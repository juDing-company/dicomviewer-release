/*
 * @Date         : 2022-03-22 15:14:40
 * @Description  : 注释
 * @LastEditTime : 2023-05-17 16:56:35
 * @LastEditors  : chen wei
 * @Version      : 1.0
 */

/**
 * Created by ZKK on 17/5/8.
 *//**
 * 该文件是根据视口的状态和提供的灰度图像数据信息转化成可在canvas绘制的图像，
 * 只是一个处理工厂，针对图像显示和变换
 * 依赖：DicomInfo、伪彩表
 *//*2016.1.12编写
 * 该库是三维处理库
 * 依赖：CBoBo.DicomKernel处理库
 */// JavaScript source code


/**
 * 该库是灰度图像标注处理库
 * 2016.12.28编写
 * 依赖：CBoBo.DicomKernel处理库
 */
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,b,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[b]=a.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var b=0;return $jscomp.iteratorPrototype(function(){return b<d.length?{done:!1,value:d[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=d[Symbol.iterator];return b?b.call(d):$jscomp.arrayIterator(d)};$jscomp.arrayFromIterator=function(d){for(var b,a=[];!(b=d.next()).done;)a.push(b.value);return a};$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.Plugin={};CBoBo.Plugin.RadianToDegree=function(d){return 57.29578*d};CBoBo.Plugin.DegreeToRadian=function(d){return.0174532*d};CBoBo.Plugin.GetClockDirection=function(d,b,a){var f=b.x-d.x;b=b.y-d.y;var g=a.x-d.x;d=a.y-d.y;a=Math.sqrt(Math.pow(f,2)+Math.pow(b,2));var c=Math.sqrt(Math.pow(g,2)+Math.pow(d,2));return 0<f/a*(d/c)-g/c*(b/a)?!0:!1};CBoBo.Plugin.GetDegree=function(d,b,a){var f=CBoBo.Plugin.GetDistance(d,b);d=CBoBo.Plugin.GetDistance(d,a);b=CBoBo.Plugin.GetDistance(b,a);if(0==f||0==d)return 0;f=(f*f-b*b+d*d)/(2*f*d);-1>f?f=-1:1<f&&(f=1);return CBoBo.Plugin.RadianToDegree(Math.acos(f))};CBoBo.Plugin.GetDistance=function(d,b){return Math.sqrt((d.x-b.x)*(d.x-b.x)+(d.y-b.y)*(d.y-b.y))};CBoBo.Plugin.GetRectAera=function(d,b){return Math.abs((b.x-d.x)*(b.y-d.y))};CBoBo.Plugin.GetEllipseAera=function(d,b){return Math.abs(Math.PI*sw*sh)};CBoBo.Plugin.GetDrawTextCoord=function(d,b,a,f,g,c){var e={lt:[],rt:[],rb:[],lb:[],dp:[]},h=g.right-g.left;g=g.bottom-g.top;for(var l,k=0;k<d;k++)l=k*c+4*k+8,e.lt.push({x:2,y:l});for(k=0;k<b;k++)l=k*c+4*k+8,e.rt.push({x:h-2,y:l});for(k=0;k<a;k++)l=g-k*c-8-4*k,e.rb.push({x:h-2,y:l});for(k=0;k<f;k++)l=g-k*c-8-4*k,e.lb.push({x:0,y:l});e.dp.push({x:5,y:(g/2).toFixed(0)});e.dp.push({x:h/2>>0,y:8});e.dp.push({x:h-10,y:g/2>>0});e.dp.push({x:h/2>>0,y:g-10});return e};CBoBo.Plugin.PolygonArea=function(d){pt0=d[0];for(var b=0,a=d.length,f=1;f<a-1;f++)b=b+(d[f].x-pt0.x)*(d[f+1].y-pt0.y)-(d[f].y-pt0.y)*(d[f+1].x-pt0.x);b=.5*Math.abs(b);return b.toFixed(0)};CBoBo.Plugin.GetDcmDistance=function(d,b,a,f){a=d.ClientToImage_point(a,b).pointSource;f=d.ClientToImage_point(f,b).pointSource;return CBoBo.Plugin.GetDistance(a,f)};CBoBo.Plugin.GetDcmRectAera=function(d,b,a,f){a=d.ClientToImage_point(a,b).pointSource;f=d.ClientToImage_point(f,b).pointSource;return CBoBo.Plugin.GetRectAera(a,f)};CBoBo.Plugin.GetDcmEllipseAera=function(d,b,a,f){a=d.ClientToImage_point(a,b).pointSource;f=d.ClientToImage_point(f,b).pointSource;return CBoBo.Plugin.GetEllipseAera(a,f)};CBoBo.Plugin.TransCoord=function(d,b,a){d=d.GetCanvas().getBoundingClientRect();return{x:b-d.left,y:a-d.top}};CBoBo.Plugin.GetRandom=function(d,b){if(void 0==d||void 0==b)return(1E12*Math.random()>>0)+(new Date).getTime();try{var a=b-d,f=(1E12*Math.random()>>0)%b;f<d&&(f+=a);0==f&&(f=b);return f}catch(g){console.log(g.message)}};CBoBo.Plugin.SetDrawTextCoord=function(d,b,a,f,g,c,e){e||(e=10);var h={lt:[],rt:[],rb:[],lb:[],dp:[]};e*=1.1;for(var l=e>>1,k,m=0;m<a;m++)k=m*e+l,h.lt.push({x:2,y:k});for(m=0;m<f;m++)k=m*e+l,h.rt.push({x:d-2,y:k});for(m=0;m<g;m++)k=b-m*e-l,h.rb.push({x:d-2,y:k});for(m=0;m<c;m++)k=b-m*e-l,h.lb.push({x:0,y:k});h.dp.push({x:5,y:b/2>>0});h.dp.push({x:d/2>>0,y:8});h.dp.push({x:d-l,y:b/2>>0});h.dp.push({x:d/2>>0,y:b-l});return h};CBoBo.Plugin.GetUrlParam=function(d){d=new RegExp("(^|\x26)"+d+"\x3d([^\x26]*)(\x26|$)");d=window.location.search.substr(1).match(d);return null!=d?unescape(d[2]):null};CBoBo.Plugin.GetUrlParamArray=function(){for(var d=location.href,b=d.indexOf("?"),d=d.substr(b+1),d=d.split("\x26"),a={},f=0;f<d.length;f++)if(b=d[f].indexOf("\x3d"),0<b){var g=d[f].substring(0,b),b=d[f].substr(b+1);a[g]=b}return a};CBoBo.Plugin.GetBrowserInfo=function(){var d=navigator.userAgent;d.indexOf("Trident");d.indexOf("Presto");d.indexOf("AppleWebKit");-1<d.indexOf("Gecko")&&d.indexOf("KHTML");var b=!!d.match(/AppleWebKit.*Mobile.*/),a=!!d.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),f=-1<d.indexOf("Android")||-1<d.indexOf("Linux"),g=-1<d.indexOf("iPhone"),c=-1<d.indexOf("iPad");d.indexOf("Safari");d=-1<d.indexOf("NHG47K")||-1<d.indexOf("rk3399")||-1<d.indexOf("RK3399");return{language:navigator.userAgent,isMobile:b,isIOS:a,isAndroid:f,isIPhone:g,isIpad:c,isTablet:d}};CBoBo.Plugin.Error=function(d,b){id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px",background:"#000"});var a=document.getElementById(id);a.width=$(window).width();a.height=$(window).height();var f=a.width/d.length*.8>>0,g=a.getContext("2d"),c=document.createElement("canvas"),e=c.getContext("2d"),h=[],l=[],k=!1,m=0,n=null,p=0,t=0,r=0,v=0,w=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return setTimeout(a,20)};this.run=function(){setTimeout(q,500);a.setAttribute("width",window.innerWidth);a.setAttribute("height",window.innerHeight);c.setAttribute("width",window.innerWidth);c.setAttribute("height",window.innerHeight);e.fillStyle="#fff";e.font="italic bold ".concat(f).concat("px ").concat("Helvetica");n=g.createLinearGradient(0,0,window.innerWidth,0);for(var b=0,k;10>b;b++)k="hsl(".concat(36*b).concat(", 50%, 50%)"),n.addColorStop(b/10||0,k);l=[];k=e.measureText(d);e.clearRect(0,0,window.innerWidth,window.innerHeight);e.fillText(d,window.innerWidth/2-k.width/2,window.innerHeight/2-f/2);b=e.getImageData(0,0,window.innerWidth,window.innerHeight);p=window.innerWidth/2-k.width/2;t=window.innerHeight/2-f/2-f;r=k.width;v=f;for(k=0;k<window.innerHeight;k+=3)for(var m=0;m<window.innerWidth;m+=3)0!=b.data[4*(k*window.innerWidth+m)]&&l.push({x:m,y:k,color:"hsl("+(360/r*m-p)+", 50%, 50%)"});h=[];b=0;for(k=Math.ceil(1*l.length);b<k;b++){var m=10*Math.random(),x=Math.random();h.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,dirX:0>.5-Math.random()?x*m:0-x*m,dirY:0>.5-Math.random()?(1-x)*m:0-(1-x)*m,split:x,oldX:0,oldY:0,moveX:0,moveY:0})}u()};var q=function(){if(k=!k)for(var a=m=0;a<h.length;a++)h[a].moveX=0,h[a].moveY=0},u=function(){g.clearRect(0,0,window.innerWidth,window.innerHeight);g.fillStyle="rgb(200, 200, 200)";for(var a=!1,c=0;c<h.length;c++)if(g.fillStyle=c<l.length?l[c].color:"rgb(200, 200, 200)",k)if(c<l.length){var e=c;g.fillRect(h[e].x|0,h[e].y|0,2,2);g.fill();var b=!1,d=l[e],e=h[e];d.x!=e.x&&(2>Math.abs(e.x-d.x)?e.x=d.x:(e.x>d.x?0<e.moveX?e.moveX-=2:--e.moveX:e.moveX=0>e.moveX?e.moveX+2:e.moveX+1,b=!0,e.x+=e.moveX));d.y!=e.y&&(2>Math.abs(e.y-d.y)?e.y=d.y:(e.y>d.y?0<e.moveY?e.moveY-=2:--e.moveY:e.moveY=0>e.moveY?e.moveY+2:e.moveY+1,b=!0,e.y+=e.moveY));b&&(a=!0)}else x(h[c]);else x(h[c]);k&&!a&&(m++,0<m&&180>=m&&(g.globalCompositeOperation="source-atop",g.fillStyle="#fff",a=p-20+(r+40)/180*m,g.fillRect(a,t-20,10,v+40),g.fillRect(a+10+5,t-20,5,v+40),g.globalCompositeOperation="source-over",180==m&&(setTimeout(q,500),setTimeout(q,6E3))));w(u)},x=function(a){a.x+=a.dirX;a.y+=a.dirY;0>a.x?a.dirX=Math.abs(a.dirX):a.x>window.innerWidth&&(a.dirX=0-a.dirX);0>a.y?a.dirY=Math.abs(a.dirY):a.y>window.innerHeight&&(a.dirY=0-a.dirY);g.fillRect(a.x|0,a.y|0,2,2);g.fill()};this.run();b=function(a){void 0===a&&(a="CLEAR DICOMVIEWER 2016");$("\x3cdiv\x3e"+a+"\x3c/div\x3e").appendTo($("body")).css({position:"absolute",bottom:0,color:"rgba(100,100,100,0.2)","font-size":"20px","z-index":"101",cursor:"default"})}(b)};CBoBo.Plugin.Error404=function(){id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px"});var d=document.getElementById(id);d.width=$(window).width();d.height=$(window).height();var b=Math.PI/90,a=d.getContext("2d"),f,g,c,e=[],h=function(a,c,e){c=c||0;a=c+((a-1||0)+1-c)*Math.random();return e?Math.round(a):a},l=function(a){return Math.random()<(a||.5)?-1:1},k=function(c,b,k,d){this.x=c||0;this.y=b||0;this.vx=l()*h(.5,.125);this.vy=l()*h(.5,.125);this.ax=0;this.ay=.01;this.c=k||"white";this.alpha=1;this.r=d||h(3,.5);this.evolve=function(){this.alpha-=.008;this.vx+=this.ax;this.vy+=this.ay;this.x+=this.vx;this.y+=this.vy;this.y>.5*f-this.r&&(this.y=.5*f-this.r,this.vx*=.95,this.vy*=-.9);Math.abs(this.x)>.5*f+2*this.r||this.y<-.5*g-2*this.r||0>=this.alpha?this.destroy():this.draw()};this.draw=function(){a.fillStyle=this.c;a.globalAlpha=this.alpha;a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.closePath();a.fill()};this.destroy=function(){var a=e.indexOf(this);e.splice(a,1)}},m=function(){f=d.width=window.innerWidth;g=d.height=window.innerHeight;c=.25*Math.min(g,f);a.restore();a.save();a.translate(.5*f,.5*g)},n=function(d){var m=c*(2+Math.sin(.73*d))/2,p=m*Math.cos(d),m=m*Math.sin(d),v=~~(.183*d/Math.PI*360)%360,w;w=e.length;a.beginPath();a.clearRect(-.5*f,-.5*g,f,g);for(var q=0;q<w;q++)e[q].evolve(),e.length!=w&&(w--,q--);for(q=0;32>q;q++)w=40*(1+Math.random()),w=new k(p+l()*h(8),m+l()*h(8),"hsl("+v+",100%,"+w+"%)"),w.draw(),e.push(w);requestAnimationFrame(n.bind(this,d+b))};m();n(0);addEventListener("resize",m,!1)};CBoBo.Plugin.Error405=function(){function d(){window.requestAnimationFrame(d);++k;e.globalCompositeOperation="source-over";e.shadowBlur=0;e.fillStyle="rgba(0,0,0,alp)".replace("alp",h.repaintAlpha);e.clearRect(0,0,g,c);e.shadowBlur=h.shadowBlur;e.globalCompositeOperation="lighter";m=h.tickHueMultiplier*k;l.map(function(a){a.step()})}function b(){this.circles=[new a(2,0)];this.rot=Math.random()*Math.PI*2;this.angularVel=Math.random()*h.rayAngularVelSpan*(.5>Math.random()?1:-1);this.angularAccWaveInput=Math.random()*Math.PI*2;this.angularAccWaveInputIncrementer=h.rayAngularAccWaveInputBaseIncrementer+h.rayAngularAccWaveInputAddedIncrementer*Math.random();for(var c=100,e=0;0<--c&&this.circles[e].radius<h.maxRadius;)this.circles.push(new a(++e))}function a(a){this.radius=h.circleRadiusIncrementAcceleration*Math.pow(a,2);this.waveInputIncrementer=(h.baseWaveInputIncrementer+h.addedWaveInputIncrementer*Math.random())*(.5>Math.random()?1:-1)*h.circleNumWaveIncrementerMultiplier*a;this.waveInput=Math.random()*Math.PI*2;this.radiant=Math.random()*h.radiantSpan*(.5>Math.random()?1:-1)}id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px"});var f=document.getElementById(id),g=f.width=window.innerWidth,c=f.height=window.innerHeight,e=f.getContext("2d"),h={rays:30,maxRadius:Math.sqrt(g*g/4+c*c/4),circleRadiusIncrementAcceleration:2,radiantSpan:.4,rayAngularVelSpan:.005,rayAngularVelLineWidthMultiplier:60,rayAngularAccWaveInputBaseIncrementer:.03,rayAngularAccWaveInputAddedIncrementer:.02,rayAngularAccWaveMultiplier:3E-4,baseWaveInputIncrementer:.01,addedWaveInputIncrementer:.01,circleNumWaveIncrementerMultiplier:.1,circleNumLineWidthMultiplier:2,cx:g/2,cy:c/2,tickHueMultiplier:1,shadowBlur:0,repaintAlpha:.2},l=[],k=0,m;b.prototype.step=function(){var a=this.rot+=this.angularVel+=Math.sin(this.angularAccWaveInput+=this.angularAccWaveInputIncrementer)*h.rayAngularAccWaveMultiplier,c=h.cx,l=h.cy;e.lineWidth=Math.min(1E-5/Math.abs(this.angularVel),10/h.rayAngularVelLineWidthMultiplier)*h.rayAngularVelLineWidthMultiplier;e.beginPath();e.moveTo(c,l);for(var b=0;b<this.circles.length;++b){var k=this.circles[b];k.step();var a=a+k.radiant,d=h.cx+Math.sin(a)*k.radius,k=h.cy+Math.cos(a)*k.radius;e.quadraticCurveTo(c,l,(c+d)/2,(l+k)/2);c=d;l=k}e.strokeStyle=e.shadowColor="hsl(hue,80%,50%)".replace("hue",(a+this.rot)/2%(2*Math.PI)/Math.PI*30+m);e.stroke()};a.prototype.step=function(){this.waveInput+=this.waveInputIncrementer;this.radiant=Math.sin(this.waveInput)*h.radiantSpan};(function(){for(var a=l.length=0;a<h.rays;++a)l.push(new b);0===k&&d()})()};CBoBo.Plugin.GetTime=function(){var d=new Date,b=d.getMonth()+1,b=10>b?"0"+b:b;return d.getFullYear()+"/"+b+"/"+d.getDate()+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()};CBoBo.Plugin.SetCookie=function(d,b,a){var f=new Date;f.setTime(f.getTime()+864E5*a);a="expires\x3d"+f.toUTCString();document.cookie=d+"\x3d"+b+"; "+a+";path\x3d/;"};CBoBo.Plugin.GetCookie=function(d){d+="\x3d";for(var b=document.cookie.split(";"),a=0;a<b.length;a++){for(var f=b[a];" "==f.charAt(0);)f=f.substring(1);if(-1!=f.indexOf(d))return f.substring(d.length,f.length)}return""};CBoBo.Plugin.ClearCookie=function(d){CBoBo.Plugin.SetCookie(d,"",-1)};CBoBo.Plugin.FullScreen=function(d){function b(){var a=document.documentElement,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullScreen;"undefined"!=typeof b&&b?b.call(a):"undefined"!=typeof window.ActiveXObject&&(a=new ActiveXObject("WScript.Shell"),null!=a&&a.SendKeys("{F11}"))}function a(){var a=document,b=a.cancelFullScreen||a.webkitCancelFullScreen||a.mozCancelFullScreen||a.exitFullScreen;"undefined"!=typeof b&&b?b.call(a):"undefined"!=typeof window.ActiveXObject&&(a=new ActiveXObject("WScript.Shell"),null!=a&&a.SendKeys("{F11}"))}d?b():a()};CBoBo.Plugin.CloneObj=function(d){var b={};d instanceof Array&&(b=[]);for(var a in d){var f=d[a];b[a]="object"===typeof f?arguments.callee(f):f}return b};"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.PTYPE_JPG=0;CBoBo.PTYPE_SERIES=1;CBoBo.PTYPE_DESERIES=2;CBoBo.TOOL_NULL=0;CBoBo.TOOL_WC=1;CBoBo.TOOL_MOVE=2;CBoBo.TOOL_ZOOM=3;CBoBo.TOOL_PAGE=4;CBoBo.TOOL_M_POINT=5;CBoBo.TOOL_M_LINE=6;CBoBo.TOOL_M_RECT=7;CBoBo.TOOL_M_ELLIPSE=8;CBoBo.TOOL_M_CURVE=9;CBoBo.TOOL_M_ANGLE=10;CBoBo.TOOL_LABEL=11;CBoBo.TOOL_MAG=12;CBoBo.TOOL_POLYGON=13;CBoBo.TOOL_ARROW=14;CBoBo.TOOL_LEFT=15;CBoBo.TOOL_RIGHT=16;CBoBo.TOOL_HEARDRATIO=17;CBoBo.DRAW_IMG=0;CBoBo.DRAW_ANN=1;CBoBo.MPR_ORIGINAL=0;CBoBo.MPR_LEVEL=1;CBoBo.MPR_VERTICAl=2;CBoBo.MPR_ANY=3;CBoBo.TOOLMENU_JPG=0;CBoBo.TOOLMENU_SERIES=1;CBoBo.TOOLMENU_DESERIES=2;CBoBo.TOOLMENU_PRINT_JPG=3;CBoBo.TOOLMENU_PRINT_RADIATE=4;CBoBo.TOOLMENU_MPR=5;CBoBo.TOOLMENU_AI=6;CBoBo.TOOLMENU_VRT=7;CBoBo.MSG_ALERT=0;CBoBo.MSG_SUCCESS=1;CBoBo.MSG_ERROR=2;CBoBo.SMOOTHING_ENABLED=!1;CBoBo.Scrollsize=20;CBoBo.IsMobile=!1;CBoBo.IsTablet=!1;CBoBo.isShowAi=!1;CBoBo.rootDom=null;CBoBo.store={db:{dbName:"DicomView",version:"1",storeName:"DicomStore",_enableImagesDB:localStorage.getItem("enableImagesDB")||!0,get enableImagesDB(){var d=this._enableImagesDB;return void 0===d?d:!!JSON.parse(d)},set enableImagesDB(d){this._enableImagesDB=d=d?1:0;localStorage.setItem("enableImagesDB",d)}},loadQueue:{waitSeriesID:new Map}};CBoBo.Manager=function(d){var b=this,a=this;this.isAIFinished=this.isAIRequestFinished=!1;this.onTool={bShowScountLine:!1,stack:[]};this.handles={};this.privilege={bPrint:void 0,bMupStudy:!1};this.onCanvas={bLMouse:!1,bRMouse:!1,ptStart:{x:0,y:0},ptLast:{x:0,y:0},imgStatus:[],Ann:null,bEditAnn:!1,EditAnnData:null,curCanvas:null,ptLable:null,stampStart:null,bTouchMul:!1,lastScale:1};this.onObserver=function(a,e){this.handles.hasOwnProperty(a)||(this.handles[a]=[]);if("function"==typeof e)this.handles[a].push(e);else throw Error("\u7f3a\u5c11\u56de\u8c03\u51fd\u6570");return this};this.onEmit=function(a,e){if(this.handles.hasOwnProperty(a))this.handles[a].forEach(function(a,c,b){a.apply(null,e)});else throw Error('"'+a+'"\u4e8b\u4ef6\u672a\u6ce8\u518c');return this};this.onOff=function(a,e){if(this.handles.hasOwnProperty(a)){if("function"!=typeof e)throw Error("\u7f3a\u5c11\u56de\u8c03\u51fd\u6570");this.handles[a].forEach(function(a,c,b){a==e&&b.splice(c,1)})}else throw Error('"'+a+'"\u4e8b\u4ef6\u672a\u6ce8\u518c');return this};this.onThumb={bSeriesTile:!1};this.canvasManager;this.logo;this.dataManager;this.thumbManager;this.frame;this.annStatusManager;this.layoutCtrl;this.rotateCtrl;this.wwCtrl;this.lableCtrl;this.pseudocolorCtrl;this.mode;this.canvasCtxMenu;this.thumbCtxMenu;this.seriesPlayer;this.Mpr;this.VRT;this.printer;this.toolBar;this.configView;this.assistDiagnose;this.canvasMax;this.isKeyBoard=!1;this.rootDom=d;this.GlobalInit=function(){$("body,a,img,span").bind("drop",function(a){a.preventDefault();a.stopPropagation()});$("body").bind("touchmove",function(a){a.preventDefault()});document.oncontextmenu=function(a){a.cancelBubble=!0;return a.returnValue=!1};document.onmousedown=function(a){if(window.Event){if(2==a.which||3==a.which)return!1}else if(2==a.button||3==a.button)return a.cancelBubble=!0,a.returnValue=!1};document.onkeydown=function(c){var e=c||window.event||arguments.callee.caller.arguments[0];e&&a.KeyboardMsg(e)};window.screen&&window.resizeTo(screen.availWidth,screen.availHeight);void 0===CBoBo.store.db.enableImagesDB&&a.toggleImageBDHandle(confirm("\u662f\u5426\u5f00\u542f\u56fe\u50cf\u7f13\u5b58\u529f\u80fd"))};this.KeyboardMsg=function(c){if(!a.isKeyBoard){var e=c.shiftKey,h=c.ctrlKey;switch(c.keyCode){case 80:if(!a.privilege.bPrint)break;a.printer||(a.printer=new CBoBo.View.DVPrint({msgtransform:a.PrintView.MsgTransform,mode:a.mode}));a.onTool.MsgTransform({usermsg:"sdaf",btntitle:"\u80f6\u7247\u6253\u5370",btnforce:!0});if(a.printer){var b=[];a.printer.bShow||a.printer.Show(!0);if(a.mode==CBoBo.PTYPE_SERIES&&h)e=a.canvasManager.GetFocusMng().AnnStatusMng().GetAnnStatus(),$.each(e,function(c,e){b.push(a.annStatusManager.GetCopyAnnStatus(e))});else if(e=a.canvasManager.GetFocusCanvas().AnnStatus())e=a.annStatusManager.GetCopyAnnStatus(e),b.push(e);0<b.length&&a.printer.RequestPrint(b)}c.preventDefault();break;case 27:a.canvasMax&&a.canvasMax.bShow&&a.onCanvas.DbClick();break;case 9:case 112:case 117:case 121:case 122:case 114:case 115:case 118:c.preventDefault();case 46:if(e){c=CBoBo.store.db;var k=new simple.IndexedDB(c.dbName,c.storeName,c.version);k.open().then(function(){k.dispatch("clear").then(function(){alert("\u56fe\u50cf\u7f13\u5b58\u6e05\u9664\u6210\u529f")})})}break;case 37:a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.scroll&&a.canvasMax.secondCtrl.scroll.TriggerClick(1):a.canvasManager.scroll&&a.canvasManager.scroll.TriggerClick(1);break;case 38:this.onCanvas.NextPage(1);break;case 39:a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.scroll&&a.canvasMax.secondCtrl.scroll.TriggerClick(-1):a.canvasManager.scroll&&a.canvasManager.scroll.TriggerClick(-1);break;case 40:this.onCanvas.NextPage(-1);break;case 83:h&&c.preventDefault();break;case 82:h?(a.onTool.ReLoadDicom(),c.preventDefault()):a.onTool.RestoreDicom();break;case 70:a.onTool.Negative();break;case 48:a.onTool.Pseudocolor("");break;case 49:a.onTool.Pseudocolor("\u5f69\u8679");break;case 50:a.onTool.Pseudocolor("\u9ed1\u4f53");break;case 51:a.onTool.Pseudocolor("\u9aa8\u9abc");break;case 52:a.onTool.Pseudocolor("\u5fc3\u810f");break;case 53:a.onTool.Pseudocolor("\u6d41\u52a8");break;case 54:a.onTool.Pseudocolor("Ge\u8272");break;case 55:a.onTool.Pseudocolor("\u5f69\u86791");break;case 56:a.onTool.Pseudocolor("\u7ea2\u8272\u8840\u7ba1");break;case 57:a.onTool.Pseudocolor("\u65af\u7279\u6069")}}};this.DL={arrSpeed:{}};this.DL.OpenStudy=function(){void 0===a.dataManager&&(a.dataManager=new CBoBo.DataManager({render:a.DL.DLFirstProgress,manager:a}));if(0===arguments.length){var c=CBoBo.Plugin.GetUrlParam("Studyuid")||$("#hdstuuid").val(),e=CBoBo.Plugin.GetUrlParam("WadoURL")||$("#hdurl").val(),h=CBoBo.Plugin.GetUrlParam("Hospid")||$("#hdhospid").val(),b=CBoBo.Plugin.GetUrlParam("token")||$("#token").val(),k=1==CBoBo.Plugin.GetUrlParam("imageType")?1:0,d=CBoBo.Plugin.GetUrlParam("departCode")||$("#departCode").val()||0,f=CBoBo.Plugin.GetUrlParam("isDesens")||CBoBo.Plugin.GetUrlParam("hasDesensitize")||CBoBo.Plugin.GetUrlParam("hdsensitivity")||$("#hasDesensitize").val()||$("#hdsensitivity").val(),g=CBoBo.Plugin.GetUrlParam("isKeyImage")||$("#isKeyImage").val(),t=CBoBo.Plugin.GetUrlParam("isInternal")||$("#isInternal").val();if(""===c)new CBoBo.Plugin.Error("Study not Found.","Studyuid is null.");else if(""===e)new CBoBo.Plugin.Error("Study not Found.","Wadourl is null.");else if(""===h)new CBoBo.Plugin.Error("Study not Found.","Hospitaluid is null.");else{var r=c?c.split(","):[];1<r.length?a.dataManager.Request({wadourl:e,hospid:h,studyuid:r[0],token:b,imageType:k,departCode:d,hasDesensitize:JSON.parse(f||0)?1:0,isKeyImage:g,isInternal:t,serverRead:!1,progress:a.DL.DLFirstProgress,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var c=CBoBo.Plugin.GetTime();console.log(c+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(c){a.Init();var b=a.thumbManager.GetThumb(c.studyuid);void 0===b&&(b=a.thumbManager.AddThumb(c.studyuid));b.First();a.DL.StudySuccess(c);a.DL.RequestHistoryStudy(r,e,h,!1)}}):a.dataManager.Request({wadourl:e,hospid:h,studyuid:c,token:b,imageType:k,departCode:d,hasDesensitize:JSON.parse(f||0)?1:0,isKeyImage:g,isInternal:t,serverRead:!1,progress:a.DL.DLFirstProgress,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var c=CBoBo.Plugin.GetTime();console.log(c+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(c){a.Init();var e=a.thumbManager.GetThumb(c.studyuid);void 0===e&&(e=a.thumbManager.AddThumb(c.studyuid));e.First();a.DL.StudySuccess(c)}})}}else 3==arguments.length&&(c=arguments[2],e=arguments[0],h=arguments[1],alert("dsad"),a.dataManager.Request({wadourl:e,hospid:h,studyuid:c,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var c=CBoBo.Plugin.GetTime();console.log(c+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(c){a.privilege.bMupStudy=!1;a.Init();var e=a.thumbManager.GetThumb(c.studyuid);void 0===e&&(e=a.thumbManager.AddThumb(c.studyuid));e.First();a.DL.StudySuccess(c)}}))};this.DL.RequestHistoryStudy=function(c,e,h,b){a.privilege.bMupStudy=!1;c.splice(0,1);0<c.length?c.forEach(function(c,b){a.dataManager.Request({wadourl:e,hospid:h,studyuid:c,serverRead:!1,progress:a.DL.DLFirstProgress,history:!0,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var c=CBoBo.Plugin.GetTime();console.log(c+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(c){a.DL.StudySuccess(c);void 0===a.thumbManager.GetThumb(c.studyuid)&&a.thumbManager.AddThumb(c.studyuid)}})}):console.log("\u672a\u68c0\u6d4b\u5230\u5386\u53f2\u68c0\u67e5\u3002")};this.DL.StudySuccess=function(c){var e=a.thumbManager.GetThumb(c.studyuid);if(void 0===e||null===e)e=a.thumbManager.AddThumb(c.studyuid);a.DL.SetThumbHead(c,e);a.DL.SetThumbSeries(c,e)};this.DL.DLFirstProgress=function(c,e,h,b){c.col=void 0==c.col?512:c.col;c.row=void 0==c.row?512:c.row;a.UpdateCanvas(c);a.DL.DLProgress(c,e,h)};this.DL.DLProgress=function(c,e,h){var b=e.studyuid,k=a.thumbManager.GetThumb(b);void 0===a.DL.arrSpeed[b]&&(a.DL.arrSpeed[b]={dlnums:0,dlspeed:0,total:parseInt(e.imgcount),timer:null});b=a.DL.arrSpeed[b];b.dlnums++;b.dlnums===b.total&&($.Status("\u68c0\u67e5\u4e0b\u8f7d\u5b8c\u6bd5!"),clearInterval(b.timer));a.DL.ProcessMode({study:e,seriespro:function(){k.SetProgress(c.seruid,h)},deseriespro:function(){k.SetProgress(c.id,h)},jpgpro:function(){k.SetProgress(c.id,100)}})};this.DL.SetThumbHead=function(a,e){if(void 0===e)throw"SetThumbHead:parameter study cannot be undefined";if(void 0===a)throw"SetThumbHead:parameter thumb cannot be undefined";var c;""===a.age||null===a.age?c=a.name+" / "+a.sex:("string"===typeof a.age&&0==parseInt(a.age.substring(0,1))&&(a.age=a.age.substring(1)),c=a.name+" / "+a.sex+" / "+a.age);e.SetHeadInfo(c,a.modality,a.studydate)};this.DL.SetThumbSeries=function(c,e){a.DL.ProcessMode({study:c,seriespro:function(){for(var a=c.GetAllSeries(),b,k=0;k<a.length;k++){b=a[k];e.PushSerisesItem(b.uid);if(0<b.arrImage.length){var d=a[k].arrImage[0];e.SetItemInfo(b.uid,"["+(k+1)+"] \u5171"+b.arrImage.length+"\u56fe","\u5e8f\u5217\uff1a"+b.num);e.SetItemIcon(b.uid,d.imageicon,d.id,b)}e.SetProgress(b.uid,0)}},deseriespro:function(){for(var a=c.GetAllDicom(),b=0;b<a.length;b++){var k=a[b],d=k.id;e.PushSerisesItem(d);e.SetItemInfo(d,"["+(b+1)+"] \u51711\u56fe",k.num);e.SetItemIcon(d,k.imageicon,k.id);e.SetProgress(d,0)}},jpgpro:function(){var a=c.GetJpg();$.each(a,function(a,c){var h=c.id;e.PushSerisesItem(h);e.SetItemInfo(a,"["+(a+1)+"] \u5171 1 \u5f20\u56fe","\u7f16\u53f7\uff1a"+c.num);e.SetItemIcon(a,c.imageicon,c.id);e.SetProgress(h,0)})}});e.UpdateStyle();e.UpdateSeriesData()};this.DL.ProcessMode=function(a){if(void 0!==a)switch(a=$.extend(!0,{study:null,seriespro:null,deseriespro:null,jpgpro:null},a),a.study.GetStudyType()){case "jpg":a.jpgpro instanceof Function&&a.jpgpro();break;case "series":a.seriespro instanceof Function&&a.seriespro();break;case "deseries":a.deseriespro instanceof Function&&a.deseriespro()}};this.UpdateCanvas=function(c){if(a.canvasMax&&a.canvasMax.bShow){var e=a.canvasMax.secondCtrl.GetMng()[0],h=e.AnnStatusMng();if(h){var b=e.scroll?e.scroll.draggerPos:1,k=e.GetLayout();if(void 0===k||1>k.row||1>k.col)k={row:1,col:1};var d=a.GetSelArray(h.images,b,k.row,k.col);a.DrawAnnStatusForMng(h,e,!0);e=e.GetAllCanvas();$.each(e,function(a,e){a<d.length&&(a=d[a],a.id===c.id&&a.bLoadImage&&(e.bAnimatStop||e.StopLoadingAnimation(),h.viewport.image=a,1===h.viewport.scale?(CBoBo.ImageProcessor.Restore(h.viewport),CBoBo.Draw.FitServerCanvas(h.viewport,e.canvas)):CBoBo.Draw.FitServerCanvas(h.viewport,e.canvas,!0),e.DrawCornerInfo(h.viewport)))})}}else e=a.canvasManager.GetMng(),$.each(e,function(){var e=this.AnnStatusMng();if(e){var h=this.scroll?this.scroll.draggerPos:1,b=this.GetLayout();if(void 0===b||1>b.row||1>b.col)b={row:1,col:1};var l=a.GetSelArray(e.images,h,b.row,b.col),h=this.GetAllCanvas();$.each(h,function(a,h){a<l.length&&(a=l[a],a.id===c.id&&a.bLoadImage&&(h.bAnimatStop||h.StopLoadingAnimation(),e.viewport.image=a,1===e.viewport.scale?(CBoBo.ImageProcessor.Restore(e.viewport),CBoBo.Draw.FitServerCanvas(e.viewport,h.canvas)):CBoBo.Draw.FitServerCanvas(e.viewport,h.canvas,!0),h.DrawCornerInfo(e.viewport)))})}})};this.InitMulStudyMode=function(){a.privilege.bMupStudy||a.mode==CBoBo.PTYPE_SERIES?a.privilege.bMupStudy=!0:(void 0!==this.canvasManager&&(this.canvasManager.Destroy(),delete this.canvasManager),void 0!==this.annStatusManager&&delete this.annStatusManager,a.privilege.bMupStudy=!0,this.Init())};this.Init=function(){function c(c){c="#"+a.frame.GetId("canvasbox");a.canvasManager=new CBoBo.View.CMngSecondLayer({parent:c,msgtransform:a.MsgTransform,scrollsize:CBoBo.Scrollsize})}void 0===a.frame&&(a.frame=new CBoBo.View.Frame(this.rootDom));void 0===a.thumbManager&&(a.thumbManager=new CBoBo.View.ThumbManager({parent:"#"+a.frame.GetId("thumb"),msgtransform:a.onThumb.MsgTransform}));var e=a.dataManager.GetStudy(0),h=e.GetStudyType();a.InitAnnStatusStack();var b,k;switch(h){case "jpg":b=CBoBo.TOOLMENU_JPG;k=a.onTool.Jpg.MsgTransform;break;case "deseries":b=CBoBo.TOOLMENU_DESERIES;k=a.onTool.MsgTransform;break;case "series":b=CBoBo.TOOLMENU_SERIES,k=a.onTool.MsgTransform}var d=1,f=1;CBoBo.IsMobile&&0==CBoBo.IsTablet?(a.frame.HideToolBar(),c(!0),void 0===a.toolBar&&(a.toolBar=new CBoBo.View.MobileMenuBall({msgtransform:k})),a.toolBar.RequestToolBall(b,k),a.toolBar.toolType="ww"):(a.WindowResize(),c(CBoBo.IsTablet),void 0===a.toolBar&&(a.logo=(new CBoBo.View.Logo("#"+a.frame.GetId("logo"))).SetFont("\u5f71\u50cf\u6e90").SetLogo(""),a.toolBar=new CBoBo.View.PCToolBar({parent:"#"+a.frame.GetId("toolbar"),msgtransform:a.onTool.Main.MsgTransform})),a.toolBar.RequestGrayToolBar(b,k),a.toolBar.toolType="zoom",a.toolBar.modalityType=e.modality,a.toolBar.ChangeBtnStatus("\u653e\u7f29",!0),a.toolBar.ChangeBtnStatus("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0),a.toolBar.ChangeBtnStatus("\u672c\u5730\u7f13\u5b58",CBoBo.store.db.enableImagesDB),e=JSON.parse(localStorage.getItem("seriesLayoutCount"))||{},d=e.row,e=e.col,d&&e?f=e:"series"===h?(d=2,f=3):f=d=1);var g=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(g.length,d,f);h=a.canvasManager.GetMng();void 0!==h&&$.each(h,function(a,c){a<g.length&&c.UpdateLayout(g[a].images.length,1,1)});a.canvasManager.SetDefaultFocus(0,0);a.onTool.ReLoadDicom();a.privilege.bPrint=!0;a.toolBar.EnableButton&&a.toolBar.EnableButton("\u80f6\u7247\u6253\u5370",!0)};this.WindowResize=function(){window.onresize=function(c){a.frame.UpdateStyle();a.logo&&a.logo.SetStyle();a.toolBar&&a.toolBar.UpdateStyle&&a.toolBar.UpdateStyle();a.layoutCtrl&&a.layoutCtrl.UpdateStyle();a.rotateCtrl&&a.rotateCtrl.UpdateStyle();a.lableCtrl&&a.lableCtrl;a.pseudocolorCtrl&&a.pseudocolorCtrl.UpdateStyle();a.thumbManager&&a.thumbManager.ForEach(function(a){a.UpdateStyle()});a.canvasCtxMenu&&a.canvasCtxMenu.UpdateStyle();a.Mpr&&(a.Mpr.UpdateStyle(),a.Mpr.mng.TriggerResize());a.VRT&&(a.VRT.UpdateStyle(),a.VRT.mng.TriggerResize());a.configView&&a.configView.TriggerResize();a.canvasMax&&(a.canvasMax.UpdateStyle(),a.canvasMax.secondCtrl.TriggerResize());a.canvasManager&&a.canvasManager.TriggerResize(c)}};this.InitAnnStatusStack=function(){var c=a.dataManager.GetStudy(0);if(void 0!==c){var e=c.GetStudyType();CBoBo.AnnStatusManager.Clear();switch(e){case "jpg":var h=c.GetJpg();a.annStatusManager.NewAnnStatusArray(c.studyuid,h,e);break;case "deseries":h=c.GetAllDicom();h instanceof Array&&0<h.length&&$.each(h,function(){var a=CBoBo.AnnStatusManager.Create(this,c.studyuid,e);CBoBo.ImageProcessor.Restore(a.viewport)});break;case "series":$.each(c.GetAllSeries(),function(a,h){a=h.GetAllDicom();a=CBoBo.AnnStatusManager.Create(a,c.studyuid,e);CBoBo.ImageProcessor.Restore(a.viewport)})}}};this.DrawAnnStatus=function(c,e,h,b,k,d){d=void 0===d?0:d;var l=[];e instanceof Array?$.each(e,function(){l.push(this)}):l.push(e);var f,g;void 0!==b&&void 0!==k?(g=Math.min(b,c.images.length-1),e=Math.min(g+k,c.images.length),f=c.images.slice(g,e)):(g=0,e=l.length,f=c.images);var m=a.dataManager.GetStudy(d);m.IsPageSwitch();m.GetStudyType();$.each(l,function(e,b){if(e<f.length)if(e=f[e],e.bLoadImage){if(a.canvasAIMax&&a.canvasAIMax.bShow){var l=m.GetAnnotations();if(!1===a.isAIFinished||!l.length){b.canvas.width=b.canvas.width;b.DrawCornerInfo();b.bAnimatStop&&b.StartLoadingAnimation();return}}b.bAnimatStop||b.StopLoadingAnimation();c.viewport.image=e;if(1===c.viewport.scale&&0===c.viewport.wc&&0===c.viewport.ww||0===c.viewport.wc&&0===c.viewport.ww)CBoBo.ImageProcessor.Restore(c.viewport),CBoBo.Draw.FitServerCanvas(c.viewport,b.canvas,!1,!0);h?CBoBo.Draw.FitServerCanvas(c.viewport,b.canvas):CBoBo.Draw.DrawImage(c.viewport,b.canvas);a.toolBar&&a.toolBar.bShowCornerInfo?b.DrawCornerInfo(c.viewport):b.DrawCornerInfo();if(a.canvasAIMax&&a.canvasAIMax.bShow){var k=e.imageInstanceUid;c.anns[k]instanceof Array||(c.anns[k]=[]);var d=c.viewport;$.each(l,function(e,h){if(h.imageInstanceUid==k){var l=c.anns[k];l.length||$.each(h.annotation,function(a,c){a=CBoBo.Annotation.NewAIAnnotation(d,b.canvas,"rect",c.points[0],c.points[1]);l.push(a)})}a.canvasAIMax.secondCtrl.SetDefaultFocus(0,0)});c.anns[k]instanceof Array||(c.anns[k]=[]);CBoBo.Annotation.DrawAnnotation(c.viewport,b.canvas,c.anns[k])}else c.anns[e.id]instanceof Array||(c.anns[e.id]=[]),CBoBo.Annotation.DrawAnnotation(c.viewport,b.canvas,c.anns[e.id])}else{if(b.StartLoadingAnimation(),0==g){var n=b.canvas;simple.canvasDrawImage(n,e.imageicon,{interceptors:function(){b.StopLoadingAnimation();return Promise.resolve(1===n.parentElement.childElementCount)}}).catch(function(){})}}else b.canvas.width=b.canvas.width,b.DrawCornerInfo()})};this.DrawAnnStatusForMng=function(c,e,h){var b=e.scroll?e.scroll.draggerPos:1,k=e.GetLayout();if(void 0===k||1>k.row||1>k.col)k={row:1,col:1};k=k.row*k.col;b=(b-1)*k;e=e.GetAllCanvas();a.DrawAnnStatus(c,e,h,b,k)};this.GetSelArray=function(a,e,h,b){if(void 0!=a&&void 0!=e&&void 0!=h&&void 0!=b){h*=b;e=(e-1)*h;if(e>a.length-1||0>e)return[];b=a.length-e;return a.slice(e,(h>b?b:h)+e)}};this.ChangeToolBar=function(c){if((c=c.mng.AnnStatusMng())&&!c.bPrint){var e,h;switch(c.type){case "series":e=CBoBo.TOOLMENU_SERIES;h=a.onTool.MsgTransform;break;case "deseries":e=CBoBo.TOOLMENU_DESERIES;h=a.onTool.MsgTransform;break;case "jpg":e=CBoBo.TOOLMENU_JPG;h=a.onTool.Jpg.MsgTransform;break;case CBoBo.TOOLMENU_PRINT_JPG:e=c.type}a.toolBar.RequestToolBall&&a.toolBar.RequestToolBall(e,h);a.toolBar.RequestGrayToolBar&&a.toolBar.RequestGrayToolBar(e,h)}};this.GetContextMenu=function(c){a.canvasCtxMenu&&a.canvasCtxMenu.Destroy();a.canvasCtxMenu="jpg"==c?new CBoBo.View.ContextMenu({action:a.onTool.Jpg.MsgTransform,flash:!0,speed:300,items:[{text:"\u4eae\u5ea6/\u5bf9\u6bd4"},{text:"\u653e\u7f29"},{text:"\u79fb\u52a8"},{text:"\u5220\u9664\u56fe\u50cf"},{text:"\u8d1f\u50cf"},{text:"\u6062\u590d"}]}):new CBoBo.View.ContextMenu({action:a.onTool.MsgTransform,flash:!0,speed:300,items:[{text:"\u8c03\u7a97"},{text:"\u653e\u7f29"},{text:"\u79fb\u52a8"},{text:"\u5220\u9664\u56fe\u50cf"},{text:"\u9006\u65f6\u9488"},{text:"\u987a\u65f6\u9488"},{text:"\u5de6\u53f3\u955c\u50cf"},{text:"\u4e0a\u4e0b\u955c\u50cf"},{text:"\u8d1f\u50cf"},{text:"\u6062\u590d"},{text:"DICOM\u4fe1\u606f"}]});return a.canvasCtxMenu};this.IsUIWaitId=function(c){var e=!1,h=a.canvasManager.GetMng();$.each(h,function(){var h=this.AnnStatusMng();if(h){var b=this.scroll?this.scroll.draggerPos:1,d=this.GetLayout();if(void 0===d||1>d.row||1>d.col)d={row:1,col:1};h=a.GetSelArray(h.images,b,d.row,d.col);$.each(h,function(){this.id===c&&(e=!0)})}});return e};this.DRS={};var f=!0,g=simple.debounce(function(a){b.DRS.MsgTransform(a);f=!0},1500);this.DRS.MsgTransform=function(c){var e=c.value,h=c.firstmng;switch(c.type){case "resize":b.DRS.Resize(c);break;case "scroll":h&&(h=h.AnnStatusMng().images[e-1],f?(f=!1,setTimeout(function(){f=!0},1E3),b.scrollDownLoadLazySeriesHandle(h.customSeriesId,1,e)):0==h.bLoadImage&&g(c));a.DRS.Scroll(c);break;case "drag":a.DRS.DragImage(c)}};this.DRS.Resize=function(c){a.Mpr&&a.Mpr.bShow&&(a.Mpr.mng.UpdateLayoutSp3(0,"left"),a.Mpr.mng.SetSpBoundaryColor(0,"#F00"),a.Mpr.mng.SetSpBoundaryColor(1,"#0F0"),a.Mpr.mng.SetSpBoundaryColor(2,"#00F"),c=a.Mpr.mng.AnnStatusMng(),a.onCanvas.Mpr.UpdateCanvas(c));a.VRT&&a.VRT.bShow&&(c=a.VRT.mng.AnnStatusMng(),a.onCanvas.VRT.UpdateCanvas(c));if(a.canvasMax&&a.canvasMax.bShow){var e=a.canvasMax.secondCtrl.GetMng()[0];(c=e.AnnStatusMng())&&a.DrawAnnStatusForMng(c,e,!0)}else c=a.canvasManager.GetMng(),$.each(c,function(c,e){(c=e.AnnStatusMng())&&a.DrawAnnStatusForMng(c,e,!0)})};this.DRS.Scroll=function(c){var e=c.value;if(c.firstmng){var h=c.firstmng;if(c=h.AnnStatusMng()){var b=h.GetLayout();if(!(void 0===b||1>b.row||1>b.col)){var k=b.row*b.col,b=h.GetLayoutCanvas();void 0!==b&&(a.DrawAnnStatus(c,b,!1,(e-1)*k,k),a.onTool.ScountLine(!0))}}}else if(c.secondmng)if(c=CBoBo.AnnStatusManager.Get(),a.canvasMax&&a.canvasMax.bShow)h=a.canvasMax.secondCtrl.GetMng()[0],c=c[e-1],h.AnnStatusMng(c),h.UpdateLayout(c.images.length),a.DrawAnnStatusForMng(c,h);else for(var h=a.canvasManager.GetLayout(),e=a.GetSelArray(c,e,h.row,h.col),k=a.canvasManager.GetMng(),d=0;d<k.length;d++)h=k[d],b=h.GetLayoutCanvas(),0===b.length&&h.UpdateLayout(0,1,1),d<e.length?(c=e[d],h.AnnStatusMng(c),h.UpdateLayout(c.images.length),"series"===c.type&&h.checkbox.Show(!0),a.DrawAnnStatus(c,b,!0)):(h.checkbox.Show(!1),$.each(b,function(a,c){c.Clear();c.DrawCornerInfo()}),h.Clear())};this.DRS.DragImage=function(c){var e=c.imgId;c=c.mng;var h=a.dataManager.GetStudy(e),b=h.GetStudyType(),k;switch(b){case "jpg":k=h.GetJpg();c.checkbox.Show(!1);break;case "deseries":k=h.GetDicomById(e);c.checkbox.Show(!1);break;case "series":var d=h.GetSeries(e);k=d.GetAllDicom();a.downLoadLazySeriesHandle(d.customSeriesId,1,d.studyuid);c.checkbox.Show(!0)}d=c.AnnStatusMng();k=CBoBo.AnnStatusManager.Replace(d,k,h.studyuid,b);void 0!==k&&(c.AnnStatusMng(k),c.UpdateLayout(k.images.length),CBoBo.ImageProcessor.Restore(k.viewport),c=c.GetAllCanvas(),a.DrawAnnStatus(k,c,!0,void 0,void 0,e))};this.onThumb.MsgTransform=function(c){switch(c.type){case "click":c.series&&a.downLoadLazySeriesHandle(c.series.customSeriesId,1,c.series.studyuid);break;case "mousedown":"head"==c.tag&&3==c.which&&(void 0===a.thumbCtxMenu&&(a.thumbCtxMenu=new CBoBo.View.ContextMenu({action:a.onThumb.ToolMsg,flash:!0,speed:300,items:[{text:"\u5220\u9664\u8be5\u68c0\u67e5"},{text:"\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5"}]})),a.thumbCtxMenu.SetReserve(c.studyuid),a.thumbCtxMenu.SetPosition(c.clientX,c.clientY),a.thumbCtxMenu.Show(!0));break;case "doubletap":case "dblclick":a.onThumb.ThumbDbClick(c)}};this.onThumb.ThumbDbClick=function(c){c=parseInt(c.target.title);if(a.Mpr&&a.Mpr.bShow)a.onCanvas.Mpr.DragImage(c);else{var e={type:"drag"};e.imgId=c;e.mng=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetMng()[0]:a.canvasManager.GetFocusMng();a.DRS.MsgTransform(e)}};this.onThumb.ToolMsg=function(c){switch(c.usermsg||c.target.title){case "\u5220\u9664\u8be5\u68c0\u67e5":c=c.reservedata;a.thumbManager.DeleteThumb(c);a.dataManager.DeleteStudy(c);a.annStatusManager.DelAnnStatusMngByStudyUid?a.annStatusManager.DelAnnStatusMngByStudyUid(c):a.annStatusManager.arrAnnStatus=[];a.onTool.ReLoadDicom(!0);break;case "\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5":$.each(a.dataManager.arrStudy,function(){var c=this.studyuid;a.thumbManager.DeleteThumb(c);a.annStatusManager.DelAnnStatusMngByStudyUid?a.annStatusManager.DelAnnStatusMngByStudyUid(c):a.annStatusManager.arrAnnStatus=[];a.onTool.ReLoadDicom(!0)}),a.dataManager.arrStudy=[],a.onTool.ReLoadDicom(!0)}a.Mpr&&a.onCanvas.Mpr.Clear();$.Msg("\u68c0\u67e5\u5220\u9664\u6210\u529f",CBoBo.MSG_SUCCESS)};this.onTool.Main={};this.onTool.Main.MsgTransform=function(c){var e=CBoBo.Plugin.GetBrowserInfo();switch(c.target.title){case "2D":e.isMobile||a.toolBar.Request2DToolBar();a.Mpr&&a.Mpr.Show(!1);a.VRT&&a.VRT.Show(!1);if(a.canvasAIMax){a.canvasAIMax.Show(!1);c=a.canvasManager.scroll?a.canvasManager.scroll.draggerPos:1;var e=a.canvasManager.GetLayout(),h=CBoBo.AnnStatusManager.Get(),b=a.GetSelArray(h,c,e.row,e.col),d;a.canvasManager.EachMng(function(c,e){e<b.length&&(d=b[e],c.AnnStatusMng(d),c.AnnStatusMng()!==d&&c.UpdateLayout(d.images.length),a.DrawAnnStatusForMng(d,c,!0))})}break;case "MPR":a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));a.canvasAIMax&&a.canvasAIMax.Show(!1);void 0===a.Mpr&&(a.Mpr=new CBoBo.View.MPR({parent:"#"+a.frame.GetId("canvasbox"),mode:a.mode,msgtransform:a.onCanvas.Mpr.MsgTransform}),a.Mpr.SetLayout(3));e.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_MPR,a.onTool.Mpr.MsgTransform);a.Mpr.Show(!0);var f=a.canvasManager.GetFocusMng();if(!f){$.Msg("\u8bf7\u9009\u62e9\u9700\u8981\u91cd\u5efa\u7684\u5e8f\u5217\uff01");break}a.onCanvas.Mpr.LoadingAnimation(!0);(function p(c){c=void 0===c?!0:c;var e=f.AnnStatusMng();if(e)if(10>e.images.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20\uff01"),a.onCanvas.Mpr.Clear();else{for(var h=!1,b=0;b<e.images.length;b++)if(!e.images[b].bLoadImage){h=!0;break}h?(c&&(a.downLoadCurrentSeriesHandle(e.images),$.Msg("\u8bf7\u7b49\u5f85\uff0c\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u6b63\u5728\u4e0b\u8f7d\u4e2d...",CBoBo.MSG_ALERT)),a.onCanvas.Mpr.Clear(),setTimeout(function(){p(!1)},2E3)):(a.onCanvas.Mpr.LoadingAnimation(),a.Mpr.Series(e.images),a.onCanvas.Mpr.InitCanvas())}})();break;case "AI":a.onEmit("aiClick");break;case "3D":a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1)),a.canvasAIMax&&a.canvasAIMax.Show(!1),a.Mpr&&(a.Mpr.Show(!1),a.Mpr=void 0),void 0===a.VRT&&(a.VRT=new CBoBo.View.VRT({parent:"#"+a.frame.GetId("canvasbox"),mode:a.mode,msgtransform:a.onCanvas.VRT.MsgTransform}),a.VRT.SetLayout()),e.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_VRT,a.onTool.VRT.MsgTransform),a.VRT.Show(!0),(f=a.canvasManager.GetFocusMng())?(a.onCanvas.VRT.LoadingAnimation(!0),function t(c){c=void 0===c?!0:c;var e=f.AnnStatusMng();if(e)if(10>e.images.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20\uff01"),a.onCanvas.VRT.Clear();else{for(var h=!1,b=0;b<e.images.length;b++)if(!e.images[b].bLoadImage){h=!0;break}h?(c&&(a.downLoadCurrentSeriesHandle(e.images),$.Msg("\u8bf7\u7b49\u5f85\uff0c\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u6b63\u5728\u4e0b\u8f7d\u4e2d...",CBoBo.MSG_ALERT)),a.onCanvas.VRT.Clear(),setTimeout(function(){t(!1)},2E3)):(a.onCanvas.VRT.LoadingAnimation(),a.VRT.Series(e.images),a.onCanvas.VRT.InitCanvas())}}()):$.Msg("\u8bf7\u9009\u62e9\u9700\u8981\u91cd\u5efa\u7684\u5e8f\u5217\uff01")}};this.MsgTransform=function(c){switch(c.type){case "resize":case "scroll":case "drag":a.DRS.MsgTransform(c);return}var e=c.mng;if(e&&(e=e.AnnStatusMng())){var h=e.viewport;if("jpg"===e.type){if(!h.GetImage().bLoaded)return;e=a.onCanvas.Jpg.MsgTransform}else{if(!h.image.bLoadImage)return;e=a.onCanvas.MsgTransform}e(c)}};this.downLoadLazySeriesHandle=function(c,e,h){e=void 0===e?1:e;if(c){h=a.dataManager.GetStudy(h);var b=h.GetWaitLoadSeries({seriesId:c,params:"threadPostData"});if(b.length){var d=[];if(1==e){var f=CBoBo.store.loadQueue.waitSeriesID;f.delete(c);for(var g=$jscomp.makeIterator(f),p=g.next();!p.done;p=g.next()){var p=$jscomp.makeIterator(p.value).next().value,t=h.GetWaitLoadSeries({seriesId:p,params:"threadPostData"});t.length?d.unshift.apply(d,[].concat($jscomp.arrayFromIterable(t))):f.delete(p)}f.set(c)}window.mergeThread.postMessage({type:e,arrpriority:[].concat($jscomp.arrayFromIterable(b),$jscomp.arrayFromIterable(d))})}}};this.scrollDownLoadLazySeriesHandle=function(c,e,h){e=void 0===e?1:e;c&&(c=a.dataManager.arrStudy[0].GetWaitLoadSeries({seriesId:c}).filter(function(a){a=a.imgnum;return a>=h&&a<=h+7}).map(function(a){return a.threadPostData}),c.length&&window.mergeThread.postMessage({type:e,arrpriority:[].concat($jscomp.arrayFromIterable(c))}))};this.downLoadCurrentSeriesHandle=function(a,e){e=void 0===e?1:e;a=a.filter(function(a){return!a.bLoadImage}).map(function(a){return a.threadPostData});window.mergeThread.postMessage({type:e,arrpriority:[].concat($jscomp.arrayFromIterable(a))})};this.toggleImageBDHandle=function(a){void 0===a&&(a=!CBoBo.store.db.enableImagesDB);a=!!a;window.mergeThread&&window.mergeThread.postMessage({store:{enableImagesDB:a}});CBoBo.store.db.enableImagesDB=a;if(!a){var c=CBoBo.store.db,h=new simple.IndexedDB(c.dbName,c.storeName,c.version);h.open().then(function(){h.dispatch("clear")})}return a};this.UpdateAICanvas=function(){var c=CBoBo.Plugin.GetBrowserInfo();a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));a.Mpr&&a.Mpr.Show(!1);c.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_AI);void 0===a.canvasAIMax&&(a.canvasAIMax=new CBoBo.View.AI({parent:"#"+a.frame.GetId("canvasbox"),refrence:"#"+a.frame.GetId("contain"),msgtransform:a.MsgTransform}));a.canvasAIMax.bShow=!0;a.canvasAIMax.Show(!0);c=CBoBo.AnnStatusManager.Get();if(a.canvasAIMax.bShow){var e=a.canvasManager.GetFocusMng(),h=e.AnnStatusMng(),b=CBoBo.AnnStatusManager.GetIndex(h);void 0===b&&(b=0);a.canvasAIMax.secondCtrl.UpdateLayout(c.length,1,1,b+1);b=e.GetEventImageIndex(event.self);e=a.canvasAIMax.secondCtrl.GetMng()[0];e.UpdateLayout(h.images.length,1,1,b+1);e.AnnStatusMng(h);var d=e.GetAllCanvas()[0];$.each(c,function(){CBoBo.ImageProcessor.FitCanvas(h.viewport,d.canvas,!1,!0)});a.DrawAnnStatusForMng(h,e);a.canvasAIMax.secondCtrl.SetDefaultFocus(0,0)}};this.onCanvas.Jpg={};this.onCanvas.Jpg.MsgTransform=function(c){var e=c.self,h=e.AnnStatus(),b=h.status;switch(c.type){case "touchstart":case "mousedown":a.onCanvas.stampStart=c.timeStamp;a.SaveStartStatus(c,b);"touchstart"==c.type?(h=c.originalEvent.targetTouches[0],a.onCanvas.ptStart=CBoBo.Plugin.TransCoord(e,h.pageX,h.pageY),a.onCanvas.bLMouse=!0):a.onCanvas.ptStart=CBoBo.Plugin.TransCoord(e,c.pageX,c.pageY);switch(c.which){case 1:a.onCanvas.bLMouse=!0;break;case 3:a.onCanvas.bRMouse=!0}a.ChangeToolBar(c);break;case "touchmove":case "mousemove":if(a.onCanvas.bLMouse)a.onCanvas.Jpg.MouseLMove(e,b,c);else if(a.onCanvas.bRMouse)h=CBoBo.Plugin.TransCoord(e,c.pageX,c.pageY),a.onCanvas.Jpg.BC(e,h);else{var d;"touchmove"==c.type?(h=c.originalEvent.targetTouches[0],h=CBoBo.Plugin.TransCoord(e,h.pageX,h.pageY),d=c.originalEvent.targetTouches.length):h=CBoBo.Plugin.TransCoord(e,c.pageX,c.pageY);d&&2==d&&a.onCanvas.Jpg.Move(e,h)}break;case "touchend":case "mouseup":case "mouseout":case "pinchend":a.onCanvas.bRMouse&&200>c.timeStamp-a.onCanvas.stampStart&&(e=a.GetContextMenu(CBoBo.PTYPE_JPG))&&(e.SetPosition(c.clientX,c.clientY),e.Show(!0));a.onCanvas.bLMouse=!1;a.onCanvas.bRMouse=!1;a.onCanvas.imgStatus=[];break;case "dblclick":case "tap":a.privilege.bMupStudy?a.onCanvas.DbClick(h):a.canvasManager.bMax?(c=a.onTool.stack.pop(),d=a.onTool.stack.pop(),e=a.onTool.stack.pop(),h=a.onTool.stack.pop(),void 0!=h&&void 0!=e&&a.onTool.Jpg.MsgTransform({target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:h,col:e,max:!0,maxdata:{scrollpos:d,focusindex:c}})):(a.onTool.stack.push(a.canvasManager.nLayoutRow),a.onTool.stack.push(a.canvasManager.nLayoutCol),d=1,void 0!=a.canvasManager.scroll&&(d=a.canvasManager.scroll.draggerPos),a.onTool.stack.push(d),h=a.canvasManager.GetFocusCanvas().AnnStatus(),c=a.canvasManager.GetCanvasIndex(),a.onTool.stack.push(c),a.onTool.Jpg.MsgTransform({target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:1,max:!0,maxdata:{annstatus:h,focusindex:c}}));break;case "mousewheel":a.onCanvas.NextPage(c.deltaY);break;case "pinchstart":a.onCanvas.bLMouse=!1;a.SaveStartStatus();break;case "pinch":a.onCanvas.Jpg.Zoom(e,c.scale);break;case "message":a.onCanvas.Jpg.DrawImage(c)}};this.onCanvas.Jpg.MouseLMove=function(c,e,h){"touchmove"==h.type?(e=h.originalEvent.targetTouches[0],e=CBoBo.Plugin.TransCoord(c,e.pageX,e.pageY)):e=CBoBo.Plugin.TransCoord(c,h.pageX,h.pageY);var b=e.y-a.onCanvas.ptStart.y;if(0!=e.x-a.onCanvas.ptStart.x||0!=b)switch(h.tooltype||a.toolBar.toolType){case CBoBo.TOOL_MOVE:a.onCanvas.Jpg.Move(c,e);break;case CBoBo.TOOL_ZOOM:a.onCanvas.Jpg.Zoom(c,e);break;case CBoBo.TOOL_WC:a.onCanvas.Jpg.BC(c,e)}};this.onCanvas.Jpg.BC=function(c,e){var h=e.x-a.onCanvas.ptStart.x;e=e.y-a.onCanvas.ptStart.y;if(0!=h||0!=e){var b=c.AnnStatus().status;if(void 0!=b||void 0!=b.imageInfo){var d=a.onCanvas.imgStatus[0],f=d.brightness,d=d.contrast,f=f+(h>>2),d=d+(e>>2);-100>f&&(f=-100);100<f&&(f=100);-100>d&&(d=-100);100<d&&(d=100);b.SetBriCon(f,d);b.DrawImg(c)}}};this.onCanvas.Jpg.Move=function(c,e){var h=e.x-a.onCanvas.ptStart.x;e=e.y-a.onCanvas.ptStart.y;if(0!=h||0!=e){var b=c.AnnStatus().status;if(void 0!=b||void 0!=b.image){var d=a.onCanvas.imgStatus[0],d={x:d.ptLast.x,y:d.ptLast.y};d.x+=h>>0;d.y+=e>>0;b.MoveImage(d);b.DrawImg(c)}}};this.onCanvas.Jpg.Zoom=function(c,e){var b=!1;"number"==typeof e&&(b=!0);if(!b){var d=e.y-a.onCanvas.ptStart.y;if(0==d)return}if(0!=d){var k=c.AnnStatus().status;if(void 0!=k||void 0!=k.image){var f=a.onCanvas.imgStatus[0].zoomRatio,g=k.GetImageSize(),f=b?f*e:f-3*d/g.width;.02>f&&(f=.02);10<f&&(f=10);k.ZoomImage(f*g.width,f*g.height);k.DrawImg(c)}}};this.onCanvas.Jpg.DrawImage=function(a){var c=a.self;c.drawlock=!0;var b=c.GetCanvas(),d=c.AnnStatus();if(null!=d&&void 0!=d&&(d=d.status,void 0!=a.data)){var k=document.createElement("canvas");k.width=a.data.width;k.height=a.data.height;console.log("3");k.getContext("2d").putImageData(a.data,0,0);a=b.getContext("2d");a.clearRect(0,0,b.width,b.height);var f=d.scaledWidth,g=d.scaledHeight,p=d.ptLast,t=d.GetImageSize();a.drawImage(k,0,0,t.width,t.height,(b.width-f)/2+p.x,(b.height-g)/2+p.y,f,g);d.DrawText(c)}};this.onTool.Jpg={};this.onTool.Jpg.MsgTransform=function(c){var e=c.usermsg||c.target.title;switch(e){case "\u91ca\u653e\u5de5\u5177":a.toolBar.toolType=CBoBo.TOOL_NULL;break;case "\u91cd\u65b0\u52a0\u8f7d":a.onTool.Jpg.ReLoad();break;case "\u56fe\u50cf\u5e03\u5c40":case "\u5e8f\u5217\u5e03\u5c40":console.log(0);void 0==a.layoutCtrl&&(a.layoutCtrl=new CBoBo.View.LayoutCtrl({msgtransform:a.onTool.Jpg.MsgTransform,radio:!1}));a.layoutCtrl.bShow?a.layoutCtrl.Show(!1):(a.layoutCtrl.SetPosition(c.clientX-8,.4*CBoBo.View.TOOLBAR_HEIGHT>>0),a.layoutCtrl.Show(!0),a.layoutCtrl.Type(e));break;case "\u6062\u590d":a.onTool.Jpg.Restore();break;case "\u653e\u7f29":a.toolBar.toolType=CBoBo.TOOL_ZOOM;break;case "\u79fb\u52a8":a.toolBar.toolType=CBoBo.TOOL_MOVE;break;case "\u8d1f\u50cf":a.onTool.Jpg.Negative();break;case "\u4f2a\u5f69":void 0==a.pseudocolorCtrl&&(a.pseudocolorCtrl=new CBoBo.View.PseudoColorCtrl({msgtransform:a.onTool.Jpg.MsgTransform}));a.pseudocolorCtrl.bShow?a.pseudocolorCtrl.Show(!1):(a.pseudocolorCtrl.SetPosition(c.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.pseudocolorCtrl.Show(!0));break;case "\u4eae\u5ea6/\u5bf9\u6bd4":case "\u4eae/\u5bf9\u6bd4":case "\u8c03\u7a97":a.toolBar.toolType=CBoBo.TOOL_WC;break;case "\u5220\u9664\u56fe\u50cf":a.onTool.Jpg.Delete();break;case "\u5e03\u5c40\u63a7\u4ef6":if(a.privilege.bMupStudy)a.onTool.CanvasLayout(c);else{var b,e=!1,d,k=c.maxdata;c.max&&(void 0!=k.annstatus?(d=k.focusindex+1,b=[],b.push(k.annstatus),e=!0):d=k.scrollpos);var f=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(f.length,c.row,c.col,d);var g=a.canvasManager.GetLayoutCanvas();$.each(f,function(a,c){c.status.FitCanvas(g[0])});void 0==d&&(d=1);e||(b=a.GetSelArray(f,d,c.row,c.col),void 0!=k&&a.canvasManager.Focus(k.focusindex));a.FlushAnnStatusForCanvas(b,g)}break;case "\u7070\u8272":case "\u5f69\u8679":case "\u9ed1\u4f53":case "\u9aa8\u9abc":case "\u5fc3\u810f":case "\u6d41\u52a8":case "Ge\u8272":case "\u7070\u8272\u5f69\u8679":case "\u70ed\u7eff":case "\u94ec\u94c1":case "\u70ed\u91d1\u5c5e":case "\u9971\u548c\u5ea61":case "\u9971\u548c\u5ea62":case "\u7ea2\u5916":case "\u58a8\u9ed1":case "\u9aa8\u9abc-\u808c\u8089":case "NIH":case "\u5f69\u86791":case "\u5f69\u86792":case "\u5f69\u86793":case "\u6bd4\u503c":case "\u7ea2\u8272\u8840\u7ba1":case "\u5149\u8c31":case "\u65af\u7279\u6069":case "UCLA":a.onTool.Pseudocolor(c.target.title);break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":a.onTool.MsgTransform({usermsg:"\u663e/\u9690\u56db\u89d2\u4fe1\u606f"});break;case "dragend":$.Msg("dragend");break;case "drag":$.Msg("drag");break;case "hold":$.Msg("hold");break;case "\u914d\u7f6e":a.onTool.MsgTransform(c);break;case "\u80f6\u7247\u6253\u5370":a.onTool.MsgTransform(c);break;case "\u534f\u540c\u8bca\u65ad":a.onTool.MsgTransform({usermsg:e})}CBoBo.Plugin.GetBrowserInfo().isMobile||!1!==a.toolBar.ChangeBtnStatus(c.btntitle,c.btnforce)||(a.toolBar.toolType=CBoBo.TOOL_NULL,a.toolBar.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))};this.onTool.Jpg.Restore=function(){var c=a.canvasManager.GetFocusCanvas(),e=c.AnnStatus().status;void 0!=e&&(e.Restore(),e.FitCanvas(c).DrawImg(c))};this.onTool.Jpg.Delete=function(){if(a.privilege.bMupStudy)a.onTool.DeleteDicom();else{var c=a.canvasManager.GetFocusCanvas();a.annStatusManager.DeleteAnnStatus(c.AnnStatus());c=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(c.length);var e=a.canvasManager.GetLayoutCanvas();a.FlushAnnStatusForCanvas(c,e,!0)}};this.onTool.Jpg.ReLoad=function(c){a.onTool.MsgTransform({usermsg:"\u91cd\u65b0\u52a0\u8f7d"})};this.onTool.Jpg.Negative=function(){var c=a.canvasManager.GetFocusCanvas(),e=c.AnnStatus().status;void 0!=e&&(e.SetNegative(!e.GetNegative()),e.DrawImg(c))};this.onCanvas.MsgTransform=function(c){var e=c.mng.AnnStatusMng(),b=c.mng.GetEventImageIndex(c.self);if(e&&!(b>e.images.length-1))switch(c.type){case "touchstart":case "mousedown":a.onCanvas.stampStart=c.timeStamp;"touchstart"==c.type?(a.onCanvas.lastScale=e.viewport.scale,e=c.originalEvent.targetTouches[0],a.onCanvas.ptStart=new Point(e.pageX,e.pageY),1===c.originalEvent.touches.length?a.onCanvas.which=1:a.onCanvas.bTouchMul=!0):(a.onTool.ScountLine(!0),a.onCanvas.which=c.which,a.onCanvas.ptStart=new Point(c.pageX,c.pageY));"ww"==a.toolBar.toolType&&(a.onCanvas.which=3);0===a.toolBar.toolType&&(a.onCanvas.which=4);a.onCanvas.ptLast=new Point(a.onCanvas.ptStart);a.onCanvas.MouseDown(c);a.ChangeToolBar(c);break;case "touchmove":case "mousemove":0!==a.onCanvas.which||"touchmove"==c.type&&2===c.originalEvent.touches.length?a.onCanvas.MouseDowmMove(c):a.onCanvas.MouseMove(c);break;case "touchend":case "mouseup":case "mouseout":case "pinchend":a.onCanvas.MouseUp(c);break;case "dblclick":case "doubletap":a.onCanvas.DbClick(c);break;case "mousewheel":a.onCanvas.NextPage(c.deltaY);break;case "pinchstart":a.onCanvas.which=0;break;case "pinch":a.onCanvas.ZOOM(c.scale);break;case "hold":$.Msg("hold")}};this.onCanvas.MouseDown=function(c){if(1===a.onCanvas.which){var e=c.mng.AnnStatusMng(),b=e.viewport,d=c.mng.GetEventImageIndex(c.self),d=e.images[d];void 0!==d&&(a.canvasAIMax&&a.canvasAIMax.bShow?(d=d.imageInstanceUid,e.anns[d]instanceof Array||(e.anns[d]=[]),e=e.anns[d]):(e.anns[d.id]instanceof Array||(e.anns[d.id]=[]),e=e.anns[d.id]),d=c.self.canvas,c=c.tooltype||a.toolBar.toolType,CBoBo.Annotation.ScanClickTextBox(b,d,e,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y),CBoBo.Annotation.ActiveAnnotation(e)||(b=CBoBo.Annotation.NewAnnotation(b,d,c,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y),void 0!==b&&e.push(b)))}};this.onCanvas.MouseDowmMove=function(c){var e;"touchmove"==c.type?(e=c.originalEvent.targetTouches[0],e=new Point(e.pageX,e.pageY)):e=new Point(c.pageX,c.pageY);var b=e.x-a.onCanvas.ptLast.x,d=e.y-a.onCanvas.ptLast.y;if(0!==b||0!==d){if(2==a.onCanvas.which||"touchmove"==c.type&&2===c.originalEvent.touches.length)a.onCanvas.MOVE(b,d);else if(3==a.onCanvas.which)a.onCanvas.WW(b,d);else if(4==a.onCanvas.which)5<Math.abs(d)&&(0<d?a.onCanvas.NextPage(-1):a.onCanvas.NextPage(1));else if(1==a.onCanvas.which){var k=c.mng.AnnStatusMng(),f=k.viewport,g=c.mng.GetEventImageIndex(c.self),g=k.images[g];if(void 0===g)return;f.image=g;a.canvasAIMax&&a.canvasAIMax.bShow?(g=g.imageInstanceUid,k.anns[g]instanceof Array||(k.anns[g]=[]),k=k.anns[g]):(k.anns[g.id]instanceof Array||(k.anns[g.id]=[]),k=k.anns[g.id]);g=c.tooltype||a.toolBar.toolType;c=c.self.canvas;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(!CBoBo.Annotation.MaybeServerModifyActiveAnn(f,c,k,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y,e.x,e.y))switch(g){case "sharpen":a.onCanvas.Sharpen(b,d);break;case "blur":a.onCanvas.Blur(b,d);break;case "zoom":a.onCanvas.ZOOM(b,d);break;case "ww":a.onCanvas.WW(b,d);break;case "move":a.onCanvas.MOVE(b,d)}}else if(!CBoBo.Annotation.MaybeModifyActiveAnn(f,c,k,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y,e.x,e.y))switch(g){case "sharpen":a.onCanvas.Sharpen(b,d);break;case "blur":a.onCanvas.Blur(b,d);break;case "zoom":a.onCanvas.ZOOM(b,d);break;case "ww":a.onCanvas.WW(b,d);break;case "move":a.onCanvas.MOVE(b,d);break;case "heartratio":case "r":case "l":case ".":case "angle":case "arrow":case "ellipse":case "probe":case "rect":case "line":CBoBo.Annotation.UnfinishedAnn(f,c,k,g,e.x,e.y)}}a.onCanvas.ptLast=e}};this.onCanvas.MouseUp=function(c){if(1===a.onCanvas.which||a.onCanvas.bTouchMul){var e=c.mng.AnnStatusMng(),b=e.viewport,d=c.mng.GetEventImageIndex(c.self),d=e.images[d];if(void 0===d)return;b.image=d;var k;a.canvasAIMax&&a.canvasAIMax.bShow?(d=d.imageInstanceUid,e.anns[d]instanceof Array||(e.anns[d]=[]),k=e.anns[d]):(e.anns[d.id]instanceof Array||(e.anns[d.id]=[]),k=e.anns[d.id]);var e=c.tooltype||a.toolBar.toolType,f=c.self.canvas,d=CBoBo.Annotation.GetMaybeSaveAnn(e,b,f);void 0!==d?(k.push(d),CBoBo.Draw.GetIsFromServer()&&CBoBo.Annotation.ServerGetMaybeSaveAnn(e,b,f,d).then(function(a){CBoBo.ImageProcessor.DrawGrayImage(b,f);CBoBo.Annotation.DrawAnnotation(b,f,k);CBoBo.Annotation.MaybeEndModifyAnn()})):CBoBo.Draw.GetIsFromServer()&&(c=new Point(c.pageX,c.pageY),console.log(c),c=CBoBo.Annotation.ServerHoverAnnotation(b,f,k,c.x,c.y),CBoBo.Annotation.ServerGetMaybeSaveAnn(e,b,f,c).then(function(a){CBoBo.ImageProcessor.DrawGrayImage(b,f);CBoBo.Annotation.DrawAnnotation(b,f,k);CBoBo.Annotation.MaybeEndModifyAnn()}));CBoBo.Annotation.MaybeEndModifyAnn()}else 3===a.onCanvas.which&&"mouseup"===c.type&&(e=CBoBo.Annotation.Distance(new Point(c.pageX,c.pageY),a.onCanvas.ptStart),200>c.timeStamp-a.onCanvas.stampStart&&1>e&&(e=a.GetContextMenu("series")))&&(e.SetPosition(c.clientX,c.clientY),e.Show(!0));a.onCanvas.bTouchMul=!1;a.onCanvas.which=0};this.onCanvas.MouseMove=function(c){var e=c.mng.AnnStatusMng(),b;if("touchmove"==c.type){if(1!==c.originalEvent.touches.length){a.onCanvas.bTouchMul=!0;return}b=c.originalEvent.targetTouches[0];b=new Point(b.pageX,b.pageY)}else b=new Point(c.pageX,c.pageY);var d=b.y-a.onCanvas.ptLast.y;if(0!==b.x-a.onCanvas.ptLast.x||0!==d){var d=e.viewport,k=c.mng.GetEventImageIndex(c.self),k=e.images[k];if(void 0!==k){d.image=k;a.canvasAIMax&&a.canvasAIMax.bShow?(k=k.imageInstanceUid,e.anns[k]instanceof Array||(e.anns[k]=[]),e=e.anns[k]):(e.anns[k.id]instanceof Array||(e.anns[k.id]=[]),e=e.anns[k.id]);var k=c.self.canvas,f=c.tooltype||a.toolBar.toolType;if(0===a.onCanvas.which&&!CBoBo.Annotation.UnfinishedAnn(d,k,e,f,b.x,b.y)&&(CBoBo.Annotation.ScanHoverAnnotation(d,k,e,b.x,b.y),"touchmove"==c.type&&"pointer"==k.style.cursor)){switch(a.toolBar.toolType){case "line":a.toolBar.ChangeBtnStatus("\u76f4\u7ebf");break;case "rect":a.toolBar.ChangeBtnStatus("\u77e9\u5f62");break;case "ellipse":a.toolBar.ChangeBtnStatus("\u692d\u5706");break;case "angle":a.toolBar.ChangeBtnStatus("\u89d2\u5ea6")}a.toolBar.toolType="."}a.onCanvas.ptLast=b;a.onTool.ScountLine(!0)}}};this.onCanvas.WW=function(c,e){var b,d,k;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(b=a.canvasAIMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng())k=d.viewport,k.ww+=parseInt(c*k.wwScale),k.wc+=parseInt(e*k.wwScale),2>k.ww&&(k.ww=2),a.DrawAnnStatusForMng(d,b)}else if(a.canvasMax&&a.canvasMax.bShow){if(b=a.canvasMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng())k=d.viewport,k.ww+=parseInt(c*k.wwScale),k.wc+=parseInt(e*k.wwScale),2>k.ww&&(k.ww=2),a.DrawAnnStatusForMng(d,b)}else b=a.canvasManager.GetActiveMng(),$.each(b,function(b,h){if(b=h.AnnStatusMng()){var d=b.viewport;d.ww+=parseInt(c*d.wwScale);d.wc+=parseInt(e*d.wwScale);2>d.ww&&(d.ww=2);a.DrawAnnStatusForMng(b,h)}})};this.onCanvas.MOVE=function(c,e){var b,d,k;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(b=a.canvasAIMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng())k=d.viewport,k.translation.x+=parseInt(c/k.scale),k.translation.y+=parseInt(e/k.scale),a.DrawAnnStatusForMng(d,b)}else if(a.canvasMax&&a.canvasMax.bShow){if(b=a.canvasMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng())k=d.viewport,k.translation.x+=parseInt(c/k.scale),k.translation.y+=parseInt(e/k.scale),a.DrawAnnStatusForMng(d,b)}else b=a.canvasManager.GetActiveMng(),$.each(b,function(b,h){if(b=h.AnnStatusMng()){var d=b.viewport;d.translation.x+=c/d.scale;d.translation.y+=e/d.scale;a.DrawAnnStatusForMng(b,h)}})};this.onCanvas.ZOOM=function(c,e){var b,d,k;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(b=a.canvasAIMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng())k=d.viewport,k.scale=void 0===e?a.onCanvas.lastScale*c:k.scale+e/100,.01>k.scale&&(k.scale=.01),k.scale=parseFloat(k.scale.toFixed(2)),a.DrawAnnStatusForMng(d,b)}else if(a.canvasMax&&a.canvasMax.bShow){if(b=a.canvasMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng())k=d.viewport,k.scale=void 0===e?a.onCanvas.lastScale*c:k.scale+e/100,.01>k.scale&&(k.scale=.01),k.scale=parseFloat(k.scale.toFixed(2)),a.DrawAnnStatusForMng(d,b)}else b=a.canvasManager.GetActiveMng(),$.each(b,function(b,h){if(b=h.AnnStatusMng()){var d=b.viewport;d.scale=void 0===e?a.onCanvas.lastScale*c:d.scale+e/100;.01>d.scale&&(d.scale=.01);d.scale=parseFloat(d.scale.toFixed(2));a.DrawAnnStatusForMng(b,h)}})};this.onCanvas.Sharpen=function(c,e){var b=function(c){var b=c.AnnStatusMng();if(b){var h=b.viewport,d=h.sharpen,d=d+e/5E3;0>d&&(d=0);h.sharpen=parseFloat(d.toFixed(4));a.DrawAnnStatusForMng(b,c)}};a.canvasAIMax&&a.canvasAIMax.bShow?(c=a.canvasAIMax.secondCtrl.GetMng()[0],b(c)):a.canvasMax&&a.canvasMax.bShow?(c=a.canvasMax.secondCtrl.GetMng()[0],b(c)):(c=a.canvasManager.GetActiveMng(),$.each(c,function(a,c){b(c)}))};this.onCanvas.Blur=function(c,e){var b=function(c){var b=c.AnnStatusMng();if(b){var h=b.viewport,d=h.blur,d=d+e/2E3;0>d&&(d=0);h.blur=parseFloat(d.toFixed(4));a.DrawAnnStatusForMng(b,c)}};a.canvasAIMax&&a.canvasAIMax.bShow?(c=a.canvasAIMax.secondCtrl.GetMng()[0],b(c)):a.canvasMax&&a.canvasMax.bShow?(c=a.canvasMax.secondCtrl.GetMng()[0],b(c)):(c=a.canvasManager.GetActiveMng(),$.each(c,function(a,c){b(c)}))};this.onCanvas.NextPage=function(c){var e;a.canvasMax&&a.canvasMax.bShow?(e=a.canvasMax.secondCtrl.GetMng()[0],e.scroll&&e.scroll.TriggerClick(c)):a.canvasAIMax&&a.canvasAIMax.bShow?(e=a.canvasAIMax.secondCtrl.GetMng()[0],e.scroll&&e.scroll.TriggerClick(c)):(e=a.canvasManager.GetActiveMng(),$.each(e,function(a,e){e.scroll&&e.scroll.TriggerClick(c)}))};this.onCanvas.DbClick=function(c){if(!a.canvasAIMax||!a.canvasAIMax.bShow){var e=a.canvasManager.GetLayout();if(1===e.row&&1===e.col){var b=a.canvasManager.GetFocusMng(),e=b.GetLayout();if(1===e.row&&1===e.col)return}a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));void 0===a.canvasMax&&(a.canvasMax=new CBoBo.View.CanvasMax({parent:"#"+a.frame.GetId("canvasbox"),msgtransform:a.MsgTransform}));a.canvasMax.bShow=!a.canvasMax.bShow;b=a.canvasMax.bShow;a.canvasMax.Show(b);e=CBoBo.AnnStatusManager.Get();if(b){var b=c.mng,d=b.AnnStatusMng(),k=CBoBo.AnnStatusManager.GetIndex(d);void 0===k&&(k=0);a.canvasMax.secondCtrl.UpdateLayout(e.length,1,1,k+1);k=b.GetEventImageIndex(c.self);b=a.canvasMax.secondCtrl.GetMng()[0];b.UpdateLayout(d.images.length,1,1,k+1);b.AnnStatusMng(d);var f=b.GetAllCanvas()[0];$.each(e,function(){CBoBo.Draw.FitServerCanvas(this.viewport,f.canvas,!1,!0)});a.DrawAnnStatusForMng(d,b);a.canvasMax.secondCtrl.SetDefaultFocus(0,0)}else{c=a.canvasManager.scroll?a.canvasManager.scroll.draggerPos:1;var b=a.canvasManager.GetLayout(),g=a.GetSelArray(e,c,b.row,b.col);a.canvasManager.EachMng(function(c,e){e<g.length&&(d=g[e],c.AnnStatusMng(d),c.AnnStatusMng()!==d&&c.UpdateLayout(d.images.length),a.DrawAnnStatusForMng(d,c,!0))})}}};this.onTool.MsgTransform=function(c){var e=c.usermsg||c.target.title;switch(e){case "\u91ca\u653e\u5de5\u5177":a.toolBar.toolType=CBoBo.TOOL_NULL;break;case "\u91cd\u65b0\u52a0\u8f7d":void 0!==a.lableCtrl&&a.lableCtrl.Show(!1);a.onTool.ReLoadDicom(!0);break;case "\u5e8f\u5217\u5e03\u5c40":case "\u56fe\u50cf\u5e03\u5c40":void 0==a.layoutCtrl&&(a.layoutCtrl=new CBoBo.View.LayoutCtrl({msgtransform:a.onTool.MsgTransform,radio:!1}));a.layoutCtrl.bShow?a.layoutCtrl.Show(!1):(a.layoutCtrl.SetPosition(c.clientX-8,.4*CBoBo.View.TOOLBAR_HEIGHT>>0),a.layoutCtrl.Show(!0),a.layoutCtrl.Type(e));break;case "\u6062\u590d":a.onTool.RestoreDicom();break;case "\u5b9a\u4f4d\u7ebf":a.onTool.bShowScountLine?($.Msg("\u5b9a\u4f4d\u7ebf\u5df2\u5173\u95ed\u3002",CBoBo.MSG_SUCCESS),a.onTool.bShowScountLine=!1,e=a.canvasManager.GetMng(),$.each(e,function(c,e){(c=e.AnnStatusMng())&&a.DrawAnnStatusForMng(c,e)})):($.Msg("\u5b9a\u4f4d\u7ebf\u5df2\u5f00\u542f\u3002",CBoBo.MSG_SUCCESS),a.onTool.bShowScountLine=!0,a.onTool.ScountLine());break;case "\u5e8f\u5217\u64ad\u653e":void 0==a.seriesPlayer&&(a.seriesPlayer=new CBoBo.View.SeriesPlayer({msgtransform:a.onTool.MsgTransform}));if(a.seriesPlayer.bShow)a.seriesPlayer.Show(!1);else{var b;b=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetFocusMng():a.canvasManager.GetFocusMng();e=b.GetBoundary();a.seriesPlayer.SetPosition(e.left+(e.width-300>>1),e.top+e.height-45);var d=1;if(e=b.AnnStatusMng())e=e.images,d=e.length,1==d&&(d=e[0].frames);a.seriesPlayer.SaveSeriesTag(b);a.seriesPlayer.SetRange(d);a.seriesPlayer.Show(!0);a.seriesPlayer.TriggerClick(2)}break;case "\u653e\u7f29":a.toolBar.toolType="zoom";break;case "\u79fb\u52a8":a.toolBar.toolType="move";break;case "\u65cb\u8f6c":void 0==a.rotateCtrl&&(a.rotateCtrl=new CBoBo.View.RotateCtrl({msgtransform:a.onTool.MsgTransform}));a.rotateCtrl.bShow?a.rotateCtrl.Show(!1):(a.rotateCtrl.SetPosition(c.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.rotateCtrl.Show(!0));break;case "\u8d1f\u50cf":a.onTool.Negative();break;case "\u4f2a\u5f69":void 0==a.pseudocolorCtrl&&(a.pseudocolorCtrl=new CBoBo.View.PseudoColorCtrl({msgtransform:a.onTool.MsgTransform}));a.pseudocolorCtrl.bShow?a.pseudocolorCtrl.Show(!1):(a.pseudocolorCtrl.SetPosition(c.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.pseudocolorCtrl.Show(!0));break;case "\u8c03\u7a97":a.toolBar.toolType="ww";break;case "\u81ea\u5b9a\u4e49\u8c03\u7a97 ":void 0==a.wwCtrl&&(a.wwCtrl=new CBoBo.View.wwCtrl({msgtransform:a.onTool.MsgTransform,modalityType:a.dataManager.GetStudy(0).modality}));a.wwCtrl.bShow?a.wwCtrl.Show(!1):(a.wwCtrl.SetPosition(c.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.wwCtrl.Show(!0));break;case "\u9510\u5316":a.toolBar.toolType="sharpen";break;case "\u5e73\u6ed1":a.toolBar.toolType="blur";break;case "\u76f4\u7ebf":a.toolBar.toolType="line";break;case "\u77e9\u5f62":a.toolBar.toolType="rect";break;case "\u692d\u5706":a.toolBar.toolType="ellipse";break;case "\u89d2\u5ea6":a.toolBar.toolType="angle";break;case "CT":a.toolBar.toolType="probe";break;case "\u6587\u672c":a.toolBar.toolType="text";break;case "\u7bad\u5934":a.toolBar.toolType="arrow";break;case "\u5de6\u6807\u8bb0":a.toolBar.toolType="l";break;case "\u53f3\u6807\u8bb0":a.toolBar.toolType="r";break;case "\u64a4\u9500":b=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetMng()[0]:a.canvasManager.GetFocusMng();if(e=b.AnnStatusMng()){var d=e.viewport,k=b.GetFocusCanvas();if(void 0!==k){b=b.GetEventImageIndex(k);var f=e.images[b];if(void 0===f)return;d.image=f;e.anns[f.id]instanceof Array&&(0<e.anns[f.id].length&&e.anns[f.id].pop(),b=k.canvas,CBoBo.Draw.DrawImage(d,b),CBoBo.Annotation.DrawAnnotation(d,b,e.anns[f.id]))}}break;case "\u5220\u9664\u56fe\u50cf":a.onTool.DeleteDicom();break;case "\u5e03\u5c40\u63a7\u4ef6":a.onTool.CanvasLayout(c);break;case "\u9006\u65f6\u9488":case "\u987a\u65f6\u9488":case "\u5de6\u53f3\u955c\u50cf":case "\u4e0a\u4e0b\u955c\u50cf":a.onTool.RotateDicom(c.target.title);break;case "\u7070\u8272":case "\u5f69\u8679":case "\u9ed1\u4f53":case "\u9aa8\u9abc":case "\u5fc3\u810f":case "\u6d41\u52a8":case "Ge\u8272":case "\u7070\u8272\u5f69\u8679":case "\u70ed\u7eff":case "\u94ec\u94c1":case "\u70ed\u91d1\u5c5e":case "\u9971\u548c\u5ea61":case "\u9971\u548c\u5ea62":case "\u7ea2\u5916":case "\u58a8\u9ed1":case "\u9aa8\u9abc-\u808c\u8089":case "NIH":case "\u5f69\u86791":case "\u5f69\u86792":case "\u5f69\u86793":case "\u6bd4\u503c":case "\u7ea2\u8272\u8840\u7ba1":case "\u5149\u8c31":case "\u65af\u7279\u6069":case "UCLA":a.onTool.Pseudocolor(c.target.title);break;case "seriesplay":b=a.seriesPlayer.GetSeriesTag();if("userdocument"==c.userdocument){if(!a.seriesPlayer.bShow)return;e=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetFocusMng():a.canvasManager.GetFocusMng();b!=e&&(a.seriesPlayer.Show(!1),c.btntitle="\u5e8f\u5217\u64ad\u653e",c.btnforce=!1)}else void 0!=c.target?b.scroll&&a.seriesPlayer.SetRange(b.scroll.rangeMap,b.scroll.draggerPos):b.scroll?b.scroll.TriggerDragger(c.value):(e=b.AnnStatusMng(),d=e.viewport,b=b.GetCanvas(),d.scale=d.scale1,d.image=e.images[0],d.frames=c.value,CBoBo.ImageProcessor.FitCanvas(d,b[0].canvas,!0));break;case "\u80f6\u7247\u6253\u5370":if(!a.privilege.bPrint)break;void 0==a.printer&&(a.printer=new CBoBo.View.DVPrint({msgtransform:a.PrintView.MsgTransform,mode:a.mode}));a.printer.bShow?a.printer.Show():a.printer.Show(!0);break;case "\u5fc3\u80f8\u6bd4":a.toolBar.toolType="heartratio";break;case "DICOM\u4fe1\u606f":if(a.dicomScan&&a.dicomScan.bShow)a.dicomScan.Show(!1),delete a.dicomScan;else{a.dicomScan=new CBoBo.View.DicomScan({msgtransform:a.onTool.MsgTransform});a.canvasMax&&a.canvasMax.bShow?(k=a.canvasMax.secondCtrl.GetMng()[0],b=k.GetFocusCanvas()):(k=a.canvasManager.GetFocusMng(),b=a.canvasManager.GetFocusCanvas());if(e=k.AnnStatusMng())b=k.GetEventImageIndex(b),d=e.images[b];a.dicomScan.SetDicomInfo(d);console.log(d);a.dicomScan.Show(!0);e={title:"DICOM\u4fe1\u606f",bseled:!0};c.btnstatus=e}break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":a.toolBar.bShowCornerInfo=!a.toolBar.bShowCornerInfo;e={title:"\u663e/\u9690\u56db\u89d2\u4fe1\u606f"};e.bseled=a.toolBar.bShowCornerInfo;c.btnstatus=e;e=a.canvasManager.GetMng();$.each(e,function(c,e){(c=e.AnnStatusMng())&&a.DrawAnnStatusForMng(c,e)});break;case "\u6253\u5370\u56fe\u50cf":a.KeyboardMsg({keyCode:80});break;case "\u6253\u5370\u5e8f\u5217":a.KeyboardMsg({keyCode:80,ctrlKey:!0});break;case "MPR":a.onTool.Main.MsgTransform({target:{title:"MPR"}});break;case "2D":a.onTool.Main.MsgTransform({target:{title:"2D"}});break;case "\u914d\u7f6e":void 0===a.configView&&(a.configView=new CBoBo.View.Config);e=a.toolBar.GetButtonDOM("\u914d\u7f6e");a.configView.bShow?(a.configView.Show(!1),$(e).css("pointer-events","")):(a.configView.Show(!0),$(e).css("pointer-events","auto"));break;case "\u534f\u540c\u8bca\u65ad":void 0==a.assistDiagnose&&(a.assistDiagnose=new CBoBo.View.AssistDiagnose({server:"localhost:80",msgtransform:a.Assist.MsgTransform}),a.assistDiagnose.Login());a.assistDiagnose.Show(!a.assistDiagnose.bShow);break;case "\u672c\u5730\u7f13\u5b58":a.toggleImageBDHandle();break;case "\u6309\u952e\u8bf4\u660e":a.iconInfo&&a.iconInfo.bShow?(a.iconInfo.Show(!1),delete a.iconInfo):(a.iconInfo=new CBoBo.View.IconInfo({msgtransform:a.onTool.MsgTransform}),a.iconInfo.SetInfo(),a.iconInfo.Show(!0));break;case "CPR\u76f4\u7ebf":case "CPR\u66f2\u7ebf":case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":a.onTool.Mpr.MsgTransform(c);break;case "Abodmen":case "Lung":case "Brain":case "Bone":case "Chest":case "Head/Neck":a.onTool.WW(e);break;case "CustomWWWC":a.onTool.BindAlert()}CBoBo.Plugin.GetBrowserInfo().isMobile||!1!==a.toolBar.ChangeBtnStatus(c.btntitle,c.btnforce)||(a.toolBar.toolType=CBoBo.TOOL_NULL,a.toolBar.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))};this.onTool.BindAlert=function(){var c,e,b=a.canvasManager.GetActiveMng();$.each(b,function(a,b){if(a=b.AnnStatusMng())a=a.viewport,c=a.ww,e=a.wc});a.isKeyBoard=!0;var d=layer.open({title:"\u8bf7\u8f93\u5165\u7a97\u5bbd\u7a97\u4f4d",type:1,skin:"layui-layer-rim",area:["420px","210px"],content:'\x3cdiv class\x3d"layer-wrap"\x3e\x3cdiv class\x3d"layer-content"\x3e\x3cdiv class\x3d"layer-iptdiv"\x3e\x3clabel\x3e\u7a97\u5bbd:\x3c/label\x3e\x3cinput type\x3d"text" id\x3d"customWW"    class\x3d"layer-ipt" value\x3d"'+c+'"\x3e\x3c/div\x3e\x3cdiv class\x3d"layer-iptdiv"\x3e\x3clabel\x3e\u7a97\u4f4d:\x3c/label\x3e\x3cinput type\x3d"text" id\x3d"customWC"  class\x3d"layer-ipt" value\x3d"'+e+'"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"footer"\x3e\x3cspan id\x3d"btn-ok-custom" class\x3d"darkgreen"\x3e\u786e\u5b9a\x3c/span\x3e\x3cspan id\x3d"btn-cancel-custom"\x3e\u53d6\u6d88\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',cancel:function(){a.isKeyBoard=!1}});$("#btn-ok-custom").click(function(){var c=$("#customWW").val(),e=$("#customWC").val();isNaN(e)||isNaN(c)?alert("\u8bf7\u8f93\u5165\u6b63\u786e\u6570\u5b57"):(a.onTool.CustomWW(parseInt(c),parseInt(e)),layer.close(d),a.isKeyBoard=!1)});$("#btn-cancel-custom").click(function(){layer.close(d);a.isKeyBoard=!1})};this.onTool.CustomWW=function(c,e){if(a.canvasMax&&a.canvasMax.bShow){var b=a.canvasMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng();if(d){var k=d.viewport;k.ww=parseInt(c);k.wc=parseInt(e);2>k.ww&&(k.ww=2);a.DrawAnnStatusForMng(d,b)}}else b=a.canvasManager.GetActiveMng(),$.each(b,function(b,d){if(b=d.AnnStatusMng()){var h=b.viewport;h.ww=c;h.wc=e;2>h.ww&&(h.ww=2);a.DrawAnnStatusForMng(b,d)}})};this.onTool.WW=function(c){if(a.canvasAIMax&&a.canvasAIMax.bShow){var e=a.canvasMax.secondCtrl.GetMng()[0],b=e.AnnStatusMng();if(b){var d=b.viewport;switch(c){case "Abodmen":d.ww=400;d.wc=60;break;case "Lung":d.ww=1500;d.wc=-600;break;case "Brain":d.ww=80;d.wc=40;break;case "Bone":d.ww=1500;d.wc=300;break;case "Chest":d.ww=400;d.wc=40;break;case "Head/Neck":d.ww=350,d.wc=90}2>d.ww&&(d.ww=2);a.DrawAnnStatusForMng(b,e)}}else if(a.canvasMax&&a.canvasMax.bShow){if(e=a.canvasMax.secondCtrl.GetMng()[0],b=e.AnnStatusMng()){d=b.viewport;switch(c){case "Abodmen":d.ww=400;d.wc=60;break;case "Lung":d.ww=1500;d.wc=-600;break;case "Brain":d.ww=80;d.wc=40;break;case "Bone":d.ww=1500;d.wc=300;break;case "Chest":d.ww=400;d.wc=40;break;case "Head/Neck":d.ww=350,d.wc=90}2>d.ww&&(d.ww=2);a.DrawAnnStatusForMng(b,e)}}else e=a.canvasManager.GetActiveMng(),$.each(e,function(e,b){if(e=b.AnnStatusMng()){var d=e.viewport;switch(c){case "Abodmen":d.ww=400;d.wc=60;break;case "Lung":d.ww=1500;d.wc=-600;break;case "Brain":d.ww=80;d.wc=40;break;case "Bone":d.ww=1500;d.wc=300;break;case "Chest":d.ww=400;d.wc=40;break;case "Head/Neck":d.ww=350,d.wc=90}2>d.ww&&(d.ww=2);a.DrawAnnStatusForMng(e,b)}})};this.onTool.Negative=function(){if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();e&&(e.viewport.invert=!e.viewport.invert,a.DrawAnnStatusForMng(e,c))}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,e){if(c=e.AnnStatusMng())c.viewport.invert=!c.viewport.invert,a.DrawAnnStatusForMng(c,e)})};this.onTool.RotateDicom=function(c){if(a.canvasMax&&a.canvasMax.bShow){var e=a.canvasMax.secondCtrl.GetMng()[0],b=e.AnnStatusMng();if(b){switch(c){case "\u9006\u65f6\u9488":b.viewport.rotation+=-90;break;case "\u987a\u65f6\u9488":b.viewport.rotation+=90;break;case "\u5de6\u53f3\u955c\u50cf":b.viewport.hflip=!b.viewport.hflip;break;case "\u4e0a\u4e0b\u955c\u50cf":b.viewport.vflip=!b.viewport.vflip}if(-360===b.viewport.rotation||360===b.viewport.rotation)b.viewport.rotation=0;a.DrawAnnStatusForMng(b,e)}}else e=a.canvasManager.GetActiveMng(),$.each(e,function(e,b){if(e=b.AnnStatusMng()){switch(c){case "\u9006\u65f6\u9488":e.viewport.rotation+=-90;break;case "\u987a\u65f6\u9488":e.viewport.rotation+=90;break;case "\u5de6\u53f3\u955c\u50cf":e.viewport.hflip=!e.viewport.hflip;break;case "\u4e0a\u4e0b\u955c\u50cf":e.viewport.vflip=!e.viewport.vflip}if(-360===e.viewport.rotation||360===e.viewport.rotation)e.viewport.rotation=0;a.DrawAnnStatusForMng(e,b)}})};this.onTool.ReLoadDicom=function(c){a.canvasMax&&a.canvasMax.bShow&&a.canvasMax.Show(!1);c&&a.InitAnnStatusStack();c=a.dataManager.GetStudy(0);var e=c.GetStudyType(),b=c.IsPageSwitch();"series"===e&&b&&c.RequestSeriesDicom();c=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(c.length);e=a.canvasManager.GetMng();for(b=0;b<e.length;b++){var d=e[b],k=d.GetLayoutCanvas();0===k.length&&d.UpdateLayout(0,1,1);if(b<c.length){var f=c[b];d.AnnStatusMng(f);d.UpdateLayout(f.images.length);"series"===f.type&&d.checkbox.Show(!0);window.devicePixelRatio=1;a.DrawAnnStatus(f,k,!0)}else d.checkbox.Show(!1),$.each(k,function(a,c){c.Clear();c.DrawCornerInfo()}),d.Clear()}};this.onTool.DeleteDicom=function(){if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();if(e){var e=CBoBo.AnnStatusManager.Delete(e),b=CBoBo.AnnStatusManager.Get(),e=Math.min(e,b.length-1);a.canvasMax.secondCtrl.UpdateLayout(b.length,1,1,(0>e?0:e)+1);if(e<b.length&&-1<e){if(e=b[e])c.UpdateLayout(e.images.length),c.AnnStatusMng(e),a.DrawAnnStatusForMng(e,c)}else c.UpdateLayout(0),c.AnnStatusMng(null),c=c.GetAllCanvas()[0],e=c.canvas,e.width=e.width,c.DrawCornerInfo()}}else c=a.canvasManager.GetActiveMng(),$.each(c,function(a,c){a=c.AnnStatusMng();CBoBo.AnnStatusManager.Delete(a)}),a.onTool.ReLoadDicom()};this.onTool.RestoreDicom=function(){if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();e&&(CBoBo.ImageProcessor.Restore(e.viewport),e.anns={},a.DrawAnnStatusForMng(e,c,!0))}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,e){if(c=e.AnnStatusMng())CBoBo.ImageProcessor.Restore(c.viewport),c.anns={},a.DrawAnnStatusForMng(c,e,!0)})};this.onTool.Pseudocolor=function(c){if(a.canvasMax&&a.canvasMax.bShow){var e=a.canvasMax.secondCtrl.GetMng()[0],b=e.AnnStatusMng();b&&(b.viewport.pseudo=c,a.DrawAnnStatusForMng(b,e))}else e=a.canvasManager.GetActiveMng(),$.each(e,function(e,b){if(e=b.AnnStatusMng())e.viewport.pseudo=c,a.DrawAnnStatusForMng(e,b)})};this.onTool.CanvasLayout=function(c){switch(c.ctrltype){case "\u56fe\u50cf\u5e03\u5c40":if(a.canvasMax&&a.canvasMax.bShow){var e=a.canvasMax.secondCtrl.GetMng()[0],b=e.AnnStatusMng();b&&(e.UpdateLayout(b.images.length,c.row,c.col),c=e.GetAllCanvas(),a.DrawAnnStatus(b,c,!0),b=e.GetFocusCanvas(),void 0===b&&e.Focus(c.length-1))}else if(e=a.canvasManager.GetFocusMng(),void 0!==e&&(b=e.AnnStatusMng()))e.UpdateLayout(b.images.length,c.row,c.col),c=e.GetAllCanvas(),a.DrawAnnStatus(b,c,!0),b=e.GetFocusCanvas(),void 0===b&&e.Focus(c.length-1);break;case "\u5e8f\u5217\u5e03\u5c40":a.canvasMax&&a.canvasMax.bShow&&a.canvasMax.Show(!1);localStorage.setItem("seriesLayoutCount",JSON.stringify({row:c.row,col:c.col}));var d=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(d.length,c.row,c.col);e=a.canvasManager.GetMng();$.each(e,function(c,e){if(c<d.length){if(c=d[c])e.UpdateLayout(c.images.length),e.AnnStatusMng(c),"series"===c.type?(e.checkbox.Show(!0),e.checkbox.On_Off(c.compare)):e.checkbox.Show(!1),e=e.GetLayoutCanvas(),a.DrawAnnStatus(c,e,!0)}else e.UpdateLayout(0),e.checkbox.Show(!1)});e=a.canvasManager.focusIndex;b=a.canvasManager.GetLayout();if(void 0===b||1>b.row||1>b.col)b={row:1,col:1};b=b.row*b.col-1;e>b&&a.canvasManager.SetDefaultFocus(b,0)}};this.onTool.ScountLine=function(c){function e(a,c,e,b,d,h,k,f){var l;b.x<d.x?(l=b,b=d):l=d;l=CBoBo.ImageProcessor.PixelToCanvas(e,c,l);c=CBoBo.ImageProcessor.PixelToCanvas(e,c,b);a.save();a.strokeStyle="#fff";a.fillStyle="#FFF";a.shadowColor="#000";a.shadowOffsetX="1";a.shadowOffsetY="1";a.lineWidth="1";a.beginPath();0==k&&a.setLineDash([2,3]);a.moveTo(l.x,l.y);a.lineTo(c.x,c.y);a.stroke();f&&(new Point(0,0),5>l.y-3?a.fillText(h,l.x-3,l.y):a.fillText(h,l.x,l.y-3));a.restore()}if(a.onTool.bShowScountLine){var b=a.canvasManager.GetFocusMng(),d=b.AnnStatusMng();if(d){if(c){var k=a.canvasManager.GetMng();$.each(k,function(c,e){(c=e.AnnStatusMng())&&a.DrawAnnStatusForMng(c,e)})}var k=a.canvasManager.GetLayoutCanvas(),f,g=[],p;for(c=0;c<k.length;c++){var t=k[c];0===c?p=b.GetEventImageIndex(t):p++;if(p<d.images.length){var r=d.images[p];void 0===f&&(f=r.seruid);g.push(r.uid)}}var v=!0;1<g.length&&(v=!1);k=a.canvasManager.GetMng();for(c=0;c<k.length;c++){var b=k[c],w=b.AnnStatusMng();if(w!==d&&w)for(var q=b.GetAllCanvas(),u=p=0;u<q.length;u++)if(t=q[u],0===u?p=b.GetEventImageIndex(t):p++,p<w.images.length&&(r=w.images[p],r=r.scount[f],void 0!==r&&0<r.length)){var x=t.canvas,A=x.getContext("2d");2<r.length&&(e(A,x,w.viewport,r[0].ptStart,r[0].ptEnd,r[0].index,!1,!0),t=r.length-1,e(A,x,w.viewport,r[t].ptStart,r[t].ptEnd,r[t].index,!1,!0));$.each(r,function(a,c){$.each(g,function(a,b){b==c.uid&&e(A,x,w.viewport,c.ptStart,c.ptEnd,c.index,!0,v)})})}}}}};this.onCanvas.VRT={};this.onCanvas.VRT.WebDcmSocket=null;this.onCanvas.VRT.Seruuid=null;this.onCanvas.VRT.canvas3D=null;this.onCanvas.VRT.annStatus3D=null;this.onCanvas.VRT.MsgTransform=function(c){if(a.VRT.bMsg||"drag"===c.type)switch(c.type){case "touchstart":case "mousedown":var e;"touchstart"===c.type?(e=c.originalEvent.targetTouches[0],e=new Point(e.pageX,e.pageY),a.onCanvas.which=1):(e=new Point(c.pageX,c.pageY),a.onCanvas.which=c.which);a.VRT.ptLast=e;a.onCanvas.VRT.MouseDown(c);break;case "touchmove":case "mousemove":0!==a.onCanvas.which&&a.onCanvas.VRT.MouseDownMove(c);break;case "touchend":case "mouseup":case "mouseout":a.onCanvas.VRT.MouseUp(c);a.onCanvas.which=0;break;case "mousewheel":a.onCanvas.VRT.MouseWheel(c);break;case "drag":a.onCanvas.VRT.DragImage(c.imgId)}};this.onCanvas.VRT.MouseDown=function(c){1===a.onCanvas.which&&a.onCanvas.VRT.Slicing(c)};this.onCanvas.VRT.Slicing=function(c){var e;if("touchmove"==c.type||"touchstart"==c.type){var b=c.originalEvent.targetTouches[0];e=new Point(b.pageX,b.pageY)}else e=new Point(c.pageX,c.pageY);var d=c.self.canvas,b=a.VRT.mng.AnnStatusMng(),k=b.viewport,f=a.VRT.mng.GetCanvas(),g=a.VRT.Series();switch(a.VRT.mng.GetEventImageIndex(c.self)){case 1:k.scale=k.scale1;k.image=b.images[0];e=CBoBo.ImageProcessor.PageToPixel(k,d,e.x,e.y);CBoBo.ImageProcessor.FitCanvas(k,d);a.onCanvas.VRT.DrawCanvasLine(c.self,{point:e,lcolor:"#0F0",vcolor:"#00F"});a.VRT.ptO=e;d=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:e,index:a.VRT.oIndex});a.onCanvas.VRT.DrawMprDicom(f[2],e,180);a.onCanvas.VRT.DrawCanvasLine(f[2],d[CBoBo.MPR_LEVEL]);a.onCanvas.VRT.DrawMprDicom(f[3],e,90);a.onCanvas.VRT.DrawCanvasLine(f[3],d[CBoBo.MPR_VERTICAl]);break;case 2:k.scale=k.scale2;k.image=b.images[180];e=CBoBo.ImageProcessor.PageToPixel(k,d,e.x,e.y);a.VRT.ptL=e;CBoBo.ImageProcessor.FitCanvas(k,f[2].canvas,!1,!1,!0);a.onCanvas.VRT.DrawCanvasLine(c.self,{point:e,lcolor:"#F00",vcolor:"#00F"});a.VRT.oIndex=e.y;if(c=g[a.VRT.oIndex-1])d=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_LEVEL,point:e}),k.image=c,b.images[0]=c,CBoBo.ImageProcessor.FitCanvas(k,f[1].canvas),a.onCanvas.VRT.DrawCanvasLine(f[1],d[CBoBo.MPR_ORIGINAL]),a.onCanvas.VRT.DrawMprDicom(f[3],a.VRT.ptO,90),a.onCanvas.VRT.DrawCanvasLine(f[3],d[CBoBo.MPR_VERTICAl]);break;case 3:if(k.scale=k.scale3,k.image=b.images[90],e=CBoBo.ImageProcessor.PageToPixel(k,d,e.x,e.y),a.VRT.ptV=e,CBoBo.ImageProcessor.FitCanvas(k,f[3].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(c.self,{point:e,lcolor:"#F00",vcolor:"#0F0"}),a.VRT.oIndex=e.y,c=g[a.VRT.oIndex-1])d=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:e}),k.image=c,b.images[0]=c,CBoBo.ImageProcessor.FitCanvas(k,f[1].canvas),a.onCanvas.VRT.DrawCanvasLine(f[1],d[CBoBo.MPR_ORIGINAL]),a.onCanvas.VRT.DrawMprDicom(f[2],a.VRT.ptO,180),a.onCanvas.VRT.DrawCanvasLine(f[2],d[CBoBo.MPR_LEVEL])}};this.onCanvas.VRT.MouseDownMove=function(c){if(1===a.onCanvas.which){var e=a.VRT.mng.GetEventImageIndex(c.self);if(0==e)switch(a.onTool.VRT.type){case "\u624b\u672f\u5200\u5185":case "\u624b\u672f\u5200\u5916":a.onCanvas.VRT.KnifeMove(c);break;default:a.onCanvas.VRT.Rotate(c)}else a.onCanvas.VRT.Slicing(c)}else 3===a.onCanvas.which?(e=a.VRT.mng.GetEventImageIndex(c.self),0==e?a.onCanvas.VRT.WindowsLevel(c):a.onCanvas.VRT.WW(c)):2===a.onCanvas.which&&(e=a.VRT.mng.GetEventImageIndex(c.self),0==e&&a.onCanvas.VRT.Pan(c))};this.onCanvas.VRT.WW=function(c){var e;"touchmove"==c.type&&(c=c.originalEvent.targetTouches[0]);e=new Point(c.pageX,c.pageY);c=e.x-a.VRT.ptLast.x;var b=e.y-a.VRT.ptLast.y;if(0!==c||0!==b){a.VRT.ptLast=e;e=a.VRT.mng.AnnStatusMng();var d=e.viewport;d.ww+=parseInt(c/d.scale);d.wc+=parseInt(b/d.scale);2>d.ww&&(d.ww=2);a.onCanvas.VRT.UpdateCanvas(e)}};this.onCanvas.VRT.MouseUp=function(c){if(1===a.onCanvas.which&&0==a.VRT.mng.GetEventImageIndex(c.self))switch(a.onTool.VRT.type){case "\u624b\u672f\u5200\u5185":case "\u624b\u672f\u5200\u5916":a.onCanvas.VRT.KnifeEnd(),a.toolBar.ChangeBtnStatus(a.onTool.VRT.type,null),a.onTool.VRT.type=""}};this.onCanvas.VRT.MouseWheel=function(c){console.log("MouseWheel");var e=a.VRT.mng.GetCanvas(),b=c.deltaY,d=a.VRT.Series(),k=a.VRT.mng.AnnStatusMng(),f;f=a.VRT.mng.GetEventImageIndex(c.self);switch(f){case 1:f=a.VRT.oIndex;a.VRT.oIndex=0<b?1>--a.VRT.oIndex?1:a.VRT.oIndex:++a.VRT.oIndex>d.length?d.length:a.VRT.oIndex;f!==a.VRT.oIndex&&(f=d[a.VRT.oIndex-1],k.viewport.image=f,k.images[0]=f,CBoBo.ImageProcessor.FitCanvas(k.viewport,c.self.canvas),a.onCanvas.VRT.DrawCanvasLine(c.self,{point:a.VRT.ptO,lcolor:"#0F0",vcolor:"#00F"}),b=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex}),k.viewport.image=k.images[180],CBoBo.ImageProcessor.FitCanvas(k.viewport,e[2].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(e[2],b[CBoBo.MPR_LEVEL]),k.viewport.scale=1,k.viewport.image=k.images[90],CBoBo.ImageProcessor.FitCanvas(k.viewport,e[3].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(e[3],b[CBoBo.MPR_VERTICAl]),k.viewport.image=k.images[0],e[1].DrawCornerInfo(k.viewport),e[2].DrawCornerInfo(k.viewport),e[3].DrawCornerInfo(k.viewport));break;case 2:f=d[0];c=parseInt(f.row);f=a.VRT.ptO.y;a.VRT.ptO.y=0<b?1>--a.VRT.ptO.y?1:a.VRT.ptO.y:++a.VRT.ptO.y>c?c:a.VRT.ptO.y;a.VRT.ptV.x=a.VRT.ptO.y;f!==a.VRT.ptO.y&&(b=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex}),a.onCanvas.VRT.DrawMprDicom(e[2],a.VRT.ptO,180),a.onCanvas.VRT.DrawCanvasLine(e[2],b[CBoBo.MPR_LEVEL]),k.viewport.image=k.images[90],CBoBo.ImageProcessor.FitCanvas(k.viewport,e[3].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(e[3],b[CBoBo.MPR_VERTICAl]),b=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:a.VRT.ptV}),f=d[a.VRT.oIndex-1],k.viewport.image=f,k.images[0]=f,CBoBo.ImageProcessor.FitCanvas(k.viewport,e[1].canvas),a.onCanvas.VRT.DrawCanvasLine(e[1],b[CBoBo.MPR_ORIGINAL]));break;case 3:f=d[0];c=parseInt(f.col);f=a.VRT.ptO.x;a.VRT.ptO.x=0<b?1>--a.VRT.ptO.x?1:a.VRT.ptO.x:++a.VRT.ptO.x>c?c:a.VRT.ptO.x;a.VRT.ptL.x=a.VRT.ptO.x;f!==a.VRT.ptO.x&&(b=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex}),a.onCanvas.VRT.DrawMprDicom(e[3],a.VRT.ptO,90),a.onCanvas.VRT.DrawCanvasLine(e[3],b[CBoBo.MPR_VERTICAl]),k.viewport.image=k.images[180],CBoBo.ImageProcessor.FitCanvas(k.viewport,e[2].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(e[2],b[CBoBo.MPR_LEVEL]),b=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_LEVEL,point:a.VRT.ptL}),f=d[a.VRT.oIndex-1],k.viewport.image=f,k.images[0]=f,CBoBo.ImageProcessor.FitCanvas(k.viewport,e[1].canvas),a.onCanvas.VRT.DrawCanvasLine(e[1],b[CBoBo.MPR_ORIGINAL]));break;case 0:a.onCanvas.VRT.Zoom(c)}};this.onCanvas.VRT.DragImage=function(c,e){e=void 0===e?!0:e;var b=this;a.onCanvas.VRT.LoadingAnimation(!0);var d=a.dataManager.GetSeries(c);if(d)if(d=d.GetAllDicom(),10>d.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20\uff01",CBoBo.MSG_ALERT),a.onCanvas.VRT.Clear();else{for(var f=!1,g=0;g<d.length;g++)if(!d[g].bLoadImage){f=!0;break}f?(e&&(a.downLoadCurrentSeriesHandle(d),$.Msg("\u8bf7\u7b49\u5f85\uff0c\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u6b63\u5728\u4e0b\u8f7d\u4e2d...",CBoBo.MSG_ALERT)),a.onCanvas.VRT.Clear(),setTimeout(function(){b.DragImage(c,!1)},2E3)):(a.onCanvas.VRT.LoadingAnimation(),a.VRT.Series(d),a.onCanvas.VRT.InitCanvas())}else $.Msg("\u4e0d\u80fd\u8fdb\u884cMPR\u91cd\u5efa\uff01")};this.onCanvas.VRT.LoadingAnimation=function(c){var e=a.VRT.mng.GetCanvas();if(void 0!==e)for(var e=$jscomp.makeIterator(e),b=e.next();!b.done;b=e.next())b=b.value,c?b.StartLoadingAnimation():b.StopLoadingAnimation()};this.onCanvas.VRT.InitCanvas=function(){var c=a.VRT.mng.GetCanvas();if(void 0!==c){var e=a.VRT.Series();if(e){var b=CBoBo.AnnStatusManager.Create(e[0],"","",!0);a.VRT.mng.AnnStatusMng(b);a.onCanvas.VRT.canvas3D=c[0];a.onCanvas.VRT.canvas3D.StartLoadingAnimation();a.onCanvas.VRTannStatus3D=b;a.onCanvas.VRT.canvas3D.DrawCornerInfo(b.viewport);a.onCanvas.VRT.DrawVrtDicom(b.viewport);var d=c[1],f=Math.floor(e.length/2);a.VRT.oIndex=f;e=e[f-1];b.viewport.image=e;b.images[0]=e;CBoBo.ImageProcessor.Restore(b.viewport).FitCanvas(b.viewport,d.canvas);d.DrawCornerInfo(b.viewport);b.viewport.scale1=b.viewport.scale;e=new Point(parseInt(e.col)>>1,parseInt(e.row)>>1);a.VRT.ptO=e;a.onCanvas.VRT.DrawCanvasLine(d,{point:e,lcolor:"#0F0",vcolor:"#00F"});d=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:e,index:f});a.onCanvas.VRT.DrawMprDicom(c[2],e,180);a.onCanvas.VRT.DrawCanvasLine(c[2],d[CBoBo.MPR_LEVEL]);c[2].DrawCornerInfo(b.viewport);b.viewport.scale2=b.viewport.scale;a.onCanvas.VRT.DrawMprDicom(c[3],e,90);a.onCanvas.VRT.DrawCanvasLine(c[3],d[CBoBo.MPR_VERTICAl]);c[3].DrawCornerInfo(b.viewport);b.viewport.scale3=b.viewport.scale;a.VRT.ptL=d[CBoBo.MPR_LEVEL].point;a.VRT.ptV=d[CBoBo.MPR_VERTICAl].point}}};this.onCanvas.VRT.DrawCanvasLine=function(c,e){function b(a,c,e){a.beginPath();a.moveTo(c.x,c.y);a.lineTo(e.x,e.y);a.stroke()}if(void 0!==e){var d=c.canvas;c=c.canvas.getContext("2d");var f=a.VRT.mng.AnnStatusMng().viewport,g=f.image,n=e.point,p=e.lcolor;e=e.vcolor;var t=g.col,r=g.row,g=new Point(0,n.y),v=new Point(t,n.y),t=new Point(n.x,0),r=new Point(n.x,r),g=CBoBo.ImageProcessor.PixelToCanvas(f,d,g),v=CBoBo.ImageProcessor.PixelToCanvas(f,d,v);c.setTransform(1,0,0,1,0,0);c.save();c.strokeStyle=p;b(c,g,v);g=CBoBo.ImageProcessor.PixelToCanvas(f,d,t);v=CBoBo.ImageProcessor.PixelToCanvas(f,d,r);c.strokeStyle=e;b(c,g,v);c.restore();return n}};this.onCanvas.VRT.DrawMprDicom=function(c,e,b){var d={},h={},f=a.VRT.Series();f&&(90===b?(d.x=e.x,d.y=0,h.x=e.x,h.y=f[0].row):(d.x=0,d.y=e.y,h.x=f[0].col,h.y=e.y),e=CBoBo.Mpr.GetPointsFromLine(d,h),e=CBoBo.Mpr.GenerateNormalPlane(a.VRT.Series(),e),d=a.VRT.mng.AnnStatusMng(),d.images[b]=e,d.viewport.image=e,CBoBo.ImageProcessor.FitCanvas(d.viewport,c.canvas,!1,!1,!0))};this.onCanvas.VRT.DrawVrtDicom=function(c){var e=a.dataManager.GetStudy(0),b=e.vrtWsURl;c=c.image.seruuid;e=e.wadourl+"/GetImagesPath?seruuid\x3d"+c+"\x26hospcode\x3d"+e.hospid+"\x26studyuid\x3d"+e.studyuid;b||alert("vrtWsURl is undefined");if(null!=a.onCanvas.VRT.WebDcmSocket){if(a.onCanvas.VRT.Seruuid==c){a.onCanvas.VRT.Refresh();return}a.onCanvas.VRT.WebDcmSocket.close()}a.onCanvas.VRT.Seruuid=c;b=b+"/Wado?serurl\x3d"+encodeURIComponent(e);a.onCanvas.VRT.WebDcmSocket=new WebSocket(b);a.onCanvas.VRT.WebDcmSocket.onclose=function(){console.log("Connection closed")};a.onCanvas.VRT.WebDcmSocket.onopen=function(){console.log("Connection opened")};a.onCanvas.VRT.WebDcmSocket.onerror=function(a){console.log("An error occured",a)};a.onCanvas.VRT.WebDcmSocket.onmessage=function(c){if("string"!=typeof c.data){var e=new FileReader;e.onload=function(c){if(c.target.readyState==FileReader.DONE){var e=new Image;e.src=this.result;e.onload=function(){a.onCanvas.VRT.canvas3D.StopLoadingAnimation();var c=a.VRT.mng.AnnStatusMng().viewport,b=a.onCanvas.VRT.canvas3D.canvas,d=b.getContext("2d"),h=b.width,b=b.height,f=e.width,k=e.height,g=h/f,l=b/k;g>l?(c.scale0=parseFloat(l.toFixed(2)),f*=l,k*=l):(c.scale0=parseFloat(g.toFixed(2)),f*=g,k*=g);d.drawImage(e,(h-f)/2,(b-k)/2,f,k);c.scale=c.scale0;a.onCanvas.VRT.canvas3D.DrawCornerInfo(c)}}};e.readAsDataURL(c.data)}}};this.onCanvas.VRT.GetMapCoord=function(c){if(void 0!=c){var e={};switch(c.type){case CBoBo.MPR_ORIGINAL:var b=c.point,d=c.index;c=e[CBoBo.MPR_LEVEL]={};c.point=new Point(b.x,d);c.lcolor="#F00";c.vcolor="#00F";c=e[CBoBo.MPR_VERTICAl]={};c.point=new Point(b.y,d);c.lcolor="#F00";c.vcolor="#0F0";break;case CBoBo.MPR_LEVEL:b=c.point;c=e[CBoBo.MPR_ORIGINAL]={};a.VRT.ptO.x=b.x;c.point=a.VRT.ptO;c.lcolor="#0F0";c.vcolor="#00F";c=e[CBoBo.MPR_VERTICAl]={};a.VRT.ptV.y=b.y;c.point=a.VRT.ptV;c.lcolor="#F00";c.vcolor="#0F0";break;case CBoBo.MPR_VERTICAl:b=c.point,c=e[CBoBo.MPR_ORIGINAL]={},a.VRT.ptO.y=b.x,c.point=a.VRT.ptO,c.lcolor="#0F0",c.vcolor="#00F",c=e[CBoBo.MPR_LEVEL]={},a.VRT.ptL.y=b.y,c.point=a.VRT.ptL,c.lcolor="#F00",c.vcolor="#00F"}return e}};this.onCanvas.VRT.Clear=function(){a.VRT.mng.AnnStatusMng(null);var c=a.VRT.mng.GetCanvas();void 0!==c&&($.each(c,function(a,c){c.canvas.width=c.canvas.width;c.DrawCornerInfo()}),a.VRT.bMsg=!1)};this.onCanvas.VRT.UpdateCanvas=function(c){a.onCanvas.VRT.Refresh();var e=a.VRT.mng.GetCanvas();c.viewport.image=c.images[0];CBoBo.ImageProcessor.FitCanvas(c.viewport,e[1].canvas);c.viewport.scale1=c.viewport.scale;a.onCanvas.VRT.DrawCanvasLine(e[1],{point:a.VRT.ptO,lcolor:"#0F0",vcolor:"#00F"});var b=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex});c.viewport.image=c.images[180];CBoBo.ImageProcessor.FitCanvas(c.viewport,e[2].canvas,!1,!1,!0);a.onCanvas.VRT.DrawCanvasLine(e[2],b[CBoBo.MPR_LEVEL]);c.viewport.scale2=c.viewport.scale;c.viewport.image=c.images[90];CBoBo.ImageProcessor.FitCanvas(c.viewport,e[3].canvas,!1,!1,!0);a.onCanvas.VRT.DrawCanvasLine(e[3],b[CBoBo.MPR_VERTICAl]);c.viewport.scale3=c.viewport.scale;c.viewport.image=c.images[0];c.viewport.scale=c.viewport.scale1;e[1].DrawCornerInfo(c.viewport);c.viewport.scale=c.viewport.scale2;e[2].DrawCornerInfo(c.viewport);c.viewport.scale=c.viewport.scale3;e[3].DrawCornerInfo(c.viewport)};this.onCanvas.VRT.Rotate=function(c){var e;if("touchmove"==c.type){var b=c.originalEvent.targetTouches[0];e=new Point(b.pageX,b.pageY)}else e=new Point(c.pageX,c.pageY);b=e.y-a.VRT.ptLast.y;if(0!==e.x-a.VRT.ptLast.x||0!==b){var b=a.VRT.ptLast.x,d=a.VRT.ptLast.y;a.VRT.ptLast=e;var f=c.self.canvas.getBoundingClientRect();e=parseInt(f.left+window.pageXOffset);var f=parseInt(f.top+window.pageYOffset),g={Cmd:1,LastPosition:[]};g.LastPosition[0]=b-e;g.LastPosition[1]=d-f;g.NowPosition=[];g.NowPosition[0]=c.pageX-e;g.NowPosition[1]=c.pageY-f;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(g))}};this.onCanvas.VRT.Pan=function(c){var e;if("touchmove"==c.type){var b=c.originalEvent.targetTouches[0];e=new Point(b.pageX,b.pageY)}else e=new Point(c.pageX,c.pageY);b=e.y-a.VRT.ptLast.y;if(0!==e.x-a.VRT.ptLast.x||0!==b){var b=a.VRT.ptLast.x,d=a.VRT.ptLast.y;a.VRT.ptLast=e;var f=c.self.canvas.getBoundingClientRect();e=f.left+window.pageXOffset;var f=f.top+window.pageYOffset,g={Cmd:2,LastPosition:[]};g.LastPosition[0]=b-e;g.LastPosition[1]=d-f;g.NowPosition=[];g.NowPosition[0]=c.pageX-e;g.NowPosition[1]=c.pageY-f;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(g))}};this.onCanvas.VRT.WindowsLevel=function(c){var e;if("touchmove"==c.type){var b=c.originalEvent.targetTouches[0];e=new Point(b.pageX,b.pageY)}else e=new Point(c.pageX,c.pageY);b=e.y-a.VRT.ptLast.y;if(0!==e.x-a.VRT.ptLast.x||0!==b){var b=a.VRT.ptLast.x,d=a.VRT.ptLast.y;a.VRT.ptLast=e;var f=c.self.canvas.getBoundingClientRect();e=f.left+window.pageXOffset;var f=f.top+window.pageYOffset,g={Cmd:4,LastPosition:[]};g.LastPosition[0]=b-e;g.LastPosition[1]=d-f;g.NowPosition=[];g.NowPosition[0]=c.pageX-e;g.NowPosition[1]=c.pageY-f;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(g))}};this.onCanvas.VRT.Zoom=function(c){var e={Cmd:3};e.DeltaY=c.deltaY;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(e))};this.onCanvas.VRT.Reset=function(){a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify({Cmd:0}))};this.onCanvas.VRT.Refresh=function(){a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify({Cmd:99}))};this.onCanvas.VRT.KnifeMove=function(c){var e;if("touchmove"==c.type){var b=c.originalEvent.targetTouches[0];e=new Point(b.pageX,b.pageY)}else e=new Point(c.pageX,c.pageY);b=e.y-a.VRT.ptLast.y;if(0!==e.x-a.VRT.ptLast.x||0!==b){var b=a.VRT.ptLast.x,d=a.VRT.ptLast.y;a.VRT.ptLast=e;e=c.self.canvas.getBoundingClientRect();var f=e.left+window.pageXOffset,g=e.top+window.pageYOffset,n={Cmd:5,LastPosition:[]};n.LastPosition[0]=b-f;n.LastPosition[1]=d-g;n.NowPosition=[];n.ViewWidth=e.width;n.ViewHeight=e.height;n.NowPosition[0]=c.pageX-f;n.NowPosition[1]=c.pageY-g;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(n))}};this.onCanvas.VRT.KnifeEnd=function(){a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify({Cmd:8}))};this.onCanvas.VRT.KnifeBegin=function(c){if("KnifeIn"==c){var e={Cmd:7};a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(e))}"KnifeOut"==c&&(e={Cmd:6},a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(e)))};this.onTool.VRT={type:""};this.onTool.VRT.MsgTransform=function(c){var e=c.usermsg||c.target.title;switch(e){case "\u624b\u672f\u5200\u5185":a.onCanvas.VRT.KnifeBegin("KnifeIn");a.toolBar.ChangeBtnStatus(c.btntitle,c.btnforce);break;case "\u624b\u672f\u5200\u5916":a.onCanvas.VRT.KnifeBegin("KnifeOut");a.toolBar.ChangeBtnStatus(c.btntitle,c.btnforce);break;case "\u91cd\u7f6e\u4e09\u7ef4\u89c6\u56fe":a.onCanvas.VRT.Reset()}a.onTool.VRT.type=e};this.onCanvas.Mpr={};this.onCanvas.Mpr.MsgTransform=function(c){if(a.Mpr.bMsg||"drag"===c.type)switch(c.type){case "touchstart":case "mousedown":var e;"touchstart"===c.type?(e=c.originalEvent.targetTouches[0],e=new Point(e.pageX,e.pageY),a.onCanvas.which=1):(e=new Point(c.pageX,c.pageY),a.onCanvas.which=c.which);a.Mpr.ptLast=e;a.onCanvas.Mpr.MouseDown(c);break;case "touchmove":case "mousemove":0!==a.onCanvas.which&&a.onCanvas.Mpr.MouseDownMove(c);break;case "touchend":case "mouseup":case "mouseout":a.onCanvas.Mpr.MouseUp(c);a.onCanvas.which=0;break;case "mousewheel":a.onCanvas.Mpr.MouseWheel(c);break;case "drag":a.onCanvas.Mpr.DragImage(c.imgId)}};this.onCanvas.Mpr.MouseDown=function(c){if(1===a.onCanvas.which)switch(a.onTool.Mpr.type){case "\u5341\u5b57\u5207\u9762":a.onCanvas.Mpr.Slicing(c);break;case "CPR\u66f2\u7ebf":a.onCanvas.Mpr.curvePoints=[],c=CBoBo.Annotation.PageCoods2Canvas(c.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y),a.onCanvas.Mpr.curvePoints.push(c)}};this.onCanvas.Mpr.MouseDownMove=function(c){if(1===a.onCanvas.which)switch(a.onTool.Mpr.type){case "\u5207\u9762\u8c03\u7a97":a.onCanvas.Mpr.WW(c);break;case "\u5341\u5b57\u5207\u9762":a.onCanvas.Mpr.Slicing(c);break;case "CPR\u76f4\u7ebf":a.onCanvas.Mpr.CprLine(c);break;case "CPR\u66f2\u7ebf":a.onCanvas.Mpr.CprCurve(c);break;case "\u5207\u56fe":a.onCanvas.Mpr.MoveMpr(c)}else 3===a.onCanvas.which&&a.onCanvas.Mpr.WW(c)};this.onCanvas.Mpr.MouseUp=function(c){if(1===a.onCanvas.which&&"\u5207\u9762\u8c03\u7a97"!==a.onTool.Mpr.type&&"\u5341\u5b57\u5207\u9762"!==a.onTool.Mpr.type&&"\u5207\u56fe"!==a.onTool.Mpr.type){var e=a.Mpr.mng.AnnStatusMng(),b=a.Mpr.mng.GetEventImageIndex(c.self);switch(b){case 0:e.viewport.image=e.images[0];break;case 1:e.viewport.image=e.images[90];break;case 2:e.viewport.image=e.images[180];break;case 3:return}CBoBo.ImageProcessor.FitCanvas(e.viewport,c.self.canvas,!0,!0,!0);var d;switch(a.onTool.Mpr.type){case "CPR\u76f4\u7ebf":var f;if("touchend"==c.type){var g=c.originalEvent.targetTouches[0];f=new Point(g.pageX,g.pageY)}else f=new Point(c.pageX,c.pageY);g=CBoBo.ImageProcessor.PageToPixel(e.viewport,c.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y);f=CBoBo.ImageProcessor.PageToPixel(e.viewport,c.self.canvas,f.x,f.y);var n=CBoBo.Mpr.GetPointsFromLine(g,f);switch(b){case 0:d=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),n);break;case 1:d=CBoBo.Mpr.GenerateSlopePlane(a.Mpr.Series(),g,f,90);break;case 2:d=CBoBo.Mpr.GenerateSlopePlane(a.Mpr.Series(),g,f,180);break;case 3:return}break;case "CPR\u66f2\u7ebf":var p=[];$.each(a.onCanvas.Mpr.curvePoints,function(){var a=CBoBo.ImageProcessor.PageToPixel(e.viewport,c.self.canvas,this.x,this.y,"cpr");p.push(a)});n=[];for(g=0;g<p.length;g++){f=p[g+1];if(void 0===f)break;f=CBoBo.Mpr.GetPointsFromLine(p[g],f);$.each(f,function(){n.push(this)})}console.log(n.length);switch(b){case 0:d=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),n);break;case 1:d=CBoBo.Mpr.GenerateSurface(a.Mpr.Series(),n);break;case 2:d=CBoBo.Mpr.GenerateSurface(a.Mpr.Series(),n);break;case 3:return}}e.viewport.image=d;b=a.Mpr.mng.GetCanvas();CBoBo.ImageProcessor.FitCanvas(e.viewport,b[3].canvas,!0,!1,!0)}};this.onCanvas.Mpr.Slicing=function(c){var e;if("touchmove"==c.type||"touchstart"==c.type){var b=c.originalEvent.targetTouches[0];e=new Point(b.pageX,b.pageY)}else e=new Point(c.pageX,c.pageY);var d=c.self.canvas,b=a.Mpr.mng.AnnStatusMng(),f=b.viewport,g=a.Mpr.mng.GetCanvas();a.Mpr.Series();switch(a.Mpr.mng.GetEventImageIndex(c.self)){case CBoBo.MPR_ORIGINAL:f.image=b.images[0];f.scale=f.scale1;e=CBoBo.ImageProcessor.PageToPixel(f,d,e.x,e.y);CBoBo.ImageProcessor.FitCanvas(f,d);a.onCanvas.Mpr.DrawCanvasLine(c.self,{point:e,lcolor:"#0F0",vcolor:"#00F"});a.Mpr.ptO=e;d=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:e,index:a.Mpr.oIndex});a.onCanvas.Mpr.DrawMprDicom(g[1],e,180);a.onCanvas.Mpr.DrawCanvasLine(g[1],d[CBoBo.MPR_LEVEL]);a.onCanvas.Mpr.DrawMprDicom(g[2],e,90);a.onCanvas.Mpr.DrawCanvasLine(g[2],d[CBoBo.MPR_VERTICAl]);break;case CBoBo.MPR_LEVEL:f.image=b.images[180];f.scale=f.scale2;e=CBoBo.ImageProcessor.PageToPixel(f,d,e.x,e.y);a.Mpr.ptL=e;CBoBo.ImageProcessor.FitCanvas(f,g[1].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(c.self,{point:e,lcolor:"#F00",vcolor:"#00F"});a.Mpr.oIndex=e.y;if(c=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype))d=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_LEVEL,point:e}),f.image=c,b.images[0]=c,CBoBo.ImageProcessor.FitCanvas(f,g[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(g[0],d[CBoBo.MPR_ORIGINAL]),a.onCanvas.Mpr.DrawMprDicom(g[2],a.Mpr.ptO,90),a.onCanvas.Mpr.DrawCanvasLine(g[2],d[CBoBo.MPR_VERTICAl]);break;case CBoBo.MPR_VERTICAl:if(f.image=b.images[90],f.scale=f.scale3,e=CBoBo.ImageProcessor.PageToPixel(f,d,e.x,e.y),a.Mpr.ptV=e,CBoBo.ImageProcessor.FitCanvas(f,g[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(c.self,{point:e,lcolor:"#F00",vcolor:"#0F0"}),a.Mpr.oIndex=e.y,c=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype))d=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:e}),f.image=c,b.images[0]=c,CBoBo.ImageProcessor.FitCanvas(f,g[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(g[0],d[CBoBo.MPR_ORIGINAL]),a.onCanvas.Mpr.DrawMprDicom(g[1],a.Mpr.ptO,180),a.onCanvas.Mpr.DrawCanvasLine(g[1],d[CBoBo.MPR_LEVEL])}};this.onCanvas.Mpr.CprCurve=function(c){if(a.Mpr.mng.GetCanvas()[3]!==c.self){var e;"touchmove"==c.type||"touchstart"==c.type?(e=c.originalEvent.targetTouches[0],e=new Point(e.pageX,e.pageY)):e=new Point(c.pageX,c.pageY);var b=a.Mpr.mng.AnnStatusMng();a.onCanvas.Mpr.UpdateCanvas(b);e=CBoBo.Annotation.PageCoods2Canvas(c.self.canvas,e.x,e.y);a.onCanvas.Mpr.curvePoints.push(e);var d=c.self.canvas.getContext("2d");d.beginPath();d.strokeStyle="#FF0";c=a.onCanvas.Mpr.curvePoints[0];d.moveTo(c.x,c.y);$.each(a.onCanvas.Mpr.curvePoints,function(){d.lineTo(this.x,this.y)});d.stroke()}};this.onCanvas.Mpr.CprLine=function(c){if(a.Mpr.mng.GetCanvas()[3]!==c.self){var e;"touchmove"==c.type||"touchstart"==c.type?(e=c.originalEvent.targetTouches[0],e=new Point(e.pageX,e.pageY)):e=new Point(c.pageX,c.pageY);var b=a.Mpr.mng.AnnStatusMng();a.onCanvas.Mpr.UpdateCanvas(b);b=CBoBo.Annotation.PageCoods2Canvas(c.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y);e=CBoBo.Annotation.PageCoods2Canvas(c.self.canvas,e.x,e.y);a.onCanvas.Mpr.DrawCprLine(c.self,b,e)}};this.onCanvas.Mpr.DrawCprLine=function(a,e,b){a=a.canvas.getContext("2d");a.beginPath();a.strokeStyle="#FF0";a.moveTo(e.x,e.y);a.lineTo(b.x,b.y);a.stroke()};this.onCanvas.Mpr.WW=function(c){var e;"touchmove"==c.type&&(c=c.originalEvent.targetTouches[0]);e=new Point(c.pageX,c.pageY);c=e.x-a.Mpr.ptLast.x;var b=e.y-a.Mpr.ptLast.y;if(0!==c||0!==b){a.Mpr.ptLast=e;e=a.Mpr.mng.AnnStatusMng();var d=e.viewport;d.ww+=parseInt(c/d.scale);d.wc+=parseInt(b/d.scale);2>d.ww&&(d.ww=2);a.onCanvas.Mpr.UpdateCanvas(e)}};this.onCanvas.Mpr.UpdateCanvas=function(c){var e=a.Mpr.mng.GetCanvas();c.viewport.image=c.images[0];CBoBo.ImageProcessor.FitCanvas(c.viewport,e[0].canvas);a.onCanvas.Mpr.DrawCanvasLine(e[0],{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"});var b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex});c.viewport.image=c.images[180];CBoBo.ImageProcessor.FitCanvas(c.viewport,e[1].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(e[1],b[CBoBo.MPR_LEVEL]);c.viewport.image=c.images[90];CBoBo.ImageProcessor.FitCanvas(c.viewport,e[2].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(e[2],b[CBoBo.MPR_VERTICAl]);c.viewport.image=c.images[0];e[0].DrawCornerInfo(c.viewport);e[1].DrawCornerInfo(c.viewport);e[2].DrawCornerInfo(c.viewport)};this.onCanvas.Mpr.MouseWheel=function(c){console.log("MouseWheel");var e=a.Mpr.mng.GetCanvas(),b=c.deltaY,d=a.Mpr.Series(),f=a.Mpr.mng.AnnStatusMng(),g;g=a.Mpr.mng.GetEventImageIndex(c.self);switch(g){case CBoBo.MPR_ORIGINAL:g=a.Mpr.oIndex;a.Mpr.oIndex=0<b?1>--a.Mpr.oIndex?1:a.Mpr.oIndex:++a.Mpr.oIndex>d.length?d.length:a.Mpr.oIndex;g!==a.Mpr.oIndex&&(g=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,c.self.canvas),a.onCanvas.Mpr.DrawCanvasLine(c.self,{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"}),b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),f.viewport.image=f.images[180],CBoBo.ImageProcessor.FitCanvas(f.viewport,e[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(e[1],b[CBoBo.MPR_LEVEL]),f.viewport.scale=1,f.viewport.image=f.images[90],CBoBo.ImageProcessor.FitCanvas(f.viewport,e[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(e[2],b[CBoBo.MPR_VERTICAl]),f.viewport.image=f.images[0],e[0].DrawCornerInfo(f.viewport),e[1].DrawCornerInfo(f.viewport),e[2].DrawCornerInfo(f.viewport));break;case CBoBo.MPR_LEVEL:g=d[0];c=parseInt(g.row);g=a.Mpr.ptO.y;a.Mpr.ptO.y=0<b?1>--a.Mpr.ptO.y?1:a.Mpr.ptO.y:++a.Mpr.ptO.y>c?c:a.Mpr.ptO.y;a.Mpr.ptV.x=a.Mpr.ptO.y;g!==a.Mpr.ptO.y&&(b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),a.onCanvas.Mpr.DrawMprDicom(e[1],a.Mpr.ptO,180),a.onCanvas.Mpr.DrawCanvasLine(e[1],b[CBoBo.MPR_LEVEL]),f.viewport.image=f.images[90],CBoBo.ImageProcessor.FitCanvas(f.viewport,e[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(e[2],b[CBoBo.MPR_VERTICAl]),b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:a.Mpr.ptV}),g=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,e[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(e[0],b[CBoBo.MPR_ORIGINAL]));break;case CBoBo.MPR_VERTICAl:g=d[0],c=parseInt(g.col),g=a.Mpr.ptO.x,a.Mpr.ptO.x=0<b?1>--a.Mpr.ptO.x?1:a.Mpr.ptO.x:++a.Mpr.ptO.x>c?c:a.Mpr.ptO.x,a.Mpr.ptL.x=a.Mpr.ptO.x,g!==a.Mpr.ptO.x&&(b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),a.onCanvas.Mpr.DrawMprDicom(e[2],a.Mpr.ptO,90),a.onCanvas.Mpr.DrawCanvasLine(e[2],b[CBoBo.MPR_VERTICAl]),f.viewport.image=f.images[180],CBoBo.ImageProcessor.FitCanvas(f.viewport,e[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(e[1],b[CBoBo.MPR_LEVEL]),b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_LEVEL,point:a.Mpr.ptL}),g=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,e[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(e[0],b[CBoBo.MPR_ORIGINAL]))}};this.onCanvas.Mpr.MoveMpr=function(c){console.log("MoveMpr");var b;"touchmove"==c.type?(b=c.originalEvent.targetTouches[0],b=new Point(b.pageX,b.pageY)):b=new Point(c.pageX,c.pageY);var d=b.y-a.Mpr.ptLast.y;if(0!==d){a.Mpr.ptLast=b;b=a.Mpr.mng.GetCanvas();var f=a.Mpr.Series(),g=a.Mpr.mng.AnnStatusMng(),m=a.Mpr.mng.GetEventImageIndex(c.self);switch(m){case CBoBo.MPR_ORIGINAL:m=a.Mpr.oIndex,a.Mpr.oIndex=0<d?1>--a.Mpr.oIndex?1:a.Mpr.oIndex:++a.Mpr.oIndex>f.length?f.length:a.Mpr.oIndex,m!==a.Mpr.oIndex&&(d=f[a.Mpr.oIndex-1],g.viewport.image=d,g.images[0]=d,CBoBo.ImageProcessor.FitCanvas(g.viewport,c.self.canvas),a.onCanvas.Mpr.DrawCanvasLine(c.self,{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"}),c=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),g.viewport.image=g.images[180],CBoBo.ImageProcessor.FitCanvas(g.viewport,b[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(b[1],c[CBoBo.MPR_LEVEL]),g.viewport.scale=1,g.viewport.image=g.images[90],CBoBo.ImageProcessor.FitCanvas(g.viewport,b[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(b[2],c[CBoBo.MPR_VERTICAl]),g.viewport.image=g.images[0],b[0].DrawCornerInfo(g.viewport),b[1].DrawCornerInfo(g.viewport),b[2].DrawCornerInfo(g.viewport))}}};this.onCanvas.Mpr.DragImage=function(c,b){b=void 0===b?!0:b;var e=this;a.onCanvas.Mpr.LoadingAnimation(!0);var d=a.dataManager.GetSeries(c);if(d)if(d=d.GetAllDicom(),10>d.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20\uff01",CBoBo.MSG_ALERT),a.onCanvas.Mpr.Clear();else{for(var f=!1,g=0;g<d.length;g++)if(!d[g].bLoadImage){f=!0;break}f?(b&&(a.downLoadCurrentSeriesHandle(d),$.Msg("\u8bf7\u7b49\u5f85\uff0c\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u6b63\u5728\u4e0b\u8f7d\u4e2d...",CBoBo.MSG_ALERT)),a.onCanvas.Mpr.Clear(),setTimeout(function(){e.DragImage(c,!1)},2E3)):(a.onCanvas.Mpr.LoadingAnimation(),a.Mpr.Series(d),a.onCanvas.Mpr.InitCanvas())}else $.Msg("\u4e0d\u80fd\u8fdb\u884cMPR\u91cd\u5efa\uff01")};this.onCanvas.Mpr.LoadingAnimation=function(c){var b=a.Mpr.mng.GetCanvas();if(void 0!==b)for(var b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next())d=d.value,c?d.StartLoadingAnimation():d.StopLoadingAnimation()};this.onCanvas.Mpr.InitCanvas=function(){var c=a.Mpr.mng.GetCanvas();if(void 0!==c){var b=a.Mpr.Series();if(b){var d=CBoBo.AnnStatusManager.Create(b[0],"","",!0);a.Mpr.mng.AnnStatusMng(d);var f=c[0],b=Math.floor(b.length/2);a.Mpr.oIndex=b;var g=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),b-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype);d.viewport.image=g;d.images[0]=g;CBoBo.ImageProcessor.Restore(d.viewport).FitCanvas(d.viewport,f.canvas);d.viewport.scale1=d.viewport.scale;f.DrawCornerInfo(d.viewport);g=new Point(parseInt(g.col)>>1,parseInt(g.row)>>1);a.Mpr.ptO=g;a.onCanvas.Mpr.DrawCanvasLine(f,{point:g,lcolor:"#0F0",vcolor:"#00F"});f=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:g,index:b});a.onCanvas.Mpr.DrawMprDicom(c[1],g,180);d.viewport.scale2=d.viewport.scale;a.onCanvas.Mpr.DrawCanvasLine(c[1],f[CBoBo.MPR_LEVEL]);c[1].DrawCornerInfo(d.viewport);a.onCanvas.Mpr.DrawMprDicom(c[2],g,90);d.viewport.scale3=d.viewport.scale;a.onCanvas.Mpr.DrawCanvasLine(c[2],f[CBoBo.MPR_VERTICAl]);c[2].DrawCornerInfo(d.viewport);a.Mpr.ptL=f[CBoBo.MPR_LEVEL].point;a.Mpr.ptV=f[CBoBo.MPR_VERTICAl].point}}};this.onCanvas.Mpr.DrawCanvasLine=function(c,b){function e(a,c,b){a.beginPath();a.moveTo(c.x,c.y);a.lineTo(b.x,b.y);a.stroke()}if(void 0!==b){var d=c.canvas;c=c.canvas.getContext("2d");var f=a.Mpr.mng.AnnStatusMng().viewport,g=f.image,n=b.point,p=b.lcolor;b=b.vcolor;var t=g.col,r=g.row,g=new Point(0,n.y),v=new Point(t,n.y),t=new Point(n.x,0),r=new Point(n.x,r),g=CBoBo.ImageProcessor.PixelToCanvas(f,d,g),v=CBoBo.ImageProcessor.PixelToCanvas(f,d,v);c.setTransform(1,0,0,1,0,0);c.save();c.strokeStyle=p;e(c,g,v);g=CBoBo.ImageProcessor.PixelToCanvas(f,d,t);v=CBoBo.ImageProcessor.PixelToCanvas(f,d,r);c.strokeStyle=b;e(c,g,v);c.restore();return n}};this.onCanvas.Mpr.DrawMprDicom=function(c,b,d){var e={},f={},g=a.Mpr.Series();g&&(90===d?(e.x=b.x,e.y=0,f.x=b.x,f.y=g[0].row):(e.x=0,e.y=b.y,f.x=g[0].col,f.y=b.y),b=CBoBo.Mpr.GetPointsFromLine(e,f),b=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),b,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),e=a.Mpr.mng.AnnStatusMng(),e.images[d]=b,e.viewport.image=b,CBoBo.ImageProcessor.FitCanvas(e.viewport,c.canvas,!1,!1,!0))};this.onCanvas.Mpr.GetMprDicom=function(a,b,d){var c=a[0].col,e=a[0].row,f=parseFloat(a[0].sliceth),g=parseFloat(a[0].pixy),h=new DVDicomInfo;h.SetInfo({data:a[0]});h.pixy=f;h.sliceth=g;h.id=CBoBo.Plugin.GetRandom();0===d%180?(h.row=a.length,h.col=c):0===d%90&&(h.row=a.length,h.col=e);h.pixsBuffer=new Int16Array(h.row*h.col);var t=0,r,v=c*b.y;$.each(a,function(a,f){r=f.pixsBuffer;if(0===d%180)for(a=0;a<c;a++)f=r[a+v],h.pixsBuffer[t]=f,t++;else if(0===d%90)for(a=0;a<e;a++)f=r[a*c+b.x],h.pixsBuffer[t]=f,t++});h.setPixsBuffer(h.pixsBuffer);return h};this.onCanvas.Mpr.GetMapCoord=function(c){if(void 0!=c){var b={};switch(c.type){case CBoBo.MPR_ORIGINAL:var d=c.point,f=c.index;c=b[CBoBo.MPR_LEVEL]={};c.point=new Point(d.x,f);c.lcolor="#F00";c.vcolor="#00F";c=b[CBoBo.MPR_VERTICAl]={};c.point=new Point(d.y,f);c.lcolor="#F00";c.vcolor="#0F0";break;case CBoBo.MPR_LEVEL:d=c.point;c=b[CBoBo.MPR_ORIGINAL]={};a.Mpr.ptO.x=d.x;c.point=a.Mpr.ptO;c.lcolor="#0F0";c.vcolor="#00F";c=b[CBoBo.MPR_VERTICAl]={};a.Mpr.ptV.y=d.y;c.point=a.Mpr.ptV;c.lcolor="#F00";c.vcolor="#0F0";break;case CBoBo.MPR_VERTICAl:d=c.point,c=b[CBoBo.MPR_ORIGINAL]={},a.Mpr.ptO.y=d.x,c.point=a.Mpr.ptO,c.lcolor="#0F0",c.vcolor="#00F",c=b[CBoBo.MPR_LEVEL]={},a.Mpr.ptL.y=d.y,c.point=a.Mpr.ptL,c.lcolor="#F00",c.vcolor="#00F"}return b}};this.onCanvas.Mpr.Clear=function(){a.Mpr.mng.AnnStatusMng(null);var c=a.Mpr.mng.GetCanvas();void 0!==c&&($.each(c,function(a,c){c.canvas.width=c.canvas.width;c.DrawCornerInfo()}),a.Mpr.bMsg=!1)};this.onCanvas.Mpr.MipCreat=function(a,b){alert(a+b)};this.onTool.Mpr={type:"\u5341\u5b57\u5207\u9762",Miptype:void 0,thicKness:1};this.onTool.Mpr.MsgTransform=function(c){var b=c.usermsg||c.target.title;switch(b){case "CPR\u76f4\u7ebf":case "CPR\u66f2\u7ebf":a.Mpr.SetLayout(4);break;case "\u5207\u9762\u8c03\u7a97":"\u5207\u9762\u8c03\u7a97"!=a.onTool.Mpr.type&&a.toolBar.ChangeBtnStatus(a.onTool.Mpr.type);a.onTool.Mpr.type="\u5207\u9762\u8c03\u7a97";a.Mpr.SetLayout(3);a.onCanvas.Mpr.InitCanvas();return;case "\u5341\u5b57\u5207\u9762":"\u5341\u5b57\u5207\u9762"!=a.onTool.Mpr.type&&a.toolBar.ChangeBtnStatus(a.onTool.Mpr.type),a.onTool.Mpr.type="\u5341\u5b57\u5207\u9762",a.Mpr.SetLayout(3);case "\u5012\u5e8f":a.Mpr.Series().reverse();a.onCanvas.Mpr.InitCanvas();return;case "\u6700\u5927\u5bc6\u5ea6\u6295\u5f71":a.onTool.Mpr.Miptype=b;break;case "\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71":a.onTool.Mpr.Miptype=b;break;case "\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71":a.onTool.Mpr.Miptype=b;break;case "\u5c42\u539a":a.onTool.Mpr.thicKness=c.target.value}"\u5c42\u539a"!=b&&!1===a.toolBar.ChangeBtnStatus(c.btntitle,c.btnforce)?(a.onTool.Mpr.type="\u5341\u5b57\u5207\u9762",void 0!=a.onTool.Mpr.Miptype&&(a.onTool.Mpr.Miptype=void 0,a.onCanvas.Mpr.InitCanvas())):("\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71"!=b&&"\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71"!=b&&"\u6700\u5927\u5bc6\u5ea6\u6295\u5f71"!=b&&"\u5c42\u539a"!=b&&(a.onTool.Mpr.type=b),void 0!=a.onTool.Mpr.Miptype&&1!=a.onTool.Mpr.thicKness?a.onCanvas.Mpr.InitCanvas():(c=a.Mpr.mng.AnnStatusMng(),a.onCanvas.Mpr.UpdateCanvas(c)))};this.PrintView={};this.PrintView.MsgTransform=function(c){if(c.self){var b=c.self.webWorkerType;switch(c.type){case "dblclick":case "doubletap":case "mousewheel":return;case "message":b==CBoBo.PTYPE_JPG?a.onCanvas.Jpg.DrawImage(c):a.onCanvas.DrawDicom(c)}b==CBoBo.PTYPE_JPG?a.onCanvas.Jpg.MsgTransform(c):a.onCanvas.MsgTransform(c)}else switch(c.toolbtnresponse&&a.onTool.MsgTransform(c),c.type){case "draw":a.FlushAnnStatusForCanvas(c.arrannstatus,c.arrcanvas,c.bforce,!0)}};this.Assist={};this.Assist.MsgTransform=function(c){if("object"==typeof c)switch(c.type){case "btnfocus":a.toolBar.ChangeBtnStatus(c.btntitle,c.btnforce);break;case "command":a.Assist.AnalyzeStatus(c.data);break;case "addstudy":c=a.Assist.GetTransferStatus(),a.assistDiagnose.SendCommand(c)}};this.Assist.GetTransferStatus=function(){var c={wadourl:"",hospid:"",studyuid:"",mode:"2d",bd:{mode:0,layout:{row:1,col:1,arrlayout:[]},focus:{index1:1,index2:1},bshowcornerinfo:1,annstatus:[]}},b={voi:{ww:0,wc:0},translation:{x:0,y:0},invert:0,rotation:0,pseudocolor:"",arrann:{}},d=a.dataManager.GetStudy(0);c.studyuid=d.stuuid;c.wadourl=d.wadourl;c.hospid=d.hospid;c.mode=void 0!==a.Mpr&&a.Mpr.bShow?"mpr":"2d";"2d"==c.mode?(c.bd.mode=a.mode,c.bd.mode==CBoBo.PTYPE_SERIES?(c.bd.layout.row=a.canvasManager.nLayoutRow,c.bd.layout.col=a.canvasManager.nLayoutCol,c.bd.focus.index1=a.canvasManager.focusIndex,c.bd.focus.index2=a.canvasManager.GetFocusMng().focusIndex,$.each(a.annStatusManager.GetAnnStatusMng(),function(a,e){var d=$.extend(!0,b,{});$.each(e.arrAnnStatus,function(a,c){var b=c.status;0==a&&(d.voi.ww=b.ww,d.voi.wc=b.wc,d.translation.x=b.ptLast.x,d.translation.y=b.ptLast.y,d.invert=b.negative,d.rotation=b.rotateState,d.pseudocolor="");if(void 0!==b.imageInfo||null!==b.imageInfo)d.arrann[b.imageInfo.id]=CBoBo.Plugin.CloneObj(c.ann.arrAnn)});c.bd.annstatus.push(d)}),$.each(a.canvasManager.arrFirstLayer,function(){c.bd.layout.arrlayout.push({row:this.nLayoutRow,col:this.nLayoutCol})})):(c.bd.layout.row=a.canvasManager.nLayoutRow,c.bd.layout.col=a.canvasManager.nLayoutCol,c.bd.focus.index1=a.canvasManager.focusIndex,$.each(a.annStatusManager.GetAnnStatus(),function(a,e){a=$.extend(!0,{},b);if(e.type==CBoBo.PTYPE_DESERIES){var d=e.status;a.voi.ww=d.ww;a.voi.wc=d.wc;a.translation.x=d.ptLast.x;a.translation.y=d.ptLast.y;a.invert=d.negative;a.rotation=d.rotateState;a.pseudocolor="";if(void 0!==d.imageInfo||null!==d.imageInfo)a.arrann[d.imageInfo.id]=CBoBo.Plugin.CloneObj(e.ann.arrAnn)}else d=e.status,a.voi.ww=d.brightness,a.voi.wc=d.contrast,a.translation.x=d.ptLast.x,a.translation.y=d.ptLast.y,a.invert=d.Negative,a.rotation=d.rotateState,a.pseudocolor="";c.bd.annstatus.push(a)})),c.bd.bshowcornerinfo=a.toolBar.bShowCornerInfo):"mpr"==c.mode&&(c.mpr={});return c};this.Assist.AnalyzeStatus=function(c){if(c instanceof Object){var b=a.Assist.GetTransferStatus();console.log(c);if(c.hospid!=b.hospid||b.studyuid!=c.studyuid)a.onThumb.ToolMsg({usermsg:"\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5"}),void 0!==a.canvasManager&&(a.canvasManager.Destroy(),delete a.canvasManager,a.canvasManager=void 0),void 0!==a.annStatusManager&&(delete a.annStatusManager,a.annStatusManager=void 0),a.OpenStudy(c.wadourl,c.hospid,c.studyuid);(function(c){if("2d"==c.mode&&void 0!==a.canvasManager)if(c=c.bd,c.mode==CBoBo.PTYPE_SERIES){if(b.bd.layout.row!=c.layout.row||b.bd.layout.col!=c.layout.col){var e=a.annStatusManager.GetAnnStatusMng();a.canvasManager.UpdateLayout(e.length,c.layout.row,c.layout.col);a.canvasManager.EachMng(function(a,c){if(a<e.length){if(a=e[a],null!==a){var b=a.GetAnnStatus();c.UpdateLayout(b.length);c.AnnStatusMng(a);0<b.length&&(b[0].type==CBoBo.PTYPE_SERIES?c.checkbox.Show(!0):c.checkbox.Show(!1))}}else c.UpdateLayout(0),c.checkbox.Show(!1)})}var d=c.layout.arrlayout,f=b.bd.layout.arrlayout;d instanceof Array&&a.canvasManager.EachMng(function(a,c){if(a<d.length){var b=d[a];a=f[a];if(a.row!=b.row||a.col!=b.col)null!==c.annStatusMng?c.UpdateLayout(c.annStatusMng.arrAnnStatus.length,b.row,b.col):c.UpdateLayout(0,b.row,b.col)}})}else if(b.bd.layout.row!=c.layout.row||b.bd.layout.col!=c.layout.col){var g=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(g.length,c.layout.row,c.layout.col)}})(c);(function(c){"2d"==c.mode&&(c=c.bd,b.bd.focus.index1==c.focus.index1&&b.bd.focus.index2==c.focus.index2||a.canvasManager.SetDefaultFocus(c.focus.index1,c.focus.index2))})(c);(function(a){if("2d"==a.mode){a=a.bd;var c=a.annstatus;a.mode==CBoBo.PTYPE_SERIES&&c instanceof Array&&$.each(c,function(a,c){})}})(c)}};a.GlobalInit();a.DL.OpenStudy()};"undefined"==typeof CBoBo&&(CBoBo={});!function(d){var b=!1,a;d.Draw={GetIsFromServer:function(){return b},SetIsFromServer:function(a){b=a},FitServerCanvas:function(a,g,c,e,h){b?d.ImageProcessor.FitServerCanvas(a,g,c,e,h):d.ImageProcessor.FitCanvas(a,g,c,e,h)},DrawImage:function(a,g,c,e){b?d.ImageProcessor.DrawServerGrayImage(a,g,c,e):d.ImageProcessor.DrawGrayImage(a,g,c,e)},SetWadoUrl:function(b){a=b},GetWadoUrl:function(){return a}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function b(a){for(var c=0;c<q.length;c++){var b=q[c];if(b.id===a.id&&b.imageid===a.image.id)return b}}function a(a){24<=q.length&&q.shift();q.push(a)}function f(a){for(var c=0;c<q.length;c++){var b=q[c];b.id===a.id&&b.imageid===a.imageid&&q.splice(c,1)}}function g(c,d,g){var u=b(c),A=e(u,c),p=c.image,n=p.isRGB,x=p.isIMGAnalysis2;if(d||void 0===u||u.canvas.width!==c.image.col||u.canvas.height!==c.image.row){void 0!==u&&f(u);u={};u.id=c.id;u.imageid=c.image.id;u.ww=c.ww;u.wc=c.wc;u.invert=c.invert;u.pseudo=c.pseudo;u.sharpen=c.sharpen;u.blur=c.blur;1<c.image.frames&&!self.CBoBo.Manager.toolBar.IsEnable("\u5e8f\u5217\u64ad\u653e")&&(self.CBoBo.Manager.toolBar.EnableButton("\u5e8f\u5217\u64ad\u653e",!0),self.CBoBo.Manager.toolBar.GetButtonDOM("\u5e8f\u5217\u64ad\u653e").click());d=document.createElement("canvas");d.width=c.image.col;d.height=c.image.row;A=d.getContext("2d");p=A.getImageData(0,0,d.width,d.height);if(n){c=c.image.pixsBuffer;for(var n=g=0,H=c.length,r=p.data;n<H;)r[g++]=c[n++],r[g++]=c[n++],r[g++]=c[n++],r[g++]=x?c[n++]:255}else{if(1==c.image.imageType&&8>=c.image.bita&&"MONOCHROME2"==c.image.phme)for(var x=c.image.pixsBuffer,n=p.data,t=c.frames,t=isNaN(t)||void 0==t?0:t-1,H=0,r=n.length,t=t*r/4;H<r;)n[H++]=x[t],n[H++]=x[t],n[H++]=x[t],n[H++]=255,t++;else x=c.image.pixsBuffer,n=c.image.minGray,H=p.data,r=h(c.ww,c.wc,n,c.image.maxGray,c.image.rescsl,c.image.rescin,c.invert,c.pseudo),l(x,r,n,H);p=k(p,c.sharpen);m(g,c.blur)}A.putImageData(p,0,0);u.canvas=d;u.ctx=A;u.imagedata=p;a(u);return d}void 0!==u&&A?n||(d=c.image.pixsBuffer,A=c.image.minGray,p=u.imagedata.data,x=h(c.ww,c.wc,A,c.image.maxGray,c.image.rescsl,c.image.rescin,c.invert,c.pseudo),l(d,x,A,p),u.imagedata=k(u.imagedata,c.sharpen),m(g,c.blur),u.ctx.putImageData(u.imagedata,0,0),u.ww=c.ww,u.wc=c.wc,u.invert=c.invert,u.pseudo=c.pseudo,u.sharpen=c.sharpen,u.blur=c.blur):n||m(g,c.blur);return u.canvas}function c(c,g){var h=b(c),k=e(h,c),l=$.Deferred();if(g||void 0===h||h.canvas.width!==c.image.col||h.canvas.height!==c.image.row)void 0!==h&&f(h),g=new Image,g.src=d.Draw.GetWadoUrl()+"/GetImageData?id\x3d"+c.image.id+"\x26contentType\x3dimage/jpeg\x26windowWidth\x3d"+c.ww+"\x26windowCenter\x3d"+c.wc+"\x26efficioncy\x3d80",g.onload=function(){var b={};b.id=c.id;b.imageid=c.image.id;b.ww=c.ww;b.wc=c.wc;b.invert=c.invert;b.pseudo=c.pseudo;b.canvas=this;a(b);return l.resolve(this)};else if(void 0!==h&&k)void 0!==h&&f(h),g=new Image,g.src=d.Draw.GetWadoUrl()+"/GetImageData?id\x3d"+c.image.id+"\x26contentType\x3dimage/jpeg\x26windowWidth\x3d"+c.ww+"\x26windowCenter\x3d"+c.wc+"\x26efficioncy\x3d80",g.onload=function(){var b={};b.id=c.id;b.imageid=c.image.id;b.ww=c.ww;b.wc=c.wc;b.invert=c.invert;b.pseudo=c.pseudo;b.canvas=this;a(b);return l.resolve(this)};else return l.resolve(h.canvas);return l}function e(a,c){return void 0===a||void 0===c?!1:a.ww!==c.ww||a.wc!==c.wc||a.invert!==c.invert||a.pseudo!==c.pseudo||a.sharpen!==c.sharpen||a.blur!==c.blur?!0:!1}function h(a,c,b,e,d,f,g,h){var k=[],l=0;0>b&&(l=b);if(g)for(;b<=e;b++)g=parseInt(b*d+f),g=255*((g+-c)/a+.5),g=Math.min(Math.max(g,0),255),k[b+-l]=Math.round(255-g);else for(;b<=e;b++)g=parseFloat(b*d+f),g=255*((g+-c)/a+.5),g=Math.min(Math.max(g,0),255),k[b+-l]=Math.round(g);if(""===h||"\u7070\u8272"===h)return{r:k,g:k,b:k};a=n(h);c=new Int16Array(k.length);e=new Int16Array(k.length);for(f=0;f<k.length;f++)d=k[f],c[f]=a.r[d],e[f]=a.g[d],k[f]=a.b[d];return{r:c,g:e,b:k}}function l(a,c,b,e){var d=0,f=0,g=a.length,h=c.r,k=c.g;c=c.b;var l;if(0>b)for(;f<g;)l=a[f++]+-b,e[d++]=h[l],e[d++]=k[l],e[d++]=c[l],e[d++]=255;else for(;f<g;)l=a[f++],e[d++]=h[l],e[d++]=k[l],e[d++]=c[l],e[d++]=255;return e}function k(a,c){if(c){c=[0-c,-.2-c,0-c,-.2-c,1.8+8*c,-.2-c,0-c,-.2-c,0-c];var b=Math.round(Math.sqrt(c.length)),e=Math.floor(b/2),d=a.data,f=a.width;a=a.height;for(var g=document.createElement("canvas").getContext("2d").createImageData(f,a),h=0;h<a;h++)for(var k=0;k<f;k++){for(var l=4*(h*f+k),m=0,y=0,B=0,I=0;I<b;I++)for(var u=0;u<b;u++){var D=h+I-e,K=k+u-e;0<=D&&D<a&&0<=K&&K<f&&(D=4*(D*f+K),K=c[I*b+u],m+=d[D]*K,y+=d[D+1]*K,B+=d[D+2]*K)}g.data[l]=m;g.data[l+1]=y;g.data[l+2]=B;g.data[l+3]=255}c=g}else c=a;return c}function m(a,c){a.setAttribute("style","filter:blur("+c+"px)")}function n(a){switch(a){case "\u5f69\u8679":return{r:rainbow_red,g:rainbow_green,b:rainbow_blue};case "\u9ed1\u4f53":return{r:blackbody_red,g:blackbody_green,b:blackbody_blue};case "\u9aa8\u9abc":return{r:bones_red,g:bones_green,b:bones_blue};case "\u5fc3\u810f":return{r:cardiac_red,g:cardiac_green,b:cardiac_blue};case "\u6d41\u52a8":return{r:flow_red,g:flow_green,b:flow_blue};case "Ge\u8272":return{r:ge_color_red,g:ge_color_green,b:ge_color_blue};case "\u7070\u8272\u5f69\u8679":return{r:gray_rainbow_red,g:gray_rainbow_green,b:gray_rainbow_blue};case "\u70ed\u7eff":return{r:hot_green_red,g:hot_green_green,b:hot_green_blue};case "\u94ec\u94c1":return{r:hot_iron_red,g:hot_iron_green,b:hot_iron_blue};case "\u70ed\u91d1\u5c5e":return{r:hot_metal_red,g:hot_metal_green,b:hot_metal_blue};case "\u9971\u548c\u5ea61":return{r:hue1_red,g:hue1_green,b:hue1_blue};case "\u9971\u548c\u5ea62":return{r:hue2_red,g:hue2_green,b:hue2_blue};case "\u7ea2\u5916":return{r:ired_red,g:ired_green,b:ired_blue};case "\u58a8\u9ed1":return{r:jet_red,g:jet_green,b:jet_blue};case "\u9aa8\u9abc-\u808c\u8089":return{r:muscles_bones_red,g:muscles_bones_green,b:muscles_bones_blue};case "NIH":return{r:nih_red,g:nih_green,b:nih_blue};case "\u5f69\u86791":return{r:rainbow1_red,g:rainbow1_green,b:rainbow1_blue};case "\u5f69\u86792":return{r:rainbow2_red,g:rainbow2_green,b:rainbow2_blue};case "\u5f69\u86793":return{r:rainbow3_red,g:rainbow3_green,b:rainbow3_blue};case "\u6bd4\u503c":return{r:ratio_red,g:ratio_green,b:ratio_blue};case "\u7ea2\u8272\u8840\u7ba1":return{r:red_vessels_red,g:red_vessels_green,b:red_vessels_blue};case "\u5149\u8c31":return{r:spectrum_red,g:spectrum_green,b:spectrum_blue};case "\u65af\u7279\u6069":return{r:stern_red,g:stern_green,b:stern_blue};case "UCLA":return{r:ucla_red,g:ucla_green,b:ucla_blue}}}function p(a){return void 0===a.image?{width:0,height:0}:0===a.rotation||180===a.rotation?{width:a.image.col,height:a.image.row}:{width:a.image.row,height:a.image.col}}function t(a,c,b){var e=new w;e.translate(c.width/2,c.height/2);c=a.rotation;0!==c&&e.rotate(c*Math.PI/180);var d=a.scale,f=a.scale;a.image.pixy<a.image.pixx?d*=a.image.pixx/a.image.pixy:a.image.pixx<a.image.pixy&&(f*=a.image.pixy/a.image.pixx);e.scale(d,f);0!==c&&e.rotate(-c*Math.PI/180);e.translate(a.translation.x,a.translation.y);0!==c&&e.rotate(c*Math.PI/180);void 0!==b&&e.scale(b,b);a.hflip&&e.scale(-1,1);a.vflip&&e.scale(1,-1);e.translate(-a.image.col/2,-a.image.row/2);return e}function r(a,c,b,e){if(a.image.pixx&&a.image.pixy&&!(150>e||150>b)){var d=a.image.col,f=a.image.row,g=a.scale,h,k,l=a.image.pixx;a=a.image.pixy;h=d*g;k=f*g;var g=b/3*d*l/h,m=b/2*d*l/h,y=e/3*f*a/k,B=e/2*f*a/k,I=[1,2,3,5,10,15,20,25,30,50,100,150,200,250,300,500,1E3,1500,2E3,2500,3E3,5E3,1E4];for(a=k=f=0;a<I.length&&!(.01>f&&g<I[a]&&m>I[a]&&(f=I[a]),.01>k&&y<I[a]&&B>I[a]&&(k=I[a]),.01<=f&&.01<=k);a++);.01>f&&(f=Math.round((m+g)/2));.01>k&&(k=Math.round((B+y)/2));a=f*h/(l*d);if(!(1E4<f||1>f||1E4<k||1>k)){g="mm";1E3<=f?3E3<f?(f=Math.round(f/1E3),g="m",a=1E3*f*h/(l*d)):(f=Math.round(f/100),g="dm",a=100*f*h/(l*d)):100<=f?300<f?(f=Math.round(f/100),g="dm",a=100*f*h/(l*d)):(f=Math.round(f/10),g="cm",a=10*f*h/(l*d)):10<=f&&30<f&&(f=Math.round(f/10),g="cm",a=10*f*h/(l*d));c.save();c.setTransform(1,0,0,1,0,0);c.beginPath();c.translate(.5,.5);c.strokeStyle="white";c.fillStyle="white";h=e/20;d=(b-a)/2;l=e-h;b=(b+a)/2;e-=h;c.moveTo(Math.round(d),Math.round(l));c.lineTo(Math.round(b),Math.round(e));h=f;10>=h&&(h*=10);m=a/h;10<h&&5>m&&(h/=10,m=a/h);for(a=0;a<=h;a++)k=a*m,y=d+k,0==a%10?(I=d+k,B=l-15):0==a%5?(I=d+k,B=l-15):(I=d+k,B=l-10),k=c,k.moveTo(Math.round(y),Math.round(l)),k.lineTo(Math.round(I),Math.round(B));c.stroke();c.fillText(f+" "+g,Math.round(b+10),Math.round(e));c.restore()}}}function v(a,c,b){var e=a.image;if(e.orl||e.ort||e.orr||e.orb){b.setTransform(1,0,0,1,0,0);var f,g=a.image.col,h=a.image.row;f={x:g/2,y:12};e=d.ImageProcessor.PixelToCanvas(a,c,f);f={x:g/2,y:h-12};var k=d.ImageProcessor.PixelToCanvas(a,c,f);f={x:12,y:h/2};var l=d.ImageProcessor.PixelToCanvas(a,c,f);f={x:g-12,y:h/2};c=d.ImageProcessor.PixelToCanvas(a,c,f);f=b.measureText(a.image.ort).width;var g=b.measureText(a.image.orl).width,h=b.measureText(a.image.orr).width,m=b.measureText(a.image.orb).width;b.fillText(a.image.ort,e.x-f/2,e.y);b.fillText(a.image.orl,l.x-g/2,l.y);b.fillText(a.image.orr,c.x-h/2,c.y);b.fillText(a.image.orb,k.x-m/2,k.y)}}function w(){this.reset()}var q=[];d.ImageProcessor={GetDefaultStatus:function(){var a;a=(1E12*Math.random()>>0)+(new Date).getTime();return{id:a,image:void 0,ww:0,wc:0,rotation:0,scale:1,scale0:1,scale1:1,scale2:1,scale3:1,translation:{x:0,y:0},hflip:!1,vflip:!1,pseudo:"",invert:!1,wwScale:1}},Restore:function(a){if(!a.image.bLoadImage)return this;a.wc=parseInt(a.image.wc);a.ww=parseInt(a.image.ww);if(isNaN(a.wc)||isNaN(a.ww)||0===a.ww)a.ww=a.image.maxGray-a.image.minGray,a.wc=a.image.minGray+(a.ww>>1);a.scale=1;a.translation.x=0;a.translation.y=0;a.invert="MONOCHROME1"===a.image.phme?!0:!1;a.image.isIMGAnalysis2&&(a.invert=!1);a.pseudo="";a.rotation=0;a.hflip=!1;a.vflip=!1;a.image.isIMGAnalysis2?a.wwScale=.5:(a.wwScale=Math.abs(a.wc).toString().slice(0,1),2>=a.wc.toString().length&&(a.wwScale=.5));a.sharpen=0;a.blur=0;return this},FitCanvas:function(a,c,b,e,d){if(void 0!==a.image&&a.image.bLoadImage){var f=p(a),g;g=a.image.pixx===a.image.pixy||isNaN(a.image.pixx)||isNaN(a.image.pixy)?c.height/f.height:c.height/(f.height*a.image.pixy/a.image.pixx);f=c.width/f.width;a.scale=f<g?f:g;a.scale=parseFloat(a.scale.toFixed(2));a.translation.x=0;a.translation.y=0;e||this.DrawGrayImage(a,c,b,d)}},DrawGrayImage:function(a,c,b,e){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===c)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var d=c.getContext("2d");b=g(a,b,c);var f=a.image.col,h=a.image.row;d.imageSmoothingQuality="high";d.imageSmoothingEnabled=!0;d.shadowColor="#000000";d.shadowOffsetX=1;d.shadowOffsetY=1;d.shadowBlur=.5;d.fillStyle="white";d.clearRect(0,0,c.width,c.height);var k=t(a,c);d.setTransform(k.m[0],k.m[1],k.m[2],k.m[3],k.m[4],k.m[5],k.m[6]);a.image.pixx===a.image.pixy||isNaN(a.image.pixx)||isNaN(a.image.pixy)?d.drawImage(b,0,0,f,h,0,0,f,h):d.drawImage(b,0,0,f,h);e?d.setTransform(1,0,0,1,0,0):v(a,c,d);"ECG"!=a.image.mod&&r(a,d,c.width,c.height)},DrawGrayImage1:function(a,c,b,e){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===c)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var d=c.getContext("2d"),f=g(a,b),h=a.image.col,k=a.image.row;d.shadowColor="#000000";d.shadowOffsetX=1;d.shadowOffsetY=1;d.shadowBlur=.5;d.fillStyle="white";d.clearRect(0,0,c.width,c.height);var l=t(a,c);d.setTransform(l.m[0],l.m[1],l.m[2],l.m[3],l.m[4],l.m[5],l.m[6]);d.drawImage(f,0,0,h,k,0,0,h,k);b=d.getImageData(0,0,h,k);var m=document.createElement("canvas");m.width=c.width;m.height=c.height;m=m.getContext("2d");m.shadowColor="#000000";m.shadowOffsetX=1;m.shadowOffsetY=1;m.shadowBlur=.5;m.fillStyle="white";m.clearRect(0,0,c.width,c.height);m.imageSmoothingEnabled=!1;m.setTransform(l.m[0],l.m[1],l.m[2],l.m[3],l.m[4],l.m[5],l.m[6]);m.drawImage(f,0,0,h,k,0,0,h,k);f=m.getImageData(0,0,h,k);b=b.data;f=f.data;for(h=0;h<b.length;h+=4)if(k=f[h],l=f[h+1],m=f[h+2],255===k||0===k)b[h]=k,b[h+1]=l,b[h+2]=m;e?d.setTransform(1,0,0,1,0,0):v(a,c,d);r(a,d,c.width,c.height)},PageToPixel:function(a,c,b,e,d){if(void 0===a.image)throw"PageToPixel:image has not been loaded yet.";void 0==d?(d=c.getBoundingClientRect(),b={x:b-d.left-window.pageXOffset,y:e-d.top-window.pageYOffset}):b={x:b,y:e};c=t(a,c);c.invert();c=b=c.transformPoint(b.x,b.y);e=a.image.col;a=a.image.row;0>c.x&&(c.x=0);0>c.y&&(c.y=0);e=0+e;a=0+a;c.x>e&&(c.x=e);c.y>a&&(c.y=a);c.x=parseInt(c.x);c.y=parseInt(c.y);return b},PixelToCanvas:function(a,c,b){return t(a,c).transformPoint(b.x,b.y)},FitServerCanvas:function(a,c,b,e,d){if(void 0!==a.image&&a.image.bLoadImage){var f=p(a),g=c.height/f.height,f=c.width/f.width;a.scale=f<g?f:g;a.scale=parseFloat(a.scale.toFixed(2));a.translation.x=0;a.translation.y=0;e||this.DrawServerGrayImage(a,c,b,d)}},DrawServerGrayImage:function(a,b,e,d){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===b)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var f=b.getContext("2d");c(a,e).then(function(c){var e=a.image.col,g=a.image.row;f.shadowColor="#000000";f.shadowOffsetX=1;f.shadowOffsetY=1;f.shadowBlur=.5;f.fillStyle="white";f.clearRect(0,0,b.width,b.height);var h=t(a,b);f.setTransform(h.m[0],h.m[1],h.m[2],h.m[3],h.m[4],h.m[5],h.m[6]);f.drawImage(c,0,0,e,g,0,0,e,g);d?f.setTransform(1,0,0,1,0,0):v(a,b,f);r(a,f,b.width,b.height)})}};w.prototype.reset=function(){this.m=[1,0,0,1,0,0]};w.prototype.clone=function(){var a=new w;a.m[0]=this.m[0];a.m[1]=this.m[1];a.m[2]=this.m[2];a.m[3]=this.m[3];a.m[4]=this.m[4];a.m[5]=this.m[5];return a};w.prototype.multiply=function(a){var c=this.m[1]*a.m[0]+this.m[3]*a.m[1],b=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],d=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],f=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=c;this.m[2]=b;this.m[3]=e;this.m[4]=d;this.m[5]=f};w.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),c=-this.m[1]*a,b=-this.m[2]*a,e=this.m[0]*a,d=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),f=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*a;this.m[1]=c;this.m[2]=b;this.m[3]=e;this.m[4]=d;this.m[5]=f};w.prototype.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);var b=this.m[1]*c+this.m[3]*a,e=this.m[0]*-a+this.m[2]*c,d=this.m[1]*-a+this.m[3]*c;this.m[0]=this.m[0]*c+this.m[2]*a;this.m[1]=b;this.m[2]=e;this.m[3]=d};w.prototype.translate=function(a,c){this.m[4]+=this.m[0]*a+this.m[2]*c;this.m[5]+=this.m[1]*a+this.m[3]*c};w.prototype.scale=function(a,c){this.m[0]*=a;this.m[1]*=a;this.m[2]*=c;this.m[3]*=c};w.prototype.transformPoint=function(a,c){var b=a;a=b*this.m[0]+c*this.m[2]+this.m[4];c=b*this.m[1]+c*this.m[3]+this.m[5];return{x:a,y:c}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function b(a,b,c){var e=[];if(a.x===b.x&&a.y===b.y)e.push(a);else if(a.x===b.x)if(a.y>b.y)for(var d=a.y;d>=b.y;d--)e.push({x:a.x,y:d});else for(d=a.y;d<=b.y;d++)e.push({x:a.x,y:d});else if(a.y===b.y)if(a.x>b.x)for(var f=a.x;f>=b.x;f--)e.push({x:f,y:a.y});else for(f=a.x;f<=b.x;f++)e.push({x:f,y:a.y});else{var g=(b.y-a.y)/(b.x-a.x);if(Math.abs(a.x-b.x)>Math.abs(a.y-b.y))if(a.x>b.x)for(f=a.x;f>=b.x;f--)d=g*(f-a.x)+a.y,c||(d=Math.round(d)),e.push({x:f,y:d});else for(f=a.x;f<=b.x;f++)d=g*(f-a.x)+a.y,c||(d=Math.round(d)),e.push({x:f,y:d});else if(a.y>b.y)for(d=a.y;d>=b.y;d--)f=(d-a.y)/g+a.x,c||(f=Math.round(f)),e.push({x:f,y:d});else for(d=a.y;d<=b.y;d++)f=(d-a.y)/g+a.x,c||(f=Math.round(f)),e.push({x:f,y:d})}return e}function a(a){return"number"===typeof a&&0===a%1}!function(d){function f(a,b,f,g){var c=a[0].col,e=new DVDicomInfo;e.id=d.Plugin.GetRandom();e.SetInfo({data:a[0]});var h=1,l=0,t=0,r=0,v=0,v=b[0].x==b[1].x?1:2;e.row=a.length;e.col=b.length;e.pixy=Math.abs(a[0].pixz-a[1].pixz);h=parseInt(f/e.pixx);e.pixsBuffer=new Int16Array(e.row*e.col);var w=0;$.each(a,function(a,d){$.each(b,function(){l=-32768;t=32767;for(var a=r=0;a<h;a++){if(2==v)var b=c*(this.y+a)+this.x;1==v&&(b=c*this.y+this.x+a);var f=d.pixsBuffer[b];r+=f/h;l<f&&(l=f);t>f&&(t=f)}"\u6700\u5927\u5bc6\u5ea6\u6295\u5f71"==g?e.pixsBuffer[w]=l:"\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71"==g?e.pixsBuffer[w]=t:"\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71"==g&&(e.pixsBuffer[w]=r);w++})});e.setPixsBuffer(e.pixsBuffer);return e}d.Mpr={GenerateMipNomalPlane:function(a,b,f,g){if(void 0==g||6!=g.length)return a[b];var c=new DVDicomInfo;c.id=d.Plugin.GetRandom();c.SetInfo({data:a[b]});var e,h,l;f=parseInt(f/Math.abs(a[0].pixz-a[1].pixz));c.pixsBuffer=new Int16Array(c.row*c.col);for(var t=c.pixsBuffer.length,r=0;r<t;r++){e=-32768;h=32767;for(var v=l=0;v<f;v++)if(v<a.length-b){var w=a[v+b].pixsBuffer[r];l+=w/f;e<w&&(e=w);h>w&&(h=w)}"\u6700\u5927\u5bc6\u5ea6\u6295\u5f71"==g?c.pixsBuffer[r]=e:"\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71"==g?c.pixsBuffer[r]=h:"\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71"==g&&(c.pixsBuffer[r]=l)}c.setPixsBuffer(c.pixsBuffer);return c},GenerateNormalPlane:function(a,b,g,l){if(void 0!=l&&6==l.length)return f(a,b,g,l);var c=a[0].col;g=Math.abs(a[0].pixz-a[1].pixz);var e=new DVDicomInfo;e.SetInfo({data:a[0]});e.pixy=g;e.id=d.Plugin.GetRandom();e.row=a.length;e.col=b.length;e.pixsBuffer=new Int16Array(e.row*e.col);var h=0;$.each(a,function(a,d){$.each(b,function(){e.pixsBuffer[h]=d.pixsBuffer[c*this.y+this.x];h++})});e.setPixsBuffer(e.pixsBuffer);return e},GenerateSlopePlane:function(c,e,f,g){var h=new DVDicomInfo;h.SetInfo({data:c[0]});h.id=d.Plugin.GetRandom();var l=parseFloat(c[0].sliceth);h.pixx=(l-h.pixx)/90*(e.x===f.x&&e.y===f.y?0:e.x===f.x?90:e.y===f.y?0:Math.abs(180*Math.atan((f.y-e.y)/(f.x-e.x))/Math.PI))+h.pixx;e=b(e,f,!0);h.col=e.length;var n=0,p,t,r;if(90===g){h.row=c[0].row;h.pixsBuffer=new Int16Array(h.row*h.col);for(var v=0;v<h.row;v++)$.each(e,function(){t=parseInt(v*c[0].col+this.x);if(a(this.y))this.y=Math.max(0,Math.min(c.length-1,this.y)),p=c[this.y],r=p.pixsBuffer[t];else{var b=Math.floor(this.y),e;e=Math.max(0,Math.min(c.length-1,b+1));var b=Math.max(0,Math.min(c.length-1,b)),d=this.y-b;r=c[b].pixsBuffer[t]*(1-d)+c[e].pixsBuffer[t]*d;r=Math.round(r)}h.pixsBuffer[n]=r;n++})}else if(180===g)for(h.row=c[0].col,h.pixsBuffer=new Int16Array(h.row*h.col),v=0;v<h.row;v++)$.each(e,function(){t=c[0].col*parseInt(this.x)+v;if(a(this.y))this.y=Math.max(0,Math.min(c.length-1,this.y)),p=c[this.y],r=p.pixsBuffer[t];else{var b=Math.floor(this.y),e;e=Math.max(0,Math.min(c.length-1,b+1));var b=Math.max(0,Math.min(c.length-1,b)),d=this.y-b;r=c[b].pixsBuffer[t]*(1-d)+c[e].pixsBuffer[t]*d;r=Math.round(r)}h.pixsBuffer[n]=r;n++});else return;h.setPixsBuffer(h.pixsBuffer);return h},GenerateSurface:function(a,e){for(var c=[],f=0;f<e.length;f++){var g=e[f+1];if(void 0===g)break;g=b(e[f],g);$.each(g,function(){c.push(this)})}var m=new DVDicomInfo;m.SetInfo({data:a[0]});m.id=d.Plugin.GetRandom();m.pixy=parseFloat(a[0].sliceth);m.row=a.length;m.col=c.length;m.pixsBuffer=new Int16Array(m.row*m.col);var n=0;$.each(a,function(b,e){$.each(c,function(){m.pixsBuffer[n]=e.pixsBuffer[a[0].col*this.y+this.x];n++})});m.setPixsBuffer(m.pixsBuffer);return m},GetPointsFromLine:b}}(d);!function(a){a.Mip={GenerateMipPlane:function(b,c,e,d,f){var g=b[0].col,h=new DVDicomInfo;h.id=a.Plugin.GetRandom();h.SetInfo({data:b[0]});var l=1,p=0,t=0,r=0;if(0==e){l=parseInt(d/Math.abs(b[0].pixz-b[1].pixz));h.pixsBuffer=new Int16Array(h.row*h.col);d=h.pixsBuffer.length;for(var v=0;i<d;v++)for(var p=65535,t=-65535,r=0,w=c;w<l;w++)if(w<b.length){var q=b[w].pixsBuffer[v],r=r+q/l;p<q&&(p=q);t>q&&(t=q)}"Max"==f?h.pixsBuffer[u]=p:"Min"==f?h.pixsBuffer[u]=t:"Mean"==f&&(h.pixsBuffer[u]=r)}else{h.row=b.length;h.col=c.length;h.pixy=Math.abs(b[0].pixz-b[1].pixz);l=parseInt(d/h.pixx);h.pixsBuffer=new Int16Array(h.row*h.col);var u=0;$.each(b,function(a,b){$.each(c,function(){p=65535;t=-65535;for(var a=r=0;a<l;a++){if(2==e)var c=g*(this.y+a)+this.x;1==e&&(c=g*this.y+this.x+a);var d=b.pixsBuffer[c];r+=d;p<d&&(p=d);t>d&&(t=d)}r/=l;"Max"==f?h.pixsBuffer[u]=p:"Min"==f?h.pixsBuffer[u]=t:"Mean"==f&&(h.pixsBuffer[u]=r);u++})})}h.setPixsBuffer(h.pixsBuffer);return h}}}(d)}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function b(a,c){var b=a.x-c.x;a=a.y-c.y;return b*b+a*a}function a(a,c){var e=b(a.start,a.end);if(0===e)return b(c,a.start);e=((c.x-a.start.x)*(a.end.x-a.start.x)+(c.y-a.start.y)*(a.end.y-a.start.y))/e;return 0>e?b(c,a.start):1<e?b(c,a.end):b(c,{x:a.start.x+e*(a.end.x-a.start.x),y:a.start.y+e*(a.end.y-a.start.y)})}function f(c,b){return Math.sqrt(a(c,b))}function g(a,c,b,e,d,f){c instanceof Array||(c=[c]);var g=F.getFont(),h=F.getFontSize(),k=F.getBackgroundColor();a.save();a.font=g;a.textBaseline="top";a.strokeStyle=d;var l=0;c.forEach(function(c){c=a.measureText(c).width;l=Math.max(l,c)});a.fillStyle=k;g={width:l+10,height:5+c.length*(h+5)};f&&f.centering&&!0===f.centering.x&&(b-=g.width/2);f&&f.centering&&!0===f.centering.y&&(e-=g.height/2);g.left=b;g.top=e;f&&!0===f.debug&&(a.fillStyle="#FF0000");a.fillRect(g.left,g.top,g.width,g.height);c.forEach(function(c,f){a.fillStyle=d;a.fillText(c,b+5,e+5+f*(h+5))});a.restore();return g}function c(a,c){return Math.sqrt(e(a,c))}function e(a,c){var b=a.x-c.x;a=a.y-c.y;return b*b+a*a}function h(a,b){for(var e=[],d,f=0;f<a.length;f++){var g=c(a[f],b);e.push(g);d=0===f?g:Math.min(g,d)}b=e.indexOf(d);return a[b]}function l(a,c){a.save();a.strokeStyle=F.GetHandleColor();if(c instanceof Array&&!(1>c.length)){for(var b=0;b<c.length;b++){a.beginPath();var e=c[b];a.fillStyle="#00FF00";a.arc(e.x,e.y,10,0,2*Math.PI);a.fill()}a.restore()}}function k(a,c,b){for(var e=[],f=0;f<b.length;f++){var g=d.ImageProcessor.PixelToCanvas(a,c,b[f]);e.push(g)}return e}function m(a,b){for(var e=0;e<b.length;e++)if(40>c(b[e],a))return e;return-1}function n(a,c){return a.x<c.left||a.x>c.left+c.width||a.y<c.top||a.y>c.top+c.height?!1:!0}function p(a,c,b){a=a.getBoundingClientRect();return{x:c-a.left-window.pageXOffset,y:b-a.top-window.pageYOffset}}function t(a){a=a.getContext("2d");a.lineWidth=F.getToolWidth();a.shadowColor=F.getshadowColor();a.shadowOffsetX=F.getshadowOffsetX();a.shadowOffsetY=F.getshadowOffsetY();a.shadowBlur=.5;a.setTransform(1,0,0,1,0,0);return a}function r(a,c,b,e,d){if(void 0===a)throw"GetStoredPixels: parameter image must not be undefined.";c=Math.round(c);b=Math.round(b);for(var f=[],g=0,h=a.pixsBuffer,k=0;k<d;k++)for(var l=0;l<e;l++){var y=(k+b)*a.col+(l+c);f[g++]=h[y]}return f}function v(a,c){var b=parseInt(a);isNaN(b)&&(b=1);var e=parseInt(c);isNaN(e)&&(e=0);return function(a){return a*b+e}}function w(a,c,b,e,d){c=r(a,c,b,e,d);return 1===a.rescsl&&0===a.rescin?c:c.map(v(a.rescsl,a.rescin))}function q(a,c){a instanceof Object&&1==arguments.length?(this.x=a.x,this.y=a.y):(this.x=a,this.y=c)}function u(){this.type="probe";this.active=!1;this.handles={end:{x:0,y:0}}}function x(){this.type="line";this.active=!1;this.length=0;this.invalid=!0;this.index=-1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,text:"",boundingBox:{}}}function A(){this.type="rect";this.active=!1;this.index=-1;this.area=0;this.invalid=!0;this.isServer=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}};this.ellipse={left:0,top:0,width:0,height:0};this.meanStdDev={count:0,mean:0,variance:0,stdDev:0}}function z(){this.type="ellipse";this.active=!1;this.index=-1;this.invalid=!0;this.isServer=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}};this.ellipse={left:0,top:0,width:0,height:0};this.meanStdDev={count:0,mean:0,variance:0,stdDev:0}}function E(){this.type="arrow";this.active=!1;this.index=-1;this.handles={start:{x:0,y:0},end:{x:0,y:0}}}function G(){this.type="angle";this.active=!1;this.index=-1;this.angle=0;this.invalid=!0;this.createHitNums=0;this.handles={start:{x:0,y:0},center:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}}}function M(){this.type="text";this.text="";this.textBox={active:!1,x:0,y:0,boundingBox:{}};this.text=prompt("\u8bf7\u8f93\u5165\u6587\u672c:","")}function J(a){this.type=a;this.active=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}}}function H(){this.type="heartratio";this.active=!1;this.lineIndex=this.index=-1;this.ratio=0;this.invalid=!0;this.topline={start:{x:0,y:0},end:{x:0,y:0}};this.downline={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}}}var F=new function(){var a="#ff8000",c="#dd0",b="transparent",e=15,d=e+"px Arial",f="transparent",g=1;this.setFillColor=function(a){b=a};this.getFillColor=function(){return b};this.setToolColor=function(c){a=c};this.getToolColor=function(){return a};this.setActiveToolColor=function(a){c=a};this.getActiveToolColor=function(){return c};this.getColorIfActive=function(b){return b?c:a};this.setToolWidth=function(a){g=a};this.getToolWidth=function(){return g};this.setFont=function(a){d=a};this.getFont=function(){return d};this.setFontSize=function(a){e=a};this.getFontSize=function(){return e};this.setBackgroundColor=function(a){f=a};this.getBackgroundColor=function(){return f};this.getshadowColor=function(){return"#000000"};this.getshadowOffsetX=function(){return 1};this.getshadowOffsetY=function(){return 1};this.GetHandleColor=function(){return"#ff0"}},C={recordAnn:void 0,SetRecordAnn:function(a){this.recordAnn=a},GetRecordAnn:function(){return this.recordAnn},newAnn:void 0,SetNewAnn:function(a){this.newAnn=a},GetNewAnn:function(){return this.newAnn},modifyAnn:void 0,SetModifyAnn:function(a){this.modifyAnn=a},GetModifyAnn:function(){return this.modifyAnn}};u.prototype.Draw=function(a,c,b){var e=F.getColorIfActive(this.active),f=d.ImageProcessor.PixelToCanvas(a,c,this.handles.end),f=[{x:f.x,y:f.y-4},{x:f.x-4,y:f.y},{x:f.x,y:f.y+4},{x:f.x+4,y:f.y}];b.beginPath();b.strokeStyle=e;b.moveTo(f[0].x,f[0].y);b.lineTo(f[2].x,f[2].y);b.moveTo(f[1].x,f[1].y);b.lineTo(f[3].x,f[3].y);b.stroke();this.active&&(f=[this.handles.end],f=k(a,c,f),l(b,f));b.fillStyle=e;var f=Math.round(this.handles.end.x),h=Math.round(this.handles.end.y),y,B;if(!(0>f||0>h||f>=a.image.col||h>=a.image.row)){if(!a.image.color){y=r(a.image,f,h,1,1);B=y[0];var m=parseInt(a.image.rescsl),I=parseInt(a.image.rescin);y="x : "+f+", y : "+h;B="sp: "+B+" mo: "+parseFloat((B*m+I).toFixed(3))}a=d.ImageProcessor.PixelToCanvas(a,c,{x:this.handles.end.x+3,y:this.handles.end.y-5});c=F.getFontSize();g(b,B,a.x,a.y+c+5,e);g(b,y,a.x,a.y,e)}};u.prototype.PointIsPointNear=function(a,c,b){var e=[this.handles.end],e=k(a,c,e);this.index=a=m(b,e);return-1!==a?!0:!1};u.prototype.Modify=function(a,c){this.handles.end.x+=a;this.handles.end.y+=c};x.prototype.Draw=function(a,c,b){var e=F.getColorIfActive(this.active||this.textBox.active),f=d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),y=d.ImageProcessor.PixelToCanvas(a,c,this.handles.end);b.beginPath();b.strokeStyle=e;b.moveTo(f.x,f.y);b.lineTo(y.x,y.y);b.stroke();if(this.active){var B=this.GetHandlePoints(),B=k(a,c,B);l(b,B)}b.fillStyle=e;this.invalid&&this.Calculate(a);B=" mm";a.image.pixx&&a.image.pixy||(B=" pixels");B=""+this.length.toFixed(2)+B;if(!this.textBox.hasMoved){var m=Math.max(this.handles.start.x,this.handles.end.x),p;p=m===this.handles.start.x?this.handles.start.y:this.handles.end.y;this.textBox.x=m;this.textBox.y=p}a=d.ImageProcessor.PixelToCanvas(a,c,this.textBox);a.x+=10;c=g(b,B,a.x,a.y,e);this.textBox.boundingBox=c;this.textBox.hasMoved&&(m={},B=[f,y,{x:(f.x+y.x)/2,y:(f.y+y.y)/2}],m.x=a.x,m.y=a.y,f=h(B,m),m=h([{x:c.left+c.width/2,y:c.top},{x:c.left,y:c.top+c.height/2},{x:c.left+c.width/2,y:c.top+c.height},{x:c.left+c.width,y:c.top+c.height/2}],f),b.save(),b.beginPath(),b.strokeStyle=e,b.setLineDash([2,3]),b.moveTo(f.x,f.y),b.lineTo(m.x,m.y),b.stroke(),b.restore())};x.prototype.PointIsLineNear=function(a,c,b){a={start:d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,c,this.handles.end)};return 10>f(a,b)};x.prototype.PointIsPointNear=function(a,c,b){var e=this.GetHandlePoints(),e=k(a,c,e);this.index=a=m(b,e);return-1!==a?!0:!1};x.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.end);return a};x.prototype.PointIsInTextBox=function(a,c,b,e){a=p(c,b,e);return n(a,this.textBox.boundingBox)};x.prototype.Calculate=function(a){var c=(this.handles.end.x-this.handles.start.x)*(a.image.pixy||1);a=(this.handles.end.y-this.handles.start.y)*(a.image.pixx||1);this.length=Math.sqrt(c*c+a*a);this.invalid=!1};x.prototype.Modify=function(a,c){var b=!0;if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=c;else{switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=c;break;case 1:this.handles.end.x+=a;this.handles.end.y+=c;break;default:this.handles.start.x+=a,this.handles.start.y+=c,this.handles.end.x+=a,this.handles.end.y+=c,b=!1}this.invalid=b}};A.prototype.Draw=function(a,c,b,e,f){e=F.getColorIfActive(this.active||this.textBox.active);var y=d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),m=d.ImageProcessor.PixelToCanvas(a,c,this.handles.end);f=Math.abs(y.x-m.x);var B=Math.abs(y.y-m.y),p=Math.min(y.x,m.x),y=Math.min(y.y,m.y);b.beginPath();b.strokeStyle=e;b.rect(p,y,f,B);b.stroke();this.active&&(f=this.GetHandlePoints(),f=k(a,c,f),l(b,f));if(this.invalid){var n=Math.abs(this.handles.start.x-this.handles.end.x),D=Math.abs(this.handles.start.y-this.handles.end.y),B=Math.min(this.handles.start.x,this.handles.end.x),p=Math.min(this.handles.start.y,this.handles.end.y);this.ellipse=f={left:B,top:p,width:n,height:D};this.context=b;d.Draw.GetIsFromServer()||(B=w(a.image,B,p,n,D),this.Calculate(B,f),this.area=n*(a.image.pixx||1)*D*(a.image.pixy||1),this.invalid=!1)}d.Draw.GetIsFromServer()&&(this.area=n*(a.image.pixx||1)*D*(a.image.pixy||1));f=" mm\u00b2";a.image.pixx&&a.image.pixy||(f=" pixel\u00b2");D="Area: "+this.area.toFixed(2)+f;this.textBox.hasMoved||(n=this.GetHandlePoints(),a.hflip?(this.textBox.bRight=n[1].x>a.image.col>>1,this.textBox.x=this.textBox.bRight?n[0].x:n[2].x):(this.textBox.bRight=n[1].x<a.image.col>>1,this.textBox.x=this.textBox.bRight?n[2].x:n[0].x),this.textBox.y=a.vflip?n[4].y:n[0].y);n=d.ImageProcessor.PixelToCanvas(a,c,this.textBox);f=b.measureText(f);this.textBox.bRight?n.x+=8:(B=b.measureText(D),n.x=n.x-f.width-B.width-8);B="";"CT"===a.image.mod&&(B=" HU");b.fillStyle=e;f="Mean: "+this.meanStdDev.mean.toFixed(2)+B;B="StdDev: "+this.meanStdDev.stdDev.toFixed(2)+B;p=[];p.push(f);p.push(B);p.push(D);D=g(b,p,n.x,n.y,e);this.textBox.boundingBox=D;this.textBox.hasMoved&&(B={},f=this.GetHandlePoints(),f=k(a,c,f),B.x=n.x,B.y=n.y,a=h(f,B),B=h([{x:D.left+D.width/2,y:D.top},{x:D.left,y:D.top+D.height/2},{x:D.left+D.width/2,y:D.top+D.height},{x:D.left+D.width,y:D.top+D.height/2}],a),b.save(),b.beginPath(),b.strokeStyle=e,b.setLineDash([2,3]),b.moveTo(a.x,a.y),b.lineTo(B.x,B.y),b.stroke(),b.restore())};A.prototype.GetHandlePoints=function(){var a=[],c=Math.min(this.handles.start.x,this.handles.end.x),b=Math.min(this.handles.start.y,this.handles.end.y),e=Math.max(this.handles.start.x,this.handles.end.x),d=Math.max(this.handles.start.y,this.handles.end.y),f=this.handles.start.x+this.handles.end.x>>1,g=this.handles.start.y+this.handles.end.y>>1;a.push(new q(c,b));a.push(new q(f,b));a.push(new q(e,b));a.push(new q(e,g));a.push(new q(e,d));a.push(new q(f,d));a.push(new q(c,d));a.push(new q(c,g));return a};A.prototype.Calculate=function(a,c){for(var b=0,e=0,d=0,f=0,g=c.top;g<c.top+c.height;g++)for(var h=c.left;h<c.left+c.width;h++)b+=a[f],e+=a[f]*a[f],d++,f++;0===d&&(this.meanStdDev={count:d,mean:0,variance:0,stdDev:0});a=b/d;e=e/d-a*a;this.meanStdDev={count:d,mean:a,variance:e,stdDev:Math.sqrt(e)}};A.prototype.PointIsLineNear=function(a,c,b){var e=this.GetHandlePoints(),g={start:d.ImageProcessor.PixelToCanvas(a,c,e[0]),end:d.ImageProcessor.PixelToCanvas(a,c,e[2])},g=f(g,b);if(20>g)return!0;g={start:d.ImageProcessor.PixelToCanvas(a,c,e[2]),end:d.ImageProcessor.PixelToCanvas(a,c,e[4])};g=f(g,b);if(20>g)return!0;g={start:d.ImageProcessor.PixelToCanvas(a,c,e[4]),end:d.ImageProcessor.PixelToCanvas(a,c,e[6])};g=f(g,b);if(20>g)return!0;g={start:d.ImageProcessor.PixelToCanvas(a,c,e[0]),end:d.ImageProcessor.PixelToCanvas(a,c,e[6])};g=f(g,b);return 20>g?!0:!1};A.prototype.PointIsPointNear=function(a,c,b){var e=this.GetHandlePoints(),e=k(a,c,e);this.index=a=m(b,e);return-1!==a?!0:!1};A.prototype.PointIsInTextBox=function(a,c,b,e){a=p(c,b,e);return n(a,this.textBox.boundingBox)};A.prototype.Modify=function(a,c){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=c;else{var b=this.handles.start.x,e=this.handles.start.y,d=this.handles.end.x,f=this.handles.end.y;switch(this.index){case 0:b+=a;e+=c;break;case 1:e+=c;break;case 2:d+=a;e+=c;break;case 3:d+=a;break;case 4:d+=a;f+=c;break;case 5:f+=c;break;case 6:b+=a;f+=c;break;case 7:b+=a;break;default:b+=a,e+=c,d+=a,f+=c}this.handles.start.x=b;this.handles.start.y=e;this.handles.end.x=d;this.handles.end.y=f;this.invalid=!0}};A.prototype.ServerModify=function(a,c){this.textBox.active&&(this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=c)};A.prototype.CorrectPoint=function(){var a=Math.min(this.handles.start.y,this.handles.end.y),c=Math.max(this.handles.start.x,this.handles.end.x),b=Math.max(this.handles.start.y,this.handles.end.y);this.handles.start.x=Math.min(this.handles.start.x,this.handles.end.x);this.handles.start.y=a;this.handles.end.x=c;this.handles.end.y=b};z.prototype.Draw=function(a,c,b){var e=F.getColorIfActive(this.active||this.textBox.active),f=d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),m=d.ImageProcessor.PixelToCanvas(a,c,this.handles.end),y=Math.min(f.x,m.x),n=Math.min(f.y,m.y),p=Math.abs(f.x-m.x),f=Math.abs(f.y-m.y);b.beginPath();b.strokeStyle=e;this.DrawEllipse(b,y,n,p,f);b.closePath();this.active&&(f=this.GetHandlePoints(),f=k(a,c,f),l(b,f));this.invalid&&(n=Math.abs(this.handles.start.x-this.handles.end.x),p=Math.abs(this.handles.start.y-this.handles.end.y),f=Math.min(this.handles.start.x,this.handles.end.x),m=Math.min(this.handles.start.y,this.handles.end.y),this.ellipse=y={left:f,top:m,width:n,height:p},this.context=b,d.Draw.GetIsFromServer()||(n=w(a.image,f,m,n,p),this.Calculate(n,y),this.invalid=!1),this.area=y.width*(a.image.pixx||1)/2*Math.PI*(y.height*(a.image.pixy||1)/2));p="";"CT"===a.image.mod&&(p=" HU");f=" mm\u00b2";a.image.pixx&&a.image.pixy||(f=" pixel\u00b2");n="Area: "+this.area.toFixed(2)+f;this.textBox.hasMoved||(y=this.GetHandlePoints(),a.hflip?(this.textBox.bRight=y[0].x>a.image.col>>1,this.textBox.x=this.textBox.bRight?y[3].x:y[1].x):(this.textBox.bRight=y[0].x<a.image.col>>1,this.textBox.x=this.textBox.bRight?y[1].x:y[3].x),this.textBox.y=a.vflip?y[2].y:y[0].y);y=d.ImageProcessor.PixelToCanvas(a,c,this.textBox);f=b.measureText(f);this.textBox.bRight?y.x+=8:(m=b.measureText(n),y.x=y.x-f.width-m.width-5);b.fillStyle=e;f="Mean: "+this.meanStdDev.mean.toFixed(2)+p;p="StdDev: "+this.meanStdDev.stdDev.toFixed(2)+p;m=[];m.push(f);m.push(p);m.push(n);n=g(b,m,y.x,y.y,e);this.textBox.boundingBox=n;this.textBox.hasMoved&&(p={},f=this.GetHandlePoints(),f=k(a,c,f),p.x=y.x,p.y=y.y,a=h(f,p),p=h([{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}],a),b.save(),b.beginPath(),b.strokeStyle=e,b.setLineDash([2,3]),b.moveTo(a.x,a.y),b.lineTo(p.x,p.y),b.stroke(),b.restore())};z.prototype.DrawEllipse=function(a,c,b,e,d){var f=e/2*.5522848,g=d/2*.5522848,h=c+e,k=b+d;e=c+e/2;d=b+d/2;a.beginPath();a.moveTo(c,d);a.bezierCurveTo(c,d-g,e-f,b,e,b);a.bezierCurveTo(e+f,b,h,d-g,h,d);a.bezierCurveTo(h,d+g,e+f,k,e,k);a.bezierCurveTo(e-f,k,c,d+g,c,d);a.closePath();a.stroke()};z.prototype.GetHandlePoints=function(){var a=[],c=Math.min(this.handles.start.x,this.handles.end.x),b=Math.max(this.handles.start.x,this.handles.end.x),e=Math.max(this.handles.start.y,this.handles.end.y),d=this.handles.start.x+this.handles.end.x>>1,f=this.handles.start.y+this.handles.end.y>>1;a.push(new q(d,Math.min(this.handles.start.y,this.handles.end.y)));a.push(new q(b,f));a.push(new q(d,e));a.push(new q(c,f));return a};z.prototype.PointInEllipse=function(a,c){var b=a.width/2,e=a.height/2;if(0>=b||0>=e)return!1;var d=c.x-(a.left+b);a=c.y-(a.top+e);return 1>=d*d/(b*b)+a*a/(e*e)};z.prototype.Calculate=function(a,c){for(var b=0,e=0,d=0,f=0,g=c.top;g<c.top+c.height;g++)for(var h=c.left;h<c.left+c.width;h++)!0===this.PointInEllipse(c,{x:h,y:g})&&(b+=a[f],e+=a[f]*a[f],d++),f++;0===d&&(this.meanStdDev={count:d,mean:0,variance:0,stdDev:0});a=b/d;e=e/d-a*a;this.meanStdDev={count:d,mean:a,variance:e,stdDev:Math.sqrt(e)}};z.prototype.PointIsLineNear=function(a,c,b){var e=d.ImageProcessor.PixelToCanvas(a,c,this.handles.start);c=d.ImageProcessor.PixelToCanvas(a,c,this.handles.end);a={left:Math.min(e.x,c.x)-7.5,top:Math.min(e.y,c.y)-7.5,width:Math.abs(e.x-c.x)+15,height:Math.abs(e.y-c.y)+15};e=this.PointInEllipse({left:Math.min(e.x,c.x)+7.5,top:Math.min(e.y,c.y)+7.5,width:Math.abs(e.x-c.x)-15,height:Math.abs(e.y-c.y)-15},b);return this.PointInEllipse(a,b)&&!e?!0:!1};z.prototype.PointIsPointNear=function(a,c,b){var e=this.GetHandlePoints(),e=k(a,c,e);this.index=a=m(b,e);return-1!==a?!0:!1};z.prototype.PointIsInTextBox=function(a,c,b,e){a=p(c,b,e);return n(a,this.textBox.boundingBox)};z.prototype.Modify=function(a,c){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=c;else{var b=this.handles.start.x,e=this.handles.start.y,d=this.handles.end.x,f=this.handles.end.y;switch(this.index){case 0:e+=c;break;case 1:d+=a;break;case 2:f+=c;break;case 3:b+=a;break;default:b+=a,e+=c,d+=a,f+=c}this.handles.start.x=b;this.handles.start.y=e;this.handles.end.x=d;this.handles.end.y=f;this.invalid=!0}};z.prototype.CorrectPoint=function(){var a=Math.min(this.handles.start.y,this.handles.end.y),c=Math.max(this.handles.start.x,this.handles.end.x),b=Math.max(this.handles.start.y,this.handles.end.y);this.handles.start.x=Math.min(this.handles.start.x,this.handles.end.x);this.handles.start.y=a;this.handles.end.x=c;this.handles.end.y=b};E.prototype.Draw=function(a,c,b){var e=F.getColorIfActive(this.active),f=d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),g=d.ImageProcessor.PixelToCanvas(a,c,this.handles.end);b.strokeStyle=e;b.fillStyle=e;this.DrawArrow(b,f,g);this.active&&(e=this.GetHandlePoints(),e=k(a,c,e),l(b,e))};E.prototype.DrawArrow=function(a,c,b){c=[c.x,c.y];b=[b.x,b.y];a.beginPath();a.translate(0,0);a.moveTo(c[0],c[1]);a.lineTo(b[0],b[1]);a.fill();a.stroke();a.save();a.translate(b[0],b[1]);var e=(b[0]-c[0])/(b[1]-c[1]),e=Math.atan(e);0<=b[1]-c[1]?a.rotate(-e):a.rotate(Math.PI-e);a.lineTo(-5,-10);a.lineTo(0,-5);a.lineTo(5,-10);a.lineTo(0,0);a.fill();a.restore();a.closePath()};E.prototype.PointIsLineNear=function(a,c,b){a={start:d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,c,this.handles.end)};return 10>f(a,b)};E.prototype.PointIsPointNear=function(a,c,b){var e=this.GetHandlePoints(),e=k(a,c,e);this.index=a=m(b,e);return-1!==a?!0:!1};E.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.end);return a};E.prototype.Modify=function(a,c){switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=c;break;case 1:this.handles.end.x+=a;this.handles.end.y+=c;break;default:this.handles.start.x+=a,this.handles.start.y+=c,this.handles.end.x+=a,this.handles.end.y+=c}};G.prototype.Draw=function(a,c,b){var e=F.getColorIfActive(this.active||this.textBox.active),f={start:d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),center:d.ImageProcessor.PixelToCanvas(a,c,this.handles.center),end:d.ImageProcessor.PixelToCanvas(a,c,this.handles.end)};b.strokeStyle=e;b.fillStyle=e;if(0!==this.handles.center.x&&0!==this.handles.center.y&&0===this.handles.end.x&&0===this.handles.end.y)b.beginPath(),b.moveTo(f.start.x,f.start.y),b.lineTo(f.center.x,f.center.y),b.stroke();else{this.DrawAngle(b,f);if(this.active){var m=this.GetHandlePoints(),m=k(a,c,m);l(b,m)}if(!this.textBox.hasMoved){var f=this.GetHandlePoints(),n=Math.min(f[0].x,f[1].x,f[2].x),p=Math.max(f[0].x,f[1].x,f[2].x),m=n+(p-n>>1);a.hflip?(this.textBox.bRight=m>a.image.col>>1,this.textBox.x=this.textBox.bRight?n:p):(this.textBox.bRight=m<a.image.col>>1,this.textBox.x=this.textBox.bRight?p:n);var r=this;f.forEach(function(a){a.x===r.textBox.x&&(r.textBox.y=a.y)})}f=d.ImageProcessor.PixelToCanvas(a,c,this.textBox);n=this.angle.toFixed(2)+" \u00b0";this.textBox.bRight?f.x+=8:(p=b.measureText(n),f.x-=p.width);n=g(b,n,f.x,f.y,e);this.textBox.boundingBox=n;this.textBox.hasMoved&&(m={},p={},m=this.GetHandlePoints(),m=k(a,c,m),p.x=f.x,p.y=f.y,m=h(m,p),p=h([{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}],m),b.save(),b.beginPath(),b.strokeStyle=e,b.setLineDash([2,3]),b.moveTo(m.x,m.y),b.lineTo(p.x,p.y),b.stroke(),b.restore())}};G.prototype.DrawAngle=function(a,b){var e=b.start.x,d=b.start.y,f=b.center.x,g=b.center.y,h=b.end.x,k=b.end.y;a.save();a.translate(.5,.5);a.beginPath();a.moveTo(e,d);a.lineTo(f,g);a.moveTo(e,d);a.lineTo(h,k);var l=b.start,k=b.center,m=b.end,h=k.x-l.x,k=k.y-l.y,n=m.x-l.x,l=m.y-l.y,m=Math.sqrt(Math.pow(h,2)+Math.pow(k,2)),p=Math.sqrt(Math.pow(n,2)+Math.pow(l,2)),h=0<h/m*(l/p)-n/p*(k/m)?!0:!1,k=this.angle;this.invalid&&(m=b.start,n=b.center,l=b.end,k=c(m,n),m=c(m,l),n=c(n,l),0==k||0==m?k=0:(k=(k*k-n*n+m*m)/(2*k*m),-1>k?k=-1:1<k&&(k=1),k=57.29578*Math.acos(k)),this.angle=k,this.invalid=!1);k*=.0174532;f=(g-d)/(f-e);0>=g-d?0>=f?(f=Math.abs(f),g=2*Math.PI-Math.atan(f)):g=Math.PI+Math.atan(f):0>f?(f=Math.abs(f),g=Math.PI-Math.atan(f)):g=Math.atan(f);f=c(b.start,b.center);b=c(b.start,b.end);b=Math.min(f,b)/6;30<b&&(b=30);a.moveTo(e,d);h?a.arc(e,d,b,g,g+k,!1):a.arc(e,d,b,g,g-k,!0);a.stroke();a.restore()};G.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.center);a.push(this.handles.end);return a};G.prototype.PointIsLineNear=function(a,c,b){var e={start:d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,c,this.handles.center)},e=f(e,b);if(10>e)return!0;e={start:d.ImageProcessor.PixelToCanvas(a,c,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,c,this.handles.end)};e=f(e,b);return 10>e?!0:!1};G.prototype.PointIsPointNear=function(a,c,b){var e=this.GetHandlePoints(),e=k(a,c,e);this.index=a=m(b,e);return-1!==a?!0:!1};G.prototype.PointIsInTextBox=function(a,c,b,e){a=p(c,b,e);return n(a,this.textBox.boundingBox)};G.prototype.Modify=function(a,c){var b=!0;if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=c;else{switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=c;break;case 1:this.handles.center.x+=a;this.handles.center.y+=c;break;case 2:this.handles.end.x+=a;this.handles.end.y+=c;break;default:this.handles.start.x+=a,this.handles.start.y+=c,this.handles.center.x+=a,this.handles.center.y+=c,this.handles.end.x+=a,this.handles.end.y+=c,b=!1}this.invalid=b}};M.prototype.Draw=function(a,c,b){var e=F.getColorIfActive(this.textBox.active);b.fillStyle=e;a=d.ImageProcessor.PixelToCanvas(a,c,this.textBox);b=g(b,this.text,a.x,a.y,e);this.textBox.boundingBox=b};M.prototype.PointIsInTextBox=function(a,c,b,e){a=p(c,b,e);return n(a,this.textBox.boundingBox)};M.prototype.Modify=function(a,c){this.textBox.active&&(this.textBox.x+=a,this.textBox.y+=c)};J.prototype.Draw=function(a,b,e){var f=F.getColorIfActive(this.active);e.fillStyle=f;e.strokeStyle=f;var f=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),g=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);a=f.x+g.x>>1;b=f.y+g.y>>1;f=c(f,g)>>1;this.DrawLR(e,{x:a,y:b},f,this.type)};J.prototype.DrawLR=function(a,c,b,e){a.beginPath();a.arc(c.x,c.y,b,0,2*Math.PI);a.stroke();a.save();a.font=b+"px lighter";b=a.measureText("L").width>>1;"l"===e?a.fillText("L",c.x-b,c.y+b):a.fillText("R",c.x-b,c.y+b);a.restore()};J.prototype.PointIsLineNear=function(a,b,e){var f=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start);a=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);b=c(f,a)>>1;return c(e,{x:f.x+a.x>>1,y:f.y+a.y>>1})<=b};J.prototype.Modify=function(a,c){this.handles.start.x+=a;this.handles.start.y+=c;this.handles.end.x+=a;this.handles.end.y+=c};H.prototype.Draw=function(a,b,e){var f=F.getColorIfActive(this.active||this.textBox.active),m=d.ImageProcessor.PixelToCanvas(a,b,this.topline.start),n=d.ImageProcessor.PixelToCanvas(a,b,this.topline.end),p=d.ImageProcessor.PixelToCanvas(a,b,this.downline.start),r=d.ImageProcessor.PixelToCanvas(a,b,this.downline.end),A=m.x+n.x>>1,t=m.y+n.y>>1,H=p.x+r.x>>1,v=p.y+r.y>>1;e.beginPath();e.strokeStyle=f;e.moveTo(m.x,m.y);e.lineTo(n.x,n.y);e.stroke();e.beginPath();e.save();e.setLineDash([2,3]);e.moveTo(A,t);e.lineTo(H,v);e.stroke();e.restore();e.beginPath();e.moveTo(p.x,p.y);e.lineTo(r.x,r.y);e.stroke();this.active&&(r=this.GetHandlePoints(),r=k(a,b,r),l(e,r));this.invalid&&(m=c(this.topline.start,this.topline.end),n=c(this.downline.start,this.downline.end),this.ratio=m/n,this.invalid=!1);m="ratio: "+this.ratio.toFixed(2);this.textBox.hasMoved||(n=Math.min(this.topline.start.x,this.topline.end.x,this.downline.start.x,this.downline.end.x),p=Math.max(this.topline.start.x,this.topline.end.x,this.downline.start.x,this.downline.end.x),r=Math.min(this.topline.start.y,this.topline.end.y,this.downline.start.y,this.downline.end.y),A=Math.max(this.topline.start.y,this.topline.end.y,this.downline.start.y,this.downline.end.y),t=n+p>>1,a.hflip?(this.textBox.bRight=t>a.image.col>>1,this.textBox.x=this.textBox.bRight?n:p):(this.textBox.bRight=n<a.image.col>>1,this.textBox.x=this.textBox.bRight?p:n),this.textBox.y=a.vflip?A:r);n=d.ImageProcessor.PixelToCanvas(a,b,this.textBox);this.textBox.bRight?n.x+=8:(p=e.measureText(m),n.x=n.x-p.width-8);e.fillStyle=f;m=g(e,m,n.x,n.y,f);this.textBox.boundingBox=m;this.textBox.hasMoved&&(p={},r=this.GetHandlePoints(),r=k(a,b,r),p.x=n.x,p.y=n.y,a=h(r,p),p=h([{x:m.left+m.width/2,y:m.top},{x:m.left,y:m.top+m.height/2},{x:m.left+m.width/2,y:m.top+m.height},{x:m.left+m.width,y:m.top+m.height/2}],a),e.save(),e.beginPath(),e.strokeStyle=f,e.setLineDash([2,3]),e.moveTo(a.x,a.y),e.lineTo(p.x,p.y),e.stroke(),e.restore())};H.prototype.GetHandlePoints=function(){var a=[];a.push(this.topline.start);a.push(this.topline.end);a.push(this.downline.end);a.push(this.downline.start);return a};H.prototype.PointIsLineNear=function(a,c,b){var e={start:d.ImageProcessor.PixelToCanvas(a,c,this.topline.start),end:d.ImageProcessor.PixelToCanvas(a,c,this.topline.end)},e=f(e,b);if(10>e)return this.lineIndex=0,!0;e={start:d.ImageProcessor.PixelToCanvas(a,c,this.downline.start),end:d.ImageProcessor.PixelToCanvas(a,c,this.downline.end)};e=f(e,b);return 10>e?(this.lineIndex=1,!0):!1};H.prototype.PointIsPointNear=function(a,c,b){var e=this.GetHandlePoints(),e=k(a,c,e);this.index=a=m(b,e);return-1!==a?!0:!1};H.prototype.PointIsInTextBox=function(a,c,b,e){a=p(c,b,e);return n(a,this.textBox.boundingBox)};H.prototype.Modify=function(a,c){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=c;else{switch(this.index){case 0:this.topline.start.x+=a;this.topline.start.y+=c;break;case 1:this.topline.end.x+=a;this.topline.end.y+=c;break;case 2:this.downline.end.x+=a;this.downline.end.y+=c;break;case 3:this.downline.start.x+=a;this.downline.start.y+=c;break;default:0===this.lineIndex?(this.topline.start.x+=a,this.topline.start.y+=c,this.topline.end.x+=a,this.topline.end.y+=c):1===this.lineIndex&&(this.downline.end.x+=a,this.downline.end.y+=c,this.downline.start.x+=a,this.downline.start.y+=c)}this.invalid=!0}};d.Annotation={NewAIAnnotation:function(a,c,b,e,d){var f;switch(b){case "probe":f=new u;f.handles.end=pt;b=t(c);f.Draw(a,c,b);break;case "line":f=new x;f.handles.start=pt;break;case "rect":return f=new A,f.handles.start=e,f.handles.end=d,f.id=a.image.id,f.invalid=!0,f;case "ellipse":f=new z;f.handles.start=pt;f.id=a.image.id;break;case "arrow":f=new E;f.handles.start=pt;break;case "angle":f=C.GetNewAnn();void 0===f?(f=new G,f.handles.start=pt,f.createHitNums++):1===f.createHitNums?(f.handles.center=pt,f.createHitNums++):2===f.createHitNums&&(f.handles.end=pt,f.createHitNums=0);break;case "text":f=new M;f.textBox.x=pt.x;f.textBox.y=pt.y;if(""!==f.text&&null!==f.text)return b=t(c),f.Draw(a,c,b),f;break;case "l":case "r":f=new J(b);f.handles.start=pt;break;case "heartratio":f=new H(b),f.topline.start=pt}C.SetNewAnn(f)},NewAnnotation:function(a,c,b,e,f){var g;e=d.ImageProcessor.PageToPixel(a,c,e,f);switch(b){case "probe":g=new u;g.handles.end=e;b=t(c);g.Draw(a,c,b);break;case "line":g=new x;g.handles.start=e;break;case "rect":g=new A;g.handles.start=e;g.id=a.image.id;break;case "ellipse":g=new z;g.handles.start=e;g.id=a.image.id;break;case "arrow":g=new E;g.handles.start=e;break;case "angle":g=C.GetNewAnn();void 0===g?(g=new G,g.handles.start=e,g.createHitNums++):1===g.createHitNums?(g.handles.center=e,g.createHitNums++):2===g.createHitNums&&(g.handles.end=e,g.createHitNums=0);break;case "text":g=new M;g.textBox.x=e.x;g.textBox.y=e.y;if(""!==g.text&&null!==g.text)return b=t(c),g.Draw(a,c,b),g;break;case "l":case "r":g=new J(b);g.handles.start=e;break;case "heartratio":g=new H(b),g.topline.start=e}C.SetNewAnn(g)},UnfinishedAnn:function(a,c,b,e,f,g){var h=C.GetNewAnn();if(void 0===h)return!1;d.ImageProcessor.DrawGrayImage(a,c);b=d.Annotation.DrawAnnotation(a,c,b);f=d.ImageProcessor.PageToPixel(a,c,f,g);switch(e){case "heartratio":h.topline.end.x=f.x;h.topline.end.y=h.topline.start.y;h.downline.start.x=h.topline.start.x;h.downline.start.y=f.y;h.downline.end=f;h.invalid=!0;h.Draw(a,c,b);break;case "r":case "l":case "arrow":case "ellipse":case "probe":case "rect":case "line":h.handles.end=f;h.invalid=!0;h.Draw(a,c,b);break;case "angle":1===h.createHitNums?h.handles.center=f:2===h.createHitNums&&(h.handles.end=f),h.invalid=!0,h.Draw(a,c,b)}return!0},GetMaybeSaveAnn:function(a,b,e){b=C.GetNewAnn();if(void 0!==b)switch(a){case "probe":return C.SetNewAnn(),b;case "line":C.SetNewAnn();if(1<b.length)return b;break;case "ellipse":case "rect":C.SetNewAnn();if(1<b.area)return b.CorrectPoint&&b.CorrectPoint(),b;break;case "l":case "r":case "arrow":C.SetNewAnn();if(2<c(b.handles.start,b.handles.end)&&(0!==b.handles.end.x||0!==b.handles.end.y))return b;break;case "angle":if(0!==b.handles.end.x||0!==b.handles.end.y)if(C.SetNewAnn(),1<b.angle)return b;break;case "heartratio":if(C.SetNewAnn(),0!==b.topline.start.x&&0!==b.topline.start.y&&0!==b.downline.start.x&&0!==b.downline.start.y)return b}},DrawAnnotation:function(a,c,b){for(var e=t(c),d=0;d<b.length;d++)b[d].Draw(a,c,e);return e},ScanHoverAnnotation:function(a,c,b,e,f){if(b instanceof Array&&!(1>b.length)){e=p(c,e,f);var g;f=!1;for(var h=0;h<b.length;h++){var k=b[h];k.PointIsPointNear&&(k.PointIsPointNear(a,c,e)&&void 0===g?(g=k,f=k.active=!0):k.active=!1);k.textBox&&(k.textBox.active=!1)}if(void 0===g)for(h=0;h<b.length;h++)k=b[h],k.PointIsLineNear&&(k.PointIsLineNear(a,c,e)&&void 0===g?(k.active=!0,g=k):k.active=!1);f?c.style.cursor="pointer":"default"!==c.style.cursor&&(c.style.cursor="default");e=C.GetRecordAnn();g!==e&&(d.ImageProcessor.DrawGrayImage(a,c),this.DrawAnnotation(a,c,b),C.SetRecordAnn(g))}},ScanClickTextBox:function(a,c,b,e,f){if(b instanceof Array&&!(1>b.length)){for(var g,h=0;h<b.length;h++){var k=b[h];k.PointIsInTextBox&&(k.PointIsInTextBox(a,c,e,f)&&void 0===g?(k.textBox.active=!0,g=k):k.textBox.active=!1)}e=C.GetRecordAnn();if(g!==e)return d.Draw.DrawImage(a,c),c.getContext("2d"),this.DrawAnnotation(a,c,b),C.SetRecordAnn(g),g}},ActiveAnnotation:function(a){for(var c=0;c<a.length;c++){var b=a[c];if(b.active||b.textBox&&b.textBox.active)return C.SetModifyAnn(b),!0}return!1},MaybeModifyActiveAnn:function(a,c,b,e,f,g,h){var k=C.GetModifyAnn();if(void 0===k)return!1;d.Draw.DrawImage(a,c);e=d.ImageProcessor.PageToPixel(a,c,e,f);h=d.ImageProcessor.PageToPixel(a,c,g,h);g=h.x-e.x;h=h.y-e.y;k.Modify&&k.Modify(g,h);this.DrawAnnotation(a,c,b);return!0},MaybeServerModifyActiveAnn:function(a,c,b,e,f,g,h){var k=C.GetModifyAnn();if(void 0===k)return!1;d.Draw.DrawImage(a,c);e=d.ImageProcessor.PageToPixel(a,c,e,f);h=d.ImageProcessor.PageToPixel(a,c,g,h);g=h.x-e.x;h=h.y-e.y;k.ServerModify&&k.ServerModify(g,h);this.DrawAnnotation(a,c,b);return!0},MaybeEndModifyAnn:function(){var a=C.GetModifyAnn();void 0!==a&&a.CorrectPoint&&a.CorrectPoint();C.SetModifyAnn()},Distance:c,PageCoods2Canvas:p,ServerGetMaybeSaveAnn:function(a,b,e,f){var g=$.Deferred();if(void 0===f)return g;switch(a){case "probe":return C.SetNewAnn(),f;case "line":C.SetNewAnn();if(1<f.length)return f;break;case "ellipse":C.SetNewAnn();a=d.Draw.GetWadoUrl()+"/GetMeasureData";$.ajax({url:a,type:"get",data:{id:f.id,type:"ellipse",left:f.ellipse.left,top:f.ellipse.top,width:f.ellipse.width,height:f.ellipse.height},dataType:"json",complete:function(a){return 200==a.status&&a.responseJSON?(a=a.responseJSON.data,f.meanStdDev={count:a.count,mean:a.mean,variance:a.stdDev,stdDev:a.variance},g.resolve(f)):g.reject()}});break;case "rect":C.SetNewAnn();a=d.Draw.GetWadoUrl()+"/GetMeasureData";$.ajax({url:a,type:"get",data:{id:f.id,type:"Rect",left:f.ellipse.left,top:f.ellipse.top,width:f.ellipse.width,height:f.ellipse.height},complete:function(a){return 200==a.status&&a.responseJSON?(a=a.responseJSON.data,f.meanStdDev={count:a.count,mean:a.mean,variance:a.stdDev,stdDev:a.variance},g.resolve(f)):g.reject()}});break;case "l":case "r":case "arrow":C.SetNewAnn();if(2<c(f.handles.start,f.handles.end)&&(0!==f.handles.end.x||0!==f.handles.end.y))return f;break;case "angle":if(0===f.handles.end.x&&0===f.handles.end.y)return;C.SetNewAnn();if(1<f.angle)return f;break;case "heartratio":if(C.SetNewAnn(),0!==f.topline.start.x&&0!==f.topline.start.y&&0!==f.downline.start.x&&0!==f.downline.start.y)return f}return g},ServerHoverAnnotation:function(a,c,b,e,d){if(b instanceof Array&&!(1>b.length)){e=p(c,e,d);var f;for(d=0;d<b.length;d++){var g=b[d];if(g.PointIsPointNear&&g.PointIsPointNear(a,c,e)&&void 0===f)return f=g}if(void 0===f)for(d=0;d<b.length;d++)if(g=b[d],g.PointIsLineNear&&g.PointIsLineNear(a,c,e)&&void 0===f)return f=g}}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function b(a,c,b,h){var e=[];a instanceof Array?e=a:e.push(a);a={images:e,viewport:d.ImageProcessor.GetDefaultStatus(),anns:{},compare:!1,studyuid:c,type:b};a.viewport.image=e[0];h||f.push(a);return a}function a(a){if(a instanceof Function)for(var c=0;c<f.length;c++)a(f[c],c)}var f=[];d.AnnStatusManager={Create:b,Get:function(a){if(void 0===a)return f;if(a instanceof Number)return f[a]},Set:function(b){if(b instanceof Object){2>b.status.ww&&(b.status.ww=2);.01>b.status.scale&&(b.status.scale=.01);if(360===b.status.rotation||-360===b.status.rotation)b.status.rotation=0;a(function(a,e){a===b&&(f[e]=b)})}},Clear:function(){f=[]},Delete:function(b){var c=0;a(function(a,d){a===b&&(f.splice(d,1),c=d)});return c},Replace:function(d,c,e,h){var g;a(function(a,l){a===d&&(g=f[l]=b(c,e,h,!0))});void 0===g&&(g=b(c,e,h));return g},GetIndex:function(b){if(void 0!==b){var c;a(function(a,d){a===b&&(c=d)});return c}},IsExist:function(b){var c=!1;a(function(a){a.images.forEach(function(a){b.id==a.id&&(c=!0)})});return c}}}(CBoBo);function ImageStatus(){this.image;this.contrast=this.brightness=0;this.Negative=!1;this.scaledHeight=this.scaledWidth=0;this.ptMove={x:0,y:0};this.rotateState=0;this.pseudoColor=null;this.bDrawText=!0}ImageStatus.prototype.GetBrightness=function(){return this.brightness};ImageStatus.prototype.GetContrast=function(){return this.contrast};ImageStatus.prototype.SetBriCon=function(d,b){this.brightness=d;this.contrast=b};ImageStatus.prototype.SetImage=function(d){this.image=d};ImageStatus.prototype.GetImage=function(){return this.image};ImageStatus.prototype.GetImageSize=function(){if(void 0!=this.image){var d={};d.width=this.image.image.width;d.height=this.image.image.height;return d}};ImageStatus.prototype.ZoomImage=function(d,b){this.scaledWidth=d;this.scaledHeight=b};ImageStatus.prototype.Restore=function(){this.rotateState=this.contrast=this.brightness=0;this.ptMove={x:0,y:0};this.Negative=!1;this.pseudoColor=null;return this};ImageStatus.prototype.GetZoomRatio=function(){if(void 0!=this.image){var d=this.image.image.height;if(!(0>=d))return this.scaledHeight/d}};ImageStatus.prototype.GetMovePoint=function(){return this.ptMove};ImageStatus.prototype.MoveImage=function(d){this.ptMove.x=d.x>>0;this.ptMove.y=d.y>>0};ImageStatus.prototype.SetNegative=function(d){this.Negative=d};ImageStatus.prototype.GetNegative=function(){return this.Negative};ImageStatus.prototype.SetPseudoColor=function(d,b,a){this.pseudoColor=void 0==d||void 0==b||void 0==a?void 0:{red:d,green:b,blue:a}};ImageStatus.prototype.GetPseudoColor=function(){return this.pseudoColor};ImageStatus.prototype.FitCanvas=function(d){if(void 0==this.image||!this.image.bLoaded||void 0==d)return this;var b=d.GetCanvas();d=this.GetImageSize();if(void 0!=d)return b=Math.min(b.width/d.width,b.height/d.height),this.ZoomImage(b*d.width>>0,b*d.height>>0),this};ImageStatus.prototype.DrawImg=function(d){void 0!=d&&(void 0!=this.image?this.image.bLoaded?(d.bStop||d.StopLoadingAnimation(),d.drawlock&&(d.drawlock=!1,d.imgProcessWorker.postMessage({type:2,brightness:this.brightness,contrast:this.contrast,pseudocolor:this.pseudoColor,nagative:this.Negative}))):d.StartLoadingAnimation():d.canvas.getContext("2d").clearRect(0,0,d.canvas.width,d.canvas.height))};ImageStatus.prototype.DrawText=function(d){if(this.bDrawText){var b=d.GetCanvas(),a=b.width<b.height?b.width:b.height,a=a/55>>0;10>a&&(a=10);d=b.getContext("2d");d.fillStyle="#fff";d.textBaseline="middle";d.textAlign="right";d.font=a+"px lighter";d.shadowColor="#000";d.shadowOffsetX=1;d.shadowOffsetY=1;a=d.measureText("\u5b57").width;b=CBoBo.Plugin.SetDrawTextCoord(b.width,b.height,0,0,3,0,a);index=0;d.fillText("\u5bf9\u6bd4\u5ea6:"+this.GetContrast(),b.rb[index].x,b.rb[index].y);index++;d.fillText(" \u4eae\u5ea6:"+this.GetBrightness(),b.rb[index].x,b.rb[index].y);index++;a=this.GetZoomRatio();void 0!=a&&d.fillText("\u653e\u7f29\u500d\u6570:"+a.toFixed(2),b.rb[index].x,b.rb[index].y)}};ImageStatus.prototype.SetDrawTextFlag=function(d){this.bDrawText=d};plain_blue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_red=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_inverse_blue=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];plain_inverse_green=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];plain_inverse_red=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];rainbow_blue=[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3];rainbow_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];blackbody_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255];blackbody_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];blackbody_red=[0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];bones_blue=[0,0,0,0,1,1,1,2,2,2,2,3,3,3,4,4,4,4,5,5,5,6,6,6,6,7,7,7,8,8,8,9,9,9,9,10,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,15,15,15,16,16,16,16,17,17,17,18,18,18,18,19,19,19,20,20,20,20,21,21,21,22,22,22,23,23,23,23,24,24,24,25,25,25,25,26,26,26,27,27,27,27,28,28,28,29,29,29,29,30,30,30,31,31,31,32,32,32,32,33,33,33,34,34,34,34,35,35,35,36,36,36,36,36,37,37,37,37,37,38,38,38,38,39,39,39,39,39,40,40,40,40,40,41,41,41,41,42,42,42,42,42,43,43,43,43,44,44,44,44,44,45,45,45,45,45,46,46,46,46,47,47,47,47,47,48,48,48,48,48,49,49,49,49,50,50,50,50,50,51,51,51,51,51,52,52,52,53,53,53,54,54,54,55,55,55,56,56,56,56,57,57,57,58,58,58,59,59,59,60,60,60,61,61,61,62,62,62,63,63,63,64,64,64,65,65,65,66,66,66,67,84,101,118,135,152,169,186,203,220,237];bones_green=[0,1,2,3,4,6,7,8,9,11,12,13,14,16,17,18,19,20,22,23,24,25,27,28,29,30,32,33,34,35,37,38,39,40,41,43,44,45,46,48,49,50,51,53,54,55,56,57,59,60,61,62,64,65,66,67,69,70,71,72,74,75,76,77,78,80,81,82,83,85,86,87,88,90,91,92,93,94,96,97,98,99,101,102,103,104,106,107,108,109,111,112,113,114,115,117,118,119,120,122,123,124,125,127,128,129,130,131,133,134,135,136,138,139,140,141,143,144,145,146,148,149,150,151,152,153,153,154,154,155,156,156,157,158,158,159,160,160,161,162,162,163,164,164,165,166,166,167,168,168,169,170,170,171,172,172,173,174,174,175,175,176,177,177,178,179,179,180,181,181,182,183,183,184,185,185,186,187,187,188,189,189,190,191,191,192,193,193,194,195,195,196,196,197,198,198,199,200,200,201,202,203,204,205,206,207,208,209,210,211,213,214,215,216,217,218,219,220,221,222,223,224,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,251,252,252,252,253,253,253,254,254];bones_red=[0,1,3,5,7,8,10,12,14,15,17,19,21,22,24,26,28,29,31,33,35,37,38,40,42,44,45,47,49,51,52,54,56,58,59,61,63,65,67,68,70,72,74,75,77,79,81,82,84,86,88,89,91,93,95,96,98,100,102,104,105,107,109,111,112,114,116,118,119,121,123,125,126,128,130,132,134,135,137,139,141,142,144,146,148,149,151,153,155,156,158,160,162,164,165,167,169,171,172,174,176,178,179,181,183,185,186,188,190,192,193,195,197,199,201,202,204,206,208,209,211,213,215,216,217,217,218,218,219,219,220,220,221,221,222,222,223,223,224,224,225,225,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,244,244,245,245,246,246,247,247,248,248,249,249,250,250,251,251,252,252,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];cardiac_blue=[3,12,20,29,37,46,54,63,71,80,88,97,105,114,122,131,139,146,154,161,168,175,183,190,197,204,212,219,226,233,241,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,252,250,249,247,246,244,243,241,239,238,236,235,233,232,230,229,227,226,224,223,221,220,218,217,215,214,212,211,209,208,206,203,201,198,196,193,191,188,186,183,180,178,175,173,170,168,165,163,161,159,157,155,153,151,149,146,144,142,140,138,136,134,132,127,123,118,113,109,104,99,95,90,85,80,76,71,66,62,57,53,50,46,43,39,36,32,29,25,21,18,14,11,7,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,3,4,5,5,6,7,8,8,9,10,11,11,12,11,11,10,10,9,9,8,8,7,6,6,5,5,4,3];cardiac_green=[193,195,197,198,200,202,204,206,208,209,211,213,215,217,218,220,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,216,211,205,200,194,188,183,177,171,166,160,155,149,143,138,132,128,125,121,118,114,110,107,103,99,96,92,89,85,81,78,74,70,67,63,60,56,52,49,45,41,38,34,31,27,23,20,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,17,19,21,23,25,27,29,31,33,37,41,45,50,54,58,62,66,70,74,78,83,87,91,95,99,103,107,111,116,120,124,128,132,136,140,144,149,153,157,161,165,170,174,179,184,188,193,197,202,207,211,216,221,225,230,234,239,238,237,236,235,234,233,232,231,229,228,227,226,225,224,223,222,220,218,217,215,213,211,209,208,206,204,202,200,198,197,193];cardiac_red=[73,72,70,69,68,66,65,63,62,61,59,58,57,55,54,52,51,48,45,41,38,35,32,29,26,22,19,16,13,10,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,21,22,22,23,24,25,25,26,27,28,28,29,30,31,31,32,36,39,43,47,50,54,57,61,65,68,72,76,79,83,86,90,95,99,104,109,113,118,123,128,132,137,142,146,151,156,160,165,169,172,176,179,183,186,190,194,197,201,204,208,211,215,218,222,224,226,228,230,232,234,236,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,236,231,226,221,216,211,206,201,197,192,187,182,177,171,164,158,151,145,138,132,125,119,112,106,99,93,86,73];flow_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,251,247,244,240,236,232,228,225,221,217,213,209,206,202,198,194,190,186,183,179,175,171,167,164,160,156,152,148,145,141,137,133,129,126,122,118,114,110,107,103,99,95,91,88,84,80,76,72,69,65,61,57,53,49,46,42,38,34,30,27,23,19,15,11,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255];flow_green=[200,197,194,191,188,185,182,179,176,173,170,167,164,161,158,155,152,149,146,143,140,137,134,131,128,125,122,119,116,113,110,107,104,101,98,95,92,89,86,83,80,77,74,71,68,65,62,59,56,53,50,47,44,41,38,35,32,29,26,23,20,20,20,19,19,19,19,18,18,18,17,17,17,16,16,16,16,15,15,15,14,14,14,13,13,13,13,12,12,12,11,11,11,10,10,10,10,9,9,9,8,8,8,7,7,7,7,6,6,6,5,5,5,4,4,4,4,3,3,3,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,10,14,18,22,26,30,34,38,42,46,50,54,58,62,66,70,74,78,82,86,90,94,98,102,106,110,114,118,122,126,130,134,138,142,146,150,154,158,162,166,170,174,178,182,186,190,194,198,202,206,210,214,218,222,226,230,234,238,242,246,250,255];flow_red=[32,32,32,32,31,31,31,31,31,30,30,30,30,30,29,29,29,29,29,28,28,28,28,28,27,27,27,27,27,26,26,26,26,26,25,25,25,25,25,24,24,24,24,24,23,23,23,23,23,22,22,22,22,22,21,21,21,21,21,20,20,20,20,19,19,19,19,18,18,18,17,17,17,16,16,16,16,15,15,15,14,14,14,13,13,13,13,12,12,12,11,11,11,10,10,10,10,9,9,9,8,8,8,7,7,7,7,6,6,6,5,5,5,4,4,4,4,3,3,3,2,2,2,1,1,1,1,0,0,0,4,8,12,16,20,24,28,32,36,40,45,49,53,57,61,65,69,73,77,81,85,89,93,97,101,105,109,113,117,121,125,130,134,138,142,146,150,154,158,162,166,170,174,178,182,186,190,194,198,202,206,210,215,219,223,227,231,235,239,243,247,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];ge_color_blue=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,252,248,244,240,236,232,228,224,220,216,212,208,204,200,196,192,188,184,180,176,172,168,164,160,156,152,148,144,140,136,132,128,124,120,116,112,108,104,100,96,92,88,84,80,76,72,68,64,60,56,52,48,44,40,36,32,28,24,20,16,12,8,4,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,85,89,93,97,101,105,109,113,117,121,125,129,133,137,141,145,149,153,157,161,165,170,174,178,182,186,190,194,198,202,206,210,214,218,222,226,230,234,238,242,246,250,255];ge_color_green=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,63,61,59,57,55,53,51,49,47,45,43,41,39,37,35,33,31,29,27,25,23,21,19,17,15,13,11,9,7,5,3,1,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255];ge_color_red=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];gray_rainbow_blue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,255,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,255,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,255,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,255,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,255,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,255,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,205,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,125,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,45,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,0,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,0,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,0,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,0,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,0,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,0,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];gray_rainbow_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,0,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,145,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,225,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,255,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,255,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,255,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,255,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,255,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,255,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,235,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,155,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,75,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];gray_rainbow_red=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,175,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,95,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,15,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,0,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,0,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,0,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,0,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,35,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,115,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,195,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,255,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,255,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,255,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];hot_green_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,10,13,16,20,23,26,30,33,37,40,43,47,50,53,57,60,64,67,70,74,77,80,84,87,90,94,97,101,104,107,111,114,117,121,124,128,131,134,138,141,144,148,151,154,158,161,165,168,171,175,178,181,185,188,192,195,198,202,205,208,212,215,218,222,225,229,232,235,239,242,245,249,252];hot_green_green=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,25,27,28,30,31,33,34,36,37,39,40,42,43,45,46,48,49,51,52,54,55,57,58,60,61,63,64,66,67,69,70,72,73,75,76,78,79,81,82,84,85,87,88,90,91,93,94,96,97,99,100,102,103,105,106,108,109,111,112,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,136,138,139,141,142,144,145,147,148,150,151,153,154,156,157,159,160,162,163,165,166,168,169,171,172,174,175,177,178,180,181,183,184,186,187,189,190,192,193,195,196,198,199,201,202,204,205,207,208,210,211,213,214,216,217,219,220,222,223,225,226,228,229,231,232,234,235,237,238,240,241,243,244,246,247,249,250,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_green_red=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,8,10,12,14,16,17,19,21,23,24,26,28,30,32,33,35,37,39,40,42,44,46,48,49,51,53,55,56,58,60,62,64,65,67,69,71,72,74,76,78,80,81,83,85,87,88,90,92,94,96,97,99,101,103,104,106,108,110,112,113,115,117,119,120,122,124,126,128,129,131,133,135,136,138,140,142,144,145,147,149,151,152,154,156,158,160,161,163,165,167,168,170,172,174,176,177,179,181,183,184,186,188,190,192,193,195,197,199,200,202,204,206,208,209,211,213,215,216,218,220,222,224,225,227,229,231,232,234,236,238,240,241,243,245,247,248,250,252,254];hot_iron_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255];hot_iron_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255];hot_iron_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_metal_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,7,11,15,19,23,27,31,35,39,43,47,51,55,59,63,67,71,75,79,83,87,91,95,99,103,107,111,115,119,123,127,131,135,139,143,147,151,155,159,163,167,171,175,179,183,187,191,195,199,203,207,211,215,219,223,227,231,235,239,243,247,251];hot_metal_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,5,8,11,14,16,19,22,25,28,30,33,36,39,42,44,47,50,53,56,58,61,64,67,70,72,75,78,81,84,86,89,92,95,98,100,103,106,109,112,114,117,120,123,126,128,131,134,137,140,142,145,148,151,154,156,159,162,165,168,170,173,176,179,182,184,187,190,193,196,198,201,204,207,210,212,215,218,221,224,226,229,232,235,238,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_metal_red=[0,1,2,4,5,7,8,9,11,12,14,15,16,18,19,21,22,23,25,26,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,60,61,63,64,65,67,68,70,71,72,74,75,77,78,79,81,82,84,85,86,88,89,91,92,93,95,96,98,99,100,102,103,105,106,107,109,110,112,113,114,116,117,119,120,121,123,124,126,127,128,130,131,133,134,135,137,138,140,141,142,144,145,147,148,149,151,152,154,155,156,158,159,161,162,163,165,166,168,169,170,172,173,175,176,177,179,180,182,183,184,186,187,189,190,191,193,194,196,197,198,200,201,203,204,205,207,208,210,211,212,214,215,217,218,219,221,222,224,225,226,228,229,231,232,233,235,236,238,239,240,242,243,245,246,247,249,250,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hue1_blue=[3,3,13,17,23,30,37,44,50,57,63,70,76,82,89,95,101,107,114,120,126,132,138,144,149,155,161,167,172,178,184,189,195,200,205,211,216,221,227,232,237,242,247,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,250,247,244,242,239,236,234,231,229,226,224,221,219,217,214,212,210,208,206,204,202,200,198,196,194,192,191,189,187,186,184,183,181,180,179,177,176,175,174,173,172,171,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,251];hue1_green=[0,0,1,2,3,4,5,6,7,8,9,13,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,87,92,97,102,107,111,116,121,125,130,134,139,143,147,152,156,160,164,168,172,176,180,184,188,192,196,199,203,207,210,214,217,221,224,228,231,234,238,241,244,247,250,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,251,250,249,249,248,247,247,246,246,246,245,245,245,245,244,244,244,244,244,244,245,245,245,245,246,246,246,247,247,248,249,249,250,251,251,251];hue1_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,247,242,237,233,228,223,219,214,210,205,201,196,192,188,184,179,175,171,167,163,159,155,151,147,144,140,136,133,129,125,122,118,115,112,108,105,102,99,95,92,89,86,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,172,175,177,180,183,186,188,191,194,196,199,201,203,206,208,210,213,215,217,219,221,223,225,227,229,230,232,234,236,237,239,240,242,243,245,246,247,248,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hue2_blue=[253,253,252,251,250,249,248,248,247,247,246,246,245,245,244,244,244,244,243,243,243,243,243,243,243,243,244,244,244,244,245,245,246,246,247,247,248,249,250,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,250,247,244,241,237,234,231,227,224,220,217,213,210,206,203,199,195,191,187,183,179,175,171,167,163,159,155,150,146,142,137,133,128,124,119,114,110,105,100,95,90,86,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,13,9,8,7,6,5,4,3,2,2];hue2_green=[253,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,169,169,170,171,172,173,174,176,177,178,180,181,183,184,186,188,189,191,193,195,197,199,201,203,205,207,209,211,214,216,218,221,223,226,228,231,233,236,239,241,244,247,250,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,247,242,237,232,226,221,216,211,205,200,194,189,183,178,172,166,160,155,149,143,137,131,125,119,113,107,100,94,88,81,75,69,62,56,49,42,36,29,29];hue2_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,249,248,247,246,244,243,241,240,238,237,235,233,231,230,228,226,224,222,220,218,216,213,211,209,207,204,202,199,197,194,192,189,187,184,181,178,175,172,170,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,85,84,84,88,91,94,97,100,103,107,110,114,117,121,124,128,131,135,139,143,146,150,154,158,162,166,170,174,179,183,187,191,196,200,205,209,214,218,223,228,233,237,242,247,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];ired_blue=[255,254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1];ired_green=[255,254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1];ired_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];jet_blue=[142,146,149,153,156,160,163,167,170,174,177,181,184,188,191,195,198,202,205,209,212,216,219,223,226,230,233,237,240,244,247,251,255,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,250,250,250,250,246,242,239,235,231,227,223,219,215,211,207,203,199,195,192,188,184,180,176,172,168,164,160,156,152,148,144,141,137,133,129,125,121,117,113,109,105,101,97,94,90,86,82,78,74,70,66,62,58,54,50,47,43,39,35,31,27,23,19,15,11,7,3,0,0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,12,12,11,11,11,11,11,10,10,10,10,10,9,9,9,9,9,8,8,8,8,8,7,7,7,7,7,6,6,6];jet_green=[5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,13,16,20,24,28,32,35,39,43,47,51,54,58,62,66,70,73,77,81,85,89,92,96,100,104,108,112,115,119,123,127,131,134,138,142,146,150,153,157,161,165,169,172,176,180,184,188,191,195,199,203,207,211,214,218,222,226,230,233,237,241,245,249,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,250,250,250,250,250,250,250,250,250,247,243,240,236,233,229,225,222,218,215,211,208,204,201,197,194,190,187,183,180,176,173,169,165,162,158,155,151,148,144,141,137,134,130,127,123,120,116,113,109,105,102,98,95,91,88,84,81,77,74,70,67,63,60,56,53,49,45,42,38,35,31,28,24,24,24,23,23,22,22,22,21,21,20,20,20,19,19,19,18,18,17,17,17,16,16,15,15,15,14,14,14,13,13,12];jet_red=[17,18,18,19,19,19,20,20,21,21,22,22,22,23,23,24,24,25,25,26,26,26,27,27,28,28,29,29,29,30,30,31,31,31,31,31,31,30,30,30,30,30,30,30,29,29,29,29,29,29,28,28,28,28,28,28,28,27,27,27,27,27,27,27,26,26,26,26,26,26,25,25,25,25,25,25,25,24,24,24,24,24,24,24,23,23,23,23,23,23,22,22,22,22,22,22,22,25,29,32,36,40,43,47,50,54,57,61,65,68,72,75,79,83,86,90,93,97,101,104,108,111,115,118,122,126,129,133,136,140,144,147,151,154,158,162,165,169,172,176,179,183,187,190,194,197,201,205,208,212,215,219,223,226,230,233,237,240,244,248,251,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,249,245,241,237,233,229,225,221,217,213,209,206,202,198,194,190,186,182,178,174,170,166,162,158,154,151,147,143,139,135,131];muscles_bones_blue=[0,0,0,0,1,1,1,2,2,2,2,3,3,3,4,4,4,5,5,5,5,6,6,6,7,7,7,7,8,8,8,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,13,13,14,14,14,15,15,15,15,16,16,16,17,17,17,17,18,18,18,19,19,19,20,20,20,20,21,21,21,22,22,22,22,23,23,23,24,24,24,25,25,25,25,26,26,26,27,27,27,27,27,27,26,26,26,25,25,25,24,24,24,23,23,22,22,22,21,21,21,20,20,20,19,19,19,18,18,18,17,17,16,16,16,15,15,15,14,14,14,13,13,13,12,12,11,11,11,10,10,10,9,9,10,10,11,11,12,12,13,13,14,15,15,16,16,17,17,18,18,19,19,20,21,21,22,22,23,23,24,24,25,26,26,27,27,28,28,29,29,30,31,31,32,32,33,33,34,34,35,36,36,37,37,38,38,39,43,47,51,55,58,62,66,70,74,78,82,86,90,94,98,102,105,109,113,117,121,125,129,133,137,141,145,149,153,156,160,164,168,172,176,180,184,188,192,196,200,204,207,211,215,219,223,227,231,235,239,243,247,251];muscles_bones_green=[0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,176,177,179,180,181,182,183,185,186,187,188,189,191,192,193,194,195,197,198,199,200,201,203,204,205,206,207,209,210,211,212,213,215,216,217,218,220,221,222,223,224,226,227,228,229,230,232,233,234,235,236,238,239,240,241,241,242,242,242,242,243,243,243,243,244,244,244,244,245,245,245,245,246,246,246,246,247,247,247,247,248,248,248,248,248,249,249,249,249,250,250,250,250,251,251,251,251,252,252,252,252,253,253,253,253,254,254,254,254];muscles_bones_red=[0,2,5,8,10,13,16,18,21,24,26,29,32,34,37,40,42,45,48,51,53,56,59,61,64,67,69,72,75,77,80,83,85,88,91,93,96,99,102,104,107,110,112,115,118,120,123,126,128,131,134,136,139,142,144,147,150,153,155,158,161,163,166,169,171,174,177,179,182,185,187,190,193,195,198,201,204,206,209,212,214,217,220,222,225,228,230,233,236,238,241,244,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];nih_blue=[0,11,22,34,45,56,68,79,90,102,113,124,136,147,158,170,164,159,154,148,143,138,132,127,122,116,111,106,100,95,90,85,90,95,100,106,111,116,122,127,132,138,143,148,154,159,164,170,175,180,185,191,196,201,207,212,217,223,228,233,239,244,249,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,249,244,239,233,228,223,217,212,207,201,196,191,185,180,175,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,159,148,138,127,116,106,95,85,74,63,53,42,31,21,10,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,79,74,69,63,58,53,47,42,37,31,26,21,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255];nih_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,90,95,100,106,111,116,122,127,132,138,143,148,154,159,164,170,175,180,185,191,196,201,207,212,217,223,228,233,239,244,249,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,249,244,239,233,228,223,217,212,207,201,196,191,185,180,175,170,164,159,154,148,143,138,132,127,122,116,111,106,100,95,90,85,81,78,75,71,68,65,62,58,55,52,49,45,42,39,35,32,29,26,22,19,16,13,9,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255];nih_red=[0,5,11,17,22,28,34,39,45,51,56,62,68,73,79,85,79,74,69,63,58,53,47,42,37,31,26,21,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,95,106,116,127,138,148,159,170,180,191,201,212,223,233,244,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,250,248,246,243,241,239,237,234,232,230,228,225,223,221,219,216,214,212,210,208,205,203,201,199,196,194,192,190,187,185,183,181,178,176,174,255,255];rainbow1_blue=[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow1_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3];rainbow1_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];rainbow2_blue=[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow2_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0];rainbow2_red=[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];rainbow3_blue=[255,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,250,247,241,238,232,229,223,220,214,211,205,202,196,193,187,184,178,175,169,166,160,157,151,148,142,139,133,130,125,121,116,112,107,103,98,94,89,85,80,76,71,67,62,58,53,49,44,40,35,31,26,22,17,13,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow3_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,6,11,15,20,24,29,33,38,42,47,51,56,60,65,69,74,78,83,87,92,96,101,105,110,114,119,122,128,131,137,140,146,149,155,158,164,167,173,176,182,185,191,194,200,203,209,212,218,221,227,230,236,240,245,249,254,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,252,247,243,238,234,229,225,220,216,211,207,202,198,193,189,184,180,175,171,166,162,157,153,148,144,139,135,131,126,122,117,113,108,104,99,95,90,86,81,77,72,68,63,59,54,50,45,41,36,32,27,23,18,14,9,5,5];rainbow3_red=[124,124,120,115,111,106,102,97,93,88,84,79,75,70,66,61,57,52,48,43,39,34,30,25,21,16,12,7,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,5,13,14,19,23,28,32,37,41,46,50,55,59,64,68,73,77,82,86,91,95,100,104,109,113,118,123,126,132,135,141,144,150,153,159,162,168,171,177,180,186,189,195,198,204,207,213,216,222,225,231,234,240,243,249,252,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,255,255];ratio_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,252,250,248,246,244,242,240,238,236,234,232,230,228,226,224,222,220,218,216,214,212,210,208,206,204,202,200,198,196,194,192,190,188,186,184,182,180,178,176,174,172,170,168,166,164,162,160,158,156,154,152,150,148,146,144,142,140,138,136,134,132,130,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0];ratio_green=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,254,252,250,248,246,244,242,240,238,236,234,232,230,228,226,224,222,220,218,216,214,212,210,208,206,204,202,200,198,196,194,192,190,188,186,184,182,180,178,176,174,172,170,168,166,164,162,160,158,156,154,152,150,148,146,144,142,140,138,136,134,132,130,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0];ratio_red=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];red_vessels_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,55,57,59,61,64,66,68,70,72,75,77,79,81,84,86,88,90,92,95,97,99,101,103,106,108,110,112,114,117,119,121,123,126,128,136,144,152,159,167,175,183,191,199,207,215,223,231,239,247];red_vessels_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,6,8,10,11,13,15,16,18,20,21,23,25,26,28,30,32,33,35,37,38,40,42,43,45,47,48,50,52,53,55,57,59,60,62,64,65,67,69,70,72,74,75,77,79,80,82,84,86,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,164,170,176,182,188,194,200,206,212,218,224,230,236,242,248];red_vessels_red=[0,1,2,3,5,6,7,9,10,11,12,14,15,16,18,19,20,21,23,24,25,27,28,29,30,32,33,34,36,37,38,39,41,42,43,45,46,47,49,50,51,52,54,55,56,58,59,60,61,63,64,65,67,68,69,70,72,73,74,76,77,78,79,81,82,83,85,86,87,88,90,91,92,94,95,96,98,99,100,101,103,104,105,107,108,109,110,112,113,114,116,117,118,119,121,122,123,125,126,127,128,130,131,132,134,135,136,137,139,140,141,143,144,145,147,148,149,150,152,153,154,156,157,158,159,161,162,163,165,166,167,168,170,171,172,174,175,176,177,179,180,181,183,184,185,186,188,189,190,192,193,194,196,197,198,199,200,201,202,203,204,206,207,208,209,210,211,212,213,214,215,216,217,219,220,221,222,223,224,225,226,227,228,229,231,232,233,234,235,236,237,238,239,240,241,243,244,245,246,247,248,249,250,251,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];spectrum_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];spectrum_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0];spectrum_red=[255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];stern_blue=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,251,247,243,238,234,230,226,221,217,213,209,204,200,196,192,187,183,179,175,170,166,162,158,153,149,145,141,136,132,128,124,119,115,111,107,102,98,94,90,85,81,77,73,68,64,60,56,51,47,43,39,34,30,26,22,17,13,9,5,0,3,7,11,15,19,22,26,30,34,38,41,45,49,53,57,60,64,68,72,76,79,83,87,91,95,98,102,106,110,114,117,121,125,129,133,137,140,144,148,152,156,159,163,167,171,175,178,182,186,190,194,197,201,205,209,213,216,220,224,228,232,235,239,243,247,251,255];stern_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];stern_red=[0,18,36,54,72,90,108,127,145,163,181,199,217,235,254,249,244,239,234,229,223,218,213,208,203,197,192,187,182,177,172,166,161,156,151,146,140,135,130,125,120,115,109,104,99,94,89,83,78,73,68,63,58,52,47,42,37,32,26,21,16,11,6,0,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];ucla_blue=[0,0,0,0,0,0,0,0,0,0,0,0,102,102,102,102,136,136,136,136,136,136,136,136,136,136,136,136,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,170,170,170,170,187,187,187,187,204,204,204,204,204,204,204,204,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,187,187,187,187,187,187,187,187,170,170,170,170,153,153,153,153,153,153,153,153,136,136,136,136,119,119,119,119,119,119,119,119,85,85,85,85,71,71,71,71,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];ucla_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,51,51,51,51,51,51,51,51,85,85,85,85,119,119,119,119,119,119,119,119,136,136,136,136,153,153,153,153,153,153,153,153,153,153,153,153,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,185,185,185,185,185,185,185,185,204,204,204,204,221,221,221,221,221,221,221,221,238,238,238,238,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,238,238,238,238,238,238,238,238,221,221,221,221,204,204,204,204,204,204,204,204,187,187,187,187,170,170,170,170,170,170,170,170,153,153,153,153,119,119,119,119,85,85,85,85,85,85,85,85,51,51,51,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];ucla_red=[0,0,0,0,0,0,0,0,0,0,0,0,85,85,85,85,119,119,119,119,119,119,119,119,136,136,136,136,136,136,136,136,136,136,136,136,102,102,102,102,68,68,68,68,68,68,68,68,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,102,102,102,102,187,187,187,187,204,204,204,204,204,204,204,204,238,238,238,238,238,238,238,238,238,238,238,238,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,238,238,238,238,221,221,221,221,221,221,221,221,204,204,204,204,255,255,255,255];"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.DataManager=function(d){var b=this;this.arrStudy=[];var a=$.extend(!0,{render:null},d);this.requestHandle;this.Request=function(c){if(void 0!==c)if(5<=this.arrStudy.length)$.Msg("\u52a0\u8f7d\u68c0\u67e5\u6570\u4e0a\u9650\uff0c\u6700\u9ad8\u53ea\u80fd\u52a0\u8f7d5\u4e2a\u68c0\u67e5\u3002"),console.log(CBoBo.Plugin.GetTime()+" :\u52a0\u8f7d\u68c0\u67e5\u6570\u4e0a\u9650\uff0c\u6700\u9ad8\u53ea\u80fd\u52a0\u8f7d5\u4e2a\u68c0\u67e5\u3002");else if(void 0!=this.GetStudy(c.studyuid))$.Msg("\u52a0\u8f7d\u8be5\u68c0\u67e5\x3c"+c.studyuid+"\x3e\u5931\u8d25,\u5f53\u524d\u68c0\u67e5\u5df2\u5b58\u5728\u3002"),console.log(CBoBo.Plugin.GetTime()+" :\u52a0\u8f7d\u8be5\u68c0\u67e5\x3c"+c.studyuid+"\x3e\u5931\u8d25,\u68c0\u67e5\u5df2\u5b58\u5728\u3002");else{var b=c.studyuid,e=c.wadourl,d=c.hospid,f=c.token,g=c.imageType,p=c.hasDesensitize,t=c.departCode,r=c.isKeyImage,v=c.isInternal,w=c.error,q=c.success,u=c.progress,x=c.deseriesfakeprogress,A=c.serverRead;c=c.history;var z=new DVStudy;z.setURLSearchParams({studyuid:b,wadourl:e,hospid:d,token:f,imageType:g,hasDesensitize:p,departCode:t,isKeyImage:r,isInternal:v});this.requestHandle=new DicomRequest({wadourl:e,hospid:d,studyuid:b,study:z,token:f,imageType:g,hasDesensitize:p,departCode:t,isKeyImage:r,isInternal:v,error:w,success:q,progress:u,deseriesfakeprogress:x,serverRead:A,manager:a.manager,history:c});this.requestHandle.RequestVrtWsURl();this.requestHandle.StartStudyInfo(z);this.arrStudy.push(z)}};this.RequestAIAnnotation=function(a){layer.confirm("\u5e73\u53f0\u53ea\u5f00\u653e\u80f8\u90e8CT\u3001DR\u5f71\u50cf\u7684AI\u670d\u52a1\uff0c\u66f4\u591a\u90e8\u4f4d\u5c06\u9646\u7eed\u5f00\u653e\u3002\x3cbr\x3e\u7b26\u5408\u8bf7\u201c\u786e\u8ba4\u201d\x3c/br\x3e\u4e0d\u7b26\u5408\u8bf7\u201c\u8fd4\u56de\u201d,\u89e3\u6790\u7ed3\u679c\u9700\u8981\u7b49\u5f85\u5927\u698230\u79d2",{btn:["\u786e\u5b9a","\u53d6\u6d88"],title:"AI\u8bca\u65ad"},function(){layer.msg("\u6b63\u5728\u4e3a\u60a8\u89e3\u6790AI\u7ed3\u679c\u3002",{icon:1});var c=b.arrStudy[0].wadourl.replace("Wado","").replace("wado","");$.ajax({url:c+"Ai/NewStudy",type:"get",data:{studyUid:b.arrStudy[0].stuuid,hospId:b.arrStudy[0].hospid},async:!1,complete:function(c){200==c.status&&c.responseJSON?"success"===c.responseJSON.status?a.success():(a.error&&a.error(),layer.msg("\u8bf7\u6c42AI\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]})):(a.error&&a.error(),layer.msg("\u8bf7\u6c42AI\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}))}})},function(){})};this.RequestAIResult=function(a){var c=b.arrStudy[0].wadourl.replace("Wado","").replace("wado","");$.ajax({url:c+"Ai/GetResult",type:"get",data:{studyUid:b.arrStudy[0].stuuid,hospId:b.arrStudy[0].hospid},async:!1,complete:function(c){200==c.status&&c.responseJSON?(c=c.responseJSON,"success"===c.status?c.result.imgDetail.length?(b.arrStudy[0].SetAnnotations(c.result.imgDetail),a.success()):layer.msg("\u626b\u63cf\u5b8c\u6210\uff0c\u672a\u53d1\u73b0\u53ef\u7591\u7ed3\u8282",{icon:5,time:3E3,shade:[.3,"#000"]}):(layer.msg("\u8bf7\u6c42AI\u6570\u636e\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}),a.error&&a.error())):(a.error&&a.error(),layer.msg("\u8bf7\u6c42AI\u6570\u636e\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}))}})};this.RequestHistoryStudy=function(a){var c=$.extend({hospid:"",studyuid:"",hisurl:"",process:null,progress:null,error:null,complete:null,deseriesfakeprogress:null},a);$.ajax({url:c.hisurl,type:"get",data:{hospId:c.hospid,mainstudyUid:c.studyuid},complete:function(a){var e=!1;200==a.status&&a.responseJSON&&(a.responseJSON.success?(e=!0,$.each(a.responseJSON.studies,function(a,e){b.Request({wadourl:e.url,hospuid:e.hospId,studyuid:e.uid,departCode:e.departCode,progress:c.progress,success:c.success,error:c.error,deseriesfakeprogress:c.deseriesfakeprogress})})):$.Msg(a.responseJSON.msg));null!=c.complete&&c.complete(e)}})};this.GetStudy=function(a){var c;a<this.arrStudy.length&&-1<a&&(c=this.arrStudy[a]);if(void 0===c)for(var b=0;b<this.arrStudy.length;b++){var e=this.arrStudy[b],d;if("JPG"==e.totaltype){d=e.GetJpg();var f=0}else d=e.GetAllDicom(),f=0;for(;f<d.length;f++)d[f].id==a&&(c=e)}if(void 0===c)for(b=0;b<this.arrStudy.length;b++)e=this.arrStudy[b],e.studyuid==a&&(c=e);return c};this.GetSeries=function(a){for(var c=0;c<this.arrStudy.length;c++){var b=this.arrStudy[c].GetSeries(a);if(void 0!=b)return b}};this.DeleteStudy=function(a){for(var c=0;c<this.arrStudy.length;c++){var b=this.arrStudy[c];b.studyuid==a&&(delete b,this.arrStudy.splice(c,1))}};var f=0;this.SaveDicomBinary=function(c){var e=c.id,d=c.buffer,g=c.width,m=c.height,n=c.bseries,p=c.progress,t=c.frames,r=c.isRGB,v=c.isIMGAnalysis2;c=c.imageType;if(void 0!==e){void 0==p&&(p=100);f++;for(var w=0;w<this.arrStudy.length;w++){var q=this.arrStudy[w],u=q.GetDicomById(e,q.name);if(u){var x;u.frames=t;u.col=g;u.row=m;try{x=r?new Uint8Array(d):8>=u.bita&&!v?new Uint8Array(d):u.pixrep?new Int16Array(d):new Uint16Array(d)}catch(z){console.log(z)}u.setPixsBuffer(x);u.setData({isIMGAnalysis2:v,imageType:c});v&&!r&&u.getWwWc();if(n)u.bProgress=!0,a.render(u,q,q.CompletePercent(e));else if(a.render(u,q,p),!d){var A={};A.seruid=u.seruid;A.id=u.id;a.render(A,q,p)}u=q.IsPageSwitch();A=q.GetStudyType();u&&A&&f===q.GetAllSeries().length&&b.requestHandle.DLJsonBySeriesUid()}}}};d=window.config&&window.config.threadDecodePath;var g=["./dicomviewer/js/Thread.Decode.js","./static/dicomviewer/js/Thread.Decode.js","./js/Thread.Decode.js"],c=[];d&&g.unshift(d);!function(){var a=arguments;workerUrl=g.shift()+"?v\x3d20220616\x26db\x3d"+JSON.stringify(CBoBo.store.db);var d;fetch(workerUrl).then(function(a){d=a;var c=a.ok;if("OK"==a.statusText||c)return a.text();throw{msg:"Worker\u6587\u4ef6\u8def\u5f84\u9519\u8bef",res:a};}).then(function(a){if(!a.includes(".postMessage("))throw{msg:"Worker\u6587\u4ef6\u7c7b\u578b\u9519\u8bef",response:d,data:a};a=new Worker(workerUrl);window.mergeThread=a;a.onmessage=function(a){a=a.data;b.SaveDicomBinary({id:a.id,buffer:a.buffer,width:a.width,height:a.height,bseries:a.bseries,progress:a.progress,frames:a.frames,isRGB:a.isRGB,isIMGAnalysis2:a.isIMGAnalysis2,imageType:a.imageType})}}).catch(function(b){c.push(b);g.length?a.callee():(console.info(c),console.error("\u8bf7\u6309\u89c4\u8303\u63a5\u5165dicomviewer!!!,worker\u8def\u5f84\u4e0d\u89c4\u8303!!!,\u8bf7\u8054\u7cfb\u7ef4\u62a4\u4eba\u5458,\u53ef\u4ee5\u4e34\u65f6\u914d\u7f6eindex.html\x3d\u300bwindow.config"),console.info(" dicomviewer\u89c4\u8303\u8be6\u89c1\u5185\u90e8git\uff1a","http://192.168.18.134:8081/dicomviewer/dicomviewer-pc-jquery"))})}()};function DicomRequest(d){function b(a){for(var c=[],b=k.study.GetAllSeries(),e=0;e<b.length;e++)for(var d=b[e],f=0;f<Math.min(d.arrImage.length,1);f++){var g=d.arrImage[f];c.push(g.id)}if(a)return c;for(e=0;e<b.length;e++)for(d=b[e],f=1;f<d.arrImage.length;f++)g=d.arrImage[f],c.push(g.id);return c}function a(){for(var a=k.study.GetAllSeries(),c=[],a=$jscomp.makeIterator(a),b=a.next();!b.done;b=a.next())c.push(b.value.arrImage);return simple.arraysLaminated.apply(simple,[].concat($jscomp.arrayFromIterable(c)))}function f(a){for(var c=[],b=k.study.GetAllSeries(),e=0;e<b.length;e++)for(var d=b[e],f=0;f<Math.min(d.arrImage.length,1);f++){var g=d.arrImage[f];c.push(g)}if(a)return c;for(e=0;e<b.length;e++)for(d=b[e],f=1;f<d.arrImage.length;f++)g=d.arrImage[f],c.push(g);return c}function g(){var a=b(),e=0,d=k.study.imgcount;$.each(a,function(){var a=this,b=new XMLHttpRequest;b.open("GET",k.wadourl+"/GetImageMeta/"+a,!0);b.responseType="json";b.send();b.onreadystatechange=function(){if(b.readyState===b.DONE&&200===b.status&&b.response){var f=b.response;"string"===typeof f&&(f=eval("("+f+")"));k.study.SetDicomData(f,a,0);e++}else b.readyState===b.DONE&&200!==b.status&&e++;e===d&&(k.study.CorrectScout(),k.study.bAllMetaDl=!0,c())}})}function c(){function c(a,c){var b=a.isRGB,e=a.url,k=a.id,m=a.uid,n=a.col,p=a.row,r=a.mod,t=a.compress,q=a.seruid,v=a.imgnum,M=a.patid;1==l?"ECG"==r?e=d+"/GetECGImageData?id\x3d"+k:t?e=d+"/GetDecodeImageData?id\x3d"+k:e||(e=d+"/GetImageData?id\x3d"+k):e||(e=d+"/GetBlock/"+k+"?blockIndex\x3d0\x26studyuid\x3d"+f+"\x26hospitalid\x3d"+g+"\x26hospid\x3d"+g+"\x26seriesId\x3d"+q+"\x26departCode\x3d"+h);b={url:e,id:k,uid:m,imageType:l,bseries:!0,brgb:b,index:0,ratio:1,dcmWidth:n,dcmHeight:p,bsave:!0,patid:M,dicomInfo:{isRGB:b}};a.setData({threadPostData:b});2>=v||c<G||void 0===c?A.push(b):z.push(b)}var b=k,e=b.study,d=b.wadourl,f=b.studyuid,g=b.hospid,h=b.departCode,l=b.imageType,m=[],A=[],z=[],b=a(),E=e.GetStudyType(),G=e.GetAllSeries().length||6;b instanceof Array&&("series"===E?b.forEach(function(a,b){c(a,b)}):$.each(b,function(){if(1==l)c(this);else{var a=this.seruid;var b=e.studyuid,f=e.hospid,g=e.departCode;if(this instanceof DVDicomInfo)for(var h=this.isRGB,k=this.url,n=this.id,p=this.uid,r=this.blocks,t=this.bits,q=this.col,v=this.row,z=this.patid,O=0;O<r;O++){var Q={url:k||d+"/GetBlock/"+n+"?blockIndex\x3d"+O+"\x26studyuid\x3d"+b+"\x26hospitalid\x3d"+f+"\x26hospid\x3d"+f+"\x26seriesId\x3d"+a+"\x26departCode\x3d"+g,id:n,uid:p,imageType:l,bseries:!1,brgb:!1,index:O,ratio:Math.sqrt(r),bits:t,dcmWidth:q,dcmHeight:v,bsave:!0,patid:z,dicomInfo:{isRGB:h}};0===O?A.push(Q):m.push(Q)}}}));b=simple.queryToObject().prefetchNum;z=z.slice(0,isNaN(b)?G*(7>G?1:0):b);mergeThread.postMessage({type:0,arrpriority:[].concat($jscomp.arrayFromIterable(A),$jscomp.arrayFromIterable(m),$jscomp.arrayFromIterable(z))})}function e(){var a=b(!0),c=0,e=a.length;$.each(a,function(){var a=this,b=new XMLHttpRequest;b.open("GET",k.wadourl+"/GetImageMeta/"+a,!0);b.responseType="json";b.send();b.onreadystatechange=function(){if(b.readyState===b.DONE&&200===b.status&&b.response){var d=b.response;"string"===typeof d&&(d=eval("("+d+")"));k.study.SetDicomData(d,a,0);c++}else b.readyState===b.DONE&&200!==b.status&&c++;c===e&&h()}})}function h(){var a=[],c=f(!0),b=k.study.GetStudyType();c instanceof Array&&"series"===b&&$.each(c,function(){var c=this.isRGB,b=this.id;a.push({url:this.url||k.wadourl+"/GetBlock/"+b+"?blockIndex\x3d0",id:b,uid:this.uid,imageType:k.imageType,bseries:!0,brgb:c,index:0,ratio:1,dcmWidth:this.col,dcmHeight:this.row,bsave:!0,patid:this.patid,dicomInfo:{isRGB:c}})});mergeThread.postMessage({type:0,arrpriority:a,arrnormal:[]})}function l(){for(var a=k.study.GetJpg(),c=0;c<a.length;c++){var b=a[c];b.image=new Image;b.image.crossOrigin="";b.image.src=k.wadourl+"/GetImageData/"+b.id;$(b.image).bind("load",{img:b},function(a){a=a.data.img;a.bLoaded=!0;null!=k.progress&&k.progress(a,k.study)})}}var k=$.extend({wadourl:"",hospid:"",studyuid:"",study:"",token:void 0,imageType:void 0,departCode:0,hasDesensitize:0,isKeyImage:0,isInternal:0,progress:null,serverRead:"",error:null,success:null,deseriesfakeprogress:null,manager:void 0},d),m=this;this.RequestVrtWsURl=function(){var a=k,c=a.study,b=new XMLHttpRequest;b.open("GET",a.wadourl+"/getPath3d",!0);b.responseType="json";b.onreadystatechange=function(){var a=b.status,e=b.response;4===b.readyState&&200===a&&e&&(a=e.data.path)&&(c.vrtWsURl=a,CBoBo.isShow3D=!0,(a=document.querySelector('div[title\x3d"3D"]'))&&(a.style.display="inline"))};b.send()};this.StartStudyInfo=function(){var a=k,c=a.wadourl,b=a.studyuid,d=a.hospid,f=a.hasDesensitize,h=a.departCode,q=a.token,u=a.imageType,x=a.isKeyImage,A=a.isInternal,z=a.error,E=c+"/GetStudyInfo";CBoBo.Draw.SetIsFromServer(a.serverRead);CBoBo.Draw.SetWadoUrl(c);$.ajax({headers:q?{Authorization:"bearer "+q}:{},url:E,type:"get",data:{hospId:d,StudyUID:b,hasDesensitize:f,departCode:h,imageType:u,isDcm:u,isKeyImage:x,isInternal:A},complete:function(a){200==a.status&&a.responseJSON?(a=a.responseJSON,a.success?(a.data.requestDesensitize=k.hasDesensitize,k.study.SetStudyInfo(a.data),k.study.UpdateSort(),null!=k.success&&k.success(k.study),k.study.hasseries&&"RAW"==k.study.totaltype?CBoBo.Draw.GetIsFromServer()?m.DLJsonBySeriesUid():(a=k.study.GetStudyType(),a="series"===a?!0:!1,k.study.IsPageSwitch()&&a?e():void 0===k.study.GetAllSeries()[0].uuid?g():m.DLJsonBySeriesUid()):l()):null!==k.error&&k.error({msg:a.msg,studyuid:k.studyuid})):null!==z&&z({msg:"\u5f71\u50cf\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",studyuid:b})}})};this.DLJsonBySeriesUid=function(){var a=0,b=k.study.GetAllSeries(),e=k,d=e.wadourl,f=e.hospid,g=e.departCode,h=e.imageType,l=e.study.studyuid;(new simple.PromiseQueue).init({arr:b,func:function(e){return new Promise(function(m){var n=new XMLHttpRequest;n.open("GET",d+"/GetSeriesMeta?uuid\x3d"+e.uuid+"\x26studyuid\x3d"+l+"\x26hospitalid\x3d"+f+"\x26hospid\x3d"+f+"\x26departCode\x3d"+g+"\x26imageType\x3d"+h,!0);n.responseType="json";n.onreadystatechange=function(){var e=n.readyState,d=n.response;200!==n.status?(m(),a++):(3===e&&m(),4===e&&(a++,e=d||{},"string"===typeof e&&(e=eval("("+e+")")),e.success&&(d=e.data,k.study.SetSeriesDicom(d.imgs,d.compress,e.data))),a===b.length&&(k.study.CorrectScout(),k.study.bAllMetaDl=!0,function(){window.mergeThread?c():setTimeout(arguments.callee,10)}()))};n.send()})}})};RequestBinaryData=function(a){var c=$.Deferred(),b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="arraybuffer";b.send();b.onreadystatechange=function(){if(b.readyState==b.DONE&&200==b.status&&b.response)return c.resolve(b.response)};b.onerror=function(a){return c.reject(a)};return c}}function DVStudy(){function d(a,b){if(a instanceof Array){var c=!1;a.forEach(function(a){a===b&&(c=!0)});return c}}var b=[],a=[],f=[];this.studyuuid;this.studyuid;this.age;this.hasseries;this.hospname;this.imgcount;this.imgs;this.modality;this.name;this.orginaltype;this.patientid;this.seriescount;this.studydate;this.sex;this.studyid;this.totaltype;this.wadourl;this.hospid;this.token;this.imageType;this.hasDesensitize;this.isKeyImage;this.isInternal;this.departCode;this.m_Max=99999;var g=this;this.bAllMetaDl=!1;this.URLSearchParams={};this.vrtWsURl=void 0;this.setURLSearchParams=function(a){this.URLSearchParams=a;for(var c in a)Object.hasOwnProperty.call(a,c)&&(this[c]=a[c])};this.SetSeriesDicom=function(a,e,d){a instanceof Array&&a.forEach(function(a){a.compress=e;a.seruuid=d.seruid||d.uuid;a.id=a.id;for(var c=0;c<b.length;c++)for(var f=b[c],g=0;g<f.arrImage.length;g++){var h=f.arrImage[g];h.id==a.id&&(CBoBo.Draw.GetIsFromServer()&&(h.bLoadImage=!0),h.SetInfo({data:a}))}})};this.RequestCache=function(a,b,f){if(this.bAllMetaDl){var c=[],e=f.slice(Math.max(a-9,0),Math.min(b+9,f.length));f.forEach(function(a){d(e,a)?a.bLoadImage||c.push(a):(a.bLoadImage=!1,a.bProgress=!1,delete a.pixsBuffer)});this.SwitchSeriesImagesInMemory(c)}};this.RequestSeriesDicom=function(){if(this.bAllMetaDl){var a=[],b=function(){for(var a=[],c=g.GetAllSeries(),b=0;b<c.length;b++)for(var e=c[b],d=0;d<Math.min(e.arrImage.length,1);d++){var f=e.arrImage[d];a.push(f)}b=g.IsPageSwitch();e=g.GetStudyType();if(b&&e){for(b=0;b<c.length;b++)for(e=c[b],d=1;d<Math.min(e.arrImage.length,10);d++)f=e.arrImage[d],a.push(f);return a}for(b=0;b<c.length;b++)for(e=c[b],d=1;d<e.arrImage.length;d++)f=e.arrImage[d],a.push(f);return a}();this.GetStudyType();b instanceof Array&&$.each(b,function(c,b){c=this.isRGB;b=this.id;a.push({url:this.url||g.wadourl+"/GetBlock/"+b+"?blockIndex\x3d0",id:b,uid:this.uid,imageType:g.URLSearchParams.imageType,bseries:!0,brgb:c,index:0,ratio:1,dcmWidth:this.col,dcmHeight:this.row,bsave:0<=g.m_Max,patid:this.patid,dicomInfo:{isRGB:c}})});mergeThread.postMessage({type:1,arrpriority:[],arrnormal:a})}};this.GetSwitchInMemoryDicoms=function(a){if(a instanceof Array){var c=[];a.forEach(function(a){a.images.forEach(function(a,b){0!==b||a.bLoadImage||c.push(a)})});var b=[],d=g.URLSearchParams.imageType;$.each(c,function(a,c){a=c.isRGB;var e=c.id;b.push({url:c.url||g.wadourl+"/GetBlock/"+e+"?blockIndex\x3d0",id:e,uid:c.uid,imageType:d,bseries:!0,brgb:a,index:0,ratio:1,dcmWidth:c.col,dcmHeight:c.row,bsave:!0,patid:c.patid,dicomInfo:{isRGB:a}})});mergeThread.postMessage({type:1,arrpriority:b,arrnormal:[]})}};this.SwitchSeriesImagesInMemory=function(a){var c=[],b=this.URLSearchParams.imageType;$.each(a,function(a,e){a=e.isRGB;var d=e.id;c.push({url:e.url||g.wadourl+"/GetBlock/"+d+"?blockIndex\x3d0",id:d,uid:uid,imageType:b,bseries:!0,brgb:a,index:0,ratio:1,dcmWidth:e.col,dcmHeight:e.row,seriesuid:e.seruid,bsave:!0,patid:e.patid,dicomInfo:{isRGB:a}})});mergeThread.postMessage({type:2,arrpriority:c,arrnormal:[]})};this.IsPageSwitch=function(){return this.imgcount>this.m_Max};this.CompletePercent=function(a){a=this.GetSeries(a);if(void 0!==a){var c=0;a=a.GetAllDicom();$.each(a,function(){this.bProgress&&c++});a=c/a.length*100;return 10<=a?parseInt(a):a.toFixed(1)}return 100};this.GetStudyType=function(){var a;"JPG"==this.totaltype?a="jpg":"RAW"==this.totaltype&&(a="CT"==this.modality||"MR"==this.modality?"series":"deseries");return a};this.UpdateSort=function(){function c(a,c){if(!(void 0==a||1>a.length))for(var b,d,f=0;f<a.length;f++){if("FFP"==c||"FFS"==c||"FFDR"==c||"FFDL"==c){b=a;d=f;for(var g=f+1;g<b.length;++g)parseInt(b[d].num)<parseInt(b[g].num)&&(d=g)}else e(a,f);b=e(a,f);b!=f&&(d=a[f],a[f]=a[b],a[b]=d)}}function e(a,c){var b=c;for(c+=1;c<a.length;++c)parseInt(a[b].num)>parseInt(a[c].num)&&(b=c);return b}0<b.length&&($.each(b,function(a,b){c(b.arrImage,b.desp)}),c(b));0<a.length&&c(a)};this.CorrectScout=function(a){function c(a,c){a&&(a=a.split("|"),void 0!=a&&$.each(a,function(a,b){a=b.split("^");a={uid:a[0],index:parseInt(a[1]),ptStart:new Point(parseInt(a[2]),parseInt(a[3])),ptEnd:new Point(parseInt(a[4]),parseInt(a[5]))};if(b=f[a.uid])"[object Array]"!=Object.prototype.toString.apply(c[b])&&(c[b]=[]),c[b].push(a)}))}function d(a){$.each(a,function(a,c){c.sort(function(a,c){return a.index-c.index})})}a=void 0===a?!0:a;var f=function(){var a=[];$.each(b,function(c,b){$.each(b.arrImage,function(c,b){a[b.uid]=b.seruid})});return a}(),k=!1;$.each(b,function(a,b){b.arrImage[0].strScount&&(k=!0);$.each(b.arrImage,function(a,b){c(b.strScount,b.scount);d(b.scount);b.strScount=null})});k?(a=document.querySelector('span[title\x3d"\u5b9a\u4f4d\u7ebf"]').parentElement,CBoBo.isShowScout=!0,a&&(a.style.display="flex")):a&&g.DLImageScoutLine()};this.DLImageScoutLine=function(){var a=this.wadourl+"/GetImageScoutLine?uuid\x3d"+this.studyuuid+"\x26hospId\x3d"+this.hospid+"\x26departCode\x3d"+this.departCode,e=new XMLHttpRequest;e.timeout=18E4;e.open("GET",a,!0);e.responseType="json";e.send();e.onreadystatechange=function(){if(e.readyState===e.DONE&&200===e.status&&e.response){var a=e.response,c=a.statusCode,d=a.data,f=a.result;if(a.success||200===c)$.each(b,function(a,c){$.each(c.arrImage,function(a,c){c.strScount=(d||f)[c.uid]})}),g.CorrectScout(!1)}}};this.SetStudyInfo=function(a){function c(a){if(!a)return"*";var c=a.length;return a.slice(0,2)+"*".repeat(5>c?2:c-4)+a.slice(c-2)}if(void 0!=a){this.studyuid=a.studyuid;this.studyuuid=a.studyuuid;this.age=a.age;this.hasseries=parseInt(a.hasseries);this.hospname=a.hospname||a.orgname;this.imgcount=parseInt(a.imgcount);this.imgs=a.imgs;this.modality=a.modality;null!=this.modality&&""!=this.modality&&(this.modality=this.modality.toUpperCase());this.name=a.name;null!=this.name&&""!=this.name&&(this.name=this.name.replace(/\^/g,""));this.orginaltype=a.orginaltype;this.patientid=a.patientid;this.seriescount=a.seriescount;this.studydate=a.studydate;var b=String(a.sex).trim();this.sex="M"===b?"\u7537":"F"===b?"\u5973":b;this.studyid=a.studyid;this.totaltype="RAW";null!=this.totaltype&&""!=this.totaltype&&(this.totaltype=this.totaltype.toUpperCase());this.hasseries?this.PushArrSeries(a.serieses):this.PushArrImgs(a.imgs);window.globalStudyInfo=this;b=a.hasDesensitize;a.requestDesensitize&&1!==b&&(this.name=this.name.slice(0,1)+"**",this.orgname=c(this.hospname),this.patientid=c(this.patientid))}};this.PushArrSeries=function(a){if(void 0!=a){var c=this;if("RAW"==this.totaltype)$.each(a,function(a,e){var d=String(a);e.customSeriesId=d;var f=new DVSeries(c.studyuid,c.hospid,c.departCode,e);$.each(e.imgs,function(a,b){b.customSeriesId=d;f.PushImage(b,c.wadourl)});b.push(f)});else{var d=[];$.each(a,function(a,c){d.push(c.imgs)});$.each(d,function(a,b){b.customSeriesId=String(a);c.PushArrImgs(b)})}}};this.PushArrImgs=function(c){if(void 0!=c){var b=this;$.each(c,function(c,e){c=new DVImageInfo;c.id=e.id;c.num=e.num;c.imageicon=b.wadourl+"/GetImageThumb/"+e.id;dicominfo.url=e.url;dicominfo.customSeriesId=e.customSeriesId;a.push(c)})}};this.SetDicomData=function(a,e,d){for(var c=0;c<b.length;c++)for(var f=b[c],g=0;g<f.arrImage.length;g++){var h=f.arrImage[g];h.id==e&&(1==d?h.setPixsBuffer(a):0==d&&h.SetInfo(a))}};this.GetSpecifyImage=function(a,e){if(!(0>e))for(var c,d=0;d<b.length;d++)if(c=b[d],c.seruid==a){a=c.arrImage.length;if(e<a)return c.arrImage[e];break}};this.GetAllSeries=function(){return b};this.GetAllDicom=function(){var a=[];$.each(b,function(c,b){$.each(b.arrImage,function(c,b){a.push(b)})});return a};this.GetJpg=function(c){if(void 0==c)return a;for(var b=0;b<a.length;b++)if(img=a[b],img.id==c)return img;if(-1<c&&c<a.length)return a[c]};this.GetNextDicom=function(a,e,d){for(var c=0;c<b.length;c++)if(ser=b[c],ser.uid===a)for(var f=0;f<ser.arrImage.length;f++)if(img=ser.arrImage[f],img.sopuid==e){if(0<d){if(0>=f)return;index=f-1}else{if(f>=ser.arrImage.length-1)return;index=f+1}return ser.arrImage[index]}};this.GetSpecialDicom=function(a,e){for(var c=0;c<b.length;c++)if(ser=b[c],ser.uid==a&&e<ser.arrImage.length)return ser.arrImage[e]};this.GetDicomById=function(a,e){for(e=0;e<b.length;e++){ser=b[e];for(var c=0;c<ser.arrImage.length;c++)if(img=ser.arrImage[c],img.id===a)return img}};this.GetWaitLoadSeries=function(a){var c=a.index,d=a.seriesId,f=a.params;a=b.length;var g=[];isNaN(c)&&d&&(c=b.findIndex(function(a){return a.customSeriesId==d}));if(0<=c&&c<a){c=b[c].arrImage.filter(function(a){return!a.bLoadImage});if(f)return g=c.map(function(a){return a[f]});g=c}return g};this.GetSeries=function(a){for(var c,d=0;d<b.length;d++){ser=b[d];for(var f=0;f<ser.arrImage.length;f++)img=ser.arrImage[f],img.id==a&&(c=ser)}void 0==c&&a<b.length&&-1<a&&(c=b[a]);return c};this.GetSeriesLengthById=function(a){for(var c=0;c<b.length;c++){ser=b[c];for(var d=0;d<ser.arrImage.length;d++)if(img=ser.arrImage[d],img.id==a)return ser.arrImage.length}};this.GetDicomNums=function(){for(var a=0,e=0;e<b.length;e++)ser=b[e],a+=ser.arrImage.length;return a};this.SetAnnotations=function(a){f=a};this.GetAnnotations=function(){return f}}function DVSeries(d,b,a,f){var g=f.desp,c=f.num,e=f.uid,h=f.uuid;f=f.customSeriesId;this.studyuid=d;this.hospid=b;this.departCode=a;this.desp=g;this.customSeriesId=f;this.num=c;this.uid=e;this.uuid=h;this.arrImage=[];this.PushImage=function(c,e){var f=new DVDicomInfo;f.id=c.id;f.num=c.num;f.imageInstanceUid=c.imageInstanceUid;f.imageicon=e+"/GetImageThumb/"+c.id+"?seriesId\x3d"+h+"\x26studyuid\x3d"+d+"\x26hospitalid\x3d"+b+"\x26hospid\x3d"+b+"\x26departCode\x3d"+a;f.url=c.url;f.customSeriesId=c.customSeriesId;this.arrImage.push(f)};this.GetAllDicom=function(){return this.arrImage}}function getIsRGB(d,b){return d?["RGB","YBR_FULL","YBR_FULL_422","YBR_RCT","YBR_ICT"].includes(d):8>=b}function DVDicomInfo(){this.bProgress=!1;this.minGray;this.maxGray;this.id;this.num;this.imageicon;this.uid;this.pixsBuffer;this.bLoadImage=!1;this.sex;this.age;this.birth;this.patid;this.mod;this.accnum;this.stuid;this.stuuid;this.studes;this.serid;this.seruid;this.serdes;this.imgnum;this.sopuid;this.studt;this.stutm;this.acqdt;this.acqtm;this.wc;this.ww;this.ma;this.kv;this.sliceth;this.manu;this.inst;this.frames;this.row;this.col;this.pixx;this.pixy;this.bita;this.bits;this.hbit;this.rescin;this.rescsl;this.pixrep;this.sappix;this.phme;this.orl;this.ort;this.orr;this.orb;this.scount={};this.strScount;this.blocks;this.isRGB;this.isIMGAnalysis2;this.imageType;this.pixz;this.imgpos;this.url;this.panPos;this.seruuid;this.SetInfo=function(d){if(d&&(d=d.data)){this.compress=d.compress;this.seruuid=d.seruuid;this.name=d.name.replace(/\^/g,"");this.sex=d.sex;this.age=d.age;this.birth=d.birth;this.patid=d.patid;this.mod=d.mod;this.accnum=d.accnum;this.stuid=d.stuid;this.stuuid=d.stuuid;this.studes=d.studes;this.serid=parseInt(d.serid).toString();this.seruid=d.seruid;this.serdes=d.serdes;this.imgnum=d.imgnum;this.sopuid=d.sopuid;this.uid=d.uid;this.blocks=parseInt(d.blocks);d.url&&(this.url=d.url);var b=d.stutm;"string"!==typeof b||b.match(":")?this.stutm=b:this.stutm=[b.substring(0,2),b.substring(2,4),b.substring(4)].join(":");b=d.studt;"string"!==typeof b||b.match("-")?this.studt=d.studt:this.studt=[b.substring(0,4),b.substring(4,6),b.substring(6)].join("-");this.acqdt=d.acqdt;(this.acqtm=d.acqtm)&&parseFloat(d.acqtm).toFixed(3);this.wc=parseInt(d.wc);this.ww=parseInt(d.ww);this.ma=d.ma;this.kv=d.kv;this.sliceth=d.sliceth;this.manu=d.manu;this.inst=d.inst;this.row=parseInt(d.row);this.col=parseInt(d.col);this.pixx=d.pixx;this.pixy=d.pixy;"string"===typeof this.pixx&&"string"===typeof this.pixy&&(-1!=d.pixx.indexOf(" ")&&(b=d.pixx.split(" "),2==b.length&&(this.pixx=parseFloat(b[0]),this.pixy=parseFloat(b[1]))),this.pixx=parseFloat(this.pixx),this.pixy=parseFloat(this.pixy));this.bita=parseInt(d.bita);this.bits=d.bits;this.hbit=d.hbit;this.rescin=parseInt(d.rescin);this.rescsl=parseFloat(d.rescsl);if(""===d.rescin||null===d.rescin||isNaN(this.rescin))this.rescin=0;if(""===d.rescsl||null===d.rescsl||isNaN(this.rescsl)||1>d.rescsl)this.rescsl=1;this.pixrep=parseInt(d.pixrep);this.sappix=parseInt(d.sappix);this.phme=d.phme;this.panPos=d.panPos;this.orl=d.orl;this.ort=d.ort;this.orr=d.orr;this.orb=d.orb;this.strScount=d.scount;b=(this.imgpos=d.imgpos)?d.imgpos.split("|"):[];3==b.length&&(this.pixz=parseFloat(b[2]));this.isRGB=getIsRGB(this.phme,this.bita)}};this.setData=function(d){if("object"!==typeof d)throw Error("prams is not object");for(var b in d)this[b]=d[b]};this.setPixsBuffer=function(d){if(void 0!==d){this.pixsBuffer=d;this.bLoadImage=!0;d=1E6;for(var b=-1E6,a,f=0;f<this.pixsBuffer.length;f++)a=this.pixsBuffer[f],a>b&&(b=a),a<d&&(d=a);this.minGray=d;this.maxGray=b}};this.getWwWc=function(){var d=this.rescin,b=this.rescsl,a=this.maxGray*b+d,d=this.minGray*b+d;this.ww=parseInt(a-d);this.wc=parseInt((a+d)/2)};this.GetData=function(){return this.pixsBuffer}}function DVImageInfo(){this.id;this.num;this.imageicon;this.image;this.bLoaded}function Point(d,b){d instanceof Object&&1==arguments.length?(this.x=d.x,this.y=d.y):(this.x=d,this.y=b)}function Rect(d,b,a,f){this.left=d||0;this.top=b||0;this.right=a||0;this.bottom=f||0}"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.View={};CBoBo.View.Frame=function(d){var b=this,a=!0;this.index=0;this.idManager={};this.rootDom=d;this.GetId=function(a){switch(a){case "main":return this.idManager.main;case "banner":return this.idManager.banner;case "contain":return this.idManager.contain;case "thumb":return this.idManager.thumb;case "canvasbox":return this.idManager.canvasbox;case "logo":return this.idManager.logo;case "toolbar":return this.idManager.toolbar;case "thumbbox":return this.idManager.thumbbox}};this.Init=function(){this.idManager.main="main"+CBoBo.Plugin.GetRandom();this.idManager.banner=CBoBo.Plugin.GetRandom();this.idManager.contain="contain"+CBoBo.Plugin.GetRandom();this.idManager.thumb="thumb"+CBoBo.Plugin.GetRandom();this.idManager.thumbbox="thumbbox"+CBoBo.Plugin.GetRandom();this.idManager.canvasbox="canvasbox"+CBoBo.Plugin.GetRandom();this.idManager.logo=CBoBo.Plugin.GetRandom();this.idManager.toolbar=CBoBo.Plugin.GetRandom();this.idManager.hidebar=CBoBo.Plugin.GetRandom();m_printUrl=CBoBo.Plugin.GetUrlParam("WadoURL")||$("#hdurl").val()};this.Create=function(){var a="\x3cdiv id\x3d'"+this.idManager.main+"'\x3e\x3cdiv id\x3d'"+this.idManager.banner+"'\x3e\x3cdiv id\x3d'"+this.idManager.logo+"' title\x3d'\u5168\u5c4f'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.idManager.toolbar,a=a+("'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"+this.idManager.contain+"\x3e"),a=a+("\x3cdiv id \x3d"+this.idManager.thumb+"\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.idManager.canvasbox+"'\x3e\x3c/div\x3e"),a=a+"\x3c/div\x3e\x3c/div\x3e";this.rootDom?$(a).appendTo(this.rootDom):$(a).appendTo($("body"))};this.AddEvent=function(){};this.UpdateStyle0=function(){var a=$(window).width(),b=$(window).height();0!=CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=.026*a>>0,29>CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=29));var c=$("#"+this.idManager.main),e=a-1;c.width(e);c.height(b-1);c.css({"border-top":"1px solid #282828","border-left":"1px solid #282828","border-right":"1px solid #282828",overflow:"hidden"});c=$("#"+this.idManager.banner);c.width(e);c.height(CBoBo.View.TOOLBAR_HEIGHT-2);c.css({background:"#535353","border-top":"1px solid #6a6a6a","border-bottom":"1px solid #282828"});c=$("#"+this.idManager.contain);b-=CBoBo.View.TOOLBAR_HEIGHT;c.width(e);c.height(b);c.css({position:"relative"});var d=$("#"+this.idManager.thumb),c=e>>4;101>c&&(c=101);d.width(c);d.height(b-2);d.css({float:"left",background:"#464646","border-right":"1px solid #282828"});$("#"+this.idManager.thumbbox).css({width:"100%"});d=$("#"+this.idManager.logo);d.width(c);d.height(CBoBo.View.TOOLBAR_HEIGHT-2);d.css({display:"inline-block","text-align":"center"});d=$("#"+this.idManager.toolbar);d.width(e-c);d.height(CBoBo.View.TOOLBAR_HEIGHT-2);d.css({display:"inline-block",overflow:"hidden"});e=$("#"+this.idManager.canvasbox);e.width(a-c-23);e.height(b-22);e.css({float:"left",background:"#333",padding:"10px"})};this.UpdateStyleLB=function(a){var b=$(window).width(),c=$(window).height();0!=CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=.026*b>>0,44>CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=44));var e=$("#"+this.idManager.main),d=b-1;e.width(d);e.height(c-1);e.css({"border-top":"1px solid #282828","border-left":"1px solid #282828","border-right":"1px solid #282828",overflow:"hidden"});e=$("#"+this.idManager.banner);e.width(d);e.height(CBoBo.View.TOOLBAR_HEIGHT-2);e.css({background:"#535353","border-top":"1px solid #6a6a6a","border-bottom":"1px solid #282828"});e=$("#"+this.idManager.contain);c-=CBoBo.View.TOOLBAR_HEIGHT;e.width(d);e.height(c);e.css({position:"relative"});var e=$("#"+this.idManager.thumb),f=d>>4;101>f&&(f=101);var k=$("#"+this.idManager.logo);k.width(f);k.height(CBoBo.View.TOOLBAR_HEIGHT-2);k.css({display:"inline-block","text-align":"center"});k=$("#"+this.idManager.toolbar);k.width(d-f);k.height(CBoBo.View.TOOLBAR_HEIGHT-2);k.css({display:"inline-block",overflow:"hidden"});var k=$("#"+this.idManager.canvasbox),m,n,p,t;a?(p=m=a=0,b-=20,f=c>>4,60>f&&(f=60),t=c-20-f,n=c-f,c=f,f=d):(n=a=0,m=f,p=0,b=b-f-20,t=c-20);e.width(f);e.height(c);e.css({position:"absolute",left:a+"px",top:n+"px",background:"#464646","border-right":"1px solid #282828","white-space":"nowrap","padding-bottom":"1px"});k.width(b);k.height(t);k.css({position:"absolute",left:m+"px",top:p+"px",background:"#333",padding:"10px"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height();this.UpdateStyleLB(a>b?!1:!0)};this.HideToolBar=function(){CBoBo.View.TOOLBAR_HEIGHT=0;$("#"+this.idManager.banner).hide();b.UpdateStyle()};this.ShowThumb=function(b){if(b!=a){var d=$("#"+this.idManager.thumb);b?(a=!0,d.css({transition:"left 500ms ease-in-out",left:0})):(a=!1,d.css({transition:"left 500ms ease-in-out",left:"-150px"}))}};b.Init();b.Create();b.UpdateStyle();!0};CBoBo.View.Logo=function(d){this.logo;this.logoFont;this.parentElem;var b=!1;this.Create=function(){this.logo=CBoBo.Plugin.GetRandom();this.logoFont=CBoBo.Plugin.GetRandom();$("\x3cspan id\x3d'"+this.logo+"'\x3e\x3c/span\x3e\x3cspan id\x3d'"+this.logoFont+"'\x3e\x3c/span\x3e").appendTo($(this.parentElem))};this.SetStyle=function(){var a=$("#"+this.logoFont),b=.9*$(this.parentElem).width()>>0;a.width(b);a.height(CBoBo.View.TOOLBAR_HEIGHT-2);a.css({"font-family":"STXingkai",color:"#aaa",overflow:"hidden","line-height":CBoBo.View.TOOLBAR_HEIGHT-2+"px","text-align":"center","font-size":(.2427637721755369*b>>0)+"px",cursor:"pointer","text-shadow":"2px 2px 3px #000","font-weight":"900",display:"inline-block"});a=(b>>1)-5;$("#"+this.logo).css({color:"#33FFFF",overflow:"hidden","line-height":CBoBo.View.TOOLBAR_HEIGHT-2+"px","text-align":"center","font-size":a+"px",cursor:"pointer"})};this.SetFont=function(a){$("#"+this.logoFont).html(a);return this};this.SetLogo=function(a){$("#"+this.logo).html(a);return this};this.AddEvent=function(){$(this.parentElem).bind("click",function(a){b=!b;CBoBo.Plugin.FullScreen(b)})};this.parentElem=d;this.Create();this.AddEvent();this.SetStyle();!0};CBoBo.View.PCToolBar=function(d){var b=this,a=$.extend(!0,{parent:null,axis:"x",bottonbox:!0,msgtransform:null},d),f={},g={},c={},e={type:-1,msgtansform:null},h,l,k=!1;this.bShowCornerInfo=!0;this.toolType;this.modalityType;var m=function(){var a=$("#"+f.toolbox);a&&a.empty()},n=function(){E("2D","2D");E("MPR","MPR");E("3D","3D",CBoBo.isShow3D?{}:{display:"none"});CBoBo.isShowAi&&E("AI","AI")},p=function(){n();G("2D");z();q("\x26#xe631;","\u91ca\u653e\u5de5\u5177");q("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");x("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40");x("\x26#xe66d;","\u5e8f\u5217\u5e03\u5c40");q("\x26#xe644;","\u6062\u590d");q("\x26#xe607;","\u5e8f\u5217\u64ad\u653e");q("\x26#xe610;","\u5b9a\u4f4d\u7ebf",CBoBo.isShowScout?{}:{display:"none"});q("\x26#xe671;","DICOM\u4fe1\u606f");q("\x26#xe6b6;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");z();q("\x26#xe670;","\u653e\u7f29");q("\x26#xe630;","\u79fb\u52a8");x("\x26#xe623;","\u65cb\u8f6c");z();q("\x26#xe603;","\u8d1f\u50cf");x("\x26#xe602;","\u4f2a\u5f69");z();q("\x26#xe61b;","\u8c03\u7a97");A("\x26#xe61b;","\u81ea\u5b9a\u4e49\u8c03\u7a97");q("\x26#xe901;","\u9510\u5316");q("\x26#xe902;","\u5e73\u6ed1");z();q("\x26#xe61f;","\u76f4\u7ebf");q("\x26#xe619;","\u77e9\u5f62");q("\x26#xe61e;","\u692d\u5706");q("\x26#xe618;","\u89d2\u5ea6");q("\x26#xe637;","CT");q("\x26#xe629;","\u6587\u672c");q("\x26#xe62f;","\u7bad\u5934");q("\x26#xe9d8;","\u5de6\u6807\u8bb0");q("\x26#xE60E;","\u53f3\u6807\u8bb0");q("\x26#xe617;","\u5fc3\u80f8\u6bd4");q("\x26#xe622;","\u64a4\u9500");z();q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");z();q("\x26#xe900;","\u672c\u5730\u7f13\u5b58");z();q("\x26#xe64c;","\u6309\u952e\u8bf4\u660e")},t=function(a){switch(a.type){case "click":a.btntitle=a.target.title;e.msgtansform&&e.msgtansform(a);break;case "change":a.btntitle=a.target.title,e.msgtansform&&e.msgtansform(a)}},r=function(){function a(a){$.each(a,function(a,b){switch(b.title){case "\u91ca\u653e\u5de5\u5177":case "\u8c03\u7a97":case "\u9510\u5316":case "\u5e73\u6ed1":case "\u6700\u5927\u5bc6\u5ea6\u6295\u5f71":case "\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71":case "CPR\u66f2\u7ebf":case "CPR\u76f4\u7ebf":case "\u5207\u56fe":case "\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71":case "\u653e\u7f29":case "\u79fb\u52a8":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "\u692d\u5706":case "\u89d2\u5ea6":case "CT":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u5fc3\u80f8\u6bd4":case "\u4eae\u5ea6/\u5bf9\u6bd4":c.push(b)}})}var c=[],b=$("."+f.item);a(b);b=$("."+f.menuitem);a(b);$.each(c,function(){g[this.title]=null;$(this).css({background:"","box-shadow":""})})},v=function(a){function c(a){$.each(a,function(a,c){switch(c.title){case "\u91ca\u653e\u5de5\u5177":case "\u5207\u56fe":case "CPR\u66f2\u7ebf":case "CPR\u76f4\u7ebf":case "\u8c03\u7a97":case "\u9510\u5316":case "\u5e73\u6ed1":case "\u653e\u7f29":case "\u79fb\u52a8":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "\u6700\u5927\u5bc6\u5ea6\u6295\u5f71":case "\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71":case "\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71":case "\u692d\u5706":case "\u89d2\u5ea6":case "CT":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u5fc3\u80f8\u6bd4":case "\u4eae\u5ea6/\u5bf9\u6bd4":b.push(c)}})}var b=[],e=$("."+f.item);c(e);e=$("."+f.menuitem);c(e);for(e=0;e<b.length;e++)if(b[e].title===a)return!0;return!1},w=function(){function a(a){$.each(a,function(a,b){c.push(b)})}var c=[],b=$("."+f.item);a(b);b=$("."+f.menuitem);a(b);b=$("."+f.button);a(b);return c},q=function(a,c,b){f.item||(f.item=CBoBo.Plugin.GetRandom());a=$("\x3cspan class\x3d'item-box'\x3e\x3cspan class\x3d'icon_tool tool-item "+f.item+"' title\x3d'"+c+"'\x3e"+a+"\x3c/span\x3e\x3c/span\x3e").appendTo($("#"+f.toolbox));a.bind("click",function(a){t(a)});"[object Object]"==Object.prototype.toString.apply(b)&&a.css(b)},u=function(a,c,b){f.item||(f.item=CBoBo.Plugin.GetRandom());a=$("\x3cspan class\x3d'icon_tool tool-item "+f.item+"' title\x3d'"+c+"'\x3e"+a+"\x3cinput  type\x3d'range' min\x3d'1' max\x3d'10' step\x3d'1' value\x3d'1' style\x3d'width:100px' /\x3e\x3c/span\x3e\x3cp style\x3d'font-size:10px' id\x3d'Thickness'\x3e1mm\x3cp\x3e").appendTo($("#"+f.toolbox));a.change(function(a){$("#Thickness").html(a.target.value+"mm");a.target.title=c;t(a)});"[object Object]"==Object.prototype.toString.apply(b)&&a.css(b)},x=function(a,c,b){f.menuitem||(f.menuitem=CBoBo.Plugin.GetRandom());a=$("\x3cspan class\x3d'item-box'\x3e\x3cdiv class\x3d'tool-item "+f.menuitem+"' title\x3d'"+c+"'\x3e\x3cspan class\x3d'icon_tool' title\x3d'"+c+"'\x3e"+a+"\x3c/span\x3e\x3cspan style\x3d'font-size:14px' title\x3d'"+c+"'\x3e\u25be\x3c/span\x3e\x3c/div\x3e\x3c/span\x3e").appendTo($("#"+f.toolbox));a.bind("click",function(a){t(a)});"[object Object]"===Object.prototype.toString.apply(b)&&a.css(b)},A=function(a,c,b){f.menuitem||(f.menuitem=CBoBo.Plugin.GetRandom());a=$("\x3cdiv class\x3d'tool-item tool-item-div "+f.menuitem+"' title\x3d'"+c+" '\x3e\x3cspan title\x3d'"+c+"'\x3e\u25be\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+f.toolbox));a.bind("click",function(a){t(a)});"[object Object]"===Object.prototype.toString.apply(b)&&a.css(b);$("."+f.menuitem+" span").css({"pointer-events":"none",overflow:"hidden","white-space":"nowrap"})},z=function(a){f.line||(f.line=CBoBo.Plugin.GetRandom());var c=$("\x3cdiv class\x3d'"+f.line+"'\x3e\x3c/div\x3e").appendTo($("#"+f.toolbox));"[object Object]"==Object.prototype.toString.apply(a)&&c.css(a)},E=function(c,b,e){var d=$("div[title\x3d'"+b+"']");null==d.html()&&(f.button||(f.button=CBoBo.Plugin.GetRandom()),d=$("\x3cdiv class\x3d'"+f.button+"' title\x3d'"+b+"'\x3e"+c+"\x3c/div\x3e").appendTo($("#"+f.bottonbox)),"[object Object]"===Object.prototype.toString.call(e)&&d.css(e),d.bind("click mouseenter mouseout",function(c){if(!g[c.target.title])switch(c.type){case "mouseenter":d.css({color:"#33FFFF","text-shadow":"0 0 15px #33FFFF"});break;case "mouseout":d.css({color:"#efefef","text-shadow":""});break;case "click":G(c.target.title),a.msgtransform&&a.msgtransform(c)}}))},G=function(a){$("."+f.button).each(function(){var c=$(this);this.title==a?(g[this.title]=a,c.css({color:"#33FFFF","text-shadow":"0px 0px 20px #FFF","pointer-events":"none"})):(g[this.title]=null,c.css({animation:"",color:"#efefef","text-shadow":"","pointer-events":"auto"}))})};this.UpdateStyle=function(){var c=$(a.parent),b=$("."+f.item),e=$("."+f.menuitem),d=$("."+f.line);if("x"==a.axis){var g=$(".item-box"),h=g.length,k=20<h,l=.66*c.height()>>0,c=.9*c.width()/h*.5>>0,c=20>c?20:25<c?25:c;g.css({flex:k?1:"none"});b.css({padding:k?"4px 2px":"4px 6px","font-size":c+"px",border:"1px solid #535353",cursor:"pointer","border-radius":"6px"});e.css({padding:"2px","font-size":c+"px",border:"1px solid #535353",cursor:"pointer","border-radius":"6px"});d.css({"border-left":"1px solid #383838",width:"1px",height:l+"px",margin:"0 "+m+"px","pointer-events":"none","float":"left"});c=.75*c>>0;$("."+f.button).css({margin:"0 4px 0 0",height:l+"px",cursor:"pointer","font-size":c+"px","text-align":"center","font-family":"Microsoft YaHei","line-height":l+"px","border-radius":"4px",border:"1px solid #535353"})}else{var g=.6*c.width()>>0,c=.6*g>>0,m=c/3>>0;b.css({display:"block",padding:"2px",width:g+"px",overflow:"hidden","font-size":c+"px",border:"1px solid #444",cursor:"pointer",margin:m+"px auto","border-radius":"6px"});e.css({display:"block",padding:"2px",width:g+"px",overflow:"hidden",margin:m+"px auto","font-size":c+"px",border:"1px solid #444",cursor:"pointer","border-radius":"6px"});d.css({"border-top":"1px solid #000",width:g+"px",height:"1px",margin:m+"px auto","pointer-events":"none"})}$(".tool-item-div").css({"margin-left":"-10px",fontSize:"14px"})};this.RequestToolBar=function(a,c,d){if(a!=e.type||c!=e.msgtansform||void 0!==d){m();switch(a){case CBoBo.TOOLMENU_JPG:E("2D","2D");G("2D");q("\x26#xe631;","\u91ca\u653e\u5de5\u5177");q("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");x("\x26#xe66d;","\u5e03\u5c40");q("\x26#xe644;","\u6062\u590d");q("\x26#xe670;","\u653e\u7f29");q("\x26#xe630;","\u79fb\u52a8");q("\x26#xe603;","\u8d1f\u50cf");x("\x26#xe602;","\u4f2a\u5f69");q("\x26#xe61b;","\u4eae\u5ea6/\u5bf9\u6bd4");q("\x26#xe60f;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_SERIES:p();break;case CBoBo.TOOLMENU_DESERIES:E("2D","2D");G("2D");q("\x26#xe631;","\u91ca\u653e\u5de5\u5177");q("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");x("\x26#xe66d;","\u5e03\u5c40");q("\x26#xe644;","\u6062\u590d");q("\x26#xe606;","\u80f6\u7247\u6253\u5370");q("\x26#xe671;","DICOM\u4fe1\u606f");q("\x26#xe67a;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");z();q("\x26#xe670;","\u653e\u7f29");q("\x26#xe630;","\u79fb\u52a8");x("\x26#xe623;","\u65cb\u8f6c");z();q("\x26#xe603;","\u8d1f\u50cf");x("\x26#xe602;","\u4f2a\u5f69");z();q("\x26#xe61b;","\u8c03\u7a97");z();q("\x26#xe61f;","\u76f4\u7ebf");q("\x26#xe619;","\u77e9\u5f62");q("\x26#xe61e;","\u692d\u5706");q("\x26#xe618;","\u89d2\u5ea6");q("\x26#xe637;","CT");q("\x26#xe629;","\u6587\u672c");q("\x26#xe62f;","\u7bad\u5934");q("L","\u5de6\u6807\u8bb0");q("R","\u53f3\u6807\u8bb0");q("\x26#xe615;","\u5fc3\u80f8\u6bd4");q("\x26#xe622;","\u64a4\u9500");z();q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_PRINT_JPG:q("\x26#xe603;","\u8d1f\u50cf");q("\x26#xe644;","\u6062\u590d");q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_PRINT_RADIATE:q("\x26#xe61f;","\u76f4\u7ebf");q("\x26#xe619;","\u77e9\u5f62");q("\x26#xe61e;","\u692d\u5706");q("\x26#xe618;","\u89d2\u5ea6");q("\x26#xe637;","CT");q("\x26#xe629;","\u6587\u672c");q("\x26#xe62f;","\u7bad\u5934");q("\x26#xe622;","\u64a4\u9500");z();x("\x26#xe623;","\u65cb\u8f6c");z();q("\x26#xe603;","\u8d1f\u50cf");q("\x26#xe644;","\u6062\u590d");q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");z();q("\x26#xe67a;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");break;case CBoBo.TOOLMENU_MPR:m();n();z();q("\x26#xe61b;","\u5207\u9762\u8c03\u7a97");q("\x26#xe68b;","\u5341\u5b57\u5207\u9762");q("\x26#xe6ae;","CPR\u76f4\u7ebf");q("\x26#xe6f2;","CPR\u66f2\u7ebf");z();q("\x26#xe6ad;","\u5207\u56fe");q("\x26#xe611;","\u5012\u5e8f");z();q("\x26#xec68;","\u6700\u5927\u5bc6\u5ea6\u6295\u5f71");q("\x26#xec69;","\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71");q("\x26#xec6c;","\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71");u("\x26#xe6077;","\u5c42\u539a");G("MPR");break;case CBoBo.TOOLMENU_AI:m();break;case CBoBo.TOOLMENU_VRT:m(),n(),z(),q("\x26#xe920;","\u624b\u672f\u5200\u5185"),q("\x26#xe9c8;","\u624b\u672f\u5200\u5916"),z(),q("\x26#xe628;","\u91cd\u7f6e\u4e09\u7ef4\u89c6\u56fe"),G("3D")}b.UpdateStyle();h=$.extend({},e);e.type=a;e.msgtansform=c}};this.Request2DToolBar=function(){b.RequestToolBar(l.type,l.msgtansform,!0);b.ChangeBtnStatus("\u672c\u5730\u7f13\u5b58",CBoBo.store.db.enableImagesDB)};this.RequestGrayToolBar=function(a,c){k||(p(),b.UpdateStyle(),k=!0);if(a!=e.type||c!=e.msgtansform){switch(a){case CBoBo.TOOLMENU_JPG:b.EnableButton("MPR",!1);b.EnableButton("\u91ca\u653e\u5de5\u5177",!0);b.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);b.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);b.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);b.EnableButton("\u6062\u590d",!0);b.EnableButton("\u5e8f\u5217\u64ad\u653e",!1);b.EnableButton("\u5b9a\u4f4d\u7ebf",!1);b.EnableButton("\u80f6\u7247\u6253\u5370",!0);b.EnableButton("DICOM\u4fe1\u606f",!1);b.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);b.EnableButton("\u653e\u7f29",!0);b.EnableButton("\u79fb\u52a8",!0);b.EnableButton("\u65cb\u8f6c",!1);b.EnableButton("\u8d1f\u50cf",!0);b.EnableButton("\u4f2a\u5f69",!0);b.EnableButton("\u8c03\u7a97",!0);b.EnableButton("\u76f4\u7ebf",!1);b.EnableButton("\u77e9\u5f62",!1);b.EnableButton("\u692d\u5706",!1);b.EnableButton("\u89d2\u5ea6",!1);b.EnableButton("CT",!1);b.EnableButton("\u6587\u672c",!1);b.EnableButton("\u7bad\u5934",!1);b.EnableButton("\u5de6\u6807\u8bb0",!1);b.EnableButton("\u53f3\u6807\u8bb0",!1);b.EnableButton("\u5fc3\u80f8\u6bd4",!1);b.EnableButton("\u64a4\u9500",!1);b.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_SERIES:b.EnableButton("MPR",!0);b.EnableButton("3D",!0);b.EnableButton("AI",!0);b.EnableButton("\u91ca\u653e\u5de5\u5177",!0);b.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);b.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);b.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);b.EnableButton("\u6062\u590d",!0);b.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);b.EnableButton("\u5b9a\u4f4d\u7ebf",!0);b.EnableButton("\u80f6\u7247\u6253\u5370",!0);b.EnableButton("DICOM\u4fe1\u606f",!0);b.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);b.EnableButton("\u653e\u7f29",!0);b.EnableButton("\u79fb\u52a8",!0);b.EnableButton("\u65cb\u8f6c",!0);b.EnableButton("\u8d1f\u50cf",!0);b.EnableButton("\u4f2a\u5f69",!0);b.EnableButton("\u8c03\u7a97",!0);b.EnableButton("\u76f4\u7ebf",!0);b.EnableButton("\u77e9\u5f62",!0);b.EnableButton("\u692d\u5706",!0);b.EnableButton("\u89d2\u5ea6",!0);b.EnableButton("CT",!0);b.EnableButton("\u6587\u672c",!0);b.EnableButton("\u7bad\u5934",!0);b.EnableButton("\u5de6\u6807\u8bb0",!0);b.EnableButton("\u53f3\u6807\u8bb0",!0);b.EnableButton("\u64a4\u9500",!0);b.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_DESERIES:b.EnableButton("MPR",!1);b.EnableButton("3D",!1);b.EnableButton("\u91ca\u653e\u5de5\u5177",!0);b.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);b.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);b.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);b.EnableButton("\u6062\u590d",!0);b.EnableButton("\u5e8f\u5217\u64ad\u653e",!1);b.EnableButton("\u5b9a\u4f4d\u7ebf",!1);b.EnableButton("\u80f6\u7247\u6253\u5370",!0);b.EnableButton("DICOM\u4fe1\u606f",!0);b.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);b.EnableButton("\u653e\u7f29",!0);b.EnableButton("\u79fb\u52a8",!0);b.EnableButton("\u65cb\u8f6c",!0);b.EnableButton("\u8d1f\u50cf",!0);b.EnableButton("\u4f2a\u5f69",!0);b.EnableButton("\u8c03\u7a97",!0);b.EnableButton("\u76f4\u7ebf",!0);b.EnableButton("\u77e9\u5f62",!0);b.EnableButton("\u692d\u5706",!0);b.EnableButton("\u89d2\u5ea6",!0);b.EnableButton("CT",!0);b.EnableButton("\u6587\u672c",!0);b.EnableButton("\u7bad\u5934",!0);b.EnableButton("\u5de6\u6807\u8bb0",!0);b.EnableButton("\u53f3\u6807\u8bb0",!0);b.EnableButton("\u64a4\u9500",!0);b.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_PRINT_JPG:b.EnableButton("\u91ca\u653e\u5de5\u5177",!0);b.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);b.EnableButton("\u5e03\u5c40",!0);b.EnableButton("\u6062\u590d",!0);b.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);b.EnableButton("\u5b9a\u4f4d\u7ebf",!0);b.EnableButton("\u80f6\u7247\u6253\u5370",!0);b.EnableButton("DICOM\u4fe1\u606f",!0);b.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);b.EnableButton("\u653e\u7f29",!0);b.EnableButton("\u79fb\u52a8",!0);b.EnableButton("\u65cb\u8f6c",!0);b.EnableButton("\u8d1f\u50cf",!0);b.EnableButton("\u4f2a\u5f69",!0);b.EnableButton("\u8c03\u7a97",!0);b.EnableButton("\u76f4\u7ebf",!0);b.EnableButton("\u77e9\u5f62",!0);b.EnableButton("\u692d\u5706",!0);b.EnableButton("\u89d2\u5ea6",!0);b.EnableButton("CT",!0);b.EnableButton("\u6587\u672c",!0);b.EnableButton("\u7bad\u5934",!0);b.EnableButton("\u5de6\u6807\u8bb0",!0);b.EnableButton("\u53f3\u6807\u8bb0",!0);b.EnableButton("\u5fc3\u80f8\u6bd4",!0);b.EnableButton("\u64a4\u9500",!0);b.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_PRINT_RADIATE:b.EnableButton("\u91ca\u653e\u5de5\u5177",!0);b.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);b.EnableButton("\u5e03\u5c40",!0);b.EnableButton("\u6062\u590d",!0);b.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);b.EnableButton("\u5b9a\u4f4d\u7ebf",!0);b.EnableButton("\u80f6\u7247\u6253\u5370",!0);b.EnableButton("DICOM\u4fe1\u606f",!0);b.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);b.EnableButton("\u653e\u7f29",!0);b.EnableButton("\u79fb\u52a8",!0);b.EnableButton("\u65cb\u8f6c",!0);b.EnableButton("\u8d1f\u50cf",!0);b.EnableButton("\u4f2a\u5f69",!0);b.EnableButton("\u8c03\u7a97",!0);b.EnableButton("\u76f4\u7ebf",!0);b.EnableButton("\u77e9\u5f62",!0);b.EnableButton("\u692d\u5706",!0);b.EnableButton("\u89d2\u5ea6",!0);b.EnableButton("CT",!0);b.EnableButton("\u6587\u672c",!0);b.EnableButton("\u7bad\u5934",!0);b.EnableButton("\u5de6\u6807\u8bb0",!0);b.EnableButton("\u53f3\u6807\u8bb0",!0);b.EnableButton("\u5fc3\u80f8\u6bd4",!0);b.EnableButton("\u64a4\u9500",!0);b.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_MPR:m()}b.isFirst||(l=$.extend({},e),l.type=a,l.msgtansform=c,b.isFirst=!0);h=$.extend({},e);e.type=a;e.msgtansform=c}};this.ChangeBtnStatus=function(a,c){var e;a:{e=w();for(var d=0;d<e.length;d++){var f=e[d];switch(f.title){case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":case "\u91cd\u65b0\u52a0\u8f7d":case "\u6062\u590d":case "\u80f6\u7247\u6253\u5370":case "\u8d1f\u50cf":case "\u64a4\u9500":case "\u5220\u9664\u56fe\u50cf":continue}if(f.title==a){e=!0;break a}}e=!1}if(e){if(void 0!==c)c=!c;else a:{for(var h in g)if(g[h]==a){c=!0;break a}c=!1}if(v(a))return r(),"\u91ca\u653e\u5de5\u5177"===a&&(c=!1),b.ButtonStatus(a,!c),!c;b.ButtonStatus(a,!c)}};this.ButtonStatus=function(a,c){function b(a,c){var b;$.each(a,function(a,e){e.title==c&&(b=e)});return b}var e=$("."+f.item),e=b(e,a);e||(e=$("."+f.menuitem),e=b(e,a));e&&(c?(g[a]=a,$(e).css({background:"#777","box-shadow":"0 0 20px #aaa"})):($(e).css({background:"","box-shadow":""}),g[a]=null))};this.EnableButton=function(a,b){if(a){for(var e=w(),d,f=0;f<e.length;f++)if(e[f].title==a){d=e[f];break}d&&(a=$(d),b?(c[d.title]=null,a.css({color:"#efefef","pointer-events":""})):(c[d.title]=d.title,a.css({color:"gray","pointer-events":"none"})))}};this.BackToolBar=function(){if(h){this.RequestToolBar(h.type,h.msgtansform);for(var a in g){var e=g[a];e&&b.ButtonStatus(e,!0)}for(a in c)(e=c[a])&&b.EnableButton(e,!1)}};this.GetButtonDOM=function(a){var c;$("."+f.item).each(function(){this.title==a&&(c=this)});return c};this.IsEnable=function(a){for(var b in c)if(c[b]==a)return!1;return!0};(function(){f.bottonbox="bottonbox"+CBoBo.Plugin.GetRandom();f.toolbox="toolbox"+CBoBo.Plugin.GetRandom();$("\x3cdiv\x3e\x3cdiv id\x3d'"+f.bottonbox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+f.toolbox+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($(a.parent)).css({width:"100%",height:"100%",overflow:"hidden",display:"flex"});var c=$("#"+f.bottonbox),b=$("#"+f.toolbox);"x"==a.axis?a.bottonbox?(c.css({height:"100%",display:"flex","align-items":"center",color:"#efefef"}),b.css({height:"100%",display:"flex",flex:1,"align-items":"center",color:"#efefef","overflow-x":"auto"})):(c.hide(),b.css({width:"100%",height:"100%",overflow:"hidden","float":"left",display:"flex","align-items":"center",color:"#efefef"})):a.bottonbox?(c.css({width:"100%",height:"7%",overflow:"hidden",display:"flex","align-items":"center",color:"#efefef"}),b.css({width:"100%",height:"93%",overflow:"hidden",display:"flex","align-items":"center",color:"#efefef"})):(c.hide(),b.css({width:"100%",height:"100%",overflow:"hidden",color:"#efefef","text-align":"center"}))})()};CBoBo.View.LayoutCtrl=function(d){var b=this;this.ctrlId;this.tableId;this.specialId;this.trClass;this.tdClass;this.itemId=[];this.arrTD;this.bShow;var a,f=$.extend(!0,{msgtransform:null,radio:!1,specialbutton:!1},d);this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.tableId=CBoBo.Plugin.GetRandom();this.specialId=CBoBo.Plugin.GetRandom();this.radioId=CBoBo.Plugin.GetRandom();this.tdClass=CBoBo.Plugin.GetRandom();for(var a="\x3cdiv class\x3d'"+this.tdClass+"'\x3e\x3c/div\x3e",c="",b=0;6>b;b++)for(var d=0;6>d;d++)c+=a;$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e\x3cdiv id\x3d'"+this.radioId+"'\x3e\x3clabel\x3e\x3cinput name\x3d'cbobo' type\x3d'radio' value\x3d'1' checked/\x3e\u56fe\u50cf \x3c/label\x3e \x3clabel\x3e\x3cinput name\x3d'cbobo' type\x3d'radio' value\x3d'2' /\x3e\u5e8f\u5217 \x3c/label\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.tableId+"'\x3e"+c+"\x3c/div\x3e\x3cdiv id\x3d'"+this.specialId+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.Show=function(a){var c=$("#"+this.ctrlId);a?(this.bShow=!0,c.hide(),c.show(200)):(this.bShow=!1,c.hide(400))};this.UpdateStyle=function(){var a=$(window).width(),c=$(window).height(),b=$("#"+this.ctrlId),c=Math.max(a,c)/12>>0;117>c&&(c=117);a=c;if(f.radio){var d=.15*c;$("#"+this.radioId).height(d).width(c).show().css({"text-align":"center","font-size":"10px"});$("#"+this.radioId);a+=d}else $("#"+this.radioId).hide();b.css({width:c+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px",padding:"3px","z-index":9999999});this.arrTD=$("."+this.tdClass);c=c/7.78>>0;this.arrTD.css({border:"1px solid #585858",width:c+"px",height:c+"px",overflow:"hidden",float:"left",margin:(.1*c>>0)+"px"});if(f.specialbutton){b=$("#"+this.specialId);c=6*(c+4)-10;a-=c;c=c-.09*c>>0;d=a/7.5>>0;a-=d;b.css({width:c+"px",height:a+"px","border-top":"1px solid #b3b3b3","text-align":"center","margin-top":d+"px"});var l=c/7>>0,k=a-l>>1,m=l/6>>0;$.each(this.itemId,function(a,c){c=$("#"+c);c.css({display:"inline-block",color:"#585858","text-align":"center","line-height":l+"px","font-size":l+"px","margin-top":.7*k+"px",padding:m+"px"});0!=a&&c.css({"margin-left":k+"px"})})}else $("#"+this.specialId).hide()};this.SetPosition=function(a,c){$("#"+this.ctrlId).css({left:a+"px",top:c+"px"})};this.SpecialMenu=function(){this.PushItem(this.specialId,'"',"2*1");this.PushItem(this.specialId,",","1*2");this.PushItem(this.specialId,"H","3*N");this.PushItem(this.specialId,"G","N*3")};this.PushItem=function(a,c,b,d){var e=CBoBo.Plugin.GetRandom();this.itemId.push(e);$("\x3cspan class\x3d'rotate icon_tool' id\x3d'"+e+"' title\x3d'"+b+"'\x3e"+c+"\x3c/span\x3e").appendTo($("#"+a));void 0!=d&&$("#"+e).bind("click",d)};this.GetRadioValue=function(){return $("#"+this.radioId+" input:checked").val()};this.AddEvent=function(){$("#"+this.tableId).bind("mousemove click",function(a){switch(a.type){case "mousemove":$.each(b.arrTD,function(c,b){a.clientX>b.getBoundingClientRect().left&&a.clientY>b.getBoundingClientRect().top?b.style.background="#c6c6c6":b.style.background="#efefef"});break;case "click":var c=0,e=0;$.each(b.arrTD,function(a,b){b=$(b);6>a&&"rgb(198, 198, 198)"==b.css("background-color")&&e++;0==a&&"rgb(198, 198, 198)"==b.css("background-color")&&c++;5<a&&0==a%6&&"rgb(198, 198, 198)"==b.css("background-color")&&c++});sessionStorage.setItem("layout",c+","+e);console.log(c+","+e);null==f.msgtransform||0==c&&0==e||f.msgtransform({type:"click",target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:c,col:e,ctrltype:b.Type()})}});$("#"+this.ctrlId).bind("mouseleave",function(a){b.Show();a.btntitle=b.Type();a.btnforce=!1;f.msgtransform&&f.msgtransform(a)})};this.Type=function(b){if(void 0===b)return a;a=b};b.Create();b.SpecialMenu();b.UpdateStyle();b.AddEvent();!0};CBoBo.View.RotateCtrl=function(d){var b=this;this.ctrlId;this.itemClass;var a;this.bShow;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.itemClass=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool'\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u9006\u65f6\u9488'\x3e\x26#xe61d;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u987a\u65f6\u9488'\x3e\x26#xe61c;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u5de6\u53f3\u955c\u50cf'\x3e\x26#xe63a;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u4e0a\u4e0b\u955c\u50cf'\x3e\x26#xe639;\x3c/span\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),c=$("#"+this.ctrlId),b=Math.max(a,b)/15>>0;70>b&&(b=70);a=b/4>>0;17>a&&(a=17);c.css({width:b+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px","text-align":"center","z-index":999999999});c=$("."+this.itemClass);b=.171875*b>>0;c.css({display:"inline-block",padding:(.1*b>>0)+"px",overflow:"hidden","vertical-align":"top","font-size":b+"px",color:"#585858",border:"1px solid #b3b3b3","margin-top":(.03125*a>>0)+"px"})};this.AddEvent=function(d){$("."+this.itemClass).bind("click",function(b){void 0!=a&&a(b)});$("#"+this.ctrlId).bind("mouseleave",function(d){b.Show();d={usermsg:"ssssdafdsa132",btntitle:"\u65cb\u8f6c",btnforce:!1};a&&a(d)})};this.SetPosition=function(a,b){$("#"+this.ctrlId).css({left:a+"px",top:b+"px"})};this.Show=function(a){var b=$("#"+this.ctrlId);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(100))};a=d.msgtransform;b.Create();b.UpdateStyle();b.AddEvent();!0};CBoBo.View.PseudoColorCtrl=function(d){var b=this;this.ctrlId;this.tdClass;this.imgClass;this.bShow;var a;this.Home=function(){var a=window.config&&window.config.pseudoColorPath||"./static/dicomviewer/css/pseudocolor/";this.PushItem(0,a+"0.jpg","\u7070\u8272");this.PushItem(1,a+"1.jpg","\u5f69\u8679");this.PushItem(2,a+"2.jpg","\u9ed1\u4f53");this.PushItem(3,a+"3.jpg","\u9aa8\u9abc");this.PushItem(4,a+"4.jpg","\u5fc3\u810f");this.PushItem(5,a+"5.jpg","\u6d41\u52a8");this.PushItem(6,a+"6.jpg","Ge\u8272");this.PushItem(7,a+"7.jpg","\u7070\u8272\u5f69\u8679");this.PushItem(8,a+"8.jpg","\u70ed\u7eff");this.PushItem(9,a+"9.jpg","\u94ec\u94c1");this.PushItem(10,a+"10.jpg","\u70ed\u91d1\u5c5e");this.PushItem(11,a+"11.jpg","\u9971\u548c\u5ea61");this.PushItem(12,a+"12.jpg","\u9971\u548c\u5ea62");this.PushItem(13,a+"13.jpg","\u7ea2\u5916");this.PushItem(14,a+"14.jpg","\u58a8\u9ed1");this.PushItem(15,a+"15.jpg","\u9aa8\u9abc-\u808c\u8089");this.PushItem(16,a+"16.jpg","NIH");this.PushItem(17,a+"17.jpg","\u5f69\u86791");this.PushItem(18,a+"18.jpg","\u5f69\u86792");this.PushItem(19,a+"19.jpg","\u5f69\u86793");this.PushItem(20,a+"20.jpg","\u6bd4\u503c");this.PushItem(21,a+"21.jpg","\u7ea2\u8272\u8840\u7ba1");this.PushItem(22,a+"22.jpg","\u5149\u8c31");this.PushItem(23,a+"23.jpg","\u65af\u7279\u6069");this.PushItem(24,a+"24.jpg","UCLA")};this.PushItem=function(a,b,c){var e=$("."+this.imgClass).eq(a);e[0].onerror=function(){this.src=this.src.replace("static/","");this.onerror=void 0};e.attr("src",b);$("."+this.tdClass).eq(a).attr("title",c)};this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.tdClass=CBoBo.Plugin.GetRandom();this.imgClass=CBoBo.Plugin.GetRandom();for(var a="\x3cdiv class\x3d'"+this.tdClass+" pc-pseudocolor'\x3e\x3cimg class\x3d'"+this.imgClass+"' /\x3e\x3c/div\x3e",b="",c=0;5>c;c++)for(var e=0;5>e;e++)b+=a;$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e"+b+"\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),c=$("#"+this.ctrlId),a=Math.max(a,b)/10>>0;151>a&&(a=151);c.css({width:a+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px","z-index":999999999});c=.188*a>>0;a=.8*c>>0;$("."+this.tdClass).width(c).height(c).css({border:"1px solid #b3b3b3",overflow:"hidden",position:"relative","float":"left"});$("."+this.imgClass).width(a).height(a).css({position:"absolute",margin:"auto",left:0,top:0,bottom:0,right:0,"pointer-events":"none"})};this.AddEvent=function(d){$("."+this.tdClass).bind("click",function(b){void 0!=a&&a(b)});$("#"+this.ctrlId).bind("mouseleave",function(d){b.Show();d={usermsg:"sssssa2ss123sa",btntitle:"\u4f2a\u5f69",btnforce:!1};a&&a(d)})};this.SetPosition=function(a,b){$("#"+this.ctrlId).css({left:a+"px",top:b+"px"})};this.Show=function(a){var b=$("#"+this.ctrlId);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(400))};a=d.msgtransform;b.Create();b.Home();b.UpdateStyle();b.AddEvent();!0};CBoBo.View.LableCtrl=function(){this.ctrlId;this.bShow=!1;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e\x3ctextarea autofocus\x3e\x3c/textarea\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute","min-width":"180px","min-height":"36px","z-index":99999999});$("#"+this.ctrlId+" textarea").css({width:"100%",height:"100%","background-color":"rgba(0,0,0,0.2)",color:"#FFF",padding:"0",margin:"0"});$("#"+this.ctrlId).bind("click",function(d){d.stopPropagation()})};this.SetPosition=function(d,b){d-=2;b-=4;$("#"+this.ctrlId).css({left:d+"px",top:b+"px"})};this.Show=function(d){this.bShow=d;var b=$("#"+this.ctrlId);d?b.show():b.hide()};this.GetValue=function(){return $("#"+this.ctrlId+" textarea").val()};this.SetValue=function(d){$("#"+this.ctrlId+" textarea").val(d)};this.Create();!0};CBoBo.View.wwCtrl=function(d){var b=this;this.ctrlId;this.itemClass;var a,f;this.bShow;f=d.modalityType;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.itemClass=CBoBo.Plugin.GetRandom();$("CT"==f?"\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool icon_ww_tool'\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'CustomWWWC'\x3e\u81ea\u5b9a\u4e49\u7a97\u5bbd\u7a97\u4f4d\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Abodmen'\x3eCT Abodmen\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Lung'\x3eCT Lung\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Brain'\x3eCT Brain\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Bone'\x3eCT Bone\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Chest'\x3eCT Chest\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Head/Neck'\x3eCT Head/Neck\x3c/a\x3e\x3c/div\x3e":"\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool icon_ww_tool '\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'CustomWWWC'\x3e\u81ea\u5b9a\u4e49\u7a97\u5bbd\u7a97\u4f4d\x3c/a\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),c=$(window).height(),b=$("#"+this.ctrlId),a=Math.max(a,c)/15>>0;70>a&&(a=70);c=a/4>>0;17>c&&(c=17);b.css({width:a+"px",background:"#121212","border-bottom":"1px solid #222","border-left":"1px solid #222","border-right":"1px solid #222","border-radius":"4px","text-align":"center","z-index":999999999});$("."+this.itemClass).css({display:"block",padding:(.1*(.171875*a>>0)>>0)+"px",overflow:"hidden","vertical-align":"top","font-size":"16px",color:"#fff","margin-top":(.03125*c>>0)+"px",cursor:"pointer"})};this.AddEvent=function(d){$("."+this.itemClass).bind("click",function(c){void 0!=a&&a(c)});$("#"+this.ctrlId).bind("mouseleave",function(c){b.Show();c={usermsg:"ssssdafdsa132312",btntitle:"\u81ea\u5b9a\u4e49\u8c03\u7a97 ",btnforce:!1};a&&a(c)})};this.SetPosition=function(a,c){$("#"+this.ctrlId).css({left:a+"px",top:c+"px"})};this.Show=function(a){var c=$("#"+this.ctrlId);a?(this.bShow=!0,c.hide(),c.show(200)):(this.bShow=!1,c.hide(100))};a=d.msgtransform;b.Create();b.UpdateStyle();b.AddEvent();!0};CBoBo.View.Thumb=function(d){this.studyuid;this.bSerises;this.horv;this.arrId={};this.bFirst=this.bItemShow=!1;this.parentElem;this.seriesLen=0;this.msgTransform;this.bthumbDirect=!0;this.thumbListWidth;this.AnalysisParam(d);this.Init();this.Create();this.AddEvent();this.ShowItem(!0);this.OpenStyle();!0};CBoBo.View.Thumb.prototype.Init=function(){this.arrId.thumbitem="thumbitem"+CBoBo.Plugin.GetRandom();this.arrId.head=CBoBo.Plugin.GetRandom();this.arrId.info=CBoBo.Plugin.GetRandom();this.arrId.mode=CBoBo.Plugin.GetRandom();this.arrId.time=CBoBo.Plugin.GetRandom();this.arrId.arrow=CBoBo.Plugin.GetRandom();this.arrId.listbox="listbox"+CBoBo.Plugin.GetRandom();this.arrId.listcontain="listcontain"+CBoBo.Plugin.GetRandom();this.arrId.itemid=[];this.arrId.seriesitem="seriesitem"+CBoBo.Plugin.GetRandom();this.arrId.seriesinfo=CBoBo.Plugin.GetRandom();this.arrId.seriesinfoseries=CBoBo.Plugin.GetRandom();this.arrId.seriesimgbox=CBoBo.Plugin.GetRandom();this.arrId.seriesimg="s"+CBoBo.Plugin.GetRandom();this.arrId.progressbar=CBoBo.Plugin.GetRandom();this.arrId.progressparent=CBoBo.Plugin.GetRandom();this.arrId.progress=CBoBo.Plugin.GetRandom();this.arrId.progresspercent=CBoBo.Plugin.GetRandom()};CBoBo.View.Thumb.prototype.Create=function(){this.CreateBox();this.CreateHeadBox();this.CreateListBox()};CBoBo.View.Thumb.prototype.CreateBox=function(){$("\x3cdiv id\x3d'"+this.arrId.thumbitem+"'\x3e\x3c/div\x3e").appendTo($(this.parentElem))};CBoBo.View.Thumb.prototype.CreateHeadBox=function(){$("\x3cdiv id\x3d'"+this.arrId.head+"'\x3e\x3cspan class\x3d'"+this.arrId.info+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.info+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.info+" "+this.arrId.time+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.arrow+" icon_tool'\x3e\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.thumbitem))};CBoBo.View.Thumb.prototype.CreateListBox=function(){$("\x3cdiv id\x3d'"+this.arrId.listbox+"'\x3e\x3cdiv id\x3d'"+this.arrId.listcontain+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.thumbitem))};CBoBo.View.Thumb.prototype.SetHeadInfo=function(d,b,a){var f=$("#"+this.arrId.thumbitem+" ."+this.arrId.info);f.eq(0).html(d).attr("title",d);f.eq(1).html(b).attr("title",b);f.eq(2).html(a).attr("title",a)};CBoBo.View.Thumb.prototype.SetItemInfo=function(d,b,a){if(void 0===d)throw"SetItemInfo:mark is undefined.";"string"!==typeof d&&(d=d.toString());d=d.replace(/\./g,"");d=$("#"+d+" ."+this.arrId.seriesinfo);d.eq(0).html(b).attr("title",b);d.eq(1).html(a).attr("title",a)};CBoBo.View.Thumb.prototype.SetItemIcon=function(d,b,a,f){var g=this;if(void 0===d)throw"SetItemIcon:mark is undefined.";"string"!==typeof d&&(d=d.toString());d=d.replace(/\./g,"");$("#"+d+" img").attr("src",b).attr("title",a).click(function(a){a.series=f;g.msgTransform(a)})};CBoBo.View.Thumb.prototype.SetProgress=function(d,b){"string"!==typeof d&&(d=d.toString());d=d.replace(/\./g,"");0>b&&(b=0);if(99<b)$("#"+d+" ."+this.arrId.progressbar).hide();else{$("#"+d+" ."+this.arrId.progressbar).show();var a=$("."+this.arrId.progressparent).width()*b/100>>0;$("#"+d+" ."+this.arrId.progress).width(a);$("#"+d+" ."+this.arrId.progresspercent).html(b+"%")}};CBoBo.View.Thumb.prototype.SetHeadArrow=function(d){var b=$("#"+this.arrId.head+" ."+this.arrId.arrow);d?(b.css({color:"#1d1d1d"}),b.html("\x26#xe646;")):(b.css({color:"#c5c5c5"}),b.html("\x26#xe64a;"))};CBoBo.View.Thumb.prototype.PushSerisesItem=function(d){if(void 0===d)throw"PushSerisesItem:progressMark is undefined.";"string"!==typeof d&&(d=d.toString());d=d.replace(/\./g,"");this.seriesLen++;$("\x3cdiv class\x3d'"+this.arrId.seriesitem+"' id\x3d'"+d+"'\x3e\x3cspan class\x3d'"+this.arrId.seriesinfo+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.seriesinfo+" "+this.arrId.seriesinfoseries+"'\x3e\x3c/span\x3e\x3cdiv class\x3d'"+this.arrId.seriesimgbox+"' style\x3d'position:relative'\x3e\x3cimg class \x3d'"+this.arrId.seriesimg+"'/\x3e \x3cdiv class\x3d'"+this.arrId.progressbar+"'\x3e\x3cdiv class\x3d'"+this.arrId.progressparent+"'\x3e\x3cdiv class\x3d'"+this.arrId.progress+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d'"+this.arrId.progresspercent+"'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.listcontain))};CBoBo.View.Thumb.prototype.UpdateSeriesData=function(){var d=this,b=" ."+this.arrId.seriesimg;if(CBoBo.Plugin.GetBrowserInfo().isMobile)touch.on(b,"doubletap",function(a){void 0!=d.msgTransform&&d.msgTransform(a)});else $(b).bind("dblclick",function(a){void 0!=d.msgTransform&&d.msgTransform(a)});interact("."+this.arrId.seriesimg).draggable({onstart:function(a){$("#special2016920dragimg").remove();var b=$(a.target).clone();$("body").append(b);var d=b.width(),c=b.height();b.attr("id","special2016920dragimg").css({"z-index":"99999999999",position:"absolute",left:a.pageX-d/2+"px",top:a.pageY-c/2+"px"})},onmove:function(a){var b=$("#special2016920dragimg")[0],d=(parseFloat(b.getAttribute("data-x"))||0)+a.dx;a=(parseFloat(b.getAttribute("data-y"))||0)+a.dy;b.style.webkitTransform=b.style.transform="translate("+d+"px, "+a+"px)";b.setAttribute("data-x",d);b.setAttribute("data-y",a)},onend:function(a){$("#special2016920dragimg").remove()}})};CBoBo.View.Thumb.prototype.UpdateStyleL=function(){var d=$(this.parentElem),b=d.width();d.height();var d=$("#"+this.arrId.thumbitem),a;a=this.bFirst?0:.0476*b>>0;d.width(b).css({overflow:"hidden","padding-top":a+"px","border-bottom":"1px solid #6a6a6a",background:"#282828"});a=$("#"+this.arrId.head);a.width(b);d=.57*b>>0;a.height(d).css({cursor:"pointer"});a=$("."+this.arrId.info);var f=d/3>>0;a.height(f);a.width(b);d=.11*b>>0;a.css({"line-heihgt":f+"px",display:"block","text-overflow":"ellipsis","white-space":"nowrap","text-align":"center","font-size":d+"px"});$("."+this.arrId.time).width(.8*b>>0).css({display:"inline-block"});$("."+this.arrId.arrow).width(.2*b>>0).height(f).css({display:"inline-block","font-size":d+"px","line-height":f+"px","text-align":"center","pointer-events":"none"});var g=$("."+this.arrId.seriesitem);a=1.1*b>>0;var f=.08*b>>0,c=.06*b>>0;g.height(a).width(b-c).css({"border-bottom":"1px solid #373737","padding-top":f+"px","padding-left":c+"px","padding-bottom":"2px"});g=4<this.seriesLen?4:this.seriesLen;1>g&&(g=1);a=g*(a+f+3);f=$("#"+this.arrId.listbox);b-=4;f.width(b).css({border:"2px solid #cccccc",background:"#535353",height:a+"px",overflow:"hide",position:"relative"});$("#"+this.arrId.listcontain).css({position:"absolute",width:"100%",height:"100%"});$("#"+this.arrId.listcontain).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:400,mouseWheelPixels:800,theme:"thumbScroll",documentTouchScroll:!0,moveDragger:!1,advanced:{updateOnContentResize:!0}});$("."+this.arrId.seriesinfo).css({display:"block",color:"#c5c5c5","text-overflow":"ellipsis","white-space":"nowrap","text-align":"left","font-size":d+"px",cursor:"default"});a=$("."+this.arrId.seriesimg);f=.723*b>>0;a.width(f).height(f).css({cursor:"pointer"});g=$("."+this.arrId.seriesimgbox);a=.8*b>>0;b=.04*b>>0;g.width(a).height(f).css({"text-align":"center",background:"#3a3a3a",margin:b+"px 0px"});b=$("."+this.arrId.progressbar);g=.1866*f>>0;b.width(a).height(g).css({position:"absolute",left:0,bottom:"2px",color:"#33ffff","text-align":"left"});"1"!==simple.queryToObject().showProgress&&b.css({opacity:0});f=$("."+this.arrId.progressparent);b=.66*g>>0;a=.6*a>>0;f.height(b).width(a).css({"border-bottom":"1px solid #757575","border-right":"1px solid #757575","border-radius":"4px",background:"#363535",display:"inline-block","margin-bottom":"3px"});a=$("."+this.arrId.progress);f=.66*b>>0;b=b-f>>1;a.height(f).css({margin:b+"px 1px",background:"#33ffff"});$("."+this.arrId.progresspercent).css({"font-size":d+"px","vertical-align":"top"})};CBoBo.View.Thumb.prototype.UpdateStyleB=function(){var d=$(this.parentElem);d.width();var d=d.height(),d=d-2,b=$("#"+this.arrId.thumbitem),a;a=this.bFirst?0:.0476*d>>0;b.height(d).css({overflow:"hidden","padding-left":a+"px","border-right":"1px solid #6a6a6a",background:"#282828",display:"inline-block"});a=$("#"+this.arrId.head);b=1.2*d>>0;a.width(b-4).height(d-4).css({cursor:"pointer",display:"inline-block",border:"2px solid rgba(0,0,0,0)","white-space":"pre"});a=$("."+this.arrId.info);var f=d/3>>0;a.width(b);a.height(f);b=.11*d>>0;10>b&&(b=10);a.css({"line-height":f+"px",display:"block","text-overflow":"ellipsis","text-align":"center","font-size":b+"px"});var g=$("."+this.arrId.seriesitem);a=1.1*d>>0;f=.08*d>>0;g.height(.9*d).width(a).css({"border-right":"1px solid #373737","padding-left":f+"px","padding-right":f+"px",display:"inline-block","text-align":"center","vertical-align":"top"});g=4<this.seriesLen?4:this.seriesLen;1>g&&(g=1);f=g*(a+2*f+1);g=$("#"+this.arrId.listbox);d-=4;this.thumbListWidth=f;g.width(f).height(d).css({border:"2px solid #cccccc",background:"#535353",overflow:"hidden",position:"relative",display:"inline-block"});$("#"+this.arrId.listcontain).css({position:"absolute",height:"100%",width:f+"px"});$("#"+this.arrId.listcontain).mCustomScrollbar({axis:"x",scrollInertia:800,theme:"thumbScroll",documentTouchScroll:!0,advanced:{updateOnContentResize:!0}});$("."+this.arrId.seriesinfo).height(Math.round(.3076923076923076*d)).css({color:"#c5c5c5","text-overflow":"ellipsis","white-space":"nowrap","text-align":"center","font-size":b+"px",cursor:"default",display:"block"});$("."+this.arrId.seriesinfoseries).css({display:"none"});f=$("."+this.arrId.seriesimgbox);g=.6296296296296297*d|0;a=.8*a|0;f.height(g).width(a).css({"text-align":"center",background:"#3a3a3a",margin:"0 auto"});$("."+this.arrId.seriesimg).width(a-8).height(g).css({cursor:"pointer"});a=$("."+this.arrId.progressbar);d=.3333333333333333*d>>0;18>d&&(d=18);a.height(d).css({width:"100%",position:"absolute",left:"0px",bottom:"1px",color:"#33ffff","text-align":"left"});"1"!==simple.queryToObject().showProgress&&a.css({opacity:0});a=$("."+this.arrId.progressparent);f=.3*d>>0;d=1.333333333333333*d>>0;a.height(f).width(d).css({"border-bottom":"1px solid #757575","border-right":"1px solid #757575","border-radius":"4px",background:"#363535",display:"inline-block"});$("."+this.arrId.progress).height(f).css({margin:"1px",background:"#33ffff"});$("."+this.arrId.progresspercent).css({"font-size":b+"px",width:"20px"})};CBoBo.View.Thumb.prototype.ClearStyle=function(){$("#"+this.arrId.thumbitem).removeAttr("style");$("#"+this.arrId.head).removeAttr("style");$("."+this.arrId.info).removeAttr("style");$("."+this.arrId.time).removeAttr("style");$("."+this.arrId.arrow).removeAttr("style");$("."+this.arrId.seriesitem).removeAttr("style");$("#"+this.arrId.listbox).removeAttr("style");$("#"+this.arrId.listcontain).removeAttr("style");$("#"+this.arrId.listcontain).mCustomScrollbar("destroy");$("."+this.arrId.seriesinfo).removeAttr("style");$("."+this.arrId.seriesimg).removeAttr("style")};CBoBo.View.Thumb.prototype.UpdateStyle=function(){var d=$(window).width(),b=$(window).height();this.ClearStyle();d>b?(this.UpdateStyleL(),this.bthumbDirect=!0):(this.UpdateStyleB(),this.bthumbDirect=!1);this.OpenStyle();this.ShowItem(!0)};CBoBo.View.Thumb.prototype.ShowItem=function(d){var b=$("#"+this.arrId.listbox);this.bItemShow?d?b.show():this.bthumbDirect?b.slideDown(500):(b.show().css({transition:"width 500ms"}),b.width(this.thumbListWidth)):d?b.hide():this.bthumbDirect?b.slideUp(500):(b.css({transition:"width 500ms"}),setTimeout(function(){b.hide()},400),b.width(0))};CBoBo.View.Thumb.prototype.OpenStyle=function(){var d=$("#"+this.arrId.head),b=$("."+this.arrId.info);this.bItemShow?(this.SetHeadArrow(!0),b.css({color:"#1d1d1d",transition:"all 0.5s ease-in"}),d.css({background:"#cccccc"})):(this.SetHeadArrow(!1),b.css({color:"#c5c5c5"}),d.css({background:"#373737"}))};CBoBo.View.Thumb.prototype.First=function(){this.bFirst=!0;$("#"+this.arrId.thumbitem).css({"padding-top":"0px"});this.bItemShow=!0;this.ShowItem(!0);this.OpenStyle()};CBoBo.View.Thumb.prototype.AnalysisParam=function(d){this.parentElem=d.parentelem;this.msgTransform=d.msgtransform};CBoBo.View.Thumb.prototype.AddEvent=function(){function d(b){void 0!=a.msgTransform&&(b.tag="head",b.studyuid=a.studyuid,a.msgTransform(b))}function b(b){void 0!=a.msgTransform&&(b.tag="head",b.studyuid=a.studyuid,b.parentid=a.arrId.head,a.msgTransform(b));b.stopPropagation()}var a=this;CBoBo.Plugin.GetBrowserInfo().isMobile?($("#"+a.arrId.head).bind("touchstart",d),$("."+this.arrId.info).bind("touchstart",b)):($("#"+a.arrId.head).bind("mousedown",d),$("."+this.arrId.info).bind("mousedown",b))};CBoBo.View.Thumb.prototype.Show=function(d){d?$("#"+this.arrId.thumbitem).show():$("#"+this.arrId.thumbitem).hide()};CBoBo.View.Thumb.prototype.Destroy=function(){$("#"+this.arrId.thumbitem).remove()};CBoBo.View.ThumbManager=function(d){var b=$.extend(!0,{parent:null,msgtransform:null},d),a={};this.ThumbMsg=function(d){function f(){var b=d.parentid||d.target.id;$.each(a,function(a,c){null!==c&&void 0!==c&&(c.bItemShow=c.arrId.head==b?!c.bItemShow:!1,c.ShowItem(),c.OpenStyle())})}switch(d.type){case "touchstart":f();break;case "mousedown":"head"==d.tag&&1===d.which&&f()}null!==b.msgtransform&&b.msgtransform(d)};this.OpenLastThumb=function(){var b=Object.keys(a).length-1,d=0;$.each(a,function(a,e){null!==e&&void 0!==e&&(e.bItemShow=d==b?!0:!1,e.ShowItem(),e.OpenStyle(),d++)})};this.AddThumb=function(d){var f=new CBoBo.View.Thumb({parentelem:b.parent,msgtransform:this.ThumbMsg});f.studyuid=d;return a[d]=f};this.GetThumb=function(b){return a[b]};this.ForEach=function(b){if(b instanceof Function)for(var d in a)b(a[d],d)};this.DeleteThumb=function(b){var d=a[b];void 0!==d&&(d.Destroy(),a[b]=null)}};CBoBo.View.DVCanvas=function(d){this.canvas;this.opt=$.extend({msgtransform:null,parent:null,bdrag:!1},d);this.boxId;this.canvasId;this.bFocus=!1;this.bAnimatStop=!0;this.arrCornerInfo={};this.cornerclass;this.Create();this.GetCanvas()};CBoBo.View.DVCanvas.prototype.Destroy=function(){this.imgProcessWorker&&this.imgProcessWorker.terminate();$("#"+this.boxId).remove()};CBoBo.View.DVCanvas.prototype.Clear=function(){var d=this.GetCanvas();void 0!=d&&d.getContext("2d").clearRect(0,0,d.width,d.height)};CBoBo.View.DVCanvas.prototype.Msg=function(d){d.self=this;this.opt.msgtransform&&this.opt.msgtransform(d)};CBoBo.View.DVCanvas.prototype.GetId=function(d){switch(d){case "box":return this.boxId;case "canvas":return this.canvasId}};CBoBo.View.DVCanvas.prototype.Float=function(d){d&&$("#"+this.boxId).css("float",d)};CBoBo.View.DVCanvas.prototype.GetCanvas=function(){void 0===this.canvas&&(this.canvas=document.getElementById(this.canvasId));return this.canvas};CBoBo.View.DVCanvas.prototype.Create=function(){null!=this.opt.parent&&(this.canvasId="c"+CBoBo.Plugin.GetRandom(),this.boxId="p"+CBoBo.Plugin.GetRandom(),this.cornerclass=CBoBo.Plugin.GetRandom(),$("\x3cdiv id\x3d'"+this.boxId+"'\x3e\x3ccanvas id\x3d'"+this.canvasId+"'\x3e\x3c/canvas\x3e\x3c/div\x3e").appendTo($(this.opt.parent)),$("#"+this.boxId).css({float:"left",margin:"1px",border:"2px solid #595959"}),$("#"+this.canvasId).css({cursor:"default"}),this.AddEvent())};CBoBo.View.DVCanvas.prototype.SetRange=function(d,b){var a="#"+this.boxId;0==d||0==b?$(a).hide():($(a).show(),d>>=0,b>>=0,$("#"+this.boxId).width(d).height(b).css({position:"relative"}),a=this.GetCanvas(),a.width=d,a.height=b)};CBoBo.View.DVCanvas.prototype.AddEvent=function(d){var b=this;d=CBoBo.Plugin.GetBrowserInfo();var a="#"+this.canvasId;d.isMobile?($(a).bind("touchstart touchmove touchend",function(a){a.preventDefault();b.Msg(a)}),touch.on(a,"pinchstart pinch pinchend doubletap",function(a){"doubletap"==a.type&&(a.preventDefault(),a.stopPropagation());b.Msg(a)})):($(a).bind("dblclick click mousedown mousemove mouseup mouseout mousewheel",function(a){b.Msg(a)}),$(a).bind("touchstart touchmove touchend",function(a){b.Msg(a)}),touch.on(a,"pinchstart pinch pinchend",function(a){b.Msg(a)}));interact("#"+this.boxId).dropzone({ondragenter:function(a){$("#"+a.target.id+" canvas").css({"background-color":"rgba(255,255,255,0.1)"})},ondragleave:function(a){$("#"+a.target.id+" canvas").css({"background-color":""})},ondrop:function(a){var d=a.relatedTarget;$("#"+a.target.id+" canvas").css({"background-color":""});b.opt.msgtransform&&b.opt.msgtransform({type:"drag",imgId:d.title,canvas:b})}})};CBoBo.View.DVCanvas.prototype.StartLoadingAnimation=function(){if(this.bAnimatStop){var d=function(a,b,c,e){function f(e,g){if(!b[e]){if(!a[e]){var h="function"==typeof require&&require;if(!g&&h||h)return h(e,!0);g=Error("Cannot find module '"+e+"'");throw g.code="MODULE_NOT_FOUND",g;}g=b[e]={exports:{}};a[e][0].call(g.exports,function(b){var c=a[e][1][b];return f(c?c:b)},g,g.exports,d,a,b,c)}return b[e].exports}f(c);return f},b=this.GetCanvas();this.bAnimatStop=!1;var a=this;d({1:[function(a,b,c){var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();Object.defineProperty(c,"__esModule",{value:!0});var d=(a=a("./objects/ParticleContainer"))&&a.__esModule?a:{"default":a};a=function(){function a(b,c,e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.$canvas=b;this.context=this.$canvas.getContext("2d");this.height=this.width=0;this.params={};this.lastTime=this.tick=0;this.particleContainer=new d.default(10,c,e);this.resize(c,e)}e(a,[{key:"resize",value:function(a,b){this.width=a;this.height=b;this.particleContainer.resize(a,b);this.$canvas.width=a*window.devicePixelRatio;this.$canvas.height=b*window.devicePixelRatio}},{key:"render",value:function(){var a=Date.now();this.tick+=(a-this.lastTime)/1E3;this.context.clearRect(0,0,this.width,this.height);this.particleContainer.update(this.context,this.tick);this.lastTime=a}}]);return a}();c.default=a},{"./objects/ParticleContainer":6}],2:[function(d,g,c){function e(){a.bAnimatStop||((0,f.default)(e),l.render())}g=(g=d("./Scene"))&&g.__esModule?g:{"default":g};var f=(d=d("raf"))&&d.__esModule?d:{"default":d},l=new g.default(b,b.width,b.height);window.addEventListener("resize",function(){a.bAnimatStop||l.resize(b.width,b.height)});e()},{"./Scene":1,raf:9}],3:[function(a,b,c){var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();Object.defineProperty(c,"__esModule",{value:!0});var d=(a=a("./Vector2"))&&a.__esModule?a:{"default":a};a=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?0:arguments[0],c=1>=arguments.length||void 0===arguments[1]?0:arguments[1],e=2>=arguments.length||void 0===arguments[2]?5:arguments[2],f=3>=arguments.length||void 0===arguments[3]?"#000":arguments[3],g=4>=arguments.length||void 0===arguments[4]?0:arguments[4];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var h=5>=arguments.length||void 0===arguments[5]?1:arguments[5];this.position=new d.default(b,c);this.velocity=new d.default;this.acceleration=new d.default;this.friction=h;this.gravity=g;this.scale=window.devicePixelRatio;this.radius=e;this.color=f}e(a,[{key:"accelerate",value:function(a,b){this.acceleration.x=a;this.acceleration.y=b}},{key:"update",value:function(){this.velocity.add(this.acceleration);this.velocity.multiply(this.friction);this.velocity.y+=this.gravity;this.position.add(this.velocity)}},{key:"draw",value:function(a){a.scale(window.devicePixelRatio,window.devicePixelRatio);a.fillStyle=this.color;a.beginPath();a.arc(this.position.x,this.position.y,this.radius*this.scale,0,2*Math.PI,!1);a.fill()}}]);return a}();c.default=a},{"./Vector2":4}],4:[function(a,b,c){var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?0:arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var c=1>=arguments.length||void 0===arguments[1]?0:arguments[1];this.x=b;this.y=c}e(a,[{key:"invert",value:function(){this.x=-this.x;this.y=-this.y}},{key:"add",value:function(a){this.x+=a.x;this.y+=a.y}},{key:"subtract",value:function(a){this.x-=a.x;this.y-=a.y}},{key:"multiply",value:function(a){this.x*=a;this.y*=a}},{key:"divide",value:function(a){this.x/=a;this.y/=a}},{key:"equals",value:function(a){return this.x===a.x&&this.y===a.y}},{key:"dot",value:function(a){return this.x*a.x+this.y*a.y}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y)}},{key:"distance",value:function(a){return Math.sqrt(this.distSq(a))}},{key:"normalize",value:function(){return this.divide(this.length())}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"clone",value:function(){return new Vector(this.x,this.y)}}]);return a}();c.default=a},{}],5:[function(a,b,c){function e(a,b,c){return(a-b)/(c-b)}function d(a,b,c){return(c-b)*a+b}Object.defineProperty(c,"__esModule",{value:!0});c.normalize=e;c.lerp=d;c.map=function(a,b,c,f,g){return d(e(a,b,c),f,g)};c.clamp=function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))};c.distance=function(a,b,c,e){a=c-a;b=e-b;return Math.sqrt(a*a+b*b)};c.inRange=function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)};c.degreesToRads=function(a){return a/180*Math.PI};c.radsToDegrees=function(a){return 180*a/Math.PI};c.randomRange=function(a,b){return a+Math.random()*(b-a)}},{}],6:[function(a,b,c){var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();Object.defineProperty(c,"__esModule",{value:!0});var d=(b=a("../lib/Particle"))&&b.__esModule?b:{"default":b},f=a("../lib/math");a=function(){function a(b,c,e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.width=c;this.height=e;this.nbParticle=b;this.pool=[];this.angles=[];this.radius=Math.min(c,e)>>4;this.slice=0;this.sliceTo=2*Math.PI/this.nbParticle;this.speed=0;this.dir=1;this.populate()}e(a,[{key:"populate",value:function(){for(var a,b,c,e=0;e<this.nbParticle;e++){c=this.slice*e;a=.5*this.width+Math.cos(c)*this.radius;b=.5*this.height+Math.sin(c)*this.radius;var f=this.radius>>4;1>f&&(f=1);a=new d.default(a,b,f);a.color="#848282";this.pool.push(a);this.angles.push(c)}}},{key:"resize",value:function(a,b){this.width=a;this.height=b}},{key:"update",value:function(a,b){var c=this;this.slice>=this.sliceTo-.001&&1===this.dir&&.5<b&&(this.dir=-1);.01>=this.slice&&-.01<=this.slice&&-1===this.dir&&(this.dir=1);this.slice=(0,f.lerp)(this.dir*Math.abs(Math.sin(.8*b)),0,this.sliceTo);this.pool.forEach(function(b,e){c.angles[e]=c.slice*e;b.position.x=.5*c.width+Math.cos(c.angles[e])*c.radius;b.position.y=.5*c.height+Math.sin(c.angles[e])*c.radius;b.update();b.draw(a)})}}]);return a}();c.default=a},{"../lib/Particle":3,"../lib/math":5}],7:[function(a,b,c){(function(a){(function(){var c,e,d;"undefined"!==typeof performance&&null!==performance&&performance.now?b.exports=function(){return performance.now()}:"undefined"!==typeof a&&null!==a&&a.hrtime?(b.exports=function(){return(c()-d)/1E6},e=a.hrtime,c=function(){var a;a=e();return 1E9*a[0]+a[1]},d=c()):Date.now?(b.exports=function(){return Date.now()-d},d=Date.now()):(b.exports=function(){return(new Date).getTime()-d},d=(new Date).getTime())}).call(this)}).call(this,a("_process"))},{_process:8}],8:[function(a,b,c){function e(){n=!1;p.length?m=p.concat(m):t=-1;m.length&&d()}function d(){if(!n){var a=setTimeout(e);n=!0;for(var b=m.length;b;){p=m;for(m=[];++t<b;)p&&p[t].run();t=-1;b=m.length}p=null;n=!1;clearTimeout(a)}}function f(a,b){this.fun=a;this.array=b}function g(){}a=b.exports={};var m=[],n=!1,p,t=-1;a.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];m.push(new f(a,b));1!==m.length||n||setTimeout(d,0)};f.prototype.run=function(){this.fun.apply(null,this.array)};a.title="browser";a.browser=!0;a.env={};a.argv=[];a.version="";a.versions={};a.on=g;a.addListener=g;a.once=g;a.off=g;a.removeListener=g;a.removeAllListeners=g;a.emit=g;a.binding=function(a){throw Error("process.binding is not supported");};a.cwd=function(){return"/"};a.chdir=function(a){throw Error("process.chdir is not supported");};a.umask=function(){return 0}},{}],9:[function(a,b,c){var e=a("performance-now"),d="undefined"===typeof window?{}:window;a=["moz","webkit"];var f=d.requestAnimationFrame,g=d.cancelAnimationFrame||d.cancelRequestAnimationFrame;for(c=0;c<a.length&&!f;c++)f=d[a[c]+"RequestAnimationFrame"],g=d[a[c]+"CancelAnimationFrame"]||d[a[c]+"CancelRequestAnimationFrame"];if(!f||!g)var m=0,n=0,p=[],t=1E3/60,f=function(a){if(0===p.length){var b=e(),c=Math.max(0,t-(b-m));m=c+b;setTimeout(function(){for(var a=p.slice(0),b=p.length=0;b<a.length;b++)if(!a[b].cancelled)try{a[b].callback(m)}catch(x){setTimeout(function(){throw x;},0)}},Math.round(c))}p.push({handle:++n,callback:a,cancelled:!1});return n},g=function(a){for(var b=0;b<p.length;b++)p[b].handle===a&&(p[b].cancelled=!0)};b.exports=function(a){return f.call(d,a)};b.exports.cancel=function(){g.apply(d,arguments)}},{"performance-now":7}],10:!1},{},2,b)}};CBoBo.View.DVCanvas.prototype.StopLoadingAnimation=function(){this.bAnimatStop=!0};CBoBo.View.DVCanvas.prototype.PushCornerInfo=function(d,b){this.arrCornerInfo[d]instanceof Array||(this.arrCornerInfo[d]=[]);this.arrCornerInfo[d].push(b)};CBoBo.View.DVCanvas.prototype.ClearCornerInfo=function(){this.arrCornerInfo={};$("."+this.cornerclass).remove()};CBoBo.View.DVCanvas.prototype.ShowCornerInfo=function(){var d=this.arrCornerInfo.rt,b=this.arrCornerInfo.rb,a=this.arrCornerInfo.lb;this.DrawBox(this.arrCornerInfo.lt,"lt",3,3);this.DrawBox(d,"rt",3,3);this.DrawBox(b,"rb",3,3);this.DrawBox(a,"lb",3,3)};CBoBo.View.DVCanvas.prototype.DrawBox=function(d,b,a,f){if(void 0!==d){var g=[];d instanceof Array?g=d:g.push(d);var c,e;d="left";switch(b){case "lt":c="left";e="top";break;case "rt":c="right";e="top";d="right";break;case "rb":c="right";e="bottom";d="right";break;case "lb":c="left",e="bottom"}b="\x3cdiv class\x3d'"+this.cornerclass+"' style\x3d'position:absolute;"+c+":"+a+"px;"+e+":"+f+"px;color:#FFF;text-align:"+d+";font-size:10px;text-shadow:1px 1px 1px #000;cursor:default;pointer-events:none;'\x3e";for(a=0;a<g.length;a++)str="\x3cp\x3e"+g[a]+"\x3c/p\x3e",b+=str;$(b+"\x3c/div\x3e").appendTo("#"+this.boxId)}};CBoBo.View.DVCanvas.prototype.DrawCornerInfo=function(d){this.ClearCornerInfo();if(!(150>this.canvas.width||150>this.canvas.height)&&d instanceof Object){var b=d.image,a=window.globalStudyInfo;b.patientid&&this.PushCornerInfo("lt","ID:"+b.patientid);b.name&&this.PushCornerInfo("lt","\u59d3\u540d:"+b.name);b.mod&&this.PushCornerInfo("lt","\u8bbe\u5907:"+b.mod);b.sex&&this.PushCornerInfo("lt","\u6027\u522b:"+b.sex);b.age&&this.PushCornerInfo("lt","\u5e74\u9f84:"+b.age);b.kv&&this.PushCornerInfo("lb","\u7535\u538b:"+b.kv);b.ma&&this.PushCornerInfo("lb","\u7535\u6d41:"+b.ma);b.sliceth&&this.PushCornerInfo("lb","\u5c42\u539a:"+b.sliceth);b.studt&&this.PushCornerInfo("rt","\u65e5\u671f:"+b.studt);b.acqtm&&this.PushCornerInfo("rt","\u65f6\u95f4:"+b.acqtm);this.PushCornerInfo("rt","\u5f71\u50cf\u53f7:"+b.stuid+"-"+b.serid+"-"+b.imgnum);this.PushCornerInfo("rb","\u500d\u6570:"+d.scale);this.PushCornerInfo("rb","\u7a97\u4f4d:"+d.wc);this.PushCornerInfo("rb","\u7a97\u5bbd:"+d.ww);b.inst&&this.PushCornerInfo("rb",a.hospname||b.inst);this.ShowCornerInfo()}};CBoBo.View.CMngFirstLayer=function(d){this.opt=$.extend(!0,{parent:null,scrollsize:CBoBo.Scrollsize,msgtransform:null,single:!0},d);this.arrTag={};this.arrCanvas=[];this.checkbox;this.nLayoutCol=this.nLayoutRow=0;this.bFocus=this.bMax=!1;this.scroll;this.imageNums;this.seriesIndex;this.annStatusMng=null;this.bBorderSpColor=!1;this.focusIndex=1;var b=this;!function(){b.CreateBox();b.opt.single?b.UpdateStyle():(b.checkbox=new CBoBo.View.CheckBox({parent:"#"+b.arrTag.box,title:"\u5e8f\u5217\u5bf9\u6bd4",msgtransform:function(a){null!==b.annStatusMng&&(b.annStatusMng.compare=a)}}),b.checkbox.Show(!1))}()};CBoBo.View.CMngFirstLayer.prototype.Clear=function(){this.UpdateLayout(0,1,1);null!=this.annStatusMng&&($.each(this.arrCanvas,function(d,b){b.Clear()}),this.annStatusMng=null)};CBoBo.View.CMngFirstLayer.prototype.AnnStatusMng=function(d){if(void 0===d)return this.annStatusMng;d=(this.annStatusMng=d)?d.compare:!1;this.checkbox&&this.checkbox.On_Off(d)};CBoBo.View.CMngFirstLayer.prototype.CreateBox=function(){if(null!=this.opt.parent){this.arrTag.box="box"+CBoBo.Plugin.GetRandom();this.arrTag.canvasbox="box"+CBoBo.Plugin.GetRandom();this.arrTag.container="box"+CBoBo.Plugin.GetRandom();this.arrTag.scroll="box"+CBoBo.Plugin.GetRandom();var d=$("\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.canvasbox+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrTag.scroll+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo(this.opt.parent);void 0!=d&&(this.opt.single?d.css({position:"relative",background:"#000"}):d.css({position:"relative",background:"#000",float:"left",border:"2px solid #595959",margin:"1px"}));$("#"+this.arrTag.canvasbox).css({position:"relative","float":"left"});$("#"+this.arrTag.container).css({position:"absolute",left:0,top:0,right:0,bottom:0,margin:"auto"});$("#"+this.arrTag.scroll).css({"float":"right",position:"relative","margin-bottom":"1px","margin-right":"1px","margin-top":"1px"});return d}};CBoBo.View.CMngFirstLayer.prototype.UpdateStyle=function(){var d=$(this.opt.parent);if(void 0!=d){var b=d.width(),d=d.height();$("#"+this.arrTag.box).width(b).height(d)}};CBoBo.View.CMngFirstLayer.prototype.TriggerResize=function(d){if(this.opt.single){this.UpdateStyle();var b=1;this.scroll&&(b=this.scroll.draggerPos);this.UpdateLayout(this.imageNums,this.nLayoutRow,this.nLayoutCol,b);this.opt.msgtransform&&d&&this.opt.msgtransform(d)}};CBoBo.View.CMngFirstLayer.prototype.AddEvent=function(){};CBoBo.View.CMngFirstLayer.prototype.SetBoxRange=function(d,b){var a=$("#"+this.arrTag.box);0==d||0==b?a.hide():(a.show(),b>>=0,a.width(d>>0).height(b))};CBoBo.View.CMngFirstLayer.prototype.ShowScroll=function(d){var b=$("#"+this.arrTag.scroll),a=$("#"+this.arrTag.container),f=$("#"+this.arrTag.box),g=$("#"+this.arrTag.canvasbox),c=f.width(),f=f.height();if(d){b.width(this.opt.scrollsize-1).height(f-2).show();var c=c-this.opt.scrollsize,e=this;void 0===this.scroll&&(this.scroll=new CBoBo.View.Scroll({parent:"#"+this.arrTag.scroll,msgtransform:function(a){a.firstmng=e;null!=e.opt.msgtransform&&e.opt.msgtransform(a)},size:e.opt.scrollsize}))}else b.hide(),this.scroll=void 0;c=Math.floor(c);f=Math.floor(f);a.width(c).height(f);g.width(c).height(f)};CBoBo.View.CMngFirstLayer.prototype.GetId=function(d){if(void 0!=d)return this.arrTag[d]};CBoBo.View.CMngFirstLayer.prototype.Focus=function(d){if("[object String]"==Object.prototype.toString.apply(d))for(var b=0;b<this.arrCanvas.length;b++){var a=this.arrCanvas[b],f=$("#"+a.boxId);a.GetId("canvas")==d?(a.bFocus=!0,this.focusIndex=b,f.css({"border-color":"#33ffff"})):(a.bFocus=!1,f.css({"border-color":"#595959"}))}else if("[object Number]"==Object.prototype.toString.apply(d)&&-1<d&&d<this.arrCanvas.length){var g;g=this.opt.single?"2px solid #33ffff":"2px dashed #FFFF00";for(b=0;b<this.arrCanvas.length;b++)a=this.arrCanvas[b],f=$("#"+a.boxId),b==d?(a.bFocus=!0,this.focusIndex=b,f.css({border:g})):(a.bFocus=!1,f.css({border:"2px solid #595959"}))}};CBoBo.View.CMngFirstLayer.prototype.MsgProxy=function(d){!this.opt.single||"mousedown"!=d.type&&"touchstart"!=d.type||this.bBorderSpColor||this.Focus(d.target.id);d.mng=this;null!=this.opt.msgtransform&&this.opt.msgtransform(d)};CBoBo.View.CMngFirstLayer.prototype.AddCanvas=function(){var d=this,b=new CBoBo.View.DVCanvas({parent:"#"+this.arrTag.container,msgtransform:function(a){d.MsgProxy(a)},bdrag:this.opt.single});this.arrCanvas.push(b)};CBoBo.View.CMngFirstLayer.prototype.DeleteCanvas=function(d){if(!(void 0==d||d>this.arrCanvas.length))for(var b=this.arrCanvas.length-1;b>=d;b--)$("#"+this.arrCanvas[b].boxId).remove(),this.arrCanvas.pop()};CBoBo.View.CMngFirstLayer.prototype.SetLayout=function(d,b){var a=$("#"+this.arrTag.container),f=a.width(),a=a.height(),f=Math.floor((f-6*b)/b),a=Math.floor((a-6*d)/d),g=d*b,c=this.arrCanvas.length;if(c<g)for(;c<g;c++)this.AddCanvas();else c>g&&this.DeleteCanvas(g);$.each(this.arrCanvas,function(a,b){b.Float("left")});for(c=0;c<this.arrCanvas.length;c++){var e=this.arrCanvas[c];c<g?e.SetRange(f,a):e.SetRange(0,0)}this.nLayoutRow=d;this.nLayoutCol=b};CBoBo.View.CMngFirstLayer.prototype.GetFocusCanvas=function(){for(var d=0;d<this.arrCanvas.length;d++){var b=this.arrCanvas[d];if(b.bFocus)return b}};CBoBo.View.CMngFirstLayer.prototype.GetCanvasIndex=function(d){if(void 0==d)for(var b=0;b<this.arrCanvas.length;b++){var a=this.arrCanvas[b];if(a.bFocus)return b}else for(b=0;b<this.arrCanvas.length;b++)if(a=this.arrCanvas[b],a.GetId("canvas")==d)return b};CBoBo.View.CMngFirstLayer.prototype.GetAllCanvas=function(){return this.arrCanvas};CBoBo.View.CMngFirstLayer.prototype.GetLayoutCanvas=function(){var d=this.nLayoutRow*this.nLayoutCol,d=d>this.arrCanvas.length?this.arrCanvas.length:d;return this.arrCanvas.slice(0,d)};CBoBo.View.CMngFirstLayer.prototype.GetCanvasById=function(d){for(var b=0;b<this.arrCanvas.length;b++){var a=this.arrCanvas[b];if(a.GetId("canvas")==d)return a}};CBoBo.View.CMngFirstLayer.prototype.GetCanvas=function(d){return d<this.arrCanvas.length&&-1<d?this.arrCanvas.slice(0,d):this.arrCanvas};CBoBo.View.CMngFirstLayer.prototype.UpdateLayout=function(d,b,a,f){if(void 0!=d){if(void 0==b||void 0==a)b=0<this.nLayoutRow?this.nLayoutRow:1,a=0<this.nLayoutCol?this.nLayoutCol:1;this.imageNums=d;d>b*a?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(d/(b*a)),f)):this.ShowScroll(!1);this.SetLayout(b,a)}};CBoBo.View.CMngFirstLayer.prototype.UpdateLayoutSp3=function(d,b,a){void 0!==d&&(this.imageNums=d,3<d?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(d/3),a)):this.ShowScroll(!1),this.LayoutSp3(b))};CBoBo.View.CMngFirstLayer.prototype.LayoutSp3=function(d){var b=$("#"+this.arrTag.container);b.width();var a=b.width()-1,f=b.height()-1,b=a-6,g=f-6,a=a-12>>1,f=f-12>>1,c=this.arrCanvas.length;if(3>c)for(;3>c;c++)this.AddCanvas();else 3<c&&this.DeleteCanvas(3);var e="left";"right"===d&&(e="right");$.each(this.arrCanvas,function(a,b){b.Float(e)});switch(d){case "left":this.arrCanvas[0].SetRange(a,g);this.arrCanvas[1].SetRange(a,f);this.arrCanvas[2].SetRange(a,f);break;case "top":this.arrCanvas[0].SetRange(b,f);this.arrCanvas[1].SetRange(a,f);this.arrCanvas[2].SetRange(a,f);break;case "right":this.arrCanvas[0].SetRange(a,g);this.arrCanvas[1].SetRange(a,f);this.arrCanvas[2].SetRange(a,f);break;case "bottom":this.arrCanvas[0].SetRange(a,f),this.arrCanvas[1].SetRange(a,f),this.arrCanvas[2].SetRange(b,f)}};CBoBo.View.CMngFirstLayer.prototype.SetDefaultFocus=function(d){isNaN(d)||(d=d>this.arrCanvas.length-1?this.arrCanvas.length-1:d,this.Focus(this.arrCanvas[0>d?0:d].canvasId))};CBoBo.View.CMngFirstLayer.prototype.GetLayout=function(){return{row:this.nLayoutRow,col:this.nLayoutCol}};CBoBo.View.CMngFirstLayer.prototype.SeriesIndex=function(d){if(void 0==d)return this.seriesIndex;this.seriesIndex=d;return this};CBoBo.View.CMngFirstLayer.prototype.GetBoundary=function(){var d={},b=$("#"+this.arrTag.box),a=b.offset();d.left=a.left;d.top=a.top;d.width=b.width();d.height=b.height();return d};CBoBo.View.CMngFirstLayer.prototype.SetSpBoundaryColor=function(d,b){this.bBorderSpColor=!0;d=this.arrCanvas[d];void 0!=d&&$("#"+d.boxId).css({"border-color":b})};CBoBo.View.CMngFirstLayer.prototype.EnableScroll=function(d){this.scroll||this.ShowScroll(!0);this.scroll.Enable(d)};CBoBo.View.CMngFirstLayer.prototype.SetCanavsBoxBoundary=function(d,b){if(!isNaN(d)&&!isNaN(b)){var a=$("#"+this.arrTag.container),f=$("#"+this.arrTag.box),g=f.width(),f=f.height();this.scroll&&(g-=this.opt.scrollsize);d/=b;g/f>d?(b=f,g=b*d):b=g/d;a.width(g).height(b)}};CBoBo.View.CMngFirstLayer.prototype.SetCanvasMsgPro=function(d){$.each(this.arrCanvas,function(){this.SetMsgPro(d)})};CBoBo.View.CMngFirstLayer.prototype.Destroy=function(){$("#"+this.arrTag.box).remove()};CBoBo.View.CMngFirstLayer.prototype.GetEventImageIndex=function(d){var b=this.scroll?this.scroll.draggerPos:1,a=this.nLayoutRow,f=this.nLayoutCol;if(1>a||1>f)f=a=1;for(var g=0,c=0;c<this.arrCanvas.length;c++)if(this.arrCanvas[c]===d){g=c;break}return(b-1)*a*f+g};CBoBo.View.CMngSecondLayer=function(d){var b=this,a=$.extend(!0,{parent:null,scrollsize:CBoBo.Scrollsize},d);this.arrTag={};this.arrFirstLayer=[];this.nLayoutCol=this.nLayoutRow=0;this.scroll;this.bMax=!1;this.imageNums;this.focusIndex=1;this.CreateBox=function(){if(null!=a.parent){this.arrTag.box="box"+CBoBo.Plugin.GetRandom();this.arrTag.container="container"+CBoBo.Plugin.GetRandom();this.arrTag.scroll="scroll"+CBoBo.Plugin.GetRandom();var b=$(!0!==a.aiRead?"\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrTag.scroll+"'\x3e\x3c/div\x3e\x3c/div\x3e":"\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo(a.parent);void 0!=b&&b.css({position:"relative",background:"#000"});$("#"+this.arrTag.container).css({display:"inline-block"});$("#"+this.arrTag.scroll).css({display:"inline-block",position:"relative","margin-bottom":"1px","margin-top":"1px","margin-right":"1px"});return b}};this.UpdateStyle=function(){var b=$(a.parent);if(void 0!=b){var d=b.width(),b=b.height();$("#"+this.arrTag.box).width(d).height(b)}};this.TriggerResize=function(d){b.UpdateStyle();var f=b.scroll?b.scroll.draggerPos:1;b.UpdateLayout(b.imageNums,b.nLayoutRow,b.nLayoutCol,f);b.arrFirstLayer.forEach(function(a){f=a.scroll?a.scroll.draggerPos:1;a.UpdateLayout(a.imageNums,a.nLayoutRow,a.nLayoutCol,f)});a.msgtransform&&d&&a.msgtransform(d)};this.AddEvent=function(){};this.ShowScroll=function(d){var f=$("#"+this.arrTag.scroll),c=$("#"+this.arrTag.container),e=$("#"+this.arrTag.box);d?(f.width(a.scrollsize-1).height(e.height()-2).show(),c.width(e.width()-a.scrollsize),void 0==this.scroll&&(this.scroll=new CBoBo.View.Scroll({parent:"#"+this.arrTag.scroll,msgtransform:function(c){c.secondmng=b;a.msgtransform(c)},size:a.scrollsize}))):(f.hide(),this.scroll=void 0,c.width(e.width()));c.height(e.height())};this.Focus=function(a){var d=!1;$.each(this.arrFirstLayer,function(c,e){$.each(e.arrCanvas,function(b,c){var f=$("#"+c.boxId);c.GetId("canvas")==a?(c.bFocus=!0,e.focusIndex=b,f.css({border:"2px dashed #FFFF00"}),d=!0):(c.bFocus=!1,f.css({border:"2px solid #595959"}))});var f=$("#"+e.GetId("box"));d?(f.css({"border-color":"#33ffff"}),b.focusIndex=c,e.bFocus=!0,d=!1):(f.css({"border-color":"#595959"}),e.bFocus=!1)})};this.MsgProxy=function(b){"mousedown"!=b.type&&"touchstart"!=b.type||this.Focus(b.target.id);a.msgtransform&&a.msgtransform(b)};this.AddFirstMng=function(){var b=this;this.arrFirstLayer.push(new CBoBo.View.CMngFirstLayer({parent:"#"+this.arrTag.container,scrollsize:a.scrollsize,msgtransform:function(a){b.MsgProxy(a)},single:!1}))};this.SetLayout=function(a,b){var c=$("#"+this.arrTag.container),e=c.width(),c=c.height(),e=(e-6*b)/b,c=(c-6*a)/a,d=a*b,f=this.arrFirstLayer.length;if(f<d)for(;f<d;f++)this.AddFirstMng();for(f=0;f<this.arrFirstLayer.length;f++){var g=this.arrFirstLayer[f];f<d?g.SetBoxRange(e,c):g.SetBoxRange(0,0)}this.nLayoutRow=a;this.nLayoutCol=b;sessionStorage.setItem("layout",a+","+b)};this.GetLayout=function(){return{row:this.nLayoutRow,col:this.nLayoutCol}};this.GetActiveMng=function(){var a=[];$.each(this.arrFirstLayer,function(b,c){(c.bFocus||c.checkbox.bState)&&a.push(c)});return a};this.GetFocusMng=function(){for(var a=0;a<this.arrFirstLayer.length;a++)for(var b=this.arrFirstLayer[a],c=0;c<b.arrCanvas.length;c++)if(b.arrCanvas[c].bFocus)return b};this.GetFocusCanvas=function(){for(var a=0;a<this.arrFirstLayer.length;a++)for(var b=this.arrFirstLayer[a],c=0;c<b.arrCanvas.length;c++){var e=b.arrCanvas[c];if(e.bFocus)return e}};this.GetMng=function(a){if(void 0==a)return this.arrFirstLayer;if("[object Object]"==Object.prototype.toString.apply(a))for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];if(c.scroll==a)return c}else{if("[object Number]"==Object.prototype.toString.apply(a))return a=a>this.arrFirstLayer.length-1?this.arrFirstLayer.length-1:a,this.arrFirstLayer[0>a?0:a];if("[object String]"==Object.prototype.toString.apply(a))for(b=0;b<this.arrFirstLayer.length;b++)if(c=this.arrFirstLayer[b],c.GetId("box")==a)return c}};this.GetMngByCanvas=function(a){a=a.GetId("canvas");for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];if(c.GetCanvasById(a))return c}};this.GetAllCanvas=function(){var a=[];$.each(this.arrFirstLayer,function(b,c){a=a.concat(c.arrCanvas)});return a};this.GetCanvasById=function(a){for(var b=0;b<this.arrFirstLayer.length;b++)for(var c=this.arrFirstLayer[b].GetAllCanvas(),e=0;e<c.length;e++){var d=c[e];if(d.GetId("canvas")==a)return d}};this.GetSeriesCanvasById=function(a){for(var b={},c=0;c<this.arrFirstLayer.length;c++)for(var e=this.arrFirstLayer[c].GetAllCanvas(),d=0;d<e.length;d++)if(e[d].GetId("canvas")==a)return b.arrcanvas=e,b.mng=this.arrFirstLayer[c],b};this.UpdateLayout=function(a,b,c,e){if(void 0!=a){if(void 0==b||void 0==c)b=0<this.nLayoutRow?this.nLayoutRow:1,c=0<this.nLayoutCol?this.nLayoutCol:1;this.imageNums=a;a>b*c?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(a/(b*c)),e)):this.ShowScroll(!1);CBoBo.IsTablet&&this.ShowScroll(!1);this.SetLayout(b,c)}};this.SetDefaultFocus=function(a,b){isNaN(a)||(a=a>this.arrFirstLayer.length-1?this.arrFirstLayer.length-1:a,a=this.arrFirstLayer[0>a?0:a].GetAllCanvas(),1>a.length||this.Focus(a[b].GetId("canvas")))};this.GetLayoutCanvas=function(a){if(void 0===a)return this.GetFocusMng().GetLayoutCanvas()};this.GetLayoutMng=function(a){a=this.nLayoutRow*this.nLayoutCol;a=a>this.arrFirstLayer.length?this.arrFirstLayer.length:a;return this.arrFirstLayer.slice(0,a)};this.GetMngIndex=function(a){if(void 0===a)for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];for(a=0;a<c.arrCanvas.length;a++)if(c.arrCanvas[a].bFocus)return b}else for(b=0;b<this.arrFirstLayer.length;b++)if(c=this.arrFirstLayer[b],c.GetId("box")==a)return b};this.EachMng=function(a){a instanceof Function&&$.each(this.arrFirstLayer,function(b,c){a(c,b)})};this.Destroy=function(){$("#"+this.arrTag.box).remove()};b.CreateBox();b.UpdateStyle();b.ShowScroll(!0);!0};CBoBo.View.CheckBox=function(d){var b=this,a=$.extend(!0,{parent:null,title:"",msgtransform:null},d);this.ctrlId;this.bShow=this.bState=!1;this.dragId;var f=20,g=40;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.dragId=CBoBo.Plugin.GetRandom();var b="\x3cdiv class\x3d'seriCompareBar' id\x3d'"+this.ctrlId+"' title\x3d'"+a.title+"'\x3e\x3cdiv class\x3d'seriCompareSlide'\x3e\x3cinput type\x3d'checkbox' value\x3d'none' name\x3d'checkbox' id\x3d'"+this.dragId+"' /\x3e\x3clabel for\x3d'"+this.dragId+"'\x3e\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e";CBoBo.IsTablet&&(b="\x3cdiv class\x3d'seriCompareBar' id\x3d'"+this.ctrlId+"' title\x3d'"+a.title+"'\x3e\x3cdiv class\x3d'seriCompareSlideSP'\x3e\x3cinput type\x3d'checkbox' value\x3d'none' name\x3d'checkbox' id\x3d'"+this.dragId+"' /\x3e\x3clabel for\x3d'"+this.dragId+"'\x3e\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e");$(b).appendTo($(a.parent));$("#"+this.ctrlId).css({position:"absolute"});$("#"+this.ctrlId).css({position:"absolute"})};this.SetPositon=function(a,e){f=a;g=e;b.UpdateStyle()};this.Show=function(a){a?(this.bShow=!0,$("#"+this.ctrlId).show()):(this.bShow=!1,b.On_Off(!1),$("#"+this.ctrlId).hide())};this.On_Off=function(a){a?(b.bState=!0,$("#"+this.dragId).prop("checked",!0).next().css({left:"33px"})):(b.bState=!1,$("#"+this.dragId).prop("checked",!1).next().css({left:"2px"}))};this.AddEvent=function(){$("#"+this.dragId).bind("click",function(c){c=$(this);b.bState=c.is(":checked");b.bState?c.next().css({left:"33px"}):c.next().css({left:"2px"});null!==a.msgtransform&&a.msgtransform(b.bState)});$(window).bind("resize",function(a){b.UpdateStyle()})};this.UpdateStyle=function(){$("#"+this.ctrlId).css({right:f+"px",top:g+"px"})};b.Create();b.UpdateStyle();b.AddEvent();!0};CBoBo.View.DVPrint=function(d){function b(a,b,c){this.type=a||"";this.row=b||1;this.col=c||2}function a(a){var b=$(r.printSetting);switch(a.type){case "mouseenter":b.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":b.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":c.bShowPrintSetBox||(c.bShowPrintSetBox=!0,$("#"+h.settingBox).show(!0))}}function f(a){var b=localStorage.getItem("localPrint"),e={},d=$("#iptInputPrintName").val(),f=$("#iptInputPrintTitle").val(),g=$("#iptInputPrintAddress").val().trim(),k=$("#iptInputPrintPort").val();if(!d||""==d)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684\u540d\u79f0"),!1;if(!f||""==f)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684AETitle"),!1;if(!g||""==g)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684IP\u5730\u5740"),!1;if(!/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/.test(g))return layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740"),!1;if(k&&""!=k)isNaN(k)&&layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7aef\u53e3\u53f7");else return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684\u7aef\u53e3\u53f7"),!1;c.isAddPrint&&(e.id="print"+Date.parse(new Date));e.printName=d;e.printTitle=f;e.printAddress=g;e.printPort=k;if(b)if(b=JSON.parse(b),c.isAddPrint)b.print.push(e),b.defaultId&&""!=b.defaultId||(b.defaultId=e.id);else{for(var e=b.print,l=0;l<e.length;l++)e[l].id==a&&(e[l].printName=d,e[l].printTitle=f,e[l].printAddress=g,e[l].printPort=k);b.print=e}else a=[],b={},a.push(e),b.defaultId=e.id,b.print=a;localStorage.setItem("localPrint",JSON.stringify(b));c.closePrintBox("bShowPrintAddBox",h.settingAddBox);c.readLocalPrint();c.LoadPrintToSelelct(r.printer,"pointer")}function g(a){var d=$(r.cancelPrint);switch(a.type){case "mouseenter":d.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":d.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":c.Show(!1),d=$("#"+h.ctrl+" canvas").attr("imgID"),$.ajax({type:"get",url:u+"/CancelPrint?filmuid\x3d"+d,dataType:"json",processData:!1,contentType:!1,complete:function(d){200==d.status?(a.preventDefault(),c.Show(!1),null!=e.msgtransform&&e.msgtransform({type:"btnfocus",btntitle:"\u534f\u540c\u8bca\u65ad",btnforce:!1}),q&&q.bUpload||(k=[],m=[],n=1,p=new b,m.push(p),l.SetLayout(1,1),y(),F(),E())):$.Msg("\u6253\u5370\u53d6\u6d88\u5931\u8d25\u3002",CBoBo.MSG_ERROR)}})}}var c=this,e=$.extend(!0,{msgtransform:null,mode:1},d),h={},l,k=[],m=[],n=1,p=new b,t,r={},v,w=[],q,u=CBoBo.Plugin.GetUrlParam("WadoURL")||$("#hdurl").val();this.bShow;this.bShowPrintAddBox=this.bShowPrintSetBox=!1;this.isAddPrint=!0;this.closePrintBox=function(a,b){"bShowPrintSetBox"===a?this.bShowPrintSetBox=!1:this.bShowPrintAddBox=!1;$("#"+b).hide()};this.showPrintBox=function(a,b){"bShowPrintSetBox"===a?this.bShowPrintSetBox=!0:this.bShowPrintAddBox=!0;$("#"+b).show()};this.readLocalPrint=function(){var a=localStorage.getItem("localPrint");if(a){var a=JSON.parse(a),b=a.print;if(0<b.length){for(var c="",e=0;e<b.length;e++)c=b[e].id===a.defaultId?c+("\x3ctr class\x3d'current' id\x3d'"+b[e].id+"'\x3e"):c+("\x3ctr id\x3d'"+b[e].id+"'\x3e"),c+="\x3ctd width\x3d'35%'\x3e"+b[e].printName+"\x3c/td\x3e\x3ctd width\x3d'25%'\x3e"+b[e].printTitle+"\x3c/td\x3e\x3ctd width\x3d'25%'\x3e"+b[e].printAddress+"\x3c/td\x3e\x3ctd width\x3d'15%'\x3e"+b[e].printPort+"\x3c/td\x3e\x3c/tr\x3e";$("#"+h.tableContent).html(c);$("#"+h.tableContent+" tr").on("click",function(a){$("#"+h.tableContent+" tr").removeClass("current");$(this).addClass("current")})}else $("#"+h.tableContent).html("")}};this.PrintSearchByPrintId=function(a){var b=localStorage.getItem("localPrint"),c=null;if(b&&(b=JSON.parse(b),(b=b.print)&&0<b.length))for(var e=0;e<b.length;e++)a==b[e].id&&(c=b[e]);return c};this.LoadPrintToSelelct=function(a,b){if("pointer"==b){var c=localStorage.getItem("localPrint");if(c)if(c=JSON.parse(c),b=c.print,c=c.defaultId,b&&0<b.length){for(var e="",d=0;d<b.length;d++)e+="\x3coption value\x3d'"+b[d].id+"'\x3e"+b[d].printName+"\x3c/option\x3e";$(a).html(e);$(a).val(c).removeAttr("disabled")}else $(a).html("").attr("disabled","disabled")}};this.ModifyLocalPrint=function(a){var b=localStorage.getItem("localPrint"),b=JSON.parse(b);if((b=b.print)&&0<b.length)for(var e=0;e<b.length;e++)b[e].id==a&&($("#iptInputPrintName").val(b[e].printName),$("#iptInputPrintTitle").val(b[e].printTitle),$("#iptInputPrintAddress").val(b[e].printAddress),$("#iptInputPrintPort").val(b[e].printPort));c.showPrintBox("bShowPrintAddBox",h.settingAddBox)};var x=function(){var a=A(),b=u+"/CreatDicomFilm";l.arrCanvas[0].StartLoadingAnimation();$.ajax({type:"post",dataType:"json",url:b,data:JSON.stringify(a),complete:function(a){if(200==a.status)if(a.responseJSON.success){var b=$("#"+h.leftBox),c=new Image;c.src=u+"/GetViewFilm?uuid\x3d"+a.responseJSON.data.UID+"\x26width\x3d"+b.width()+"\x26height\x3d"+b.height()+"\x26r\x3d"+Math.random();c.onload=function(){l.arrCanvas[0].StopLoadingAnimation();var b=$("#"+h.ctrl+" canvas")[0];b.getContext("2d").clearRect(0,0,b.width,b.height);$(b).attr("imgID",a.responseJSON.data.UID);b.getContext("2d").drawImage(c,0,0,c.width,c.height)}}else $.Msg("\u6253\u5370\u80f6\u7247\u52a0\u8f7d\u5931\u8d25\u3002",CBoBo.MSG_ERROR);else $.Msg("\u6253\u5370\u80f6\u7247\u52a0\u8f7d\u5931\u8d25\u3002",CBoBo.MSG_ERROR)}})},A=function(){var a=this.CBoBo.AnnStatusManager.Get(),b,c,e=sessionStorage.getItem("layout");void 0==e?(b=3,c=2):(b=e.split(",")[1],c=e.split(",")[0]);e=new CBoBo.View.DVPrintInfo;e.ImageDisplayFormat="STANDARD\\"+b+","+c;for(b=0;b<a.length;b++){c=new CBoBo.View.DVPrintImageInfo;c.WindowLevel=a[b].viewport.wc;c.WindowWidth=a[b].viewport.ww;c.ID=a[b].viewport.image.id;c.TopLabel=a[b].viewport.image.ort;c.DownLabel=a[b].viewport.image.orb;c.LeftLabel=a[b].viewport.image.orl;c.RightLabel=a[b].viewport.image.orr;var d=new CBoBo.View.DVPrintImageDescribe;d.Describe.push("ID:"+a[b].viewport.image.accnum);d.Describe.push("\u59d3\u540d:"+a[b].viewport.image.name);d.Describe.push("\u8bbe\u5907:"+a[b].viewport.image.mod);d.Describe.push("\u6027\u522b:"+a[b].viewport.image.sex);c.TopLeftLabels=d;d=new CBoBo.View.DVPrintImageDescribe;d.Describe.push("\u65e5\u671f:"+a[b].viewport.image.studt);d.Describe.push("\u65f6\u95f4:"+a[b].viewport.image.acqtm);d.Describe.push("\u5f71\u50cf\u53f7:"+a[b].viewport.image.serid+"-"+a[b].viewport.image.stuid+"-"+a[b].viewport.image.imgnum);c.TopRightLabels=d;d=new CBoBo.View.DVPrintImageDescribe;d.Describe.push("\u500d\u6570:"+a[b].viewport.scale);d.Describe.push("\u7a97\u4f4d:"+a[b].viewport.wc);d.Describe.push("\u7a97\u5bbd:"+a[b].viewport.ww);d.Describe.push("\u533b\u9662\u540d:"+a[b].viewport.image.manu);c.DownRightLabels=d;d=new CBoBo.View.DVPrintImageDescribe;d.Describe.push("\u7535\u538b:"+a[b].viewport.image.kv);d.Describe.push("\u5c42\u539a:"+a[b].viewport.image.sliceth);c.DownLeftLabels=d;e.DicomInfos.push(c)}e.Orientation=$(r.direct).val();e.FilmSizeID=$(r.size).val();return e},z=function(){function a(a){for(var b=0;b<w.length;b++){var c=w[b];if(c.name==a)return c.printer}}var b=r.printer;$(b).empty();var c=I().hospital;c&&(c=a(c))&&$.each(c,function(){L(b,this.name,this.uid)})},E=function(){var a=$("."+h.controlItem),b=a.eq(0),c=a.eq(1),e=a.eq(2),a=a.eq(3),d=m.length;2>d?(b.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"}),e.css({"pointer-events":"none",color:"gray"}),a.css({"pointer-events":"none",color:"gray"})):2>n?(b.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"}),e.css({"pointer-events":"auto",color:"#000"}),a.css({"pointer-events":"auto",color:"#000"})):n>d-1?(b.css({"pointer-events":"auto",color:"#000"}),c.css({"pointer-events":"auto",color:"#000"}),e.css({"pointer-events":"none",color:"gray"}),a.css({"pointer-events":"none",color:"gray"})):(b.css({"pointer-events":"auto",color:"#000"}),c.css({"pointer-events":"auto",color:"#000"}),e.css({"pointer-events":"auto",color:"#000"}),a.css({"pointer-events":"auto",color:"#000"}))},G=function(a){if(a){var b=!1;a.type==p.type&&a.row==p.row&&a.col==p.col&&(b=!0);p.type=a.type;p.row=a.row;p.col=a.col;return b}},M=function(a){function b(){var a=l.GetFocusCanvas();var b=a.AnnStatus().status,c=a.AnnStatus();null!=c&&void 0!=b&&(b.Restore(),b.FitCanvas(a).DrawImg(a),c=c.ann,c.DeleteAllAnn(),c.DrawAllAnn(a,b))}function c(){var a=l.GetFocusCanvas(),b=a.AnnStatus().status;void 0!=b&&(b.SetNegative(!b.GetNegative()),b.DrawImg(a))}function e(a){var b=l.GetFocusCanvas();if(b){var c=b.AnnStatus();if(c&&(c=c.status,void 0!=c)){switch(a){case "\u9006\u65f6\u9488":c.SetRotate(270);break;case "\u987a\u65f6\u9488":c.SetRotate(90);break;case "\u5de6\u53f3\u955c\u50cf":c.FlipImage();break;case "\u4e0a\u4e0b\u955c\u50cf":c.InvertImage()}if(null!=b||void 0!=b)c.DrawImg(b),b.AnnStatus().ann.DrawAllAnn(b,c)}}}function d(){var a=l.GetFocusCanvas(),b=a.AnnStatus();if(void 0!=a&&null!=b){for(a=0;a<k.length;a++)if(b==k[a]){k.splice(a,1);break}B();F();y();C(!0);E()}}switch(a.usermsg||a.target.title){case "\u6062\u590d":b();break;case "\u65cb\u8f6c":void 0==manager.rotateCtrl&&(manager.rotateCtrl=new CBoBo.View.RotateCtrl({msgtransform:M}));manager.rotateCtrl.bShow?manager.rotateCtrl.Show(!1):(manager.rotateCtrl.SetPosition(a.clientX,a.clientY),manager.rotateCtrl.Show(!0));break;case "\u8d1f\u50cf":c();break;case "\u76f4\u7ebf":v.toolType=CBoBo.TOOL_M_LINE;break;case "\u77e9\u5f62":v.toolType=CBoBo.TOOL_M_RECT;break;case "\u692d\u5706":v.toolType=CBoBo.TOOL_M_ELLIPSE;break;case "\u89d2\u5ea6":v.toolType=CBoBo.TOOL_M_ANGLE;break;case "CT":v.toolType=CBoBo.TOOL_M_POINT;break;case "\u6587\u672c":v.toolType=CBoBo.TOOL_LABEL;void 0==manager.lableCtrl&&(manager.lableCtrl=new CBoBo.View.LableCtrl,manager.lableCtrl.Show(!1));break;case "\u7bad\u5934":v.toolType=CBoBo.TOOL_ARROW;break;case "\u5de6\u6807\u8bb0":v.toolType=CBoBo.TOOL_LEFT;break;case "\u53f3\u6807\u8bb0":v.toolType=CBoBo.TOOL_RIGHT;break;case "\u64a4\u9500":var f=l.GetFocusCanvas();if(void 0==f)break;var g=f.AnnStatus().status,h=f.AnnStatus().ann;if(void 0==g)break;g.DrawImg(f);h.PopAnn(f,g);h.DrawAllAnn(f,g);break;case "\u9006\u65f6\u9488":case "\u987a\u65f6\u9488":case "\u5de6\u53f3\u955c\u50cf":case "\u4e0a\u4e0b\u955c\u50cf":e(a.target.title);break;case "\u5220\u9664\u56fe\u50cf":d();break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":v.bShowCornerInfo=!v.bShowCornerInfo,a.btntitle="\u663e/\u9690\u56db\u89d2\u4fe1\u606f",a.btnforce=v.bShowCornerInfo,$.each(k,function(a,b){b.status.SetDrawTextFlag(v.bShowCornerInfo)}),C()}!1===v.ChangeBtnStatus(a.btntitle,a.btnforce)&&(v.toolType=CBoBo.TOOL_NULL,v.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))},J=function(d){function f(a){var c=$("#"+a.target.id);switch(a.type){case "mouseenter":c.css({color:"#CCCCC4"});break;case "mouseout":c.css({color:"#888"});break;case "click":c=new b("",-1,-1);switch(a.target.title){case "1*1":c.row=1,c.col=1;case "1*2":if(-1==c.row||-1==c.col)c.row=1,c.col=2;case "2*1":if(-1==c.row||-1==c.col)c.row=2,c.col=1;case "2*2":if(-1==c.row||-1==c.col)c.row=2,c.col=2;case "2*3":if(-1==c.row||-1==c.col)c.row=2,c.col=3;case "\u5e03\u5c40\u63a7\u4ef6":if(-1==c.row||-1==c.col)c.row=a.row,c.col=a.col;l.SetLayout(c.row,c.col);break;case "1*1+2":c.type="bottom";case "2+1*1":""==c.type&&(c.type="top");case "2*1+1":""==c.type&&(c.type="left");case "1+1*2":""==c.type&&(c.type="right");l.LayoutSp3(c.type);c.row=1;c.col=3;break;case "m*n":t||(t=new CBoBo.View.LayoutCtrl({msgtransform:J}));t.bShow?t.Show(!1):(t.SetPosition(a.clientX+3,a.clientY+3),t.Show(!0));return}a=m[n-1];a.row=c.row;a.col=c.col;a.type=c.type;B();y();F();C(!0);E();G(c)}}function k(a){$(a.target);switch(a.type){case "click":var b=n;switch(a.target.title){case "\u7b2c\u4e00\u9875":n=1;break;case "\u4e0a\u4e00\u9875":n=1>--n?1:n;break;case "\u4e0b\u4e00\u9875":n=++n>m.length?m.length:n;break;case "\u6700\u540e\u4e00\u9875":n=m.length}b!=n&&(l.scroll&&l.scroll.TriggerDragger(n),E())}}function A(a){var b=document.getElementById("csharpActiveX"),e=$(r.startPrint),d=$(r.printer).val(),f=$(r.color).val(),g=$(r.direct).val(),k=$(r.size).val(),l=localStorage.getItem("localPrint");switch(a.type){case "mouseenter":e.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":e.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":if(l){var m=$("#"+h.ctrl+" canvas").attr("imgID"),n=$("#hduseruid").val();a=u+"/ConfirmPrint?filmuid\x3d"+m;var l=JSON.parse(l),A=c.PrintSearchByPrintId(d),f="multicolour"==f?"\u5f69\u8272":"\u9ed1\u767d";if(window.ActiveXObject||"ActiveXObject"in window){if(null==b.object)return layer.msg("csharpActiveX\u63d2\u4ef6\u672a\u5b89\u88c5\uff01"),!1}else return layer.msg("\u8bf7\u4f7f\u7528IE\u6d4f\u89c8\u5668\uff01"),!1;$.ajax({type:"post",url:a,dataType:"json",complete:function(a){200==a.status?(a.responseJSON.success?b.Print(n,m,A.printTitle,A.printAddress,A.printPort,f,k,g):$.Msg("\u80f6\u7247\u6253\u5370\u5931\u8d25\u3002",CBoBo.MSG_ERROR),c.Show(!1)):$.Msg("\u80f6\u7247\u6253\u5370\u5f02\u5e38\u3002",CBoBo.MSG_ERROR)}})}else layer.msg("\u8bf7\u5148\u8bbe\u7f6e\u6253\u5370\u673a!")}}switch(d.type){case "scroll":N(d.value);break;case "change":switch(d.target.title){case "\u533b\u9662":z();case "\u6253\u5370\u673a":case "\u80f6\u7247\u5c3a\u5bf8":case "\u65b9\u5411":x()}break;case "mousewheel":var p=l.scroll;void 0!=p&&p.TriggerClick(d.deltaY);break;default:d.tooltype=v.toolType,e.msgtransform&&e.msgtransform(d)}if(d.target){switch(d.target.name){case "printSetting":a(d)}switch(d.target.title){case "1*1":case "1*1+2":case "2+1*1":case "2*1+1":case "1+1*2":case "1*2":case "2*1":case "2*2":case "2*3":case "\u5e03\u5c40\u63a7\u4ef6":case "m*n":f(d);break;case "\u7b2c\u4e00\u9875":case "\u4e0a\u4e00\u9875":case "\u4e0b\u4e00\u9875":case "\u6700\u540e\u4e00\u9875":k(d);break;case "\u5f00\u59cb\u6253\u5370":A(d);break;case "\u53d6\u6d88\u6253\u5370":g(d)}}},H=function(){var a=!1,b,e,d=$("#"+h.ctrl);$("#"+h.title).bind("mousedown",function(c){a=!0;b=new Point(c.pageX,c.pageY);c=d.offset();e=new Point(c.left,c.top)});$("#"+h.title+" a").bind("click",function(a){});$(document).bind("mousemove mouseup",function(c){switch(c.type){case "mousemove":a&&d.css({left:c.pageX-b.x+e.x+"px",top:c.pageY-b.y+e.y+"px"});break;case "mouseup":a=!1}});$("."+h.controlItem).bind("click mouseenter mouseout",function(a){J(a)});$("#printNetTest,#printerAdd,#printerChange,#printerDel,#printSetDefault,#printSetBoxClose,#printAddSubmit,#printCancelBox").bind("click",function(a){var b=JSON.parse(localStorage.getItem("localPrint")),e=document.getElementById("csharpActiveX"),d=$("#"+h.tableContent+" .current").attr("id");switch(a.target.id){case "printNetTest":null==e.object?layer.msg("csharpActiveX\u63d2\u4ef6\u672a\u5b89\u88c5\uff01"):(b=c.PrintSearchByPrintId(d),console.log(e.TestAE),e.TestAE(b.printTitle,b.printAddress,b.printPort));break;case "printerAdd":$("#iptInputPrintName").val("");$("#iptInputPrintTitle").val("");$("#iptInputPrintAddress").val("");$("#iptInputPrintPort").val("");$("#"+h.settingAddBox+"Title").text("\u6dfb\u52a0\u6253\u5370\u673a");c.isAddPrint=!0;c.showPrintBox("bShowPrintAddBox",h.settingAddBox);break;case "printerChange":d&&""!=d?(c.isAddPrint=!1,$("#"+h.settingAddBox+"Title").text("\u4fee\u6539\u6253\u5370\u673a"),c.ModifyLocalPrint(d)):layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printerDel":e=b.print;a=[];if(0<e.length){for(var g=0;g<e.length;g++)e[g].id!=d&&a.push(e[g]);b.print=a;b.defaultId==d&&(b.defaultId=0<a.length?a[0].id:"");localStorage.setItem("localPrint",JSON.stringify(b));c.readLocalPrint();c.LoadPrintToSelelct(r.printer,"pointer")}else layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printSetDefault":d&&""!=d?(b.defaultId=d,localStorage.setItem("localPrint",JSON.stringify(b)),c.LoadPrintToSelelct(r.printer,"pointer"),c.closePrintBox("bShowPrintSetBox",h.settingBox)):layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printSetBoxClose":c.closePrintBox("bShowPrintSetBox",h.settingBox);break;case "printAddSubmit":f(d);break;case "printCancelBox":c.closePrintBox("bShowPrintAddBox",h.settingAddBox)}});$(r.direct+","+r.size+","+r.color+","+r.printer).bind("change",function(a){J(a)});$(r.startPrint+","+r.cancelPrint+","+r.printSetting).bind("click mouseenter mouseout",function(a){J(a)})},F=function(){$("#"+h.pageInfo).html(n+"/"+m.length)},C=function(a){var b,c=void 0;void 0==c&&(c=n);for(var d=b=0;d<c-1;d++){var f=m[d];b+=f.row*f.col}c=m[c-1];c=c.row*c.col+b;c>k.length&&(c=k.length);b=k.slice(b,c);c=l.GetAllCanvas();e.msgtransform&&e.msgtransform({type:"draw",arrcanvas:c,arrannstatus:b,bforce:a})},y=function(){if(l){var a;1<m.length?(l.EnableScroll(!0),a=n>m.length?m.length:n):(l.EnableScroll(!1),a=1);l.scroll.SetRange(m.length,a)}},B=function(){var a=k.length;if(a){var c=m;m=[];for(var e=0,d=0;d<a;){var f=c[e];f||(f=new b);m.push(f);d+=f.row*f.col;e++}n>m.length&&(n=m.length)}},I=function(){var a={},b;for(b in r){var c=r[b],c="mode"==b?$(c+" input:checked").val():$(c).find("option:selected").val();a[b]=c}return a},N=function(a,b){a&&!isNaN(a)&&(n=a);if((a=m[n-1])&&(b||!G(a)))switch(a.type){case "left":case "top":case "right":case "bottom":l.LayoutSp3(a.type);break;default:l.SetLayout(a.row,a.col)}C(!0);F();E()},D=function(a){a=$.extend(!0,{parent:null,iconstr:"",title:"",angle:0,size:30,margin:{left:0,top:0,right:0,bottom:0},padding:{left:0,top:0,right:0,bottom:0}},a);var b=CBoBo.Plugin.GetRandom(),c=$("\x3cdiv id\x3d'"+b+"' title\x3d'"+a.title+"'\x3e"+a.iconstr+"\x3c/div\x3e").appendTo($(a.parent));$("#"+b).bind("click mouseenter mouseout",function(a){J(a)});c.css({transform:"rotate("+a.angle+"deg)","font-size":a.size+"px","float":"left","padding-left":a.padding.left+"px","padding-top":a.padding.top+"px","padding-right":a.padding.right+"px","padding-bottom":a.padding.bottom+"px","margin-left":a.margin.left+"px","margin-top":a.margin.top+"px","margin-right":a.margin.right+"px","margin-bottom":a.margin.bottom+"px",cursor:"pointer",color:"#888"});return b},K=function(a,b){if(void 0!=b&&void 0!=a){var c=CBoBo.Plugin.GetRandom(),e=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+e+"'\x3e\x3cspan\x3e"+b+"\x3c/span\x3e\x3cselect id\x3d'"+c+"' title\x3d'"+b+"'\x3e\x3c/select\x3e\x3c/div\x3e").appendTo($(a)).css({"float":"left",width:"100%","text-align":"center",height:"45px","margin-top":"6px"});$("#"+e+" span").css({width:"90%","font-size":"14px",height:"20px",cursor:"default"});$("#"+c).css({width:"90%",cursor:"pointer",height:"25px"});return c}},L=function(a,b,c){void 0!=b&&$("\x3coption value\x3d'"+c+"'\x3e"+b+"\x3c/option\x3e").appendTo($(a))},P=function(a,b,c){if(void 0!=b&&void 0!=a){var e=CBoBo.Plugin.GetRandom();a=$("\x3cdiv\x3e\x3cbutton id\x3d'"+e+"' title\x3d'"+b+"'name\x3d'"+c+"'\x3e"+b+"\x3c/button\x3e\x3c/div\x3e").appendTo($(a));"printSetting"===c?a.css({"float":"left",width:"100%",height:"30px","text-align":"center","margin-top":"100px"}):a.css({"float":"left",width:"100%",height:"30px","text-align":"center","margin-top":"6px"});$("#"+e).css({width:"90%",height:"30px",background:"#555555",color:"#CCCCC4",border:"none","font-size":"14px","font-weight":"bold","border-radius":"5px",cursor:"pointer"});return e}};this.Show=function(a){var b=$("#"+h.ctrl);a?(x(),b.fadeIn(300),this.bShow=!0):(b.fadeOut(500),this.bShow=!1)};this.RequestPrint=function(a){if(a&&!(1>a.length)){for(var b=0;b<a.length;b++){var c=a[b];c.type==CBoBo.PTYPE_SERIES&&(c.type=CBoBo.PTYPE_DESERIES);c.type==CBoBo.PTYPE_JPG?$.Msg("\u4e0d\u652f\u6301\u8d85\u58f0\u6253\u5370!"):(c.bPrint=!0,c.status.bDrawText=!0,k.push(c))}B();F();y();C(!0);E()}};(function(){h.ctrl=CBoBo.Plugin.GetRandom();h.title=CBoBo.Plugin.GetRandom();h.title=CBoBo.Plugin.GetRandom();h.titleBtn=CBoBo.Plugin.GetRandom();h.container=CBoBo.Plugin.GetRandom();h.leftBox=CBoBo.Plugin.GetRandom();h.canvasBox=CBoBo.Plugin.GetRandom();h.controlBar=CBoBo.Plugin.GetRandom();h.control=CBoBo.Plugin.GetRandom();h.controlItem=CBoBo.Plugin.GetRandom();h.pageInfo=CBoBo.Plugin.GetRandom();h.toolBox=CBoBo.Plugin.GetRandom();h.winLayout=CBoBo.Plugin.GetRandom();h.tool=CBoBo.Plugin.GetRandom();h.config=CBoBo.Plugin.GetRandom();h.toolId=CBoBo.Plugin.GetRandom();h.winLayoutId=CBoBo.Plugin.GetRandom();h.configId=CBoBo.Plugin.GetRandom();h.settingBox=CBoBo.Plugin.GetRandom();h.settingAddBox=CBoBo.Plugin.GetRandom();h.tableContent=CBoBo.Plugin.GetRandom();$("\x3cobject id\x3d'csharpActiveX' classid\x3d'clsid:CC6F4407-B2B2-47FB-AE00-7E88A7E615EC' width\x3d'0' height\x3d'0'\x3e\x3c/object\x3e\x3cdiv id\x3d'"+h.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+h.title+"'\x3e\x3cspan class\x3d'"+h.titleBtn+"'\x3e\u80f6\u7247\u6253\u5370\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.container+"'\x3e\x3cdiv id\x3d'"+h.leftBox+"'\x3e\x3cdiv id\x3d'"+h.canvasBox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.controlBar+"'\x3e\x3cdiv id\x3d'"+h.control+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.toolBox+"'\x3e\x3cdiv id\x3d'"+h.config+"'\x3e\x3cspan \x3e\u6253 \u5370 \u914d \u7f6e\x3c/span\x3e\x3cdiv id\x3d'"+h.configId+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e''\x3cdiv id\x3d'"+h.settingBox+"' class\x3d'zzhsettingBox'\x3e\x3cdiv class\x3d'title-container'\x3eDICOM \u6253\u5370\u673a\u914d\u7f6e\x3c/div\x3e\x3cdiv class\x3d'setting-content'\x3e\x3cdiv class\x3d'operation-container'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printNetTest'\x3e\u7f51\u7edc\u6d4b\u8bd5\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerAdd'\x3e\u6dfb\u52a0\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerChange'\x3e\u4fee\u6539\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerDel'\x3e\u5220\u9664\x3c/button\x3e\x3c/div\x3e\x3cdiv class\x3d'table-content'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3cthead\x3e\x3ctr\x3e\x3cth width\x3d'35%'\x3e\u540d\u79f0\x3c/th\x3e\x3cth width\x3d'25%'\x3eAET\x3c/th\x3e\x3cth width\x3d'25%'\x3e\u5730\u5740\x3c/th\x3e\x3cth width\x3d'15%'\x3e\u7aef\u53e3\x3c/th\x3e\x3c/tr\x3e\x3c/thead\x3e\x3c/table\x3e\x3cdiv class\x3d'contentScroll'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' id\x3d'"+h.tableContent+"'\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-container setting-footer'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printSetDefault'\x3e\u8bbe\u4e3a\u9ed8\u8ba4\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printSetBoxClose'\x3e\u5173\u95ed\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.settingAddBox+"' class\x3d'addPrintterContainer'\x3e\x3cdiv class\x3d'title-container' id\x3d'"+h.settingAddBox+"Title'\x3e\u6dfb\u52a0\u6253\u5370\u673a\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3e\u6253\u5370\u673a\u540d\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintName'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3eAETitle\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintTitle'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3eIP\u5730\u5740\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintAddress'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3e\u7aef\u53e3\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text 'maxlength\x3d'5'id\x3d'iptInputPrintPort'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-container setting-footer'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printAddSubmit'\x3e\u786e\u5b9a\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printCancelBox'\x3e\u53d6\u6d88\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));var a=.8*$(window).width()>>0,a=800>a?800:a;$("#"+h.ctrl).width(a).height(820).css({border:"1px solid #676767",position:"absolute","z-index":"9999",background:"#444444",display:"none","user-select":"none",color:"#CCCCC4"});$("#"+h.title).css({height:"30px",width:"100%",background:"#555555",cursor:"move"});$("."+h.titleBtn).css({width:"100%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+h.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+h.container).css({position:"relative"});var e=$("#"+h.leftBox);leftBoxWidth=a-202;e.width(leftBoxWidth).height(790).css({"float":"left"});$("#"+h.canvasBox).width(leftBoxWidth).height(745).css({"border-bottom":"1px solid #676767"});$("#"+h.controlBar).height(44).css({width:"100%"});$("#"+h.control).height(44).width(220).css({"float":"right","text-align":"center","font-size":"25px","line-height":"40px",color:"#000"});$("."+h.controlItem).css({cursor:"pointer",margin:"0 10px"});$("#"+h.pageInfo).css({color:"#CCCCC4","font-size":"18px","vertical-align":"middle",cursor:"default"});$("#"+h.toolBox).css({height:"590px",width:"200px","float":"right","border-left":"1px solid #676767","border-top":"1px solid #000"});$("#"+h.toolBox+" span").css({width:"100%","text-align":"center",display:"inline-block","font-size":"14px",background:"#555555",cursor:"default",color:"rgba(255,255,255,0.8)"});$("#"+h.winLayout).height(100);$("#"+h.tool).css({height:"490px",width:"25%",display:"inline-block","border-right":"1px solid #676767",overflow:"hidden"});$("#"+h.config).css({height:"490px",width:"100%",display:"inline-block",overflow:"hidden"});$("#"+h.winLayoutId).height(84).css({overflow:"hidden"});$("#"+h.toolId).height(474).css({overflow:"hidden",width:"50px"});$("#"+h.configId).height(474).css({overflow:"hidden"});var d=$("body"),a=$("#"+h.ctrl),e=d.width(),d=d.height(),f=a.width(),g=a.height();a.css({left:(e-f>>1)+"px",top:(d-g>>1)+"px"});E();new CBoBo.View.CMngFirstLayer;v=new CBoBo.View.PCToolBar({parent:"#"+h.toolId,axis:"y",bottonbox:!1});v.RequestToolBar(CBoBo.TOOLMENU_PRINT_RADIATE,M);v.ChangeBtnStatus("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);l=new CBoBo.View.CMngFirstLayer({parent:"#"+h.canvasBox,single:!0,msgtransform:J});m.push(new b);y();l.SetLayout(1,1);l.SetDefaultFocus(0);D({parent:"#"+h.winLayoutId,iconstr:"\x26#xe667;",title:"1*1",angle:0,size:30,margin:{left:5,top:4,right:5,bottom:5},padding:{left:0,top:0,right:0,bottom:0}});e="#"+h.configId;a="#"+K(e,"\u80f6\u7247\u5c3a\u5bf8");r.size=a;L(a,"8INX10IN","8INX10IN");L(a,"10INX12IN","10INX12IN");L(a,"10INX14IN","10INX14IN");L(a,"11INX14IN","11INX14IN");L(a,"14INX14IN","14INX14IN");L(a,"14INX17IN","14INX17IN");a="#"+K(e,"\u65b9\u5411");r.direct=a;L(a,"\u7eb5\u5411","PORTRAIT");L(a,"\u6a2a\u5411","LANDSCAPE");a="#"+K(e,"\u989c\u8272");r.color=a;L(a,"\u5f69\u8272","multicolour");L(a,"\u7070\u9636","grayscale");a="#"+K(e,"\u6253\u5370\u673a");r.printer=a;c.LoadPrintToSelelct(a,"pointer");a="#"+P(e,"\u5f00\u59cb\u6253\u5370");r.startPrint=a;a="#"+P(e,"\u53d6\u6d88\u6253\u5370");r.cancelPrint=a;H()})()};CBoBo.View.DVPrintInfo=function(){this.DicomInfos=[];this.ImageDisplayFormat;this.Size;this.Direct};CBoBo.View.DVPrintImageInfo=function(){this.ID;this.WindowLevel;this.WindowWidth;this.Multiple;this.TopLeftLabels;this.TopRightLabels;this.DownLeftLabels;this.DownRightLabels;this.TopLabel;this.DownLabel;this.LeftLabel;this.RightLabel};CBoBo.View.DVPrintImageDescribe=function(){this.Describe=[]};CBoBo.View.MenuBall=function(){this.breatheID;this.touchStartPosX;this.touchStartPosY;this.CircleLeft;this.CircleTop;this.CircleWidth;this.CircleHeight;this.breatheRadius;this.breatheCentreX;this.breatheCentreY;this.documentWidth;this.documentHeight;this.startTimeStamp;this.HomeMenu;this.CentreClick;this.CreateBall=function(){this.breatheID="#breatheBall";$('\x3cdiv id\x3d"menuCircle" class\x3d\'icon_tool\'\x3e\x3cdiv id \x3d"menuRing"\x3e\x3c/div\x3e\x3cdiv id\x3d"breatheBall"\x3e\x3c/div\x3e\x3c/div\x3e').appendTo($("body"));this.Int();this.AddEnvent()};this.SetMainMenu=function(d){this.HomeMenu=d;this.HomeMenu()};this.Animation=function(d){switch(d){case 1:$("#menuRing").addClass("itemRingRotate");setTimeout("$('#menuRing').removeClass('itemRingRotate');",700);break;case 2:$("#menuRing").addClass("itemRingRotate1");setTimeout("$('#menuRing').removeClass('itemRingRotate1');",700);break;case 3:$("#menuRing").addClass("itemRingFade"),setTimeout("$('#menuRing').removeClass('itemRingFade');",700)}};this.CloseRingMenu=function(){$("#menuCircle").hasClass("open")&&$("#menuCircle").removeClass("open")};this.OpenRingMenu=function(d){$("#menuCircle").hasClass("open")||$("#menuCircle").addClass("open")};this.Clear=function(){$(".menuItem").unbind();$("#menuRing").empty();this.CentreClick=null};this.SetCentreIcon=function(d){var b=$(this.breatheID);b.empty();$("\x3cspan class\x3dbreatheBallCentre\x3e"+d+"\x3c/span\x3e").appendTo(b)};this.Push=function(d,b,a,f){void 0==b&&(b="");var g="cMenuItem"+CBoBo.Plugin.GetRandom();d="\x3cdiv class\x3d'menuItem' id\x3d\""+g+("\" title\x3d'"+b+"'\x3e\x3cp style\x3d'pointer-events:none;'\x3e"+d+"\x3c/p\x3e\x3cp class\x3d\"itemTitle\" style\x3d'pointer-events:none;'\x3e")+b;d+="\x3c/p\x3e\x3c/div\x3e";$(d).appendTo($("#menuRing"));if(void 0!=a){var g="#"+g,c=g+" p:first-child",e=g+" p:last-child",h=this;$(g).bind("touchstart",function(a){h.startTimeStamp=a.timeStamp;$(e).css("color","#67CBFA")});$(g).bind("touchend",function(b){if(200>b.timeStamp-h.startTimeStamp){var d=$(c).text();h.SetCentreIcon(d);a(b)}$(e).css("color","#FFF")})}f&&$(c).css({transform:"rotate("+f+"deg)"})};this.PushImage=function(d,b,a){var f=CBoBo.Plugin.GetRandom();$("\x3cdiv class\x3d'menuItem' id\x3d'"+f+"' title\x3d'"+b+"'\x3e\x3cimg class\x3d'pseudocolor' src\x3d'"+d+"'/\x3e\x3cdiv class\x3d'itemTitle' style\x3d'pointer-events:none;'\x3e"+b+"\x3c/div\x3e\x3c/div\x3e").appendTo($("#menuRing"));if(void 0!=a){d="#"+f;var g=d+" p:first-child",c=d+" p:last-child",e=this;$(d).bind("touchstart",function(a){e.startTimeStamp=a.timeStamp;$(c).css("color","#67CBFA")});$(d).bind("touchend",function(b){if(200>b.timeStamp-e.startTimeStamp){var d=$(g).text();e.SetCentreIcon(d);a(b)}$(c).css("color","#FFF")})}};this.FlushMenu=function(){for(var d=document.querySelectorAll(".menuItem"),b=0,a=d.length;b<a;b++)d[b].style.left=(50-35*Math.cos(-.5*Math.PI-1/a*2*b*Math.PI)).toFixed(4)+"%",d[b].style.top=(50+35*Math.sin(-.5*Math.PI-1/a*2*b*Math.PI)).toFixed(4)+"%"};this.Int=function(){this.breatheRadius=$(this.breatheID).width()/2;this.documentWidth=$(window).width()-1;this.documentHeight=$(window).height()-1;this.CircleWidth=$("#menuCircle").width();this.CircleHeight=$("#menuCircle").height()};this.AddEnvent=function(){var d=this;$(this.breatheID).bind("touchstart",function(b){d.BreatheTouchStart(b)});$(this.breatheID).bind("touchmove",function(b){d.BreatheTouchMove(b)});$(this.breatheID).bind("touchend",function(b){d.BreatheTouchEnd(b)});$(document).bind("touchstart",function(b){d.DocumentTouchStart(b)});$(document).bind("touchend",function(b){d.DocumentTouchEnd(b)});$("#menuCircle").bind("touchmove touchstart touchend",function(b){d.CircleEvent(b)})};this.WindowResize=function(d){d=$(window).width();var b=$(window).height();this.CircleLeft=$("#menuCircle").offset().left;this.CircleTop=$("#menuCircle").offset().top;var a=this.CircleLeft*d/this.documentWidth,f=this.CircleTop*b/this.documentHeight,g=d-this.CircleWidth/2-this.breatheRadius-2,c=-this.CircleWidth/2+this.breatheRadius+2,e=b-this.CircleHeight/2-this.breatheRadius-2,h=-this.CircleHeight/2+this.breatheRadius+2;a>g?a=g:a<c&&(a=c);f>e?f=e:f<h&&(f=h);$("#menuCircle").css({left:a+"px",top:f+"px"});this.documentWidth=d;this.documentHeight=b};this.BreatheTouchStart=function(d){this.startTimeStamp=d.timeStamp;d=d.originalEvent.targetTouches[0];this.touchStartPosX=d.screenX;this.touchStartPosY=d.screenY;this.CircleLeft=$("#menuCircle").offset().left;this.CircleTop=$("#menuCircle").offset().top};this.BreatheTouchMove=function(d){d.preventDefault();d=d.originalEvent.targetTouches[0];this.breatheCentreX=d.screenX;this.breatheCentreY=d.screenY;d=this.breatheCentreX-this.touchStartPosX+this.CircleLeft;var b=this.breatheCentreY-this.touchStartPosY+this.CircleTop,a=this.documentWidth-this.CircleWidth-2,f=this.documentHeight-this.CircleHeight-2;d>a?d=a:1>d&&(d=1);b>f?b=f:1>b&&(b=1);$("#menuCircle").css({left:d+"px",top:b+"px"})};this.SetCentreClick=function(d){this.CentreClick=d};this.BreatheTouchEnd=function(d){200>d.timeStamp-this.startTimeStamp&&(void 0==this.CentreClick||null==this.CentreClick?0<document.querySelectorAll(".menuItem").length&&$("#menuCircle").toggleClass("open"):(this.CentreClick(),this.CentreClick=null))};this.DocumentTouchStart=function(d){this.startTimeStamp=d.timeStamp};this.DocumentTouchEnd=function(d){200>d.timeStamp-this.startTimeStamp&&(this.CloseRingMenu(),this.Clear(),this.HomeMenu())};this.CircleEvent=function(d){d.stopPropagation();d.preventDefault()}};CBoBo.View.MobileMenuBall=function(d){var b=this;this.menuBall;var a=d.msgtransform,f,g=!1,c;this.toolType;this.bShowCornerInfo=!0;this.menuBall=new CBoBo.View.MenuBall;this.menuBall.CreateBall();this.SeriesHomeMenu=function(){b.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",b.MsgTransform);b.menuBall.Push("\x26#xe61b;","\u8c03\u7a97",b.MsgTransform);b.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",b.MsgTransform);b.menuBall.Push("\x26#xe644;","\u6062\u590d",b.MsgTransform);b.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",b.MsgTransform);b.menuBall.Push("\x26#xe604;","\u6d4b\u91cf",b.MsgTransform);b.menuBall.Push("\x26#xe60d;","\u65cb\u8f6c",b.MsgTransform);b.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",b.MsgTransform);b.menuBall.Push("\x26#xe63d;","\u5e8f\u5217\u5e03\u5c40",b.MsgTransform);b.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",b.MsgTransform);b.menuBall.Push("\x26#xe643;","MPR",b.MsgTransform);b.menuBall.FlushMenu()};this.DeSeriesHomeMenu=function(){b.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",b.MsgTransform);b.menuBall.Push("\x26#xe61b;","\u8c03\u7a97",b.MsgTransform);b.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",b.MsgTransform);b.menuBall.Push("\x26#xe644;","\u6062\u590d",b.MsgTransform);b.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",b.MsgTransform);b.menuBall.Push("\x26#xe604;","\u6d4b\u91cf",b.MsgTransform);b.menuBall.Push("\x26#xe60d;","\u65cb\u8f6c",b.MsgTransform);b.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",b.MsgTransform);b.menuBall.Push("\x26#xe63d;","\u5e8f\u5217\u5e03\u5c40",b.MsgTransform);b.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",b.MsgTransform);b.menuBall.FlushMenu()};this.JpgHomeMenu=function(){b.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",b.MsgTransform);b.menuBall.Push("\x26#xe61b;","\u4eae/\u5bf9\u6bd4",b.MsgTransform);b.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",b.MsgTransform);b.menuBall.Push("\x26#xe644;","\u6062\u590d",b.MsgTransform);b.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",b.MsgTransform);b.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",b.MsgTransform);b.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",b.MsgTransform);b.menuBall.FlushMenu()};this.MprHomeMenu=function(){b.menuBall.Push("\x26#xe658;","2D",b.MsgTransform);b.menuBall.Push("\x26#xe61b;","\u5207\u9762\u8c03\u7a97",b.MsgTransform);b.menuBall.Push("\x26#xe6aa;","\u5341\u5b57\u5207\u9762",b.MsgTransform);b.menuBall.FlushMenu()};this.MsgTransform=function(d){switch(d.target.title){case "\u6d4b\u91cf":b.MeasureMenu();break;case "\u65cb\u8f6c":b.RotateMenu();break;case "\u56fe\u50cf\u5e03\u5c40":case "\u5e8f\u5217\u5e03\u5c40":c=d.target.title;b.LayoutMenu();break;case "\u4f2a\u5f69":b.PseudoColor();break;case "\u8c03\u7a97":case "\u4eae/\u5bf9\u6bd4":case "\u6062\u590d":case "\u79fb\u52a8":case "\u8d1f\u50cf":case "\u5220\u9664\u56fe\u50cf":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "CT":case "\u692d\u5706":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u91cd\u65b0\u52a0\u8f7d":case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":b.menuBall.CloseRingMenu();void 0!==a&&a(d);break;case "1x1":d={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:1,ctrltype:c};void 0!=a&&a(d);break;case "1x2":d={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:2,ctrltype:c};void 0!=a&&a(d);break;case "2x1":d={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:1,ctrltype:c};void 0!=a&&a(d);break;case "2x2":d={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:2,ctrltype:c};void 0!=a&&a(d);break;case "2x3":d={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:3,ctrltype:c};void 0!=a&&a(d);break;case "3x2":d={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:3,col:2,ctrltype:c};void 0!=a&&a(d);break;case "3x3":d={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:3,col:3,ctrltype:c};void 0!=a&&a(d);break;case "MPR":g=!0;b.Clear();e();a&&a(d);break;case "2D":g=!1,b.Clear(),e();default:void 0!=a&&a(d)}};this.RequestToolBall=function(b,c){if(b!==f||a!==c)f=b,a=c,e()};this.PseudoColor=function(){b.Clear(3);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/0.jpg","\u7070\u8272",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/1.jpg","\u5f69\u8679",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/2.jpg","\u9ed1\u4f53",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/3.jpg","\u9aa8\u9abc",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/4.jpg","\u5fc3\u810f",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/5.jpg","\u6d41\u52a8",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/6.jpg","Ge\u8272",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/8.jpg","\u70ed\u7eff",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/9.jpg","\u94ec\u94c1",b.MsgTransform);b.menuBall.PushImage("./dicomviewer/css/pseudocolor/10.jpg","\u70ed\u91d1\u5c5e",b.MsgTransform);b.menuBall.FlushMenu();b.menuBall.SetCentreClick(b.BackHome)};this.RotateMenu=function(){b.Clear(3);b.menuBall.Push("\x26#xe61d;","\u9006\u65f6\u9488",b.MsgTransform);b.menuBall.Push("\x26#xe61c;","\u987a\u65f6\u9488",b.MsgTransform);b.menuBall.Push("\x26#xe63a;","\u5de6\u53f3\u955c\u50cf",b.MsgTransform);b.menuBall.Push("\x26#xe639;","\u4e0a\u4e0b\u955c\u50cf",b.MsgTransform);b.menuBall.FlushMenu();b.menuBall.SetCentreClick(b.BackHome)};this.MeasureMenu=function(){b.Clear(3);b.menuBall.Push("\x26#xe61f;","\u76f4\u7ebf",b.MsgTransform);b.menuBall.Push("\x26#xe619;","\u77e9\u5f62",b.MsgTransform);b.menuBall.Push("\x26#xe637;","CT",b.MsgTransform);b.menuBall.Push("\x26#xe61e;","\u692d\u5706",b.MsgTransform);b.menuBall.Push("\x26#xe629;","\u6587\u672c",b.MsgTransform);b.menuBall.Push("\x26#xe62f;","\u7bad\u5934",b.MsgTransform);b.menuBall.Push("L","\u5de6\u6807\u8bb0",b.MsgTransform);b.menuBall.Push("R","\u53f3\u6807\u8bb0",b.MsgTransform);b.menuBall.Push("\x26#xe622;","\u64a4\u9500",b.MsgTransform);b.menuBall.FlushMenu();b.menuBall.SetCentreClick(b.BackHome)};this.LayoutMenu=function(){b.Clear(3);b.menuBall.Push("\x26#xe667;","1x1",b.MsgTransform);b.menuBall.Push("\x26#xe66f;","1x2",b.MsgTransform,90);b.menuBall.Push("\x26#xe66f;","2x1",b.MsgTransform);b.menuBall.Push("\x26#xe66e;","2x2",b.MsgTransform);b.menuBall.Push("\x26#xe66a;","3x2",b.MsgTransform,90);b.menuBall.Push("\x26#xe66a;","2x3",b.MsgTransform);b.menuBall.Push("\x26#xe66d;","3x3",b.MsgTransform);b.menuBall.FlushMenu();b.menuBall.SetCentreClick(b.BackHome)};this.Clear=function(a){void 0!==a&&b.menuBall.Animation(a);b.menuBall.Clear()};this.BackHome=function(){b.Clear(3);g?b.MprHomeMenu():f==CBoBo.PTYPE_JPG?b.JpgHomeMenu():f==CBoBo.PTYPE_SERIES?b.SeriesHomeMenu():b.DeSeriesHomeMenu();b.menuBall.OpenRingMenu()};var e=function(){g?b.menuBall.SetMainMenu(b.MprHomeMenu):f==CBoBo.PTYPE_JPG?b.menuBall.SetMainMenu(b.JpgHomeMenu):f==CBoBo.PTYPE_SERIES?b.menuBall.SetMainMenu(b.SeriesHomeMenu):b.menuBall.SetMainMenu(b.DeSeriesHomeMenu)}};CBoBo.View.SeriesPlayer=function(d){this.bShow;var b=1,a=1,f,g,c=$.extend(!0,{msgtransform:null},d),e={},h=null,l=function(d){var g=!0;2>b&&(g=!1);var h=!0;if(g){var l=$("."+e.playItem).eq(2);switch(d.target.title){case "\u7b2c\u4e00\u5f20":a=1;break;case "\u4e0a\u4e00\u5f20":a=1>--a?1:a;break;case "\u64ad\u653e":null!=c.msgtransform&&(d.usermsg="seriesplay",d.value=a,c.msgtransform(d));k();l.html("\x26#xe713;");l.attr("title","\u6682\u505c");h=!1;f=!0;break;case "\u6682\u505c":m();setTimeout(function(){null!=c.msgtransform&&(d.usermsg="seriesplay",d.value=a,c.msgtransform(d));l.html("\x26#xe724;");l.attr("title","\u64ad\u653e")},100);h=f=!1;break;case "\u4e0b\u4e00\u5f20":a=++a>b?b:a;break;case "\u6700\u540e\u4e00\u5f20":a=b;break;case "\u64ad\u653e\u901f\u5ea6":f&&(m(),k()),h=!1}}n();null!=c.msgtransform&&h&&("userdocument"==d.userdocument?c.msgtransform({usermsg:"seriesplay",value:a,userdocument:"userdocument"}):c.msgtransform({usermsg:"seriesplay",value:a}))},k=function(){var d=$("#"+e.playSpeed).val();void 0!=d&&($("body").css("pointer-events","none"),g=setInterval(function(){a++;a>b&&(a=1);null!=c.msgtransform&&c.msgtransform({usermsg:"seriesplay",value:a})},1E3/d))},m=function(){clearInterval(g);g=null;$("body").css("pointer-events","auto")},n=function(){var c=$("."+e.playItem),d=c.eq(0),g=c.eq(1),h=c.eq(2),k=c.eq(3),c=c.eq(4);2>b?(d.css({"pointer-events":"none",color:"gray"}),g.css({"pointer-events":"none",color:"gray"}),h.css({"pointer-events":"none",color:"gray"}),k.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"})):f?(d.css({"pointer-events":"none",color:"gray"}),g.css({"pointer-events":"none",color:"gray"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"})):2>a?(d.css({"pointer-events":"none",color:"gray"}),g.css({"pointer-events":"none",color:"gray"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"auto",color:"#33FFFF"}),c.css({"pointer-events":"auto",color:"#33FFFF"})):a>b-1?(d.css({"pointer-events":"auto",color:"#33FFFF"}),g.css({"pointer-events":"auto",color:"#33FFFF"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"})):(d.css({"pointer-events":"auto",color:"#33FFFF"}),g.css({"pointer-events":"auto",color:"#33FFFF"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"auto",color:"#33FFFF"}),c.css({"pointer-events":"auto",color:"#33FFFF"}));$("#"+e.playSpeed).css({"pointer-events":"auto"})};this.SetPosition=function(a,b){$("#"+e.ctrl).css({left:a+"px",top:b+"px"})};this.Show=function(a){var b=$("#"+e.ctrl);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(400))};this.SetRange=function(c,d){isNaN(c)||(b=c,a=d,void 0==a&&(a=1),f=!1,c=$("."+e.playItem).eq(2),c.html("\x26#xe724;"),c.attr("title","\u64ad\u653e"),n())};this.TriggerClick=function(a){$("."+e.playItem).eq(a).triggerHandler("click")};this.SaveSeriesTag=function(a){h=a};this.GetSeriesTag=function(){return h};(function(){e.ctrl=CBoBo.Plugin.GetRandom();e.playItem=CBoBo.Plugin.GetRandom();e.playfps=CBoBo.Plugin.GetRandom();e.playSpeed=CBoBo.Plugin.GetRandom();var a="\x3cdiv id\x3d'"+e.ctrl+"' class\x3d'icon-player'\x3e\x3cul\x3e",a=a+("\x3cli\x3e\x3cspan class\x3d'player "+e.playItem+"' title\x3d'\u7b2c\u4e00\u5f20'\x3e\x26#xe76a;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+e.playItem+"' title\x3d'\u4e0a\u4e00\u5f20'\x3e\x26#xe68d;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+e.playItem+"' title\x3d'\u64ad\u653e'\x3e\x26#xe724;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+e.playItem+"' title\x3d'\u4e0b\u4e00\u5f20'\x3e\x26#xe68c;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+e.playItem+"' title\x3d'\u6700\u540e\u4e00\u5f20'\x3e\x26#xe769;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan  id\x3d'"+e.playfps+"'\x3eFPS\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cinput id\x3d'"+e.playSpeed+"' type\x3d'number' min\x3d'1' max\x3d'50' value\x3d'10' title\x3d'\u64ad\u653e\u901f\u5ea6'/\x3e\x3c/li\x3e");$(a+"\x3c/ul\x3e\x3c/div\x3e").appendTo($("body")).width(293).height(40).css({position:"absolute",background:"rgba(0,0,0,1)","z-index":11111,border:"1px solid #33FFFF","border-radius":"6px 6px","user-select":"none","line-height":"40px"})})();$("#"+e.ctrl+" ul").css({"list-style":"none",position:"absolute",margin:"auto",left:0,top:0,bottom:0,right:0,padding:"0"});$("#"+e.ctrl+" ul li").css({display:"inline-block"});$("#"+e.playfps).css({"font-size":"16px","font-family":"Microsoft YaHei","margin-left":"10px","vertical-align":"middle",cursor:"default",color:"#FFF"});$("#"+e.playSpeed).height(18).width(35).css({"margin-left":"5px","vertical-align":"middle"});(function(){$("."+e.playItem).bind("click",function(a){l(a);a.stopPropagation()});$("#"+e.playSpeed).bind("change",function(a){l(a)});$(document).bind("click",function(a){a.userdocument="userdocument";l(a)})})();!0};CBoBo.View.ContextMenu=function(d){var b,a=$.extend(!0,{offsetX:2,offsetY:2,speed:300,flash:!1,items:[],action:null},d),f=this,g;this.ctrl;this.bShow=!1;this.Create=function(){g="cbobo"+CBoBo.Plugin.GetRandom();var b="";$.each(a.items,function(a,c){c&&(b+="\x3cli title\x3d'"+c.text+"' class\x3d'ctxmenu'\x3e\x3cspan\x3e"+c.text+"\x3c/span\x3e\x3c/li\x3e")});this.ctrl=$("\x3cdiv id\x3d'"+g+"'\x3e\x3cul\x3e"+b+"\x3c/ul\x3e\x3c/div\x3e").appendTo("body");this.ctrl.css({position:"absolute","border-radius":"5px","z-index":999999,"-webkit-user-select":"none","background-color":"rgba(56, 56, 56, 0.8)",border:"1px solid rgba(80, 80, 80, 1)","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none","box-shadow":"-2px 2px 5px #000"});$("#"+g+" ul").css({"list-style":"none",padding:"0",margin:"0"});$("#"+g+" ul li").css({padding:"2px",margin:"0",display:"block"});$("#"+g+" ul li span").css({"pointer-events":"none"})};this.SetPosition=function(a,b){this.ctrl.css({left:a+"px",top:b+"px"});return this};this.Show=function(b){(this.bShow=b)?(this.ctrl.hide(),a.flash?this.ctrl.show(a.speed):this.ctrl.show()):a.flash?this.ctrl.hide(a.speed):this.ctrl.hide();return this};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),a=Math.max(a,b)/17>>0;63>a&&(a=63);this.ctrl.css({width:a+"px","font-size":(.1234*a>>0)+"px"});a=.2*a>>0;$("#"+g+" ul li").css({"padding-left":a+"px"})};this.AddEvent=function(){CBoBo.Plugin.GetBrowserInfo().isMobile?($(document).bind("touchstart",function(a){f.Show(!1)}),$("#"+g+" li").bind("touchstart",function(c){c.reservedata=b;c.btntitle=c.target.title;null!=a.action&&a.action(c);c.stopPropagation()})):($(document).bind("mousedown",function(a){1==a.which&&f.Show(!1)}),$("#"+g+" li").bind("mousedown",function(c){c.reservedata=b;c.btntitle=c.target.title;null!=a.action&&a.action(c)}))};this.SetReserve=function(a){b=a};this.GetReserve=function(){return b};this.Destroy=function(){$("#"+g).remove()};f.Create();f.UpdateStyle();f.AddEvent();!0};CBoBo.View.Scroll=function(d){this.opt=$.extend(!0,{parent:null,axis:"y",showbutton:!0,size:20,range:100,offset:0,railalign:"center",msgtransform:null},d);this.arrClass={};this.rangeMap=this.draggerPos=1;this.stack=[];null!=this.opt.parent&&(this.Create(),this.UpdateStyle(),this.AddEvent());!0};CBoBo.View.Scroll.prototype.GetId=function(d){switch(d){case "ctrl":return this.arrClass.ctrl=CBoBo.Plugin.GetRandom();case "buttonl_t":return this.arrClass.buttonl_t;case "buttonr_b":return this.arrClass.buttonr_b;case "container":return this.arrClass.container;case "dragger_bar":return this.arrClass.dragger_bar;case "dragger":return this.arrClass.dragger;case "dragger_rail":return this.arrClass.dragger_rail}};CBoBo.View.Scroll.prototype.Create=function(){this.arrClass.ctrl=CBoBo.Plugin.GetRandom();this.arrClass.buttonl_t=CBoBo.Plugin.GetRandom();this.arrClass.buttonr_b=CBoBo.Plugin.GetRandom();this.arrClass.container=CBoBo.Plugin.GetRandom();this.arrClass.dragger_bar=CBoBo.Plugin.GetRandom();this.arrClass.dragger=CBoBo.Plugin.GetRandom();this.arrClass.dragger_rail=CBoBo.Plugin.GetRandom();var d,b;"x"==this.opt.axis?(d="\x26#xe6d5;",b="\x26#xe6d6;"):"y"==this.opt.axis&&(d="\x26#xe6d7;",b="\x26#xe6d4;");d=$("\x3cdiv id\x3d'"+this.arrClass.ctrl+"' class\x3d'icon-player'\x3e\x3cspan id\x3d'"+this.arrClass.buttonl_t+"'\x3e"+d+"\x3c/span\x3e\x3cdiv id\x3d'"+this.arrClass.container+"'\x3e\x3cdiv id\x3d'"+this.arrClass.dragger_bar+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrClass.dragger+"'\x3e\x3cdiv id\x3d'"+this.arrClass.dragger_rail+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan id\x3d'"+this.arrClass.buttonr_b+"'\x3e"+b+"\x3c/span\x3e\x3c/div\x3e").appendTo(this.opt.parent);d.css({position:"absolute","background-color":"#333333",color:"rgba(255,255,255,0.3)"});return d};CBoBo.View.Scroll.prototype.SetRange=function(d,b){isNaN(d)||1>d||(this.rangeMap=d,void 0==b&&(b=1),this.draggerPos=b,this.UpdateStyle(),this.UpdateBtnStatus())};CBoBo.View.Scroll.prototype.UpdateStyle=function(){var d=$(this.opt.parent);if(void 0!=d){var b=$("#"+this.arrClass.ctrl),a=$("#"+this.arrClass.buttonl_t),f=$("#"+this.arrClass.buttonr_b),g=$("#"+this.arrClass.container),c=$("#"+this.arrClass.dragger_bar),e=$("#"+this.arrClass.dragger),h=$("#"+this.arrClass.dragger_rail);if("x"==this.opt.axis)h=d.width()*this.opt.range/100>>0,b.width(h).height(this.opt.size),h=d.width()-h>>1,b.css({left:h+"px",bottom:this.opt.offset+"px"});else if("y"==this.opt.axis){var l=d.height()*this.opt.range/100>>0;b.width(this.opt.size).height(l);d=d.height()-l>>1;b.css({top:d+"px",right:this.opt.offset+"px"});CBoBo.IsTablet?(a.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":"18px",position:"relative",Top:"0px"}),f.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":"18px",position:"relative",bottom:"8px"})):(a.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":this.opt.size+"px"}),f.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":this.opt.size+"px",position:"absolute",bottom:"0px"}));b=l-(this.opt.size<<1)-4;g.width(this.opt.size).height(b).css({position:"relative"});g=b-2;CBoBo.IsTablet&&(g=b-10);c.width(this.opt.size).height(g).css({"border-top":"1px solid #000","border-bottom":"1px solid #000"});b=g/this.rangeMap>>0;b=10>b?10:b;c=(this.draggerPos-1)/(this.rangeMap-1)*(g-b)+1;e.width(this.opt.size).height(b).css({position:"absolute",top:c+"px"});e=this.opt.size-5;h.width(e).height(b).css({"background-color":"rgba(255,255,255,0.2)","border-radius":"1px"});switch(this.opt.railalign){case "center":h.css({position:"absolute",left:(this.opt.size-e)/2+"px"})}}}};CBoBo.View.Scroll.prototype.AddEvent=function(){function d(a){switch(a.type){case "touchstart":case "mousedown":b(a);break;case "touchmove":case "mousemove":if(g.stack[0]){var e=g.GetId("dragger_rail");$("#"+e).triggerHandler("mouseenter");g.evenType=a.type;var d;"touchmove"==a.type?(a=a.originalEvent.targetTouches[0],"y"==g.opt.axis?d=a.pageY-g.stack[1]+g.stack[2]:"x"==g.opt.axis&&(d=a.pageX-g.stack[1]+g.stack[2])):"mousemove"==a.type&&("y"==g.opt.axis?d=a.pageY-g.stack[1]+g.stack[2]:"x"==g.opt.axis&&(d=a.pageX-g.stack[1]+g.stack[2]));d=d>g.stack[3]?g.stack[3]:d;d=1>d?1:d;"y"==g.opt.axis?g.stack[4].css("top",d+"px"):"x"==g.opt.axis&&g.stack[4].css("left",d+"px");g.draggerPos=Math.round(d/(g.stack[3]/(g.rangeMap-1)))+1;c!=g.draggerPos&&(g.UpdateBtnStatus(),c=g.draggerPos,g.opt.msgtransform({type:"scroll",value:g.draggerPos,scroll:g}))}break;case "touchend":case "mouseup":if(!(1>g.stack)){for(d=0;5>d;d++)g.stack.pop();d=g.GetId("dragger_rail");$("#"+d).triggerHandler("mouseout")}}}function b(a){var b,c;if("touchstart"==a.type){var e=a.originalEvent.targetTouches[0];b=e.pageX;c=e.pageY}else"mousedown"==a.type&&(b=a.pageX,c=a.pageY);var e=$("#"+g.arrClass.dragger),d=e.position(),f=$("#"+g.arrClass.dragger_bar);g.stack.push(!0);"y"==g.opt.axis?(g.stack.push(c),g.stack.push(d.top),b=f.height()-e.height(),g.stack.push(b)):"x"==g.opt.axis&&(g.stack.push(b),g.stack.push(d.left),b=f.width()-e.width(),g.stack.push(b));g.stack.push(e);a.stopPropagation()}function a(a){var b=g.draggerPos;"lt"==a?(g.draggerPos--,g.draggerPos=1>g.draggerPos?1:g.draggerPos):"rb"==a&&(g.draggerPos++,g.draggerPos=g.draggerPos>g.rangeMap?g.rangeMap:g.draggerPos);b!=g.draggerPos&&(g.FlushDraggerPos(),g.UpdateBtnStatus(),g.opt.msgtransform({type:"scroll",value:g.draggerPos,scroll:g}))}function f(a){var b,c;"touchstart"==a.type?(c=a.originalEvent.targetTouches[0],b=c.pageX,c=c.pageY):"mousedown"==a.type&&(b=a.pageX,c=a.pageY);a=$("#"+g.arrClass.dragger);var e=$("#"+g.arrClass.dragger_bar),d,f=1;"y"==g.opt.axis?(d=e.height()-a.height(),f=c-$("#"+g.arrClass.container).offset().top-a.height()/2+1,f=1>f?1:f,f=f>d?d:f,a.css("top",f+"px")):"x"==g.opt.axis&&(d=e.width()-a.width(),f=b-$("#"+g.arrClass.container).offset().left-a.width()/2+1,f=1>f?1:f,f=f>d?d:f,a.css("left",f+"px"));g.draggerPos=Math.ceil(f/d*g.rangeMap);g.UpdateBtnStatus();g.opt.msgtransform({type:"scroll",value:g.draggerPos,scroll:g})}var g=this;$(window).bind("resize",function(a){g.UpdateStyle()});CBoBo.Plugin.GetBrowserInfo().isMobile?($("#"+this.arrClass.dragger).bind("touchstart",d),$(document).bind("touchmove touchend",d),$("#"+this.arrClass.buttonl_t).bind("touchstart",function(b){a("lt")}),$("#"+this.arrClass.buttonr_b).bind("touchstart",function(b){a("rb")}),$("#"+this.arrClass.container).bind("touchstart",function(a){f(a);b(a)})):($("#"+this.arrClass.dragger).bind("touchstart",d),$(document).bind("touchmove touchend",d),$("#"+this.arrClass.container).bind("touchstart",function(a){f(a);b(a)}),$("#"+this.arrClass.dragger).bind("mousedown",d),$(document).bind("mousemove mouseup",d),$("#"+this.arrClass.dragger_rail).bind("mouseenter mouseout",function(a){"mouseenter"==a.type?$(this).css({cursor:"pointer","background-color":"rgba(255,255,255,0.3)"}):"mouseout"==a.type&&$(this).css({cursor:"default","background-color":"rgba(255,255,255,0.2)"})}),$("#"+this.arrClass.buttonl_t).bind("mousedown",function(b){"mousedown"==b.type&&a("lt")}),$("#"+this.arrClass.buttonr_b).bind("mousedown",function(b){"mousedown"==b.type&&a("rb")}),$("#"+this.arrClass.container).bind("mousedown",function(a){f(a);b(a)}));var c=1};CBoBo.View.Scroll.prototype.FlushDraggerPos=function(d){void 0!=d&&(this.draggerPos=d);d=$("#"+this.arrClass.dragger);var b=$("#"+this.arrClass.dragger_bar);"y"==this.opt.axis?(b=b.height()-d.height(),d.css("top",(this.draggerPos-1)/(this.rangeMap-1)*b+1+"px")):"x"==this.opt.axis&&(b=b.width()-d.width(),d.css("left",(this.draggerPos-1)/(this.rangeMap-1)*b+1+"px"))};CBoBo.View.Scroll.prototype.TriggerClick=function(d){id=0<d?this.GetId("buttonl_t"):this.GetId("buttonr_b");$("#"+id).triggerHandler("mousedown")};CBoBo.View.Scroll.prototype.TriggerDragger=function(d){this.FlushDraggerPos(d);this.UpdateBtnStatus();this.opt.msgtransform&&this.opt.msgtransform({type:"scroll",value:d,scroll:this})};CBoBo.View.Scroll.prototype.Enable=function(d){var b=$("#"+this.arrClass.ctrl),a=$("#"+this.arrClass.dragger);d?(b.css({"pointer-events":"auto"}),a.show()):(b.css({"pointer-events":"none"}),a.hide())};CBoBo.View.Scroll.prototype.UpdateBtnStatus=function(){var d=$("#"+this.arrClass.buttonl_t),b=$("#"+this.arrClass.buttonr_b);1==this.draggerPos?(d.css({color:"rgba(255,255,255,0.1)","pointer-events":"none"}),b.css({color:"rgba(255,255,255,0.3)","pointer-events":""})):this.draggerPos==this.rangeMap?(d.css({color:"rgba(255,255,255,0.3)","pointer-events":""}),b.css({color:"rgba(255,255,255,0.1)","pointer-events":"none"})):(d.css({color:"rgba(255,255,255,0.3)","pointer-events":""}),b.css({color:"rgba(255,255,255,0.3)","pointer-events":""}))};CBoBo.View.Msg=function(d){function b(a,b){var c=CBoBo.Plugin.GetRandom();(function(){var e;switch(b){case CBoBo.MSG_SUCCESS:e="\x26#xe63c;";break;case CBoBo.MSG_ERROR:e="\x26#xe686;";break;default:e="\x26#xe628;"}d("\x3cdiv id\x3d'"+c+"'\x3e\x3cspan class\x3d'icon_tool'\x3e"+e+"\x3c/span\x3e\x3cspan\x3e"+a+"\x3c/span\x3e\x3c/div\x3e").appendTo(d("body"))})();(function(){var a=d("#"+c),e,f;switch(b){case CBoBo.MSG_SUCCESS:e="#058912";f="#08ED1F";break;case CBoBo.MSG_ERROR:e="#F0120A";f="#F0524D";break;default:e="#FAF003",f="#525503"}a.css({position:"absolute",right:"10px",background:e,height:"50px","box-shadow":"0 0 10px "+f,padding:"5px","border-radius":"5px","pointer-events":"none","z-index":"9999999999999999",overflow:"hidden"});a=d("#"+c+" span");a.css({color:"#000",height:"50px","font-weight":"bold",display:"flex","align-items":"center","float":"left"});a.eq(0).css({"font-size":"35px","padding-right":"5px",color:f})})();this.Width=function(){return d("#"+c).width()+10};this.Height=function(){return d("#"+c).height()+10};this.SetBottom=function(a){d("#"+c).css({bottom:a+"px"})};this.Destroy=function(){var a=d("#"+c);void 0!=a&&(a.fadeOut(500),setTimeout(function(){a.remove()},500))};this.GetId=function(){return c}}function a(a){var b,c=CBoBo.Plugin.GetRandom(),f=function(a){var b=d("#"+c);b.fadeOut(3E3);setTimeout(function(){b.remove();g=void 0},3E3)};d("\x3cdiv id\x3d'"+c+"'\x3e\x3cspan\x3e"+a+"\x3c/span\x3e\x3c/div\x3e").appendTo(d("body")).css({position:"absolute",bottom:"2px",color:"#33FFFF","pointer-events":"none",padding:"0 2px","z-index":"99999"});b=setTimeout(f,3E3);this.Print=function(a){d("#"+c+" span").html(a);void 0!=b&&clearTimeout(b);b=setTimeout(f,3E3)}}var f=new function(){this.ctrl=CBoBo.Plugin.GetRandom();var a=[],b=function(b){setTimeout(function(b){var c=b.GetId();d.each(a,function(e,d){void 0!=d&&(d=d.GetId(),c==d&&(b.Destroy(),a.splice(e,1)))})},4E3,b)};this.Push=function(c){a.push(c);b(c);var e=0,f=d("body").height();c=-1;for(var g=a.length-1;-1<g;g--){var h=a[g],e=e+h.Height();if(e>f){c=g;break}}e=10;for(g=c+1;g<a.length;g++)h=a[g],h.SetBottom(e),e+=h.Height()+5;for(g=0;g<c+1;g++)h=a[g],h.Destroy();a.splice(0,c+1)};this.Length=function(){return a.length}},g;d.extend({Msg:function(a,e){f.Push(new b(a,e))},Status:function(b){void 0==g?g=new a(b):g.Print(b)}})}(jQuery);CBoBo.View.AI=function(d){this.bShow;this.isAIFinished=this.isAIReuest=!1;var b=$.extend(!0,{parent:null},d),a=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var d=$("#"+a),g=$(b.refrence),c=g.width(),g=g.height();d.width(c).height(g)};this.Show=function(b){var d=$("#"+a);b?(this.bShow=!0,d.hide(),d.fadeIn(400)):(this.bShow=!1,d.fadeOut(400))};$("\x3cdiv id\x3d'"+a+"'\x3e\x3c/div\x3e").appendTo($(b.refrence)).css({position:"absolute","z-index":1003,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"});this.UpdateStyle();d.parent="#"+a;d.aiRead=!0;this.secondCtrl=new CBoBo.View.CMngSecondLayer(d)};CBoBo.View.VRT=function(d){this.bShow;var b=null,a={mode:CBoBo.PTYPE_SERIES,parent:"body",msgtransform:null};this.bMsg;var f=$.extend(!0,a,d),g=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var a=$("#"+g),b=$(f.parent),d=b.width(),b=b.height();a.width(d).height(b).css({left:"10px",top:"10px"})};this.Show=function(a){var b=$("#"+g);a?(this.bShow=!0,b.hide(),b.fadeIn(400)):(this.bShow=!1,b.fadeOut(400))};this.Series=function(a){if(void 0==a)return b;b=a;this.bMsg=!0};this.SetLayout=function(a){this.mng.UpdateLayout(0,2,2);this.mng.SetSpBoundaryColor(0,"#FF0");this.mng.SetSpBoundaryColor(1,"#F00");this.mng.SetSpBoundaryColor(2,"#0F0");this.mng.SetSpBoundaryColor(3,"#00F")};(function(){var a=$("\x3cdiv id\x3d'"+g+"'\x3e\x3c/div\x3e").appendTo($(f.parent));void 0!=a&&a.css({position:"absolute","z-index":10001,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"})})();this.UpdateStyle();this.mng=new CBoBo.View.CMngFirstLayer({parent:"#"+g,single:!0,msgtransform:f.msgtransform})};CBoBo.View.MPR=function(d){this.bShow;var b=null,a={mode:CBoBo.PTYPE_SERIES,parent:"body",msgtransform:null},f;this.bMsg;var g=$.extend(!0,a,d),c=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var a=$("#"+c),b=$(g.parent),d=b.width(),b=b.height();a.width(d).height(b).css({left:"10px",top:"10px"})};this.Show=function(a){var b=$("#"+c);a?(this.bShow=!0,b.hide(),b.fadeIn(400)):(this.bShow=!1,b.fadeOut(400))};this.Series=function(a){if(void 0==a)return b;b=a;this.bMsg=!0};this.SetLayout=function(a){f!==a&&(3===a?(this.mng.UpdateLayoutSp3(0,"left"),this.mng.SetSpBoundaryColor(0,"#F00"),this.mng.SetSpBoundaryColor(1,"#0F0"),this.mng.SetSpBoundaryColor(2,"#00F")):4===a&&(this.mng.UpdateLayout(0,2,2),this.mng.SetSpBoundaryColor(0,"#F00"),this.mng.SetSpBoundaryColor(1,"#0F0"),this.mng.SetSpBoundaryColor(2,"#00F"),this.mng.SetSpBoundaryColor(3,"#FF0")),f=a)};(function(){var a=$("\x3cdiv id\x3d'"+c+"'\x3e\x3c/div\x3e").appendTo($(g.parent));void 0!=a&&a.css({position:"absolute","z-index":10001,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"})})();this.UpdateStyle();this.mng=new CBoBo.View.CMngFirstLayer({parent:"#"+c,single:!0,msgtransform:g.msgtransform})};CBoBo.View.DicomScan=function(d){var b=this,a=$.extend(!0,{msgtransform:null},d),f={};this.bShow;var g=function(a,b,d,g){void 0==g&&(g="\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;");b+=g;f.key||(f.key=CBoBo.Plugin.GetRandom());f.value||(f.value=CBoBo.Plugin.GetRandom());$("\x3cdiv\x3e\x3cspan class\x3d'1604335943322'\x3e"+b+"\x3c/span\x3e\x3cspan class\x3d'"+f.value+"'\x3e"+d+"\x3c/span\x3e\x3c/div\x3e").appendTo($(a)).css({height:"25px","margin-left":"20px"});b=$("."+f.key);b.css({color:"#FFF","font-size":"16px"});d=$("."+f.value);d.css({color:"#DDD","font-size":"14px"})};this.Show=function(a){var b=$("#"+f.ctrl);a?(b.fadeIn(300),this.bShow=!0):(b.fadeOut(800),this.bShow=!1)};this.SetDicomInfo=function(a){var b="#"+f.container;$(b).html("");a&&(g(b,"0008,0018",a.sopuid),g(b,"0008,0020",a.studt),g(b,"0008,0022",a.acqdt),g(b,"0008,0030",a.stutm),g(b,"0008,0032",a.acqtm),g(b,"0008,0050",a.accnum),g(b,"0008,0060",a.mod),g(b,"0008,0070",a.manu),g(b,"0008,0080",a.inst),g(b,"0008,1030",a.studes),g(b,"0008,103E",a.serdes),g(b,"0010,0010",a.name),g(b,"0010,0020",a.patid),g(b,"0010,0030",a.birth),g(b,"0010,0040",a.sex),g(b,"0010,1010 ",a.age),g(b,"0018,0050",a.sliceth),g(b,"0018,0060",a.kv),g(b,"0018,1151",a.ma),g(b,"0020,0010",a.stuid),g(b,"0020,000D",a.stuuid),g(b,"0020,000E",a.seruid),g(b,"0020,0011",a.serid),g(b,"0020,0013",a.imgnum),g(b,"0028,0002",a.sappix),g(b,"0028,0004",a.phme),g(b,"0028,0010",a.row),g(b,"0028,0011",a.col),g(b,"0028,0030",a.pixx+"/"+a.pixy),g(b,"0028,0100",a.bita),g(b,"0028,0101",a.bits),g(b,"0028,0102",a.hbit),g(b,"0028,0103",a.pixrep),g(b,"0028,1050",a.wc),g(b,"0028,1051",a.ww),g(b,"0028,1052",a.rescin),g(b,"0028,1053",a.rescsl),g(b,"\u56fe\u50cf\u65b9\u4f4d\u5de6",a.orl),g(b,"\u56fe\u50cf\u65b9\u4f4d\u4e0a",a.ort),g(b,"\u56fe\u50cf\u65b9\u4f4d\u53f3",a.orr),g(b,"\u56fe\u50cf\u65b9\u4f4d\u4e0b",a.orb));$("#"+f.container).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"})};f.ctrl=CBoBo.Plugin.GetRandom();f.title=CBoBo.Plugin.GetRandom();f.container=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+f.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+f.title+"'\x3e\x3cspan\x3eDicom\u4fe1\u606f\x3c/span\x3e\x3ca\x3e\x26#xe661;\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d'"+f.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));(function(){var a=$(window).width(),b=$(window).height(),a=.5*a>>0,a=600>a?600:a,b=.9*b>>0,b=300>b?300:b;$("#"+f.ctrl).width(a).height(b).css({border:"1px solid #676767",position:"absolute","z-index":11111,background:"#444444",display:"none","user-select":"none",color:"#CCCCC4"});$("#"+f.title).css({height:"30px",width:"100%",background:"#555555",cursor:"default","border-bottom":"1px solid #000","text-align":"center"});$("#"+f.title+" span").css({width:"15%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+f.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+f.container).width(a-6).height(b-6-30).css({"user-select":"auto",padding:"3px","font-family":"Microsoft YaHei",overflow:"auto"})})();(function(){var c=!1,d,g,l=$("#"+f.ctrl);$("#"+f.title).bind("mousedown",function(a){c=!0;d=new Point(a.pageX,a.pageY);a=l.offset();g=new Point(a.left,a.top)});$("#"+f.title+" a").bind("click",function(c){c.preventDefault();b.Show(!1);a.msgtransform&&(c.btntitle="DICOM\u4fe1\u606f",c.btnforce=!1,a.msgtransform(c));setTimeout(function(){l.remove()},800)});$(document).bind("mousemove mouseup",function(a){switch(a.type){case "mousemove":c&&l.css({left:a.pageX-d.x+g.x+"px",top:a.pageY-d.y+g.y+"px"});break;case "mouseup":c=!1}})})();(function(){var a=$("body"),b=$("#"+f.ctrl),d=a.width(),a=a.height(),g=b.width(),k=b.height();b.css({left:(d-g>>1)+"px",top:(a-k>>1)+"px"})})()};CBoBo.View.AutoScroll=function(d){};CBoBo.View.Config=function(){var d={};this.bShow=!1;var b,a=0,f=function(){var a=$("body"),b=a.width(),c=a.height(),a=$("#"+d.ctrl);1150>b&&(b=1150);a.width(b).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({top:CBoBo.View.TOOLBAR_HEIGHT});var e=$("#"+d.left),a=.08*b;97>a&&(a=97);e.width(a).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({display:"inline-block"});$("#"+d.right).width(b-a-2).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({background:"#333333",display:"inline-block",position:"relative"});b=$("."+d.headbtn);c=.12*a;b.width(a).height(60).css({"border-bottom":"1px solid #383838","line-height":"60px",cursor:"pointer","font-size":c+"px",color:"#efefef"});$("."+d.headbtnicon).css({"font-size":1.5*c+"px","vertical-align":"middle",color:"#ccc"});$("."+d.headbtn+" span").css({"pointer-events":"none",padding:"4px"})};this.TriggerResize=function(){f();b&&b()};var g=function(){function a(a){l(a,"\u5e73\u79fb","translation");l(a,"\u7a97\u5bbd\u7a97\u4f4d","wwwc");l(a,"\u7ffb\u9875","page");l(a,"\u7f29\u653e","zoom");l(a,"\u91ca\u653e","release")}var b="CT",c={},e=function(){$("#"+c.ctrl).css({width:"50%",height:"100%",position:"absolute",top:0,left:"60px",overflow:"hidden","font-family":"Microsoft Yahei"});$("#"+c.selmodality).css({height:"100%",width:"20%",display:"inline-block","padding-top":"10px"});$("#"+c.main).css({height:"100%",width:"70%",display:"inline-block","margin-left":"10%","padding-top":"10px"});$("#"+c.radio).css({height:"20%",width:"100%"});$("#"+c.checkbox).css({height:"20%",width:"100%"});$("#"+c.layout).css({width:"100%"})},f=function(a,b){var c=CBoBo.Config.GetSeriesLayout(a,b);$("input:radio[name\x3d'serieslayout']").each(function(){var a=$(this).prev();this.value===c?(this.checked=!0,a.css("color","#F0F")):(this.checked=!1,a.css("color","#FFF"))});c=CBoBo.Config.GetImageLayout(a,b);$("input:radio[name\x3d'imagelayout']").each(function(){var a=$(this).prev();this.value===c?(this.checked=!0,a.css("color","#F0F")):(this.checked=!1,a.css("color","#FFF"))})},g=function(a){var b=CBoBo.Config.GetImageShowMode(a);$("input:radio[name\x3d'imageshow']").each(function(){this.checked=this.value===b?!0:!1});var d=CBoBo.Config.GetThumbPosition(a);$("input:radio[name\x3d'thumbposition']").each(function(){this.checked=this.value===d?!0:!1});var e=CBoBo.Config.GetMouseLeft(a);$(c.mouseLeft).val(e);e=CBoBo.Config.GetMouseRight(a);$(c.mouseRight).val(e);e=CBoBo.Config.GetMouseMiddle(a);$(c.mouseMiddle).val(e);e=CBoBo.Config.GetMouseMiddleRoll(a);$(c.mouseMiddleRoll).val(e);$(c.platform).val("pc");f(a,"pc")},k=function(a,c){switch(a){case "imageshow":CBoBo.Config.SetImageShowMode(b,c);break;case "thumbposition":CBoBo.Config.SetThumbPosition(b,c)}};c.ctrl=CBoBo.Plugin.GetRandom();c.selmodality=CBoBo.Plugin.GetRandom();c.main=CBoBo.Plugin.GetRandom();c.radio=CBoBo.Plugin.GetRandom();c.checkbox=CBoBo.Plugin.GetRandom();c.layout=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+c.ctrl+"'\x3e\x3cdiv id\x3d'"+c.selmodality+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.main+"'\x3e\x3cdiv id\x3d'"+c.radio+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.checkbox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.layout+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+d.right));e();!function(){var d="#"+c.selmodality;c.modality=d="#"+h(d,"\u8bbe\u5907\u7c7b\u578b",{},function(a){b=a;g(a)});l(d,"CT","CT");l(d,"PT","PT");l(d,"MR","MR");l(d,"XR","XR");l(d,"OTHER","OTHER");d="#"+c.radio;q(d,"\u56fe\u50cf\u9ed8\u8ba4\u663e\u793a",{width:"100%",height:"30px"});var e="imageshow";w(d,e,"\u6b63\u5e38\uff08\u9ed8\u8ba4\uff09","normal",{"margin-left":"20px"},function(a){k("imageshow",a.target.value)});w(d,e,"\u53cd\u8272","inverse",{"margin-left":"10px"},function(a){k("imageshow",a.target.value)});q(d,"\u7f29\u7565\u56fe\u4f4d\u7f6e",{width:"100%","margin-top":"30px",height:"30px"});e="thumbposition";w(d,e,"\u81ea\u52a8\uff08\u9ed8\u8ba4\uff09","auto",{"margin-left":"20px"},function(a){k("thumbposition",a.target.value)});w(d,e,"\u5de6\u8fb9\u663e\u793a","left",{"margin-left":"10px"},function(a){k("thumbposition",a.target.value)});w(d,e,"\u4e0b\u65b9\u663e\u793a","bottom",{"margin-left":"10px"},function(a){k("thumbposition",a.target.value)});pid="#"+c.checkbox;q(pid,"\u9ed8\u8ba4\u9f20\u6807\u914d\u7f6e",{width:"100%",height:"30px"});c.mouseLeft=d="#"+h(pid,"\u5de6\u952e",{width:"40%",height:"30px","margin-left":"20px"},function(a){CBoBo.Config.SetMouseLeft(b,a)});a(d);c.mouseRight=d="#"+h(pid,"\u53f3\u952e",{width:"40%",height:"30px"},function(a){CBoBo.Config.SetMouseRight(b,a)});a(d);c.mouseMiddle=d="#"+h(pid,"\u4e2d\u952e",{width:"40%",height:"30px","margin-left":"20px"},function(a){CBoBo.Config.SetMouseMiddle(b,a)});a(d);c.mouseMiddleRoll=d="#"+h(pid,"\u6eda\u8f6e",{width:"40%",height:"30px"},function(a){CBoBo.Config.SetMouseMiddleRoll(b,a)});l(d,"\u7ffb\u9875","page");l(d,"\u7f29\u653e","zoom");pid="#"+c.layout;q(pid,"\u9ed8\u8ba4\u5e03\u5c40\u914d\u7f6e",{width:"100%",height:"30px"});c.platform=d="#"+h(pid,"\u4f7f\u7528\u8bbe\u5907",{"margin-left":"20px"},function(a){f(b,a)});l(d,"PC","pc");l(d,"IPAD","ipad");l(d,"IPHONE","iphone");l(d,"OTHER","other");q(pid,"\u5e8f\u5217\u5e03\u5c40",{width:"100%",height:"30px","margin-left":"40px","margin-top":"20px"});d={parent:pid,iconstr:"\x26#xe667;",title:"1*1",name:"serieslayout",value:"1*1",exstyle:{"margin-left":"40px","margin-top":"10px"},iconstyle:{"font-size":"27px"},change:function(a){CBoBo.Config.SetSeriesLayout(b,$(c.platform).val(),a)}};u(d);d.value=d.title="2*1";d.iconstr="\x26#xe66f;";u(d);d.value=d.title="1*2";d.iconstyle.transform="rotate(90deg)";u(d);d.value=d.title="2*2";d.iconstr="\x26#xe66b;";d.iconstyle.transform="";u(d);d.value=d.title="2*3";d.iconstr="\x26#xe668;";u(d);d.value=d.title="3*2";d.iconstr="\x26#xe668;";d.iconstyle.transform="rotate(90deg)";u(d);d.value=d.title="3*3";d.iconstr="\x26#xe665;";d.iconstyle.transform="";u(d);q(pid,"\u56fe\u50cf\u5e03\u5c40",{width:"100%",height:"30px","margin-left":"40px","margin-top":"20px"});d={parent:pid,iconstr:"\x26#xe667;",title:"1*1",name:"imagelayout",value:"1*1",exstyle:{"margin-left":"40px","margin-top":"10px"},iconstyle:{"font-size":"27px"},change:function(a){CBoBo.Config.SetImageLayout(b,$(c.platform).val(),a)}};u(d);d.value=d.title="2*1";d.iconstr="\x26#xe66f;";u(d);d.value=d.title="1*2";d.iconstyle.transform="rotate(90deg)";u(d);d.value=d.title="2*2";d.iconstr="\x26#xe66b;";d.iconstyle.transform="";u(d);d.value=d.title="2*3";d.iconstr="\x26#xe668;";u(d);d.value=d.title="3*2";d.iconstr="\x26#xe668;";d.iconstyle.transform="rotate(90deg)";u(d);d.value=d.title="3*3";d.iconstr="\x26#xe665;";d.iconstyle.transform="";u(d)}();(function(a){$(c.modality).val(a);g(a)})(b);return e},c=function(){var b="CT",c={},e=function(){var a=$("#"+c.lt),b=$("#"+c.rt),d=$("#"+c.rb),e=$("#"+c.lb),g=$("#"+c.center),h=$("#"+c.left),k=$("#"+c.right),l=$("#"+c.centerHead),m=$("#"+c.centerHead+" span"),r=$("#"+c.centerContainer),p=$("."+c.itemhead),q=$("."+c.itemhead+" span"),v=$("."+c.itemHeadName),t=$("."+c.itemHeadOparete),A=$("#"+c.left_modalty),u=$("#"+c.left_fontStyle),x=k.parent(),z=x.width(),w=z/6|0,x=x.height();h.width(w).height(x).css({display:"inline-block"});k.width(z-w-1).height(x).css({display:"inline-block",position:"relative"});x=a.parent();w=((x.width()-20)/3|0)-2;x=((x.height()-10)/2|0)-2;a.width(w).height(x).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:0,top:0});g.width(w).height(2*x+10).css({position:"absolute",left:w+10,top:0});b.width(w).height(x).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:2*(w+10),top:0});d.width(w).height(x).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:2*(w+10),top:x+10});e.width(w).height(x).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:0,top:x+10});f();l.css({"font-family":"Microsoft YaHei",width:"100%",height:"25px",background:"#222",cursor:"default","font-size":"17px"});m.css({color:"#efefef",display:"inline-block",height:"100%"});m.eq(0).css({width:"30%"});m.eq(1).css({width:"50%"});m.eq(2).css({width:"20%","text-align":"center"});r.height(r.parent().height()-20).css({width:"100%"});n();p.css({"font-family":"Microsoft YaHei",width:"100%",height:"25px",background:"#222",cursor:"default","font-size":"17px",color:"#efefef"});q.css({display:"inline-block",height:"100%"});v.css({width:"80%"});t.css({width:"20%","text-align":"center"});A.height(74).css({width:"90%","margin-left":"10%"});a=u.parent().height();u.height(a-86).css({width:"90%","margin-left":"10%","border-top":"1px solid #222","margin-top":"10px"})},f=function(){var b=$("#"+c.lt),d=$("#"+c.rt),e=$("#"+c.rb),f=$("#"+c.lb);b.css({"border-color":"#666"});d.css({"border-color":"#666"});e.css({"border-color":"#666"});f.css({"border-color":"#666"});switch(a){case 0:b.css({"border-color":"#0ff"});break;case 1:d.css({"border-color":"#0ff"});break;case 2:e.css({"border-color":"#0ff"});break;case 3:f.css({"border-color":"#0ff"})}},g=function(){switch(a){case 0:return"lt";case 1:return"rt";case 2:return"rb";case 3:return"lb"}},k=function(a,b){void 0===c.centerContainerItem&&(c.centerContainerItem=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemTag&&(c.centerContainerItemTag=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemName&&(c.centerContainerItemName=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemTool&&(c.centerContainerItemTool=CBoBo.Plugin.GetRandom());var d=CBoBo.Plugin.GetRandom();$("\x3cdiv class\x3d'"+c.centerContainerItem+" config-conerinfoitem'\x3e\x3cspan class\x3d'"+c.centerContainerItemTag+"' title\x3d'"+a+"'\x3e"+a+"\x3c/span\x3e\x3cspan class\x3d'"+c.centerContainerItemName+"' title\x3d'"+b+"'\x3e"+b+"\x3c/span\x3e\x3cspan class\x3d'"+c.centerContainerItemTool+" icon_tool' title\x3d'\u589e\u52a0\u5230\u6307\u5b9a\u5217\u8868' id\x3d'"+d+"'\x3e\x26#xe6ca;\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+c.centerContainer)).bind("dblclick",a,function(a){m(a.data)});$("#"+d).bind("click dblclick",a,function(a){"dblclick"===a.type?(a.stopPropagation(),a.preventDefault()):m(a.data)})},m=function(d){var e;switch(a){case 0:e=c.ltContainer;break;case 1:e=c.rtContainer;break;case 2:e=c.rbContainer;break;case 3:e=c.lbContainer}var f=CBoBo.Config.PushCornerInfoItem(b,g(),d);f?$.Msg(f):(r(e,d),d=CBoBo.Config.GetCornerInfoFontColor(),e=CBoBo.Config.GetCornerInfoFontFamily(),p(d,e))},n=function(){$("."+c.centerContainerItem).height(20).css({"font-family":"Microsoft YaHei",cursor:"default",margin:"4px 0"});$("."+c.centerContainerItem+" span").css({display:"inline-block",height:"100%","line-height":"20px"});$("."+c.centerContainerItemTag).css({color:"#aaa",width:"30%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.centerContainerItemName).css({color:"#FFF",width:"50%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.centerContainerItemTool).css({color:"#0f0",width:"20%","text-align":"center",cursor:"pointer"})},r=function(a,b){void 0===c.item&&(c.item=CBoBo.Plugin.GetRandom());void 0===c.itemName&&(c.itemName=CBoBo.Plugin.GetRandom());void 0===c.itemDelete&&(c.itemDelete=CBoBo.Plugin.GetRandom());var d=CBoBo.Plugin.GetRandom(),e=CBoBo.Dicom.GetTagData(b);void 0!==e&&(e=e.name,b={id:a,tag:b},$("\x3cdiv class\x3d'"+c.item+" config-conerinfoitem'\x3e\x3cspan class\x3d'"+c.itemName+"' title\x3d'"+e+"'\x3e"+e+"\x3c/span\x3e\x3cspan class\x3d'"+c.itemDelete+" icon_tool' title\x3d'\u5220\u9664\u8be5\u9879' id\x3d'"+d+"'\x3e\x26#xe653;\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+a)).bind("dblclick",b,function(a){t(a.data.id,a.data.tag.toString())}),$("#"+d).bind("click dblclick",b,function(a){"dblclick"===a.type?(a.stopPropagation(),a.preventDefault()):t(a.data.id,a.data.tag.toString())}))},p=function(a,b){void 0===a&&(a="#efefef");void 0===b&&(b="Microsoft YaHei");$("."+c.item).height(20).css({"font-family":b,cursor:"default",margin:"4px 0"});$("."+c.item+" span").css({display:"inline-block",height:"100%","line-height":"20px"});$("."+c.itemName).css({color:a,width:"80%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.itemDelete).css({color:"#F00",width:"20%","text-align":"center",cursor:"pointer"})},t=function(a,d){var e=CBoBo.Dicom.GetTagData(d);if(void 0!==e&&CBoBo.Config.DeleteCornerInfoItem(b,g(),d)){var f=e.name;$("#"+a+" ."+c.item).each(function(){var a=$(this);a.children("."+c.itemName).html()===f&&a.remove()})}},u=function(){var a=c.ltContainer;$("#"+a).empty();a=c.rtContainer;$("#"+a).empty();a=c.rbContainer;$("#"+a).empty();a=c.lbContainer;$("#"+a).empty()},w=function(){var a=c.ltContainer,d=CBoBo.Config.GetCornerInfoItem(b,"lt");N(a,d);a=c.rtContainer;d=CBoBo.Config.GetCornerInfoItem(b,"rt");N(a,d);a=c.rbContainer;d=CBoBo.Config.GetCornerInfoItem(b,"rb");N(a,d);a=c.lbContainer;d=CBoBo.Config.GetCornerInfoItem(b,"lb");N(a,d);a=CBoBo.Config.GetCornerInfoFontColor();d=CBoBo.Config.GetCornerInfoFontFamily();p(a,d)},N=function(a,b){if(!(b instanceof Array))throw"PushItemByArray:array is not correct.";$.each(b,function(){r(a,this)})};(function(){c.ctrl=CBoBo.Plugin.GetRandom();c.left=CBoBo.Plugin.GetRandom();c.right=CBoBo.Plugin.GetRandom();c.lt=CBoBo.Plugin.GetRandom();c.rt=CBoBo.Plugin.GetRandom();c.rb=CBoBo.Plugin.GetRandom();c.lb=CBoBo.Plugin.GetRandom();c.center=CBoBo.Plugin.GetRandom();c.centerHead=CBoBo.Plugin.GetRandom();c.centerContainer=CBoBo.Plugin.GetRandom();c.itemhead=CBoBo.Plugin.GetRandom();c.itemHeadName=CBoBo.Plugin.GetRandom();c.itemHeadOparete=CBoBo.Plugin.GetRandom();c.lbContainer=CBoBo.Plugin.GetRandom();c.ltContainer=CBoBo.Plugin.GetRandom();c.rtContainer=CBoBo.Plugin.GetRandom();c.rbContainer=CBoBo.Plugin.GetRandom();c.left_modalty=CBoBo.Plugin.GetRandom();c.left_fontStyle=CBoBo.Plugin.GetRandom();var a="\x3cdiv class\x3d'"+c.itemhead+"'\x3e\x3cspan class\x3d'"+c.itemHeadName+"'\x3eName\x3c/span\x3e\x3cspan class\x3d'"+c.itemHeadOparete+"'\x3e\u64cd\u4f5c\x3c/span\x3e\x3c/div\x3e";$("\x3cdiv id\x3d'"+c.left+"'\x3e"+("\x3cdiv id\x3d'"+c.left_modalty+"'\x3e\x3c/div\x3e")+("\x3cdiv id\x3d'"+c.left_fontStyle+"'\x3e\x3c/div\x3e")+"\x3c/div\x3e\x3cdiv id\x3d'"+c.right+"'\x3e\x3cdiv id\x3d'"+c.lt+"'\x3e"+a+"\x3cdiv id\x3d'"+c.ltContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.center+"'\x3e"+("\x3cdiv id\x3d'"+c.centerHead+"'\x3e\x3cspan\x3eTag\x3c/span\x3e\x3cspan\x3eName\x3c/span\x3e\x3cspan\x3e\u64cd\u4f5c\x3c/span\x3e\x3c/div\x3e")+("\x3cdiv id\x3d'"+c.centerContainer+"'\x3e\x3c/div\x3e")+"\x3c/div\x3e\x3cdiv id\x3d'"+c.rt+"'\x3e"+a+"\x3cdiv id\x3d'"+c.rtContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.rb+"'\x3e"+a+"\x3cdiv id\x3d'"+c.rbContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.lb+"'\x3e"+a+"\x3cdiv id\x3d'"+c.lbContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+d.right))})();e();(function(){var b=$("#"+c.lt),d=$("#"+c.rt),e=$("#"+c.rb),g=$("#"+c.lb);b.bind("mousedown",function(b){a=0;f()});d.bind("mousedown",function(b){a=1;f()});e.bind("mousedown",function(b){a=2;f()});g.bind("mousedown",function(b){a=3;f()})})();(function(){var a="#"+c.left_modalty;q(a,"\u8bbe\u5907\u914d\u7f6e",{width:"100%",height:"30px"});a="#"+h(a,"\u5f71\u50cf",{"margin-left":"10px"},function(a){var d=$(c.modality).parent();"2D"===a?(d.css({visibility:""}),b=$(c.modality).val()):(d.css({visibility:"hidden"}),b=a);u();w()});l(a,"2D","2D");l(a,"Film","FILM");a="#"+c.left_modalty;c.modality=a="#"+h(a,"\u8bbe\u5907",{"margin-left":"10px"},function(a){b=a;u();w()});l(a,"CT","CT");l(a,"PT","PT");l(a,"MR","MR");l(a,"XR","XR");l(a,"OTHER","OTHER");a="#"+c.left_fontStyle;q(a,"\u5b57\u4f53\u8bbe\u7f6e",{width:"100%",height:"30px"});a="#"+h(a,"\u6837\u5f0f",{"margin-left":"10px"},function(a){CBoBo.Config.SetCornerInfoFontFamily(a);var b=CBoBo.Config.GetCornerInfoFontColor();p(b,a)});l(a,"Arial","Arial");l(a,"\u5fae\u8f6f\u96c5\u9ed1","Microsoft YaHei");l(a,"\u5b8b\u4f53","SimSun");l(a,"\u65b0\u5b8b\u4f53","NSimSun");l(a,"\u4eff\u5b8b_GB2312","FangSong_GB2312");l(a,"\u6977\u4f53_GB2312","KaiTi_GB2312");l(a,"\u9ed1\u4f53","SimHei");l(a,"Arial Black","Arial Black");l(a,"Times New Roman","Times New Roman");l(a,"Courier New","Courier New");l(a,"Tahoma","Tahoma");l(a,"Verdana","Verdana");var d=CBoBo.Config.GetCornerInfoFontFamily();$(a).val(d);a="#"+c.left_fontStyle;d=CBoBo.Config.GetCornerInfoFontColor();v(a,d,function(a){CBoBo.Config.SetCornerInfoFontColor(a);var b=CBoBo.Config.GetCornerInfoFontFamily();p(a,b)},{margin:"10px 0 0 10px"})})();(function(){void 0!==CBoBo.Dicom&&($.each(CBoBo.Dicom.GetTagData(),function(){k(this.tag,this.name)}),n(),$("#"+c.centerContainer).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"}))})();w();return e},e=function(){var a="CT",b={},c=function(){var c=b.bodyid;$(c).empty();var d=CBoBo.Config.GetPreWwWc(a),e;$.each(d,function(){e=[];e.push({title:this.title,width:"20%"});e.push({title:this.ww,width:"20%"});e.push({title:this.wc,width:"20%"});e.push({title:this.shortcutName,width:"20%"});p(c,e,this.id,f)});t()},e=function(a){switch(a){case 0:return"title";case 1:return"ww";case 2:return"wc";case 3:return"shortcut"}},f=function(b,c,d,f,g,h,k){switch(b){case "delete":CBoBo.Config.DeletePreWwWc(a,c);d.remove();break;case "modify":CBoBo.Config.ModalityPreWwWc(a,c,e(d),f,g,h,k)}};b.ctrl=CBoBo.Plugin.GetRandom();b.preWw=CBoBo.Plugin.GetRandom();b.shortcut=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+b.ctrl+"'\x3e\x3cdiv id\x3d'"+b.preWw+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.shortcut+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+d.right));(function(){var a=$("#"+b.ctrl),c=$("#"+b.preWw),d=$("#"+b.shortcut),e=a.parent().width();a.width(e-60).css({height:"100%",position:"absolute",top:0,left:"60px",overflow:"hidden","font-family":"Microsoft Yahei"});c.css({width:"30%",height:"100%",display:"inline-block"});d.css({width:"69%",height:"100%",display:"inline-block"})})();(function(){var d="#"+b.preWw;q(d,"\u9884\u8bbe\u7a97\u5bbd\u7a97\u4f4d",{width:"100%",height:"30px"});d="#"+h(d,"\u8bbe\u5907\u7c7b\u578b",{"margin-left":"20px"},function(b){a=b;c()});l(d,"CT","CT");l(d,"PT","PT");l(d,"MR","MR");l(d,"XR","XR");l(d,"OTHER","OTHER");var d="#"+b.preWw,e=$(d).width()-22,d="#"+k(d,{float:"left",width:e+"px",height:"400px",margin:"10px 0 0 20px",border:"1px solid #666",position:"relative"}),e=[];e.push({title:"\u540d\u79f0",width:"20%"});e.push({title:"\u7a97\u5bbd",width:"20%"});e.push({title:"\u7a97\u4f4d",width:"20%"});e.push({title:"\u5feb\u6377\u952e",width:"20%"});e.push({title:"\u64cd\u4f5c",width:"20%"});m(d,e,{height:"20px",background:"#333",width:"100%",color:"#efefef",cursor:"default"});b.bodyid="#"+n(d,{height:"355px",width:"100%",background:"#222",overflow:"hidden"});r(d,{bottom:"0",width:"100%",height:"25px",position:"absolute","text-align":"center",color:"green",cursor:"pointer"},function(c){c=CBoBo.Config.PushPreWwWc(a,"","","","",!1,!1);if(c instanceof String)$.Msg(c);else{var d=[];d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});p(b.bodyid,d,c,f)}});d="#"+b.shortcut;q(d,"\u5feb\u6377\u952e\u914d\u7f6e",{width:"100%",height:"30px","margin-left":"40px"});e=$(d).width()-62;preBoxHeight=$(d).height()-60;d="#"+k(d,{float:"left",width:e+"px",height:preBoxHeight+"px",margin:"10px 0 0 60px",border:"1px solid #666",position:"relative"});e=[];e.push({title:"\u52a8\u4f5c",width:"80%"});e.push({title:"\u5feb\u6377\u952e",width:"20%"});m(d,e,{height:"20px",background:"#333",width:"100%",color:"#efefef",cursor:"default"},!0);d="#"+n(d,{height:preBoxHeight-20+"px",width:"100%",background:"#222",overflow:"hidden"});e=[];e.push({title:"\u7684\u6492\u54e5\u53cd\u5bf9\u5927\u5e08\u5085",width:"80%"});e.push({title:"R",width:"20%"});t();$(d).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"})})();c()},h=function(a,b,c,d){if(void 0!=b&&void 0!=a){var e=CBoBo.Plugin.GetRandom(),f=CBoBo.Plugin.GetRandom();a=$("\x3cdiv id\x3d'"+f+"'\x3e\x3cspan\x3e"+b+"\x3c/span\x3e\x3cselect id\x3d'"+e+"' title\x3d'"+b+"'\x3e\x3c/select\x3e\x3c/div\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef"});$("#"+f+" span").css({cursor:"default","margin-right":"8px"});$("#"+e).css({cursor:"pointer","min-width":"100px"});void 0!==c&&"object"===typeof c&&a.css(c);d instanceof Function&&$("#"+e).bind("change",function(a){d($(this).val())});return e}},l=function(a,b,c){void 0!=b&&$("\x3coption value\x3d'"+c+"'\x3e"+b+"\x3c/option\x3e").appendTo($(a))},k=function(a,b){var c=CBoBo.Plugin.GetRandom();a=$("\x3cdiv id \x3d'"+c+"'\x3e\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&a.css(b);return c},m=function(a,b,c,d){var e="",f;$.each(b,function(a){f=d||b.length-1!==a?"\x3cspan style\x3d'width:"+this.width+";height:100%;display:inline-block;'\x3e"+this.title+"\x3c/span\x3e":"\x3cspan style\x3d'width:"+this.width+";height:100%;display:inline-block;text-align:center;'\x3e"+this.title+"\x3c/span\x3e";e+=f});a=$("\x3cdiv\x3e"+e+"\x3c/div\x3e").appendTo($(a));void 0!==c&&"object"===typeof c&&a.css(c)},n=function(a,b){var c=CBoBo.Plugin.GetRandom();a=$("\x3cdiv id \x3d'"+c+"'\x3e\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&a.css(b);return c},p=function(a,b,c,e,f){function g(a){var b;$("."+k).each(function(c,d){a===this&&(b=c)});return b}void 0===d.InsertTableItem&&(d.InsertTableItem=CBoBo.Plugin.GetRandom());var h=CBoBo.Plugin.GetRandom(),k=CBoBo.Plugin.GetRandom(),l="",m;if(f)$.each(b,function(a){m=b.length-1===a?"\x3cinput id\x3d'"+h+"' type\x3d'text' style\x3d' width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e":"\x3cinput type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e";l+=m});else{var n=CBoBo.Plugin.GetRandom();$.each(b,function(a){m=b.length-1===a?"\x3cinput id\x3d'"+h+"' type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e":"\x3cinput class\x3d'"+k+"' type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef;' value\x3d'"+this.title+"'/\x3e";l+=m});l+="\x3cspan type\x3d'text' style\x3d'width:20%;height:100%;float:left;text-align:center; cursor:pointer;display:inline-block;color:red;' id\x3d'"+n+"' class\x3d'icon_tool' title\x3d'\u5220\u9664\u8be5\u9879'\x3e\x26#xe653;\x3c/span\x3e"}var r=$("\x3cdiv class\x3d'"+d.InsertTableItem+"'\x3e"+l+"\x3c/div\x3e").appendTo($(a)),p,q,v;$("#"+h).bind("focus blur keydown",c,function(a){var d=$(this);switch(a.type){case "focus":d.css({color:"#222",background:"#aaa","text-align":"center"});break;case "blur":d.css({color:"#efefef",background:"#444","text-align":"left"});break;case "keydown":var f=a.keyCode;(8<=f&&36>=f||41<=f&&47>=f||136<=f&&254>=f||91<=f&&95>=f)&&192!==f||(p=String.fromCharCode(a.keyCode).toUpperCase(),q=a.ctrlKey,v=a.altKey,a.stopPropagation(),a.preventDefault(),f="",a.ctrlKey&&(f+="Ctrl+"),a.altKey&&(f+="Alt+"),f+=p,"Ctrl+C"===f||"Ctrl+A"===f||"Ctrl+V"===f||"Ctrl+X"===f||"Ctrl+F"===f?$.Msg("\u8be5\u7ec4\u5408\u952e\u88ab\u7cfb\u7edf\u5360\u7528."):(d.val(f),e instanceof Function&&e("modify",c,b.length-1,a.target.value,p,q,v)))}});f||($("#"+n).bind("click",c,function(a){e instanceof Function&&e("delete",c,r)}),$("."+k).bind("change",c,function(a){e instanceof Function&&e("modify",c,g(a.target),a.target.value)}))},t=function(){$("."+d.InsertTableItem).css({height:"20px",margin:"5px 0"})},r=function(a,b,c){a=$("\x3cdiv\x3eAdd\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&a.css(b);c instanceof Function&&a.bind("mouseenter mouseleave click ",function(a){var b=$(this);switch(a.type){case "mouseenter":b.css({background:"#666"});break;case "mouseleave":b.css({background:"#333"});break;case "click":c(a)}})},v=function(a,b,c,d){var e=CBoBo.Plugin.GetRandom();a=$("\x3cdiv\x3e\u989c\u8272 \x3cinput id\x3d'"+e+"' type\x3d'color' name\x3d'favcolor'value\x3d'"+b+"' /\x3e\x3c/div\x3e").appendTo($(a));a.height(60).css({"float":"left",color:"#efefef",cursor:"default","min-width":"100px"});void 0!==d&&"object"===typeof d&&a.css(d);c instanceof Function&&$("#"+e).bind("change",function(a){c($(this).val())});return e},w=function(a,b,c,d,e,f){var g=CBoBo.Plugin.GetRandom();a=$("\x3clabel title\x3d'"+c+"' value\x3d'"+d+"'\x3e\x3cinput id\x3d'"+g+"' name\x3d'"+b+"' type\x3d'radio'  value\x3d'"+d+"'/\x3e"+c+"\x3c/label\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef",cursor:"pointer"});void 0!==e&&"object"===typeof e&&a.css(e);f instanceof Function&&$("#"+g).bind("click",f)},q=function(a,b,c){a=$("\x3clabel\x3e"+b+"\x3c/label\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef"});void 0!==c&&"object"===typeof c&&a.css(c)},u=function(a){var b=$.extend(!0,{parent:null,iconstr:"",title:"",name:"",value:"",exstyle:{},iconstyle:{},change:null},a);a=CBoBo.Plugin.GetRandom();var c=$("\x3cdiv title\x3d'"+b.title+"'\x3e\x3cdiv style\x3d'pointer-events:none;' id\x3d'"+a+"' class\x3d'icon_tool'\x3e"+b.iconstr+"\x3c/div\x3e\x3cinput name\x3d'"+b.name+"'style\x3d'pointer-events:none;' type\x3d'radio'  value\x3d'"+b.value+"' style\x3d'cursor:pointer'\x3e\x3c/div\x3e").appendTo($(b.parent));c.css({"float":"left",color:"#fff",cursor:"pointer","text-align":"center"});c.css(b.exstyle);$("#"+a).css(b.iconstyle);c.bind("click",function(a){var c=a.target.title;$("input:radio[name\x3d'"+b.name+"']").each(function(){var a=$(this),b=a.prev();a.val()===c?(b.css("color","#F0F"),this.checked=!0):(b.css("color","#fff"),this.checked=!1)});b.change instanceof Function&&b.change(c)});return a};this.Show=function(a){this.bShow=a;var b=$("#"+d.ctrl),c=$("body");a?(b.hide(),b.fadeIn(500),c.css("pointer-events","none"),b.css("pointer-events","auto")):(b.fadeOut(500),c.css("pointer-events",""),b.css("pointer-events",""))};d.ctrl=CBoBo.Plugin.GetRandom();d.left=CBoBo.Plugin.GetRandom();d.right=CBoBo.Plugin.GetRandom();d.headbtn=CBoBo.Plugin.GetRandom();d.headbtnicon=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+d.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+d.left+"'\x3e\x3cdiv class\x3d'"+d.headbtn+"' title\x3d'\u57fa\u672c\u914d\u7f6e'\x3e\x3cspan class\x3d'"+d.headbtnicon+"'\x3e\x26#xe6ba;\x3c/span\x3e\x3cspan\x3e\u57fa\u672c\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'"+d.headbtn+"' title\x3d'\u56db\u89d2\u4fe1\u606f\u914d\u7f6e'\x3e\x3cspan class\x3d'"+d.headbtnicon+"'\x3e\x26#xe6bb;\x3c/span\x3e\x3cspan\x3e\u56db\u89d2\u4fe1\u606f\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'"+d.headbtn+"' title\x3d'\u5176\u4ed6\u914d\u7f6e'\x3e\x3cspan class\x3d'"+d.headbtnicon+"'\x3e\x26#xe6b8;\x3c/span\x3e\x3cspan\x3e\u5176\u4ed6\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+d.right+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body")).css({position:"absolute",left:0,top:CBoBo.View.TOOLBAR_HEIGHT,"z-index":"9999",background:"#535353","border-top":"1px solid #383838",overflow:"hide"});f();(function(){var a=$("."+d.headbtn);a.bind("click",function(f){a.css({"background-color":"","pointer-events":""});$(this).css({"background-color":"#333333","pointer-events":"none"});f=f.target.title;$("#"+d.right).empty();switch(f){case "\u57fa\u672c\u914d\u7f6e":b=g();break;case "\u56db\u89d2\u4fe1\u606f\u914d\u7f6e":b=c();break;case "\u5de5\u5177\u680f\u914d\u7f6e":CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();$("\x3ch1\x3e\u5de5\u5177\u680f\u914d\u7f6e\x3c/h1\x3e").appendTo($("#"+d.right));b=void 0;break;case "\u5176\u4ed6\u914d\u7f6e":b=e()}})})();$("."+d.headbtn).eq(0).trigger("click")};CBoBo.View.AssistDiagnose=function(d){var b=this;this.recrodStatus={};var a=$.extend(!0,{msgtransform:null,server:""},d),f,g={};this.bShow=!1;var c=!0,e,h,l;this.Login=function(){f=io.connect("ws://"+a.server);k();b.UpdateRoomList(!0);b.UpdateRoomList(!1)};this.UpdateRoomList=function(a){void 0!==f&&(a?f.emit("getmyroom",{uid:"ranqiwu"}):f.emit("getotherroom",{uid:"ranqiwu"}))};this.Show=function(a){this.bShow=a;a=$("#"+g.ctrl);this.bShow?(a.hide(),a.fadeIn(400)):a.fadeOut(400)};this.SendCommand=function(a){f.emit("command",a)};var k=function(){var b=f;b.on("connect",function(){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"success"}})});b.on("connect_failed",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"failed"}})});b.on("error",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"error"}})});b.on("reconnecting",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"reconnecting",times:b}})});b.on("reconnect",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"reconnected",times:b}})});b.on("disconnect",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"disconnect"}})});b.on("command",function(b){null!==a.msgtransform&&a.msgtransform({type:"command",data:b})});b.on("myroom",function(a){$.each(a,function(){n({title:this.title,personcount:this.personcount,id:this.roomid},!0)})});b.on("otherroom",function(a){$.each(a,function(){n({title:this.title,personcount:this.personcount,id:this.roomid})})})},m=function(a){h=a.destory;l=a.gray;var b=a.password;e=a.title;""!==b&&(b=hex_md5(b));f.emit("createroom",{uid:"ranqiwu",title:a.title,isprivate:a.isprivate,password:b});c&&(f.on("createroomstatus",function(a){a.success?(void 0!==h&&h(),n({title:e},!0),$.Msg(a.msg,CBoBo.MSG_SUCCESS)):(void 0!==l&&l(),$.Msg(a.msg,CBoBo.MSG_ERROR))}),c=!1)},n=function(a,b){if("object"==typeof a){var c=$.extend(!0,{title:"",personcount:0,author:"",createtime:"",type:"",id:""},a),d="\x3cli\x3e\x3cspan\x3e"+c.title+"\x3c/span\x3e\x3cspan style\x3d'color:#FFF'\x3e "+c.personcount+"\x3c/span\x3e\x3c/li\x3e";b=b?g.myroom+" ul":g.otherroom+" ul";$(d).appendTo("#"+b).css({cursor:"default",margin:"2px 0"}).bind("dblclick",function(b){p(!0);b=$(this).data("info");"object"==typeof a&&void 0!==f&&f.emit("entersession",{uid:"ranqiwu",roomid:b.id})}).data("info",c)}},p=function(a){$("#"+g.ctrl);var b=.5*$(window).height()>>0,b=300>b?300:b;a?(a=.3*$(window).width()>>0,a=285>a?285:a):a=288;$("."+g.clear).css({display:"none",float:"none"});$("#"+g.ctrl).width(a).height(b).css({border:"1px solid #676767",position:"absolute","z-index":"9999",background:"#444444","user-select":"none",color:"#CCCCC4"});$("#"+g.title).css({height:"30px",width:"100%",background:"#555555",cursor:"default","border-bottom":"1px solid #000","text-align":"center","box-shadow":"0 1px 2px #000"});$("#"+g.title+" span").css({width:"40%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+g.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+g.container).css({position:"relative"});$("#"+g.search).css({height:"30px",width:"100%",background:"#131313"});$("#"+g.search+" input").css({width:a-55+"px",height:"100%","padding-left":"3px",float:"left"});$("#"+g.searchbtn).css({width:"48px","font-size":"5%",cursor:"pointer",display:"block","text-align":"center",height:"30px",float:"right","line-height":"30px"});var c=$("#"+g.room),b=b-62;c.height(b).width(288).css({float:"left"});$("#"+g.roommanager).height(30).css({width:"100%",background:"gray",color:"#222"});$("."+g.roommanactrl).height(30).css({width:"90","line-height":"30px",cursor:"pointer"});$("."+g.roommanactrl+" label").css({"font-size":"130%","padding-right":"4px"});c=$("."+g.roomtitle);c.css({width:"100%",background:"#555555",display:"block","margin-bottom":"3px","box-shadow":"0 1px 3px #333",cursor:"pointer","padding-left":"5px"});var d=$("#"+g.myroom),e=.3*b>>0;d.css({width:"100%","margin-bottom":"6px","max-height":e+"px"});var d=$("#"+g.myroom+" ul"),f=e-c.height();d.css({"overflow-y":"auto",height:f+"px"});d=$("#"+g.otherroom);e=b-e;d.css({width:"100%","max-height":e+"px"});d=$("#"+g.otherroom+" ul");c=e-c.height();d.css({"overflow-y":"auto",height:c+"px"});c=$("#"+g.roomin);a-=288;c.height(b).width(a).css({float:"right",background:"#da8456"})},t=function(a){function b(){e.remove()}function c(a){var b=$("#"+d);a?(b.html("\u6b63\u5728\u521b\u5efa..."),b.css({"pointer-events":"none"})):(b.html("\u786e\u5b9a"),b.css({"pointer-events":""}))}var d,e,f=this,h=!1;(function(){var d="assist"+CBoBo.Plugin.GetRandom(),k="input"+CBoBo.Plugin.GetRandom(),l="input"+CBoBo.Plugin.GetRandom(),m="input"+CBoBo.Plugin.GetRandom(),n="input"+CBoBo.Plugin.GetRandom(),p="input"+CBoBo.Plugin.GetRandom();f.cfmbtn=p;var r="input"+CBoBo.Plugin.GetRandom(),q="checkbox"+CBoBo.Plugin.GetRandom(),t="passwordbox"+CBoBo.Plugin.GetRandom();e=$("\x3cdiv \x3e\x3cform id\x3d'"+d+"'\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan \x3e\u623f\u95f4\u540d\uff1a\x3c/span\x3e\x3cinput id\x3d'"+k+"' type\x3d'text' placeholder\x3d'\u8bf7\u8f93\u5165\u623f\u95f4\u540d\u79f0' required\x3d'required' autofocus max\x3d'15' tabindex\x3d'0'\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv id\x3d'"+q+"' \x3e\x3cdiv style\x3d'text-align:right; width:90px'\x3e\u623f\u95f4\u52a0\u5bc6\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+t+"' style\x3d'display:none;'\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan\x3e\u5bc6\u7801\uff1a\x3c/span\x3e\x3cinput id\x3d'"+l+"' type\x3d'password' placeholder\x3d'\u8bf7\u8f93\u5165\u623f\u95f4\u5bc6\u7801' required\x3d'required' tabindex\x3d'1'\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan\x3e\u786e\u8ba4\u5bc6\u7801\uff1a\x3c/span\x3e\x3cinput id\x3d'"+m+"' type\x3d'password' placeholder\x3d'\u8bf7\u786e\u8ba4\u623f\u95f4\u5bc6\u7801' required\x3d'required' tabindex\x3d'2'\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cbutton id\x3d'"+p+"' tabindex\x3d'3' type\x3d'submit'\x3e\u786e\u5b9a\x3c/button\x3e\x3cbutton id\x3d'"+r+"' tabindex\x3d'4'\x3e\u53d6\u6d88\x3c/button\x3e\x3c/div\x3e\x3c/form\x3e\x3c/div\x3e").appendTo($("#"+g.container));e.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",background:"#444444","box-shadow":"1px 1px 2px #000"});$("#"+d).css({margin:"0 auto",width:"288px",height:"100%","padding-top":"20px"});$("."+n).css({"margin-bottom":"10px","text-align":"center"});$("."+n+" span").css({"text-align":"right",width:"90px",display:"inline-block","vertical-align":"middle"});$("."+n+" input").css({padding:"0",border:"1px solid #333",background:"#ddd",height:"25px"});$("."+n+" button").css({width:"90px",background:"#333",border:"0",height:"30px",color:"#ccccc4",cursor:"pointer"}).bind("mouseenter mouseleave",function(a){"mouseenter"==a.type?$(this).css({background:"#ccccc4",color:"#333"}):"mouseleave"==a.type&&$(this).css({background:"#333",color:"#ccccc4"})});$("#"+p).css({"margin-right":"10px"});$("#"+r).bind("click",function(a){a.preventDefault();b()});$("#"+p).bind("click",function(d){d.preventDefault();if(void 0!==a||null!==a)if(d=$("#"+k).val(),""===d)$.Msg("\u623f\u95f4\u540d\u4e0d\u80fd\u4e3a\u7a7a!");else{var e="";if(h){var e=$("#"+l).val(),f=$("#"+m).val();if(""===e){$.Msg("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a!");return}if(e!==f){$.Msg("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u76f8\u540c!");return}}c(!0);a({title:d,isprivate:h,password:e,destory:b,gray:c})}});$("#"+q).height(40).css({position:"relative"});(new CBoBo.View.CheckBox({parent:"#"+q,title:"\u623f\u95f4\u52a0\u5bc6",msgtransform:function(a){h=a;var b=$("#"+t);a?b.slideDown(400):b.slideUp(400)}})).SetPositon(110,-18)})()};g.ctrl="assist"+CBoBo.Plugin.GetRandom();g.title=CBoBo.Plugin.GetRandom();g.container=CBoBo.Plugin.GetRandom();g.search=CBoBo.Plugin.GetRandom();g.searchbtn=CBoBo.Plugin.GetRandom();g.room=CBoBo.Plugin.GetRandom();g.roommanager=CBoBo.Plugin.GetRandom();g.roomin=CBoBo.Plugin.GetRandom();g.clear=CBoBo.Plugin.GetRandom();g.roommanactrl=CBoBo.Plugin.GetRandom();g.myroom=CBoBo.Plugin.GetRandom();g.otherroom=CBoBo.Plugin.GetRandom();g.roomtitle=CBoBo.Plugin.GetRandom();g.addstudy=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+g.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+g.title+"'\x3e\x3cspan\x3e\u534f\u540c\u8bca\u65ad\x3c/span\x3e\x3ca\x3e\x26#xe661;\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d'"+g.container+"'\x3e\x3cdiv id\x3d'"+g.search+"'\x3e\x3cinput type\x3d'text' placeholder\x3d'\u641c\u7d22\uff1a\u623f\u95f4\u540d/\u53f7\u3001\u5728\u7ebf\u7528\u6237'\x3e\x3c/input\x3e\x3ca id\x3d'"+g.searchbtn+"'\x3e\u53d6\u6d88\x3c/a\x3e\x3cdiv class'"+g.clear+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+g.room+"'\x3e\x3cdiv id\x3d'"+g.roommanager+"'\x3e\x3cdiv class\x3d'"+g.roommanactrl+"'\x3e\x3clabel\x3e\x26#xe69d;\x3c/label\x3e\x3cspan\x3e\u521b\u5efa\u623f\u95f4\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+g.myroom+"'\x3e\x3cspan class\x3d'"+g.roomtitle+"'\x3e\u6211\u7684\u623f\u95f4\x3c/span\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv id\x3d'"+g.otherroom+"'\x3e\x3cspan class\x3d'"+g.roomtitle+"'\x3e\u516c\u5171\u623f\u95f4\x3c/span\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+g.roomin+"'\x3e\x3ca id\x3d'"+g.addstudy+"'\x3e\u66f4\u65b0\u68c0\u67e5\x3c/a\x3e\x3c/div\x3e\x3cdiv class'"+g.clear+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));p(!1);(function(){$("#"+g.title).bind("mousedown",function(a){function b(a){switch(a.type){case "mousemove":c.css({left:a.pageX-d.x+e.x+"px",top:a.pageY-d.y+e.y+"px"});break;case "mouseup":$(document).unbind("mousemove mouseup",b)}}var c=$("#"+g.ctrl),d=new Point(a.pageX,a.pageY);a=c.offset();var e=new Point(a.left,a.top);$(document).bind("mousemove mouseup",b)});$("#"+g.title+" a").bind("click",function(c){c.preventDefault();b.Show(!1);null!=a.msgtransform&&a.msgtransform({type:"btnfocus",btntitle:"\u534f\u540c\u8bca\u65ad",btnforce:!1})});$("."+g.roomtitle).bind("click",function(a){a=$(this).next();"none"==a.css("display")?(a.hide(),a.slideDown(300)):a.slideUp(300)});$("."+g.roommanactrl).bind("click",function(a){switch($(this).children("span").html()){case "\u521b\u5efa\u623f\u95f4":t(m)}});$("#"+g.addstudy).bind("click",function(b){"function"===typeof a.msgtransform&&a.msgtransform({type:"addstudy"})})})();(function(){var a=$("body"),b=$("#"+g.ctrl),c=a.width(),a=a.height(),d=b.width(),e=b.height();b.css({left:(c-d>>1)+"px",top:(a-e>>1)+"px"})})();n({title:"\u5395\u6240",personcount:2016,id:"aa123"},!0)};CBoBo.View.CanvasMax=function(d){this.bShow;var b=$.extend(!0,{parent:null},d),a=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var d=$("#"+a),g=$(b.parent),c=g.width(),g=g.height();d.width(c).height(g).css({left:"10px",top:"10px"})};this.Show=function(b){var d=$("#"+a);b?(this.bShow=!0,d.hide(),d.fadeIn(400)):(this.bShow=!1,d.fadeOut(400))};$("\x3cdiv id\x3d'"+a+"'\x3e\x3c/div\x3e").appendTo($(b.parent)).css({position:"absolute","z-index":1E3,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"});this.UpdateStyle();d.parent="#"+a;this.secondCtrl=new CBoBo.View.CMngSecondLayer(d)};CBoBo.View.IconInfo=function(d){$.extend(!0,{msgtransform:null},d);var b={};this.bShow;this.Show=function(a){var d=$("#"+b.ctrl);a?(d.fadeIn(300),this.bShow=!0):(d.fadeOut(800),this.bShow=!1)};this.SetInfo=function(){var a="#"+b.container;$(a).html("");b.td||(b.td=CBoBo.Plugin.GetRandom());b.th||(b.th=CBoBo.Plugin.GetRandom());var d="\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.th+"'\x3e\u6309\u952e\x3c/td\x3e\x3ctd class\x3d'"+b.th+"'\x3e\u529f\u80fd\u63cf\u8ff0\x3c/td\x3e\x3ctd class\x3d'"+b.th+"'\x3e\u6309\u952e\x3c/td\x3e\x3ctd class\x3d'"+b.th+"'\x3e\u529f\u80fd\u63cf\u8ff0\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5f71\u50cf\u6e90\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u53cc\u51fb\u5168\u5c4f\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61b\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u8c03\u7a97/\u81ea\u5b9a\u4e49\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe631\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u91ca\u653e\u5de5\u5177\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe67f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u91cd\u65b0\u52a0\u8f7d\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe62a\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u56fe\u50cf\u5e03\u5c40\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe66d\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5e8f\u5217\u5e03\u5c40\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe644\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u6062\u590d\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe607\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5e8f\u5217\u64ad\u653e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe610\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5b9a\u4f4d\u7ebf\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe629\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u6587\u672c\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe671\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3eDICOM\u4fe1\u606f\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe6b6\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u56db\u89d2\u4fe1\u606f\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe670\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u653e\u7f29\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe630\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u79fb\u52a8\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe623\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u65cb\u8f6c\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe603\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u8d1f\u50cf\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe602\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u4f2a\u5f69\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u76f4\u7ebf\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe901\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u9510\u5316\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe902\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5e73\u6ed1\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe617\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5fc3\u80f8\u6bd4\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe619\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u77e9\u5f62\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe622\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u64a4\u9500\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61e\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u692d\u5706\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe653\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5220\u9664\u56fe\u50cf\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe618\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u89d2\u5ea6\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe64c\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u6309\u952e\u8bf4\u660e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe637\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3eCT\u503c\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3eMPR\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3eMPR\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe62f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u7bad\u5934\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xE60E\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u53f3\u6807\u8bb0\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe9d8\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5de6\u6807\u8bb0\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),d=d+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+b.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe900\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u5f00/\u5173\u56fe\u50cf\u7f13\u5b58\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3eshift+delete\x3c/td\x3e\x3ctd class\x3d'"+b.td+"'\x3e\u6e05\u9664\u56fe\u50cf\u7f13\u5b58\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e");$(d).appendTo($(a));$("."+b.th).width(140).css({color:"#33ffff","font-size":"17px"});$("."+b.td).width(140).css({color:"#FFF","font-size":"17px"})};b.ctrl=CBoBo.Plugin.GetRandom();b.container=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+b.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+b.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));(function(){var a=$(window).width();$(window).height();var a=.5*a>>0,a=600<a?600:a,d=$("#"+CBoBo.Manager.canvasManager.arrTag.box).height(),g=$("#"+CBoBo.Manager.frame.GetId("banner")).height();$("#"+b.ctrl).width(a).height(d).css({border:"1px solid #676767",position:"absolute","z-index":11111,background:"#444444","border-radius":"20px",display:"none","user-select":"none",color:"#CCCCC4",opacity:"90%",right:"0px",top:g+"px"});$("#"+b.container).width(a-30).height(d-30-30).css({"user-select":"auto",padding:"15px","font-family":"Microsoft YaHei",overflow:"auto"})})()};