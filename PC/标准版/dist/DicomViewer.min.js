/*
 * @Date         : 2022-03-22 15:14:40
 * @Description  : 注释
 * @LastEditTime : 2022-05-27 15:07:45
 * @LastEditors  : chen wei
 * @Version      : 1.0
 */

/**
 * 该文件是根据视口的状态和提供的灰度图像数据信息转化成可在canvas绘制的图像，
 * 只是一个处理工厂，针对图像显示和变换
 * 依赖：DicomInfo、伪彩表
 *//**
 * Created by ZKK on 17/5/8.
 *//*2016.1.12编写
 * 该库是三维处理库
 * 依赖：CBoBo.DicomKernel处理库
 */// JavaScript source code


/**
 * 该库是灰度图像标注处理库
 * 2016.12.28编写
 * 依赖：CBoBo.DicomKernel处理库
 *//*伪彩表*/
"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.PTYPE_JPG=0;CBoBo.PTYPE_SERIES=1;CBoBo.PTYPE_DESERIES=2;CBoBo.TOOL_NULL=0;CBoBo.TOOL_WC=1;CBoBo.TOOL_MOVE=2;CBoBo.TOOL_ZOOM=3;CBoBo.TOOL_PAGE=4;CBoBo.TOOL_M_POINT=5;CBoBo.TOOL_M_LINE=6;CBoBo.TOOL_M_RECT=7;CBoBo.TOOL_M_ELLIPSE=8;CBoBo.TOOL_M_CURVE=9;CBoBo.TOOL_M_ANGLE=10;CBoBo.TOOL_LABEL=11;CBoBo.TOOL_MAG=12;CBoBo.TOOL_POLYGON=13;CBoBo.TOOL_ARROW=14;CBoBo.TOOL_LEFT=15;CBoBo.TOOL_RIGHT=16;CBoBo.TOOL_HEARDRATIO=17;CBoBo.DRAW_IMG=0;CBoBo.DRAW_ANN=1;CBoBo.MPR_ORIGINAL=0;CBoBo.MPR_LEVEL=1;CBoBo.MPR_VERTICAl=2;CBoBo.MPR_ANY=3;CBoBo.TOOLMENU_JPG=0;CBoBo.TOOLMENU_SERIES=1;CBoBo.TOOLMENU_DESERIES=2;CBoBo.TOOLMENU_PRINT_JPG=3;CBoBo.TOOLMENU_PRINT_RADIATE=4;CBoBo.TOOLMENU_MPR=5;CBoBo.TOOLMENU_AI=6;CBoBo.MSG_ALERT=0;CBoBo.MSG_SUCCESS=1;CBoBo.MSG_ERROR=2;CBoBo.SMOOTHING_ENABLED=!1;CBoBo.Scrollsize=20;CBoBo.IsMobile=!1;CBoBo.IsTablet=!1;CBoBo.isShowAi=!1;CBoBo.rootDom=null;CBoBo.Manager=function(d){var a=this;this.isAIFinished=this.isAIRequestFinished=!1;this.onTool={bShowScountLine:!1,stack:[]};this.handles={};this.privilege={bPrint:void 0,bMupStudy:!1};this.onCanvas={bLMouse:!1,bRMouse:!1,ptStart:{x:0,y:0},ptLast:{x:0,y:0},imgStatus:[],Ann:null,bEditAnn:!1,EditAnnData:null,curCanvas:null,ptLable:null,stampStart:null,bTouchMul:!1,lastScale:1};this.onObserver=function(a,c){this.handles.hasOwnProperty(a)||(this.handles[a]=[]);if("function"==typeof c)this.handles[a].push(c);else throw Error("\u7f3a\u5c11\u56de\u8c03\u51fd\u6570");return this};this.onEmit=function(a,c){if(this.handles.hasOwnProperty(a))this.handles[a].forEach(function(a,b,g){a.apply(null,c)});else throw Error('"'+a+'"\u4e8b\u4ef6\u672a\u6ce8\u518c');return this};this.onOff=function(a,c){if(this.handles.hasOwnProperty(a)){if("function"!=typeof c)throw Error("\u7f3a\u5c11\u56de\u8c03\u51fd\u6570");this.handles[a].forEach(function(a,b,g){a==c&&g.splice(b,1)})}else throw Error('"'+a+'"\u4e8b\u4ef6\u672a\u6ce8\u518c');return this};this.onThumb={bSeriesTile:!1};this.canvasManager;this.logo;this.dataManager;this.thumbManager;this.frame;this.annStatusManager;this.layoutCtrl;this.rotateCtrl;this.wwCtrl;this.lableCtrl;this.pseudocolorCtrl;this.mode;this.canvasCtxMenu;this.thumbCtxMenu;this.seriesPlayer;this.Mpr;this.printer;this.toolBar;this.configView;this.assistDiagnose;this.canvasMax;this.isKeyBoard=!1;this.rootDom=d;this.GlobalInit=function(){$("body,a,img,span").bind("drop",function(a){a.preventDefault();a.stopPropagation()});$("body").bind("touchmove",function(a){a.preventDefault()});document.oncontextmenu=function(a){a.cancelBubble=!0;return a.returnValue=!1};document.onmousedown=function(a){if(window.Event){if(2==a.which||3==a.which)return!1}else if(2==a.button||3==a.button)return a.cancelBubble=!0,a.returnValue=!1};document.onkeydown=function(b){var c=b||window.event||arguments.callee.caller.arguments[0];c&&a.KeyboardMsg(c)};window.screen&&window.resizeTo(screen.availWidth,screen.availHeight)};this.KeyboardMsg=function(b){if(!a.isKeyBoard)switch(b.keyCode){case 80:if(!a.privilege.bPrint)break;a.printer||(a.printer=new CBoBo.View.DVPrint({msgtransform:a.PrintView.MsgTransform,mode:a.mode}));a.onTool.MsgTransform({usermsg:"sdaf",btntitle:"\u80f6\u7247\u6253\u5370",btnforce:!0});if(a.printer){var c=[];a.printer.bShow||a.printer.Show(!0);if(a.mode==CBoBo.PTYPE_SERIES&&b.ctrlKey){var e=a.canvasManager.GetFocusMng().AnnStatusMng().GetAnnStatus();$.each(e,function(b,e){c.push(a.annStatusManager.GetCopyAnnStatus(e))})}else if(e=a.canvasManager.GetFocusCanvas().AnnStatus())e=a.annStatusManager.GetCopyAnnStatus(e),c.push(e);0<c.length&&a.printer.RequestPrint(c)}b.preventDefault();break;case 27:a.canvasMax&&a.canvasMax.bShow&&a.onCanvas.DbClick();break;case 9:case 112:case 117:case 121:case 122:case 114:case 115:case 118:b.preventDefault();case 46:break;case 37:a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.scroll&&a.canvasMax.secondCtrl.scroll.TriggerClick(1):a.canvasManager.scroll&&a.canvasManager.scroll.TriggerClick(1);break;case 38:this.onCanvas.NextPage(1);break;case 39:a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.scroll&&a.canvasMax.secondCtrl.scroll.TriggerClick(-1):a.canvasManager.scroll&&a.canvasManager.scroll.TriggerClick(-1);break;case 40:this.onCanvas.NextPage(-1);break;case 83:b.ctrlKey&&b.preventDefault();break;case 82:b.ctrlKey?(a.onTool.ReLoadDicom(),b.preventDefault()):a.onTool.RestoreDicom();break;case 70:a.onTool.Negative();break;case 48:a.onTool.Pseudocolor("");break;case 49:a.onTool.Pseudocolor("\u5f69\u8679");break;case 50:a.onTool.Pseudocolor("\u9ed1\u4f53");break;case 51:a.onTool.Pseudocolor("\u9aa8\u9abc");break;case 52:a.onTool.Pseudocolor("\u5fc3\u810f");break;case 53:a.onTool.Pseudocolor("\u6d41\u52a8");break;case 54:a.onTool.Pseudocolor("Ge\u8272");break;case 55:a.onTool.Pseudocolor("\u5f69\u86791");break;case 56:a.onTool.Pseudocolor("\u7ea2\u8272\u8840\u7ba1");break;case 57:a.onTool.Pseudocolor("\u65af\u7279\u6069")}};this.DL={arrSpeed:{}};this.DL.OpenStudy=function(){void 0===a.dataManager&&(a.dataManager=new CBoBo.DataManager({render:a.DL.DLFirstProgress}));if(0===arguments.length){var b=$("#hdstuuid").val()||CBoBo.Plugin.GetUrlParam("Studyuid"),c=$("#hdurl").val()||CBoBo.Plugin.GetUrlParam("WadoURL"),e=$("#hdhospid").val()||CBoBo.Plugin.GetUrlParam("Hospid"),f=$("#token").val()||CBoBo.Plugin.GetUrlParam("token")||JSON.parse(localStorage.getItem("token")||localStorage.getItem("Authorization")),g=CBoBo.Plugin.GetUrlParam("isDesens")||CBoBo.Plugin.GetUrlParam("hasDesensitize")||CBoBo.Plugin.GetUrlParam("hdsensitivity")||$("#hasDesensitize").val()||$("#hdsensitivity").val();""===b?new CBoBo.Plugin.Error("Study not Found.","Studyuid is null."):""===c?new CBoBo.Plugin.Error("Study not Found.","Wadourl is null."):""===e?new CBoBo.Plugin.Error("Study not Found.","Hospitaluid is null."):a.dataManager.Request({wadourl:c,hospid:e,studyuid:b,token:f,hasDesensitize:JSON.parse(g||0),serverRead:!1,progress:a.DL.DLFirstProgress,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var c=CBoBo.Plugin.GetTime();console.log(c+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(c){a.Init();var b=a.thumbManager.GetThumb(c.studyuid);void 0===b&&(b=a.thumbManager.AddThumb(c.studyuid));b.First();a.DL.StudySuccess(c)}})}else 3==arguments.length&&(b=arguments[2],c=arguments[0],e=arguments[1],a.dataManager.Request({wadourl:c,hospid:e,studyuid:b,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var c=CBoBo.Plugin.GetTime();console.log(c+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(c){a.privilege.bMupStudy=!1;a.Init();var b=a.thumbManager.GetThumb(c.studyuid);void 0===b&&(b=a.thumbManager.AddThumb(c.studyuid));b.First();a.DL.StudySuccess(c)}}))};this.DL.RequestHistoryStudy=function(){a.privilege.bMupStudy=!1;var b="";$.ajax({url:"/Member/Study/GetHistoryViewerData",data:{requestID:$("#requestid").val()},type:"get",success:function(c){console.log(c);c.success&&(b=c.data,""==b?console.log("\u672a\u68c0\u6d4b\u5230\u5386\u53f2\u68c0\u67e5\u3002"):(console.log(b),0<b.length?b.forEach(function(c,b){a.dataManager.Request({wadourl:c.url,hospid:c.hospid,studyuid:c.stuuid,serverRead:!1,progress:a.DL.DLFirstProgress,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var c=CBoBo.Plugin.GetTime();console.log(c+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(c){a.DL.StudySuccess(c)}})}):console.log("\u672a\u68c0\u6d4b\u5230\u5386\u53f2\u68c0\u67e5\u3002")))}})};this.DL.StudySuccess=function(b){var c=a.thumbManager.GetThumb(b.studyuid);if(void 0===c||null===c)c=a.thumbManager.AddThumb(b.studyuid);a.DL.SetThumbHead(b,c);a.DL.SetThumbSeries(b,c)};this.DL.DLFirstProgress=function(b,c,e,f){b.col=void 0==b.col?512:b.col;b.row=void 0==b.row?512:b.row;a.UpdateCanvas(b);a.DL.DLProgress(b,c,e)};this.DL.DLProgress=function(b,c,e){var f=c.studyuid,g=a.thumbManager.GetThumb(f);void 0===a.DL.arrSpeed[f]&&(a.DL.arrSpeed[f]={dlnums:0,dlspeed:0,total:parseInt(c.imgcount),timer:null});f=a.DL.arrSpeed[f];f.dlnums++;f.dlnums===f.total&&($.Status("\u68c0\u67e5\u4e0b\u8f7d\u5b8c\u6bd5!"),clearInterval(f.timer));a.DL.ProcessMode({study:c,seriespro:function(){g.SetProgress(b.seruid,e)},deseriespro:function(){g.SetProgress(b.id,e)},jpgpro:function(){g.SetProgress(b.id,100)}})};this.DL.SetThumbHead=function(a,c){if(void 0===c)throw"SetThumbHead:parameter study cannot be undefined";if(void 0===a)throw"SetThumbHead:parameter thumb cannot be undefined";var b;""===a.age||null===a.age?b=a.name+" / "+a.sex:("string"===typeof a.age&&0==parseInt(a.age.substring(0,1))&&(a.age=a.age.substring(1)),b=a.name+" / "+a.sex+" / "+a.age);c.SetHeadInfo(b,a.modality,a.studydate)};this.DL.SetThumbSeries=function(b,c){a.DL.ProcessMode({study:b,seriespro:function(){for(var a=b.GetAllSeries(),f,g=0;g<a.length;g++){f=a[g];c.PushSerisesItem(f.uid);if(0<f.arrImage.length){var d=a[g].arrImage[0];c.SetItemInfo(f.uid,"["+(g+1)+"] \u5171"+f.arrImage.length+"\u56fe","\u5e8f\u5217\uff1a"+f.num);c.SetItemIcon(f.uid,d.imageicon,d.id)}c.SetProgress(f.uid,0)}},deseriespro:function(){for(var a=b.GetAllDicom(),f=0;f<a.length;f++){var g=a[f],d=g.id;c.PushSerisesItem(d);c.SetItemInfo(d,"["+(f+1)+"] \u51711\u56fe",g.num);c.SetItemIcon(d,g.imageicon,g.id);c.SetProgress(d,0)}},jpgpro:function(){var a=b.GetJpg();$.each(a,function(a,b){var e=b.id;c.PushSerisesItem(e);c.SetItemInfo(a,"["+(a+1)+"] \u5171 1 \u5f20\u56fe","\u7f16\u53f7\uff1a"+b.num);c.SetItemIcon(a,b.imageicon,b.id);c.SetProgress(e,0)})}});c.UpdateStyle();c.UpdateSeriesData()};this.DL.ProcessMode=function(a){if(void 0!==a)switch(a=$.extend(!0,{study:null,seriespro:null,deseriespro:null,jpgpro:null},a),a.study.GetStudyType()){case "jpg":a.jpgpro instanceof Function&&a.jpgpro();break;case "series":a.seriespro instanceof Function&&a.seriespro();break;case "deseries":a.deseriespro instanceof Function&&a.deseriespro()}};this.UpdateCanvas=function(b){if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();if(e){var f=c.scroll?c.scroll.draggerPos:1,g=c.GetLayout();if(void 0===g||1>g.row||1>g.col)g={row:1,col:1};var d=a.GetSelArray(e.images,f,g.row,g.col);a.DrawAnnStatusForMng(e,c,!0);c=c.GetAllCanvas();$.each(c,function(a,c){if(a<d.length){var f=d[a];f.id===b.id&&f.bLoadImage&&(c.bAnimatStop||c.StopLoadingAnimation(),e.viewport.image=f,1===e.viewport.scale?(CBoBo.ImageProcessor.Restore(e.viewport),CBoBo.Draw.FitServerCanvas(e.viewport,c.canvas)):CBoBo.Draw.FitServerCanvas(e.viewport,c.canvas,!0),c.DrawCornerInfo(e.viewport))}})}}else c=a.canvasManager.GetMng(),$.each(c,function(){var c=this.AnnStatusMng();if(c){var e=this.scroll?this.scroll.draggerPos:1,f=this.GetLayout();if(void 0===f||1>f.row||1>f.col)f={row:1,col:1};var g=a.GetSelArray(c.images,e,f.row,f.col),e=this.GetAllCanvas();$.each(e,function(a,e){if(a<g.length){var f=g[a];f.id===b.id&&f.bLoadImage&&(e.bAnimatStop||e.StopLoadingAnimation(),c.viewport.image=f,1===c.viewport.scale?(CBoBo.ImageProcessor.Restore(c.viewport),CBoBo.Draw.FitServerCanvas(c.viewport,e.canvas)):CBoBo.Draw.FitServerCanvas(c.viewport,e.canvas,!0),e.DrawCornerInfo(c.viewport))}})}})};this.InitMulStudyMode=function(){a.privilege.bMupStudy||a.mode==CBoBo.PTYPE_SERIES?a.privilege.bMupStudy=!0:(void 0!==this.canvasManager&&(this.canvasManager.Destroy(),delete this.canvasManager),void 0!==this.annStatusManager&&delete this.annStatusManager,a.privilege.bMupStudy=!0,this.Init())};this.Init=function(){function b(c){c="#"+a.frame.GetId("canvasbox");a.canvasManager=new CBoBo.View.CMngSecondLayer({parent:c,msgtransform:a.MsgTransform,scrollsize:CBoBo.Scrollsize})}void 0===a.frame&&(a.frame=new CBoBo.View.Frame(this.rootDom));void 0===a.thumbManager&&(a.thumbManager=new CBoBo.View.ThumbManager({parent:"#"+a.frame.GetId("thumb"),msgtransform:a.onThumb.MsgTransform}));var c=a.dataManager.GetStudy(0),e=c.GetStudyType();a.InitAnnStatusStack();var f,g;switch(e){case "jpg":f=CBoBo.TOOLMENU_JPG;g=a.onTool.Jpg.MsgTransform;break;case "deseries":f=CBoBo.TOOLMENU_DESERIES;g=a.onTool.MsgTransform;break;case "series":f=CBoBo.TOOLMENU_SERIES,g=a.onTool.MsgTransform}var d=1,k=1;CBoBo.IsMobile&&0==CBoBo.IsTablet?(a.frame.HideToolBar(),b(!0),void 0===a.toolBar&&(a.toolBar=new CBoBo.View.MobileMenuBall({msgtransform:g})),a.toolBar.RequestToolBall(f,g),a.toolBar.toolType="ww"):(a.WindowResize(),b(CBoBo.IsTablet),void 0===a.toolBar&&(a.logo=(new CBoBo.View.Logo("#"+a.frame.GetId("logo"))).SetFont("\u5f71\u50cf\u6e90").SetLogo(""),a.toolBar=new CBoBo.View.PCToolBar({parent:"#"+a.frame.GetId("toolbar"),msgtransform:a.onTool.Main.MsgTransform})),a.toolBar.RequestGrayToolBar(f,g),a.toolBar.toolType="zoom",a.toolBar.modalityType=c.modality,a.toolBar.ChangeBtnStatus("\u653e\u7f29",!0),a.toolBar.ChangeBtnStatus("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0),"series"===e?(d=2,k=3):k=d=1);var l=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(l.length,d,k);c=a.canvasManager.GetMng();void 0!==c&&$.each(c,function(a,c){a<l.length&&c.UpdateLayout(l[a].images.length,1,1)});a.canvasManager.SetDefaultFocus(0,0);a.onTool.ReLoadDicom();a.privilege.bPrint=!0;a.toolBar.EnableButton&&a.toolBar.EnableButton("\u80f6\u7247\u6253\u5370",!0)};this.WindowResize=function(){window.onresize=function(b){a.frame.UpdateStyle();a.logo&&a.logo.SetStyle();a.toolBar&&a.toolBar.UpdateStyle&&a.toolBar.UpdateStyle();a.layoutCtrl&&a.layoutCtrl.UpdateStyle();a.rotateCtrl&&a.rotateCtrl.UpdateStyle();a.lableCtrl&&a.lableCtrl;a.pseudocolorCtrl&&a.pseudocolorCtrl.UpdateStyle();a.thumbManager&&a.thumbManager.ForEach(function(a){a.UpdateStyle()});a.canvasCtxMenu&&a.canvasCtxMenu.UpdateStyle();a.Mpr&&(a.Mpr.UpdateStyle(),a.Mpr.mng.TriggerResize());a.configView&&a.configView.TriggerResize();a.canvasMax&&(a.canvasMax.UpdateStyle(),a.canvasMax.secondCtrl.TriggerResize());a.canvasManager&&a.canvasManager.TriggerResize(b)}};this.InitAnnStatusStack=function(){var b=a.dataManager.GetStudy(0);if(void 0!==b){var c=b.GetStudyType();CBoBo.AnnStatusManager.Clear();switch(c){case "jpg":var e=b.GetJpg();a.annStatusManager.NewAnnStatusArray(b.studyuid,e,c);break;case "deseries":e=b.GetAllDicom();e instanceof Array&&0<e.length&&$.each(e,function(){var a=CBoBo.AnnStatusManager.Create(this,b.studyuid,c);CBoBo.ImageProcessor.Restore(a.viewport)});break;case "series":$.each(b.GetAllSeries(),function(a,e){var f=e.GetAllDicom(),f=CBoBo.AnnStatusManager.Create(f,b.studyuid,c);CBoBo.ImageProcessor.Restore(f.viewport)})}}};this.DrawAnnStatus=function(b,c,e,f,g){var d=[];c instanceof Array?$.each(c,function(){d.push(this)}):d.push(c);var k;void 0!==f&&void 0!==g?(c=Math.min(f,b.images.length-1),g=Math.min(c+g,b.images.length),k=b.images.slice(c,g)):(c=0,g=d.length,k=b.images);var l=a.dataManager.GetStudy(0);l.IsPageSwitch();l.GetStudyType();$.each(d,function(c,f){if(c<k.length){var g=k[c];if(g.bLoadImage){if(a.canvasAIMax&&a.canvasAIMax.bShow){var d=l.GetAnnotations();if(!1===a.isAIFinished||!d.length){f.canvas.width=f.canvas.width;f.DrawCornerInfo();f.bAnimatStop&&f.StartLoadingAnimation();return}}f.bAnimatStop||f.StopLoadingAnimation();b.viewport.image=g;1===b.viewport.scale&&0===b.viewport.wc&&0===b.viewport.ww&&(CBoBo.ImageProcessor.Restore(b.viewport),CBoBo.Draw.FitServerCanvas(b.viewport,f.canvas,!1,!0));e?CBoBo.Draw.FitServerCanvas(b.viewport,f.canvas):CBoBo.Draw.DrawImage(b.viewport,f.canvas);a.toolBar&&a.toolBar.bShowCornerInfo?f.DrawCornerInfo(b.viewport):f.DrawCornerInfo();if(a.canvasAIMax&&a.canvasAIMax.bShow){var h=g.imageInstanceUid;b.anns[h]instanceof Array||(b.anns[h]=[]);var m=b.viewport;$.each(d,function(c,e){if(e.imageInstanceUid==h){var g=b.anns[h];g.length||$.each(e.annotation,function(a,c){var b=CBoBo.Annotation.NewAIAnnotation(m,f.canvas,"rect",c.points[0],c.points[1]);g.push(b)})}a.canvasAIMax.secondCtrl.SetDefaultFocus(0,0)});b.anns[h]instanceof Array||(b.anns[h]=[]);CBoBo.Annotation.DrawAnnotation(b.viewport,f.canvas,b.anns[h])}else b.anns[g.id]instanceof Array||(b.anns[g.id]=[]),CBoBo.Annotation.DrawAnnotation(b.viewport,f.canvas,b.anns[g.id])}else f.StartLoadingAnimation()}else f.canvas.width=f.canvas.width,f.DrawCornerInfo()})};this.DrawAnnStatusForMng=function(b,c,e){var f=c.scroll?c.scroll.draggerPos:1,g=c.GetLayout();if(void 0===g||1>g.row||1>g.col)g={row:1,col:1};g=g.row*g.col;f=(f-1)*g;c=c.GetAllCanvas();a.DrawAnnStatus(b,c,e,f,g)};this.GetSelArray=function(a,c,e,f){if(void 0!=a&&void 0!=c&&void 0!=e&&void 0!=f){e*=f;c=(c-1)*e;if(c>a.length-1||0>c)return[];f=a.length-c;return a.slice(c,(e>f?f:e)+c)}};this.ChangeToolBar=function(b){if((b=b.mng.AnnStatusMng())&&!b.bPrint){var c,e;switch(b.type){case "series":c=CBoBo.TOOLMENU_SERIES;e=a.onTool.MsgTransform;break;case "deseries":c=CBoBo.TOOLMENU_DESERIES;e=a.onTool.MsgTransform;break;case "jpg":c=CBoBo.TOOLMENU_JPG;e=a.onTool.Jpg.MsgTransform;break;case CBoBo.TOOLMENU_PRINT_JPG:c=b.type}a.toolBar.RequestToolBall&&a.toolBar.RequestToolBall(c,e);a.toolBar.RequestGrayToolBar&&a.toolBar.RequestGrayToolBar(c,e)}};this.GetContextMenu=function(b){a.canvasCtxMenu&&a.canvasCtxMenu.Destroy();a.canvasCtxMenu="jpg"==b?new CBoBo.View.ContextMenu({action:a.onTool.Jpg.MsgTransform,flash:!0,speed:300,items:[{text:"\u4eae\u5ea6/\u5bf9\u6bd4"},{text:"\u653e\u7f29"},{text:"\u79fb\u52a8"},{text:"\u5220\u9664\u56fe\u50cf"},{text:"\u8d1f\u50cf"},{text:"\u6062\u590d"}]}):new CBoBo.View.ContextMenu({action:a.onTool.MsgTransform,flash:!0,speed:300,items:[{text:"\u8c03\u7a97"},{text:"\u653e\u7f29"},{text:"\u79fb\u52a8"},{text:"\u5220\u9664\u56fe\u50cf"},{text:"\u9006\u65f6\u9488"},{text:"\u987a\u65f6\u9488"},{text:"\u5de6\u53f3\u955c\u50cf"},{text:"\u4e0a\u4e0b\u955c\u50cf"},{text:"\u8d1f\u50cf"},{text:"\u6062\u590d"},{text:"DICOM\u4fe1\u606f"},{text:"\u6253\u5370\u56fe\u50cf"},{text:"\u6253\u5370\u5e8f\u5217"}]});return a.canvasCtxMenu};this.IsUIWaitId=function(b){var c=!1,e=a.canvasManager.GetMng();$.each(e,function(){var e=this.AnnStatusMng();if(e){var g=this.scroll?this.scroll.draggerPos:1,d=this.GetLayout();if(void 0===d||1>d.row||1>d.col)d={row:1,col:1};e=a.GetSelArray(e.images,g,d.row,d.col);$.each(e,function(){this.id===b&&(c=!0)})}});return c};this.DRS={};this.DRS.MsgTransform=function(b){switch(b.type){case "resize":a.DRS.Resize(b);break;case "scroll":a.DRS.Scroll(b);break;case "drag":a.DRS.DragImage(b)}};this.DRS.Resize=function(b){a.Mpr&&a.Mpr.bShow&&(a.Mpr.mng.UpdateLayoutSp3(0,"left"),a.Mpr.mng.SetSpBoundaryColor(0,"#F00"),a.Mpr.mng.SetSpBoundaryColor(1,"#0F0"),a.Mpr.mng.SetSpBoundaryColor(2,"#00F"),b=a.Mpr.mng.AnnStatusMng(),a.onCanvas.Mpr.UpdateCanvas(b));if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0];(b=c.AnnStatusMng())&&a.DrawAnnStatusForMng(b,c,!0)}else b=a.canvasManager.GetMng(),$.each(b,function(c,b){var e=b.AnnStatusMng();e&&a.DrawAnnStatusForMng(e,b,!0)})};this.DRS.Scroll=function(b){var c=b.value;if(b.firstmng){var e=b.firstmng;if(b=e.AnnStatusMng()){var f=e.GetLayout();if(!(void 0===f||1>f.row||1>f.col)){var g=f.row*f.col,f=e.GetLayoutCanvas();void 0!==f&&(a.DrawAnnStatus(b,f,!1,(c-1)*g,g),a.onTool.ScountLine(!0))}}}else if(b.secondmng)if(b=CBoBo.AnnStatusManager.Get(),a.canvasMax&&a.canvasMax.bShow)e=a.canvasMax.secondCtrl.GetMng()[0],b=b[c-1],e.AnnStatusMng(b),e.UpdateLayout(b.images.length),a.DrawAnnStatusForMng(b,e);else for(var e=a.canvasManager.GetLayout(),c=a.GetSelArray(b,c,e.row,e.col),g=a.canvasManager.GetMng(),d=0;d<g.length;d++)e=g[d],f=e.GetLayoutCanvas(),0===f.length&&e.UpdateLayout(0,1,1),d<c.length?(b=c[d],e.AnnStatusMng(b),e.UpdateLayout(b.images.length),"series"===b.type&&e.checkbox.Show(!0),a.DrawAnnStatus(b,f,!1)):(e.checkbox.Show(!1),$.each(f,function(a,c){c.Clear();c.DrawCornerInfo()}),e.Clear())};this.DRS.DragImage=function(b){var c=b.imgId;b=b.mng;var e=a.dataManager.GetStudy(c),f=e.GetStudyType(),g;switch(f){case "jpg":g=e.GetJpg();b.checkbox.Show(!1);break;case "deseries":g=e.GetDicomById(c);b.checkbox.Show(!1);break;case "series":g=e.GetSeries(c).GetAllDicom(),b.checkbox.Show(!0)}c=b.AnnStatusMng();g=CBoBo.AnnStatusManager.Replace(c,g,e.studyuid,f);void 0!==g&&(b.AnnStatusMng(g),b.UpdateLayout(g.images.length),CBoBo.ImageProcessor.Restore(g.viewport),b=b.GetAllCanvas(),a.DrawAnnStatus(g,b,!0))};this.onThumb.MsgTransform=function(b){switch(b.type){case "mousedown":"head"==b.tag&&3==b.which&&(void 0===a.thumbCtxMenu&&(a.thumbCtxMenu=new CBoBo.View.ContextMenu({action:a.onThumb.ToolMsg,flash:!0,speed:300,items:[{text:"\u5220\u9664\u8be5\u68c0\u67e5"},{text:"\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5"}]})),a.thumbCtxMenu.SetReserve(b.studyuid),a.thumbCtxMenu.SetPosition(b.clientX,b.clientY),a.thumbCtxMenu.Show(!0));break;case "doubletap":case "dblclick":a.onThumb.ThumbDbClick(b)}};this.onThumb.ThumbDbClick=function(b){b=parseInt(b.target.title);if(a.Mpr&&a.Mpr.bShow)a.onCanvas.Mpr.DragImage(b);else{var c={type:"drag"};c.imgId=b;c.mng=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetMng()[0]:a.canvasManager.GetFocusMng();a.DRS.MsgTransform(c)}};this.onThumb.ToolMsg=function(b){switch(b.usermsg||b.target.title){case "\u5220\u9664\u8be5\u68c0\u67e5":b=b.reservedata;a.thumbManager.DeleteThumb(b);a.dataManager.DeleteStudy(b);a.annStatusManager.DelAnnStatusMngByStudyUid?a.annStatusManager.DelAnnStatusMngByStudyUid(b):a.annStatusManager.arrAnnStatus=[];a.onTool.ReLoadDicom(!0);break;case "\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5":$.each(a.dataManager.arrStudy,function(){var c=this.studyuid;a.thumbManager.DeleteThumb(c);a.annStatusManager.DelAnnStatusMngByStudyUid?a.annStatusManager.DelAnnStatusMngByStudyUid(c):a.annStatusManager.arrAnnStatus=[];a.onTool.ReLoadDicom(!0)}),a.dataManager.arrStudy=[],a.onTool.ReLoadDicom(!0)}a.Mpr&&a.onCanvas.Mpr.Clear();$.Msg("\u68c0\u67e5\u5220\u9664\u6210\u529f",CBoBo.MSG_SUCCESS)};this.onTool.Main={};this.onTool.Main.MsgTransform=function(b){var c=CBoBo.Plugin.GetBrowserInfo();switch(b.target.title){case "2D":c.isMobile||a.toolBar.Request2DToolBar();a.Mpr&&a.Mpr.Show(!1);if(a.canvasAIMax){a.canvasAIMax.Show(!1);b=a.canvasManager.scroll?a.canvasManager.scroll.draggerPos:1;var c=a.canvasManager.GetLayout(),e=CBoBo.AnnStatusManager.Get(),f=a.GetSelArray(e,b,c.row,c.col),g;a.canvasManager.EachMng(function(c,b){b<f.length&&(g=f[b],c.AnnStatusMng(g),c.AnnStatusMng()!==g&&c.UpdateLayout(g.images.length),a.DrawAnnStatusForMng(g,c,!0))})}break;case "MPR":a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));a.canvasAIMax&&a.canvasAIMax.Show(!1);void 0===a.Mpr&&(a.Mpr=new CBoBo.View.MPR({parent:"#"+a.frame.GetId("canvasbox"),mode:a.mode,msgtransform:a.onCanvas.Mpr.MsgTransform}),a.Mpr.SetLayout(3));c.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_MPR,a.onTool.Mpr.MsgTransform);a.Mpr.Show(!0);b=a.canvasManager.GetFocusMng();if(!b){$.Msg("\u8bf7\u9009\u62e9\u9700\u8981\u91cd\u5efa\u7684\u5e8f\u5217\uff01");break}if(g=b.AnnStatusMng())if(10>g.images.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20\uff01"),a.onCanvas.Mpr.Clear();else{b=!1;for(c=0;c<g.images.length;c++)if(!g.images[c].bLoadImage){b=!0;break}b?($.Msg("\u8bf7\u7b49\u5f85\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u4e0b\u8f7d\u5b8c\u6bd5!",CBoBo.MSG_ALERT),a.onCanvas.Mpr.Clear()):(a.Mpr.Series(g.images),a.onCanvas.Mpr.InitCanvas())}break;case "AI":a.onEmit("aiClick")}};this.MsgTransform=function(b){switch(b.type){case "resize":case "scroll":case "drag":a.DRS.MsgTransform(b);return}var c=b.mng;if(c&&(c=c.AnnStatusMng())){var e=c.viewport;if("jpg"===c.type){if(!e.GetImage().bLoaded)return;c=a.onCanvas.Jpg.MsgTransform}else{if(!e.image.bLoadImage)return;c=a.onCanvas.MsgTransform}c(b)}};this.UpdateAICanvas=function(){var b=CBoBo.Plugin.GetBrowserInfo();a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));a.Mpr&&a.Mpr.Show(!1);b.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_AI);void 0===a.canvasAIMax&&(a.canvasAIMax=new CBoBo.View.AI({parent:"#"+a.frame.GetId("canvasbox"),refrence:"#"+a.frame.GetId("contain"),msgtransform:a.MsgTransform}));a.canvasAIMax.bShow=!0;a.canvasAIMax.Show(!0);b=CBoBo.AnnStatusManager.Get();if(a.canvasAIMax.bShow){var c=a.canvasManager.GetFocusMng(),e=c.AnnStatusMng(),f=CBoBo.AnnStatusManager.GetIndex(e);void 0===f&&(f=0);a.canvasAIMax.secondCtrl.UpdateLayout(b.length,1,1,f+1);f=c.GetEventImageIndex(event.self);c=a.canvasAIMax.secondCtrl.GetMng()[0];c.UpdateLayout(e.images.length,1,1,f+1);c.AnnStatusMng(e);var g=c.GetAllCanvas()[0];$.each(b,function(){CBoBo.ImageProcessor.FitCanvas(e.viewport,g.canvas,!1,!0)});a.DrawAnnStatusForMng(e,c);a.canvasAIMax.secondCtrl.SetDefaultFocus(0,0)}};this.onCanvas.Jpg={};this.onCanvas.Jpg.MsgTransform=function(b){var c=b.self,e=c.AnnStatus(),f=e.status;switch(b.type){case "touchstart":case "mousedown":a.onCanvas.stampStart=b.timeStamp;a.SaveStartStatus(b,f);"touchstart"==b.type?(e=b.originalEvent.targetTouches[0],a.onCanvas.ptStart=CBoBo.Plugin.TransCoord(c,e.pageX,e.pageY),a.onCanvas.bLMouse=!0):a.onCanvas.ptStart=CBoBo.Plugin.TransCoord(c,b.pageX,b.pageY);switch(b.which){case 1:a.onCanvas.bLMouse=!0;break;case 3:a.onCanvas.bRMouse=!0}a.ChangeToolBar(b);break;case "touchmove":case "mousemove":if(a.onCanvas.bLMouse)a.onCanvas.Jpg.MouseLMove(c,f,b);else if(a.onCanvas.bRMouse)e=CBoBo.Plugin.TransCoord(c,b.pageX,b.pageY),a.onCanvas.Jpg.BC(c,e);else{var g;"touchmove"==b.type?(e=b.originalEvent.targetTouches[0],e=CBoBo.Plugin.TransCoord(c,e.pageX,e.pageY),g=b.originalEvent.targetTouches.length):e=CBoBo.Plugin.TransCoord(c,b.pageX,b.pageY);g&&2==g&&a.onCanvas.Jpg.Move(c,e)}break;case "touchend":case "mouseup":case "mouseout":case "pinchend":a.onCanvas.bRMouse&&200>b.timeStamp-a.onCanvas.stampStart&&(c=a.GetContextMenu(CBoBo.PTYPE_JPG))&&(c.SetPosition(b.clientX,b.clientY),c.Show(!0));a.onCanvas.bLMouse=!1;a.onCanvas.bRMouse=!1;a.onCanvas.imgStatus=[];break;case "dblclick":case "doubletap":a.privilege.bMupStudy?a.onCanvas.DbClick(e):a.canvasManager.bMax?(b=a.onTool.stack.pop(),g=a.onTool.stack.pop(),c=a.onTool.stack.pop(),e=a.onTool.stack.pop(),void 0!=e&&void 0!=c&&a.onTool.Jpg.MsgTransform({target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:e,col:c,max:!0,maxdata:{scrollpos:g,focusindex:b}})):(a.onTool.stack.push(a.canvasManager.nLayoutRow),a.onTool.stack.push(a.canvasManager.nLayoutCol),g=1,void 0!=a.canvasManager.scroll&&(g=a.canvasManager.scroll.draggerPos),a.onTool.stack.push(g),e=a.canvasManager.GetFocusCanvas().AnnStatus(),b=a.canvasManager.GetCanvasIndex(),a.onTool.stack.push(b),a.onTool.Jpg.MsgTransform({target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:1,max:!0,maxdata:{annstatus:e,focusindex:b}}));break;case "mousewheel":a.onCanvas.NextPage(b.deltaY);break;case "pinchstart":a.onCanvas.bLMouse=!1;a.SaveStartStatus();break;case "pinch":a.onCanvas.Jpg.Zoom(c,b.scale);break;case "message":a.onCanvas.Jpg.DrawImage(b)}};this.onCanvas.Jpg.MouseLMove=function(b,c,e){"touchmove"==e.type?(c=e.originalEvent.targetTouches[0],c=CBoBo.Plugin.TransCoord(b,c.pageX,c.pageY)):c=CBoBo.Plugin.TransCoord(b,e.pageX,e.pageY);var f=c.y-a.onCanvas.ptStart.y;if(0!=c.x-a.onCanvas.ptStart.x||0!=f)switch(e.tooltype||a.toolBar.toolType){case CBoBo.TOOL_MOVE:a.onCanvas.Jpg.Move(b,c);break;case CBoBo.TOOL_ZOOM:a.onCanvas.Jpg.Zoom(b,c);break;case CBoBo.TOOL_WC:a.onCanvas.Jpg.BC(b,c)}};this.onCanvas.Jpg.BC=function(b,c){var e=c.x-a.onCanvas.ptStart.x,f=c.y-a.onCanvas.ptStart.y;if(0!=e||0!=f){var g=b.AnnStatus().status;if(void 0!=g||void 0!=g.imageInfo){var d=a.onCanvas.imgStatus[0],k=d.brightness,d=d.contrast,k=k+(e>>2),d=d+(f>>2);-100>k&&(k=-100);100<k&&(k=100);-100>d&&(d=-100);100<d&&(d=100);g.SetBriCon(k,d);g.DrawImg(b)}}};this.onCanvas.Jpg.Move=function(b,c){var e=c.x-a.onCanvas.ptStart.x,f=c.y-a.onCanvas.ptStart.y;if(0!=e||0!=f){var g=b.AnnStatus().status;if(void 0!=g||void 0!=g.image){var d=a.onCanvas.imgStatus[0],d={x:d.ptLast.x,y:d.ptLast.y};d.x+=e>>0;d.y+=f>>0;g.MoveImage(d);g.DrawImg(b)}}};this.onCanvas.Jpg.Zoom=function(b,c){var e=!1;"number"==typeof c&&(e=!0);if(!e){var f=c.y-a.onCanvas.ptStart.y;if(0==f)return}if(0!=f){var g=b.AnnStatus().status;if(void 0!=g||void 0!=g.image){var d=a.onCanvas.imgStatus[0].zoomRatio,k=g.GetImageSize(),d=e?d*c:d-3*f/k.width;.02>d&&(d=.02);10<d&&(d=10);g.ZoomImage(d*k.width,d*k.height);g.DrawImg(b)}}};this.onCanvas.Jpg.DrawImage=function(a){var c=a.self;c.drawlock=!0;var b=c.GetCanvas(),f=c.AnnStatus();if(null!=f&&void 0!=f&&(f=f.status,void 0!=a.data)){var g=document.createElement("canvas");g.width=a.data.width;g.height=a.data.height;console.log("3");g.getContext("2d").putImageData(a.data,0,0);a=b.getContext("2d");a.clearRect(0,0,b.width,b.height);var d=f.scaledWidth,k=f.scaledHeight,l=f.ptLast,m=f.GetImageSize();a.drawImage(g,0,0,m.width,m.height,(b.width-d)/2+l.x,(b.height-k)/2+l.y,d,k);f.DrawText(c)}};this.onTool.Jpg={};this.onTool.Jpg.MsgTransform=function(b){var c=b.usermsg||b.target.title;switch(c){case "\u91ca\u653e\u5de5\u5177":a.toolBar.toolType=CBoBo.TOOL_NULL;break;case "\u91cd\u65b0\u52a0\u8f7d":a.onTool.Jpg.ReLoad();break;case "\u56fe\u50cf\u5e03\u5c40":case "\u5e8f\u5217\u5e03\u5c40":console.log(0);void 0==a.layoutCtrl&&(a.layoutCtrl=new CBoBo.View.LayoutCtrl({msgtransform:a.onTool.Jpg.MsgTransform,radio:!1}));a.layoutCtrl.bShow?a.layoutCtrl.Show(!1):(a.layoutCtrl.SetPosition(b.clientX-8,.4*CBoBo.View.TOOLBAR_HEIGHT>>0),a.layoutCtrl.Show(!0),a.layoutCtrl.Type(c));break;case "\u6062\u590d":a.onTool.Jpg.Restore();break;case "\u653e\u7f29":a.toolBar.toolType=CBoBo.TOOL_ZOOM;break;case "\u79fb\u52a8":a.toolBar.toolType=CBoBo.TOOL_MOVE;break;case "\u8d1f\u50cf":a.onTool.Jpg.Negative();break;case "\u4f2a\u5f69":void 0==a.pseudocolorCtrl&&(a.pseudocolorCtrl=new CBoBo.View.PseudoColorCtrl({msgtransform:a.onTool.Jpg.MsgTransform}));a.pseudocolorCtrl.bShow?a.pseudocolorCtrl.Show(!1):(a.pseudocolorCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.pseudocolorCtrl.Show(!0));break;case "\u4eae\u5ea6/\u5bf9\u6bd4":case "\u4eae/\u5bf9\u6bd4":case "\u8c03\u7a97":a.toolBar.toolType=CBoBo.TOOL_WC;break;case "\u5220\u9664\u56fe\u50cf":a.onTool.Jpg.Delete();break;case "\u5e03\u5c40\u63a7\u4ef6":if(a.privilege.bMupStudy)a.onTool.CanvasLayout(b);else{var e,c=!1,f,g=b.maxdata;b.max&&(void 0!=g.annstatus?(f=g.focusindex+1,e=[],e.push(g.annstatus),c=!0):f=g.scrollpos);var d=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(d.length,b.row,b.col,f);var k=a.canvasManager.GetLayoutCanvas();$.each(d,function(a,c){c.status.FitCanvas(k[0])});void 0==f&&(f=1);c||(e=a.GetSelArray(d,f,b.row,b.col),void 0!=g&&a.canvasManager.Focus(g.focusindex));a.FlushAnnStatusForCanvas(e,k)}break;case "\u7070\u8272":case "\u5f69\u8679":case "\u9ed1\u4f53":case "\u9aa8\u9abc":case "\u5fc3\u810f":case "\u6d41\u52a8":case "Ge\u8272":case "\u7070\u8272\u5f69\u8679":case "\u70ed\u7eff":case "\u94ec\u94c1":case "\u70ed\u91d1\u5c5e":case "\u9971\u548c\u5ea61":case "\u9971\u548c\u5ea62":case "\u7ea2\u5916":case "\u58a8\u9ed1":case "\u9aa8\u9abc-\u808c\u8089":case "NIH":case "\u5f69\u86791":case "\u5f69\u86792":case "\u5f69\u86793":case "\u6bd4\u503c":case "\u7ea2\u8272\u8840\u7ba1":case "\u5149\u8c31":case "\u65af\u7279\u6069":case "UCLA":a.onTool.Pseudocolor(b.target.title);break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":a.onTool.MsgTransform({usermsg:"\u663e/\u9690\u56db\u89d2\u4fe1\u606f"});break;case "dragend":$.Msg("dragend");break;case "drag":$.Msg("drag");break;case "hold":$.Msg("hold");break;case "\u914d\u7f6e":a.onTool.MsgTransform(b);break;case "\u80f6\u7247\u6253\u5370":a.onTool.MsgTransform(b);break;case "\u534f\u540c\u8bca\u65ad":a.onTool.MsgTransform({usermsg:c})}CBoBo.Plugin.GetBrowserInfo().isMobile||!1!==a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce)||(a.toolBar.toolType=CBoBo.TOOL_NULL,a.toolBar.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))};this.onTool.Jpg.Restore=function(){var b=a.canvasManager.GetFocusCanvas(),c=b.AnnStatus().status;void 0!=c&&(c.Restore(),c.FitCanvas(b).DrawImg(b))};this.onTool.Jpg.Delete=function(){if(a.privilege.bMupStudy)a.onTool.DeleteDicom();else{var b=a.canvasManager.GetFocusCanvas();a.annStatusManager.DeleteAnnStatus(b.AnnStatus());b=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(b.length);var c=a.canvasManager.GetLayoutCanvas();a.FlushAnnStatusForCanvas(b,c,!0)}};this.onTool.Jpg.ReLoad=function(b){a.onTool.MsgTransform({usermsg:"\u91cd\u65b0\u52a0\u8f7d"})};this.onTool.Jpg.Negative=function(){var b=a.canvasManager.GetFocusCanvas(),c=b.AnnStatus().status;void 0!=c&&(c.SetNegative(!c.GetNegative()),c.DrawImg(b))};this.onCanvas.MsgTransform=function(b){var c=b.mng.AnnStatusMng(),e=b.mng.GetEventImageIndex(b.self);if(c&&!(e>c.images.length-1))switch(b.type){case "touchstart":case "mousedown":a.onCanvas.stampStart=b.timeStamp;"touchstart"==b.type?(a.onCanvas.lastScale=c.viewport.scale,c=b.originalEvent.targetTouches[0],a.onCanvas.ptStart=new Point(c.pageX,c.pageY),1===b.originalEvent.touches.length?a.onCanvas.which=1:a.onCanvas.bTouchMul=!0):(a.onTool.ScountLine(!0),a.onCanvas.which=b.which,a.onCanvas.ptStart=new Point(b.pageX,b.pageY));"ww"==a.toolBar.toolType&&(a.onCanvas.which=3);0===a.toolBar.toolType&&(a.onCanvas.which=4);a.onCanvas.ptLast=new Point(a.onCanvas.ptStart);a.onCanvas.MouseDown(b);a.ChangeToolBar(b);break;case "touchmove":case "mousemove":0!==a.onCanvas.which||"touchmove"==b.type&&2===b.originalEvent.touches.length?a.onCanvas.MouseDowmMove(b):a.onCanvas.MouseMove(b);break;case "touchend":case "mouseup":case "mouseout":case "pinchend":a.onCanvas.MouseUp(b);break;case "dblclick":case "doubletap":a.onCanvas.DbClick(b);break;case "mousewheel":a.onCanvas.NextPage(b.deltaY);break;case "pinchstart":a.onCanvas.which=0;break;case "pinch":a.onCanvas.ZOOM(b.scale);break;case "hold":$.Msg("hold")}};this.onCanvas.MouseDown=function(b){if(1===a.onCanvas.which){var c=b.mng.AnnStatusMng(),e=c.viewport,f=b.mng.GetEventImageIndex(b.self),f=c.images[f];void 0!==f&&(a.canvasAIMax&&a.canvasAIMax.bShow?(f=f.imageInstanceUid,c.anns[f]instanceof Array||(c.anns[f]=[]),c=c.anns[f]):(c.anns[f.id]instanceof Array||(c.anns[f.id]=[]),c=c.anns[f.id]),f=b.self.canvas,b=b.tooltype||a.toolBar.toolType,CBoBo.Annotation.ScanClickTextBox(e,f,c,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y),CBoBo.Annotation.ActiveAnnotation(c)||(e=CBoBo.Annotation.NewAnnotation(e,f,b,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y),void 0!==e&&c.push(e)))}};this.onCanvas.MouseDowmMove=function(b){var c;"touchmove"==b.type?(c=b.originalEvent.targetTouches[0],c=new Point(c.pageX,c.pageY)):c=new Point(b.pageX,b.pageY);var e=c.x-a.onCanvas.ptLast.x,f=c.y-a.onCanvas.ptLast.y;if(0!==e||0!==f){if(2==a.onCanvas.which||"touchmove"==b.type&&2===b.originalEvent.touches.length)a.onCanvas.MOVE(e,f);else if(3==a.onCanvas.which)a.onCanvas.WW(e,f);else if(4==a.onCanvas.which)5<Math.abs(f)&&(0<f?a.onCanvas.NextPage(-1):a.onCanvas.NextPage(1));else if(1==a.onCanvas.which){var g=b.mng.AnnStatusMng(),d=g.viewport,k=b.mng.GetEventImageIndex(b.self),k=g.images[k];if(void 0===k)return;d.image=k;a.canvasAIMax&&a.canvasAIMax.bShow?(k=k.imageInstanceUid,g.anns[k]instanceof Array||(g.anns[k]=[]),g=g.anns[k]):(g.anns[k.id]instanceof Array||(g.anns[k.id]=[]),g=g.anns[k.id]);k=b.tooltype||a.toolBar.toolType;b=b.self.canvas;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(!CBoBo.Annotation.MaybeServerModifyActiveAnn(d,b,g,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y,c.x,c.y))switch(k){case "zoom":a.onCanvas.ZOOM(e,f);break;case "ww":a.onCanvas.WW(e,f);break;case "move":a.onCanvas.MOVE(e,f)}}else if(!CBoBo.Annotation.MaybeModifyActiveAnn(d,b,g,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y,c.x,c.y))switch(k){case "zoom":a.onCanvas.ZOOM(e,f);break;case "ww":a.onCanvas.WW(e,f);break;case "move":a.onCanvas.MOVE(e,f);break;case "heartratio":case "r":case "l":case ".":case "angle":case "arrow":case "ellipse":case "probe":case "rect":case "line":CBoBo.Annotation.UnfinishedAnn(d,b,g,k,c.x,c.y)}}a.onCanvas.ptLast=c}};this.onCanvas.MouseUp=function(b){if(1===a.onCanvas.which||a.onCanvas.bTouchMul){var c=b.mng.AnnStatusMng(),e=c.viewport,f=b.mng.GetEventImageIndex(b.self),f=c.images[f];if(void 0===f)return;e.image=f;var g;a.canvasAIMax&&a.canvasAIMax.bShow?(f=f.imageInstanceUid,c.anns[f]instanceof Array||(c.anns[f]=[]),g=c.anns[f]):(c.anns[f.id]instanceof Array||(c.anns[f.id]=[]),g=c.anns[f.id]);var c=b.tooltype||a.toolBar.toolType,d=b.self.canvas,f=CBoBo.Annotation.GetMaybeSaveAnn(c,e,d);void 0!==f?(g.push(f),CBoBo.Draw.GetIsFromServer()&&CBoBo.Annotation.ServerGetMaybeSaveAnn(c,e,d,f).then(function(a){CBoBo.ImageProcessor.DrawGrayImage(e,d);CBoBo.Annotation.DrawAnnotation(e,d,g);CBoBo.Annotation.MaybeEndModifyAnn()})):CBoBo.Draw.GetIsFromServer()&&(b=new Point(b.pageX,b.pageY),console.log(b),b=CBoBo.Annotation.ServerHoverAnnotation(e,d,g,b.x,b.y),CBoBo.Annotation.ServerGetMaybeSaveAnn(c,e,d,b).then(function(a){CBoBo.ImageProcessor.DrawGrayImage(e,d);CBoBo.Annotation.DrawAnnotation(e,d,g);CBoBo.Annotation.MaybeEndModifyAnn()}));CBoBo.Annotation.MaybeEndModifyAnn()}else 3===a.onCanvas.which&&"mouseup"===b.type&&(c=CBoBo.Annotation.Distance(new Point(b.pageX,b.pageY),a.onCanvas.ptStart),200>b.timeStamp-a.onCanvas.stampStart&&1>c&&(c=a.GetContextMenu("series")))&&(c.SetPosition(b.clientX,b.clientY),c.Show(!0));a.onCanvas.bTouchMul=!1;a.onCanvas.which=0};this.onCanvas.MouseMove=function(b){var c=b.mng.AnnStatusMng(),e;if("touchmove"==b.type){if(1!==b.originalEvent.touches.length){a.onCanvas.bTouchMul=!0;return}e=b.originalEvent.targetTouches[0];e=new Point(e.pageX,e.pageY)}else e=new Point(b.pageX,b.pageY);var f=e.y-a.onCanvas.ptLast.y;if(0!==e.x-a.onCanvas.ptLast.x||0!==f){var f=c.viewport,g=b.mng.GetEventImageIndex(b.self),g=c.images[g];if(void 0!==g){f.image=g;a.canvasAIMax&&a.canvasAIMax.bShow?(g=g.imageInstanceUid,c.anns[g]instanceof Array||(c.anns[g]=[]),c=c.anns[g]):(c.anns[g.id]instanceof Array||(c.anns[g.id]=[]),c=c.anns[g.id]);var g=b.self.canvas,d=b.tooltype||a.toolBar.toolType;if(0===a.onCanvas.which&&!CBoBo.Annotation.UnfinishedAnn(f,g,c,d,e.x,e.y)&&(CBoBo.Annotation.ScanHoverAnnotation(f,g,c,e.x,e.y),"touchmove"==b.type&&"pointer"==g.style.cursor)){switch(a.toolBar.toolType){case "line":a.toolBar.ChangeBtnStatus("\u76f4\u7ebf");break;case "rect":a.toolBar.ChangeBtnStatus("\u77e9\u5f62");break;case "ellipse":a.toolBar.ChangeBtnStatus("\u692d\u5706");break;case "angle":a.toolBar.ChangeBtnStatus("\u89d2\u5ea6")}a.toolBar.toolType="."}a.onCanvas.ptLast=e;a.onTool.ScountLine(!0)}}};this.onCanvas.WW=function(b,c){var e,f,g;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(e=a.canvasAIMax.secondCtrl.GetMng()[0],f=e.AnnStatusMng())g=f.viewport,g.ww+=parseInt(b*g.wwScale),g.wc+=parseInt(c*g.wwScale),2>g.ww&&(g.ww=2),a.DrawAnnStatusForMng(f,e)}else if(a.canvasMax&&a.canvasMax.bShow){if(e=a.canvasMax.secondCtrl.GetMng()[0],f=e.AnnStatusMng())g=f.viewport,g.ww+=parseInt(b*g.wwScale),g.wc+=parseInt(c*g.wwScale),2>g.ww&&(g.ww=2),a.DrawAnnStatusForMng(f,e)}else e=a.canvasManager.GetActiveMng(),$.each(e,function(e,f){var g=f.AnnStatusMng();if(g){var d=g.viewport;d.ww+=parseInt(b*d.wwScale);d.wc+=parseInt(c*d.wwScale);2>d.ww&&(d.ww=2);a.DrawAnnStatusForMng(g,f)}})};this.onCanvas.MOVE=function(b,c){var e,f,g;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(e=a.canvasAIMax.secondCtrl.GetMng()[0],f=e.AnnStatusMng())g=f.viewport,g.translation.x+=parseInt(b/g.scale),g.translation.y+=parseInt(c/g.scale),a.DrawAnnStatusForMng(f,e)}else if(a.canvasMax&&a.canvasMax.bShow){if(e=a.canvasMax.secondCtrl.GetMng()[0],f=e.AnnStatusMng())g=f.viewport,g.translation.x+=parseInt(b/g.scale),g.translation.y+=parseInt(c/g.scale),a.DrawAnnStatusForMng(f,e)}else e=a.canvasManager.GetActiveMng(),$.each(e,function(e,f){var g=f.AnnStatusMng();if(g){var d=g.viewport;d.translation.x+=b/d.scale;d.translation.y+=c/d.scale;a.DrawAnnStatusForMng(g,f)}})};this.onCanvas.ZOOM=function(b,c){var e,f,g;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(e=a.canvasAIMax.secondCtrl.GetMng()[0],f=e.AnnStatusMng())g=f.viewport,g.scale=void 0===c?a.onCanvas.lastScale*b:g.scale+c/100,.01>g.scale&&(g.scale=.01),g.scale=parseFloat(g.scale.toFixed(2)),a.DrawAnnStatusForMng(f,e)}else if(a.canvasMax&&a.canvasMax.bShow){if(e=a.canvasMax.secondCtrl.GetMng()[0],f=e.AnnStatusMng())g=f.viewport,g.scale=void 0===c?a.onCanvas.lastScale*b:g.scale+c/100,.01>g.scale&&(g.scale=.01),g.scale=parseFloat(g.scale.toFixed(2)),a.DrawAnnStatusForMng(f,e)}else e=a.canvasManager.GetActiveMng(),$.each(e,function(e,f){var g=f.AnnStatusMng();if(g){var d=g.viewport;d.scale=void 0===c?a.onCanvas.lastScale*b:d.scale+c/100;.01>d.scale&&(d.scale=.01);d.scale=parseFloat(d.scale.toFixed(2));a.DrawAnnStatusForMng(g,f)}})};this.onCanvas.NextPage=function(b){var c;a.canvasMax&&a.canvasMax.bShow?(c=a.canvasMax.secondCtrl.GetMng()[0],c.scroll&&c.scroll.TriggerClick(b)):a.canvasAIMax&&a.canvasAIMax.bShow?(c=a.canvasAIMax.secondCtrl.GetMng()[0],c.scroll&&c.scroll.TriggerClick(b)):(c=a.canvasManager.GetActiveMng(),$.each(c,function(a,c){c.scroll&&c.scroll.TriggerClick(b)}))};this.onCanvas.DbClick=function(b){if(!a.canvasAIMax||!a.canvasAIMax.bShow){var c=a.canvasManager.GetLayout();if(1===c.row&&1===c.col){var e=a.canvasManager.GetFocusMng(),c=e.GetLayout();if(1===c.row&&1===c.col)return}a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));void 0===a.canvasMax&&(a.canvasMax=new CBoBo.View.CanvasMax({parent:"#"+a.frame.GetId("canvasbox"),msgtransform:a.MsgTransform}));a.canvasMax.bShow=!a.canvasMax.bShow;a.canvasMax.Show(a.canvasMax.bShow);c=CBoBo.AnnStatusManager.Get();if(a.canvasMax.bShow){var e=b.mng,f=e.AnnStatusMng(),g=CBoBo.AnnStatusManager.GetIndex(f);void 0===g&&(g=0);a.canvasMax.secondCtrl.UpdateLayout(c.length,1,1,g+1);g=e.GetEventImageIndex(b.self);e=a.canvasMax.secondCtrl.GetMng()[0];e.UpdateLayout(f.images.length,1,1,g+1);e.AnnStatusMng(f);var d=e.GetAllCanvas()[0];$.each(c,function(){CBoBo.Draw.FitServerCanvas(this.viewport,d.canvas,!1,!0)});a.DrawAnnStatusForMng(f,e);a.canvasMax.secondCtrl.SetDefaultFocus(0,0)}else{b=a.canvasManager.scroll?a.canvasManager.scroll.draggerPos:1;var e=a.canvasManager.GetLayout(),k=a.GetSelArray(c,b,e.row,e.col);a.canvasManager.EachMng(function(c,b){b<k.length&&(f=k[b],c.AnnStatusMng(f),c.AnnStatusMng()!==f&&c.UpdateLayout(f.images.length),a.DrawAnnStatusForMng(f,c,!0))})}}};this.onTool.MsgTransform=function(b){var c=b.usermsg||b.target.title;console.log(c);switch(c){case "\u91ca\u653e\u5de5\u5177":a.toolBar.toolType=CBoBo.TOOL_NULL;break;case "\u91cd\u65b0\u52a0\u8f7d":void 0!==a.lableCtrl&&a.lableCtrl.Show(!1);a.onTool.ReLoadDicom(!0);break;case "\u5e8f\u5217\u5e03\u5c40":case "\u56fe\u50cf\u5e03\u5c40":void 0==a.layoutCtrl&&(a.layoutCtrl=new CBoBo.View.LayoutCtrl({msgtransform:a.onTool.MsgTransform,radio:!1}));a.layoutCtrl.bShow?a.layoutCtrl.Show(!1):(a.layoutCtrl.SetPosition(b.clientX-8,.4*CBoBo.View.TOOLBAR_HEIGHT>>0),a.layoutCtrl.Show(!0),a.layoutCtrl.Type(c));break;case "\u6062\u590d":a.onTool.RestoreDicom();break;case "\u5b9a\u4f4d\u7ebf":a.onTool.bShowScountLine?($.Msg("\u5b9a\u4f4d\u7ebf\u5df2\u5173\u95ed\u3002",CBoBo.MSG_SUCCESS),a.onTool.bShowScountLine=!1,c=a.canvasManager.GetMng(),$.each(c,function(c,b){var e=b.AnnStatusMng();e&&a.DrawAnnStatusForMng(e,b)})):($.Msg("\u5b9a\u4f4d\u7ebf\u5df2\u5f00\u542f\u3002",CBoBo.MSG_SUCCESS),a.onTool.bShowScountLine=!0,a.onTool.ScountLine());break;case "\u5e8f\u5217\u64ad\u653e":void 0==a.seriesPlayer&&(a.seriesPlayer=new CBoBo.View.SeriesPlayer({msgtransform:a.onTool.MsgTransform}));if(a.seriesPlayer.bShow)a.seriesPlayer.Show(!1);else{var e;e=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetFocusMng():a.canvasManager.GetFocusMng();c=e.GetBoundary();a.seriesPlayer.SetPosition(c.left+(c.width-300>>1),c.top+c.height-45);var f=1;if(c=e.AnnStatusMng())f=c.images.length;a.seriesPlayer.SaveSeriesTag(e);a.seriesPlayer.SetRange(f);a.seriesPlayer.Show(!0);a.seriesPlayer.TriggerClick(2)}break;case "\u653e\u7f29":a.toolBar.toolType="zoom";break;case "\u79fb\u52a8":a.toolBar.toolType="move";break;case "\u65cb\u8f6c":void 0==a.rotateCtrl&&(a.rotateCtrl=new CBoBo.View.RotateCtrl({msgtransform:a.onTool.MsgTransform}));a.rotateCtrl.bShow?a.rotateCtrl.Show(!1):(a.rotateCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.rotateCtrl.Show(!0));break;case "\u8d1f\u50cf":a.onTool.Negative();break;case "\u4f2a\u5f69":void 0==a.pseudocolorCtrl&&(a.pseudocolorCtrl=new CBoBo.View.PseudoColorCtrl({msgtransform:a.onTool.MsgTransform}));a.pseudocolorCtrl.bShow?a.pseudocolorCtrl.Show(!1):(a.pseudocolorCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.pseudocolorCtrl.Show(!0));break;case "\u8c03\u7a97":a.toolBar.toolType="ww";break;case "\u81ea\u5b9a\u4e49\u8c03\u7a97 ":void 0==a.wwCtrl&&(a.wwCtrl=new CBoBo.View.wwCtrl({msgtransform:a.onTool.MsgTransform,modalityType:a.dataManager.GetStudy(0).modality}));a.wwCtrl.bShow?a.wwCtrl.Show(!1):(a.wwCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.wwCtrl.Show(!0));break;case "\u76f4\u7ebf":a.toolBar.toolType="line";break;case "\u77e9\u5f62":a.toolBar.toolType="rect";break;case "\u692d\u5706":a.toolBar.toolType="ellipse";break;case "\u89d2\u5ea6":a.toolBar.toolType="angle";break;case "CT":a.toolBar.toolType="probe";break;case "\u6587\u672c":a.toolBar.toolType="text";break;case "\u7bad\u5934":a.toolBar.toolType="arrow";break;case "\u5de6\u6807\u8bb0":a.toolBar.toolType="l";break;case "\u53f3\u6807\u8bb0":a.toolBar.toolType="r";break;case "\u64a4\u9500":e=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetMng()[0]:a.canvasManager.GetFocusMng();if(c=e.AnnStatusMng()){var f=c.viewport,g=e.GetFocusCanvas();if(void 0!==g){e=e.GetEventImageIndex(g);var d=c.images[e];if(void 0===d)return;f.image=d;c.anns[d.id]instanceof Array&&(0<c.anns[d.id].length&&c.anns[d.id].pop(),e=g.canvas,CBoBo.Draw.DrawImage(f,e),CBoBo.Annotation.DrawAnnotation(f,e,c.anns[d.id]))}}break;case "\u5220\u9664\u56fe\u50cf":a.onTool.DeleteDicom();break;case "\u5e03\u5c40\u63a7\u4ef6":a.onTool.CanvasLayout(b);break;case "\u9006\u65f6\u9488":case "\u987a\u65f6\u9488":case "\u5de6\u53f3\u955c\u50cf":case "\u4e0a\u4e0b\u955c\u50cf":a.onTool.RotateDicom(b.target.title);break;case "\u7070\u8272":case "\u5f69\u8679":case "\u9ed1\u4f53":case "\u9aa8\u9abc":case "\u5fc3\u810f":case "\u6d41\u52a8":case "Ge\u8272":case "\u7070\u8272\u5f69\u8679":case "\u70ed\u7eff":case "\u94ec\u94c1":case "\u70ed\u91d1\u5c5e":case "\u9971\u548c\u5ea61":case "\u9971\u548c\u5ea62":case "\u7ea2\u5916":case "\u58a8\u9ed1":case "\u9aa8\u9abc-\u808c\u8089":case "NIH":case "\u5f69\u86791":case "\u5f69\u86792":case "\u5f69\u86793":case "\u6bd4\u503c":case "\u7ea2\u8272\u8840\u7ba1":case "\u5149\u8c31":case "\u65af\u7279\u6069":case "UCLA":a.onTool.Pseudocolor(b.target.title);break;case "seriesplay":e=a.seriesPlayer.GetSeriesTag();if("userdocument"==b.userdocument){if(!a.seriesPlayer.bShow)return;c=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetFocusMng():a.canvasManager.GetFocusMng();e!=c&&(a.seriesPlayer.Show(!1),b.btntitle="\u5e8f\u5217\u64ad\u653e",b.btnforce=!1)}else void 0!=b.target?e.scroll&&a.seriesPlayer.SetRange(e.scroll.rangeMap,e.scroll.draggerPos):e.scroll&&e.scroll.TriggerDragger(b.value);break;case "\u80f6\u7247\u6253\u5370":if(!a.privilege.bPrint)break;void 0==a.printer&&(a.printer=new CBoBo.View.DVPrint({msgtransform:a.PrintView.MsgTransform,mode:a.mode}));a.printer.bShow?a.printer.Show():a.printer.Show(!0);break;case "\u5fc3\u80f8\u6bd4":a.toolBar.toolType="heartratio";break;case "DICOM\u4fe1\u606f":if(a.dicomScan&&a.dicomScan.bShow)a.dicomScan.Show(!1),delete a.dicomScan;else{a.dicomScan=new CBoBo.View.DicomScan({msgtransform:a.onTool.MsgTransform});a.canvasMax&&a.canvasMax.bShow?(g=a.canvasMax.secondCtrl.GetMng()[0],e=g.GetFocusCanvas()):(g=a.canvasManager.GetFocusMng(),e=a.canvasManager.GetFocusCanvas());if(c=g.AnnStatusMng())e=g.GetEventImageIndex(e),f=c.images[e];a.dicomScan.SetDicomInfo(f);console.log(f);a.dicomScan.Show(!0);c={title:"DICOM\u4fe1\u606f",bseled:!0};b.btnstatus=c}break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":a.toolBar.bShowCornerInfo=!a.toolBar.bShowCornerInfo;c={title:"\u663e/\u9690\u56db\u89d2\u4fe1\u606f"};c.bseled=a.toolBar.bShowCornerInfo;b.btnstatus=c;c=a.canvasManager.GetMng();$.each(c,function(c,b){var e=b.AnnStatusMng();e&&a.DrawAnnStatusForMng(e,b)});break;case "\u6253\u5370\u56fe\u50cf":a.KeyboardMsg({keyCode:80});break;case "\u6253\u5370\u5e8f\u5217":a.KeyboardMsg({keyCode:80,ctrlKey:!0});break;case "MPR":a.onTool.Main.MsgTransform({target:{title:"MPR"}});break;case "2D":a.onTool.Main.MsgTransform({target:{title:"2D"}});break;case "\u914d\u7f6e":void 0===a.configView&&(a.configView=new CBoBo.View.Config);c=a.toolBar.GetButtonDOM("\u914d\u7f6e");a.configView.bShow?(a.configView.Show(!1),$(c).css("pointer-events","")):(a.configView.Show(!0),$(c).css("pointer-events","auto"));break;case "\u534f\u540c\u8bca\u65ad":void 0==a.assistDiagnose&&(a.assistDiagnose=new CBoBo.View.AssistDiagnose({server:"localhost:80",msgtransform:a.Assist.MsgTransform}),a.assistDiagnose.Login());a.assistDiagnose.Show(!a.assistDiagnose.bShow);break;case "\u6309\u952e\u8bf4\u660e":a.iconInfo&&a.iconInfo.bShow?(a.iconInfo.Show(!1),delete a.iconInfo):(a.iconInfo=new CBoBo.View.IconInfo({msgtransform:a.onTool.MsgTransform}),a.iconInfo.SetInfo(),a.iconInfo.Show(!0));break;case "CPR\u76f4\u7ebf":case "CPR\u66f2\u7ebf":case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":a.onTool.Mpr.MsgTransform(b);break;case "Abodmen":case "Lung":case "Brain":case "Bone":case "Chest":case "Head/Neck":a.onTool.WW(c);break;case "CustomWWWC":a.onTool.BindAlert()}CBoBo.Plugin.GetBrowserInfo().isMobile||!1!==a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce)||(a.toolBar.toolType=CBoBo.TOOL_NULL,a.toolBar.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))};this.onTool.BindAlert=function(){var b,c,e=a.canvasManager.GetActiveMng();$.each(e,function(a,e){var f=e.AnnStatusMng();f&&(f=f.viewport,b=f.ww,c=f.wc)});a.isKeyBoard=!0;var f=layer.open({title:"\u8bf7\u8f93\u5165\u7a97\u5bbd\u7a97\u4f4d",type:1,skin:"layui-layer-rim",area:["420px","200px"],content:'\x3cdiv class\x3d"layer-wrap"\x3e\x3cdiv class\x3d"layer-content"\x3e\x3cdiv class\x3d"layer-iptdiv"\x3e\x3clabel\x3e\u7a97\u5bbd:\x3c/label\x3e\x3cinput type\x3d"text" id\x3d"customWW"    class\x3d"layer-ipt" value\x3d"'+b+'"\x3e\x3c/div\x3e\x3cdiv class\x3d"layer-iptdiv"\x3e\x3clabel\x3e\u7a97\u4f4d:\x3c/label\x3e\x3cinput type\x3d"text" id\x3d"customWC"  class\x3d"layer-ipt" value\x3d"'+c+'"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"footer"\x3e\x3cspan id\x3d"btn-ok-custom" class\x3d"darkgreen"\x3e\u786e\u5b9a\x3c/span\x3e\x3cspan id\x3d"btn-cancel-custom"\x3e\u53d6\u6d88\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',cancel:function(){a.isKeyBoard=!1}});$("#btn-ok-custom").click(function(){var c=$("#customWW").val(),b=$("#customWC").val();isNaN(b)||isNaN(c)?alert("\u8bf7\u8f93\u5165\u6b63\u786e\u6570\u5b57"):(a.onTool.CustomWW(parseInt(c),parseInt(b)),layer.close(f),a.isKeyBoard=!1)});$("#btn-cancel-custom").click(function(){layer.close(f);a.isKeyBoard=!1})};this.onTool.CustomWW=function(b,c){if(a.canvasMax&&a.canvasMax.bShow){var e=a.canvasMax.secondCtrl.GetMng()[0],f=e.AnnStatusMng();if(f){var d=f.viewport;d.ww=parseInt(b);d.wc=parseInt(c);2>d.ww&&(d.ww=2);a.DrawAnnStatusForMng(f,e)}}else e=a.canvasManager.GetActiveMng(),$.each(e,function(e,f){var d=f.AnnStatusMng();if(d){var g=d.viewport;g.ww=b;g.wc=c;2>g.ww&&(g.ww=2);a.DrawAnnStatusForMng(d,f)}})};this.onTool.WW=function(b){if(a.canvasAIMax&&a.canvasAIMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();if(e){var f=e.viewport;switch(b){case "Abodmen":f.ww=400;f.wc=60;break;case "Lung":f.ww=1500;f.wc=-600;break;case "Brain":f.ww=80;f.wc=40;break;case "Bone":f.ww=1500;f.wc=300;break;case "Chest":f.ww=400;f.wc=40;break;case "Head/Neck":f.ww=350,f.wc=90}2>f.ww&&(f.ww=2);a.DrawAnnStatusForMng(e,c)}}else if(a.canvasMax&&a.canvasMax.bShow){if(c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng()){f=e.viewport;switch(b){case "Abodmen":f.ww=400;f.wc=60;break;case "Lung":f.ww=1500;f.wc=-600;break;case "Brain":f.ww=80;f.wc=40;break;case "Bone":f.ww=1500;f.wc=300;break;case "Chest":f.ww=400;f.wc=40;break;case "Head/Neck":f.ww=350,f.wc=90}2>f.ww&&(f.ww=2);a.DrawAnnStatusForMng(e,c)}}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,e){var f=e.AnnStatusMng();if(f){var d=f.viewport;switch(b){case "Abodmen":d.ww=400;d.wc=60;break;case "Lung":d.ww=1500;d.wc=-600;break;case "Brain":d.ww=80;d.wc=40;break;case "Bone":d.ww=1500;d.wc=300;break;case "Chest":d.ww=400;d.wc=40;break;case "Head/Neck":d.ww=350,d.wc=90}2>d.ww&&(d.ww=2);a.DrawAnnStatusForMng(f,e)}})};this.onTool.Negative=function(){if(a.canvasMax&&a.canvasMax.bShow){var b=a.canvasMax.secondCtrl.GetMng()[0],c=b.AnnStatusMng();c&&(c.viewport.invert=!c.viewport.invert,a.DrawAnnStatusForMng(c,b))}else b=a.canvasManager.GetActiveMng(),$.each(b,function(c,b){var e=b.AnnStatusMng();e&&(e.viewport.invert=!e.viewport.invert,a.DrawAnnStatusForMng(e,b))})};this.onTool.RotateDicom=function(b){if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();if(e){switch(b){case "\u9006\u65f6\u9488":e.viewport.rotation+=-90;break;case "\u987a\u65f6\u9488":e.viewport.rotation+=90;break;case "\u5de6\u53f3\u955c\u50cf":e.viewport.hflip=!e.viewport.hflip;break;case "\u4e0a\u4e0b\u955c\u50cf":e.viewport.vflip=!e.viewport.vflip}if(-360===e.viewport.rotation||360===e.viewport.rotation)e.viewport.rotation=0;a.DrawAnnStatusForMng(e,c)}}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,e){var f=e.AnnStatusMng();if(f){switch(b){case "\u9006\u65f6\u9488":f.viewport.rotation+=-90;break;case "\u987a\u65f6\u9488":f.viewport.rotation+=90;break;case "\u5de6\u53f3\u955c\u50cf":f.viewport.hflip=!f.viewport.hflip;break;case "\u4e0a\u4e0b\u955c\u50cf":f.viewport.vflip=!f.viewport.vflip}if(-360===f.viewport.rotation||360===f.viewport.rotation)f.viewport.rotation=0;a.DrawAnnStatusForMng(f,e)}})};this.onTool.ReLoadDicom=function(b){a.canvasMax&&a.canvasMax.bShow&&a.canvasMax.Show(!1);b&&a.InitAnnStatusStack();b=a.dataManager.GetStudy(0);var c=b.GetStudyType(),e=b.IsPageSwitch();"series"===c&&e&&b.RequestSeriesDicom();b=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(b.length);c=a.canvasManager.GetMng();for(e=0;e<c.length;e++){var f=c[e],d=f.GetLayoutCanvas();0===d.length&&f.UpdateLayout(0,1,1);if(e<b.length){var h=b[e];f.AnnStatusMng(h);f.UpdateLayout(h.images.length);"series"===h.type&&f.checkbox.Show(!0);window.devicePixelRatio=1;a.DrawAnnStatus(h,d,!0)}else f.checkbox.Show(!1),$.each(d,function(a,c){c.Clear();c.DrawCornerInfo()}),f.Clear()}};this.onTool.DeleteDicom=function(){if(a.canvasMax&&a.canvasMax.bShow){var b=a.canvasMax.secondCtrl.GetMng()[0],c=b.AnnStatusMng();if(c){var c=CBoBo.AnnStatusManager.Delete(c),e=CBoBo.AnnStatusManager.Get(),c=Math.min(c,e.length-1);a.canvasMax.secondCtrl.UpdateLayout(e.length,1,1,(0>c?0:c)+1);if(c<e.length&&-1<c){if(c=e[c])b.UpdateLayout(c.images.length),b.AnnStatusMng(c),a.DrawAnnStatusForMng(c,b)}else b.UpdateLayout(0),b.AnnStatusMng(null),b=b.GetAllCanvas()[0],c=b.canvas,c.width=c.width,b.DrawCornerInfo()}}else b=a.canvasManager.GetActiveMng(),$.each(b,function(a,c){var b=c.AnnStatusMng();CBoBo.AnnStatusManager.Delete(b)}),a.onTool.ReLoadDicom()};this.onTool.RestoreDicom=function(){if(a.canvasMax&&a.canvasMax.bShow){var b=a.canvasMax.secondCtrl.GetMng()[0],c=b.AnnStatusMng();c&&(CBoBo.ImageProcessor.Restore(c.viewport),c.anns={},a.DrawAnnStatusForMng(c,b,!0))}else b=a.canvasManager.GetActiveMng(),$.each(b,function(c,b){var e=b.AnnStatusMng();e&&(CBoBo.ImageProcessor.Restore(e.viewport),e.anns={},a.DrawAnnStatusForMng(e,b,!0))})};this.onTool.Pseudocolor=function(b){if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();e&&(e.viewport.pseudo=b,a.DrawAnnStatusForMng(e,c))}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,e){var f=e.AnnStatusMng();f&&(f.viewport.pseudo=b,a.DrawAnnStatusForMng(f,e))})};this.onTool.CanvasLayout=function(b){switch(b.ctrltype){case "\u56fe\u50cf\u5e03\u5c40":if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();e&&(c.UpdateLayout(e.images.length,b.row,b.col),b=c.GetAllCanvas(),a.DrawAnnStatus(e,b,!0),e=c.GetFocusCanvas(),void 0===e&&c.Focus(b.length-1))}else if(c=a.canvasManager.GetFocusMng(),void 0!==c&&(e=c.AnnStatusMng()))c.UpdateLayout(e.images.length,b.row,b.col),b=c.GetAllCanvas(),a.DrawAnnStatus(e,b,!0),e=c.GetFocusCanvas(),void 0===e&&c.Focus(b.length-1);break;case "\u5e8f\u5217\u5e03\u5c40":a.canvasMax&&a.canvasMax.bShow&&a.canvasMax.Show(!1);var f=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(f.length,b.row,b.col);c=a.canvasManager.GetMng();$.each(c,function(c,b){if(c<f.length){var e=f[c];if(e){b.UpdateLayout(e.images.length);b.AnnStatusMng(e);"series"===e.type?(b.checkbox.Show(!0),b.checkbox.On_Off(e.compare)):b.checkbox.Show(!1);var d=b.GetLayoutCanvas();a.DrawAnnStatus(e,d,!0)}}else b.UpdateLayout(0),b.checkbox.Show(!1)});c=a.canvasManager.focusIndex;e=a.canvasManager.GetLayout();if(void 0===e||1>e.row||1>e.col)e={row:1,col:1};e=e.row*e.col-1;c>e&&a.canvasManager.SetDefaultFocus(e,0)}};this.onTool.ScountLine=function(b){function c(a,c,b,e,f,d,g,h){var k;e.x<f.x?(k=e,e=f):k=f;k=CBoBo.ImageProcessor.PixelToCanvas(b,c,k);c=CBoBo.ImageProcessor.PixelToCanvas(b,c,e);a.save();a.strokeStyle="#fff";a.fillStyle="#FFF";a.shadowColor="#000";a.shadowOffsetX="1";a.shadowOffsetY="1";a.lineWidth="1";a.beginPath();0==g&&a.setLineDash([2,3]);a.moveTo(k.x,k.y);a.lineTo(c.x,c.y);a.stroke();h&&(new Point(0,0),5>k.y-3?a.fillText(d,k.x-3,k.y):a.fillText(d,k.x,k.y-3));a.restore()}if(a.onTool.bShowScountLine){var e=a.canvasManager.GetFocusMng(),f=e.AnnStatusMng();if(f){if(b){var d=a.canvasManager.GetMng();$.each(d,function(c,b){var e=b.AnnStatusMng();e&&a.DrawAnnStatusForMng(e,b)})}var d=a.canvasManager.GetLayoutCanvas(),h,k=[],l;for(b=0;b<d.length;b++){var m=d[b];0===b?l=e.GetEventImageIndex(m):l++;if(l<f.images.length){var r=f.images[l];void 0===h&&(h=r.seruid);k.push(r.uid)}}var p=!0;1<k.length&&(p=!1);d=a.canvasManager.GetMng();for(b=0;b<d.length;b++){var e=d[b],w=e.AnnStatusMng();if(w!==f&&w)for(var v=e.GetAllCanvas(),x=l=0;x<v.length;x++)if(m=v[x],0===x?l=e.GetEventImageIndex(m):l++,l<w.images.length&&(r=w.images[l],r=r.scount[h],void 0!==r&&0<r.length)){var z=m.canvas,n=z.getContext("2d");2<r.length&&(c(n,z,w.viewport,r[0].ptStart,r[0].ptEnd,r[0].index,!1,!0),m=r.length-1,c(n,z,w.viewport,r[m].ptStart,r[m].ptEnd,r[m].index,!1,!0));$.each(r,function(a,b){$.each(k,function(a,e){e==b.uid&&c(n,z,w.viewport,b.ptStart,b.ptEnd,b.index,!0,p)})})}}}}};this.onCanvas.Mpr={};this.onCanvas.Mpr.MsgTransform=function(b){if(a.Mpr.bMsg||"drag"===b.type)switch(b.type){case "touchstart":case "mousedown":var c;"touchstart"===b.type?(c=b.originalEvent.targetTouches[0],c=new Point(c.pageX,c.pageY),a.onCanvas.which=1):(c=new Point(b.pageX,b.pageY),a.onCanvas.which=b.which);a.Mpr.ptLast=c;a.onCanvas.Mpr.MouseDown(b);break;case "touchmove":case "mousemove":0!==a.onCanvas.which&&a.onCanvas.Mpr.MouseDownMove(b);break;case "touchend":case "mouseup":case "mouseout":a.onCanvas.Mpr.MouseUp(b);a.onCanvas.which=0;break;case "mousewheel":a.onCanvas.Mpr.MouseWheel(b);break;case "drag":a.onCanvas.Mpr.DragImage(b.imgId)}};this.onCanvas.Mpr.MouseDown=function(b){if(1===a.onCanvas.which)switch(a.onTool.Mpr.type){case "\u5341\u5b57\u5207\u9762":a.onCanvas.Mpr.Slicing(b);break;case "CPR\u66f2\u7ebf":a.onCanvas.Mpr.curvePoints=[],b=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y),a.onCanvas.Mpr.curvePoints.push(b)}};this.onCanvas.Mpr.MouseDownMove=function(b){if(1===a.onCanvas.which)switch(console.log("\u9f20\u6807\u6309\u4f4f\u79fb\u52a8"),a.onTool.Mpr.type){case "\u5207\u9762\u8c03\u7a97":a.onCanvas.Mpr.WW(b);break;case "\u5341\u5b57\u5207\u9762":a.onCanvas.Mpr.Slicing(b);break;case "CPR\u76f4\u7ebf":a.onCanvas.Mpr.CprLine(b);break;case "CPR\u66f2\u7ebf":a.onCanvas.Mpr.CprCurve(b);break;case "\u5207\u56fe":a.onCanvas.Mpr.MoveMpr(b)}else 3===a.onCanvas.which&&a.onCanvas.Mpr.WW(b)};this.onCanvas.Mpr.MouseUp=function(b){if(1===a.onCanvas.which&&"\u5207\u9762\u8c03\u7a97"!==a.onTool.Mpr.type&&"\u5341\u5b57\u5207\u9762"!==a.onTool.Mpr.type&&"\u5207\u56fe"!==a.onTool.Mpr.type){var c=a.Mpr.mng.AnnStatusMng(),e=a.Mpr.mng.GetEventImageIndex(b.self);switch(e){case 0:c.viewport.image=c.images[0];break;case 1:c.viewport.image=c.images[90];break;case 2:c.viewport.image=c.images[180];break;case 3:return}CBoBo.ImageProcessor.FitCanvas(c.viewport,b.self.canvas,!0,!0,!0);var f;switch(a.onTool.Mpr.type){case "CPR\u76f4\u7ebf":var d;if("touchend"==b.type){var h=b.originalEvent.targetTouches[0];d=new Point(h.pageX,h.pageY)}else d=new Point(b.pageX,b.pageY);h=CBoBo.ImageProcessor.PageToPixel(c.viewport,b.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y);d=CBoBo.ImageProcessor.PageToPixel(c.viewport,b.self.canvas,d.x,d.y);var k=CBoBo.Mpr.GetPointsFromLine(h,d);switch(e){case 0:f=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),k);break;case 1:f=CBoBo.Mpr.GenerateSlopePlane(a.Mpr.Series(),h,d,90);break;case 2:f=CBoBo.Mpr.GenerateSlopePlane(a.Mpr.Series(),h,d,180);break;case 3:return}break;case "CPR\u66f2\u7ebf":var l=[];$.each(a.onCanvas.Mpr.curvePoints,function(){var a=CBoBo.ImageProcessor.PageToPixel(c.viewport,b.self.canvas,this.x,this.y);l.push(a)});k=[];for(h=0;h<l.length;h++){d=l[h+1];if(void 0===d)break;d=CBoBo.Mpr.GetPointsFromLine(l[h],d);$.each(d,function(){console.log(this.x,this.y);k.push(this)})}console.log(k.length);switch(e){case 0:f=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),k);break;case 1:f=CBoBo.Mpr.GenerateSurface(a.Mpr.Series(),k);break;case 2:f=CBoBo.Mpr.GenerateSurface(a.Mpr.Series(),k);break;case 3:return}}c.viewport.image=f;e=a.Mpr.mng.GetCanvas();CBoBo.ImageProcessor.FitCanvas(c.viewport,e[3].canvas,!0,!1,!0)}};this.onCanvas.Mpr.Slicing=function(b){var c;if("touchmove"==b.type||"touchstart"==b.type){var e=b.originalEvent.targetTouches[0];c=new Point(e.pageX,e.pageY)}else c=new Point(b.pageX,b.pageY);var f=b.self.canvas,e=a.Mpr.mng.AnnStatusMng(),d=e.viewport,h=a.Mpr.mng.GetCanvas(),k=a.Mpr.Series();switch(a.Mpr.mng.GetEventImageIndex(b.self)){case CBoBo.MPR_ORIGINAL:d.image=e.images[0];c=CBoBo.ImageProcessor.PageToPixel(d,f,c.x,c.y);CBoBo.ImageProcessor.FitCanvas(d,f);a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:c,lcolor:"#0F0",vcolor:"#00F"});a.Mpr.ptO=c;f=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:c,index:a.Mpr.oIndex});a.onCanvas.Mpr.DrawMprDicom(h[1],c,180);a.onCanvas.Mpr.DrawCanvasLine(h[1],f[CBoBo.MPR_LEVEL]);a.onCanvas.Mpr.DrawMprDicom(h[2],c,90);a.onCanvas.Mpr.DrawCanvasLine(h[2],f[CBoBo.MPR_VERTICAl]);break;case CBoBo.MPR_LEVEL:d.image=e.images[180];c=CBoBo.ImageProcessor.PageToPixel(d,f,c.x,c.y);a.Mpr.ptL=c;CBoBo.ImageProcessor.FitCanvas(d,h[1].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:c,lcolor:"#F00",vcolor:"#00F"});a.Mpr.oIndex=c.y;if(b=k[a.Mpr.oIndex-1])f=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_LEVEL,point:c}),d.image=b,e.images[0]=b,CBoBo.ImageProcessor.FitCanvas(d,h[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(h[0],f[CBoBo.MPR_ORIGINAL]),a.onCanvas.Mpr.DrawMprDicom(h[2],a.Mpr.ptO,90),a.onCanvas.Mpr.DrawCanvasLine(h[2],f[CBoBo.MPR_VERTICAl]);break;case CBoBo.MPR_VERTICAl:if(d.image=e.images[90],c=CBoBo.ImageProcessor.PageToPixel(d,f,c.x,c.y),a.Mpr.ptV=c,CBoBo.ImageProcessor.FitCanvas(d,h[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:c,lcolor:"#F00",vcolor:"#0F0"}),a.Mpr.oIndex=c.y,b=k[a.Mpr.oIndex-1])f=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:c}),d.image=b,e.images[0]=b,CBoBo.ImageProcessor.FitCanvas(d,h[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(h[0],f[CBoBo.MPR_ORIGINAL]),a.onCanvas.Mpr.DrawMprDicom(h[1],a.Mpr.ptO,180),a.onCanvas.Mpr.DrawCanvasLine(h[1],f[CBoBo.MPR_LEVEL])}};this.onCanvas.Mpr.CprCurve=function(b){if(a.Mpr.mng.GetCanvas()[3]!==b.self){var c;"touchmove"==b.type||"touchstart"==b.type?(c=b.originalEvent.targetTouches[0],c=new Point(c.pageX,c.pageY)):c=new Point(b.pageX,b.pageY);var e=a.Mpr.mng.AnnStatusMng();a.onCanvas.Mpr.UpdateCanvas(e);c=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,c.x,c.y);a.onCanvas.Mpr.curvePoints.push(c);var f=b.self.canvas.getContext("2d");f.beginPath();f.strokeStyle="#FF0";b=a.onCanvas.Mpr.curvePoints[0];f.moveTo(b.x,b.y);$.each(a.onCanvas.Mpr.curvePoints,function(){f.lineTo(this.x,this.y)});f.stroke()}};this.onCanvas.Mpr.CprLine=function(b){if(a.Mpr.mng.GetCanvas()[3]!==b.self){var c;"touchmove"==b.type||"touchstart"==b.type?(c=b.originalEvent.targetTouches[0],c=new Point(c.pageX,c.pageY)):c=new Point(b.pageX,b.pageY);var e=a.Mpr.mng.AnnStatusMng();a.onCanvas.Mpr.UpdateCanvas(e);e=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y);c=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,c.x,c.y);a.onCanvas.Mpr.DrawCprLine(b.self,e,c)}};this.onCanvas.Mpr.DrawCprLine=function(a,c,e){a=a.canvas.getContext("2d");a.beginPath();a.strokeStyle="#FF0";a.moveTo(c.x,c.y);a.lineTo(e.x,e.y);a.stroke()};this.onCanvas.Mpr.WW=function(b){var c;"touchmove"==b.type&&(b=b.originalEvent.targetTouches[0]);c=new Point(b.pageX,b.pageY);b=c.x-a.Mpr.ptLast.x;var e=c.y-a.Mpr.ptLast.y;if(0!==b||0!==e){a.Mpr.ptLast=c;c=a.Mpr.mng.AnnStatusMng();var f=c.viewport;f.ww+=parseInt(b/f.scale);f.wc+=parseInt(e/f.scale);2>f.ww&&(f.ww=2);a.onCanvas.Mpr.UpdateCanvas(c)}};this.onCanvas.Mpr.UpdateCanvas=function(b){var c=a.Mpr.mng.GetCanvas();b.viewport.image=b.images[0];CBoBo.ImageProcessor.FitCanvas(b.viewport,c[0].canvas);a.onCanvas.Mpr.DrawCanvasLine(c[0],{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"});var e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex});b.viewport.image=b.images[180];CBoBo.ImageProcessor.FitCanvas(b.viewport,c[1].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(c[1],e[CBoBo.MPR_LEVEL]);b.viewport.image=b.images[90];CBoBo.ImageProcessor.FitCanvas(b.viewport,c[2].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(c[2],e[CBoBo.MPR_VERTICAl]);b.viewport.image=b.images[0];c[0].DrawCornerInfo(b.viewport);c[1].DrawCornerInfo(b.viewport);c[2].DrawCornerInfo(b.viewport)};this.onCanvas.Mpr.MouseWheel=function(b){console.log("MouseWheel");var c=a.Mpr.mng.GetCanvas(),e=b.deltaY,f=a.Mpr.Series(),d=a.Mpr.mng.AnnStatusMng(),h;h=a.Mpr.mng.GetEventImageIndex(b.self);switch(h){case CBoBo.MPR_ORIGINAL:h=a.Mpr.oIndex;a.Mpr.oIndex=0<e?1>--a.Mpr.oIndex?1:a.Mpr.oIndex:++a.Mpr.oIndex>f.length?f.length:a.Mpr.oIndex;h!==a.Mpr.oIndex&&(h=f[a.Mpr.oIndex-1],d.viewport.image=h,d.images[0]=h,CBoBo.ImageProcessor.FitCanvas(d.viewport,b.self.canvas),a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"}),e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),d.viewport.image=d.images[180],CBoBo.ImageProcessor.FitCanvas(d.viewport,c[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(c[1],e[CBoBo.MPR_LEVEL]),d.viewport.scale=1,d.viewport.image=d.images[90],CBoBo.ImageProcessor.FitCanvas(d.viewport,c[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(c[2],e[CBoBo.MPR_VERTICAl]),d.viewport.image=d.images[0],c[0].DrawCornerInfo(d.viewport),c[1].DrawCornerInfo(d.viewport),c[2].DrawCornerInfo(d.viewport));break;case CBoBo.MPR_LEVEL:h=f[0];b=parseInt(h.row);h=a.Mpr.ptO.y;a.Mpr.ptO.y=0<e?1>--a.Mpr.ptO.y?1:a.Mpr.ptO.y:++a.Mpr.ptO.y>b?b:a.Mpr.ptO.y;a.Mpr.ptV.x=a.Mpr.ptO.y;h!==a.Mpr.ptO.y&&(e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),a.onCanvas.Mpr.DrawMprDicom(c[1],a.Mpr.ptO,180),a.onCanvas.Mpr.DrawCanvasLine(c[1],e[CBoBo.MPR_LEVEL]),d.viewport.image=d.images[90],CBoBo.ImageProcessor.FitCanvas(d.viewport,c[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(c[2],e[CBoBo.MPR_VERTICAl]),e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:a.Mpr.ptV}),h=f[a.Mpr.oIndex-1],d.viewport.image=h,d.images[0]=h,CBoBo.ImageProcessor.FitCanvas(d.viewport,c[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(c[0],e[CBoBo.MPR_ORIGINAL]));break;case CBoBo.MPR_VERTICAl:h=f[0],b=parseInt(h.col),h=a.Mpr.ptO.x,a.Mpr.ptO.x=0<e?1>--a.Mpr.ptO.x?1:a.Mpr.ptO.x:++a.Mpr.ptO.x>b?b:a.Mpr.ptO.x,a.Mpr.ptL.x=a.Mpr.ptO.x,h!==a.Mpr.ptO.x&&(e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),a.onCanvas.Mpr.DrawMprDicom(c[2],a.Mpr.ptO,90),a.onCanvas.Mpr.DrawCanvasLine(c[2],e[CBoBo.MPR_VERTICAl]),d.viewport.image=d.images[180],CBoBo.ImageProcessor.FitCanvas(d.viewport,c[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(c[1],e[CBoBo.MPR_LEVEL]),e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_LEVEL,point:a.Mpr.ptL}),h=f[a.Mpr.oIndex-1],d.viewport.image=h,d.images[0]=h,CBoBo.ImageProcessor.FitCanvas(d.viewport,c[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(c[0],e[CBoBo.MPR_ORIGINAL]))}};this.onCanvas.Mpr.MoveMpr=function(b){console.log("MoveMpr");var c;"touchmove"==b.type?(c=b.originalEvent.targetTouches[0],c=new Point(c.pageX,c.pageY)):c=new Point(b.pageX,b.pageY);var e=c.y-a.Mpr.ptLast.y;if(0!==e){a.Mpr.ptLast=c;c=a.Mpr.mng.GetCanvas();var f=a.Mpr.Series(),d=a.Mpr.mng.AnnStatusMng(),h=a.Mpr.mng.GetEventImageIndex(b.self);switch(h){case CBoBo.MPR_ORIGINAL:h=a.Mpr.oIndex,a.Mpr.oIndex=0<e?1>--a.Mpr.oIndex?1:a.Mpr.oIndex:++a.Mpr.oIndex>f.length?f.length:a.Mpr.oIndex,h!==a.Mpr.oIndex&&(e=f[a.Mpr.oIndex-1],d.viewport.image=e,d.images[0]=e,CBoBo.ImageProcessor.FitCanvas(d.viewport,b.self.canvas),a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"}),b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),d.viewport.image=d.images[180],CBoBo.ImageProcessor.FitCanvas(d.viewport,c[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(c[1],b[CBoBo.MPR_LEVEL]),d.viewport.scale=1,d.viewport.image=d.images[90],CBoBo.ImageProcessor.FitCanvas(d.viewport,c[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(c[2],b[CBoBo.MPR_VERTICAl]),d.viewport.image=d.images[0],c[0].DrawCornerInfo(d.viewport),c[1].DrawCornerInfo(d.viewport),c[2].DrawCornerInfo(d.viewport))}}};this.onCanvas.Mpr.DragImage=function(b){if(b=a.dataManager.GetSeries(b))if(b=b.GetAllDicom(),10>b.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20!",CBoBo.MSG_ALERT),a.onCanvas.Mpr.Clear();else{for(var c=!1,e=0;e<b.length;e++)if(!b[e].bLoadImage){c=!0;break}c?($.Msg("\u8bf7\u7b49\u5f85\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u4e0b\u8f7d\u5b8c\u6bd5!",CBoBo.MSG_ALERT),a.onCanvas.Mpr.Clear()):(a.Mpr.Series(b),a.onCanvas.Mpr.InitCanvas())}else $.Msg("\u4e0d\u80fd\u8fdb\u884cMPR\u91cd\u5efa\uff01")};this.onCanvas.Mpr.InitCanvas=function(){var b=a.Mpr.mng.GetCanvas();if(void 0!==b){var c=a.Mpr.Series();if(c){var e=CBoBo.AnnStatusManager.Create(c[0],"","",!0);a.Mpr.mng.AnnStatusMng(e);var f=b[0],d=Math.floor(c.length/2);a.Mpr.oIndex=d;c=c[d-1];e.viewport.image=c;e.images[0]=c;CBoBo.ImageProcessor.Restore(e.viewport).FitCanvas(e.viewport,f.canvas);f.DrawCornerInfo(e.viewport);c=new Point(parseInt(c.col)>>1,parseInt(c.row)>>1);a.Mpr.ptO=c;a.onCanvas.Mpr.DrawCanvasLine(f,{point:c,lcolor:"#0F0",vcolor:"#00F"});f=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:c,index:d});a.onCanvas.Mpr.DrawMprDicom(b[1],c,180);a.onCanvas.Mpr.DrawCanvasLine(b[1],f[CBoBo.MPR_LEVEL]);b[1].DrawCornerInfo(e.viewport);a.onCanvas.Mpr.DrawMprDicom(b[2],c,90);a.onCanvas.Mpr.DrawCanvasLine(b[2],f[CBoBo.MPR_VERTICAl]);b[2].DrawCornerInfo(e.viewport);a.Mpr.ptL=f[CBoBo.MPR_LEVEL].point;a.Mpr.ptV=f[CBoBo.MPR_VERTICAl].point}}};this.onCanvas.Mpr.DrawCanvasLine=function(b,c){function e(a,c,b){a.beginPath();a.moveTo(c.x,c.y);a.lineTo(b.x,b.y);a.stroke()}if(void 0!==c){var f=b.canvas,d=b.canvas.getContext("2d"),h=a.Mpr.mng.AnnStatusMng().viewport,k=h.image,l=c.point,m=c.lcolor,r=c.vcolor,p=k.col,w=k.row,k=new Point(0,l.y),v=new Point(p,l.y),p=new Point(l.x,0),w=new Point(l.x,w),k=CBoBo.ImageProcessor.PixelToCanvas(h,f,k),v=CBoBo.ImageProcessor.PixelToCanvas(h,f,v);d.save();d.strokeStyle=m;e(d,k,v);k=CBoBo.ImageProcessor.PixelToCanvas(h,f,p);v=CBoBo.ImageProcessor.PixelToCanvas(h,f,w);d.strokeStyle=r;e(d,k,v);d.restore();return l}};this.onCanvas.Mpr.DrawMprDicom=function(b,c,e){var f={},d={},h=a.Mpr.Series();h&&(90===e?(f.x=c.x,f.y=0,d.x=c.x,d.y=h[0].row):(f.x=0,f.y=c.y,d.x=h[0].col,d.y=c.y),c=CBoBo.Mpr.GetPointsFromLine(f,d),c=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),c),f=a.Mpr.mng.AnnStatusMng(),f.images[e]=c,f.viewport.image=c,CBoBo.ImageProcessor.FitCanvas(f.viewport,b.canvas,!1,!1,!0))};this.onCanvas.Mpr.GetMprDicom=function(a,c,e){var b=a[0].col,d=a[0].row,h=parseFloat(a[0].sliceth),k=parseFloat(a[0].pixy),l=new DVDicomInfo;l.SetInfo({data:a[0]});l.pixy=h;l.sliceth=k;l.id=CBoBo.Plugin.GetRandom();0===e%180?(l.row=a.length,l.col=b):0===e%90&&(l.row=a.length,l.col=d);l.pixsBuffer=new Int16Array(l.row*l.col);var m=0,r,p=b*c.y;$.each(a,function(a,f){r=f.pixsBuffer;if(0===e%180)for(a=0;a<b;a++){var g=r[a+p];l.pixsBuffer[m]=g;m++}else if(0===e%90)for(a=0;a<d;a++)g=r[a*b+c.x],l.pixsBuffer[m]=g,m++});l.SetData(l.pixsBuffer);return l};this.onCanvas.Mpr.GetMapCoord=function(b){if(void 0!=b){var c={};switch(b.type){case CBoBo.MPR_ORIGINAL:var e=b.point,f=b.index;b=c[CBoBo.MPR_LEVEL]={};b.point=new Point(e.x,f);b.lcolor="#F00";b.vcolor="#00F";b=c[CBoBo.MPR_VERTICAl]={};b.point=new Point(e.y,f);b.lcolor="#F00";b.vcolor="#0F0";break;case CBoBo.MPR_LEVEL:e=b.point;b=c[CBoBo.MPR_ORIGINAL]={};a.Mpr.ptO.x=e.x;b.point=a.Mpr.ptO;b.lcolor="#0F0";b.vcolor="#00F";b=c[CBoBo.MPR_VERTICAl]={};a.Mpr.ptV.y=e.y;b.point=a.Mpr.ptV;b.lcolor="#F00";b.vcolor="#0F0";break;case CBoBo.MPR_VERTICAl:e=b.point,b=c[CBoBo.MPR_ORIGINAL]={},a.Mpr.ptO.y=e.x,b.point=a.Mpr.ptO,b.lcolor="#0F0",b.vcolor="#00F",b=c[CBoBo.MPR_LEVEL]={},a.Mpr.ptL.y=e.y,b.point=a.Mpr.ptL,b.lcolor="#F00",b.vcolor="#00F"}return c}};this.onCanvas.Mpr.Clear=function(){a.Mpr.mng.AnnStatusMng(null);var b=a.Mpr.mng.GetCanvas();void 0!==b&&($.each(b,function(a,b){b.canvas.width=b.canvas.width;b.DrawCornerInfo()}),a.Mpr.bMsg=!1)};this.onTool.Mpr={type:"\u5341\u5b57\u5207\u9762"};this.onTool.Mpr.MsgTransform=function(b){b=b.usermsg||b.target.title;switch(b){case "CPR\u76f4\u7ebf":case "CPR\u66f2\u7ebf":a.Mpr.SetLayout(4);break;case "\u5341\u5b57\u5207\u9762":a.Mpr.SetLayout(3);case "\u5012\u5e8f":a.Mpr.Series().reverse(),b="\u5341\u5b57\u5207\u9762",a.Mpr.SetLayout(3)}a.onTool.Mpr.type=b;b=a.Mpr.mng.AnnStatusMng();a.onCanvas.Mpr.UpdateCanvas(b)};this.PrintView={};this.PrintView.MsgTransform=function(b){if(b.self){var c=b.self.webWorkerType;switch(b.type){case "dblclick":case "doubletap":case "mousewheel":return;case "message":c==CBoBo.PTYPE_JPG?a.onCanvas.Jpg.DrawImage(b):a.onCanvas.DrawDicom(b)}c==CBoBo.PTYPE_JPG?a.onCanvas.Jpg.MsgTransform(b):a.onCanvas.MsgTransform(b)}else switch(b.toolbtnresponse&&a.onTool.MsgTransform(b),b.type){case "draw":a.FlushAnnStatusForCanvas(b.arrannstatus,b.arrcanvas,b.bforce,!0)}};this.Assist={};this.Assist.MsgTransform=function(b){if("object"==typeof b)switch(b.type){case "btnfocus":a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce);break;case "command":a.Assist.AnalyzeStatus(b.data);break;case "addstudy":b=a.Assist.GetTransferStatus(),a.assistDiagnose.SendCommand(b)}};this.Assist.GetTransferStatus=function(){var b={wadourl:"",hospid:"",studyuid:"",mode:"2d",bd:{mode:0,layout:{row:1,col:1,arrlayout:[]},focus:{index1:1,index2:1},bshowcornerinfo:1,annstatus:[]}},c={voi:{ww:0,wc:0},translation:{x:0,y:0},invert:0,rotation:0,pseudocolor:"",arrann:{}},e=a.dataManager.GetStudy(0);b.studyuid=e.stuuid;b.wadourl=e.wadourl;b.hospid=e.hospid;b.mode=void 0!==a.Mpr&&a.Mpr.bShow?"mpr":"2d";"2d"==b.mode?(b.bd.mode=a.mode,b.bd.mode==CBoBo.PTYPE_SERIES?(b.bd.layout.row=a.canvasManager.nLayoutRow,b.bd.layout.col=a.canvasManager.nLayoutCol,b.bd.focus.index1=a.canvasManager.focusIndex,b.bd.focus.index2=a.canvasManager.GetFocusMng().focusIndex,$.each(a.annStatusManager.GetAnnStatusMng(),function(a,e){var f=$.extend(!0,c,{});$.each(e.arrAnnStatus,function(a,c){var b=c.status;0==a&&(f.voi.ww=b.ww,f.voi.wc=b.wc,f.translation.x=b.ptLast.x,f.translation.y=b.ptLast.y,f.invert=b.negative,f.rotation=b.rotateState,f.pseudocolor="");if(void 0!==b.imageInfo||null!==b.imageInfo)f.arrann[b.imageInfo.id]=CBoBo.Plugin.CloneObj(c.ann.arrAnn)});b.bd.annstatus.push(f)}),$.each(a.canvasManager.arrFirstLayer,function(){b.bd.layout.arrlayout.push({row:this.nLayoutRow,col:this.nLayoutCol})})):(b.bd.layout.row=a.canvasManager.nLayoutRow,b.bd.layout.col=a.canvasManager.nLayoutCol,b.bd.focus.index1=a.canvasManager.focusIndex,$.each(a.annStatusManager.GetAnnStatus(),function(a,e){var f=$.extend(!0,{},c);if(e.type==CBoBo.PTYPE_DESERIES){var d=e.status;f.voi.ww=d.ww;f.voi.wc=d.wc;f.translation.x=d.ptLast.x;f.translation.y=d.ptLast.y;f.invert=d.negative;f.rotation=d.rotateState;f.pseudocolor="";if(void 0!==d.imageInfo||null!==d.imageInfo)f.arrann[d.imageInfo.id]=CBoBo.Plugin.CloneObj(e.ann.arrAnn)}else d=e.status,f.voi.ww=d.brightness,f.voi.wc=d.contrast,f.translation.x=d.ptLast.x,f.translation.y=d.ptLast.y,f.invert=d.Negative,f.rotation=d.rotateState,f.pseudocolor="";b.bd.annstatus.push(f)})),b.bd.bshowcornerinfo=a.toolBar.bShowCornerInfo):"mpr"==b.mode&&(b.mpr={});return b};this.Assist.AnalyzeStatus=function(b){if(b instanceof Object){var c=a.Assist.GetTransferStatus();console.log(b);if(b.hospid!=c.hospid||c.studyuid!=b.studyuid)a.onThumb.ToolMsg({usermsg:"\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5"}),void 0!==a.canvasManager&&(a.canvasManager.Destroy(),delete a.canvasManager,a.canvasManager=void 0),void 0!==a.annStatusManager&&(delete a.annStatusManager,a.annStatusManager=void 0),a.OpenStudy(b.wadourl,b.hospid,b.studyuid);(function(b){if("2d"==b.mode&&void 0!==a.canvasManager)if(b=b.bd,b.mode==CBoBo.PTYPE_SERIES){if(c.bd.layout.row!=b.layout.row||c.bd.layout.col!=b.layout.col){var e=a.annStatusManager.GetAnnStatusMng();a.canvasManager.UpdateLayout(e.length,b.layout.row,b.layout.col);a.canvasManager.EachMng(function(a,c){if(a<e.length){var b=e[a];if(null!==b){var f=b.GetAnnStatus();c.UpdateLayout(f.length);c.AnnStatusMng(b);0<f.length&&(f[0].type==CBoBo.PTYPE_SERIES?c.checkbox.Show(!0):c.checkbox.Show(!1))}}else c.UpdateLayout(0),c.checkbox.Show(!1)})}var d=b.layout.arrlayout,h=c.bd.layout.arrlayout;d instanceof Array&&a.canvasManager.EachMng(function(a,c){if(a<d.length){var b=d[a],e=h[a];if(e.row!=b.row||e.col!=b.col)null!==c.annStatusMng?c.UpdateLayout(c.annStatusMng.arrAnnStatus.length,b.row,b.col):c.UpdateLayout(0,b.row,b.col)}})}else if(c.bd.layout.row!=b.layout.row||c.bd.layout.col!=b.layout.col){var k=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(k.length,b.layout.row,b.layout.col)}})(b);(function(b){"2d"==b.mode&&(b=b.bd,c.bd.focus.index1==b.focus.index1&&c.bd.focus.index2==b.focus.index2||a.canvasManager.SetDefaultFocus(b.focus.index1,b.focus.index2))})(b);(function(a){if("2d"==a.mode){a=a.bd;var c=a.annstatus;a.mode==CBoBo.PTYPE_SERIES&&c instanceof Array&&$.each(c,function(a,c){})}})(b)}};a.GlobalInit();a.DL.OpenStudy()};"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.DataManager=function(d){var a=this;this.arrStudy=[];var b=$.extend(!0,{render:null},d);this.requestHandle;this.Request=function(a){if(void 0!==a)if(5<=this.arrStudy.length)$.Msg("\u52a0\u8f7d\u68c0\u67e5\u6570\u4e0a\u9650\uff0c\u6700\u9ad8\u53ea\u80fd\u52a0\u8f7d5\u4e2a\u68c0\u67e5\u3002"),console.log(CBoBo.Plugin.GetTime()+" :\u52a0\u8f7d\u68c0\u67e5\u6570\u4e0a\u9650\uff0c\u6700\u9ad8\u53ea\u80fd\u52a0\u8f7d5\u4e2a\u68c0\u67e5\u3002");else if(void 0!=this.GetStudy(a.studyuid))$.Msg("\u52a0\u8f7d\u8be5\u68c0\u67e5\x3c"+a.studyuid+"\x3e\u5931\u8d25,\u5f53\u524d\u68c0\u67e5\u5df2\u5b58\u5728\u3002"),console.log(CBoBo.Plugin.GetTime()+" :\u52a0\u8f7d\u8be5\u68c0\u67e5\x3c"+a.studyuid+"\x3e\u5931\u8d25,\u68c0\u67e5\u5df2\u5b58\u5728\u3002");else{var c=new DVStudy;c.stuuid=a.studyuid;c.wadourl=a.wadourl;c.hospid=a.hospid;this.requestHandle=new DicomRequest({wadourl:a.wadourl,hospid:a.hospid,study:c,token:a.token,hasDesensitize:a.hasDesensitize,error:a.error,success:a.success,progress:a.progress,deseriesfakeprogress:a.deseriesfakeprogress,serverRead:a.serverRead});this.requestHandle.StartStudyInfo();this.arrStudy.push(c)}};this.RequestAIAnnotation=function(c){layer.confirm("\u5e73\u53f0\u53ea\u5f00\u653e\u80f8\u90e8CT\u3001DR\u5f71\u50cf\u7684AI\u670d\u52a1\uff0c\u66f4\u591a\u90e8\u4f4d\u5c06\u9646\u7eed\u5f00\u653e\u3002\x3cbr\x3e\u7b26\u5408\u8bf7\u201c\u786e\u8ba4\u201d\x3c/br\x3e\u4e0d\u7b26\u5408\u8bf7\u201c\u8fd4\u56de\u201d,\u89e3\u6790\u7ed3\u679c\u9700\u8981\u7b49\u5f85\u5927\u698230\u79d2",{btn:["\u786e\u5b9a","\u53d6\u6d88"],title:"AI\u8bca\u65ad"},function(){layer.msg("\u6b63\u5728\u4e3a\u60a8\u89e3\u6790AI\u7ed3\u679c\u3002",{icon:1});var b=a.arrStudy[0].wadourl.replace("Wado","").replace("wado","");$.ajax({url:b+"Ai/NewStudy",type:"get",data:{studyUid:a.arrStudy[0].stuuid,hospId:a.arrStudy[0].hospid},async:!1,complete:function(a){200==a.status&&a.responseJSON?"success"===a.responseJSON.status?c.success():(c.error&&c.error(),layer.msg("\u8bf7\u6c42AI\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]})):(c.error&&c.error(),layer.msg("\u8bf7\u6c42AI\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}))}})},function(){})};this.RequestAIResult=function(c){var b=a.arrStudy[0].wadourl.replace("Wado","").replace("wado","");$.ajax({url:b+"Ai/GetResult",type:"get",data:{studyUid:a.arrStudy[0].stuuid,hospId:a.arrStudy[0].hospid},async:!1,complete:function(b){200==b.status&&b.responseJSON?(b=b.responseJSON,"success"===b.status?b.result.imgDetail.length?(a.arrStudy[0].SetAnnotations(b.result.imgDetail),c.success()):layer.msg("\u626b\u63cf\u5b8c\u6210\uff0c\u672a\u53d1\u73b0\u53ef\u7591\u7ed3\u8282",{icon:5,time:3E3,shade:[.3,"#000"]}):(layer.msg("\u8bf7\u6c42AI\u6570\u636e\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}),c.error&&c.error())):(c.error&&c.error(),layer.msg("\u8bf7\u6c42AI\u6570\u636e\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}))}})};this.RequestHistoryStudy=function(c){var b=$.extend({hospid:"",studyuid:"",hisurl:"",process:null,progress:null,error:null,complete:null,deseriesfakeprogress:null},c);$.ajax({url:b.hisurl,type:"get",data:{hospId:b.hospid,mainstudyUid:b.studyuid},complete:function(c){var e=!1;200==c.status&&c.responseJSON&&(c.responseJSON.success?(e=!0,$.each(c.responseJSON.studies,function(c,e){a.Request({wadourl:e.url,hospuid:e.hospId,studyuid:e.uid,progress:b.progress,success:b.success,error:b.error,deseriesfakeprogress:b.deseriesfakeprogress})})):$.Msg(c.responseJSON.msg));null!=b.complete&&b.complete(e)}})};this.GetStudy=function(a){var c;a<this.arrStudy.length&&-1<a&&(c=this.arrStudy[a]);if(void 0===c)for(var b=0;b<this.arrStudy.length;b++){var e=this.arrStudy[b],d;if("JPG"==e.totaltype){d=e.GetJpg();var l=0}else d=e.GetAllDicom(),l=0;for(;l<d.length;l++)d[l].id==a&&(c=e)}if(void 0===c)for(b=0;b<this.arrStudy.length;b++)e=this.arrStudy[b],e.studyuid==a&&(c=e);return c};this.GetSeries=function(a){for(var c=0;c<this.arrStudy.length;c++){var b=this.arrStudy[c].GetSeries(a);if(void 0!=b)return b}};this.DeleteStudy=function(a){for(var c=0;c<this.arrStudy.length;c++){var b=this.arrStudy[c];b.studyuid==a&&(delete b,this.arrStudy.splice(c,1))}};var c=0;this.SaveDicomBinary=function(e,d,g,h,k,l){if(void 0!==e){void 0==k&&(k=100);c++;for(var f=0;f<this.arrStudy.length;f++){var r=this.arrStudy[f],p=r.GetDicomById(e),w;void 0!=p&&(l?(void 0!==d&&(p.col=g,p.row=h,w=8<p.bita?p.pixrep?new Int16Array(d):new Uint16Array(d):new Uint8Array(d),p.SetData(w)),p.bProgress=!0,b.render(p,r,r.CompletePercent(e))):null!==d&&void 0!==d?(p.col=g,p.row=h,w=8<p.bita?p.pixrep?new Int16Array(d):new Uint16Array(d):new Uint8Array(d),p.SetData(w),b.render(p,r,k)):(w={},w.seruid=p.seruid,w.id=p.id,b.render(w,r,k)));p=r.IsPageSwitch();w=r.GetStudyType();p&&w&&c===r.GetAllSeries().length&&a.requestHandle.DLJsonBySeriesUid()}}};!function(){var c=new Worker("dicomviewer/js/Thread.Decode.js?v\x3d20220407");window.mergeThread=c;c.onmessage=function(c){c=c.data;a.SaveDicomBinary(c.id,c.buffer,c.width,c.height,c.progress,c.bseries)}}()};function DicomRequest(d){function a(a){a instanceof Array&&a.forEach(function(a){a.bLoadImage=!0;l.progress(a,l.study,100)})}function b(a){for(var c=[],b=l.study.GetAllSeries(),e=0;e<b.length;e++)for(var d=b[e],f=0;f<Math.min(d.arrImage.length,1);f++){var g=d.arrImage[f];c.push(g.id)}if(a)return c;for(e=0;e<b.length;e++)for(d=b[e],f=1;f<d.arrImage.length;f++)g=d.arrImage[f],c.push(g.id);return c}function c(a){for(var c=[],b=l.study.GetAllSeries(),e=0;e<b.length;e++)for(var d=b[e],f=0;f<Math.min(d.arrImage.length,1);f++){var g=d.arrImage[f];c.push(g)}if(a)return c;l.study.IsPageSwitch();l.study.GetStudyType();for(e=0;e<b.length;e++)for(d=b[e],f=1;f<d.arrImage.length;f++)g=d.arrImage[f],c.push(g);return c}function e(){var a=b(),c=0,e=l.study.imgcount;$.each(a,function(){var a=this,b=new XMLHttpRequest;b.open("GET",l.wadourl+"/GetImageMeta/"+a,!0);b.responseType="json";b.send();b.onreadystatechange=function(){if(b.readyState===b.DONE&&200===b.status&&b.response){var d=b.response;"string"===typeof d&&(d=eval("("+d+")"));l.study.SetDicomData(d,a,0);c++}else b.readyState===b.DONE&&200!==b.status&&c++;c===e&&(l.study.CorrectScout(),l.study.bAllMetaDl=!0,f())}})}function f(){function a(a,c){c||(c=window.location.href);var b="";c.substr(c.indexOf("?")+1).split("\x26").forEach(function(c,e){-1<c.indexOf(a)&&(b=c.substr(c.indexOf("\x3d")+1))});return b}var b=[],e=[],d=c(),f=l.study.GetStudyType(),g=l.study,h=0;d instanceof Array&&("series"===f?$.each(d,function(){h++;var c={},e=a("hospitalid",this.imageicon),d=a("studyuid",this.imageicon),f=a("seriesId",this.imageicon);c.url=this.url||l.wadourl+"/GetBlock/"+this.id+"?blockIndex\x3d0\x26studyuid\x3d"+d+"\x26hospitalid\x3d"+e+"\x26seriesId\x3d"+f;c.id=this.id;c.bseries=!0;c.brgb=8<this.bita?!1:!0;c.index=0;c.ratio=1;c.dcmwidth=this.col;c.dcmheight=this.row;c.bsave=!0;b.push(c)}):$.each(d,function(){var a=g.studyuid,c=g.hospid,d=this.seruid;if(this instanceof DVDicomInfo)for(var f=this.blocks,h=0;h<f;h++){var k={};k.url=this.url||l.wadourl+"/GetBlock/"+this.id+"?blockIndex\x3d"+h+"\x26studyuid\x3d"+a+"\x26hospitalid\x3d"+c+"\x26seriesId\x3d"+d;k.id=this.id;k.bseries=!1;k.brgb=!1;k.index=h;k.ratio=Math.sqrt(f);k.bits=this.bits;k.dcmwidth=this.col;k.dcmheight=this.row;k.bsave=!0;0===h?e.push(k):b.push(k)}}));mergeThread.postMessage({type:0,arrpriority:e,arrnormal:b})}function g(){var a=b(!0),c=0,e=a.length;$.each(a,function(){var a=this,b=new XMLHttpRequest;b.open("GET",l.wadourl+"/GetImageMeta/"+a,!0);b.responseType="json";b.send();b.onreadystatechange=function(){if(b.readyState===b.DONE&&200===b.status&&b.response){var d=b.response;"string"===typeof d&&(d=eval("("+d+")"));l.study.SetDicomData(d,a,0);c++}else b.readyState===b.DONE&&200!==b.status&&c++;c===e&&h()}})}function h(){var a=[],b=c(!0),e=l.study.GetStudyType();b instanceof Array&&"series"===e&&$.each(b,function(){var c={};c.url=this.url||l.wadourl+"/GetBlock/"+this.id+"?blockIndex\x3d0";c.id=this.id;c.bseries=!0;c.brgb=8<this.bita?!1:!0;c.index=0;c.ratio=1;c.dcmwidth=this.col;c.dcmheight=this.row;c.bsave=!0;a.push(c)});mergeThread.postMessage({type:0,arrpriority:a,arrnormal:[]})}function k(){for(var a=l.study.GetJpg(),c=0;c<a.length;c++){var b=a[c];b.image=new Image;b.image.crossOrigin="";b.image.src=l.wadourl+"/GetImageData/"+b.id;$(b.image).bind("load",{img:b},function(a){a=a.data.img;a.bLoaded=!0;null!=l.progress&&l.progress(a,l.study)})}}var l=$.extend({wadourl:"",hospid:"",study:"",token:"",progress:null,serverRead:"",error:null,success:null,deseriesfakeprogress:null},d),m=this;this.StartStudyInfo=function(){var a=l.wadourl+"/GetStudyInfo";CBoBo.Draw.SetIsFromServer(l.serverRead);CBoBo.Draw.SetWadoUrl(l.wadourl);$.ajax({headers:{Authorization:l.token?"bearer "+l.token:void 0},url:a,type:"get",data:{hospId:l.hospid,StudyUID:l.study.stuuid,hasDesensitize:l.hasDesensitize?1:0},complete:function(a){200==a.status&&a.responseJSON?(a=a.responseJSON,a.success?(l.study.SetStudyInfo(a.data),l.study.UpdateSort(),null!=l.success&&l.success(l.study),l.study.hasseries&&"RAW"==l.study.totaltype?CBoBo.Draw.GetIsFromServer()?m.DLJsonBySeriesUid():(a=l.study.GetStudyType(),a="series"===a?!0:!1,l.study.IsPageSwitch()&&a?g():void 0===l.study.GetAllSeries()[0].uuid?e():m.DLJsonBySeriesUid()):k()):null!==l.error&&l.error({msg:a.msg,studyuid:l.study.stuuid})):null!==l.error&&l.error({msg:"\u5f71\u50cf\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",studyuid:l.study.stuuid})}})};this.DLJsonBySeriesUid=function(){var c=0,b=l.study.GetAllSeries();b.forEach(function(e,d){var g=new XMLHttpRequest;g.open("GET",l.wadourl+"/GetSeriesMeta?uuid\x3d"+e.uuid+"\x26studyuid\x3d"+l.study.studyuid+"\x26hospitalid\x3d"+l.study.hospid,!0);g.responseType="json";g.send();g.onreadystatechange=function(){if(g.readyState===g.DONE&&200===g.status&&g.response){var e=g.response;"string"===typeof e&&(e=eval("("+e+")"));e.success&&(l.study.SetSeriesDicom(e.data.imgs),CBoBo.Draw.GetIsFromServer()&&a(e.data.imgs));c++}else g.readyState===g.DONE&&200!==g.status&&c++;c===b.length&&(l.study.CorrectScout(),l.study.bAllMetaDl=!0,CBoBo.Draw.GetIsFromServer()||f())}})};RequestBinaryData=function(a){var c=$.Deferred(),b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="arraybuffer";b.send();b.onreadystatechange=function(){if(b.readyState==b.DONE&&200==b.status&&b.response)return c.resolve(b.response)};b.onerror=function(a){return c.reject(a)};return c}}function DVStudy(){function d(a,c){if(a instanceof Array){var b=!1;a.forEach(function(a){a===c&&(b=!0)});return b}}var a=[],b=[],c=[];this.studyuid;this.age;this.hasseries;this.hospname;this.imgcount;this.imgs;this.modality;this.name;this.orginaltype;this.patientid;this.seriescount;this.studydate;this.sex;this.studyid;this.totaltype;this.wadourl;this.hospid;this.m_Max=99999;var e=this;this.bAllMetaDl=!1;this.SetSeriesDicom=function(c){c instanceof Array&&c.forEach(function(c){c.id=c.id;for(var b=0;b<a.length;b++)for(var e=a[b],d=0;d<e.arrImage.length;d++){var f=e.arrImage[d];f.id==c.id&&(CBoBo.Draw.GetIsFromServer()&&(f.bLoadImage=!0),f.SetInfo({data:c}))}})};this.RequestCache=function(a,c,b){if(this.bAllMetaDl){var e=[],f=b.slice(Math.max(a-9,0),Math.min(c+9,b.length));b.forEach(function(a){d(f,a)?a.bLoadImage||e.push(a):(a.bLoadImage=!1,a.bProgress=!1,delete a.pixsBuffer)});this.SwitchSeriesImagesInMemory(e)}};this.RequestSeriesDicom=function(){if(this.bAllMetaDl){var a=[],c=function(){for(var a=[],c=e.GetAllSeries(),b=0;b<c.length;b++)for(var d=c[b],f=0;f<Math.min(d.arrImage.length,1);f++){var g=d.arrImage[f];a.push(g)}b=e.IsPageSwitch();d=e.GetStudyType();if(b&&d){for(b=0;b<c.length;b++)for(d=c[b],f=1;f<Math.min(d.arrImage.length,10);f++)g=d.arrImage[f],a.push(g);return a}for(b=0;b<c.length;b++)for(d=c[b],f=1;f<d.arrImage.length;f++)g=d.arrImage[f],a.push(g);return a}();this.GetStudyType();c instanceof Array&&$.each(c,function(c,b){var d={};d.url=this.url||e.wadourl+"/GetBlock/"+this.id+"?blockIndex\x3d0";d.id=this.id;d.bseries=!0;d.brgb=8<this.bita?!1:!0;d.index=0;d.ratio=1;d.dcmwidth=this.col;d.dcmheight=this.row;d.bsave=0>e.m_Max?!1:!0;a.push(d)});mergeThread.postMessage({type:1,arrpriority:[],arrnormal:a})}};this.GetSwitchInMemoryDicoms=function(a){if(a instanceof Array){var c=[];a.forEach(function(a){a.images.forEach(function(a,b){0!==b||a.bLoadImage||c.push(a)})});var b=[];$.each(c,function(a,c){var d={};d.url=c.url||e.wadourl+"/GetBlock/"+c.id+"?blockIndex\x3d0";d.id=c.id;d.bseries=!0;d.brgb=8<c.bita?!1:!0;d.index=0;d.ratio=1;d.dcmwidth=c.col;d.dcmheight=c.row;d.bsave=!0;b.push(d)});mergeThread.postMessage({type:1,arrpriority:b,arrnormal:[]})}};this.SwitchSeriesImagesInMemory=function(a){var c=[];$.each(a,function(a,b){var d={};d.url=b.url||e.wadourl+"/GetBlock/"+b.id+"?blockIndex\x3d0";d.id=b.id;d.bseries=!0;d.brgb=8<b.bita?!1:!0;d.index=0;d.ratio=1;d.dcmwidth=b.col;d.dcmheight=b.row;d.seriesuid=b.seruid;d.bsave=!0;c.push(d)});mergeThread.postMessage({type:2,arrpriority:c,arrnormal:[]})};this.IsPageSwitch=function(){return this.imgcount>this.m_Max};this.CompletePercent=function(a){a=this.GetSeries(a);if(void 0!==a){var c=0;a=a.GetAllDicom();$.each(a,function(){this.bProgress&&c++});return parseInt(c/a.length*100)}return 100};this.GetStudyType=function(){var a;"JPG"==this.totaltype?a="jpg":"RAW"==this.totaltype&&(a="CT"==this.modality||"MR"==this.modality||"DX"==this.modality?"series":"deseries");return a};this.UpdateSort=function(){function c(a){if(!(void 0==a||1>a.length))for(var c,b,e=0;e<a.length;e++){c=a;b=e;for(var d=e+1;d<c.length;++d)parseInt(c[b].num)>parseInt(c[d].num)&&(b=d);c=b;c!=e&&(b=a[e],a[e]=a[c],a[c]=b)}}0<a.length&&($.each(a,function(a,b){c(b.arrImage)}),c(a));0<b.length&&c(b)};this.CorrectScout=function(){function c(a,c){if(void 0!==a){var b=a.split("|");void 0!=b&&$.each(b,function(a,b){var d=b.split("^"),d={uid:d[0],index:parseInt(d[1]),ptStart:new Point(parseInt(d[2]),parseInt(d[3])),ptEnd:new Point(parseInt(d[4]),parseInt(d[5]))},f=e[d.uid];void 0!==f&&("[object Array]"!=Object.prototype.toString.apply(c[f])&&(c[f]=[]),c[f].push(d))})}}function b(a){$.each(a,function(a,c){c.sort(function(a,c){return a.index-c.index})})}var e=function(){var c=[];$.each(a,function(a,b){$.each(b.arrImage,function(a,b){c[b.uid]=b.seruid})});return c}();$.each(a,function(a,e){$.each(e.arrImage,function(a,e){c(e.strScount,e.scount);b(e.scount);e.strScount=null})})};this.SetStudyInfo=function(a){if(void 0!=a){this.studyuid=a.studyuid;this.studyuuid=a.studyuuid;this.age=a.age;this.hasseries=parseInt(a.hasseries);this.hospname=a.hospname||a.orgname;this.imgcount=parseInt(a.imgcount);this.imgs=a.imgs;this.modality=a.modality;null!=this.modality&&""!=this.modality&&(this.modality=this.modality.toUpperCase());this.name=a.name;null!=this.name&&""!=this.name&&(this.name=this.name.replace(/\^/g,""));this.orginaltype=a.orginaltype;this.patientid=a.patientid;this.seriescount=a.seriescount;this.studydate=a.studydate;var c=a.sex.trim();this.sex="M"===c?"\u7537":"F"===c?"\u5973":c;this.studyid=a.studyid;this.totaltype="RAW";null!=this.totaltype&&""!=this.totaltype&&(this.totaltype=this.totaltype.toUpperCase());this.hasseries?this.PushArrSeries(a.serieses):this.PushArrImgs(a.imgs);window.globalStudyInfo=this}};this.PushArrSeries=function(c){if(void 0!=c){var b=this;if("RAW"==this.totaltype)$.each(c,function(c,e){var d=new DVSeries(b.studyuid,b.hospid,e.desp,e.num,e.uid,e.uuid);$.each(e.imgs,function(a,c){d.PushImage(c,b.wadourl)});a.push(d)});else{var e=[];$.each(c,function(a,c){e.push(c.imgs)});$.each(e,function(a,c){b.PushArrImgs(c)})}}};this.PushArrImgs=function(a){if(void 0!=a){var c=this;$.each(a,function(a,e){var d=new DVImageInfo;d.id=e.id;d.num=e.num;d.imageicon=c.wadourl+"/GetImageThumb/"+e.id+"?studyuid\x3d";b.push(d)})}};this.SetDicomData=function(c,b,e){for(var d=0;d<a.length;d++)for(var f=a[d],g=0;g<f.arrImage.length;g++){var h=f.arrImage[g];h.id==b&&(1==e?h.SetData(c):0==e&&h.SetInfo(c))}};this.GetSpecifyImage=function(c,b){if(!(0>b)){var e,d;for(d=0;d<a.length;d++)if(e=a[d],e.seruid==c){d=e.arrImage.length;if(b<d)return e.arrImage[b];break}}};this.GetAllSeries=function(){return a};this.GetAllDicom=function(){var c=[];$.each(a,function(a,b){$.each(b.arrImage,function(a,b){c.push(b)})});return c};this.GetJpg=function(a){if(void 0==a)return b;for(var c=0;c<b.length;c++)if(img=b[c],img.id==a)return img;if(-1<a&&a<b.length)return b[a]};this.GetNextDicom=function(c,b,e){for(var d=0;d<a.length;d++)if(ser=a[d],ser.uid===c)for(var f=0;f<ser.arrImage.length;f++)if(img=ser.arrImage[f],img.sopuid==b){if(0<e){if(0>=f)return;index=f-1}else{if(f>=ser.arrImage.length-1)return;index=f+1}return ser.arrImage[index]}};this.GetSpecialDicom=function(c,b){for(var e=0;e<a.length;e++)if(ser=a[e],ser.uid==c&&b<ser.arrImage.length)return ser.arrImage[b]};this.GetDicomById=function(c){for(var b=0;b<a.length;b++){ser=a[b];for(var e=0;e<ser.arrImage.length;e++)if(img=ser.arrImage[e],img.id===c)return img}};this.GetSeries=function(c){for(var b,e=0;e<a.length;e++){ser=a[e];for(var d=0;d<ser.arrImage.length;d++)img=ser.arrImage[d],img.id==c&&(b=ser)}void 0==b&&c<a.length&&-1<c&&(b=a[c]);return b};this.GetSeriesLengthById=function(c){for(var b=0;b<a.length;b++){ser=a[b];for(var e=0;e<ser.arrImage.length;e++)if(img=ser.arrImage[e],img.id==c)return ser.arrImage.length}};this.GetDicomNums=function(){for(var c=0,b=0;b<a.length;b++)ser=a[b],c+=ser.arrImage.length;return c};this.SetAnnotations=function(a){c=a};this.GetAnnotations=function(){return c}}function DVSeries(d,a,b,c,e,f){this.studyuid=d;this.hospid=a;this.desp=b;this.num=c;this.uid=e;this.uuid=f;this.arrImage=[];this.PushImage=function(a,c){var b=new DVDicomInfo;b.id=a.id;b.num=a.num;b.imageInstanceUid=a.imageInstanceUid;b.imageicon=c+"/GetImageThumb/"+a.id+"?seriesId\x3d"+this.uuid+"\x26studyuid\x3d"+this.studyuid+"\x26hospitalid\x3d"+this.hospid;b.url=a.url;this.arrImage.push(b)};this.GetAllDicom=function(){return this.arrImage}}function DVDicomInfo(){this.bProgress=!1;this.minGray;this.maxGray;this.id;this.num;this.imageicon;this.uid;this.pixsBuffer;this.bLoadImage=!1;this.sex;this.age;this.birth;this.patid;this.mod;this.accnum;this.stuid;this.stuuid;this.studes;this.serid;this.seruid;this.serdes;this.imgnum;this.sopuid;this.studt;this.stutm;this.acqdt;this.acqtm;this.wc;this.ww;this.ma;this.kv;this.sliceth;this.manu;this.inst;this.frames;this.row;this.col;this.pixx;this.pixy;this.bita;this.bits;this.hbit;this.rescin;this.rescsl;this.pixrep;this.sappix;this.phme;this.orl;this.ort;this.orr;this.orb;this.scount={};this.strScount;this.blocks;this.SetInfo=function(d){if(d&&(d=d.data)){this.name=d.name.replace(/\^/g,"");this.sex=d.sex;this.age=d.age;this.birth=d.birth;this.patid=d.patid;this.mod=d.mod;this.accnum=d.accnum;this.stuid=d.stuid;this.stuuid=d.stuuid;this.studes=d.studes;this.serid=d.serid;this.seruid=d.seruid;this.serdes=d.serdes;this.imgnum=d.imgnum;this.sopuid=d.sopuid;this.uid=d.uid;this.blocks=parseInt(d.blocks);if("string"!==typeof d.stutm||[":","-"].includes(d.stutm))this.stutm=d.stutm,this.studt=d.studt;else for(var a=0;2>a;a++){var b=d.stutm.substr(2*a,2),c=d.studt.substr(2*a+4,2);0==a&&(this.stutm=b,this.studt=d.studt.substr(0,4));this.stutm+=":"+b;this.studt+="-"+c}this.acqdt=d.acqdt;(this.acqtm=d.acqtm)&&parseFloat(d.acqtm).toFixed(3);this.wc=parseInt(d.wc);this.ww=parseInt(d.ww);this.ma=d.ma;this.kv=d.kv;this.sliceth=d.sliceth;this.manu=d.manu;this.inst=d.inst;this.row=parseInt(d.row);this.col=parseInt(d.col);this.pixx=d.pixx;this.pixy=d.pixy;"string"===typeof this.pixx&&"string"===typeof this.pixy&&(-1!=d.pixx.indexOf(" ")&&(a=d.pixx.split(" "),2==a.length&&(this.pixx=parseFloat(a[0]),this.pixy=parseFloat(a[1]))),this.pixx=parseFloat(this.pixx),this.pixy=parseFloat(this.pixy));this.bita=parseInt(d.bita);this.bits=d.bits;this.hbit=d.hbit;this.rescin=parseInt(d.rescin);this.rescsl=parseFloat(d.rescsl);if(""===d.rescin||null===d.rescin||isNaN(this.rescin))this.rescin=0;if(""===d.rescsl||null===d.rescsl||isNaN(this.rescsl)||1>d.rescsl)this.rescsl=1;this.pixrep=parseInt(d.pixrep);this.sappix=parseInt(d.sappix);this.phme=d.phme;this.orl=d.orl;this.ort=d.ort;this.orr=d.orr;this.orb=d.orb;this.strScount=d.scount}};this.SetData=function(d){if(void 0!==d){this.pixsBuffer=d;this.bLoadImage=!0;d=1E6;for(var a=-1E6,b,c=0;c<this.pixsBuffer.length;c++)b=this.pixsBuffer[c],b>a&&(a=b),b<d&&(d=b);this.minGray=d;this.maxGray=a}};this.GetData=function(){return this.pixsBuffer}}function DVImageInfo(){this.id;this.num;this.imageicon;this.image;this.bLoaded}function Point(d,a){d instanceof Object&&1==arguments.length?(this.x=d.x,this.y=d.y):(this.x=d,this.y=a)}function Rect(d,a,b,c){this.left=d||0;this.top=a||0;this.right=b||0;this.bottom=c||0}"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function a(a){for(var c=0;c<x.length;c++){var b=x[c];if(b.id===a.id&&b.imageid===a.image.id)return b}}function b(a){24<=x.length&&x.shift();x.push(a)}function c(a){for(var c=0;c<x.length;c++){var b=x[c];b.id===a.id&&b.imageid===a.imageid&&x.splice(c,1)}}function e(e,d){var f=a(e),l=g(f,e);if(d||void 0===f||f.canvas.width!==e.image.col||f.canvas.height!==e.image.row){void 0!==f&&c(f);f={};f.id=e.id;f.imageid=e.image.id;f.ww=e.ww;f.wc=e.wc;f.invert=e.invert;f.pseudo=e.pseudo;l=document.createElement("canvas");l.width=e.image.col;l.height=e.image.row;var y=l.getContext("2d"),z=y.getImageData(0,0,l.width,l.height);if(8<e.image.bita||"RGB"!==e.image.phme){var n=e.image.pixsBuffer,m=e.image.minGray,p=z.data,r=h(e.ww,e.wc,m,e.image.maxGray,e.image.rescsl,e.image.rescin,e.invert,e.pseudo);k(n,r,m,p)}else for(var n=e.image.pixsBuffer,p=m=0,r=n.length,J=z.data;p<r;)J[m++]=n[p++],J[m++]=n[p++],J[m++]=n[p++],J[m++]=255;y.putImageData(z,0,0);f.canvas=l;f.ctx=y;f.imagedata=z;b(f);return l}void 0!==f&&l&&(8<e.image.bita||"RGB"!==e.image.phme)&&(l=e.image.pixsBuffer,y=e.image.minGray,z=f.imagedata.data,n=h(e.ww,e.wc,y,e.image.maxGray,e.image.rescsl,e.image.rescin,e.invert,e.pseudo),k(l,n,y,z),f.ctx.putImageData(f.imagedata,0,0),f.ww=e.ww,f.wc=e.wc,f.invert=e.invert,f.pseudo=e.pseudo);return f.canvas}function f(e,f){var h=a(e),k=g(h,e),y=$.Deferred();if(f||void 0===h||h.canvas.width!==e.image.col||h.canvas.height!==e.image.row)void 0!==h&&c(h),h=new Image,h.src=d.Draw.GetWadoUrl()+"/GetImageData?id\x3d"+e.image.id+"\x26contentType\x3dimage/jpeg\x26windowWidth\x3d"+e.ww+"\x26windowCenter\x3d"+e.wc+"\x26efficioncy\x3d80",h.onload=function(){var a={};a.id=e.id;a.imageid=e.image.id;a.ww=e.ww;a.wc=e.wc;a.invert=e.invert;a.pseudo=e.pseudo;a.canvas=this;b(a);return y.resolve(this)};else if(void 0!==h&&k)void 0!==h&&c(h),h=new Image,h.src=d.Draw.GetWadoUrl()+"/GetImageData?id\x3d"+e.image.id+"\x26contentType\x3dimage/jpeg\x26windowWidth\x3d"+e.ww+"\x26windowCenter\x3d"+e.wc+"\x26efficioncy\x3d80",h.onload=function(){var a={};a.id=e.id;a.imageid=e.image.id;a.ww=e.ww;a.wc=e.wc;a.invert=e.invert;a.pseudo=e.pseudo;a.canvas=this;b(a);return y.resolve(this)};else return y.resolve(h.canvas);return y}function g(a,c){return void 0===a||void 0===c?!1:a.ww!==c.ww||a.wc!==c.wc||a.invert!==c.invert||a.pseudo!==c.pseudo?!0:!1}function h(a,c,b,e,d,f,g,h){var k=[],y=0;0>b&&(y=b);if(g)for(;b<=e;b++)g=parseInt(b*d+f),g=255*((g+-c)/a+.5),g=Math.min(Math.max(g,0),255),k[b+-y]=Math.round(255-g);else for(;b<=e;b++)g=parseFloat(b*d+f),g=255*((g+-c)/a+.5),g=Math.min(Math.max(g,0),255),k[b+-y]=Math.round(g);if(""===h||"\u7070\u8272"===h)return{r:k,g:k,b:k};a=l(h);c=new Int16Array(k.length);e=new Int16Array(k.length);for(f=0;f<k.length;f++)d=k[f],c[f]=a.r[d],e[f]=a.g[d],k[f]=a.b[d];return{r:c,g:e,b:k}}function k(a,c,b,e){var d=0,f=0,g=a.length,h=c.r,k=c.g;c=c.b;var l;if(0>b)for(;f<g;)l=a[f++]+-b,e[d++]=h[l],e[d++]=k[l],e[d++]=c[l],e[d++]=255;else for(;f<g;)l=a[f++],e[d++]=h[l],e[d++]=k[l],e[d++]=c[l],e[d++]=255;return e}function l(a){switch(a){case "\u5f69\u8679":return{r:rainbow_red,g:rainbow_green,b:rainbow_blue};case "\u9ed1\u4f53":return{r:blackbody_red,g:blackbody_green,b:blackbody_blue};case "\u9aa8\u9abc":return{r:bones_red,g:bones_green,b:bones_blue};case "\u5fc3\u810f":return{r:cardiac_red,g:cardiac_green,b:cardiac_blue};case "\u6d41\u52a8":return{r:flow_red,g:flow_green,b:flow_blue};case "Ge\u8272":return{r:ge_color_red,g:ge_color_green,b:ge_color_blue};case "\u7070\u8272\u5f69\u8679":return{r:gray_rainbow_red,g:gray_rainbow_green,b:gray_rainbow_blue};case "\u70ed\u7eff":return{r:hot_green_red,g:hot_green_green,b:hot_green_blue};case "\u94ec\u94c1":return{r:hot_iron_red,g:hot_iron_green,b:hot_iron_blue};case "\u70ed\u91d1\u5c5e":return{r:hot_metal_red,g:hot_metal_green,b:hot_metal_blue};case "\u9971\u548c\u5ea61":return{r:hue1_red,g:hue1_green,b:hue1_blue};case "\u9971\u548c\u5ea62":return{r:hue2_red,g:hue2_green,b:hue2_blue};case "\u7ea2\u5916":return{r:ired_red,g:ired_green,b:ired_blue};case "\u58a8\u9ed1":return{r:jet_red,g:jet_green,b:jet_blue};case "\u9aa8\u9abc-\u808c\u8089":return{r:muscles_bones_red,g:muscles_bones_green,b:muscles_bones_blue};case "NIH":return{r:nih_red,g:nih_green,b:nih_blue};case "\u5f69\u86791":return{r:rainbow1_red,g:rainbow1_green,b:rainbow1_blue};case "\u5f69\u86792":return{r:rainbow2_red,g:rainbow2_green,b:rainbow2_blue};case "\u5f69\u86793":return{r:rainbow3_red,g:rainbow3_green,b:rainbow3_blue};case "\u6bd4\u503c":return{r:ratio_red,g:ratio_green,b:ratio_blue};case "\u7ea2\u8272\u8840\u7ba1":return{r:red_vessels_red,g:red_vessels_green,b:red_vessels_blue};case "\u5149\u8c31":return{r:spectrum_red,g:spectrum_green,b:spectrum_blue};case "\u65af\u7279\u6069":return{r:stern_red,g:stern_green,b:stern_blue};case "UCLA":return{r:ucla_red,g:ucla_green,b:ucla_blue}}}function m(a){return void 0===a.image?{width:0,height:0}:0===a.rotation||180===a.rotation?{width:a.image.col,height:a.image.row}:{width:a.image.row,height:a.image.col}}function r(a,c,b){var e=new v;e.translate(c.width/2,c.height/2);var d=a.rotation;0!==d&&e.rotate(d*Math.PI/180);var f=a.scale,g=a.scale;a.image.pixy<a.image.pixx?f*=a.image.pixx/a.image.pixy:a.image.pixx<a.image.pixy&&(g*=a.image.pixy/a.image.pixx,g*a.image.row>c.height&&(g=c.height/a.image.row));e.scale(f,g);0!==d&&e.rotate(-d*Math.PI/180);e.translate(a.translation.x,a.translation.y);0!==d&&e.rotate(d*Math.PI/180);void 0!==b&&e.scale(b,b);a.hflip&&e.scale(-1,1);a.vflip&&e.scale(1,-1);e.translate(-a.image.col/2,-a.image.row/2);return e}function p(a,c,b,e){if(a.image.pixx&&a.image.pixy&&!(150>e||150>b)){var d=a.image.col,f=a.image.row,g=a.scale,h,k,l=a.image.pixx;a=a.image.pixy;h=d*g;k=f*g;var g=b/3*d*l/h,m=b/2*d*l/h,z=e/3*f*a/k,n=e/2*f*a/k,q=[1,2,3,5,10,15,20,25,30,50,100,150,200,250,300,500,1E3,1500,2E3,2500,3E3,5E3,1E4];for(a=k=f=0;a<q.length&&!(.01>f&&g<q[a]&&m>q[a]&&(f=q[a]),.01>k&&z<q[a]&&n>q[a]&&(k=q[a]),.01<=f&&.01<=k);a++);.01>f&&(f=Math.round((m+g)/2));.01>k&&(k=Math.round((n+z)/2));a=f*h/(l*d);if(!(1E4<f||1>f||1E4<k||1>k)){g="mm";1E3<=f?3E3<f?(f=Math.round(f/1E3),g="m",a=1E3*f*h/(l*d)):(f=Math.round(f/100),g="dm",a=100*f*h/(l*d)):100<=f?300<f?(f=Math.round(f/100),g="dm",a=100*f*h/(l*d)):(f=Math.round(f/10),g="cm",a=10*f*h/(l*d)):10<=f&&30<f&&(f=Math.round(f/10),g="cm",a=10*f*h/(l*d));c.save();c.setTransform(1,0,0,1,0,0);c.beginPath();c.translate(.5,.5);c.strokeStyle="white";c.fillStyle="white";h=e/20;d=(b-a)/2;l=e-h;b=(b+a)/2;e-=h;c.moveTo(Math.round(d),Math.round(l));c.lineTo(Math.round(b),Math.round(e));h=f;10>=h&&(h*=10);m=a/h;10<h&&5>m&&(h/=10,m=a/h);for(a=0;a<=h;a++)k=a*m,z=d+k,0==a%10?(q=d+k,n=l-15):0==a%5?(q=d+k,n=l-15):(q=d+k,n=l-10),k=c,k.moveTo(Math.round(z),Math.round(l)),k.lineTo(Math.round(q),Math.round(n));c.stroke();c.fillText(f+" "+g,Math.round(b+10),Math.round(e));c.restore()}}}function w(a,c,b){var e=a.image;if(e.orl||e.ort||e.orr||e.orb){b.setTransform(1,0,0,1,0,0);var f,g=a.image.col,h=a.image.row;f={x:g/2,y:12};e=d.ImageProcessor.PixelToCanvas(a,c,f);f={x:g/2,y:h-12};var k=d.ImageProcessor.PixelToCanvas(a,c,f);f={x:12,y:h/2};var l=d.ImageProcessor.PixelToCanvas(a,c,f);f={x:g-12,y:h/2};c=d.ImageProcessor.PixelToCanvas(a,c,f);f=b.measureText(a.image.ort).width;var g=b.measureText(a.image.orl).width,h=b.measureText(a.image.orr).width,m=b.measureText(a.image.orb).width;b.fillText(a.image.ort,e.x-f/2,e.y);b.fillText(a.image.orl,l.x-g/2,l.y);b.fillText(a.image.orr,c.x-h/2,c.y);b.fillText(a.image.orb,k.x-m/2,k.y)}}function v(){this.reset()}var x=[];d.ImageProcessor={GetDefaultStatus:function(){var a;a=(1E12*Math.random()>>0)+(new Date).getTime();return{id:a,image:void 0,ww:0,wc:0,rotation:0,scale:1,translation:{x:0,y:0},hflip:!1,vflip:!1,pseudo:"",invert:!1,wwScale:1}},Restore:function(a){if(!a.image.bLoadImage)return this;a.wc=parseInt(a.image.wc);a.ww=parseInt(a.image.ww);if(isNaN(a.wc)||isNaN(a.ww)||0===a.ww)a.ww=a.image.maxGray-a.image.minGray,a.wc=a.image.minGray+(a.ww>>1);a.scale=1;a.translation.x=0;a.translation.y=0;a.invert="MONOCHROME1"===a.image.phme?!0:!1;a.pseudo="";a.rotation=0;a.hflip=!1;a.vflip=!1;d.Draw.GetIsFromServer()?a.wwScale=10:a.wwScale=a.image.maxGray/2500;return this},FitCanvas:function(a,c,b,e,d){if(void 0!==a.image&&a.image.bLoadImage){var f=m(a),g;a.image.pixx===a.image.pixy||isNaN(a.image.pixx)||isNaN(a.image.pixy)?(g=c.height/f.height,f=c.width/f.width):(g=c.height/(f.height*a.image.pixy),f=c.width/f.width*a.image.pixx);a.scale=f<g?f:g;a.scale=parseFloat(a.scale.toFixed(2));a.translation.x=0;a.translation.y=0;e||this.DrawGrayImage(a,c,b,d)}},DrawGrayImage:function(a,c,b,d){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===c)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var f=c.getContext("2d");b=e(a,b);var g=a.image.col,h=a.image.row;1===a.scale?f.imageSmoothingEnabled=!1:(f.imageSmoothingQuality="high",f.imageSmoothingEnabled=!0);f.shadowColor="#000000";f.shadowOffsetX=1;f.shadowOffsetY=1;f.shadowBlur=.5;f.fillStyle="white";f.clearRect(0,0,c.width,c.height);var k=r(a,c);f.setTransform(k.m[0],k.m[1],k.m[2],k.m[3],k.m[4],k.m[5],k.m[6]);f.drawImage(b,0,0,g,h,0,0,g,h);d?f.setTransform(1,0,0,1,0,0):w(a,c,f);p(a,f,c.width,c.height)},DrawGrayImage1:function(a,c,b,d){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===c)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var f=c.getContext("2d"),g=e(a,b),h=a.image.col,k=a.image.row;f.shadowColor="#000000";f.shadowOffsetX=1;f.shadowOffsetY=1;f.shadowBlur=.5;f.fillStyle="white";f.clearRect(0,0,c.width,c.height);var l=r(a,c);f.setTransform(l.m[0],l.m[1],l.m[2],l.m[3],l.m[4],l.m[5],l.m[6]);f.drawImage(g,0,0,h,k,0,0,h,k);b=f.getImageData(0,0,h,k);var m=document.createElement("canvas");m.width=c.width;m.height=c.height;m=m.getContext("2d");m.shadowColor="#000000";m.shadowOffsetX=1;m.shadowOffsetY=1;m.shadowBlur=.5;m.fillStyle="white";m.clearRect(0,0,c.width,c.height);m.imageSmoothingEnabled=!1;m.setTransform(l.m[0],l.m[1],l.m[2],l.m[3],l.m[4],l.m[5],l.m[6]);m.drawImage(g,0,0,h,k,0,0,h,k);g=m.getImageData(0,0,h,k);b=b.data;g=g.data;for(h=0;h<b.length;h+=4)if(k=g[h],l=g[h+1],m=g[h+2],255===k||0===k)b[h]=k,b[h+1]=l,b[h+2]=m;d?f.setTransform(1,0,0,1,0,0):w(a,c,f);p(a,f,c.width,c.height)},PageToPixel:function(a,c,b,e){if(void 0===a.image)throw"PageToPixel:image has not been loaded yet.";var f=c.getBoundingClientRect();b=b-f.left-window.pageXOffset;e=e-f.top-window.pageYOffset;if(void 0!=d.Manager.Mpr&&d.Manager.Mpr.bShow){var f=c.width/2,g=c.height/2;e<g&&(e+=(g-e)/2);e>g&&(e-=(e-g)/2);b<f&&(b+=(f-b)/2);b>f&&(b-=(b-f)/2)}b={x:b,y:e};c=r(a,c);c.invert();c=b=c.transformPoint(b.x,b.y);e=a.image.col;a=a.image.row;0>c.x&&(c.x=0);0>c.y&&(c.y=0);e=0+e;a=0+a;c.x>e&&(c.x=e);c.y>a&&(c.y=a);c.x=parseInt(c.x);c.y=parseInt(c.y);return b},PixelToCanvas:function(a,c,b){return r(a,c).transformPoint(b.x,b.y)},FitServerCanvas:function(a,c,b,e,d){if(void 0!==a.image&&a.image.bLoadImage){var f=m(a),g=c.height/f.height,f=c.width/f.width;a.scale=f<g?f:g;a.scale=parseFloat(a.scale.toFixed(2));a.translation.x=0;a.translation.y=0;e||this.DrawServerGrayImage(a,c,b,d)}},DrawServerGrayImage:function(a,c,b,e){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===c)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var d=c.getContext("2d");f(a,b).then(function(b){var f=a.image.col,g=a.image.row;d.shadowColor="#000000";d.shadowOffsetX=1;d.shadowOffsetY=1;d.shadowBlur=.5;d.fillStyle="white";d.clearRect(0,0,c.width,c.height);var h=r(a,c);d.setTransform(h.m[0],h.m[1],h.m[2],h.m[3],h.m[4],h.m[5],h.m[6]);d.drawImage(b,0,0,f,g,0,0,f,g);e?d.setTransform(1,0,0,1,0,0):w(a,c,d);p(a,d,c.width,c.height)})}};v.prototype.reset=function(){this.m=[1,0,0,1,0,0]};v.prototype.clone=function(){var a=new v;a.m[0]=this.m[0];a.m[1]=this.m[1];a.m[2]=this.m[2];a.m[3]=this.m[3];a.m[4]=this.m[4];a.m[5]=this.m[5];return a};v.prototype.multiply=function(a){var c=this.m[1]*a.m[0]+this.m[3]*a.m[1],b=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],d=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],f=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=c;this.m[2]=b;this.m[3]=e;this.m[4]=d;this.m[5]=f};v.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),c=-this.m[1]*a,b=-this.m[2]*a,e=this.m[0]*a,d=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),f=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*a;this.m[1]=c;this.m[2]=b;this.m[3]=e;this.m[4]=d;this.m[5]=f};v.prototype.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);var b=this.m[1]*c+this.m[3]*a,e=this.m[0]*-a+this.m[2]*c,d=this.m[1]*-a+this.m[3]*c;this.m[0]=this.m[0]*c+this.m[2]*a;this.m[1]=b;this.m[2]=e;this.m[3]=d};v.prototype.translate=function(a,c){this.m[4]+=this.m[0]*a+this.m[2]*c;this.m[5]+=this.m[1]*a+this.m[3]*c};v.prototype.scale=function(a,c){this.m[0]*=a;this.m[1]*=a;this.m[2]*=c;this.m[3]*=c};v.prototype.transformPoint=function(a,c){var b=a,e=c;a=b*this.m[0]+e*this.m[2]+this.m[4];c=b*this.m[1]+e*this.m[3]+this.m[5];return{x:a,y:c}}}(CBoBo);"undefined"==typeof CBoBo&&(CBoBo={});!function(d){var a=!1,b;d.Draw={GetIsFromServer:function(){return a},SetIsFromServer:function(c){a=c},FitServerCanvas:function(c,b,f,g,h){a?d.ImageProcessor.FitServerCanvas(c,b,f,g,h):d.ImageProcessor.FitCanvas(c,b,f,g,h)},DrawImage:function(c,b,f,g){a?d.ImageProcessor.DrawServerGrayImage(c,b,f,g):d.ImageProcessor.DrawGrayImage(c,b,f,g)},SetWadoUrl:function(a){b=a},GetWadoUrl:function(){return b}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.Plugin={};CBoBo.Plugin.RadianToDegree=function(d){return 57.29578*d};CBoBo.Plugin.DegreeToRadian=function(d){return.0174532*d};CBoBo.Plugin.GetClockDirection=function(d,a,b){var c=a.x-d.x;a=a.y-d.y;var e=b.x-d.x;d=b.y-d.y;b=Math.sqrt(Math.pow(c,2)+Math.pow(a,2));var f=Math.sqrt(Math.pow(e,2)+Math.pow(d,2));return 0<c/b*(d/f)-e/f*(a/b)?!0:!1};CBoBo.Plugin.GetDegree=function(d,a,b){var c=CBoBo.Plugin.GetDistance(d,a);d=CBoBo.Plugin.GetDistance(d,b);a=CBoBo.Plugin.GetDistance(a,b);if(0==c||0==d)return 0;c=(c*c-a*a+d*d)/(2*c*d);-1>c?c=-1:1<c&&(c=1);return CBoBo.Plugin.RadianToDegree(Math.acos(c))};CBoBo.Plugin.GetDistance=function(d,a){return Math.sqrt((d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y))};CBoBo.Plugin.GetRectAera=function(d,a){return Math.abs((a.x-d.x)*(a.y-d.y))};CBoBo.Plugin.GetEllipseAera=function(d,a){return Math.abs(Math.PI*sw*sh)};CBoBo.Plugin.GetDrawTextCoord=function(d,a,b,c,e,f){var g={lt:[],rt:[],rb:[],lb:[],dp:[]},h=e.right-e.left;e=e.bottom-e.top;for(var k,l=0;l<d;l++)k=l*f+4*l+8,g.lt.push({x:2,y:k});for(l=0;l<a;l++)k=l*f+4*l+8,g.rt.push({x:h-2,y:k});for(l=0;l<b;l++)k=e-l*f-8-4*l,g.rb.push({x:h-2,y:k});for(l=0;l<c;l++)k=e-l*f-8-4*l,g.lb.push({x:0,y:k});g.dp.push({x:5,y:(e/2).toFixed(0)});g.dp.push({x:h/2>>0,y:8});g.dp.push({x:h-10,y:e/2>>0});g.dp.push({x:h/2>>0,y:e-10});return g};CBoBo.Plugin.PolygonArea=function(d){pt0=d[0];for(var a=0,b=d.length,c=1;c<b-1;c++)a=a+(d[c].x-pt0.x)*(d[c+1].y-pt0.y)-(d[c].y-pt0.y)*(d[c+1].x-pt0.x);a=.5*Math.abs(a);return a.toFixed(0)};CBoBo.Plugin.GetDcmDistance=function(d,a,b,c){b=d.ClientToImage_point(b,a).pointSource;c=d.ClientToImage_point(c,a).pointSource;return CBoBo.Plugin.GetDistance(b,c)};CBoBo.Plugin.GetDcmRectAera=function(d,a,b,c){b=d.ClientToImage_point(b,a).pointSource;c=d.ClientToImage_point(c,a).pointSource;return CBoBo.Plugin.GetRectAera(b,c)};CBoBo.Plugin.GetDcmEllipseAera=function(d,a,b,c){b=d.ClientToImage_point(b,a).pointSource;c=d.ClientToImage_point(c,a).pointSource;return CBoBo.Plugin.GetEllipseAera(b,c)};CBoBo.Plugin.TransCoord=function(d,a,b){d=d.GetCanvas().getBoundingClientRect();return{x:a-d.left,y:b-d.top}};CBoBo.Plugin.GetRandom=function(d,a){if(void 0==d||void 0==a)return(1E12*Math.random()>>0)+(new Date).getTime();try{var b=a-d,c=(1E12*Math.random()>>0)%a;c<d&&(c+=b);0==c&&(c=a);return c}catch(e){console.log(e.message)}};CBoBo.Plugin.SetDrawTextCoord=function(d,a,b,c,e,f,g){g||(g=10);var h={lt:[],rt:[],rb:[],lb:[],dp:[]};g*=1.1;for(var k=g>>1,l,m=0;m<b;m++)l=m*g+k,h.lt.push({x:2,y:l});for(m=0;m<c;m++)l=m*g+k,h.rt.push({x:d-2,y:l});for(m=0;m<e;m++)l=a-m*g-k,h.rb.push({x:d-2,y:l});for(m=0;m<f;m++)l=a-m*g-k,h.lb.push({x:0,y:l});h.dp.push({x:5,y:a/2>>0});h.dp.push({x:d/2>>0,y:8});h.dp.push({x:d-k,y:a/2>>0});h.dp.push({x:d/2>>0,y:a-k});return h};CBoBo.Plugin.GetUrlParam=function(d){d=new RegExp("(^|\x26)"+d+"\x3d([^\x26]*)(\x26|$)");d=window.location.search.substr(1).match(d);return null!=d?unescape(d[2]):null};CBoBo.Plugin.GetUrlParamArray=function(){for(var d=location.href,a=d.indexOf("?"),d=d.substr(a+1),d=d.split("\x26"),b={},c=0;c<d.length;c++)if(a=d[c].indexOf("\x3d"),0<a){var e=d[c].substring(0,a),a=d[c].substr(a+1);b[e]=a}return b};CBoBo.Plugin.GetBrowserInfo=function(){var d=navigator.userAgent;d.indexOf("Trident");d.indexOf("Presto");d.indexOf("AppleWebKit");-1<d.indexOf("Gecko")&&d.indexOf("KHTML");var a=!!d.match(/AppleWebKit.*Mobile.*/),b=!!d.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),c=-1<d.indexOf("Android")||-1<d.indexOf("Linux"),e=-1<d.indexOf("iPhone"),f=-1<d.indexOf("iPad");d.indexOf("Safari");d=-1<d.indexOf("NHG47K")||-1<d.indexOf("rk3399")||-1<d.indexOf("RK3399");return{language:navigator.userAgent,isMobile:a,isIOS:b,isAndroid:c,isIPhone:e,isIpad:f,isTablet:d}};CBoBo.Plugin.Error=function(d,a){id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px",background:"#000"});var b=document.getElementById(id);b.width=$(window).width();b.height=$(window).height();var c=.078125*b.width>>0,e=b.getContext("2d"),f=document.createElement("canvas"),g=f.getContext("2d"),h=[],k=[],l=!1,m=0,r=null,p=0,w=0,v=0,x=0,z=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return setTimeout(a,20)};this.run=function(){setTimeout(n,500);b.setAttribute("width",window.innerWidth);b.setAttribute("height",window.innerHeight);f.setAttribute("width",window.innerWidth);f.setAttribute("height",window.innerHeight);g.fillStyle="#fff";g.font="italic bold ".concat(c).concat("px ").concat("Helvetica");r=e.createLinearGradient(0,0,window.innerWidth,0);for(var a=0,l;10>a;a++)l="hsl(".concat(36*a).concat(", 50%, 50%)"),r.addColorStop(a/10||0,l);k=[];l=g.measureText(d);g.clearRect(0,0,window.innerWidth,window.innerHeight);g.fillText(d,window.innerWidth/2-l.width/2,window.innerHeight/2-c/2);a=g.getImageData(0,0,window.innerWidth,window.innerHeight);p=window.innerWidth/2-l.width/2;w=window.innerHeight/2-c/2-c;v=l.width;x=c;for(l=0;l<window.innerHeight;l+=3)for(var m=0;m<window.innerWidth;m+=3)0!=a.data[4*(l*window.innerWidth+m)]&&k.push({x:m,y:l,color:"hsl("+(360/v*m-p)+", 50%, 50%)"});h=[];a=0;for(l=Math.ceil(1*k.length);a<l;a++){var m=10*Math.random(),I=Math.random();h.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,dirX:0>.5-Math.random()?I*m:0-I*m,dirY:0>.5-Math.random()?(1-I)*m:0-(1-I)*m,split:I,oldX:0,oldY:0,moveX:0,moveY:0})}A()};var n=function(){if(l=!l)for(var a=m=0;a<h.length;a++)h[a].moveX=0,h[a].moveY=0},A=function(){e.clearRect(0,0,window.innerWidth,window.innerHeight);e.fillStyle="rgb(200, 200, 200)";for(var a=!1,c=0;c<h.length;c++)if(e.fillStyle=c<k.length?k[c].color:"rgb(200, 200, 200)",l)if(c<k.length){var b=c;e.fillRect(h[b].x|0,h[b].y|0,2,2);e.fill();var d=!1,f=k[b],b=h[b];f.x!=b.x&&(2>Math.abs(b.x-f.x)?b.x=f.x:(b.x>f.x?0<b.moveX?b.moveX-=2:--b.moveX:b.moveX=0>b.moveX?b.moveX+2:b.moveX+1,d=!0,b.x+=b.moveX));f.y!=b.y&&(2>Math.abs(b.y-f.y)?b.y=f.y:(b.y>f.y?0<b.moveY?b.moveY-=2:--b.moveY:b.moveY=0>b.moveY?b.moveY+2:b.moveY+1,d=!0,b.y+=b.moveY));d&&(a=!0)}else C(h[c]);else C(h[c]);l&&!a&&(m++,0<m&&180>=m&&(e.globalCompositeOperation="source-atop",e.fillStyle="#fff",a=p-20+(v+40)/180*m,e.fillRect(a,w-20,10,x+40),e.fillRect(a+10+5,w-20,5,x+40),e.globalCompositeOperation="source-over",180==m&&(setTimeout(n,500),setTimeout(n,6E3))));z(A)},C=function(a){a.x+=a.dirX;a.y+=a.dirY;0>a.x?a.dirX=Math.abs(a.dirX):a.x>window.innerWidth&&(a.dirX=0-a.dirX);0>a.y?a.dirY=Math.abs(a.dirY):a.y>window.innerHeight&&(a.dirY=0-a.dirY);e.fillRect(a.x|0,a.y|0,2,2);e.fill()};this.run();a=function(a){void 0===a&&(a="CLEAR DICOMVIEWER 2016");$("\x3cdiv\x3e"+a+"\x3c/div\x3e").appendTo($("body")).css({position:"absolute",bottom:0,color:"rgba(100,100,100,0.2)","font-size":"20px","z-index":"101",cursor:"default"})}(a)};CBoBo.Plugin.Error404=function(){id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px"});var d=document.getElementById(id);d.width=$(window).width();d.height=$(window).height();var a=Math.PI/90,b=d.getContext("2d"),c,e,f,g=[],h=function(a,c,b){c=c||0;a=c+((a-1||0)+1-c)*Math.random();return b?Math.round(a):a},k=function(a){return Math.random()<(a||.5)?-1:1},l=function(a,d,f,l){this.x=a||0;this.y=d||0;this.vx=k()*h(.5,.125);this.vy=k()*h(.5,.125);this.ax=0;this.ay=.01;this.c=f||"white";this.alpha=1;this.r=l||h(3,.5);this.evolve=function(){this.alpha-=.008;this.vx+=this.ax;this.vy+=this.ay;this.x+=this.vx;this.y+=this.vy;this.y>.5*c-this.r&&(this.y=.5*c-this.r,this.vx*=.95,this.vy*=-.9);Math.abs(this.x)>.5*c+2*this.r||this.y<-.5*e-2*this.r||0>=this.alpha?this.destroy():this.draw()};this.draw=function(){b.fillStyle=this.c;b.globalAlpha=this.alpha;b.beginPath();b.arc(this.x,this.y,this.r,0,2*Math.PI);b.closePath();b.fill()};this.destroy=function(){var a=g.indexOf(this);g.splice(a,1)}},m=function(){c=d.width=window.innerWidth;e=d.height=window.innerHeight;f=.25*Math.min(e,c);b.restore();b.save();b.translate(.5*c,.5*e)},r=function(d){var m=f*(2+Math.sin(.73*d))/2,p=m*Math.cos(d),m=m*Math.sin(d),x=~~(.183*d/Math.PI*360)%360,z;z=g.length;b.beginPath();b.clearRect(-.5*c,-.5*e,c,e);for(var n=0;n<z;n++)g[n].evolve(),g.length!=z&&(z--,n--);for(n=0;32>n;n++)z=40*(1+Math.random()),z=new l(p+k()*h(8),m+k()*h(8),"hsl("+x+",100%,"+z+"%)"),z.draw(),g.push(z);requestAnimationFrame(r.bind(this,d+a))};m();r(0);addEventListener("resize",m,!1)};CBoBo.Plugin.Error405=function(){function d(){window.requestAnimationFrame(d);++l;g.globalCompositeOperation="source-over";g.shadowBlur=0;g.fillStyle="rgba(0,0,0,alp)".replace("alp",h.repaintAlpha);g.clearRect(0,0,e,f);g.shadowBlur=h.shadowBlur;g.globalCompositeOperation="lighter";m=h.tickHueMultiplier*l;k.map(function(a){a.step()})}function a(){this.circles=[new b(2,0)];this.rot=Math.random()*Math.PI*2;this.angularVel=Math.random()*h.rayAngularVelSpan*(.5>Math.random()?1:-1);this.angularAccWaveInput=Math.random()*Math.PI*2;this.angularAccWaveInputIncrementer=h.rayAngularAccWaveInputBaseIncrementer+h.rayAngularAccWaveInputAddedIncrementer*Math.random();for(var a=100,c=0;0<--a&&this.circles[c].radius<h.maxRadius;)this.circles.push(new b(++c))}function b(a){this.radius=h.circleRadiusIncrementAcceleration*Math.pow(a,2);this.waveInputIncrementer=(h.baseWaveInputIncrementer+h.addedWaveInputIncrementer*Math.random())*(.5>Math.random()?1:-1)*h.circleNumWaveIncrementerMultiplier*a;this.waveInput=Math.random()*Math.PI*2;this.radiant=Math.random()*h.radiantSpan*(.5>Math.random()?1:-1)}id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px"});var c=document.getElementById(id),e=c.width=window.innerWidth,f=c.height=window.innerHeight,g=c.getContext("2d"),h={rays:30,maxRadius:Math.sqrt(e*e/4+f*f/4),circleRadiusIncrementAcceleration:2,radiantSpan:.4,rayAngularVelSpan:.005,rayAngularVelLineWidthMultiplier:60,rayAngularAccWaveInputBaseIncrementer:.03,rayAngularAccWaveInputAddedIncrementer:.02,rayAngularAccWaveMultiplier:3E-4,baseWaveInputIncrementer:.01,addedWaveInputIncrementer:.01,circleNumWaveIncrementerMultiplier:.1,circleNumLineWidthMultiplier:2,cx:e/2,cy:f/2,tickHueMultiplier:1,shadowBlur:0,repaintAlpha:.2},k=[],l=0,m;a.prototype.step=function(){var a=this.rot+=this.angularVel+=Math.sin(this.angularAccWaveInput+=this.angularAccWaveInputIncrementer)*h.rayAngularAccWaveMultiplier,c=h.cx,b=h.cy;g.lineWidth=Math.min(1E-5/Math.abs(this.angularVel),10/h.rayAngularVelLineWidthMultiplier)*h.rayAngularVelLineWidthMultiplier;g.beginPath();g.moveTo(c,b);for(var e=0;e<this.circles.length;++e){var d=this.circles[e];d.step();var a=a+d.radiant,f=h.cx+Math.sin(a)*d.radius,d=h.cy+Math.cos(a)*d.radius;g.quadraticCurveTo(c,b,(c+f)/2,(b+d)/2);c=f;b=d}g.strokeStyle=g.shadowColor="hsl(hue,80%,50%)".replace("hue",(a+this.rot)/2%(2*Math.PI)/Math.PI*30+m);g.stroke()};b.prototype.step=function(){this.waveInput+=this.waveInputIncrementer;this.radiant=Math.sin(this.waveInput)*h.radiantSpan};(function(){for(var c=k.length=0;c<h.rays;++c)k.push(new a);0===l&&d()})()};CBoBo.Plugin.GetTime=function(){var d=new Date,a=d.getMonth()+1,a=10>a?"0"+a:a;return d.getFullYear()+"/"+a+"/"+d.getDate()+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()};CBoBo.Plugin.SetCookie=function(d,a,b){var c=new Date;c.setTime(c.getTime()+864E5*b);b="expires\x3d"+c.toUTCString();document.cookie=d+"\x3d"+a+"; "+b+";path\x3d/;"};CBoBo.Plugin.GetCookie=function(d){d+="\x3d";for(var a=document.cookie.split(";"),b=0;b<a.length;b++){for(var c=a[b];" "==c.charAt(0);)c=c.substring(1);if(-1!=c.indexOf(d))return c.substring(d.length,c.length)}return""};CBoBo.Plugin.ClearCookie=function(d){CBoBo.Plugin.SetCookie(d,"",-1)};CBoBo.Plugin.FullScreen=function(d){function a(){var a=document.documentElement,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullScreen;"undefined"!=typeof b&&b?b.call(a):"undefined"!=typeof window.ActiveXObject&&(a=new ActiveXObject("WScript.Shell"),null!=a&&a.SendKeys("{F11}"))}function b(){var a=document,b=a.cancelFullScreen||a.webkitCancelFullScreen||a.mozCancelFullScreen||a.exitFullScreen;"undefined"!=typeof b&&b?b.call(a):"undefined"!=typeof window.ActiveXObject&&(a=new ActiveXObject("WScript.Shell"),null!=a&&a.SendKeys("{F11}"))}d?a():b()};CBoBo.Plugin.CloneObj=function(d){var a={};d instanceof Array&&(a=[]);for(var b in d){var c=d[b];a[b]="object"===typeof c?arguments.callee(c):c}return a};"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.View={};CBoBo.View.Frame=function(d){var a=this,b=!0;this.index=0;this.idManager={};this.rootDom=d;this.GetId=function(a){switch(a){case "main":return this.idManager.main;case "banner":return this.idManager.banner;case "contain":return this.idManager.contain;case "thumb":return this.idManager.thumb;case "canvasbox":return this.idManager.canvasbox;case "logo":return this.idManager.logo;case "toolbar":return this.idManager.toolbar;case "thumbbox":return this.idManager.thumbbox}};this.Init=function(){this.idManager.main="main"+CBoBo.Plugin.GetRandom();this.idManager.banner=CBoBo.Plugin.GetRandom();this.idManager.contain="contain"+CBoBo.Plugin.GetRandom();this.idManager.thumb="thumb"+CBoBo.Plugin.GetRandom();this.idManager.thumbbox="thumbbox"+CBoBo.Plugin.GetRandom();this.idManager.canvasbox="canvasbox"+CBoBo.Plugin.GetRandom();this.idManager.logo=CBoBo.Plugin.GetRandom();this.idManager.toolbar=CBoBo.Plugin.GetRandom();this.idManager.hidebar=CBoBo.Plugin.GetRandom();m_printUrl=$("#hdurl").val()};this.Create=function(){var a="\x3cdiv id\x3d'"+this.idManager.main+"'\x3e\x3cdiv id\x3d'"+this.idManager.banner+"'\x3e\x3cdiv id\x3d'"+this.idManager.logo+"' title\x3d'\u5168\u5c4f'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.idManager.toolbar,a=a+("'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"+this.idManager.contain+"\x3e"),a=a+("\x3cdiv id \x3d"+this.idManager.thumb+"\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.idManager.canvasbox+"'\x3e\x3c/div\x3e"),a=a+"\x3c/div\x3e\x3c/div\x3e";this.rootDom?$(a).appendTo(this.rootDom):$(a).appendTo($("body"))};this.AddEvent=function(){};this.UpdateStyle0=function(){var a=$(window).width(),b=$(window).height();0!=CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=.026*a>>0,29>CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=29));var d=$("#"+this.idManager.main),g=a-1;d.width(g);d.height(b-1);d.css({"border-top":"1px solid #282828","border-left":"1px solid #282828","border-right":"1px solid #282828",overflow:"hidden"});d=$("#"+this.idManager.banner);d.width(g);d.height(CBoBo.View.TOOLBAR_HEIGHT-2);d.css({background:"#535353","border-top":"1px solid #6a6a6a","border-bottom":"1px solid #282828"});d=$("#"+this.idManager.contain);b-=CBoBo.View.TOOLBAR_HEIGHT;d.width(g);d.height(b);d.css({position:"relative"});var h=$("#"+this.idManager.thumb),d=g>>4;101>d&&(d=101);h.width(d);h.height(b-2);h.css({"float":"left",background:"#464646","border-right":"1px solid #282828"});$("#"+this.idManager.thumbbox).css({width:"100%"});h=$("#"+this.idManager.logo);h.width(d);h.height(CBoBo.View.TOOLBAR_HEIGHT-2);h.css({display:"inline-block","text-align":"center"});h=$("#"+this.idManager.toolbar);h.width(g-d);h.height(CBoBo.View.TOOLBAR_HEIGHT-2);h.css({display:"inline-block",overflow:"hidden"});g=$("#"+this.idManager.canvasbox);g.width(a-d-23);g.height(b-22);g.css({"float":"left",background:"#333",padding:"10px"})};this.UpdateStyleLB=function(a){var c=$(window).width(),b=$(window).height();0!=CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=.026*c>>0,29>CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=29));var d=$("#"+this.idManager.main),h=c-1;d.width(h);d.height(b-1);d.css({"border-top":"1px solid #282828","border-left":"1px solid #282828","border-right":"1px solid #282828",overflow:"hidden"});d=$("#"+this.idManager.banner);d.width(h);d.height(CBoBo.View.TOOLBAR_HEIGHT-2);d.css({background:"#535353","border-top":"1px solid #6a6a6a","border-bottom":"1px solid #282828"});d=$("#"+this.idManager.contain);b-=CBoBo.View.TOOLBAR_HEIGHT;d.width(h);d.height(b);d.css({position:"relative"});var d=$("#"+this.idManager.thumb),k=h>>4;101>k&&(k=101);var l=$("#"+this.idManager.logo);l.width(k);l.height(CBoBo.View.TOOLBAR_HEIGHT-2);l.css({display:"inline-block","text-align":"center"});l=$("#"+this.idManager.toolbar);l.width(h-k);l.height(CBoBo.View.TOOLBAR_HEIGHT-2);l.css({display:"inline-block",overflow:"hidden"});var l=$("#"+this.idManager.canvasbox),m,r,p,w;a?(p=m=a=0,c-=20,k=b>>4,60>k&&(k=60),w=b-20-k,r=b-k,b=k,k=h):(r=a=0,m=k,p=0,c=c-k-20,w=b-20);d.width(k);d.height(b);d.css({position:"absolute",left:a+"px",top:r+"px",background:"#464646","border-right":"1px solid #282828","white-space":"nowrap","padding-bottom":"1px"});l.width(c);l.height(w);l.css({position:"absolute",left:m+"px",top:p+"px",background:"#333",padding:"10px"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height();this.UpdateStyleLB(a>b?!1:!0)};this.HideToolBar=function(){CBoBo.View.TOOLBAR_HEIGHT=0;$("#"+this.idManager.banner).hide();a.UpdateStyle()};this.ShowThumb=function(a){if(a!=b){var c=$("#"+this.idManager.thumb);a?(b=!0,c.css({transition:"left 500ms ease-in-out",left:0})):(b=!1,c.css({transition:"left 500ms ease-in-out",left:"-150px"}))}};a.Init();a.Create();a.UpdateStyle();!0};CBoBo.View.Logo=function(d){this.logo;this.logoFont;this.parentElem;var a=!1;this.Create=function(){this.logo=CBoBo.Plugin.GetRandom();this.logoFont=CBoBo.Plugin.GetRandom();$("\x3cspan id\x3d'"+this.logo+"'\x3e\x3c/span\x3e\x3cspan id\x3d'"+this.logoFont+"'\x3e\x3c/span\x3e").appendTo($(this.parentElem))};this.SetStyle=function(){var a=$("#"+this.logoFont),c=.9*$(this.parentElem).width()>>0;a.width(c);a.height(CBoBo.View.TOOLBAR_HEIGHT-2);a.css({"font-family":"STXingkai",color:"#aaa",overflow:"hidden","line-height":CBoBo.View.TOOLBAR_HEIGHT-2+"px","text-align":"center","font-size":(.2427637721755369*c>>0)+"px",cursor:"pointer","text-shadow":"2px 2px 3px #000","font-weight":"900",display:"inline-block"});a=(c>>1)-5;$("#"+this.logo).css({color:"#33FFFF",overflow:"hidden","line-height":CBoBo.View.TOOLBAR_HEIGHT-2+"px","text-align":"center","font-size":a+"px",cursor:"pointer"})};this.SetFont=function(a){$("#"+this.logoFont).html(a);return this};this.SetLogo=function(a){$("#"+this.logo).html(a);return this};this.AddEvent=function(){$(this.parentElem).bind("click",function(b){a=!a;CBoBo.Plugin.FullScreen(a)})};this.parentElem=d;this.Create();this.AddEvent();this.SetStyle();!0};CBoBo.View.PCToolBar=function(d){var a=this,b=$.extend(!0,{parent:null,axis:"x",bottonbox:!0,msgtransform:null},d),c={},e={},f={},g={type:-1,msgtansform:null},h,k,l=!1;this.bShowCornerInfo=!0;this.toolType;this.modalityType;var m=function(){var a=$("#"+c.toolbox);a&&a.empty()},r=function(){H("2D","2D");H("MPR","MPR");CBoBo.isShowAi&&H("AI","AI")},p=function(){r();F("2D");y();n("\x26#xe631;","\u91ca\u653e\u5de5\u5177");n("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");A("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40");A("\x26#xe66d;","\u5e8f\u5217\u5e03\u5c40");n("\x26#xe644;","\u6062\u590d");n("\x26#xe607;","\u5e8f\u5217\u64ad\u653e");n("\x26#xe610;","\u5b9a\u4f4d\u7ebf");n("\x26#xe671;","DICOM\u4fe1\u606f");n("\x26#xe6b6;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");y();n("\x26#xe670;","\u653e\u7f29");n("\x26#xe630;","\u79fb\u52a8");A("\x26#xe623;","\u65cb\u8f6c");y();n("\x26#xe603;","\u8d1f\u50cf");A("\x26#xe602;","\u4f2a\u5f69");y();n("\x26#xe61b;","\u8c03\u7a97");C("\x26#xe61b;","\u81ea\u5b9a\u4e49\u8c03\u7a97");y();n("\x26#xe61f;","\u76f4\u7ebf");n("\x26#xe619;","\u77e9\u5f62");n("\x26#xe61e;","\u692d\u5706");n("\x26#xe618;","\u89d2\u5ea6");n("\x26#xe637;","CT");n("\x26#xe629;","\u6587\u672c");n("\x26#xe62f;","\u7bad\u5934");n("\x26#xe9d8;","\u5de6\u6807\u8bb0");n("\x26#xE60E;","\u53f3\u6807\u8bb0");n("\x26#xe615;","\u5fc3\u80f8\u6bd4");n("\x26#xe622;","\u64a4\u9500");y();n("\x26#xe653;","\u5220\u9664\u56fe\u50cf");y();n("\x26#xe628;","\u6309\u952e\u8bf4\u660e")},w=function(a){$(a.target);switch(a.type){case "click":a.btntitle=a.target.title,g.msgtansform&&g.msgtansform(a)}},v=function(){function a(a){$.each(a,function(a,c){switch(c.title){case "\u91ca\u653e\u5de5\u5177":case "\u8c03\u7a97":case "\u653e\u7f29":case "\u79fb\u52a8":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "\u692d\u5706":case "\u89d2\u5ea6":case "CT":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u5fc3\u80f8\u6bd4":case "\u4eae\u5ea6/\u5bf9\u6bd4":b.push(c)}})}var b=[],d=$("."+c.item);a(d);d=$("."+c.menuitem);a(d);$.each(b,function(){e[this.title]=null;$(this).css({background:"","box-shadow":""})})},x=function(a){function b(a){$.each(a,function(a,c){switch(c.title){case "\u91ca\u653e\u5de5\u5177":case "\u8c03\u7a97":case "\u653e\u7f29":case "\u79fb\u52a8":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "\u692d\u5706":case "\u89d2\u5ea6":case "CT":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u5fc3\u80f8\u6bd4":case "\u4eae\u5ea6/\u5bf9\u6bd4":e.push(c)}})}var e=[],d=$("."+c.item);b(d);d=$("."+c.menuitem);b(d);for(d=0;d<e.length;d++)if(e[d].title===a)return!0;return!1},z=function(){function a(a){$.each(a,function(a,c){b.push(c)})}var b=[],e=$("."+c.item);a(e);e=$("."+c.menuitem);a(e);e=$("."+c.button);a(e);return b},n=function(a,b,e){c.item||(c.item=CBoBo.Plugin.GetRandom());a=$("\x3cspan class\x3d'icon_tool tool-item "+c.item+"' title\x3d'"+b+"'\x3e"+a+"\x3c/span\x3e").appendTo($("#"+c.toolbox));a.bind("click",function(a){w(a)});"[object Object]"==Object.prototype.toString.apply(e)&&a.css(e)},A=function(a,b,e){c.menuitem||(c.menuitem=CBoBo.Plugin.GetRandom());a=$("\x3cdiv class\x3d'tool-item "+c.menuitem+"' title\x3d'"+b+"'\x3e\x3cspan class\x3d'icon_tool' title\x3d'"+b+"'\x3e"+a+"\x3c/span\x3e\x3cspan title\x3d'"+b+"'\x3e\u25be\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+c.toolbox));a.bind("click",function(a){w(a)});"[object Object]"===Object.prototype.toString.apply(e)&&a.css(e);$("."+c.menuitem+" span").css({"pointer-events":"none",overflow:"hidden","white-space":"nowrap"})},C=function(a,b,e){c.menuitem||(c.menuitem=CBoBo.Plugin.GetRandom());a=$("\x3cdiv class\x3d'tool-item tool-item-div "+c.menuitem+"' title\x3d'"+b+" '\x3e\x3cspan title\x3d'"+b+"'\x3e\u25be\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+c.toolbox));a.bind("click",function(a){w(a)});"[object Object]"===Object.prototype.toString.apply(e)&&a.css(e);$("."+c.menuitem+" span").css({"pointer-events":"none",overflow:"hidden","white-space":"nowrap"})},y=function(a){c.line||(c.line=CBoBo.Plugin.GetRandom());var b=$("\x3cdiv class\x3d'"+c.line+"'\x3e\x3c/div\x3e").appendTo($("#"+c.toolbox));"[object Object]"==Object.prototype.toString.apply(a)&&b.css(a)},H=function(a,d){var f=$("div[title\x3d'"+d+"']");null==f.html()&&(c.button||(c.button=CBoBo.Plugin.GetRandom()),f=$("\x3cdiv class\x3d'"+c.button+"' title\x3d'"+d+"'\x3e"+a+"\x3c/div\x3e").appendTo($("#"+c.bottonbox)),f.bind("click mouseenter mouseout",function(a){if(!e[a.target.title])switch(a.type){case "mouseenter":f.css({color:"#33FFFF","text-shadow":"0 0 15px #33FFFF"});break;case "mouseout":f.css({color:"#efefef","text-shadow":""});break;case "click":F(a.target.title),b.msgtransform&&b.msgtransform(a)}}))},F=function(a){$("."+c.button).each(function(){var c=$(this);this.title==a?(e[this.title]=a,c.css({color:"#33FFFF","text-shadow":"0px 0px 20px #FFF","pointer-events":"none"})):(e[this.title]=null,c.css({animation:"",color:"#efefef","text-shadow":"","pointer-events":"auto"}))})};this.UpdateStyle=function(){var a=$(b.parent),e=$("."+c.item),d=$("."+c.menuitem),f=$("."+c.line);if("x"==b.axis){var g=a.height(),h=.66*g>>0,a=h/1.7>>0,g=(g-h)/1.5>>0;e.css({display:"block",padding:"3px",overflow:"hidden","font-size":a+"px",border:"1px solid #535353","float":"left",cursor:"pointer",margin:"0 "+g+"px","border-radius":"6px"});d.css({display:"block",padding:"3px",overflow:"hidden",margin:"0 "+g+"px","font-size":a+"px",border:"1px solid #535353","float":"left",cursor:"pointer","border-radius":"6px"});f.css({"border-left":"1px solid #383838",width:"1px",height:h+"px",margin:"0 "+g+"px","pointer-events":"none","float":"left"});a=.9*a>>0;$("."+c.button).css({width:3*a+"px",height:h+"px","float":"left",cursor:"pointer",margin:"0 2px","font-size":a+"px","text-align":"center","font-family":"Microsoft YaHei","line-height":h+"px","border-radius":"4px",border:"1px solid #535353"})}else h=.6*a.width()>>0,a=.6*h>>0,g=a/3>>0,e.css({display:"block",padding:"2px",width:h+"px",overflow:"hidden","font-size":a+"px",border:"1px solid #444",cursor:"pointer",margin:g+"px auto","border-radius":"6px"}),d.css({display:"block",padding:"2px",width:h+"px",overflow:"hidden",margin:g+"px auto","font-size":a+"px",border:"1px solid #444",cursor:"pointer","border-radius":"6px"}),f.css({"border-top":"1px solid #000",width:h+"px",height:"1px",margin:g+"px auto","pointer-events":"none"});$(".tool-item-div").css({"margin-left":"-10px"})};this.RequestToolBar=function(c,b,e){if(c!=g.type||b!=g.msgtansform||void 0!==e){m();switch(c){case CBoBo.TOOLMENU_JPG:H("2D","2D");F("2D");n("\x26#xe631;","\u91ca\u653e\u5de5\u5177");n("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");A("\x26#xe66d;","\u5e03\u5c40");n("\x26#xe644;","\u6062\u590d");n("\x26#xe670;","\u653e\u7f29");n("\x26#xe630;","\u79fb\u52a8");n("\x26#xe603;","\u8d1f\u50cf");A("\x26#xe602;","\u4f2a\u5f69");n("\x26#xe61b;","\u4eae\u5ea6/\u5bf9\u6bd4");n("\x26#xe60f;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_SERIES:p();break;case CBoBo.TOOLMENU_DESERIES:H("2D","2D");F("2D");n("\x26#xe631;","\u91ca\u653e\u5de5\u5177");n("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");A("\x26#xe66d;","\u5e03\u5c40");n("\x26#xe644;","\u6062\u590d");n("\x26#xe606;","\u80f6\u7247\u6253\u5370");n("\x26#xe671;","DICOM\u4fe1\u606f");n("\x26#xe67a;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");y();n("\x26#xe670;","\u653e\u7f29");n("\x26#xe630;","\u79fb\u52a8");A("\x26#xe623;","\u65cb\u8f6c");y();n("\x26#xe603;","\u8d1f\u50cf");A("\x26#xe602;","\u4f2a\u5f69");y();n("\x26#xe61b;","\u8c03\u7a97");y();n("\x26#xe61f;","\u76f4\u7ebf");n("\x26#xe619;","\u77e9\u5f62");n("\x26#xe61e;","\u692d\u5706");n("\x26#xe618;","\u89d2\u5ea6");n("\x26#xe637;","CT");n("\x26#xe629;","\u6587\u672c");n("\x26#xe62f;","\u7bad\u5934");n("L","\u5de6\u6807\u8bb0");n("R","\u53f3\u6807\u8bb0");n("\x26#xe615;","\u5fc3\u80f8\u6bd4");n("\x26#xe622;","\u64a4\u9500");y();n("\x26#xe653;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_PRINT_JPG:n("\x26#xe603;","\u8d1f\u50cf");n("\x26#xe644;","\u6062\u590d");n("\x26#xe653;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_PRINT_RADIATE:n("\x26#xe61f;","\u76f4\u7ebf");n("\x26#xe619;","\u77e9\u5f62");n("\x26#xe61e;","\u692d\u5706");n("\x26#xe618;","\u89d2\u5ea6");n("\x26#xe637;","CT");n("\x26#xe629;","\u6587\u672c");n("\x26#xe62f;","\u7bad\u5934");n("\x26#xe622;","\u64a4\u9500");y();A("\x26#xe623;","\u65cb\u8f6c");y();n("\x26#xe603;","\u8d1f\u50cf");n("\x26#xe644;","\u6062\u590d");n("\x26#xe653;","\u5220\u9664\u56fe\u50cf");y();n("\x26#xe67a;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");break;case CBoBo.TOOLMENU_MPR:m();r();n("\x26#xe61b;","\u5207\u9762\u8c03\u7a97");n("\x26#xe6a6;","\u5341\u5b57\u5207\u9762");n("\x26#xe6ae;","CPR\u76f4\u7ebf");n("\x26#xe641;","\u5012\u5e8f");n("\x26#xe62D;","\u5207\u56fe");F("MPR");break;case CBoBo.TOOLMENU_AI:m()}a.UpdateStyle();h=$.extend({},g);g.type=c;g.msgtansform=b}};this.Request2DToolBar=function(){a.RequestToolBar(k.type,k.msgtansform,!0)};this.RequestGrayToolBar=function(c,b){l||(p(),a.UpdateStyle(),l=!0);if(c!=g.type||b!=g.msgtansform){switch(c){case CBoBo.TOOLMENU_JPG:a.EnableButton("MPR",!1);a.EnableButton("\u91ca\u653e\u5de5\u5177",!0);a.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);a.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);a.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);a.EnableButton("\u6062\u590d",!0);a.EnableButton("\u5e8f\u5217\u64ad\u653e",!1);a.EnableButton("\u5b9a\u4f4d\u7ebf",!1);a.EnableButton("\u80f6\u7247\u6253\u5370",!1);a.EnableButton("DICOM\u4fe1\u606f",!1);a.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);a.EnableButton("\u653e\u7f29",!0);a.EnableButton("\u79fb\u52a8",!0);a.EnableButton("\u65cb\u8f6c",!1);a.EnableButton("\u8d1f\u50cf",!0);a.EnableButton("\u4f2a\u5f69",!0);a.EnableButton("\u8c03\u7a97",!0);a.EnableButton("\u76f4\u7ebf",!1);a.EnableButton("\u77e9\u5f62",!1);a.EnableButton("\u692d\u5706",!1);a.EnableButton("\u89d2\u5ea6",!1);a.EnableButton("CT",!1);a.EnableButton("\u6587\u672c",!1);a.EnableButton("\u7bad\u5934",!1);a.EnableButton("\u5de6\u6807\u8bb0",!1);a.EnableButton("\u53f3\u6807\u8bb0",!1);a.EnableButton("\u5fc3\u80f8\u6bd4",!1);a.EnableButton("\u64a4\u9500",!1);a.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_SERIES:a.EnableButton("MPR",!0);a.EnableButton("AI",!0);a.EnableButton("\u91ca\u653e\u5de5\u5177",!0);a.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);a.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);a.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);a.EnableButton("\u6062\u590d",!0);a.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);a.EnableButton("\u5b9a\u4f4d\u7ebf",!0);a.EnableButton("\u80f6\u7247\u6253\u5370",!0);a.EnableButton("DICOM\u4fe1\u606f",!0);a.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);a.EnableButton("\u653e\u7f29",!0);a.EnableButton("\u79fb\u52a8",!0);a.EnableButton("\u65cb\u8f6c",!0);a.EnableButton("\u8d1f\u50cf",!0);a.EnableButton("\u4f2a\u5f69",!0);a.EnableButton("\u8c03\u7a97",!0);a.EnableButton("\u76f4\u7ebf",!0);a.EnableButton("\u77e9\u5f62",!0);a.EnableButton("\u692d\u5706",!0);a.EnableButton("\u89d2\u5ea6",!0);a.EnableButton("CT",!0);a.EnableButton("\u6587\u672c",!0);a.EnableButton("\u7bad\u5934",!0);a.EnableButton("\u5de6\u6807\u8bb0",!0);a.EnableButton("\u53f3\u6807\u8bb0",!0);a.EnableButton("\u64a4\u9500",!0);a.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_DESERIES:a.EnableButton("MPR",!1);a.EnableButton("\u91ca\u653e\u5de5\u5177",!0);a.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);a.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);a.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);a.EnableButton("\u6062\u590d",!0);a.EnableButton("\u5e8f\u5217\u64ad\u653e",!1);a.EnableButton("\u5b9a\u4f4d\u7ebf",!1);a.EnableButton("\u80f6\u7247\u6253\u5370",!0);a.EnableButton("DICOM\u4fe1\u606f",!0);a.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);a.EnableButton("\u653e\u7f29",!0);a.EnableButton("\u79fb\u52a8",!0);a.EnableButton("\u65cb\u8f6c",!0);a.EnableButton("\u8d1f\u50cf",!0);a.EnableButton("\u4f2a\u5f69",!0);a.EnableButton("\u8c03\u7a97",!0);a.EnableButton("\u76f4\u7ebf",!0);a.EnableButton("\u77e9\u5f62",!0);a.EnableButton("\u692d\u5706",!0);a.EnableButton("\u89d2\u5ea6",!0);a.EnableButton("CT",!0);a.EnableButton("\u6587\u672c",!0);a.EnableButton("\u7bad\u5934",!0);a.EnableButton("\u5de6\u6807\u8bb0",!0);a.EnableButton("\u53f3\u6807\u8bb0",!0);a.EnableButton("\u64a4\u9500",!0);a.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_PRINT_JPG:a.EnableButton("\u91ca\u653e\u5de5\u5177",!0);a.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);a.EnableButton("\u5e03\u5c40",!0);a.EnableButton("\u6062\u590d",!0);a.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);a.EnableButton("\u5b9a\u4f4d\u7ebf",!0);a.EnableButton("\u80f6\u7247\u6253\u5370",!0);a.EnableButton("DICOM\u4fe1\u606f",!0);a.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);a.EnableButton("\u653e\u7f29",!0);a.EnableButton("\u79fb\u52a8",!0);a.EnableButton("\u65cb\u8f6c",!0);a.EnableButton("\u8d1f\u50cf",!0);a.EnableButton("\u4f2a\u5f69",!0);a.EnableButton("\u8c03\u7a97",!0);a.EnableButton("\u76f4\u7ebf",!0);a.EnableButton("\u77e9\u5f62",!0);a.EnableButton("\u692d\u5706",!0);a.EnableButton("\u89d2\u5ea6",!0);a.EnableButton("CT",!0);a.EnableButton("\u6587\u672c",!0);a.EnableButton("\u7bad\u5934",!0);a.EnableButton("\u5de6\u6807\u8bb0",!0);a.EnableButton("\u53f3\u6807\u8bb0",!0);a.EnableButton("\u5fc3\u80f8\u6bd4",!0);a.EnableButton("\u64a4\u9500",!0);a.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_PRINT_RADIATE:a.EnableButton("\u91ca\u653e\u5de5\u5177",!0);a.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);a.EnableButton("\u5e03\u5c40",!0);a.EnableButton("\u6062\u590d",!0);a.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);a.EnableButton("\u5b9a\u4f4d\u7ebf",!0);a.EnableButton("\u80f6\u7247\u6253\u5370",!0);a.EnableButton("DICOM\u4fe1\u606f",!0);a.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);a.EnableButton("\u653e\u7f29",!0);a.EnableButton("\u79fb\u52a8",!0);a.EnableButton("\u65cb\u8f6c",!0);a.EnableButton("\u8d1f\u50cf",!0);a.EnableButton("\u4f2a\u5f69",!0);a.EnableButton("\u8c03\u7a97",!0);a.EnableButton("\u76f4\u7ebf",!0);a.EnableButton("\u77e9\u5f62",!0);a.EnableButton("\u692d\u5706",!0);a.EnableButton("\u89d2\u5ea6",!0);a.EnableButton("CT",!0);a.EnableButton("\u6587\u672c",!0);a.EnableButton("\u7bad\u5934",!0);a.EnableButton("\u5de6\u6807\u8bb0",!0);a.EnableButton("\u53f3\u6807\u8bb0",!0);a.EnableButton("\u5fc3\u80f8\u6bd4",!0);a.EnableButton("\u64a4\u9500",!0);a.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_MPR:m()}a.isFirst||(k=$.extend({},g),k.type=c,k.msgtansform=b,a.isFirst=!0);h=$.extend({},g);g.type=c;g.msgtansform=b}};this.ChangeBtnStatus=function(c,b){var d;a:{d=z();for(var f=0;f<d.length;f++){var g=d[f];switch(g.title){case "\u91cd\u65b0\u52a0\u8f7d":case "\u6062\u590d":case "\u8d1f\u50cf":case "\u64a4\u9500":case "\u5220\u9664\u56fe\u50cf":continue}if(g.title==c){d=!0;break a}}d=!1}if(d){var h;if(void 0!==b)h=!b;else a:{for(h in e)if(e[h]==c){h=!0;break a}h=!1}if(x(c))return v(),"\u91ca\u653e\u5de5\u5177"===c&&(h=!1),a.ButtonStatus(c,!h),!h;a.ButtonStatus(c,!h)}};this.ButtonStatus=function(a,b){function d(a,c){var b;$.each(a,function(a,e){e.title==c&&(b=e)});return b}var f=$("."+c.item),f=d(f,a);f||(f=$("."+c.menuitem),f=d(f,a));f&&(b?(e[a]=a,$(f).css({background:"#777","box-shadow":"0 0 20px #aaa"})):($(f).css({background:"","box-shadow":""}),e[a]=null))};this.EnableButton=function(a,c){if(a){for(var b=z(),e,d=0;d<b.length;d++)if(b[d].title==a){e=b[d];break}e&&(b=$(e),c?(f[e.title]=null,b.css({color:"#efefef","pointer-events":""})):(f[e.title]=e.title,b.css({color:"gray","pointer-events":"none"})))}};this.BackToolBar=function(){if(h){this.RequestToolBar(h.type,h.msgtansform);for(var c in e){var b=e[c];b&&a.ButtonStatus(b,!0)}for(c in f)(b=f[c])&&a.EnableButton(b,!1)}};this.GetButtonDOM=function(a){var b;$("."+c.item).each(function(){this.title==a&&(b=this)});return b};(function(){c.bottonbox="bottonbox"+CBoBo.Plugin.GetRandom();c.toolbox="toolbox"+CBoBo.Plugin.GetRandom();$("\x3cdiv\x3e\x3cdiv id\x3d'"+c.bottonbox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.toolbox+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($(b.parent)).css({width:"100%",height:"100%",overflow:"hidden"});var a=$("#"+c.bottonbox),e=$("#"+c.toolbox);"x"==b.axis?b.bottonbox?(a.css({width:"9%",height:"100%",overflow:"hidden","float":"left",display:"flex","align-items":"center",color:"#efefef"}),e.css({width:"91%",height:"100%",overflow:"hidden","float":"left",display:"flex","align-items":"center",color:"#efefef"})):(a.hide(),e.css({width:"100%",height:"100%",overflow:"hidden","float":"left",display:"flex","align-items":"center",color:"#efefef"})):b.bottonbox?(a.css({width:"100%",height:"7%",overflow:"hidden",display:"flex","align-items":"center",color:"#efefef"}),e.css({width:"100%",height:"93%",overflow:"hidden",display:"flex","align-items":"center",color:"#efefef"})):(a.hide(),e.css({width:"100%",height:"100%",overflow:"hidden",color:"#efefef","text-align":"center"}))})()};CBoBo.View.LayoutCtrl=function(d){var a=this;this.ctrlId;this.tableId;this.specialId;this.trClass;this.tdClass;this.itemId=[];this.arrTD;this.bShow;var b,c=$.extend(!0,{msgtransform:null,radio:!1,specialbutton:!1},d);this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.tableId=CBoBo.Plugin.GetRandom();this.specialId=CBoBo.Plugin.GetRandom();this.radioId=CBoBo.Plugin.GetRandom();this.tdClass=CBoBo.Plugin.GetRandom();for(var a="\x3cdiv class\x3d'"+this.tdClass+"'\x3e\x3c/div\x3e",c="",b=0;6>b;b++)for(var d=0;6>d;d++)c+=a;$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e\x3cdiv id\x3d'"+this.radioId+"'\x3e\x3clabel\x3e\x3cinput name\x3d'cbobo' type\x3d'radio' value\x3d'1' checked/\x3e\u56fe\u50cf \x3c/label\x3e \x3clabel\x3e\x3cinput name\x3d'cbobo' type\x3d'radio' value\x3d'2' /\x3e\u5e8f\u5217 \x3c/label\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.tableId+"'\x3e"+c+"\x3c/div\x3e\x3cdiv id\x3d'"+this.specialId+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.Show=function(a){var c=$("#"+this.ctrlId);a?(this.bShow=!0,c.hide(),c.show(200)):(this.bShow=!1,c.hide(400))};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),d=$("#"+this.ctrlId),b=Math.max(a,b)/12>>0;117>b&&(b=117);a=b;if(c.radio){var h=.15*b;$("#"+this.radioId).height(h).width(b).show().css({"text-align":"center","font-size":"10px"});$("#"+this.radioId);a+=h}else $("#"+this.radioId).hide();d.css({width:b+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px",padding:"3px","z-index":9999999});this.arrTD=$("."+this.tdClass);b=b/7.78>>0;this.arrTD.css({border:"1px solid #585858",width:b+"px",height:b+"px",overflow:"hidden","float":"left",margin:(.1*b>>0)+"px"});if(c.specialbutton){d=$("#"+this.specialId);b=6*(b+4)-10;a-=b;b=b-.09*b>>0;h=a/7.5>>0;a-=h;d.css({width:b+"px",height:a+"px","border-top":"1px solid #b3b3b3","text-align":"center","margin-top":h+"px"});var k=b/7>>0,l=a-k>>1,m=k/6>>0;$.each(this.itemId,function(a,c){var b=$("#"+c);b.css({display:"inline-block",color:"#585858","text-align":"center","line-height":k+"px","font-size":k+"px","margin-top":.7*l+"px",padding:m+"px"});0!=a&&b.css({"margin-left":l+"px"})})}else $("#"+this.specialId).hide()};this.SetPosition=function(a,c){$("#"+this.ctrlId).css({left:a+"px",top:c+"px"})};this.SpecialMenu=function(){this.PushItem(this.specialId,'"',"2*1");this.PushItem(this.specialId,",","1*2");this.PushItem(this.specialId,"H","3*N");this.PushItem(this.specialId,"G","N*3")};this.PushItem=function(a,c,b,d){var e=CBoBo.Plugin.GetRandom();this.itemId.push(e);$("\x3cspan class\x3d'rotate icon_tool' id\x3d'"+e+"' title\x3d'"+b+"'\x3e"+c+"\x3c/span\x3e").appendTo($("#"+a));void 0!=d&&$("#"+e).bind("click",d)};this.GetRadioValue=function(){return $("#"+this.radioId+" input:checked").val()};this.AddEvent=function(){$("#"+this.tableId).bind("mousemove click",function(b){switch(b.type){case "mousemove":$.each(a.arrTD,function(a,c){b.clientX>c.getBoundingClientRect().left&&b.clientY>c.getBoundingClientRect().top?c.style.background="#c6c6c6":c.style.background="#efefef"});break;case "click":var e=0,d=0;$.each(a.arrTD,function(a,c){var b=$(c);6>a&&"rgb(198, 198, 198)"==b.css("background-color")&&d++;0==a&&"rgb(198, 198, 198)"==b.css("background-color")&&e++;5<a&&0==a%6&&"rgb(198, 198, 198)"==b.css("background-color")&&e++});sessionStorage.setItem("layout",e+","+d);console.log(e+","+d);null==c.msgtransform||0==e&&0==d||c.msgtransform({type:"click",target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:e,col:d,ctrltype:a.Type()})}});$("#"+this.ctrlId).bind("mouseleave",function(b){a.Show();b.btntitle=a.Type();b.btnforce=!1;c.msgtransform&&c.msgtransform(b)})};this.Type=function(a){if(void 0===a)return b;b=a};a.Create();a.SpecialMenu();a.UpdateStyle();a.AddEvent();!0};CBoBo.View.RotateCtrl=function(d){var a=this;this.ctrlId;this.itemClass;var b;this.bShow;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.itemClass=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool'\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u9006\u65f6\u9488'\x3e\x26#xe61d;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u987a\u65f6\u9488'\x3e\x26#xe61c;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u5de6\u53f3\u955c\u50cf'\x3e\x26#xe63a;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u4e0a\u4e0b\u955c\u50cf'\x3e\x26#xe639;\x3c/span\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),d=$("#"+this.ctrlId),b=Math.max(a,b)/15>>0;70>b&&(b=70);a=b/4>>0;17>a&&(a=17);d.css({width:b+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px","text-align":"center","z-index":999999999});d=$("."+this.itemClass);b=.171875*b>>0;d.css({display:"inline-block",padding:(.1*b>>0)+"px",overflow:"hidden","vertical-align":"top","font-size":b+"px",color:"#585858",border:"1px solid #b3b3b3","margin-top":(.03125*a>>0)+"px"})};this.AddEvent=function(c){$("."+this.itemClass).bind("click",function(a){void 0!=b&&b(a)});$("#"+this.ctrlId).bind("mouseleave",function(c){a.Show();c={usermsg:"ssssdafdsa132",btntitle:"\u65cb\u8f6c",btnforce:!1};b&&b(c)})};this.SetPosition=function(a,b){$("#"+this.ctrlId).css({left:a+"px",top:b+"px"})};this.Show=function(a){var c=$("#"+this.ctrlId);a?(this.bShow=!0,c.hide(),c.show(200)):(this.bShow=!1,c.hide(100))};b=d.msgtransform;a.Create();a.UpdateStyle();a.AddEvent();!0};CBoBo.View.PseudoColorCtrl=function(d){var a=this;this.ctrlId;this.tdClass;this.imgClass;this.bShow;var b;this.Home=function(){this.PushItem(0,"/static/dicomviewer/css/pseudocolor/0.jpg","\u7070\u8272");this.PushItem(1,"/static/dicomviewer/css/pseudocolor/1.jpg","\u5f69\u8679");this.PushItem(2,"/static/dicomviewer/css/pseudocolor/2.jpg","\u9ed1\u4f53");this.PushItem(3,"/static/dicomviewer/css/pseudocolor/3.jpg","\u9aa8\u9abc");this.PushItem(4,"/static/dicomviewer/css/pseudocolor/4.jpg","\u5fc3\u810f");this.PushItem(5,"/static/dicomviewer/css/pseudocolor/5.jpg","\u6d41\u52a8");this.PushItem(6,"/static/dicomviewer/css/pseudocolor/6.jpg","Ge\u8272");this.PushItem(7,"/static/dicomviewer/css/pseudocolor/7.jpg","\u7070\u8272\u5f69\u8679");this.PushItem(8,"/static/dicomviewer/css/pseudocolor/8.jpg","\u70ed\u7eff");this.PushItem(9,"/static/dicomviewer/css/pseudocolor/9.jpg","\u94ec\u94c1");this.PushItem(10,"/static/dicomviewer/css/pseudocolor/10.jpg","\u70ed\u91d1\u5c5e");this.PushItem(11,"/static/dicomviewer/css/pseudocolor/11.jpg","\u9971\u548c\u5ea61");this.PushItem(12,"/static/dicomviewer/css/pseudocolor/12.jpg","\u9971\u548c\u5ea62");this.PushItem(13,"/static/dicomviewer/css/pseudocolor/13.jpg","\u7ea2\u5916");this.PushItem(14,"/static/dicomviewer/css/pseudocolor/14.jpg","\u58a8\u9ed1");this.PushItem(15,"/static/dicomviewer/css/pseudocolor/15.jpg","\u9aa8\u9abc-\u808c\u8089");this.PushItem(16,"/static/dicomviewer/css/pseudocolor/16.jpg","NIH");this.PushItem(17,"/static/dicomviewer/css/pseudocolor/17.jpg","\u5f69\u86791");this.PushItem(18,"/static/dicomviewer/css/pseudocolor/18.jpg","\u5f69\u86792");this.PushItem(19,"/static/dicomviewer/css/pseudocolor/19.jpg","\u5f69\u86793");this.PushItem(20,"/static/dicomviewer/css/pseudocolor/20.jpg","\u6bd4\u503c");this.PushItem(21,"/static/dicomviewer/css/pseudocolor/21.jpg","\u7ea2\u8272\u8840\u7ba1");this.PushItem(22,"/static/dicomviewer/css/pseudocolor/22.jpg","\u5149\u8c31");this.PushItem(23,"/static/dicomviewer/css/pseudocolor/23.jpg","\u65af\u7279\u6069");this.PushItem(24,"/static/dicomviewer/css/pseudocolor/24.jpg","UCLA")};this.PushItem=function(a,b,d){$("."+this.imgClass).eq(a).attr("src",b);$("."+this.tdClass).eq(a).attr("title",d)};this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.tdClass=CBoBo.Plugin.GetRandom();this.imgClass=CBoBo.Plugin.GetRandom();for(var a="\x3cdiv class\x3d'"+this.tdClass+" pc-pseudocolor'\x3e\x3cimg class\x3d'"+this.imgClass+"' /\x3e\x3c/div\x3e",b="",d=0;5>d;d++)for(var g=0;5>g;g++)b+=a;$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e"+b+"\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),d=$("#"+this.ctrlId),a=Math.max(a,b)/10>>0;151>a&&(a=151);d.css({width:a+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px","z-index":999999999});d=.188*a>>0;a=.8*d>>0;$("."+this.tdClass).width(d).height(d).css({border:"1px solid #b3b3b3",overflow:"hidden",position:"relative","float":"left"});$("."+this.imgClass).width(a).height(a).css({position:"absolute",margin:"auto",left:0,top:0,bottom:0,right:0,"pointer-events":"none"})};this.AddEvent=function(c){$("."+this.tdClass).bind("click",function(a){void 0!=b&&b(a)});$("#"+this.ctrlId).bind("mouseleave",function(c){a.Show();c={usermsg:"sssssa2ss123sa",btntitle:"\u4f2a\u5f69",btnforce:!1};b&&b(c)})};this.SetPosition=function(a,b){$("#"+this.ctrlId).css({left:a+"px",top:b+"px"})};this.Show=function(a){var c=$("#"+this.ctrlId);a?(this.bShow=!0,c.hide(),c.show(200)):(this.bShow=!1,c.hide(400))};b=d.msgtransform;a.Create();a.Home();a.UpdateStyle();a.AddEvent();!0};CBoBo.View.LableCtrl=function(){this.ctrlId;this.bShow=!1;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e\x3ctextarea autofocus\x3e\x3c/textarea\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute","min-width":"180px","min-height":"36px","z-index":99999999});$("#"+this.ctrlId+" textarea").css({width:"100%",height:"100%","background-color":"rgba(0,0,0,0.2)",color:"#FFF",padding:"0",margin:"0"});$("#"+this.ctrlId).bind("click",function(d){d.stopPropagation()})};this.SetPosition=function(d,a){d-=2;a-=4;$("#"+this.ctrlId).css({left:d+"px",top:a+"px"})};this.Show=function(d){this.bShow=d;var a=$("#"+this.ctrlId);d?a.show():a.hide()};this.GetValue=function(){return $("#"+this.ctrlId+" textarea").val()};this.SetValue=function(d){$("#"+this.ctrlId+" textarea").val(d)};this.Create();!0};CBoBo.View.wwCtrl=function(d){var a=this;this.ctrlId;this.itemClass;var b,c;this.bShow;c=d.modalityType;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.itemClass=CBoBo.Plugin.GetRandom();$("CT"==c?"\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool icon_ww_tool'\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'CustomWWWC'\x3e\u81ea\u5b9a\u4e49\u7a97\u5bbd\u7a97\u4f4d\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Abodmen'\x3eCT Abodmen\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Lung'\x3eCT Lung\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Brain'\x3eCT Brain\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Bone'\x3eCT Bone\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Chest'\x3eCT Chest\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Head/Neck'\x3eCT Head/Neck\x3c/a\x3e\x3c/div\x3e":"\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool icon_ww_tool '\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'CustomWWWC'\x3e\u81ea\u5b9a\u4e49\u7a97\u5bbd\u7a97\u4f4d\x3c/a\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),c=$(window).height(),b=$("#"+this.ctrlId),a=Math.max(a,c)/15>>0;70>a&&(a=70);c=a/4>>0;17>c&&(c=17);b.css({width:a+"px",background:"#121212","border-bottom":"1px solid #222","border-left":"1px solid #222","border-right":"1px solid #222","border-radius":"4px","text-align":"center","z-index":999999999});$("."+this.itemClass).css({display:"block",padding:(.1*(.171875*a>>0)>>0)+"px",overflow:"hidden","vertical-align":"top","font-size":"16px",color:"#fff","margin-top":(.03125*c>>0)+"px",cursor:"pointer"})};this.AddEvent=function(c){$("."+this.itemClass).bind("click",function(a){void 0!=b&&b(a)});$("#"+this.ctrlId).bind("mouseleave",function(c){a.Show();c={usermsg:"ssssdafdsa132312",btntitle:"\u81ea\u5b9a\u4e49\u8c03\u7a97 ",btnforce:!1};b&&b(c)})};this.SetPosition=function(a,c){$("#"+this.ctrlId).css({left:a+"px",top:c+"px"})};this.Show=function(a){var c=$("#"+this.ctrlId);a?(this.bShow=!0,c.hide(),c.show(200)):(this.bShow=!1,c.hide(100))};b=d.msgtransform;a.Create();a.UpdateStyle();a.AddEvent();!0};CBoBo.View.Thumb=function(d){this.studyuid;this.bSerises;this.horv;this.arrId={};this.bFirst=this.bItemShow=!1;this.parentElem;this.seriesLen=0;this.msgTransform;this.bthumbDirect=!0;this.thumbListWidth;this.AnalysisParam(d);this.Init();this.Create();this.AddEvent();this.ShowItem(!0);this.OpenStyle();!0};CBoBo.View.Thumb.prototype.Init=function(){this.arrId.thumbitem="thumbitem"+CBoBo.Plugin.GetRandom();this.arrId.head=CBoBo.Plugin.GetRandom();this.arrId.info=CBoBo.Plugin.GetRandom();this.arrId.mode=CBoBo.Plugin.GetRandom();this.arrId.time=CBoBo.Plugin.GetRandom();this.arrId.arrow=CBoBo.Plugin.GetRandom();this.arrId.listbox="listbox"+CBoBo.Plugin.GetRandom();this.arrId.listcontain="listcontain"+CBoBo.Plugin.GetRandom();this.arrId.itemid=[];this.arrId.seriesitem="seriesitem"+CBoBo.Plugin.GetRandom();this.arrId.seriesinfo=CBoBo.Plugin.GetRandom();this.arrId.seriesinfoseries=CBoBo.Plugin.GetRandom();this.arrId.seriesimgbox=CBoBo.Plugin.GetRandom();this.arrId.seriesimg="s"+CBoBo.Plugin.GetRandom();this.arrId.progressbar=CBoBo.Plugin.GetRandom();this.arrId.progressparent=CBoBo.Plugin.GetRandom();this.arrId.progress=CBoBo.Plugin.GetRandom();this.arrId.progresspercent=CBoBo.Plugin.GetRandom()};CBoBo.View.Thumb.prototype.Create=function(){this.CreateBox();this.CreateHeadBox();this.CreateListBox()};CBoBo.View.Thumb.prototype.CreateBox=function(){$("\x3cdiv id\x3d'"+this.arrId.thumbitem+"'\x3e\x3c/div\x3e").appendTo($(this.parentElem))};CBoBo.View.Thumb.prototype.CreateHeadBox=function(){$("\x3cdiv id\x3d'"+this.arrId.head+"'\x3e\x3cspan class\x3d'"+this.arrId.info+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.info+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.info+" "+this.arrId.time+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.arrow+" icon_tool'\x3e\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.thumbitem))};CBoBo.View.Thumb.prototype.CreateListBox=function(){$("\x3cdiv id\x3d'"+this.arrId.listbox+"'\x3e\x3cdiv id\x3d'"+this.arrId.listcontain+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.thumbitem))};CBoBo.View.Thumb.prototype.SetHeadInfo=function(d,a,b){var c=$("#"+this.arrId.thumbitem+" ."+this.arrId.info);c.eq(0).html(d).attr("title",d);c.eq(1).html(a).attr("title",a);c.eq(2).html(b).attr("title",b)};CBoBo.View.Thumb.prototype.SetItemInfo=function(d,a,b){if(void 0===d)throw"SetItemInfo:mark is undefined.";"string"!==typeof d&&(d=d.toString());d=d.replace(/\./g,"");d=$("#"+d+" ."+this.arrId.seriesinfo);d.eq(0).html(a).attr("title",a);d.eq(1).html(b).attr("title",b)};CBoBo.View.Thumb.prototype.SetItemIcon=function(d,a,b){if(void 0===d)throw"SetItemIcon:mark is undefined.";"string"!==typeof d&&(d=d.toString());d=d.replace(/\./g,"");$("#"+d+" img").attr("src",a).attr("title",b)};CBoBo.View.Thumb.prototype.SetProgress=function(d,a){if(void 0===d)throw"SetProgress:progressMark is undefined.";"string"!==typeof d&&(d=d.toString());var b=d.replace(/\./g,"");0>a&&(a=0);if(99<a)$("#"+b+" ."+this.arrId.progressbar).hide();else{$("#"+b+" ."+this.arrId.progressbar).show();var c=$("."+this.arrId.progressparent).width()*a/100>>0;$("#"+b+" ."+this.arrId.progress).width(c);$("#"+b+" ."+this.arrId.progresspercent).html(a+"%")}};CBoBo.View.Thumb.prototype.SetHeadArrow=function(d){var a=$("#"+this.arrId.head+" ."+this.arrId.arrow);d?(a.css({color:"#1d1d1d"}),a.html("\x26#xe646;")):(a.css({color:"#c5c5c5"}),a.html("\x26#xe64a;"))};CBoBo.View.Thumb.prototype.PushSerisesItem=function(d){if(void 0===d)throw"PushSerisesItem:progressMark is undefined.";"string"!==typeof d&&(d=d.toString());d=d.replace(/\./g,"");this.seriesLen++;$("\x3cdiv class\x3d'"+this.arrId.seriesitem+"' id\x3d'"+d+"'\x3e\x3cspan class\x3d'"+this.arrId.seriesinfo+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.seriesinfo+" "+this.arrId.seriesinfoseries+"'\x3e\x3c/span\x3e\x3cdiv class\x3d'"+this.arrId.seriesimgbox+"' style\x3d'position:relative'\x3e\x3cimg class \x3d'"+this.arrId.seriesimg+"'/\x3e \x3cdiv class\x3d'"+this.arrId.progressbar+"'\x3e\x3cdiv class\x3d'"+this.arrId.progressparent+"'\x3e\x3cdiv class\x3d'"+this.arrId.progress+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d'"+this.arrId.progresspercent+"'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.listcontain))};CBoBo.View.Thumb.prototype.UpdateSeriesData=function(){var d=this,a=" ."+this.arrId.seriesimg;if(CBoBo.Plugin.GetBrowserInfo().isMobile)touch.on(a,"doubletap",function(a){void 0!=d.msgTransform&&d.msgTransform(a)});else $(a).bind("dblclick",function(a){void 0!=d.msgTransform&&d.msgTransform(a)});interact("."+this.arrId.seriesimg).draggable({onstart:function(a){$("#special2016920dragimg").remove();var c=$(a.target).clone();$("body").append(c);var b=c.width(),d=c.height();c.attr("id","special2016920dragimg").css({"z-index":"99999999999",position:"absolute",left:a.pageX-b/2+"px",top:a.pageY-d/2+"px"})},onmove:function(a){var c=$("#special2016920dragimg")[0],b=(parseFloat(c.getAttribute("data-x"))||0)+a.dx;a=(parseFloat(c.getAttribute("data-y"))||0)+a.dy;c.style.webkitTransform=c.style.transform="translate("+b+"px, "+a+"px)";c.setAttribute("data-x",b);c.setAttribute("data-y",a)},onend:function(a){$("#special2016920dragimg").remove()}})};CBoBo.View.Thumb.prototype.UpdateStyleL=function(){var d=$(this.parentElem),a=d.width(),b=d.height(),d=$("#"+this.arrId.thumbitem),c;c=this.bFirst?0:.0476*a>>0;d.width(a).css({overflow:"hidden","padding-top":c+"px","border-bottom":"1px solid #6a6a6a",background:"#282828"});d=$("#"+this.arrId.head);d.width(a);var e=.57*a>>0;d.height(e).css({cursor:"pointer"});var f=$("."+this.arrId.info),g=e/3>>0;f.height(g);f.width(a);d=.11*a>>0;f.css({"line-heihgt":g+"px",display:"block","text-overflow":"ellipsis","white-space":"nowrap","text-align":"center","font-size":d+"px"});$("."+this.arrId.time).width(.8*a>>0).css({display:"inline-block"});$("."+this.arrId.arrow).width(.2*a>>0).height(g).css({display:"inline-block","font-size":d+"px","line-height":g+"px","text-align":"center","pointer-events":"none"});var f=$("."+this.arrId.seriesitem),g=.08*a>>0,h=.06*a>>0;f.height(1.1*a>>0).width(a-h).css({"border-bottom":"1px solid #373737","padding-top":g+"px","padding-left":h+"px","padding-bottom":"2px"});b=b-e-c-5;c=$("#"+this.arrId.listbox);a-=4;c.width(a).css({border:"2px solid #cccccc",background:"#535353",height:b+"px",overflow:"hide",position:"relative"});$("#"+this.arrId.listcontain).css({position:"absolute",width:"100%",height:"100%"});$("#"+this.arrId.listcontain).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"thumbScroll",documentTouchScroll:!0,advanced:{updateOnContentResize:!0}});$("."+this.arrId.seriesinfo).css({display:"block",color:"#c5c5c5","text-overflow":"ellipsis","white-space":"nowrap","text-align":"left","font-size":d+"px",cursor:"default"});b=$("."+this.arrId.seriesimg);c=.723*a>>0;b.width(c).height(c).css({cursor:"pointer"});e=$("."+this.arrId.seriesimgbox);b=.8*a>>0;a=.04*a>>0;e.width(b).height(c).css({"text-align":"center",background:"#3a3a3a",margin:a+"px 0px"});a=$("."+this.arrId.progressbar);e=.1866*c>>0;a.width(b).height(e).css({position:"absolute",left:0,bottom:"2px",color:"#33ffff","text-align":"left"});c=$("."+this.arrId.progressparent);a=.66*e>>0;b=.6*b>>0;c.height(a).width(b).css({"border-bottom":"1px solid #757575","border-right":"1px solid #757575","border-radius":"4px",background:"#363535",display:"inline-block","margin-bottom":"3px"});b=$("."+this.arrId.progress);c=.66*a>>0;a=a-c>>1;b.height(c).css({margin:a+"px 1px",background:"#33ffff"});$("."+this.arrId.progresspercent).css({"font-size":d+"px","vertical-align":"top"})};CBoBo.View.Thumb.prototype.UpdateStyleB=function(){var d=$(this.parentElem);d.width();var d=d.height(),d=d-2,a=$("#"+this.arrId.thumbitem),b;b=this.bFirst?0:.0476*d>>0;a.height(d).css({overflow:"hidden","padding-left":b+"px","border-right":"1px solid #6a6a6a",background:"#282828",display:"inline-block"});b=$("#"+this.arrId.head);a=1.2*d>>0;b.width(a-4).height(d-4).css({cursor:"pointer",display:"inline-block",border:"2px solid rgba(0,0,0,0)","white-space":"pre"});b=$("."+this.arrId.info);var c=d/3>>0;b.width(a);b.height(c);a=.11*d>>0;10>a&&(a=10);b.css({"line-height":c+"px",display:"block","text-overflow":"ellipsis","text-align":"center","font-size":a+"px"});var e=$("."+this.arrId.seriesitem);b=1.1*d>>0;c=.08*d>>0;e.height(.9*d).width(b).css({"border-right":"1px solid #373737","padding-left":c+"px","padding-right":c+"px",display:"inline-block","text-align":"center","vertical-align":"top"});e=4<this.seriesLen?4:this.seriesLen;1>e&&(e=1);c=e*(b+2*c+1);e=$("#"+this.arrId.listbox);d-=4;this.thumbListWidth=c;e.width(c).height(d).css({border:"2px solid #cccccc",background:"#535353",overflow:"hidden",position:"relative",display:"inline-block"});$("#"+this.arrId.listcontain).css({position:"absolute",height:"100%",width:c+"px"});$("#"+this.arrId.listcontain).mCustomScrollbar({axis:"x",scrollInertia:800,theme:"thumbScroll",documentTouchScroll:!0,advanced:{updateOnContentResize:!0}});$("."+this.arrId.seriesinfo).height(Math.round(.3076923076923076*d)).css({color:"#c5c5c5","text-overflow":"ellipsis","white-space":"nowrap","text-align":"center","font-size":a+"px",cursor:"default",display:"block"});$("."+this.arrId.seriesinfoseries).css({display:"none"});c=$("."+this.arrId.seriesimgbox);e=.6296296296296297*d|0;b=.8*b|0;c.height(e).width(b).css({"text-align":"center",background:"#3a3a3a",margin:"0 auto"});$("."+this.arrId.seriesimg).width(b-8).height(e).css({cursor:"pointer"});b=$("."+this.arrId.progressbar);d=.3333333333333333*d>>0;18>d&&(d=18);b.height(d).css({width:"100%",position:"absolute",left:"0px",bottom:"1px",color:"#33ffff","text-align":"left"});b=$("."+this.arrId.progressparent);c=.3*d>>0;d=1.333333333333333*d>>0;b.height(c).width(d).css({"border-bottom":"1px solid #757575","border-right":"1px solid #757575","border-radius":"4px",background:"#363535",display:"inline-block"});$("."+this.arrId.progress).height(c).css({margin:"1px",background:"#33ffff"});$("."+this.arrId.progresspercent).css({"font-size":a+"px",width:"20px"})};CBoBo.View.Thumb.prototype.ClearStyle=function(){$("#"+this.arrId.thumbitem).removeAttr("style");$("#"+this.arrId.head).removeAttr("style");$("."+this.arrId.info).removeAttr("style");$("."+this.arrId.time).removeAttr("style");$("."+this.arrId.arrow).removeAttr("style");$("."+this.arrId.seriesitem).removeAttr("style");$("#"+this.arrId.listbox).removeAttr("style");$("#"+this.arrId.listcontain).removeAttr("style");$("#"+this.arrId.listcontain).mCustomScrollbar("destroy");$("."+this.arrId.seriesinfo).removeAttr("style");$("."+this.arrId.seriesimg).removeAttr("style")};CBoBo.View.Thumb.prototype.UpdateStyle=function(){var d=$(window).width(),a=$(window).height();this.ClearStyle();d>a?(this.UpdateStyleL(),this.bthumbDirect=!0):(this.UpdateStyleB(),this.bthumbDirect=!1);this.OpenStyle();this.ShowItem(!0)};CBoBo.View.Thumb.prototype.ShowItem=function(d){var a=$("#"+this.arrId.listbox);this.bItemShow?d?a.show():this.bthumbDirect?a.slideDown(500):(a.show().css({transition:"width 500ms"}),a.width(this.thumbListWidth)):d?a.hide():this.bthumbDirect?a.slideUp(500):(a.css({transition:"width 500ms"}),setTimeout(function(){a.hide()},400),a.width(0))};CBoBo.View.Thumb.prototype.OpenStyle=function(){var d=$("#"+this.arrId.head),a=$("."+this.arrId.info);this.bItemShow?(this.SetHeadArrow(!0),a.css({color:"#1d1d1d",transition:"all 0.5s ease-in"}),d.css({background:"#cccccc"})):(this.SetHeadArrow(!1),a.css({color:"#c5c5c5"}),d.css({background:"#373737"}))};CBoBo.View.Thumb.prototype.First=function(){this.bFirst=!0;$("#"+this.arrId.thumbitem).css({"padding-top":"0px"});this.bItemShow=!0;this.ShowItem(!0);this.OpenStyle()};CBoBo.View.Thumb.prototype.AnalysisParam=function(d){this.parentElem=d.parentelem;this.msgTransform=d.msgtransform};CBoBo.View.Thumb.prototype.AddEvent=function(){function d(a){void 0!=b.msgTransform&&(a.tag="head",a.studyuid=b.studyuid,b.msgTransform(a))}function a(a){void 0!=b.msgTransform&&(a.tag="head",a.studyuid=b.studyuid,a.parentid=b.arrId.head,b.msgTransform(a));a.stopPropagation()}var b=this;CBoBo.Plugin.GetBrowserInfo().isMobile?($("#"+b.arrId.head).bind("touchstart",d),$("."+this.arrId.info).bind("touchstart",a)):($("#"+b.arrId.head).bind("mousedown",d),$("."+this.arrId.info).bind("mousedown",a))};CBoBo.View.Thumb.prototype.Show=function(d){d?$("#"+this.arrId.thumbitem).show():$("#"+this.arrId.thumbitem).hide()};CBoBo.View.Thumb.prototype.Destroy=function(){$("#"+this.arrId.thumbitem).remove()};CBoBo.View.ThumbManager=function(d){var a=$.extend(!0,{parent:null,msgtransform:null},d),b={};this.ThumbMsg=function(c){function d(){var a=c.parentid||c.target.id;$.each(b,function(c,b){null!==b&&void 0!==b&&(b.bItemShow=b.arrId.head==a?!b.bItemShow:!1,b.ShowItem(),b.OpenStyle())})}switch(c.type){case "touchstart":d();break;case "mousedown":"head"==c.tag&&1===c.which&&d()}null!==a.msgtransform&&a.msgtransform(c)};this.OpenLastThumb=function(){var a=Object.keys(b).length-1,d=0;$.each(b,function(c,b){null!==b&&void 0!==b&&(b.bItemShow=d==a?!0:!1,b.ShowItem(),b.OpenStyle(),d++)})};this.AddThumb=function(c){var d=new CBoBo.View.Thumb({parentelem:a.parent,msgtransform:this.ThumbMsg});d.studyuid=c;return b[c]=d};this.GetThumb=function(a){return b[a]};this.ForEach=function(a){if(a instanceof Function)for(var c in b)a(b[c],c)};this.DeleteThumb=function(a){var c=b[a];void 0!==c&&(c.Destroy(),b[a]=null)}};CBoBo.View.DVCanvas=function(d){this.canvas;this.opt=$.extend({msgtransform:null,parent:null,bdrag:!1},d);this.boxId;this.canvasId;this.bFocus=!1;this.bAnimatStop=!0;this.arrCornerInfo={};this.cornerclass;this.Create();this.GetCanvas()};CBoBo.View.DVCanvas.prototype.Destroy=function(){this.imgProcessWorker&&this.imgProcessWorker.terminate();$("#"+this.boxId).remove()};CBoBo.View.DVCanvas.prototype.Clear=function(){var d=this.GetCanvas();void 0!=d&&d.getContext("2d").clearRect(0,0,d.width,d.height)};CBoBo.View.DVCanvas.prototype.Msg=function(d){d.self=this;this.opt.msgtransform&&this.opt.msgtransform(d)};CBoBo.View.DVCanvas.prototype.GetId=function(d){switch(d){case "box":return this.boxId;case "canvas":return this.canvasId}};CBoBo.View.DVCanvas.prototype.Float=function(d){d&&$("#"+this.boxId).css("float",d)};CBoBo.View.DVCanvas.prototype.GetCanvas=function(){void 0===this.canvas&&(this.canvas=document.getElementById(this.canvasId));return this.canvas};CBoBo.View.DVCanvas.prototype.Create=function(){null!=this.opt.parent&&(this.canvasId="c"+CBoBo.Plugin.GetRandom(),this.boxId="p"+CBoBo.Plugin.GetRandom(),this.cornerclass=CBoBo.Plugin.GetRandom(),$("\x3cdiv id\x3d'"+this.boxId+"'\x3e\x3ccanvas id\x3d'"+this.canvasId+"'\x3e\x3c/canvas\x3e\x3c/div\x3e").appendTo($(this.opt.parent)),$("#"+this.boxId).css({"float":"left",margin:"1px",border:"2px solid #595959"}),$("#"+this.canvasId).css({cursor:"default"}),this.AddEvent())};CBoBo.View.DVCanvas.prototype.SetRange=function(d,a){var b="#"+this.boxId;0==d||0==a?$(b).hide():($(b).show(),d>>=0,a>>=0,$("#"+this.boxId).width(d).height(a).css({position:"relative"}),b=this.GetCanvas(),b.width=d,b.height=a)};CBoBo.View.DVCanvas.prototype.AddEvent=function(d){var a=this;d=CBoBo.Plugin.GetBrowserInfo();var b="#"+this.canvasId;d.isMobile?($(b).bind("touchstart touchmove touchend",function(c){c.preventDefault();a.Msg(c)}),touch.on(b,"pinchstart pinch pinchend doubletap",function(c){"doubletap"==c.type&&(c.preventDefault(),c.stopPropagation());a.Msg(c)})):($(b).bind("dblclick click mousedown mousemove mouseup mouseout mousewheel",function(c){a.Msg(c)}),$(b).bind("touchstart touchmove touchend",function(c){a.Msg(c)}),touch.on(b,"pinchstart pinch pinchend",function(c){a.Msg(c)}));interact("#"+this.boxId).dropzone({ondragenter:function(a){$("#"+a.target.id+" canvas").css({"background-color":"rgba(255,255,255,0.1)"})},ondragleave:function(a){$("#"+a.target.id+" canvas").css({"background-color":""})},ondrop:function(c){var b=c.relatedTarget;$("#"+c.target.id+" canvas").css({"background-color":""});a.opt.msgtransform&&a.opt.msgtransform({type:"drag",imgId:b.title,canvas:a})}})};CBoBo.View.DVCanvas.prototype.StartLoadingAnimation=function(){if(this.bAnimatStop){var d=function(a,b,f,g){function c(e,g){if(!b[e]){if(!a[e]){var h="function"==typeof require&&require;if(!g&&h||h)return h(e,!0);h=Error("Cannot find module '"+e+"'");throw h.code="MODULE_NOT_FOUND",h;}h=b[e]={exports:{}};a[e][0].call(h.exports,function(b){var d=a[e][1][b];return c(d?d:b)},h,h.exports,d,a,b,f)}return b[e].exports}c(f);return c},a=this.GetCanvas();this.bAnimatStop=!1;var b=this;d({1:[function(a,b,d){var c=function(){function a(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){b&&a(c.prototype,b);d&&a(c,d);return c}}();Object.defineProperty(d,"__esModule",{value:!0});var e=(a=a("./objects/ParticleContainer"))&&a.__esModule?a:{"default":a};a=function(){function a(c,b,d){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.$canvas=c;this.context=this.$canvas.getContext("2d");this.height=this.width=0;this.params={};this.lastTime=this.tick=0;this.particleContainer=new e["default"](10,b,d);this.resize(b,d)}c(a,[{key:"resize",value:function(a,c){this.width=a;this.height=c;this.particleContainer.resize(a,c);this.$canvas.width=a*window.devicePixelRatio;this.$canvas.height=c*window.devicePixelRatio}},{key:"render",value:function(){var a=Date.now();this.tick+=(a-this.lastTime)/1E3;this.context.clearRect(0,0,this.width,this.height);this.particleContainer.update(this.context,this.tick);this.lastTime=a}}]);return a}();d["default"]=a},{"./objects/ParticleContainer":6}],2:[function(c,d,f){function e(){b.bAnimatStop||((0,h["default"])(e),k.render())}d=(d=c("./Scene"))&&d.__esModule?d:{"default":d};var h=(c=c("raf"))&&c.__esModule?c:{"default":c},k=new d["default"](a,a.width,a.height);window.addEventListener("resize",function(){b.bAnimatStop||k.resize(a.width,a.height)});e()},{"./Scene":1,raf:9}],3:[function(a,b,d){var c=function(){function a(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){b&&a(c.prototype,b);d&&a(c,d);return c}}();Object.defineProperty(d,"__esModule",{value:!0});var e=(a=a("./Vector2"))&&a.__esModule?a:{"default":a};a=function(){function a(){var c=0>=arguments.length||void 0===arguments[0]?0:arguments[0],b=1>=arguments.length||void 0===arguments[1]?0:arguments[1],d=2>=arguments.length||void 0===arguments[2]?5:arguments[2],f=3>=arguments.length||void 0===arguments[3]?"#000":arguments[3],g=4>=arguments.length||void 0===arguments[4]?0:arguments[4];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var h=5>=arguments.length||void 0===arguments[5]?1:arguments[5];this.position=new e["default"](c,b);this.velocity=new e["default"];this.acceleration=new e["default"];this.friction=h;this.gravity=g;this.scale=window.devicePixelRatio;this.radius=d;this.color=f}c(a,[{key:"accelerate",value:function(a,c){this.acceleration.x=a;this.acceleration.y=c}},{key:"update",value:function(){this.velocity.add(this.acceleration);this.velocity.multiply(this.friction);this.velocity.y+=this.gravity;this.position.add(this.velocity)}},{key:"draw",value:function(a){a.scale(window.devicePixelRatio,window.devicePixelRatio);a.fillStyle=this.color;a.beginPath();a.arc(this.position.x,this.position.y,this.radius*this.scale,0,2*Math.PI,!1);a.fill()}}]);return a}();d["default"]=a},{"./Vector2":4}],4:[function(a,b,d){var c=function(){function a(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){b&&a(c.prototype,b);d&&a(c,d);return c}}();Object.defineProperty(d,"__esModule",{value:!0});a=function(){function a(){var c=0>=arguments.length||void 0===arguments[0]?0:arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var b=1>=arguments.length||void 0===arguments[1]?0:arguments[1];this.x=c;this.y=b}c(a,[{key:"invert",value:function(){this.x=-this.x;this.y=-this.y}},{key:"add",value:function(a){this.x+=a.x;this.y+=a.y}},{key:"subtract",value:function(a){this.x-=a.x;this.y-=a.y}},{key:"multiply",value:function(a){this.x*=a;this.y*=a}},{key:"divide",value:function(a){this.x/=a;this.y/=a}},{key:"equals",value:function(a){return this.x===a.x&&this.y===a.y}},{key:"dot",value:function(a){return this.x*a.x+this.y*a.y}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y)}},{key:"distance",value:function(a){return Math.sqrt(this.distSq(a))}},{key:"normalize",value:function(){return this.divide(this.length())}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"clone",value:function(){return new Vector(this.x,this.y)}}]);return a}();d["default"]=a},{}],5:[function(a,b,d){function c(a,c,b){return(a-c)/(b-c)}function e(a,c,b){return(b-c)*a+c}Object.defineProperty(d,"__esModule",{value:!0});d.normalize=c;d.lerp=e;d.map=function(a,b,d,f,g){return e(c(a,b,d),f,g)};d.clamp=function(a,c,b){return Math.min(Math.max(a,Math.min(c,b)),Math.max(c,b))};d.distance=function(a,c,b,d){a=b-a;c=d-c;return Math.sqrt(a*a+c*c)};d.inRange=function(a,c,b){return a>=Math.min(c,b)&&a<=Math.max(c,b)};d.degreesToRads=function(a){return a/180*Math.PI};d.radsToDegrees=function(a){return 180*a/Math.PI};d.randomRange=function(a,c){return a+Math.random()*(c-a)}},{}],6:[function(a,b,d){var c=function(){function a(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){b&&a(c.prototype,b);d&&a(c,d);return c}}();Object.defineProperty(d,"__esModule",{value:!0});var e=(b=a("../lib/Particle"))&&b.__esModule?b:{"default":b},f=a("../lib/math");a=function(){function a(c,b,d){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.width=b;this.height=d;this.nbParticle=c;this.pool=[];this.angles=[];this.radius=Math.min(b,d)>>4;this.slice=0;this.sliceTo=2*Math.PI/this.nbParticle;this.speed=0;this.dir=1;this.populate()}c(a,[{key:"populate",value:function(){for(var a,c,b,d=0;d<this.nbParticle;d++){b=this.slice*d;a=.5*this.width+Math.cos(b)*this.radius;c=.5*this.height+Math.sin(b)*this.radius;var f=this.radius>>4;1>f&&(f=1);a=new e["default"](a,c,f);a.color="#848282";this.pool.push(a);this.angles.push(b)}}},{key:"resize",value:function(a,c){this.width=a;this.height=c}},{key:"update",value:function(a,c){var b=this;this.slice>=this.sliceTo-.001&&1===this.dir&&.5<c&&(this.dir=-1);.01>=this.slice&&-.01<=this.slice&&-1===this.dir&&(this.dir=1);this.slice=(0,f.lerp)(this.dir*Math.abs(Math.sin(.8*c)),0,this.sliceTo);this.pool.forEach(function(c,d){b.angles[d]=b.slice*d;c.position.x=.5*b.width+Math.cos(b.angles[d])*b.radius;c.position.y=.5*b.height+Math.sin(b.angles[d])*b.radius;c.update();c.draw(a)})}}]);return a}();d["default"]=a},{"../lib/Particle":3,"../lib/math":5}],7:[function(a,b,d){(function(a){(function(){var c,d,e;"undefined"!==typeof performance&&null!==performance&&performance.now?b.exports=function(){return performance.now()}:"undefined"!==typeof a&&null!==a&&a.hrtime?(b.exports=function(){return(c()-e)/1E6},d=a.hrtime,c=function(){var a;a=d();return 1E9*a[0]+a[1]},e=c()):Date.now?(b.exports=function(){return Date.now()-e},e=Date.now()):(b.exports=function(){return(new Date).getTime()-e},e=(new Date).getTime())}).call(this)}).call(this,a("_process"))},{_process:8}],8:[function(a,b,d){function c(){r=!1;p.length?m=p.concat(m):w=-1;m.length&&e()}function e(){if(!r){var a=setTimeout(c);r=!0;for(var b=m.length;b;){p=m;for(m=[];++w<b;)p&&p[w].run();w=-1;b=m.length}p=null;r=!1;clearTimeout(a)}}function f(a,c){this.fun=a;this.array=c}function l(){}a=b.exports={};var m=[],r=!1,p,w=-1;a.nextTick=function(a){var c=Array(arguments.length-1);if(1<arguments.length)for(var b=1;b<arguments.length;b++)c[b-1]=arguments[b];m.push(new f(a,c));1!==m.length||r||setTimeout(e,0)};f.prototype.run=function(){this.fun.apply(null,this.array)};a.title="browser";a.browser=!0;a.env={};a.argv=[];a.version="";a.versions={};a.on=l;a.addListener=l;a.once=l;a.off=l;a.removeListener=l;a.removeAllListeners=l;a.emit=l;a.binding=function(a){throw Error("process.binding is not supported");};a.cwd=function(){return"/"};a.chdir=function(a){throw Error("process.chdir is not supported");};a.umask=function(){return 0}},{}],9:[function(a,b,d){var c=a("performance-now"),e="undefined"===typeof window?{}:window;a=["moz","webkit"];var f=e.requestAnimationFrame,l=e.cancelAnimationFrame||e.cancelRequestAnimationFrame;for(d=0;d<a.length&&!f;d++)f=e[a[d]+"RequestAnimationFrame"],l=e[a[d]+"CancelAnimationFrame"]||e[a[d]+"CancelRequestAnimationFrame"];if(!f||!l)var m=0,r=0,p=[],w=1E3/60,f=function(a){if(0===p.length){var b=c(),d=Math.max(0,w-(b-m));m=d+b;setTimeout(function(){for(var a=p.slice(0),b=p.length=0;b<a.length;b++)if(!a[b].cancelled)try{a[b].callback(m)}catch(C){setTimeout(function(){throw C;},0)}},Math.round(d))}p.push({handle:++r,callback:a,cancelled:!1});return r},l=function(a){for(var b=0;b<p.length;b++)p[b].handle===a&&(p[b].cancelled=!0)};b.exports=function(a){return f.call(e,a)};b.exports.cancel=function(){l.apply(e,arguments)}},{"performance-now":7}],10:!1},{},2,a)}};CBoBo.View.DVCanvas.prototype.StopLoadingAnimation=function(){this.bAnimatStop=!0};CBoBo.View.DVCanvas.prototype.PushCornerInfo=function(d,a){this.arrCornerInfo[d]instanceof Array||(this.arrCornerInfo[d]=[]);this.arrCornerInfo[d].push(a)};CBoBo.View.DVCanvas.prototype.ClearCornerInfo=function(){this.arrCornerInfo={};$("."+this.cornerclass).remove()};CBoBo.View.DVCanvas.prototype.ShowCornerInfo=function(){var d=this.arrCornerInfo.rt,a=this.arrCornerInfo.rb,b=this.arrCornerInfo.lb;this.DrawBox(this.arrCornerInfo.lt,"lt",3,3);this.DrawBox(d,"rt",3,3);this.DrawBox(a,"rb",3,3);this.DrawBox(b,"lb",3,3)};CBoBo.View.DVCanvas.prototype.DrawBox=function(d,a,b,c){if(void 0!==d){var e=[];d instanceof Array?e=d:e.push(d);var f,g;d="left";switch(a){case "lt":f="left";g="top";break;case "rt":f="right";g="top";d="right";break;case "rb":f="right";g="bottom";d="right";break;case "lb":f="left",g="bottom"}a="\x3cdiv class\x3d'"+this.cornerclass+"' style\x3d'position:absolute;"+f+":"+b+"px;"+g+":"+c+"px;color:#FFF;text-align:"+d+";font-size:10px;text-shadow:1px 1px 1px #000;cursor:default;pointer-events:none;'\x3e";for(b=0;b<e.length;b++)str="\x3cp\x3e"+e[b]+"\x3c/p\x3e",a+=str;$(a+"\x3c/div\x3e").appendTo("#"+this.boxId)}};CBoBo.View.DVCanvas.prototype.DrawCornerInfo=function(d){this.ClearCornerInfo();if(!(150>this.canvas.width||150>this.canvas.height)&&d instanceof Object){var a=d.image,b=window.globalStudyInfo;b.patientid&&this.PushCornerInfo("lt","ID:"+b.patientid);b.name&&this.PushCornerInfo("lt","\u59d3\u540d:"+b.name);a.mod&&this.PushCornerInfo("lt","\u8bbe\u5907:"+a.mod);b.sex&&this.PushCornerInfo("lt","\u6027\u522b:"+b.sex);b.age&&this.PushCornerInfo("lt","\u5e74\u9f84:"+b.age);a.kv&&this.PushCornerInfo("lb","\u7535\u538b:"+a.kv);a.ma&&this.PushCornerInfo("lb","\u7535\u6d41:"+a.ma);a.sliceth&&this.PushCornerInfo("lb","\u5c42\u539a:"+a.sliceth);a.studt&&this.PushCornerInfo("rt","\u65e5\u671f:"+a.studt);a.acqtm&&this.PushCornerInfo("rt","\u65f6\u95f4:"+a.acqtm);this.PushCornerInfo("rt","\u5f71\u50cf\u53f7:"+a.stuid+"-"+a.serid+"-"+a.imgnum);this.PushCornerInfo("rb","\u500d\u6570:"+d.scale);this.PushCornerInfo("rb","\u7a97\u4f4d:"+d.wc);this.PushCornerInfo("rb","\u7a97\u5bbd:"+d.ww);a.inst&&this.PushCornerInfo("rb",b.hospname||a.inst);this.ShowCornerInfo()}};CBoBo.View.CMngFirstLayer=function(d){this.opt=$.extend(!0,{parent:null,scrollsize:CBoBo.Scrollsize,msgtransform:null,single:!0},d);this.arrTag={};this.arrCanvas=[];this.checkbox;this.nLayoutCol=this.nLayoutRow=0;this.bFocus=this.bMax=!1;this.scroll;this.imageNums;this.seriesIndex;this.annStatusMng=null;this.bBorderSpColor=!1;this.focusIndex=1;var a=this;!function(){a.CreateBox();a.opt.single?a.UpdateStyle():(a.checkbox=new CBoBo.View.CheckBox({parent:"#"+a.arrTag.box,title:"\u5e8f\u5217\u5bf9\u6bd4",msgtransform:function(b){null!==a.annStatusMng&&(a.annStatusMng.compare=b)}}),a.checkbox.Show(!1))}()};CBoBo.View.CMngFirstLayer.prototype.Clear=function(){this.UpdateLayout(0,1,1);null!=this.annStatusMng&&($.each(this.arrCanvas,function(d,a){a.Clear()}),this.annStatusMng=null)};CBoBo.View.CMngFirstLayer.prototype.AnnStatusMng=function(d){if(void 0===d)return this.annStatusMng;d=(this.annStatusMng=d)?d.compare:!1;this.checkbox&&this.checkbox.On_Off(d)};CBoBo.View.CMngFirstLayer.prototype.CreateBox=function(){if(null!=this.opt.parent){this.arrTag.box="box"+CBoBo.Plugin.GetRandom();this.arrTag.canvasbox="box"+CBoBo.Plugin.GetRandom();this.arrTag.container="box"+CBoBo.Plugin.GetRandom();this.arrTag.scroll="box"+CBoBo.Plugin.GetRandom();var d=$("\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.canvasbox+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrTag.scroll+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo(this.opt.parent);void 0!=d&&(this.opt.single?d.css({position:"relative",background:"#000"}):d.css({position:"relative",background:"#000","float":"left",border:"2px solid #595959",margin:"1px"}));$("#"+this.arrTag.canvasbox).css({position:"relative","float":"left"});$("#"+this.arrTag.container).css({position:"absolute",left:0,top:0,right:0,bottom:0,margin:"auto"});$("#"+this.arrTag.scroll).css({"float":"right",position:"relative","margin-bottom":"1px","margin-right":"1px","margin-top":"1px"});return d}};CBoBo.View.CMngFirstLayer.prototype.UpdateStyle=function(){var d=$(this.opt.parent);if(void 0!=d){var a=d.width(),d=d.height();$("#"+this.arrTag.box).width(a).height(d)}};CBoBo.View.CMngFirstLayer.prototype.TriggerResize=function(d){if(this.opt.single){this.UpdateStyle();var a=1;this.scroll&&(a=this.scroll.draggerPos);this.UpdateLayout(this.imageNums,this.nLayoutRow,this.nLayoutCol,a);this.opt.msgtransform&&d&&this.opt.msgtransform(d)}};CBoBo.View.CMngFirstLayer.prototype.AddEvent=function(){};CBoBo.View.CMngFirstLayer.prototype.SetBoxRange=function(d,a){var b=$("#"+this.arrTag.box);0==d||0==a?b.hide():(b.show(),a>>=0,b.width(d>>0).height(a))};CBoBo.View.CMngFirstLayer.prototype.ShowScroll=function(d){var a=$("#"+this.arrTag.scroll),b=$("#"+this.arrTag.container),c=$("#"+this.arrTag.box),e=$("#"+this.arrTag.canvasbox),f=c.width(),c=c.height();if(d){a.width(this.opt.scrollsize-1).height(c-2).show();var f=f-this.opt.scrollsize,g=this;void 0===this.scroll&&(this.scroll=new CBoBo.View.Scroll({parent:"#"+this.arrTag.scroll,msgtransform:function(a){a.firstmng=g;null!=g.opt.msgtransform&&g.opt.msgtransform(a)},size:g.opt.scrollsize}))}else a.hide(),this.scroll=void 0;f=Math.floor(f);c=Math.floor(c);b.width(f).height(c);e.width(f).height(c)};CBoBo.View.CMngFirstLayer.prototype.GetId=function(d){if(void 0!=d)return this.arrTag[d]};CBoBo.View.CMngFirstLayer.prototype.Focus=function(d){if("[object String]"==Object.prototype.toString.apply(d))for(var a=0;a<this.arrCanvas.length;a++){var b=this.arrCanvas[a],c=$("#"+b.boxId);b.GetId("canvas")==d?(b.bFocus=!0,this.focusIndex=a,c.css({"border-color":"#33ffff"})):(b.bFocus=!1,c.css({"border-color":"#595959"}))}else if("[object Number]"==Object.prototype.toString.apply(d)&&-1<d&&d<this.arrCanvas.length){var e;e=this.opt.single?"2px solid #33ffff":"2px dashed #FFFF00";for(a=0;a<this.arrCanvas.length;a++)b=this.arrCanvas[a],c=$("#"+b.boxId),a==d?(b.bFocus=!0,this.focusIndex=a,c.css({border:e})):(b.bFocus=!1,c.css({border:"2px solid #595959"}))}};CBoBo.View.CMngFirstLayer.prototype.MsgProxy=function(d){!this.opt.single||"mousedown"!=d.type&&"touchstart"!=d.type||this.bBorderSpColor||this.Focus(d.target.id);d.mng=this;null!=this.opt.msgtransform&&this.opt.msgtransform(d)};CBoBo.View.CMngFirstLayer.prototype.AddCanvas=function(){var d=this,a=new CBoBo.View.DVCanvas({parent:"#"+this.arrTag.container,msgtransform:function(a){d.MsgProxy(a)},bdrag:this.opt.single});this.arrCanvas.push(a)};CBoBo.View.CMngFirstLayer.prototype.DeleteCanvas=function(d){if(!(void 0==d||d>this.arrCanvas.length))for(var a=this.arrCanvas.length-1;a>=d;a--)$("#"+this.arrCanvas[a].boxId).remove(),this.arrCanvas.pop()};CBoBo.View.CMngFirstLayer.prototype.SetLayout=function(d,a){var b=$("#"+this.arrTag.container),c=b.width(),b=b.height(),c=Math.floor((c-6*a)/a),b=Math.floor((b-6*d)/d),e=d*a,f=this.arrCanvas.length;if(f<e)for(;f<e;f++)this.AddCanvas();else f>e&&this.DeleteCanvas(e);$.each(this.arrCanvas,function(a,b){b.Float("left")});for(f=0;f<this.arrCanvas.length;f++){var g=this.arrCanvas[f];f<e?g.SetRange(c,b):g.SetRange(0,0)}this.nLayoutRow=d;this.nLayoutCol=a};CBoBo.View.CMngFirstLayer.prototype.GetFocusCanvas=function(){for(var d=0;d<this.arrCanvas.length;d++){var a=this.arrCanvas[d];if(a.bFocus)return a}};CBoBo.View.CMngFirstLayer.prototype.GetCanvasIndex=function(d){if(void 0==d)for(var a=0;a<this.arrCanvas.length;a++){var b=this.arrCanvas[a];if(b.bFocus)return a}else for(a=0;a<this.arrCanvas.length;a++)if(b=this.arrCanvas[a],b.GetId("canvas")==d)return a};CBoBo.View.CMngFirstLayer.prototype.GetAllCanvas=function(){return this.arrCanvas};CBoBo.View.CMngFirstLayer.prototype.GetLayoutCanvas=function(){var d=this.nLayoutRow*this.nLayoutCol,d=d>this.arrCanvas.length?this.arrCanvas.length:d;return this.arrCanvas.slice(0,d)};CBoBo.View.CMngFirstLayer.prototype.GetCanvasById=function(d){for(var a=0;a<this.arrCanvas.length;a++){var b=this.arrCanvas[a];if(b.GetId("canvas")==d)return b}};CBoBo.View.CMngFirstLayer.prototype.GetCanvas=function(d){return d<this.arrCanvas.length&&-1<d?this.arrCanvas.slice(0,d):this.arrCanvas};CBoBo.View.CMngFirstLayer.prototype.UpdateLayout=function(d,a,b,c){if(void 0!=d){if(void 0==a||void 0==b)a=0<this.nLayoutRow?this.nLayoutRow:1,b=0<this.nLayoutCol?this.nLayoutCol:1;this.imageNums=d;d>a*b?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(d/(a*b)),c)):this.ShowScroll(!1);this.SetLayout(a,b)}};CBoBo.View.CMngFirstLayer.prototype.UpdateLayoutSp3=function(d,a,b){void 0!==d&&(this.imageNums=d,3<d?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(d/3),b)):this.ShowScroll(!1),this.LayoutSp3(a))};CBoBo.View.CMngFirstLayer.prototype.LayoutSp3=function(d){var a=$("#"+this.arrTag.container);a.width();var b=a.width()-1,c=a.height()-1,a=b-6,e=c-6,b=b-12>>1,c=c-12>>1,f=this.arrCanvas.length;if(3>f)for(;3>f;f++)this.AddCanvas();else 3<f&&this.DeleteCanvas(3);var g="left";"right"===d&&(g="right");$.each(this.arrCanvas,function(a,b){b.Float(g)});switch(d){case "left":this.arrCanvas[0].SetRange(b,e);this.arrCanvas[1].SetRange(b,c);this.arrCanvas[2].SetRange(b,c);break;case "top":this.arrCanvas[0].SetRange(a,c);this.arrCanvas[1].SetRange(b,c);this.arrCanvas[2].SetRange(b,c);break;case "right":this.arrCanvas[0].SetRange(b,e);this.arrCanvas[1].SetRange(b,c);this.arrCanvas[2].SetRange(b,c);break;case "bottom":this.arrCanvas[0].SetRange(b,c),this.arrCanvas[1].SetRange(b,c),this.arrCanvas[2].SetRange(a,c)}};CBoBo.View.CMngFirstLayer.prototype.SetDefaultFocus=function(d){isNaN(d)||(d=d>this.arrCanvas.length-1?this.arrCanvas.length-1:d,this.Focus(this.arrCanvas[0>d?0:d].canvasId))};CBoBo.View.CMngFirstLayer.prototype.GetLayout=function(){return{row:this.nLayoutRow,col:this.nLayoutCol}};CBoBo.View.CMngFirstLayer.prototype.SeriesIndex=function(d){if(void 0==d)return this.seriesIndex;this.seriesIndex=d;return this};CBoBo.View.CMngFirstLayer.prototype.GetBoundary=function(){var d={},a=$("#"+this.arrTag.box),b=a.offset();d.left=b.left;d.top=b.top;d.width=a.width();d.height=a.height();return d};CBoBo.View.CMngFirstLayer.prototype.SetSpBoundaryColor=function(d,a){this.bBorderSpColor=!0;var b=this.arrCanvas[d];void 0!=b&&$("#"+b.boxId).css({"border-color":a})};CBoBo.View.CMngFirstLayer.prototype.EnableScroll=function(d){this.scroll||this.ShowScroll(!0);this.scroll.Enable(d)};CBoBo.View.CMngFirstLayer.prototype.SetCanavsBoxBoundary=function(d,a){if(!isNaN(d)&&!isNaN(a)){var b=$("#"+this.arrTag.container),c=$("#"+this.arrTag.box),e=c.width(),f=c.height();this.scroll&&(e-=this.opt.scrollsize);c=d/a;e/f>c?e=f*c:f=e/c;b.width(e).height(f)}};CBoBo.View.CMngFirstLayer.prototype.SetCanvasMsgPro=function(d){$.each(this.arrCanvas,function(){this.SetMsgPro(d)})};CBoBo.View.CMngFirstLayer.prototype.Destroy=function(){$("#"+this.arrTag.box).remove()};CBoBo.View.CMngFirstLayer.prototype.GetEventImageIndex=function(d){var a=this.scroll?this.scroll.draggerPos:1,b=this.nLayoutRow,c=this.nLayoutCol;if(1>b||1>c)c=b=1;for(var e=0,f=0;f<this.arrCanvas.length;f++)if(this.arrCanvas[f]===d){e=f;break}return(a-1)*b*c+e};CBoBo.View.CMngSecondLayer=function(d){var a=this,b=$.extend(!0,{parent:null,scrollsize:CBoBo.Scrollsize},d);this.arrTag={};this.arrFirstLayer=[];this.nLayoutCol=this.nLayoutRow=0;this.scroll;this.bMax=!1;this.imageNums;this.focusIndex=1;this.CreateBox=function(){if(null!=b.parent){this.arrTag.box="box"+CBoBo.Plugin.GetRandom();this.arrTag.container="container"+CBoBo.Plugin.GetRandom();this.arrTag.scroll="scroll"+CBoBo.Plugin.GetRandom();var a=$(!0!==b.aiRead?"\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrTag.scroll+"'\x3e\x3c/div\x3e\x3c/div\x3e":"\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo(b.parent);void 0!=a&&a.css({position:"relative",background:"#000"});$("#"+this.arrTag.container).css({display:"inline-block"});$("#"+this.arrTag.scroll).css({display:"inline-block",position:"relative","margin-bottom":"1px","margin-top":"1px","margin-right":"1px"});return a}};this.UpdateStyle=function(){var a=$(b.parent);if(void 0!=a){var d=a.width(),a=a.height();$("#"+this.arrTag.box).width(d).height(a)}};this.TriggerResize=function(c){a.UpdateStyle();var d=a.scroll?a.scroll.draggerPos:1;a.UpdateLayout(a.imageNums,a.nLayoutRow,a.nLayoutCol,d);a.arrFirstLayer.forEach(function(a){d=a.scroll?a.scroll.draggerPos:1;a.UpdateLayout(a.imageNums,a.nLayoutRow,a.nLayoutCol,d)});b.msgtransform&&c&&b.msgtransform(c)};this.AddEvent=function(){};this.ShowScroll=function(c){var d=$("#"+this.arrTag.scroll),f=$("#"+this.arrTag.container),g=$("#"+this.arrTag.box);c?(d.width(b.scrollsize-1).height(g.height()-2).show(),f.width(g.width()-b.scrollsize),void 0==this.scroll&&(this.scroll=new CBoBo.View.Scroll({parent:"#"+this.arrTag.scroll,msgtransform:function(c){c.secondmng=a;b.msgtransform(c)},size:b.scrollsize}))):(d.hide(),this.scroll=void 0,f.width(g.width()));f.height(g.height())};this.Focus=function(b){var c=!1;$.each(this.arrFirstLayer,function(d,e){$.each(e.arrCanvas,function(a,d){var f=$("#"+d.boxId);d.GetId("canvas")==b?(d.bFocus=!0,e.focusIndex=a,f.css({border:"2px dashed #FFFF00"}),c=!0):(d.bFocus=!1,f.css({border:"2px solid #595959"}))});var f=$("#"+e.GetId("box"));c?(f.css({"border-color":"#33ffff"}),a.focusIndex=d,e.bFocus=!0,c=!1):(f.css({"border-color":"#595959"}),e.bFocus=!1)})};this.MsgProxy=function(a){"mousedown"!=a.type&&"touchstart"!=a.type||this.Focus(a.target.id);b.msgtransform&&b.msgtransform(a)};this.AddFirstMng=function(){var a=this;this.arrFirstLayer.push(new CBoBo.View.CMngFirstLayer({parent:"#"+this.arrTag.container,scrollsize:b.scrollsize,msgtransform:function(b){a.MsgProxy(b)},single:!1}))};this.SetLayout=function(a,b){var c=$("#"+this.arrTag.container),d=c.width(),c=c.height(),d=(d-6*b)/b,c=(c-6*a)/a,e=a*b,k=this.arrFirstLayer.length;if(k<e)for(;k<e;k++)this.AddFirstMng();for(k=0;k<this.arrFirstLayer.length;k++){var l=this.arrFirstLayer[k];k<e?l.SetBoxRange(d,c):l.SetBoxRange(0,0)}this.nLayoutRow=a;this.nLayoutCol=b;sessionStorage.setItem("layout",a+","+b)};this.GetLayout=function(){return{row:this.nLayoutRow,col:this.nLayoutCol}};this.GetActiveMng=function(){var a=[];$.each(this.arrFirstLayer,function(b,c){(c.bFocus||c.checkbox.bState)&&a.push(c)});return a};this.GetFocusMng=function(){for(var a=0;a<this.arrFirstLayer.length;a++)for(var b=this.arrFirstLayer[a],d=0;d<b.arrCanvas.length;d++)if(b.arrCanvas[d].bFocus)return b};this.GetFocusCanvas=function(){for(var a=0;a<this.arrFirstLayer.length;a++)for(var b=this.arrFirstLayer[a],d=0;d<b.arrCanvas.length;d++){var g=b.arrCanvas[d];if(g.bFocus)return g}};this.GetMng=function(a){if(void 0==a)return this.arrFirstLayer;if("[object Object]"==Object.prototype.toString.apply(a))for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];if(c.scroll==a)return c}else{if("[object Number]"==Object.prototype.toString.apply(a))return a=a>this.arrFirstLayer.length-1?this.arrFirstLayer.length-1:a,this.arrFirstLayer[0>a?0:a];if("[object String]"==Object.prototype.toString.apply(a))for(b=0;b<this.arrFirstLayer.length;b++)if(c=this.arrFirstLayer[b],c.GetId("box")==a)return c}};this.GetMngByCanvas=function(a){a=a.GetId("canvas");for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];if(c.GetCanvasById(a))return c}};this.GetAllCanvas=function(){var a=[];$.each(this.arrFirstLayer,function(b,c){a=a.concat(c.arrCanvas)});return a};this.GetCanvasById=function(a){for(var b=0;b<this.arrFirstLayer.length;b++)for(var c=this.arrFirstLayer[b].GetAllCanvas(),d=0;d<c.length;d++){var h=c[d];if(h.GetId("canvas")==a)return h}};this.GetSeriesCanvasById=function(a){for(var b={},c=0;c<this.arrFirstLayer.length;c++)for(var d=this.arrFirstLayer[c].GetAllCanvas(),h=0;h<d.length;h++)if(d[h].GetId("canvas")==a)return b.arrcanvas=d,b.mng=this.arrFirstLayer[c],b};this.UpdateLayout=function(a,b,d,g){if(void 0!=a){if(void 0==b||void 0==d)b=0<this.nLayoutRow?this.nLayoutRow:1,d=0<this.nLayoutCol?this.nLayoutCol:1;this.imageNums=a;a>b*d?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(a/(b*d)),g)):this.ShowScroll(!1);CBoBo.IsTablet&&this.ShowScroll(!1);this.SetLayout(b,d)}};this.SetDefaultFocus=function(a,b){if(!isNaN(a)){a=a>this.arrFirstLayer.length-1?this.arrFirstLayer.length-1:a;var c=this.arrFirstLayer[0>a?0:a].GetAllCanvas();1>c.length||this.Focus(c[b].GetId("canvas"))}};this.GetLayoutCanvas=function(a){if(void 0===a)return this.GetFocusMng().GetLayoutCanvas()};this.GetLayoutMng=function(a){a=this.nLayoutRow*this.nLayoutCol;a=a>this.arrFirstLayer.length?this.arrFirstLayer.length:a;return this.arrFirstLayer.slice(0,a)};this.GetMngIndex=function(a){if(void 0===a)for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];for(a=0;a<c.arrCanvas.length;a++)if(c.arrCanvas[a].bFocus)return b}else for(b=0;b<this.arrFirstLayer.length;b++)if(c=this.arrFirstLayer[b],c.GetId("box")==a)return b};this.EachMng=function(a){a instanceof Function&&$.each(this.arrFirstLayer,function(b,c){a(c,b)})};this.Destroy=function(){$("#"+this.arrTag.box).remove()};a.CreateBox();a.UpdateStyle();a.ShowScroll(!0);!0};CBoBo.View.CheckBox=function(d){var a=this,b=$.extend(!0,{parent:null,title:"",msgtransform:null},d);this.ctrlId;this.bShow=this.bState=!1;this.dragId;var c=20,e=40;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.dragId=CBoBo.Plugin.GetRandom();var a="\x3cdiv class\x3d'seriCompareBar' id\x3d'"+this.ctrlId+"' title\x3d'"+b.title+"'\x3e\x3cdiv class\x3d'seriCompareSlide'\x3e\x3cinput type\x3d'checkbox' value\x3d'none' name\x3d'checkbox' id\x3d'"+this.dragId+"' /\x3e\x3clabel for\x3d'"+this.dragId+"'\x3e\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e";CBoBo.IsTablet&&(a="\x3cdiv class\x3d'seriCompareBar' id\x3d'"+this.ctrlId+"' title\x3d'"+b.title+"'\x3e\x3cdiv class\x3d'seriCompareSlideSP'\x3e\x3cinput type\x3d'checkbox' value\x3d'none' name\x3d'checkbox' id\x3d'"+this.dragId+"' /\x3e\x3clabel for\x3d'"+this.dragId+"'\x3e\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e");$(a).appendTo($(b.parent));$("#"+this.ctrlId).css({position:"absolute"});$("#"+this.ctrlId).css({position:"absolute"})};this.SetPositon=function(b,d){c=b;e=d;a.UpdateStyle()};this.Show=function(b){b?(this.bShow=!0,$("#"+this.ctrlId).show()):(this.bShow=!1,a.On_Off(!1),$("#"+this.ctrlId).hide())};this.On_Off=function(b){b?(a.bState=!0,$("#"+this.dragId).prop("checked",!0).next().css({left:"33px"})):(a.bState=!1,$("#"+this.dragId).prop("checked",!1).next().css({left:"2px"}))};this.AddEvent=function(){$("#"+this.dragId).bind("click",function(c){c=$(this);a.bState=c.is(":checked");a.bState?c.next().css({left:"33px"}):c.next().css({left:"2px"});null!==b.msgtransform&&b.msgtransform(a.bState)});$(window).bind("resize",function(b){a.UpdateStyle()})};this.UpdateStyle=function(){$("#"+this.ctrlId).css({right:c+"px",top:e+"px"})};a.Create();a.UpdateStyle();a.AddEvent();!0};CBoBo.View.DVPrint=function(d){function a(a,b,c){this.type=a||"";this.row=b||1;this.col=c||2}function b(a){var b=$(v.printSetting);switch(a.type){case "mouseenter":b.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":b.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":f.bShowPrintSetBox||(f.bShowPrintSetBox=!0,$("#"+h.settingBox).show(!0))}}function c(a){var b=localStorage.getItem("localPrint"),c={},d=$("#iptInputPrintName").val(),e=$("#iptInputPrintTitle").val(),g=$("#iptInputPrintAddress").val().trim(),q=$("#iptInputPrintPort").val();if(!d||""==d)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684\u540d\u79f0"),!1;if(!e||""==e)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684AETitle"),!1;if(!g||""==g)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684IP\u5730\u5740"),!1;if(!/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/.test(g))return layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740"),!1;if(q&&""!=q)isNaN(q)&&layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7aef\u53e3\u53f7");else return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684\u7aef\u53e3\u53f7"),!1;f.isAddPrint&&(c.id="print"+Date.parse(new Date));c.printName=d;c.printTitle=e;c.printAddress=g;c.printPort=q;if(b)if(b=JSON.parse(b),f.isAddPrint)b.print.push(c),b.defaultId&&""!=b.defaultId||(b.defaultId=c.id);else{for(var c=b.print,k=0;k<c.length;k++)c[k].id==a&&(c[k].printName=d,c[k].printTitle=e,c[k].printAddress=g,c[k].printPort=q);b.print=c}else a=[],b={},a.push(c),b.defaultId=c.id,b.print=a;localStorage.setItem("localPrint",JSON.stringify(b));f.closePrintBox("bShowPrintAddBox",h.settingAddBox);f.readLocalPrint();f.LoadPrintToSelelct(v.printer,"pointer")}function e(b){var c=$(v.cancelPrint);switch(b.type){case "mouseenter":c.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":c.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":f.Show(!1),c=$("#"+h.ctrl+" canvas").attr("imgID"),$.ajax({type:"post",url:A+"/CancelPrint?filmuid\x3d"+c,dataType:"json",processData:!1,contentType:!1,complete:function(c){200==c.status?(b.preventDefault(),f.Show(!1),null!=g.msgtransform&&g.msgtransform({type:"btnfocus",btntitle:"\u534f\u540c\u8bca\u65ad",btnforce:!1}),n&&n.bUpload||(l=[],m=[],r=1,p=new a,m.push(p),k.SetLayout(1,1),q(),E(),F())):$.Msg("\u6253\u5370\u53d6\u6d88\u5931\u8d25\u3002",CBoBo.MSG_ERROR)}})}}var f=this,g=$.extend(!0,{msgtransform:null,mode:1},d),h={},k,l=[],m=[],r=1,p=new a,w,v={},x,z=[],n,A=$("#hdurl").val();this.bShow;this.bShowPrintAddBox=this.bShowPrintSetBox=!1;this.isAddPrint=!0;this.closePrintBox=function(a,b){"bShowPrintSetBox"===a?this.bShowPrintSetBox=!1:this.bShowPrintAddBox=!1;$("#"+b).hide()};this.showPrintBox=function(a,b){"bShowPrintSetBox"===a?this.bShowPrintSetBox=!0:this.bShowPrintAddBox=!0;$("#"+b).show()};this.readLocalPrint=function(){var a=localStorage.getItem("localPrint");if(a){var a=JSON.parse(a),b=a.print;if(0<b.length){for(var c="",d=0;d<b.length;d++)c=b[d].id===a.defaultId?c+("\x3ctr class\x3d'current' id\x3d'"+b[d].id+"'\x3e"):c+("\x3ctr id\x3d'"+b[d].id+"'\x3e"),c+="\x3ctd width\x3d'35%'\x3e"+b[d].printName+"\x3c/td\x3e\x3ctd width\x3d'25%'\x3e"+b[d].printTitle+"\x3c/td\x3e\x3ctd width\x3d'25%'\x3e"+b[d].printAddress+"\x3c/td\x3e\x3ctd width\x3d'15%'\x3e"+b[d].printPort+"\x3c/td\x3e\x3c/tr\x3e";$("#"+h.tableContent).html(c);$("#"+h.tableContent+" tr").on("click",function(a){$("#"+h.tableContent+" tr").removeClass("current");$(this).addClass("current")})}else $("#"+h.tableContent).html("")}};this.PrintSearchByPrintId=function(a){var b=localStorage.getItem("localPrint"),c=null;if(b&&(b=JSON.parse(b),(b=b.print)&&0<b.length))for(var d=0;d<b.length;d++)a==b[d].id&&(c=b[d]);return c};this.LoadPrintToSelelct=function(a,b){if("pointer"==b){var c=localStorage.getItem("localPrint");if(c){var c=JSON.parse(c),d=c.print,c=c.defaultId;if(d&&0<d.length){for(var e="",f=0;f<d.length;f++)e+="\x3coption value\x3d'"+d[f].id+"'\x3e"+d[f].printName+"\x3c/option\x3e";$(a).html(e);$(a).val(c).removeAttr("disabled")}else $(a).html("").attr("disabled","disabled")}}};this.ModifyLocalPrint=function(a){var b=localStorage.getItem("localPrint"),b=JSON.parse(b);if((b=b.print)&&0<b.length)for(var c=0;c<b.length;c++)b[c].id==a&&($("#iptInputPrintName").val(b[c].printName),$("#iptInputPrintTitle").val(b[c].printTitle),$("#iptInputPrintAddress").val(b[c].printAddress),$("#iptInputPrintPort").val(b[c].printPort));f.showPrintBox("bShowPrintAddBox",h.settingAddBox)};var C=function(){var a=y();$.ajax({type:"post",dataType:"json",url:A+"/CreatDicomFilm",data:JSON.stringify(a),complete:function(a){if(200==a.status)if(a.responseJSON.success){var b=$("#"+h.leftBox),c=new Image;c.src=a.responseJSON.data.Url+"\x26width\x3d"+b.width()+"\x26height\x3d"+b.height()+"\x26r\x3d"+Math.random();c.onload=function(){var b=$("#"+h.ctrl+" canvas")[0];b.getContext("2d").clearRect(0,0,b.width,b.height);$(b).attr("imgID",a.responseJSON.data.UID);b.getContext("2d").drawImage(c,0,0,c.width,c.height)}}else $.Msg("\u6253\u5370\u80f6\u7247\u52a0\u8f7d\u5931\u8d25\u3002",CBoBo.MSG_ERROR);else $.Msg("\u6253\u5370\u80f6\u7247\u52a0\u8f7d\u5931\u8d25\u3002",CBoBo.MSG_ERROR)}})},y=function(){var a=this.CBoBo.AnnStatusManager.Get(),b,c,d=sessionStorage.getItem("layout");void 0==d?(b=3,c=2):(b=d.split(",")[1],c=d.split(",")[0]);d=new CBoBo.View.DVPrintInfo;d.ImageDisplayFormat="STANDARD\\"+b+","+c;for(b=0;b<a.length;b++){c=new CBoBo.View.DVPrintImageInfo;c.WindowLevel=a[b].viewport.wc;c.WindowWidth=a[b].viewport.ww;c.ID=a[b].viewport.image.id;c.TopLabel=a[b].viewport.image.ort;c.DownLabel=a[b].viewport.image.orb;c.LeftLabel=a[b].viewport.image.orl;c.RightLabel=a[b].viewport.image.orr;var e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("ID:"+a[b].viewport.image.accnum);e.Describe.push("\u59d3\u540d:"+a[b].viewport.image.name);e.Describe.push("\u8bbe\u5907:"+a[b].viewport.image.mod);e.Describe.push("\u6027\u522b:"+a[b].viewport.image.sex);c.TopLeftLabels=e;e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("\u65e5\u671f:"+a[b].viewport.image.studt);e.Describe.push("\u65f6\u95f4:"+a[b].viewport.image.acqtm);e.Describe.push("\u5f71\u50cf\u53f7:"+a[b].viewport.image.serid+"-"+a[b].viewport.image.stuid+"-"+a[b].viewport.image.imgnum);c.TopRightLabels=e;e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("\u500d\u6570:"+a[b].viewport.scale);e.Describe.push("\u7a97\u4f4d:"+a[b].viewport.wc);e.Describe.push("\u7a97\u5bbd:"+a[b].viewport.ww);e.Describe.push("\u533b\u9662\u540d:"+a[b].viewport.image.manu);c.DownRightLabels=e;e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("\u7535\u538b:"+a[b].viewport.image.kv);e.Describe.push("\u5c42\u539a:"+a[b].viewport.image.sliceth);c.DownLeftLabels=e;d.DicomInfos.push(c)}d.Orientation=$(v.direct).val();d.FilmSizeID=$(v.size).val();return d},H=function(){function a(a){for(var b=0;b<z.length;b++){var c=z[b];if(c.name==a)return c.printer}}var b=v.printer;$(b).empty();var c=u().hospital;c&&(c=a(c))&&$.each(c,function(){L(b,this.name,this.uid)})},F=function(){var a=$("."+h.controlItem),b=a.eq(0),c=a.eq(1),d=a.eq(2),a=a.eq(3),e=m.length;2>e?(b.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"}),d.css({"pointer-events":"none",color:"gray"}),a.css({"pointer-events":"none",color:"gray"})):2>r?(b.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"}),d.css({"pointer-events":"auto",color:"#000"}),a.css({"pointer-events":"auto",color:"#000"})):r>e-1?(b.css({"pointer-events":"auto",color:"#000"}),c.css({"pointer-events":"auto",color:"#000"}),d.css({"pointer-events":"none",color:"gray"}),a.css({"pointer-events":"none",color:"gray"})):(b.css({"pointer-events":"auto",color:"#000"}),c.css({"pointer-events":"auto",color:"#000"}),d.css({"pointer-events":"auto",color:"#000"}),a.css({"pointer-events":"auto",color:"#000"}))},I=function(a){if(a){var b=!1;a.type==p.type&&a.row==p.row&&a.col==p.col&&(b=!0);p.type=a.type;p.row=a.row;p.col=a.col;return b}},M=function(a){function b(){var a=k.GetFocusCanvas();var b=a.AnnStatus().status,c=a.AnnStatus();null!=c&&void 0!=b&&(b.Restore(),b.FitCanvas(a).DrawImg(a),c=c.ann,c.DeleteAllAnn(),c.DrawAllAnn(a,b))}function c(){var a=k.GetFocusCanvas(),b=a.AnnStatus().status;void 0!=b&&(b.SetNegative(!b.GetNegative()),b.DrawImg(a))}function d(a){var b=k.GetFocusCanvas();if(b){var c=b.AnnStatus();if(c&&(c=c.status,void 0!=c)){switch(a){case "\u9006\u65f6\u9488":c.SetRotate(270);break;case "\u987a\u65f6\u9488":c.SetRotate(90);break;case "\u5de6\u53f3\u955c\u50cf":c.FlipImage();break;case "\u4e0a\u4e0b\u955c\u50cf":c.InvertImage()}if(null!=b||void 0!=b)c.DrawImg(b),b.AnnStatus().ann.DrawAllAnn(b,c)}}}function e(){var a=k.GetFocusCanvas(),b=a.AnnStatus();if(void 0!=a&&null!=b){for(a=0;a<l.length;a++)if(b==l[a]){l.splice(a,1);break}t();E();q();B(!0);F()}}switch(a.usermsg||a.target.title){case "\u6062\u590d":b();break;case "\u65cb\u8f6c":void 0==manager.rotateCtrl&&(manager.rotateCtrl=new CBoBo.View.RotateCtrl({msgtransform:M}));manager.rotateCtrl.bShow?manager.rotateCtrl.Show(!1):(manager.rotateCtrl.SetPosition(a.clientX,a.clientY),manager.rotateCtrl.Show(!0));break;case "\u8d1f\u50cf":c();break;case "\u76f4\u7ebf":x.toolType=CBoBo.TOOL_M_LINE;break;case "\u77e9\u5f62":x.toolType=CBoBo.TOOL_M_RECT;break;case "\u692d\u5706":x.toolType=CBoBo.TOOL_M_ELLIPSE;break;case "\u89d2\u5ea6":x.toolType=CBoBo.TOOL_M_ANGLE;break;case "CT":x.toolType=CBoBo.TOOL_M_POINT;break;case "\u6587\u672c":x.toolType=CBoBo.TOOL_LABEL;void 0==manager.lableCtrl&&(manager.lableCtrl=new CBoBo.View.LableCtrl,manager.lableCtrl.Show(!1));break;case "\u7bad\u5934":x.toolType=CBoBo.TOOL_ARROW;break;case "\u5de6\u6807\u8bb0":x.toolType=CBoBo.TOOL_LEFT;break;case "\u53f3\u6807\u8bb0":x.toolType=CBoBo.TOOL_RIGHT;break;case "\u64a4\u9500":var f=k.GetFocusCanvas();if(void 0==f)break;var g=f.AnnStatus().status,h=f.AnnStatus().ann;if(void 0==g)break;g.DrawImg(f);h.PopAnn(f,g);h.DrawAllAnn(f,g);break;case "\u9006\u65f6\u9488":case "\u987a\u65f6\u9488":case "\u5de6\u53f3\u955c\u50cf":case "\u4e0a\u4e0b\u955c\u50cf":d(a.target.title);break;case "\u5220\u9664\u56fe\u50cf":e();break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":x.bShowCornerInfo=!x.bShowCornerInfo,a.btntitle="\u663e/\u9690\u56db\u89d2\u4fe1\u606f",a.btnforce=x.bShowCornerInfo,$.each(l,function(a,b){b.status.SetDrawTextFlag(x.bShowCornerInfo)}),B()}!1===x.ChangeBtnStatus(a.btntitle,a.btnforce)&&(x.toolType=CBoBo.TOOL_NULL,x.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))},K=function(c){function d(b){var c=$("#"+b.target.id);switch(b.type){case "mouseenter":c.css({color:"#CCCCC4"});break;case "mouseout":c.css({color:"#888"});break;case "click":c=new a("",-1,-1);switch(b.target.title){case "1*1":c.row=1,c.col=1;case "1*2":if(-1==c.row||-1==c.col)c.row=1,c.col=2;case "2*1":if(-1==c.row||-1==c.col)c.row=2,c.col=1;case "2*2":if(-1==c.row||-1==c.col)c.row=2,c.col=2;case "2*3":if(-1==c.row||-1==c.col)c.row=2,c.col=3;case "\u5e03\u5c40\u63a7\u4ef6":if(-1==c.row||-1==c.col)c.row=b.row,c.col=b.col;k.SetLayout(c.row,c.col);break;case "1*1+2":c.type="bottom";case "2+1*1":""==c.type&&(c.type="top");case "2*1+1":""==c.type&&(c.type="left");case "1+1*2":""==c.type&&(c.type="right");k.LayoutSp3(c.type);c.row=1;c.col=3;break;case "m*n":w||(w=new CBoBo.View.LayoutCtrl({msgtransform:K}));w.bShow?w.Show(!1):(w.SetPosition(b.clientX+3,b.clientY+3),w.Show(!0));return}b=m[r-1];b.row=c.row;b.col=c.col;b.type=c.type;t();q();E();B(!0);F();I(c)}}function D(a){$(a.target);switch(a.type){case "click":var b=r;switch(a.target.title){case "\u7b2c\u4e00\u9875":r=1;break;case "\u4e0a\u4e00\u9875":r=1>--r?1:r;break;case "\u4e0b\u4e00\u9875":r=++r>m.length?m.length:r;break;case "\u6700\u540e\u4e00\u9875":r=m.length}b!=r&&(k.scroll&&k.scroll.TriggerDragger(r),F())}}function u(a){var b=document.getElementById("csharpActiveX"),c=$(v.startPrint),d=$(v.printer).val(),e=$(v.color).val(),g=$(v.direct).val(),q=$(v.size).val(),k=localStorage.getItem("localPrint");switch(a.type){case "mouseenter":c.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":c.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":if(k){var t=$("#"+h.ctrl+" canvas").attr("imgID"),D=$("#hduseruid").val();a=A+"/ConfirmPrint?filmuid\x3d"+t;var k=JSON.parse(k),u=f.PrintSearchByPrintId(d),e="multicolour"==e?"\u5f69\u8272":"\u9ed1\u767d";if(window.ActiveXObject||"ActiveXObject"in window){if(null==b.object)return layer.msg("csharpActiveX\u63d2\u4ef6\u672a\u5b89\u88c5\uff01"),!1}else return layer.msg("\u8bf7\u4f7f\u7528IE\u6d4f\u89c8\u5668\uff01"),!1;$.ajax({type:"post",url:a,dataType:"json",complete:function(a){200==a.status?(a.responseJSON.success?b.Print(D,t,u.printTitle,u.printAddress,u.printPort,e,q,g):$.Msg("\u80f6\u7247\u6253\u5370\u5931\u8d25\u3002",CBoBo.MSG_ERROR),f.Show(!1)):$.Msg("\u80f6\u7247\u6253\u5370\u5f02\u5e38\u3002",CBoBo.MSG_ERROR)}})}else layer.msg("\u8bf7\u5148\u8bbe\u7f6e\u6253\u5370\u673a!")}}switch(c.type){case "scroll":G(c.value);break;case "change":switch(c.target.title){case "\u533b\u9662":H();case "\u6253\u5370\u673a":case "\u80f6\u7247\u5c3a\u5bf8":case "\u65b9\u5411":C()}break;case "mousewheel":var l=k.scroll;void 0!=l&&l.TriggerClick(c.deltaY);break;default:c.tooltype=x.toolType,g.msgtransform&&g.msgtransform(c)}if(c.target){switch(c.target.name){case "printSetting":b(c)}switch(c.target.title){case "1*1":case "1*1+2":case "2+1*1":case "2*1+1":case "1+1*2":case "1*2":case "2*1":case "2*2":case "2*3":case "\u5e03\u5c40\u63a7\u4ef6":case "m*n":d(c);break;case "\u7b2c\u4e00\u9875":case "\u4e0a\u4e00\u9875":case "\u4e0b\u4e00\u9875":case "\u6700\u540e\u4e00\u9875":D(c);break;case "\u5f00\u59cb\u6253\u5370":u(c);break;case "\u53d6\u6d88\u6253\u5370":e(c)}}},J=function(){var a=!1,b,d,e=$("#"+h.ctrl);$("#"+h.title).bind("mousedown",function(c){a=!0;b=new Point(c.pageX,c.pageY);c=e.offset();d=new Point(c.left,c.top)});$("#"+h.title+" a").bind("click",function(a){});$(document).bind("mousemove mouseup",function(c){switch(c.type){case "mousemove":a&&e.css({left:c.pageX-b.x+d.x+"px",top:c.pageY-b.y+d.y+"px"});break;case "mouseup":a=!1}});$("."+h.controlItem).bind("click mouseenter mouseout",function(a){K(a)});$("#printNetTest,#printerAdd,#printerChange,#printerDel,#printSetDefault,#printSetBoxClose,#printAddSubmit,#printCancelBox").bind("click",function(a){var b=JSON.parse(localStorage.getItem("localPrint")),d=document.getElementById("csharpActiveX"),e=$("#"+h.tableContent+" .current").attr("id");switch(a.target.id){case "printNetTest":null==d.object?layer.msg("csharpActiveX\u63d2\u4ef6\u672a\u5b89\u88c5\uff01"):(b=f.PrintSearchByPrintId(e),console.log(d.TestAE),d.TestAE(b.printTitle,b.printAddress,b.printPort));break;case "printerAdd":$("#iptInputPrintName").val("");$("#iptInputPrintTitle").val("");$("#iptInputPrintAddress").val("");$("#iptInputPrintPort").val("");$("#"+h.settingAddBox+"Title").text("\u6dfb\u52a0\u6253\u5370\u673a");f.isAddPrint=!0;f.showPrintBox("bShowPrintAddBox",h.settingAddBox);break;case "printerChange":e&&""!=e?(f.isAddPrint=!1,$("#"+h.settingAddBox+"Title").text("\u4fee\u6539\u6253\u5370\u673a"),f.ModifyLocalPrint(e)):layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printerDel":d=b.print;a=[];if(0<d.length){for(var g=0;g<d.length;g++)d[g].id!=e&&a.push(d[g]);b.print=a;b.defaultId==e&&(b.defaultId=0<a.length?a[0].id:"");localStorage.setItem("localPrint",JSON.stringify(b));f.readLocalPrint();f.LoadPrintToSelelct(v.printer,"pointer")}else layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printSetDefault":e&&""!=e?(b.defaultId=e,localStorage.setItem("localPrint",JSON.stringify(b)),f.LoadPrintToSelelct(v.printer,"pointer"),f.closePrintBox("bShowPrintSetBox",h.settingBox)):layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printSetBoxClose":f.closePrintBox("bShowPrintSetBox",h.settingBox);break;case "printAddSubmit":c(e);break;case "printCancelBox":f.closePrintBox("bShowPrintAddBox",h.settingAddBox)}});$(v.direct+","+v.size+","+v.color+","+v.printer).bind("change",function(a){K(a)});$(v.startPrint+","+v.cancelPrint+","+v.printSetting).bind("click mouseenter mouseout",function(a){K(a)})},E=function(){$("#"+h.pageInfo).html(r+"/"+m.length)},B=function(a){var b,c=void 0;void 0==c&&(c=r);for(var d=b=0;d<c-1;d++){var e=m[d];b+=e.row*e.col}c=m[c-1];c=c.row*c.col+b;c>l.length&&(c=l.length);b=l.slice(b,c);c=k.GetAllCanvas();g.msgtransform&&g.msgtransform({type:"draw",arrcanvas:c,arrannstatus:b,bforce:a})},q=function(){if(k){var a;1<m.length?(k.EnableScroll(!0),a=r>m.length?m.length:r):(k.EnableScroll(!1),a=1);k.scroll.SetRange(m.length,a)}},t=function(){var b=l.length;if(b){var c=m;m=[];for(var d=0,e=0;e<b;){var f=c[d];f||(f=new a);m.push(f);e+=f.row*f.col;d++}r>m.length&&(r=m.length)}},u=function(){var a={},b;for(b in v){var c=v[b],c="mode"==b?$(c+" input:checked").val():$(c).find("option:selected").val();a[b]=c}return a},G=function(a,b){a&&!isNaN(a)&&(r=a);var c=m[r-1];if(c&&(b||!I(c)))switch(c.type){case "left":case "top":case "right":case "bottom":k.LayoutSp3(c.type);break;default:k.SetLayout(c.row,c.col)}B(!0);E();F()},D=function(a){a=$.extend(!0,{parent:null,iconstr:"",title:"",angle:0,size:30,margin:{left:0,top:0,right:0,bottom:0},padding:{left:0,top:0,right:0,bottom:0}},a);var b=CBoBo.Plugin.GetRandom(),c=$("\x3cdiv id\x3d'"+b+"' title\x3d'"+a.title+"'\x3e"+a.iconstr+"\x3c/div\x3e").appendTo($(a.parent));$("#"+b).bind("click mouseenter mouseout",function(a){K(a)});c.css({transform:"rotate("+a.angle+"deg)","font-size":a.size+"px","float":"left","padding-left":a.padding.left+"px","padding-top":a.padding.top+"px","padding-right":a.padding.right+"px","padding-bottom":a.padding.bottom+"px","margin-left":a.margin.left+"px","margin-top":a.margin.top+"px","margin-right":a.margin.right+"px","margin-bottom":a.margin.bottom+"px",cursor:"pointer",color:"#888"});return b},N=function(a,b){if(void 0!=b&&void 0!=a){var c=CBoBo.Plugin.GetRandom(),d=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+d+"'\x3e\x3cspan\x3e"+b+"\x3c/span\x3e\x3cselect id\x3d'"+c+"' title\x3d'"+b+"'\x3e\x3c/select\x3e\x3c/div\x3e").appendTo($(a)).css({"float":"left",width:"100%","text-align":"center",height:"45px","margin-top":"6px"});$("#"+d+" span").css({width:"90%","font-size":"14px",height:"20px",cursor:"default"});$("#"+c).css({width:"90%",cursor:"pointer",height:"25px"});return c}},L=function(a,b,c){void 0!=b&&$("\x3coption value\x3d'"+c+"'\x3e"+b+"\x3c/option\x3e").appendTo($(a))},O=function(a,b,c){if(void 0!=b&&void 0!=a){var d=CBoBo.Plugin.GetRandom();a=$("\x3cdiv\x3e\x3cbutton id\x3d'"+d+"' title\x3d'"+b+"'name\x3d'"+c+"'\x3e"+b+"\x3c/button\x3e\x3c/div\x3e").appendTo($(a));"printSetting"===c?a.css({"float":"left",width:"100%",height:"30px","text-align":"center","margin-top":"100px"}):a.css({"float":"left",width:"100%",height:"30px","text-align":"center","margin-top":"6px"});$("#"+d).css({width:"90%",height:"30px",background:"#555555",color:"#CCCCC4",border:"none","font-size":"14px","font-weight":"bold","border-radius":"5px",cursor:"pointer"});return d}};this.Show=function(a){var b=$("#"+h.ctrl);a?(C(),b.fadeIn(300),this.bShow=!0):(b.fadeOut(500),this.bShow=!1)};this.RequestPrint=function(a){if(a&&!(1>a.length)){for(var b=0;b<a.length;b++){var c=a[b];c.type==CBoBo.PTYPE_SERIES&&(c.type=CBoBo.PTYPE_DESERIES);c.type==CBoBo.PTYPE_JPG?$.Msg("\u4e0d\u652f\u6301\u8d85\u58f0\u6253\u5370!"):(c.bPrint=!0,c.status.bDrawText=!0,l.push(c))}t();E();q();B(!0);F()}};(function(){h.ctrl=CBoBo.Plugin.GetRandom();h.title=CBoBo.Plugin.GetRandom();h.title=CBoBo.Plugin.GetRandom();h.titleBtn=CBoBo.Plugin.GetRandom();h.container=CBoBo.Plugin.GetRandom();h.leftBox=CBoBo.Plugin.GetRandom();h.canvasBox=CBoBo.Plugin.GetRandom();h.controlBar=CBoBo.Plugin.GetRandom();h.control=CBoBo.Plugin.GetRandom();h.controlItem=CBoBo.Plugin.GetRandom();h.pageInfo=CBoBo.Plugin.GetRandom();h.toolBox=CBoBo.Plugin.GetRandom();h.winLayout=CBoBo.Plugin.GetRandom();h.tool=CBoBo.Plugin.GetRandom();h.config=CBoBo.Plugin.GetRandom();h.toolId=CBoBo.Plugin.GetRandom();h.winLayoutId=CBoBo.Plugin.GetRandom();h.configId=CBoBo.Plugin.GetRandom();h.settingBox=CBoBo.Plugin.GetRandom();h.settingAddBox=CBoBo.Plugin.GetRandom();h.tableContent=CBoBo.Plugin.GetRandom();$("\x3cobject id\x3d'csharpActiveX' classid\x3d'clsid:CC6F4407-B2B2-47FB-AE00-7E88A7E615EC' width\x3d'0' height\x3d'0'\x3e\x3c/object\x3e\x3cdiv id\x3d'"+h.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+h.title+"'\x3e\x3cspan class\x3d'"+h.titleBtn+"'\x3e\u80f6\u7247\u6253\u5370\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.container+"'\x3e\x3cdiv id\x3d'"+h.leftBox+"'\x3e\x3cdiv id\x3d'"+h.canvasBox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.controlBar+"'\x3e\x3cdiv id\x3d'"+h.control+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.toolBox+"'\x3e\x3cdiv id\x3d'"+h.config+"'\x3e\x3cspan \x3e\u6253 \u5370 \u914d \u7f6e\x3c/span\x3e\x3cdiv id\x3d'"+h.configId+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e''\x3cdiv id\x3d'"+h.settingBox+"' class\x3d'zzhsettingBox'\x3e\x3cdiv class\x3d'title-container'\x3eDICOM \u6253\u5370\u673a\u914d\u7f6e\x3c/div\x3e\x3cdiv class\x3d'setting-content'\x3e\x3cdiv class\x3d'operation-container'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printNetTest'\x3e\u7f51\u7edc\u6d4b\u8bd5\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerAdd'\x3e\u6dfb\u52a0\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerChange'\x3e\u4fee\u6539\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerDel'\x3e\u5220\u9664\x3c/button\x3e\x3c/div\x3e\x3cdiv class\x3d'table-content'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3cthead\x3e\x3ctr\x3e\x3cth width\x3d'35%'\x3e\u540d\u79f0\x3c/th\x3e\x3cth width\x3d'25%'\x3eAET\x3c/th\x3e\x3cth width\x3d'25%'\x3e\u5730\u5740\x3c/th\x3e\x3cth width\x3d'15%'\x3e\u7aef\u53e3\x3c/th\x3e\x3c/tr\x3e\x3c/thead\x3e\x3c/table\x3e\x3cdiv class\x3d'contentScroll'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' id\x3d'"+h.tableContent+"'\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-container setting-footer'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printSetDefault'\x3e\u8bbe\u4e3a\u9ed8\u8ba4\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printSetBoxClose'\x3e\u5173\u95ed\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+h.settingAddBox+"' class\x3d'addPrintterContainer'\x3e\x3cdiv class\x3d'title-container' id\x3d'"+h.settingAddBox+"Title'\x3e\u6dfb\u52a0\u6253\u5370\u673a\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3e\u6253\u5370\u673a\u540d\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintName'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3eAETitle\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintTitle'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3eIP\u5730\u5740\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintAddress'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3e\u7aef\u53e3\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text 'maxlength\x3d'5'id\x3d'iptInputPrintPort'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-container setting-footer'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printAddSubmit'\x3e\u786e\u5b9a\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printCancelBox'\x3e\u53d6\u6d88\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));var b=.8*$(window).width()>>0,b=800>b?800:b;$("#"+h.ctrl).width(b).height(820).css({border:"1px solid #676767",position:"absolute","z-index":"9999",background:"#444444",display:"none","user-select":"none",color:"#CCCCC4"});$("#"+h.title).css({height:"30px",width:"100%",background:"#555555",cursor:"move"});$("."+h.titleBtn).css({width:"100%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+h.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+h.container).css({position:"relative"});var c=$("#"+h.leftBox);leftBoxWidth=b-202;c.width(leftBoxWidth).height(790).css({"float":"left"});$("#"+h.canvasBox).width(leftBoxWidth).height(745).css({"border-bottom":"1px solid #676767"});$("#"+h.controlBar).height(44).css({width:"100%"});$("#"+h.control).height(44).width(220).css({"float":"right","text-align":"center","font-size":"25px","line-height":"40px",color:"#000"});$("."+h.controlItem).css({cursor:"pointer",margin:"0 10px"});$("#"+h.pageInfo).css({color:"#CCCCC4","font-size":"18px","vertical-align":"middle",cursor:"default"});$("#"+h.toolBox).css({height:"590px",width:"200px","float":"right","border-left":"1px solid #676767","border-top":"1px solid #000"});$("#"+h.toolBox+" span").css({width:"100%","text-align":"center",display:"inline-block","font-size":"14px",background:"#555555",cursor:"default",color:"rgba(255,255,255,0.8)"});$("#"+h.winLayout).height(100);$("#"+h.tool).css({height:"490px",width:"25%",display:"inline-block","border-right":"1px solid #676767",overflow:"hidden"});$("#"+h.config).css({height:"490px",width:"100%",display:"inline-block",overflow:"hidden"});$("#"+h.winLayoutId).height(84).css({overflow:"hidden"});$("#"+h.toolId).height(474).css({overflow:"hidden",width:"50px"});$("#"+h.configId).height(474).css({overflow:"hidden"});var d=$("body"),b=$("#"+h.ctrl),c=d.width(),d=d.height(),e=b.width(),g=b.height();b.css({left:(c-e>>1)+"px",top:(d-g>>1)+"px"});F();new CBoBo.View.CMngFirstLayer;x=new CBoBo.View.PCToolBar({parent:"#"+h.toolId,axis:"y",bottonbox:!1});x.RequestToolBar(CBoBo.TOOLMENU_PRINT_RADIATE,M);x.ChangeBtnStatus("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);k=new CBoBo.View.CMngFirstLayer({parent:"#"+h.canvasBox,single:!0,msgtransform:K});m.push(new a);q();k.SetLayout(1,1);k.SetDefaultFocus(0);D({parent:"#"+h.winLayoutId,iconstr:"\x26#xe667;",title:"1*1",angle:0,size:30,margin:{left:5,top:4,right:5,bottom:5},padding:{left:0,top:0,right:0,bottom:0}});c="#"+h.configId;b="#"+N(c,"\u80f6\u7247\u5c3a\u5bf8");v.size=b;L(b,"8INX10IN","8INX10IN");L(b,"10INX12IN","10INX12IN");L(b,"10INX14IN","10INX14IN");L(b,"11INX14IN","11INX14IN");L(b,"14INX14IN","14INX14IN");L(b,"14INX17IN","14INX17IN");b="#"+N(c,"\u65b9\u5411");v.direct=b;L(b,"\u7eb5\u5411","PORTRAIT");L(b,"\u6a2a\u5411","LANDSCAPE");b="#"+N(c,"\u989c\u8272");v.color=b;L(b,"\u5f69\u8272","multicolour");L(b,"\u7070\u9636","grayscale");b="#"+N(c,"\u6253\u5370\u673a");v.printer=b;f.LoadPrintToSelelct(b,"pointer");b="#"+O(c,"\u6253\u5370\u673a\u8bbe\u7f6e","printSetting");v.printSetting=b;b="#"+O(c,"\u5f00\u59cb\u6253\u5370","startPrint");v.startPrint=b;b="#"+O(c,"\u53d6\u6d88\u6253\u5370","cancelPrint");v.cancelPrint=b;f.readLocalPrint();J()})()};CBoBo.View.DVPrintInfo=function(){this.DicomInfos=[];this.ImageDisplayFormat;this.Size;this.Direct};CBoBo.View.DVPrintImageInfo=function(){this.ID;this.WindowLevel;this.WindowWidth;this.Multiple;this.TopLeftLabels;this.TopRightLabels;this.DownLeftLabels;this.DownRightLabels;this.TopLabel;this.DownLabel;this.LeftLabel;this.RightLabel};CBoBo.View.DVPrintImageDescribe=function(){this.Describe=[]};CBoBo.View.MenuBall=function(){this.breatheID;this.touchStartPosX;this.touchStartPosY;this.CircleLeft;this.CircleTop;this.CircleWidth;this.CircleHeight;this.breatheRadius;this.breatheCentreX;this.breatheCentreY;this.documentWidth;this.documentHeight;this.startTimeStamp;this.HomeMenu;this.CentreClick;this.CreateBall=function(){this.breatheID="#breatheBall";$('\x3cdiv id\x3d"menuCircle" class\x3d\'icon_tool\'\x3e\x3cdiv id \x3d"menuRing"\x3e\x3c/div\x3e\x3cdiv id\x3d"breatheBall"\x3e\x3c/div\x3e\x3c/div\x3e').appendTo($("body"));this.Int();this.AddEnvent()};this.SetMainMenu=function(d){this.HomeMenu=d;this.HomeMenu()};this.Animation=function(d){switch(d){case 1:$("#menuRing").addClass("itemRingRotate");setTimeout("$('#menuRing').removeClass('itemRingRotate');",700);break;case 2:$("#menuRing").addClass("itemRingRotate1");setTimeout("$('#menuRing').removeClass('itemRingRotate1');",700);break;case 3:$("#menuRing").addClass("itemRingFade"),setTimeout("$('#menuRing').removeClass('itemRingFade');",700)}};this.CloseRingMenu=function(){$("#menuCircle").hasClass("open")&&$("#menuCircle").removeClass("open")};this.OpenRingMenu=function(d){$("#menuCircle").hasClass("open")||$("#menuCircle").addClass("open")};this.Clear=function(){$(".menuItem").unbind();$("#menuRing").empty();this.CentreClick=null};this.SetCentreIcon=function(d){var a=$(this.breatheID);a.empty();$("\x3cspan class\x3dbreatheBallCentre\x3e"+d+"\x3c/span\x3e").appendTo(a)};this.Push=function(d,a,b,c){void 0==a&&(a="");var e="cMenuItem"+CBoBo.Plugin.GetRandom();d="\x3cdiv class\x3d'menuItem' id\x3d\""+e+("\" title\x3d'"+a+"'\x3e\x3cp style\x3d'pointer-events:none;'\x3e"+d+"\x3c/p\x3e\x3cp class\x3d\"itemTitle\" style\x3d'pointer-events:none;'\x3e")+a;d+="\x3c/p\x3e\x3c/div\x3e";$(d).appendTo($("#menuRing"));if(void 0!=b){var e="#"+e,f=e+" p:first-child",g=e+" p:last-child",h=this;$(e).bind("touchstart",function(a){h.startTimeStamp=a.timeStamp;$(g).css("color","#67CBFA")});$(e).bind("touchend",function(a){if(200>a.timeStamp-h.startTimeStamp){var c=$(f).text();h.SetCentreIcon(c);b(a)}$(g).css("color","#FFF")})}c&&$(f).css({transform:"rotate("+c+"deg)"})};this.PushImage=function(d,a,b){var c=CBoBo.Plugin.GetRandom();$("\x3cdiv class\x3d'menuItem' id\x3d'"+c+"' title\x3d'"+a+"'\x3e\x3cimg class\x3d'pseudocolor' src\x3d'"+d+"'/\x3e\x3cdiv class\x3d'itemTitle' style\x3d'pointer-events:none;'\x3e"+a+"\x3c/div\x3e\x3c/div\x3e").appendTo($("#menuRing"));if(void 0!=b){d="#"+c;var e=d+" p:first-child",f=d+" p:last-child",g=this;$(d).bind("touchstart",function(a){g.startTimeStamp=a.timeStamp;$(f).css("color","#67CBFA")});$(d).bind("touchend",function(a){if(200>a.timeStamp-g.startTimeStamp){var c=$(e).text();g.SetCentreIcon(c);b(a)}$(f).css("color","#FFF")})}};this.FlushMenu=function(){for(var d=document.querySelectorAll(".menuItem"),a=0,b=d.length;a<b;a++)d[a].style.left=(50-35*Math.cos(-.5*Math.PI-1/b*2*a*Math.PI)).toFixed(4)+"%",d[a].style.top=(50+35*Math.sin(-.5*Math.PI-1/b*2*a*Math.PI)).toFixed(4)+"%"};this.Int=function(){this.breatheRadius=$(this.breatheID).width()/2;this.documentWidth=$(window).width()-1;this.documentHeight=$(window).height()-1;this.CircleWidth=$("#menuCircle").width();this.CircleHeight=$("#menuCircle").height()};this.AddEnvent=function(){var d=this;$(this.breatheID).bind("touchstart",function(a){d.BreatheTouchStart(a)});$(this.breatheID).bind("touchmove",function(a){d.BreatheTouchMove(a)});$(this.breatheID).bind("touchend",function(a){d.BreatheTouchEnd(a)});$(document).bind("touchstart",function(a){d.DocumentTouchStart(a)});$(document).bind("touchend",function(a){d.DocumentTouchEnd(a)});$("#menuCircle").bind("touchmove touchstart touchend",function(a){d.CircleEvent(a)})};this.WindowResize=function(d){d=$(window).width();var a=$(window).height();this.CircleLeft=$("#menuCircle").offset().left;this.CircleTop=$("#menuCircle").offset().top;var b=this.CircleLeft*d/this.documentWidth,c=this.CircleTop*a/this.documentHeight,e=d-this.CircleWidth/2-this.breatheRadius-2,f=-this.CircleWidth/2+this.breatheRadius+2,g=a-this.CircleHeight/2-this.breatheRadius-2,h=-this.CircleHeight/2+this.breatheRadius+2;b>e?b=e:b<f&&(b=f);c>g?c=g:c<h&&(c=h);$("#menuCircle").css({left:b+"px",top:c+"px"});this.documentWidth=d;this.documentHeight=a};this.BreatheTouchStart=function(d){this.startTimeStamp=d.timeStamp;d=d.originalEvent.targetTouches[0];this.touchStartPosX=d.screenX;this.touchStartPosY=d.screenY;this.CircleLeft=$("#menuCircle").offset().left;this.CircleTop=$("#menuCircle").offset().top};this.BreatheTouchMove=function(d){d.preventDefault();d=d.originalEvent.targetTouches[0];this.breatheCentreX=d.screenX;this.breatheCentreY=d.screenY;d=this.breatheCentreX-this.touchStartPosX+this.CircleLeft;var a=this.breatheCentreY-this.touchStartPosY+this.CircleTop,b=this.documentWidth-this.CircleWidth-2,c=this.documentHeight-this.CircleHeight-2;d>b?d=b:1>d&&(d=1);a>c?a=c:1>a&&(a=1);$("#menuCircle").css({left:d+"px",top:a+"px"})};this.SetCentreClick=function(d){this.CentreClick=d};this.BreatheTouchEnd=function(d){200>d.timeStamp-this.startTimeStamp&&(void 0==this.CentreClick||null==this.CentreClick?0<document.querySelectorAll(".menuItem").length&&$("#menuCircle").toggleClass("open"):(this.CentreClick(),this.CentreClick=null))};this.DocumentTouchStart=function(d){this.startTimeStamp=d.timeStamp};this.DocumentTouchEnd=function(d){200>d.timeStamp-this.startTimeStamp&&(this.CloseRingMenu(),this.Clear(),this.HomeMenu())};this.CircleEvent=function(d){d.stopPropagation();d.preventDefault()}};CBoBo.View.MobileMenuBall=function(d){var a=this;this.menuBall;var b=d.msgtransform,c,e=!1,f;this.toolType;this.bShowCornerInfo=!0;this.menuBall=new CBoBo.View.MenuBall;this.menuBall.CreateBall();this.SeriesHomeMenu=function(){a.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",a.MsgTransform);a.menuBall.Push("\x26#xe61b;","\u8c03\u7a97",a.MsgTransform);a.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",a.MsgTransform);a.menuBall.Push("\x26#xe644;","\u6062\u590d",a.MsgTransform);a.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",a.MsgTransform);a.menuBall.Push("\x26#xe604;","\u6d4b\u91cf",a.MsgTransform);a.menuBall.Push("\x26#xe60d;","\u65cb\u8f6c",a.MsgTransform);a.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",a.MsgTransform);a.menuBall.Push("\x26#xe63d;","\u5e8f\u5217\u5e03\u5c40",a.MsgTransform);a.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",a.MsgTransform);a.menuBall.Push("\x26#xe643;","MPR",a.MsgTransform);a.menuBall.FlushMenu()};this.DeSeriesHomeMenu=function(){a.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",a.MsgTransform);a.menuBall.Push("\x26#xe61b;","\u8c03\u7a97",a.MsgTransform);a.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",a.MsgTransform);a.menuBall.Push("\x26#xe644;","\u6062\u590d",a.MsgTransform);a.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",a.MsgTransform);a.menuBall.Push("\x26#xe604;","\u6d4b\u91cf",a.MsgTransform);a.menuBall.Push("\x26#xe60d;","\u65cb\u8f6c",a.MsgTransform);a.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",a.MsgTransform);a.menuBall.Push("\x26#xe63d;","\u5e8f\u5217\u5e03\u5c40",a.MsgTransform);a.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",a.MsgTransform);a.menuBall.FlushMenu()};this.JpgHomeMenu=function(){a.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",a.MsgTransform);a.menuBall.Push("\x26#xe61b;","\u4eae/\u5bf9\u6bd4",a.MsgTransform);a.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",a.MsgTransform);a.menuBall.Push("\x26#xe644;","\u6062\u590d",a.MsgTransform);a.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",a.MsgTransform);a.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",a.MsgTransform);a.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",a.MsgTransform);a.menuBall.FlushMenu()};this.MprHomeMenu=function(){a.menuBall.Push("\x26#xe658;","2D",a.MsgTransform);a.menuBall.Push("\x26#xe61b;","\u5207\u9762\u8c03\u7a97",a.MsgTransform);a.menuBall.Push("\x26#xe6aa;","\u5341\u5b57\u5207\u9762",a.MsgTransform);a.menuBall.FlushMenu()};this.MsgTransform=function(c){switch(c.target.title){case "\u6d4b\u91cf":a.MeasureMenu();break;case "\u65cb\u8f6c":a.RotateMenu();break;case "\u56fe\u50cf\u5e03\u5c40":case "\u5e8f\u5217\u5e03\u5c40":f=c.target.title;a.LayoutMenu();break;case "\u4f2a\u5f69":a.PseudoColor();break;case "\u8c03\u7a97":case "\u4eae/\u5bf9\u6bd4":case "\u6062\u590d":case "\u79fb\u52a8":case "\u8d1f\u50cf":case "\u5220\u9664\u56fe\u50cf":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "CT":case "\u692d\u5706":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u91cd\u65b0\u52a0\u8f7d":case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":a.menuBall.CloseRingMenu();void 0!==b&&b(c);break;case "1x1":c={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:1,ctrltype:f};void 0!=b&&b(c);break;case "1x2":c={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:2,ctrltype:f};void 0!=b&&b(c);break;case "2x1":c={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:1,ctrltype:f};void 0!=b&&b(c);break;case "2x2":c={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:2,ctrltype:f};void 0!=b&&b(c);break;case "2x3":c={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:3,ctrltype:f};void 0!=b&&b(c);break;case "3x2":c={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:3,col:2,ctrltype:f};void 0!=b&&b(c);break;case "3x3":c={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:3,col:3,ctrltype:f};void 0!=b&&b(c);break;case "MPR":e=!0;a.Clear();g();b&&b(c);break;case "2D":e=!1,a.Clear(),g();default:void 0!=b&&b(c)}};this.RequestToolBall=function(a,d){if(a!==c||b!==d)c=a,b=d,g()};this.PseudoColor=function(){a.Clear(3);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/0.jpg","\u7070\u8272",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/1.jpg","\u5f69\u8679",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/2.jpg","\u9ed1\u4f53",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/3.jpg","\u9aa8\u9abc",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/4.jpg","\u5fc3\u810f",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/5.jpg","\u6d41\u52a8",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/6.jpg","Ge\u8272",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/8.jpg","\u70ed\u7eff",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/9.jpg","\u94ec\u94c1",a.MsgTransform);a.menuBall.PushImage("/DicomViewer/css/pseudocolor/10.jpg","\u70ed\u91d1\u5c5e",a.MsgTransform);a.menuBall.FlushMenu();a.menuBall.SetCentreClick(a.BackHome)};this.RotateMenu=function(){a.Clear(3);a.menuBall.Push("\x26#xe61d;","\u9006\u65f6\u9488",a.MsgTransform);a.menuBall.Push("\x26#xe61c;","\u987a\u65f6\u9488",a.MsgTransform);a.menuBall.Push("\x26#xe63a;","\u5de6\u53f3\u955c\u50cf",a.MsgTransform);a.menuBall.Push("\x26#xe639;","\u4e0a\u4e0b\u955c\u50cf",a.MsgTransform);a.menuBall.FlushMenu();a.menuBall.SetCentreClick(a.BackHome)};this.MeasureMenu=function(){a.Clear(3);a.menuBall.Push("\x26#xe61f;","\u76f4\u7ebf",a.MsgTransform);a.menuBall.Push("\x26#xe619;","\u77e9\u5f62",a.MsgTransform);a.menuBall.Push("\x26#xe637;","CT",a.MsgTransform);a.menuBall.Push("\x26#xe61e;","\u692d\u5706",a.MsgTransform);a.menuBall.Push("\x26#xe629;","\u6587\u672c",a.MsgTransform);a.menuBall.Push("\x26#xe62f;","\u7bad\u5934",a.MsgTransform);a.menuBall.Push("L","\u5de6\u6807\u8bb0",a.MsgTransform);a.menuBall.Push("R","\u53f3\u6807\u8bb0",a.MsgTransform);a.menuBall.Push("\x26#xe622;","\u64a4\u9500",a.MsgTransform);a.menuBall.FlushMenu();a.menuBall.SetCentreClick(a.BackHome)};this.LayoutMenu=function(){a.Clear(3);a.menuBall.Push("\x26#xe667;","1x1",a.MsgTransform);a.menuBall.Push("\x26#xe66f;","1x2",a.MsgTransform,90);a.menuBall.Push("\x26#xe66f;","2x1",a.MsgTransform);a.menuBall.Push("\x26#xe66e;","2x2",a.MsgTransform);a.menuBall.Push("\x26#xe66a;","3x2",a.MsgTransform,90);a.menuBall.Push("\x26#xe66a;","2x3",a.MsgTransform);a.menuBall.Push("\x26#xe66d;","3x3",a.MsgTransform);a.menuBall.FlushMenu();a.menuBall.SetCentreClick(a.BackHome)};this.Clear=function(b){void 0!==b&&a.menuBall.Animation(b);a.menuBall.Clear()};this.BackHome=function(){a.Clear(3);e?a.MprHomeMenu():c==CBoBo.PTYPE_JPG?a.JpgHomeMenu():c==CBoBo.PTYPE_SERIES?a.SeriesHomeMenu():a.DeSeriesHomeMenu();a.menuBall.OpenRingMenu()};var g=function(){e?a.menuBall.SetMainMenu(a.MprHomeMenu):c==CBoBo.PTYPE_JPG?a.menuBall.SetMainMenu(a.JpgHomeMenu):c==CBoBo.PTYPE_SERIES?a.menuBall.SetMainMenu(a.SeriesHomeMenu):a.menuBall.SetMainMenu(a.DeSeriesHomeMenu)}};CBoBo.View.SeriesPlayer=function(d){this.bShow;var a=1,b=1,c,e,f=$.extend(!0,{msgtransform:null},d),g={},h=null,k=function(d){var e=!0;2>a&&(e=!1);var h=!0;if(e){var k=$("."+g.playItem).eq(2);switch(d.target.title){case "\u7b2c\u4e00\u5f20":b=1;break;case "\u4e0a\u4e00\u5f20":b=1>--b?1:b;break;case "\u64ad\u653e":null!=f.msgtransform&&(d.usermsg="seriesplay",d.value=b,f.msgtransform(d));l();k.html("\x26#xe713;");k.attr("title","\u6682\u505c");h=!1;c=!0;break;case "\u6682\u505c":m();setTimeout(function(){null!=f.msgtransform&&(d.usermsg="seriesplay",d.value=b,f.msgtransform(d));k.html("\x26#xe724;");k.attr("title","\u64ad\u653e")},100);h=c=!1;break;case "\u4e0b\u4e00\u5f20":b=++b>a?a:b;break;case "\u6700\u540e\u4e00\u5f20":b=a;break;case "\u64ad\u653e\u901f\u5ea6":c&&(m(),l()),h=!1}}r();null!=f.msgtransform&&h&&("userdocument"==d.userdocument?f.msgtransform({usermsg:"seriesplay",value:b,userdocument:"userdocument"}):f.msgtransform({usermsg:"seriesplay",value:b}))},l=function(){var c=$("#"+g.playSpeed).val();void 0!=c&&($("body").css("pointer-events","none"),e=setInterval(function(){b++;b>a&&(b=1);null!=f.msgtransform&&f.msgtransform({usermsg:"seriesplay",value:b})},1E3/c))},m=function(){clearInterval(e);e=null;$("body").css("pointer-events","auto")},r=function(){var d=$("."+g.playItem),e=d.eq(0),f=d.eq(1),h=d.eq(2),k=d.eq(3),d=d.eq(4);2>a?(e.css({"pointer-events":"none",color:"gray"}),f.css({"pointer-events":"none",color:"gray"}),h.css({"pointer-events":"none",color:"gray"}),k.css({"pointer-events":"none",color:"gray"}),d.css({"pointer-events":"none",color:"gray"})):c?(e.css({"pointer-events":"none",color:"gray"}),f.css({"pointer-events":"none",color:"gray"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"none",color:"gray"}),d.css({"pointer-events":"none",color:"gray"})):2>b?(e.css({"pointer-events":"none",color:"gray"}),f.css({"pointer-events":"none",color:"gray"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"auto",color:"#33FFFF"}),d.css({"pointer-events":"auto",color:"#33FFFF"})):b>a-1?(e.css({"pointer-events":"auto",color:"#33FFFF"}),f.css({"pointer-events":"auto",color:"#33FFFF"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"none",color:"gray"}),d.css({"pointer-events":"none",color:"gray"})):(e.css({"pointer-events":"auto",color:"#33FFFF"}),f.css({"pointer-events":"auto",color:"#33FFFF"}),h.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"auto",color:"#33FFFF"}),d.css({"pointer-events":"auto",color:"#33FFFF"}));$("#"+g.playSpeed).css({"pointer-events":"auto"})};this.SetPosition=function(a,b){$("#"+g.ctrl).css({left:a+"px",top:b+"px"})};this.Show=function(a){var b=$("#"+g.ctrl);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(400))};this.SetRange=function(d,e){if(!isNaN(d)){a=d;b=e;void 0==b&&(b=1);c=!1;var f=$("."+g.playItem).eq(2);f.html("\x26#xe724;");f.attr("title","\u64ad\u653e");r()}};this.TriggerClick=function(a){$("."+g.playItem).eq(a).triggerHandler("click")};this.SaveSeriesTag=function(a){h=a};this.GetSeriesTag=function(){return h};(function(){g.ctrl=CBoBo.Plugin.GetRandom();g.playItem=CBoBo.Plugin.GetRandom();g.playfps=CBoBo.Plugin.GetRandom();g.playSpeed=CBoBo.Plugin.GetRandom();var a="\x3cdiv id\x3d'"+g.ctrl+"' class\x3d'icon-player'\x3e\x3cul\x3e",a=a+("\x3cli\x3e\x3cspan class\x3d'player "+g.playItem+"' title\x3d'\u7b2c\u4e00\u5f20'\x3e\x26#xe76a;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+g.playItem+"' title\x3d'\u4e0a\u4e00\u5f20'\x3e\x26#xe68d;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+g.playItem+"' title\x3d'\u64ad\u653e'\x3e\x26#xe724;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+g.playItem+"' title\x3d'\u4e0b\u4e00\u5f20'\x3e\x26#xe68c;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+g.playItem+"' title\x3d'\u6700\u540e\u4e00\u5f20'\x3e\x26#xe769;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan  id\x3d'"+g.playfps+"'\x3eFPS\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cinput id\x3d'"+g.playSpeed+"' type\x3d'number' min\x3d'1' max\x3d'50' value\x3d'10' title\x3d'\u64ad\u653e\u901f\u5ea6'/\x3e\x3c/li\x3e");$(a+"\x3c/ul\x3e\x3c/div\x3e").appendTo($("body")).width(293).height(40).css({position:"absolute",background:"rgba(0,0,0,1)","z-index":11111,border:"1px solid #33FFFF","border-radius":"6px 6px","user-select":"none","font-size":"40px"})})();$("#"+g.ctrl+" ul").css({"list-style":"none",position:"absolute",margin:"auto",left:0,top:0,bottom:0,right:0,padding:"0"});$("#"+g.ctrl+" ul li").css({display:"inline-block"});$("#"+g.playfps).css({"font-size":"16px","font-family":"Microsoft YaHei","margin-left":"10px","vertical-align":"middle",cursor:"default",color:"#FFF"});$("#"+g.playSpeed).height(18).width(35).css({"margin-left":"5px","vertical-align":"middle"});(function(){$("."+g.playItem).bind("click",function(a){k(a);a.stopPropagation()});$("#"+g.playSpeed).bind("change",function(a){k(a)});$(document).bind("click",function(a){a.userdocument="userdocument";k(a)})})();!0};CBoBo.View.ContextMenu=function(d){var a,b=$.extend(!0,{offsetX:2,offsetY:2,speed:300,flash:!1,items:[],action:null},d),c=this,e;this.ctrl;this.bShow=!1;this.Create=function(){e="cbobo"+CBoBo.Plugin.GetRandom();var a="";$.each(b.items,function(b,c){c&&(a+="\x3cli title\x3d'"+c.text+"' class\x3d'ctxmenu'\x3e\x3cspan\x3e"+c.text+"\x3c/span\x3e\x3c/li\x3e")});this.ctrl=$("\x3cdiv id\x3d'"+e+"'\x3e\x3cul\x3e"+a+"\x3c/ul\x3e\x3c/div\x3e").appendTo("body");this.ctrl.css({position:"absolute","border-radius":"5px","z-index":999999,"-webkit-user-select":"none","background-color":"rgba(56, 56, 56, 0.8)",border:"1px solid rgba(80, 80, 80, 1)","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none","box-shadow":"-2px 2px 5px #000"});$("#"+e+" ul").css({"list-style":"none",padding:"0",margin:"0"});$("#"+e+" ul li").css({padding:"2px",margin:"0",display:"block"});$("#"+e+" ul li span").css({"pointer-events":"none"})};this.SetPosition=function(a,b){this.ctrl.css({left:a+"px",top:b+"px"});return this};this.Show=function(a){(this.bShow=a)?(this.ctrl.hide(),b.flash?this.ctrl.show(b.speed):this.ctrl.show()):b.flash?this.ctrl.hide(b.speed):this.ctrl.hide();return this};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),a=Math.max(a,b)/17>>0;63>a&&(a=63);this.ctrl.css({width:a+"px","font-size":(.1234*a>>0)+"px"});a=.2*a>>0;$("#"+e+" ul li").css({"padding-left":a+"px"})};this.AddEvent=function(){CBoBo.Plugin.GetBrowserInfo().isMobile?($(document).bind("touchstart",function(a){c.Show(!1)}),$("#"+e+" li").bind("touchstart",function(c){c.reservedata=a;c.btntitle=c.target.title;null!=b.action&&b.action(c);c.stopPropagation()})):($(document).bind("mousedown",function(a){1==a.which&&c.Show(!1)}),$("#"+e+" li").bind("mousedown",function(c){c.reservedata=a;c.btntitle=c.target.title;null!=b.action&&b.action(c)}))};this.SetReserve=function(b){a=b};this.GetReserve=function(){return a};this.Destroy=function(){$("#"+e).remove()};c.Create();c.UpdateStyle();c.AddEvent();!0};CBoBo.View.Scroll=function(d){this.opt=$.extend(!0,{parent:null,axis:"y",showbutton:!0,size:20,range:100,offset:0,railalign:"center",msgtransform:null},d);this.arrClass={};this.rangeMap=this.draggerPos=1;this.stack=[];null!=this.opt.parent&&(this.Create(),this.UpdateStyle(),this.AddEvent());!0};CBoBo.View.Scroll.prototype.GetId=function(d){switch(d){case "ctrl":return this.arrClass.ctrl=CBoBo.Plugin.GetRandom();case "buttonl_t":return this.arrClass.buttonl_t;case "buttonr_b":return this.arrClass.buttonr_b;case "container":return this.arrClass.container;case "dragger_bar":return this.arrClass.dragger_bar;case "dragger":return this.arrClass.dragger;case "dragger_rail":return this.arrClass.dragger_rail}};CBoBo.View.Scroll.prototype.Create=function(){this.arrClass.ctrl=CBoBo.Plugin.GetRandom();this.arrClass.buttonl_t=CBoBo.Plugin.GetRandom();this.arrClass.buttonr_b=CBoBo.Plugin.GetRandom();this.arrClass.container=CBoBo.Plugin.GetRandom();this.arrClass.dragger_bar=CBoBo.Plugin.GetRandom();this.arrClass.dragger=CBoBo.Plugin.GetRandom();this.arrClass.dragger_rail=CBoBo.Plugin.GetRandom();var d,a;"x"==this.opt.axis?(d="\x26#xe6d5;",a="\x26#xe6d6;"):"y"==this.opt.axis&&(d="\x26#xe6d7;",a="\x26#xe6d4;");d=$("\x3cdiv id\x3d'"+this.arrClass.ctrl+"' class\x3d'icon-player'\x3e\x3cspan id\x3d'"+this.arrClass.buttonl_t+"'\x3e"+d+"\x3c/span\x3e\x3cdiv id\x3d'"+this.arrClass.container+"'\x3e\x3cdiv id\x3d'"+this.arrClass.dragger_bar+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrClass.dragger+"'\x3e\x3cdiv id\x3d'"+this.arrClass.dragger_rail+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan id\x3d'"+this.arrClass.buttonr_b+"'\x3e"+a+"\x3c/span\x3e\x3c/div\x3e").appendTo(this.opt.parent);d.css({position:"absolute","background-color":"#333333",color:"rgba(255,255,255,0.3)"});return d};CBoBo.View.Scroll.prototype.SetRange=function(d,a){isNaN(d)||1>d||(this.rangeMap=d,void 0==a&&(a=1),this.draggerPos=a,this.UpdateStyle(),this.UpdateBtnStatus())};CBoBo.View.Scroll.prototype.UpdateStyle=function(){var d=$(this.opt.parent);if(void 0!=d){var a=$("#"+this.arrClass.ctrl),b=$("#"+this.arrClass.buttonl_t),c=$("#"+this.arrClass.buttonr_b),e=$("#"+this.arrClass.container),f=$("#"+this.arrClass.dragger_bar),g=$("#"+this.arrClass.dragger),h=$("#"+this.arrClass.dragger_rail);if("x"==this.opt.axis)h=d.width()*this.opt.range/100>>0,a.width(h).height(this.opt.size),h=d.width()-h>>1,a.css({left:h+"px",bottom:this.opt.offset+"px"});else if("y"==this.opt.axis){var k=d.height()*this.opt.range/100>>0;a.width(this.opt.size).height(k);d=d.height()-k>>1;a.css({top:d+"px",right:this.opt.offset+"px"});CBoBo.IsTablet?(b.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":"18px",position:"relative",Top:"0px"}),c.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":"18px",position:"relative",bottom:"8px"})):(b.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":this.opt.size+"px"}),c.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":this.opt.size+"px",position:"absolute",bottom:"0px"}));a=k-(this.opt.size<<1)-4;e.width(this.opt.size).height(a).css({position:"relative"});e=a-2;CBoBo.IsTablet&&(e=a-10);f.width(this.opt.size).height(e).css({"border-top":"1px solid #000","border-bottom":"1px solid #000"});a=e/this.rangeMap>>0;a=10>a?10:a;f=(this.draggerPos-1)/(this.rangeMap-1)*(e-a)+1;g.width(this.opt.size).height(a).css({position:"absolute",top:f+"px"});g=this.opt.size-5;h.width(g).height(a).css({"background-color":"rgba(255,255,255,0.2)","border-radius":"1px"});switch(this.opt.railalign){case "center":h.css({position:"absolute",left:(this.opt.size-g)/2+"px"})}}}};CBoBo.View.Scroll.prototype.AddEvent=function(){function d(b){switch(b.type){case "touchstart":case "mousedown":a(b);break;case "touchmove":case "mousemove":if(e.stack[0]){var c=e.GetId("dragger_rail");$("#"+c).triggerHandler("mouseenter");e.evenType=b.type;var d;"touchmove"==b.type?(b=b.originalEvent.targetTouches[0],"y"==e.opt.axis?d=b.pageY-e.stack[1]+e.stack[2]:"x"==e.opt.axis&&(d=b.pageX-e.stack[1]+e.stack[2])):"mousemove"==b.type&&("y"==e.opt.axis?d=b.pageY-e.stack[1]+e.stack[2]:"x"==e.opt.axis&&(d=b.pageX-e.stack[1]+e.stack[2]));d=d>e.stack[3]?e.stack[3]:d;d=1>d?1:d;"y"==e.opt.axis?e.stack[4].css("top",d+"px"):"x"==e.opt.axis&&e.stack[4].css("left",d+"px");e.draggerPos=Math.round(d/(e.stack[3]/(e.rangeMap-1)))+1;f!=e.draggerPos&&(e.UpdateBtnStatus(),f=e.draggerPos,e.opt.msgtransform({type:"scroll",value:e.draggerPos,scroll:e}))}break;case "touchend":case "mouseup":if(!(1>e.stack)){for(d=0;5>d;d++)e.stack.pop();d=e.GetId("dragger_rail");$("#"+d).triggerHandler("mouseout")}}}function a(a){var b,c;if("touchstart"==a.type){var d=a.originalEvent.targetTouches[0];b=d.pageX;c=d.pageY}else"mousedown"==a.type&&(b=a.pageX,c=a.pageY);var d=$("#"+e.arrClass.dragger),f=d.position(),g=$("#"+e.arrClass.dragger_bar);e.stack.push(!0);"y"==e.opt.axis?(e.stack.push(c),e.stack.push(f.top),b=g.height()-d.height(),e.stack.push(b)):"x"==e.opt.axis&&(e.stack.push(b),e.stack.push(f.left),b=g.width()-d.width(),e.stack.push(b));e.stack.push(d);a.stopPropagation()}function b(a){var b=e.draggerPos;"lt"==a?(e.draggerPos--,e.draggerPos=1>e.draggerPos?1:e.draggerPos):"rb"==a&&(e.draggerPos++,e.draggerPos=e.draggerPos>e.rangeMap?e.rangeMap:e.draggerPos);b!=e.draggerPos&&(e.FlushDraggerPos(),e.UpdateBtnStatus(),e.opt.msgtransform({type:"scroll",value:e.draggerPos,scroll:e}))}function c(a){var b,c;"touchstart"==a.type?(c=a.originalEvent.targetTouches[0],b=c.pageX,c=c.pageY):"mousedown"==a.type&&(b=a.pageX,c=a.pageY);a=$("#"+e.arrClass.dragger);var d=$("#"+e.arrClass.dragger_bar),f,g=1;"y"==e.opt.axis?(f=d.height()-a.height(),g=c-$("#"+e.arrClass.container).offset().top-a.height()/2+1,g=1>g?1:g,g=g>f?f:g,a.css("top",g+"px")):"x"==e.opt.axis&&(f=d.width()-a.width(),g=b-$("#"+e.arrClass.container).offset().left-a.width()/2+1,g=1>g?1:g,g=g>f?f:g,a.css("left",g+"px"));e.draggerPos=Math.ceil(g/f*e.rangeMap);e.UpdateBtnStatus();e.opt.msgtransform({type:"scroll",value:e.draggerPos,scroll:e})}var e=this;$(window).bind("resize",function(a){e.UpdateStyle()});CBoBo.Plugin.GetBrowserInfo().isMobile?($("#"+this.arrClass.dragger).bind("touchstart",d),$(document).bind("touchmove touchend",d),$("#"+this.arrClass.buttonl_t).bind("touchstart",function(a){b("lt")}),$("#"+this.arrClass.buttonr_b).bind("touchstart",function(a){b("rb")}),$("#"+this.arrClass.container).bind("touchstart",function(b){c(b);a(b)})):($("#"+this.arrClass.dragger).bind("touchstart",d),$(document).bind("touchmove touchend",d),$("#"+this.arrClass.container).bind("touchstart",function(b){c(b);a(b)}),$("#"+this.arrClass.dragger).bind("mousedown",d),$(document).bind("mousemove mouseup",d),$("#"+this.arrClass.dragger_rail).bind("mouseenter mouseout",function(a){"mouseenter"==a.type?$(this).css({cursor:"pointer","background-color":"rgba(255,255,255,0.3)"}):"mouseout"==a.type&&$(this).css({cursor:"default","background-color":"rgba(255,255,255,0.2)"})}),$("#"+this.arrClass.buttonl_t).bind("mousedown",function(a){"mousedown"==a.type&&b("lt")}),$("#"+this.arrClass.buttonr_b).bind("mousedown",function(a){"mousedown"==a.type&&b("rb")}),$("#"+this.arrClass.container).bind("mousedown",function(b){c(b);a(b)}));var f=1};CBoBo.View.Scroll.prototype.FlushDraggerPos=function(d){void 0!=d&&(this.draggerPos=d);d=$("#"+this.arrClass.dragger);var a=$("#"+this.arrClass.dragger_bar);"y"==this.opt.axis?(a=a.height()-d.height(),d.css("top",(this.draggerPos-1)/(this.rangeMap-1)*a+1+"px")):"x"==this.opt.axis&&(a=a.width()-d.width(),d.css("left",(this.draggerPos-1)/(this.rangeMap-1)*a+1+"px"))};CBoBo.View.Scroll.prototype.TriggerClick=function(d){id=0<d?this.GetId("buttonl_t"):this.GetId("buttonr_b");$("#"+id).triggerHandler("mousedown")};CBoBo.View.Scroll.prototype.TriggerDragger=function(d){this.FlushDraggerPos(d);this.UpdateBtnStatus();this.opt.msgtransform&&this.opt.msgtransform({type:"scroll",value:d,scroll:this})};CBoBo.View.Scroll.prototype.Enable=function(d){var a=$("#"+this.arrClass.ctrl),b=$("#"+this.arrClass.dragger);d?(a.css({"pointer-events":"auto"}),b.show()):(a.css({"pointer-events":"none"}),b.hide())};CBoBo.View.Scroll.prototype.UpdateBtnStatus=function(){var d=$("#"+this.arrClass.buttonl_t),a=$("#"+this.arrClass.buttonr_b);1==this.draggerPos?(d.css({color:"rgba(255,255,255,0.1)","pointer-events":"none"}),a.css({color:"rgba(255,255,255,0.3)","pointer-events":""})):this.draggerPos==this.rangeMap?(d.css({color:"rgba(255,255,255,0.3)","pointer-events":""}),a.css({color:"rgba(255,255,255,0.1)","pointer-events":"none"})):(d.css({color:"rgba(255,255,255,0.3)","pointer-events":""}),a.css({color:"rgba(255,255,255,0.3)","pointer-events":""}))};CBoBo.View.Msg=function(d){function a(a,b){var c=CBoBo.Plugin.GetRandom();(function(){var e;switch(b){case CBoBo.MSG_SUCCESS:e="\x26#xe63c;";break;case CBoBo.MSG_ERROR:e="\x26#xe686;";break;default:e="\x26#xe628;"}d("\x3cdiv id\x3d'"+c+"'\x3e\x3cspan class\x3d'icon_tool'\x3e"+e+"\x3c/span\x3e\x3cspan\x3e"+a+"\x3c/span\x3e\x3c/div\x3e").appendTo(d("body"))})();(function(){var a=d("#"+c),e,f;switch(b){case CBoBo.MSG_SUCCESS:e="#058912";f="#08ED1F";break;case CBoBo.MSG_ERROR:e="#F0120A";f="#F0524D";break;default:e="#FAF003",f="#525503"}a.css({position:"absolute",right:"10px",background:e,height:"50px","box-shadow":"0 0 10px "+f,padding:"5px","border-radius":"5px","pointer-events":"none","z-index":"9999999999999999",overflow:"hidden"});a=d("#"+c+" span");a.css({color:"#000",height:"50px","font-weight":"bold",display:"flex","align-items":"center","float":"left"});a.eq(0).css({"font-size":"35px","padding-right":"5px",color:f})})();this.Width=function(){return d("#"+c).width()+10};this.Height=function(){return d("#"+c).height()+10};this.SetBottom=function(a){d("#"+c).css({bottom:a+"px"})};this.Destroy=function(){var a=d("#"+c);void 0!=a&&(a.fadeOut(500),setTimeout(function(){a.remove()},500))};this.GetId=function(){return c}}function b(a){var b,c=CBoBo.Plugin.GetRandom(),f=function(a){var b=d("#"+c);b.fadeOut(3E3);setTimeout(function(){b.remove();e=void 0},3E3)};d("\x3cdiv id\x3d'"+c+"'\x3e\x3cspan\x3e"+a+"\x3c/span\x3e\x3c/div\x3e").appendTo(d("body")).css({position:"absolute",bottom:"2px",color:"#33FFFF","pointer-events":"none",padding:"0 2px","z-index":"99999"});b=setTimeout(f,3E3);this.Print=function(a){d("#"+c+" span").html(a);void 0!=b&&clearTimeout(b);b=setTimeout(f,3E3)}}var c=new function(){this.ctrl=CBoBo.Plugin.GetRandom();var a=[],b=function(b){setTimeout(function(b){var c=b.GetId();d.each(a,function(d,e){if(void 0!=e){var f=e.GetId();c==f&&(b.Destroy(),a.splice(d,1))}})},4E3,b)};this.Push=function(c){a.push(c);b(c);var e=0,f=d("body").height();c=-1;for(var g=a.length-1;-1<g;g--){var h=a[g],e=e+h.Height();if(e>f){c=g;break}}e=10;for(g=c+1;g<a.length;g++)h=a[g],h.SetBottom(e),e+=h.Height()+5;for(g=0;g<c+1;g++)h=a[g],h.Destroy();a.splice(0,c+1)};this.Length=function(){return a.length}},e;d.extend({Msg:function(b,d){c.Push(new a(b,d))},Status:function(a){void 0==e?e=new b(a):e.Print(a)}})}(jQuery);CBoBo.View.AI=function(d){this.bShow;this.isAIFinished=this.isAIReuest=!1;var a=$.extend(!0,{parent:null},d),b=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var c=$("#"+b),d=$(a.refrence),f=d.width(),d=d.height();c.width(f).height(d)};this.Show=function(a){var c=$("#"+b);a?(this.bShow=!0,c.hide(),c.fadeIn(400)):(this.bShow=!1,c.fadeOut(400))};$("\x3cdiv id\x3d'"+b+"'\x3e\x3c/div\x3e").appendTo($(a.refrence)).css({position:"absolute","z-index":1003,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"});this.UpdateStyle();d.parent="#"+b;d.aiRead=!0;this.secondCtrl=new CBoBo.View.CMngSecondLayer(d)};CBoBo.View.MPR=function(d){this.bShow;var a=null,b={mode:CBoBo.PTYPE_SERIES,parent:"body",msgtransform:null},c;this.bMsg;var e=$.extend(!0,b,d),f=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var a=$("#"+f),b=$(e.parent),c=b.width(),b=b.height();a.width(c).height(b).css({left:"10px",top:"10px"})};this.Show=function(a){var b=$("#"+f);a?(this.bShow=!0,b.hide(),b.fadeIn(400)):(this.bShow=!1,b.fadeOut(400))};this.Series=function(b){if(void 0==b)return a;a=b;this.bMsg=!0};this.SetLayout=function(a){c!==a&&(3===a?(this.mng.UpdateLayoutSp3(0,"left"),this.mng.SetSpBoundaryColor(0,"#F00"),this.mng.SetSpBoundaryColor(1,"#0F0"),this.mng.SetSpBoundaryColor(2,"#00F")):4===a&&(this.mng.UpdateLayout(0,2,2),this.mng.SetSpBoundaryColor(0,"#F00"),this.mng.SetSpBoundaryColor(1,"#0F0"),this.mng.SetSpBoundaryColor(2,"#00F"),this.mng.SetSpBoundaryColor(3,"#FF0")),c=a)};(function(){var a=$("\x3cdiv id\x3d'"+f+"'\x3e\x3c/div\x3e").appendTo($(e.parent));void 0!=a&&a.css({position:"absolute","z-index":10001,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"})})();this.UpdateStyle();this.mng=new CBoBo.View.CMngFirstLayer({parent:"#"+f,single:!0,msgtransform:e.msgtransform})};CBoBo.View.DicomScan=function(d){var a=this,b=$.extend(!0,{msgtransform:null},d),c={};this.bShow;var e=function(a,b,d,e){void 0==e&&(e="\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;");b+=e;c.key||(c.key=CBoBo.Plugin.GetRandom());c.value||(c.value=CBoBo.Plugin.GetRandom());$("\x3cdiv\x3e\x3cspan class\x3d'icon_tool tool-item 1604335943322'\x3e"+b+"\x3c/span\x3e\x3cspan class\x3d'"+c.value+"'\x3e"+d+"\x3c/span\x3e\x3c/div\x3e").appendTo($(a)).css({height:"25px","margin-left":"20px"});b=$("."+c.key);b.css({color:"#FFF","font-size":"16px"});d=$("."+c.value);d.css({color:"#DDD","font-size":"14px"})};this.Show=function(a){var b=$("#"+c.ctrl);a?(b.fadeIn(300),this.bShow=!0):(b.fadeOut(800),this.bShow=!1)};this.SetDicomInfo=function(a){var b="#"+c.container;$(b).html("");a&&(e(b,"0008,0018",a.sopuid),e(b,"0008,0020",a.studt),e(b,"0008,0022",a.acqdt),e(b,"0008,0030",a.stutm),e(b,"0008,0032",a.acqtm),e(b,"0008,0050",a.accnum),e(b,"0008,0060",a.mod),e(b,"0008,0070",a.manu),e(b,"0008,0080",a.inst),e(b,"0008,1030",a.studes),e(b,"0008,103E",a.serdes),e(b,"0010,0010",a.name),e(b,"0010,0020",a.patid),e(b,"0010,0030",a.birth),e(b,"0010,0040",a.sex),e(b,"0010,1010 ",a.age),e(b,"0018,0050",a.sliceth),e(b,"0018,0060",a.kv),e(b,"0018,1151",a.ma),e(b,"0020,0010",a.stuid),e(b,"0020,000D",a.stuuid),e(b,"0020,000E",a.seruid),e(b,"0020,0011",a.serid),e(b,"0020,0013",a.imgnum),e(b,"0028,0002",a.sappix),e(b,"0028,0004",a.phme),e(b,"0028,0010",a.row),e(b,"0028,0011",a.col),e(b,"0028,0030",a.pixx+"/"+a.pixy),e(b,"0028,0100",a.bita),e(b,"0028,0101",a.bits),e(b,"0028,0102",a.hbit),e(b,"0028,0103",a.pixrep),e(b,"0028,1050",a.wc),e(b,"0028,1051",a.ww),e(b,"0028,1052",a.rescin),e(b,"0028,1053",a.rescsl),e(b,"\u56fe\u50cf\u65b9\u4f4d\u5de6",a.orl),e(b,"\u56fe\u50cf\u65b9\u4f4d\u4e0a",a.ort),e(b,"\u56fe\u50cf\u65b9\u4f4d\u53f3",a.orr),e(b,"\u56fe\u50cf\u65b9\u4f4d\u4e0b",a.orb));$("#"+c.container).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"})};c.ctrl=CBoBo.Plugin.GetRandom();c.title=CBoBo.Plugin.GetRandom();c.container=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+c.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+c.title+"'\x3e\x3cspan\x3eDicom\u4fe1\u606f\x3c/span\x3e\x3ca\x3e\x26#xe661;\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));(function(){var a=$(window).width(),b=$(window).height(),a=.5*a>>0,a=600>a?600:a,b=.9*b>>0,b=300>b?300:b;$("#"+c.ctrl).width(a).height(b).css({border:"1px solid #676767",position:"absolute","z-index":11111,background:"#444444",display:"none","user-select":"none",color:"#CCCCC4"});$("#"+c.title).css({height:"30px",width:"100%",background:"#555555",cursor:"default","border-bottom":"1px solid #000","text-align":"center"});$("#"+c.title+" span").css({width:"15%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+c.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+c.container).width(a-6).height(b-6-30).css({"user-select":"auto",padding:"3px","font-family":"Microsoft YaHei",overflow:"auto"})})();(function(){var d=!1,e,h,k=$("#"+c.ctrl);$("#"+c.title).bind("mousedown",function(a){d=!0;e=new Point(a.pageX,a.pageY);a=k.offset();h=new Point(a.left,a.top)});$("#"+c.title+" a").bind("click",function(c){c.preventDefault();a.Show(!1);b.msgtransform&&(c.btntitle="DICOM\u4fe1\u606f",c.btnforce=!1,b.msgtransform(c));setTimeout(function(){k.remove()},800)});$(document).bind("mousemove mouseup",function(a){switch(a.type){case "mousemove":d&&k.css({left:a.pageX-e.x+h.x+"px",top:a.pageY-e.y+h.y+"px"});break;case "mouseup":d=!1}})})();(function(){var a=$("body"),b=$("#"+c.ctrl),d=a.width(),a=a.height(),e=b.width(),l=b.height();b.css({left:(d-e>>1)+"px",top:(a-l>>1)+"px"})})()};CBoBo.View.AutoScroll=function(d){};CBoBo.View.Config=function(){var d={};this.bShow=!1;var a,b=0,c=function(){var a=$("body"),b=a.width(),c=a.height(),a=$("#"+d.ctrl);1150>b&&(b=1150);a.width(b).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({top:CBoBo.View.TOOLBAR_HEIGHT});var e=$("#"+d.left),a=.08*b;97>a&&(a=97);e.width(a).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({display:"inline-block"});$("#"+d.right).width(b-a-2).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({background:"#333333",display:"inline-block",position:"relative"});b=$("."+d.headbtn);c=.12*a;b.width(a).height(60).css({"border-bottom":"1px solid #383838","line-height":"60px",cursor:"pointer","font-size":c+"px",color:"#efefef"});$("."+d.headbtnicon).css({"font-size":1.5*c+"px","vertical-align":"middle",color:"#ccc"});$("."+d.headbtn+" span").css({"pointer-events":"none",padding:"4px"})};this.TriggerResize=function(){c();a&&a()};var e=function(){function a(a){k(a,"\u5e73\u79fb","translation");k(a,"\u7a97\u5bbd\u7a97\u4f4d","wwwc");k(a,"\u7ffb\u9875","page");k(a,"\u7f29\u653e","zoom");k(a,"\u91ca\u653e","release")}var b="CT",c={},e=function(){$("#"+c.ctrl).css({width:"50%",height:"100%",position:"absolute",top:0,left:"60px",overflow:"hidden","font-family":"Microsoft Yahei"});$("#"+c.selmodality).css({height:"100%",width:"20%",display:"inline-block","padding-top":"10px"});$("#"+c.main).css({height:"100%",width:"70%",display:"inline-block","margin-left":"10%","padding-top":"10px"});$("#"+c.radio).css({height:"20%",width:"100%"});$("#"+c.checkbox).css({height:"20%",width:"100%"});$("#"+c.layout).css({width:"100%"})},f=function(a,b){var c=CBoBo.Config.GetSeriesLayout(a,b);$("input:radio[name\x3d'serieslayout']").each(function(){var a=$(this).prev();this.value===c?(this.checked=!0,a.css("color","#F0F")):(this.checked=!1,a.css("color","#FFF"))});c=CBoBo.Config.GetImageLayout(a,b);$("input:radio[name\x3d'imagelayout']").each(function(){var a=$(this).prev();this.value===c?(this.checked=!0,a.css("color","#F0F")):(this.checked=!1,a.css("color","#FFF"))})},g=function(a){var b=CBoBo.Config.GetImageShowMode(a);$("input:radio[name\x3d'imageshow']").each(function(){this.checked=this.value===b?!0:!1});var d=CBoBo.Config.GetThumbPosition(a);$("input:radio[name\x3d'thumbposition']").each(function(){this.checked=this.value===d?!0:!1});var e=CBoBo.Config.GetMouseLeft(a);$(c.mouseLeft).val(e);e=CBoBo.Config.GetMouseRight(a);$(c.mouseRight).val(e);e=CBoBo.Config.GetMouseMiddle(a);$(c.mouseMiddle).val(e);e=CBoBo.Config.GetMouseMiddleRoll(a);$(c.mouseMiddleRoll).val(e);$(c.platform).val("pc");f(a,"pc")},l=function(a,c){switch(a){case "imageshow":CBoBo.Config.SetImageShowMode(b,c);break;case "thumbposition":CBoBo.Config.SetThumbPosition(b,c)}};c.ctrl=CBoBo.Plugin.GetRandom();c.selmodality=CBoBo.Plugin.GetRandom();c.main=CBoBo.Plugin.GetRandom();c.radio=CBoBo.Plugin.GetRandom();c.checkbox=CBoBo.Plugin.GetRandom();c.layout=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+c.ctrl+"'\x3e\x3cdiv id\x3d'"+c.selmodality+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.main+"'\x3e\x3cdiv id\x3d'"+c.radio+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.checkbox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.layout+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+d.right));e();!function(){var d="#"+c.selmodality;c.modality=d="#"+h(d,"\u8bbe\u5907\u7c7b\u578b",{},function(a){b=a;g(a)});k(d,"CT","CT");k(d,"PT","PT");k(d,"MR","MR");k(d,"XR","XR");k(d,"OTHER","OTHER");d="#"+c.radio;n(d,"\u56fe\u50cf\u9ed8\u8ba4\u663e\u793a",{width:"100%",height:"30px"});var e="imageshow";z(d,e,"\u6b63\u5e38\uff08\u9ed8\u8ba4\uff09","normal",{"margin-left":"20px"},function(a){l("imageshow",a.target.value)});z(d,e,"\u53cd\u8272","inverse",{"margin-left":"10px"},function(a){l("imageshow",a.target.value)});n(d,"\u7f29\u7565\u56fe\u4f4d\u7f6e",{width:"100%","margin-top":"30px",height:"30px"});e="thumbposition";z(d,e,"\u81ea\u52a8\uff08\u9ed8\u8ba4\uff09","auto",{"margin-left":"20px"},function(a){l("thumbposition",a.target.value)});z(d,e,"\u5de6\u8fb9\u663e\u793a","left",{"margin-left":"10px"},function(a){l("thumbposition",a.target.value)});z(d,e,"\u4e0b\u65b9\u663e\u793a","bottom",{"margin-left":"10px"},function(a){l("thumbposition",a.target.value)});pid="#"+c.checkbox;n(pid,"\u9ed8\u8ba4\u9f20\u6807\u914d\u7f6e",{width:"100%",height:"30px"});c.mouseLeft=d="#"+h(pid,"\u5de6\u952e",{width:"40%",height:"30px","margin-left":"20px"},function(a){CBoBo.Config.SetMouseLeft(b,a)});a(d);c.mouseRight=d="#"+h(pid,"\u53f3\u952e",{width:"40%",height:"30px"},function(a){CBoBo.Config.SetMouseRight(b,a)});a(d);c.mouseMiddle=d="#"+h(pid,"\u4e2d\u952e",{width:"40%",height:"30px","margin-left":"20px"},function(a){CBoBo.Config.SetMouseMiddle(b,a)});a(d);c.mouseMiddleRoll=d="#"+h(pid,"\u6eda\u8f6e",{width:"40%",height:"30px"},function(a){CBoBo.Config.SetMouseMiddleRoll(b,a)});k(d,"\u7ffb\u9875","page");k(d,"\u7f29\u653e","zoom");pid="#"+c.layout;n(pid,"\u9ed8\u8ba4\u5e03\u5c40\u914d\u7f6e",{width:"100%",height:"30px"});c.platform=d="#"+h(pid,"\u4f7f\u7528\u8bbe\u5907",{"margin-left":"20px"},function(a){f(b,a)});k(d,"PC","pc");k(d,"IPAD","ipad");k(d,"IPHONE","iphone");k(d,"OTHER","other");n(pid,"\u5e8f\u5217\u5e03\u5c40",{width:"100%",height:"30px","margin-left":"40px","margin-top":"20px"});d={parent:pid,iconstr:"\x26#xe667;",title:"1*1",name:"serieslayout",value:"1*1",exstyle:{"margin-left":"40px","margin-top":"10px"},iconstyle:{"font-size":"27px"},change:function(a){CBoBo.Config.SetSeriesLayout(b,$(c.platform).val(),a)}};A(d);d.value=d.title="2*1";d.iconstr="\x26#xe66f;";A(d);d.value=d.title="1*2";d.iconstyle.transform="rotate(90deg)";A(d);d.value=d.title="2*2";d.iconstr="\x26#xe66b;";d.iconstyle.transform="";A(d);d.value=d.title="2*3";d.iconstr="\x26#xe668;";A(d);d.value=d.title="3*2";d.iconstr="\x26#xe668;";d.iconstyle.transform="rotate(90deg)";A(d);d.value=d.title="3*3";d.iconstr="\x26#xe665;";d.iconstyle.transform="";A(d);n(pid,"\u56fe\u50cf\u5e03\u5c40",{width:"100%",height:"30px","margin-left":"40px","margin-top":"20px"});d={parent:pid,iconstr:"\x26#xe667;",title:"1*1",name:"imagelayout",value:"1*1",exstyle:{"margin-left":"40px","margin-top":"10px"},iconstyle:{"font-size":"27px"},change:function(a){CBoBo.Config.SetImageLayout(b,$(c.platform).val(),a)}};A(d);d.value=d.title="2*1";d.iconstr="\x26#xe66f;";A(d);d.value=d.title="1*2";d.iconstyle.transform="rotate(90deg)";A(d);d.value=d.title="2*2";d.iconstr="\x26#xe66b;";d.iconstyle.transform="";A(d);d.value=d.title="2*3";d.iconstr="\x26#xe668;";A(d);d.value=d.title="3*2";d.iconstr="\x26#xe668;";d.iconstyle.transform="rotate(90deg)";A(d);d.value=d.title="3*3";d.iconstr="\x26#xe665;";d.iconstyle.transform="";A(d)}();(function(a){$(c.modality).val(a);g(a)})(b);return e},f=function(){var a="CT",c={},e=function(){var a=$("#"+c.lt),b=$("#"+c.rt),d=$("#"+c.rb),e=$("#"+c.lb),g=$("#"+c.center),q=$("#"+c.left),h=$("#"+c.right),k=$("#"+c.centerHead),t=$("#"+c.centerHead+" span"),u=$("#"+c.centerContainer),l=$("."+c.itemhead),G=$("."+c.itemhead+" span"),m=$("."+c.itemHeadName),n=$("."+c.itemHeadOparete),y=$("#"+c.left_modalty),r=$("#"+c.left_fontStyle),p=h.parent(),x=p.width(),C=x/6|0,p=p.height();q.width(C).height(p).css({display:"inline-block"});h.width(x-C-1).height(p).css({display:"inline-block",position:"relative"});p=a.parent();C=((p.width()-20)/3|0)-2;p=((p.height()-10)/2|0)-2;a.width(C).height(p).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:0,top:0});g.width(C).height(2*p+10).css({position:"absolute",left:C+10,top:0});b.width(C).height(p).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:2*(C+10),top:0});d.width(C).height(p).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:2*(C+10),top:p+10});e.width(C).height(p).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:0,top:p+10});f();k.css({"font-family":"Microsoft YaHei",width:"100%",height:"25px",background:"#222",cursor:"default","font-size":"17px"});t.css({color:"#efefef",display:"inline-block",height:"100%"});t.eq(0).css({width:"30%"});t.eq(1).css({width:"50%"});t.eq(2).css({width:"20%","text-align":"center"});u.height(u.parent().height()-20).css({width:"100%"});v();l.css({"font-family":"Microsoft YaHei",width:"100%",height:"25px",background:"#222",cursor:"default","font-size":"17px",color:"#efefef"});G.css({display:"inline-block",height:"100%"});m.css({width:"80%"});n.css({width:"20%","text-align":"center"});y.height(74).css({width:"90%","margin-left":"10%"});a=r.parent().height();r.height(a-86).css({width:"90%","margin-left":"10%","border-top":"1px solid #222","margin-top":"10px"})},f=function(){var a=$("#"+c.lt),d=$("#"+c.rt),e=$("#"+c.rb),f=$("#"+c.lb);a.css({"border-color":"#666"});d.css({"border-color":"#666"});e.css({"border-color":"#666"});f.css({"border-color":"#666"});switch(b){case 0:a.css({"border-color":"#0ff"});break;case 1:d.css({"border-color":"#0ff"});break;case 2:e.css({"border-color":"#0ff"});break;case 3:f.css({"border-color":"#0ff"})}},g=function(){switch(b){case 0:return"lt";case 1:return"rt";case 2:return"rb";case 3:return"lb"}},l=function(a,b){void 0===c.centerContainerItem&&(c.centerContainerItem=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemTag&&(c.centerContainerItemTag=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemName&&(c.centerContainerItemName=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemTool&&(c.centerContainerItemTool=CBoBo.Plugin.GetRandom());var d=CBoBo.Plugin.GetRandom();$("\x3cdiv class\x3d'"+c.centerContainerItem+" config-conerinfoitem'\x3e\x3cspan class\x3d'"+c.centerContainerItemTag+"' title\x3d'"+a+"'\x3e"+a+"\x3c/span\x3e\x3cspan class\x3d'"+c.centerContainerItemName+"' title\x3d'"+b+"'\x3e"+b+"\x3c/span\x3e\x3cspan class\x3d'"+c.centerContainerItemTool+" icon_tool' title\x3d'\u589e\u52a0\u5230\u6307\u5b9a\u5217\u8868' id\x3d'"+d+"'\x3e\x26#xe6ca;\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+c.centerContainer)).bind("dblclick",a,function(a){m(a.data)});$("#"+d).bind("click dblclick",a,function(a){"dblclick"===a.type?(a.stopPropagation(),a.preventDefault()):m(a.data)})},m=function(d){var e;switch(b){case 0:e=c.ltContainer;break;case 1:e=c.rtContainer;break;case 2:e=c.rbContainer;break;case 3:e=c.lbContainer}var f=CBoBo.Config.PushCornerInfoItem(a,g(),d);f?$.Msg(f):(r(e,d),d=CBoBo.Config.GetCornerInfoFontColor(),e=CBoBo.Config.GetCornerInfoFontFamily(),p(d,e))},v=function(){$("."+c.centerContainerItem).height(20).css({"font-family":"Microsoft YaHei",cursor:"default",margin:"4px 0"});$("."+c.centerContainerItem+" span").css({display:"inline-block",height:"100%","line-height":"20px"});$("."+c.centerContainerItemTag).css({color:"#aaa",width:"30%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.centerContainerItemName).css({color:"#FFF",width:"50%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.centerContainerItemTool).css({color:"#0f0",width:"20%","text-align":"center",cursor:"pointer"})},r=function(a,b){void 0===c.item&&(c.item=CBoBo.Plugin.GetRandom());void 0===c.itemName&&(c.itemName=CBoBo.Plugin.GetRandom());void 0===c.itemDelete&&(c.itemDelete=CBoBo.Plugin.GetRandom());var d=CBoBo.Plugin.GetRandom(),e=CBoBo.Dicom.GetTagData(b);if(void 0!==e){var e=e.name,f={id:a,tag:b};$("\x3cdiv class\x3d'"+c.item+" config-conerinfoitem'\x3e\x3cspan class\x3d'"+c.itemName+"' title\x3d'"+e+"'\x3e"+e+"\x3c/span\x3e\x3cspan class\x3d'"+c.itemDelete+" icon_tool' title\x3d'\u5220\u9664\u8be5\u9879' id\x3d'"+d+"'\x3e\x26#xe653;\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+a)).bind("dblclick",f,function(a){q(a.data.id,a.data.tag.toString())});$("#"+d).bind("click dblclick",f,function(a){"dblclick"===a.type?(a.stopPropagation(),a.preventDefault()):q(a.data.id,a.data.tag.toString())})}},p=function(a,b){void 0===a&&(a="#efefef");void 0===b&&(b="Microsoft YaHei");$("."+c.item).height(20).css({"font-family":b,cursor:"default",margin:"4px 0"});$("."+c.item+" span").css({display:"inline-block",height:"100%","line-height":"20px"});$("."+c.itemName).css({color:a,width:"80%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.itemDelete).css({color:"#F00",width:"20%","text-align":"center",cursor:"pointer"})},q=function(b,d){var e=CBoBo.Dicom.GetTagData(d);if(void 0!==e&&CBoBo.Config.DeleteCornerInfoItem(a,g(),d)){var f=e.name;$("#"+b+" ."+c.item).each(function(){var a=$(this);a.children("."+c.itemName).html()===f&&a.remove()})}},t=function(){var a=c.ltContainer;$("#"+a).empty();a=c.rtContainer;$("#"+a).empty();a=c.rbContainer;$("#"+a).empty();a=c.lbContainer;$("#"+a).empty()},u=function(){var b=c.ltContainer,d=CBoBo.Config.GetCornerInfoItem(a,"lt");G(b,d);b=c.rtContainer;d=CBoBo.Config.GetCornerInfoItem(a,"rt");G(b,d);b=c.rbContainer;d=CBoBo.Config.GetCornerInfoItem(a,"rb");G(b,d);b=c.lbContainer;d=CBoBo.Config.GetCornerInfoItem(a,"lb");G(b,d);b=CBoBo.Config.GetCornerInfoFontColor();d=CBoBo.Config.GetCornerInfoFontFamily();p(b,d)},G=function(a,b){if(!(b instanceof Array))throw"PushItemByArray:array is not correct.";$.each(b,function(){r(a,this)})};(function(){c.ctrl=CBoBo.Plugin.GetRandom();c.left=CBoBo.Plugin.GetRandom();c.right=CBoBo.Plugin.GetRandom();c.lt=CBoBo.Plugin.GetRandom();c.rt=CBoBo.Plugin.GetRandom();c.rb=CBoBo.Plugin.GetRandom();c.lb=CBoBo.Plugin.GetRandom();c.center=CBoBo.Plugin.GetRandom();c.centerHead=CBoBo.Plugin.GetRandom();c.centerContainer=CBoBo.Plugin.GetRandom();c.itemhead=CBoBo.Plugin.GetRandom();c.itemHeadName=CBoBo.Plugin.GetRandom();c.itemHeadOparete=CBoBo.Plugin.GetRandom();c.lbContainer=CBoBo.Plugin.GetRandom();c.ltContainer=CBoBo.Plugin.GetRandom();c.rtContainer=CBoBo.Plugin.GetRandom();c.rbContainer=CBoBo.Plugin.GetRandom();c.left_modalty=CBoBo.Plugin.GetRandom();c.left_fontStyle=CBoBo.Plugin.GetRandom();var a="\x3cdiv class\x3d'"+c.itemhead+"'\x3e\x3cspan class\x3d'"+c.itemHeadName+"'\x3eName\x3c/span\x3e\x3cspan class\x3d'"+c.itemHeadOparete+"'\x3e\u64cd\u4f5c\x3c/span\x3e\x3c/div\x3e";$("\x3cdiv id\x3d'"+c.left+"'\x3e"+("\x3cdiv id\x3d'"+c.left_modalty+"'\x3e\x3c/div\x3e")+("\x3cdiv id\x3d'"+c.left_fontStyle+"'\x3e\x3c/div\x3e")+"\x3c/div\x3e\x3cdiv id\x3d'"+c.right+"'\x3e\x3cdiv id\x3d'"+c.lt+"'\x3e"+a+"\x3cdiv id\x3d'"+c.ltContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.center+"'\x3e"+("\x3cdiv id\x3d'"+c.centerHead+"'\x3e\x3cspan\x3eTag\x3c/span\x3e\x3cspan\x3eName\x3c/span\x3e\x3cspan\x3e\u64cd\u4f5c\x3c/span\x3e\x3c/div\x3e")+("\x3cdiv id\x3d'"+c.centerContainer+"'\x3e\x3c/div\x3e")+"\x3c/div\x3e\x3cdiv id\x3d'"+c.rt+"'\x3e"+a+"\x3cdiv id\x3d'"+c.rtContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.rb+"'\x3e"+a+"\x3cdiv id\x3d'"+c.rbContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.lb+"'\x3e"+a+"\x3cdiv id\x3d'"+c.lbContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+d.right))})();e();(function(){var a=$("#"+c.lt),d=$("#"+c.rt),e=$("#"+c.rb),g=$("#"+c.lb);a.bind("mousedown",function(a){b=0;f()});d.bind("mousedown",function(a){b=1;f()});e.bind("mousedown",function(a){b=2;f()});g.bind("mousedown",function(a){b=3;f()})})();(function(){var b="#"+c.left_modalty;n(b,"\u8bbe\u5907\u914d\u7f6e",{width:"100%",height:"30px"});b="#"+h(b,"\u5f71\u50cf",{"margin-left":"10px"},function(b){var d=$(c.modality).parent();"2D"===b?(d.css({visibility:""}),a=$(c.modality).val()):(d.css({visibility:"hidden"}),a=b);t();u()});k(b,"2D","2D");k(b,"Film","FILM");b="#"+c.left_modalty;c.modality=b="#"+h(b,"\u8bbe\u5907",{"margin-left":"10px"},function(b){a=b;t();u()});k(b,"CT","CT");k(b,"PT","PT");k(b,"MR","MR");k(b,"XR","XR");k(b,"OTHER","OTHER");b="#"+c.left_fontStyle;n(b,"\u5b57\u4f53\u8bbe\u7f6e",{width:"100%",height:"30px"});b="#"+h(b,"\u6837\u5f0f",{"margin-left":"10px"},function(a){CBoBo.Config.SetCornerInfoFontFamily(a);var b=CBoBo.Config.GetCornerInfoFontColor();p(b,a)});k(b,"Arial","Arial");k(b,"\u5fae\u8f6f\u96c5\u9ed1","Microsoft YaHei");k(b,"\u5b8b\u4f53","SimSun");k(b,"\u65b0\u5b8b\u4f53","NSimSun");k(b,"\u4eff\u5b8b_GB2312","FangSong_GB2312");k(b,"\u6977\u4f53_GB2312","KaiTi_GB2312");k(b,"\u9ed1\u4f53","SimHei");k(b,"Arial Black","Arial Black");k(b,"Times New Roman","Times New Roman");k(b,"Courier New","Courier New");k(b,"Tahoma","Tahoma");k(b,"Verdana","Verdana");var d=CBoBo.Config.GetCornerInfoFontFamily();$(b).val(d);b="#"+c.left_fontStyle;d=CBoBo.Config.GetCornerInfoFontColor();x(b,d,function(a){CBoBo.Config.SetCornerInfoFontColor(a);var b=CBoBo.Config.GetCornerInfoFontFamily();p(a,b)},{margin:"10px 0 0 10px"})})();(function(){void 0!==CBoBo.Dicom&&($.each(CBoBo.Dicom.GetTagData(),function(){l(this.tag,this.name)}),v(),$("#"+c.centerContainer).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"}))})();u();return e},g=function(){var a="CT",b={},c=function(){var c=b.bodyid;$(c).empty();var d=CBoBo.Config.GetPreWwWc(a),e;$.each(d,function(){e=[];e.push({title:this.title,width:"20%"});e.push({title:this.ww,width:"20%"});e.push({title:this.wc,width:"20%"});e.push({title:this.shortcutName,width:"20%"});p(c,e,this.id,f)});w()},e=function(a){switch(a){case 0:return"title";case 1:return"ww";case 2:return"wc";case 3:return"shortcut"}},f=function(b,c,d,f,g,q,h){switch(b){case "delete":CBoBo.Config.DeletePreWwWc(a,c);d.remove();break;case "modify":CBoBo.Config.ModalityPreWwWc(a,c,e(d),f,g,q,h)}};b.ctrl=CBoBo.Plugin.GetRandom();b.preWw=CBoBo.Plugin.GetRandom();b.shortcut=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+b.ctrl+"'\x3e\x3cdiv id\x3d'"+b.preWw+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.shortcut+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+d.right));(function(){var a=$("#"+b.ctrl),c=$("#"+b.preWw),d=$("#"+b.shortcut),e=a.parent().width();a.width(e-60).css({height:"100%",position:"absolute",top:0,left:"60px",overflow:"hidden","font-family":"Microsoft Yahei"});c.css({width:"30%",height:"100%",display:"inline-block"});d.css({width:"69%",height:"100%",display:"inline-block"})})();(function(){var d="#"+b.preWw;n(d,"\u9884\u8bbe\u7a97\u5bbd\u7a97\u4f4d",{width:"100%",height:"30px"});d="#"+h(d,"\u8bbe\u5907\u7c7b\u578b",{"margin-left":"20px"},function(b){a=b;c()});k(d,"CT","CT");k(d,"PT","PT");k(d,"MR","MR");k(d,"XR","XR");k(d,"OTHER","OTHER");var d="#"+b.preWw,e=$(d).width()-22,d="#"+l(d,{"float":"left",width:e+"px",height:"400px",margin:"10px 0 0 20px",border:"1px solid #666",position:"relative"}),e=[];e.push({title:"\u540d\u79f0",width:"20%"});e.push({title:"\u7a97\u5bbd",width:"20%"});e.push({title:"\u7a97\u4f4d",width:"20%"});e.push({title:"\u5feb\u6377\u952e",width:"20%"});e.push({title:"\u64cd\u4f5c",width:"20%"});m(d,e,{height:"20px",background:"#333",width:"100%",color:"#efefef",cursor:"default"});b.bodyid="#"+r(d,{height:"355px",width:"100%",background:"#222",overflow:"hidden"});v(d,{bottom:"0",width:"100%",height:"25px",position:"absolute","text-align":"center",color:"green",cursor:"pointer"},function(c){c=CBoBo.Config.PushPreWwWc(a,"","","","",!1,!1);if(c instanceof String)$.Msg(c);else{var d=[];d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});p(b.bodyid,d,c,f)}});d="#"+b.shortcut;n(d,"\u5feb\u6377\u952e\u914d\u7f6e",{width:"100%",height:"30px","margin-left":"40px"});e=$(d).width()-62;preBoxHeight=$(d).height()-60;d="#"+l(d,{"float":"left",width:e+"px",height:preBoxHeight+"px",margin:"10px 0 0 60px",border:"1px solid #666",position:"relative"});e=[];e.push({title:"\u52a8\u4f5c",width:"80%"});e.push({title:"\u5feb\u6377\u952e",width:"20%"});m(d,e,{height:"20px",background:"#333",width:"100%",color:"#efefef",cursor:"default"},!0);d="#"+r(d,{height:preBoxHeight-20+"px",width:"100%",background:"#222",overflow:"hidden"});e=[];e.push({title:"\u7684\u6492\u54e5\u53cd\u5bf9\u5927\u5e08\u5085",width:"80%"});e.push({title:"R",width:"20%"});w();$(d).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"})})();c()},h=function(a,b,c,d){if(void 0!=b&&void 0!=a){var e=CBoBo.Plugin.GetRandom(),f=CBoBo.Plugin.GetRandom();a=$("\x3cdiv id\x3d'"+f+"'\x3e\x3cspan\x3e"+b+"\x3c/span\x3e\x3cselect id\x3d'"+e+"' title\x3d'"+b+"'\x3e\x3c/select\x3e\x3c/div\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef"});$("#"+f+" span").css({cursor:"default","margin-right":"8px"});$("#"+e).css({cursor:"pointer","min-width":"100px"});void 0!==c&&"object"===typeof c&&a.css(c);d instanceof Function&&$("#"+e).bind("change",function(a){d($(this).val())});return e}},k=function(a,b,c){void 0!=b&&$("\x3coption value\x3d'"+c+"'\x3e"+b+"\x3c/option\x3e").appendTo($(a))},l=function(a,b){var c=CBoBo.Plugin.GetRandom(),d=$("\x3cdiv id \x3d'"+c+"'\x3e\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&d.css(b);return c},m=function(a,b,c,d){var e="",f;$.each(b,function(a){f=d||b.length-1!==a?"\x3cspan style\x3d'width:"+this.width+";height:100%;display:inline-block;'\x3e"+this.title+"\x3c/span\x3e":"\x3cspan style\x3d'width:"+this.width+";height:100%;display:inline-block;text-align:center;'\x3e"+this.title+"\x3c/span\x3e";e+=f});a=$("\x3cdiv\x3e"+e+"\x3c/div\x3e").appendTo($(a));void 0!==c&&"object"===typeof c&&a.css(c)},r=function(a,b){var c=CBoBo.Plugin.GetRandom(),d=$("\x3cdiv id \x3d'"+c+"'\x3e\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&d.css(b);return c},p=function(a,b,c,e,f){function g(a){var b;$("."+k).each(function(c,d){a===this&&(b=c)});return b}void 0===d.InsertTableItem&&(d.InsertTableItem=CBoBo.Plugin.GetRandom());var h=CBoBo.Plugin.GetRandom(),k=CBoBo.Plugin.GetRandom(),l="",m;if(f)$.each(b,function(a){m=b.length-1===a?"\x3cinput id\x3d'"+h+"' type\x3d'text' style\x3d' width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e":"\x3cinput type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e";l+=m});else{var q=CBoBo.Plugin.GetRandom();$.each(b,function(a){m=b.length-1===a?"\x3cinput id\x3d'"+h+"' type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e":"\x3cinput class\x3d'"+k+"' type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef;' value\x3d'"+this.title+"'/\x3e";l+=m});l+="\x3cspan type\x3d'text' style\x3d'width:20%;height:100%;float:left;text-align:center; cursor:pointer;display:inline-block;color:red;' id\x3d'"+q+"' class\x3d'icon_tool' title\x3d'\u5220\u9664\u8be5\u9879'\x3e\x26#xe653;\x3c/span\x3e"}var t=$("\x3cdiv class\x3d'"+d.InsertTableItem+"'\x3e"+l+"\x3c/div\x3e").appendTo($(a)),u,G,D;$("#"+h).bind("focus blur keydown",c,function(a){var d=$(this);switch(a.type){case "focus":d.css({color:"#222",background:"#aaa","text-align":"center"});break;case "blur":d.css({color:"#efefef",background:"#444","text-align":"left"});break;case "keydown":var f=a.keyCode;(8<=f&&36>=f||41<=f&&47>=f||136<=f&&254>=f||91<=f&&95>=f)&&192!==f||(u=String.fromCharCode(a.keyCode).toUpperCase(),G=a.ctrlKey,D=a.altKey,a.stopPropagation(),a.preventDefault(),f="",a.ctrlKey&&(f+="Ctrl+"),a.altKey&&(f+="Alt+"),f+=u,"Ctrl+C"===f||"Ctrl+A"===f||"Ctrl+V"===f||"Ctrl+X"===f||"Ctrl+F"===f?$.Msg("\u8be5\u7ec4\u5408\u952e\u88ab\u7cfb\u7edf\u5360\u7528."):(d.val(f),e instanceof Function&&e("modify",c,b.length-1,a.target.value,u,G,D)))}});f||($("#"+q).bind("click",c,function(a){e instanceof Function&&e("delete",c,t)}),$("."+k).bind("change",c,function(a){e instanceof Function&&e("modify",c,g(a.target),a.target.value)}))},w=function(){$("."+d.InsertTableItem).css({height:"20px",margin:"5px 0"})},v=function(a,b,c){a=$("\x3cdiv\x3eAdd\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&a.css(b);c instanceof Function&&a.bind("mouseenter mouseleave click ",function(a){var b=$(this);switch(a.type){case "mouseenter":b.css({background:"#666"});break;case "mouseleave":b.css({background:"#333"});break;case "click":c(a)}})},x=function(a,b,c,d){var e=CBoBo.Plugin.GetRandom();a=$("\x3cdiv\x3e\u989c\u8272 \x3cinput id\x3d'"+e+"' type\x3d'color' name\x3d'favcolor'value\x3d'"+b+"' /\x3e\x3c/div\x3e").appendTo($(a));a.height(60).css({"float":"left",color:"#efefef",cursor:"default","min-width":"100px"});void 0!==d&&"object"===typeof d&&a.css(d);c instanceof Function&&$("#"+e).bind("change",function(a){c($(this).val())});return e},z=function(a,b,c,d,e,f){var g=CBoBo.Plugin.GetRandom();a=$("\x3clabel title\x3d'"+c+"' value\x3d'"+d+"'\x3e\x3cinput id\x3d'"+g+"' name\x3d'"+b+"' type\x3d'radio'  value\x3d'"+d+"'/\x3e"+c+"\x3c/label\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef",cursor:"pointer"});void 0!==e&&"object"===typeof e&&a.css(e);f instanceof Function&&$("#"+g).bind("click",f)},n=function(a,b,c){a=$("\x3clabel\x3e"+b+"\x3c/label\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef"});void 0!==c&&"object"===typeof c&&a.css(c)},A=function(a){var b=$.extend(!0,{parent:null,iconstr:"",title:"",name:"",value:"",exstyle:{},iconstyle:{},change:null},a);a=CBoBo.Plugin.GetRandom();var c=$("\x3cdiv title\x3d'"+b.title+"'\x3e\x3cdiv style\x3d'pointer-events:none;' id\x3d'"+a+"' class\x3d'icon_tool'\x3e"+b.iconstr+"\x3c/div\x3e\x3cinput name\x3d'"+b.name+"'style\x3d'pointer-events:none;' type\x3d'radio'  value\x3d'"+b.value+"' style\x3d'cursor:pointer'\x3e\x3c/div\x3e").appendTo($(b.parent));c.css({"float":"left",color:"#fff",cursor:"pointer","text-align":"center"});c.css(b.exstyle);$("#"+a).css(b.iconstyle);c.bind("click",function(a){var c=a.target.title;$("input:radio[name\x3d'"+b.name+"']").each(function(){var a=$(this),b=a.prev();a.val()===c?(b.css("color","#F0F"),this.checked=!0):(b.css("color","#fff"),this.checked=!1)});b.change instanceof Function&&b.change(c)});return a};this.Show=function(a){this.bShow=a;var b=$("#"+d.ctrl),c=$("body");a?(b.hide(),b.fadeIn(500),c.css("pointer-events","none"),b.css("pointer-events","auto")):(b.fadeOut(500),c.css("pointer-events",""),b.css("pointer-events",""))};d.ctrl=CBoBo.Plugin.GetRandom();d.left=CBoBo.Plugin.GetRandom();d.right=CBoBo.Plugin.GetRandom();d.headbtn=CBoBo.Plugin.GetRandom();d.headbtnicon=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+d.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+d.left+"'\x3e\x3cdiv class\x3d'"+d.headbtn+"' title\x3d'\u57fa\u672c\u914d\u7f6e'\x3e\x3cspan class\x3d'"+d.headbtnicon+"'\x3e\x26#xe6ba;\x3c/span\x3e\x3cspan\x3e\u57fa\u672c\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'"+d.headbtn+"' title\x3d'\u56db\u89d2\u4fe1\u606f\u914d\u7f6e'\x3e\x3cspan class\x3d'"+d.headbtnicon+"'\x3e\x26#xe6bb;\x3c/span\x3e\x3cspan\x3e\u56db\u89d2\u4fe1\u606f\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'"+d.headbtn+"' title\x3d'\u5176\u4ed6\u914d\u7f6e'\x3e\x3cspan class\x3d'"+d.headbtnicon+"'\x3e\x26#xe6b8;\x3c/span\x3e\x3cspan\x3e\u5176\u4ed6\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+d.right+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body")).css({position:"absolute",left:0,top:CBoBo.View.TOOLBAR_HEIGHT,"z-index":"9999",background:"#535353","border-top":"1px solid #383838",overflow:"hide"});c();(function(){var b=$("."+d.headbtn);b.bind("click",function(c){b.css({"background-color":"","pointer-events":""});$(this).css({"background-color":"#333333","pointer-events":"none"});c=c.target.title;$("#"+d.right).empty();switch(c){case "\u57fa\u672c\u914d\u7f6e":a=e();break;case "\u56db\u89d2\u4fe1\u606f\u914d\u7f6e":a=f();break;case "\u5de5\u5177\u680f\u914d\u7f6e":CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();$("\x3ch1\x3e\u5de5\u5177\u680f\u914d\u7f6e\x3c/h1\x3e").appendTo($("#"+d.right));a=void 0;break;case "\u5176\u4ed6\u914d\u7f6e":a=g()}})})();$("."+d.headbtn).eq(0).trigger("click")};CBoBo.View.AssistDiagnose=function(d){var a=this;this.recrodStatus={};var b=$.extend(!0,{msgtransform:null,server:""},d),c,e={};this.bShow=!1;var f=!0,g,h,k;this.Login=function(){c=io.connect("ws://"+b.server);l();a.UpdateRoomList(!0);a.UpdateRoomList(!1)};this.UpdateRoomList=function(a){void 0!==c&&(a?c.emit("getmyroom",{uid:"ranqiwu"}):c.emit("getotherroom",{uid:"ranqiwu"}))};this.Show=function(a){this.bShow=a;a=$("#"+e.ctrl);this.bShow?(a.hide(),a.fadeIn(400)):a.fadeOut(400)};this.SendCommand=function(a){c.emit("command",a)};var l=function(){var a=c;a.on("connect",function(){null!==b.msgtransform&&b.msgtransform({type:"socket.io",data:{type:"success"}})});a.on("connect_failed",function(a){null!==b.msgtransform&&b.msgtransform({type:"socket.io",data:{type:"failed"}})});a.on("error",function(a){null!==b.msgtransform&&b.msgtransform({type:"socket.io",data:{type:"error"}})});a.on("reconnecting",function(a){null!==b.msgtransform&&b.msgtransform({type:"socket.io",data:{type:"reconnecting",times:a}})});a.on("reconnect",function(a){null!==b.msgtransform&&b.msgtransform({type:"socket.io",data:{type:"reconnected",times:a}})});a.on("disconnect",function(a){null!==b.msgtransform&&b.msgtransform({type:"socket.io",data:{type:"disconnect"}})});a.on("command",function(a){null!==b.msgtransform&&b.msgtransform({type:"command",data:a})});a.on("myroom",function(a){$.each(a,function(){r({title:this.title,personcount:this.personcount,id:this.roomid},!0)})});a.on("otherroom",function(a){$.each(a,function(){r({title:this.title,personcount:this.personcount,id:this.roomid})})})},m=function(a){h=a.destory;k=a.gray;var b=a.password;g=a.title;""!==b&&(b=hex_md5(b));c.emit("createroom",{uid:"ranqiwu",title:a.title,isprivate:a.isprivate,password:b});f&&(c.on("createroomstatus",function(a){a.success?(void 0!==h&&h(),r({title:g},!0),$.Msg(a.msg,CBoBo.MSG_SUCCESS)):(void 0!==k&&k(),$.Msg(a.msg,CBoBo.MSG_ERROR))}),f=!1)},r=function(a,b){if("object"==typeof a){var d=$.extend(!0,{title:"",personcount:0,author:"",createtime:"",type:"",id:""},a),f="\x3cli\x3e\x3cspan\x3e"+d.title+"\x3c/span\x3e\x3cspan style\x3d'color:#FFF'\x3e "+d.personcount+"\x3c/span\x3e\x3c/li\x3e",g;g=b?e.myroom+" ul":e.otherroom+" ul";$(f).appendTo("#"+g).css({cursor:"default",margin:"2px 0"}).bind("dblclick",function(b){p(!0);b=$(this).data("info");"object"==typeof a&&void 0!==c&&c.emit("entersession",{uid:"ranqiwu",roomid:b.id})}).data("info",d)}},p=function(a){$("#"+e.ctrl);var b=.5*$(window).height()>>0,b=300>b?300:b;a?(a=.3*$(window).width()>>0,a=285>a?285:a):a=288;$("."+e.clear).css({display:"none","float":"none"});$("#"+e.ctrl).width(a).height(b).css({border:"1px solid #676767",position:"absolute","z-index":"9999",background:"#444444","user-select":"none",color:"#CCCCC4"});$("#"+e.title).css({height:"30px",width:"100%",background:"#555555",cursor:"default","border-bottom":"1px solid #000","text-align":"center","box-shadow":"0 1px 2px #000"});$("#"+e.title+" span").css({width:"40%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+e.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+e.container).css({position:"relative"});$("#"+e.search).css({height:"30px",width:"100%",background:"#131313"});$("#"+e.search+" input").css({width:a-55+"px",height:"100%","padding-left":"3px","float":"left"});$("#"+e.searchbtn).css({width:"48px","font-size":"5%",cursor:"pointer",display:"block","text-align":"center",height:"30px","float":"right","line-height":"30px"});var c=$("#"+e.room),b=b-62;c.height(b).width(288).css({"float":"left"});$("#"+e.roommanager).height(30).css({width:"100%",background:"gray",color:"#222"});$("."+e.roommanactrl).height(30).css({width:"90","line-height":"30px",cursor:"pointer"});$("."+e.roommanactrl+" label").css({"font-size":"130%","padding-right":"4px"});c=$("."+e.roomtitle);c.css({width:"100%",background:"#555555",display:"block","margin-bottom":"3px","box-shadow":"0 1px 3px #333",cursor:"pointer","padding-left":"5px"});var d=$("#"+e.myroom),f=.3*b>>0;d.css({width:"100%","margin-bottom":"6px","max-height":f+"px"});var d=$("#"+e.myroom+" ul"),g=f-c.height();d.css({"overflow-y":"auto",height:g+"px"});d=$("#"+e.otherroom);f=b-f;d.css({width:"100%","max-height":f+"px"});d=$("#"+e.otherroom+" ul");c=f-c.height();d.css({"overflow-y":"auto",height:c+"px"});c=$("#"+e.roomin);a-=288;c.height(b).width(a).css({"float":"right",background:"#da8456"})},w=function(a){function b(){f.remove()}function c(a){var b=$("#"+d);a?(b.html("\u6b63\u5728\u521b\u5efa..."),b.css({"pointer-events":"none"})):(b.html("\u786e\u5b9a"),b.css({"pointer-events":""}))}var d,f,g=this,h=!1;(function(){var d="assist"+CBoBo.Plugin.GetRandom(),k="input"+CBoBo.Plugin.GetRandom(),l="input"+CBoBo.Plugin.GetRandom(),m="input"+CBoBo.Plugin.GetRandom(),n="input"+CBoBo.Plugin.GetRandom(),p="input"+CBoBo.Plugin.GetRandom();g.cfmbtn=p;var r="input"+CBoBo.Plugin.GetRandom(),v="checkbox"+CBoBo.Plugin.GetRandom(),q="passwordbox"+CBoBo.Plugin.GetRandom();f=$("\x3cdiv \x3e\x3cform id\x3d'"+d+"'\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan \x3e\u623f\u95f4\u540d\uff1a\x3c/span\x3e\x3cinput id\x3d'"+k+"' type\x3d'text' placeholder\x3d'\u8bf7\u8f93\u5165\u623f\u95f4\u540d\u79f0' required\x3d'required' autofocus max\x3d'15' tabindex\x3d'0'\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv id\x3d'"+v+"' \x3e\x3cdiv style\x3d'text-align:right; width:90px'\x3e\u623f\u95f4\u52a0\u5bc6\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+q+"' style\x3d'display:none;'\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan\x3e\u5bc6\u7801\uff1a\x3c/span\x3e\x3cinput id\x3d'"+l+"' type\x3d'password' placeholder\x3d'\u8bf7\u8f93\u5165\u623f\u95f4\u5bc6\u7801' required\x3d'required' tabindex\x3d'1'\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan\x3e\u786e\u8ba4\u5bc6\u7801\uff1a\x3c/span\x3e\x3cinput id\x3d'"+m+"' type\x3d'password' placeholder\x3d'\u8bf7\u786e\u8ba4\u623f\u95f4\u5bc6\u7801' required\x3d'required' tabindex\x3d'2'\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cbutton id\x3d'"+p+"' tabindex\x3d'3' type\x3d'submit'\x3e\u786e\u5b9a\x3c/button\x3e\x3cbutton id\x3d'"+r+"' tabindex\x3d'4'\x3e\u53d6\u6d88\x3c/button\x3e\x3c/div\x3e\x3c/form\x3e\x3c/div\x3e").appendTo($("#"+e.container));f.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",background:"#444444","box-shadow":"1px 1px 2px #000"});$("#"+d).css({margin:"0 auto",width:"288px",height:"100%","padding-top":"20px"});$("."+n).css({"margin-bottom":"10px","text-align":"center"});$("."+n+" span").css({"text-align":"right",width:"90px",display:"inline-block","vertical-align":"middle"});$("."+n+" input").css({padding:"0",border:"1px solid #333",background:"#ddd",height:"25px"});$("."+n+" button").css({width:"90px",background:"#333",border:"0",height:"30px",color:"#ccccc4",cursor:"pointer"}).bind("mouseenter mouseleave",function(a){"mouseenter"==a.type?$(this).css({background:"#ccccc4",color:"#333"}):"mouseleave"==a.type&&$(this).css({background:"#333",color:"#ccccc4"})});$("#"+p).css({"margin-right":"10px"});$("#"+r).bind("click",function(a){a.preventDefault();b()});$("#"+p).bind("click",function(d){d.preventDefault();if(void 0!==a||null!==a)if(d=$("#"+k).val(),""===d)$.Msg("\u623f\u95f4\u540d\u4e0d\u80fd\u4e3a\u7a7a!");else{var e="";if(h){var e=$("#"+l).val(),f=$("#"+m).val();if(""===e){$.Msg("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a!");return}if(e!==f){$.Msg("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u76f8\u540c!");return}}c(!0);a({title:d,isprivate:h,password:e,destory:b,gray:c})}});$("#"+v).height(40).css({position:"relative"});(new CBoBo.View.CheckBox({parent:"#"+v,title:"\u623f\u95f4\u52a0\u5bc6",msgtransform:function(a){h=a;var b=$("#"+q);a?b.slideDown(400):b.slideUp(400)}})).SetPositon(110,-18)})()};e.ctrl="assist"+CBoBo.Plugin.GetRandom();e.title=CBoBo.Plugin.GetRandom();e.container=CBoBo.Plugin.GetRandom();e.search=CBoBo.Plugin.GetRandom();e.searchbtn=CBoBo.Plugin.GetRandom();e.room=CBoBo.Plugin.GetRandom();e.roommanager=CBoBo.Plugin.GetRandom();e.roomin=CBoBo.Plugin.GetRandom();e.clear=CBoBo.Plugin.GetRandom();e.roommanactrl=CBoBo.Plugin.GetRandom();e.myroom=CBoBo.Plugin.GetRandom();e.otherroom=CBoBo.Plugin.GetRandom();e.roomtitle=CBoBo.Plugin.GetRandom();e.addstudy=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+e.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+e.title+"'\x3e\x3cspan\x3e\u534f\u540c\u8bca\u65ad\x3c/span\x3e\x3ca\x3e\x26#xe661;\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d'"+e.container+"'\x3e\x3cdiv id\x3d'"+e.search+"'\x3e\x3cinput type\x3d'text' placeholder\x3d'\u641c\u7d22\uff1a\u623f\u95f4\u540d/\u53f7\u3001\u5728\u7ebf\u7528\u6237'\x3e\x3c/input\x3e\x3ca id\x3d'"+e.searchbtn+"'\x3e\u53d6\u6d88\x3c/a\x3e\x3cdiv class'"+e.clear+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+e.room+"'\x3e\x3cdiv id\x3d'"+e.roommanager+"'\x3e\x3cdiv class\x3d'"+e.roommanactrl+"'\x3e\x3clabel\x3e\x26#xe69d;\x3c/label\x3e\x3cspan\x3e\u521b\u5efa\u623f\u95f4\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+e.myroom+"'\x3e\x3cspan class\x3d'"+e.roomtitle+"'\x3e\u6211\u7684\u623f\u95f4\x3c/span\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv id\x3d'"+e.otherroom+"'\x3e\x3cspan class\x3d'"+e.roomtitle+"'\x3e\u516c\u5171\u623f\u95f4\x3c/span\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+e.roomin+"'\x3e\x3ca id\x3d'"+e.addstudy+"'\x3e\u66f4\u65b0\u68c0\u67e5\x3c/a\x3e\x3c/div\x3e\x3cdiv class'"+e.clear+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));p(!1);(function(){$("#"+e.title).bind("mousedown",function(a){function b(a){switch(a.type){case "mousemove":c.css({left:a.pageX-d.x+f.x+"px",top:a.pageY-d.y+f.y+"px"});break;case "mouseup":$(document).unbind("mousemove mouseup",b)}}var c=$("#"+e.ctrl),d=new Point(a.pageX,a.pageY);a=c.offset();var f=new Point(a.left,a.top);$(document).bind("mousemove mouseup",b)});$("#"+e.title+" a").bind("click",function(c){c.preventDefault();a.Show(!1);null!=b.msgtransform&&b.msgtransform({type:"btnfocus",btntitle:"\u534f\u540c\u8bca\u65ad",btnforce:!1})});$("."+e.roomtitle).bind("click",function(a){a=$(this).next();"none"==a.css("display")?(a.hide(),a.slideDown(300)):a.slideUp(300)});$("."+e.roommanactrl).bind("click",function(a){switch($(this).children("span").html()){case "\u521b\u5efa\u623f\u95f4":w(m)}});$("#"+e.addstudy).bind("click",function(a){"function"===typeof b.msgtransform&&b.msgtransform({type:"addstudy"})})})();(function(){var a=$("body"),b=$("#"+e.ctrl),c=a.width(),a=a.height(),d=b.width(),f=b.height();b.css({left:(c-d>>1)+"px",top:(a-f>>1)+"px"})})();r({title:"\u5395\u6240",personcount:2016,id:"aa123"},!0)};CBoBo.View.CanvasMax=function(d){this.bShow;var a=$.extend(!0,{parent:null},d),b=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var c=$("#"+b),d=$(a.parent),f=d.width(),d=d.height();c.width(f).height(d).css({left:"10px",top:"10px"})};this.Show=function(a){var c=$("#"+b);a?(this.bShow=!0,c.hide(),c.fadeIn(400)):(this.bShow=!1,c.fadeOut(400))};$("\x3cdiv id\x3d'"+b+"'\x3e\x3c/div\x3e").appendTo($(a.parent)).css({position:"absolute","z-index":1E3,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"});this.UpdateStyle();d.parent="#"+b;this.secondCtrl=new CBoBo.View.CMngSecondLayer(d)};CBoBo.View.IconInfo=function(d){$.extend(!0,{msgtransform:null},d);var a={};this.bShow;this.Show=function(b){var c=$("#"+a.ctrl);b?(c.fadeIn(300),this.bShow=!0):(c.fadeOut(800),this.bShow=!1)};this.SetInfo=function(){var b="#"+a.container;$(b).html("");a.td||(a.td=CBoBo.Plugin.GetRandom());a.th||(a.th=CBoBo.Plugin.GetRandom());var c="\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.th+"'\x3e\u6309\u952e\x3c/td\x3e\x3ctd class\x3d'"+a.th+"'\x3e\u529f\u80fd\u63cf\u8ff0\x3c/td\x3e\x3ctd class\x3d'"+a.th+"'\x3e\u6309\u952e\x3c/td\x3e\x3ctd class\x3d'"+a.th+"'\x3e\u529f\u80fd\u63cf\u8ff0\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u5f71\u50cf\u6e90\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u53cc\u51fb\u5168\u5c4f\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61b\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u8c03\u7a97/\u81ea\u5b9a\u4e49\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe631\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u91ca\u653e\u5de5\u5177\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe67f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u91cd\u65b0\u52a0\u8f7d\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe62a\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u56fe\u50cf\u5e03\u5c40\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe66d\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u5e8f\u5217\u5e03\u5c40\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe644\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u6062\u590d\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe607\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u5e8f\u5217\u64ad\u653e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe610\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u5b9a\u4f4d\u7ebf\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe629\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u6587\u672c\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe671\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3eDICOM\u4fe1\u606f\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe6b6\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u56db\u89d2\u4fe1\u606f\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe670\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u653e\u7f29\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe630\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u79fb\u52a8\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe623\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u65cb\u8f6c\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe603\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u8d1f\u50cf\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe602\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u4f2a\u5f69\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u76f4\u7ebf\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe615\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u5fc3\u80f8\u6bd4\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe619\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u77e9\u5f62\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe622\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u64a4\u9500\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61e\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u692d\u5706\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe653\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u5220\u9664\u56fe\u50cf\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe618\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u89d2\u5ea6\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe628\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u6309\u952e\u8bf4\u660e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe637\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3eCT\u503c\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3eMPR\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3eMPR\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe62f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u7bad\u5934\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),c=c+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xE60E\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u53f3\u6807\u8bb0\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe9d8\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+a.td+"'\x3e\u5de6\u6807\u8bb0\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e");$(c).appendTo($(b));$("."+a.th).width(140).css({color:"#33ffff","font-size":"17px"});$("."+a.td).width(140).css({color:"#FFF","font-size":"17px"})};a.ctrl=CBoBo.Plugin.GetRandom();a.container=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+a.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+a.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));(function(){var b=$(window).width();$(window).height();var b=.5*b>>0,b=600<b?600:b,c=$("#"+CBoBo.Manager.canvasManager.arrTag.box).height(),d=$("#"+CBoBo.Manager.frame.GetId("banner")).height();$("#"+a.ctrl).width(b).height(c).css({border:"1px solid #676767",position:"absolute","z-index":11111,background:"#444444","border-radius":"20px",display:"none","user-select":"none",color:"#CCCCC4",opacity:"90%",right:"0px",top:d+"px"});$("#"+a.container).width(b-30).height(c-30-30).css({"user-select":"auto",padding:"15px","font-family":"Microsoft YaHei",overflow:"auto"})})()};"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function a(a,b,d){var c=[];if(a.x===b.x&&a.y===b.y)c.push(a);else if(a.x===b.x)if(a.y>b.y)for(var e=a.y;e>=b.y;e--)c.push({x:a.x,y:e});else for(e=a.y;e<=b.y;e++)c.push({x:a.x,y:e});else if(a.y===b.y)if(a.x>b.x)for(var f=a.x;f>=b.x;f--)c.push({x:f,y:a.y});else for(f=a.x;f<=b.x;f++)c.push({x:f,y:a.y});else{var l=(b.y-a.y)/(b.x-a.x);if(Math.abs(a.x-b.x)>Math.abs(a.y-b.y))if(a.x>b.x)for(f=a.x;f>=b.x;f--)e=l*(f-a.x)+a.y,d||(e=Math.round(e)),c.push({x:f,y:e});else for(f=a.x;f<=b.x;f++)e=l*(f-a.x)+a.y,d||(e=Math.round(e)),c.push({x:f,y:e});else if(a.y>b.y)for(e=a.y;e>=b.y;e--)f=(e-a.y)/l+a.x,d||(f=Math.round(f)),c.push({x:f,y:e});else for(e=a.y;e<=b.y;e++)f=(e-a.y)/l+a.x,d||(f=Math.round(f)),c.push({x:f,y:e})}return c}function b(a){return"number"===typeof a&&0===a%1}!function(c){c.Mpr={GenerateNormalPlane:function(a,b){var d=a[0].col,e=parseFloat(a[0].sliceth),f=new DVDicomInfo;f.SetInfo({data:a[0]});f.pixy=e;f.id=c.Plugin.GetRandom();f.row=a.length;f.col=b.length;f.pixsBuffer=new Int16Array(f.row*f.col);var l=0;$.each(a,function(a,c){$.each(b,function(){f.pixsBuffer[l]=c.pixsBuffer[d*this.y+this.x];l++})});f.SetData(f.pixsBuffer);return f},GenerateSlopePlane:function(d,f,g,h){var e=new DVDicomInfo;e.SetInfo({data:d[0]});e.id=c.Plugin.GetRandom();var l=parseFloat(d[0].sliceth);e.pixx=(l-e.pixx)/90*(f.x===g.x&&f.y===g.y?0:f.x===g.x?90:f.y===g.y?0:Math.abs(180*Math.atan((g.y-f.y)/(g.x-f.x))/Math.PI))+e.pixx;f=a(f,g,!0);e.col=f.length;var m=0,r,p,w;if(90===h){e.row=d[0].row;e.pixsBuffer=new Int16Array(e.row*e.col);for(var v=0;v<e.row;v++)$.each(f,function(){p=parseInt(v*d[0].col+this.x);if(b(this.y))this.y=Math.max(0,Math.min(d.length-1,this.y)),r=d[this.y],w=r.pixsBuffer[p];else{var a=Math.floor(this.y),c;c=Math.max(0,Math.min(d.length-1,a+1));var a=Math.max(0,Math.min(d.length-1,a)),f=this.y-a;w=d[a].pixsBuffer[p]*(1-f)+d[c].pixsBuffer[p]*f;w=Math.round(w)}e.pixsBuffer[m]=w;m++})}else if(180===h)for(e.row=d[0].col,e.pixsBuffer=new Int16Array(e.row*e.col),v=0;v<e.row;v++)$.each(f,function(){p=d[0].col*parseInt(this.x)+v;if(b(this.y))this.y=Math.max(0,Math.min(d.length-1,this.y)),r=d[this.y],w=r.pixsBuffer[p];else{var a=Math.floor(this.y),c;c=Math.max(0,Math.min(d.length-1,a+1));var a=Math.max(0,Math.min(d.length-1,a)),f=this.y-a;w=d[a].pixsBuffer[p]*(1-f)+d[c].pixsBuffer[p]*f;w=Math.round(w)}e.pixsBuffer[m]=w;m++});else return;e.SetData(e.pixsBuffer);return e},GenerateSurface:function(b,d){for(var e=[],f=0;f<d.length;f++){var k=d[f+1];if(void 0===k)break;k=a(d[f],k);$.each(k,function(){e.push(this)})}var l=new DVDicomInfo;l.SetInfo({data:b[0]});l.id=c.Plugin.GetRandom();l.pixy=parseFloat(b[0].sliceth);l.row=b.length;l.col=e.length;l.pixsBuffer=new Int16Array(l.row*l.col);var m=0;$.each(b,function(a,c){$.each(e,function(){l.pixsBuffer[m]=c.pixsBuffer[b[0].col*this.y+this.x];m++})});l.SetData(l.pixsBuffer);return l},GetPointsFromLine:a}}(d);d.Mip={};!0}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function a(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function b(b,c){var d=a(b.start,b.end);if(0===d)return a(c,b.start);d=((c.x-b.start.x)*(b.end.x-b.start.x)+(c.y-b.start.y)*(b.end.y-b.start.y))/d;return 0>d?a(c,b.start):1<d?a(c,b.end):a(c,{x:b.start.x+d*(b.end.x-b.start.x),y:b.start.y+d*(b.end.y-b.start.y)})}function c(a,c){return Math.sqrt(b(a,c))}function e(a,b,c,d,e,f){b instanceof Array||(b=[b]);var g=E.getFont(),q=E.getFontSize(),h=E.getBackgroundColor();a.save();a.font=g;a.textBaseline="top";a.strokeStyle=e;var t=0;b.forEach(function(b){b=a.measureText(b).width;t=Math.max(t,b)});a.fillStyle=h;g={width:t+10,height:5+b.length*(q+5)};f&&f.centering&&!0===f.centering.x&&(c-=g.width/2);f&&f.centering&&!0===f.centering.y&&(d-=g.height/2);g.left=c;g.top=d;f&&!0===f.debug&&(a.fillStyle="#FF0000");a.fillRect(g.left,g.top,g.width,g.height);b.forEach(function(b,f){a.fillStyle=e;a.fillText(b,c+5,d+5+f*(q+5))});a.restore();return g}function f(a,b){return Math.sqrt(g(a,b))}function g(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function h(a,b){for(var c=[],d,e=0;e<a.length;e++){var g=f(a[e],b);c.push(g);d=0===e?g:Math.min(g,d)}c=c.indexOf(d);return a[c]}function k(a,b){a.save();a.strokeStyle=E.GetHandleColor();if(b instanceof Array&&!(1>b.length)){for(var c=0;c<b.length;c++){a.beginPath();var d=b[c];a.fillStyle="#00FF00";a.arc(d.x,d.y,10,0,2*Math.PI);a.fill()}a.restore()}}function l(a,b,c){for(var e=[],f=0;f<c.length;f++){var g=d.ImageProcessor.PixelToCanvas(a,b,c[f]);e.push(g)}return e}function m(a,b){for(var c=0;c<b.length;c++)if(40>f(b[c],a))return c;return-1}function r(a,b){return a.x<b.left||a.x>b.left+b.width||a.y<b.top||a.y>b.top+b.height?!1:!0}function p(a,b,c){a=a.getBoundingClientRect();return{x:b-a.left-window.pageXOffset,y:c-a.top-window.pageYOffset}}function w(a){a=a.getContext("2d");a.lineWidth=E.getToolWidth();a.shadowColor=E.getshadowColor();a.shadowOffsetX=E.getshadowOffsetX();a.shadowOffsetY=E.getshadowOffsetY();a.shadowBlur=.5;a.setTransform(1,0,0,1,0,0);return a}function v(a,b,c,d,e){if(void 0===a)throw"GetStoredPixels: parameter image must not be undefined.";b=Math.round(b);c=Math.round(c);for(var f=[],g=0,h=a.pixsBuffer,q=0;q<e;q++)for(var k=0;k<d;k++){var t=(q+c)*a.col+(k+b);f[g++]=h[t]}return f}function x(a,b){var c=parseInt(a);isNaN(c)&&(c=1);var d=parseInt(b);isNaN(d)&&(d=0);return function(a){return a*c+d}}function z(a,b,c,d,e){b=v(a,b,c,d,e);return 1===a.rescsl&&0===a.rescin?b:b.map(x(a.rescsl,a.rescin))}function n(a,b){a instanceof Object&&1==arguments.length?(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)}function A(){this.type="probe";this.active=!1;this.handles={end:{x:0,y:0}}}function C(){this.type="line";this.active=!1;this.length=0;this.invalid=!0;this.index=-1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,text:"",boundingBox:{}}}function y(){this.type="rect";this.active=!1;this.index=-1;this.area=0;this.invalid=!0;this.isServer=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}};this.ellipse={left:0,top:0,width:0,height:0};this.meanStdDev={count:0,mean:0,variance:0,stdDev:0}}function H(){this.type="ellipse";this.active=!1;this.index=-1;this.invalid=!0;this.isServer=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}};this.ellipse={left:0,top:0,width:0,height:0};this.meanStdDev={count:0,mean:0,variance:0,stdDev:0}}function F(){this.type="arrow";this.active=!1;this.index=-1;this.handles={start:{x:0,y:0},end:{x:0,y:0}}}function I(){this.type="angle";this.active=!1;this.index=-1;this.angle=0;this.invalid=!0;this.createHitNums=0;this.handles={start:{x:0,y:0},center:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}}}function M(){this.type="text";this.text="";this.textBox={active:!1,x:0,y:0,boundingBox:{}};this.text=prompt("\u8bf7\u8f93\u5165\u6587\u672c:","")}function K(a){this.type=a;this.active=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}}}function J(){this.type="heartratio";this.active=!1;this.lineIndex=this.index=-1;this.ratio=0;this.invalid=!0;this.topline={start:{x:0,y:0},end:{x:0,y:0}};this.downline={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}}}var E=new function(){var a="#ff8000",b="#dd0",c="transparent",d=15,e=d+"px Arial",f="transparent",g=1;this.setFillColor=function(a){c=a};this.getFillColor=function(){return c};this.setToolColor=function(b){a=b};this.getToolColor=function(){return a};this.setActiveToolColor=function(a){b=a};this.getActiveToolColor=function(){return b};this.getColorIfActive=function(c){return c?b:a};this.setToolWidth=function(a){g=a};this.getToolWidth=function(){return g};this.setFont=function(a){e=a};this.getFont=function(){return e};this.setFontSize=function(a){d=a};this.getFontSize=function(){return d};this.setBackgroundColor=function(a){f=a};this.getBackgroundColor=function(){return f};this.getshadowColor=function(){return"#000000"};this.getshadowOffsetX=function(){return 1};this.getshadowOffsetY=function(){return 1};this.GetHandleColor=function(){return"#ff0"}},B={recordAnn:void 0,SetRecordAnn:function(a){this.recordAnn=a},GetRecordAnn:function(){return this.recordAnn},newAnn:void 0,SetNewAnn:function(a){this.newAnn=a},GetNewAnn:function(){return this.newAnn},modifyAnn:void 0,SetModifyAnn:function(a){this.modifyAnn=a},GetModifyAnn:function(){return this.modifyAnn}};A.prototype.Draw=function(a,b,c){var f=E.getColorIfActive(this.active),g=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end),g=[{x:g.x,y:g.y-4},{x:g.x-4,y:g.y},{x:g.x,y:g.y+4},{x:g.x+4,y:g.y}];c.beginPath();c.strokeStyle=f;c.moveTo(g[0].x,g[0].y);c.lineTo(g[2].x,g[2].y);c.moveTo(g[1].x,g[1].y);c.lineTo(g[3].x,g[3].y);c.stroke();this.active&&(g=[this.handles.end],g=l(a,b,g),k(c,g));c.fillStyle=f;var g=Math.round(this.handles.end.x),h=Math.round(this.handles.end.y),q,t;if(!(0>g||0>h||g>=a.image.col||h>=a.image.row)){if(!a.image.color){q=v(a.image,g,h,1,1);t=q[0];var u=parseInt(a.image.rescsl),m=parseInt(a.image.rescin);q="x : "+g+", y : "+h;t="sp: "+t+" mo: "+parseFloat((t*u+m).toFixed(3))}a=d.ImageProcessor.PixelToCanvas(a,b,{x:this.handles.end.x+3,y:this.handles.end.y-5});b=E.getFontSize();e(c,t,a.x,a.y+b+5,f);e(c,q,a.x,a.y,f)}};A.prototype.PointIsPointNear=function(a,b,c){var d=[this.handles.end],d=l(a,b,d);this.index=a=m(c,d);return-1!==a?!0:!1};A.prototype.Modify=function(a,b){this.handles.end.x+=a;this.handles.end.y+=b};C.prototype.Draw=function(a,b,c){var f=E.getColorIfActive(this.active||this.textBox.active),g=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),q=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);c.beginPath();c.strokeStyle=f;c.moveTo(g.x,g.y);c.lineTo(q.x,q.y);c.stroke();if(this.active){var t=this.GetHandlePoints(),t=l(a,b,t);k(c,t)}c.fillStyle=f;this.invalid&&this.Calculate(a);t=" mm";a.image.pixx&&a.image.pixy||(t=" pixels");t=""+this.length.toFixed(2)+t;if(!this.textBox.hasMoved){var u=Math.max(this.handles.start.x,this.handles.end.x),m;m=u===this.handles.start.x?this.handles.start.y:this.handles.end.y;this.textBox.x=u;this.textBox.y=m}a=d.ImageProcessor.PixelToCanvas(a,b,this.textBox);a.x+=10;b=e(c,t,a.x,a.y,f);this.textBox.boundingBox=b;this.textBox.hasMoved&&(u={},t=[g,q,{x:(g.x+q.x)/2,y:(g.y+q.y)/2}],u.x=a.x,u.y=a.y,g=h(t,u),u=h([{x:b.left+b.width/2,y:b.top},{x:b.left,y:b.top+b.height/2},{x:b.left+b.width/2,y:b.top+b.height},{x:b.left+b.width,y:b.top+b.height/2}],g),c.save(),c.beginPath(),c.strokeStyle=f,c.setLineDash([2,3]),c.moveTo(g.x,g.y),c.lineTo(u.x,u.y),c.stroke(),c.restore())};C.prototype.PointIsLineNear=function(a,b,e){a={start:d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,b,this.handles.end)};return 10>c(a,e)};C.prototype.PointIsPointNear=function(a,b,c){var d=this.GetHandlePoints(),d=l(a,b,d);this.index=a=m(c,d);return-1!==a?!0:!1};C.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.end);return a};C.prototype.PointIsInTextBox=function(a,b,c,d){a=p(b,c,d);return r(a,this.textBox.boundingBox)};C.prototype.Calculate=function(a){var b=(this.handles.end.x-this.handles.start.x)*(a.image.pixy||1);a=(this.handles.end.y-this.handles.start.y)*(a.image.pixx||1);this.length=Math.sqrt(b*b+a*a);this.invalid=!1};C.prototype.Modify=function(a,b){var c=!0;if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=b;break;case 1:this.handles.end.x+=a;this.handles.end.y+=b;break;default:this.handles.start.x+=a,this.handles.start.y+=b,this.handles.end.x+=a,this.handles.end.y+=b,c=!1}this.invalid=c}};y.prototype.Draw=function(a,b,c,f,g){f=E.getColorIfActive(this.active||this.textBox.active);var q=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),t=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);g=Math.abs(q.x-t.x);var u=Math.abs(q.y-t.y),G=Math.min(q.x,t.x),q=Math.min(q.y,t.y);c.beginPath();c.strokeStyle=f;c.rect(G,q,g,u);c.stroke();this.active&&(g=this.GetHandlePoints(),g=l(a,b,g),k(c,g));if(this.invalid){var D=Math.abs(this.handles.start.x-this.handles.end.x),m=Math.abs(this.handles.start.y-this.handles.end.y),u=Math.min(this.handles.start.x,this.handles.end.x),G=Math.min(this.handles.start.y,this.handles.end.y);this.ellipse=g={left:u,top:G,width:D,height:m};this.context=c;d.Draw.GetIsFromServer()||(u=z(a.image,u,G,D,m),this.Calculate(u,g),this.area=D*(a.image.pixx||1)*m*(a.image.pixy||1),this.invalid=!1)}d.Draw.GetIsFromServer()&&(this.area=D*(a.image.pixx||1)*m*(a.image.pixy||1));g=" mm\u00b2";a.image.pixx&&a.image.pixy||(g=" pixel\u00b2");m="Area: "+this.area.toFixed(2)+g;this.textBox.hasMoved||(D=this.GetHandlePoints(),a.hflip?(this.textBox.bRight=D[1].x>a.image.col>>1,this.textBox.x=this.textBox.bRight?D[0].x:D[2].x):(this.textBox.bRight=D[1].x<a.image.col>>1,this.textBox.x=this.textBox.bRight?D[2].x:D[0].x),this.textBox.y=a.vflip?D[4].y:D[0].y);D=d.ImageProcessor.PixelToCanvas(a,b,this.textBox);g=c.measureText(g);this.textBox.bRight?D.x+=8:(u=c.measureText(m),D.x=D.x-g.width-u.width-8);u="";"CT"===a.image.mod&&(u=" HU");c.fillStyle=f;g="Mean: "+this.meanStdDev.mean.toFixed(2)+u;u="StdDev: "+this.meanStdDev.stdDev.toFixed(2)+u;G=[];G.push(g);G.push(u);G.push(m);m=e(c,G,D.x,D.y,f);this.textBox.boundingBox=m;this.textBox.hasMoved&&(u={},g=this.GetHandlePoints(),g=l(a,b,g),u.x=D.x,u.y=D.y,a=h(g,u),u=h([{x:m.left+m.width/2,y:m.top},{x:m.left,y:m.top+m.height/2},{x:m.left+m.width/2,y:m.top+m.height},{x:m.left+m.width,y:m.top+m.height/2}],a),c.save(),c.beginPath(),c.strokeStyle=f,c.setLineDash([2,3]),c.moveTo(a.x,a.y),c.lineTo(u.x,u.y),c.stroke(),c.restore())};y.prototype.GetHandlePoints=function(){var a=[],b=Math.min(this.handles.start.x,this.handles.end.x),c=Math.min(this.handles.start.y,this.handles.end.y),d=Math.max(this.handles.start.x,this.handles.end.x),e=Math.max(this.handles.start.y,this.handles.end.y),f=this.handles.start.x+this.handles.end.x>>1,g=this.handles.start.y+this.handles.end.y>>1;a.push(new n(b,c));a.push(new n(f,c));a.push(new n(d,c));a.push(new n(d,g));a.push(new n(d,e));a.push(new n(f,e));a.push(new n(b,e));a.push(new n(b,g));return a};y.prototype.Calculate=function(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)c+=a[f],d+=a[f]*a[f],e++,f++;0===e&&(this.meanStdDev={count:e,mean:0,variance:0,stdDev:0});c/=e;d=d/e-c*c;this.meanStdDev={count:e,mean:c,variance:d,stdDev:Math.sqrt(d)}};y.prototype.PointIsLineNear=function(a,b,e){var f=this.GetHandlePoints(),g={start:d.ImageProcessor.PixelToCanvas(a,b,f[0]),end:d.ImageProcessor.PixelToCanvas(a,b,f[2])},g=c(g,e);if(20>g)return!0;g={start:d.ImageProcessor.PixelToCanvas(a,b,f[2]),end:d.ImageProcessor.PixelToCanvas(a,b,f[4])};g=c(g,e);if(20>g)return!0;g={start:d.ImageProcessor.PixelToCanvas(a,b,f[4]),end:d.ImageProcessor.PixelToCanvas(a,b,f[6])};g=c(g,e);if(20>g)return!0;g={start:d.ImageProcessor.PixelToCanvas(a,b,f[0]),end:d.ImageProcessor.PixelToCanvas(a,b,f[6])};g=c(g,e);return 20>g?!0:!1};y.prototype.PointIsPointNear=function(a,b,c){var d=this.GetHandlePoints(),d=l(a,b,d);this.index=a=m(c,d);return-1!==a?!0:!1};y.prototype.PointIsInTextBox=function(a,b,c,d){a=p(b,c,d);return r(a,this.textBox.boundingBox)};y.prototype.Modify=function(a,b){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{var c=this.handles.start.x,d=this.handles.start.y,e=this.handles.end.x,f=this.handles.end.y;switch(this.index){case 0:c+=a;d+=b;break;case 1:d+=b;break;case 2:e+=a;d+=b;break;case 3:e+=a;break;case 4:e+=a;f+=b;break;case 5:f+=b;break;case 6:c+=a;f+=b;break;case 7:c+=a;break;default:c+=a,d+=b,e+=a,f+=b}this.handles.start.x=c;this.handles.start.y=d;this.handles.end.x=e;this.handles.end.y=f;this.invalid=!0}};y.prototype.ServerModify=function(a,b){this.textBox.active&&(this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b)};y.prototype.CorrectPoint=function(){var a=Math.min(this.handles.start.y,this.handles.end.y),b=Math.max(this.handles.start.x,this.handles.end.x),c=Math.max(this.handles.start.y,this.handles.end.y);this.handles.start.x=Math.min(this.handles.start.x,this.handles.end.x);this.handles.start.y=a;this.handles.end.x=b;this.handles.end.y=c};H.prototype.Draw=function(a,b,c){var f=E.getColorIfActive(this.active||this.textBox.active),g=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),q=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end),t=Math.min(g.x,q.x),u=Math.min(g.y,q.y),m=Math.abs(g.x-q.x),g=Math.abs(g.y-q.y);c.beginPath();c.strokeStyle=f;this.DrawEllipse(c,t,u,m,g);c.closePath();this.active&&(g=this.GetHandlePoints(),g=l(a,b,g),k(c,g));this.invalid&&(u=Math.abs(this.handles.start.x-this.handles.end.x),m=Math.abs(this.handles.start.y-this.handles.end.y),g=Math.min(this.handles.start.x,this.handles.end.x),q=Math.min(this.handles.start.y,this.handles.end.y),this.ellipse=t={left:g,top:q,width:u,height:m},this.context=c,d.Draw.GetIsFromServer()||(u=z(a.image,g,q,u,m),this.Calculate(u,t),this.invalid=!1),this.area=t.width*(a.image.pixx||1)/2*Math.PI*(t.height*(a.image.pixy||1)/2));m="";"CT"===a.image.mod&&(m=" HU");g=" mm\u00b2";a.image.pixx&&a.image.pixy||(g=" pixel\u00b2");u="Area: "+this.area.toFixed(2)+g;this.textBox.hasMoved||(t=this.GetHandlePoints(),a.hflip?(this.textBox.bRight=t[0].x>a.image.col>>1,this.textBox.x=this.textBox.bRight?t[3].x:t[1].x):(this.textBox.bRight=t[0].x<a.image.col>>1,this.textBox.x=this.textBox.bRight?t[1].x:t[3].x),this.textBox.y=a.vflip?t[2].y:t[0].y);t=d.ImageProcessor.PixelToCanvas(a,b,this.textBox);g=c.measureText(g);this.textBox.bRight?t.x+=8:(q=c.measureText(u),t.x=t.x-g.width-q.width-5);c.fillStyle=f;g="Mean: "+this.meanStdDev.mean.toFixed(2)+m;m="StdDev: "+this.meanStdDev.stdDev.toFixed(2)+m;q=[];q.push(g);q.push(m);q.push(u);u=e(c,q,t.x,t.y,f);this.textBox.boundingBox=u;this.textBox.hasMoved&&(m={},g=this.GetHandlePoints(),g=l(a,b,g),m.x=t.x,m.y=t.y,a=h(g,m),m=h([{x:u.left+u.width/2,y:u.top},{x:u.left,y:u.top+u.height/2},{x:u.left+u.width/2,y:u.top+u.height},{x:u.left+u.width,y:u.top+u.height/2}],a),c.save(),c.beginPath(),c.strokeStyle=f,c.setLineDash([2,3]),c.moveTo(a.x,a.y),c.lineTo(m.x,m.y),c.stroke(),c.restore())};H.prototype.DrawEllipse=function(a,b,c,d,e){var f=d/2*.5522848,g=e/2*.5522848,h=b+d,k=c+e;d=b+d/2;e=c+e/2;a.beginPath();a.moveTo(b,e);a.bezierCurveTo(b,e-g,d-f,c,d,c);a.bezierCurveTo(d+f,c,h,e-g,h,e);a.bezierCurveTo(h,e+g,d+f,k,d,k);a.bezierCurveTo(d-f,k,b,e+g,b,e);a.closePath();a.stroke()};H.prototype.GetHandlePoints=function(){var a=[],b=Math.min(this.handles.start.x,this.handles.end.x),c=Math.max(this.handles.start.x,this.handles.end.x),d=Math.max(this.handles.start.y,this.handles.end.y),e=this.handles.start.x+this.handles.end.x>>1,f=this.handles.start.y+this.handles.end.y>>1;a.push(new n(e,Math.min(this.handles.start.y,this.handles.end.y)));a.push(new n(c,f));a.push(new n(e,d));a.push(new n(b,f));return a};H.prototype.PointInEllipse=function(a,b){var c=a.width/2,d=a.height/2;if(0>=c||0>=d)return!1;var e=b.x-(a.left+c),f=b.y-(a.top+d);return 1>=e*e/(c*c)+f*f/(d*d)};H.prototype.Calculate=function(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)!0===this.PointInEllipse(b,{x:h,y:g})&&(c+=a[f],d+=a[f]*a[f],e++),f++;0===e&&(this.meanStdDev={count:e,mean:0,variance:0,stdDev:0});c/=e;d=d/e-c*c;this.meanStdDev={count:e,mean:c,variance:d,stdDev:Math.sqrt(d)}};H.prototype.PointIsLineNear=function(a,b,c){var e=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start);b=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);a={left:Math.min(e.x,b.x)-7.5,top:Math.min(e.y,b.y)-7.5,width:Math.abs(e.x-b.x)+15,height:Math.abs(e.y-b.y)+15};e=this.PointInEllipse({left:Math.min(e.x,b.x)+7.5,top:Math.min(e.y,b.y)+7.5,width:Math.abs(e.x-b.x)-15,height:Math.abs(e.y-b.y)-15},c);return this.PointInEllipse(a,c)&&!e?!0:!1};H.prototype.PointIsPointNear=function(a,b,c){var d=this.GetHandlePoints(),d=l(a,b,d);this.index=a=m(c,d);return-1!==a?!0:!1};H.prototype.PointIsInTextBox=function(a,b,c,d){a=p(b,c,d);return r(a,this.textBox.boundingBox)};H.prototype.Modify=function(a,b){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{var c=this.handles.start.x,d=this.handles.start.y,e=this.handles.end.x,f=this.handles.end.y;switch(this.index){case 0:d+=b;break;case 1:e+=a;break;case 2:f+=b;break;case 3:c+=a;break;default:c+=a,d+=b,e+=a,f+=b}this.handles.start.x=c;this.handles.start.y=d;this.handles.end.x=e;this.handles.end.y=f;this.invalid=!0}};H.prototype.CorrectPoint=function(){var a=Math.min(this.handles.start.y,this.handles.end.y),b=Math.max(this.handles.start.x,this.handles.end.x),c=Math.max(this.handles.start.y,this.handles.end.y);this.handles.start.x=Math.min(this.handles.start.x,this.handles.end.x);this.handles.start.y=a;this.handles.end.x=b;this.handles.end.y=c};F.prototype.Draw=function(a,b,c){var e=E.getColorIfActive(this.active),f=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),g=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);c.strokeStyle=e;c.fillStyle=e;this.DrawArrow(c,f,g);this.active&&(e=this.GetHandlePoints(),e=l(a,b,e),k(c,e))};F.prototype.DrawArrow=function(a,b,c){b=[b.x,b.y];c=[c.x,c.y];a.beginPath();a.translate(0,0);a.moveTo(b[0],b[1]);a.lineTo(c[0],c[1]);a.fill();a.stroke();a.save();a.translate(c[0],c[1]);var d=(c[0]-b[0])/(c[1]-b[1]),d=Math.atan(d);0<=c[1]-b[1]?a.rotate(-d):a.rotate(Math.PI-d);a.lineTo(-5,-10);a.lineTo(0,-5);a.lineTo(5,-10);a.lineTo(0,0);a.fill();a.restore();a.closePath()};F.prototype.PointIsLineNear=function(a,b,e){a={start:d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,b,this.handles.end)};return 10>c(a,e)};F.prototype.PointIsPointNear=function(a,b,c){var d=this.GetHandlePoints(),d=l(a,b,d);this.index=a=m(c,d);return-1!==a?!0:!1};F.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.end);return a};F.prototype.Modify=function(a,b){switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=b;break;case 1:this.handles.end.x+=a;this.handles.end.y+=b;break;default:this.handles.start.x+=a,this.handles.start.y+=b,this.handles.end.x+=a,this.handles.end.y+=b}};I.prototype.Draw=function(a,b,c){var f=E.getColorIfActive(this.active||this.textBox.active),g={start:d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),center:d.ImageProcessor.PixelToCanvas(a,b,this.handles.center),end:d.ImageProcessor.PixelToCanvas(a,b,this.handles.end)};c.strokeStyle=f;c.fillStyle=f;if(0!==this.handles.center.x&&0!==this.handles.center.y&&0===this.handles.end.x&&0===this.handles.end.y)c.beginPath(),c.moveTo(g.start.x,g.start.y),c.lineTo(g.center.x,g.center.y),c.stroke();else{this.DrawAngle(c,g);if(this.active){var q=this.GetHandlePoints(),q=l(a,b,q);k(c,q)}if(!this.textBox.hasMoved){var g=this.GetHandlePoints(),m=Math.min(g[0].x,g[1].x,g[2].x),t=Math.max(g[0].x,g[1].x,g[2].x),q=m+(t-m>>1);a.hflip?(this.textBox.bRight=q>a.image.col>>1,this.textBox.x=this.textBox.bRight?m:t):(this.textBox.bRight=q<a.image.col>>1,this.textBox.x=this.textBox.bRight?t:m);var u=this;g.forEach(function(a){a.x===u.textBox.x&&(u.textBox.y=a.y)})}g=d.ImageProcessor.PixelToCanvas(a,b,this.textBox);m=this.angle.toFixed(2)+" \u00b0";this.textBox.bRight?g.x+=8:(t=c.measureText(m),g.x-=t.width);m=e(c,m,g.x,g.y,f);this.textBox.boundingBox=m;this.textBox.hasMoved&&(q={},t={},q=this.GetHandlePoints(),q=l(a,b,q),t.x=g.x,t.y=g.y,q=h(q,t),t=h([{x:m.left+m.width/2,y:m.top},{x:m.left,y:m.top+m.height/2},{x:m.left+m.width/2,y:m.top+m.height},{x:m.left+m.width,y:m.top+m.height/2}],q),c.save(),c.beginPath(),c.strokeStyle=f,c.setLineDash([2,3]),c.moveTo(q.x,q.y),c.lineTo(t.x,t.y),c.stroke(),c.restore())}};I.prototype.DrawAngle=function(a,b){var c=b.start.x,d=b.start.y,e=b.center.x,g=b.center.y,h=b.end.x,k=b.end.y;a.save();a.translate(.5,.5);a.beginPath();a.moveTo(c,d);a.lineTo(e,g);a.moveTo(c,d);a.lineTo(h,k);var l=b.start,k=b.center,m=b.end,h=k.x-l.x,k=k.y-l.y,q=m.x-l.x,l=m.y-l.y,m=Math.sqrt(Math.pow(h,2)+Math.pow(k,2)),t=Math.sqrt(Math.pow(q,2)+Math.pow(l,2)),h=0<h/m*(l/t)-q/t*(k/m)?!0:!1,k=this.angle;this.invalid&&(m=b.start,q=b.center,l=b.end,k=f(m,q),m=f(m,l),q=f(q,l),0==k||0==m?k=0:(k=(k*k-q*q+m*m)/(2*k*m),-1>k?k=-1:1<k&&(k=1),k=57.29578*Math.acos(k)),this.angle=k,this.invalid=!1);k*=.0174532;e=(g-d)/(e-c);0>=g-d?0>=e?(e=Math.abs(e),g=2*Math.PI-Math.atan(e)):g=Math.PI+Math.atan(e):0>e?(e=Math.abs(e),g=Math.PI-Math.atan(e)):g=Math.atan(e);e=f(b.start,b.center);q=f(b.start,b.end);e=Math.min(e,q)/6;30<e&&(e=30);a.moveTo(c,d);h?a.arc(c,d,e,g,g+k,!1):a.arc(c,d,e,g,g-k,!0);a.stroke();a.restore()};I.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.center);a.push(this.handles.end);return a};I.prototype.PointIsLineNear=function(a,b,e){var f={start:d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,b,this.handles.center)},f=c(f,e);if(10>f)return!0;f={start:d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:d.ImageProcessor.PixelToCanvas(a,b,this.handles.end)};f=c(f,e);return 10>f?!0:!1};I.prototype.PointIsPointNear=function(a,b,c){var d=this.GetHandlePoints(),d=l(a,b,d);this.index=a=m(c,d);return-1!==a?!0:!1};I.prototype.PointIsInTextBox=function(a,b,c,d){a=p(b,c,d);return r(a,this.textBox.boundingBox)};I.prototype.Modify=function(a,b){var c=!0;if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=b;break;case 1:this.handles.center.x+=a;this.handles.center.y+=b;break;case 2:this.handles.end.x+=a;this.handles.end.y+=b;break;default:this.handles.start.x+=a,this.handles.start.y+=b,this.handles.center.x+=a,this.handles.center.y+=b,this.handles.end.x+=a,this.handles.end.y+=b,c=!1}this.invalid=c}};M.prototype.Draw=function(a,b,c){var f=E.getColorIfActive(this.textBox.active);c.fillStyle=f;a=d.ImageProcessor.PixelToCanvas(a,b,this.textBox);c=e(c,this.text,a.x,a.y,f);this.textBox.boundingBox=c};M.prototype.PointIsInTextBox=function(a,b,c,d){a=p(b,c,d);return r(a,this.textBox.boundingBox)};M.prototype.Modify=function(a,b){this.textBox.active&&(this.textBox.x+=a,this.textBox.y+=b)};K.prototype.Draw=function(a,b,c){var e=E.getColorIfActive(this.active);c.fillStyle=e;c.strokeStyle=e;var e=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start),g=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);a=e.x+g.x>>1;b=e.y+g.y>>1;e=f(e,g)>>1;this.DrawLR(c,{x:a,y:b},e,this.type)};K.prototype.DrawLR=function(a,b,c,d){a.beginPath();a.arc(b.x,b.y,c,0,2*Math.PI);a.stroke();a.save();a.font=c+"px lighter";c=a.measureText("L").width>>1;"l"===d?a.fillText("L",b.x-c,b.y+c):a.fillText("R",b.x-c,b.y+c);a.restore()};K.prototype.PointIsLineNear=function(a,b,c){var e=d.ImageProcessor.PixelToCanvas(a,b,this.handles.start);a=d.ImageProcessor.PixelToCanvas(a,b,this.handles.end);b=f(e,a)>>1;return f(c,{x:e.x+a.x>>1,y:e.y+a.y>>1})<=b};K.prototype.Modify=function(a,b){this.handles.start.x+=a;this.handles.start.y+=b;this.handles.end.x+=a;this.handles.end.y+=b};J.prototype.Draw=function(a,b,c){var g=E.getColorIfActive(this.active||this.textBox.active),m=d.ImageProcessor.PixelToCanvas(a,b,this.topline.start),q=d.ImageProcessor.PixelToCanvas(a,b,this.topline.end),t=d.ImageProcessor.PixelToCanvas(a,b,this.downline.start),u=d.ImageProcessor.PixelToCanvas(a,b,this.downline.end),n=m.x+q.x>>1,p=m.y+q.y>>1,r=t.x+u.x>>1,v=t.y+u.y>>1;c.beginPath();c.strokeStyle=g;c.moveTo(m.x,m.y);c.lineTo(q.x,q.y);c.stroke();c.beginPath();c.save();c.setLineDash([2,3]);c.moveTo(n,p);c.lineTo(r,v);c.stroke();c.restore();c.beginPath();c.moveTo(t.x,t.y);c.lineTo(u.x,u.y);c.stroke();this.active&&(u=this.GetHandlePoints(),u=l(a,b,u),k(c,u));this.invalid&&(m=f(this.topline.start,this.topline.end),q=f(this.downline.start,this.downline.end),this.ratio=m/q,this.invalid=!1);m="ratio: "+this.ratio.toFixed(2);this.textBox.hasMoved||(q=Math.min(this.topline.start.x,this.topline.end.x,this.downline.start.x,this.downline.end.x),t=Math.max(this.topline.start.x,this.topline.end.x,this.downline.start.x,this.downline.end.x),u=Math.min(this.topline.start.y,this.topline.end.y,this.downline.start.y,this.downline.end.y),n=Math.max(this.topline.start.y,this.topline.end.y,this.downline.start.y,this.downline.end.y),p=q+t>>1,a.hflip?(this.textBox.bRight=p>a.image.col>>1,this.textBox.x=this.textBox.bRight?q:t):(this.textBox.bRight=q<a.image.col>>1,this.textBox.x=this.textBox.bRight?t:q),this.textBox.y=a.vflip?n:u);q=d.ImageProcessor.PixelToCanvas(a,b,this.textBox);this.textBox.bRight?q.x+=8:(t=c.measureText(m),q.x=q.x-t.width-8);c.fillStyle=g;m=e(c,m,q.x,q.y,g);this.textBox.boundingBox=m;this.textBox.hasMoved&&(t={},u=this.GetHandlePoints(),u=l(a,b,u),t.x=q.x,t.y=q.y,a=h(u,t),t=h([{x:m.left+m.width/2,y:m.top},{x:m.left,y:m.top+m.height/2},{x:m.left+m.width/2,y:m.top+m.height},{x:m.left+m.width,y:m.top+m.height/2}],a),c.save(),c.beginPath(),c.strokeStyle=g,c.setLineDash([2,3]),c.moveTo(a.x,a.y),c.lineTo(t.x,t.y),c.stroke(),c.restore())};J.prototype.GetHandlePoints=function(){var a=[];a.push(this.topline.start);a.push(this.topline.end);a.push(this.downline.end);a.push(this.downline.start);return a};J.prototype.PointIsLineNear=function(a,b,e){var f={start:d.ImageProcessor.PixelToCanvas(a,b,this.topline.start),end:d.ImageProcessor.PixelToCanvas(a,b,this.topline.end)},f=c(f,e);if(10>f)return this.lineIndex=0,!0;f={start:d.ImageProcessor.PixelToCanvas(a,b,this.downline.start),end:d.ImageProcessor.PixelToCanvas(a,b,this.downline.end)};f=c(f,e);return 10>f?(this.lineIndex=1,!0):!1};J.prototype.PointIsPointNear=function(a,b,c){var d=this.GetHandlePoints(),d=l(a,b,d);this.index=a=m(c,d);return-1!==a?!0:!1};J.prototype.PointIsInTextBox=function(a,b,c,d){a=p(b,c,d);return r(a,this.textBox.boundingBox)};J.prototype.Modify=function(a,b){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{switch(this.index){case 0:this.topline.start.x+=a;this.topline.start.y+=b;break;case 1:this.topline.end.x+=a;this.topline.end.y+=b;break;case 2:this.downline.end.x+=a;this.downline.end.y+=b;break;case 3:this.downline.start.x+=a;this.downline.start.y+=b;break;default:0===this.lineIndex?(this.topline.start.x+=a,this.topline.start.y+=b,this.topline.end.x+=a,this.topline.end.y+=b):1===this.lineIndex&&(this.downline.end.x+=a,this.downline.end.y+=b,this.downline.start.x+=a,this.downline.start.y+=b)}this.invalid=!0}};d.Annotation={NewAIAnnotation:function(a,b,c,d,e){var f;switch(c){case "probe":f=new A;f.handles.end=pt;c=w(b);f.Draw(a,b,c);break;case "line":f=new C;f.handles.start=pt;break;case "rect":return f=new y,f.handles.start=d,f.handles.end=e,f.id=a.image.id,f.invalid=!0,f;case "ellipse":f=new H;f.handles.start=pt;f.id=a.image.id;break;case "arrow":f=new F;f.handles.start=pt;break;case "angle":f=B.GetNewAnn();void 0===f?(f=new I,f.handles.start=pt,f.createHitNums++):1===f.createHitNums?(f.handles.center=pt,f.createHitNums++):2===f.createHitNums&&(f.handles.end=pt,f.createHitNums=0);break;case "text":f=new M;f.textBox.x=pt.x;f.textBox.y=pt.y;if(""!==f.text&&null!==f.text)return c=w(b),f.Draw(a,b,c),f;break;case "l":case "r":f=new K(c);f.handles.start=pt;break;case "heartratio":f=new J(c),f.topline.start=pt}B.SetNewAnn(f)},NewAnnotation:function(a,b,c,e,f){var g;e=d.ImageProcessor.PageToPixel(a,b,e,f);switch(c){case "probe":g=new A;g.handles.end=e;c=w(b);g.Draw(a,b,c);break;case "line":g=new C;g.handles.start=e;break;case "rect":g=new y;g.handles.start=e;g.id=a.image.id;break;case "ellipse":g=new H;g.handles.start=e;g.id=a.image.id;break;case "arrow":g=new F;g.handles.start=e;break;case "angle":g=B.GetNewAnn();void 0===g?(g=new I,g.handles.start=e,g.createHitNums++):1===g.createHitNums?(g.handles.center=e,g.createHitNums++):2===g.createHitNums&&(g.handles.end=e,g.createHitNums=0);break;case "text":g=new M;g.textBox.x=e.x;g.textBox.y=e.y;if(""!==g.text&&null!==g.text)return c=w(b),g.Draw(a,b,c),g;break;case "l":case "r":g=new K(c);g.handles.start=e;break;case "heartratio":g=new J(c),g.topline.start=e}B.SetNewAnn(g)},UnfinishedAnn:function(a,b,c,e,f,g){var h=B.GetNewAnn();if(void 0===h)return!1;d.ImageProcessor.DrawGrayImage(a,b);c=d.Annotation.DrawAnnotation(a,b,c);f=d.ImageProcessor.PageToPixel(a,b,f,g);switch(e){case "heartratio":h.topline.end.x=f.x;h.topline.end.y=h.topline.start.y;h.downline.start.x=h.topline.start.x;h.downline.start.y=f.y;h.downline.end=f;h.invalid=!0;h.Draw(a,b,c);break;case "r":case "l":case "arrow":case "ellipse":case "probe":case "rect":case "line":h.handles.end=f;h.invalid=!0;h.Draw(a,b,c);break;case "angle":1===h.createHitNums?h.handles.center=f:2===h.createHitNums&&(h.handles.end=f),h.invalid=!0,h.Draw(a,b,c)}return!0},GetMaybeSaveAnn:function(a,b,c){b=B.GetNewAnn();if(void 0!==b)switch(a){case "probe":return B.SetNewAnn(),b;case "line":B.SetNewAnn();if(1<b.length)return b;break;case "ellipse":case "rect":B.SetNewAnn();if(1<b.area)return b.CorrectPoint&&b.CorrectPoint(),b;break;case "l":case "r":case "arrow":B.SetNewAnn();if(2<f(b.handles.start,b.handles.end)&&(0!==b.handles.end.x||0!==b.handles.end.y))return b;break;case "angle":if(0!==b.handles.end.x||0!==b.handles.end.y)if(B.SetNewAnn(),1<b.angle)return b;break;case "heartratio":if(B.SetNewAnn(),0!==b.topline.start.x&&0!==b.topline.start.y&&0!==b.downline.start.x&&0!==b.downline.start.y)return b}},DrawAnnotation:function(a,b,c){for(var d=w(b),e=0;e<c.length;e++)c[e].Draw(a,b,d);return d},ScanHoverAnnotation:function(a,b,c,e,f){if(c instanceof Array&&!(1>c.length)){e=p(b,e,f);var g;f=!1;for(var h=0;h<c.length;h++){var k=c[h];k.PointIsPointNear&&(k.PointIsPointNear(a,b,e)&&void 0===g?(g=k,f=k.active=!0):k.active=!1);k.textBox&&(k.textBox.active=!1)}if(void 0===g)for(h=0;h<c.length;h++)k=c[h],k.PointIsLineNear&&(k.PointIsLineNear(a,b,e)&&void 0===g?(k.active=!0,g=k):k.active=!1);f?b.style.cursor="pointer":"default"!==b.style.cursor&&(b.style.cursor="default");e=B.GetRecordAnn();g!==e&&(d.ImageProcessor.DrawGrayImage(a,b),this.DrawAnnotation(a,b,c),B.SetRecordAnn(g))}},ScanClickTextBox:function(a,b,c,e,f){if(c instanceof Array&&!(1>c.length)){for(var g,h=0;h<c.length;h++){var k=c[h];k.PointIsInTextBox&&(k.PointIsInTextBox(a,b,e,f)&&void 0===g?(k.textBox.active=!0,g=k):k.textBox.active=!1)}e=B.GetRecordAnn();if(g!==e)return d.Draw.DrawImage(a,b),b.getContext("2d"),this.DrawAnnotation(a,b,c),B.SetRecordAnn(g),g}},ActiveAnnotation:function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.active||c.textBox&&c.textBox.active)return B.SetModifyAnn(c),!0}return!1},MaybeModifyActiveAnn:function(a,b,c,e,f,g,h){var k=B.GetModifyAnn();if(void 0===k)return!1;d.Draw.DrawImage(a,b);e=d.ImageProcessor.PageToPixel(a,b,e,f);h=d.ImageProcessor.PageToPixel(a,b,g,h);g=h.x-e.x;h=h.y-e.y;k.Modify&&k.Modify(g,h);this.DrawAnnotation(a,b,c);return!0},MaybeServerModifyActiveAnn:function(a,b,c,e,f,g,h){var k=B.GetModifyAnn();if(void 0===k)return!1;d.Draw.DrawImage(a,b);e=d.ImageProcessor.PageToPixel(a,b,e,f);h=d.ImageProcessor.PageToPixel(a,b,g,h);g=h.x-e.x;h=h.y-e.y;k.ServerModify&&k.ServerModify(g,h);this.DrawAnnotation(a,b,c);return!0},MaybeEndModifyAnn:function(){var a=B.GetModifyAnn();void 0!==a&&a.CorrectPoint&&a.CorrectPoint();B.SetModifyAnn()},Distance:f,PageCoods2Canvas:p,ServerGetMaybeSaveAnn:function(a,b,c,e){var g=$.Deferred();if(void 0===e)return g;switch(a){case "probe":return B.SetNewAnn(),e;case "line":B.SetNewAnn();if(1<e.length)return e;break;case "ellipse":B.SetNewAnn();a=d.Draw.GetWadoUrl()+"/GetMeasureData";$.ajax({url:a,type:"get",data:{id:e.id,type:"ellipse",left:e.ellipse.left,top:e.ellipse.top,width:e.ellipse.width,height:e.ellipse.height},dataType:"json",complete:function(a){return 200==a.status&&a.responseJSON?(a=a.responseJSON.data,e.meanStdDev={count:a.count,mean:a.mean,variance:a.stdDev,stdDev:a.variance},g.resolve(e)):g.reject()}});break;case "rect":B.SetNewAnn();a=d.Draw.GetWadoUrl()+"/GetMeasureData";$.ajax({url:a,type:"get",data:{id:e.id,type:"Rect",left:e.ellipse.left,top:e.ellipse.top,width:e.ellipse.width,height:e.ellipse.height},complete:function(a){return 200==a.status&&a.responseJSON?(a=a.responseJSON.data,e.meanStdDev={count:a.count,mean:a.mean,variance:a.stdDev,stdDev:a.variance},g.resolve(e)):g.reject()}});break;case "l":case "r":case "arrow":B.SetNewAnn();if(2<f(e.handles.start,e.handles.end)&&(0!==e.handles.end.x||0!==e.handles.end.y))return e;break;case "angle":if(0===e.handles.end.x&&0===e.handles.end.y)return;B.SetNewAnn();if(1<e.angle)return e;break;case "heartratio":if(B.SetNewAnn(),0!==e.topline.start.x&&0!==e.topline.start.y&&0!==e.downline.start.x&&0!==e.downline.start.y)return e}return g},ServerHoverAnnotation:function(a,b,c,d,e){if(c instanceof Array&&!(1>c.length)){d=p(b,d,e);var f;for(e=0;e<c.length;e++){var g=c[e];if(g.PointIsPointNear&&g.PointIsPointNear(a,b,d)&&void 0===f)return f=g}if(void 0===f)for(e=0;e<c.length;e++)if(g=c[e],g.PointIsLineNear&&g.PointIsLineNear(a,b,d)&&void 0===f)return f=g}}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(d){function a(a,b,g,h){var e=[];a instanceof Array?e=a:e.push(a);a={images:e,viewport:d.ImageProcessor.GetDefaultStatus(),anns:{},compare:!1,studyuid:b,type:g};a.viewport.image=e[0];h||c.push(a);return a}function b(a){if(a instanceof Function)for(var b=0;b<c.length;b++)a(c[b],b)}var c=[];d.AnnStatusManager={Create:a,Get:function(a){if(void 0===a)return c;if(a instanceof Number)return c[a]},Set:function(a){if(a instanceof Object){2>a.status.ww&&(a.status.ww=2);.01>a.status.scale&&(a.status.scale=.01);if(360===a.status.rotation||-360===a.status.rotation)a.status.rotation=0;b(function(b,d){b===a&&(c[d]=a)})}},Clear:function(){c=[]},Delete:function(a){var d=0;b(function(b,e){b===a&&(c.splice(e,1),d=e)});return d},Replace:function(d,f,g,h){var e;b(function(b,k){b===d&&(e=c[k]=a(f,g,h,!0))});void 0===e&&(e=a(f,g,h));return e},GetIndex:function(a){if(void 0!==a){var c;b(function(b,d){b===a&&(c=d)});return c}},IsExist:function(a){var c=!1;b(function(b){b.images.forEach(function(b){a.id==b.id&&(c=!0)})});return c}}}(CBoBo);function ImageStatus(){this.image;this.contrast=this.brightness=0;this.Negative=!1;this.scaledHeight=this.scaledWidth=0;this.ptMove={x:0,y:0};this.rotateState=0;this.pseudoColor=null;this.bDrawText=!0}ImageStatus.prototype.GetBrightness=function(){return this.brightness};ImageStatus.prototype.GetContrast=function(){return this.contrast};ImageStatus.prototype.SetBriCon=function(d,a){this.brightness=d;this.contrast=a};ImageStatus.prototype.SetImage=function(d){this.image=d};ImageStatus.prototype.GetImage=function(){return this.image};ImageStatus.prototype.GetImageSize=function(){if(void 0!=this.image){var d={};d.width=this.image.image.width;d.height=this.image.image.height;return d}};ImageStatus.prototype.ZoomImage=function(d,a){this.scaledWidth=d;this.scaledHeight=a};ImageStatus.prototype.Restore=function(){this.rotateState=this.contrast=this.brightness=0;this.ptMove={x:0,y:0};this.Negative=!1;this.pseudoColor=null;return this};ImageStatus.prototype.GetZoomRatio=function(){if(void 0!=this.image){var d=this.image.image.height;if(!(0>=d))return this.scaledHeight/d}};ImageStatus.prototype.GetMovePoint=function(){return this.ptMove};ImageStatus.prototype.MoveImage=function(d){this.ptMove.x=d.x>>0;this.ptMove.y=d.y>>0};ImageStatus.prototype.SetNegative=function(d){this.Negative=d};ImageStatus.prototype.GetNegative=function(){return this.Negative};ImageStatus.prototype.SetPseudoColor=function(d,a,b){this.pseudoColor=void 0==d||void 0==a||void 0==b?void 0:{red:d,green:a,blue:b}};ImageStatus.prototype.GetPseudoColor=function(){return this.pseudoColor};ImageStatus.prototype.FitCanvas=function(d){if(void 0==this.image||!this.image.bLoaded||void 0==d)return this;var a=d.GetCanvas();d=this.GetImageSize();if(void 0!=d)return a=Math.min(a.width/d.width,a.height/d.height),this.ZoomImage(a*d.width>>0,a*d.height>>0),this};ImageStatus.prototype.DrawImg=function(d){void 0!=d&&(void 0!=this.image?this.image.bLoaded?(d.bStop||d.StopLoadingAnimation(),d.drawlock&&(d.drawlock=!1,d.imgProcessWorker.postMessage({type:2,brightness:this.brightness,contrast:this.contrast,pseudocolor:this.pseudoColor,nagative:this.Negative}))):d.StartLoadingAnimation():d.canvas.getContext("2d").clearRect(0,0,d.canvas.width,d.canvas.height))};ImageStatus.prototype.DrawText=function(d){if(this.bDrawText){var a=d.GetCanvas(),b=a.width<a.height?a.width:a.height,b=b/55>>0;10>b&&(b=10);d=a.getContext("2d");d.fillStyle="#fff";d.textBaseline="middle";d.textAlign="right";d.font=b+"px lighter";d.shadowColor="#000";d.shadowOffsetX=1;d.shadowOffsetY=1;b=d.measureText("\u5b57").width;a=CBoBo.Plugin.SetDrawTextCoord(a.width,a.height,0,0,3,0,b);index=0;d.fillText("\u5bf9\u6bd4\u5ea6:"+this.GetContrast(),a.rb[index].x,a.rb[index].y);index++;d.fillText(" \u4eae\u5ea6:"+this.GetBrightness(),a.rb[index].x,a.rb[index].y);index++;b=this.GetZoomRatio();void 0!=b&&d.fillText("\u653e\u7f29\u500d\u6570:"+b.toFixed(2),a.rb[index].x,a.rb[index].y)}};ImageStatus.prototype.SetDrawTextFlag=function(d){this.bDrawText=d};plain_blue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_red=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_inverse_blue=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];plain_inverse_green=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];plain_inverse_red=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];rainbow_blue=[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3];rainbow_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];blackbody_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255];blackbody_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];blackbody_red=[0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];bones_blue=[0,0,0,0,1,1,1,2,2,2,2,3,3,3,4,4,4,4,5,5,5,6,6,6,6,7,7,7,8,8,8,9,9,9,9,10,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,15,15,15,16,16,16,16,17,17,17,18,18,18,18,19,19,19,20,20,20,20,21,21,21,22,22,22,23,23,23,23,24,24,24,25,25,25,25,26,26,26,27,27,27,27,28,28,28,29,29,29,29,30,30,30,31,31,31,32,32,32,32,33,33,33,34,34,34,34,35,35,35,36,36,36,36,36,37,37,37,37,37,38,38,38,38,39,39,39,39,39,40,40,40,40,40,41,41,41,41,42,42,42,42,42,43,43,43,43,44,44,44,44,44,45,45,45,45,45,46,46,46,46,47,47,47,47,47,48,48,48,48,48,49,49,49,49,50,50,50,50,50,51,51,51,51,51,52,52,52,53,53,53,54,54,54,55,55,55,56,56,56,56,57,57,57,58,58,58,59,59,59,60,60,60,61,61,61,62,62,62,63,63,63,64,64,64,65,65,65,66,66,66,67,84,101,118,135,152,169,186,203,220,237];bones_green=[0,1,2,3,4,6,7,8,9,11,12,13,14,16,17,18,19,20,22,23,24,25,27,28,29,30,32,33,34,35,37,38,39,40,41,43,44,45,46,48,49,50,51,53,54,55,56,57,59,60,61,62,64,65,66,67,69,70,71,72,74,75,76,77,78,80,81,82,83,85,86,87,88,90,91,92,93,94,96,97,98,99,101,102,103,104,106,107,108,109,111,112,113,114,115,117,118,119,120,122,123,124,125,127,128,129,130,131,133,134,135,136,138,139,140,141,143,144,145,146,148,149,150,151,152,153,153,154,154,155,156,156,157,158,158,159,160,160,161,162,162,163,164,164,165,166,166,167,168,168,169,170,170,171,172,172,173,174,174,175,175,176,177,177,178,179,179,180,181,181,182,183,183,184,185,185,186,187,187,188,189,189,190,191,191,192,193,193,194,195,195,196,196,197,198,198,199,200,200,201,202,203,204,205,206,207,208,209,210,211,213,214,215,216,217,218,219,220,221,222,223,224,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,251,252,252,252,253,253,253,254,254];bones_red=[0,1,3,5,7,8,10,12,14,15,17,19,21,22,24,26,28,29,31,33,35,37,38,40,42,44,45,47,49,51,52,54,56,58,59,61,63,65,67,68,70,72,74,75,77,79,81,82,84,86,88,89,91,93,95,96,98,100,102,104,105,107,109,111,112,114,116,118,119,121,123,125,126,128,130,132,134,135,137,139,141,142,144,146,148,149,151,153,155,156,158,160,162,164,165,167,169,171,172,174,176,178,179,181,183,185,186,188,190,192,193,195,197,199,201,202,204,206,208,209,211,213,215,216,217,217,218,218,219,219,220,220,221,221,222,222,223,223,224,224,225,225,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,244,244,245,245,246,246,247,247,248,248,249,249,250,250,251,251,252,252,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];cardiac_blue=[3,12,20,29,37,46,54,63,71,80,88,97,105,114,122,131,139,146,154,161,168,175,183,190,197,204,212,219,226,233,241,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,252,250,249,247,246,244,243,241,239,238,236,235,233,232,230,229,227,226,224,223,221,220,218,217,215,214,212,211,209,208,206,203,201,198,196,193,191,188,186,183,180,178,175,173,170,168,165,163,161,159,157,155,153,151,149,146,144,142,140,138,136,134,132,127,123,118,113,109,104,99,95,90,85,80,76,71,66,62,57,53,50,46,43,39,36,32,29,25,21,18,14,11,7,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,3,4,5,5,6,7,8,8,9,10,11,11,12,11,11,10,10,9,9,8,8,7,6,6,5,5,4,3];cardiac_green=[193,195,197,198,200,202,204,206,208,209,211,213,215,217,218,220,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,216,211,205,200,194,188,183,177,171,166,160,155,149,143,138,132,128,125,121,118,114,110,107,103,99,96,92,89,85,81,78,74,70,67,63,60,56,52,49,45,41,38,34,31,27,23,20,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,17,19,21,23,25,27,29,31,33,37,41,45,50,54,58,62,66,70,74,78,83,87,91,95,99,103,107,111,116,120,124,128,132,136,140,144,149,153,157,161,165,170,174,179,184,188,193,197,202,207,211,216,221,225,230,234,239,238,237,236,235,234,233,232,231,229,228,227,226,225,224,223,222,220,218,217,215,213,211,209,208,206,204,202,200,198,197,193];cardiac_red=[73,72,70,69,68,66,65,63,62,61,59,58,57,55,54,52,51,48,45,41,38,35,32,29,26,22,19,16,13,10,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,21,22,22,23,24,25,25,26,27,28,28,29,30,31,31,32,36,39,43,47,50,54,57,61,65,68,72,76,79,83,86,90,95,99,104,109,113,118,123,128,132,137,142,146,151,156,160,165,169,172,176,179,183,186,190,194,197,201,204,208,211,215,218,222,224,226,228,230,232,234,236,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,236,231,226,221,216,211,206,201,197,192,187,182,177,171,164,158,151,145,138,132,125,119,112,106,99,93,86,73];flow_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,251,247,244,240,236,232,228,225,221,217,213,209,206,202,198,194,190,186,183,179,175,171,167,164,160,156,152,148,145,141,137,133,129,126,122,118,114,110,107,103,99,95,91,88,84,80,76,72,69,65,61,57,53,49,46,42,38,34,30,27,23,19,15,11,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255];flow_green=[200,197,194,191,188,185,182,179,176,173,170,167,164,161,158,155,152,149,146,143,140,137,134,131,128,125,122,119,116,113,110,107,104,101,98,95,92,89,86,83,80,77,74,71,68,65,62,59,56,53,50,47,44,41,38,35,32,29,26,23,20,20,20,19,19,19,19,18,18,18,17,17,17,16,16,16,16,15,15,15,14,14,14,13,13,13,13,12,12,12,11,11,11,10,10,10,10,9,9,9,8,8,8,7,7,7,7,6,6,6,5,5,5,4,4,4,4,3,3,3,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,10,14,18,22,26,30,34,38,42,46,50,54,58,62,66,70,74,78,82,86,90,94,98,102,106,110,114,118,122,126,130,134,138,142,146,150,154,158,162,166,170,174,178,182,186,190,194,198,202,206,210,214,218,222,226,230,234,238,242,246,250,255];flow_red=[32,32,32,32,31,31,31,31,31,30,30,30,30,30,29,29,29,29,29,28,28,28,28,28,27,27,27,27,27,26,26,26,26,26,25,25,25,25,25,24,24,24,24,24,23,23,23,23,23,22,22,22,22,22,21,21,21,21,21,20,20,20,20,19,19,19,19,18,18,18,17,17,17,16,16,16,16,15,15,15,14,14,14,13,13,13,13,12,12,12,11,11,11,10,10,10,10,9,9,9,8,8,8,7,7,7,7,6,6,6,5,5,5,4,4,4,4,3,3,3,2,2,2,1,1,1,1,0,0,0,4,8,12,16,20,24,28,32,36,40,45,49,53,57,61,65,69,73,77,81,85,89,93,97,101,105,109,113,117,121,125,130,134,138,142,146,150,154,158,162,166,170,174,178,182,186,190,194,198,202,206,210,215,219,223,227,231,235,239,243,247,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];ge_color_blue=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,252,248,244,240,236,232,228,224,220,216,212,208,204,200,196,192,188,184,180,176,172,168,164,160,156,152,148,144,140,136,132,128,124,120,116,112,108,104,100,96,92,88,84,80,76,72,68,64,60,56,52,48,44,40,36,32,28,24,20,16,12,8,4,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,85,89,93,97,101,105,109,113,117,121,125,129,133,137,141,145,149,153,157,161,165,170,174,178,182,186,190,194,198,202,206,210,214,218,222,226,230,234,238,242,246,250,255];ge_color_green=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,63,61,59,57,55,53,51,49,47,45,43,41,39,37,35,33,31,29,27,25,23,21,19,17,15,13,11,9,7,5,3,1,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255];ge_color_red=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];gray_rainbow_blue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,255,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,255,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,255,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,255,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,255,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,255,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,205,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,125,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,45,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,0,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,0,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,0,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,0,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,0,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,0,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];gray_rainbow_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,0,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,145,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,225,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,255,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,255,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,255,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,255,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,255,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,255,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,235,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,155,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,75,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];gray_rainbow_red=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,175,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,95,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,15,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,0,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,0,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,0,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,0,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,35,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,115,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,195,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,255,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,255,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,255,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];hot_green_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,10,13,16,20,23,26,30,33,37,40,43,47,50,53,57,60,64,67,70,74,77,80,84,87,90,94,97,101,104,107,111,114,117,121,124,128,131,134,138,141,144,148,151,154,158,161,165,168,171,175,178,181,185,188,192,195,198,202,205,208,212,215,218,222,225,229,232,235,239,242,245,249,252];hot_green_green=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,25,27,28,30,31,33,34,36,37,39,40,42,43,45,46,48,49,51,52,54,55,57,58,60,61,63,64,66,67,69,70,72,73,75,76,78,79,81,82,84,85,87,88,90,91,93,94,96,97,99,100,102,103,105,106,108,109,111,112,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,136,138,139,141,142,144,145,147,148,150,151,153,154,156,157,159,160,162,163,165,166,168,169,171,172,174,175,177,178,180,181,183,184,186,187,189,190,192,193,195,196,198,199,201,202,204,205,207,208,210,211,213,214,216,217,219,220,222,223,225,226,228,229,231,232,234,235,237,238,240,241,243,244,246,247,249,250,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_green_red=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,8,10,12,14,16,17,19,21,23,24,26,28,30,32,33,35,37,39,40,42,44,46,48,49,51,53,55,56,58,60,62,64,65,67,69,71,72,74,76,78,80,81,83,85,87,88,90,92,94,96,97,99,101,103,104,106,108,110,112,113,115,117,119,120,122,124,126,128,129,131,133,135,136,138,140,142,144,145,147,149,151,152,154,156,158,160,161,163,165,167,168,170,172,174,176,177,179,181,183,184,186,188,190,192,193,195,197,199,200,202,204,206,208,209,211,213,215,216,218,220,222,224,225,227,229,231,232,234,236,238,240,241,243,245,247,248,250,252,254];hot_iron_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255];hot_iron_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255];hot_iron_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_metal_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,7,11,15,19,23,27,31,35,39,43,47,51,55,59,63,67,71,75,79,83,87,91,95,99,103,107,111,115,119,123,127,131,135,139,143,147,151,155,159,163,167,171,175,179,183,187,191,195,199,203,207,211,215,219,223,227,231,235,239,243,247,251];hot_metal_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,5,8,11,14,16,19,22,25,28,30,33,36,39,42,44,47,50,53,56,58,61,64,67,70,72,75,78,81,84,86,89,92,95,98,100,103,106,109,112,114,117,120,123,126,128,131,134,137,140,142,145,148,151,154,156,159,162,165,168,170,173,176,179,182,184,187,190,193,196,198,201,204,207,210,212,215,218,221,224,226,229,232,235,238,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_metal_red=[0,1,2,4,5,7,8,9,11,12,14,15,16,18,19,21,22,23,25,26,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,60,61,63,64,65,67,68,70,71,72,74,75,77,78,79,81,82,84,85,86,88,89,91,92,93,95,96,98,99,100,102,103,105,106,107,109,110,112,113,114,116,117,119,120,121,123,124,126,127,128,130,131,133,134,135,137,138,140,141,142,144,145,147,148,149,151,152,154,155,156,158,159,161,162,163,165,166,168,169,170,172,173,175,176,177,179,180,182,183,184,186,187,189,190,191,193,194,196,197,198,200,201,203,204,205,207,208,210,211,212,214,215,217,218,219,221,222,224,225,226,228,229,231,232,233,235,236,238,239,240,242,243,245,246,247,249,250,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hue1_blue=[3,3,13,17,23,30,37,44,50,57,63,70,76,82,89,95,101,107,114,120,126,132,138,144,149,155,161,167,172,178,184,189,195,200,205,211,216,221,227,232,237,242,247,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,250,247,244,242,239,236,234,231,229,226,224,221,219,217,214,212,210,208,206,204,202,200,198,196,194,192,191,189,187,186,184,183,181,180,179,177,176,175,174,173,172,171,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,251];hue1_green=[0,0,1,2,3,4,5,6,7,8,9,13,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,87,92,97,102,107,111,116,121,125,130,134,139,143,147,152,156,160,164,168,172,176,180,184,188,192,196,199,203,207,210,214,217,221,224,228,231,234,238,241,244,247,250,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,251,250,249,249,248,247,247,246,246,246,245,245,245,245,244,244,244,244,244,244,245,245,245,245,246,246,246,247,247,248,249,249,250,251,251,251];hue1_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,247,242,237,233,228,223,219,214,210,205,201,196,192,188,184,179,175,171,167,163,159,155,151,147,144,140,136,133,129,125,122,118,115,112,108,105,102,99,95,92,89,86,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,172,175,177,180,183,186,188,191,194,196,199,201,203,206,208,210,213,215,217,219,221,223,225,227,229,230,232,234,236,237,239,240,242,243,245,246,247,248,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hue2_blue=[253,253,252,251,250,249,248,248,247,247,246,246,245,245,244,244,244,244,243,243,243,243,243,243,243,243,244,244,244,244,245,245,246,246,247,247,248,249,250,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,250,247,244,241,237,234,231,227,224,220,217,213,210,206,203,199,195,191,187,183,179,175,171,167,163,159,155,150,146,142,137,133,128,124,119,114,110,105,100,95,90,86,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,13,9,8,7,6,5,4,3,2,2];hue2_green=[253,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,169,169,170,171,172,173,174,176,177,178,180,181,183,184,186,188,189,191,193,195,197,199,201,203,205,207,209,211,214,216,218,221,223,226,228,231,233,236,239,241,244,247,250,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,247,242,237,232,226,221,216,211,205,200,194,189,183,178,172,166,160,155,149,143,137,131,125,119,113,107,100,94,88,81,75,69,62,56,49,42,36,29,29];hue2_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,249,248,247,246,244,243,241,240,238,237,235,233,231,230,228,226,224,222,220,218,216,213,211,209,207,204,202,199,197,194,192,189,187,184,181,178,175,172,170,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,85,84,84,88,91,94,97,100,103,107,110,114,117,121,124,128,131,135,139,143,146,150,154,158,162,166,170,174,179,183,187,191,196,200,205,209,214,218,223,228,233,237,242,247,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];ired_blue=[255,254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1];ired_green=[255,254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1];ired_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];jet_blue=[142,146,149,153,156,160,163,167,170,174,177,181,184,188,191,195,198,202,205,209,212,216,219,223,226,230,233,237,240,244,247,251,255,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,250,250,250,250,246,242,239,235,231,227,223,219,215,211,207,203,199,195,192,188,184,180,176,172,168,164,160,156,152,148,144,141,137,133,129,125,121,117,113,109,105,101,97,94,90,86,82,78,74,70,66,62,58,54,50,47,43,39,35,31,27,23,19,15,11,7,3,0,0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,12,12,11,11,11,11,11,10,10,10,10,10,9,9,9,9,9,8,8,8,8,8,7,7,7,7,7,6,6,6];jet_green=[5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,13,16,20,24,28,32,35,39,43,47,51,54,58,62,66,70,73,77,81,85,89,92,96,100,104,108,112,115,119,123,127,131,134,138,142,146,150,153,157,161,165,169,172,176,180,184,188,191,195,199,203,207,211,214,218,222,226,230,233,237,241,245,249,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,250,250,250,250,250,250,250,250,250,247,243,240,236,233,229,225,222,218,215,211,208,204,201,197,194,190,187,183,180,176,173,169,165,162,158,155,151,148,144,141,137,134,130,127,123,120,116,113,109,105,102,98,95,91,88,84,81,77,74,70,67,63,60,56,53,49,45,42,38,35,31,28,24,24,24,23,23,22,22,22,21,21,20,20,20,19,19,19,18,18,17,17,17,16,16,15,15,15,14,14,14,13,13,12];jet_red=[17,18,18,19,19,19,20,20,21,21,22,22,22,23,23,24,24,25,25,26,26,26,27,27,28,28,29,29,29,30,30,31,31,31,31,31,31,30,30,30,30,30,30,30,29,29,29,29,29,29,28,28,28,28,28,28,28,27,27,27,27,27,27,27,26,26,26,26,26,26,25,25,25,25,25,25,25,24,24,24,24,24,24,24,23,23,23,23,23,23,22,22,22,22,22,22,22,25,29,32,36,40,43,47,50,54,57,61,65,68,72,75,79,83,86,90,93,97,101,104,108,111,115,118,122,126,129,133,136,140,144,147,151,154,158,162,165,169,172,176,179,183,187,190,194,197,201,205,208,212,215,219,223,226,230,233,237,240,244,248,251,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,249,245,241,237,233,229,225,221,217,213,209,206,202,198,194,190,186,182,178,174,170,166,162,158,154,151,147,143,139,135,131];muscles_bones_blue=[0,0,0,0,1,1,1,2,2,2,2,3,3,3,4,4,4,5,5,5,5,6,6,6,7,7,7,7,8,8,8,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,13,13,14,14,14,15,15,15,15,16,16,16,17,17,17,17,18,18,18,19,19,19,20,20,20,20,21,21,21,22,22,22,22,23,23,23,24,24,24,25,25,25,25,26,26,26,27,27,27,27,27,27,26,26,26,25,25,25,24,24,24,23,23,22,22,22,21,21,21,20,20,20,19,19,19,18,18,18,17,17,16,16,16,15,15,15,14,14,14,13,13,13,12,12,11,11,11,10,10,10,9,9,10,10,11,11,12,12,13,13,14,15,15,16,16,17,17,18,18,19,19,20,21,21,22,22,23,23,24,24,25,26,26,27,27,28,28,29,29,30,31,31,32,32,33,33,34,34,35,36,36,37,37,38,38,39,43,47,51,55,58,62,66,70,74,78,82,86,90,94,98,102,105,109,113,117,121,125,129,133,137,141,145,149,153,156,160,164,168,172,176,180,184,188,192,196,200,204,207,211,215,219,223,227,231,235,239,243,247,251];muscles_bones_green=[0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,176,177,179,180,181,182,183,185,186,187,188,189,191,192,193,194,195,197,198,199,200,201,203,204,205,206,207,209,210,211,212,213,215,216,217,218,220,221,222,223,224,226,227,228,229,230,232,233,234,235,236,238,239,240,241,241,242,242,242,242,243,243,243,243,244,244,244,244,245,245,245,245,246,246,246,246,247,247,247,247,248,248,248,248,248,249,249,249,249,250,250,250,250,251,251,251,251,252,252,252,252,253,253,253,253,254,254,254,254];muscles_bones_red=[0,2,5,8,10,13,16,18,21,24,26,29,32,34,37,40,42,45,48,51,53,56,59,61,64,67,69,72,75,77,80,83,85,88,91,93,96,99,102,104,107,110,112,115,118,120,123,126,128,131,134,136,139,142,144,147,150,153,155,158,161,163,166,169,171,174,177,179,182,185,187,190,193,195,198,201,204,206,209,212,214,217,220,222,225,228,230,233,236,238,241,244,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];nih_blue=[0,11,22,34,45,56,68,79,90,102,113,124,136,147,158,170,164,159,154,148,143,138,132,127,122,116,111,106,100,95,90,85,90,95,100,106,111,116,122,127,132,138,143,148,154,159,164,170,175,180,185,191,196,201,207,212,217,223,228,233,239,244,249,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,249,244,239,233,228,223,217,212,207,201,196,191,185,180,175,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,159,148,138,127,116,106,95,85,74,63,53,42,31,21,10,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,79,74,69,63,58,53,47,42,37,31,26,21,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255];nih_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,90,95,100,106,111,116,122,127,132,138,143,148,154,159,164,170,175,180,185,191,196,201,207,212,217,223,228,233,239,244,249,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,249,244,239,233,228,223,217,212,207,201,196,191,185,180,175,170,164,159,154,148,143,138,132,127,122,116,111,106,100,95,90,85,81,78,75,71,68,65,62,58,55,52,49,45,42,39,35,32,29,26,22,19,16,13,9,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255];nih_red=[0,5,11,17,22,28,34,39,45,51,56,62,68,73,79,85,79,74,69,63,58,53,47,42,37,31,26,21,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,95,106,116,127,138,148,159,170,180,191,201,212,223,233,244,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,250,248,246,243,241,239,237,234,232,230,228,225,223,221,219,216,214,212,210,208,205,203,201,199,196,194,192,190,187,185,183,181,178,176,174,255,255];rainbow1_blue=[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow1_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3];rainbow1_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];rainbow2_blue=[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow2_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0];rainbow2_red=[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];rainbow3_blue=[255,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,250,247,241,238,232,229,223,220,214,211,205,202,196,193,187,184,178,175,169,166,160,157,151,148,142,139,133,130,125,121,116,112,107,103,98,94,89,85,80,76,71,67,62,58,53,49,44,40,35,31,26,22,17,13,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow3_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,6,11,15,20,24,29,33,38,42,47,51,56,60,65,69,74,78,83,87,92,96,101,105,110,114,119,122,128,131,137,140,146,149,155,158,164,167,173,176,182,185,191,194,200,203,209,212,218,221,227,230,236,240,245,249,254,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,252,247,243,238,234,229,225,220,216,211,207,202,198,193,189,184,180,175,171,166,162,157,153,148,144,139,135,131,126,122,117,113,108,104,99,95,90,86,81,77,72,68,63,59,54,50,45,41,36,32,27,23,18,14,9,5,5];rainbow3_red=[124,124,120,115,111,106,102,97,93,88,84,79,75,70,66,61,57,52,48,43,39,34,30,25,21,16,12,7,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,5,13,14,19,23,28,32,37,41,46,50,55,59,64,68,73,77,82,86,91,95,100,104,109,113,118,123,126,132,135,141,144,150,153,159,162,168,171,177,180,186,189,195,198,204,207,213,216,222,225,231,234,240,243,249,252,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,255,255];ratio_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,252,250,248,246,244,242,240,238,236,234,232,230,228,226,224,222,220,218,216,214,212,210,208,206,204,202,200,198,196,194,192,190,188,186,184,182,180,178,176,174,172,170,168,166,164,162,160,158,156,154,152,150,148,146,144,142,140,138,136,134,132,130,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0];ratio_green=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,254,252,250,248,246,244,242,240,238,236,234,232,230,228,226,224,222,220,218,216,214,212,210,208,206,204,202,200,198,196,194,192,190,188,186,184,182,180,178,176,174,172,170,168,166,164,162,160,158,156,154,152,150,148,146,144,142,140,138,136,134,132,130,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0];ratio_red=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];red_vessels_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,55,57,59,61,64,66,68,70,72,75,77,79,81,84,86,88,90,92,95,97,99,101,103,106,108,110,112,114,117,119,121,123,126,128,136,144,152,159,167,175,183,191,199,207,215,223,231,239,247];red_vessels_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,6,8,10,11,13,15,16,18,20,21,23,25,26,28,30,32,33,35,37,38,40,42,43,45,47,48,50,52,53,55,57,59,60,62,64,65,67,69,70,72,74,75,77,79,80,82,84,86,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,164,170,176,182,188,194,200,206,212,218,224,230,236,242,248];red_vessels_red=[0,1,2,3,5,6,7,9,10,11,12,14,15,16,18,19,20,21,23,24,25,27,28,29,30,32,33,34,36,37,38,39,41,42,43,45,46,47,49,50,51,52,54,55,56,58,59,60,61,63,64,65,67,68,69,70,72,73,74,76,77,78,79,81,82,83,85,86,87,88,90,91,92,94,95,96,98,99,100,101,103,104,105,107,108,109,110,112,113,114,116,117,118,119,121,122,123,125,126,127,128,130,131,132,134,135,136,137,139,140,141,143,144,145,147,148,149,150,152,153,154,156,157,158,159,161,162,163,165,166,167,168,170,171,172,174,175,176,177,179,180,181,183,184,185,186,188,189,190,192,193,194,196,197,198,199,200,201,202,203,204,206,207,208,209,210,211,212,213,214,215,216,217,219,220,221,222,223,224,225,226,227,228,229,231,232,233,234,235,236,237,238,239,240,241,243,244,245,246,247,248,249,250,251,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];spectrum_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];spectrum_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0];spectrum_red=[255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];stern_blue=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,251,247,243,238,234,230,226,221,217,213,209,204,200,196,192,187,183,179,175,170,166,162,158,153,149,145,141,136,132,128,124,119,115,111,107,102,98,94,90,85,81,77,73,68,64,60,56,51,47,43,39,34,30,26,22,17,13,9,5,0,3,7,11,15,19,22,26,30,34,38,41,45,49,53,57,60,64,68,72,76,79,83,87,91,95,98,102,106,110,114,117,121,125,129,133,137,140,144,148,152,156,159,163,167,171,175,178,182,186,190,194,197,201,205,209,213,216,220,224,228,232,235,239,243,247,251,255];stern_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];stern_red=[0,18,36,54,72,90,108,127,145,163,181,199,217,235,254,249,244,239,234,229,223,218,213,208,203,197,192,187,182,177,172,166,161,156,151,146,140,135,130,125,120,115,109,104,99,94,89,83,78,73,68,63,58,52,47,42,37,32,26,21,16,11,6,0,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];ucla_blue=[0,0,0,0,0,0,0,0,0,0,0,0,102,102,102,102,136,136,136,136,136,136,136,136,136,136,136,136,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,170,170,170,170,187,187,187,187,204,204,204,204,204,204,204,204,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,187,187,187,187,187,187,187,187,170,170,170,170,153,153,153,153,153,153,153,153,136,136,136,136,119,119,119,119,119,119,119,119,85,85,85,85,71,71,71,71,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];ucla_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,51,51,51,51,51,51,51,51,85,85,85,85,119,119,119,119,119,119,119,119,136,136,136,136,153,153,153,153,153,153,153,153,153,153,153,153,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,185,185,185,185,185,185,185,185,204,204,204,204,221,221,221,221,221,221,221,221,238,238,238,238,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,238,238,238,238,238,238,238,238,221,221,221,221,204,204,204,204,204,204,204,204,187,187,187,187,170,170,170,170,170,170,170,170,153,153,153,153,119,119,119,119,85,85,85,85,85,85,85,85,51,51,51,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];ucla_red=[0,0,0,0,0,0,0,0,0,0,0,0,85,85,85,85,119,119,119,119,119,119,119,119,136,136,136,136,136,136,136,136,136,136,136,136,102,102,102,102,68,68,68,68,68,68,68,68,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,102,102,102,102,187,187,187,187,204,204,204,204,204,204,204,204,238,238,238,238,238,238,238,238,238,238,238,238,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,238,238,238,238,221,221,221,221,221,221,221,221,204,204,204,204,255,255,255,255];