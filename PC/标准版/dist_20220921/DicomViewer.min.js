/*
 * @Date         : 2022-03-22 15:14:40
 * @Description  : 注释
 * @LastEditTime : 2022-09-15 16:26:16
 * @LastEditors  : chen wei
 * @Version      : 1.0
 */

/**
 * Created by ZKK on 17/5/8.
 *//**
 * 该文件是根据视口的状态和提供的灰度图像数据信息转化成可在canvas绘制的图像，
 * 只是一个处理工厂，针对图像显示和变换
 * 依赖：DicomInfo、伪彩表
 *//*2016.1.12编写
 * 该库是三维处理库
 * 依赖：CBoBo.DicomKernel处理库
 */// JavaScript source code


/**
 * 该库是灰度图像标注处理库
 * 2016.12.28编写
 * 依赖：CBoBo.DicomKernel处理库
 *//*伪彩表*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,c,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[c]=a.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var c=0;return $jscomp.iteratorPrototype(function(){return c<e.length?{done:!1,value:e[c++]}:{done:!0}})};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.makeIterator=function(e){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=e[Symbol.iterator];return c?c.call(e):$jscomp.arrayIterator(e)};$jscomp.arrayFromIterator=function(e){for(var c,a=[];!(c=e.next()).done;)a.push(c.value);return a};$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))};"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.Plugin={};CBoBo.Plugin.importScript=function(e){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",e);document.querySelector("head").appendChild(c)};!simple&&CBoBo.Plugin.importScript("https://cdn.jsdelivr.net/npm/simple2k13@0.0/dist/simple.min.js");CBoBo.Plugin.RadianToDegree=function(e){return 57.29578*e};CBoBo.Plugin.DegreeToRadian=function(e){return.0174532*e};CBoBo.Plugin.GetClockDirection=function(e,c,a){var g=c.x-e.x;c=c.y-e.y;var b=a.x-e.x;e=a.y-e.y;a=Math.sqrt(Math.pow(g,2)+Math.pow(c,2));var d=Math.sqrt(Math.pow(b,2)+Math.pow(e,2));return 0<g/a*(e/d)-b/d*(c/a)?!0:!1};CBoBo.Plugin.GetDegree=function(e,c,a){var g=CBoBo.Plugin.GetDistance(e,c);e=CBoBo.Plugin.GetDistance(e,a);c=CBoBo.Plugin.GetDistance(c,a);if(0==g||0==e)return 0;g=(g*g-c*c+e*e)/(2*g*e);-1>g?g=-1:1<g&&(g=1);return CBoBo.Plugin.RadianToDegree(Math.acos(g))};CBoBo.Plugin.GetDistance=function(e,c){return Math.sqrt((e.x-c.x)*(e.x-c.x)+(e.y-c.y)*(e.y-c.y))};CBoBo.Plugin.GetRectAera=function(e,c){return Math.abs((c.x-e.x)*(c.y-e.y))};CBoBo.Plugin.GetEllipseAera=function(e,c){return Math.abs(Math.PI*sw*sh)};CBoBo.Plugin.GetDrawTextCoord=function(e,c,a,g,b,d){var h={lt:[],rt:[],rb:[],lb:[],dp:[]},k=b.right-b.left;b=b.bottom-b.top;for(var f,p=0;p<e;p++)f=p*d+4*p+8,h.lt.push({x:2,y:f});for(p=0;p<c;p++)f=p*d+4*p+8,h.rt.push({x:k-2,y:f});for(p=0;p<a;p++)f=b-p*d-8-4*p,h.rb.push({x:k-2,y:f});for(p=0;p<g;p++)f=b-p*d-8-4*p,h.lb.push({x:0,y:f});h.dp.push({x:5,y:(b/2).toFixed(0)});h.dp.push({x:k/2>>0,y:8});h.dp.push({x:k-10,y:b/2>>0});h.dp.push({x:k/2>>0,y:b-10});return h};CBoBo.Plugin.PolygonArea=function(e){pt0=e[0];for(var c=0,a=e.length,g=1;g<a-1;g++)c=c+(e[g].x-pt0.x)*(e[g+1].y-pt0.y)-(e[g].y-pt0.y)*(e[g+1].x-pt0.x);c=.5*Math.abs(c);return c.toFixed(0)};CBoBo.Plugin.GetDcmDistance=function(e,c,a,g){a=e.ClientToImage_point(a,c).pointSource;g=e.ClientToImage_point(g,c).pointSource;return CBoBo.Plugin.GetDistance(a,g)};CBoBo.Plugin.GetDcmRectAera=function(e,c,a,g){a=e.ClientToImage_point(a,c).pointSource;g=e.ClientToImage_point(g,c).pointSource;return CBoBo.Plugin.GetRectAera(a,g)};CBoBo.Plugin.GetDcmEllipseAera=function(e,c,a,g){a=e.ClientToImage_point(a,c).pointSource;g=e.ClientToImage_point(g,c).pointSource;return CBoBo.Plugin.GetEllipseAera(a,g)};CBoBo.Plugin.TransCoord=function(e,c,a){e=e.GetCanvas().getBoundingClientRect();return{x:c-e.left,y:a-e.top}};CBoBo.Plugin.GetRandom=function(e,c){if(void 0==e||void 0==c)return(1E12*Math.random()>>0)+(new Date).getTime();try{var a=c-e,g=(1E12*Math.random()>>0)%c;g<e&&(g+=a);0==g&&(g=c);return g}catch(b){console.log(b.message)}};CBoBo.Plugin.SetDrawTextCoord=function(e,c,a,g,b,d,h){h||(h=10);var k={lt:[],rt:[],rb:[],lb:[],dp:[]};h*=1.1;for(var f=h>>1,p,l=0;l<a;l++)p=l*h+f,k.lt.push({x:2,y:p});for(l=0;l<g;l++)p=l*h+f,k.rt.push({x:e-2,y:p});for(l=0;l<b;l++)p=c-l*h-f,k.rb.push({x:e-2,y:p});for(l=0;l<d;l++)p=c-l*h-f,k.lb.push({x:0,y:p});k.dp.push({x:5,y:c/2>>0});k.dp.push({x:e/2>>0,y:8});k.dp.push({x:e-f,y:c/2>>0});k.dp.push({x:e/2>>0,y:c-f});return k};CBoBo.Plugin.GetUrlParam=function(e){e=new RegExp("(^|\x26)"+e+"\x3d([^\x26]*)(\x26|$)");e=window.location.search.substr(1).match(e);return null!=e?unescape(e[2]):null};CBoBo.Plugin.GetUrlParamArray=function(){for(var e=location.href,c=e.indexOf("?"),e=e.substr(c+1),e=e.split("\x26"),a={},g=0;g<e.length;g++)if(c=e[g].indexOf("\x3d"),0<c){var b=e[g].substring(0,c),c=e[g].substr(c+1);a[b]=c}return a};CBoBo.Plugin.GetBrowserInfo=function(){var e=navigator.userAgent;e.indexOf("Trident");e.indexOf("Presto");e.indexOf("AppleWebKit");-1<e.indexOf("Gecko")&&e.indexOf("KHTML");var c=!!e.match(/AppleWebKit.*Mobile.*/),a=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),g=-1<e.indexOf("Android")||-1<e.indexOf("Linux"),b=-1<e.indexOf("iPhone"),d=-1<e.indexOf("iPad");e.indexOf("Safari");e=-1<e.indexOf("NHG47K")||-1<e.indexOf("rk3399")||-1<e.indexOf("RK3399");return{language:navigator.userAgent,isMobile:c,isIOS:a,isAndroid:g,isIPhone:b,isIpad:d,isTablet:e}};CBoBo.Plugin.Error=function(e,c){id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px",background:"#000"});var a=document.getElementById(id);a.width=$(window).width();a.height=$(window).height();var g=.078125*a.width>>0,b=a.getContext("2d"),d=document.createElement("canvas"),h=d.getContext("2d"),k=[],f=[],p=!1,l=0,m=null,n=0,t=0,r=0,v=0,u=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return setTimeout(a,20)};this.run=function(){setTimeout(q,500);a.setAttribute("width",window.innerWidth);a.setAttribute("height",window.innerHeight);d.setAttribute("width",window.innerWidth);d.setAttribute("height",window.innerHeight);h.fillStyle="#fff";h.font="italic bold ".concat(g).concat("px ").concat("Helvetica");m=b.createLinearGradient(0,0,window.innerWidth,0);for(var c=0,p;10>c;c++)p="hsl(".concat(36*c).concat(", 50%, 50%)"),m.addColorStop(c/10||0,p);f=[];p=h.measureText(e);h.clearRect(0,0,window.innerWidth,window.innerHeight);h.fillText(e,window.innerWidth/2-p.width/2,window.innerHeight/2-g/2);c=h.getImageData(0,0,window.innerWidth,window.innerHeight);n=window.innerWidth/2-p.width/2;t=window.innerHeight/2-g/2-g;r=p.width;v=g;for(p=0;p<window.innerHeight;p+=3)for(var l=0;l<window.innerWidth;l+=3)0!=c.data[4*(p*window.innerWidth+l)]&&f.push({x:l,y:p,color:"hsl("+(360/r*l-n)+", 50%, 50%)"});k=[];c=0;for(p=Math.ceil(1*f.length);c<p;c++){var l=10*Math.random(),u=Math.random();k.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,dirX:0>.5-Math.random()?u*l:0-u*l,dirY:0>.5-Math.random()?(1-u)*l:0-(1-u)*l,split:u,oldX:0,oldY:0,moveX:0,moveY:0})}w()};var q=function(){if(p=!p)for(var a=l=0;a<k.length;a++)k[a].moveX=0,k[a].moveY=0},w=function(){b.clearRect(0,0,window.innerWidth,window.innerHeight);b.fillStyle="rgb(200, 200, 200)";for(var a=!1,d=0;d<k.length;d++)if(b.fillStyle=d<f.length?f[d].color:"rgb(200, 200, 200)",p)if(d<f.length){var h=d;b.fillRect(k[h].x|0,k[h].y|0,2,2);b.fill();var c=!1,e=f[h],h=k[h];e.x!=h.x&&(2>Math.abs(h.x-e.x)?h.x=e.x:(h.x>e.x?0<h.moveX?h.moveX-=2:--h.moveX:h.moveX=0>h.moveX?h.moveX+2:h.moveX+1,c=!0,h.x+=h.moveX));e.y!=h.y&&(2>Math.abs(h.y-e.y)?h.y=e.y:(h.y>e.y?0<h.moveY?h.moveY-=2:--h.moveY:h.moveY=0>h.moveY?h.moveY+2:h.moveY+1,c=!0,h.y+=h.moveY));c&&(a=!0)}else z(k[d]);else z(k[d]);p&&!a&&(l++,0<l&&180>=l&&(b.globalCompositeOperation="source-atop",b.fillStyle="#fff",a=n-20+(r+40)/180*l,b.fillRect(a,t-20,10,v+40),b.fillRect(a+10+5,t-20,5,v+40),b.globalCompositeOperation="source-over",180==l&&(setTimeout(q,500),setTimeout(q,6E3))));u(w)},z=function(a){a.x+=a.dirX;a.y+=a.dirY;0>a.x?a.dirX=Math.abs(a.dirX):a.x>window.innerWidth&&(a.dirX=0-a.dirX);0>a.y?a.dirY=Math.abs(a.dirY):a.y>window.innerHeight&&(a.dirY=0-a.dirY);b.fillRect(a.x|0,a.y|0,2,2);b.fill()};this.run();c=function(a){void 0===a&&(a="CLEAR DICOMVIEWER 2016");$("\x3cdiv\x3e"+a+"\x3c/div\x3e").appendTo($("body")).css({position:"absolute",bottom:0,color:"rgba(100,100,100,0.2)","font-size":"20px","z-index":"101",cursor:"default"})}(c)};CBoBo.Plugin.Error404=function(){id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px"});var e=document.getElementById(id);e.width=$(window).width();e.height=$(window).height();var c=Math.PI/90,a=e.getContext("2d"),g,b,d,h=[],k=function(a,b,d){b=b||0;a=b+((a-1||0)+1-b)*Math.random();return d?Math.round(a):a},f=function(a){return Math.random()<(a||.5)?-1:1},p=function(d,c,e,p){this.x=d||0;this.y=c||0;this.vx=f()*k(.5,.125);this.vy=f()*k(.5,.125);this.ax=0;this.ay=.01;this.c=e||"white";this.alpha=1;this.r=p||k(3,.5);this.evolve=function(){this.alpha-=.008;this.vx+=this.ax;this.vy+=this.ay;this.x+=this.vx;this.y+=this.vy;this.y>.5*g-this.r&&(this.y=.5*g-this.r,this.vx*=.95,this.vy*=-.9);Math.abs(this.x)>.5*g+2*this.r||this.y<-.5*b-2*this.r||0>=this.alpha?this.destroy():this.draw()};this.draw=function(){a.fillStyle=this.c;a.globalAlpha=this.alpha;a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.closePath();a.fill()};this.destroy=function(){var a=h.indexOf(this);h.splice(a,1)}},l=function(){g=e.width=window.innerWidth;b=e.height=window.innerHeight;d=.25*Math.min(b,g);a.restore();a.save();a.translate(.5*g,.5*b)},m=function(e){var l=d*(2+Math.sin(.73*e))/2,n=l*Math.cos(e),l=l*Math.sin(e),v=~~(.183*e/Math.PI*360)%360,u;u=h.length;a.beginPath();a.clearRect(-.5*g,-.5*b,g,b);for(var q=0;q<u;q++)h[q].evolve(),h.length!=u&&(u--,q--);for(q=0;32>q;q++)u=40*(1+Math.random()),u=new p(n+f()*k(8),l+f()*k(8),"hsl("+v+",100%,"+u+"%)"),u.draw(),h.push(u);requestAnimationFrame(m.bind(this,e+c))};l();m(0);addEventListener("resize",l,!1)};CBoBo.Plugin.Error405=function(){function e(){window.requestAnimationFrame(e);++p;h.globalCompositeOperation="source-over";h.shadowBlur=0;h.fillStyle="rgba(0,0,0,alp)".replace("alp",k.repaintAlpha);h.clearRect(0,0,b,d);h.shadowBlur=k.shadowBlur;h.globalCompositeOperation="lighter";l=k.tickHueMultiplier*p;f.map(function(a){a.step()})}function c(){this.circles=[new a(2,0)];this.rot=Math.random()*Math.PI*2;this.angularVel=Math.random()*k.rayAngularVelSpan*(.5>Math.random()?1:-1);this.angularAccWaveInput=Math.random()*Math.PI*2;this.angularAccWaveInputIncrementer=k.rayAngularAccWaveInputBaseIncrementer+k.rayAngularAccWaveInputAddedIncrementer*Math.random();for(var b=100,d=0;0<--b&&this.circles[d].radius<k.maxRadius;)this.circles.push(new a(++d))}function a(a){this.radius=k.circleRadiusIncrementAcceleration*Math.pow(a,2);this.waveInputIncrementer=(k.baseWaveInputIncrementer+k.addedWaveInputIncrementer*Math.random())*(.5>Math.random()?1:-1)*k.circleNumWaveIncrementerMultiplier*a;this.waveInput=Math.random()*Math.PI*2;this.radiant=Math.random()*k.radiantSpan*(.5>Math.random()?1:-1)}id="c"+CBoBo.Plugin.GetRandom();$("\x3ccanvas id\x3d'"+id+"'\x3e\x3c/canvas\x3e").appendTo($("body"));$("#"+id).css({"z-index":100,position:"absolute",top:"0px",left:"0px"});var g=document.getElementById(id),b=g.width=window.innerWidth,d=g.height=window.innerHeight,h=g.getContext("2d"),k={rays:30,maxRadius:Math.sqrt(b*b/4+d*d/4),circleRadiusIncrementAcceleration:2,radiantSpan:.4,rayAngularVelSpan:.005,rayAngularVelLineWidthMultiplier:60,rayAngularAccWaveInputBaseIncrementer:.03,rayAngularAccWaveInputAddedIncrementer:.02,rayAngularAccWaveMultiplier:3E-4,baseWaveInputIncrementer:.01,addedWaveInputIncrementer:.01,circleNumWaveIncrementerMultiplier:.1,circleNumLineWidthMultiplier:2,cx:b/2,cy:d/2,tickHueMultiplier:1,shadowBlur:0,repaintAlpha:.2},f=[],p=0,l;c.prototype.step=function(){var a=this.rot+=this.angularVel+=Math.sin(this.angularAccWaveInput+=this.angularAccWaveInputIncrementer)*k.rayAngularAccWaveMultiplier,b=k.cx,d=k.cy;h.lineWidth=Math.min(1E-5/Math.abs(this.angularVel),10/k.rayAngularVelLineWidthMultiplier)*k.rayAngularVelLineWidthMultiplier;h.beginPath();h.moveTo(b,d);for(var f=0;f<this.circles.length;++f){var c=this.circles[f];c.step();var a=a+c.radiant,e=k.cx+Math.sin(a)*c.radius,c=k.cy+Math.cos(a)*c.radius;h.quadraticCurveTo(b,d,(b+e)/2,(d+c)/2);b=e;d=c}h.strokeStyle=h.shadowColor="hsl(hue,80%,50%)".replace("hue",(a+this.rot)/2%(2*Math.PI)/Math.PI*30+l);h.stroke()};a.prototype.step=function(){this.waveInput+=this.waveInputIncrementer;this.radiant=Math.sin(this.waveInput)*k.radiantSpan};(function(){for(var a=f.length=0;a<k.rays;++a)f.push(new c);0===p&&e()})()};CBoBo.Plugin.GetTime=function(){var e=new Date,c=e.getMonth()+1,c=10>c?"0"+c:c;return e.getFullYear()+"/"+c+"/"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()};CBoBo.Plugin.SetCookie=function(e,c,a){var g=new Date;g.setTime(g.getTime()+864E5*a);a="expires\x3d"+g.toUTCString();document.cookie=e+"\x3d"+c+"; "+a+";path\x3d/;"};CBoBo.Plugin.GetCookie=function(e){e+="\x3d";for(var c=document.cookie.split(";"),a=0;a<c.length;a++){for(var g=c[a];" "==g.charAt(0);)g=g.substring(1);if(-1!=g.indexOf(e))return g.substring(e.length,g.length)}return""};CBoBo.Plugin.ClearCookie=function(e){CBoBo.Plugin.SetCookie(e,"",-1)};CBoBo.Plugin.FullScreen=function(e){function c(){var a=document.documentElement,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullScreen;"undefined"!=typeof b&&b?b.call(a):"undefined"!=typeof window.ActiveXObject&&(a=new ActiveXObject("WScript.Shell"),null!=a&&a.SendKeys("{F11}"))}function a(){var a=document,b=a.cancelFullScreen||a.webkitCancelFullScreen||a.mozCancelFullScreen||a.exitFullScreen;"undefined"!=typeof b&&b?b.call(a):"undefined"!=typeof window.ActiveXObject&&(a=new ActiveXObject("WScript.Shell"),null!=a&&a.SendKeys("{F11}"))}e?c():a()};CBoBo.Plugin.CloneObj=function(e){var c={};e instanceof Array&&(c=[]);for(var a in e){var g=e[a];c[a]="object"===typeof g?arguments.callee(g):g}return c};"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.PTYPE_JPG=0;CBoBo.PTYPE_SERIES=1;CBoBo.PTYPE_DESERIES=2;CBoBo.TOOL_NULL=0;CBoBo.TOOL_WC=1;CBoBo.TOOL_MOVE=2;CBoBo.TOOL_ZOOM=3;CBoBo.TOOL_PAGE=4;CBoBo.TOOL_M_POINT=5;CBoBo.TOOL_M_LINE=6;CBoBo.TOOL_M_RECT=7;CBoBo.TOOL_M_ELLIPSE=8;CBoBo.TOOL_M_CURVE=9;CBoBo.TOOL_M_ANGLE=10;CBoBo.TOOL_LABEL=11;CBoBo.TOOL_MAG=12;CBoBo.TOOL_POLYGON=13;CBoBo.TOOL_ARROW=14;CBoBo.TOOL_LEFT=15;CBoBo.TOOL_RIGHT=16;CBoBo.TOOL_HEARDRATIO=17;CBoBo.DRAW_IMG=0;CBoBo.DRAW_ANN=1;CBoBo.MPR_ORIGINAL=0;CBoBo.MPR_LEVEL=1;CBoBo.MPR_VERTICAl=2;CBoBo.MPR_ANY=3;CBoBo.TOOLMENU_JPG=0;CBoBo.TOOLMENU_SERIES=1;CBoBo.TOOLMENU_DESERIES=2;CBoBo.TOOLMENU_PRINT_JPG=3;CBoBo.TOOLMENU_PRINT_RADIATE=4;CBoBo.TOOLMENU_MPR=5;CBoBo.TOOLMENU_AI=6;CBoBo.TOOLMENU_VRT=7;CBoBo.MSG_ALERT=0;CBoBo.MSG_SUCCESS=1;CBoBo.MSG_ERROR=2;CBoBo.SMOOTHING_ENABLED=!1;CBoBo.Scrollsize=20;CBoBo.IsMobile=!1;CBoBo.IsTablet=!1;CBoBo.isShowAi=!1;CBoBo.rootDom=null;CBoBo.store={db:{dbName:"DicomView",version:"1",storeName:"DicomStore",_enableImagesDB:localStorage.getItem("enableImagesDB")||!0,get enableImagesDB(){var e=this._enableImagesDB;return void 0===e?e:!!JSON.parse(e)},set enableImagesDB(e){this._enableImagesDB=e=e?1:0;localStorage.setItem("enableImagesDB",e)}},loadQueue:{waitSeriesID:new Map}};CBoBo.Manager=function(e){var c=this,a=this;this.isAIFinished=this.isAIRequestFinished=!1;this.onTool={bShowScountLine:!1,stack:[]};this.handles={};this.privilege={bPrint:void 0,bMupStudy:!1};this.onCanvas={bLMouse:!1,bRMouse:!1,ptStart:{x:0,y:0},ptLast:{x:0,y:0},imgStatus:[],Ann:null,bEditAnn:!1,EditAnnData:null,curCanvas:null,ptLable:null,stampStart:null,bTouchMul:!1,lastScale:1};this.onObserver=function(a,d){this.handles.hasOwnProperty(a)||(this.handles[a]=[]);if("function"==typeof d)this.handles[a].push(d);else throw Error("\u7f3a\u5c11\u56de\u8c03\u51fd\u6570");return this};this.onEmit=function(a,d){if(this.handles.hasOwnProperty(a))this.handles[a].forEach(function(a,b,f){a.apply(null,d)});else throw Error('"'+a+'"\u4e8b\u4ef6\u672a\u6ce8\u518c');return this};this.onOff=function(a,d){if(this.handles.hasOwnProperty(a)){if("function"!=typeof d)throw Error("\u7f3a\u5c11\u56de\u8c03\u51fd\u6570");this.handles[a].forEach(function(a,b,f){a==d&&f.splice(b,1)})}else throw Error('"'+a+'"\u4e8b\u4ef6\u672a\u6ce8\u518c');return this};this.onThumb={bSeriesTile:!1};this.canvasManager;this.logo;this.dataManager;this.thumbManager;this.frame;this.annStatusManager;this.layoutCtrl;this.rotateCtrl;this.wwCtrl;this.lableCtrl;this.pseudocolorCtrl;this.mode;this.canvasCtxMenu;this.thumbCtxMenu;this.seriesPlayer;this.Mpr;this.VRT;this.printer;this.toolBar;this.configView;this.assistDiagnose;this.canvasMax;this.isKeyBoard=!1;this.rootDom=e;this.GlobalInit=function(){$("body,a,img,span").bind("drop",function(a){a.preventDefault();a.stopPropagation()});$("body").bind("touchmove",function(a){a.preventDefault()});document.oncontextmenu=function(a){a.cancelBubble=!0;return a.returnValue=!1};document.onmousedown=function(a){if(window.Event){if(2==a.which||3==a.which)return!1}else if(2==a.button||3==a.button)return a.cancelBubble=!0,a.returnValue=!1};document.onkeydown=function(b){var d=b||window.event||arguments.callee.caller.arguments[0];d&&a.KeyboardMsg(d)};window.screen&&window.resizeTo(screen.availWidth,screen.availHeight);void 0===CBoBo.store.db.enableImagesDB&&a.toggleImageBDHandle(confirm("\u662f\u5426\u5f00\u542f\u56fe\u50cf\u7f13\u5b58\u529f\u80fd"))};this.KeyboardMsg=function(b){if(!a.isKeyBoard){var d=b.shiftKey,h=b.ctrlKey;switch(b.keyCode){case 80:if(!a.privilege.bPrint)break;a.printer||(a.printer=new CBoBo.View.DVPrint({msgtransform:a.PrintView.MsgTransform,mode:a.mode}));a.onTool.MsgTransform({usermsg:"sdaf",btntitle:"\u80f6\u7247\u6253\u5370",btnforce:!0});if(a.printer){var k=[];a.printer.bShow||a.printer.Show(!0);if(a.mode==CBoBo.PTYPE_SERIES&&h)d=a.canvasManager.GetFocusMng().AnnStatusMng().GetAnnStatus(),$.each(d,function(b,d){k.push(a.annStatusManager.GetCopyAnnStatus(d))});else if(d=a.canvasManager.GetFocusCanvas().AnnStatus())d=a.annStatusManager.GetCopyAnnStatus(d),k.push(d);0<k.length&&a.printer.RequestPrint(k)}b.preventDefault();break;case 27:a.canvasMax&&a.canvasMax.bShow&&a.onCanvas.DbClick();break;case 9:case 112:case 117:case 121:case 122:case 114:case 115:case 118:b.preventDefault();case 46:if(d){b=CBoBo.store.db;var f=new simple.IndexedDB(b.dbName,b.storeName,b.version);f.open().then(function(){f.dispatch("clear").then(function(){alert("\u56fe\u50cf\u7f13\u5b58\u6e05\u9664\u6210\u529f")})})}break;case 37:a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.scroll&&a.canvasMax.secondCtrl.scroll.TriggerClick(1):a.canvasManager.scroll&&a.canvasManager.scroll.TriggerClick(1);break;case 38:this.onCanvas.NextPage(1);break;case 39:a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.scroll&&a.canvasMax.secondCtrl.scroll.TriggerClick(-1):a.canvasManager.scroll&&a.canvasManager.scroll.TriggerClick(-1);break;case 40:this.onCanvas.NextPage(-1);break;case 83:h&&b.preventDefault();d&&a.toggleImageBDHandle();break;case 82:h?(a.onTool.ReLoadDicom(),b.preventDefault()):a.onTool.RestoreDicom();break;case 70:a.onTool.Negative();break;case 48:a.onTool.Pseudocolor("");break;case 49:a.onTool.Pseudocolor("\u5f69\u8679");break;case 50:a.onTool.Pseudocolor("\u9ed1\u4f53");break;case 51:a.onTool.Pseudocolor("\u9aa8\u9abc");break;case 52:a.onTool.Pseudocolor("\u5fc3\u810f");break;case 53:a.onTool.Pseudocolor("\u6d41\u52a8");break;case 54:a.onTool.Pseudocolor("Ge\u8272");break;case 55:a.onTool.Pseudocolor("\u5f69\u86791");break;case 56:a.onTool.Pseudocolor("\u7ea2\u8272\u8840\u7ba1");break;case 57:a.onTool.Pseudocolor("\u65af\u7279\u6069")}}};this.DL={arrSpeed:{}};this.DL.OpenStudy=function(){void 0===a.dataManager&&(a.dataManager=new CBoBo.DataManager({render:a.DL.DLFirstProgress,manager:a}));if(0===arguments.length){var b=CBoBo.Plugin.GetUrlParam("Studyuid")||$("#hdstuuid").val(),d=CBoBo.Plugin.GetUrlParam("WadoURL")||$("#hdurl").val(),h=CBoBo.Plugin.GetUrlParam("Hospid")||$("#hdhospid").val(),k=CBoBo.Plugin.GetUrlParam("token")||JSON.parse(localStorage.getItem("token")||localStorage.getItem("Authorization"))||$("#token").val(),f=1==CBoBo.Plugin.GetUrlParam("imageType")?1:0,c=CBoBo.Plugin.GetUrlParam("departCode")||$("#departCode").val()||0,e=CBoBo.Plugin.GetUrlParam("isDesens")||CBoBo.Plugin.GetUrlParam("hasDesensitize")||CBoBo.Plugin.GetUrlParam("hdsensitivity")||$("#hasDesensitize").val()||$("#hdsensitivity").val();""===b?new CBoBo.Plugin.Error("Study not Found.","Studyuid is null."):""===d?new CBoBo.Plugin.Error("Study not Found.","Wadourl is null."):""===h?new CBoBo.Plugin.Error("Study not Found.","Hospitaluid is null."):a.dataManager.Request({wadourl:d,hospid:h,studyuid:b,token:k,imageType:f,departCode:c,hasDesensitize:JSON.parse(e||0)?1:0,serverRead:!1,progress:a.DL.DLFirstProgress,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var b=CBoBo.Plugin.GetTime();console.log(b+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(b){a.Init();var d=a.thumbManager.GetThumb(b.studyuid);void 0===d&&(d=a.thumbManager.AddThumb(b.studyuid));d.First();a.DL.StudySuccess(b)}})}else 3==arguments.length&&(b=arguments[2],d=arguments[0],h=arguments[1],a.dataManager.Request({wadourl:d,hospid:h,studyuid:b,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var b=CBoBo.Plugin.GetTime();console.log(b+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(b){a.privilege.bMupStudy=!1;a.Init();var d=a.thumbManager.GetThumb(b.studyuid);void 0===d&&(d=a.thumbManager.AddThumb(b.studyuid));d.First();a.DL.StudySuccess(b)}}))};this.DL.RequestHistoryStudy=function(){a.privilege.bMupStudy=!1;var b="";$.ajax({url:"/Member/Study/GetHistoryViewerData",data:{requestID:$("#requestid").val()},type:"get",success:function(d){console.log(d);d.success&&(b=d.data,""==b?console.log("\u672a\u68c0\u6d4b\u5230\u5386\u53f2\u68c0\u67e5\u3002"):(console.log(b),0<b.length?b.forEach(function(b,d){a.dataManager.Request({wadourl:b.url,hospid:b.hospid,studyuid:b.stuuid,serverRead:!1,progress:a.DL.DLFirstProgress,error:function(a){if(a.bdicomdata){$.Msg(a.studyuid+":"+a.msg,CBoBo.MSG_ERROR);var b=CBoBo.Plugin.GetTime();console.log(b+"\uff1a"+a.msg)}else new CBoBo.Plugin.Error(a.msg)},success:function(b){a.DL.StudySuccess(b)}})}):console.log("\u672a\u68c0\u6d4b\u5230\u5386\u53f2\u68c0\u67e5\u3002")))}})};this.DL.StudySuccess=function(b){var d=a.thumbManager.GetThumb(b.studyuid);if(void 0===d||null===d)d=a.thumbManager.AddThumb(b.studyuid);a.DL.SetThumbHead(b,d);a.DL.SetThumbSeries(b,d)};this.DL.DLFirstProgress=function(b,d,h,k){b.col=void 0==b.col?512:b.col;b.row=void 0==b.row?512:b.row;a.UpdateCanvas(b);a.DL.DLProgress(b,d,h)};this.DL.DLProgress=function(b,d,h){var k=d.studyuid,f=a.thumbManager.GetThumb(k);void 0===a.DL.arrSpeed[k]&&(a.DL.arrSpeed[k]={dlnums:0,dlspeed:0,total:parseInt(d.imgcount),timer:null});k=a.DL.arrSpeed[k];k.dlnums++;k.dlnums===k.total&&($.Status("\u68c0\u67e5\u4e0b\u8f7d\u5b8c\u6bd5!"),clearInterval(k.timer));a.DL.ProcessMode({study:d,seriespro:function(){f.SetProgress(b.seruid,h)},deseriespro:function(){f.SetProgress(b.id,h)},jpgpro:function(){f.SetProgress(b.id,100)}})};this.DL.SetThumbHead=function(a,d){if(void 0===d)throw"SetThumbHead:parameter study cannot be undefined";if(void 0===a)throw"SetThumbHead:parameter thumb cannot be undefined";var b;""===a.age||null===a.age?b=a.name+" / "+a.sex:("string"===typeof a.age&&0==parseInt(a.age.substring(0,1))&&(a.age=a.age.substring(1)),b=a.name+" / "+a.sex+" / "+a.age);d.SetHeadInfo(b,a.modality,a.studydate)};this.DL.SetThumbSeries=function(b,d){a.DL.ProcessMode({study:b,seriespro:function(){for(var a=b.GetAllSeries(),k,f=0;f<a.length;f++){k=a[f];d.PushSerisesItem(k.uid);if(0<k.arrImage.length){var c=a[f].arrImage[0];d.SetItemInfo(k.uid,"["+(f+1)+"] \u5171"+k.arrImage.length+"\u56fe","\u5e8f\u5217\uff1a"+k.num);d.SetItemIcon(k.uid,c.imageicon,c.id,k)}d.SetProgress(k.uid,0)}},deseriespro:function(){for(var a=b.GetAllDicom(),k=0;k<a.length;k++){var f=a[k],c=f.id;d.PushSerisesItem(c);d.SetItemInfo(c,"["+(k+1)+"] \u51711\u56fe",f.num);d.SetItemIcon(c,f.imageicon,f.id);d.SetProgress(c,0)}},jpgpro:function(){var a=b.GetJpg();$.each(a,function(a,b){var h=b.id;d.PushSerisesItem(h);d.SetItemInfo(a,"["+(a+1)+"] \u5171 1 \u5f20\u56fe","\u7f16\u53f7\uff1a"+b.num);d.SetItemIcon(a,b.imageicon,b.id);d.SetProgress(h,0)})}});d.UpdateStyle();d.UpdateSeriesData()};this.DL.ProcessMode=function(a){if(void 0!==a)switch(a=$.extend(!0,{study:null,seriespro:null,deseriespro:null,jpgpro:null},a),a.study.GetStudyType()){case "jpg":a.jpgpro instanceof Function&&a.jpgpro();break;case "series":a.seriespro instanceof Function&&a.seriespro();break;case "deseries":a.deseriespro instanceof Function&&a.deseriespro()}};this.UpdateCanvas=function(b){if(a.canvasMax&&a.canvasMax.bShow){var d=a.canvasMax.secondCtrl.GetMng()[0],h=d.AnnStatusMng();if(h){var c=d.scroll?d.scroll.draggerPos:1,f=d.GetLayout();if(void 0===f||1>f.row||1>f.col)f={row:1,col:1};var e=a.GetSelArray(h.images,c,f.row,f.col);a.DrawAnnStatusForMng(h,d,!0);d=d.GetAllCanvas();$.each(d,function(a,d){a<e.length&&(a=e[a],a.id===b.id&&a.bLoadImage&&(d.bAnimatStop||d.StopLoadingAnimation(),h.viewport.image=a,1===h.viewport.scale?(CBoBo.ImageProcessor.Restore(h.viewport),CBoBo.Draw.FitServerCanvas(h.viewport,d.canvas)):CBoBo.Draw.FitServerCanvas(h.viewport,d.canvas,!0),d.DrawCornerInfo(h.viewport)))})}}else d=a.canvasManager.GetMng(),$.each(d,function(){var d=this.AnnStatusMng();if(d){var h=this.scroll?this.scroll.draggerPos:1,f=this.GetLayout();if(void 0===f||1>f.row||1>f.col)f={row:1,col:1};var c=a.GetSelArray(d.images,h,f.row,f.col),h=this.GetAllCanvas();$.each(h,function(a,h){a<c.length&&(a=c[a],a.id===b.id&&a.bLoadImage&&(h.bAnimatStop||h.StopLoadingAnimation(),d.viewport.image=a,1===d.viewport.scale?(CBoBo.ImageProcessor.Restore(d.viewport),CBoBo.Draw.FitServerCanvas(d.viewport,h.canvas)):CBoBo.Draw.FitServerCanvas(d.viewport,h.canvas,!0),h.DrawCornerInfo(d.viewport)))})}})};this.InitMulStudyMode=function(){a.privilege.bMupStudy||a.mode==CBoBo.PTYPE_SERIES?a.privilege.bMupStudy=!0:(void 0!==this.canvasManager&&(this.canvasManager.Destroy(),delete this.canvasManager),void 0!==this.annStatusManager&&delete this.annStatusManager,a.privilege.bMupStudy=!0,this.Init())};this.Init=function(){function b(b){b="#"+a.frame.GetId("canvasbox");a.canvasManager=new CBoBo.View.CMngSecondLayer({parent:b,msgtransform:a.MsgTransform,scrollsize:CBoBo.Scrollsize})}void 0===a.frame&&(a.frame=new CBoBo.View.Frame(this.rootDom));void 0===a.thumbManager&&(a.thumbManager=new CBoBo.View.ThumbManager({parent:"#"+a.frame.GetId("thumb"),msgtransform:a.onThumb.MsgTransform}));var d=a.dataManager.GetStudy(0),h=d.GetStudyType();a.InitAnnStatusStack();var c,f;switch(h){case "jpg":c=CBoBo.TOOLMENU_JPG;f=a.onTool.Jpg.MsgTransform;break;case "deseries":c=CBoBo.TOOLMENU_DESERIES;f=a.onTool.MsgTransform;break;case "series":c=CBoBo.TOOLMENU_SERIES,f=a.onTool.MsgTransform}var e=1,g=1;CBoBo.IsMobile&&0==CBoBo.IsTablet?(a.frame.HideToolBar(),b(!0),void 0===a.toolBar&&(a.toolBar=new CBoBo.View.MobileMenuBall({msgtransform:f})),a.toolBar.RequestToolBall(c,f),a.toolBar.toolType="ww"):(a.WindowResize(),b(CBoBo.IsTablet),void 0===a.toolBar&&(a.logo=(new CBoBo.View.Logo("#"+a.frame.GetId("logo"))).SetFont("\u5f71\u50cf\u6e90").SetLogo(""),a.toolBar=new CBoBo.View.PCToolBar({parent:"#"+a.frame.GetId("toolbar"),msgtransform:a.onTool.Main.MsgTransform})),a.toolBar.RequestGrayToolBar(c,f),a.toolBar.toolType="zoom",a.toolBar.modalityType=d.modality,a.toolBar.ChangeBtnStatus("\u653e\u7f29",!0),a.toolBar.ChangeBtnStatus("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0),"series"===h?(e=2,g=3):g=e=1);var m=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(m.length,e,g);d=a.canvasManager.GetMng();void 0!==d&&$.each(d,function(a,b){a<m.length&&b.UpdateLayout(m[a].images.length,1,1)});a.canvasManager.SetDefaultFocus(0,0);a.onTool.ReLoadDicom();a.privilege.bPrint=!0;a.toolBar.EnableButton&&a.toolBar.EnableButton("\u80f6\u7247\u6253\u5370",!0)};this.WindowResize=function(){window.onresize=function(b){a.frame.UpdateStyle();a.logo&&a.logo.SetStyle();a.toolBar&&a.toolBar.UpdateStyle&&a.toolBar.UpdateStyle();a.layoutCtrl&&a.layoutCtrl.UpdateStyle();a.rotateCtrl&&a.rotateCtrl.UpdateStyle();a.lableCtrl&&a.lableCtrl;a.pseudocolorCtrl&&a.pseudocolorCtrl.UpdateStyle();a.thumbManager&&a.thumbManager.ForEach(function(a){a.UpdateStyle()});a.canvasCtxMenu&&a.canvasCtxMenu.UpdateStyle();a.Mpr&&(a.Mpr.UpdateStyle(),a.Mpr.mng.TriggerResize());a.VRT&&(a.VRT.UpdateStyle(),a.VRT.mng.TriggerResize());a.configView&&a.configView.TriggerResize();a.canvasMax&&(a.canvasMax.UpdateStyle(),a.canvasMax.secondCtrl.TriggerResize());a.canvasManager&&a.canvasManager.TriggerResize(b)}};this.InitAnnStatusStack=function(){var b=a.dataManager.GetStudy(0);if(void 0!==b){var d=b.GetStudyType();CBoBo.AnnStatusManager.Clear();switch(d){case "jpg":var h=b.GetJpg();a.annStatusManager.NewAnnStatusArray(b.studyuid,h,d);break;case "deseries":h=b.GetAllDicom();h instanceof Array&&0<h.length&&$.each(h,function(){var a=CBoBo.AnnStatusManager.Create(this,b.studyuid,d);CBoBo.ImageProcessor.Restore(a.viewport)});break;case "series":$.each(b.GetAllSeries(),function(a,h){a=h.GetAllDicom();a=CBoBo.AnnStatusManager.Create(a,b.studyuid,d);CBoBo.ImageProcessor.Restore(a.viewport)})}}};this.DrawAnnStatus=function(b,d,h,c,f){var k=[];d instanceof Array?$.each(d,function(){k.push(this)}):k.push(d);var e,g;void 0!==c&&void 0!==f?(g=Math.min(c,b.images.length-1),d=Math.min(g+f,b.images.length),e=b.images.slice(g,d)):(g=0,d=k.length,e=b.images);var n=a.dataManager.GetStudy(0);n.IsPageSwitch();n.GetStudyType();$.each(k,function(d,c){if(d<e.length)if(d=e[d],d.bLoadImage){if(a.canvasAIMax&&a.canvasAIMax.bShow){var f=n.GetAnnotations();if(!1===a.isAIFinished||!f.length){c.canvas.width=c.canvas.width;c.DrawCornerInfo();c.bAnimatStop&&c.StartLoadingAnimation();return}}c.bAnimatStop||c.StopLoadingAnimation();b.viewport.image=d;if(1===b.viewport.scale&&0===b.viewport.wc&&0===b.viewport.ww||0===b.viewport.wc&&0===b.viewport.ww)CBoBo.ImageProcessor.Restore(b.viewport),CBoBo.Draw.FitServerCanvas(b.viewport,c.canvas,!1,!0);h?CBoBo.Draw.FitServerCanvas(b.viewport,c.canvas):CBoBo.Draw.DrawImage(b.viewport,c.canvas);a.toolBar&&a.toolBar.bShowCornerInfo?c.DrawCornerInfo(b.viewport):c.DrawCornerInfo();if(a.canvasAIMax&&a.canvasAIMax.bShow){var k=d.imageInstanceUid;b.anns[k]instanceof Array||(b.anns[k]=[]);var p=b.viewport;$.each(f,function(d,h){if(h.imageInstanceUid==k){var f=b.anns[k];f.length||$.each(h.annotation,function(a,b){a=CBoBo.Annotation.NewAIAnnotation(p,c.canvas,"rect",b.points[0],b.points[1]);f.push(a)})}a.canvasAIMax.secondCtrl.SetDefaultFocus(0,0)});b.anns[k]instanceof Array||(b.anns[k]=[]);CBoBo.Annotation.DrawAnnotation(b.viewport,c.canvas,b.anns[k])}else b.anns[d.id]instanceof Array||(b.anns[d.id]=[]),CBoBo.Annotation.DrawAnnotation(b.viewport,c.canvas,b.anns[d.id])}else 0==g?simple.canvasDrawImage(c.canvas,d.imageicon):c.StartLoadingAnimation();else c.canvas.width=c.canvas.width,c.DrawCornerInfo()})};this.DrawAnnStatusForMng=function(b,d,h){var c=d.scroll?d.scroll.draggerPos:1,f=d.GetLayout();if(void 0===f||1>f.row||1>f.col)f={row:1,col:1};f=f.row*f.col;c=(c-1)*f;d=d.GetAllCanvas();a.DrawAnnStatus(b,d,h,c,f)};this.GetSelArray=function(a,d,h,c){if(void 0!=a&&void 0!=d&&void 0!=h&&void 0!=c){h*=c;d=(d-1)*h;if(d>a.length-1||0>d)return[];c=a.length-d;return a.slice(d,(h>c?c:h)+d)}};this.ChangeToolBar=function(b){if((b=b.mng.AnnStatusMng())&&!b.bPrint){var d,h;switch(b.type){case "series":d=CBoBo.TOOLMENU_SERIES;h=a.onTool.MsgTransform;break;case "deseries":d=CBoBo.TOOLMENU_DESERIES;h=a.onTool.MsgTransform;break;case "jpg":d=CBoBo.TOOLMENU_JPG;h=a.onTool.Jpg.MsgTransform;break;case CBoBo.TOOLMENU_PRINT_JPG:d=b.type}a.toolBar.RequestToolBall&&a.toolBar.RequestToolBall(d,h);a.toolBar.RequestGrayToolBar&&a.toolBar.RequestGrayToolBar(d,h)}};this.GetContextMenu=function(b){a.canvasCtxMenu&&a.canvasCtxMenu.Destroy();a.canvasCtxMenu="jpg"==b?new CBoBo.View.ContextMenu({action:a.onTool.Jpg.MsgTransform,flash:!0,speed:300,items:[{text:"\u4eae\u5ea6/\u5bf9\u6bd4"},{text:"\u653e\u7f29"},{text:"\u79fb\u52a8"},{text:"\u5220\u9664\u56fe\u50cf"},{text:"\u8d1f\u50cf"},{text:"\u6062\u590d"}]}):new CBoBo.View.ContextMenu({action:a.onTool.MsgTransform,flash:!0,speed:300,items:[{text:"\u8c03\u7a97"},{text:"\u653e\u7f29"},{text:"\u79fb\u52a8"},{text:"\u5220\u9664\u56fe\u50cf"},{text:"\u9006\u65f6\u9488"},{text:"\u987a\u65f6\u9488"},{text:"\u5de6\u53f3\u955c\u50cf"},{text:"\u4e0a\u4e0b\u955c\u50cf"},{text:"\u8d1f\u50cf"},{text:"\u6062\u590d"},{text:"DICOM\u4fe1\u606f"}]});return a.canvasCtxMenu};this.IsUIWaitId=function(b){var d=!1,h=a.canvasManager.GetMng();$.each(h,function(){var h=this.AnnStatusMng();if(h){var c=this.scroll?this.scroll.draggerPos:1,e=this.GetLayout();if(void 0===e||1>e.row||1>e.col)e={row:1,col:1};h=a.GetSelArray(h.images,c,e.row,e.col);$.each(h,function(){this.id===b&&(d=!0)})}});return d};this.DRS={};var g=!0;this.DRS.MsgTransform=function(b){var d=b.value,h=b.firstmng;switch(b.type){case "resize":c.DRS.Resize(b);break;case "scroll":h&&(d=h.AnnStatusMng().images[d-1],0==d.bLoadImage&&g&&(g=!1,setTimeout(function(){g=!0},1E3),c.downLoadLazySeriesHandle(d.customSeriesId)));a.DRS.Scroll(b);break;case "drag":a.DRS.DragImage(b)}};this.DRS.Resize=function(b){a.Mpr&&a.Mpr.bShow&&(a.Mpr.mng.UpdateLayoutSp3(0,"left"),a.Mpr.mng.SetSpBoundaryColor(0,"#F00"),a.Mpr.mng.SetSpBoundaryColor(1,"#0F0"),a.Mpr.mng.SetSpBoundaryColor(2,"#00F"),b=a.Mpr.mng.AnnStatusMng(),a.onCanvas.Mpr.UpdateCanvas(b));a.VRT&&a.VRT.bShow&&(b=a.VRT.mng.AnnStatusMng(),a.onCanvas.VRT.UpdateCanvas(b));if(a.canvasMax&&a.canvasMax.bShow){var d=a.canvasMax.secondCtrl.GetMng()[0];(b=d.AnnStatusMng())&&a.DrawAnnStatusForMng(b,d,!0)}else b=a.canvasManager.GetMng(),$.each(b,function(b,d){(b=d.AnnStatusMng())&&a.DrawAnnStatusForMng(b,d,!0)})};this.DRS.Scroll=function(b){var d=b.value;if(b.firstmng){var h=b.firstmng;if(b=h.AnnStatusMng()){var c=h.GetLayout();if(!(void 0===c||1>c.row||1>c.col)){var f=c.row*c.col,c=h.GetLayoutCanvas();void 0!==c&&(a.DrawAnnStatus(b,c,!1,(d-1)*f,f),a.onTool.ScountLine(!0))}}}else if(b.secondmng)if(b=CBoBo.AnnStatusManager.Get(),a.canvasMax&&a.canvasMax.bShow)h=a.canvasMax.secondCtrl.GetMng()[0],b=b[d-1],h.AnnStatusMng(b),h.UpdateLayout(b.images.length),a.DrawAnnStatusForMng(b,h);else for(var h=a.canvasManager.GetLayout(),d=a.GetSelArray(b,d,h.row,h.col),f=a.canvasManager.GetMng(),e=0;e<f.length;e++)h=f[e],c=h.GetLayoutCanvas(),0===c.length&&h.UpdateLayout(0,1,1),e<d.length?(b=d[e],h.AnnStatusMng(b),h.UpdateLayout(b.images.length),"series"===b.type&&h.checkbox.Show(!0),a.DrawAnnStatus(b,c,!0)):(h.checkbox.Show(!1),$.each(c,function(a,b){b.Clear();b.DrawCornerInfo()}),h.Clear())};this.DRS.DragImage=function(b){var d=b.imgId;b=b.mng;var h=a.dataManager.GetStudy(d),c=h.GetStudyType(),f;switch(c){case "jpg":f=h.GetJpg();b.checkbox.Show(!1);break;case "deseries":f=h.GetDicomById(d);b.checkbox.Show(!1);break;case "series":f=h.GetSeries(d).GetAllDicom(),b.checkbox.Show(!0)}d=b.AnnStatusMng();f=CBoBo.AnnStatusManager.Replace(d,f,h.studyuid,c);void 0!==f&&(b.AnnStatusMng(f),b.UpdateLayout(f.images.length),CBoBo.ImageProcessor.Restore(f.viewport),b=b.GetAllCanvas(),a.DrawAnnStatus(f,b,!0))};this.onThumb.MsgTransform=function(b){switch(b.type){case "click":b.series&&a.downLoadLazySeriesHandle(b.series.customSeriesId);break;case "mousedown":"head"==b.tag&&3==b.which&&(void 0===a.thumbCtxMenu&&(a.thumbCtxMenu=new CBoBo.View.ContextMenu({action:a.onThumb.ToolMsg,flash:!0,speed:300,items:[{text:"\u5220\u9664\u8be5\u68c0\u67e5"},{text:"\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5"}]})),a.thumbCtxMenu.SetReserve(b.studyuid),a.thumbCtxMenu.SetPosition(b.clientX,b.clientY),a.thumbCtxMenu.Show(!0));break;case "doubletap":case "dblclick":a.onThumb.ThumbDbClick(b)}};this.onThumb.ThumbDbClick=function(b){b=parseInt(b.target.title);if(a.Mpr&&a.Mpr.bShow)a.onCanvas.Mpr.DragImage(b);else{var d={type:"drag"};d.imgId=b;d.mng=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetMng()[0]:a.canvasManager.GetFocusMng();a.DRS.MsgTransform(d)}};this.onThumb.ToolMsg=function(b){switch(b.usermsg||b.target.title){case "\u5220\u9664\u8be5\u68c0\u67e5":b=b.reservedata;a.thumbManager.DeleteThumb(b);a.dataManager.DeleteStudy(b);a.annStatusManager.DelAnnStatusMngByStudyUid?a.annStatusManager.DelAnnStatusMngByStudyUid(b):a.annStatusManager.arrAnnStatus=[];a.onTool.ReLoadDicom(!0);break;case "\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5":$.each(a.dataManager.arrStudy,function(){var b=this.studyuid;a.thumbManager.DeleteThumb(b);a.annStatusManager.DelAnnStatusMngByStudyUid?a.annStatusManager.DelAnnStatusMngByStudyUid(b):a.annStatusManager.arrAnnStatus=[];a.onTool.ReLoadDicom(!0)}),a.dataManager.arrStudy=[],a.onTool.ReLoadDicom(!0)}a.Mpr&&a.onCanvas.Mpr.Clear();$.Msg("\u68c0\u67e5\u5220\u9664\u6210\u529f",CBoBo.MSG_SUCCESS)};this.onTool.Main={};this.onTool.Main.MsgTransform=function(b){var d=CBoBo.Plugin.GetBrowserInfo();switch(b.target.title){case "2D":d.isMobile||a.toolBar.Request2DToolBar();a.Mpr&&a.Mpr.Show(!1);a.VRT&&a.VRT.Show(!1);if(a.canvasAIMax){a.canvasAIMax.Show(!1);b=a.canvasManager.scroll?a.canvasManager.scroll.draggerPos:1;var d=a.canvasManager.GetLayout(),h=CBoBo.AnnStatusManager.Get(),c=a.GetSelArray(h,b,d.row,d.col),f;a.canvasManager.EachMng(function(b,d){d<c.length&&(f=c[d],b.AnnStatusMng(f),b.AnnStatusMng()!==f&&b.UpdateLayout(f.images.length),a.DrawAnnStatusForMng(f,b,!0))})}break;case "MPR":a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));a.canvasAIMax&&a.canvasAIMax.Show(!1);void 0===a.Mpr&&(a.Mpr=new CBoBo.View.MPR({parent:"#"+a.frame.GetId("canvasbox"),mode:a.mode,msgtransform:a.onCanvas.Mpr.MsgTransform}),a.Mpr.SetLayout(3));d.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_MPR,a.onTool.Mpr.MsgTransform);a.Mpr.Show(!0);b=a.canvasManager.GetFocusMng();if(!b){$.Msg("\u8bf7\u9009\u62e9\u9700\u8981\u91cd\u5efa\u7684\u5e8f\u5217\uff01");break}if(f=b.AnnStatusMng())if(10>f.images.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20\uff01"),a.onCanvas.Mpr.Clear();else{b=!1;for(d=0;d<f.images.length;d++)if(!f.images[d].bLoadImage){b=!0;break}b?($.Msg("\u8bf7\u7b49\u5f85\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u4e0b\u8f7d\u5b8c\u6bd5!",CBoBo.MSG_ALERT),a.onCanvas.Mpr.Clear()):(a.Mpr.Series(f.images),a.onCanvas.Mpr.InitCanvas())}break;case "AI":a.onEmit("aiClick");break;case "3D":if(a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1)),a.canvasAIMax&&a.canvasAIMax.Show(!1),a.Mpr&&a.Mpr.Show(!1),void 0===a.VRT&&(a.VRT=new CBoBo.View.VRT({parent:"#"+a.frame.GetId("canvasbox"),mode:a.mode,msgtransform:a.onCanvas.VRT.MsgTransform}),a.VRT.SetLayout()),d.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_VRT,a.onTool.VRT.MsgTransform),a.VRT.Show(!0),b=a.canvasManager.GetFocusMng()){if(f=b.AnnStatusMng())if(10>f.images.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20\uff01"),a.onCanvas.VRT.Clear();else{b=!1;for(d=0;d<f.images.length;d++)if(!f.images[d].bLoadImage){b=!0;break}b?($.Msg("\u8bf7\u7b49\u5f85\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u4e0b\u8f7d\u5b8c\u6bd5!",CBoBo.MSG_ALERT),a.onCanvas.VRT.Clear()):(a.VRT.Series(f.images),a.onCanvas.VRT.InitCanvas())}}else $.Msg("\u8bf7\u9009\u62e9\u9700\u8981\u91cd\u5efa\u7684\u5e8f\u5217\uff01")}};this.MsgTransform=function(b){switch(b.type){case "click":var d=b.mng.AnnStatusMng();if(!d)return;a.downLoadLazySeriesHandle(d.images[0].customSeriesId);break;case "resize":case "scroll":case "drag":a.DRS.MsgTransform(b);return}if(d=b.mng)if(d=d.AnnStatusMng()){var h=d.viewport;if("jpg"===d.type){if(!h.GetImage().bLoaded)return;d=a.onCanvas.Jpg.MsgTransform}else{if(!h.image.bLoadImage)return;d=a.onCanvas.MsgTransform}d(b)}};this.downLoadLazySeriesHandle=function(b,d){d=void 0===d?1:d;if(b){var h=a.dataManager.arrStudy[0],c=h.GetWaitLoadSeries({seriesId:b,params:"threadPostData"});if(c.length){var f=[];if(1==d){var e=CBoBo.store.loadQueue.waitSeriesID;e.delete(b);for(var g=$jscomp.makeIterator(e),m=g.next();!m.done;m=g.next()){var m=$jscomp.makeIterator(m.value).next().value,n=h.GetWaitLoadSeries({seriesId:m,params:"threadPostData"});n.length?f.unshift.apply(f,[].concat($jscomp.arrayFromIterable(n))):e.delete(m)}e.set(b)}window.mergeThread.postMessage({type:d,arrpriority:[].concat($jscomp.arrayFromIterable(c),$jscomp.arrayFromIterable(f))})}}};this.toggleImageBDHandle=function(a){void 0===a&&(a=!CBoBo.store.db.enableImagesDB);a=!!a;window.mergeThread&&window.mergeThread.postMessage({store:{enableImagesDB:a}});CBoBo.store.db.enableImagesDB=a;if(!a){var b=CBoBo.store.db,h=new simple.IndexedDB(b.dbName,b.storeName,b.version);h.open().then(function(){h.dispatch("clear")})}alert("\u56fe\u50cf\u7f13\u5b58\u529f\u80fd\u5df2\u7ecf"+(a?"\u5f00\u542f":"\u5173\u95ed")+"\u3002(\u5feb\u6377\u952e\uff1ashift+s\uff1b\u8be6\u89c1\u53f3\u4e0a\u89d2\u6309\u952e\u8bf4\u660e)");return a};this.UpdateAICanvas=function(){var b=CBoBo.Plugin.GetBrowserInfo();a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));a.Mpr&&a.Mpr.Show(!1);b.isMobile||a.toolBar.RequestToolBar(CBoBo.TOOLMENU_AI);void 0===a.canvasAIMax&&(a.canvasAIMax=new CBoBo.View.AI({parent:"#"+a.frame.GetId("canvasbox"),refrence:"#"+a.frame.GetId("contain"),msgtransform:a.MsgTransform}));a.canvasAIMax.bShow=!0;a.canvasAIMax.Show(!0);b=CBoBo.AnnStatusManager.Get();if(a.canvasAIMax.bShow){var d=a.canvasManager.GetFocusMng(),h=d.AnnStatusMng(),c=CBoBo.AnnStatusManager.GetIndex(h);void 0===c&&(c=0);a.canvasAIMax.secondCtrl.UpdateLayout(b.length,1,1,c+1);c=d.GetEventImageIndex(event.self);d=a.canvasAIMax.secondCtrl.GetMng()[0];d.UpdateLayout(h.images.length,1,1,c+1);d.AnnStatusMng(h);var f=d.GetAllCanvas()[0];$.each(b,function(){CBoBo.ImageProcessor.FitCanvas(h.viewport,f.canvas,!1,!0)});a.DrawAnnStatusForMng(h,d);a.canvasAIMax.secondCtrl.SetDefaultFocus(0,0)}};this.onCanvas.Jpg={};this.onCanvas.Jpg.MsgTransform=function(b){var d=b.self,h=d.AnnStatus(),c=h.status;switch(b.type){case "touchstart":case "mousedown":a.onCanvas.stampStart=b.timeStamp;a.SaveStartStatus(b,c);"touchstart"==b.type?(h=b.originalEvent.targetTouches[0],a.onCanvas.ptStart=CBoBo.Plugin.TransCoord(d,h.pageX,h.pageY),a.onCanvas.bLMouse=!0):a.onCanvas.ptStart=CBoBo.Plugin.TransCoord(d,b.pageX,b.pageY);switch(b.which){case 1:a.onCanvas.bLMouse=!0;break;case 3:a.onCanvas.bRMouse=!0}a.ChangeToolBar(b);break;case "touchmove":case "mousemove":if(a.onCanvas.bLMouse)a.onCanvas.Jpg.MouseLMove(d,c,b);else if(a.onCanvas.bRMouse)h=CBoBo.Plugin.TransCoord(d,b.pageX,b.pageY),a.onCanvas.Jpg.BC(d,h);else{var f;"touchmove"==b.type?(h=b.originalEvent.targetTouches[0],h=CBoBo.Plugin.TransCoord(d,h.pageX,h.pageY),f=b.originalEvent.targetTouches.length):h=CBoBo.Plugin.TransCoord(d,b.pageX,b.pageY);f&&2==f&&a.onCanvas.Jpg.Move(d,h)}break;case "touchend":case "mouseup":case "mouseout":case "pinchend":a.onCanvas.bRMouse&&200>b.timeStamp-a.onCanvas.stampStart&&(d=a.GetContextMenu(CBoBo.PTYPE_JPG))&&(d.SetPosition(b.clientX,b.clientY),d.Show(!0));a.onCanvas.bLMouse=!1;a.onCanvas.bRMouse=!1;a.onCanvas.imgStatus=[];break;case "dblclick":case "doubletap":a.privilege.bMupStudy?a.onCanvas.DbClick(h):a.canvasManager.bMax?(b=a.onTool.stack.pop(),f=a.onTool.stack.pop(),d=a.onTool.stack.pop(),h=a.onTool.stack.pop(),void 0!=h&&void 0!=d&&a.onTool.Jpg.MsgTransform({target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:h,col:d,max:!0,maxdata:{scrollpos:f,focusindex:b}})):(a.onTool.stack.push(a.canvasManager.nLayoutRow),a.onTool.stack.push(a.canvasManager.nLayoutCol),f=1,void 0!=a.canvasManager.scroll&&(f=a.canvasManager.scroll.draggerPos),a.onTool.stack.push(f),h=a.canvasManager.GetFocusCanvas().AnnStatus(),b=a.canvasManager.GetCanvasIndex(),a.onTool.stack.push(b),a.onTool.Jpg.MsgTransform({target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:1,max:!0,maxdata:{annstatus:h,focusindex:b}}));break;case "mousewheel":a.onCanvas.NextPage(b.deltaY);break;case "pinchstart":a.onCanvas.bLMouse=!1;a.SaveStartStatus();break;case "pinch":a.onCanvas.Jpg.Zoom(d,b.scale);break;case "message":a.onCanvas.Jpg.DrawImage(b)}};this.onCanvas.Jpg.MouseLMove=function(b,d,h){"touchmove"==h.type?(d=h.originalEvent.targetTouches[0],d=CBoBo.Plugin.TransCoord(b,d.pageX,d.pageY)):d=CBoBo.Plugin.TransCoord(b,h.pageX,h.pageY);var c=d.y-a.onCanvas.ptStart.y;if(0!=d.x-a.onCanvas.ptStart.x||0!=c)switch(h.tooltype||a.toolBar.toolType){case CBoBo.TOOL_MOVE:a.onCanvas.Jpg.Move(b,d);break;case CBoBo.TOOL_ZOOM:a.onCanvas.Jpg.Zoom(b,d);break;case CBoBo.TOOL_WC:a.onCanvas.Jpg.BC(b,d)}};this.onCanvas.Jpg.BC=function(b,d){var h=d.x-a.onCanvas.ptStart.x;d=d.y-a.onCanvas.ptStart.y;if(0!=h||0!=d){var c=b.AnnStatus().status;if(void 0!=c||void 0!=c.imageInfo){var f=a.onCanvas.imgStatus[0],e=f.brightness,f=f.contrast,e=e+(h>>2),f=f+(d>>2);-100>e&&(e=-100);100<e&&(e=100);-100>f&&(f=-100);100<f&&(f=100);c.SetBriCon(e,f);c.DrawImg(b)}}};this.onCanvas.Jpg.Move=function(b,d){var h=d.x-a.onCanvas.ptStart.x;d=d.y-a.onCanvas.ptStart.y;if(0!=h||0!=d){var c=b.AnnStatus().status;if(void 0!=c||void 0!=c.image){var f=a.onCanvas.imgStatus[0],f={x:f.ptLast.x,y:f.ptLast.y};f.x+=h>>0;f.y+=d>>0;c.MoveImage(f);c.DrawImg(b)}}};this.onCanvas.Jpg.Zoom=function(b,d){var h=!1;"number"==typeof d&&(h=!0);if(!h){var c=d.y-a.onCanvas.ptStart.y;if(0==c)return}if(0!=c){var f=b.AnnStatus().status;if(void 0!=f||void 0!=f.image){var e=a.onCanvas.imgStatus[0].zoomRatio,g=f.GetImageSize(),e=h?e*d:e-3*c/g.width;.02>e&&(e=.02);10<e&&(e=10);f.ZoomImage(e*g.width,e*g.height);f.DrawImg(b)}}};this.onCanvas.Jpg.DrawImage=function(a){var b=a.self;b.drawlock=!0;var h=b.GetCanvas(),c=b.AnnStatus();if(null!=c&&void 0!=c&&(c=c.status,void 0!=a.data)){var f=document.createElement("canvas");f.width=a.data.width;f.height=a.data.height;console.log("3");f.getContext("2d").putImageData(a.data,0,0);a=h.getContext("2d");a.clearRect(0,0,h.width,h.height);var e=c.scaledWidth,g=c.scaledHeight,m=c.ptLast,n=c.GetImageSize();a.drawImage(f,0,0,n.width,n.height,(h.width-e)/2+m.x,(h.height-g)/2+m.y,e,g);c.DrawText(b)}};this.onTool.Jpg={};this.onTool.Jpg.MsgTransform=function(b){var d=b.usermsg||b.target.title;switch(d){case "\u91ca\u653e\u5de5\u5177":a.toolBar.toolType=CBoBo.TOOL_NULL;break;case "\u91cd\u65b0\u52a0\u8f7d":a.onTool.Jpg.ReLoad();break;case "\u56fe\u50cf\u5e03\u5c40":case "\u5e8f\u5217\u5e03\u5c40":console.log(0);void 0==a.layoutCtrl&&(a.layoutCtrl=new CBoBo.View.LayoutCtrl({msgtransform:a.onTool.Jpg.MsgTransform,radio:!1}));a.layoutCtrl.bShow?a.layoutCtrl.Show(!1):(a.layoutCtrl.SetPosition(b.clientX-8,.4*CBoBo.View.TOOLBAR_HEIGHT>>0),a.layoutCtrl.Show(!0),a.layoutCtrl.Type(d));break;case "\u6062\u590d":a.onTool.Jpg.Restore();break;case "\u653e\u7f29":a.toolBar.toolType=CBoBo.TOOL_ZOOM;break;case "\u79fb\u52a8":a.toolBar.toolType=CBoBo.TOOL_MOVE;break;case "\u8d1f\u50cf":a.onTool.Jpg.Negative();break;case "\u4f2a\u5f69":void 0==a.pseudocolorCtrl&&(a.pseudocolorCtrl=new CBoBo.View.PseudoColorCtrl({msgtransform:a.onTool.Jpg.MsgTransform}));a.pseudocolorCtrl.bShow?a.pseudocolorCtrl.Show(!1):(a.pseudocolorCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.pseudocolorCtrl.Show(!0));break;case "\u4eae\u5ea6/\u5bf9\u6bd4":case "\u4eae/\u5bf9\u6bd4":case "\u8c03\u7a97":a.toolBar.toolType=CBoBo.TOOL_WC;break;case "\u5220\u9664\u56fe\u50cf":a.onTool.Jpg.Delete();break;case "\u5e03\u5c40\u63a7\u4ef6":if(a.privilege.bMupStudy)a.onTool.CanvasLayout(b);else{var h,d=!1,c,f=b.maxdata;b.max&&(void 0!=f.annstatus?(c=f.focusindex+1,h=[],h.push(f.annstatus),d=!0):c=f.scrollpos);var e=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(e.length,b.row,b.col,c);var g=a.canvasManager.GetLayoutCanvas();$.each(e,function(a,b){b.status.FitCanvas(g[0])});void 0==c&&(c=1);d||(h=a.GetSelArray(e,c,b.row,b.col),void 0!=f&&a.canvasManager.Focus(f.focusindex));a.FlushAnnStatusForCanvas(h,g)}break;case "\u7070\u8272":case "\u5f69\u8679":case "\u9ed1\u4f53":case "\u9aa8\u9abc":case "\u5fc3\u810f":case "\u6d41\u52a8":case "Ge\u8272":case "\u7070\u8272\u5f69\u8679":case "\u70ed\u7eff":case "\u94ec\u94c1":case "\u70ed\u91d1\u5c5e":case "\u9971\u548c\u5ea61":case "\u9971\u548c\u5ea62":case "\u7ea2\u5916":case "\u58a8\u9ed1":case "\u9aa8\u9abc-\u808c\u8089":case "NIH":case "\u5f69\u86791":case "\u5f69\u86792":case "\u5f69\u86793":case "\u6bd4\u503c":case "\u7ea2\u8272\u8840\u7ba1":case "\u5149\u8c31":case "\u65af\u7279\u6069":case "UCLA":a.onTool.Pseudocolor(b.target.title);break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":a.onTool.MsgTransform({usermsg:"\u663e/\u9690\u56db\u89d2\u4fe1\u606f"});break;case "dragend":$.Msg("dragend");break;case "drag":$.Msg("drag");break;case "hold":$.Msg("hold");break;case "\u914d\u7f6e":a.onTool.MsgTransform(b);break;case "\u80f6\u7247\u6253\u5370":a.onTool.MsgTransform(b);break;case "\u534f\u540c\u8bca\u65ad":a.onTool.MsgTransform({usermsg:d})}CBoBo.Plugin.GetBrowserInfo().isMobile||!1!==a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce)||(a.toolBar.toolType=CBoBo.TOOL_NULL,a.toolBar.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))};this.onTool.Jpg.Restore=function(){var b=a.canvasManager.GetFocusCanvas(),d=b.AnnStatus().status;void 0!=d&&(d.Restore(),d.FitCanvas(b).DrawImg(b))};this.onTool.Jpg.Delete=function(){if(a.privilege.bMupStudy)a.onTool.DeleteDicom();else{var b=a.canvasManager.GetFocusCanvas();a.annStatusManager.DeleteAnnStatus(b.AnnStatus());b=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(b.length);var d=a.canvasManager.GetLayoutCanvas();a.FlushAnnStatusForCanvas(b,d,!0)}};this.onTool.Jpg.ReLoad=function(b){a.onTool.MsgTransform({usermsg:"\u91cd\u65b0\u52a0\u8f7d"})};this.onTool.Jpg.Negative=function(){var b=a.canvasManager.GetFocusCanvas(),d=b.AnnStatus().status;void 0!=d&&(d.SetNegative(!d.GetNegative()),d.DrawImg(b))};this.onCanvas.MsgTransform=function(b){var d=b.mng.AnnStatusMng(),h=b.mng.GetEventImageIndex(b.self);if(d&&!(h>d.images.length-1))switch(b.type){case "touchstart":case "mousedown":a.onCanvas.stampStart=b.timeStamp;"touchstart"==b.type?(a.onCanvas.lastScale=d.viewport.scale,d=b.originalEvent.targetTouches[0],a.onCanvas.ptStart=new Point(d.pageX,d.pageY),1===b.originalEvent.touches.length?a.onCanvas.which=1:a.onCanvas.bTouchMul=!0):(a.onTool.ScountLine(!0),a.onCanvas.which=b.which,a.onCanvas.ptStart=new Point(b.pageX,b.pageY));"ww"==a.toolBar.toolType&&(a.onCanvas.which=3);0===a.toolBar.toolType&&(a.onCanvas.which=4);a.onCanvas.ptLast=new Point(a.onCanvas.ptStart);a.onCanvas.MouseDown(b);a.ChangeToolBar(b);break;case "touchmove":case "mousemove":0!==a.onCanvas.which||"touchmove"==b.type&&2===b.originalEvent.touches.length?a.onCanvas.MouseDowmMove(b):a.onCanvas.MouseMove(b);break;case "touchend":case "mouseup":case "mouseout":case "pinchend":a.onCanvas.MouseUp(b);break;case "dblclick":case "doubletap":a.onCanvas.DbClick(b);break;case "mousewheel":a.onCanvas.NextPage(b.deltaY);break;case "pinchstart":a.onCanvas.which=0;break;case "pinch":a.onCanvas.ZOOM(b.scale);break;case "hold":$.Msg("hold")}};this.onCanvas.MouseDown=function(b){if(1===a.onCanvas.which){var d=b.mng.AnnStatusMng(),h=d.viewport,c=b.mng.GetEventImageIndex(b.self),c=d.images[c];void 0!==c&&(a.canvasAIMax&&a.canvasAIMax.bShow?(c=c.imageInstanceUid,d.anns[c]instanceof Array||(d.anns[c]=[]),d=d.anns[c]):(d.anns[c.id]instanceof Array||(d.anns[c.id]=[]),d=d.anns[c.id]),c=b.self.canvas,b=b.tooltype||a.toolBar.toolType,CBoBo.Annotation.ScanClickTextBox(h,c,d,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y),CBoBo.Annotation.ActiveAnnotation(d)||(h=CBoBo.Annotation.NewAnnotation(h,c,b,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y),void 0!==h&&d.push(h)))}};this.onCanvas.MouseDowmMove=function(b){var d;"touchmove"==b.type?(d=b.originalEvent.targetTouches[0],d=new Point(d.pageX,d.pageY)):d=new Point(b.pageX,b.pageY);var h=d.x-a.onCanvas.ptLast.x,c=d.y-a.onCanvas.ptLast.y;if(0!==h||0!==c){if(2==a.onCanvas.which||"touchmove"==b.type&&2===b.originalEvent.touches.length)a.onCanvas.MOVE(h,c);else if(3==a.onCanvas.which)a.onCanvas.WW(h,c);else if(4==a.onCanvas.which)5<Math.abs(c)&&(0<c?a.onCanvas.NextPage(-1):a.onCanvas.NextPage(1));else if(1==a.onCanvas.which){var f=b.mng.AnnStatusMng(),e=f.viewport,g=b.mng.GetEventImageIndex(b.self),g=f.images[g];if(void 0===g)return;e.image=g;a.canvasAIMax&&a.canvasAIMax.bShow?(g=g.imageInstanceUid,f.anns[g]instanceof Array||(f.anns[g]=[]),f=f.anns[g]):(f.anns[g.id]instanceof Array||(f.anns[g.id]=[]),f=f.anns[g.id]);g=b.tooltype||a.toolBar.toolType;b=b.self.canvas;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(!CBoBo.Annotation.MaybeServerModifyActiveAnn(e,b,f,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y,d.x,d.y))switch(g){case "zoom":a.onCanvas.ZOOM(h,c);break;case "ww":a.onCanvas.WW(h,c);break;case "move":a.onCanvas.MOVE(h,c)}}else if(!CBoBo.Annotation.MaybeModifyActiveAnn(e,b,f,a.onCanvas.ptLast.x,a.onCanvas.ptLast.y,d.x,d.y))switch(g){case "zoom":a.onCanvas.ZOOM(h,c);break;case "ww":a.onCanvas.WW(h,c);break;case "move":a.onCanvas.MOVE(h,c);break;case "heartratio":case "r":case "l":case ".":case "angle":case "arrow":case "ellipse":case "probe":case "rect":case "line":CBoBo.Annotation.UnfinishedAnn(e,b,f,g,d.x,d.y)}}a.onCanvas.ptLast=d}};this.onCanvas.MouseUp=function(b){if(1===a.onCanvas.which||a.onCanvas.bTouchMul){var d=b.mng.AnnStatusMng(),h=d.viewport,c=b.mng.GetEventImageIndex(b.self),c=d.images[c];if(void 0===c)return;h.image=c;var f;a.canvasAIMax&&a.canvasAIMax.bShow?(c=c.imageInstanceUid,d.anns[c]instanceof Array||(d.anns[c]=[]),f=d.anns[c]):(d.anns[c.id]instanceof Array||(d.anns[c.id]=[]),f=d.anns[c.id]);var d=b.tooltype||a.toolBar.toolType,e=b.self.canvas,c=CBoBo.Annotation.GetMaybeSaveAnn(d,h,e);void 0!==c?(f.push(c),CBoBo.Draw.GetIsFromServer()&&CBoBo.Annotation.ServerGetMaybeSaveAnn(d,h,e,c).then(function(a){CBoBo.ImageProcessor.DrawGrayImage(h,e);CBoBo.Annotation.DrawAnnotation(h,e,f);CBoBo.Annotation.MaybeEndModifyAnn()})):CBoBo.Draw.GetIsFromServer()&&(b=new Point(b.pageX,b.pageY),console.log(b),b=CBoBo.Annotation.ServerHoverAnnotation(h,e,f,b.x,b.y),CBoBo.Annotation.ServerGetMaybeSaveAnn(d,h,e,b).then(function(a){CBoBo.ImageProcessor.DrawGrayImage(h,e);CBoBo.Annotation.DrawAnnotation(h,e,f);CBoBo.Annotation.MaybeEndModifyAnn()}));CBoBo.Annotation.MaybeEndModifyAnn()}else 3===a.onCanvas.which&&"mouseup"===b.type&&(d=CBoBo.Annotation.Distance(new Point(b.pageX,b.pageY),a.onCanvas.ptStart),200>b.timeStamp-a.onCanvas.stampStart&&1>d&&(d=a.GetContextMenu("series")))&&(d.SetPosition(b.clientX,b.clientY),d.Show(!0));a.onCanvas.bTouchMul=!1;a.onCanvas.which=0};this.onCanvas.MouseMove=function(b){var d=b.mng.AnnStatusMng(),c;if("touchmove"==b.type){if(1!==b.originalEvent.touches.length){a.onCanvas.bTouchMul=!0;return}c=b.originalEvent.targetTouches[0];c=new Point(c.pageX,c.pageY)}else c=new Point(b.pageX,b.pageY);var e=c.y-a.onCanvas.ptLast.y;if(0!==c.x-a.onCanvas.ptLast.x||0!==e){var e=d.viewport,f=b.mng.GetEventImageIndex(b.self),f=d.images[f];if(void 0!==f){e.image=f;a.canvasAIMax&&a.canvasAIMax.bShow?(f=f.imageInstanceUid,d.anns[f]instanceof Array||(d.anns[f]=[]),d=d.anns[f]):(d.anns[f.id]instanceof Array||(d.anns[f.id]=[]),d=d.anns[f.id]);var f=b.self.canvas,g=b.tooltype||a.toolBar.toolType;if(0===a.onCanvas.which&&!CBoBo.Annotation.UnfinishedAnn(e,f,d,g,c.x,c.y)&&(CBoBo.Annotation.ScanHoverAnnotation(e,f,d,c.x,c.y),"touchmove"==b.type&&"pointer"==f.style.cursor)){switch(a.toolBar.toolType){case "line":a.toolBar.ChangeBtnStatus("\u76f4\u7ebf");break;case "rect":a.toolBar.ChangeBtnStatus("\u77e9\u5f62");break;case "ellipse":a.toolBar.ChangeBtnStatus("\u692d\u5706");break;case "angle":a.toolBar.ChangeBtnStatus("\u89d2\u5ea6")}a.toolBar.toolType="."}a.onCanvas.ptLast=c;a.onTool.ScountLine(!0)}}};this.onCanvas.WW=function(b,d){var c,e,f;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(c=a.canvasAIMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng())f=e.viewport,f.ww+=parseInt(b*f.wwScale),f.wc+=parseInt(d*f.wwScale),2>f.ww&&(f.ww=2),a.DrawAnnStatusForMng(e,c)}else if(a.canvasMax&&a.canvasMax.bShow){if(c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng())f=e.viewport,f.ww+=parseInt(b*f.wwScale),f.wc+=parseInt(d*f.wwScale),2>f.ww&&(f.ww=2),a.DrawAnnStatusForMng(e,c)}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,h){if(c=h.AnnStatusMng()){var f=c.viewport;f.ww+=parseInt(b*f.wwScale);f.wc+=parseInt(d*f.wwScale);2>f.ww&&(f.ww=2);a.DrawAnnStatusForMng(c,h)}})};this.onCanvas.MOVE=function(b,d){var c,e,f;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(c=a.canvasAIMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng())f=e.viewport,f.translation.x+=parseInt(b/f.scale),f.translation.y+=parseInt(d/f.scale),a.DrawAnnStatusForMng(e,c)}else if(a.canvasMax&&a.canvasMax.bShow){if(c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng())f=e.viewport,f.translation.x+=parseInt(b/f.scale),f.translation.y+=parseInt(d/f.scale),a.DrawAnnStatusForMng(e,c)}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,h){if(c=h.AnnStatusMng()){var f=c.viewport;f.translation.x+=b/f.scale;f.translation.y+=d/f.scale;a.DrawAnnStatusForMng(c,h)}})};this.onCanvas.ZOOM=function(b,d){var c,e,f;if(a.canvasAIMax&&a.canvasAIMax.bShow){if(c=a.canvasAIMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng())f=e.viewport,f.scale=void 0===d?a.onCanvas.lastScale*b:f.scale+d/100,.01>f.scale&&(f.scale=.01),f.scale=parseFloat(f.scale.toFixed(2)),a.DrawAnnStatusForMng(e,c)}else if(a.canvasMax&&a.canvasMax.bShow){if(c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng())f=e.viewport,f.scale=void 0===d?a.onCanvas.lastScale*b:f.scale+d/100,.01>f.scale&&(f.scale=.01),f.scale=parseFloat(f.scale.toFixed(2)),a.DrawAnnStatusForMng(e,c)}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,h){if(c=h.AnnStatusMng()){var f=c.viewport;f.scale=void 0===d?a.onCanvas.lastScale*b:f.scale+d/100;.01>f.scale&&(f.scale=.01);f.scale=parseFloat(f.scale.toFixed(2));a.DrawAnnStatusForMng(c,h)}})};this.onCanvas.NextPage=function(b){var d;a.canvasMax&&a.canvasMax.bShow?(d=a.canvasMax.secondCtrl.GetMng()[0],d.scroll&&d.scroll.TriggerClick(b)):a.canvasAIMax&&a.canvasAIMax.bShow?(d=a.canvasAIMax.secondCtrl.GetMng()[0],d.scroll&&d.scroll.TriggerClick(b)):(d=a.canvasManager.GetActiveMng(),$.each(d,function(a,d){d.scroll&&d.scroll.TriggerClick(b)}))};this.onCanvas.DbClick=function(b){if(!a.canvasAIMax||!a.canvasAIMax.bShow){var d=a.canvasManager.GetLayout();if(1===d.row&&1===d.col){var c=a.canvasManager.GetFocusMng(),d=c.GetLayout();if(1===d.row&&1===d.col)return}a.seriesPlayer&&a.seriesPlayer.bShow&&(a.seriesPlayer.Show(!1),a.toolBar.ChangeBtnStatus("\u5e8f\u5217\u64ad\u653e",!1));void 0===a.canvasMax&&(a.canvasMax=new CBoBo.View.CanvasMax({parent:"#"+a.frame.GetId("canvasbox"),msgtransform:a.MsgTransform}));a.canvasMax.bShow=!a.canvasMax.bShow;c=a.canvasMax.bShow;a.canvasMax.Show(c);d=CBoBo.AnnStatusManager.Get();if(c){var c=b.mng,e=c.AnnStatusMng(),f=CBoBo.AnnStatusManager.GetIndex(e);void 0===f&&(f=0);a.canvasMax.secondCtrl.UpdateLayout(d.length,1,1,f+1);f=c.GetEventImageIndex(b.self);c=a.canvasMax.secondCtrl.GetMng()[0];c.UpdateLayout(e.images.length,1,1,f+1);c.AnnStatusMng(e);var g=c.GetAllCanvas()[0];$.each(d,function(){CBoBo.Draw.FitServerCanvas(this.viewport,g.canvas,!1,!0)});a.DrawAnnStatusForMng(e,c);a.canvasMax.secondCtrl.SetDefaultFocus(0,0)}else{b=a.canvasManager.scroll?a.canvasManager.scroll.draggerPos:1;var c=a.canvasManager.GetLayout(),l=a.GetSelArray(d,b,c.row,c.col);a.canvasManager.EachMng(function(b,d){d<l.length&&(e=l[d],b.AnnStatusMng(e),b.AnnStatusMng()!==e&&b.UpdateLayout(e.images.length),a.DrawAnnStatusForMng(e,b,!0))})}}};this.onTool.MsgTransform=function(b){var d=b.usermsg||b.target.title;switch(d){case "\u91ca\u653e\u5de5\u5177":a.toolBar.toolType=CBoBo.TOOL_NULL;break;case "\u91cd\u65b0\u52a0\u8f7d":void 0!==a.lableCtrl&&a.lableCtrl.Show(!1);a.onTool.ReLoadDicom(!0);break;case "\u5e8f\u5217\u5e03\u5c40":case "\u56fe\u50cf\u5e03\u5c40":void 0==a.layoutCtrl&&(a.layoutCtrl=new CBoBo.View.LayoutCtrl({msgtransform:a.onTool.MsgTransform,radio:!1}));a.layoutCtrl.bShow?a.layoutCtrl.Show(!1):(a.layoutCtrl.SetPosition(b.clientX-8,.4*CBoBo.View.TOOLBAR_HEIGHT>>0),a.layoutCtrl.Show(!0),a.layoutCtrl.Type(d));break;case "\u6062\u590d":a.onTool.RestoreDicom();break;case "\u5b9a\u4f4d\u7ebf":a.onTool.bShowScountLine?($.Msg("\u5b9a\u4f4d\u7ebf\u5df2\u5173\u95ed\u3002",CBoBo.MSG_SUCCESS),a.onTool.bShowScountLine=!1,d=a.canvasManager.GetMng(),$.each(d,function(b,d){(b=d.AnnStatusMng())&&a.DrawAnnStatusForMng(b,d)})):($.Msg("\u5b9a\u4f4d\u7ebf\u5df2\u5f00\u542f\u3002",CBoBo.MSG_SUCCESS),a.onTool.bShowScountLine=!0,a.onTool.ScountLine());break;case "\u5e8f\u5217\u64ad\u653e":void 0==a.seriesPlayer&&(a.seriesPlayer=new CBoBo.View.SeriesPlayer({msgtransform:a.onTool.MsgTransform}));if(a.seriesPlayer.bShow)a.seriesPlayer.Show(!1);else{var c;c=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetFocusMng():a.canvasManager.GetFocusMng();d=c.GetBoundary();a.seriesPlayer.SetPosition(d.left+(d.width-300>>1),d.top+d.height-45);var e=1;if(d=c.AnnStatusMng())d=d.images,e=d.length,1==e&&(e=d[0].frames);a.seriesPlayer.SaveSeriesTag(c);a.seriesPlayer.SetRange(e);a.seriesPlayer.Show(!0);a.seriesPlayer.TriggerClick(2)}break;case "\u653e\u7f29":a.toolBar.toolType="zoom";break;case "\u79fb\u52a8":a.toolBar.toolType="move";break;case "\u65cb\u8f6c":void 0==a.rotateCtrl&&(a.rotateCtrl=new CBoBo.View.RotateCtrl({msgtransform:a.onTool.MsgTransform}));a.rotateCtrl.bShow?a.rotateCtrl.Show(!1):(a.rotateCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.rotateCtrl.Show(!0));break;case "\u8d1f\u50cf":a.onTool.Negative();break;case "\u4f2a\u5f69":void 0==a.pseudocolorCtrl&&(a.pseudocolorCtrl=new CBoBo.View.PseudoColorCtrl({msgtransform:a.onTool.MsgTransform}));a.pseudocolorCtrl.bShow?a.pseudocolorCtrl.Show(!1):(a.pseudocolorCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.pseudocolorCtrl.Show(!0));break;case "\u8c03\u7a97":a.toolBar.toolType="ww";break;case "\u81ea\u5b9a\u4e49\u8c03\u7a97 ":void 0==a.wwCtrl&&(a.wwCtrl=new CBoBo.View.wwCtrl({msgtransform:a.onTool.MsgTransform,modalityType:a.dataManager.GetStudy(0).modality}));a.wwCtrl.bShow?a.wwCtrl.Show(!1):(a.wwCtrl.SetPosition(b.clientX,CBoBo.View.TOOLBAR_HEIGHT),a.wwCtrl.Show(!0));break;case "\u76f4\u7ebf":a.toolBar.toolType="line";break;case "\u77e9\u5f62":a.toolBar.toolType="rect";break;case "\u692d\u5706":a.toolBar.toolType="ellipse";break;case "\u89d2\u5ea6":a.toolBar.toolType="angle";break;case "CT":a.toolBar.toolType="probe";break;case "\u6587\u672c":a.toolBar.toolType="text";break;case "\u7bad\u5934":a.toolBar.toolType="arrow";break;case "\u5de6\u6807\u8bb0":a.toolBar.toolType="l";break;case "\u53f3\u6807\u8bb0":a.toolBar.toolType="r";break;case "\u64a4\u9500":c=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetMng()[0]:a.canvasManager.GetFocusMng();if(d=c.AnnStatusMng()){var e=d.viewport,f=c.GetFocusCanvas();if(void 0!==f){c=c.GetEventImageIndex(f);var g=d.images[c];if(void 0===g)return;e.image=g;d.anns[g.id]instanceof Array&&(0<d.anns[g.id].length&&d.anns[g.id].pop(),c=f.canvas,CBoBo.Draw.DrawImage(e,c),CBoBo.Annotation.DrawAnnotation(e,c,d.anns[g.id]))}}break;case "\u5220\u9664\u56fe\u50cf":a.onTool.DeleteDicom();break;case "\u5e03\u5c40\u63a7\u4ef6":a.onTool.CanvasLayout(b);break;case "\u9006\u65f6\u9488":case "\u987a\u65f6\u9488":case "\u5de6\u53f3\u955c\u50cf":case "\u4e0a\u4e0b\u955c\u50cf":a.onTool.RotateDicom(b.target.title);break;case "\u7070\u8272":case "\u5f69\u8679":case "\u9ed1\u4f53":case "\u9aa8\u9abc":case "\u5fc3\u810f":case "\u6d41\u52a8":case "Ge\u8272":case "\u7070\u8272\u5f69\u8679":case "\u70ed\u7eff":case "\u94ec\u94c1":case "\u70ed\u91d1\u5c5e":case "\u9971\u548c\u5ea61":case "\u9971\u548c\u5ea62":case "\u7ea2\u5916":case "\u58a8\u9ed1":case "\u9aa8\u9abc-\u808c\u8089":case "NIH":case "\u5f69\u86791":case "\u5f69\u86792":case "\u5f69\u86793":case "\u6bd4\u503c":case "\u7ea2\u8272\u8840\u7ba1":case "\u5149\u8c31":case "\u65af\u7279\u6069":case "UCLA":a.onTool.Pseudocolor(b.target.title);break;case "seriesplay":c=a.seriesPlayer.GetSeriesTag();if("userdocument"==b.userdocument){if(!a.seriesPlayer.bShow)return;d=a.canvasMax&&a.canvasMax.bShow?a.canvasMax.secondCtrl.GetFocusMng():a.canvasManager.GetFocusMng();c!=d&&(a.seriesPlayer.Show(!1),b.btntitle="\u5e8f\u5217\u64ad\u653e",b.btnforce=!1)}else void 0!=b.target?c.scroll&&a.seriesPlayer.SetRange(c.scroll.rangeMap,c.scroll.draggerPos):c.scroll?c.scroll.TriggerDragger(b.value):(d=c.AnnStatusMng(),e=d.viewport,c=c.GetCanvas(),e.scale=e.scale1,e.image=d.images[0],e.frames=b.value,CBoBo.ImageProcessor.FitCanvas(e,c[0].canvas,!0));break;case "\u80f6\u7247\u6253\u5370":if(!a.privilege.bPrint)break;void 0==a.printer&&(a.printer=new CBoBo.View.DVPrint({msgtransform:a.PrintView.MsgTransform,mode:a.mode}));a.printer.bShow?a.printer.Show():a.printer.Show(!0);break;case "\u5fc3\u80f8\u6bd4":a.toolBar.toolType="heartratio";break;case "DICOM\u4fe1\u606f":if(a.dicomScan&&a.dicomScan.bShow)a.dicomScan.Show(!1),delete a.dicomScan;else{a.dicomScan=new CBoBo.View.DicomScan({msgtransform:a.onTool.MsgTransform});a.canvasMax&&a.canvasMax.bShow?(f=a.canvasMax.secondCtrl.GetMng()[0],c=f.GetFocusCanvas()):(f=a.canvasManager.GetFocusMng(),c=a.canvasManager.GetFocusCanvas());if(d=f.AnnStatusMng())c=f.GetEventImageIndex(c),e=d.images[c];a.dicomScan.SetDicomInfo(e);console.log(e);a.dicomScan.Show(!0);d={title:"DICOM\u4fe1\u606f",bseled:!0};b.btnstatus=d}break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":a.toolBar.bShowCornerInfo=!a.toolBar.bShowCornerInfo;d={title:"\u663e/\u9690\u56db\u89d2\u4fe1\u606f"};d.bseled=a.toolBar.bShowCornerInfo;b.btnstatus=d;d=a.canvasManager.GetMng();$.each(d,function(b,d){(b=d.AnnStatusMng())&&a.DrawAnnStatusForMng(b,d)});break;case "\u6253\u5370\u56fe\u50cf":a.KeyboardMsg({keyCode:80});break;case "\u6253\u5370\u5e8f\u5217":a.KeyboardMsg({keyCode:80,ctrlKey:!0});break;case "MPR":a.onTool.Main.MsgTransform({target:{title:"MPR"}});break;case "2D":a.onTool.Main.MsgTransform({target:{title:"2D"}});break;case "\u914d\u7f6e":void 0===a.configView&&(a.configView=new CBoBo.View.Config);d=a.toolBar.GetButtonDOM("\u914d\u7f6e");a.configView.bShow?(a.configView.Show(!1),$(d).css("pointer-events","")):(a.configView.Show(!0),$(d).css("pointer-events","auto"));break;case "\u534f\u540c\u8bca\u65ad":void 0==a.assistDiagnose&&(a.assistDiagnose=new CBoBo.View.AssistDiagnose({server:"localhost:80",msgtransform:a.Assist.MsgTransform}),a.assistDiagnose.Login());a.assistDiagnose.Show(!a.assistDiagnose.bShow);break;case "\u6309\u952e\u8bf4\u660e":a.iconInfo&&a.iconInfo.bShow?(a.iconInfo.Show(!1),delete a.iconInfo):(a.iconInfo=new CBoBo.View.IconInfo({msgtransform:a.onTool.MsgTransform}),a.iconInfo.SetInfo(),a.iconInfo.Show(!0));break;case "CPR\u76f4\u7ebf":case "CPR\u66f2\u7ebf":case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":a.onTool.Mpr.MsgTransform(b);break;case "Abodmen":case "Lung":case "Brain":case "Bone":case "Chest":case "Head/Neck":a.onTool.WW(d);break;case "CustomWWWC":a.onTool.BindAlert()}CBoBo.Plugin.GetBrowserInfo().isMobile||!1!==a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce)||(a.toolBar.toolType=CBoBo.TOOL_NULL,a.toolBar.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))};this.onTool.BindAlert=function(){var b,d,c=a.canvasManager.GetActiveMng();$.each(c,function(a,c){if(a=c.AnnStatusMng())a=a.viewport,b=a.ww,d=a.wc});a.isKeyBoard=!0;var e=layer.open({title:"\u8bf7\u8f93\u5165\u7a97\u5bbd\u7a97\u4f4d",type:1,skin:"layui-layer-rim",area:["420px","210px"],content:'\x3cdiv class\x3d"layer-wrap"\x3e\x3cdiv class\x3d"layer-content"\x3e\x3cdiv class\x3d"layer-iptdiv"\x3e\x3clabel\x3e\u7a97\u5bbd:\x3c/label\x3e\x3cinput type\x3d"text" id\x3d"customWW"    class\x3d"layer-ipt" value\x3d"'+b+'"\x3e\x3c/div\x3e\x3cdiv class\x3d"layer-iptdiv"\x3e\x3clabel\x3e\u7a97\u4f4d:\x3c/label\x3e\x3cinput type\x3d"text" id\x3d"customWC"  class\x3d"layer-ipt" value\x3d"'+d+'"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"footer"\x3e\x3cspan id\x3d"btn-ok-custom" class\x3d"darkgreen"\x3e\u786e\u5b9a\x3c/span\x3e\x3cspan id\x3d"btn-cancel-custom"\x3e\u53d6\u6d88\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',cancel:function(){a.isKeyBoard=!1}});$("#btn-ok-custom").click(function(){var b=$("#customWW").val(),d=$("#customWC").val();isNaN(d)||isNaN(b)?alert("\u8bf7\u8f93\u5165\u6b63\u786e\u6570\u5b57"):(a.onTool.CustomWW(parseInt(b),parseInt(d)),layer.close(e),a.isKeyBoard=!1)});$("#btn-cancel-custom").click(function(){layer.close(e);a.isKeyBoard=!1})};this.onTool.CustomWW=function(b,d){if(a.canvasMax&&a.canvasMax.bShow){var c=a.canvasMax.secondCtrl.GetMng()[0],e=c.AnnStatusMng();if(e){var f=e.viewport;f.ww=parseInt(b);f.wc=parseInt(d);2>f.ww&&(f.ww=2);a.DrawAnnStatusForMng(e,c)}}else c=a.canvasManager.GetActiveMng(),$.each(c,function(c,h){if(c=h.AnnStatusMng()){var f=c.viewport;f.ww=b;f.wc=d;2>f.ww&&(f.ww=2);a.DrawAnnStatusForMng(c,h)}})};this.onTool.WW=function(b){if(a.canvasAIMax&&a.canvasAIMax.bShow){var d=a.canvasMax.secondCtrl.GetMng()[0],c=d.AnnStatusMng();if(c){var e=c.viewport;switch(b){case "Abodmen":e.ww=400;e.wc=60;break;case "Lung":e.ww=1500;e.wc=-600;break;case "Brain":e.ww=80;e.wc=40;break;case "Bone":e.ww=1500;e.wc=300;break;case "Chest":e.ww=400;e.wc=40;break;case "Head/Neck":e.ww=350,e.wc=90}2>e.ww&&(e.ww=2);a.DrawAnnStatusForMng(c,d)}}else if(a.canvasMax&&a.canvasMax.bShow){if(d=a.canvasMax.secondCtrl.GetMng()[0],c=d.AnnStatusMng()){e=c.viewport;switch(b){case "Abodmen":e.ww=400;e.wc=60;break;case "Lung":e.ww=1500;e.wc=-600;break;case "Brain":e.ww=80;e.wc=40;break;case "Bone":e.ww=1500;e.wc=300;break;case "Chest":e.ww=400;e.wc=40;break;case "Head/Neck":e.ww=350,e.wc=90}2>e.ww&&(e.ww=2);a.DrawAnnStatusForMng(c,d)}}else d=a.canvasManager.GetActiveMng(),$.each(d,function(d,c){if(d=c.AnnStatusMng()){var h=d.viewport;switch(b){case "Abodmen":h.ww=400;h.wc=60;break;case "Lung":h.ww=1500;h.wc=-600;break;case "Brain":h.ww=80;h.wc=40;break;case "Bone":h.ww=1500;h.wc=300;break;case "Chest":h.ww=400;h.wc=40;break;case "Head/Neck":h.ww=350,h.wc=90}2>h.ww&&(h.ww=2);a.DrawAnnStatusForMng(d,c)}})};this.onTool.Negative=function(){if(a.canvasMax&&a.canvasMax.bShow){var b=a.canvasMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng();d&&(d.viewport.invert=!d.viewport.invert,a.DrawAnnStatusForMng(d,b))}else b=a.canvasManager.GetActiveMng(),$.each(b,function(b,d){if(b=d.AnnStatusMng())b.viewport.invert=!b.viewport.invert,a.DrawAnnStatusForMng(b,d)})};this.onTool.RotateDicom=function(b){if(a.canvasMax&&a.canvasMax.bShow){var d=a.canvasMax.secondCtrl.GetMng()[0],c=d.AnnStatusMng();if(c){switch(b){case "\u9006\u65f6\u9488":c.viewport.rotation+=-90;break;case "\u987a\u65f6\u9488":c.viewport.rotation+=90;break;case "\u5de6\u53f3\u955c\u50cf":c.viewport.hflip=!c.viewport.hflip;break;case "\u4e0a\u4e0b\u955c\u50cf":c.viewport.vflip=!c.viewport.vflip}if(-360===c.viewport.rotation||360===c.viewport.rotation)c.viewport.rotation=0;a.DrawAnnStatusForMng(c,d)}}else d=a.canvasManager.GetActiveMng(),$.each(d,function(d,c){if(d=c.AnnStatusMng()){switch(b){case "\u9006\u65f6\u9488":d.viewport.rotation+=-90;break;case "\u987a\u65f6\u9488":d.viewport.rotation+=90;break;case "\u5de6\u53f3\u955c\u50cf":d.viewport.hflip=!d.viewport.hflip;break;case "\u4e0a\u4e0b\u955c\u50cf":d.viewport.vflip=!d.viewport.vflip}if(-360===d.viewport.rotation||360===d.viewport.rotation)d.viewport.rotation=0;a.DrawAnnStatusForMng(d,c)}})};this.onTool.ReLoadDicom=function(b){a.canvasMax&&a.canvasMax.bShow&&a.canvasMax.Show(!1);b&&a.InitAnnStatusStack();b=a.dataManager.GetStudy(0);var d=b.GetStudyType(),c=b.IsPageSwitch();"series"===d&&c&&b.RequestSeriesDicom();b=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(b.length);d=a.canvasManager.GetMng();for(c=0;c<d.length;c++){var e=d[c],f=e.GetLayoutCanvas();0===f.length&&e.UpdateLayout(0,1,1);if(c<b.length){var g=b[c];e.AnnStatusMng(g);e.UpdateLayout(g.images.length);"series"===g.type&&e.checkbox.Show(!0);window.devicePixelRatio=1;a.DrawAnnStatus(g,f,!0)}else e.checkbox.Show(!1),$.each(f,function(a,b){b.Clear();b.DrawCornerInfo()}),e.Clear()}};this.onTool.DeleteDicom=function(){if(a.canvasMax&&a.canvasMax.bShow){var b=a.canvasMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng();if(d){var d=CBoBo.AnnStatusManager.Delete(d),c=CBoBo.AnnStatusManager.Get(),d=Math.min(d,c.length-1);a.canvasMax.secondCtrl.UpdateLayout(c.length,1,1,(0>d?0:d)+1);if(d<c.length&&-1<d){if(d=c[d])b.UpdateLayout(d.images.length),b.AnnStatusMng(d),a.DrawAnnStatusForMng(d,b)}else b.UpdateLayout(0),b.AnnStatusMng(null),b=b.GetAllCanvas()[0],d=b.canvas,d.width=d.width,b.DrawCornerInfo()}}else b=a.canvasManager.GetActiveMng(),$.each(b,function(a,b){a=b.AnnStatusMng();CBoBo.AnnStatusManager.Delete(a)}),a.onTool.ReLoadDicom()};this.onTool.RestoreDicom=function(){if(a.canvasMax&&a.canvasMax.bShow){var b=a.canvasMax.secondCtrl.GetMng()[0],d=b.AnnStatusMng();d&&(CBoBo.ImageProcessor.Restore(d.viewport),d.anns={},a.DrawAnnStatusForMng(d,b,!0))}else b=a.canvasManager.GetActiveMng(),$.each(b,function(b,d){if(b=d.AnnStatusMng())CBoBo.ImageProcessor.Restore(b.viewport),b.anns={},a.DrawAnnStatusForMng(b,d,!0)})};this.onTool.Pseudocolor=function(b){if(a.canvasMax&&a.canvasMax.bShow){var d=a.canvasMax.secondCtrl.GetMng()[0],c=d.AnnStatusMng();c&&(c.viewport.pseudo=b,a.DrawAnnStatusForMng(c,d))}else d=a.canvasManager.GetActiveMng(),$.each(d,function(d,c){if(d=c.AnnStatusMng())d.viewport.pseudo=b,a.DrawAnnStatusForMng(d,c)})};this.onTool.CanvasLayout=function(b){switch(b.ctrltype){case "\u56fe\u50cf\u5e03\u5c40":if(a.canvasMax&&a.canvasMax.bShow){var d=a.canvasMax.secondCtrl.GetMng()[0],c=d.AnnStatusMng();c&&(d.UpdateLayout(c.images.length,b.row,b.col),b=d.GetAllCanvas(),a.DrawAnnStatus(c,b,!0),c=d.GetFocusCanvas(),void 0===c&&d.Focus(b.length-1))}else if(d=a.canvasManager.GetFocusMng(),void 0!==d&&(c=d.AnnStatusMng()))d.UpdateLayout(c.images.length,b.row,b.col),b=d.GetAllCanvas(),a.DrawAnnStatus(c,b,!0),c=d.GetFocusCanvas(),void 0===c&&d.Focus(b.length-1);break;case "\u5e8f\u5217\u5e03\u5c40":a.canvasMax&&a.canvasMax.bShow&&a.canvasMax.Show(!1);var e=CBoBo.AnnStatusManager.Get();a.canvasManager.UpdateLayout(e.length,b.row,b.col);d=a.canvasManager.GetMng();$.each(d,function(b,d){if(b<e.length){if(b=e[b])d.UpdateLayout(b.images.length),d.AnnStatusMng(b),"series"===b.type?(d.checkbox.Show(!0),d.checkbox.On_Off(b.compare)):d.checkbox.Show(!1),d=d.GetLayoutCanvas(),a.DrawAnnStatus(b,d,!0)}else d.UpdateLayout(0),d.checkbox.Show(!1)});d=a.canvasManager.focusIndex;c=a.canvasManager.GetLayout();if(void 0===c||1>c.row||1>c.col)c={row:1,col:1};c=c.row*c.col-1;d>c&&a.canvasManager.SetDefaultFocus(c,0)}};this.onTool.ScountLine=function(b){function d(a,b,d,c,e,f,h,g){var k;c.x<e.x?(k=c,c=e):k=e;k=CBoBo.ImageProcessor.PixelToCanvas(d,b,k);b=CBoBo.ImageProcessor.PixelToCanvas(d,b,c);a.save();a.strokeStyle="#fff";a.fillStyle="#FFF";a.shadowColor="#000";a.shadowOffsetX="1";a.shadowOffsetY="1";a.lineWidth="1";a.beginPath();0==h&&a.setLineDash([2,3]);a.moveTo(k.x,k.y);a.lineTo(b.x,b.y);a.stroke();g&&(new Point(0,0),5>k.y-3?a.fillText(f,k.x-3,k.y):a.fillText(f,k.x,k.y-3));a.restore()}if(a.onTool.bShowScountLine){var c=a.canvasManager.GetFocusMng(),e=c.AnnStatusMng();if(e){if(b){var f=a.canvasManager.GetMng();$.each(f,function(b,d){(b=d.AnnStatusMng())&&a.DrawAnnStatusForMng(b,d)})}var f=a.canvasManager.GetLayoutCanvas(),g,l=[],m;for(b=0;b<f.length;b++){var n=f[b];0===b?m=c.GetEventImageIndex(n):m++;if(m<e.images.length){var t=e.images[m];void 0===g&&(g=t.seruid);l.push(t.uid)}}var r=!0;1<l.length&&(r=!1);f=a.canvasManager.GetMng();for(b=0;b<f.length;b++){var c=f[b],v=c.AnnStatusMng();if(v!==e&&v)for(var u=c.GetAllCanvas(),q=m=0;q<u.length;q++)if(n=u[q],0===q?m=c.GetEventImageIndex(n):m++,m<v.images.length&&(t=v.images[m],t=t.scount[g],void 0!==t&&0<t.length)){var w=n.canvas,z=w.getContext("2d");2<t.length&&(d(z,w,v.viewport,t[0].ptStart,t[0].ptEnd,t[0].index,!1,!0),n=t.length-1,d(z,w,v.viewport,t[n].ptStart,t[n].ptEnd,t[n].index,!1,!0));$.each(t,function(a,b){$.each(l,function(a,c){c==b.uid&&d(z,w,v.viewport,b.ptStart,b.ptEnd,b.index,!0,r)})})}}}}};this.onCanvas.VRT={};this.onCanvas.VRT.WebDcmSocket=null;this.onCanvas.VRT.Seruuid=null;this.onCanvas.VRT.canvas3D=null;this.onCanvas.VRT.annStatus3D=null;this.onCanvas.VRT.MsgTransform=function(b){if(a.VRT.bMsg||"drag"===b.type)switch(b.type){case "touchstart":case "mousedown":var d;"touchstart"===b.type?(d=b.originalEvent.targetTouches[0],d=new Point(d.pageX,d.pageY),a.onCanvas.which=1):(d=new Point(b.pageX,b.pageY),a.onCanvas.which=b.which);a.VRT.ptLast=d;a.onCanvas.VRT.MouseDown(b);break;case "touchmove":case "mousemove":0!==a.onCanvas.which&&a.onCanvas.VRT.MouseDownMove(b);break;case "touchend":case "mouseup":case "mouseout":a.onCanvas.VRT.MouseUp(b);a.onCanvas.which=0;break;case "mousewheel":a.onCanvas.VRT.MouseWheel(b);break;case "drag":a.onCanvas.VRT.DragImage(b.imgId)}};this.onCanvas.VRT.MouseDown=function(b){1===a.onCanvas.which&&a.onCanvas.VRT.Slicing(b)};this.onCanvas.VRT.Slicing=function(b){var d;if("touchmove"==b.type||"touchstart"==b.type){var c=b.originalEvent.targetTouches[0];d=new Point(c.pageX,c.pageY)}else d=new Point(b.pageX,b.pageY);var e=b.self.canvas,c=a.VRT.mng.AnnStatusMng(),f=c.viewport,g=a.VRT.mng.GetCanvas(),l=a.VRT.Series();switch(a.VRT.mng.GetEventImageIndex(b.self)){case 1:f.scale=f.scale1;f.image=c.images[0];d=CBoBo.ImageProcessor.PageToPixel(f,e,d.x,d.y);CBoBo.ImageProcessor.FitCanvas(f,e);a.onCanvas.VRT.DrawCanvasLine(b.self,{point:d,lcolor:"#0F0",vcolor:"#00F"});a.VRT.ptO=d;e=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:d,index:a.VRT.oIndex});a.onCanvas.VRT.DrawMprDicom(g[2],d,180);a.onCanvas.VRT.DrawCanvasLine(g[2],e[CBoBo.MPR_LEVEL]);a.onCanvas.VRT.DrawMprDicom(g[3],d,90);a.onCanvas.VRT.DrawCanvasLine(g[3],e[CBoBo.MPR_VERTICAl]);break;case 2:f.scale=f.scale2;f.image=c.images[180];d=CBoBo.ImageProcessor.PageToPixel(f,e,d.x,d.y);a.VRT.ptL=d;CBoBo.ImageProcessor.FitCanvas(f,g[2].canvas,!1,!1,!0);a.onCanvas.VRT.DrawCanvasLine(b.self,{point:d,lcolor:"#F00",vcolor:"#00F"});a.VRT.oIndex=d.y;if(b=l[a.VRT.oIndex-1])e=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_LEVEL,point:d}),f.image=b,c.images[0]=b,CBoBo.ImageProcessor.FitCanvas(f,g[1].canvas),a.onCanvas.VRT.DrawCanvasLine(g[1],e[CBoBo.MPR_ORIGINAL]),a.onCanvas.VRT.DrawMprDicom(g[3],a.VRT.ptO,90),a.onCanvas.VRT.DrawCanvasLine(g[3],e[CBoBo.MPR_VERTICAl]);break;case 3:if(f.scale=f.scale3,f.image=c.images[90],d=CBoBo.ImageProcessor.PageToPixel(f,e,d.x,d.y),a.VRT.ptV=d,CBoBo.ImageProcessor.FitCanvas(f,g[3].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(b.self,{point:d,lcolor:"#F00",vcolor:"#0F0"}),a.VRT.oIndex=d.y,b=l[a.VRT.oIndex-1])e=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:d}),f.image=b,c.images[0]=b,CBoBo.ImageProcessor.FitCanvas(f,g[1].canvas),a.onCanvas.VRT.DrawCanvasLine(g[1],e[CBoBo.MPR_ORIGINAL]),a.onCanvas.VRT.DrawMprDicom(g[2],a.VRT.ptO,180),a.onCanvas.VRT.DrawCanvasLine(g[2],e[CBoBo.MPR_LEVEL])}};this.onCanvas.VRT.MouseDownMove=function(b){if(1===a.onCanvas.which){var d=a.VRT.mng.GetEventImageIndex(b.self);if(0==d)switch(a.onTool.VRT.type){case "\u624b\u672f\u5200\u5185":case "\u624b\u672f\u5200\u5916":a.onCanvas.VRT.KnifeMove(b);break;default:a.onCanvas.VRT.Rotate(b)}else a.onCanvas.VRT.Slicing(b)}else 3===a.onCanvas.which?(d=a.VRT.mng.GetEventImageIndex(b.self),0==d?a.onCanvas.VRT.WindowsLevel(b):a.onCanvas.VRT.WW(b)):2===a.onCanvas.which&&(d=a.VRT.mng.GetEventImageIndex(b.self),0==d&&a.onCanvas.VRT.Pan(b))};this.onCanvas.VRT.WW=function(b){var d;"touchmove"==b.type&&(b=b.originalEvent.targetTouches[0]);d=new Point(b.pageX,b.pageY);b=d.x-a.VRT.ptLast.x;var c=d.y-a.VRT.ptLast.y;if(0!==b||0!==c){a.VRT.ptLast=d;d=a.VRT.mng.AnnStatusMng();var e=d.viewport;e.ww+=parseInt(b/e.scale);e.wc+=parseInt(c/e.scale);2>e.ww&&(e.ww=2);a.onCanvas.VRT.UpdateCanvas(d)}};this.onCanvas.VRT.MouseUp=function(b){if(1===a.onCanvas.which&&0==a.VRT.mng.GetEventImageIndex(b.self))switch(a.onTool.VRT.type){case "\u624b\u672f\u5200\u5185":case "\u624b\u672f\u5200\u5916":a.onCanvas.VRT.KnifeEnd(),a.toolBar.ChangeBtnStatus(a.onTool.VRT.type,null),a.onTool.VRT.type=""}};this.onCanvas.VRT.MouseWheel=function(b){console.log("MouseWheel");var d=a.VRT.mng.GetCanvas(),c=b.deltaY,e=a.VRT.Series(),f=a.VRT.mng.AnnStatusMng(),g;g=a.VRT.mng.GetEventImageIndex(b.self);switch(g){case 1:g=a.VRT.oIndex;a.VRT.oIndex=0<c?1>--a.VRT.oIndex?1:a.VRT.oIndex:++a.VRT.oIndex>e.length?e.length:a.VRT.oIndex;g!==a.VRT.oIndex&&(g=e[a.VRT.oIndex-1],f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,b.self.canvas),a.onCanvas.VRT.DrawCanvasLine(b.self,{point:a.VRT.ptO,lcolor:"#0F0",vcolor:"#00F"}),c=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex}),f.viewport.image=f.images[180],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[2].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(d[2],c[CBoBo.MPR_LEVEL]),f.viewport.scale=1,f.viewport.image=f.images[90],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[3].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(d[3],c[CBoBo.MPR_VERTICAl]),f.viewport.image=f.images[0],d[1].DrawCornerInfo(f.viewport),d[2].DrawCornerInfo(f.viewport),d[3].DrawCornerInfo(f.viewport));break;case 2:g=e[0];b=parseInt(g.row);g=a.VRT.ptO.y;a.VRT.ptO.y=0<c?1>--a.VRT.ptO.y?1:a.VRT.ptO.y:++a.VRT.ptO.y>b?b:a.VRT.ptO.y;a.VRT.ptV.x=a.VRT.ptO.y;g!==a.VRT.ptO.y&&(c=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex}),a.onCanvas.VRT.DrawMprDicom(d[2],a.VRT.ptO,180),a.onCanvas.VRT.DrawCanvasLine(d[2],c[CBoBo.MPR_LEVEL]),f.viewport.image=f.images[90],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[3].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(d[3],c[CBoBo.MPR_VERTICAl]),c=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:a.VRT.ptV}),g=e[a.VRT.oIndex-1],f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,d[1].canvas),a.onCanvas.VRT.DrawCanvasLine(d[1],c[CBoBo.MPR_ORIGINAL]));break;case 3:g=e[0];b=parseInt(g.col);g=a.VRT.ptO.x;a.VRT.ptO.x=0<c?1>--a.VRT.ptO.x?1:a.VRT.ptO.x:++a.VRT.ptO.x>b?b:a.VRT.ptO.x;a.VRT.ptL.x=a.VRT.ptO.x;g!==a.VRT.ptO.x&&(c=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex}),a.onCanvas.VRT.DrawMprDicom(d[3],a.VRT.ptO,90),a.onCanvas.VRT.DrawCanvasLine(d[3],c[CBoBo.MPR_VERTICAl]),f.viewport.image=f.images[180],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[2].canvas,!1,!1,!0),a.onCanvas.VRT.DrawCanvasLine(d[2],c[CBoBo.MPR_LEVEL]),c=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_LEVEL,point:a.VRT.ptL}),g=e[a.VRT.oIndex-1],f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,d[1].canvas),a.onCanvas.VRT.DrawCanvasLine(d[1],c[CBoBo.MPR_ORIGINAL]));break;case 0:a.onCanvas.VRT.Zoom(b)}};this.onCanvas.VRT.InitCanvas=function(){var b=a.VRT.mng.GetCanvas();if(void 0!==b){var d=a.VRT.Series();if(d){var c=CBoBo.AnnStatusManager.Create(d[0],"","",!0);a.VRT.mng.AnnStatusMng(c);a.onCanvas.VRT.canvas3D=b[0];a.onCanvas.VRT.canvas3D.StartLoadingAnimation();a.onCanvas.VRTannStatus3D=c;a.onCanvas.VRT.canvas3D.DrawCornerInfo(c.viewport);a.onCanvas.VRT.DrawVrtDicom();var e=b[1],f=Math.floor(d.length/2);a.VRT.oIndex=f;d=d[f-1];c.viewport.image=d;c.images[0]=d;CBoBo.ImageProcessor.Restore(c.viewport).FitCanvas(c.viewport,e.canvas);e.DrawCornerInfo(c.viewport);c.viewport.scale1=c.viewport.scale;d=new Point(parseInt(d.col)>>1,parseInt(d.row)>>1);a.VRT.ptO=d;a.onCanvas.VRT.DrawCanvasLine(e,{point:d,lcolor:"#0F0",vcolor:"#00F"});e=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:d,index:f});a.onCanvas.VRT.DrawMprDicom(b[2],d,180);a.onCanvas.VRT.DrawCanvasLine(b[2],e[CBoBo.MPR_LEVEL]);b[2].DrawCornerInfo(c.viewport);c.viewport.scale2=c.viewport.scale;a.onCanvas.VRT.DrawMprDicom(b[3],d,90);a.onCanvas.VRT.DrawCanvasLine(b[3],e[CBoBo.MPR_VERTICAl]);b[3].DrawCornerInfo(c.viewport);c.viewport.scale3=c.viewport.scale;a.VRT.ptL=e[CBoBo.MPR_LEVEL].point;a.VRT.ptV=e[CBoBo.MPR_VERTICAl].point}}};this.onCanvas.VRT.DrawCanvasLine=function(b,d){function c(a,b,d){a.beginPath();a.moveTo(b.x,b.y);a.lineTo(d.x,d.y);a.stroke()}if(void 0!==d){var e=b.canvas;b=b.canvas.getContext("2d");var f=a.VRT.mng.AnnStatusMng().viewport,g=f.image,l=d.point,m=d.lcolor;d=d.vcolor;var n=g.col,t=g.row,g=new Point(0,l.y),r=new Point(n,l.y),n=new Point(l.x,0),t=new Point(l.x,t),g=CBoBo.ImageProcessor.PixelToCanvas(f,e,g),r=CBoBo.ImageProcessor.PixelToCanvas(f,e,r);b.save();b.setTransform(1,0,0,1,0,0);b.strokeStyle=m;c(b,g,r);g=CBoBo.ImageProcessor.PixelToCanvas(f,e,n);r=CBoBo.ImageProcessor.PixelToCanvas(f,e,t);b.strokeStyle=d;c(b,g,r);b.restore();return l}};this.onCanvas.VRT.DrawMprDicom=function(b,d,c){var e={},f={},h=a.VRT.Series();h&&(90===c?(e.x=d.x,e.y=0,f.x=d.x,f.y=h[0].row):(e.x=0,e.y=d.y,f.x=h[0].col,f.y=d.y),d=CBoBo.Mpr.GetPointsFromLine(e,f),d=CBoBo.Mpr.GenerateNormalPlane(a.VRT.Series(),d),e=a.VRT.mng.AnnStatusMng(),e.images[c]=d,e.viewport.image=d,CBoBo.ImageProcessor.FitCanvas(e.viewport,b.canvas,!1,!1,!0))};this.onCanvas.VRT.DrawVrtDicom=function(b,d){d=a.dataManager.GetStudy(0);b=d.vrtWsURl;d=d.hospid;b||alert("vrtWsURl is undefined");var c=a.canvasManager.GetFocusMng().AnnStatusMng().images[0].seruuid;if(null!=a.onCanvas.VRT.WebDcmSocket){if(a.onCanvas.VRT.Seruuid==c){a.onCanvas.VRT.Refresh();return}a.onCanvas.VRT.WebDcmSocket.close()}a.onCanvas.VRT.Seruuid=c;a.onCanvas.VRT.WebDcmSocket=new WebSocket(b+"/Wado?seruuid\x3d"+c+"\x26hospcode\x3d"+d);a.onCanvas.VRT.WebDcmSocket.onclose=function(){console.log("Connection closed")};a.onCanvas.VRT.WebDcmSocket.onopen=function(){console.log("Connection opened")};a.onCanvas.VRT.WebDcmSocket.onerror=function(a){console.log("An error occured")};a.onCanvas.VRT.WebDcmSocket.onmessage=function(b){if("string"!=typeof b.data){var d=new FileReader;d.onload=function(b){if(b.target.readyState==FileReader.DONE){var d=new Image;d.src=this.result;d.onload=function(){a.onCanvas.VRT.canvas3D.StopLoadingAnimation();var b=a.VRT.mng.AnnStatusMng().viewport,c=a.onCanvas.VRT.canvas3D.canvas,e=c.getContext("2d"),f=c.width,c=c.height,h=d.width,g=d.height,k=f/h,p=c/g;k>p?(b.scale0=parseFloat(p.toFixed(2)),h*=p,g*=p):(b.scale0=parseFloat(k.toFixed(2)),h*=k,g*=k);e.drawImage(d,(f-h)/2,(c-g)/2,h,g);b.scale=b.scale0;a.onCanvas.VRT.canvas3D.DrawCornerInfo(b)}}};d.readAsDataURL(b.data)}}};this.onCanvas.VRT.GetMapCoord=function(b){if(void 0!=b){var d={};switch(b.type){case CBoBo.MPR_ORIGINAL:var c=b.point,e=b.index;b=d[CBoBo.MPR_LEVEL]={};b.point=new Point(c.x,e);b.lcolor="#F00";b.vcolor="#00F";b=d[CBoBo.MPR_VERTICAl]={};b.point=new Point(c.y,e);b.lcolor="#F00";b.vcolor="#0F0";break;case CBoBo.MPR_LEVEL:c=b.point;b=d[CBoBo.MPR_ORIGINAL]={};a.VRT.ptO.x=c.x;b.point=a.VRT.ptO;b.lcolor="#0F0";b.vcolor="#00F";b=d[CBoBo.MPR_VERTICAl]={};a.VRT.ptV.y=c.y;b.point=a.VRT.ptV;b.lcolor="#F00";b.vcolor="#0F0";break;case CBoBo.MPR_VERTICAl:c=b.point,b=d[CBoBo.MPR_ORIGINAL]={},a.VRT.ptO.y=c.x,b.point=a.VRT.ptO,b.lcolor="#0F0",b.vcolor="#00F",b=d[CBoBo.MPR_LEVEL]={},a.VRT.ptL.y=c.y,b.point=a.VRT.ptL,b.lcolor="#F00",b.vcolor="#00F"}return d}};this.onCanvas.VRT.UpdateCanvas=function(b){a.onCanvas.VRT.Refresh();var d=a.VRT.mng.GetCanvas();b.viewport.image=b.images[0];CBoBo.ImageProcessor.FitCanvas(b.viewport,d[1].canvas);b.viewport.scale1=b.viewport.scale;a.onCanvas.VRT.DrawCanvasLine(d[1],{point:a.VRT.ptO,lcolor:"#0F0",vcolor:"#00F"});var c=a.onCanvas.VRT.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.VRT.ptO,index:a.VRT.oIndex});b.viewport.image=b.images[180];CBoBo.ImageProcessor.FitCanvas(b.viewport,d[2].canvas,!1,!1,!0);a.onCanvas.VRT.DrawCanvasLine(d[2],c[CBoBo.MPR_LEVEL]);b.viewport.scale2=b.viewport.scale;b.viewport.image=b.images[90];CBoBo.ImageProcessor.FitCanvas(b.viewport,d[3].canvas,!1,!1,!0);a.onCanvas.VRT.DrawCanvasLine(d[3],c[CBoBo.MPR_VERTICAl]);b.viewport.scale3=b.viewport.scale;b.viewport.image=b.images[0];b.viewport.scale=b.viewport.scale1;d[1].DrawCornerInfo(b.viewport);b.viewport.scale=b.viewport.scale2;d[2].DrawCornerInfo(b.viewport);b.viewport.scale=b.viewport.scale3;d[3].DrawCornerInfo(b.viewport)};this.onCanvas.VRT.Rotate=function(b){var d;if("touchmove"==b.type){var c=b.originalEvent.targetTouches[0];d=new Point(c.pageX,c.pageY)}else d=new Point(b.pageX,b.pageY);c=d.y-a.VRT.ptLast.y;if(0!==d.x-a.VRT.ptLast.x||0!==c){var c=a.VRT.ptLast.x,e=a.VRT.ptLast.y;a.VRT.ptLast=d;var f=b.self.canvas.getBoundingClientRect();d=parseInt(f.left+window.pageXOffset);var f=parseInt(f.top+window.pageYOffset),g={Cmd:1,LastPosition:[]};g.LastPosition[0]=c-d;g.LastPosition[1]=e-f;g.NowPosition=[];g.NowPosition[0]=b.pageX-d;g.NowPosition[1]=b.pageY-f;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(g))}};this.onCanvas.VRT.Pan=function(b){var d;if("touchmove"==b.type){var c=b.originalEvent.targetTouches[0];d=new Point(c.pageX,c.pageY)}else d=new Point(b.pageX,b.pageY);c=d.y-a.VRT.ptLast.y;if(0!==d.x-a.VRT.ptLast.x||0!==c){var c=a.VRT.ptLast.x,e=a.VRT.ptLast.y;a.VRT.ptLast=d;var f=b.self.canvas.getBoundingClientRect();d=f.left+window.pageXOffset;var f=f.top+window.pageYOffset,g={Cmd:2,LastPosition:[]};g.LastPosition[0]=c-d;g.LastPosition[1]=e-f;g.NowPosition=[];g.NowPosition[0]=b.pageX-d;g.NowPosition[1]=b.pageY-f;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(g))}};this.onCanvas.VRT.WindowsLevel=function(b){var d;if("touchmove"==b.type){var c=b.originalEvent.targetTouches[0];d=new Point(c.pageX,c.pageY)}else d=new Point(b.pageX,b.pageY);c=d.y-a.VRT.ptLast.y;if(0!==d.x-a.VRT.ptLast.x||0!==c){var c=a.VRT.ptLast.x,e=a.VRT.ptLast.y;a.VRT.ptLast=d;var f=b.self.canvas.getBoundingClientRect();d=f.left+window.pageXOffset;var f=f.top+window.pageYOffset,g={Cmd:4,LastPosition:[]};g.LastPosition[0]=c-d;g.LastPosition[1]=e-f;g.NowPosition=[];g.NowPosition[0]=b.pageX-d;g.NowPosition[1]=b.pageY-f;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(g))}};this.onCanvas.VRT.Zoom=function(b){var d={Cmd:3};d.DeltaY=b.deltaY;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(d))};this.onCanvas.VRT.Reset=function(){a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify({Cmd:0}))};this.onCanvas.VRT.Refresh=function(){a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify({Cmd:99}))};this.onCanvas.VRT.KnifeMove=function(b){var d;if("touchmove"==b.type){var c=b.originalEvent.targetTouches[0];d=new Point(c.pageX,c.pageY)}else d=new Point(b.pageX,b.pageY);c=d.y-a.VRT.ptLast.y;if(0!==d.x-a.VRT.ptLast.x||0!==c){var c=a.VRT.ptLast.x,e=a.VRT.ptLast.y;a.VRT.ptLast=d;d=b.self.canvas.getBoundingClientRect();var f=d.left+window.pageXOffset,g=d.top+window.pageYOffset,l={Cmd:5,LastPosition:[]};l.LastPosition[0]=c-f;l.LastPosition[1]=e-g;l.NowPosition=[];l.ViewWidth=d.width;l.ViewHeight=d.height;l.NowPosition[0]=b.pageX-f;l.NowPosition[1]=b.pageY-g;a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(l))}};this.onCanvas.VRT.KnifeEnd=function(){a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify({Cmd:8}))};this.onCanvas.VRT.KnifeBegin=function(b){if("KnifeIn"==b){var d={Cmd:7};a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(d))}"KnifeOut"==b&&(d={Cmd:6},a.onCanvas.VRT.WebDcmSocket.send(JSON.stringify(d)))};this.onTool.VRT={type:""};this.onTool.VRT.MsgTransform=function(b){var d=b.usermsg||b.target.title;switch(d){case "\u624b\u672f\u5200\u5185":a.onCanvas.VRT.KnifeBegin("KnifeIn");a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce);break;case "\u624b\u672f\u5200\u5916":a.onCanvas.VRT.KnifeBegin("KnifeOut");a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce);break;case "\u91cd\u7f6e\u4e09\u7ef4\u89c6\u56fe":a.onCanvas.VRT.Reset()}a.onTool.VRT.type=d};this.onCanvas.Mpr={};this.onCanvas.Mpr.MsgTransform=function(b){if(a.Mpr.bMsg||"drag"===b.type)switch(b.type){case "touchstart":case "mousedown":var d;"touchstart"===b.type?(d=b.originalEvent.targetTouches[0],d=new Point(d.pageX,d.pageY),a.onCanvas.which=1):(d=new Point(b.pageX,b.pageY),a.onCanvas.which=b.which);a.Mpr.ptLast=d;a.onCanvas.Mpr.MouseDown(b);break;case "touchmove":case "mousemove":0!==a.onCanvas.which&&a.onCanvas.Mpr.MouseDownMove(b);break;case "touchend":case "mouseup":case "mouseout":a.onCanvas.Mpr.MouseUp(b);a.onCanvas.which=0;break;case "mousewheel":a.onCanvas.Mpr.MouseWheel(b);break;case "drag":a.onCanvas.Mpr.DragImage(b.imgId)}};this.onCanvas.Mpr.MouseDown=function(b){if(1===a.onCanvas.which)switch(a.onTool.Mpr.type){case "\u5341\u5b57\u5207\u9762":a.onCanvas.Mpr.Slicing(b);break;case "CPR\u66f2\u7ebf":a.onCanvas.Mpr.curvePoints=[],b=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y),a.onCanvas.Mpr.curvePoints.push(b)}};this.onCanvas.Mpr.MouseDownMove=function(b){if(1===a.onCanvas.which)switch(a.onTool.Mpr.type){case "\u5207\u9762\u8c03\u7a97":a.onCanvas.Mpr.WW(b);break;case "\u5341\u5b57\u5207\u9762":a.onCanvas.Mpr.Slicing(b);break;case "CPR\u76f4\u7ebf":a.onCanvas.Mpr.CprLine(b);break;case "CPR\u66f2\u7ebf":a.onCanvas.Mpr.CprCurve(b);break;case "\u5207\u56fe":a.onCanvas.Mpr.MoveMpr(b)}else 3===a.onCanvas.which&&a.onCanvas.Mpr.WW(b)};this.onCanvas.Mpr.MouseUp=function(b){if(1===a.onCanvas.which&&"\u5207\u9762\u8c03\u7a97"!==a.onTool.Mpr.type&&"\u5341\u5b57\u5207\u9762"!==a.onTool.Mpr.type&&"\u5207\u56fe"!==a.onTool.Mpr.type){var d=a.Mpr.mng.AnnStatusMng(),c=a.Mpr.mng.GetEventImageIndex(b.self);switch(c){case 0:d.viewport.image=d.images[0];break;case 1:d.viewport.image=d.images[90];break;case 2:d.viewport.image=d.images[180];break;case 3:return}CBoBo.ImageProcessor.FitCanvas(d.viewport,b.self.canvas,!0,!0,!0);var e;switch(a.onTool.Mpr.type){case "CPR\u76f4\u7ebf":var f;if("touchend"==b.type){var g=b.originalEvent.targetTouches[0];f=new Point(g.pageX,g.pageY)}else f=new Point(b.pageX,b.pageY);g=CBoBo.ImageProcessor.PageToPixel(d.viewport,b.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y);f=CBoBo.ImageProcessor.PageToPixel(d.viewport,b.self.canvas,f.x,f.y);var l=CBoBo.Mpr.GetPointsFromLine(g,f);switch(c){case 0:e=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),l);break;case 1:e=CBoBo.Mpr.GenerateSlopePlane(a.Mpr.Series(),g,f,90);break;case 2:e=CBoBo.Mpr.GenerateSlopePlane(a.Mpr.Series(),g,f,180);break;case 3:return}break;case "CPR\u66f2\u7ebf":var m=[];$.each(a.onCanvas.Mpr.curvePoints,function(){var a=CBoBo.ImageProcessor.PageToPixel(d.viewport,b.self.canvas,this.x,this.y,"cpr");m.push(a)});l=[];for(g=0;g<m.length;g++){f=m[g+1];if(void 0===f)break;f=CBoBo.Mpr.GetPointsFromLine(m[g],f);$.each(f,function(){l.push(this)})}console.log(l.length);switch(c){case 0:e=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),l);break;case 1:e=CBoBo.Mpr.GenerateSurface(a.Mpr.Series(),l);break;case 2:e=CBoBo.Mpr.GenerateSurface(a.Mpr.Series(),l);break;case 3:return}}d.viewport.image=e;c=a.Mpr.mng.GetCanvas();CBoBo.ImageProcessor.FitCanvas(d.viewport,c[3].canvas,!0,!1,!0)}};this.onCanvas.Mpr.Slicing=function(b){var d;if("touchmove"==b.type||"touchstart"==b.type){var c=b.originalEvent.targetTouches[0];d=new Point(c.pageX,c.pageY)}else d=new Point(b.pageX,b.pageY);var e=b.self.canvas,c=a.Mpr.mng.AnnStatusMng(),f=c.viewport,g=a.Mpr.mng.GetCanvas();a.Mpr.Series();switch(a.Mpr.mng.GetEventImageIndex(b.self)){case CBoBo.MPR_ORIGINAL:f.image=c.images[0];f.scale=f.scale1;d=CBoBo.ImageProcessor.PageToPixel(f,e,d.x,d.y);CBoBo.ImageProcessor.FitCanvas(f,e);a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:d,lcolor:"#0F0",vcolor:"#00F"});a.Mpr.ptO=d;e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:d,index:a.Mpr.oIndex});a.onCanvas.Mpr.DrawMprDicom(g[1],d,180);a.onCanvas.Mpr.DrawCanvasLine(g[1],e[CBoBo.MPR_LEVEL]);a.onCanvas.Mpr.DrawMprDicom(g[2],d,90);a.onCanvas.Mpr.DrawCanvasLine(g[2],e[CBoBo.MPR_VERTICAl]);break;case CBoBo.MPR_LEVEL:f.image=c.images[180];f.scale=f.scale2;d=CBoBo.ImageProcessor.PageToPixel(f,e,d.x,d.y);a.Mpr.ptL=d;CBoBo.ImageProcessor.FitCanvas(f,g[1].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:d,lcolor:"#F00",vcolor:"#00F"});a.Mpr.oIndex=d.y;if(b=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype))e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_LEVEL,point:d}),f.image=b,c.images[0]=b,CBoBo.ImageProcessor.FitCanvas(f,g[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(g[0],e[CBoBo.MPR_ORIGINAL]),a.onCanvas.Mpr.DrawMprDicom(g[2],a.Mpr.ptO,90),a.onCanvas.Mpr.DrawCanvasLine(g[2],e[CBoBo.MPR_VERTICAl]);break;case CBoBo.MPR_VERTICAl:if(f.image=c.images[90],f.scale=f.scale3,d=CBoBo.ImageProcessor.PageToPixel(f,e,d.x,d.y),a.Mpr.ptV=d,CBoBo.ImageProcessor.FitCanvas(f,g[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:d,lcolor:"#F00",vcolor:"#0F0"}),a.Mpr.oIndex=d.y,b=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype))e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:d}),f.image=b,c.images[0]=b,CBoBo.ImageProcessor.FitCanvas(f,g[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(g[0],e[CBoBo.MPR_ORIGINAL]),a.onCanvas.Mpr.DrawMprDicom(g[1],a.Mpr.ptO,180),a.onCanvas.Mpr.DrawCanvasLine(g[1],e[CBoBo.MPR_LEVEL])}};this.onCanvas.Mpr.CprCurve=function(b){if(a.Mpr.mng.GetCanvas()[3]!==b.self){var d;"touchmove"==b.type||"touchstart"==b.type?(d=b.originalEvent.targetTouches[0],d=new Point(d.pageX,d.pageY)):d=new Point(b.pageX,b.pageY);var c=a.Mpr.mng.AnnStatusMng();a.onCanvas.Mpr.UpdateCanvas(c);d=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,d.x,d.y);a.onCanvas.Mpr.curvePoints.push(d);var e=b.self.canvas.getContext("2d");e.beginPath();e.strokeStyle="#FF0";b=a.onCanvas.Mpr.curvePoints[0];e.moveTo(b.x,b.y);$.each(a.onCanvas.Mpr.curvePoints,function(){e.lineTo(this.x,this.y)});e.stroke()}};this.onCanvas.Mpr.CprLine=function(b){if(a.Mpr.mng.GetCanvas()[3]!==b.self){var d;"touchmove"==b.type||"touchstart"==b.type?(d=b.originalEvent.targetTouches[0],d=new Point(d.pageX,d.pageY)):d=new Point(b.pageX,b.pageY);var c=a.Mpr.mng.AnnStatusMng();a.onCanvas.Mpr.UpdateCanvas(c);c=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,a.Mpr.ptLast.x,a.Mpr.ptLast.y);d=CBoBo.Annotation.PageCoods2Canvas(b.self.canvas,d.x,d.y);a.onCanvas.Mpr.DrawCprLine(b.self,c,d)}};this.onCanvas.Mpr.DrawCprLine=function(a,d,c){a=a.canvas.getContext("2d");a.beginPath();a.strokeStyle="#FF0";a.moveTo(d.x,d.y);a.lineTo(c.x,c.y);a.stroke()};this.onCanvas.Mpr.WW=function(b){var d;"touchmove"==b.type&&(b=b.originalEvent.targetTouches[0]);d=new Point(b.pageX,b.pageY);b=d.x-a.Mpr.ptLast.x;var c=d.y-a.Mpr.ptLast.y;if(0!==b||0!==c){a.Mpr.ptLast=d;d=a.Mpr.mng.AnnStatusMng();var e=d.viewport;e.ww+=parseInt(b/e.scale);e.wc+=parseInt(c/e.scale);2>e.ww&&(e.ww=2);a.onCanvas.Mpr.UpdateCanvas(d)}};this.onCanvas.Mpr.UpdateCanvas=function(b){var d=a.Mpr.mng.GetCanvas();b.viewport.image=b.images[0];CBoBo.ImageProcessor.FitCanvas(b.viewport,d[0].canvas);a.onCanvas.Mpr.DrawCanvasLine(d[0],{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"});var c=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex});b.viewport.image=b.images[180];CBoBo.ImageProcessor.FitCanvas(b.viewport,d[1].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(d[1],c[CBoBo.MPR_LEVEL]);b.viewport.image=b.images[90];CBoBo.ImageProcessor.FitCanvas(b.viewport,d[2].canvas,!1,!1,!0);a.onCanvas.Mpr.DrawCanvasLine(d[2],c[CBoBo.MPR_VERTICAl]);b.viewport.image=b.images[0];d[0].DrawCornerInfo(b.viewport);d[1].DrawCornerInfo(b.viewport);d[2].DrawCornerInfo(b.viewport)};this.onCanvas.Mpr.MouseWheel=function(b){console.log("MouseWheel");var d=a.Mpr.mng.GetCanvas(),c=b.deltaY,e=a.Mpr.Series(),f=a.Mpr.mng.AnnStatusMng(),g;g=a.Mpr.mng.GetEventImageIndex(b.self);switch(g){case CBoBo.MPR_ORIGINAL:g=a.Mpr.oIndex;a.Mpr.oIndex=0<c?1>--a.Mpr.oIndex?1:a.Mpr.oIndex:++a.Mpr.oIndex>e.length?e.length:a.Mpr.oIndex;g!==a.Mpr.oIndex&&(g=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,b.self.canvas),a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"}),c=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),f.viewport.image=f.images[180],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(d[1],c[CBoBo.MPR_LEVEL]),f.viewport.scale=1,f.viewport.image=f.images[90],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(d[2],c[CBoBo.MPR_VERTICAl]),f.viewport.image=f.images[0],d[0].DrawCornerInfo(f.viewport),d[1].DrawCornerInfo(f.viewport),d[2].DrawCornerInfo(f.viewport));break;case CBoBo.MPR_LEVEL:g=e[0];b=parseInt(g.row);g=a.Mpr.ptO.y;a.Mpr.ptO.y=0<c?1>--a.Mpr.ptO.y?1:a.Mpr.ptO.y:++a.Mpr.ptO.y>b?b:a.Mpr.ptO.y;a.Mpr.ptV.x=a.Mpr.ptO.y;g!==a.Mpr.ptO.y&&(c=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),a.onCanvas.Mpr.DrawMprDicom(d[1],a.Mpr.ptO,180),a.onCanvas.Mpr.DrawCanvasLine(d[1],c[CBoBo.MPR_LEVEL]),f.viewport.image=f.images[90],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(d[2],c[CBoBo.MPR_VERTICAl]),c=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_VERTICAl,point:a.Mpr.ptV}),g=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,d[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(d[0],c[CBoBo.MPR_ORIGINAL]));break;case CBoBo.MPR_VERTICAl:g=e[0],b=parseInt(g.col),g=a.Mpr.ptO.x,a.Mpr.ptO.x=0<c?1>--a.Mpr.ptO.x?1:a.Mpr.ptO.x:++a.Mpr.ptO.x>b?b:a.Mpr.ptO.x,a.Mpr.ptL.x=a.Mpr.ptO.x,g!==a.Mpr.ptO.x&&(c=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),a.onCanvas.Mpr.DrawMprDicom(d[2],a.Mpr.ptO,90),a.onCanvas.Mpr.DrawCanvasLine(d[2],c[CBoBo.MPR_VERTICAl]),f.viewport.image=f.images[180],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(d[1],c[CBoBo.MPR_LEVEL]),c=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_LEVEL,point:a.Mpr.ptL}),g=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),a.Mpr.oIndex-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),f.viewport.image=g,f.images[0]=g,CBoBo.ImageProcessor.FitCanvas(f.viewport,d[0].canvas),a.onCanvas.Mpr.DrawCanvasLine(d[0],c[CBoBo.MPR_ORIGINAL]))}};this.onCanvas.Mpr.MoveMpr=function(b){console.log("MoveMpr");var d;"touchmove"==b.type?(d=b.originalEvent.targetTouches[0],d=new Point(d.pageX,d.pageY)):d=new Point(b.pageX,b.pageY);var c=d.y-a.Mpr.ptLast.y;if(0!==c){a.Mpr.ptLast=d;d=a.Mpr.mng.GetCanvas();var e=a.Mpr.Series(),f=a.Mpr.mng.AnnStatusMng(),g=a.Mpr.mng.GetEventImageIndex(b.self);switch(g){case CBoBo.MPR_ORIGINAL:g=a.Mpr.oIndex,a.Mpr.oIndex=0<c?1>--a.Mpr.oIndex?1:a.Mpr.oIndex:++a.Mpr.oIndex>e.length?e.length:a.Mpr.oIndex,g!==a.Mpr.oIndex&&(c=e[a.Mpr.oIndex-1],f.viewport.image=c,f.images[0]=c,CBoBo.ImageProcessor.FitCanvas(f.viewport,b.self.canvas),a.onCanvas.Mpr.DrawCanvasLine(b.self,{point:a.Mpr.ptO,lcolor:"#0F0",vcolor:"#00F"}),b=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:a.Mpr.ptO,index:a.Mpr.oIndex}),f.viewport.image=f.images[180],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[1].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(d[1],b[CBoBo.MPR_LEVEL]),f.viewport.scale=1,f.viewport.image=f.images[90],CBoBo.ImageProcessor.FitCanvas(f.viewport,d[2].canvas,!1,!1,!0),a.onCanvas.Mpr.DrawCanvasLine(d[2],b[CBoBo.MPR_VERTICAl]),f.viewport.image=f.images[0],d[0].DrawCornerInfo(f.viewport),d[1].DrawCornerInfo(f.viewport),d[2].DrawCornerInfo(f.viewport))}}};this.onCanvas.Mpr.DragImage=function(b){if(b=a.dataManager.GetSeries(b))if(b=b.GetAllDicom(),10>b.length)$.Msg("\u91cd\u5efa\u7684\u5e8f\u5217\u56fe\u50cf\u4e0d\u80fd\u5c0f\u4e8e10\u5f20!",CBoBo.MSG_ALERT),a.onCanvas.Mpr.Clear();else{for(var d=!1,c=0;c<b.length;c++)if(!b[c].bLoadImage){d=!0;break}d?($.Msg("\u8bf7\u7b49\u5f85\u8be5\u7ec4\u5e8f\u5217\u56fe\u50cf\u4e0b\u8f7d\u5b8c\u6bd5!",CBoBo.MSG_ALERT),a.onCanvas.Mpr.Clear()):(a.Mpr.Series(b),a.onCanvas.Mpr.InitCanvas())}else $.Msg("\u4e0d\u80fd\u8fdb\u884cMPR\u91cd\u5efa\uff01")};this.onCanvas.Mpr.InitCanvas=function(){var b=a.Mpr.mng.GetCanvas();if(void 0!==b){var d=a.Mpr.Series();if(d){var c=CBoBo.AnnStatusManager.Create(d[0],"","",!0);a.Mpr.mng.AnnStatusMng(c);var e=b[0],d=Math.floor(d.length/2);a.Mpr.oIndex=d;var f=CBoBo.Mpr.GenerateMipNomalPlane(a.Mpr.Series(),d-1,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype);c.viewport.image=f;c.images[0]=f;CBoBo.ImageProcessor.Restore(c.viewport).FitCanvas(c.viewport,e.canvas);c.viewport.scale1=c.viewport.scale;e.DrawCornerInfo(c.viewport);f=new Point(parseInt(f.col)>>1,parseInt(f.row)>>1);a.Mpr.ptO=f;a.onCanvas.Mpr.DrawCanvasLine(e,{point:f,lcolor:"#0F0",vcolor:"#00F"});e=a.onCanvas.Mpr.GetMapCoord({type:CBoBo.MPR_ORIGINAL,point:f,index:d});a.onCanvas.Mpr.DrawMprDicom(b[1],f,180);c.viewport.scale2=c.viewport.scale;a.onCanvas.Mpr.DrawCanvasLine(b[1],e[CBoBo.MPR_LEVEL]);b[1].DrawCornerInfo(c.viewport);a.onCanvas.Mpr.DrawMprDicom(b[2],f,90);c.viewport.scale3=c.viewport.scale;a.onCanvas.Mpr.DrawCanvasLine(b[2],e[CBoBo.MPR_VERTICAl]);b[2].DrawCornerInfo(c.viewport);a.Mpr.ptL=e[CBoBo.MPR_LEVEL].point;a.Mpr.ptV=e[CBoBo.MPR_VERTICAl].point}}};this.onCanvas.Mpr.DrawCanvasLine=function(b,d){function c(a,b,d){a.beginPath();a.moveTo(b.x,b.y);a.lineTo(d.x,d.y);a.stroke()}if(void 0!==d){var e=b.canvas;b=b.canvas.getContext("2d");var f=a.Mpr.mng.AnnStatusMng().viewport,g=f.image,l=d.point,m=d.lcolor;d=d.vcolor;var n=g.col,t=g.row,g=new Point(0,l.y),r=new Point(n,l.y),n=new Point(l.x,0),t=new Point(l.x,t),g=CBoBo.ImageProcessor.PixelToCanvas(f,e,g),r=CBoBo.ImageProcessor.PixelToCanvas(f,e,r);b.save();b.setTransform(1,0,0,1,0,0);b.strokeStyle=m;c(b,g,r);g=CBoBo.ImageProcessor.PixelToCanvas(f,e,n);r=CBoBo.ImageProcessor.PixelToCanvas(f,e,t);b.strokeStyle=d;c(b,g,r);b.restore();return l}};this.onCanvas.Mpr.DrawMprDicom=function(b,d,c){var e={},f={},g=a.Mpr.Series();g&&(90===c?(e.x=d.x,e.y=0,f.x=d.x,f.y=g[0].row):(e.x=0,e.y=d.y,f.x=g[0].col,f.y=d.y),d=CBoBo.Mpr.GetPointsFromLine(e,f),d=CBoBo.Mpr.GenerateNormalPlane(a.Mpr.Series(),d,a.onTool.Mpr.thicKness,a.onTool.Mpr.Miptype),e=a.Mpr.mng.AnnStatusMng(),e.images[c]=d,e.viewport.image=d,CBoBo.ImageProcessor.FitCanvas(e.viewport,b.canvas,!1,!1,!0))};this.onCanvas.Mpr.GetMapCoord=function(b){if(void 0!=b){var d={};switch(b.type){case CBoBo.MPR_ORIGINAL:var c=b.point,e=b.index;b=d[CBoBo.MPR_LEVEL]={};b.point=new Point(c.x,e);b.lcolor="#F00";b.vcolor="#00F";b=d[CBoBo.MPR_VERTICAl]={};b.point=new Point(c.y,e);b.lcolor="#F00";b.vcolor="#0F0";break;case CBoBo.MPR_LEVEL:c=b.point;b=d[CBoBo.MPR_ORIGINAL]={};a.Mpr.ptO.x=c.x;b.point=a.Mpr.ptO;b.lcolor="#0F0";b.vcolor="#00F";b=d[CBoBo.MPR_VERTICAl]={};a.Mpr.ptV.y=c.y;b.point=a.Mpr.ptV;b.lcolor="#F00";b.vcolor="#0F0";break;case CBoBo.MPR_VERTICAl:c=b.point,b=d[CBoBo.MPR_ORIGINAL]={},a.Mpr.ptO.y=c.x,b.point=a.Mpr.ptO,b.lcolor="#0F0",b.vcolor="#00F",b=d[CBoBo.MPR_LEVEL]={},a.Mpr.ptL.y=c.y,b.point=a.Mpr.ptL,b.lcolor="#F00",b.vcolor="#00F"}return d}};this.onCanvas.Mpr.Clear=function(){a.Mpr.mng.AnnStatusMng(null);var b=a.Mpr.mng.GetCanvas();void 0!==b&&($.each(b,function(a,b){b.canvas.width=b.canvas.width;b.DrawCornerInfo()}),a.Mpr.bMsg=!1)};this.onCanvas.Mpr.MipCreat=function(a,d){alert(a+d)};this.onTool.Mpr={type:"\u5341\u5b57\u5207\u9762",Miptype:void 0,thicKness:1};this.onTool.Mpr.MsgTransform=function(b){var d=b.usermsg||b.target.title;switch(d){case "CPR\u76f4\u7ebf":case "CPR\u66f2\u7ebf":a.Mpr.SetLayout(4);break;case "\u5207\u9762\u8c03\u7a97":"\u5207\u9762\u8c03\u7a97"!=a.onTool.Mpr.type&&a.toolBar.ChangeBtnStatus(a.onTool.Mpr.type);a.onTool.Mpr.type="\u5207\u9762\u8c03\u7a97";a.Mpr.SetLayout(3);a.onCanvas.Mpr.InitCanvas();return;case "\u5341\u5b57\u5207\u9762":"\u5341\u5b57\u5207\u9762"!=a.onTool.Mpr.type&&a.toolBar.ChangeBtnStatus(a.onTool.Mpr.type),a.onTool.Mpr.type="\u5341\u5b57\u5207\u9762",a.Mpr.SetLayout(3);case "\u5012\u5e8f":a.Mpr.Series().reverse();a.onCanvas.Mpr.InitCanvas();return;case "\u6700\u5927\u5bc6\u5ea6\u6295\u5f71":a.onTool.Mpr.Miptype=d;break;case "\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71":a.onTool.Mpr.Miptype=d;break;case "\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71":a.onTool.Mpr.Miptype=d;break;case "\u5c42\u539a":a.onTool.Mpr.thicKness=b.target.value}"\u5c42\u539a"!=d&&!1===a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce)?(a.onTool.Mpr.type="\u5341\u5b57\u5207\u9762",void 0!=a.onTool.Mpr.Miptype&&(a.onTool.Mpr.Miptype=void 0,a.onCanvas.Mpr.InitCanvas())):("\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71"!=d&&"\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71"!=d&&"\u6700\u5927\u5bc6\u5ea6\u6295\u5f71"!=d&&"\u5c42\u539a"!=d&&(a.onTool.Mpr.type=d),void 0!=a.onTool.Mpr.Miptype&&1!=a.onTool.Mpr.thicKness?a.onCanvas.Mpr.InitCanvas():(b=a.Mpr.mng.AnnStatusMng(),a.onCanvas.Mpr.UpdateCanvas(b)))};this.PrintView={};this.PrintView.MsgTransform=function(b){if(b.self){var d=b.self.webWorkerType;switch(b.type){case "dblclick":case "doubletap":case "mousewheel":return;case "message":d==CBoBo.PTYPE_JPG?a.onCanvas.Jpg.DrawImage(b):a.onCanvas.DrawDicom(b)}d==CBoBo.PTYPE_JPG?a.onCanvas.Jpg.MsgTransform(b):a.onCanvas.MsgTransform(b)}else switch(b.toolbtnresponse&&a.onTool.MsgTransform(b),b.type){case "draw":a.FlushAnnStatusForCanvas(b.arrannstatus,b.arrcanvas,b.bforce,!0)}};this.Assist={};this.Assist.MsgTransform=function(b){if("object"==typeof b)switch(b.type){case "btnfocus":a.toolBar.ChangeBtnStatus(b.btntitle,b.btnforce);break;case "command":a.Assist.AnalyzeStatus(b.data);break;case "addstudy":b=a.Assist.GetTransferStatus(),a.assistDiagnose.SendCommand(b)}};this.Assist.GetTransferStatus=function(){var b={wadourl:"",hospid:"",studyuid:"",mode:"2d",bd:{mode:0,layout:{row:1,col:1,arrlayout:[]},focus:{index1:1,index2:1},bshowcornerinfo:1,annstatus:[]}},d={voi:{ww:0,wc:0},translation:{x:0,y:0},invert:0,rotation:0,pseudocolor:"",arrann:{}},c=a.dataManager.GetStudy(0);b.studyuid=c.stuuid;b.wadourl=c.wadourl;b.hospid=c.hospid;b.mode=void 0!==a.Mpr&&a.Mpr.bShow?"mpr":"2d";"2d"==b.mode?(b.bd.mode=a.mode,b.bd.mode==CBoBo.PTYPE_SERIES?(b.bd.layout.row=a.canvasManager.nLayoutRow,b.bd.layout.col=a.canvasManager.nLayoutCol,b.bd.focus.index1=a.canvasManager.focusIndex,b.bd.focus.index2=a.canvasManager.GetFocusMng().focusIndex,$.each(a.annStatusManager.GetAnnStatusMng(),function(a,c){var e=$.extend(!0,d,{});$.each(c.arrAnnStatus,function(a,b){var d=b.status;0==a&&(e.voi.ww=d.ww,e.voi.wc=d.wc,e.translation.x=d.ptLast.x,e.translation.y=d.ptLast.y,e.invert=d.negative,e.rotation=d.rotateState,e.pseudocolor="");if(void 0!==d.imageInfo||null!==d.imageInfo)e.arrann[d.imageInfo.id]=CBoBo.Plugin.CloneObj(b.ann.arrAnn)});b.bd.annstatus.push(e)}),$.each(a.canvasManager.arrFirstLayer,function(){b.bd.layout.arrlayout.push({row:this.nLayoutRow,col:this.nLayoutCol})})):(b.bd.layout.row=a.canvasManager.nLayoutRow,b.bd.layout.col=a.canvasManager.nLayoutCol,b.bd.focus.index1=a.canvasManager.focusIndex,$.each(a.annStatusManager.GetAnnStatus(),function(a,c){a=$.extend(!0,{},d);if(c.type==CBoBo.PTYPE_DESERIES){var e=c.status;a.voi.ww=e.ww;a.voi.wc=e.wc;a.translation.x=e.ptLast.x;a.translation.y=e.ptLast.y;a.invert=e.negative;a.rotation=e.rotateState;a.pseudocolor="";if(void 0!==e.imageInfo||null!==e.imageInfo)a.arrann[e.imageInfo.id]=CBoBo.Plugin.CloneObj(c.ann.arrAnn)}else e=c.status,a.voi.ww=e.brightness,a.voi.wc=e.contrast,a.translation.x=e.ptLast.x,a.translation.y=e.ptLast.y,a.invert=e.Negative,a.rotation=e.rotateState,a.pseudocolor="";b.bd.annstatus.push(a)})),b.bd.bshowcornerinfo=a.toolBar.bShowCornerInfo):"mpr"==b.mode&&(b.mpr={});return b};this.Assist.AnalyzeStatus=function(b){if(b instanceof Object){var d=a.Assist.GetTransferStatus();console.log(b);if(b.hospid!=d.hospid||d.studyuid!=b.studyuid)a.onThumb.ToolMsg({usermsg:"\u6e05\u7a7a\u5168\u90e8\u68c0\u67e5"}),void 0!==a.canvasManager&&(a.canvasManager.Destroy(),delete a.canvasManager,a.canvasManager=void 0),void 0!==a.annStatusManager&&(delete a.annStatusManager,a.annStatusManager=void 0),a.OpenStudy(b.wadourl,b.hospid,b.studyuid);(function(b){if("2d"==b.mode&&void 0!==a.canvasManager)if(b=b.bd,b.mode==CBoBo.PTYPE_SERIES){if(d.bd.layout.row!=b.layout.row||d.bd.layout.col!=b.layout.col){var c=a.annStatusManager.GetAnnStatusMng();a.canvasManager.UpdateLayout(c.length,b.layout.row,b.layout.col);a.canvasManager.EachMng(function(a,b){if(a<c.length){if(a=c[a],null!==a){var d=a.GetAnnStatus();b.UpdateLayout(d.length);b.AnnStatusMng(a);0<d.length&&(d[0].type==CBoBo.PTYPE_SERIES?b.checkbox.Show(!0):b.checkbox.Show(!1))}}else b.UpdateLayout(0),b.checkbox.Show(!1)})}var e=b.layout.arrlayout,g=d.bd.layout.arrlayout;e instanceof Array&&a.canvasManager.EachMng(function(a,b){if(a<e.length){var d=e[a];a=g[a];if(a.row!=d.row||a.col!=d.col)null!==b.annStatusMng?b.UpdateLayout(b.annStatusMng.arrAnnStatus.length,d.row,d.col):b.UpdateLayout(0,d.row,d.col)}})}else if(d.bd.layout.row!=b.layout.row||d.bd.layout.col!=b.layout.col){var h=a.annStatusManager.GetAnnStatus();a.canvasManager.UpdateLayout(h.length,b.layout.row,b.layout.col)}})(b);(function(b){"2d"==b.mode&&(b=b.bd,d.bd.focus.index1==b.focus.index1&&d.bd.focus.index2==b.focus.index2||a.canvasManager.SetDefaultFocus(b.focus.index1,b.focus.index2))})(b);(function(a){if("2d"==a.mode){a=a.bd;var b=a.annstatus;a.mode==CBoBo.PTYPE_SERIES&&b instanceof Array&&$.each(b,function(a,b){})}})(b)}};a.GlobalInit();a.DL.OpenStudy()};"undefined"==typeof CBoBo&&(CBoBo={});!function(e){var c=!1,a;e.Draw={GetIsFromServer:function(){return c},SetIsFromServer:function(a){c=a},FitServerCanvas:function(a,b,d,h,k){c?e.ImageProcessor.FitServerCanvas(a,b,d,h,k):e.ImageProcessor.FitCanvas(a,b,d,h,k)},DrawImage:function(a,b,d,h){c?e.ImageProcessor.DrawServerGrayImage(a,b,d,h):e.ImageProcessor.DrawGrayImage(a,b,d,h)},SetWadoUrl:function(c){a=c},GetWadoUrl:function(){return a}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(e){function c(a){for(var b=0;b<v.length;b++){var d=v[b];if(d.id===a.id&&d.imageid===a.image.id)return d}}function a(a){24<=v.length&&v.shift();v.push(a)}function g(a){for(var b=0;b<v.length;b++){var d=v[b];d.id===a.id&&d.imageid===a.imageid&&v.splice(b,1)}}function b(b,d){var e=c(b),l=h(e,b),p=b.image,u=p.isRGB,m=p.isIMGAnalysis2;if(d||void 0===e||e.canvas.width!==b.image.col||e.canvas.height!==b.image.row){void 0!==e&&g(e);e={};e.id=b.id;e.imageid=b.image.id;e.ww=b.ww;e.wc=b.wc;e.invert=b.invert;e.pseudo=b.pseudo;1<b.image.frames&&!self.CBoBo.Manager.toolBar.IsEnable("\u5e8f\u5217\u64ad\u653e")&&(self.CBoBo.Manager.toolBar.EnableButton("\u5e8f\u5217\u64ad\u653e",!0),self.CBoBo.Manager.toolBar.GetButtonDOM("\u5e8f\u5217\u64ad\u653e").click());d=document.createElement("canvas");d.width=b.image.col;d.height=b.image.row;l=d.getContext("2d");p=l.getImageData(0,0,d.width,d.height);if(u){b=b.image.pixsBuffer;for(var q=u=0,n=b.length,r=p.data;q<n;)r[u++]=b[q++],r[u++]=b[q++],r[u++]=b[q++],r[u++]=m?b[q++]:255}else if(1==b.image.imageType&&8>=b.image.bita&&"MONOCHROME2"==b.image.phme)for(m=b.image.pixsBuffer,u=p.data,n=b.frames,n=isNaN(n)||void 0==n?0:n-1,b=0,q=u.length,n=n*q/4;b<q;)u[b++]=m[n],u[b++]=m[n],u[b++]=m[n],u[b++]=255,n++;else m=b.image.pixsBuffer,u=b.image.minGray,q=p.data,b=k(b.ww,b.wc,u,b.image.maxGray,b.image.rescsl,b.image.rescin,b.invert,b.pseudo),f(m,b,u,q);l.putImageData(p,0,0);e.canvas=d;e.ctx=l;e.imagedata=p;a(e);return d}void 0!==e&&l&&!u&&(d=b.image.pixsBuffer,l=b.image.minGray,p=e.imagedata.data,m=k(b.ww,b.wc,l,b.image.maxGray,b.image.rescsl,b.image.rescin,b.invert,b.pseudo),f(d,m,l,p),e.ctx.putImageData(e.imagedata,0,0),e.ww=b.ww,e.wc=b.wc,e.invert=b.invert,e.pseudo=b.pseudo);return e.canvas}function d(b,d){var f=c(b),k=h(f,b),l=$.Deferred();if(d||void 0===f||f.canvas.width!==b.image.col||f.canvas.height!==b.image.row)void 0!==f&&g(f),d=new Image,d.src=e.Draw.GetWadoUrl()+"/GetImageData?id\x3d"+b.image.id+"\x26contentType\x3dimage/jpeg\x26windowWidth\x3d"+b.ww+"\x26windowCenter\x3d"+b.wc+"\x26efficioncy\x3d80",d.onload=function(){var d={};d.id=b.id;d.imageid=b.image.id;d.ww=b.ww;d.wc=b.wc;d.invert=b.invert;d.pseudo=b.pseudo;d.canvas=this;a(d);return l.resolve(this)};else if(void 0!==f&&k)void 0!==f&&g(f),d=new Image,d.src=e.Draw.GetWadoUrl()+"/GetImageData?id\x3d"+b.image.id+"\x26contentType\x3dimage/jpeg\x26windowWidth\x3d"+b.ww+"\x26windowCenter\x3d"+b.wc+"\x26efficioncy\x3d80",d.onload=function(){var d={};d.id=b.id;d.imageid=b.image.id;d.ww=b.ww;d.wc=b.wc;d.invert=b.invert;d.pseudo=b.pseudo;d.canvas=this;a(d);return l.resolve(this)};else return l.resolve(f.canvas);return l}function h(a,b){return void 0===a||void 0===b?!1:a.ww!==b.ww||a.wc!==b.wc||a.invert!==b.invert||a.pseudo!==b.pseudo?!0:!1}function k(a,b,d,c,e,f,g,h){var k=[],l=0;0>d&&(l=d);if(g)for(;d<=c;d++)g=parseInt(d*e+f),g=255*((g+-b)/a+.5),g=Math.min(Math.max(g,0),255),k[d+-l]=Math.round(255-g);else for(;d<=c;d++)g=parseFloat(d*e+f),g=255*((g+-b)/a+.5),g=Math.min(Math.max(g,0),255),k[d+-l]=Math.round(g);if(""===h||"\u7070\u8272"===h)return{r:k,g:k,b:k};a=p(h);b=new Int16Array(k.length);c=new Int16Array(k.length);for(f=0;f<k.length;f++)e=k[f],b[f]=a.r[e],c[f]=a.g[e],k[f]=a.b[e];return{r:b,g:c,b:k}}function f(a,b,d,c){var e=0,f=0,g=a.length,h=b.r,k=b.g;b=b.b;var l;if(0>d)for(;f<g;)l=a[f++]+-d,c[e++]=h[l],c[e++]=k[l],c[e++]=b[l],c[e++]=255;else for(;f<g;)l=a[f++],c[e++]=h[l],c[e++]=k[l],c[e++]=b[l],c[e++]=255;return c}function p(a){switch(a){case "\u5f69\u8679":return{r:rainbow_red,g:rainbow_green,b:rainbow_blue};case "\u9ed1\u4f53":return{r:blackbody_red,g:blackbody_green,b:blackbody_blue};case "\u9aa8\u9abc":return{r:bones_red,g:bones_green,b:bones_blue};case "\u5fc3\u810f":return{r:cardiac_red,g:cardiac_green,b:cardiac_blue};case "\u6d41\u52a8":return{r:flow_red,g:flow_green,b:flow_blue};case "Ge\u8272":return{r:ge_color_red,g:ge_color_green,b:ge_color_blue};case "\u7070\u8272\u5f69\u8679":return{r:gray_rainbow_red,g:gray_rainbow_green,b:gray_rainbow_blue};case "\u70ed\u7eff":return{r:hot_green_red,g:hot_green_green,b:hot_green_blue};case "\u94ec\u94c1":return{r:hot_iron_red,g:hot_iron_green,b:hot_iron_blue};case "\u70ed\u91d1\u5c5e":return{r:hot_metal_red,g:hot_metal_green,b:hot_metal_blue};case "\u9971\u548c\u5ea61":return{r:hue1_red,g:hue1_green,b:hue1_blue};case "\u9971\u548c\u5ea62":return{r:hue2_red,g:hue2_green,b:hue2_blue};case "\u7ea2\u5916":return{r:ired_red,g:ired_green,b:ired_blue};case "\u58a8\u9ed1":return{r:jet_red,g:jet_green,b:jet_blue};case "\u9aa8\u9abc-\u808c\u8089":return{r:muscles_bones_red,g:muscles_bones_green,b:muscles_bones_blue};case "NIH":return{r:nih_red,g:nih_green,b:nih_blue};case "\u5f69\u86791":return{r:rainbow1_red,g:rainbow1_green,b:rainbow1_blue};case "\u5f69\u86792":return{r:rainbow2_red,g:rainbow2_green,b:rainbow2_blue};case "\u5f69\u86793":return{r:rainbow3_red,g:rainbow3_green,b:rainbow3_blue};case "\u6bd4\u503c":return{r:ratio_red,g:ratio_green,b:ratio_blue};case "\u7ea2\u8272\u8840\u7ba1":return{r:red_vessels_red,g:red_vessels_green,b:red_vessels_blue};case "\u5149\u8c31":return{r:spectrum_red,g:spectrum_green,b:spectrum_blue};case "\u65af\u7279\u6069":return{r:stern_red,g:stern_green,b:stern_blue};case "UCLA":return{r:ucla_red,g:ucla_green,b:ucla_blue}}}function l(a){return void 0===a.image?{width:0,height:0}:0===a.rotation||180===a.rotation?{width:a.image.col,height:a.image.row}:{width:a.image.row,height:a.image.col}}function m(a,b,d){var c=new r;c.translate(b.width/2,b.height/2);b=a.rotation;0!==b&&c.rotate(b*Math.PI/180);var e=a.scale,f=a.scale;a.image.pixy<a.image.pixx?e*=a.image.pixx/a.image.pixy:a.image.pixx<a.image.pixy&&(f*=a.image.pixy/a.image.pixx);c.scale(e,f);0!==b&&c.rotate(-b*Math.PI/180);c.translate(a.translation.x,a.translation.y);0!==b&&c.rotate(b*Math.PI/180);void 0!==d&&c.scale(d,d);a.hflip&&c.scale(-1,1);a.vflip&&c.scale(1,-1);c.translate(-a.image.col/2,-a.image.row/2);return c}function n(a,b,d,c){if(a.image.pixx&&a.image.pixy&&!(150>c||150>d)){var e=a.image.col,f=a.image.row,g=a.scale,h,k,l=a.image.pixx;a=a.image.pixy;h=e*g;k=f*g;var g=d/3*e*l/h,p=d/2*e*l/h,m=c/3*f*a/k,n=c/2*f*a/k,x=[1,2,3,5,10,15,20,25,30,50,100,150,200,250,300,500,1E3,1500,2E3,2500,3E3,5E3,1E4];for(a=k=f=0;a<x.length&&!(.01>f&&g<x[a]&&p>x[a]&&(f=x[a]),.01>k&&m<x[a]&&n>x[a]&&(k=x[a]),.01<=f&&.01<=k);a++);.01>f&&(f=Math.round((p+g)/2));.01>k&&(k=Math.round((n+m)/2));a=f*h/(l*e);if(!(1E4<f||1>f||1E4<k||1>k)){g="mm";1E3<=f?3E3<f?(f=Math.round(f/1E3),g="m",a=1E3*f*h/(l*e)):(f=Math.round(f/100),g="dm",a=100*f*h/(l*e)):100<=f?300<f?(f=Math.round(f/100),g="dm",a=100*f*h/(l*e)):(f=Math.round(f/10),g="cm",a=10*f*h/(l*e)):10<=f&&30<f&&(f=Math.round(f/10),g="cm",a=10*f*h/(l*e));b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.translate(.5,.5);b.strokeStyle="white";b.fillStyle="white";h=c/20;e=(d-a)/2;l=c-h;d=(d+a)/2;c-=h;b.moveTo(Math.round(e),Math.round(l));b.lineTo(Math.round(d),Math.round(c));h=f;10>=h&&(h*=10);p=a/h;10<h&&5>p&&(h/=10,p=a/h);for(a=0;a<=h;a++)k=a*p,m=e+k,0==a%10?(x=e+k,n=l-15):0==a%5?(x=e+k,n=l-15):(x=e+k,n=l-10),k=b,k.moveTo(Math.round(m),Math.round(l)),k.lineTo(Math.round(x),Math.round(n));b.stroke();b.fillText(f+" "+g,Math.round(d+10),Math.round(c));b.restore()}}}function t(a,b,d){var c=a.image;if(c.orl||c.ort||c.orr||c.orb){d.setTransform(1,0,0,1,0,0);var f,g=a.image.col,h=a.image.row;f={x:g/2,y:12};c=e.ImageProcessor.PixelToCanvas(a,b,f);f={x:g/2,y:h-12};var k=e.ImageProcessor.PixelToCanvas(a,b,f);f={x:12,y:h/2};var l=e.ImageProcessor.PixelToCanvas(a,b,f);f={x:g-12,y:h/2};b=e.ImageProcessor.PixelToCanvas(a,b,f);f=d.measureText(a.image.ort).width;var g=d.measureText(a.image.orl).width,h=d.measureText(a.image.orr).width,p=d.measureText(a.image.orb).width;d.fillText(a.image.ort,c.x-f/2,c.y);d.fillText(a.image.orl,l.x-g/2,l.y);d.fillText(a.image.orr,b.x-h/2,b.y);d.fillText(a.image.orb,k.x-p/2,k.y)}}function r(){this.reset()}var v=[];e.ImageProcessor={GetDefaultStatus:function(){var a;a=(1E12*Math.random()>>0)+(new Date).getTime();return{id:a,image:void 0,ww:0,wc:0,rotation:0,scale:1,scale0:1,scale1:1,scale2:1,scale3:1,translation:{x:0,y:0},hflip:!1,vflip:!1,pseudo:"",invert:!1,wwScale:1}},Restore:function(a){if(!a.image.bLoadImage)return this;a.wc=parseInt(a.image.wc);a.ww=parseInt(a.image.ww);if(isNaN(a.wc)||isNaN(a.ww)||0===a.ww)a.ww=a.image.maxGray-a.image.minGray,a.wc=a.image.minGray+(a.ww>>1);a.scale=1;a.translation.x=0;a.translation.y=0;a.invert="MONOCHROME1"===a.image.phme?!0:!1;a.image.isIMGAnalysis2&&(a.invert=!1);a.pseudo="";a.rotation=0;a.hflip=!1;a.vflip=!1;a.image.isIMGAnalysis2?a.wwScale=.5:(a.wwScale=Math.abs(a.wc).toString().slice(0,1),2>=a.wc.toString().length&&(a.wwScale=.5));return this},FitCanvas:function(a,b,d,c,e){if(void 0!==a.image&&a.image.bLoadImage){var f=l(a),g;g=a.image.pixx===a.image.pixy||isNaN(a.image.pixx)||isNaN(a.image.pixy)?b.height/f.height:b.height/(f.height*a.image.pixy/a.image.pixx);f=b.width/f.width;a.scale=f<g?f:g;a.scale=parseFloat(a.scale.toFixed(2));a.translation.x=0;a.translation.y=0;c||this.DrawGrayImage(a,b,d,e)}},DrawGrayImage:function(a,d,c,e){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===d)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var f=d.getContext("2d");c=b(a,c);var g=a.image.col,h=a.image.row;f.imageSmoothingQuality="high";f.imageSmoothingEnabled=!0;f.shadowColor="#000000";f.shadowOffsetX=1;f.shadowOffsetY=1;f.shadowBlur=.5;f.fillStyle="white";f.clearRect(0,0,d.width,d.height);var k=m(a,d);f.setTransform(k.m[0],k.m[1],k.m[2],k.m[3],k.m[4],k.m[5],k.m[6]);a.image.pixx===a.image.pixy||isNaN(a.image.pixx)||isNaN(a.image.pixy)?f.drawImage(c,0,0,g,h,0,0,g,h):f.drawImage(c,0,0,g,h);e?f.setTransform(1,0,0,1,0,0):t(a,d,f);"ECG"!=a.image.mod&&n(a,f,d.width,d.height)},DrawGrayImage1:function(a,d,c,e){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===d)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var f=d.getContext("2d"),g=b(a,c),h=a.image.col,k=a.image.row;f.shadowColor="#000000";f.shadowOffsetX=1;f.shadowOffsetY=1;f.shadowBlur=.5;f.fillStyle="white";f.clearRect(0,0,d.width,d.height);var l=m(a,d);f.setTransform(l.m[0],l.m[1],l.m[2],l.m[3],l.m[4],l.m[5],l.m[6]);f.drawImage(g,0,0,h,k,0,0,h,k);c=f.getImageData(0,0,h,k);var p=document.createElement("canvas");p.width=d.width;p.height=d.height;p=p.getContext("2d");p.shadowColor="#000000";p.shadowOffsetX=1;p.shadowOffsetY=1;p.shadowBlur=.5;p.fillStyle="white";p.clearRect(0,0,d.width,d.height);p.imageSmoothingEnabled=!1;p.setTransform(l.m[0],l.m[1],l.m[2],l.m[3],l.m[4],l.m[5],l.m[6]);p.drawImage(g,0,0,h,k,0,0,h,k);g=p.getImageData(0,0,h,k);c=c.data;g=g.data;for(h=0;h<c.length;h+=4)if(k=g[h],l=g[h+1],p=g[h+2],255===k||0===k)c[h]=k,c[h+1]=l,c[h+2]=p;e?f.setTransform(1,0,0,1,0,0):t(a,d,f);n(a,f,d.width,d.height)},PageToPixel:function(a,b,d,c,e){if(void 0===a.image)throw"PageToPixel:image has not been loaded yet.";void 0==e?(e=b.getBoundingClientRect(),d={x:d-e.left-window.pageXOffset,y:c-e.top-window.pageYOffset}):d={x:d,y:c};b=m(a,b);b.invert();b=d=b.transformPoint(d.x,d.y);c=a.image.col;a=a.image.row;0>b.x&&(b.x=0);0>b.y&&(b.y=0);c=0+c;a=0+a;b.x>c&&(b.x=c);b.y>a&&(b.y=a);b.x=parseInt(b.x);b.y=parseInt(b.y);return d},PixelToCanvas:function(a,b,d){return m(a,b).transformPoint(d.x,d.y)},FitServerCanvas:function(a,b,d,c,e){if(void 0!==a.image&&a.image.bLoadImage){var f=l(a),g=b.height/f.height,f=b.width/f.width;a.scale=f<g?f:g;a.scale=parseFloat(a.scale.toFixed(2));a.translation.x=0;a.translation.y=0;c||this.DrawServerGrayImage(a,b,d,e)}},DrawServerGrayImage:function(a,b,c,e){if(!(a instanceof Object))throw"CBoBo.ImageProcessor.DrawGrayImage: incorrect status.";if(void 0===b)throw"CBoBo.ImageProcessor.DrawGrayImage: canvas is undefined.";if(!a.image.bLoadImage)return this;var f=b.getContext("2d");d(a,c).then(function(d){var c=a.image.col,g=a.image.row;f.shadowColor="#000000";f.shadowOffsetX=1;f.shadowOffsetY=1;f.shadowBlur=.5;f.fillStyle="white";f.clearRect(0,0,b.width,b.height);var h=m(a,b);f.setTransform(h.m[0],h.m[1],h.m[2],h.m[3],h.m[4],h.m[5],h.m[6]);f.drawImage(d,0,0,c,g,0,0,c,g);e?f.setTransform(1,0,0,1,0,0):t(a,b,f);n(a,f,b.width,b.height)})}};r.prototype.reset=function(){this.m=[1,0,0,1,0,0]};r.prototype.clone=function(){var a=new r;a.m[0]=this.m[0];a.m[1]=this.m[1];a.m[2]=this.m[2];a.m[3]=this.m[3];a.m[4]=this.m[4];a.m[5]=this.m[5];return a};r.prototype.multiply=function(a){var b=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],c=this.m[1]*a.m[2]+this.m[3]*a.m[3],e=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],f=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=b;this.m[2]=d;this.m[3]=c;this.m[4]=e;this.m[5]=f};r.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=-this.m[1]*a,d=-this.m[2]*a,c=this.m[0]*a,e=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),f=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*a;this.m[1]=b;this.m[2]=d;this.m[3]=c;this.m[4]=e;this.m[5]=f};r.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var d=this.m[1]*b+this.m[3]*a,c=this.m[0]*-a+this.m[2]*b,e=this.m[1]*-a+this.m[3]*b;this.m[0]=this.m[0]*b+this.m[2]*a;this.m[1]=d;this.m[2]=c;this.m[3]=e};r.prototype.translate=function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b;this.m[5]+=this.m[1]*a+this.m[3]*b};r.prototype.scale=function(a,b){this.m[0]*=a;this.m[1]*=a;this.m[2]*=b;this.m[3]*=b};r.prototype.transformPoint=function(a,b){var d=a;a=d*this.m[0]+b*this.m[2]+this.m[4];b=d*this.m[1]+b*this.m[3]+this.m[5];return{x:a,y:b}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(e){function c(a,b,d){var c=[];if(a.x===b.x&&a.y===b.y)c.push(a);else if(a.x===b.x)if(a.y>b.y)for(var e=a.y;e>=b.y;e--)c.push({x:a.x,y:e});else for(e=a.y;e<=b.y;e++)c.push({x:a.x,y:e});else if(a.y===b.y)if(a.x>b.x)for(var f=a.x;f>=b.x;f--)c.push({x:f,y:a.y});else for(f=a.x;f<=b.x;f++)c.push({x:f,y:a.y});else{var g=(b.y-a.y)/(b.x-a.x);if(Math.abs(a.x-b.x)>Math.abs(a.y-b.y))if(a.x>b.x)for(f=a.x;f>=b.x;f--)e=g*(f-a.x)+a.y,d||(e=Math.round(e)),c.push({x:f,y:e});else for(f=a.x;f<=b.x;f++)e=g*(f-a.x)+a.y,d||(e=Math.round(e)),c.push({x:f,y:e});else if(a.y>b.y)for(e=a.y;e>=b.y;e--)f=(e-a.y)/g+a.x,d||(f=Math.round(f)),c.push({x:f,y:e});else for(e=a.y;e<=b.y;e++)f=(e-a.y)/g+a.x,d||(f=Math.round(f)),c.push({x:f,y:e})}return c}function a(a){return"number"===typeof a&&0===a%1}!function(e){function b(a,b,c,f){var d=a[0].col,g=new DVDicomInfo;g.id=e.Plugin.GetRandom();g.SetInfo({data:a[0]});var h=1,k=0,t=0,r=0,v=0,v=b[0].x==b[1].x?1:2;g.row=a.length;g.col=b.length;g.pixy=Math.abs(a[0].pixz-a[1].pixz);h=parseInt(c/g.pixx);g.pixsBuffer=new Int16Array(g.row*g.col);var u=0;$.each(a,function(a,c){$.each(b,function(){k=-32768;t=32767;for(var a=r=0;a<h;a++){if(2==v)var b=d*(this.y+a)+this.x;1==v&&(b=d*this.y+this.x+a);var e=c.pixsBuffer[b];r+=e/h;k<e&&(k=e);t>e&&(t=e)}"\u6700\u5927\u5bc6\u5ea6\u6295\u5f71"==f?g.pixsBuffer[u]=k:"\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71"==f?g.pixsBuffer[u]=t:"\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71"==f&&(g.pixsBuffer[u]=r);u++})});g.setPixsBuffer(g.pixsBuffer);return g}e.Mpr={GenerateMipNomalPlane:function(a,b,c,f){if(void 0==f||6!=f.length)return a[b];var d=new DVDicomInfo;d.id=e.Plugin.GetRandom();d.SetInfo({data:a[b]});var g,h,k;c=parseInt(c/Math.abs(a[0].pixz-a[1].pixz));d.pixsBuffer=new Int16Array(d.row*d.col);for(var t=d.pixsBuffer.length,r=0;r<t;r++){g=-32768;h=32767;for(var v=k=0;v<c;v++)if(v<a.length-b){var u=a[v+b].pixsBuffer[r];k+=u/c;g<u&&(g=u);h>u&&(h=u)}"\u6700\u5927\u5bc6\u5ea6\u6295\u5f71"==f?d.pixsBuffer[r]=g:"\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71"==f?d.pixsBuffer[r]=h:"\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71"==f&&(d.pixsBuffer[r]=k)}d.setPixsBuffer(d.pixsBuffer);return d},GenerateNormalPlane:function(a,c,g,f){if(void 0!=f&&6==f.length)return b(a,c,g,f);var d=a[0].col;g=Math.abs(a[0].pixz-a[1].pixz);var h=new DVDicomInfo;h.SetInfo({data:a[0]});h.pixy=g;h.id=e.Plugin.GetRandom();h.row=a.length;h.col=c.length;h.pixsBuffer=new Int16Array(h.row*h.col);var k=0;$.each(a,function(a,b){$.each(c,function(){h.pixsBuffer[k]=b.pixsBuffer[d*this.y+this.x];k++})});h.setPixsBuffer(h.pixsBuffer);return h},GenerateSlopePlane:function(b,g,k,f){var d=new DVDicomInfo;d.SetInfo({data:b[0]});d.id=e.Plugin.GetRandom();var h=parseFloat(b[0].sliceth);d.pixx=(h-d.pixx)/90*(g.x===k.x&&g.y===k.y?0:g.x===k.x?90:g.y===k.y?0:Math.abs(180*Math.atan((k.y-g.y)/(k.x-g.x))/Math.PI))+d.pixx;g=c(g,k,!0);d.col=g.length;var m=0,n,t,r;if(90===f){d.row=b[0].row;d.pixsBuffer=new Int16Array(d.row*d.col);for(var v=0;v<d.row;v++)$.each(g,function(){t=parseInt(v*b[0].col+this.x);if(a(this.y))this.y=Math.max(0,Math.min(b.length-1,this.y)),n=b[this.y],r=n.pixsBuffer[t];else{var c=Math.floor(this.y),e;e=Math.max(0,Math.min(b.length-1,c+1));var c=Math.max(0,Math.min(b.length-1,c)),f=this.y-c;r=b[c].pixsBuffer[t]*(1-f)+b[e].pixsBuffer[t]*f;r=Math.round(r)}d.pixsBuffer[m]=r;m++})}else if(180===f)for(d.row=b[0].col,d.pixsBuffer=new Int16Array(d.row*d.col),v=0;v<d.row;v++)$.each(g,function(){t=b[0].col*parseInt(this.x)+v;if(a(this.y))this.y=Math.max(0,Math.min(b.length-1,this.y)),n=b[this.y],r=n.pixsBuffer[t];else{var c=Math.floor(this.y),e;e=Math.max(0,Math.min(b.length-1,c+1));var c=Math.max(0,Math.min(b.length-1,c)),f=this.y-c;r=b[c].pixsBuffer[t]*(1-f)+b[e].pixsBuffer[t]*f;r=Math.round(r)}d.pixsBuffer[m]=r;m++});else return;d.setPixsBuffer(d.pixsBuffer);return d},GenerateSurface:function(a,b){for(var d=[],f=0;f<b.length;f++){var g=b[f+1];if(void 0===g)break;g=c(b[f],g);$.each(g,function(){d.push(this)})}var h=new DVDicomInfo;h.SetInfo({data:a[0]});h.id=e.Plugin.GetRandom();h.pixy=parseFloat(a[0].sliceth);h.row=a.length;h.col=d.length;h.pixsBuffer=new Int16Array(h.row*h.col);var m=0;$.each(a,function(b,c){$.each(d,function(){h.pixsBuffer[m]=c.pixsBuffer[a[0].col*this.y+this.x];m++})});h.setPixsBuffer(h.pixsBuffer);return h},GetPointsFromLine:c}}(e);!function(a){a.Mip={GenerateMipPlane:function(b,d,c,e,f){var g=b[0].col,h=new DVDicomInfo;h.id=a.Plugin.GetRandom();h.SetInfo({data:b[0]});var k=1,n=0,t=0,r=0;if(0==c){k=parseInt(e/Math.abs(b[0].pixz-b[1].pixz));h.pixsBuffer=new Int16Array(h.row*h.col);e=h.pixsBuffer.length;for(var v=0;i<e;v++)for(var n=65535,t=-65535,r=0,u=d;u<k;u++)if(u<b.length){var q=b[u].pixsBuffer[v],r=r+q/k;n<q&&(n=q);t>q&&(t=q)}"Max"==f?h.pixsBuffer[w]=n:"Min"==f?h.pixsBuffer[w]=t:"Mean"==f&&(h.pixsBuffer[w]=r)}else{h.row=b.length;h.col=d.length;h.pixy=Math.abs(b[0].pixz-b[1].pixz);k=parseInt(e/h.pixx);h.pixsBuffer=new Int16Array(h.row*h.col);var w=0;$.each(b,function(a,b){$.each(d,function(){n=65535;t=-65535;for(var a=r=0;a<k;a++){if(2==c)var d=g*(this.y+a)+this.x;1==c&&(d=g*this.y+this.x+a);var e=b.pixsBuffer[d];r+=e;n<e&&(n=e);t>e&&(t=e)}r/=k;"Max"==f?h.pixsBuffer[w]=n:"Min"==f?h.pixsBuffer[w]=t:"Mean"==f&&(h.pixsBuffer[w]=r);w++})})}h.setPixsBuffer(h.pixsBuffer);return h}}}(e)}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(e){function c(a,b){var d=a.x-b.x;a=a.y-b.y;return d*d+a*a}function a(a,b){var d=c(a.start,a.end);if(0===d)return c(b,a.start);d=((b.x-a.start.x)*(a.end.x-a.start.x)+(b.y-a.start.y)*(a.end.y-a.start.y))/d;return 0>d?c(b,a.start):1<d?c(b,a.end):c(b,{x:a.start.x+d*(a.end.x-a.start.x),y:a.start.y+d*(a.end.y-a.start.y)})}function g(b,d){return Math.sqrt(a(b,d))}function b(a,b,d,c,e,f){b instanceof Array||(b=[b]);var g=E.getFont(),h=E.getFontSize(),k=E.getBackgroundColor();a.save();a.font=g;a.textBaseline="top";a.strokeStyle=e;var x=0;b.forEach(function(b){b=a.measureText(b).width;x=Math.max(x,b)});a.fillStyle=k;g={width:x+10,height:5+b.length*(h+5)};f&&f.centering&&!0===f.centering.x&&(d-=g.width/2);f&&f.centering&&!0===f.centering.y&&(c-=g.height/2);g.left=d;g.top=c;f&&!0===f.debug&&(a.fillStyle="#FF0000");a.fillRect(g.left,g.top,g.width,g.height);b.forEach(function(b,f){a.fillStyle=e;a.fillText(b,d+5,c+5+f*(h+5))});a.restore();return g}function d(a,b){return Math.sqrt(h(a,b))}function h(a,b){var d=a.x-b.x;a=a.y-b.y;return d*d+a*a}function k(a,b){for(var c=[],e,f=0;f<a.length;f++){var g=d(a[f],b);c.push(g);e=0===f?g:Math.min(g,e)}b=c.indexOf(e);return a[b]}function f(a,b){a.save();a.strokeStyle=E.GetHandleColor();if(b instanceof Array&&!(1>b.length)){for(var d=0;d<b.length;d++){a.beginPath();var c=b[d];a.fillStyle="#00FF00";a.arc(c.x,c.y,10,0,2*Math.PI);a.fill()}a.restore()}}function p(a,b,d){for(var c=[],f=0;f<d.length;f++){var g=e.ImageProcessor.PixelToCanvas(a,b,d[f]);c.push(g)}return c}function l(a,b){for(var c=0;c<b.length;c++)if(40>d(b[c],a))return c;return-1}function m(a,b){return a.x<b.left||a.x>b.left+b.width||a.y<b.top||a.y>b.top+b.height?!1:!0}function n(a,b,d){a=a.getBoundingClientRect();return{x:b-a.left-window.pageXOffset,y:d-a.top-window.pageYOffset}}function t(a){a=a.getContext("2d");a.lineWidth=E.getToolWidth();a.shadowColor=E.getshadowColor();a.shadowOffsetX=E.getshadowOffsetX();a.shadowOffsetY=E.getshadowOffsetY();a.shadowBlur=.5;a.setTransform(1,0,0,1,0,0);return a}function r(a,b,d,c,e){if(void 0===a)throw"GetStoredPixels: parameter image must not be undefined.";b=Math.round(b);d=Math.round(d);for(var f=[],g=0,h=a.pixsBuffer,k=0;k<e;k++)for(var x=0;x<c;x++){var l=(k+d)*a.col+(x+b);f[g++]=h[l]}return f}function v(a,b){var d=parseInt(a);isNaN(d)&&(d=1);var c=parseInt(b);isNaN(c)&&(c=0);return function(a){return a*d+c}}function u(a,b,d,c,e){b=r(a,b,d,c,e);return 1===a.rescsl&&0===a.rescin?b:b.map(v(a.rescsl,a.rescin))}function q(a,b){a instanceof Object&&1==arguments.length?(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)}function w(){this.type="probe";this.active=!1;this.handles={end:{x:0,y:0}}}function z(){this.type="line";this.active=!1;this.length=0;this.invalid=!0;this.index=-1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,text:"",boundingBox:{}}}function A(){this.type="rect";this.active=!1;this.index=-1;this.area=0;this.invalid=!0;this.isServer=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}};this.ellipse={left:0,top:0,width:0,height:0};this.meanStdDev={count:0,mean:0,variance:0,stdDev:0}}function y(){this.type="ellipse";this.active=!1;this.index=-1;this.invalid=!0;this.isServer=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}};this.ellipse={left:0,top:0,width:0,height:0};this.meanStdDev={count:0,mean:0,variance:0,stdDev:0}}function F(){this.type="arrow";this.active=!1;this.index=-1;this.handles={start:{x:0,y:0},end:{x:0,y:0}}}function G(){this.type="angle";this.active=!1;this.index=-1;this.angle=0;this.invalid=!0;this.createHitNums=0;this.handles={start:{x:0,y:0},center:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}}}function K(){this.type="text";this.text="";this.textBox={active:!1,x:0,y:0,boundingBox:{}};this.text=prompt("\u8bf7\u8f93\u5165\u6587\u672c:","")}function I(a){this.type=a;this.active=!1;this.handles={start:{x:0,y:0},end:{x:0,y:0}}}function H(){this.type="heartratio";this.active=!1;this.lineIndex=this.index=-1;this.ratio=0;this.invalid=!0;this.topline={start:{x:0,y:0},end:{x:0,y:0}};this.downline={start:{x:0,y:0},end:{x:0,y:0}};this.textBox={active:!1,hasMoved:!1,x:0,y:0,boundingBox:{}}}var E=new function(){var a="#ff8000",b="#dd0",d="transparent",c=15,e=c+"px Arial",f="transparent",g=1;this.setFillColor=function(a){d=a};this.getFillColor=function(){return d};this.setToolColor=function(b){a=b};this.getToolColor=function(){return a};this.setActiveToolColor=function(a){b=a};this.getActiveToolColor=function(){return b};this.getColorIfActive=function(d){return d?b:a};this.setToolWidth=function(a){g=a};this.getToolWidth=function(){return g};this.setFont=function(a){e=a};this.getFont=function(){return e};this.setFontSize=function(a){c=a};this.getFontSize=function(){return c};this.setBackgroundColor=function(a){f=a};this.getBackgroundColor=function(){return f};this.getshadowColor=function(){return"#000000"};this.getshadowOffsetX=function(){return 1};this.getshadowOffsetY=function(){return 1};this.GetHandleColor=function(){return"#ff0"}},B={recordAnn:void 0,SetRecordAnn:function(a){this.recordAnn=a},GetRecordAnn:function(){return this.recordAnn},newAnn:void 0,SetNewAnn:function(a){this.newAnn=a},GetNewAnn:function(){return this.newAnn},modifyAnn:void 0,SetModifyAnn:function(a){this.modifyAnn=a},GetModifyAnn:function(){return this.modifyAnn}};w.prototype.Draw=function(a,d,c){var g=E.getColorIfActive(this.active),h=e.ImageProcessor.PixelToCanvas(a,d,this.handles.end),h=[{x:h.x,y:h.y-4},{x:h.x-4,y:h.y},{x:h.x,y:h.y+4},{x:h.x+4,y:h.y}];c.beginPath();c.strokeStyle=g;c.moveTo(h[0].x,h[0].y);c.lineTo(h[2].x,h[2].y);c.moveTo(h[1].x,h[1].y);c.lineTo(h[3].x,h[3].y);c.stroke();this.active&&(h=[this.handles.end],h=p(a,d,h),f(c,h));c.fillStyle=g;var h=Math.round(this.handles.end.x),k=Math.round(this.handles.end.y),x,l;if(!(0>h||0>k||h>=a.image.col||k>=a.image.row)){if(!a.image.color){x=r(a.image,h,k,1,1);l=x[0];var C=parseInt(a.image.rescsl),m=parseInt(a.image.rescin);x="x : "+h+", y : "+k;l="sp: "+l+" mo: "+parseFloat((l*C+m).toFixed(3))}a=e.ImageProcessor.PixelToCanvas(a,d,{x:this.handles.end.x+3,y:this.handles.end.y-5});d=E.getFontSize();b(c,l,a.x,a.y+d+5,g);b(c,x,a.x,a.y,g)}};w.prototype.PointIsPointNear=function(a,b,d){var c=[this.handles.end],c=p(a,b,c);this.index=a=l(d,c);return-1!==a?!0:!1};w.prototype.Modify=function(a,b){this.handles.end.x+=a;this.handles.end.y+=b};z.prototype.Draw=function(a,d,c){var g=E.getColorIfActive(this.active||this.textBox.active),h=e.ImageProcessor.PixelToCanvas(a,d,this.handles.start),x=e.ImageProcessor.PixelToCanvas(a,d,this.handles.end);c.beginPath();c.strokeStyle=g;c.moveTo(h.x,h.y);c.lineTo(x.x,x.y);c.stroke();if(this.active){var l=this.GetHandlePoints(),l=p(a,d,l);f(c,l)}c.fillStyle=g;this.invalid&&this.Calculate(a);l=" mm";a.image.pixx&&a.image.pixy||(l=" pixels");l=""+this.length.toFixed(2)+l;if(!this.textBox.hasMoved){var C=Math.max(this.handles.start.x,this.handles.end.x),m;m=C===this.handles.start.x?this.handles.start.y:this.handles.end.y;this.textBox.x=C;this.textBox.y=m}a=e.ImageProcessor.PixelToCanvas(a,d,this.textBox);a.x+=10;d=b(c,l,a.x,a.y,g);this.textBox.boundingBox=d;this.textBox.hasMoved&&(C={},l=[h,x,{x:(h.x+x.x)/2,y:(h.y+x.y)/2}],C.x=a.x,C.y=a.y,h=k(l,C),C=k([{x:d.left+d.width/2,y:d.top},{x:d.left,y:d.top+d.height/2},{x:d.left+d.width/2,y:d.top+d.height},{x:d.left+d.width,y:d.top+d.height/2}],h),c.save(),c.beginPath(),c.strokeStyle=g,c.setLineDash([2,3]),c.moveTo(h.x,h.y),c.lineTo(C.x,C.y),c.stroke(),c.restore())};z.prototype.PointIsLineNear=function(a,b,d){a={start:e.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:e.ImageProcessor.PixelToCanvas(a,b,this.handles.end)};return 10>g(a,d)};z.prototype.PointIsPointNear=function(a,b,d){var c=this.GetHandlePoints(),c=p(a,b,c);this.index=a=l(d,c);return-1!==a?!0:!1};z.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.end);return a};z.prototype.PointIsInTextBox=function(a,b,d,c){a=n(b,d,c);return m(a,this.textBox.boundingBox)};z.prototype.Calculate=function(a){var b=(this.handles.end.x-this.handles.start.x)*(a.image.pixy||1);a=(this.handles.end.y-this.handles.start.y)*(a.image.pixx||1);this.length=Math.sqrt(b*b+a*a);this.invalid=!1};z.prototype.Modify=function(a,b){var d=!0;if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=b;break;case 1:this.handles.end.x+=a;this.handles.end.y+=b;break;default:this.handles.start.x+=a,this.handles.start.y+=b,this.handles.end.x+=a,this.handles.end.y+=b,d=!1}this.invalid=d}};A.prototype.Draw=function(a,d,c,g,h){g=E.getColorIfActive(this.active||this.textBox.active);var l=e.ImageProcessor.PixelToCanvas(a,d,this.handles.start),x=e.ImageProcessor.PixelToCanvas(a,d,this.handles.end);h=Math.abs(l.x-x.x);var m=Math.abs(l.y-x.y),C=Math.min(l.x,x.x),l=Math.min(l.y,x.y);c.beginPath();c.strokeStyle=g;c.rect(C,l,h,m);c.stroke();this.active&&(h=this.GetHandlePoints(),h=p(a,d,h),f(c,h));if(this.invalid){var n=Math.abs(this.handles.start.x-this.handles.end.x),D=Math.abs(this.handles.start.y-this.handles.end.y),m=Math.min(this.handles.start.x,this.handles.end.x),C=Math.min(this.handles.start.y,this.handles.end.y);this.ellipse=h={left:m,top:C,width:n,height:D};this.context=c;e.Draw.GetIsFromServer()||(m=u(a.image,m,C,n,D),this.Calculate(m,h),this.area=n*(a.image.pixx||1)*D*(a.image.pixy||1),this.invalid=!1)}e.Draw.GetIsFromServer()&&(this.area=n*(a.image.pixx||1)*D*(a.image.pixy||1));h=" mm\u00b2";a.image.pixx&&a.image.pixy||(h=" pixel\u00b2");D="Area: "+this.area.toFixed(2)+h;this.textBox.hasMoved||(n=this.GetHandlePoints(),a.hflip?(this.textBox.bRight=n[1].x>a.image.col>>1,this.textBox.x=this.textBox.bRight?n[0].x:n[2].x):(this.textBox.bRight=n[1].x<a.image.col>>1,this.textBox.x=this.textBox.bRight?n[2].x:n[0].x),this.textBox.y=a.vflip?n[4].y:n[0].y);n=e.ImageProcessor.PixelToCanvas(a,d,this.textBox);h=c.measureText(h);this.textBox.bRight?n.x+=8:(m=c.measureText(D),n.x=n.x-h.width-m.width-8);m="";"CT"===a.image.mod&&(m=" HU");c.fillStyle=g;h="Mean: "+this.meanStdDev.mean.toFixed(2)+m;m="StdDev: "+this.meanStdDev.stdDev.toFixed(2)+m;C=[];C.push(h);C.push(m);C.push(D);D=b(c,C,n.x,n.y,g);this.textBox.boundingBox=D;this.textBox.hasMoved&&(m={},h=this.GetHandlePoints(),h=p(a,d,h),m.x=n.x,m.y=n.y,a=k(h,m),m=k([{x:D.left+D.width/2,y:D.top},{x:D.left,y:D.top+D.height/2},{x:D.left+D.width/2,y:D.top+D.height},{x:D.left+D.width,y:D.top+D.height/2}],a),c.save(),c.beginPath(),c.strokeStyle=g,c.setLineDash([2,3]),c.moveTo(a.x,a.y),c.lineTo(m.x,m.y),c.stroke(),c.restore())};A.prototype.GetHandlePoints=function(){var a=[],b=Math.min(this.handles.start.x,this.handles.end.x),d=Math.min(this.handles.start.y,this.handles.end.y),c=Math.max(this.handles.start.x,this.handles.end.x),e=Math.max(this.handles.start.y,this.handles.end.y),f=this.handles.start.x+this.handles.end.x>>1,g=this.handles.start.y+this.handles.end.y>>1;a.push(new q(b,d));a.push(new q(f,d));a.push(new q(c,d));a.push(new q(c,g));a.push(new q(c,e));a.push(new q(f,e));a.push(new q(b,e));a.push(new q(b,g));return a};A.prototype.Calculate=function(a,b){for(var d=0,c=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)d+=a[f],c+=a[f]*a[f],e++,f++;0===e&&(this.meanStdDev={count:e,mean:0,variance:0,stdDev:0});a=d/e;c=c/e-a*a;this.meanStdDev={count:e,mean:a,variance:c,stdDev:Math.sqrt(c)}};A.prototype.PointIsLineNear=function(a,b,d){var c=this.GetHandlePoints(),f={start:e.ImageProcessor.PixelToCanvas(a,b,c[0]),end:e.ImageProcessor.PixelToCanvas(a,b,c[2])},f=g(f,d);if(20>f)return!0;f={start:e.ImageProcessor.PixelToCanvas(a,b,c[2]),end:e.ImageProcessor.PixelToCanvas(a,b,c[4])};f=g(f,d);if(20>f)return!0;f={start:e.ImageProcessor.PixelToCanvas(a,b,c[4]),end:e.ImageProcessor.PixelToCanvas(a,b,c[6])};f=g(f,d);if(20>f)return!0;f={start:e.ImageProcessor.PixelToCanvas(a,b,c[0]),end:e.ImageProcessor.PixelToCanvas(a,b,c[6])};f=g(f,d);return 20>f?!0:!1};A.prototype.PointIsPointNear=function(a,b,d){var c=this.GetHandlePoints(),c=p(a,b,c);this.index=a=l(d,c);return-1!==a?!0:!1};A.prototype.PointIsInTextBox=function(a,b,d,c){a=n(b,d,c);return m(a,this.textBox.boundingBox)};A.prototype.Modify=function(a,b){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{var d=this.handles.start.x,c=this.handles.start.y,e=this.handles.end.x,f=this.handles.end.y;switch(this.index){case 0:d+=a;c+=b;break;case 1:c+=b;break;case 2:e+=a;c+=b;break;case 3:e+=a;break;case 4:e+=a;f+=b;break;case 5:f+=b;break;case 6:d+=a;f+=b;break;case 7:d+=a;break;default:d+=a,c+=b,e+=a,f+=b}this.handles.start.x=d;this.handles.start.y=c;this.handles.end.x=e;this.handles.end.y=f;this.invalid=!0}};A.prototype.ServerModify=function(a,b){this.textBox.active&&(this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b)};A.prototype.CorrectPoint=function(){var a=Math.min(this.handles.start.y,this.handles.end.y),b=Math.max(this.handles.start.x,this.handles.end.x),d=Math.max(this.handles.start.y,this.handles.end.y);this.handles.start.x=Math.min(this.handles.start.x,this.handles.end.x);this.handles.start.y=a;this.handles.end.x=b;this.handles.end.y=d};y.prototype.Draw=function(a,d,c){var g=E.getColorIfActive(this.active||this.textBox.active),h=e.ImageProcessor.PixelToCanvas(a,d,this.handles.start),l=e.ImageProcessor.PixelToCanvas(a,d,this.handles.end),x=Math.min(h.x,l.x),m=Math.min(h.y,l.y),n=Math.abs(h.x-l.x),h=Math.abs(h.y-l.y);c.beginPath();c.strokeStyle=g;this.DrawEllipse(c,x,m,n,h);c.closePath();this.active&&(h=this.GetHandlePoints(),h=p(a,d,h),f(c,h));this.invalid&&(m=Math.abs(this.handles.start.x-this.handles.end.x),n=Math.abs(this.handles.start.y-this.handles.end.y),h=Math.min(this.handles.start.x,this.handles.end.x),l=Math.min(this.handles.start.y,this.handles.end.y),this.ellipse=x={left:h,top:l,width:m,height:n},this.context=c,e.Draw.GetIsFromServer()||(m=u(a.image,h,l,m,n),this.Calculate(m,x),this.invalid=!1),this.area=x.width*(a.image.pixx||1)/2*Math.PI*(x.height*(a.image.pixy||1)/2));n="";"CT"===a.image.mod&&(n=" HU");h=" mm\u00b2";a.image.pixx&&a.image.pixy||(h=" pixel\u00b2");m="Area: "+this.area.toFixed(2)+h;this.textBox.hasMoved||(x=this.GetHandlePoints(),a.hflip?(this.textBox.bRight=x[0].x>a.image.col>>1,this.textBox.x=this.textBox.bRight?x[3].x:x[1].x):(this.textBox.bRight=x[0].x<a.image.col>>1,this.textBox.x=this.textBox.bRight?x[1].x:x[3].x),this.textBox.y=a.vflip?x[2].y:x[0].y);x=e.ImageProcessor.PixelToCanvas(a,d,this.textBox);h=c.measureText(h);this.textBox.bRight?x.x+=8:(l=c.measureText(m),x.x=x.x-h.width-l.width-5);c.fillStyle=g;h="Mean: "+this.meanStdDev.mean.toFixed(2)+n;n="StdDev: "+this.meanStdDev.stdDev.toFixed(2)+n;l=[];l.push(h);l.push(n);l.push(m);m=b(c,l,x.x,x.y,g);this.textBox.boundingBox=m;this.textBox.hasMoved&&(n={},h=this.GetHandlePoints(),h=p(a,d,h),n.x=x.x,n.y=x.y,a=k(h,n),n=k([{x:m.left+m.width/2,y:m.top},{x:m.left,y:m.top+m.height/2},{x:m.left+m.width/2,y:m.top+m.height},{x:m.left+m.width,y:m.top+m.height/2}],a),c.save(),c.beginPath(),c.strokeStyle=g,c.setLineDash([2,3]),c.moveTo(a.x,a.y),c.lineTo(n.x,n.y),c.stroke(),c.restore())};y.prototype.DrawEllipse=function(a,b,d,c,e){var f=c/2*.5522848,g=e/2*.5522848,h=b+c,k=d+e;c=b+c/2;e=d+e/2;a.beginPath();a.moveTo(b,e);a.bezierCurveTo(b,e-g,c-f,d,c,d);a.bezierCurveTo(c+f,d,h,e-g,h,e);a.bezierCurveTo(h,e+g,c+f,k,c,k);a.bezierCurveTo(c-f,k,b,e+g,b,e);a.closePath();a.stroke()};y.prototype.GetHandlePoints=function(){var a=[],b=Math.min(this.handles.start.x,this.handles.end.x),d=Math.max(this.handles.start.x,this.handles.end.x),c=Math.max(this.handles.start.y,this.handles.end.y),e=this.handles.start.x+this.handles.end.x>>1,f=this.handles.start.y+this.handles.end.y>>1;a.push(new q(e,Math.min(this.handles.start.y,this.handles.end.y)));a.push(new q(d,f));a.push(new q(e,c));a.push(new q(b,f));return a};y.prototype.PointInEllipse=function(a,b){var d=a.width/2,c=a.height/2;if(0>=d||0>=c)return!1;var e=b.x-(a.left+d);a=b.y-(a.top+c);return 1>=e*e/(d*d)+a*a/(c*c)};y.prototype.Calculate=function(a,b){for(var d=0,c=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)!0===this.PointInEllipse(b,{x:h,y:g})&&(d+=a[f],c+=a[f]*a[f],e++),f++;0===e&&(this.meanStdDev={count:e,mean:0,variance:0,stdDev:0});a=d/e;c=c/e-a*a;this.meanStdDev={count:e,mean:a,variance:c,stdDev:Math.sqrt(c)}};y.prototype.PointIsLineNear=function(a,b,d){var c=e.ImageProcessor.PixelToCanvas(a,b,this.handles.start);b=e.ImageProcessor.PixelToCanvas(a,b,this.handles.end);a={left:Math.min(c.x,b.x)-7.5,top:Math.min(c.y,b.y)-7.5,width:Math.abs(c.x-b.x)+15,height:Math.abs(c.y-b.y)+15};c=this.PointInEllipse({left:Math.min(c.x,b.x)+7.5,top:Math.min(c.y,b.y)+7.5,width:Math.abs(c.x-b.x)-15,height:Math.abs(c.y-b.y)-15},d);return this.PointInEllipse(a,d)&&!c?!0:!1};y.prototype.PointIsPointNear=function(a,b,d){var c=this.GetHandlePoints(),c=p(a,b,c);this.index=a=l(d,c);return-1!==a?!0:!1};y.prototype.PointIsInTextBox=function(a,b,d,c){a=n(b,d,c);return m(a,this.textBox.boundingBox)};y.prototype.Modify=function(a,b){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{var d=this.handles.start.x,c=this.handles.start.y,e=this.handles.end.x,f=this.handles.end.y;switch(this.index){case 0:c+=b;break;case 1:e+=a;break;case 2:f+=b;break;case 3:d+=a;break;default:d+=a,c+=b,e+=a,f+=b}this.handles.start.x=d;this.handles.start.y=c;this.handles.end.x=e;this.handles.end.y=f;this.invalid=!0}};y.prototype.CorrectPoint=function(){var a=Math.min(this.handles.start.y,this.handles.end.y),b=Math.max(this.handles.start.x,this.handles.end.x),d=Math.max(this.handles.start.y,this.handles.end.y);this.handles.start.x=Math.min(this.handles.start.x,this.handles.end.x);this.handles.start.y=a;this.handles.end.x=b;this.handles.end.y=d};F.prototype.Draw=function(a,b,d){var c=E.getColorIfActive(this.active),g=e.ImageProcessor.PixelToCanvas(a,b,this.handles.start),h=e.ImageProcessor.PixelToCanvas(a,b,this.handles.end);d.strokeStyle=c;d.fillStyle=c;this.DrawArrow(d,g,h);this.active&&(c=this.GetHandlePoints(),c=p(a,b,c),f(d,c))};F.prototype.DrawArrow=function(a,b,d){b=[b.x,b.y];d=[d.x,d.y];a.beginPath();a.translate(0,0);a.moveTo(b[0],b[1]);a.lineTo(d[0],d[1]);a.fill();a.stroke();a.save();a.translate(d[0],d[1]);var c=(d[0]-b[0])/(d[1]-b[1]),c=Math.atan(c);0<=d[1]-b[1]?a.rotate(-c):a.rotate(Math.PI-c);a.lineTo(-5,-10);a.lineTo(0,-5);a.lineTo(5,-10);a.lineTo(0,0);a.fill();a.restore();a.closePath()};F.prototype.PointIsLineNear=function(a,b,d){a={start:e.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:e.ImageProcessor.PixelToCanvas(a,b,this.handles.end)};return 10>g(a,d)};F.prototype.PointIsPointNear=function(a,b,d){var c=this.GetHandlePoints(),c=p(a,b,c);this.index=a=l(d,c);return-1!==a?!0:!1};F.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.end);return a};F.prototype.Modify=function(a,b){switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=b;break;case 1:this.handles.end.x+=a;this.handles.end.y+=b;break;default:this.handles.start.x+=a,this.handles.start.y+=b,this.handles.end.x+=a,this.handles.end.y+=b}};G.prototype.Draw=function(a,d,c){var g=E.getColorIfActive(this.active||this.textBox.active),h={start:e.ImageProcessor.PixelToCanvas(a,d,this.handles.start),center:e.ImageProcessor.PixelToCanvas(a,d,this.handles.center),end:e.ImageProcessor.PixelToCanvas(a,d,this.handles.end)};c.strokeStyle=g;c.fillStyle=g;if(0!==this.handles.center.x&&0!==this.handles.center.y&&0===this.handles.end.x&&0===this.handles.end.y)c.beginPath(),c.moveTo(h.start.x,h.start.y),c.lineTo(h.center.x,h.center.y),c.stroke();else{this.DrawAngle(c,h);if(this.active){var l=this.GetHandlePoints(),l=p(a,d,l);f(c,l)}if(!this.textBox.hasMoved){var h=this.GetHandlePoints(),m=Math.min(h[0].x,h[1].x,h[2].x),n=Math.max(h[0].x,h[1].x,h[2].x),l=m+(n-m>>1);a.hflip?(this.textBox.bRight=l>a.image.col>>1,this.textBox.x=this.textBox.bRight?m:n):(this.textBox.bRight=l<a.image.col>>1,this.textBox.x=this.textBox.bRight?n:m);var x=this;h.forEach(function(a){a.x===x.textBox.x&&(x.textBox.y=a.y)})}h=e.ImageProcessor.PixelToCanvas(a,d,this.textBox);m=this.angle.toFixed(2)+" \u00b0";this.textBox.bRight?h.x+=8:(n=c.measureText(m),h.x-=n.width);m=b(c,m,h.x,h.y,g);this.textBox.boundingBox=m;this.textBox.hasMoved&&(l={},n={},l=this.GetHandlePoints(),l=p(a,d,l),n.x=h.x,n.y=h.y,l=k(l,n),n=k([{x:m.left+m.width/2,y:m.top},{x:m.left,y:m.top+m.height/2},{x:m.left+m.width/2,y:m.top+m.height},{x:m.left+m.width,y:m.top+m.height/2}],l),c.save(),c.beginPath(),c.strokeStyle=g,c.setLineDash([2,3]),c.moveTo(l.x,l.y),c.lineTo(n.x,n.y),c.stroke(),c.restore())}};G.prototype.DrawAngle=function(a,b){var c=b.start.x,e=b.start.y,f=b.center.x,g=b.center.y,h=b.end.x,k=b.end.y;a.save();a.translate(.5,.5);a.beginPath();a.moveTo(c,e);a.lineTo(f,g);a.moveTo(c,e);a.lineTo(h,k);var l=b.start,k=b.center,p=b.end,h=k.x-l.x,k=k.y-l.y,m=p.x-l.x,l=p.y-l.y,p=Math.sqrt(Math.pow(h,2)+Math.pow(k,2)),n=Math.sqrt(Math.pow(m,2)+Math.pow(l,2)),h=0<h/p*(l/n)-m/n*(k/p)?!0:!1,k=this.angle;this.invalid&&(p=b.start,m=b.center,l=b.end,k=d(p,m),p=d(p,l),m=d(m,l),0==k||0==p?k=0:(k=(k*k-m*m+p*p)/(2*k*p),-1>k?k=-1:1<k&&(k=1),k=57.29578*Math.acos(k)),this.angle=k,this.invalid=!1);k*=.0174532;f=(g-e)/(f-c);0>=g-e?0>=f?(f=Math.abs(f),g=2*Math.PI-Math.atan(f)):g=Math.PI+Math.atan(f):0>f?(f=Math.abs(f),g=Math.PI-Math.atan(f)):g=Math.atan(f);f=d(b.start,b.center);b=d(b.start,b.end);b=Math.min(f,b)/6;30<b&&(b=30);a.moveTo(c,e);h?a.arc(c,e,b,g,g+k,!1):a.arc(c,e,b,g,g-k,!0);a.stroke();a.restore()};G.prototype.GetHandlePoints=function(){var a=[];a.push(this.handles.start);a.push(this.handles.center);a.push(this.handles.end);return a};G.prototype.PointIsLineNear=function(a,b,d){var c={start:e.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:e.ImageProcessor.PixelToCanvas(a,b,this.handles.center)},c=g(c,d);if(10>c)return!0;c={start:e.ImageProcessor.PixelToCanvas(a,b,this.handles.start),end:e.ImageProcessor.PixelToCanvas(a,b,this.handles.end)};c=g(c,d);return 10>c?!0:!1};G.prototype.PointIsPointNear=function(a,b,d){var c=this.GetHandlePoints(),c=p(a,b,c);this.index=a=l(d,c);return-1!==a?!0:!1};G.prototype.PointIsInTextBox=function(a,b,d,c){a=n(b,d,c);return m(a,this.textBox.boundingBox)};G.prototype.Modify=function(a,b){var d=!0;if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{switch(this.index){case 0:this.handles.start.x+=a;this.handles.start.y+=b;break;case 1:this.handles.center.x+=a;this.handles.center.y+=b;break;case 2:this.handles.end.x+=a;this.handles.end.y+=b;break;default:this.handles.start.x+=a,this.handles.start.y+=b,this.handles.center.x+=a,this.handles.center.y+=b,this.handles.end.x+=a,this.handles.end.y+=b,d=!1}this.invalid=d}};K.prototype.Draw=function(a,d,c){var f=E.getColorIfActive(this.textBox.active);c.fillStyle=f;a=e.ImageProcessor.PixelToCanvas(a,d,this.textBox);c=b(c,this.text,a.x,a.y,f);this.textBox.boundingBox=c};K.prototype.PointIsInTextBox=function(a,b,d,c){a=n(b,d,c);return m(a,this.textBox.boundingBox)};K.prototype.Modify=function(a,b){this.textBox.active&&(this.textBox.x+=a,this.textBox.y+=b)};I.prototype.Draw=function(a,b,c){var f=E.getColorIfActive(this.active);c.fillStyle=f;c.strokeStyle=f;var f=e.ImageProcessor.PixelToCanvas(a,b,this.handles.start),g=e.ImageProcessor.PixelToCanvas(a,b,this.handles.end);a=f.x+g.x>>1;b=f.y+g.y>>1;f=d(f,g)>>1;this.DrawLR(c,{x:a,y:b},f,this.type)};I.prototype.DrawLR=function(a,b,c,d){a.beginPath();a.arc(b.x,b.y,c,0,2*Math.PI);a.stroke();a.save();a.font=c+"px lighter";c=a.measureText("L").width>>1;"l"===d?a.fillText("L",b.x-c,b.y+c):a.fillText("R",b.x-c,b.y+c);a.restore()};I.prototype.PointIsLineNear=function(a,b,c){var f=e.ImageProcessor.PixelToCanvas(a,b,this.handles.start);a=e.ImageProcessor.PixelToCanvas(a,b,this.handles.end);b=d(f,a)>>1;return d(c,{x:f.x+a.x>>1,y:f.y+a.y>>1})<=b};I.prototype.Modify=function(a,b){this.handles.start.x+=a;this.handles.start.y+=b;this.handles.end.x+=a;this.handles.end.y+=b};H.prototype.Draw=function(a,c,g){var h=E.getColorIfActive(this.active||this.textBox.active),l=e.ImageProcessor.PixelToCanvas(a,c,this.topline.start),m=e.ImageProcessor.PixelToCanvas(a,c,this.topline.end),n=e.ImageProcessor.PixelToCanvas(a,c,this.downline.start),r=e.ImageProcessor.PixelToCanvas(a,c,this.downline.end),A=l.x+m.x>>1,H=l.y+m.y>>1,x=n.x+r.x>>1,q=n.y+r.y>>1;g.beginPath();g.strokeStyle=h;g.moveTo(l.x,l.y);g.lineTo(m.x,m.y);g.stroke();g.beginPath();g.save();g.setLineDash([2,3]);g.moveTo(A,H);g.lineTo(x,q);g.stroke();g.restore();g.beginPath();g.moveTo(n.x,n.y);g.lineTo(r.x,r.y);g.stroke();this.active&&(r=this.GetHandlePoints(),r=p(a,c,r),f(g,r));this.invalid&&(l=d(this.topline.start,this.topline.end),m=d(this.downline.start,this.downline.end),this.ratio=l/m,this.invalid=!1);l="ratio: "+this.ratio.toFixed(2);this.textBox.hasMoved||(m=Math.min(this.topline.start.x,this.topline.end.x,this.downline.start.x,this.downline.end.x),n=Math.max(this.topline.start.x,this.topline.end.x,this.downline.start.x,this.downline.end.x),r=Math.min(this.topline.start.y,this.topline.end.y,this.downline.start.y,this.downline.end.y),A=Math.max(this.topline.start.y,this.topline.end.y,this.downline.start.y,this.downline.end.y),H=m+n>>1,a.hflip?(this.textBox.bRight=H>a.image.col>>1,this.textBox.x=this.textBox.bRight?m:n):(this.textBox.bRight=m<a.image.col>>1,this.textBox.x=this.textBox.bRight?n:m),this.textBox.y=a.vflip?A:r);m=e.ImageProcessor.PixelToCanvas(a,c,this.textBox);this.textBox.bRight?m.x+=8:(n=g.measureText(l),m.x=m.x-n.width-8);g.fillStyle=h;l=b(g,l,m.x,m.y,h);this.textBox.boundingBox=l;this.textBox.hasMoved&&(n={},r=this.GetHandlePoints(),r=p(a,c,r),n.x=m.x,n.y=m.y,a=k(r,n),n=k([{x:l.left+l.width/2,y:l.top},{x:l.left,y:l.top+l.height/2},{x:l.left+l.width/2,y:l.top+l.height},{x:l.left+l.width,y:l.top+l.height/2}],a),g.save(),g.beginPath(),g.strokeStyle=h,g.setLineDash([2,3]),g.moveTo(a.x,a.y),g.lineTo(n.x,n.y),g.stroke(),g.restore())};H.prototype.GetHandlePoints=function(){var a=[];a.push(this.topline.start);a.push(this.topline.end);a.push(this.downline.end);a.push(this.downline.start);return a};H.prototype.PointIsLineNear=function(a,b,c){var d={start:e.ImageProcessor.PixelToCanvas(a,b,this.topline.start),end:e.ImageProcessor.PixelToCanvas(a,b,this.topline.end)},d=g(d,c);if(10>d)return this.lineIndex=0,!0;d={start:e.ImageProcessor.PixelToCanvas(a,b,this.downline.start),end:e.ImageProcessor.PixelToCanvas(a,b,this.downline.end)};d=g(d,c);return 10>d?(this.lineIndex=1,!0):!1};H.prototype.PointIsPointNear=function(a,b,c){var d=this.GetHandlePoints(),d=p(a,b,d);this.index=a=l(c,d);return-1!==a?!0:!1};H.prototype.PointIsInTextBox=function(a,b,c,d){a=n(b,c,d);return m(a,this.textBox.boundingBox)};H.prototype.Modify=function(a,b){if(this.textBox.active)this.textBox.hasMoved=!0,this.textBox.x+=a,this.textBox.y+=b;else{switch(this.index){case 0:this.topline.start.x+=a;this.topline.start.y+=b;break;case 1:this.topline.end.x+=a;this.topline.end.y+=b;break;case 2:this.downline.end.x+=a;this.downline.end.y+=b;break;case 3:this.downline.start.x+=a;this.downline.start.y+=b;break;default:0===this.lineIndex?(this.topline.start.x+=a,this.topline.start.y+=b,this.topline.end.x+=a,this.topline.end.y+=b):1===this.lineIndex&&(this.downline.end.x+=a,this.downline.end.y+=b,this.downline.start.x+=a,this.downline.start.y+=b)}this.invalid=!0}};e.Annotation={NewAIAnnotation:function(a,b,c,d,e){var f;switch(c){case "probe":f=new w;f.handles.end=pt;c=t(b);f.Draw(a,b,c);break;case "line":f=new z;f.handles.start=pt;break;case "rect":return f=new A,f.handles.start=d,f.handles.end=e,f.id=a.image.id,f.invalid=!0,f;case "ellipse":f=new y;f.handles.start=pt;f.id=a.image.id;break;case "arrow":f=new F;f.handles.start=pt;break;case "angle":f=B.GetNewAnn();void 0===f?(f=new G,f.handles.start=pt,f.createHitNums++):1===f.createHitNums?(f.handles.center=pt,f.createHitNums++):2===f.createHitNums&&(f.handles.end=pt,f.createHitNums=0);break;case "text":f=new K;f.textBox.x=pt.x;f.textBox.y=pt.y;if(""!==f.text&&null!==f.text)return c=t(b),f.Draw(a,b,c),f;break;case "l":case "r":f=new I(c);f.handles.start=pt;break;case "heartratio":f=new H(c),f.topline.start=pt}B.SetNewAnn(f)},NewAnnotation:function(a,b,c,d,f){var g;d=e.ImageProcessor.PageToPixel(a,b,d,f);switch(c){case "probe":g=new w;g.handles.end=d;c=t(b);g.Draw(a,b,c);break;case "line":g=new z;g.handles.start=d;break;case "rect":g=new A;g.handles.start=d;g.id=a.image.id;break;case "ellipse":g=new y;g.handles.start=d;g.id=a.image.id;break;case "arrow":g=new F;g.handles.start=d;break;case "angle":g=B.GetNewAnn();void 0===g?(g=new G,g.handles.start=d,g.createHitNums++):1===g.createHitNums?(g.handles.center=d,g.createHitNums++):2===g.createHitNums&&(g.handles.end=d,g.createHitNums=0);break;case "text":g=new K;g.textBox.x=d.x;g.textBox.y=d.y;if(""!==g.text&&null!==g.text)return c=t(b),g.Draw(a,b,c),g;break;case "l":case "r":g=new I(c);g.handles.start=d;break;case "heartratio":g=new H(c),g.topline.start=d}B.SetNewAnn(g)},UnfinishedAnn:function(a,b,c,d,f,g){var h=B.GetNewAnn();if(void 0===h)return!1;e.ImageProcessor.DrawGrayImage(a,b);c=e.Annotation.DrawAnnotation(a,b,c);f=e.ImageProcessor.PageToPixel(a,b,f,g);switch(d){case "heartratio":h.topline.end.x=f.x;h.topline.end.y=h.topline.start.y;h.downline.start.x=h.topline.start.x;h.downline.start.y=f.y;h.downline.end=f;h.invalid=!0;h.Draw(a,b,c);break;case "r":case "l":case "arrow":case "ellipse":case "probe":case "rect":case "line":h.handles.end=f;h.invalid=!0;h.Draw(a,b,c);break;case "angle":1===h.createHitNums?h.handles.center=f:2===h.createHitNums&&(h.handles.end=f),h.invalid=!0,h.Draw(a,b,c)}return!0},GetMaybeSaveAnn:function(a,b,c){b=B.GetNewAnn();if(void 0!==b)switch(a){case "probe":return B.SetNewAnn(),b;case "line":B.SetNewAnn();if(1<b.length)return b;break;case "ellipse":case "rect":B.SetNewAnn();if(1<b.area)return b.CorrectPoint&&b.CorrectPoint(),b;break;case "l":case "r":case "arrow":B.SetNewAnn();if(2<d(b.handles.start,b.handles.end)&&(0!==b.handles.end.x||0!==b.handles.end.y))return b;break;case "angle":if(0!==b.handles.end.x||0!==b.handles.end.y)if(B.SetNewAnn(),1<b.angle)return b;break;case "heartratio":if(B.SetNewAnn(),0!==b.topline.start.x&&0!==b.topline.start.y&&0!==b.downline.start.x&&0!==b.downline.start.y)return b}},DrawAnnotation:function(a,b,c){for(var d=t(b),e=0;e<c.length;e++)c[e].Draw(a,b,d);return d},ScanHoverAnnotation:function(a,b,c,d,f){if(c instanceof Array&&!(1>c.length)){d=n(b,d,f);var g;f=!1;for(var h=0;h<c.length;h++){var k=c[h];k.PointIsPointNear&&(k.PointIsPointNear(a,b,d)&&void 0===g?(g=k,f=k.active=!0):k.active=!1);k.textBox&&(k.textBox.active=!1)}if(void 0===g)for(h=0;h<c.length;h++)k=c[h],k.PointIsLineNear&&(k.PointIsLineNear(a,b,d)&&void 0===g?(k.active=!0,g=k):k.active=!1);f?b.style.cursor="pointer":"default"!==b.style.cursor&&(b.style.cursor="default");d=B.GetRecordAnn();g!==d&&(e.ImageProcessor.DrawGrayImage(a,b),this.DrawAnnotation(a,b,c),B.SetRecordAnn(g))}},ScanClickTextBox:function(a,b,c,d,f){if(c instanceof Array&&!(1>c.length)){for(var g,h=0;h<c.length;h++){var k=c[h];k.PointIsInTextBox&&(k.PointIsInTextBox(a,b,d,f)&&void 0===g?(k.textBox.active=!0,g=k):k.textBox.active=!1)}d=B.GetRecordAnn();if(g!==d)return e.Draw.DrawImage(a,b),b.getContext("2d"),this.DrawAnnotation(a,b,c),B.SetRecordAnn(g),g}},ActiveAnnotation:function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.active||c.textBox&&c.textBox.active)return B.SetModifyAnn(c),!0}return!1},MaybeModifyActiveAnn:function(a,b,c,d,f,g,h){var k=B.GetModifyAnn();if(void 0===k)return!1;e.Draw.DrawImage(a,b);d=e.ImageProcessor.PageToPixel(a,b,d,f);h=e.ImageProcessor.PageToPixel(a,b,g,h);g=h.x-d.x;h=h.y-d.y;k.Modify&&k.Modify(g,h);this.DrawAnnotation(a,b,c);return!0},MaybeServerModifyActiveAnn:function(a,b,c,d,f,g,h){var k=B.GetModifyAnn();if(void 0===k)return!1;e.Draw.DrawImage(a,b);d=e.ImageProcessor.PageToPixel(a,b,d,f);h=e.ImageProcessor.PageToPixel(a,b,g,h);g=h.x-d.x;h=h.y-d.y;k.ServerModify&&k.ServerModify(g,h);this.DrawAnnotation(a,b,c);return!0},MaybeEndModifyAnn:function(){var a=B.GetModifyAnn();void 0!==a&&a.CorrectPoint&&a.CorrectPoint();B.SetModifyAnn()},Distance:d,PageCoods2Canvas:n,ServerGetMaybeSaveAnn:function(a,b,c,f){var g=$.Deferred();if(void 0===f)return g;switch(a){case "probe":return B.SetNewAnn(),f;case "line":B.SetNewAnn();if(1<f.length)return f;break;case "ellipse":B.SetNewAnn();a=e.Draw.GetWadoUrl()+"/GetMeasureData";$.ajax({url:a,type:"get",data:{id:f.id,type:"ellipse",left:f.ellipse.left,top:f.ellipse.top,width:f.ellipse.width,height:f.ellipse.height},dataType:"json",complete:function(a){return 200==a.status&&a.responseJSON?(a=a.responseJSON.data,f.meanStdDev={count:a.count,mean:a.mean,variance:a.stdDev,stdDev:a.variance},g.resolve(f)):g.reject()}});break;case "rect":B.SetNewAnn();a=e.Draw.GetWadoUrl()+"/GetMeasureData";$.ajax({url:a,type:"get",data:{id:f.id,type:"Rect",left:f.ellipse.left,top:f.ellipse.top,width:f.ellipse.width,height:f.ellipse.height},complete:function(a){return 200==a.status&&a.responseJSON?(a=a.responseJSON.data,f.meanStdDev={count:a.count,mean:a.mean,variance:a.stdDev,stdDev:a.variance},g.resolve(f)):g.reject()}});break;case "l":case "r":case "arrow":B.SetNewAnn();if(2<d(f.handles.start,f.handles.end)&&(0!==f.handles.end.x||0!==f.handles.end.y))return f;break;case "angle":if(0===f.handles.end.x&&0===f.handles.end.y)return;B.SetNewAnn();if(1<f.angle)return f;break;case "heartratio":if(B.SetNewAnn(),0!==f.topline.start.x&&0!==f.topline.start.y&&0!==f.downline.start.x&&0!==f.downline.start.y)return f}return g},ServerHoverAnnotation:function(a,b,c,d,e){if(c instanceof Array&&!(1>c.length)){d=n(b,d,e);var f;for(e=0;e<c.length;e++){var g=c[e];if(g.PointIsPointNear&&g.PointIsPointNear(a,b,d)&&void 0===f)return f=g}if(void 0===f)for(e=0;e<c.length;e++)if(g=c[e],g.PointIsLineNear&&g.PointIsLineNear(a,b,d)&&void 0===f)return f=g}}}}(CBoBo);"undefined"===typeof CBoBo&&(CBoBo={});!function(e){function c(a,c,h,k){var b=[];a instanceof Array?b=a:b.push(a);a={images:b,viewport:e.ImageProcessor.GetDefaultStatus(),anns:{},compare:!1,studyuid:c,type:h};a.viewport.image=b[0];k||g.push(a);return a}function a(a){if(a instanceof Function)for(var b=0;b<g.length;b++)a(g[b],b)}var g=[];e.AnnStatusManager={Create:c,Get:function(a){if(void 0===a)return g;if(a instanceof Number)return g[a]},Set:function(b){if(b instanceof Object){2>b.status.ww&&(b.status.ww=2);.01>b.status.scale&&(b.status.scale=.01);if(360===b.status.rotation||-360===b.status.rotation)b.status.rotation=0;a(function(a,c){a===b&&(g[c]=b)})}},Clear:function(){g=[]},Delete:function(b){var c=0;a(function(a,d){a===b&&(g.splice(d,1),c=d)});return c},Replace:function(b,d,e,k){var f;a(function(a,h){a===b&&(f=g[h]=c(d,e,k,!0))});void 0===f&&(f=c(d,e,k));return f},GetIndex:function(b){if(void 0!==b){var c;a(function(a,d){a===b&&(c=d)});return c}},IsExist:function(b){var c=!1;a(function(a){a.images.forEach(function(a){b.id==a.id&&(c=!0)})});return c}}}(CBoBo);function ImageStatus(){this.image;this.contrast=this.brightness=0;this.Negative=!1;this.scaledHeight=this.scaledWidth=0;this.ptMove={x:0,y:0};this.rotateState=0;this.pseudoColor=null;this.bDrawText=!0}ImageStatus.prototype.GetBrightness=function(){return this.brightness};ImageStatus.prototype.GetContrast=function(){return this.contrast};ImageStatus.prototype.SetBriCon=function(e,c){this.brightness=e;this.contrast=c};ImageStatus.prototype.SetImage=function(e){this.image=e};ImageStatus.prototype.GetImage=function(){return this.image};ImageStatus.prototype.GetImageSize=function(){if(void 0!=this.image){var e={};e.width=this.image.image.width;e.height=this.image.image.height;return e}};ImageStatus.prototype.ZoomImage=function(e,c){this.scaledWidth=e;this.scaledHeight=c};ImageStatus.prototype.Restore=function(){this.rotateState=this.contrast=this.brightness=0;this.ptMove={x:0,y:0};this.Negative=!1;this.pseudoColor=null;return this};ImageStatus.prototype.GetZoomRatio=function(){if(void 0!=this.image){var e=this.image.image.height;if(!(0>=e))return this.scaledHeight/e}};ImageStatus.prototype.GetMovePoint=function(){return this.ptMove};ImageStatus.prototype.MoveImage=function(e){this.ptMove.x=e.x>>0;this.ptMove.y=e.y>>0};ImageStatus.prototype.SetNegative=function(e){this.Negative=e};ImageStatus.prototype.GetNegative=function(){return this.Negative};ImageStatus.prototype.SetPseudoColor=function(e,c,a){this.pseudoColor=void 0==e||void 0==c||void 0==a?void 0:{red:e,green:c,blue:a}};ImageStatus.prototype.GetPseudoColor=function(){return this.pseudoColor};ImageStatus.prototype.FitCanvas=function(e){if(void 0==this.image||!this.image.bLoaded||void 0==e)return this;var c=e.GetCanvas();e=this.GetImageSize();if(void 0!=e)return c=Math.min(c.width/e.width,c.height/e.height),this.ZoomImage(c*e.width>>0,c*e.height>>0),this};ImageStatus.prototype.DrawImg=function(e){void 0!=e&&(void 0!=this.image?this.image.bLoaded?(e.bStop||e.StopLoadingAnimation(),e.drawlock&&(e.drawlock=!1,e.imgProcessWorker.postMessage({type:2,brightness:this.brightness,contrast:this.contrast,pseudocolor:this.pseudoColor,nagative:this.Negative}))):e.StartLoadingAnimation():e.canvas.getContext("2d").clearRect(0,0,e.canvas.width,e.canvas.height))};ImageStatus.prototype.DrawText=function(e){if(this.bDrawText){var c=e.GetCanvas(),a=c.width<c.height?c.width:c.height,a=a/55>>0;10>a&&(a=10);e=c.getContext("2d");e.fillStyle="#fff";e.textBaseline="middle";e.textAlign="right";e.font=a+"px lighter";e.shadowColor="#000";e.shadowOffsetX=1;e.shadowOffsetY=1;a=e.measureText("\u5b57").width;c=CBoBo.Plugin.SetDrawTextCoord(c.width,c.height,0,0,3,0,a);index=0;e.fillText("\u5bf9\u6bd4\u5ea6:"+this.GetContrast(),c.rb[index].x,c.rb[index].y);index++;e.fillText(" \u4eae\u5ea6:"+this.GetBrightness(),c.rb[index].x,c.rb[index].y);index++;a=this.GetZoomRatio();void 0!=a&&e.fillText("\u653e\u7f29\u500d\u6570:"+a.toFixed(2),c.rb[index].x,c.rb[index].y)}};ImageStatus.prototype.SetDrawTextFlag=function(e){this.bDrawText=e};plain_blue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_red=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];plain_inverse_blue=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];plain_inverse_green=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];plain_inverse_red=[254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0];rainbow_blue=[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3];rainbow_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];blackbody_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255];blackbody_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];blackbody_red=[0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,156,159,162,165,168,171,174,177,180,183,186,189,192,195,198,201,204,207,210,213,216,219,222,225,228,231,234,237,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];bones_blue=[0,0,0,0,1,1,1,2,2,2,2,3,3,3,4,4,4,4,5,5,5,6,6,6,6,7,7,7,8,8,8,9,9,9,9,10,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,15,15,15,16,16,16,16,17,17,17,18,18,18,18,19,19,19,20,20,20,20,21,21,21,22,22,22,23,23,23,23,24,24,24,25,25,25,25,26,26,26,27,27,27,27,28,28,28,29,29,29,29,30,30,30,31,31,31,32,32,32,32,33,33,33,34,34,34,34,35,35,35,36,36,36,36,36,37,37,37,37,37,38,38,38,38,39,39,39,39,39,40,40,40,40,40,41,41,41,41,42,42,42,42,42,43,43,43,43,44,44,44,44,44,45,45,45,45,45,46,46,46,46,47,47,47,47,47,48,48,48,48,48,49,49,49,49,50,50,50,50,50,51,51,51,51,51,52,52,52,53,53,53,54,54,54,55,55,55,56,56,56,56,57,57,57,58,58,58,59,59,59,60,60,60,61,61,61,62,62,62,63,63,63,64,64,64,65,65,65,66,66,66,67,84,101,118,135,152,169,186,203,220,237];bones_green=[0,1,2,3,4,6,7,8,9,11,12,13,14,16,17,18,19,20,22,23,24,25,27,28,29,30,32,33,34,35,37,38,39,40,41,43,44,45,46,48,49,50,51,53,54,55,56,57,59,60,61,62,64,65,66,67,69,70,71,72,74,75,76,77,78,80,81,82,83,85,86,87,88,90,91,92,93,94,96,97,98,99,101,102,103,104,106,107,108,109,111,112,113,114,115,117,118,119,120,122,123,124,125,127,128,129,130,131,133,134,135,136,138,139,140,141,143,144,145,146,148,149,150,151,152,153,153,154,154,155,156,156,157,158,158,159,160,160,161,162,162,163,164,164,165,166,166,167,168,168,169,170,170,171,172,172,173,174,174,175,175,176,177,177,178,179,179,180,181,181,182,183,183,184,185,185,186,187,187,188,189,189,190,191,191,192,193,193,194,195,195,196,196,197,198,198,199,200,200,201,202,203,204,205,206,207,208,209,210,211,213,214,215,216,217,218,219,220,221,222,223,224,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,251,252,252,252,253,253,253,254,254];bones_red=[0,1,3,5,7,8,10,12,14,15,17,19,21,22,24,26,28,29,31,33,35,37,38,40,42,44,45,47,49,51,52,54,56,58,59,61,63,65,67,68,70,72,74,75,77,79,81,82,84,86,88,89,91,93,95,96,98,100,102,104,105,107,109,111,112,114,116,118,119,121,123,125,126,128,130,132,134,135,137,139,141,142,144,146,148,149,151,153,155,156,158,160,162,164,165,167,169,171,172,174,176,178,179,181,183,185,186,188,190,192,193,195,197,199,201,202,204,206,208,209,211,213,215,216,217,217,218,218,219,219,220,220,221,221,222,222,223,223,224,224,225,225,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,244,244,245,245,246,246,247,247,248,248,249,249,250,250,251,251,252,252,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];cardiac_blue=[3,12,20,29,37,46,54,63,71,80,88,97,105,114,122,131,139,146,154,161,168,175,183,190,197,204,212,219,226,233,241,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,252,250,249,247,246,244,243,241,239,238,236,235,233,232,230,229,227,226,224,223,221,220,218,217,215,214,212,211,209,208,206,203,201,198,196,193,191,188,186,183,180,178,175,173,170,168,165,163,161,159,157,155,153,151,149,146,144,142,140,138,136,134,132,127,123,118,113,109,104,99,95,90,85,80,76,71,66,62,57,53,50,46,43,39,36,32,29,25,21,18,14,11,7,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,3,4,5,5,6,7,8,8,9,10,11,11,12,11,11,10,10,9,9,8,8,7,6,6,5,5,4,3];cardiac_green=[193,195,197,198,200,202,204,206,208,209,211,213,215,217,218,220,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,216,211,205,200,194,188,183,177,171,166,160,155,149,143,138,132,128,125,121,118,114,110,107,103,99,96,92,89,85,81,78,74,70,67,63,60,56,52,49,45,41,38,34,31,27,23,20,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,17,19,21,23,25,27,29,31,33,37,41,45,50,54,58,62,66,70,74,78,83,87,91,95,99,103,107,111,116,120,124,128,132,136,140,144,149,153,157,161,165,170,174,179,184,188,193,197,202,207,211,216,221,225,230,234,239,238,237,236,235,234,233,232,231,229,228,227,226,225,224,223,222,220,218,217,215,213,211,209,208,206,204,202,200,198,197,193];cardiac_red=[73,72,70,69,68,66,65,63,62,61,59,58,57,55,54,52,51,48,45,41,38,35,32,29,26,22,19,16,13,10,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,21,22,22,23,24,25,25,26,27,28,28,29,30,31,31,32,36,39,43,47,50,54,57,61,65,68,72,76,79,83,86,90,95,99,104,109,113,118,123,128,132,137,142,146,151,156,160,165,169,172,176,179,183,186,190,194,197,201,204,208,211,215,218,222,224,226,228,230,232,234,236,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,236,231,226,221,216,211,206,201,197,192,187,182,177,171,164,158,151,145,138,132,125,119,112,106,99,93,86,73];flow_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,251,247,244,240,236,232,228,225,221,217,213,209,206,202,198,194,190,186,183,179,175,171,167,164,160,156,152,148,145,141,137,133,129,126,122,118,114,110,107,103,99,95,91,88,84,80,76,72,69,65,61,57,53,49,46,42,38,34,30,27,23,19,15,11,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255];flow_green=[200,197,194,191,188,185,182,179,176,173,170,167,164,161,158,155,152,149,146,143,140,137,134,131,128,125,122,119,116,113,110,107,104,101,98,95,92,89,86,83,80,77,74,71,68,65,62,59,56,53,50,47,44,41,38,35,32,29,26,23,20,20,20,19,19,19,19,18,18,18,17,17,17,16,16,16,16,15,15,15,14,14,14,13,13,13,13,12,12,12,11,11,11,10,10,10,10,9,9,9,8,8,8,7,7,7,7,6,6,6,5,5,5,4,4,4,4,3,3,3,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,10,14,18,22,26,30,34,38,42,46,50,54,58,62,66,70,74,78,82,86,90,94,98,102,106,110,114,118,122,126,130,134,138,142,146,150,154,158,162,166,170,174,178,182,186,190,194,198,202,206,210,214,218,222,226,230,234,238,242,246,250,255];flow_red=[32,32,32,32,31,31,31,31,31,30,30,30,30,30,29,29,29,29,29,28,28,28,28,28,27,27,27,27,27,26,26,26,26,26,25,25,25,25,25,24,24,24,24,24,23,23,23,23,23,22,22,22,22,22,21,21,21,21,21,20,20,20,20,19,19,19,19,18,18,18,17,17,17,16,16,16,16,15,15,15,14,14,14,13,13,13,13,12,12,12,11,11,11,10,10,10,10,9,9,9,8,8,8,7,7,7,7,6,6,6,5,5,5,4,4,4,4,3,3,3,2,2,2,1,1,1,1,0,0,0,4,8,12,16,20,24,28,32,36,40,45,49,53,57,61,65,69,73,77,81,85,89,93,97,101,105,109,113,117,121,125,130,134,138,142,146,150,154,158,162,166,170,174,178,182,186,190,194,198,202,206,210,215,219,223,227,231,235,239,243,247,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];ge_color_blue=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,252,248,244,240,236,232,228,224,220,216,212,208,204,200,196,192,188,184,180,176,172,168,164,160,156,152,148,144,140,136,132,128,124,120,116,112,108,104,100,96,92,88,84,80,76,72,68,64,60,56,52,48,44,40,36,32,28,24,20,16,12,8,4,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,85,89,93,97,101,105,109,113,117,121,125,129,133,137,141,145,149,153,157,161,165,170,174,178,182,186,190,194,198,202,206,210,214,218,222,226,230,234,238,242,246,250,255];ge_color_green=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,63,61,59,57,55,53,51,49,47,45,43,41,39,37,35,33,31,29,27,25,23,21,19,17,15,13,11,9,7,5,3,1,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255];ge_color_red=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];gray_rainbow_blue=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,255,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,255,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,255,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,255,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,255,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,255,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,205,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,125,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,45,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,0,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,0,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,0,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,0,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,0,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,0,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];gray_rainbow_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,0,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,65,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,145,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,225,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,255,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,255,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,255,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,255,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,255,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,255,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,235,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,155,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,75,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];gray_rainbow_red=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,175,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,95,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,15,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,0,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,0,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,0,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,0,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,35,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,115,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,195,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,255,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,255,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,255,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];hot_green_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,6,10,13,16,20,23,26,30,33,37,40,43,47,50,53,57,60,64,67,70,74,77,80,84,87,90,94,97,101,104,107,111,114,117,121,124,128,131,134,138,141,144,148,151,154,158,161,165,168,171,175,178,181,185,188,192,195,198,202,205,208,212,215,218,222,225,229,232,235,239,242,245,249,252];hot_green_green=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,25,27,28,30,31,33,34,36,37,39,40,42,43,45,46,48,49,51,52,54,55,57,58,60,61,63,64,66,67,69,70,72,73,75,76,78,79,81,82,84,85,87,88,90,91,93,94,96,97,99,100,102,103,105,106,108,109,111,112,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,136,138,139,141,142,144,145,147,148,150,151,153,154,156,157,159,160,162,163,165,166,168,169,171,172,174,175,177,178,180,181,183,184,186,187,189,190,192,193,195,196,198,199,201,202,204,205,207,208,210,211,213,214,216,217,219,220,222,223,225,226,228,229,231,232,234,235,237,238,240,241,243,244,246,247,249,250,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_green_red=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,8,10,12,14,16,17,19,21,23,24,26,28,30,32,33,35,37,39,40,42,44,46,48,49,51,53,55,56,58,60,62,64,65,67,69,71,72,74,76,78,80,81,83,85,87,88,90,92,94,96,97,99,101,103,104,106,108,110,112,113,115,117,119,120,122,124,126,128,129,131,133,135,136,138,140,142,144,145,147,149,151,152,154,156,158,160,161,163,165,167,168,170,172,174,176,177,179,181,183,184,186,188,190,192,193,195,197,199,200,202,204,206,208,209,211,213,215,216,218,220,222,224,225,227,229,231,232,234,236,238,240,241,243,245,247,248,250,252,254];hot_iron_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255];hot_iron_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,255];hot_iron_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_metal_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,7,11,15,19,23,27,31,35,39,43,47,51,55,59,63,67,71,75,79,83,87,91,95,99,103,107,111,115,119,123,127,131,135,139,143,147,151,155,159,163,167,171,175,179,183,187,191,195,199,203,207,211,215,219,223,227,231,235,239,243,247,251];hot_metal_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,5,8,11,14,16,19,22,25,28,30,33,36,39,42,44,47,50,53,56,58,61,64,67,70,72,75,78,81,84,86,89,92,95,98,100,103,106,109,112,114,117,120,123,126,128,131,134,137,140,142,145,148,151,154,156,159,162,165,168,170,173,176,179,182,184,187,190,193,196,198,201,204,207,210,212,215,218,221,224,226,229,232,235,238,240,243,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hot_metal_red=[0,1,2,4,5,7,8,9,11,12,14,15,16,18,19,21,22,23,25,26,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,60,61,63,64,65,67,68,70,71,72,74,75,77,78,79,81,82,84,85,86,88,89,91,92,93,95,96,98,99,100,102,103,105,106,107,109,110,112,113,114,116,117,119,120,121,123,124,126,127,128,130,131,133,134,135,137,138,140,141,142,144,145,147,148,149,151,152,154,155,156,158,159,161,162,163,165,166,168,169,170,172,173,175,176,177,179,180,182,183,184,186,187,189,190,191,193,194,196,197,198,200,201,203,204,205,207,208,210,211,212,214,215,217,218,219,221,222,224,225,226,228,229,231,232,233,235,236,238,239,240,242,243,245,246,247,249,250,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hue1_blue=[3,3,13,17,23,30,37,44,50,57,63,70,76,82,89,95,101,107,114,120,126,132,138,144,149,155,161,167,172,178,184,189,195,200,205,211,216,221,227,232,237,242,247,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,250,247,244,242,239,236,234,231,229,226,224,221,219,217,214,212,210,208,206,204,202,200,198,196,194,192,191,189,187,186,184,183,181,180,179,177,176,175,174,173,172,171,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,251];hue1_green=[0,0,1,2,3,4,5,6,7,8,9,13,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,87,92,97,102,107,111,116,121,125,130,134,139,143,147,152,156,160,164,168,172,176,180,184,188,192,196,199,203,207,210,214,217,221,224,228,231,234,238,241,244,247,250,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,251,250,249,249,248,247,247,246,246,246,245,245,245,245,244,244,244,244,244,244,245,245,245,245,246,246,246,247,247,248,249,249,250,251,251,251];hue1_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,247,242,237,233,228,223,219,214,210,205,201,196,192,188,184,179,175,171,167,163,159,155,151,147,144,140,136,133,129,125,122,118,115,112,108,105,102,99,95,92,89,86,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,172,175,177,180,183,186,188,191,194,196,199,201,203,206,208,210,213,215,217,219,221,223,225,227,229,230,232,234,236,237,239,240,242,243,245,246,247,248,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];hue2_blue=[253,253,252,251,250,249,248,248,247,247,246,246,245,245,244,244,244,244,243,243,243,243,243,243,243,243,244,244,244,244,245,245,246,246,247,247,248,249,250,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,250,247,244,241,237,234,231,227,224,220,217,213,210,206,203,199,195,191,187,183,179,175,171,167,163,159,155,150,146,142,137,133,128,124,119,114,110,105,100,95,90,86,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,13,9,8,7,6,5,4,3,2,2];hue2_green=[253,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,169,169,170,171,172,173,174,176,177,178,180,181,183,184,186,188,189,191,193,195,197,199,201,203,205,207,209,211,214,216,218,221,223,226,228,231,233,236,239,241,244,247,250,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,247,242,237,232,226,221,216,211,205,200,194,189,183,178,172,166,160,155,149,143,137,131,125,119,113,107,100,94,88,81,75,69,62,56,49,42,36,29,29];hue2_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,249,248,247,246,244,243,241,240,238,237,235,233,231,230,228,226,224,222,220,218,216,213,211,209,207,204,202,199,197,194,192,189,187,184,181,178,175,172,170,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,85,84,84,88,91,94,97,100,103,107,110,114,117,121,124,128,131,135,139,143,146,150,154,158,162,166,170,174,179,183,187,191,196,200,205,209,214,218,223,228,233,237,242,247,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];ired_blue=[255,254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1];ired_green=[255,254,253,252,251,250,249,248,247,246,245,244,243,242,241,240,239,238,237,236,235,234,233,232,231,230,229,228,227,226,225,224,223,222,221,220,219,218,217,216,215,214,213,212,211,210,209,208,207,206,205,204,203,202,201,200,199,198,197,196,195,194,193,192,191,190,189,188,187,186,185,184,183,182,181,180,179,178,177,176,175,174,173,172,171,170,169,168,167,166,165,164,163,162,161,160,159,158,157,156,155,154,153,152,151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128,127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60,59,58,57,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,1];ired_red=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];jet_blue=[142,146,149,153,156,160,163,167,170,174,177,181,184,188,191,195,198,202,205,209,212,216,219,223,226,230,233,237,240,244,247,251,255,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,250,250,250,250,246,242,239,235,231,227,223,219,215,211,207,203,199,195,192,188,184,180,176,172,168,164,160,156,152,148,144,141,137,133,129,125,121,117,113,109,105,101,97,94,90,86,82,78,74,70,66,62,58,54,50,47,43,39,35,31,27,23,19,15,11,7,3,0,0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,12,12,11,11,11,11,11,10,10,10,10,10,9,9,9,9,9,8,8,8,8,8,7,7,7,7,7,6,6,6];jet_green=[5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,13,16,20,24,28,32,35,39,43,47,51,54,58,62,66,70,73,77,81,85,89,92,96,100,104,108,112,115,119,123,127,131,134,138,142,146,150,153,157,161,165,169,172,176,180,184,188,191,195,199,203,207,211,214,218,222,226,230,233,237,241,245,249,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,250,250,250,250,250,250,250,250,250,247,243,240,236,233,229,225,222,218,215,211,208,204,201,197,194,190,187,183,180,176,173,169,165,162,158,155,151,148,144,141,137,134,130,127,123,120,116,113,109,105,102,98,95,91,88,84,81,77,74,70,67,63,60,56,53,49,45,42,38,35,31,28,24,24,24,23,23,22,22,22,21,21,20,20,20,19,19,19,18,18,17,17,17,16,16,15,15,15,14,14,14,13,13,12];jet_red=[17,18,18,19,19,19,20,20,21,21,22,22,22,23,23,24,24,25,25,26,26,26,27,27,28,28,29,29,29,30,30,31,31,31,31,31,31,30,30,30,30,30,30,30,29,29,29,29,29,29,28,28,28,28,28,28,28,27,27,27,27,27,27,27,26,26,26,26,26,26,25,25,25,25,25,25,25,24,24,24,24,24,24,24,23,23,23,23,23,23,22,22,22,22,22,22,22,25,29,32,36,40,43,47,50,54,57,61,65,68,72,75,79,83,86,90,93,97,101,104,108,111,115,118,122,126,129,133,136,140,144,147,151,154,158,162,165,169,172,176,179,183,187,190,194,197,201,205,208,212,215,219,223,226,230,233,237,240,244,248,251,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,249,245,241,237,233,229,225,221,217,213,209,206,202,198,194,190,186,182,178,174,170,166,162,158,154,151,147,143,139,135,131];muscles_bones_blue=[0,0,0,0,1,1,1,2,2,2,2,3,3,3,4,4,4,5,5,5,5,6,6,6,7,7,7,7,8,8,8,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,13,13,14,14,14,15,15,15,15,16,16,16,17,17,17,17,18,18,18,19,19,19,20,20,20,20,21,21,21,22,22,22,22,23,23,23,24,24,24,25,25,25,25,26,26,26,27,27,27,27,27,27,26,26,26,25,25,25,24,24,24,23,23,22,22,22,21,21,21,20,20,20,19,19,19,18,18,18,17,17,16,16,16,15,15,15,14,14,14,13,13,13,12,12,11,11,11,10,10,10,9,9,10,10,11,11,12,12,13,13,14,15,15,16,16,17,17,18,18,19,19,20,21,21,22,22,23,23,24,24,25,26,26,27,27,28,28,29,29,30,31,31,32,32,33,33,34,34,35,36,36,37,37,38,38,39,43,47,51,55,58,62,66,70,74,78,82,86,90,94,98,102,105,109,113,117,121,125,129,133,137,141,145,149,153,156,160,164,168,172,176,180,184,188,192,196,200,204,207,211,215,219,223,227,231,235,239,243,247,251];muscles_bones_green=[0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,176,177,179,180,181,182,183,185,186,187,188,189,191,192,193,194,195,197,198,199,200,201,203,204,205,206,207,209,210,211,212,213,215,216,217,218,220,221,222,223,224,226,227,228,229,230,232,233,234,235,236,238,239,240,241,241,242,242,242,242,243,243,243,243,244,244,244,244,245,245,245,245,246,246,246,246,247,247,247,247,248,248,248,248,248,249,249,249,249,250,250,250,250,251,251,251,251,252,252,252,252,253,253,253,253,254,254,254,254];muscles_bones_red=[0,2,5,8,10,13,16,18,21,24,26,29,32,34,37,40,42,45,48,51,53,56,59,61,64,67,69,72,75,77,80,83,85,88,91,93,96,99,102,104,107,110,112,115,118,120,123,126,128,131,134,136,139,142,144,147,150,153,155,158,161,163,166,169,171,174,177,179,182,185,187,190,193,195,198,201,204,206,209,212,214,217,220,222,225,228,230,233,236,238,241,244,246,249,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];nih_blue=[0,11,22,34,45,56,68,79,90,102,113,124,136,147,158,170,164,159,154,148,143,138,132,127,122,116,111,106,100,95,90,85,90,95,100,106,111,116,122,127,132,138,143,148,154,159,164,170,175,180,185,191,196,201,207,212,217,223,228,233,239,244,249,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,249,244,239,233,228,223,217,212,207,201,196,191,185,180,175,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,159,148,138,127,116,106,95,85,74,63,53,42,31,21,10,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,79,74,69,63,58,53,47,42,37,31,26,21,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255];nih_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,90,95,100,106,111,116,122,127,132,138,143,148,154,159,164,170,175,180,185,191,196,201,207,212,217,223,228,233,239,244,249,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,249,244,239,233,228,223,217,212,207,201,196,191,185,180,175,170,164,159,154,148,143,138,132,127,122,116,111,106,100,95,90,85,81,78,75,71,68,65,62,58,55,52,49,45,42,39,35,32,29,26,22,19,16,13,9,6,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255];nih_red=[0,5,11,17,22,28,34,39,45,51,56,62,68,73,79,85,79,74,69,63,58,53,47,42,37,31,26,21,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,21,26,31,37,42,47,53,58,63,69,74,79,85,95,106,116,127,138,148,159,170,180,191,201,212,223,233,244,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,250,248,246,243,241,239,237,234,232,230,228,225,223,221,219,216,214,212,210,208,205,203,201,199,196,194,192,190,187,185,183,181,178,176,174,255,255];rainbow1_blue=[0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,247,239,231,223,215,207,199,191,183,175,167,159,151,143,135,127,119,111,103,95,87,79,71,63,55,47,39,31,23,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow1_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,120,128,136,144,152,160,168,176,184,192,200,208,216,224,232,240,248,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,253,251,249,247,245,243,241,239,237,235,233,231,229,227,225,223,221,219,217,215,213,211,209,207,205,203,201,199,197,195,193,192,189,186,183,180,177,174,171,168,165,162,159,156,153,150,147,144,141,138,135,132,129,126,123,120,117,114,111,108,105,102,99,96,93,90,87,84,81,78,75,72,69,66,63,60,57,54,51,48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3];rainbow1_red=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,16,20,24,28,32,36,40,44,48,52,56,60,64,68,72,76,80,84,88,92,96,100,104,108,112,116,120,124,128,132,136,140,144,148,152,156,160,164,168,172,176,180,184,188,192,196,200,204,208,212,216,220,224,228,232,236,240,244,248,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];rainbow2_blue=[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow2_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0];rainbow2_red=[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];rainbow3_blue=[255,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,250,247,241,238,232,229,223,220,214,211,205,202,196,193,187,184,178,175,169,166,160,157,151,148,142,139,133,130,125,121,116,112,107,103,98,94,89,85,80,76,71,67,62,58,53,49,44,40,35,31,26,22,17,13,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];rainbow3_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,6,11,15,20,24,29,33,38,42,47,51,56,60,65,69,74,78,83,87,92,96,101,105,110,114,119,122,128,131,137,140,146,149,155,158,164,167,173,176,182,185,191,194,200,203,209,212,218,221,227,230,236,240,245,249,254,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,252,247,243,238,234,229,225,220,216,211,207,202,198,193,189,184,180,175,171,166,162,157,153,148,144,139,135,131,126,122,117,113,108,104,99,95,90,86,81,77,72,68,63,59,54,50,45,41,36,32,27,23,18,14,9,5,5];rainbow3_red=[124,124,120,115,111,106,102,97,93,88,84,79,75,70,66,61,57,52,48,43,39,34,30,25,21,16,12,7,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,5,13,14,19,23,28,32,37,41,46,50,55,59,64,68,73,77,82,86,91,95,100,104,109,113,118,123,126,132,135,141,144,150,153,159,162,168,171,177,180,186,189,195,198,204,207,213,216,222,225,231,234,240,243,249,252,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,254,255,255,255];ratio_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,252,250,248,246,244,242,240,238,236,234,232,230,228,226,224,222,220,218,216,214,212,210,208,206,204,202,200,198,196,194,192,190,188,186,184,182,180,178,176,174,172,170,168,166,164,162,160,158,156,154,152,150,148,146,144,142,140,138,136,134,132,130,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0];ratio_green=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,254,252,250,248,246,244,242,240,238,236,234,232,230,228,226,224,222,220,218,216,214,212,210,208,206,204,202,200,198,196,194,192,190,188,186,184,182,180,178,176,174,172,170,168,166,164,162,160,158,156,154,152,150,148,146,144,142,140,138,136,134,132,130,128,126,124,122,120,118,116,114,112,110,108,106,104,102,100,98,96,94,92,90,88,86,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2,0];ratio_red=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];red_vessels_blue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,55,57,59,61,64,66,68,70,72,75,77,79,81,84,86,88,90,92,95,97,99,101,103,106,108,110,112,114,117,119,121,123,126,128,136,144,152,159,167,175,183,191,199,207,215,223,231,239,247];red_vessels_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,6,8,10,11,13,15,16,18,20,21,23,25,26,28,30,32,33,35,37,38,40,42,43,45,47,48,50,52,53,55,57,59,60,62,64,65,67,69,70,72,74,75,77,79,80,82,84,86,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,164,170,176,182,188,194,200,206,212,218,224,230,236,242,248];red_vessels_red=[0,1,2,3,5,6,7,9,10,11,12,14,15,16,18,19,20,21,23,24,25,27,28,29,30,32,33,34,36,37,38,39,41,42,43,45,46,47,49,50,51,52,54,55,56,58,59,60,61,63,64,65,67,68,69,70,72,73,74,76,77,78,79,81,82,83,85,86,87,88,90,91,92,94,95,96,98,99,100,101,103,104,105,107,108,109,110,112,113,114,116,117,118,119,121,122,123,125,126,127,128,130,131,132,134,135,136,137,139,140,141,143,144,145,147,148,149,150,152,153,154,156,157,158,159,161,162,163,165,166,167,168,170,171,172,174,175,176,177,179,180,181,183,184,185,186,188,189,190,192,193,194,196,197,198,199,200,201,202,203,204,206,207,208,209,210,211,212,213,214,215,216,217,219,220,221,222,223,224,225,226,227,228,229,231,232,233,234,235,236,237,238,239,240,241,243,244,245,246,247,248,249,250,251,252,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];spectrum_blue=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];spectrum_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0];spectrum_red=[255,250,245,240,235,230,225,220,215,210,205,200,195,190,185,180,175,170,165,160,155,150,145,140,135,130,125,120,115,110,105,100,95,90,85,80,75,70,65,60,55,50,45,40,35,30,25,20,15,10,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110,115,120,125,130,135,140,145,150,155,160,165,170,175,180,185,190,195,200,205,210,215,220,225,230,235,240,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];stern_blue=[0,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,189,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,231,233,235,237,239,241,243,245,247,249,251,253,255,251,247,243,238,234,230,226,221,217,213,209,204,200,196,192,187,183,179,175,170,166,162,158,153,149,145,141,136,132,128,124,119,115,111,107,102,98,94,90,85,81,77,73,68,64,60,56,51,47,43,39,34,30,26,22,17,13,9,5,0,3,7,11,15,19,22,26,30,34,38,41,45,49,53,57,60,64,68,72,76,79,83,87,91,95,98,102,106,110,114,117,121,125,129,133,137,140,144,148,152,156,159,163,167,171,175,178,182,186,190,194,197,201,205,209,213,216,220,224,228,232,235,239,243,247,251,255];stern_green=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];stern_red=[0,18,36,54,72,90,108,127,145,163,181,199,217,235,254,249,244,239,234,229,223,218,213,208,203,197,192,187,182,177,172,166,161,156,151,146,140,135,130,125,120,115,109,104,99,94,89,83,78,73,68,63,58,52,47,42,37,32,26,21,16,11,6,0,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];ucla_blue=[0,0,0,0,0,0,0,0,0,0,0,0,102,102,102,102,136,136,136,136,136,136,136,136,136,136,136,136,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,170,170,170,170,187,187,187,187,204,204,204,204,204,204,204,204,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,187,187,187,187,187,187,187,187,170,170,170,170,153,153,153,153,153,153,153,153,136,136,136,136,119,119,119,119,119,119,119,119,85,85,85,85,71,71,71,71,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];ucla_green=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,51,51,51,51,51,51,51,51,85,85,85,85,119,119,119,119,119,119,119,119,136,136,136,136,153,153,153,153,153,153,153,153,153,153,153,153,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,185,185,185,185,185,185,185,185,204,204,204,204,221,221,221,221,221,221,221,221,238,238,238,238,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,238,238,238,238,238,238,238,238,221,221,221,221,204,204,204,204,204,204,204,204,187,187,187,187,170,170,170,170,170,170,170,170,153,153,153,153,119,119,119,119,85,85,85,85,85,85,85,85,51,51,51,51,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];ucla_red=[0,0,0,0,0,0,0,0,0,0,0,0,85,85,85,85,119,119,119,119,119,119,119,119,136,136,136,136,136,136,136,136,136,136,136,136,102,102,102,102,68,68,68,68,68,68,68,68,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,102,102,102,102,187,187,187,187,204,204,204,204,204,204,204,204,238,238,238,238,238,238,238,238,238,238,238,238,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,238,238,238,238,221,221,221,221,221,221,221,221,204,204,204,204,255,255,255,255];"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.DataManager=function(e){var c=this;this.arrStudy=[];var a=$.extend(!0,{render:null},e);this.requestHandle;this.Request=function(b){if(void 0!==b)if(5<=this.arrStudy.length)$.Msg("\u52a0\u8f7d\u68c0\u67e5\u6570\u4e0a\u9650\uff0c\u6700\u9ad8\u53ea\u80fd\u52a0\u8f7d5\u4e2a\u68c0\u67e5\u3002"),console.log(CBoBo.Plugin.GetTime()+" :\u52a0\u8f7d\u68c0\u67e5\u6570\u4e0a\u9650\uff0c\u6700\u9ad8\u53ea\u80fd\u52a0\u8f7d5\u4e2a\u68c0\u67e5\u3002");else if(void 0!=this.GetStudy(b.studyuid))$.Msg("\u52a0\u8f7d\u8be5\u68c0\u67e5\x3c"+b.studyuid+"\x3e\u5931\u8d25,\u5f53\u524d\u68c0\u67e5\u5df2\u5b58\u5728\u3002"),console.log(CBoBo.Plugin.GetTime()+" :\u52a0\u8f7d\u8be5\u68c0\u67e5\x3c"+b.studyuid+"\x3e\u5931\u8d25,\u68c0\u67e5\u5df2\u5b58\u5728\u3002");else{var c=b.studyuid,d=b.wadourl,e=b.hospid,g=b.token,h=b.imageType,n=b.hasDesensitize,t=b.departCode,r=b.error,v=b.success,u=b.progress,q=b.deseriesfakeprogress;b=b.serverRead;var w=new DVStudy;w.setURLSearchParams({studyuid:c,wadourl:d,hospid:e,token:g,imageType:h,hasDesensitize:n,departCode:t});this.requestHandle=new DicomRequest({wadourl:d,hospid:e,studyuid:c,study:w,token:g,imageType:h,hasDesensitize:n,departCode:t,error:r,success:v,progress:u,deseriesfakeprogress:q,serverRead:b,manager:a.manager});this.requestHandle.RequestVrtWsURl();this.requestHandle.StartStudyInfo();this.arrStudy.push(w)}};this.RequestAIAnnotation=function(a){layer.confirm("\u5e73\u53f0\u53ea\u5f00\u653e\u80f8\u90e8CT\u3001DR\u5f71\u50cf\u7684AI\u670d\u52a1\uff0c\u66f4\u591a\u90e8\u4f4d\u5c06\u9646\u7eed\u5f00\u653e\u3002\x3cbr\x3e\u7b26\u5408\u8bf7\u201c\u786e\u8ba4\u201d\x3c/br\x3e\u4e0d\u7b26\u5408\u8bf7\u201c\u8fd4\u56de\u201d,\u89e3\u6790\u7ed3\u679c\u9700\u8981\u7b49\u5f85\u5927\u698230\u79d2",{btn:["\u786e\u5b9a","\u53d6\u6d88"],title:"AI\u8bca\u65ad"},function(){layer.msg("\u6b63\u5728\u4e3a\u60a8\u89e3\u6790AI\u7ed3\u679c\u3002",{icon:1});var b=c.arrStudy[0].wadourl.replace("Wado","").replace("wado","");$.ajax({url:b+"Ai/NewStudy",type:"get",data:{studyUid:c.arrStudy[0].stuuid,hospId:c.arrStudy[0].hospid},async:!1,complete:function(b){200==b.status&&b.responseJSON?"success"===b.responseJSON.status?a.success():(a.error&&a.error(),layer.msg("\u8bf7\u6c42AI\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]})):(a.error&&a.error(),layer.msg("\u8bf7\u6c42AI\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}))}})},function(){})};this.RequestAIResult=function(a){var b=c.arrStudy[0].wadourl.replace("Wado","").replace("wado","");$.ajax({url:b+"Ai/GetResult",type:"get",data:{studyUid:c.arrStudy[0].stuuid,hospId:c.arrStudy[0].hospid},async:!1,complete:function(b){200==b.status&&b.responseJSON?(b=b.responseJSON,"success"===b.status?b.result.imgDetail.length?(c.arrStudy[0].SetAnnotations(b.result.imgDetail),a.success()):layer.msg("\u626b\u63cf\u5b8c\u6210\uff0c\u672a\u53d1\u73b0\u53ef\u7591\u7ed3\u8282",{icon:5,time:3E3,shade:[.3,"#000"]}):(layer.msg("\u8bf7\u6c42AI\u6570\u636e\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}),a.error&&a.error())):(a.error&&a.error(),layer.msg("\u8bf7\u6c42AI\u6570\u636e\u5931\u8d25",{icon:5,time:3E3,shade:[.3,"#000"]}))}})};this.RequestHistoryStudy=function(a){var b=$.extend({hospid:"",studyuid:"",hisurl:"",process:null,progress:null,error:null,complete:null,deseriesfakeprogress:null},a);$.ajax({url:b.hisurl,type:"get",data:{hospId:b.hospid,mainstudyUid:b.studyuid},complete:function(a){var d=!1;200==a.status&&a.responseJSON&&(a.responseJSON.success?(d=!0,$.each(a.responseJSON.studies,function(a,d){c.Request({wadourl:d.url,hospuid:d.hospId,studyuid:d.uid,departCode:d.departCode,progress:b.progress,success:b.success,error:b.error,deseriesfakeprogress:b.deseriesfakeprogress})})):$.Msg(a.responseJSON.msg));null!=b.complete&&b.complete(d)}})};this.GetStudy=function(a){var b;a<this.arrStudy.length&&-1<a&&(b=this.arrStudy[a]);if(void 0===b)for(var c=0;c<this.arrStudy.length;c++){var d=this.arrStudy[c],e;if("JPG"==d.totaltype){e=d.GetJpg();var g=0}else e=d.GetAllDicom(),g=0;for(;g<e.length;g++)e[g].id==a&&(b=d)}if(void 0===b)for(c=0;c<this.arrStudy.length;c++)d=this.arrStudy[c],d.studyuid==a&&(b=d);return b};this.GetSeries=function(a){for(var b=0;b<this.arrStudy.length;b++){var c=this.arrStudy[b].GetSeries(a);if(void 0!=c)return c}};this.DeleteStudy=function(a){for(var b=0;b<this.arrStudy.length;b++){var c=this.arrStudy[b];c.studyuid==a&&(delete c,this.arrStudy.splice(b,1))}};var g=0;this.SaveDicomBinary=function(b){var d=b.id,e=b.buffer,h=b.width,l=b.height,m=b.bseries,n=b.progress,t=b.frames,r=b.isRGB,v=b.isIMGAnalysis2;b=b.imageType;if(void 0!==d){void 0==n&&(n=100);g++;for(var u=0;u<this.arrStudy.length;u++){var q=this.arrStudy[u],w=q.GetDicomById(d),z;w.frames=t;w.col=h;w.row=l;try{z=r?new Uint8Array(e):8>=w.bita&&!v?new Uint8Array(e):w.pixrep?new Int16Array(e):new Uint16Array(e)}catch(y){console.log(y)}w.setPixsBuffer(z);w.setData({isIMGAnalysis2:v,imageType:b});v&&!r&&w.getWwWc();if(m)w.bProgress=!0,a.render(w,q,q.CompletePercent(d));else if(a.render(w,q,n),!e){var A={};A.seruid=w.seruid;A.id=w.id;a.render(A,q,n)}w=q.IsPageSwitch();A=q.GetStudyType();w&&A&&g===q.GetAllSeries().length&&c.requestHandle.DLJsonBySeriesUid()}}};e=window.config&&window.config.threadDecodePath;var b=["./dicomviewer/js/Thread.Decode.js","./static/dicomviewer/js/Thread.Decode.js","./js/Thread.Decode.js"],d=[];e&&b.unshift(e);!function(){var a=arguments;workerUrl=b.shift()+"?v\x3d20220616\x26db\x3d"+JSON.stringify(CBoBo.store.db);var e;fetch(workerUrl).then(function(a){e=a;var b=a.ok;if("OK"==a.statusText||b)return a.text();throw{msg:"Worker\u6587\u4ef6\u8def\u5f84\u9519\u8bef",res:a};}).then(function(a){if(!a.includes(".postMessage("))throw{msg:"Worker\u6587\u4ef6\u7c7b\u578b\u9519\u8bef",response:e,data:a};a=new Worker(workerUrl);window.mergeThread=a;a.onmessage=function(a){a=a.data;c.SaveDicomBinary({id:a.id,buffer:a.buffer,width:a.width,height:a.height,bseries:a.bseries,progress:a.progress,frames:a.frames,isRGB:a.isRGB,isIMGAnalysis2:a.isIMGAnalysis2,imageType:a.imageType})}}).catch(function(c){d.push(c);b.length?a.callee():(console.info(d),console.error("\u8bf7\u6309\u89c4\u8303\u63a5\u5165dicomviewer!!!,worker\u8def\u5f84\u4e0d\u89c4\u8303!!!,\u8bf7\u8054\u7cfb\u7ef4\u62a4\u4eba\u5458,\u53ef\u4ee5\u4e34\u65f6\u914d\u7f6eindex.html\x3d\u300bwindow.config"),console.info(" dicomviewer\u89c4\u8303\u8be6\u89c1\u5185\u90e8git\uff1a","http://192.168.18.134:8081/dicomviewer/dicomviewer-pc-jquery"))})}()};function DicomRequest(e){function c(a){for(var b=[],c=f.study.GetAllSeries(),d=0;d<c.length;d++)for(var e=c[d],g=0;g<Math.min(e.arrImage.length,1);g++){var h=e.arrImage[g];b.push(h.id)}if(a)return b;for(d=0;d<c.length;d++)for(e=c[d],g=1;g<e.arrImage.length;g++)h=e.arrImage[g],b.push(h.id);return b}function a(a){for(var b=[],c=f.study.GetAllSeries(),d=0;d<c.length;d++)for(var e=c[d],g=0;g<Math.min(e.arrImage.length,1);g++){var h=e.arrImage[g];b.push(h)}if(a)return b;for(d=0;d<c.length;d++)for(e=c[d],g=1;g<e.arrImage.length;g++)h=e.arrImage[g],b.push(h);return b}function g(){var a=c(),d=0,e=f.study.imgcount;$.each(a,function(){var a=this,c=new XMLHttpRequest;c.open("GET",f.wadourl+"/GetImageMeta/"+a,!0);c.responseType="json";c.send();c.onreadystatechange=function(){if(c.readyState===c.DONE&&200===c.status&&c.response){var g=c.response;"string"===typeof g&&(g=eval("("+g+")"));f.study.SetDicomData(g,a,0);d++}else c.readyState===c.DONE&&200!==c.status&&d++;d===e&&(f.study.CorrectScout(),f.study.bAllMetaDl=!0,b())}})}function b(){function b(a,b){var c=f.study.GetAllSeries().length,d=a.isRGB,l=a.url,m=a.id,n=a.uid,r=a.col,A=a.row,q=a.mod,t=a.compress,v=a.seruid,y=a.imgnum;1==p?"ECG"==q?l=e+"/GetECGImageData?id\x3d"+m:t?l=e+"/GetDecodeImageData?id\x3d"+m:l||(l=e+"/GetImageData?id\x3d"+m):l||(l=e+"/GetBlock/"+m+"?blockIndex\x3d0\x26studyuid\x3d"+g+"\x26hospitalid\x3d"+h+"\x26hospid\x3d"+h+"\x26seriesId\x3d"+v+"\x26departCode\x3d"+k);d={url:l,id:m,uid:n,imageType:p,bseries:!0,brgb:d,index:0,ratio:1,dcmWidth:r,dcmHeight:A,bsave:!0,dicomInfo:{isRGB:d}};a.setData({threadPostData:d});(1>=y||b<(c||6)||void 0===b)&&z.push(d)}var c=f,d=c.study,e=c.wadourl,g=c.studyuid,h=c.hospid,k=c.departCode,p=c.imageType,w=[],z=[],c=a(),A=d.GetStudyType(),A="series"===A?!0:!1;c instanceof Array&&(A?(c.forEach(function(a,c){b(a,c)}),setTimeout(function(){},500)):$.each(c,function(){if(1==p)b(this);else{var a=this.seruid;var c=d.studyuid,f=d.hospid,g=d.departCode;if(this instanceof DVDicomInfo)for(var h=this.isRGB,k=this.url,l=this.id,m=this.uid,n=this.blocks,r=this.bits,A=this.col,q=this.row,t=0;t<n;t++){var v={url:k||e+"/GetBlock/"+l+"?blockIndex\x3d"+t+"\x26studyuid\x3d"+c+"\x26hospitalid\x3d"+f+"\x26hospid\x3d"+f+"\x26seriesId\x3d"+a+"\x26departCode\x3d"+g,id:l,uid:m,imageType:p,bseries:!1,brgb:!1,index:t,ratio:Math.sqrt(n),bits:r,dcmWidth:A,dcmHeight:q,bsave:!0,dicomInfo:{isRGB:h}};0===t?z.push(v):w.push(v)}}}));c=d.GetWaitLoadSeries({seriesId:c[0].customSeriesId,params:"threadPostData"}).slice(1);mergeThread.postMessage({type:0,arrpriority:[].concat($jscomp.arrayFromIterable(z),$jscomp.arrayFromIterable(c)),arrnormal:w})}function d(){var a=c(!0),b=0,d=a.length;$.each(a,function(){var a=this,c=new XMLHttpRequest;c.open("GET",f.wadourl+"/GetImageMeta/"+a,!0);c.responseType="json";c.send();c.onreadystatechange=function(){if(c.readyState===c.DONE&&200===c.status&&c.response){var e=c.response;"string"===typeof e&&(e=eval("("+e+")"));f.study.SetDicomData(e,a,0);b++}else c.readyState===c.DONE&&200!==c.status&&b++;b===d&&h()}})}function h(){var b=[],c=a(!0),d=f.study.GetStudyType();c instanceof Array&&"series"===d&&$.each(c,function(){var a=this.isRGB,c=this.id;b.push({url:this.url||f.wadourl+"/GetBlock/"+c+"?blockIndex\x3d0",id:c,uid:this.uid,imageType:f.imageType,bseries:!0,brgb:a,index:0,ratio:1,dcmWidth:this.col,dcmHeight:this.row,bsave:!0,dicomInfo:{isRGB:a}})});mergeThread.postMessage({type:0,arrpriority:b,arrnormal:[]})}function k(){for(var a=f.study.GetJpg(),b=0;b<a.length;b++){var c=a[b];c.image=new Image;c.image.crossOrigin="";c.image.src=f.wadourl+"/GetImageData/"+c.id;$(c.image).bind("load",{img:c},function(a){a=a.data.img;a.bLoaded=!0;null!=f.progress&&f.progress(a,f.study)})}}var f=$.extend({wadourl:"",hospid:"",studyuid:"",study:"",token:void 0,imageType:void 0,departCode:0,hasDesensitize:0,progress:null,serverRead:"",error:null,success:null,deseriesfakeprogress:null,manager:void 0},e),p=this;this.RequestVrtWsURl=function(){var a=f,b=a.study,c=new XMLHttpRequest;c.open("GET",a.wadourl+"/getPath3d",!0);c.responseType="json";c.onreadystatechange=function(){var a=c.status,d=c.response;4===c.readyState&&200===a&&d.data&&(a=d.data.path)&&(b.vrtWsURl=a,CBoBo.isShow3D=!0,(a=document.querySelector('div[title\x3d"3D"]'))&&(a.style.display="inline"))};c.send()};this.StartStudyInfo=function(){var a=f,b=a.wadourl,c=a.studyuid,e=a.hospid,h=a.hasDesensitize,v=a.departCode,u=a.token,q=a.error,w=b+"/GetStudyInfo";CBoBo.Draw.SetIsFromServer(a.serverRead);CBoBo.Draw.SetWadoUrl(b);$.ajax({headers:u?{Authorization:"bearer "+u}:{},url:w,type:"get",data:{hospId:e,StudyUID:c,hasDesensitize:h,departCode:v},complete:function(a){200==a.status&&a.responseJSON?(a=a.responseJSON,a.success?(a.data.requestDesensitize=f.hasDesensitize,f.study.SetStudyInfo(a.data),f.study.UpdateSort(),null!=f.success&&f.success(f.study),f.study.hasseries&&"RAW"==f.study.totaltype?CBoBo.Draw.GetIsFromServer()?p.DLJsonBySeriesUid():(a=f.study.GetStudyType(),a="series"===a?!0:!1,f.study.IsPageSwitch()&&a?d():void 0===f.study.GetAllSeries()[0].uuid?g():p.DLJsonBySeriesUid()):k()):null!==f.error&&f.error({msg:a.msg,studyuid:f.studyuid})):null!==q&&q({msg:"\u5f71\u50cf\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",studyuid:c})}})};this.DLJsonBySeriesUid=function(){var a=0,c=f.study.GetAllSeries(),d=f,e=d.wadourl,g=d.studyuid,h=d.hospid,k=d.departCode,p=d.imageType;(new simple.PromiseQueue).init({arr:c,func:function(d){return new Promise(function(l){var m=new XMLHttpRequest;m.open("GET",e+"/GetSeriesMeta?uuid\x3d"+d.uuid+"\x26studyuid\x3d"+g+"\x26hospitalid\x3d"+h+"\x26hospid\x3d"+h+"\x26departCode\x3d"+k+"\x26imageType\x3d"+p,!0);m.responseType="json";m.onreadystatechange=function(){var d=m.readyState,e=m.response;200!==m.status?(l(),a++):(3===d&&l(),4===d&&(a++,d=e||{},"string"===typeof d&&(d=eval("("+d+")")),d.success&&(e=d.data,f.study.SetSeriesDicom(e.imgs,e.compress,d.data))),a===c.length&&(f.study.CorrectScout(),f.study.bAllMetaDl=!0,function(){window.mergeThread?b():setTimeout(arguments.callee,10)}()))};m.send()})}})};RequestBinaryData=function(a){var b=$.Deferred(),c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.send();c.onreadystatechange=function(){if(c.readyState==c.DONE&&200==c.status&&c.response)return b.resolve(c.response)};c.onerror=function(a){return b.reject(a)};return b}}function DVStudy(){function e(a,b){if(a instanceof Array){var c=!1;a.forEach(function(a){a===b&&(c=!0)});return c}}var c=[],a=[],g=[];this.studyuuid;this.studyuid;this.age;this.hasseries;this.hospname;this.imgcount;this.imgs;this.modality;this.name;this.orginaltype;this.patientid;this.seriescount;this.studydate;this.sex;this.studyid;this.totaltype;this.wadourl;this.hospid;this.token;this.imageType;this.hasDesensitize;this.departCode;this.m_Max=99999;var b=this;this.bAllMetaDl=!1;this.URLSearchParams={};this.vrtWsURl=void 0;this.setURLSearchParams=function(a){this.URLSearchParams=a;for(var b in a)Object.hasOwnProperty.call(a,b)&&(this[b]=a[b])};this.SetSeriesDicom=function(a,b,e){a instanceof Array&&a.forEach(function(a){a.compress=b;a.seruuid=e.seruid;a.id=a.id;for(var d=0;d<c.length;d++)for(var f=c[d],g=0;g<f.arrImage.length;g++){var h=f.arrImage[g];h.id==a.id&&(CBoBo.Draw.GetIsFromServer()&&(h.bLoadImage=!0),h.SetInfo({data:a}))}})};this.RequestCache=function(a,b,c){if(this.bAllMetaDl){var d=[],g=c.slice(Math.max(a-9,0),Math.min(b+9,c.length));c.forEach(function(a){e(g,a)?a.bLoadImage||d.push(a):(a.bLoadImage=!1,a.bProgress=!1,delete a.pixsBuffer)});this.SwitchSeriesImagesInMemory(d)}};this.RequestSeriesDicom=function(){if(this.bAllMetaDl){var a=[],c=function(){for(var a=[],c=b.GetAllSeries(),d=0;d<c.length;d++)for(var e=c[d],g=0;g<Math.min(e.arrImage.length,1);g++){var h=e.arrImage[g];a.push(h)}d=b.IsPageSwitch();e=b.GetStudyType();if(d&&e){for(d=0;d<c.length;d++)for(e=c[d],g=1;g<Math.min(e.arrImage.length,10);g++)h=e.arrImage[g],a.push(h);return a}for(d=0;d<c.length;d++)for(e=c[d],g=1;g<e.arrImage.length;g++)h=e.arrImage[g],a.push(h);return a}();this.GetStudyType();c instanceof Array&&$.each(c,function(c,d){c=this.isRGB;d=this.id;a.push({url:this.url||b.wadourl+"/GetBlock/"+d+"?blockIndex\x3d0",id:d,uid:this.uid,imageType:b.URLSearchParams.imageType,bseries:!0,brgb:c,index:0,ratio:1,dcmWidth:this.col,dcmHeight:this.row,bsave:0<=b.m_Max,dicomInfo:{isRGB:c}})});mergeThread.postMessage({type:1,arrpriority:[],arrnormal:a})}};this.GetSwitchInMemoryDicoms=function(a){if(a instanceof Array){var c=[];a.forEach(function(a){a.images.forEach(function(a,b){0!==b||a.bLoadImage||c.push(a)})});var d=[],e=b.URLSearchParams.imageType;$.each(c,function(a,c){a=c.isRGB;var f=c.id;d.push({url:c.url||b.wadourl+"/GetBlock/"+f+"?blockIndex\x3d0",id:f,uid:c.uid,imageType:e,bseries:!0,brgb:a,index:0,ratio:1,dcmWidth:c.col,dcmHeight:c.row,bsave:!0,dicomInfo:{isRGB:a}})});mergeThread.postMessage({type:1,arrpriority:d,arrnormal:[]})}};this.SwitchSeriesImagesInMemory=function(a){var c=[],d=this.URLSearchParams.imageType;$.each(a,function(a,e){a=e.isRGB;var f=e.id;c.push({url:e.url||b.wadourl+"/GetBlock/"+f+"?blockIndex\x3d0",id:f,uid:uid,imageType:d,bseries:!0,brgb:a,index:0,ratio:1,dcmWidth:e.col,dcmHeight:e.row,seriesuid:e.seruid,bsave:!0,dicomInfo:{isRGB:a}})});mergeThread.postMessage({type:2,arrpriority:c,arrnormal:[]})};this.IsPageSwitch=function(){return this.imgcount>this.m_Max};this.CompletePercent=function(a){a=this.GetSeries(a);if(void 0!==a){var b=0;a=a.GetAllDicom();$.each(a,function(){this.bProgress&&b++});a=b/a.length*100;return 10<=a?parseInt(a):a.toFixed(1)}return 100};this.GetStudyType=function(){var a;"JPG"==this.totaltype?a="jpg":"RAW"==this.totaltype&&(a="CT"==this.modality||"MR"==this.modality||"DX"==this.modality?"series":"deseries");return a};this.UpdateSort=function(){function b(a,b){if(!(void 0==a||1>a.length))for(var c,d,f=0;f<a.length;f++){if("FFP"==b||"FFS"==b||"FFDR"==b||"FFDL"==b){c=a;d=f;for(var g=f+1;g<c.length;++g)parseInt(c[d].num)<parseInt(c[g].num)&&(d=g)}else e(a,f);c=e(a,f);c!=f&&(d=a[f],a[f]=a[c],a[c]=d)}}function e(a,b){var c=b;for(b+=1;b<a.length;++b)parseInt(a[c].num)>parseInt(a[b].num)&&(c=b);return c}0<c.length&&($.each(c,function(a,c){b(c.arrImage,c.desp)}),b(c));0<a.length&&b(a)};this.CorrectScout=function(){function a(a,b){a&&(a=a.split("|"),void 0!=a&&$.each(a,function(a,c){a=c.split("^");a={uid:a[0],index:parseInt(a[1]),ptStart:new Point(parseInt(a[2]),parseInt(a[3])),ptEnd:new Point(parseInt(a[4]),parseInt(a[5]))};if(c=e[a.uid])"[object Array]"!=Object.prototype.toString.apply(b[c])&&(b[c]=[]),b[c].push(a)}))}function b(a){$.each(a,function(a,b){b.sort(function(a,b){return a.index-b.index})})}var e=function(){var a=[];$.each(c,function(b,c){$.each(c.arrImage,function(b,c){a[c.uid]=c.seruid})});return a}();$.each(c,function(c,d){$.each(d.arrImage,function(c,d){a(d.strScount,d.scount);b(d.scount);d.strScount=null})})};this.DLImageScoutLine=function(){var a=new XMLHttpRequest;a.open("GET",this.wadourl+"/GetImageScoutLine?uuid\x3d"+this.studyuuid,!0);a.responseType="json";a.send();a.onreadystatechange=function(){if(a.readyState===a.DONE&&200===a.status&&a.response){var d=a.response;d.success&&($.each(c,function(a,b){$.each(b.arrImage,function(a,b){b.strScount=d.data[b.uid]})}),b.CorrectScout())}}};this.SetStudyInfo=function(a){function b(a){if(!a)return"*";var b=a.length;return a.slice(0,2)+"*".repeat(5>b?2:b-4)+a.slice(b-2)}if(void 0!=a){this.studyuid=a.studyuid;this.studyuuid=a.studyuuid;this.age=a.age;this.hasseries=parseInt(a.hasseries);this.hospname=a.hospname||a.orgname;this.imgcount=parseInt(a.imgcount);this.imgs=a.imgs;this.modality=a.modality;null!=this.modality&&""!=this.modality&&(this.modality=this.modality.toUpperCase());this.name=a.name;null!=this.name&&""!=this.name&&(this.name=this.name.replace(/\^/g,""));this.orginaltype=a.orginaltype;this.patientid=a.patientid;this.seriescount=a.seriescount;this.studydate=a.studydate;var c=String(a.sex).trim();this.sex="M"===c?"\u7537":"F"===c?"\u5973":c;this.studyid=a.studyid;this.totaltype="RAW";null!=this.totaltype&&""!=this.totaltype&&(this.totaltype=this.totaltype.toUpperCase());this.hasseries?this.PushArrSeries(a.serieses):this.PushArrImgs(a.imgs);window.globalStudyInfo=this;c=a.hasDesensitize;a.requestDesensitize&&1!==c&&(this.name=this.name.slice(0,1)+"**",this.orgname=b(this.hospname),this.patientid=b(this.patientid))}};this.PushArrSeries=function(a){if(void 0!=a){var b=this;if("RAW"==this.totaltype)$.each(a,function(a,d){var e=String(a);d.customSeriesId=e;var f=new DVSeries(b.studyuid,b.hospid,b.departCode,d);$.each(d.imgs,function(a,c){c.customSeriesId=e;f.PushImage(c,b.wadourl)});c.push(f)});else{var d=[];$.each(a,function(a,b){d.push(b.imgs)});$.each(d,function(a,c){c.customSeriesId=String(a);b.PushArrImgs(c)})}}};this.PushArrImgs=function(b){if(void 0!=b){var c=this;$.each(b,function(b,d){b=new DVImageInfo;b.id=d.id;b.num=d.num;b.imageicon=c.wadourl+"/GetImageThumb/"+d.id;dicominfo.url=d.url;dicominfo.customSeriesId=d.customSeriesId;a.push(b)})}};this.SetDicomData=function(a,b,e){for(var d=0;d<c.length;d++)for(var g=c[d],h=0;h<g.arrImage.length;h++){var k=g.arrImage[h];k.id==b&&(1==e?k.setPixsBuffer(a):0==e&&k.SetInfo(a))}};this.GetSpecifyImage=function(a,b){if(!(0>b))for(var d,e=0;e<c.length;e++)if(d=c[e],d.seruid==a){a=d.arrImage.length;if(b<a)return d.arrImage[b];break}};this.GetAllSeries=function(){return c};this.GetAllDicom=function(){var a=[];$.each(c,function(b,c){$.each(c.arrImage,function(b,c){a.push(c)})});return a};this.GetJpg=function(b){if(void 0==b)return a;for(var c=0;c<a.length;c++)if(img=a[c],img.id==b)return img;if(-1<b&&b<a.length)return a[b]};this.GetNextDicom=function(a,b,e){for(var d=0;d<c.length;d++)if(ser=c[d],ser.uid===a)for(var g=0;g<ser.arrImage.length;g++)if(img=ser.arrImage[g],img.sopuid==b){if(0<e){if(0>=g)return;index=g-1}else{if(g>=ser.arrImage.length-1)return;index=g+1}return ser.arrImage[index]}};this.GetSpecialDicom=function(a,b){for(var d=0;d<c.length;d++)if(ser=c[d],ser.uid==a&&b<ser.arrImage.length)return ser.arrImage[b]};this.GetDicomById=function(a){for(var b=0;b<c.length;b++){ser=c[b];for(var d=0;d<ser.arrImage.length;d++)if(img=ser.arrImage[d],img.id===a)return img}};this.GetWaitLoadSeries=function(a){var b=a.index,d=a.seriesId,e=a.params;a=c.length;var g=[];isNaN(b)&&d&&(b=c.findIndex(function(a){return a.customSeriesId==d}));if(0<=b&&b<a){b=c[b].arrImage.filter(function(a){return!a.bLoadImage});if(e)return g=b.map(function(a){return a[e]});g=b}return g};this.GetSeries=function(a){for(var b,d=0;d<c.length;d++){ser=c[d];for(var e=0;e<ser.arrImage.length;e++)img=ser.arrImage[e],img.id==a&&(b=ser)}void 0==b&&a<c.length&&-1<a&&(b=c[a]);return b};this.GetSeriesLengthById=function(a){for(var b=0;b<c.length;b++){ser=c[b];for(var d=0;d<ser.arrImage.length;d++)if(img=ser.arrImage[d],img.id==a)return ser.arrImage.length}};this.GetDicomNums=function(){for(var a=0,b=0;b<c.length;b++)ser=c[b],a+=ser.arrImage.length;return a};this.SetAnnotations=function(a){g=a};this.GetAnnotations=function(){return g}}function DVSeries(e,c,a,g){var b=g.desp,d=g.num,h=g.uid,k=g.uuid;g=g.customSeriesId;this.studyuid=e;this.hospid=c;this.departCode=a;this.desp=b;this.customSeriesId=g;this.num=d;this.uid=h;this.uuid=k;this.arrImage=[];this.PushImage=function(b,d){var g=new DVDicomInfo;g.id=b.id;g.num=b.num;g.imageInstanceUid=b.imageInstanceUid;g.imageicon=d+"/GetImageThumb/"+b.id+"?seriesId\x3d"+k+"\x26studyuid\x3d"+e+"\x26hospitalid\x3d"+c+"\x26hospid\x3d"+c+"\x26departCode\x3d"+a;g.url=b.url;g.customSeriesId=b.customSeriesId;this.arrImage.push(g)};this.GetAllDicom=function(){return this.arrImage}}function getIsRGB(e,c){return e?["RGB","YBR_FULL","YBR_FULL_422","YBR_RCT","YBR_ICT"].includes(e):8>=c}function DVDicomInfo(){this.bProgress=!1;this.minGray;this.maxGray;this.id;this.num;this.imageicon;this.uid;this.pixsBuffer;this.bLoadImage=!1;this.sex;this.age;this.birth;this.patid;this.mod;this.accnum;this.stuid;this.stuuid;this.studes;this.serid;this.seruid;this.serdes;this.imgnum;this.sopuid;this.studt;this.stutm;this.acqdt;this.acqtm;this.wc;this.ww;this.ma;this.kv;this.sliceth;this.manu;this.inst;this.frames;this.row;this.col;this.pixx;this.pixy;this.bita;this.bits;this.hbit;this.rescin;this.rescsl;this.pixrep;this.sappix;this.phme;this.orl;this.ort;this.orr;this.orb;this.scount={};this.strScount;this.blocks;this.isRGB;this.isIMGAnalysis2;this.imageType;this.pixz;this.imgpos;this.url;this.panPos;this.seruuid;this.SetInfo=function(e){if(e&&(e=e.data)){this.compress=e.compress;this.seruuid=e.seruuid;this.name=e.name.replace(/\^/g,"");this.sex=e.sex;this.age=e.age;this.birth=e.birth;this.patid=e.patid;this.mod=e.mod;this.accnum=e.accnum;this.stuid=e.stuid;this.stuuid=e.stuuid;this.studes=e.studes;this.serid=parseInt(e.serid).toString();this.seruid=e.seruid;this.serdes=e.serdes;this.imgnum=e.imgnum;this.sopuid=e.sopuid;this.uid=e.uid;this.blocks=parseInt(e.blocks);e.url&&(this.url=e.url);var c=e.stutm;"string"!==typeof c||c.match(":")?this.stutm=c:this.stutm=[c.substring(0,2),c.substring(2,4),c.substring(4)].join(":");c=e.studt;"string"!==typeof c||c.match("-")?this.studt=e.studt:this.studt=[c.substring(0,4),c.substring(4,6),c.substring(6)].join("-");this.acqdt=e.acqdt;(this.acqtm=e.acqtm)&&parseFloat(e.acqtm).toFixed(3);this.wc=parseInt(e.wc);this.ww=parseInt(e.ww);this.ma=e.ma;this.kv=e.kv;this.sliceth=e.sliceth;this.manu=e.manu;this.inst=e.inst;this.row=parseInt(e.row);this.col=parseInt(e.col);this.pixx=e.pixx;this.pixy=e.pixy;"string"===typeof this.pixx&&"string"===typeof this.pixy&&(-1!=e.pixx.indexOf(" ")&&(c=e.pixx.split(" "),2==c.length&&(this.pixx=parseFloat(c[0]),this.pixy=parseFloat(c[1]))),this.pixx=parseFloat(this.pixx),this.pixy=parseFloat(this.pixy));this.bita=parseInt(e.bita);this.bits=e.bits;this.hbit=e.hbit;this.rescin=parseInt(e.rescin);this.rescsl=parseFloat(e.rescsl);if(""===e.rescin||null===e.rescin||isNaN(this.rescin))this.rescin=0;if(""===e.rescsl||null===e.rescsl||isNaN(this.rescsl)||1>e.rescsl)this.rescsl=1;this.pixrep=parseInt(e.pixrep);this.sappix=parseInt(e.sappix);this.phme=e.phme;this.panPos=e.panPos;this.orl=e.orl;this.ort=e.ort;this.orr=e.orr;this.orb=e.orb;this.strScount=e.scount;c=(this.imgpos=e.imgpos)?e.imgpos.split("|"):[];3==c.length&&(this.pixz=parseFloat(c[2]));this.isRGB=getIsRGB(this.phme,this.bita)}};this.setData=function(e){if("object"!==typeof e)throw Error("prams is not object");for(var c in e)this[c]=e[c]};this.setPixsBuffer=function(e){if(void 0!==e){this.pixsBuffer=e;this.bLoadImage=!0;e=1E6;for(var c=-1E6,a,g=0;g<this.pixsBuffer.length;g++)a=this.pixsBuffer[g],a>c&&(c=a),a<e&&(e=a);this.minGray=e;this.maxGray=c}};this.getWwWc=function(){var e=this.rescin,c=this.rescsl,a=this.maxGray*c+e,e=this.minGray*c+e;this.ww=parseInt(a-e);this.wc=parseInt((a+e)/2)};this.GetData=function(){return this.pixsBuffer}}function DVImageInfo(){this.id;this.num;this.imageicon;this.image;this.bLoaded}function Point(e,c){e instanceof Object&&1==arguments.length?(this.x=e.x,this.y=e.y):(this.x=e,this.y=c)}function Rect(e,c,a,g){this.left=e||0;this.top=c||0;this.right=a||0;this.bottom=g||0}"undefined"===typeof CBoBo&&(CBoBo={});CBoBo.View={};CBoBo.View.Frame=function(e){var c=this,a=!0;this.index=0;this.idManager={};this.rootDom=e;this.GetId=function(a){switch(a){case "main":return this.idManager.main;case "banner":return this.idManager.banner;case "contain":return this.idManager.contain;case "thumb":return this.idManager.thumb;case "canvasbox":return this.idManager.canvasbox;case "logo":return this.idManager.logo;case "toolbar":return this.idManager.toolbar;case "thumbbox":return this.idManager.thumbbox}};this.Init=function(){this.idManager.main="main"+CBoBo.Plugin.GetRandom();this.idManager.banner=CBoBo.Plugin.GetRandom();this.idManager.contain="contain"+CBoBo.Plugin.GetRandom();this.idManager.thumb="thumb"+CBoBo.Plugin.GetRandom();this.idManager.thumbbox="thumbbox"+CBoBo.Plugin.GetRandom();this.idManager.canvasbox="canvasbox"+CBoBo.Plugin.GetRandom();this.idManager.logo=CBoBo.Plugin.GetRandom();this.idManager.toolbar=CBoBo.Plugin.GetRandom();this.idManager.hidebar=CBoBo.Plugin.GetRandom();m_printUrl=CBoBo.Plugin.GetUrlParam("WadoURL")||$("#hdurl").val()};this.Create=function(){var a="\x3cdiv id\x3d'"+this.idManager.main+"'\x3e\x3cdiv id\x3d'"+this.idManager.banner+"'\x3e\x3cdiv id\x3d'"+this.idManager.logo+"' title\x3d'\u5168\u5c4f'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.idManager.toolbar,a=a+("'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"+this.idManager.contain+"\x3e"),a=a+("\x3cdiv id \x3d"+this.idManager.thumb+"\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.idManager.canvasbox+"'\x3e\x3c/div\x3e"),a=a+"\x3c/div\x3e\x3c/div\x3e";this.rootDom?$(a).appendTo(this.rootDom):$(a).appendTo($("body"))};this.AddEvent=function(){};this.UpdateStyle0=function(){var a=$(window).width(),b=$(window).height();0!=CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=.026*a>>0,29>CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=29));var c=$("#"+this.idManager.main),e=a-1;c.width(e);c.height(b-1);c.css({"border-top":"1px solid #282828","border-left":"1px solid #282828","border-right":"1px solid #282828",overflow:"hidden"});c=$("#"+this.idManager.banner);c.width(e);c.height(CBoBo.View.TOOLBAR_HEIGHT-2);c.css({background:"#535353","border-top":"1px solid #6a6a6a","border-bottom":"1px solid #282828"});c=$("#"+this.idManager.contain);b-=CBoBo.View.TOOLBAR_HEIGHT;c.width(e);c.height(b);c.css({position:"relative"});var k=$("#"+this.idManager.thumb),c=e>>4;101>c&&(c=101);k.width(c);k.height(b-2);k.css({float:"left",background:"#464646","border-right":"1px solid #282828"});$("#"+this.idManager.thumbbox).css({width:"100%"});k=$("#"+this.idManager.logo);k.width(c);k.height(CBoBo.View.TOOLBAR_HEIGHT-2);k.css({display:"inline-block","text-align":"center"});k=$("#"+this.idManager.toolbar);k.width(e-c);k.height(CBoBo.View.TOOLBAR_HEIGHT-2);k.css({display:"inline-block",overflow:"hidden"});e=$("#"+this.idManager.canvasbox);e.width(a-c-23);e.height(b-22);e.css({float:"left",background:"#333",padding:"10px"})};this.UpdateStyleLB=function(a){var b=$(window).width(),c=$(window).height();0!=CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=.026*b>>0,29>CBoBo.View.TOOLBAR_HEIGHT&&(CBoBo.View.TOOLBAR_HEIGHT=29));var e=$("#"+this.idManager.main),g=b-1;e.width(g);e.height(c-1);e.css({"border-top":"1px solid #282828","border-left":"1px solid #282828","border-right":"1px solid #282828",overflow:"hidden"});e=$("#"+this.idManager.banner);e.width(g);e.height(CBoBo.View.TOOLBAR_HEIGHT-2);e.css({background:"#535353","border-top":"1px solid #6a6a6a","border-bottom":"1px solid #282828"});e=$("#"+this.idManager.contain);c-=CBoBo.View.TOOLBAR_HEIGHT;e.width(g);e.height(c);e.css({position:"relative"});var e=$("#"+this.idManager.thumb),f=g>>4;101>f&&(f=101);var p=$("#"+this.idManager.logo);p.width(f);p.height(CBoBo.View.TOOLBAR_HEIGHT-2);p.css({display:"inline-block","text-align":"center"});p=$("#"+this.idManager.toolbar);p.width(g-f);p.height(CBoBo.View.TOOLBAR_HEIGHT-2);p.css({display:"inline-block",overflow:"hidden"});var p=$("#"+this.idManager.canvasbox),l,m,n,t;a?(n=l=a=0,b-=20,f=c>>4,60>f&&(f=60),t=c-20-f,m=c-f,c=f,f=g):(m=a=0,l=f,n=0,b=b-f-20,t=c-20);e.width(f);e.height(c);e.css({position:"absolute",left:a+"px",top:m+"px",background:"#464646","border-right":"1px solid #282828","white-space":"nowrap","padding-bottom":"1px"});p.width(b);p.height(t);p.css({position:"absolute",left:l+"px",top:n+"px",background:"#333",padding:"10px"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height();this.UpdateStyleLB(a>b?!1:!0)};this.HideToolBar=function(){CBoBo.View.TOOLBAR_HEIGHT=0;$("#"+this.idManager.banner).hide();c.UpdateStyle()};this.ShowThumb=function(c){if(c!=a){var b=$("#"+this.idManager.thumb);c?(a=!0,b.css({transition:"left 500ms ease-in-out",left:0})):(a=!1,b.css({transition:"left 500ms ease-in-out",left:"-150px"}))}};c.Init();c.Create();c.UpdateStyle();!0};CBoBo.View.Logo=function(e){this.logo;this.logoFont;this.parentElem;var c=!1;this.Create=function(){this.logo=CBoBo.Plugin.GetRandom();this.logoFont=CBoBo.Plugin.GetRandom();$("\x3cspan id\x3d'"+this.logo+"'\x3e\x3c/span\x3e\x3cspan id\x3d'"+this.logoFont+"'\x3e\x3c/span\x3e").appendTo($(this.parentElem))};this.SetStyle=function(){var a=$("#"+this.logoFont),c=.9*$(this.parentElem).width()>>0;a.width(c);a.height(CBoBo.View.TOOLBAR_HEIGHT-2);a.css({"font-family":"STXingkai",color:"#aaa",overflow:"hidden","line-height":CBoBo.View.TOOLBAR_HEIGHT-2+"px","text-align":"center","font-size":(.2427637721755369*c>>0)+"px",cursor:"pointer","text-shadow":"2px 2px 3px #000","font-weight":"900",display:"inline-block"});a=(c>>1)-5;$("#"+this.logo).css({color:"#33FFFF",overflow:"hidden","line-height":CBoBo.View.TOOLBAR_HEIGHT-2+"px","text-align":"center","font-size":a+"px",cursor:"pointer"})};this.SetFont=function(a){$("#"+this.logoFont).html(a);return this};this.SetLogo=function(a){$("#"+this.logo).html(a);return this};this.AddEvent=function(){$(this.parentElem).bind("click",function(a){c=!c;CBoBo.Plugin.FullScreen(c)})};this.parentElem=e;this.Create();this.AddEvent();this.SetStyle();!0};CBoBo.View.PCToolBar=function(e){var c=this,a=$.extend(!0,{parent:null,axis:"x",bottonbox:!0,msgtransform:null},e),g={},b={},d={},h={type:-1,msgtansform:null},k,f,p=!1;this.bShowCornerInfo=!0;this.toolType;this.modalityType;var l=function(){var a=$("#"+g.toolbox);a&&a.empty()},m=function(){F("2D","2D");F("MPR","MPR");F("3D","3D",!!CBoBo.isShow3D);CBoBo.isShowAi&&F("AI","AI")},n=function(){m();G("2D");y();q("\x26#xe631;","\u91ca\u653e\u5de5\u5177");q("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");z("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40");z("\x26#xe66d;","\u5e8f\u5217\u5e03\u5c40");q("\x26#xe644;","\u6062\u590d");q("\x26#xe607;","\u5e8f\u5217\u64ad\u653e");q("\x26#xe610;","\u5b9a\u4f4d\u7ebf");0==CBoBo.IsTablet&&q("\x26#xe606;","\u80f6\u7247\u6253\u5370");q("\x26#xe671;","DICOM\u4fe1\u606f");q("\x26#xe6b6;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");y();q("\x26#xe670;","\u653e\u7f29");q("\x26#xe630;","\u79fb\u52a8");z("\x26#xe623;","\u65cb\u8f6c");y();q("\x26#xe603;","\u8d1f\u50cf");z("\x26#xe602;","\u4f2a\u5f69");y();q("\x26#xe61b;","\u8c03\u7a97");A("\x26#xe61b;","\u81ea\u5b9a\u4e49\u8c03\u7a97");y();q("\x26#xe61f;","\u76f4\u7ebf");q("\x26#xe619;","\u77e9\u5f62");q("\x26#xe61e;","\u692d\u5706");q("\x26#xe618;","\u89d2\u5ea6");q("\x26#xe637;","CT");q("\x26#xe629;","\u6587\u672c");q("\x26#xe62f;","\u7bad\u5934");q("\x26#xe9d8;","\u5de6\u6807\u8bb0");q("\x26#xE60E;","\u53f3\u6807\u8bb0");q("\x26#xe615;","\u5fc3\u80f8\u6bd4");q("\x26#xe622;","\u64a4\u9500");y();q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");y();q("\x26#xe64c;","\u6309\u952e\u8bf4\u660e")},t=function(a){switch(a.type){case "click":a.btntitle=a.target.title;h.msgtansform&&h.msgtansform(a);break;case "change":a.btntitle=a.target.title,h.msgtansform&&h.msgtansform(a)}},r=function(){function a(a){$.each(a,function(a,b){switch(b.title){case "\u91ca\u653e\u5de5\u5177":case "\u8c03\u7a97":case "\u6700\u5927\u5bc6\u5ea6\u6295\u5f71":case "\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71":case "CPR\u66f2\u7ebf":case "CPR\u76f4\u7ebf":case "\u5207\u56fe":case "\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71":case "\u653e\u7f29":case "\u79fb\u52a8":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "\u692d\u5706":case "\u89d2\u5ea6":case "CT":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u5fc3\u80f8\u6bd4":case "\u4eae\u5ea6/\u5bf9\u6bd4":c.push(b)}})}var c=[],d=$("."+g.item);a(d);d=$("."+g.menuitem);a(d);$.each(c,function(){b[this.title]=null;$(this).css({background:"","box-shadow":""})})},v=function(a){function b(a){$.each(a,function(a,b){switch(b.title){case "\u91ca\u653e\u5de5\u5177":case "\u5207\u56fe":case "CPR\u66f2\u7ebf":case "CPR\u76f4\u7ebf":case "\u8c03\u7a97":case "\u653e\u7f29":case "\u79fb\u52a8":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "\u6700\u5927\u5bc6\u5ea6\u6295\u5f71":case "\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71":case "\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71":case "\u692d\u5706":case "\u89d2\u5ea6":case "CT":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u5fc3\u80f8\u6bd4":case "\u4eae\u5ea6/\u5bf9\u6bd4":c.push(b)}})}var c=[],d=$("."+g.item);b(d);d=$("."+g.menuitem);b(d);for(d=0;d<c.length;d++)if(c[d].title===a)return!0;return!1},u=function(){function a(a){$.each(a,function(a,c){b.push(c)})}var b=[],c=$("."+g.item);a(c);c=$("."+g.menuitem);a(c);c=$("."+g.button);a(c);return b},q=function(a,b,c){g.item||(g.item=CBoBo.Plugin.GetRandom());a=$("\x3cspan class\x3d'icon_tool tool-item "+g.item+"' title\x3d'"+b+"'\x3e"+a+"\x3c/span\x3e").appendTo($("#"+g.toolbox));a.bind("click",function(a){t(a)});"[object Object]"==Object.prototype.toString.apply(c)&&a.css(c)},w=function(a,b,c){g.item||(g.item=CBoBo.Plugin.GetRandom());a=$("\x3cspan class\x3d'icon_tool tool-item "+g.item+"' title\x3d'"+b+"'\x3e"+a+"\x3cinput  type\x3d'range' min\x3d'1' max\x3d'10' step\x3d'1' value\x3d'1' style\x3d'width:100px' /\x3e\x3c/span\x3e\x3cp style\x3d'font-size:10px' id\x3d'Thickness'\x3e1mm\x3cp\x3e").appendTo($("#"+g.toolbox));a.change(function(a){$("#Thickness").html(a.target.value+"mm");a.target.title=b;t(a)});"[object Object]"==Object.prototype.toString.apply(c)&&a.css(c)},z=function(a,b,c){g.menuitem||(g.menuitem=CBoBo.Plugin.GetRandom());a=$("\x3cdiv class\x3d'tool-item "+g.menuitem+"' title\x3d'"+b+"'\x3e\x3cspan class\x3d'icon_tool' title\x3d'"+b+"'\x3e"+a+"\x3c/span\x3e\x3cspan title\x3d'"+b+"'\x3e\u25be\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+g.toolbox));a.bind("click",function(a){t(a)});"[object Object]"===Object.prototype.toString.apply(c)&&a.css(c);$("."+g.menuitem+" span").css({"pointer-events":"none",overflow:"hidden","white-space":"nowrap"})},A=function(a,b,c){g.menuitem||(g.menuitem=CBoBo.Plugin.GetRandom());a=$("\x3cdiv class\x3d'tool-item tool-item-div "+g.menuitem+"' title\x3d'"+b+" '\x3e\x3cspan title\x3d'"+b+"'\x3e\u25be\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+g.toolbox));a.bind("click",function(a){t(a)});"[object Object]"===Object.prototype.toString.apply(c)&&a.css(c);$("."+g.menuitem+" span").css({"pointer-events":"none",overflow:"hidden","white-space":"nowrap"})},y=function(a){g.line||(g.line=CBoBo.Plugin.GetRandom());var b=$("\x3cdiv class\x3d'"+g.line+"'\x3e\x3c/div\x3e").appendTo($("#"+g.toolbox));"[object Object]"==Object.prototype.toString.apply(a)&&b.css(a)},F=function(c,d,e){e=void 0===e?!0:e;var f=$("div[title\x3d'"+d+"']");null==f.html()&&(g.button||(g.button=CBoBo.Plugin.GetRandom()),f=$("\x3cdiv class\x3d'"+g.button+"' title\x3d'"+d+"'\x3e"+c+"\x3c/div\x3e").appendTo($("#"+g.bottonbox)),!e&&f.css("display","none"),f.bind("click mouseenter mouseout",function(c){if(!b[c.target.title])switch(c.type){case "mouseenter":f.css({color:"#33FFFF","text-shadow":"0 0 15px #33FFFF"});break;case "mouseout":f.css({color:"#efefef","text-shadow":""});break;case "click":G(c.target.title),a.msgtransform&&a.msgtransform(c)}}))},G=function(a){$("."+g.button).each(function(){var c=$(this);this.title==a?(b[this.title]=a,c.css({color:"#33FFFF","text-shadow":"0px 0px 20px #FFF","pointer-events":"none"})):(b[this.title]=null,c.css({animation:"",color:"#efefef","text-shadow":"","pointer-events":"auto"}))})};this.UpdateStyle=function(){var b=$(a.parent),c=$("."+g.item),d=$("."+g.menuitem),e=$("."+g.line);if("x"==a.axis){var f=b.height(),h=.66*f>>0,b=h/1.7>>0,f=(f-h)/1.5>>0;c.css({display:"block",padding:"3px",overflow:"hidden","font-size":b+"px",border:"1px solid #535353","float":"left",cursor:"pointer",margin:"0 "+f+"px","border-radius":"6px"});d.css({display:"block",padding:"3px",overflow:"hidden",margin:"0 "+f+"px","font-size":b+"px",border:"1px solid #535353","float":"left",cursor:"pointer","border-radius":"6px"});e.css({"border-left":"1px solid #383838",width:"1px",height:h+"px",margin:"0 "+f+"px","pointer-events":"none","float":"left"});b=.9*b>>0;$("."+g.button).css({width:3*b+"px",height:h+"px","float":"left",cursor:"pointer",margin:"0 2px","font-size":b+"px","text-align":"center","font-family":"Microsoft YaHei","line-height":h+"px","border-radius":"4px",border:"1px solid #535353"})}else h=.6*b.width()>>0,b=.6*h>>0,f=b/3>>0,c.css({display:"block",padding:"2px",width:h+"px",overflow:"hidden","font-size":b+"px",border:"1px solid #444",cursor:"pointer",margin:f+"px auto","border-radius":"6px"}),d.css({display:"block",padding:"2px",width:h+"px",overflow:"hidden",margin:f+"px auto","font-size":b+"px",border:"1px solid #444",cursor:"pointer","border-radius":"6px"}),e.css({"border-top":"1px solid #000",width:h+"px",height:"1px",margin:f+"px auto","pointer-events":"none"});$(".tool-item-div").css({"margin-left":"-10px"})};this.RequestToolBar=function(a,b,d){if(a!=h.type||b!=h.msgtansform||void 0!==d){l();switch(a){case CBoBo.TOOLMENU_JPG:F("2D","2D");G("2D");q("\x26#xe631;","\u91ca\u653e\u5de5\u5177");q("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");z("\x26#xe66d;","\u5e03\u5c40");q("\x26#xe644;","\u6062\u590d");q("\x26#xe670;","\u653e\u7f29");q("\x26#xe630;","\u79fb\u52a8");q("\x26#xe603;","\u8d1f\u50cf");z("\x26#xe602;","\u4f2a\u5f69");q("\x26#xe61b;","\u4eae\u5ea6/\u5bf9\u6bd4");q("\x26#xe60f;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_SERIES:n();break;case CBoBo.TOOLMENU_DESERIES:F("2D","2D");G("2D");q("\x26#xe631;","\u91ca\u653e\u5de5\u5177");q("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d");z("\x26#xe66d;","\u5e03\u5c40");q("\x26#xe644;","\u6062\u590d");q("\x26#xe606;","\u80f6\u7247\u6253\u5370");q("\x26#xe671;","DICOM\u4fe1\u606f");q("\x26#xe67a;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");y();q("\x26#xe670;","\u653e\u7f29");q("\x26#xe630;","\u79fb\u52a8");z("\x26#xe623;","\u65cb\u8f6c");y();q("\x26#xe603;","\u8d1f\u50cf");z("\x26#xe602;","\u4f2a\u5f69");y();q("\x26#xe61b;","\u8c03\u7a97");y();q("\x26#xe61f;","\u76f4\u7ebf");q("\x26#xe619;","\u77e9\u5f62");q("\x26#xe61e;","\u692d\u5706");q("\x26#xe618;","\u89d2\u5ea6");q("\x26#xe637;","CT");q("\x26#xe629;","\u6587\u672c");q("\x26#xe62f;","\u7bad\u5934");q("L","\u5de6\u6807\u8bb0");q("R","\u53f3\u6807\u8bb0");q("\x26#xe615;","\u5fc3\u80f8\u6bd4");q("\x26#xe622;","\u64a4\u9500");y();q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_PRINT_JPG:q("\x26#xe603;","\u8d1f\u50cf");q("\x26#xe644;","\u6062\u590d");q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");break;case CBoBo.TOOLMENU_PRINT_RADIATE:q("\x26#xe61f;","\u76f4\u7ebf");q("\x26#xe619;","\u77e9\u5f62");q("\x26#xe61e;","\u692d\u5706");q("\x26#xe618;","\u89d2\u5ea6");q("\x26#xe637;","CT");q("\x26#xe629;","\u6587\u672c");q("\x26#xe62f;","\u7bad\u5934");q("\x26#xe622;","\u64a4\u9500");y();z("\x26#xe623;","\u65cb\u8f6c");y();q("\x26#xe603;","\u8d1f\u50cf");q("\x26#xe644;","\u6062\u590d");q("\x26#xe653;","\u5220\u9664\u56fe\u50cf");y();q("\x26#xe67a;","\u663e/\u9690\u56db\u89d2\u4fe1\u606f");break;case CBoBo.TOOLMENU_MPR:l();m();q("\x26#xe61b;","\u5207\u9762\u8c03\u7a97");q("\x26#xe68b;","\u5341\u5b57\u5207\u9762");q("\x26#xe6ae;","CPR\u76f4\u7ebf");q("\x26#xe6f2;","CPR\u66f2\u7ebf");q("\x26#xe6ad;","\u5207\u56fe");q("\x26#xe611;","\u5012\u5e8f");y();q("\x26#xec68;","\u6700\u5927\u5bc6\u5ea6\u6295\u5f71");q("\x26#xec69;","\u6700\u5c0f\u5bc6\u5ea6\u6295\u5f71");q("\x26#xec6c;","\u5e73\u5747\u5bc6\u5ea6\u6295\u5f71");w("\x26#xe6077;","\u5c42\u539a");G("MPR");break;case CBoBo.TOOLMENU_AI:l();break;case CBoBo.TOOLMENU_VRT:l(),m(),q("\x26#xe920;","\u624b\u672f\u5200\u5185"),q("\x26#xe9c8;","\u624b\u672f\u5200\u5916"),q("\x26#xe628;","\u91cd\u7f6e\u4e09\u7ef4\u89c6\u56fe"),G("3D")}c.UpdateStyle();k=$.extend({},h);h.type=a;h.msgtansform=b}};this.Request2DToolBar=function(){c.RequestToolBar(f.type,f.msgtansform,!0)};this.RequestGrayToolBar=function(a,b){p||(n(),c.UpdateStyle(),p=!0);if(a!=h.type||b!=h.msgtansform){switch(a){case CBoBo.TOOLMENU_JPG:c.EnableButton("MPR",!1);c.EnableButton("\u91ca\u653e\u5de5\u5177",!0);c.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);c.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);c.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);c.EnableButton("\u6062\u590d",!0);c.EnableButton("\u5e8f\u5217\u64ad\u653e",!1);c.EnableButton("\u5b9a\u4f4d\u7ebf",!1);c.EnableButton("\u80f6\u7247\u6253\u5370",!0);c.EnableButton("DICOM\u4fe1\u606f",!1);c.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);c.EnableButton("\u653e\u7f29",!0);c.EnableButton("\u79fb\u52a8",!0);c.EnableButton("\u65cb\u8f6c",!1);c.EnableButton("\u8d1f\u50cf",!0);c.EnableButton("\u4f2a\u5f69",!0);c.EnableButton("\u8c03\u7a97",!0);c.EnableButton("\u76f4\u7ebf",!1);c.EnableButton("\u77e9\u5f62",!1);c.EnableButton("\u692d\u5706",!1);c.EnableButton("\u89d2\u5ea6",!1);c.EnableButton("CT",!1);c.EnableButton("\u6587\u672c",!1);c.EnableButton("\u7bad\u5934",!1);c.EnableButton("\u5de6\u6807\u8bb0",!1);c.EnableButton("\u53f3\u6807\u8bb0",!1);c.EnableButton("\u5fc3\u80f8\u6bd4",!1);c.EnableButton("\u64a4\u9500",!1);c.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_SERIES:c.EnableButton("MPR",!0);c.EnableButton("3D",!0);c.EnableButton("AI",!0);c.EnableButton("\u91ca\u653e\u5de5\u5177",!0);c.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);c.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);c.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);c.EnableButton("\u6062\u590d",!0);c.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);c.EnableButton("\u5b9a\u4f4d\u7ebf",!0);c.EnableButton("\u80f6\u7247\u6253\u5370",!0);c.EnableButton("DICOM\u4fe1\u606f",!0);c.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);c.EnableButton("\u653e\u7f29",!0);c.EnableButton("\u79fb\u52a8",!0);c.EnableButton("\u65cb\u8f6c",!0);c.EnableButton("\u8d1f\u50cf",!0);c.EnableButton("\u4f2a\u5f69",!0);c.EnableButton("\u8c03\u7a97",!0);c.EnableButton("\u76f4\u7ebf",!0);c.EnableButton("\u77e9\u5f62",!0);c.EnableButton("\u692d\u5706",!0);c.EnableButton("\u89d2\u5ea6",!0);c.EnableButton("CT",!0);c.EnableButton("\u6587\u672c",!0);c.EnableButton("\u7bad\u5934",!0);c.EnableButton("\u5de6\u6807\u8bb0",!0);c.EnableButton("\u53f3\u6807\u8bb0",!0);c.EnableButton("\u64a4\u9500",!0);c.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_DESERIES:c.EnableButton("MPR",!1);c.EnableButton("3D",!1);c.EnableButton("\u91ca\u653e\u5de5\u5177",!0);c.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);c.EnableButton("\u56fe\u50cf\u5e03\u5c40",!0);c.EnableButton("\u5e8f\u5217\u5e03\u5c40",!0);c.EnableButton("\u6062\u590d",!0);c.EnableButton("\u5e8f\u5217\u64ad\u653e",!1);c.EnableButton("\u5b9a\u4f4d\u7ebf",!1);c.EnableButton("\u80f6\u7247\u6253\u5370",!0);c.EnableButton("DICOM\u4fe1\u606f",!0);c.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);c.EnableButton("\u653e\u7f29",!0);c.EnableButton("\u79fb\u52a8",!0);c.EnableButton("\u65cb\u8f6c",!0);c.EnableButton("\u8d1f\u50cf",!0);c.EnableButton("\u4f2a\u5f69",!0);c.EnableButton("\u8c03\u7a97",!0);c.EnableButton("\u76f4\u7ebf",!0);c.EnableButton("\u77e9\u5f62",!0);c.EnableButton("\u692d\u5706",!0);c.EnableButton("\u89d2\u5ea6",!0);c.EnableButton("CT",!0);c.EnableButton("\u6587\u672c",!0);c.EnableButton("\u7bad\u5934",!0);c.EnableButton("\u5de6\u6807\u8bb0",!0);c.EnableButton("\u53f3\u6807\u8bb0",!0);c.EnableButton("\u64a4\u9500",!0);c.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_PRINT_JPG:c.EnableButton("\u91ca\u653e\u5de5\u5177",!0);c.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);c.EnableButton("\u5e03\u5c40",!0);c.EnableButton("\u6062\u590d",!0);c.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);c.EnableButton("\u5b9a\u4f4d\u7ebf",!0);c.EnableButton("\u80f6\u7247\u6253\u5370",!0);c.EnableButton("DICOM\u4fe1\u606f",!0);c.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);c.EnableButton("\u653e\u7f29",!0);c.EnableButton("\u79fb\u52a8",!0);c.EnableButton("\u65cb\u8f6c",!0);c.EnableButton("\u8d1f\u50cf",!0);c.EnableButton("\u4f2a\u5f69",!0);c.EnableButton("\u8c03\u7a97",!0);c.EnableButton("\u76f4\u7ebf",!0);c.EnableButton("\u77e9\u5f62",!0);c.EnableButton("\u692d\u5706",!0);c.EnableButton("\u89d2\u5ea6",!0);c.EnableButton("CT",!0);c.EnableButton("\u6587\u672c",!0);c.EnableButton("\u7bad\u5934",!0);c.EnableButton("\u5de6\u6807\u8bb0",!0);c.EnableButton("\u53f3\u6807\u8bb0",!0);c.EnableButton("\u5fc3\u80f8\u6bd4",!0);c.EnableButton("\u64a4\u9500",!0);c.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_PRINT_RADIATE:c.EnableButton("\u91ca\u653e\u5de5\u5177",!0);c.EnableButton("\u91cd\u65b0\u52a0\u8f7d",!0);c.EnableButton("\u5e03\u5c40",!0);c.EnableButton("\u6062\u590d",!0);c.EnableButton("\u5e8f\u5217\u64ad\u653e",!0);c.EnableButton("\u5b9a\u4f4d\u7ebf",!0);c.EnableButton("\u80f6\u7247\u6253\u5370",!0);c.EnableButton("DICOM\u4fe1\u606f",!0);c.EnableButton("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);c.EnableButton("\u653e\u7f29",!0);c.EnableButton("\u79fb\u52a8",!0);c.EnableButton("\u65cb\u8f6c",!0);c.EnableButton("\u8d1f\u50cf",!0);c.EnableButton("\u4f2a\u5f69",!0);c.EnableButton("\u8c03\u7a97",!0);c.EnableButton("\u76f4\u7ebf",!0);c.EnableButton("\u77e9\u5f62",!0);c.EnableButton("\u692d\u5706",!0);c.EnableButton("\u89d2\u5ea6",!0);c.EnableButton("CT",!0);c.EnableButton("\u6587\u672c",!0);c.EnableButton("\u7bad\u5934",!0);c.EnableButton("\u5de6\u6807\u8bb0",!0);c.EnableButton("\u53f3\u6807\u8bb0",!0);c.EnableButton("\u5fc3\u80f8\u6bd4",!0);c.EnableButton("\u64a4\u9500",!0);c.EnableButton("\u5220\u9664\u56fe\u50cf",!0);break;case CBoBo.TOOLMENU_MPR:l()}c.isFirst||(f=$.extend({},h),f.type=a,f.msgtansform=b,c.isFirst=!0);k=$.extend({},h);h.type=a;h.msgtansform=b}};this.ChangeBtnStatus=function(a,d){var e;a:{e=u();for(var f=0;f<e.length;f++){var g=e[f];switch(g.title){case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":case "\u91cd\u65b0\u52a0\u8f7d":case "\u6062\u590d":case "\u80f6\u7247\u6253\u5370":case "\u8d1f\u50cf":case "\u64a4\u9500":case "\u5220\u9664\u56fe\u50cf":continue}if(g.title==a){e=!0;break a}}e=!1}if(e){if(void 0!==d)d=!d;else a:{for(var h in b)if(b[h]==a){d=!0;break a}d=!1}if(v(a))return r(),"\u91ca\u653e\u5de5\u5177"===a&&(d=!1),c.ButtonStatus(a,!d),!d;c.ButtonStatus(a,!d)}};this.ButtonStatus=function(a,c){function d(a,b){var c;$.each(a,function(a,d){d.title==b&&(c=d)});return c}var e=$("."+g.item),e=d(e,a);e||(e=$("."+g.menuitem),e=d(e,a));e&&(c?(b[a]=a,$(e).css({background:"#777","box-shadow":"0 0 20px #aaa"})):($(e).css({background:"","box-shadow":""}),b[a]=null))};this.EnableButton=function(a,b){if(a){for(var c=u(),e,f=0;f<c.length;f++)if(c[f].title==a){e=c[f];break}e&&(a=$(e),b?(d[e.title]=null,a.css({color:"#efefef","pointer-events":""})):(d[e.title]=e.title,a.css({color:"gray","pointer-events":"none"})))}};this.BackToolBar=function(){if(k){this.RequestToolBar(k.type,k.msgtansform);for(var a in b){var e=b[a];e&&c.ButtonStatus(e,!0)}for(a in d)(e=d[a])&&c.EnableButton(e,!1)}};this.GetButtonDOM=function(a){var b;$("."+g.item).each(function(){this.title==a&&(b=this)});return b};this.IsEnable=function(a){for(var b in d)if(d[b]==a)return!1;return!0};(function(){g.bottonbox="bottonbox"+CBoBo.Plugin.GetRandom();g.toolbox="toolbox"+CBoBo.Plugin.GetRandom();$("\x3cdiv\x3e\x3cdiv id\x3d'"+g.bottonbox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+g.toolbox+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($(a.parent)).css({width:"100%",height:"100%",overflow:"hidden"});var b=$("#"+g.bottonbox),c=$("#"+g.toolbox);"x"==a.axis?a.bottonbox?(b.css({width:"9%",height:"100%",overflow:"hidden","float":"left",display:"flex","align-items":"center",color:"#efefef"}),c.css({width:"91%",height:"100%",overflow:"hidden","float":"left",display:"flex","align-items":"center",color:"#efefef"})):(b.hide(),c.css({width:"100%",height:"100%",overflow:"hidden","float":"left",display:"flex","align-items":"center",color:"#efefef"})):a.bottonbox?(b.css({width:"100%",height:"7%",overflow:"hidden",display:"flex","align-items":"center",color:"#efefef"}),c.css({width:"100%",height:"93%",overflow:"hidden",display:"flex","align-items":"center",color:"#efefef"})):(b.hide(),c.css({width:"100%",height:"100%",overflow:"hidden",color:"#efefef","text-align":"center"}))})()};CBoBo.View.LayoutCtrl=function(e){var c=this;this.ctrlId;this.tableId;this.specialId;this.trClass;this.tdClass;this.itemId=[];this.arrTD;this.bShow;var a,g=$.extend(!0,{msgtransform:null,radio:!1,specialbutton:!1},e);this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.tableId=CBoBo.Plugin.GetRandom();this.specialId=CBoBo.Plugin.GetRandom();this.radioId=CBoBo.Plugin.GetRandom();this.tdClass=CBoBo.Plugin.GetRandom();for(var a="\x3cdiv class\x3d'"+this.tdClass+"'\x3e\x3c/div\x3e",c="",e=0;6>e;e++)for(var g=0;6>g;g++)c+=a;$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e\x3cdiv id\x3d'"+this.radioId+"'\x3e\x3clabel\x3e\x3cinput name\x3d'cbobo' type\x3d'radio' value\x3d'1' checked/\x3e\u56fe\u50cf \x3c/label\x3e \x3clabel\x3e\x3cinput name\x3d'cbobo' type\x3d'radio' value\x3d'2' /\x3e\u5e8f\u5217 \x3c/label\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.tableId+"'\x3e"+c+"\x3c/div\x3e\x3cdiv id\x3d'"+this.specialId+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.Show=function(a){var b=$("#"+this.ctrlId);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(400))};this.UpdateStyle=function(){var a=$(window).width(),c=$(window).height(),e=$("#"+this.ctrlId),c=Math.max(a,c)/12>>0;117>c&&(c=117);a=c;if(g.radio){var k=.15*c;$("#"+this.radioId).height(k).width(c).show().css({"text-align":"center","font-size":"10px"});$("#"+this.radioId);a+=k}else $("#"+this.radioId).hide();e.css({width:c+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px",padding:"3px","z-index":9999999});this.arrTD=$("."+this.tdClass);c=c/7.78>>0;this.arrTD.css({border:"1px solid #585858",width:c+"px",height:c+"px",overflow:"hidden",float:"left",margin:(.1*c>>0)+"px"});if(g.specialbutton){e=$("#"+this.specialId);c=6*(c+4)-10;a-=c;c=c-.09*c>>0;k=a/7.5>>0;a-=k;e.css({width:c+"px",height:a+"px","border-top":"1px solid #b3b3b3","text-align":"center","margin-top":k+"px"});var f=c/7>>0,p=a-f>>1,l=f/6>>0;$.each(this.itemId,function(a,b){b=$("#"+b);b.css({display:"inline-block",color:"#585858","text-align":"center","line-height":f+"px","font-size":f+"px","margin-top":.7*p+"px",padding:l+"px"});0!=a&&b.css({"margin-left":p+"px"})})}else $("#"+this.specialId).hide()};this.SetPosition=function(a,c){$("#"+this.ctrlId).css({left:a+"px",top:c+"px"})};this.SpecialMenu=function(){this.PushItem(this.specialId,'"',"2*1");this.PushItem(this.specialId,",","1*2");this.PushItem(this.specialId,"H","3*N");this.PushItem(this.specialId,"G","N*3")};this.PushItem=function(a,c,e,g){var b=CBoBo.Plugin.GetRandom();this.itemId.push(b);$("\x3cspan class\x3d'rotate icon_tool' id\x3d'"+b+"' title\x3d'"+e+"'\x3e"+c+"\x3c/span\x3e").appendTo($("#"+a));void 0!=g&&$("#"+b).bind("click",g)};this.GetRadioValue=function(){return $("#"+this.radioId+" input:checked").val()};this.AddEvent=function(){$("#"+this.tableId).bind("mousemove click",function(a){switch(a.type){case "mousemove":$.each(c.arrTD,function(b,c){a.clientX>c.getBoundingClientRect().left&&a.clientY>c.getBoundingClientRect().top?c.style.background="#c6c6c6":c.style.background="#efefef"});break;case "click":var b=0,e=0;$.each(c.arrTD,function(a,c){c=$(c);6>a&&"rgb(198, 198, 198)"==c.css("background-color")&&e++;0==a&&"rgb(198, 198, 198)"==c.css("background-color")&&b++;5<a&&0==a%6&&"rgb(198, 198, 198)"==c.css("background-color")&&b++});sessionStorage.setItem("layout",b+","+e);console.log(b+","+e);null==g.msgtransform||0==b&&0==e||g.msgtransform({type:"click",target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:b,col:e,ctrltype:c.Type()})}});$("#"+this.ctrlId).bind("mouseleave",function(a){c.Show();a.btntitle=c.Type();a.btnforce=!1;g.msgtransform&&g.msgtransform(a)})};this.Type=function(b){if(void 0===b)return a;a=b};c.Create();c.SpecialMenu();c.UpdateStyle();c.AddEvent();!0};CBoBo.View.RotateCtrl=function(e){var c=this;this.ctrlId;this.itemClass;var a;this.bShow;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.itemClass=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool'\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u9006\u65f6\u9488'\x3e\x26#xe61d;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u987a\u65f6\u9488'\x3e\x26#xe61c;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u5de6\u53f3\u955c\u50cf'\x3e\x26#xe63a;\x3c/span\x3e\x3cspan class\x3d'"+this.itemClass+" rotate' title\x3d'\u4e0a\u4e0b\u955c\u50cf'\x3e\x26#xe639;\x3c/span\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),c=$("#"+this.ctrlId),b=Math.max(a,b)/15>>0;70>b&&(b=70);a=b/4>>0;17>a&&(a=17);c.css({width:b+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px","text-align":"center","z-index":999999999});c=$("."+this.itemClass);b=.171875*b>>0;c.css({display:"inline-block",padding:(.1*b>>0)+"px",overflow:"hidden","vertical-align":"top","font-size":b+"px",color:"#585858",border:"1px solid #b3b3b3","margin-top":(.03125*a>>0)+"px"})};this.AddEvent=function(e){$("."+this.itemClass).bind("click",function(b){void 0!=a&&a(b)});$("#"+this.ctrlId).bind("mouseleave",function(b){c.Show();b={usermsg:"ssssdafdsa132",btntitle:"\u65cb\u8f6c",btnforce:!1};a&&a(b)})};this.SetPosition=function(a,b){$("#"+this.ctrlId).css({left:a+"px",top:b+"px"})};this.Show=function(a){var b=$("#"+this.ctrlId);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(100))};a=e.msgtransform;c.Create();c.UpdateStyle();c.AddEvent();!0};CBoBo.View.PseudoColorCtrl=function(e){var c=this;this.ctrlId;this.tdClass;this.imgClass;this.bShow;var a;this.Home=function(){var a=window.config&&window.config.pseudoColorPath||"./static/dicomviewer/css/pseudocolor/";this.PushItem(0,a+"0.jpg","\u7070\u8272");this.PushItem(1,a+"1.jpg","\u5f69\u8679");this.PushItem(2,a+"2.jpg","\u9ed1\u4f53");this.PushItem(3,a+"3.jpg","\u9aa8\u9abc");this.PushItem(4,a+"4.jpg","\u5fc3\u810f");this.PushItem(5,a+"5.jpg","\u6d41\u52a8");this.PushItem(6,a+"6.jpg","Ge\u8272");this.PushItem(7,a+"7.jpg","\u7070\u8272\u5f69\u8679");this.PushItem(8,a+"8.jpg","\u70ed\u7eff");this.PushItem(9,a+"9.jpg","\u94ec\u94c1");this.PushItem(10,a+"10.jpg","\u70ed\u91d1\u5c5e");this.PushItem(11,a+"11.jpg","\u9971\u548c\u5ea61");this.PushItem(12,a+"12.jpg","\u9971\u548c\u5ea62");this.PushItem(13,a+"13.jpg","\u7ea2\u5916");this.PushItem(14,a+"14.jpg","\u58a8\u9ed1");this.PushItem(15,a+"15.jpg","\u9aa8\u9abc-\u808c\u8089");this.PushItem(16,a+"16.jpg","NIH");this.PushItem(17,a+"17.jpg","\u5f69\u86791");this.PushItem(18,a+"18.jpg","\u5f69\u86792");this.PushItem(19,a+"19.jpg","\u5f69\u86793");this.PushItem(20,a+"20.jpg","\u6bd4\u503c");this.PushItem(21,a+"21.jpg","\u7ea2\u8272\u8840\u7ba1");this.PushItem(22,a+"22.jpg","\u5149\u8c31");this.PushItem(23,a+"23.jpg","\u65af\u7279\u6069");this.PushItem(24,a+"24.jpg","UCLA")};this.PushItem=function(a,b,c){var d=$("."+this.imgClass).eq(a);d[0].onerror=function(){this.src=this.src.replace("static/","");this.onerror=void 0};d.attr("src",b);$("."+this.tdClass).eq(a).attr("title",c)};this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.tdClass=CBoBo.Plugin.GetRandom();this.imgClass=CBoBo.Plugin.GetRandom();for(var a="\x3cdiv class\x3d'"+this.tdClass+" pc-pseudocolor'\x3e\x3cimg class\x3d'"+this.imgClass+"' /\x3e\x3c/div\x3e",b="",c=0;5>c;c++)for(var e=0;5>e;e++)b+=a;$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e"+b+"\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),b=$(window).height(),c=$("#"+this.ctrlId),a=Math.max(a,b)/10>>0;151>a&&(a=151);c.css({width:a+"px",height:a+"px",background:"#dcdcdc",border:"1px solid #fff","border-radius":"4px","z-index":999999999});c=.188*a>>0;a=.8*c>>0;$("."+this.tdClass).width(c).height(c).css({border:"1px solid #b3b3b3",overflow:"hidden",position:"relative","float":"left"});$("."+this.imgClass).width(a).height(a).css({position:"absolute",margin:"auto",left:0,top:0,bottom:0,right:0,"pointer-events":"none"})};this.AddEvent=function(e){$("."+this.tdClass).bind("click",function(b){void 0!=a&&a(b)});$("#"+this.ctrlId).bind("mouseleave",function(b){c.Show();b={usermsg:"sssssa2ss123sa",btntitle:"\u4f2a\u5f69",btnforce:!1};a&&a(b)})};this.SetPosition=function(a,b){$("#"+this.ctrlId).css({left:a+"px",top:b+"px"})};this.Show=function(a){var b=$("#"+this.ctrlId);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(400))};a=e.msgtransform;c.Create();c.Home();c.UpdateStyle();c.AddEvent();!0};CBoBo.View.LableCtrl=function(){this.ctrlId;this.bShow=!1;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+this.ctrlId+"'\x3e\x3ctextarea autofocus\x3e\x3c/textarea\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute","min-width":"180px","min-height":"36px","z-index":99999999});$("#"+this.ctrlId+" textarea").css({width:"100%",height:"100%","background-color":"rgba(0,0,0,0.2)",color:"#FFF",padding:"0",margin:"0"});$("#"+this.ctrlId).bind("click",function(e){e.stopPropagation()})};this.SetPosition=function(e,c){e-=2;c-=4;$("#"+this.ctrlId).css({left:e+"px",top:c+"px"})};this.Show=function(e){this.bShow=e;var c=$("#"+this.ctrlId);e?c.show():c.hide()};this.GetValue=function(){return $("#"+this.ctrlId+" textarea").val()};this.SetValue=function(e){$("#"+this.ctrlId+" textarea").val(e)};this.Create();!0};CBoBo.View.wwCtrl=function(e){var c=this;this.ctrlId;this.itemClass;var a,g;this.bShow;g=e.modalityType;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.itemClass=CBoBo.Plugin.GetRandom();$("CT"==g?"\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool icon_ww_tool'\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'CustomWWWC'\x3e\u81ea\u5b9a\u4e49\u7a97\u5bbd\u7a97\u4f4d\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Abodmen'\x3eCT Abodmen\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Lung'\x3eCT Lung\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Brain'\x3eCT Brain\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Bone'\x3eCT Bone\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Chest'\x3eCT Chest\x3c/a\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'Head/Neck'\x3eCT Head/Neck\x3c/a\x3e\x3c/div\x3e":"\x3cdiv id\x3d'"+this.ctrlId+"' class\x3d'icon_tool icon_ww_tool '\x3e\x3ca class\x3d'"+this.itemClass+" ' title\x3d'CustomWWWC'\x3e\u81ea\u5b9a\u4e49\u7a97\u5bbd\u7a97\u4f4d\x3c/a\x3e\x3c/div\x3e").appendTo($("body"));$("#"+this.ctrlId).css({position:"absolute"})};this.UpdateStyle=function(){var a=$(window).width(),c=$(window).height(),e=$("#"+this.ctrlId),a=Math.max(a,c)/15>>0;70>a&&(a=70);c=a/4>>0;17>c&&(c=17);e.css({width:a+"px",background:"#121212","border-bottom":"1px solid #222","border-left":"1px solid #222","border-right":"1px solid #222","border-radius":"4px","text-align":"center","z-index":999999999});$("."+this.itemClass).css({display:"block",padding:(.1*(.171875*a>>0)>>0)+"px",overflow:"hidden","vertical-align":"top","font-size":"16px",color:"#fff","margin-top":(.03125*c>>0)+"px",cursor:"pointer"})};this.AddEvent=function(b){$("."+this.itemClass).bind("click",function(b){void 0!=a&&a(b)});$("#"+this.ctrlId).bind("mouseleave",function(b){c.Show();b={usermsg:"ssssdafdsa132312",btntitle:"\u81ea\u5b9a\u4e49\u8c03\u7a97 ",btnforce:!1};a&&a(b)})};this.SetPosition=function(a,c){$("#"+this.ctrlId).css({left:a+"px",top:c+"px"})};this.Show=function(a){var b=$("#"+this.ctrlId);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(100))};a=e.msgtransform;c.Create();c.UpdateStyle();c.AddEvent();!0};CBoBo.View.Thumb=function(e){this.studyuid;this.bSerises;this.horv;this.arrId={};this.bFirst=this.bItemShow=!1;this.parentElem;this.seriesLen=0;this.msgTransform;this.bthumbDirect=!0;this.thumbListWidth;this.AnalysisParam(e);this.Init();this.Create();this.AddEvent();this.ShowItem(!0);this.OpenStyle();!0};CBoBo.View.Thumb.prototype.Init=function(){this.arrId.thumbitem="thumbitem"+CBoBo.Plugin.GetRandom();this.arrId.head=CBoBo.Plugin.GetRandom();this.arrId.info=CBoBo.Plugin.GetRandom();this.arrId.mode=CBoBo.Plugin.GetRandom();this.arrId.time=CBoBo.Plugin.GetRandom();this.arrId.arrow=CBoBo.Plugin.GetRandom();this.arrId.listbox="listbox"+CBoBo.Plugin.GetRandom();this.arrId.listcontain="listcontain"+CBoBo.Plugin.GetRandom();this.arrId.itemid=[];this.arrId.seriesitem="seriesitem"+CBoBo.Plugin.GetRandom();this.arrId.seriesinfo=CBoBo.Plugin.GetRandom();this.arrId.seriesinfoseries=CBoBo.Plugin.GetRandom();this.arrId.seriesimgbox=CBoBo.Plugin.GetRandom();this.arrId.seriesimg="s"+CBoBo.Plugin.GetRandom();this.arrId.progressbar=CBoBo.Plugin.GetRandom();this.arrId.progressparent=CBoBo.Plugin.GetRandom();this.arrId.progress=CBoBo.Plugin.GetRandom();this.arrId.progresspercent=CBoBo.Plugin.GetRandom()};CBoBo.View.Thumb.prototype.Create=function(){this.CreateBox();this.CreateHeadBox();this.CreateListBox()};CBoBo.View.Thumb.prototype.CreateBox=function(){$("\x3cdiv id\x3d'"+this.arrId.thumbitem+"'\x3e\x3c/div\x3e").appendTo($(this.parentElem))};CBoBo.View.Thumb.prototype.CreateHeadBox=function(){$("\x3cdiv id\x3d'"+this.arrId.head+"'\x3e\x3cspan class\x3d'"+this.arrId.info+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.info+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.info+" "+this.arrId.time+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.arrow+" icon_tool'\x3e\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.thumbitem))};CBoBo.View.Thumb.prototype.CreateListBox=function(){$("\x3cdiv id\x3d'"+this.arrId.listbox+"'\x3e\x3cdiv id\x3d'"+this.arrId.listcontain+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.thumbitem))};CBoBo.View.Thumb.prototype.SetHeadInfo=function(e,c,a){var g=$("#"+this.arrId.thumbitem+" ."+this.arrId.info);g.eq(0).html(e).attr("title",e);g.eq(1).html(c).attr("title",c);g.eq(2).html(a).attr("title",a)};CBoBo.View.Thumb.prototype.SetItemInfo=function(e,c,a){if(void 0===e)throw"SetItemInfo:mark is undefined.";"string"!==typeof e&&(e=e.toString());e=e.replace(/\./g,"");e=$("#"+e+" ."+this.arrId.seriesinfo);e.eq(0).html(c).attr("title",c);e.eq(1).html(a).attr("title",a)};CBoBo.View.Thumb.prototype.SetItemIcon=function(e,c,a,g){var b=this;if(void 0===e)throw"SetItemIcon:mark is undefined.";"string"!==typeof e&&(e=e.toString());e=e.replace(/\./g,"");$("#"+e+" img").attr("src",c).attr("title",a).click(function(a){a.series=g;b.msgTransform(a)})};CBoBo.View.Thumb.prototype.SetProgress=function(e,c){if(void 0===e)throw"SetProgress:progressMark is undefined.";"string"!==typeof e&&(e=e.toString());e=e.replace(/\./g,"");0>c&&(c=0);if(99<c)$("#"+e+" ."+this.arrId.progressbar).hide();else{$("#"+e+" ."+this.arrId.progressbar).show();var a=$("."+this.arrId.progressparent).width()*c/100>>0;$("#"+e+" ."+this.arrId.progress).width(a);$("#"+e+" ."+this.arrId.progresspercent).html(c+"%")}};CBoBo.View.Thumb.prototype.SetHeadArrow=function(e){var c=$("#"+this.arrId.head+" ."+this.arrId.arrow);e?(c.css({color:"#1d1d1d"}),c.html("\x26#xe646;")):(c.css({color:"#c5c5c5"}),c.html("\x26#xe64a;"))};CBoBo.View.Thumb.prototype.PushSerisesItem=function(e){if(void 0===e)throw"PushSerisesItem:progressMark is undefined.";"string"!==typeof e&&(e=e.toString());e=e.replace(/\./g,"");this.seriesLen++;$("\x3cdiv class\x3d'"+this.arrId.seriesitem+"' id\x3d'"+e+"'\x3e\x3cspan class\x3d'"+this.arrId.seriesinfo+"'\x3e\x3c/span\x3e\x3cspan class\x3d'"+this.arrId.seriesinfo+" "+this.arrId.seriesinfoseries+"'\x3e\x3c/span\x3e\x3cdiv class\x3d'"+this.arrId.seriesimgbox+"' style\x3d'position:relative'\x3e\x3cimg class \x3d'"+this.arrId.seriesimg+"'/\x3e \x3cdiv class\x3d'"+this.arrId.progressbar+"'\x3e\x3cdiv class\x3d'"+this.arrId.progressparent+"'\x3e\x3cdiv class\x3d'"+this.arrId.progress+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan class\x3d'"+this.arrId.progresspercent+"'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+this.arrId.listcontain))};CBoBo.View.Thumb.prototype.UpdateSeriesData=function(){var e=this,c=" ."+this.arrId.seriesimg;if(CBoBo.Plugin.GetBrowserInfo().isMobile)touch.on(c,"doubletap",function(a){void 0!=e.msgTransform&&e.msgTransform(a)});else $(c).bind("dblclick",function(a){void 0!=e.msgTransform&&e.msgTransform(a)});interact("."+this.arrId.seriesimg).draggable({onstart:function(a){$("#special2016920dragimg").remove();var c=$(a.target).clone();$("body").append(c);var b=c.width(),d=c.height();c.attr("id","special2016920dragimg").css({"z-index":"99999999999",position:"absolute",left:a.pageX-b/2+"px",top:a.pageY-d/2+"px"})},onmove:function(a){var c=$("#special2016920dragimg")[0],b=(parseFloat(c.getAttribute("data-x"))||0)+a.dx;a=(parseFloat(c.getAttribute("data-y"))||0)+a.dy;c.style.webkitTransform=c.style.transform="translate("+b+"px, "+a+"px)";c.setAttribute("data-x",b);c.setAttribute("data-y",a)},onend:function(a){$("#special2016920dragimg").remove()}})};CBoBo.View.Thumb.prototype.UpdateStyleL=function(){var e=$(this.parentElem),c=e.width(),a=e.height(),e=$("#"+this.arrId.thumbitem),g;g=this.bFirst?0:.0476*c>>0;e.width(c).css({overflow:"hidden","padding-top":g+"px","border-bottom":"1px solid #6a6a6a",background:"#282828"});e=$("#"+this.arrId.head);e.width(c);var b=.57*c>>0;e.height(b).css({cursor:"pointer"});var d=$("."+this.arrId.info),h=b/3>>0;d.height(h);d.width(c);e=.11*c>>0;d.css({"line-heihgt":h+"px",display:"block","text-overflow":"ellipsis","white-space":"nowrap","text-align":"center","font-size":e+"px"});$("."+this.arrId.time).width(.8*c>>0).css({display:"inline-block"});$("."+this.arrId.arrow).width(.2*c>>0).height(h).css({display:"inline-block","font-size":e+"px","line-height":h+"px","text-align":"center","pointer-events":"none"});var d=$("."+this.arrId.seriesitem),h=.08*c>>0,k=.06*c>>0;d.height(1.1*c>>0).width(c-k).css({"border-bottom":"1px solid #373737","padding-top":h+"px","padding-left":k+"px","padding-bottom":"2px"});a=a-b-g-5;g=$("#"+this.arrId.listbox);c-=4;g.width(c).css({border:"2px solid #cccccc",background:"#535353",height:a+"px",overflow:"hide",position:"relative"});$("#"+this.arrId.listcontain).css({position:"absolute",width:"100%",height:"100%"});$("#"+this.arrId.listcontain).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:400,mouseWheelPixels:800,theme:"thumbScroll",documentTouchScroll:!0,moveDragger:!1,advanced:{updateOnContentResize:!0}});$("."+this.arrId.seriesinfo).css({display:"block",color:"#c5c5c5","text-overflow":"ellipsis","white-space":"nowrap","text-align":"left","font-size":e+"px",cursor:"default"});a=$("."+this.arrId.seriesimg);g=.723*c>>0;a.width(g).height(g).css({cursor:"pointer"});b=$("."+this.arrId.seriesimgbox);a=.8*c>>0;c=.04*c>>0;b.width(a).height(g).css({"text-align":"center",background:"#3a3a3a",margin:c+"px 0px"});c=$("."+this.arrId.progressbar);b=.1866*g>>0;c.width(a).height(b).css({position:"absolute",left:0,bottom:"2px",color:"#33ffff","text-align":"left",opacity:0});g=$("."+this.arrId.progressparent);c=.66*b>>0;a=.6*a>>0;g.height(c).width(a).css({"border-bottom":"1px solid #757575","border-right":"1px solid #757575","border-radius":"4px",background:"#363535",display:"inline-block","margin-bottom":"3px"});a=$("."+this.arrId.progress);g=.66*c>>0;c=c-g>>1;a.height(g).css({margin:c+"px 1px",background:"#33ffff"});$("."+this.arrId.progresspercent).css({"font-size":e+"px","vertical-align":"top"})};CBoBo.View.Thumb.prototype.UpdateStyleB=function(){var e=$(this.parentElem);e.width();var e=e.height(),e=e-2,c=$("#"+this.arrId.thumbitem),a;a=this.bFirst?0:.0476*e>>0;c.height(e).css({overflow:"hidden","padding-left":a+"px","border-right":"1px solid #6a6a6a",background:"#282828",display:"inline-block"});a=$("#"+this.arrId.head);c=1.2*e>>0;a.width(c-4).height(e-4).css({cursor:"pointer",display:"inline-block",border:"2px solid rgba(0,0,0,0)","white-space":"pre"});a=$("."+this.arrId.info);var g=e/3>>0;a.width(c);a.height(g);c=.11*e>>0;10>c&&(c=10);a.css({"line-height":g+"px",display:"block","text-overflow":"ellipsis","text-align":"center","font-size":c+"px"});var b=$("."+this.arrId.seriesitem);a=1.1*e>>0;g=.08*e>>0;b.height(.9*e).width(a).css({"border-right":"1px solid #373737","padding-left":g+"px","padding-right":g+"px",display:"inline-block","text-align":"center","vertical-align":"top"});b=4<this.seriesLen?4:this.seriesLen;1>b&&(b=1);g=b*(a+2*g+1);b=$("#"+this.arrId.listbox);e-=4;this.thumbListWidth=g;b.width(g).height(e).css({border:"2px solid #cccccc",background:"#535353",overflow:"hidden",position:"relative",display:"inline-block"});$("#"+this.arrId.listcontain).css({position:"absolute",height:"100%",width:g+"px"});$("#"+this.arrId.listcontain).mCustomScrollbar({axis:"x",scrollInertia:800,theme:"thumbScroll",documentTouchScroll:!0,advanced:{updateOnContentResize:!0}});$("."+this.arrId.seriesinfo).height(Math.round(.3076923076923076*e)).css({color:"#c5c5c5","text-overflow":"ellipsis","white-space":"nowrap","text-align":"center","font-size":c+"px",cursor:"default",display:"block"});$("."+this.arrId.seriesinfoseries).css({display:"none"});g=$("."+this.arrId.seriesimgbox);b=.6296296296296297*e|0;a=.8*a|0;g.height(b).width(a).css({"text-align":"center",background:"#3a3a3a",margin:"0 auto"});$("."+this.arrId.seriesimg).width(a-8).height(b).css({cursor:"pointer"});a=$("."+this.arrId.progressbar);e=.3333333333333333*e>>0;18>e&&(e=18);a.height(e).css({width:"100%",position:"absolute",left:"0px",bottom:"1px",color:"#33ffff","text-align":"left"});a=$("."+this.arrId.progressparent);g=.3*e>>0;e=1.333333333333333*e>>0;a.height(g).width(e).css({"border-bottom":"1px solid #757575","border-right":"1px solid #757575","border-radius":"4px",background:"#363535",display:"inline-block"});$("."+this.arrId.progress).height(g).css({margin:"1px",background:"#33ffff"});$("."+this.arrId.progresspercent).css({"font-size":c+"px",width:"20px"})};CBoBo.View.Thumb.prototype.ClearStyle=function(){$("#"+this.arrId.thumbitem).removeAttr("style");$("#"+this.arrId.head).removeAttr("style");$("."+this.arrId.info).removeAttr("style");$("."+this.arrId.time).removeAttr("style");$("."+this.arrId.arrow).removeAttr("style");$("."+this.arrId.seriesitem).removeAttr("style");$("#"+this.arrId.listbox).removeAttr("style");$("#"+this.arrId.listcontain).removeAttr("style");$("#"+this.arrId.listcontain).mCustomScrollbar("destroy");$("."+this.arrId.seriesinfo).removeAttr("style");$("."+this.arrId.seriesimg).removeAttr("style")};CBoBo.View.Thumb.prototype.UpdateStyle=function(){var e=$(window).width(),c=$(window).height();this.ClearStyle();e>c?(this.UpdateStyleL(),this.bthumbDirect=!0):(this.UpdateStyleB(),this.bthumbDirect=!1);this.OpenStyle();this.ShowItem(!0)};CBoBo.View.Thumb.prototype.ShowItem=function(e){var c=$("#"+this.arrId.listbox);this.bItemShow?e?c.show():this.bthumbDirect?c.slideDown(500):(c.show().css({transition:"width 500ms"}),c.width(this.thumbListWidth)):e?c.hide():this.bthumbDirect?c.slideUp(500):(c.css({transition:"width 500ms"}),setTimeout(function(){c.hide()},400),c.width(0))};CBoBo.View.Thumb.prototype.OpenStyle=function(){var e=$("#"+this.arrId.head),c=$("."+this.arrId.info);this.bItemShow?(this.SetHeadArrow(!0),c.css({color:"#1d1d1d",transition:"all 0.5s ease-in"}),e.css({background:"#cccccc"})):(this.SetHeadArrow(!1),c.css({color:"#c5c5c5"}),e.css({background:"#373737"}))};CBoBo.View.Thumb.prototype.First=function(){this.bFirst=!0;$("#"+this.arrId.thumbitem).css({"padding-top":"0px"});this.bItemShow=!0;this.ShowItem(!0);this.OpenStyle()};CBoBo.View.Thumb.prototype.AnalysisParam=function(e){this.parentElem=e.parentelem;this.msgTransform=e.msgtransform};CBoBo.View.Thumb.prototype.AddEvent=function(){function e(c){void 0!=a.msgTransform&&(c.tag="head",c.studyuid=a.studyuid,a.msgTransform(c))}function c(c){void 0!=a.msgTransform&&(c.tag="head",c.studyuid=a.studyuid,c.parentid=a.arrId.head,a.msgTransform(c));c.stopPropagation()}var a=this;CBoBo.Plugin.GetBrowserInfo().isMobile?($("#"+a.arrId.head).bind("touchstart",e),$("."+this.arrId.info).bind("touchstart",c)):($("#"+a.arrId.head).bind("mousedown",e),$("."+this.arrId.info).bind("mousedown",c))};CBoBo.View.Thumb.prototype.Show=function(e){e?$("#"+this.arrId.thumbitem).show():$("#"+this.arrId.thumbitem).hide()};CBoBo.View.Thumb.prototype.Destroy=function(){$("#"+this.arrId.thumbitem).remove()};CBoBo.View.ThumbManager=function(e){var c=$.extend(!0,{parent:null,msgtransform:null},e),a={};this.ThumbMsg=function(e){function b(){var b=e.parentid||e.target.id;$.each(a,function(a,c){null!==c&&void 0!==c&&(c.bItemShow=c.arrId.head==b?!c.bItemShow:!1,c.ShowItem(),c.OpenStyle())})}switch(e.type){case "touchstart":b();break;case "mousedown":"head"==e.tag&&1===e.which&&b()}null!==c.msgtransform&&c.msgtransform(e)};this.OpenLastThumb=function(){var c=Object.keys(a).length-1,b=0;$.each(a,function(a,e){null!==e&&void 0!==e&&(e.bItemShow=b==c?!0:!1,e.ShowItem(),e.OpenStyle(),b++)})};this.AddThumb=function(e){var b=new CBoBo.View.Thumb({parentelem:c.parent,msgtransform:this.ThumbMsg});b.studyuid=e;return a[e]=b};this.GetThumb=function(c){return a[c]};this.ForEach=function(c){if(c instanceof Function)for(var b in a)c(a[b],b)};this.DeleteThumb=function(c){var b=a[c];void 0!==b&&(b.Destroy(),a[c]=null)}};CBoBo.View.DVCanvas=function(e){this.canvas;this.opt=$.extend({msgtransform:null,parent:null,bdrag:!1},e);this.boxId;this.canvasId;this.bFocus=!1;this.bAnimatStop=!0;this.arrCornerInfo={};this.cornerclass;this.Create();this.GetCanvas()};CBoBo.View.DVCanvas.prototype.Destroy=function(){this.imgProcessWorker&&this.imgProcessWorker.terminate();$("#"+this.boxId).remove()};CBoBo.View.DVCanvas.prototype.Clear=function(){var e=this.GetCanvas();void 0!=e&&e.getContext("2d").clearRect(0,0,e.width,e.height)};CBoBo.View.DVCanvas.prototype.Msg=function(e){e.self=this;this.opt.msgtransform&&this.opt.msgtransform(e)};CBoBo.View.DVCanvas.prototype.GetId=function(e){switch(e){case "box":return this.boxId;case "canvas":return this.canvasId}};CBoBo.View.DVCanvas.prototype.Float=function(e){e&&$("#"+this.boxId).css("float",e)};CBoBo.View.DVCanvas.prototype.GetCanvas=function(){void 0===this.canvas&&(this.canvas=document.getElementById(this.canvasId));return this.canvas};CBoBo.View.DVCanvas.prototype.Create=function(){null!=this.opt.parent&&(this.canvasId="c"+CBoBo.Plugin.GetRandom(),this.boxId="p"+CBoBo.Plugin.GetRandom(),this.cornerclass=CBoBo.Plugin.GetRandom(),$("\x3cdiv id\x3d'"+this.boxId+"'\x3e\x3ccanvas id\x3d'"+this.canvasId+"'\x3e\x3c/canvas\x3e\x3c/div\x3e").appendTo($(this.opt.parent)),$("#"+this.boxId).css({float:"left",margin:"1px",border:"2px solid #595959"}),$("#"+this.canvasId).css({cursor:"default"}),this.AddEvent())};CBoBo.View.DVCanvas.prototype.SetRange=function(e,c){var a="#"+this.boxId;0==e||0==c?$(a).hide():($(a).show(),e>>=0,c>>=0,$("#"+this.boxId).width(e).height(c).css({position:"relative"}),a=this.GetCanvas(),a.width=e,a.height=c)};CBoBo.View.DVCanvas.prototype.AddEvent=function(e){var c=this;e=CBoBo.Plugin.GetBrowserInfo();var a="#"+this.canvasId;e.isMobile?($(a).bind("touchstart touchmove touchend",function(a){a.preventDefault();c.Msg(a)}),touch.on(a,"pinchstart pinch pinchend doubletap",function(a){"doubletap"==a.type&&(a.preventDefault(),a.stopPropagation());c.Msg(a)})):($(a).bind("dblclick click mousedown mousemove mouseup mouseout mousewheel",function(a){c.Msg(a)}),$(a).bind("touchstart touchmove touchend",function(a){c.Msg(a)}),touch.on(a,"pinchstart pinch pinchend",function(a){c.Msg(a)}));interact("#"+this.boxId).dropzone({ondragenter:function(a){$("#"+a.target.id+" canvas").css({"background-color":"rgba(255,255,255,0.1)"})},ondragleave:function(a){$("#"+a.target.id+" canvas").css({"background-color":""})},ondrop:function(a){var b=a.relatedTarget;$("#"+a.target.id+" canvas").css({"background-color":""});c.opt.msgtransform&&c.opt.msgtransform({type:"drag",imgId:b.title,canvas:c})}})};CBoBo.View.DVCanvas.prototype.StartLoadingAnimation=function(){if(this.bAnimatStop){var e=function(a,b,c,h){function d(f,g){if(!b[f]){if(!a[f]){var h="function"==typeof require&&require;if(!g&&h||h)return h(f,!0);g=Error("Cannot find module '"+f+"'");throw g.code="MODULE_NOT_FOUND",g;}g=b[f]={exports:{}};a[f][0].call(g.exports,function(b){var c=a[f][1][b];return d(c?c:b)},g,g.exports,e,a,b,c)}return b[f].exports}d(c);return d},c=this.GetCanvas();this.bAnimatStop=!1;var a=this;e({1:[function(a,b,c){var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();Object.defineProperty(c,"__esModule",{value:!0});var e=(a=a("./objects/ParticleContainer"))&&a.__esModule?a:{"default":a};a=function(){function a(b,c,d){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.$canvas=b;this.context=this.$canvas.getContext("2d");this.height=this.width=0;this.params={};this.lastTime=this.tick=0;this.particleContainer=new e.default(10,c,d);this.resize(c,d)}d(a,[{key:"resize",value:function(a,b){this.width=a;this.height=b;this.particleContainer.resize(a,b);this.$canvas.width=a*window.devicePixelRatio;this.$canvas.height=b*window.devicePixelRatio}},{key:"render",value:function(){var a=Date.now();this.tick+=(a-this.lastTime)/1E3;this.context.clearRect(0,0,this.width,this.height);this.particleContainer.update(this.context,this.tick);this.lastTime=a}}]);return a}();c.default=a},{"./objects/ParticleContainer":6}],2:[function(e,b,d){function g(){a.bAnimatStop||((0,k.default)(g),f.render())}b=(b=e("./Scene"))&&b.__esModule?b:{"default":b};var k=(e=e("raf"))&&e.__esModule?e:{"default":e},f=new b.default(c,c.width,c.height);window.addEventListener("resize",function(){a.bAnimatStop||f.resize(c.width,c.height)});g()},{"./Scene":1,raf:9}],3:[function(a,b,c){var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();Object.defineProperty(c,"__esModule",{value:!0});var e=(a=a("./Vector2"))&&a.__esModule?a:{"default":a};a=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?0:arguments[0],c=1>=arguments.length||void 0===arguments[1]?0:arguments[1],d=2>=arguments.length||void 0===arguments[2]?5:arguments[2],f=3>=arguments.length||void 0===arguments[3]?"#000":arguments[3],g=4>=arguments.length||void 0===arguments[4]?0:arguments[4];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var h=5>=arguments.length||void 0===arguments[5]?1:arguments[5];this.position=new e.default(b,c);this.velocity=new e.default;this.acceleration=new e.default;this.friction=h;this.gravity=g;this.scale=window.devicePixelRatio;this.radius=d;this.color=f}d(a,[{key:"accelerate",value:function(a,b){this.acceleration.x=a;this.acceleration.y=b}},{key:"update",value:function(){this.velocity.add(this.acceleration);this.velocity.multiply(this.friction);this.velocity.y+=this.gravity;this.position.add(this.velocity)}},{key:"draw",value:function(a){a.scale(window.devicePixelRatio,window.devicePixelRatio);a.fillStyle=this.color;a.beginPath();a.arc(this.position.x,this.position.y,this.radius*this.scale,0,2*Math.PI,!1);a.fill()}}]);return a}();c.default=a},{"./Vector2":4}],4:[function(a,b,c){var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();Object.defineProperty(c,"__esModule",{value:!0});a=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?0:arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var c=1>=arguments.length||void 0===arguments[1]?0:arguments[1];this.x=b;this.y=c}d(a,[{key:"invert",value:function(){this.x=-this.x;this.y=-this.y}},{key:"add",value:function(a){this.x+=a.x;this.y+=a.y}},{key:"subtract",value:function(a){this.x-=a.x;this.y-=a.y}},{key:"multiply",value:function(a){this.x*=a;this.y*=a}},{key:"divide",value:function(a){this.x/=a;this.y/=a}},{key:"equals",value:function(a){return this.x===a.x&&this.y===a.y}},{key:"dot",value:function(a){return this.x*a.x+this.y*a.y}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y)}},{key:"distance",value:function(a){return Math.sqrt(this.distSq(a))}},{key:"normalize",value:function(){return this.divide(this.length())}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"clone",value:function(){return new Vector(this.x,this.y)}}]);return a}();c.default=a},{}],5:[function(a,b,c){function d(a,b,c){return(a-b)/(c-b)}function e(a,b,c){return(c-b)*a+b}Object.defineProperty(c,"__esModule",{value:!0});c.normalize=d;c.lerp=e;c.map=function(a,b,c,g,h){return e(d(a,b,c),g,h)};c.clamp=function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))};c.distance=function(a,b,c,d){a=c-a;b=d-b;return Math.sqrt(a*a+b*b)};c.inRange=function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)};c.degreesToRads=function(a){return a/180*Math.PI};c.radsToDegrees=function(a){return 180*a/Math.PI};c.randomRange=function(a,b){return a+Math.random()*(b-a)}},{}],6:[function(a,b,c){var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();Object.defineProperty(c,"__esModule",{value:!0});var e=(b=a("../lib/Particle"))&&b.__esModule?b:{"default":b},f=a("../lib/math");a=function(){function a(b,c,d){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.width=c;this.height=d;this.nbParticle=b;this.pool=[];this.angles=[];this.radius=Math.min(c,d)>>4;this.slice=0;this.sliceTo=2*Math.PI/this.nbParticle;this.speed=0;this.dir=1;this.populate()}d(a,[{key:"populate",value:function(){for(var a,b,c,d=0;d<this.nbParticle;d++){c=this.slice*d;a=.5*this.width+Math.cos(c)*this.radius;b=.5*this.height+Math.sin(c)*this.radius;var f=this.radius>>4;1>f&&(f=1);a=new e.default(a,b,f);a.color="#848282";this.pool.push(a);this.angles.push(c)}}},{key:"resize",value:function(a,b){this.width=a;this.height=b}},{key:"update",value:function(a,b){var c=this;this.slice>=this.sliceTo-.001&&1===this.dir&&.5<b&&(this.dir=-1);.01>=this.slice&&-.01<=this.slice&&-1===this.dir&&(this.dir=1);this.slice=(0,f.lerp)(this.dir*Math.abs(Math.sin(.8*b)),0,this.sliceTo);this.pool.forEach(function(b,d){c.angles[d]=c.slice*d;b.position.x=.5*c.width+Math.cos(c.angles[d])*c.radius;b.position.y=.5*c.height+Math.sin(c.angles[d])*c.radius;b.update();b.draw(a)})}}]);return a}();c.default=a},{"../lib/Particle":3,"../lib/math":5}],7:[function(a,b,c){(function(a){(function(){var c,d,e;"undefined"!==typeof performance&&null!==performance&&performance.now?b.exports=function(){return performance.now()}:"undefined"!==typeof a&&null!==a&&a.hrtime?(b.exports=function(){return(c()-e)/1E6},d=a.hrtime,c=function(){var a;a=d();return 1E9*a[0]+a[1]},e=c()):Date.now?(b.exports=function(){return Date.now()-e},e=Date.now()):(b.exports=function(){return(new Date).getTime()-e},e=(new Date).getTime())}).call(this)}).call(this,a("_process"))},{_process:8}],8:[function(a,b,c){function d(){m=!1;n.length?l=n.concat(l):t=-1;l.length&&e()}function e(){if(!m){var a=setTimeout(d);m=!0;for(var b=l.length;b;){n=l;for(l=[];++t<b;)n&&n[t].run();t=-1;b=l.length}n=null;m=!1;clearTimeout(a)}}function f(a,b){this.fun=a;this.array=b}function g(){}a=b.exports={};var l=[],m=!1,n,t=-1;a.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];l.push(new f(a,b));1!==l.length||m||setTimeout(e,0)};f.prototype.run=function(){this.fun.apply(null,this.array)};a.title="browser";a.browser=!0;a.env={};a.argv=[];a.version="";a.versions={};a.on=g;a.addListener=g;a.once=g;a.off=g;a.removeListener=g;a.removeAllListeners=g;a.emit=g;a.binding=function(a){throw Error("process.binding is not supported");};a.cwd=function(){return"/"};a.chdir=function(a){throw Error("process.chdir is not supported");};a.umask=function(){return 0}},{}],9:[function(a,b,c){var d=a("performance-now"),e="undefined"===typeof window?{}:window;a=["moz","webkit"];var f=e.requestAnimationFrame,g=e.cancelAnimationFrame||e.cancelRequestAnimationFrame;for(c=0;c<a.length&&!f;c++)f=e[a[c]+"RequestAnimationFrame"],g=e[a[c]+"CancelAnimationFrame"]||e[a[c]+"CancelRequestAnimationFrame"];if(!f||!g)var l=0,m=0,n=[],t=1E3/60,f=function(a){if(0===n.length){var b=d(),c=Math.max(0,t-(b-l));l=c+b;setTimeout(function(){for(var a=n.slice(0),b=n.length=0;b<a.length;b++)if(!a[b].cancelled)try{a[b].callback(l)}catch(z){setTimeout(function(){throw z;},0)}},Math.round(c))}n.push({handle:++m,callback:a,cancelled:!1});return m},g=function(a){for(var b=0;b<n.length;b++)n[b].handle===a&&(n[b].cancelled=!0)};b.exports=function(a){return f.call(e,a)};b.exports.cancel=function(){g.apply(e,arguments)}},{"performance-now":7}],10:!1},{},2,c)}};CBoBo.View.DVCanvas.prototype.StopLoadingAnimation=function(){this.bAnimatStop=!0};CBoBo.View.DVCanvas.prototype.PushCornerInfo=function(e,c){this.arrCornerInfo[e]instanceof Array||(this.arrCornerInfo[e]=[]);this.arrCornerInfo[e].push(c)};CBoBo.View.DVCanvas.prototype.ClearCornerInfo=function(){this.arrCornerInfo={};$("."+this.cornerclass).remove()};CBoBo.View.DVCanvas.prototype.ShowCornerInfo=function(){var e=this.arrCornerInfo.rt,c=this.arrCornerInfo.rb,a=this.arrCornerInfo.lb;this.DrawBox(this.arrCornerInfo.lt,"lt",3,3);this.DrawBox(e,"rt",3,3);this.DrawBox(c,"rb",3,3);this.DrawBox(a,"lb",3,3)};CBoBo.View.DVCanvas.prototype.DrawBox=function(e,c,a,g){if(void 0!==e){var b=[];e instanceof Array?b=e:b.push(e);var d,h;e="left";switch(c){case "lt":d="left";h="top";break;case "rt":d="right";h="top";e="right";break;case "rb":d="right";h="bottom";e="right";break;case "lb":d="left",h="bottom"}c="\x3cdiv class\x3d'"+this.cornerclass+"' style\x3d'position:absolute;"+d+":"+a+"px;"+h+":"+g+"px;color:#FFF;text-align:"+e+";font-size:10px;text-shadow:1px 1px 1px #000;cursor:default;pointer-events:none;'\x3e";for(a=0;a<b.length;a++)str="\x3cp\x3e"+b[a]+"\x3c/p\x3e",c+=str;$(c+"\x3c/div\x3e").appendTo("#"+this.boxId)}};CBoBo.View.DVCanvas.prototype.DrawCornerInfo=function(e){this.ClearCornerInfo();if(!(150>this.canvas.width||150>this.canvas.height)&&e instanceof Object){var c=e.image,a=window.globalStudyInfo;a.patientid&&this.PushCornerInfo("lt","ID:"+a.patientid);a.name&&this.PushCornerInfo("lt","\u59d3\u540d:"+a.name);c.mod&&this.PushCornerInfo("lt","\u8bbe\u5907:"+c.mod);a.sex&&this.PushCornerInfo("lt","\u6027\u522b:"+a.sex);a.age&&this.PushCornerInfo("lt","\u5e74\u9f84:"+a.age);c.kv&&this.PushCornerInfo("lb","\u7535\u538b:"+c.kv);c.ma&&this.PushCornerInfo("lb","\u7535\u6d41:"+c.ma);c.sliceth&&this.PushCornerInfo("lb","\u5c42\u539a:"+c.sliceth);c.studt&&this.PushCornerInfo("rt","\u65e5\u671f:"+c.studt);c.acqtm&&this.PushCornerInfo("rt","\u65f6\u95f4:"+c.acqtm);this.PushCornerInfo("rt","\u5f71\u50cf\u53f7:"+c.stuid+"-"+c.serid+"-"+c.imgnum);this.PushCornerInfo("rb","\u500d\u6570:"+e.scale);this.PushCornerInfo("rb","\u7a97\u4f4d:"+e.wc);this.PushCornerInfo("rb","\u7a97\u5bbd:"+e.ww);c.inst&&this.PushCornerInfo("rb",a.hospname||c.inst);this.ShowCornerInfo()}};CBoBo.View.CMngFirstLayer=function(e){this.opt=$.extend(!0,{parent:null,scrollsize:CBoBo.Scrollsize,msgtransform:null,single:!0},e);this.arrTag={};this.arrCanvas=[];this.checkbox;this.nLayoutCol=this.nLayoutRow=0;this.bFocus=this.bMax=!1;this.scroll;this.imageNums;this.seriesIndex;this.annStatusMng=null;this.bBorderSpColor=!1;this.focusIndex=1;var c=this;!function(){c.CreateBox();c.opt.single?c.UpdateStyle():(c.checkbox=new CBoBo.View.CheckBox({parent:"#"+c.arrTag.box,title:"\u5e8f\u5217\u5bf9\u6bd4",msgtransform:function(a){null!==c.annStatusMng&&(c.annStatusMng.compare=a)}}),c.checkbox.Show(!1))}()};CBoBo.View.CMngFirstLayer.prototype.Clear=function(){this.UpdateLayout(0,1,1);null!=this.annStatusMng&&($.each(this.arrCanvas,function(e,c){c.Clear()}),this.annStatusMng=null)};CBoBo.View.CMngFirstLayer.prototype.AnnStatusMng=function(e){if(void 0===e)return this.annStatusMng;e=(this.annStatusMng=e)?e.compare:!1;this.checkbox&&this.checkbox.On_Off(e)};CBoBo.View.CMngFirstLayer.prototype.CreateBox=function(){if(null!=this.opt.parent){this.arrTag.box="box"+CBoBo.Plugin.GetRandom();this.arrTag.canvasbox="box"+CBoBo.Plugin.GetRandom();this.arrTag.container="box"+CBoBo.Plugin.GetRandom();this.arrTag.scroll="box"+CBoBo.Plugin.GetRandom();var e=$("\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.canvasbox+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrTag.scroll+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo(this.opt.parent);void 0!=e&&(this.opt.single?e.css({position:"relative",background:"#000"}):e.css({position:"relative",background:"#000",float:"left",border:"2px solid #595959",margin:"1px"}));$("#"+this.arrTag.canvasbox).css({position:"relative","float":"left"});$("#"+this.arrTag.container).css({position:"absolute",left:0,top:0,right:0,bottom:0,margin:"auto"});$("#"+this.arrTag.scroll).css({"float":"right",position:"relative","margin-bottom":"1px","margin-right":"1px","margin-top":"1px"});return e}};CBoBo.View.CMngFirstLayer.prototype.UpdateStyle=function(){var e=$(this.opt.parent);if(void 0!=e){var c=e.width(),e=e.height();$("#"+this.arrTag.box).width(c).height(e)}};CBoBo.View.CMngFirstLayer.prototype.TriggerResize=function(e){if(this.opt.single){this.UpdateStyle();var c=1;this.scroll&&(c=this.scroll.draggerPos);this.UpdateLayout(this.imageNums,this.nLayoutRow,this.nLayoutCol,c);this.opt.msgtransform&&e&&this.opt.msgtransform(e)}};CBoBo.View.CMngFirstLayer.prototype.AddEvent=function(){};CBoBo.View.CMngFirstLayer.prototype.SetBoxRange=function(e,c){var a=$("#"+this.arrTag.box);0==e||0==c?a.hide():(a.show(),c>>=0,a.width(e>>0).height(c))};CBoBo.View.CMngFirstLayer.prototype.ShowScroll=function(e){var c=$("#"+this.arrTag.scroll),a=$("#"+this.arrTag.container),g=$("#"+this.arrTag.box),b=$("#"+this.arrTag.canvasbox),d=g.width(),g=g.height();if(e){c.width(this.opt.scrollsize-1).height(g-2).show();var d=d-this.opt.scrollsize,h=this;void 0===this.scroll&&(this.scroll=new CBoBo.View.Scroll({parent:"#"+this.arrTag.scroll,msgtransform:function(a){a.firstmng=h;null!=h.opt.msgtransform&&h.opt.msgtransform(a)},size:h.opt.scrollsize}))}else c.hide(),this.scroll=void 0;d=Math.floor(d);g=Math.floor(g);a.width(d).height(g);b.width(d).height(g)};CBoBo.View.CMngFirstLayer.prototype.GetId=function(e){if(void 0!=e)return this.arrTag[e]};CBoBo.View.CMngFirstLayer.prototype.Focus=function(e){if("[object String]"==Object.prototype.toString.apply(e))for(var c=0;c<this.arrCanvas.length;c++){var a=this.arrCanvas[c],g=$("#"+a.boxId);a.GetId("canvas")==e?(a.bFocus=!0,this.focusIndex=c,g.css({"border-color":"#33ffff"})):(a.bFocus=!1,g.css({"border-color":"#595959"}))}else if("[object Number]"==Object.prototype.toString.apply(e)&&-1<e&&e<this.arrCanvas.length){var b;b=this.opt.single?"2px solid #33ffff":"2px dashed #FFFF00";for(c=0;c<this.arrCanvas.length;c++)a=this.arrCanvas[c],g=$("#"+a.boxId),c==e?(a.bFocus=!0,this.focusIndex=c,g.css({border:b})):(a.bFocus=!1,g.css({border:"2px solid #595959"}))}};CBoBo.View.CMngFirstLayer.prototype.MsgProxy=function(e){!this.opt.single||"mousedown"!=e.type&&"touchstart"!=e.type||this.bBorderSpColor||this.Focus(e.target.id);e.mng=this;null!=this.opt.msgtransform&&this.opt.msgtransform(e)};CBoBo.View.CMngFirstLayer.prototype.AddCanvas=function(){var e=this,c=new CBoBo.View.DVCanvas({parent:"#"+this.arrTag.container,msgtransform:function(a){e.MsgProxy(a)},bdrag:this.opt.single});this.arrCanvas.push(c)};CBoBo.View.CMngFirstLayer.prototype.DeleteCanvas=function(e){if(!(void 0==e||e>this.arrCanvas.length))for(var c=this.arrCanvas.length-1;c>=e;c--)$("#"+this.arrCanvas[c].boxId).remove(),this.arrCanvas.pop()};CBoBo.View.CMngFirstLayer.prototype.SetLayout=function(e,c){var a=$("#"+this.arrTag.container),g=a.width(),a=a.height(),g=Math.floor((g-6*c)/c),a=Math.floor((a-6*e)/e),b=e*c,d=this.arrCanvas.length;if(d<b)for(;d<b;d++)this.AddCanvas();else d>b&&this.DeleteCanvas(b);$.each(this.arrCanvas,function(a,b){b.Float("left")});for(d=0;d<this.arrCanvas.length;d++){var h=this.arrCanvas[d];d<b?h.SetRange(g,a):h.SetRange(0,0)}this.nLayoutRow=e;this.nLayoutCol=c};CBoBo.View.CMngFirstLayer.prototype.GetFocusCanvas=function(){for(var e=0;e<this.arrCanvas.length;e++){var c=this.arrCanvas[e];if(c.bFocus)return c}};CBoBo.View.CMngFirstLayer.prototype.GetCanvasIndex=function(e){if(void 0==e)for(var c=0;c<this.arrCanvas.length;c++){var a=this.arrCanvas[c];if(a.bFocus)return c}else for(c=0;c<this.arrCanvas.length;c++)if(a=this.arrCanvas[c],a.GetId("canvas")==e)return c};CBoBo.View.CMngFirstLayer.prototype.GetAllCanvas=function(){return this.arrCanvas};CBoBo.View.CMngFirstLayer.prototype.GetLayoutCanvas=function(){var e=this.nLayoutRow*this.nLayoutCol,e=e>this.arrCanvas.length?this.arrCanvas.length:e;return this.arrCanvas.slice(0,e)};CBoBo.View.CMngFirstLayer.prototype.GetCanvasById=function(e){for(var c=0;c<this.arrCanvas.length;c++){var a=this.arrCanvas[c];if(a.GetId("canvas")==e)return a}};CBoBo.View.CMngFirstLayer.prototype.GetCanvas=function(e){return e<this.arrCanvas.length&&-1<e?this.arrCanvas.slice(0,e):this.arrCanvas};CBoBo.View.CMngFirstLayer.prototype.UpdateLayout=function(e,c,a,g){if(void 0!=e){if(void 0==c||void 0==a)c=0<this.nLayoutRow?this.nLayoutRow:1,a=0<this.nLayoutCol?this.nLayoutCol:1;this.imageNums=e;e>c*a?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(e/(c*a)),g)):this.ShowScroll(!1);this.SetLayout(c,a)}};CBoBo.View.CMngFirstLayer.prototype.UpdateLayoutSp3=function(e,c,a){void 0!==e&&(this.imageNums=e,3<e?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(e/3),a)):this.ShowScroll(!1),this.LayoutSp3(c))};CBoBo.View.CMngFirstLayer.prototype.LayoutSp3=function(e){var c=$("#"+this.arrTag.container);c.width();var a=c.width()-1,g=c.height()-1,c=a-6,b=g-6,a=a-12>>1,g=g-12>>1,d=this.arrCanvas.length;if(3>d)for(;3>d;d++)this.AddCanvas();else 3<d&&this.DeleteCanvas(3);var h="left";"right"===e&&(h="right");$.each(this.arrCanvas,function(a,b){b.Float(h)});switch(e){case "left":this.arrCanvas[0].SetRange(a,b);this.arrCanvas[1].SetRange(a,g);this.arrCanvas[2].SetRange(a,g);break;case "top":this.arrCanvas[0].SetRange(c,g);this.arrCanvas[1].SetRange(a,g);this.arrCanvas[2].SetRange(a,g);break;case "right":this.arrCanvas[0].SetRange(a,b);this.arrCanvas[1].SetRange(a,g);this.arrCanvas[2].SetRange(a,g);break;case "bottom":this.arrCanvas[0].SetRange(a,g),this.arrCanvas[1].SetRange(a,g),this.arrCanvas[2].SetRange(c,g)}};CBoBo.View.CMngFirstLayer.prototype.SetDefaultFocus=function(e){isNaN(e)||(e=e>this.arrCanvas.length-1?this.arrCanvas.length-1:e,this.Focus(this.arrCanvas[0>e?0:e].canvasId))};CBoBo.View.CMngFirstLayer.prototype.GetLayout=function(){return{row:this.nLayoutRow,col:this.nLayoutCol}};CBoBo.View.CMngFirstLayer.prototype.SeriesIndex=function(e){if(void 0==e)return this.seriesIndex;this.seriesIndex=e;return this};CBoBo.View.CMngFirstLayer.prototype.GetBoundary=function(){var e={},c=$("#"+this.arrTag.box),a=c.offset();e.left=a.left;e.top=a.top;e.width=c.width();e.height=c.height();return e};CBoBo.View.CMngFirstLayer.prototype.SetSpBoundaryColor=function(e,c){this.bBorderSpColor=!0;e=this.arrCanvas[e];void 0!=e&&$("#"+e.boxId).css({"border-color":c})};CBoBo.View.CMngFirstLayer.prototype.EnableScroll=function(e){this.scroll||this.ShowScroll(!0);this.scroll.Enable(e)};CBoBo.View.CMngFirstLayer.prototype.SetCanavsBoxBoundary=function(e,c){if(!isNaN(e)&&!isNaN(c)){var a=$("#"+this.arrTag.container),g=$("#"+this.arrTag.box),b=g.width(),g=g.height();this.scroll&&(b-=this.opt.scrollsize);e/=c;b/g>e?(c=g,b=c*e):c=b/e;a.width(b).height(c)}};CBoBo.View.CMngFirstLayer.prototype.SetCanvasMsgPro=function(e){$.each(this.arrCanvas,function(){this.SetMsgPro(e)})};CBoBo.View.CMngFirstLayer.prototype.Destroy=function(){$("#"+this.arrTag.box).remove()};CBoBo.View.CMngFirstLayer.prototype.GetEventImageIndex=function(e){var c=this.scroll?this.scroll.draggerPos:1,a=this.nLayoutRow,g=this.nLayoutCol;if(1>a||1>g)g=a=1;for(var b=0,d=0;d<this.arrCanvas.length;d++)if(this.arrCanvas[d]===e){b=d;break}return(c-1)*a*g+b};CBoBo.View.CMngSecondLayer=function(e){var c=this,a=$.extend(!0,{parent:null,scrollsize:CBoBo.Scrollsize},e);this.arrTag={};this.arrFirstLayer=[];this.nLayoutCol=this.nLayoutRow=0;this.scroll;this.bMax=!1;this.imageNums;this.focusIndex=1;this.CreateBox=function(){if(null!=a.parent){this.arrTag.box="box"+CBoBo.Plugin.GetRandom();this.arrTag.container="container"+CBoBo.Plugin.GetRandom();this.arrTag.scroll="scroll"+CBoBo.Plugin.GetRandom();var c=$(!0!==a.aiRead?"\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrTag.scroll+"'\x3e\x3c/div\x3e\x3c/div\x3e":"\x3cdiv id\x3d'"+this.arrTag.box+"'\x3e\x3cdiv id\x3d'"+this.arrTag.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo(a.parent);void 0!=c&&c.css({position:"relative",background:"#000"});$("#"+this.arrTag.container).css({display:"inline-block"});$("#"+this.arrTag.scroll).css({display:"inline-block",position:"relative","margin-bottom":"1px","margin-top":"1px","margin-right":"1px"});return c}};this.UpdateStyle=function(){var c=$(a.parent);if(void 0!=c){var b=c.width(),c=c.height();$("#"+this.arrTag.box).width(b).height(c)}};this.TriggerResize=function(e){c.UpdateStyle();var b=c.scroll?c.scroll.draggerPos:1;c.UpdateLayout(c.imageNums,c.nLayoutRow,c.nLayoutCol,b);c.arrFirstLayer.forEach(function(a){b=a.scroll?a.scroll.draggerPos:1;a.UpdateLayout(a.imageNums,a.nLayoutRow,a.nLayoutCol,b)});a.msgtransform&&e&&a.msgtransform(e)};this.AddEvent=function(){};this.ShowScroll=function(e){var b=$("#"+this.arrTag.scroll),d=$("#"+this.arrTag.container),g=$("#"+this.arrTag.box);e?(b.width(a.scrollsize-1).height(g.height()-2).show(),d.width(g.width()-a.scrollsize),void 0==this.scroll&&(this.scroll=new CBoBo.View.Scroll({parent:"#"+this.arrTag.scroll,msgtransform:function(b){b.secondmng=c;a.msgtransform(b)},size:a.scrollsize}))):(b.hide(),this.scroll=void 0,d.width(g.width()));d.height(g.height())};this.Focus=function(a){var b=!1;$.each(this.arrFirstLayer,function(d,e){$.each(e.arrCanvas,function(c,d){var f=$("#"+d.boxId);d.GetId("canvas")==a?(d.bFocus=!0,e.focusIndex=c,f.css({border:"2px dashed #FFFF00"}),b=!0):(d.bFocus=!1,f.css({border:"2px solid #595959"}))});var g=$("#"+e.GetId("box"));b?(g.css({"border-color":"#33ffff"}),c.focusIndex=d,e.bFocus=!0,b=!1):(g.css({"border-color":"#595959"}),e.bFocus=!1)})};this.MsgProxy=function(c){"mousedown"!=c.type&&"touchstart"!=c.type||this.Focus(c.target.id);a.msgtransform&&a.msgtransform(c)};this.AddFirstMng=function(){var c=this;this.arrFirstLayer.push(new CBoBo.View.CMngFirstLayer({parent:"#"+this.arrTag.container,scrollsize:a.scrollsize,msgtransform:function(a){c.MsgProxy(a)},single:!1}))};this.SetLayout=function(a,b){var c=$("#"+this.arrTag.container),e=c.width(),c=c.height(),e=(e-6*b)/b,c=(c-6*a)/a,g=a*b,f=this.arrFirstLayer.length;if(f<g)for(;f<g;f++)this.AddFirstMng();for(f=0;f<this.arrFirstLayer.length;f++){var p=this.arrFirstLayer[f];f<g?p.SetBoxRange(e,c):p.SetBoxRange(0,0)}this.nLayoutRow=a;this.nLayoutCol=b;sessionStorage.setItem("layout",a+","+b)};this.GetLayout=function(){return{row:this.nLayoutRow,col:this.nLayoutCol}};this.GetActiveMng=function(){var a=[];$.each(this.arrFirstLayer,function(b,c){(c.bFocus||c.checkbox.bState)&&a.push(c)});return a};this.GetFocusMng=function(){for(var a=0;a<this.arrFirstLayer.length;a++)for(var b=this.arrFirstLayer[a],c=0;c<b.arrCanvas.length;c++)if(b.arrCanvas[c].bFocus)return b};this.GetFocusCanvas=function(){for(var a=0;a<this.arrFirstLayer.length;a++)for(var b=this.arrFirstLayer[a],c=0;c<b.arrCanvas.length;c++){var e=b.arrCanvas[c];if(e.bFocus)return e}};this.GetMng=function(a){if(void 0==a)return this.arrFirstLayer;if("[object Object]"==Object.prototype.toString.apply(a))for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];if(c.scroll==a)return c}else{if("[object Number]"==Object.prototype.toString.apply(a))return a=a>this.arrFirstLayer.length-1?this.arrFirstLayer.length-1:a,this.arrFirstLayer[0>a?0:a];if("[object String]"==Object.prototype.toString.apply(a))for(b=0;b<this.arrFirstLayer.length;b++)if(c=this.arrFirstLayer[b],c.GetId("box")==a)return c}};this.GetMngByCanvas=function(a){a=a.GetId("canvas");for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];if(c.GetCanvasById(a))return c}};this.GetAllCanvas=function(){var a=[];$.each(this.arrFirstLayer,function(b,c){a=a.concat(c.arrCanvas)});return a};this.GetCanvasById=function(a){for(var b=0;b<this.arrFirstLayer.length;b++)for(var c=this.arrFirstLayer[b].GetAllCanvas(),e=0;e<c.length;e++){var g=c[e];if(g.GetId("canvas")==a)return g}};this.GetSeriesCanvasById=function(a){for(var b={},c=0;c<this.arrFirstLayer.length;c++)for(var e=this.arrFirstLayer[c].GetAllCanvas(),g=0;g<e.length;g++)if(e[g].GetId("canvas")==a)return b.arrcanvas=e,b.mng=this.arrFirstLayer[c],b};this.UpdateLayout=function(a,b,c,e){if(void 0!=a){if(void 0==b||void 0==c)b=0<this.nLayoutRow?this.nLayoutRow:1,c=0<this.nLayoutCol?this.nLayoutCol:1;this.imageNums=a;a>b*c?(this.ShowScroll(!0),this.scroll.SetRange(Math.ceil(a/(b*c)),e)):this.ShowScroll(!1);CBoBo.IsTablet&&this.ShowScroll(!1);this.SetLayout(b,c)}};this.SetDefaultFocus=function(a,b){isNaN(a)||(a=a>this.arrFirstLayer.length-1?this.arrFirstLayer.length-1:a,a=this.arrFirstLayer[0>a?0:a].GetAllCanvas(),1>a.length||this.Focus(a[b].GetId("canvas")))};this.GetLayoutCanvas=function(a){if(void 0===a)return this.GetFocusMng().GetLayoutCanvas()};this.GetLayoutMng=function(a){a=this.nLayoutRow*this.nLayoutCol;a=a>this.arrFirstLayer.length?this.arrFirstLayer.length:a;return this.arrFirstLayer.slice(0,a)};this.GetMngIndex=function(a){if(void 0===a)for(var b=0;b<this.arrFirstLayer.length;b++){var c=this.arrFirstLayer[b];for(a=0;a<c.arrCanvas.length;a++)if(c.arrCanvas[a].bFocus)return b}else for(b=0;b<this.arrFirstLayer.length;b++)if(c=this.arrFirstLayer[b],c.GetId("box")==a)return b};this.EachMng=function(a){a instanceof Function&&$.each(this.arrFirstLayer,function(b,c){a(c,b)})};this.Destroy=function(){$("#"+this.arrTag.box).remove()};c.CreateBox();c.UpdateStyle();c.ShowScroll(!0);!0};CBoBo.View.CheckBox=function(e){var c=this,a=$.extend(!0,{parent:null,title:"",msgtransform:null},e);this.ctrlId;this.bShow=this.bState=!1;this.dragId;var g=20,b=40;this.Create=function(){this.ctrlId=CBoBo.Plugin.GetRandom();this.dragId=CBoBo.Plugin.GetRandom();var b="\x3cdiv class\x3d'seriCompareBar' id\x3d'"+this.ctrlId+"' title\x3d'"+a.title+"'\x3e\x3cdiv class\x3d'seriCompareSlide'\x3e\x3cinput type\x3d'checkbox' value\x3d'none' name\x3d'checkbox' id\x3d'"+this.dragId+"' /\x3e\x3clabel for\x3d'"+this.dragId+"'\x3e\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e";CBoBo.IsTablet&&(b="\x3cdiv class\x3d'seriCompareBar' id\x3d'"+this.ctrlId+"' title\x3d'"+a.title+"'\x3e\x3cdiv class\x3d'seriCompareSlideSP'\x3e\x3cinput type\x3d'checkbox' value\x3d'none' name\x3d'checkbox' id\x3d'"+this.dragId+"' /\x3e\x3clabel for\x3d'"+this.dragId+"'\x3e\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e");$(b).appendTo($(a.parent));$("#"+this.ctrlId).css({position:"absolute"});$("#"+this.ctrlId).css({position:"absolute"})};this.SetPositon=function(a,e){g=a;b=e;c.UpdateStyle()};this.Show=function(a){a?(this.bShow=!0,$("#"+this.ctrlId).show()):(this.bShow=!1,c.On_Off(!1),$("#"+this.ctrlId).hide())};this.On_Off=function(a){a?(c.bState=!0,$("#"+this.dragId).prop("checked",!0).next().css({left:"33px"})):(c.bState=!1,$("#"+this.dragId).prop("checked",!1).next().css({left:"2px"}))};this.AddEvent=function(){$("#"+this.dragId).bind("click",function(b){b=$(this);c.bState=b.is(":checked");c.bState?b.next().css({left:"33px"}):b.next().css({left:"2px"});null!==a.msgtransform&&a.msgtransform(c.bState)});$(window).bind("resize",function(a){c.UpdateStyle()})};this.UpdateStyle=function(){$("#"+this.ctrlId).css({right:g+"px",top:b+"px"})};c.Create();c.UpdateStyle();c.AddEvent();!0};CBoBo.View.DVPrint=function(e){function c(a,b,c){this.type=a||"";this.row=b||1;this.col=c||2}function a(a){var b=$(r.printSetting);switch(a.type){case "mouseenter":b.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":b.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":d.bShowPrintSetBox||(d.bShowPrintSetBox=!0,$("#"+k.settingBox).show(!0))}}function g(a){var b=localStorage.getItem("localPrint"),c={},e=$("#iptInputPrintName").val(),f=$("#iptInputPrintTitle").val(),g=$("#iptInputPrintAddress").val().trim(),h=$("#iptInputPrintPort").val();if(!e||""==e)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684\u540d\u79f0"),!1;if(!f||""==f)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684AETitle"),!1;if(!g||""==g)return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684IP\u5730\u5740"),!1;if(!/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/.test(g))return layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684IP\u5730\u5740"),!1;if(h&&""!=h)isNaN(h)&&layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7aef\u53e3\u53f7");else return layer.msg("\u8bf7\u8f93\u5165\u6253\u5370\u673a\u7684\u7aef\u53e3\u53f7"),!1;d.isAddPrint&&(c.id="print"+Date.parse(new Date));c.printName=e;c.printTitle=f;c.printAddress=g;c.printPort=h;if(b)if(b=JSON.parse(b),d.isAddPrint)b.print.push(c),b.defaultId&&""!=b.defaultId||(b.defaultId=c.id);else{for(var c=b.print,l=0;l<c.length;l++)c[l].id==a&&(c[l].printName=e,c[l].printTitle=f,c[l].printAddress=g,c[l].printPort=h);b.print=c}else a=[],b={},a.push(c),b.defaultId=c.id,b.print=a;localStorage.setItem("localPrint",JSON.stringify(b));d.closePrintBox("bShowPrintAddBox",k.settingAddBox);d.readLocalPrint();d.LoadPrintToSelelct(r.printer,"pointer")}function b(a){var b=$(r.cancelPrint);switch(a.type){case "mouseenter":b.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":b.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":d.Show(!1),b=$("#"+k.ctrl+" canvas").attr("imgID"),$.ajax({type:"get",url:w+"/CancelPrint?filmuid\x3d"+b,dataType:"json",processData:!1,contentType:!1,complete:function(b){200==b.status?(a.preventDefault(),d.Show(!1),null!=h.msgtransform&&h.msgtransform({type:"btnfocus",btntitle:"\u534f\u540c\u8bca\u65ad",btnforce:!1}),q&&q.bUpload||(p=[],l=[],m=1,n=new c,l.push(n),f.SetLayout(1,1),x(),E(),F())):$.Msg("\u6253\u5370\u53d6\u6d88\u5931\u8d25\u3002",CBoBo.MSG_ERROR)}})}}var d=this,h=$.extend(!0,{msgtransform:null,mode:1},e),k={},f,p=[],l=[],m=1,n=new c,t,r={},v,u=[],q,w=CBoBo.Plugin.GetUrlParam("WadoURL")||$("#hdurl").val();this.bShow;this.bShowPrintAddBox=this.bShowPrintSetBox=!1;this.isAddPrint=!0;this.closePrintBox=function(a,b){"bShowPrintSetBox"===a?this.bShowPrintSetBox=!1:this.bShowPrintAddBox=!1;$("#"+b).hide()};this.showPrintBox=function(a,b){"bShowPrintSetBox"===a?this.bShowPrintSetBox=!0:this.bShowPrintAddBox=!0;$("#"+b).show()};this.readLocalPrint=function(){var a=localStorage.getItem("localPrint");if(a){var a=JSON.parse(a),b=a.print;if(0<b.length){for(var c="",d=0;d<b.length;d++)c=b[d].id===a.defaultId?c+("\x3ctr class\x3d'current' id\x3d'"+b[d].id+"'\x3e"):c+("\x3ctr id\x3d'"+b[d].id+"'\x3e"),c+="\x3ctd width\x3d'35%'\x3e"+b[d].printName+"\x3c/td\x3e\x3ctd width\x3d'25%'\x3e"+b[d].printTitle+"\x3c/td\x3e\x3ctd width\x3d'25%'\x3e"+b[d].printAddress+"\x3c/td\x3e\x3ctd width\x3d'15%'\x3e"+b[d].printPort+"\x3c/td\x3e\x3c/tr\x3e";$("#"+k.tableContent).html(c);$("#"+k.tableContent+" tr").on("click",function(a){$("#"+k.tableContent+" tr").removeClass("current");$(this).addClass("current")})}else $("#"+k.tableContent).html("")}};this.PrintSearchByPrintId=function(a){var b=localStorage.getItem("localPrint"),c=null;if(b&&(b=JSON.parse(b),(b=b.print)&&0<b.length))for(var d=0;d<b.length;d++)a==b[d].id&&(c=b[d]);return c};this.LoadPrintToSelelct=function(a,b){if("pointer"==b){var c=localStorage.getItem("localPrint");if(c)if(c=JSON.parse(c),b=c.print,c=c.defaultId,b&&0<b.length){for(var d="",e=0;e<b.length;e++)d+="\x3coption value\x3d'"+b[e].id+"'\x3e"+b[e].printName+"\x3c/option\x3e";$(a).html(d);$(a).val(c).removeAttr("disabled")}else $(a).html("").attr("disabled","disabled")}};this.ModifyLocalPrint=function(a){var b=localStorage.getItem("localPrint"),b=JSON.parse(b);if((b=b.print)&&0<b.length)for(var c=0;c<b.length;c++)b[c].id==a&&($("#iptInputPrintName").val(b[c].printName),$("#iptInputPrintTitle").val(b[c].printTitle),$("#iptInputPrintAddress").val(b[c].printAddress),$("#iptInputPrintPort").val(b[c].printPort));d.showPrintBox("bShowPrintAddBox",k.settingAddBox)};var z=function(){var a=A(),b=w+"/CreatDicomFilm";f.arrCanvas[0].StartLoadingAnimation();$.ajax({type:"post",dataType:"json",url:b,data:JSON.stringify(a),complete:function(a){if(200==a.status)if(a.responseJSON.success){var b=$("#"+k.leftBox),c=new Image;c.src=w+"/GetViewFilm?uuid\x3d"+a.responseJSON.data.UID+"\x26width\x3d"+b.width()+"\x26height\x3d"+b.height()+"\x26r\x3d"+Math.random();c.onload=function(){f.arrCanvas[0].StopLoadingAnimation();var b=$("#"+k.ctrl+" canvas")[0];b.getContext("2d").clearRect(0,0,b.width,b.height);$(b).attr("imgID",a.responseJSON.data.UID);b.getContext("2d").drawImage(c,0,0,c.width,c.height)}}else $.Msg("\u6253\u5370\u80f6\u7247\u52a0\u8f7d\u5931\u8d25\u3002",CBoBo.MSG_ERROR);else $.Msg("\u6253\u5370\u80f6\u7247\u52a0\u8f7d\u5931\u8d25\u3002",CBoBo.MSG_ERROR)}})},A=function(){var a=this.CBoBo.AnnStatusManager.Get(),b,c,d=sessionStorage.getItem("layout");void 0==d?(b=3,c=2):(b=d.split(",")[1],c=d.split(",")[0]);d=new CBoBo.View.DVPrintInfo;d.ImageDisplayFormat="STANDARD\\"+b+","+c;for(b=0;b<a.length;b++){c=new CBoBo.View.DVPrintImageInfo;c.WindowLevel=a[b].viewport.wc;c.WindowWidth=a[b].viewport.ww;c.ID=a[b].viewport.image.id;c.TopLabel=a[b].viewport.image.ort;c.DownLabel=a[b].viewport.image.orb;c.LeftLabel=a[b].viewport.image.orl;c.RightLabel=a[b].viewport.image.orr;var e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("ID:"+a[b].viewport.image.accnum);e.Describe.push("\u59d3\u540d:"+a[b].viewport.image.name);e.Describe.push("\u8bbe\u5907:"+a[b].viewport.image.mod);e.Describe.push("\u6027\u522b:"+a[b].viewport.image.sex);c.TopLeftLabels=e;e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("\u65e5\u671f:"+a[b].viewport.image.studt);e.Describe.push("\u65f6\u95f4:"+a[b].viewport.image.acqtm);e.Describe.push("\u5f71\u50cf\u53f7:"+a[b].viewport.image.serid+"-"+a[b].viewport.image.stuid+"-"+a[b].viewport.image.imgnum);c.TopRightLabels=e;e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("\u500d\u6570:"+a[b].viewport.scale);e.Describe.push("\u7a97\u4f4d:"+a[b].viewport.wc);e.Describe.push("\u7a97\u5bbd:"+a[b].viewport.ww);e.Describe.push("\u533b\u9662\u540d:"+a[b].viewport.image.manu);c.DownRightLabels=e;e=new CBoBo.View.DVPrintImageDescribe;e.Describe.push("\u7535\u538b:"+a[b].viewport.image.kv);e.Describe.push("\u5c42\u539a:"+a[b].viewport.image.sliceth);c.DownLeftLabels=e;d.DicomInfos.push(c)}d.Orientation=$(r.direct).val();d.FilmSizeID=$(r.size).val();return d},y=function(){function a(a){for(var b=0;b<u.length;b++){var c=u[b];if(c.name==a)return c.printer}}var b=r.printer;$(b).empty();var c=O().hospital;c&&(c=a(c))&&$.each(c,function(){J(b,this.name,this.uid)})},F=function(){var a=$("."+k.controlItem),b=a.eq(0),c=a.eq(1),d=a.eq(2),a=a.eq(3),e=l.length;2>e?(b.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"}),d.css({"pointer-events":"none",color:"gray"}),a.css({"pointer-events":"none",color:"gray"})):2>m?(b.css({"pointer-events":"none",color:"gray"}),c.css({"pointer-events":"none",color:"gray"}),d.css({"pointer-events":"auto",color:"#000"}),a.css({"pointer-events":"auto",color:"#000"})):m>e-1?(b.css({"pointer-events":"auto",color:"#000"}),c.css({"pointer-events":"auto",color:"#000"}),d.css({"pointer-events":"none",color:"gray"}),a.css({"pointer-events":"none",color:"gray"})):(b.css({"pointer-events":"auto",color:"#000"}),c.css({"pointer-events":"auto",color:"#000"}),d.css({"pointer-events":"auto",color:"#000"}),a.css({"pointer-events":"auto",color:"#000"}))},G=function(a){if(a){var b=!1;a.type==n.type&&a.row==n.row&&a.col==n.col&&(b=!0);n.type=a.type;n.row=a.row;n.col=a.col;return b}},K=function(a){function b(){var a=f.GetFocusCanvas();var b=a.AnnStatus().status,c=a.AnnStatus();null!=c&&void 0!=b&&(b.Restore(),b.FitCanvas(a).DrawImg(a),c=c.ann,c.DeleteAllAnn(),c.DrawAllAnn(a,b))}function c(){var a=f.GetFocusCanvas(),b=a.AnnStatus().status;void 0!=b&&(b.SetNegative(!b.GetNegative()),b.DrawImg(a))}function d(a){var b=f.GetFocusCanvas();if(b){var c=b.AnnStatus();if(c&&(c=c.status,void 0!=c)){switch(a){case "\u9006\u65f6\u9488":c.SetRotate(270);break;case "\u987a\u65f6\u9488":c.SetRotate(90);break;case "\u5de6\u53f3\u955c\u50cf":c.FlipImage();break;case "\u4e0a\u4e0b\u955c\u50cf":c.InvertImage()}if(null!=b||void 0!=b)c.DrawImg(b),b.AnnStatus().ann.DrawAllAnn(b,c)}}}function e(){var a=f.GetFocusCanvas(),b=a.AnnStatus();if(void 0!=a&&null!=b){for(a=0;a<p.length;a++)if(b==p[a]){p.splice(a,1);break}C();E();x();B(!0);F()}}switch(a.usermsg||a.target.title){case "\u6062\u590d":b();break;case "\u65cb\u8f6c":void 0==manager.rotateCtrl&&(manager.rotateCtrl=new CBoBo.View.RotateCtrl({msgtransform:K}));manager.rotateCtrl.bShow?manager.rotateCtrl.Show(!1):(manager.rotateCtrl.SetPosition(a.clientX,a.clientY),manager.rotateCtrl.Show(!0));break;case "\u8d1f\u50cf":c();break;case "\u76f4\u7ebf":v.toolType=CBoBo.TOOL_M_LINE;break;case "\u77e9\u5f62":v.toolType=CBoBo.TOOL_M_RECT;break;case "\u692d\u5706":v.toolType=CBoBo.TOOL_M_ELLIPSE;break;case "\u89d2\u5ea6":v.toolType=CBoBo.TOOL_M_ANGLE;break;case "CT":v.toolType=CBoBo.TOOL_M_POINT;break;case "\u6587\u672c":v.toolType=CBoBo.TOOL_LABEL;void 0==manager.lableCtrl&&(manager.lableCtrl=new CBoBo.View.LableCtrl,manager.lableCtrl.Show(!1));break;case "\u7bad\u5934":v.toolType=CBoBo.TOOL_ARROW;break;case "\u5de6\u6807\u8bb0":v.toolType=CBoBo.TOOL_LEFT;break;case "\u53f3\u6807\u8bb0":v.toolType=CBoBo.TOOL_RIGHT;break;case "\u64a4\u9500":var g=f.GetFocusCanvas();if(void 0==g)break;var h=g.AnnStatus().status,k=g.AnnStatus().ann;if(void 0==h)break;h.DrawImg(g);k.PopAnn(g,h);k.DrawAllAnn(g,h);break;case "\u9006\u65f6\u9488":case "\u987a\u65f6\u9488":case "\u5de6\u53f3\u955c\u50cf":case "\u4e0a\u4e0b\u955c\u50cf":d(a.target.title);break;case "\u5220\u9664\u56fe\u50cf":e();break;case "\u663e/\u9690\u56db\u89d2\u4fe1\u606f":v.bShowCornerInfo=!v.bShowCornerInfo,a.btntitle="\u663e/\u9690\u56db\u89d2\u4fe1\u606f",a.btnforce=v.bShowCornerInfo,$.each(p,function(a,b){b.status.SetDrawTextFlag(v.bShowCornerInfo)}),B()}!1===v.ChangeBtnStatus(a.btntitle,a.btnforce)&&(v.toolType=CBoBo.TOOL_NULL,v.ChangeBtnStatus("\u91ca\u653e\u5de5\u5177"))},I=function(e){function g(a){var b=$("#"+a.target.id);switch(a.type){case "mouseenter":b.css({color:"#CCCCC4"});break;case "mouseout":b.css({color:"#888"});break;case "click":b=new c("",-1,-1);switch(a.target.title){case "1*1":b.row=1,b.col=1;case "1*2":if(-1==b.row||-1==b.col)b.row=1,b.col=2;case "2*1":if(-1==b.row||-1==b.col)b.row=2,b.col=1;case "2*2":if(-1==b.row||-1==b.col)b.row=2,b.col=2;case "2*3":if(-1==b.row||-1==b.col)b.row=2,b.col=3;case "\u5e03\u5c40\u63a7\u4ef6":if(-1==b.row||-1==b.col)b.row=a.row,b.col=a.col;f.SetLayout(b.row,b.col);break;case "1*1+2":b.type="bottom";case "2+1*1":""==b.type&&(b.type="top");case "2*1+1":""==b.type&&(b.type="left");case "1+1*2":""==b.type&&(b.type="right");f.LayoutSp3(b.type);b.row=1;b.col=3;break;case "m*n":t||(t=new CBoBo.View.LayoutCtrl({msgtransform:I}));t.bShow?t.Show(!1):(t.SetPosition(a.clientX+3,a.clientY+3),t.Show(!0));return}a=l[m-1];a.row=b.row;a.col=b.col;a.type=b.type;C();x();E();B(!0);F();G(b)}}function n(a){$(a.target);switch(a.type){case "click":var b=m;switch(a.target.title){case "\u7b2c\u4e00\u9875":m=1;break;case "\u4e0a\u4e00\u9875":m=1>--m?1:m;break;case "\u4e0b\u4e00\u9875":m=++m>l.length?l.length:m;break;case "\u6700\u540e\u4e00\u9875":m=l.length}b!=m&&(f.scroll&&f.scroll.TriggerDragger(m),F())}}function A(a){var b=document.getElementById("csharpActiveX"),c=$(r.startPrint),e=$(r.printer).val(),f=$(r.color).val(),g=$(r.direct).val(),h=$(r.size).val(),l=localStorage.getItem("localPrint");switch(a.type){case "mouseenter":c.css({"background-color":"#CCCCC4",color:"#555555"});break;case "mouseout":c.css({"background-color":"#555555",color:"#CCCCC4"});break;case "click":if(l){var m=$("#"+k.ctrl+" canvas").attr("imgID"),n=$("#hduseruid").val();a=w+"/ConfirmPrint?filmuid\x3d"+m;var l=JSON.parse(l),A=d.PrintSearchByPrintId(e),f="multicolour"==f?"\u5f69\u8272":"\u9ed1\u767d";if(window.ActiveXObject||"ActiveXObject"in window){if(null==b.object)return layer.msg("csharpActiveX\u63d2\u4ef6\u672a\u5b89\u88c5\uff01"),!1}else return layer.msg("\u8bf7\u4f7f\u7528IE\u6d4f\u89c8\u5668\uff01"),!1;$.ajax({type:"post",url:a,dataType:"json",complete:function(a){200==a.status?(a.responseJSON.success?b.Print(n,m,A.printTitle,A.printAddress,A.printPort,f,h,g):$.Msg("\u80f6\u7247\u6253\u5370\u5931\u8d25\u3002",CBoBo.MSG_ERROR),d.Show(!1)):$.Msg("\u80f6\u7247\u6253\u5370\u5f02\u5e38\u3002",CBoBo.MSG_ERROR)}})}else layer.msg("\u8bf7\u5148\u8bbe\u7f6e\u6253\u5370\u673a!")}}switch(e.type){case "scroll":L(e.value);break;case "change":switch(e.target.title){case "\u533b\u9662":y();case "\u6253\u5370\u673a":case "\u80f6\u7247\u5c3a\u5bf8":case "\u65b9\u5411":z()}break;case "mousewheel":var p=f.scroll;void 0!=p&&p.TriggerClick(e.deltaY);break;default:e.tooltype=v.toolType,h.msgtransform&&h.msgtransform(e)}if(e.target){switch(e.target.name){case "printSetting":a(e)}switch(e.target.title){case "1*1":case "1*1+2":case "2+1*1":case "2*1+1":case "1+1*2":case "1*2":case "2*1":case "2*2":case "2*3":case "\u5e03\u5c40\u63a7\u4ef6":case "m*n":g(e);break;case "\u7b2c\u4e00\u9875":case "\u4e0a\u4e00\u9875":case "\u4e0b\u4e00\u9875":case "\u6700\u540e\u4e00\u9875":n(e);break;case "\u5f00\u59cb\u6253\u5370":A(e);break;case "\u53d6\u6d88\u6253\u5370":b(e)}}},H=function(){var a=!1,b,c,e=$("#"+k.ctrl);$("#"+k.title).bind("mousedown",function(d){a=!0;b=new Point(d.pageX,d.pageY);d=e.offset();c=new Point(d.left,d.top)});$("#"+k.title+" a").bind("click",function(a){});$(document).bind("mousemove mouseup",function(d){switch(d.type){case "mousemove":a&&e.css({left:d.pageX-b.x+c.x+"px",top:d.pageY-b.y+c.y+"px"});break;case "mouseup":a=!1}});$("."+k.controlItem).bind("click mouseenter mouseout",function(a){I(a)});$("#printNetTest,#printerAdd,#printerChange,#printerDel,#printSetDefault,#printSetBoxClose,#printAddSubmit,#printCancelBox").bind("click",function(a){var b=JSON.parse(localStorage.getItem("localPrint")),c=document.getElementById("csharpActiveX"),e=$("#"+k.tableContent+" .current").attr("id");switch(a.target.id){case "printNetTest":null==c.object?layer.msg("csharpActiveX\u63d2\u4ef6\u672a\u5b89\u88c5\uff01"):(b=d.PrintSearchByPrintId(e),console.log(c.TestAE),c.TestAE(b.printTitle,b.printAddress,b.printPort));break;case "printerAdd":$("#iptInputPrintName").val("");$("#iptInputPrintTitle").val("");$("#iptInputPrintAddress").val("");$("#iptInputPrintPort").val("");$("#"+k.settingAddBox+"Title").text("\u6dfb\u52a0\u6253\u5370\u673a");d.isAddPrint=!0;d.showPrintBox("bShowPrintAddBox",k.settingAddBox);break;case "printerChange":e&&""!=e?(d.isAddPrint=!1,$("#"+k.settingAddBox+"Title").text("\u4fee\u6539\u6253\u5370\u673a"),d.ModifyLocalPrint(e)):layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printerDel":c=b.print;a=[];if(0<c.length){for(var f=0;f<c.length;f++)c[f].id!=e&&a.push(c[f]);b.print=a;b.defaultId==e&&(b.defaultId=0<a.length?a[0].id:"");localStorage.setItem("localPrint",JSON.stringify(b));d.readLocalPrint();d.LoadPrintToSelelct(r.printer,"pointer")}else layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printSetDefault":e&&""!=e?(b.defaultId=e,localStorage.setItem("localPrint",JSON.stringify(b)),d.LoadPrintToSelelct(r.printer,"pointer"),d.closePrintBox("bShowPrintSetBox",k.settingBox)):layer.msg("\u6682\u65e0\u53ef\u64cd\u4f5c\u7684\u6253\u5370\u673a\uff01");break;case "printSetBoxClose":d.closePrintBox("bShowPrintSetBox",k.settingBox);break;case "printAddSubmit":g(e);break;case "printCancelBox":d.closePrintBox("bShowPrintAddBox",k.settingAddBox)}});$(r.direct+","+r.size+","+r.color+","+r.printer).bind("change",function(a){I(a)});$(r.startPrint+","+r.cancelPrint+","+r.printSetting).bind("click mouseenter mouseout",function(a){I(a)})},E=function(){$("#"+k.pageInfo).html(m+"/"+l.length)},B=function(a){var b,c=void 0;void 0==c&&(c=m);for(var d=b=0;d<c-1;d++){var e=l[d];b+=e.row*e.col}c=l[c-1];c=c.row*c.col+b;c>p.length&&(c=p.length);b=p.slice(b,c);c=f.GetAllCanvas();h.msgtransform&&h.msgtransform({type:"draw",arrcanvas:c,arrannstatus:b,bforce:a})},x=function(){if(f){var a;1<l.length?(f.EnableScroll(!0),a=m>l.length?l.length:m):(f.EnableScroll(!1),a=1);f.scroll.SetRange(l.length,a)}},C=function(){var a=p.length;if(a){var b=l;l=[];for(var d=0,e=0;e<a;){var f=b[d];f||(f=new c);l.push(f);e+=f.row*f.col;d++}m>l.length&&(m=l.length)}},O=function(){var a={},b;for(b in r){var c=r[b],c="mode"==b?$(c+" input:checked").val():$(c).find("option:selected").val();a[b]=c}return a},L=function(a,b){a&&!isNaN(a)&&(m=a);if((a=l[m-1])&&(b||!G(a)))switch(a.type){case "left":case "top":case "right":case "bottom":f.LayoutSp3(a.type);break;default:f.SetLayout(a.row,a.col)}B(!0);E();F()},D=function(a){a=$.extend(!0,{parent:null,iconstr:"",title:"",angle:0,size:30,margin:{left:0,top:0,right:0,bottom:0},padding:{left:0,top:0,right:0,bottom:0}},a);var b=CBoBo.Plugin.GetRandom(),c=$("\x3cdiv id\x3d'"+b+"' title\x3d'"+a.title+"'\x3e"+a.iconstr+"\x3c/div\x3e").appendTo($(a.parent));$("#"+b).bind("click mouseenter mouseout",function(a){I(a)});c.css({transform:"rotate("+a.angle+"deg)","font-size":a.size+"px","float":"left","padding-left":a.padding.left+"px","padding-top":a.padding.top+"px","padding-right":a.padding.right+"px","padding-bottom":a.padding.bottom+"px","margin-left":a.margin.left+"px","margin-top":a.margin.top+"px","margin-right":a.margin.right+"px","margin-bottom":a.margin.bottom+"px",cursor:"pointer",color:"#888"});return b},M=function(a,b){if(void 0!=b&&void 0!=a){var c=CBoBo.Plugin.GetRandom(),d=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+d+"'\x3e\x3cspan\x3e"+b+"\x3c/span\x3e\x3cselect id\x3d'"+c+"' title\x3d'"+b+"'\x3e\x3c/select\x3e\x3c/div\x3e").appendTo($(a)).css({"float":"left",width:"100%","text-align":"center",height:"45px","margin-top":"6px"});$("#"+d+" span").css({width:"90%","font-size":"14px",height:"20px",cursor:"default"});$("#"+c).css({width:"90%",cursor:"pointer",height:"25px"});return c}},J=function(a,b,c){void 0!=b&&$("\x3coption value\x3d'"+c+"'\x3e"+b+"\x3c/option\x3e").appendTo($(a))},N=function(a,b,c){if(void 0!=b&&void 0!=a){var d=CBoBo.Plugin.GetRandom();a=$("\x3cdiv\x3e\x3cbutton id\x3d'"+d+"' title\x3d'"+b+"'name\x3d'"+c+"'\x3e"+b+"\x3c/button\x3e\x3c/div\x3e").appendTo($(a));"printSetting"===c?a.css({"float":"left",width:"100%",height:"30px","text-align":"center","margin-top":"100px"}):a.css({"float":"left",width:"100%",height:"30px","text-align":"center","margin-top":"6px"});$("#"+d).css({width:"90%",height:"30px",background:"#555555",color:"#CCCCC4",border:"none","font-size":"14px","font-weight":"bold","border-radius":"5px",cursor:"pointer"});return d}};this.Show=function(a){var b=$("#"+k.ctrl);a?(z(),b.fadeIn(300),this.bShow=!0):(b.fadeOut(500),this.bShow=!1)};this.RequestPrint=function(a){if(a&&!(1>a.length)){for(var b=0;b<a.length;b++){var c=a[b];c.type==CBoBo.PTYPE_SERIES&&(c.type=CBoBo.PTYPE_DESERIES);c.type==CBoBo.PTYPE_JPG?$.Msg("\u4e0d\u652f\u6301\u8d85\u58f0\u6253\u5370!"):(c.bPrint=!0,c.status.bDrawText=!0,p.push(c))}C();E();x();B(!0);F()}};(function(){k.ctrl=CBoBo.Plugin.GetRandom();k.title=CBoBo.Plugin.GetRandom();k.title=CBoBo.Plugin.GetRandom();k.titleBtn=CBoBo.Plugin.GetRandom();k.container=CBoBo.Plugin.GetRandom();k.leftBox=CBoBo.Plugin.GetRandom();k.canvasBox=CBoBo.Plugin.GetRandom();k.controlBar=CBoBo.Plugin.GetRandom();k.control=CBoBo.Plugin.GetRandom();k.controlItem=CBoBo.Plugin.GetRandom();k.pageInfo=CBoBo.Plugin.GetRandom();k.toolBox=CBoBo.Plugin.GetRandom();k.winLayout=CBoBo.Plugin.GetRandom();k.tool=CBoBo.Plugin.GetRandom();k.config=CBoBo.Plugin.GetRandom();k.toolId=CBoBo.Plugin.GetRandom();k.winLayoutId=CBoBo.Plugin.GetRandom();k.configId=CBoBo.Plugin.GetRandom();k.settingBox=CBoBo.Plugin.GetRandom();k.settingAddBox=CBoBo.Plugin.GetRandom();k.tableContent=CBoBo.Plugin.GetRandom();$("\x3cobject id\x3d'csharpActiveX' classid\x3d'clsid:CC6F4407-B2B2-47FB-AE00-7E88A7E615EC' width\x3d'0' height\x3d'0'\x3e\x3c/object\x3e\x3cdiv id\x3d'"+k.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+k.title+"'\x3e\x3cspan class\x3d'"+k.titleBtn+"'\x3e\u80f6\u7247\u6253\u5370\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d'"+k.container+"'\x3e\x3cdiv id\x3d'"+k.leftBox+"'\x3e\x3cdiv id\x3d'"+k.canvasBox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+k.controlBar+"'\x3e\x3cdiv id\x3d'"+k.control+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+k.toolBox+"'\x3e\x3cdiv id\x3d'"+k.config+"'\x3e\x3cspan \x3e\u6253 \u5370 \u914d \u7f6e\x3c/span\x3e\x3cdiv id\x3d'"+k.configId+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e''\x3cdiv id\x3d'"+k.settingBox+"' class\x3d'zzhsettingBox'\x3e\x3cdiv class\x3d'title-container'\x3eDICOM \u6253\u5370\u673a\u914d\u7f6e\x3c/div\x3e\x3cdiv class\x3d'setting-content'\x3e\x3cdiv class\x3d'operation-container'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printNetTest'\x3e\u7f51\u7edc\u6d4b\u8bd5\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerAdd'\x3e\u6dfb\u52a0\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerChange'\x3e\u4fee\u6539\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printerDel'\x3e\u5220\u9664\x3c/button\x3e\x3c/div\x3e\x3cdiv class\x3d'table-content'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0'\x3e\x3cthead\x3e\x3ctr\x3e\x3cth width\x3d'35%'\x3e\u540d\u79f0\x3c/th\x3e\x3cth width\x3d'25%'\x3eAET\x3c/th\x3e\x3cth width\x3d'25%'\x3e\u5730\u5740\x3c/th\x3e\x3cth width\x3d'15%'\x3e\u7aef\u53e3\x3c/th\x3e\x3c/tr\x3e\x3c/thead\x3e\x3c/table\x3e\x3cdiv class\x3d'contentScroll'\x3e\x3ctable cellpadding\x3d'0' cellspacing\x3d'0' id\x3d'"+k.tableContent+"'\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-container setting-footer'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printSetDefault'\x3e\u8bbe\u4e3a\u9ed8\u8ba4\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printSetBoxClose'\x3e\u5173\u95ed\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+k.settingAddBox+"' class\x3d'addPrintterContainer'\x3e\x3cdiv class\x3d'title-container' id\x3d'"+k.settingAddBox+"Title'\x3e\u6dfb\u52a0\u6253\u5370\u673a\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3e\u6253\u5370\u673a\u540d\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintName'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3eAETitle\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintTitle'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3eIP\u5730\u5740\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text' id\x3d'iptInputPrintAddress'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'inputItem'\x3e\x3cdiv class\x3d'inputName'\x3e\u7aef\u53e3\uff1a\x3c/div\x3e\x3cdiv class\x3d'inputContainer'\x3e\x3cinput type\x3d'text 'maxlength\x3d'5'id\x3d'iptInputPrintPort'/\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-container setting-footer'\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printAddSubmit'\x3e\u786e\u5b9a\x3c/button\x3e\x3cbutton class\x3d'setting-btn' id\x3d'printCancelBox'\x3e\u53d6\u6d88\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));var a=.8*$(window).width()>>0,a=800>a?800:a;$("#"+k.ctrl).width(a).height(820).css({border:"1px solid #676767",position:"absolute","z-index":"9999",background:"#444444",display:"none","user-select":"none",color:"#CCCCC4"});$("#"+k.title).css({height:"30px",width:"100%",background:"#555555",cursor:"move"});$("."+k.titleBtn).css({width:"100%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+k.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+k.container).css({position:"relative"});var b=$("#"+k.leftBox);leftBoxWidth=a-202;b.width(leftBoxWidth).height(790).css({"float":"left"});$("#"+k.canvasBox).width(leftBoxWidth).height(745).css({"border-bottom":"1px solid #676767"});$("#"+k.controlBar).height(44).css({width:"100%"});$("#"+k.control).height(44).width(220).css({"float":"right","text-align":"center","font-size":"25px","line-height":"40px",color:"#000"});$("."+k.controlItem).css({cursor:"pointer",margin:"0 10px"});$("#"+k.pageInfo).css({color:"#CCCCC4","font-size":"18px","vertical-align":"middle",cursor:"default"});$("#"+k.toolBox).css({height:"590px",width:"200px","float":"right","border-left":"1px solid #676767","border-top":"1px solid #000"});$("#"+k.toolBox+" span").css({width:"100%","text-align":"center",display:"inline-block","font-size":"14px",background:"#555555",cursor:"default",color:"rgba(255,255,255,0.8)"});$("#"+k.winLayout).height(100);$("#"+k.tool).css({height:"490px",width:"25%",display:"inline-block","border-right":"1px solid #676767",overflow:"hidden"});$("#"+k.config).css({height:"490px",width:"100%",display:"inline-block",overflow:"hidden"});$("#"+k.winLayoutId).height(84).css({overflow:"hidden"});$("#"+k.toolId).height(474).css({overflow:"hidden",width:"50px"});$("#"+k.configId).height(474).css({overflow:"hidden"});var e=$("body"),a=$("#"+k.ctrl),b=e.width(),e=e.height(),g=a.width(),h=a.height();a.css({left:(b-g>>1)+"px",top:(e-h>>1)+"px"});F();new CBoBo.View.CMngFirstLayer;v=new CBoBo.View.PCToolBar({parent:"#"+k.toolId,axis:"y",bottonbox:!1});v.RequestToolBar(CBoBo.TOOLMENU_PRINT_RADIATE,K);v.ChangeBtnStatus("\u663e/\u9690\u56db\u89d2\u4fe1\u606f",!0);f=new CBoBo.View.CMngFirstLayer({parent:"#"+k.canvasBox,single:!0,msgtransform:I});l.push(new c);x();f.SetLayout(1,1);f.SetDefaultFocus(0);D({parent:"#"+k.winLayoutId,iconstr:"\x26#xe667;",title:"1*1",angle:0,size:30,margin:{left:5,top:4,right:5,bottom:5},padding:{left:0,top:0,right:0,bottom:0}});b="#"+k.configId;a="#"+M(b,"\u80f6\u7247\u5c3a\u5bf8");r.size=a;J(a,"8INX10IN","8INX10IN");J(a,"10INX12IN","10INX12IN");J(a,"10INX14IN","10INX14IN");J(a,"11INX14IN","11INX14IN");J(a,"14INX14IN","14INX14IN");J(a,"14INX17IN","14INX17IN");a="#"+M(b,"\u65b9\u5411");r.direct=a;J(a,"\u7eb5\u5411","PORTRAIT");J(a,"\u6a2a\u5411","LANDSCAPE");a="#"+M(b,"\u989c\u8272");r.color=a;J(a,"\u5f69\u8272","multicolour");J(a,"\u7070\u9636","grayscale");a="#"+M(b,"\u6253\u5370\u673a");r.printer=a;d.LoadPrintToSelelct(a,"pointer");a="#"+N(b,"\u5f00\u59cb\u6253\u5370");r.startPrint=a;a="#"+N(b,"\u53d6\u6d88\u6253\u5370");r.cancelPrint=a;H()})()};CBoBo.View.DVPrintInfo=function(){this.DicomInfos=[];this.ImageDisplayFormat;this.Size;this.Direct};CBoBo.View.DVPrintImageInfo=function(){this.ID;this.WindowLevel;this.WindowWidth;this.Multiple;this.TopLeftLabels;this.TopRightLabels;this.DownLeftLabels;this.DownRightLabels;this.TopLabel;this.DownLabel;this.LeftLabel;this.RightLabel};CBoBo.View.DVPrintImageDescribe=function(){this.Describe=[]};CBoBo.View.MenuBall=function(){this.breatheID;this.touchStartPosX;this.touchStartPosY;this.CircleLeft;this.CircleTop;this.CircleWidth;this.CircleHeight;this.breatheRadius;this.breatheCentreX;this.breatheCentreY;this.documentWidth;this.documentHeight;this.startTimeStamp;this.HomeMenu;this.CentreClick;this.CreateBall=function(){this.breatheID="#breatheBall";$('\x3cdiv id\x3d"menuCircle" class\x3d\'icon_tool\'\x3e\x3cdiv id \x3d"menuRing"\x3e\x3c/div\x3e\x3cdiv id\x3d"breatheBall"\x3e\x3c/div\x3e\x3c/div\x3e').appendTo($("body"));this.Int();this.AddEnvent()};this.SetMainMenu=function(e){this.HomeMenu=e;this.HomeMenu()};this.Animation=function(e){switch(e){case 1:$("#menuRing").addClass("itemRingRotate");setTimeout("$('#menuRing').removeClass('itemRingRotate');",700);break;case 2:$("#menuRing").addClass("itemRingRotate1");setTimeout("$('#menuRing').removeClass('itemRingRotate1');",700);break;case 3:$("#menuRing").addClass("itemRingFade"),setTimeout("$('#menuRing').removeClass('itemRingFade');",700)}};this.CloseRingMenu=function(){$("#menuCircle").hasClass("open")&&$("#menuCircle").removeClass("open")};this.OpenRingMenu=function(e){$("#menuCircle").hasClass("open")||$("#menuCircle").addClass("open")};this.Clear=function(){$(".menuItem").unbind();$("#menuRing").empty();this.CentreClick=null};this.SetCentreIcon=function(e){var c=$(this.breatheID);c.empty();$("\x3cspan class\x3dbreatheBallCentre\x3e"+e+"\x3c/span\x3e").appendTo(c)};this.Push=function(e,c,a,g){void 0==c&&(c="");var b="cMenuItem"+CBoBo.Plugin.GetRandom();e="\x3cdiv class\x3d'menuItem' id\x3d\""+b+("\" title\x3d'"+c+"'\x3e\x3cp style\x3d'pointer-events:none;'\x3e"+e+"\x3c/p\x3e\x3cp class\x3d\"itemTitle\" style\x3d'pointer-events:none;'\x3e")+c;e+="\x3c/p\x3e\x3c/div\x3e";$(e).appendTo($("#menuRing"));if(void 0!=a){var b="#"+b,d=b+" p:first-child",h=b+" p:last-child",k=this;$(b).bind("touchstart",function(a){k.startTimeStamp=a.timeStamp;$(h).css("color","#67CBFA")});$(b).bind("touchend",function(b){if(200>b.timeStamp-k.startTimeStamp){var c=$(d).text();k.SetCentreIcon(c);a(b)}$(h).css("color","#FFF")})}g&&$(d).css({transform:"rotate("+g+"deg)"})};this.PushImage=function(e,c,a){var g=CBoBo.Plugin.GetRandom();$("\x3cdiv class\x3d'menuItem' id\x3d'"+g+"' title\x3d'"+c+"'\x3e\x3cimg class\x3d'pseudocolor' src\x3d'"+e+"'/\x3e\x3cdiv class\x3d'itemTitle' style\x3d'pointer-events:none;'\x3e"+c+"\x3c/div\x3e\x3c/div\x3e").appendTo($("#menuRing"));if(void 0!=a){e="#"+g;var b=e+" p:first-child",d=e+" p:last-child",h=this;$(e).bind("touchstart",function(a){h.startTimeStamp=a.timeStamp;$(d).css("color","#67CBFA")});$(e).bind("touchend",function(c){if(200>c.timeStamp-h.startTimeStamp){var e=$(b).text();h.SetCentreIcon(e);a(c)}$(d).css("color","#FFF")})}};this.FlushMenu=function(){for(var e=document.querySelectorAll(".menuItem"),c=0,a=e.length;c<a;c++)e[c].style.left=(50-35*Math.cos(-.5*Math.PI-1/a*2*c*Math.PI)).toFixed(4)+"%",e[c].style.top=(50+35*Math.sin(-.5*Math.PI-1/a*2*c*Math.PI)).toFixed(4)+"%"};this.Int=function(){this.breatheRadius=$(this.breatheID).width()/2;this.documentWidth=$(window).width()-1;this.documentHeight=$(window).height()-1;this.CircleWidth=$("#menuCircle").width();this.CircleHeight=$("#menuCircle").height()};this.AddEnvent=function(){var e=this;$(this.breatheID).bind("touchstart",function(c){e.BreatheTouchStart(c)});$(this.breatheID).bind("touchmove",function(c){e.BreatheTouchMove(c)});$(this.breatheID).bind("touchend",function(c){e.BreatheTouchEnd(c)});$(document).bind("touchstart",function(c){e.DocumentTouchStart(c)});$(document).bind("touchend",function(c){e.DocumentTouchEnd(c)});$("#menuCircle").bind("touchmove touchstart touchend",function(c){e.CircleEvent(c)})};this.WindowResize=function(e){e=$(window).width();var c=$(window).height();this.CircleLeft=$("#menuCircle").offset().left;this.CircleTop=$("#menuCircle").offset().top;var a=this.CircleLeft*e/this.documentWidth,g=this.CircleTop*c/this.documentHeight,b=e-this.CircleWidth/2-this.breatheRadius-2,d=-this.CircleWidth/2+this.breatheRadius+2,h=c-this.CircleHeight/2-this.breatheRadius-2,k=-this.CircleHeight/2+this.breatheRadius+2;a>b?a=b:a<d&&(a=d);g>h?g=h:g<k&&(g=k);$("#menuCircle").css({left:a+"px",top:g+"px"});this.documentWidth=e;this.documentHeight=c};this.BreatheTouchStart=function(e){this.startTimeStamp=e.timeStamp;e=e.originalEvent.targetTouches[0];this.touchStartPosX=e.screenX;this.touchStartPosY=e.screenY;this.CircleLeft=$("#menuCircle").offset().left;this.CircleTop=$("#menuCircle").offset().top};this.BreatheTouchMove=function(e){e.preventDefault();e=e.originalEvent.targetTouches[0];this.breatheCentreX=e.screenX;this.breatheCentreY=e.screenY;e=this.breatheCentreX-this.touchStartPosX+this.CircleLeft;var c=this.breatheCentreY-this.touchStartPosY+this.CircleTop,a=this.documentWidth-this.CircleWidth-2,g=this.documentHeight-this.CircleHeight-2;e>a?e=a:1>e&&(e=1);c>g?c=g:1>c&&(c=1);$("#menuCircle").css({left:e+"px",top:c+"px"})};this.SetCentreClick=function(e){this.CentreClick=e};this.BreatheTouchEnd=function(e){200>e.timeStamp-this.startTimeStamp&&(void 0==this.CentreClick||null==this.CentreClick?0<document.querySelectorAll(".menuItem").length&&$("#menuCircle").toggleClass("open"):(this.CentreClick(),this.CentreClick=null))};this.DocumentTouchStart=function(e){this.startTimeStamp=e.timeStamp};this.DocumentTouchEnd=function(e){200>e.timeStamp-this.startTimeStamp&&(this.CloseRingMenu(),this.Clear(),this.HomeMenu())};this.CircleEvent=function(e){e.stopPropagation();e.preventDefault()}};CBoBo.View.MobileMenuBall=function(e){var c=this;this.menuBall;var a=e.msgtransform,g,b=!1,d;this.toolType;this.bShowCornerInfo=!0;this.menuBall=new CBoBo.View.MenuBall;this.menuBall.CreateBall();this.SeriesHomeMenu=function(){c.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",c.MsgTransform);c.menuBall.Push("\x26#xe61b;","\u8c03\u7a97",c.MsgTransform);c.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",c.MsgTransform);c.menuBall.Push("\x26#xe644;","\u6062\u590d",c.MsgTransform);c.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",c.MsgTransform);c.menuBall.Push("\x26#xe604;","\u6d4b\u91cf",c.MsgTransform);c.menuBall.Push("\x26#xe60d;","\u65cb\u8f6c",c.MsgTransform);c.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",c.MsgTransform);c.menuBall.Push("\x26#xe63d;","\u5e8f\u5217\u5e03\u5c40",c.MsgTransform);c.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",c.MsgTransform);c.menuBall.Push("\x26#xe643;","MPR",c.MsgTransform);c.menuBall.FlushMenu()};this.DeSeriesHomeMenu=function(){c.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",c.MsgTransform);c.menuBall.Push("\x26#xe61b;","\u8c03\u7a97",c.MsgTransform);c.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",c.MsgTransform);c.menuBall.Push("\x26#xe644;","\u6062\u590d",c.MsgTransform);c.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",c.MsgTransform);c.menuBall.Push("\x26#xe604;","\u6d4b\u91cf",c.MsgTransform);c.menuBall.Push("\x26#xe60d;","\u65cb\u8f6c",c.MsgTransform);c.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",c.MsgTransform);c.menuBall.Push("\x26#xe63d;","\u5e8f\u5217\u5e03\u5c40",c.MsgTransform);c.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",c.MsgTransform);c.menuBall.FlushMenu()};this.JpgHomeMenu=function(){c.menuBall.Push("\x26#xe67f;","\u91cd\u65b0\u52a0\u8f7d",c.MsgTransform);c.menuBall.Push("\x26#xe61b;","\u4eae/\u5bf9\u6bd4",c.MsgTransform);c.menuBall.Push("\x26#xe603;","\u8d1f\u50cf",c.MsgTransform);c.menuBall.Push("\x26#xe644;","\u6062\u590d",c.MsgTransform);c.menuBall.Push("\x26#xe653;","\u5220\u9664\u56fe\u50cf",c.MsgTransform);c.menuBall.Push("\x26#xe62a;","\u56fe\u50cf\u5e03\u5c40",c.MsgTransform);c.menuBall.Push("\x26#xe602;","\u4f2a\u5f69",c.MsgTransform);c.menuBall.FlushMenu()};this.MprHomeMenu=function(){c.menuBall.Push("\x26#xe658;","2D",c.MsgTransform);c.menuBall.Push("\x26#xe61b;","\u5207\u9762\u8c03\u7a97",c.MsgTransform);c.menuBall.Push("\x26#xe6aa;","\u5341\u5b57\u5207\u9762",c.MsgTransform);c.menuBall.FlushMenu()};this.MsgTransform=function(e){switch(e.target.title){case "\u6d4b\u91cf":c.MeasureMenu();break;case "\u65cb\u8f6c":c.RotateMenu();break;case "\u56fe\u50cf\u5e03\u5c40":case "\u5e8f\u5217\u5e03\u5c40":d=e.target.title;c.LayoutMenu();break;case "\u4f2a\u5f69":c.PseudoColor();break;case "\u8c03\u7a97":case "\u4eae/\u5bf9\u6bd4":case "\u6062\u590d":case "\u79fb\u52a8":case "\u8d1f\u50cf":case "\u5220\u9664\u56fe\u50cf":case "\u76f4\u7ebf":case "\u77e9\u5f62":case "CT":case "\u692d\u5706":case "\u6587\u672c":case "\u7bad\u5934":case "\u5de6\u6807\u8bb0":case "\u53f3\u6807\u8bb0":case "\u91cd\u65b0\u52a0\u8f7d":case "\u5207\u9762\u8c03\u7a97":case "\u5341\u5b57\u5207\u9762":c.menuBall.CloseRingMenu();void 0!==a&&a(e);break;case "1x1":e={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:1,ctrltype:d};void 0!=a&&a(e);break;case "1x2":e={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:1,col:2,ctrltype:d};void 0!=a&&a(e);break;case "2x1":e={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:1,ctrltype:d};void 0!=a&&a(e);break;case "2x2":e={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:2,ctrltype:d};void 0!=a&&a(e);break;case "2x3":e={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:2,col:3,ctrltype:d};void 0!=a&&a(e);break;case "3x2":e={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:3,col:2,ctrltype:d};void 0!=a&&a(e);break;case "3x3":e={target:{title:"\u5e03\u5c40\u63a7\u4ef6"},row:3,col:3,ctrltype:d};void 0!=a&&a(e);break;case "MPR":b=!0;c.Clear();h();a&&a(e);break;case "2D":b=!1,c.Clear(),h();default:void 0!=a&&a(e)}};this.RequestToolBall=function(b,c){if(b!==g||a!==c)g=b,a=c,h()};this.PseudoColor=function(){c.Clear(3);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/0.jpg","\u7070\u8272",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/1.jpg","\u5f69\u8679",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/2.jpg","\u9ed1\u4f53",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/3.jpg","\u9aa8\u9abc",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/4.jpg","\u5fc3\u810f",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/5.jpg","\u6d41\u52a8",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/6.jpg","Ge\u8272",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/8.jpg","\u70ed\u7eff",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/9.jpg","\u94ec\u94c1",c.MsgTransform);c.menuBall.PushImage("./dicomviewer/css/pseudocolor/10.jpg","\u70ed\u91d1\u5c5e",c.MsgTransform);c.menuBall.FlushMenu();c.menuBall.SetCentreClick(c.BackHome)};this.RotateMenu=function(){c.Clear(3);c.menuBall.Push("\x26#xe61d;","\u9006\u65f6\u9488",c.MsgTransform);c.menuBall.Push("\x26#xe61c;","\u987a\u65f6\u9488",c.MsgTransform);c.menuBall.Push("\x26#xe63a;","\u5de6\u53f3\u955c\u50cf",c.MsgTransform);c.menuBall.Push("\x26#xe639;","\u4e0a\u4e0b\u955c\u50cf",c.MsgTransform);c.menuBall.FlushMenu();c.menuBall.SetCentreClick(c.BackHome)};this.MeasureMenu=function(){c.Clear(3);c.menuBall.Push("\x26#xe61f;","\u76f4\u7ebf",c.MsgTransform);c.menuBall.Push("\x26#xe619;","\u77e9\u5f62",c.MsgTransform);c.menuBall.Push("\x26#xe637;","CT",c.MsgTransform);c.menuBall.Push("\x26#xe61e;","\u692d\u5706",c.MsgTransform);c.menuBall.Push("\x26#xe629;","\u6587\u672c",c.MsgTransform);c.menuBall.Push("\x26#xe62f;","\u7bad\u5934",c.MsgTransform);c.menuBall.Push("L","\u5de6\u6807\u8bb0",c.MsgTransform);c.menuBall.Push("R","\u53f3\u6807\u8bb0",c.MsgTransform);c.menuBall.Push("\x26#xe622;","\u64a4\u9500",c.MsgTransform);c.menuBall.FlushMenu();c.menuBall.SetCentreClick(c.BackHome)};this.LayoutMenu=function(){c.Clear(3);c.menuBall.Push("\x26#xe667;","1x1",c.MsgTransform);c.menuBall.Push("\x26#xe66f;","1x2",c.MsgTransform,90);c.menuBall.Push("\x26#xe66f;","2x1",c.MsgTransform);c.menuBall.Push("\x26#xe66e;","2x2",c.MsgTransform);c.menuBall.Push("\x26#xe66a;","3x2",c.MsgTransform,90);c.menuBall.Push("\x26#xe66a;","2x3",c.MsgTransform);c.menuBall.Push("\x26#xe66d;","3x3",c.MsgTransform);c.menuBall.FlushMenu();c.menuBall.SetCentreClick(c.BackHome)};this.Clear=function(a){void 0!==a&&c.menuBall.Animation(a);c.menuBall.Clear()};this.BackHome=function(){c.Clear(3);b?c.MprHomeMenu():g==CBoBo.PTYPE_JPG?c.JpgHomeMenu():g==CBoBo.PTYPE_SERIES?c.SeriesHomeMenu():c.DeSeriesHomeMenu();c.menuBall.OpenRingMenu()};var h=function(){b?c.menuBall.SetMainMenu(c.MprHomeMenu):g==CBoBo.PTYPE_JPG?c.menuBall.SetMainMenu(c.JpgHomeMenu):g==CBoBo.PTYPE_SERIES?c.menuBall.SetMainMenu(c.SeriesHomeMenu):c.menuBall.SetMainMenu(c.DeSeriesHomeMenu)}};CBoBo.View.SeriesPlayer=function(e){this.bShow;var c=1,a=1,g,b,d=$.extend(!0,{msgtransform:null},e),h={},k=null,f=function(b){var e=!0;2>c&&(e=!1);var f=!0;if(e){var k=$("."+h.playItem).eq(2);switch(b.target.title){case "\u7b2c\u4e00\u5f20":a=1;break;case "\u4e0a\u4e00\u5f20":a=1>--a?1:a;break;case "\u64ad\u653e":null!=d.msgtransform&&(b.usermsg="seriesplay",b.value=a,d.msgtransform(b));p();k.html("\x26#xe713;");k.attr("title","\u6682\u505c");f=!1;g=!0;break;case "\u6682\u505c":l();setTimeout(function(){null!=d.msgtransform&&(b.usermsg="seriesplay",b.value=a,d.msgtransform(b));k.html("\x26#xe724;");k.attr("title","\u64ad\u653e")},100);f=g=!1;break;case "\u4e0b\u4e00\u5f20":a=++a>c?c:a;break;case "\u6700\u540e\u4e00\u5f20":a=c;break;case "\u64ad\u653e\u901f\u5ea6":g&&(l(),p()),f=!1}}m();null!=d.msgtransform&&f&&("userdocument"==b.userdocument?d.msgtransform({usermsg:"seriesplay",value:a,userdocument:"userdocument"}):d.msgtransform({usermsg:"seriesplay",value:a}))},p=function(){var e=$("#"+h.playSpeed).val();void 0!=e&&($("body").css("pointer-events","none"),b=setInterval(function(){a++;a>c&&(a=1);null!=d.msgtransform&&d.msgtransform({usermsg:"seriesplay",value:a})},1E3/e))},l=function(){clearInterval(b);b=null;$("body").css("pointer-events","auto")},m=function(){var b=$("."+h.playItem),d=b.eq(0),e=b.eq(1),f=b.eq(2),k=b.eq(3),b=b.eq(4);2>c?(d.css({"pointer-events":"none",color:"gray"}),e.css({"pointer-events":"none",color:"gray"}),f.css({"pointer-events":"none",color:"gray"}),k.css({"pointer-events":"none",color:"gray"}),b.css({"pointer-events":"none",color:"gray"})):g?(d.css({"pointer-events":"none",color:"gray"}),e.css({"pointer-events":"none",color:"gray"}),f.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"none",color:"gray"}),b.css({"pointer-events":"none",color:"gray"})):2>a?(d.css({"pointer-events":"none",color:"gray"}),e.css({"pointer-events":"none",color:"gray"}),f.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"auto",color:"#33FFFF"}),b.css({"pointer-events":"auto",color:"#33FFFF"})):a>c-1?(d.css({"pointer-events":"auto",color:"#33FFFF"}),e.css({"pointer-events":"auto",color:"#33FFFF"}),f.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"none",color:"gray"}),b.css({"pointer-events":"none",color:"gray"})):(d.css({"pointer-events":"auto",color:"#33FFFF"}),e.css({"pointer-events":"auto",color:"#33FFFF"}),f.css({"pointer-events":"auto",color:"#33FFFF"}),k.css({"pointer-events":"auto",color:"#33FFFF"}),b.css({"pointer-events":"auto",color:"#33FFFF"}));$("#"+h.playSpeed).css({"pointer-events":"auto"})};this.SetPosition=function(a,b){$("#"+h.ctrl).css({left:a+"px",top:b+"px"})};this.Show=function(a){var b=$("#"+h.ctrl);a?(this.bShow=!0,b.hide(),b.show(200)):(this.bShow=!1,b.hide(400))};this.SetRange=function(b,d){isNaN(b)||(c=b,a=d,void 0==a&&(a=1),g=!1,b=$("."+h.playItem).eq(2),b.html("\x26#xe724;"),b.attr("title","\u64ad\u653e"),m())};this.TriggerClick=function(a){$("."+h.playItem).eq(a).triggerHandler("click")};this.SaveSeriesTag=function(a){k=a};this.GetSeriesTag=function(){return k};(function(){h.ctrl=CBoBo.Plugin.GetRandom();h.playItem=CBoBo.Plugin.GetRandom();h.playfps=CBoBo.Plugin.GetRandom();h.playSpeed=CBoBo.Plugin.GetRandom();var a="\x3cdiv id\x3d'"+h.ctrl+"' class\x3d'icon-player'\x3e\x3cul\x3e",a=a+("\x3cli\x3e\x3cspan class\x3d'player "+h.playItem+"' title\x3d'\u7b2c\u4e00\u5f20'\x3e\x26#xe76a;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+h.playItem+"' title\x3d'\u4e0a\u4e00\u5f20'\x3e\x26#xe68d;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+h.playItem+"' title\x3d'\u64ad\u653e'\x3e\x26#xe724;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+h.playItem+"' title\x3d'\u4e0b\u4e00\u5f20'\x3e\x26#xe68c;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan class\x3d'player "+h.playItem+"' title\x3d'\u6700\u540e\u4e00\u5f20'\x3e\x26#xe769;\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cspan  id\x3d'"+h.playfps+"'\x3eFPS\x3c/span\x3e\x3c/li\x3e"),a=a+("\x3cli\x3e\x3cinput id\x3d'"+h.playSpeed+"' type\x3d'number' min\x3d'1' max\x3d'50' value\x3d'10' title\x3d'\u64ad\u653e\u901f\u5ea6'/\x3e\x3c/li\x3e");$(a+"\x3c/ul\x3e\x3c/div\x3e").appendTo($("body")).width(293).height(40).css({position:"absolute",background:"rgba(0,0,0,1)","z-index":11111,border:"1px solid #33FFFF","border-radius":"6px 6px","user-select":"none","font-size":"40px"})})();$("#"+h.ctrl+" ul").css({"list-style":"none",position:"absolute",margin:"auto",left:0,top:0,bottom:0,right:0,padding:"0"});$("#"+h.ctrl+" ul li").css({display:"inline-block"});$("#"+h.playfps).css({"font-size":"16px","font-family":"Microsoft YaHei","margin-left":"10px","vertical-align":"middle",cursor:"default",color:"#FFF"});$("#"+h.playSpeed).height(18).width(35).css({"margin-left":"5px","vertical-align":"middle"});(function(){$("."+h.playItem).bind("click",function(a){f(a);a.stopPropagation()});$("#"+h.playSpeed).bind("change",function(a){f(a)});$(document).bind("click",function(a){a.userdocument="userdocument";f(a)})})();!0};CBoBo.View.ContextMenu=function(e){var c,a=$.extend(!0,{offsetX:2,offsetY:2,speed:300,flash:!1,items:[],action:null},e),g=this,b;this.ctrl;this.bShow=!1;this.Create=function(){b="cbobo"+CBoBo.Plugin.GetRandom();var c="";$.each(a.items,function(a,b){b&&(c+="\x3cli title\x3d'"+b.text+"' class\x3d'ctxmenu'\x3e\x3cspan\x3e"+b.text+"\x3c/span\x3e\x3c/li\x3e")});this.ctrl=$("\x3cdiv id\x3d'"+b+"'\x3e\x3cul\x3e"+c+"\x3c/ul\x3e\x3c/div\x3e").appendTo("body");this.ctrl.css({position:"absolute","border-radius":"5px","z-index":999999,"-webkit-user-select":"none","background-color":"rgba(56, 56, 56, 0.8)",border:"1px solid rgba(80, 80, 80, 1)","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none","box-shadow":"-2px 2px 5px #000"});$("#"+b+" ul").css({"list-style":"none",padding:"0",margin:"0"});$("#"+b+" ul li").css({padding:"2px",margin:"0",display:"block"});$("#"+b+" ul li span").css({"pointer-events":"none"})};this.SetPosition=function(a,b){this.ctrl.css({left:a+"px",top:b+"px"});return this};this.Show=function(b){(this.bShow=b)?(this.ctrl.hide(),a.flash?this.ctrl.show(a.speed):this.ctrl.show()):a.flash?this.ctrl.hide(a.speed):this.ctrl.hide();return this};this.UpdateStyle=function(){var a=$(window).width(),c=$(window).height(),a=Math.max(a,c)/17>>0;63>a&&(a=63);this.ctrl.css({width:a+"px","font-size":(.1234*a>>0)+"px"});a=.2*a>>0;$("#"+b+" ul li").css({"padding-left":a+"px"})};this.AddEvent=function(){CBoBo.Plugin.GetBrowserInfo().isMobile?($(document).bind("touchstart",function(a){g.Show(!1)}),$("#"+b+" li").bind("touchstart",function(b){b.reservedata=c;b.btntitle=b.target.title;null!=a.action&&a.action(b);b.stopPropagation()})):($(document).bind("mousedown",function(a){1==a.which&&g.Show(!1)}),$("#"+b+" li").bind("mousedown",function(b){b.reservedata=c;b.btntitle=b.target.title;null!=a.action&&a.action(b)}))};this.SetReserve=function(a){c=a};this.GetReserve=function(){return c};this.Destroy=function(){$("#"+b).remove()};g.Create();g.UpdateStyle();g.AddEvent();!0};CBoBo.View.Scroll=function(e){this.opt=$.extend(!0,{parent:null,axis:"y",showbutton:!0,size:20,range:100,offset:0,railalign:"center",msgtransform:null},e);this.arrClass={};this.rangeMap=this.draggerPos=1;this.stack=[];null!=this.opt.parent&&(this.Create(),this.UpdateStyle(),this.AddEvent());!0};CBoBo.View.Scroll.prototype.GetId=function(e){switch(e){case "ctrl":return this.arrClass.ctrl=CBoBo.Plugin.GetRandom();case "buttonl_t":return this.arrClass.buttonl_t;case "buttonr_b":return this.arrClass.buttonr_b;case "container":return this.arrClass.container;case "dragger_bar":return this.arrClass.dragger_bar;case "dragger":return this.arrClass.dragger;case "dragger_rail":return this.arrClass.dragger_rail}};CBoBo.View.Scroll.prototype.Create=function(){this.arrClass.ctrl=CBoBo.Plugin.GetRandom();this.arrClass.buttonl_t=CBoBo.Plugin.GetRandom();this.arrClass.buttonr_b=CBoBo.Plugin.GetRandom();this.arrClass.container=CBoBo.Plugin.GetRandom();this.arrClass.dragger_bar=CBoBo.Plugin.GetRandom();this.arrClass.dragger=CBoBo.Plugin.GetRandom();this.arrClass.dragger_rail=CBoBo.Plugin.GetRandom();var e,c;"x"==this.opt.axis?(e="\x26#xe6d5;",c="\x26#xe6d6;"):"y"==this.opt.axis&&(e="\x26#xe6d7;",c="\x26#xe6d4;");e=$("\x3cdiv id\x3d'"+this.arrClass.ctrl+"' class\x3d'icon-player'\x3e\x3cspan id\x3d'"+this.arrClass.buttonl_t+"'\x3e"+e+"\x3c/span\x3e\x3cdiv id\x3d'"+this.arrClass.container+"'\x3e\x3cdiv id\x3d'"+this.arrClass.dragger_bar+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+this.arrClass.dragger+"'\x3e\x3cdiv id\x3d'"+this.arrClass.dragger_rail+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan id\x3d'"+this.arrClass.buttonr_b+"'\x3e"+c+"\x3c/span\x3e\x3c/div\x3e").appendTo(this.opt.parent);e.css({position:"absolute","background-color":"#333333",color:"rgba(255,255,255,0.3)"});return e};CBoBo.View.Scroll.prototype.SetRange=function(e,c){isNaN(e)||1>e||(this.rangeMap=e,void 0==c&&(c=1),this.draggerPos=c,this.UpdateStyle(),this.UpdateBtnStatus())};CBoBo.View.Scroll.prototype.UpdateStyle=function(){var e=$(this.opt.parent);if(void 0!=e){var c=$("#"+this.arrClass.ctrl),a=$("#"+this.arrClass.buttonl_t),g=$("#"+this.arrClass.buttonr_b),b=$("#"+this.arrClass.container),d=$("#"+this.arrClass.dragger_bar),h=$("#"+this.arrClass.dragger),k=$("#"+this.arrClass.dragger_rail);if("x"==this.opt.axis)k=e.width()*this.opt.range/100>>0,c.width(k).height(this.opt.size),k=e.width()-k>>1,c.css({left:k+"px",bottom:this.opt.offset+"px"});else if("y"==this.opt.axis){var f=e.height()*this.opt.range/100>>0;c.width(this.opt.size).height(f);e=e.height()-f>>1;c.css({top:e+"px",right:this.opt.offset+"px"});CBoBo.IsTablet?(a.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":"18px",position:"relative",Top:"0px"}),g.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":"18px",position:"relative",bottom:"8px"})):(a.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":this.opt.size+"px"}),g.width(this.opt.size).height(this.opt.size).css({cursor:"pointer","font-size":this.opt.size+"px",position:"absolute",bottom:"0px"}));c=f-(this.opt.size<<1)-4;b.width(this.opt.size).height(c).css({position:"relative"});b=c-2;CBoBo.IsTablet&&(b=c-10);d.width(this.opt.size).height(b).css({"border-top":"1px solid #000","border-bottom":"1px solid #000"});c=b/this.rangeMap>>0;c=10>c?10:c;d=(this.draggerPos-1)/(this.rangeMap-1)*(b-c)+1;h.width(this.opt.size).height(c).css({position:"absolute",top:d+"px"});h=this.opt.size-5;k.width(h).height(c).css({"background-color":"rgba(255,255,255,0.2)","border-radius":"1px"});switch(this.opt.railalign){case "center":k.css({position:"absolute",left:(this.opt.size-h)/2+"px"})}}}};CBoBo.View.Scroll.prototype.AddEvent=function(){function e(a){switch(a.type){case "touchstart":case "mousedown":c(a);break;case "touchmove":case "mousemove":if(b.stack[0]){var e=b.GetId("dragger_rail");$("#"+e).triggerHandler("mouseenter");b.evenType=a.type;var f;"touchmove"==a.type?(a=a.originalEvent.targetTouches[0],"y"==b.opt.axis?f=a.pageY-b.stack[1]+b.stack[2]:"x"==b.opt.axis&&(f=a.pageX-b.stack[1]+b.stack[2])):"mousemove"==a.type&&("y"==b.opt.axis?f=a.pageY-b.stack[1]+b.stack[2]:"x"==b.opt.axis&&(f=a.pageX-b.stack[1]+b.stack[2]));f=f>b.stack[3]?b.stack[3]:f;f=1>f?1:f;"y"==b.opt.axis?b.stack[4].css("top",f+"px"):"x"==b.opt.axis&&b.stack[4].css("left",f+"px");b.draggerPos=Math.round(f/(b.stack[3]/(b.rangeMap-1)))+1;d!=b.draggerPos&&(b.UpdateBtnStatus(),d=b.draggerPos,b.opt.msgtransform({type:"scroll",value:b.draggerPos,scroll:b}))}break;case "touchend":case "mouseup":if(!(1>b.stack)){for(f=0;5>f;f++)b.stack.pop();f=b.GetId("dragger_rail");$("#"+f).triggerHandler("mouseout")}}}function c(a){var c,d;if("touchstart"==a.type){var e=a.originalEvent.targetTouches[0];c=e.pageX;d=e.pageY}else"mousedown"==a.type&&(c=a.pageX,d=a.pageY);var e=$("#"+b.arrClass.dragger),g=e.position(),h=$("#"+b.arrClass.dragger_bar);b.stack.push(!0);"y"==b.opt.axis?(b.stack.push(d),b.stack.push(g.top),c=h.height()-e.height(),b.stack.push(c)):"x"==b.opt.axis&&(b.stack.push(c),b.stack.push(g.left),c=h.width()-e.width(),b.stack.push(c));b.stack.push(e);a.stopPropagation()}function a(a){var c=b.draggerPos;"lt"==a?(b.draggerPos--,b.draggerPos=1>b.draggerPos?1:b.draggerPos):"rb"==a&&(b.draggerPos++,b.draggerPos=b.draggerPos>b.rangeMap?b.rangeMap:b.draggerPos);c!=b.draggerPos&&(b.FlushDraggerPos(),b.UpdateBtnStatus(),b.opt.msgtransform({type:"scroll",value:b.draggerPos,scroll:b}))}function g(a){var c,d;"touchstart"==a.type?(d=a.originalEvent.targetTouches[0],c=d.pageX,d=d.pageY):"mousedown"==a.type&&(c=a.pageX,d=a.pageY);a=$("#"+b.arrClass.dragger);var e=$("#"+b.arrClass.dragger_bar),g,h=1;"y"==b.opt.axis?(g=e.height()-a.height(),h=d-$("#"+b.arrClass.container).offset().top-a.height()/2+1,h=1>h?1:h,h=h>g?g:h,a.css("top",h+"px")):"x"==b.opt.axis&&(g=e.width()-a.width(),h=c-$("#"+b.arrClass.container).offset().left-a.width()/2+1,h=1>h?1:h,h=h>g?g:h,a.css("left",h+"px"));b.draggerPos=Math.ceil(h/g*b.rangeMap);b.UpdateBtnStatus();b.opt.msgtransform({type:"scroll",value:b.draggerPos,scroll:b})}var b=this;$(window).bind("resize",function(a){b.UpdateStyle()});CBoBo.Plugin.GetBrowserInfo().isMobile?($("#"+this.arrClass.dragger).bind("touchstart",e),$(document).bind("touchmove touchend",e),$("#"+this.arrClass.buttonl_t).bind("touchstart",function(b){a("lt")}),$("#"+this.arrClass.buttonr_b).bind("touchstart",function(b){a("rb")}),$("#"+this.arrClass.container).bind("touchstart",function(a){g(a);c(a)})):($("#"+this.arrClass.dragger).bind("touchstart",e),$(document).bind("touchmove touchend",e),$("#"+this.arrClass.container).bind("touchstart",function(a){g(a);c(a)}),$("#"+this.arrClass.dragger).bind("mousedown",e),$(document).bind("mousemove mouseup",e),$("#"+this.arrClass.dragger_rail).bind("mouseenter mouseout",function(a){"mouseenter"==a.type?$(this).css({cursor:"pointer","background-color":"rgba(255,255,255,0.3)"}):"mouseout"==a.type&&$(this).css({cursor:"default","background-color":"rgba(255,255,255,0.2)"})}),$("#"+this.arrClass.buttonl_t).bind("mousedown",function(b){"mousedown"==b.type&&a("lt")}),$("#"+this.arrClass.buttonr_b).bind("mousedown",function(b){"mousedown"==b.type&&a("rb")}),$("#"+this.arrClass.container).bind("mousedown",function(a){g(a);c(a)}));var d=1};CBoBo.View.Scroll.prototype.FlushDraggerPos=function(e){void 0!=e&&(this.draggerPos=e);e=$("#"+this.arrClass.dragger);var c=$("#"+this.arrClass.dragger_bar);"y"==this.opt.axis?(c=c.height()-e.height(),e.css("top",(this.draggerPos-1)/(this.rangeMap-1)*c+1+"px")):"x"==this.opt.axis&&(c=c.width()-e.width(),e.css("left",(this.draggerPos-1)/(this.rangeMap-1)*c+1+"px"))};CBoBo.View.Scroll.prototype.TriggerClick=function(e){id=0<e?this.GetId("buttonl_t"):this.GetId("buttonr_b");$("#"+id).triggerHandler("mousedown")};CBoBo.View.Scroll.prototype.TriggerDragger=function(e){this.FlushDraggerPos(e);this.UpdateBtnStatus();this.opt.msgtransform&&this.opt.msgtransform({type:"scroll",value:e,scroll:this})};CBoBo.View.Scroll.prototype.Enable=function(e){var c=$("#"+this.arrClass.ctrl),a=$("#"+this.arrClass.dragger);e?(c.css({"pointer-events":"auto"}),a.show()):(c.css({"pointer-events":"none"}),a.hide())};CBoBo.View.Scroll.prototype.UpdateBtnStatus=function(){var e=$("#"+this.arrClass.buttonl_t),c=$("#"+this.arrClass.buttonr_b);1==this.draggerPos?(e.css({color:"rgba(255,255,255,0.1)","pointer-events":"none"}),c.css({color:"rgba(255,255,255,0.3)","pointer-events":""})):this.draggerPos==this.rangeMap?(e.css({color:"rgba(255,255,255,0.3)","pointer-events":""}),c.css({color:"rgba(255,255,255,0.1)","pointer-events":"none"})):(e.css({color:"rgba(255,255,255,0.3)","pointer-events":""}),c.css({color:"rgba(255,255,255,0.3)","pointer-events":""}))};CBoBo.View.Msg=function(e){function c(a,b){var c=CBoBo.Plugin.GetRandom();(function(){var d;switch(b){case CBoBo.MSG_SUCCESS:d="\x26#xe63c;";break;case CBoBo.MSG_ERROR:d="\x26#xe686;";break;default:d="\x26#xe628;"}e("\x3cdiv id\x3d'"+c+"'\x3e\x3cspan class\x3d'icon_tool'\x3e"+d+"\x3c/span\x3e\x3cspan\x3e"+a+"\x3c/span\x3e\x3c/div\x3e").appendTo(e("body"))})();(function(){var a=e("#"+c),d,g;switch(b){case CBoBo.MSG_SUCCESS:d="#058912";g="#08ED1F";break;case CBoBo.MSG_ERROR:d="#F0120A";g="#F0524D";break;default:d="#FAF003",g="#525503"}a.css({position:"absolute",right:"10px",background:d,height:"50px","box-shadow":"0 0 10px "+g,padding:"5px","border-radius":"5px","pointer-events":"none","z-index":"9999999999999999",overflow:"hidden"});a=e("#"+c+" span");a.css({color:"#000",height:"50px","font-weight":"bold",display:"flex","align-items":"center","float":"left"});a.eq(0).css({"font-size":"35px","padding-right":"5px",color:g})})();this.Width=function(){return e("#"+c).width()+10};this.Height=function(){return e("#"+c).height()+10};this.SetBottom=function(a){e("#"+c).css({bottom:a+"px"})};this.Destroy=function(){var a=e("#"+c);void 0!=a&&(a.fadeOut(500),setTimeout(function(){a.remove()},500))};this.GetId=function(){return c}}function a(a){var c,d=CBoBo.Plugin.GetRandom(),f=function(a){var c=e("#"+d);c.fadeOut(3E3);setTimeout(function(){c.remove();b=void 0},3E3)};e("\x3cdiv id\x3d'"+d+"'\x3e\x3cspan\x3e"+a+"\x3c/span\x3e\x3c/div\x3e").appendTo(e("body")).css({position:"absolute",bottom:"2px",color:"#33FFFF","pointer-events":"none",padding:"0 2px","z-index":"99999"});c=setTimeout(f,3E3);this.Print=function(a){e("#"+d+" span").html(a);void 0!=c&&clearTimeout(c);c=setTimeout(f,3E3)}}var g=new function(){this.ctrl=CBoBo.Plugin.GetRandom();var a=[],b=function(b){setTimeout(function(b){var c=b.GetId();e.each(a,function(d,e){void 0!=e&&(e=e.GetId(),c==e&&(b.Destroy(),a.splice(d,1)))})},4E3,b)};this.Push=function(c){a.push(c);b(c);var d=0,g=e("body").height();c=-1;for(var h=a.length-1;-1<h;h--){var k=a[h],d=d+k.Height();if(d>g){c=h;break}}d=10;for(h=c+1;h<a.length;h++)k=a[h],k.SetBottom(d),d+=k.Height()+5;for(h=0;h<c+1;h++)k=a[h],k.Destroy();a.splice(0,c+1)};this.Length=function(){return a.length}},b;e.extend({Msg:function(a,b){g.Push(new c(a,b))},Status:function(c){void 0==b?b=new a(c):b.Print(c)}})}(jQuery);CBoBo.View.AI=function(e){this.bShow;this.isAIFinished=this.isAIReuest=!1;var c=$.extend(!0,{parent:null},e),a=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var e=$("#"+a),b=$(c.refrence),d=b.width(),b=b.height();e.width(d).height(b)};this.Show=function(c){var b=$("#"+a);c?(this.bShow=!0,b.hide(),b.fadeIn(400)):(this.bShow=!1,b.fadeOut(400))};$("\x3cdiv id\x3d'"+a+"'\x3e\x3c/div\x3e").appendTo($(c.refrence)).css({position:"absolute","z-index":1003,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"});this.UpdateStyle();e.parent="#"+a;e.aiRead=!0;this.secondCtrl=new CBoBo.View.CMngSecondLayer(e)};CBoBo.View.VRT=function(e){this.bShow;var c=null,a={mode:CBoBo.PTYPE_SERIES,parent:"body",msgtransform:null};this.bMsg;var g=$.extend(!0,a,e),b=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var a=$("#"+b),c=$(g.parent),e=c.width(),c=c.height();a.width(e).height(c).css({left:"10px",top:"10px"})};this.Show=function(a){var c=$("#"+b);a?(this.bShow=!0,c.hide(),c.fadeIn(400)):(this.bShow=!1,c.fadeOut(400))};this.Series=function(a){if(void 0==a)return c;c=a;this.bMsg=!0};this.SetLayout=function(a){this.mng.UpdateLayout(0,2,2);this.mng.SetSpBoundaryColor(0,"#FF0");this.mng.SetSpBoundaryColor(1,"#F00");this.mng.SetSpBoundaryColor(2,"#0F0");this.mng.SetSpBoundaryColor(3,"#00F")};(function(){var a=$("\x3cdiv id\x3d'"+b+"'\x3e\x3c/div\x3e").appendTo($(g.parent));void 0!=a&&a.css({position:"absolute","z-index":10001,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"})})();this.UpdateStyle();this.mng=new CBoBo.View.CMngFirstLayer({parent:"#"+b,single:!0,msgtransform:g.msgtransform})};CBoBo.View.MPR=function(e){this.bShow;var c=null,a={mode:CBoBo.PTYPE_SERIES,parent:"body",msgtransform:null},g;this.bMsg;var b=$.extend(!0,a,e),d=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var a=$("#"+d),c=$(b.parent),e=c.width(),c=c.height();a.width(e).height(c).css({left:"10px",top:"10px"})};this.Show=function(a){var b=$("#"+d);a?(this.bShow=!0,b.hide(),b.fadeIn(400)):(this.bShow=!1,b.fadeOut(400))};this.Series=function(a){if(void 0==a)return c;c=a;this.bMsg=!0};this.SetLayout=function(a){g!==a&&(3===a?(this.mng.UpdateLayoutSp3(0,"left"),this.mng.SetSpBoundaryColor(0,"#F00"),this.mng.SetSpBoundaryColor(1,"#0F0"),this.mng.SetSpBoundaryColor(2,"#00F")):4===a&&(this.mng.UpdateLayout(0,2,2),this.mng.SetSpBoundaryColor(0,"#F00"),this.mng.SetSpBoundaryColor(1,"#0F0"),this.mng.SetSpBoundaryColor(2,"#00F"),this.mng.SetSpBoundaryColor(3,"#FF0")),g=a)};(function(){var a=$("\x3cdiv id\x3d'"+d+"'\x3e\x3c/div\x3e").appendTo($(b.parent));void 0!=a&&a.css({position:"absolute","z-index":10001,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"})})();this.UpdateStyle();this.mng=new CBoBo.View.CMngFirstLayer({parent:"#"+d,single:!0,msgtransform:b.msgtransform})};CBoBo.View.DicomScan=function(e){var c=this,a=$.extend(!0,{msgtransform:null},e),g={};this.bShow;var b=function(a,b,c,e){void 0==e&&(e="\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;");b+=e;g.key||(g.key=CBoBo.Plugin.GetRandom());g.value||(g.value=CBoBo.Plugin.GetRandom());$("\x3cdiv\x3e\x3cspan class\x3d'icon_tool tool-item 1604335943322'\x3e"+b+"\x3c/span\x3e\x3cspan class\x3d'"+g.value+"'\x3e"+c+"\x3c/span\x3e\x3c/div\x3e").appendTo($(a)).css({height:"25px","margin-left":"20px"});b=$("."+g.key);b.css({color:"#FFF","font-size":"16px"});c=$("."+g.value);c.css({color:"#DDD","font-size":"14px"})};this.Show=function(a){var b=$("#"+g.ctrl);a?(b.fadeIn(300),this.bShow=!0):(b.fadeOut(800),this.bShow=!1)};this.SetDicomInfo=function(a){var c="#"+g.container;$(c).html("");a&&(b(c,"0008,0018",a.sopuid),b(c,"0008,0020",a.studt),b(c,"0008,0022",a.acqdt),b(c,"0008,0030",a.stutm),b(c,"0008,0032",a.acqtm),b(c,"0008,0050",a.accnum),b(c,"0008,0060",a.mod),b(c,"0008,0070",a.manu),b(c,"0008,0080",a.inst),b(c,"0008,1030",a.studes),b(c,"0008,103E",a.serdes),b(c,"0010,0010",a.name),b(c,"0010,0020",a.patid),b(c,"0010,0030",a.birth),b(c,"0010,0040",a.sex),b(c,"0010,1010 ",a.age),b(c,"0018,0050",a.sliceth),b(c,"0018,0060",a.kv),b(c,"0018,1151",a.ma),b(c,"0020,0010",a.stuid),b(c,"0020,000D",a.stuuid),b(c,"0020,000E",a.seruid),b(c,"0020,0011",a.serid),b(c,"0020,0013",a.imgnum),b(c,"0028,0002",a.sappix),b(c,"0028,0004",a.phme),b(c,"0028,0010",a.row),b(c,"0028,0011",a.col),b(c,"0028,0030",a.pixx+"/"+a.pixy),b(c,"0028,0100",a.bita),b(c,"0028,0101",a.bits),b(c,"0028,0102",a.hbit),b(c,"0028,0103",a.pixrep),b(c,"0028,1050",a.wc),b(c,"0028,1051",a.ww),b(c,"0028,1052",a.rescin),b(c,"0028,1053",a.rescsl),b(c,"\u56fe\u50cf\u65b9\u4f4d\u5de6",a.orl),b(c,"\u56fe\u50cf\u65b9\u4f4d\u4e0a",a.ort),b(c,"\u56fe\u50cf\u65b9\u4f4d\u53f3",a.orr),b(c,"\u56fe\u50cf\u65b9\u4f4d\u4e0b",a.orb));$("#"+g.container).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"})};g.ctrl=CBoBo.Plugin.GetRandom();g.title=CBoBo.Plugin.GetRandom();g.container=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+g.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+g.title+"'\x3e\x3cspan\x3eDicom\u4fe1\u606f\x3c/span\x3e\x3ca\x3e\x26#xe661;\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d'"+g.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));(function(){var a=$(window).width(),b=$(window).height(),a=.5*a>>0,a=600>a?600:a,b=.9*b>>0,b=300>b?300:b;$("#"+g.ctrl).width(a).height(b).css({border:"1px solid #676767",position:"absolute","z-index":11111,background:"#444444",display:"none","user-select":"none",color:"#CCCCC4"});$("#"+g.title).css({height:"30px",width:"100%",background:"#555555",cursor:"default","border-bottom":"1px solid #000","text-align":"center"});$("#"+g.title+" span").css({width:"15%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+g.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+g.container).width(a-6).height(b-6-30).css({"user-select":"auto",padding:"3px","font-family":"Microsoft YaHei",overflow:"auto"})})();(function(){var b=!1,e,k,f=$("#"+g.ctrl);$("#"+g.title).bind("mousedown",function(a){b=!0;e=new Point(a.pageX,a.pageY);a=f.offset();k=new Point(a.left,a.top)});$("#"+g.title+" a").bind("click",function(b){b.preventDefault();c.Show(!1);a.msgtransform&&(b.btntitle="DICOM\u4fe1\u606f",b.btnforce=!1,a.msgtransform(b));setTimeout(function(){f.remove()},800)});$(document).bind("mousemove mouseup",function(a){switch(a.type){case "mousemove":b&&f.css({left:a.pageX-e.x+k.x+"px",top:a.pageY-e.y+k.y+"px"});break;case "mouseup":b=!1}})})();(function(){var a=$("body"),b=$("#"+g.ctrl),c=a.width(),a=a.height(),e=b.width(),p=b.height();b.css({left:(c-e>>1)+"px",top:(a-p>>1)+"px"})})()};CBoBo.View.AutoScroll=function(e){};CBoBo.View.Config=function(){var e={};this.bShow=!1;var c,a=0,g=function(){var a=$("body"),b=a.width(),c=a.height(),a=$("#"+e.ctrl);1150>b&&(b=1150);a.width(b).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({top:CBoBo.View.TOOLBAR_HEIGHT});var d=$("#"+e.left),a=.08*b;97>a&&(a=97);d.width(a).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({display:"inline-block"});$("#"+e.right).width(b-a-2).height(c-CBoBo.View.TOOLBAR_HEIGHT).css({background:"#333333",display:"inline-block",position:"relative"});b=$("."+e.headbtn);c=.12*a;b.width(a).height(60).css({"border-bottom":"1px solid #383838","line-height":"60px",cursor:"pointer","font-size":c+"px",color:"#efefef"});$("."+e.headbtnicon).css({"font-size":1.5*c+"px","vertical-align":"middle",color:"#ccc"});$("."+e.headbtn+" span").css({"pointer-events":"none",padding:"4px"})};this.TriggerResize=function(){g();c&&c()};var b=function(){function a(a){f(a,"\u5e73\u79fb","translation");f(a,"\u7a97\u5bbd\u7a97\u4f4d","wwwc");f(a,"\u7ffb\u9875","page");f(a,"\u7f29\u653e","zoom");f(a,"\u91ca\u653e","release")}var b="CT",c={},d=function(){$("#"+c.ctrl).css({width:"50%",height:"100%",position:"absolute",top:0,left:"60px",overflow:"hidden","font-family":"Microsoft Yahei"});$("#"+c.selmodality).css({height:"100%",width:"20%",display:"inline-block","padding-top":"10px"});$("#"+c.main).css({height:"100%",width:"70%",display:"inline-block","margin-left":"10%","padding-top":"10px"});$("#"+c.radio).css({height:"20%",width:"100%"});$("#"+c.checkbox).css({height:"20%",width:"100%"});$("#"+c.layout).css({width:"100%"})},g=function(a,b){var c=CBoBo.Config.GetSeriesLayout(a,b);$("input:radio[name\x3d'serieslayout']").each(function(){var a=$(this).prev();this.value===c?(this.checked=!0,a.css("color","#F0F")):(this.checked=!1,a.css("color","#FFF"))});c=CBoBo.Config.GetImageLayout(a,b);$("input:radio[name\x3d'imagelayout']").each(function(){var a=$(this).prev();this.value===c?(this.checked=!0,a.css("color","#F0F")):(this.checked=!1,a.css("color","#FFF"))})},h=function(a){var b=CBoBo.Config.GetImageShowMode(a);$("input:radio[name\x3d'imageshow']").each(function(){this.checked=this.value===b?!0:!1});var d=CBoBo.Config.GetThumbPosition(a);$("input:radio[name\x3d'thumbposition']").each(function(){this.checked=this.value===d?!0:!1});var e=CBoBo.Config.GetMouseLeft(a);$(c.mouseLeft).val(e);e=CBoBo.Config.GetMouseRight(a);$(c.mouseRight).val(e);e=CBoBo.Config.GetMouseMiddle(a);$(c.mouseMiddle).val(e);e=CBoBo.Config.GetMouseMiddleRoll(a);$(c.mouseMiddleRoll).val(e);$(c.platform).val("pc");g(a,"pc")},l=function(a,c){switch(a){case "imageshow":CBoBo.Config.SetImageShowMode(b,c);break;case "thumbposition":CBoBo.Config.SetThumbPosition(b,c)}};c.ctrl=CBoBo.Plugin.GetRandom();c.selmodality=CBoBo.Plugin.GetRandom();c.main=CBoBo.Plugin.GetRandom();c.radio=CBoBo.Plugin.GetRandom();c.checkbox=CBoBo.Plugin.GetRandom();c.layout=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+c.ctrl+"'\x3e\x3cdiv id\x3d'"+c.selmodality+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.main+"'\x3e\x3cdiv id\x3d'"+c.radio+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.checkbox+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.layout+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+e.right));d();!function(){var d="#"+c.selmodality;c.modality=d="#"+k(d,"\u8bbe\u5907\u7c7b\u578b",{},function(a){b=a;h(a)});f(d,"CT","CT");f(d,"PT","PT");f(d,"MR","MR");f(d,"XR","XR");f(d,"OTHER","OTHER");d="#"+c.radio;q(d,"\u56fe\u50cf\u9ed8\u8ba4\u663e\u793a",{width:"100%",height:"30px"});var e="imageshow";u(d,e,"\u6b63\u5e38\uff08\u9ed8\u8ba4\uff09","normal",{"margin-left":"20px"},function(a){l("imageshow",a.target.value)});u(d,e,"\u53cd\u8272","inverse",{"margin-left":"10px"},function(a){l("imageshow",a.target.value)});q(d,"\u7f29\u7565\u56fe\u4f4d\u7f6e",{width:"100%","margin-top":"30px",height:"30px"});e="thumbposition";u(d,e,"\u81ea\u52a8\uff08\u9ed8\u8ba4\uff09","auto",{"margin-left":"20px"},function(a){l("thumbposition",a.target.value)});u(d,e,"\u5de6\u8fb9\u663e\u793a","left",{"margin-left":"10px"},function(a){l("thumbposition",a.target.value)});u(d,e,"\u4e0b\u65b9\u663e\u793a","bottom",{"margin-left":"10px"},function(a){l("thumbposition",a.target.value)});pid="#"+c.checkbox;q(pid,"\u9ed8\u8ba4\u9f20\u6807\u914d\u7f6e",{width:"100%",height:"30px"});c.mouseLeft=d="#"+k(pid,"\u5de6\u952e",{width:"40%",height:"30px","margin-left":"20px"},function(a){CBoBo.Config.SetMouseLeft(b,a)});a(d);c.mouseRight=d="#"+k(pid,"\u53f3\u952e",{width:"40%",height:"30px"},function(a){CBoBo.Config.SetMouseRight(b,a)});a(d);c.mouseMiddle=d="#"+k(pid,"\u4e2d\u952e",{width:"40%",height:"30px","margin-left":"20px"},function(a){CBoBo.Config.SetMouseMiddle(b,a)});a(d);c.mouseMiddleRoll=d="#"+k(pid,"\u6eda\u8f6e",{width:"40%",height:"30px"},function(a){CBoBo.Config.SetMouseMiddleRoll(b,a)});f(d,"\u7ffb\u9875","page");f(d,"\u7f29\u653e","zoom");pid="#"+c.layout;q(pid,"\u9ed8\u8ba4\u5e03\u5c40\u914d\u7f6e",{width:"100%",height:"30px"});c.platform=d="#"+k(pid,"\u4f7f\u7528\u8bbe\u5907",{"margin-left":"20px"},function(a){g(b,a)});f(d,"PC","pc");f(d,"IPAD","ipad");f(d,"IPHONE","iphone");f(d,"OTHER","other");q(pid,"\u5e8f\u5217\u5e03\u5c40",{width:"100%",height:"30px","margin-left":"40px","margin-top":"20px"});d={parent:pid,iconstr:"\x26#xe667;",title:"1*1",name:"serieslayout",value:"1*1",exstyle:{"margin-left":"40px","margin-top":"10px"},iconstyle:{"font-size":"27px"},change:function(a){CBoBo.Config.SetSeriesLayout(b,$(c.platform).val(),a)}};w(d);d.value=d.title="2*1";d.iconstr="\x26#xe66f;";w(d);d.value=d.title="1*2";d.iconstyle.transform="rotate(90deg)";w(d);d.value=d.title="2*2";d.iconstr="\x26#xe66b;";d.iconstyle.transform="";w(d);d.value=d.title="2*3";d.iconstr="\x26#xe668;";w(d);d.value=d.title="3*2";d.iconstr="\x26#xe668;";d.iconstyle.transform="rotate(90deg)";w(d);d.value=d.title="3*3";d.iconstr="\x26#xe665;";d.iconstyle.transform="";w(d);q(pid,"\u56fe\u50cf\u5e03\u5c40",{width:"100%",height:"30px","margin-left":"40px","margin-top":"20px"});d={parent:pid,iconstr:"\x26#xe667;",title:"1*1",name:"imagelayout",value:"1*1",exstyle:{"margin-left":"40px","margin-top":"10px"},iconstyle:{"font-size":"27px"},change:function(a){CBoBo.Config.SetImageLayout(b,$(c.platform).val(),a)}};w(d);d.value=d.title="2*1";d.iconstr="\x26#xe66f;";w(d);d.value=d.title="1*2";d.iconstyle.transform="rotate(90deg)";w(d);d.value=d.title="2*2";d.iconstr="\x26#xe66b;";d.iconstyle.transform="";w(d);d.value=d.title="2*3";d.iconstr="\x26#xe668;";w(d);d.value=d.title="3*2";d.iconstr="\x26#xe668;";d.iconstyle.transform="rotate(90deg)";w(d);d.value=d.title="3*3";d.iconstr="\x26#xe665;";d.iconstyle.transform="";w(d)}();(function(a){$(c.modality).val(a);h(a)})(b);return d},d=function(){var b="CT",c={},d=function(){var a=$("#"+c.lt),b=$("#"+c.rt),d=$("#"+c.rb),e=$("#"+c.lb),f=$("#"+c.center),h=$("#"+c.left),k=$("#"+c.right),l=$("#"+c.centerHead),m=$("#"+c.centerHead+" span"),r=$("#"+c.centerContainer),p=$("."+c.itemhead),q=$("."+c.itemhead+" span"),v=$("."+c.itemHeadName),A=$("."+c.itemHeadOparete),t=$("#"+c.left_modalty),z=$("#"+c.left_fontStyle),u=k.parent(),w=u.width(),y=w/6|0,u=u.height();h.width(y).height(u).css({display:"inline-block"});k.width(w-y-1).height(u).css({display:"inline-block",position:"relative"});u=a.parent();y=((u.width()-20)/3|0)-2;u=((u.height()-10)/2|0)-2;a.width(y).height(u).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:0,top:0});f.width(y).height(2*u+10).css({position:"absolute",left:y+10,top:0});b.width(y).height(u).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:2*(y+10),top:0});d.width(y).height(u).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:2*(y+10),top:u+10});e.width(y).height(u).css({border:"1px solid #666",position:"absolute","background-color":"#000",left:0,top:u+10});g();l.css({"font-family":"Microsoft YaHei",width:"100%",height:"25px",background:"#222",cursor:"default","font-size":"17px"});m.css({color:"#efefef",display:"inline-block",height:"100%"});m.eq(0).css({width:"30%"});m.eq(1).css({width:"50%"});m.eq(2).css({width:"20%","text-align":"center"});r.height(r.parent().height()-20).css({width:"100%"});n();p.css({"font-family":"Microsoft YaHei",width:"100%",height:"25px",background:"#222",cursor:"default","font-size":"17px",color:"#efefef"});q.css({display:"inline-block",height:"100%"});v.css({width:"80%"});A.css({width:"20%","text-align":"center"});t.height(74).css({width:"90%","margin-left":"10%"});a=z.parent().height();z.height(a-86).css({width:"90%","margin-left":"10%","border-top":"1px solid #222","margin-top":"10px"})},g=function(){var b=$("#"+c.lt),d=$("#"+c.rt),e=$("#"+c.rb),f=$("#"+c.lb);b.css({"border-color":"#666"});d.css({"border-color":"#666"});e.css({"border-color":"#666"});f.css({"border-color":"#666"});switch(a){case 0:b.css({"border-color":"#0ff"});break;case 1:d.css({"border-color":"#0ff"});break;case 2:e.css({"border-color":"#0ff"});break;case 3:f.css({"border-color":"#0ff"})}},h=function(){switch(a){case 0:return"lt";case 1:return"rt";case 2:return"rb";case 3:return"lb"}},l=function(a,b){void 0===c.centerContainerItem&&(c.centerContainerItem=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemTag&&(c.centerContainerItemTag=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemName&&(c.centerContainerItemName=CBoBo.Plugin.GetRandom());void 0===c.centerContainerItemTool&&(c.centerContainerItemTool=CBoBo.Plugin.GetRandom());var d=CBoBo.Plugin.GetRandom();$("\x3cdiv class\x3d'"+c.centerContainerItem+" config-conerinfoitem'\x3e\x3cspan class\x3d'"+c.centerContainerItemTag+"' title\x3d'"+a+"'\x3e"+a+"\x3c/span\x3e\x3cspan class\x3d'"+c.centerContainerItemName+"' title\x3d'"+b+"'\x3e"+b+"\x3c/span\x3e\x3cspan class\x3d'"+c.centerContainerItemTool+" icon_tool' title\x3d'\u589e\u52a0\u5230\u6307\u5b9a\u5217\u8868' id\x3d'"+d+"'\x3e\x26#xe6ca;\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+c.centerContainer)).bind("dblclick",a,function(a){m(a.data)});$("#"+d).bind("click dblclick",a,function(a){"dblclick"===a.type?(a.stopPropagation(),a.preventDefault()):m(a.data)})},m=function(d){var e;switch(a){case 0:e=c.ltContainer;break;case 1:e=c.rtContainer;break;case 2:e=c.rbContainer;break;case 3:e=c.lbContainer}var f=CBoBo.Config.PushCornerInfoItem(b,h(),d);f?$.Msg(f):(r(e,d),d=CBoBo.Config.GetCornerInfoFontColor(),e=CBoBo.Config.GetCornerInfoFontFamily(),p(d,e))},n=function(){$("."+c.centerContainerItem).height(20).css({"font-family":"Microsoft YaHei",cursor:"default",margin:"4px 0"});$("."+c.centerContainerItem+" span").css({display:"inline-block",height:"100%","line-height":"20px"});$("."+c.centerContainerItemTag).css({color:"#aaa",width:"30%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.centerContainerItemName).css({color:"#FFF",width:"50%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.centerContainerItemTool).css({color:"#0f0",width:"20%","text-align":"center",cursor:"pointer"})},r=function(a,b){void 0===c.item&&(c.item=CBoBo.Plugin.GetRandom());void 0===c.itemName&&(c.itemName=CBoBo.Plugin.GetRandom());void 0===c.itemDelete&&(c.itemDelete=CBoBo.Plugin.GetRandom());var d=CBoBo.Plugin.GetRandom(),e=CBoBo.Dicom.GetTagData(b);void 0!==e&&(e=e.name,b={id:a,tag:b},$("\x3cdiv class\x3d'"+c.item+" config-conerinfoitem'\x3e\x3cspan class\x3d'"+c.itemName+"' title\x3d'"+e+"'\x3e"+e+"\x3c/span\x3e\x3cspan class\x3d'"+c.itemDelete+" icon_tool' title\x3d'\u5220\u9664\u8be5\u9879' id\x3d'"+d+"'\x3e\x26#xe653;\x3c/span\x3e\x3c/div\x3e").appendTo($("#"+a)).bind("dblclick",b,function(a){t(a.data.id,a.data.tag.toString())}),$("#"+d).bind("click dblclick",b,function(a){"dblclick"===a.type?(a.stopPropagation(),a.preventDefault()):t(a.data.id,a.data.tag.toString())}))},p=function(a,b){void 0===a&&(a="#efefef");void 0===b&&(b="Microsoft YaHei");$("."+c.item).height(20).css({"font-family":b,cursor:"default",margin:"4px 0"});$("."+c.item+" span").css({display:"inline-block",height:"100%","line-height":"20px"});$("."+c.itemName).css({color:a,width:"80%","text-overflow":"ellipsis","white-space":"nowrap"});$("."+c.itemDelete).css({color:"#F00",width:"20%","text-align":"center",cursor:"pointer"})},t=function(a,d){var e=CBoBo.Dicom.GetTagData(d);if(void 0!==e&&CBoBo.Config.DeleteCornerInfoItem(b,h(),d)){var f=e.name;$("#"+a+" ."+c.item).each(function(){var a=$(this);a.children("."+c.itemName).html()===f&&a.remove()})}},u=function(){var a=c.ltContainer;$("#"+a).empty();a=c.rtContainer;$("#"+a).empty();a=c.rbContainer;$("#"+a).empty();a=c.lbContainer;$("#"+a).empty()},w=function(){var a=c.ltContainer,d=CBoBo.Config.GetCornerInfoItem(b,"lt");L(a,d);a=c.rtContainer;d=CBoBo.Config.GetCornerInfoItem(b,"rt");L(a,d);a=c.rbContainer;d=CBoBo.Config.GetCornerInfoItem(b,"rb");L(a,d);a=c.lbContainer;d=CBoBo.Config.GetCornerInfoItem(b,"lb");L(a,d);a=CBoBo.Config.GetCornerInfoFontColor();d=CBoBo.Config.GetCornerInfoFontFamily();p(a,d)},L=function(a,b){if(!(b instanceof Array))throw"PushItemByArray:array is not correct.";$.each(b,function(){r(a,this)})};(function(){c.ctrl=CBoBo.Plugin.GetRandom();c.left=CBoBo.Plugin.GetRandom();c.right=CBoBo.Plugin.GetRandom();c.lt=CBoBo.Plugin.GetRandom();c.rt=CBoBo.Plugin.GetRandom();c.rb=CBoBo.Plugin.GetRandom();c.lb=CBoBo.Plugin.GetRandom();c.center=CBoBo.Plugin.GetRandom();c.centerHead=CBoBo.Plugin.GetRandom();c.centerContainer=CBoBo.Plugin.GetRandom();c.itemhead=CBoBo.Plugin.GetRandom();c.itemHeadName=CBoBo.Plugin.GetRandom();c.itemHeadOparete=CBoBo.Plugin.GetRandom();c.lbContainer=CBoBo.Plugin.GetRandom();c.ltContainer=CBoBo.Plugin.GetRandom();c.rtContainer=CBoBo.Plugin.GetRandom();c.rbContainer=CBoBo.Plugin.GetRandom();c.left_modalty=CBoBo.Plugin.GetRandom();c.left_fontStyle=CBoBo.Plugin.GetRandom();var a="\x3cdiv class\x3d'"+c.itemhead+"'\x3e\x3cspan class\x3d'"+c.itemHeadName+"'\x3eName\x3c/span\x3e\x3cspan class\x3d'"+c.itemHeadOparete+"'\x3e\u64cd\u4f5c\x3c/span\x3e\x3c/div\x3e";$("\x3cdiv id\x3d'"+c.left+"'\x3e"+("\x3cdiv id\x3d'"+c.left_modalty+"'\x3e\x3c/div\x3e")+("\x3cdiv id\x3d'"+c.left_fontStyle+"'\x3e\x3c/div\x3e")+"\x3c/div\x3e\x3cdiv id\x3d'"+c.right+"'\x3e\x3cdiv id\x3d'"+c.lt+"'\x3e"+a+"\x3cdiv id\x3d'"+c.ltContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.center+"'\x3e"+("\x3cdiv id\x3d'"+c.centerHead+"'\x3e\x3cspan\x3eTag\x3c/span\x3e\x3cspan\x3eName\x3c/span\x3e\x3cspan\x3e\u64cd\u4f5c\x3c/span\x3e\x3c/div\x3e")+("\x3cdiv id\x3d'"+c.centerContainer+"'\x3e\x3c/div\x3e")+"\x3c/div\x3e\x3cdiv id\x3d'"+c.rt+"'\x3e"+a+"\x3cdiv id\x3d'"+c.rtContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.rb+"'\x3e"+a+"\x3cdiv id\x3d'"+c.rbContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+c.lb+"'\x3e"+a+"\x3cdiv id\x3d'"+c.lbContainer+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+e.right))})();d();(function(){var b=$("#"+c.lt),d=$("#"+c.rt),e=$("#"+c.rb),f=$("#"+c.lb);b.bind("mousedown",function(b){a=0;g()});d.bind("mousedown",function(b){a=1;g()});e.bind("mousedown",function(b){a=2;g()});f.bind("mousedown",function(b){a=3;g()})})();(function(){var a="#"+c.left_modalty;q(a,"\u8bbe\u5907\u914d\u7f6e",{width:"100%",height:"30px"});a="#"+k(a,"\u5f71\u50cf",{"margin-left":"10px"},function(a){var d=$(c.modality).parent();"2D"===a?(d.css({visibility:""}),b=$(c.modality).val()):(d.css({visibility:"hidden"}),b=a);u();w()});f(a,"2D","2D");f(a,"Film","FILM");a="#"+c.left_modalty;c.modality=a="#"+k(a,"\u8bbe\u5907",{"margin-left":"10px"},function(a){b=a;u();w()});f(a,"CT","CT");f(a,"PT","PT");f(a,"MR","MR");f(a,"XR","XR");f(a,"OTHER","OTHER");a="#"+c.left_fontStyle;q(a,"\u5b57\u4f53\u8bbe\u7f6e",{width:"100%",height:"30px"});a="#"+k(a,"\u6837\u5f0f",{"margin-left":"10px"},function(a){CBoBo.Config.SetCornerInfoFontFamily(a);var b=CBoBo.Config.GetCornerInfoFontColor();p(b,a)});f(a,"Arial","Arial");f(a,"\u5fae\u8f6f\u96c5\u9ed1","Microsoft YaHei");f(a,"\u5b8b\u4f53","SimSun");f(a,"\u65b0\u5b8b\u4f53","NSimSun");f(a,"\u4eff\u5b8b_GB2312","FangSong_GB2312");f(a,"\u6977\u4f53_GB2312","KaiTi_GB2312");f(a,"\u9ed1\u4f53","SimHei");f(a,"Arial Black","Arial Black");f(a,"Times New Roman","Times New Roman");f(a,"Courier New","Courier New");f(a,"Tahoma","Tahoma");f(a,"Verdana","Verdana");var d=CBoBo.Config.GetCornerInfoFontFamily();$(a).val(d);a="#"+c.left_fontStyle;d=CBoBo.Config.GetCornerInfoFontColor();v(a,d,function(a){CBoBo.Config.SetCornerInfoFontColor(a);var b=CBoBo.Config.GetCornerInfoFontFamily();p(a,b)},{margin:"10px 0 0 10px"})})();(function(){void 0!==CBoBo.Dicom&&($.each(CBoBo.Dicom.GetTagData(),function(){l(this.tag,this.name)}),n(),$("#"+c.centerContainer).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"}))})();w();return d},h=function(){var a="CT",b={},c=function(){var c=b.bodyid;$(c).empty();var d=CBoBo.Config.GetPreWwWc(a),e;$.each(d,function(){e=[];e.push({title:this.title,width:"20%"});e.push({title:this.ww,width:"20%"});e.push({title:this.wc,width:"20%"});e.push({title:this.shortcutName,width:"20%"});n(c,e,this.id,g)});t()},d=function(a){switch(a){case 0:return"title";case 1:return"ww";case 2:return"wc";case 3:return"shortcut"}},g=function(b,c,e,f,g,h,k){switch(b){case "delete":CBoBo.Config.DeletePreWwWc(a,c);e.remove();break;case "modify":CBoBo.Config.ModalityPreWwWc(a,c,d(e),f,g,h,k)}};b.ctrl=CBoBo.Plugin.GetRandom();b.preWw=CBoBo.Plugin.GetRandom();b.shortcut=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+b.ctrl+"'\x3e\x3cdiv id\x3d'"+b.preWw+"'\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.shortcut+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("#"+e.right));(function(){var a=$("#"+b.ctrl),c=$("#"+b.preWw),d=$("#"+b.shortcut),e=a.parent().width();a.width(e-60).css({height:"100%",position:"absolute",top:0,left:"60px",overflow:"hidden","font-family":"Microsoft Yahei"});c.css({width:"30%",height:"100%",display:"inline-block"});d.css({width:"69%",height:"100%",display:"inline-block"})})();(function(){var d="#"+b.preWw;q(d,"\u9884\u8bbe\u7a97\u5bbd\u7a97\u4f4d",{width:"100%",height:"30px"});d="#"+k(d,"\u8bbe\u5907\u7c7b\u578b",{"margin-left":"20px"},function(b){a=b;c()});f(d,"CT","CT");f(d,"PT","PT");f(d,"MR","MR");f(d,"XR","XR");f(d,"OTHER","OTHER");var d="#"+b.preWw,e=$(d).width()-22,d="#"+p(d,{float:"left",width:e+"px",height:"400px",margin:"10px 0 0 20px",border:"1px solid #666",position:"relative"}),e=[];e.push({title:"\u540d\u79f0",width:"20%"});e.push({title:"\u7a97\u5bbd",width:"20%"});e.push({title:"\u7a97\u4f4d",width:"20%"});e.push({title:"\u5feb\u6377\u952e",width:"20%"});e.push({title:"\u64cd\u4f5c",width:"20%"});l(d,e,{height:"20px",background:"#333",width:"100%",color:"#efefef",cursor:"default"});b.bodyid="#"+m(d,{height:"355px",width:"100%",background:"#222",overflow:"hidden"});r(d,{bottom:"0",width:"100%",height:"25px",position:"absolute","text-align":"center",color:"green",cursor:"pointer"},function(c){c=CBoBo.Config.PushPreWwWc(a,"","","","",!1,!1);if(c instanceof String)$.Msg(c);else{var d=[];d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});d.push({title:"",width:"20%"});n(b.bodyid,d,c,g)}});d="#"+b.shortcut;q(d,"\u5feb\u6377\u952e\u914d\u7f6e",{width:"100%",height:"30px","margin-left":"40px"});e=$(d).width()-62;preBoxHeight=$(d).height()-60;d="#"+p(d,{float:"left",width:e+"px",height:preBoxHeight+"px",margin:"10px 0 0 60px",border:"1px solid #666",position:"relative"});e=[];e.push({title:"\u52a8\u4f5c",width:"80%"});e.push({title:"\u5feb\u6377\u952e",width:"20%"});l(d,e,{height:"20px",background:"#333",width:"100%",color:"#efefef",cursor:"default"},!0);d="#"+m(d,{height:preBoxHeight-20+"px",width:"100%",background:"#222",overflow:"hidden"});e=[];e.push({title:"\u7684\u6492\u54e5\u53cd\u5bf9\u5927\u5e08\u5085",width:"80%"});e.push({title:"R",width:"20%"});t();$(d).mCustomScrollbar({axis:"y",scrollbarPosition:"inside",scrollInertia:800,theme:"minimal"})})();c()},k=function(a,b,c,d){if(void 0!=b&&void 0!=a){var e=CBoBo.Plugin.GetRandom(),f=CBoBo.Plugin.GetRandom();a=$("\x3cdiv id\x3d'"+f+"'\x3e\x3cspan\x3e"+b+"\x3c/span\x3e\x3cselect id\x3d'"+e+"' title\x3d'"+b+"'\x3e\x3c/select\x3e\x3c/div\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef"});$("#"+f+" span").css({cursor:"default","margin-right":"8px"});$("#"+e).css({cursor:"pointer","min-width":"100px"});void 0!==c&&"object"===typeof c&&a.css(c);d instanceof Function&&$("#"+e).bind("change",function(a){d($(this).val())});return e}},f=function(a,b,c){void 0!=b&&$("\x3coption value\x3d'"+c+"'\x3e"+b+"\x3c/option\x3e").appendTo($(a))},p=function(a,b){var c=CBoBo.Plugin.GetRandom();a=$("\x3cdiv id \x3d'"+c+"'\x3e\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&a.css(b);return c},l=function(a,b,c,d){var e="",f;$.each(b,function(a){f=d||b.length-1!==a?"\x3cspan style\x3d'width:"+this.width+";height:100%;display:inline-block;'\x3e"+this.title+"\x3c/span\x3e":"\x3cspan style\x3d'width:"+this.width+";height:100%;display:inline-block;text-align:center;'\x3e"+this.title+"\x3c/span\x3e";e+=f});a=$("\x3cdiv\x3e"+e+"\x3c/div\x3e").appendTo($(a));void 0!==c&&"object"===typeof c&&a.css(c)},m=function(a,b){var c=CBoBo.Plugin.GetRandom();a=$("\x3cdiv id \x3d'"+c+"'\x3e\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&a.css(b);return c},n=function(a,b,c,d,f){function g(a){var b;$("."+k).each(function(c,d){a===this&&(b=c)});return b}void 0===e.InsertTableItem&&(e.InsertTableItem=CBoBo.Plugin.GetRandom());var h=CBoBo.Plugin.GetRandom(),k=CBoBo.Plugin.GetRandom(),l="",m;if(f)$.each(b,function(a){m=b.length-1===a?"\x3cinput id\x3d'"+h+"' type\x3d'text' style\x3d' width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e":"\x3cinput type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e";l+=m});else{var n=CBoBo.Plugin.GetRandom();$.each(b,function(a){m=b.length-1===a?"\x3cinput id\x3d'"+h+"' type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef; user-select:none;' readOnly\x3d'true' value\x3d'"+this.title+"'/\x3e":"\x3cinput class\x3d'"+k+"' type\x3d'text' style\x3d'width:"+this.width+";height:100%;float:left;padding:0;border:0;background:#444;color:#efefef;' value\x3d'"+this.title+"'/\x3e";l+=m});l+="\x3cspan type\x3d'text' style\x3d'width:20%;height:100%;float:left;text-align:center; cursor:pointer;display:inline-block;color:red;' id\x3d'"+n+"' class\x3d'icon_tool' title\x3d'\u5220\u9664\u8be5\u9879'\x3e\x26#xe653;\x3c/span\x3e"}var r=$("\x3cdiv class\x3d'"+e.InsertTableItem+"'\x3e"+l+"\x3c/div\x3e").appendTo($(a)),p,q,v;$("#"+h).bind("focus blur keydown",c,function(a){var e=$(this);switch(a.type){case "focus":e.css({color:"#222",background:"#aaa","text-align":"center"});break;case "blur":e.css({color:"#efefef",background:"#444","text-align":"left"});break;case "keydown":var f=a.keyCode;(8<=f&&36>=f||41<=f&&47>=f||136<=f&&254>=f||91<=f&&95>=f)&&192!==f||(p=String.fromCharCode(a.keyCode).toUpperCase(),q=a.ctrlKey,v=a.altKey,a.stopPropagation(),a.preventDefault(),f="",a.ctrlKey&&(f+="Ctrl+"),a.altKey&&(f+="Alt+"),f+=p,"Ctrl+C"===f||"Ctrl+A"===f||"Ctrl+V"===f||"Ctrl+X"===f||"Ctrl+F"===f?$.Msg("\u8be5\u7ec4\u5408\u952e\u88ab\u7cfb\u7edf\u5360\u7528."):(e.val(f),d instanceof Function&&d("modify",c,b.length-1,a.target.value,p,q,v)))}});f||($("#"+n).bind("click",c,function(a){d instanceof Function&&d("delete",c,r)}),$("."+k).bind("change",c,function(a){d instanceof Function&&d("modify",c,g(a.target),a.target.value)}))},t=function(){$("."+e.InsertTableItem).css({height:"20px",margin:"5px 0"})},r=function(a,b,c){a=$("\x3cdiv\x3eAdd\x3c/div\x3e").appendTo($(a));void 0!==b&&"object"===typeof b&&a.css(b);c instanceof Function&&a.bind("mouseenter mouseleave click ",function(a){var b=$(this);switch(a.type){case "mouseenter":b.css({background:"#666"});break;case "mouseleave":b.css({background:"#333"});break;case "click":c(a)}})},v=function(a,b,c,d){var e=CBoBo.Plugin.GetRandom();a=$("\x3cdiv\x3e\u989c\u8272 \x3cinput id\x3d'"+e+"' type\x3d'color' name\x3d'favcolor'value\x3d'"+b+"' /\x3e\x3c/div\x3e").appendTo($(a));a.height(60).css({"float":"left",color:"#efefef",cursor:"default","min-width":"100px"});void 0!==d&&"object"===typeof d&&a.css(d);c instanceof Function&&$("#"+e).bind("change",function(a){c($(this).val())});return e},u=function(a,b,c,d,e,f){var g=CBoBo.Plugin.GetRandom();a=$("\x3clabel title\x3d'"+c+"' value\x3d'"+d+"'\x3e\x3cinput id\x3d'"+g+"' name\x3d'"+b+"' type\x3d'radio'  value\x3d'"+d+"'/\x3e"+c+"\x3c/label\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef",cursor:"pointer"});void 0!==e&&"object"===typeof e&&a.css(e);f instanceof Function&&$("#"+g).bind("click",f)},q=function(a,b,c){a=$("\x3clabel\x3e"+b+"\x3c/label\x3e").appendTo($(a));a.css({"float":"left",color:"#efefef"});void 0!==c&&"object"===typeof c&&a.css(c)},w=function(a){var b=$.extend(!0,{parent:null,iconstr:"",title:"",name:"",value:"",exstyle:{},iconstyle:{},change:null},a);a=CBoBo.Plugin.GetRandom();var c=$("\x3cdiv title\x3d'"+b.title+"'\x3e\x3cdiv style\x3d'pointer-events:none;' id\x3d'"+a+"' class\x3d'icon_tool'\x3e"+b.iconstr+"\x3c/div\x3e\x3cinput name\x3d'"+b.name+"'style\x3d'pointer-events:none;' type\x3d'radio'  value\x3d'"+b.value+"' style\x3d'cursor:pointer'\x3e\x3c/div\x3e").appendTo($(b.parent));c.css({"float":"left",color:"#fff",cursor:"pointer","text-align":"center"});c.css(b.exstyle);$("#"+a).css(b.iconstyle);c.bind("click",function(a){var c=a.target.title;$("input:radio[name\x3d'"+b.name+"']").each(function(){var a=$(this),b=a.prev();a.val()===c?(b.css("color","#F0F"),this.checked=!0):(b.css("color","#fff"),this.checked=!1)});b.change instanceof Function&&b.change(c)});return a};this.Show=function(a){this.bShow=a;var b=$("#"+e.ctrl),c=$("body");a?(b.hide(),b.fadeIn(500),c.css("pointer-events","none"),b.css("pointer-events","auto")):(b.fadeOut(500),c.css("pointer-events",""),b.css("pointer-events",""))};e.ctrl=CBoBo.Plugin.GetRandom();e.left=CBoBo.Plugin.GetRandom();e.right=CBoBo.Plugin.GetRandom();e.headbtn=CBoBo.Plugin.GetRandom();e.headbtnicon=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+e.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+e.left+"'\x3e\x3cdiv class\x3d'"+e.headbtn+"' title\x3d'\u57fa\u672c\u914d\u7f6e'\x3e\x3cspan class\x3d'"+e.headbtnicon+"'\x3e\x26#xe6ba;\x3c/span\x3e\x3cspan\x3e\u57fa\u672c\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'"+e.headbtn+"' title\x3d'\u56db\u89d2\u4fe1\u606f\u914d\u7f6e'\x3e\x3cspan class\x3d'"+e.headbtnicon+"'\x3e\x26#xe6bb;\x3c/span\x3e\x3cspan\x3e\u56db\u89d2\u4fe1\u606f\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'"+e.headbtn+"' title\x3d'\u5176\u4ed6\u914d\u7f6e'\x3e\x3cspan class\x3d'"+e.headbtnicon+"'\x3e\x26#xe6b8;\x3c/span\x3e\x3cspan\x3e\u5176\u4ed6\u914d\u7f6e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+e.right+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body")).css({position:"absolute",left:0,top:CBoBo.View.TOOLBAR_HEIGHT,"z-index":"9999",background:"#535353","border-top":"1px solid #383838",overflow:"hide"});g();(function(){var a=$("."+e.headbtn);a.bind("click",function(f){a.css({"background-color":"","pointer-events":""});$(this).css({"background-color":"#333333","pointer-events":"none"});f=f.target.title;$("#"+e.right).empty();switch(f){case "\u57fa\u672c\u914d\u7f6e":c=b();break;case "\u56db\u89d2\u4fe1\u606f\u914d\u7f6e":c=d();break;case "\u5de5\u5177\u680f\u914d\u7f6e":CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();CBoBo.Plugin.GetRandom();$("\x3ch1\x3e\u5de5\u5177\u680f\u914d\u7f6e\x3c/h1\x3e").appendTo($("#"+e.right));c=void 0;break;case "\u5176\u4ed6\u914d\u7f6e":c=h()}})})();$("."+e.headbtn).eq(0).trigger("click")};CBoBo.View.AssistDiagnose=function(e){var c=this;this.recrodStatus={};var a=$.extend(!0,{msgtransform:null,server:""},e),g,b={};this.bShow=!1;var d=!0,h,k,f;this.Login=function(){g=io.connect("ws://"+a.server);p();c.UpdateRoomList(!0);c.UpdateRoomList(!1)};this.UpdateRoomList=function(a){void 0!==g&&(a?g.emit("getmyroom",{uid:"ranqiwu"}):g.emit("getotherroom",{uid:"ranqiwu"}))};this.Show=function(a){this.bShow=a;a=$("#"+b.ctrl);this.bShow?(a.hide(),a.fadeIn(400)):a.fadeOut(400)};this.SendCommand=function(a){g.emit("command",a)};var p=function(){var b=g;b.on("connect",function(){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"success"}})});b.on("connect_failed",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"failed"}})});b.on("error",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"error"}})});b.on("reconnecting",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"reconnecting",times:b}})});b.on("reconnect",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"reconnected",times:b}})});b.on("disconnect",function(b){null!==a.msgtransform&&a.msgtransform({type:"socket.io",data:{type:"disconnect"}})});b.on("command",function(b){null!==a.msgtransform&&a.msgtransform({type:"command",data:b})});b.on("myroom",function(a){$.each(a,function(){m({title:this.title,personcount:this.personcount,id:this.roomid},!0)})});b.on("otherroom",function(a){$.each(a,function(){m({title:this.title,personcount:this.personcount,id:this.roomid})})})},l=function(a){k=a.destory;f=a.gray;var b=a.password;h=a.title;""!==b&&(b=hex_md5(b));g.emit("createroom",{uid:"ranqiwu",title:a.title,isprivate:a.isprivate,password:b});d&&(g.on("createroomstatus",function(a){a.success?(void 0!==k&&k(),m({title:h},!0),$.Msg(a.msg,CBoBo.MSG_SUCCESS)):(void 0!==f&&f(),$.Msg(a.msg,CBoBo.MSG_ERROR))}),d=!1)},m=function(a,c){if("object"==typeof a){var d=$.extend(!0,{title:"",personcount:0,author:"",createtime:"",type:"",id:""},a),e="\x3cli\x3e\x3cspan\x3e"+d.title+"\x3c/span\x3e\x3cspan style\x3d'color:#FFF'\x3e "+d.personcount+"\x3c/span\x3e\x3c/li\x3e";c=c?b.myroom+" ul":b.otherroom+" ul";$(e).appendTo("#"+c).css({cursor:"default",margin:"2px 0"}).bind("dblclick",function(b){n(!0);b=$(this).data("info");"object"==typeof a&&void 0!==g&&g.emit("entersession",{uid:"ranqiwu",roomid:b.id})}).data("info",d)}},n=function(a){$("#"+b.ctrl);var c=.5*$(window).height()>>0,c=300>c?300:c;a?(a=.3*$(window).width()>>0,a=285>a?285:a):a=288;$("."+b.clear).css({display:"none",float:"none"});$("#"+b.ctrl).width(a).height(c).css({border:"1px solid #676767",position:"absolute","z-index":"9999",background:"#444444","user-select":"none",color:"#CCCCC4"});$("#"+b.title).css({height:"30px",width:"100%",background:"#555555",cursor:"default","border-bottom":"1px solid #000","text-align":"center","box-shadow":"0 1px 2px #000"});$("#"+b.title+" span").css({width:"40%",height:"100%","text-align":"center",display:"inline-block","font-size":"16px","line-height":"30px"});$("#"+b.title+" a").css({display:"inline-block",position:"absolute",top:"3px",right:"5px",cursor:"pointer","font-size":"20px",color:"#000"});$("#"+b.container).css({position:"relative"});$("#"+b.search).css({height:"30px",width:"100%",background:"#131313"});$("#"+b.search+" input").css({width:a-55+"px",height:"100%","padding-left":"3px",float:"left"});$("#"+b.searchbtn).css({width:"48px","font-size":"5%",cursor:"pointer",display:"block","text-align":"center",height:"30px",float:"right","line-height":"30px"});var d=$("#"+b.room),c=c-62;d.height(c).width(288).css({float:"left"});$("#"+b.roommanager).height(30).css({width:"100%",background:"gray",color:"#222"});$("."+b.roommanactrl).height(30).css({width:"90","line-height":"30px",cursor:"pointer"});$("."+b.roommanactrl+" label").css({"font-size":"130%","padding-right":"4px"});d=$("."+b.roomtitle);d.css({width:"100%",background:"#555555",display:"block","margin-bottom":"3px","box-shadow":"0 1px 3px #333",cursor:"pointer","padding-left":"5px"});var e=$("#"+b.myroom),f=.3*c>>0;e.css({width:"100%","margin-bottom":"6px","max-height":f+"px"});var e=$("#"+b.myroom+" ul"),g=f-d.height();e.css({"overflow-y":"auto",height:g+"px"});e=$("#"+b.otherroom);f=c-f;e.css({width:"100%","max-height":f+"px"});e=$("#"+b.otherroom+" ul");d=f-d.height();e.css({"overflow-y":"auto",height:d+"px"});d=$("#"+b.roomin);a-=288;d.height(c).width(a).css({float:"right",background:"#da8456"})},t=function(a){function c(){f.remove()}function d(a){var b=$("#"+e);a?(b.html("\u6b63\u5728\u521b\u5efa..."),b.css({"pointer-events":"none"})):(b.html("\u786e\u5b9a"),b.css({"pointer-events":""}))}var e,f,g=this,h=!1;(function(){var e="assist"+CBoBo.Plugin.GetRandom(),k="input"+CBoBo.Plugin.GetRandom(),l="input"+CBoBo.Plugin.GetRandom(),m="input"+CBoBo.Plugin.GetRandom(),n="input"+CBoBo.Plugin.GetRandom(),p="input"+CBoBo.Plugin.GetRandom();g.cfmbtn=p;var q="input"+CBoBo.Plugin.GetRandom(),r="checkbox"+CBoBo.Plugin.GetRandom(),t="passwordbox"+CBoBo.Plugin.GetRandom();f=$("\x3cdiv \x3e\x3cform id\x3d'"+e+"'\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan \x3e\u623f\u95f4\u540d\uff1a\x3c/span\x3e\x3cinput id\x3d'"+k+"' type\x3d'text' placeholder\x3d'\u8bf7\u8f93\u5165\u623f\u95f4\u540d\u79f0' required\x3d'required' autofocus max\x3d'15' tabindex\x3d'0'\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv id\x3d'"+r+"' \x3e\x3cdiv style\x3d'text-align:right; width:90px'\x3e\u623f\u95f4\u52a0\u5bc6\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+t+"' style\x3d'display:none;'\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan\x3e\u5bc6\u7801\uff1a\x3c/span\x3e\x3cinput id\x3d'"+l+"' type\x3d'password' placeholder\x3d'\u8bf7\u8f93\u5165\u623f\u95f4\u5bc6\u7801' required\x3d'required' tabindex\x3d'1'\x3e\x3c/input\x3e\x3c/div\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cspan\x3e\u786e\u8ba4\u5bc6\u7801\uff1a\x3c/span\x3e\x3cinput id\x3d'"+m+"' type\x3d'password' placeholder\x3d'\u8bf7\u786e\u8ba4\u623f\u95f4\u5bc6\u7801' required\x3d'required' tabindex\x3d'2'\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'"+n+"'\x3e\x3cbutton id\x3d'"+p+"' tabindex\x3d'3' type\x3d'submit'\x3e\u786e\u5b9a\x3c/button\x3e\x3cbutton id\x3d'"+q+"' tabindex\x3d'4'\x3e\u53d6\u6d88\x3c/button\x3e\x3c/div\x3e\x3c/form\x3e\x3c/div\x3e").appendTo($("#"+b.container));f.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",background:"#444444","box-shadow":"1px 1px 2px #000"});$("#"+e).css({margin:"0 auto",width:"288px",height:"100%","padding-top":"20px"});$("."+n).css({"margin-bottom":"10px","text-align":"center"});$("."+n+" span").css({"text-align":"right",width:"90px",display:"inline-block","vertical-align":"middle"});$("."+n+" input").css({padding:"0",border:"1px solid #333",background:"#ddd",height:"25px"});$("."+n+" button").css({width:"90px",background:"#333",border:"0",height:"30px",color:"#ccccc4",cursor:"pointer"}).bind("mouseenter mouseleave",function(a){"mouseenter"==a.type?$(this).css({background:"#ccccc4",color:"#333"}):"mouseleave"==a.type&&$(this).css({background:"#333",color:"#ccccc4"})});$("#"+p).css({"margin-right":"10px"});$("#"+q).bind("click",function(a){a.preventDefault();c()});$("#"+p).bind("click",function(b){b.preventDefault();if(void 0!==a||null!==a)if(b=$("#"+k).val(),""===b)$.Msg("\u623f\u95f4\u540d\u4e0d\u80fd\u4e3a\u7a7a!");else{var e="";if(h){var e=$("#"+l).val(),f=$("#"+m).val();if(""===e){$.Msg("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a!");return}if(e!==f){$.Msg("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u76f8\u540c!");return}}d(!0);a({title:b,isprivate:h,password:e,destory:c,gray:d})}});$("#"+r).height(40).css({position:"relative"});(new CBoBo.View.CheckBox({parent:"#"+r,title:"\u623f\u95f4\u52a0\u5bc6",msgtransform:function(a){h=a;var b=$("#"+t);a?b.slideDown(400):b.slideUp(400)}})).SetPositon(110,-18)})()};b.ctrl="assist"+CBoBo.Plugin.GetRandom();b.title=CBoBo.Plugin.GetRandom();b.container=CBoBo.Plugin.GetRandom();b.search=CBoBo.Plugin.GetRandom();b.searchbtn=CBoBo.Plugin.GetRandom();b.room=CBoBo.Plugin.GetRandom();b.roommanager=CBoBo.Plugin.GetRandom();b.roomin=CBoBo.Plugin.GetRandom();b.clear=CBoBo.Plugin.GetRandom();b.roommanactrl=CBoBo.Plugin.GetRandom();b.myroom=CBoBo.Plugin.GetRandom();b.otherroom=CBoBo.Plugin.GetRandom();b.roomtitle=CBoBo.Plugin.GetRandom();b.addstudy=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+b.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+b.title+"'\x3e\x3cspan\x3e\u534f\u540c\u8bca\u65ad\x3c/span\x3e\x3ca\x3e\x26#xe661;\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.container+"'\x3e\x3cdiv id\x3d'"+b.search+"'\x3e\x3cinput type\x3d'text' placeholder\x3d'\u641c\u7d22\uff1a\u623f\u95f4\u540d/\u53f7\u3001\u5728\u7ebf\u7528\u6237'\x3e\x3c/input\x3e\x3ca id\x3d'"+b.searchbtn+"'\x3e\u53d6\u6d88\x3c/a\x3e\x3cdiv class'"+b.clear+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.room+"'\x3e\x3cdiv id\x3d'"+b.roommanager+"'\x3e\x3cdiv class\x3d'"+b.roommanactrl+"'\x3e\x3clabel\x3e\x26#xe69d;\x3c/label\x3e\x3cspan\x3e\u521b\u5efa\u623f\u95f4\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.myroom+"'\x3e\x3cspan class\x3d'"+b.roomtitle+"'\x3e\u6211\u7684\u623f\u95f4\x3c/span\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.otherroom+"'\x3e\x3cspan class\x3d'"+b.roomtitle+"'\x3e\u516c\u5171\u623f\u95f4\x3c/span\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d'"+b.roomin+"'\x3e\x3ca id\x3d'"+b.addstudy+"'\x3e\u66f4\u65b0\u68c0\u67e5\x3c/a\x3e\x3c/div\x3e\x3cdiv class'"+b.clear+"'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));n(!1);(function(){$("#"+b.title).bind("mousedown",function(a){function c(a){switch(a.type){case "mousemove":d.css({left:a.pageX-e.x+f.x+"px",top:a.pageY-e.y+f.y+"px"});break;case "mouseup":$(document).unbind("mousemove mouseup",c)}}var d=$("#"+b.ctrl),e=new Point(a.pageX,a.pageY);a=d.offset();var f=new Point(a.left,a.top);$(document).bind("mousemove mouseup",c)});$("#"+b.title+" a").bind("click",function(b){b.preventDefault();c.Show(!1);null!=a.msgtransform&&a.msgtransform({type:"btnfocus",btntitle:"\u534f\u540c\u8bca\u65ad",btnforce:!1})});$("."+b.roomtitle).bind("click",function(a){a=$(this).next();"none"==a.css("display")?(a.hide(),a.slideDown(300)):a.slideUp(300)});$("."+b.roommanactrl).bind("click",function(a){switch($(this).children("span").html()){case "\u521b\u5efa\u623f\u95f4":t(l)}});$("#"+b.addstudy).bind("click",function(b){"function"===typeof a.msgtransform&&a.msgtransform({type:"addstudy"})})})();(function(){var a=$("body"),c=$("#"+b.ctrl),d=a.width(),a=a.height(),e=c.width(),f=c.height();c.css({left:(d-e>>1)+"px",top:(a-f>>1)+"px"})})();m({title:"\u5395\u6240",personcount:2016,id:"aa123"},!0)};CBoBo.View.CanvasMax=function(e){this.bShow;var c=$.extend(!0,{parent:null},e),a=CBoBo.Plugin.GetRandom();this.UpdateStyle=function(){var e=$("#"+a),b=$(c.parent),d=b.width(),b=b.height();e.width(d).height(b).css({left:"10px",top:"10px"})};this.Show=function(c){var b=$("#"+a);c?(this.bShow=!0,b.hide(),b.fadeIn(400)):(this.bShow=!1,b.fadeOut(400))};$("\x3cdiv id\x3d'"+a+"'\x3e\x3c/div\x3e").appendTo($(c.parent)).css({position:"absolute","z-index":1E3,"-webkit-user-select":"none","background-color":"#535353","font-family":"tahoma, arial, sans-serif",color:"#FFF",display:"none"});this.UpdateStyle();e.parent="#"+a;this.secondCtrl=new CBoBo.View.CMngSecondLayer(e)};CBoBo.View.IconInfo=function(e){$.extend(!0,{msgtransform:null},e);var c={};this.bShow;this.Show=function(a){var e=$("#"+c.ctrl);a?(e.fadeIn(300),this.bShow=!0):(e.fadeOut(800),this.bShow=!1)};this.SetInfo=function(){var a="#"+c.container;$(a).html("");c.td||(c.td=CBoBo.Plugin.GetRandom());c.th||(c.th=CBoBo.Plugin.GetRandom());var e="\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.th+"'\x3e\u6309\u952e\x3c/td\x3e\x3ctd class\x3d'"+c.th+"'\x3e\u529f\u80fd\u63cf\u8ff0\x3c/td\x3e\x3ctd class\x3d'"+c.th+"'\x3e\u6309\u952e\x3c/td\x3e\x3ctd class\x3d'"+c.th+"'\x3e\u529f\u80fd\u63cf\u8ff0\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5f71\u50cf\u6e90\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u53cc\u51fb\u5168\u5c4f\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61b\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u8c03\u7a97/\u81ea\u5b9a\u4e49\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe631\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u91ca\u653e\u5de5\u5177\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe67f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u91cd\u65b0\u52a0\u8f7d\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe62a\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u56fe\u50cf\u5e03\u5c40\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe66d\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5e8f\u5217\u5e03\u5c40\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe644\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u6062\u590d\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe607\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5e8f\u5217\u64ad\u653e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe610\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5b9a\u4f4d\u7ebf\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe629\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u6587\u672c\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe671\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3eDICOM\u4fe1\u606f\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe6b6\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u56db\u89d2\u4fe1\u606f\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe670\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u653e\u7f29\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe630\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u79fb\u52a8\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe623\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u65cb\u8f6c\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe603\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u8d1f\u50cf\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe602\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u4f2a\u5f69\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u76f4\u7ebf\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe615\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5fc3\u80f8\u6bd4\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe619\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u77e9\u5f62\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe622\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u64a4\u9500\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe61e\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u692d\u5706\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe653\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5220\u9664\u56fe\u50cf\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe618\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u89d2\u5ea6\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe628\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u6309\u952e\u8bf4\u660e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe637\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3eCT\u503c\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3eMPR\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3eMPR\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe62f\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u7bad\u5934\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xE60E\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u53f3\u6807\u8bb0\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\x3cspan class\x3d'icon_tool'\x3e\x26#xe9d8\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5de6\u6807\u8bb0\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"),e=e+("\x3ctable\x3e\x3ctr\x3e\x3ctd class\x3d'"+c.td+"'\x3eshift+s\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u5f00/\u5173\u56fe\u50cf\u7f13\u5b58\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3eshift+delete\x3c/td\x3e\x3ctd class\x3d'"+c.td+"'\x3e\u6e05\u9664\u56fe\u50cf\u7f13\u5b58\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e");$(e).appendTo($(a));$("."+c.th).width(140).css({color:"#33ffff","font-size":"17px"});$("."+c.td).width(140).css({color:"#FFF","font-size":"17px"})};c.ctrl=CBoBo.Plugin.GetRandom();c.container=CBoBo.Plugin.GetRandom();$("\x3cdiv id\x3d'"+c.ctrl+"' class\x3d'icon_tool'\x3e\x3cdiv id\x3d'"+c.container+"'\x3e\x3c/div\x3e\x3c/div\x3e").appendTo($("body"));(function(){var a=$(window).width();$(window).height();var a=.5*a>>0,a=600<a?600:a,e=$("#"+CBoBo.Manager.canvasManager.arrTag.box).height(),b=$("#"+CBoBo.Manager.frame.GetId("banner")).height();$("#"+c.ctrl).width(a).height(e).css({border:"1px solid #676767",position:"absolute","z-index":11111,background:"#444444","border-radius":"20px",display:"none","user-select":"none",color:"#CCCCC4",opacity:"90%",right:"0px",top:b+"px"});$("#"+c.container).width(a-30).height(e-30-30).css({"user-select":"auto",padding:"15px","font-family":"Microsoft YaHei",overflow:"auto"})})()};