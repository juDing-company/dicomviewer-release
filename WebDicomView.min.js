!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WebDicomView",[],t):"object"==typeof exports?exports.WebDicomView=t():e.WebDicomView=t()}("undefined"!=typeof self?self:this,(()=>(()=>{var e={8075:(e,t,n)=>{"use strict";var o=n(453),a=n(487),i=a(o("String.prototype.indexOf"));e.exports=function(e,t){var n=o(e,!!t);return"function"==typeof n&&i(e,".prototype.")>-1?a(n):n}},487:(e,t,n)=>{"use strict";var o=n(6743),a=n(453),i=n(6897),r=n(9675),s=a("%Function.prototype.apply%"),l=a("%Function.prototype.call%"),c=a("%Reflect.apply%",!0)||o.call(l,s),u=n(655),d=a("%Math.max%");e.exports=function(e){if("function"!=typeof e)throw new r("a function is required");var t=c(o,l,arguments);return i(t,1+d(0,e.length-(arguments.length-1)),!0)};var h=function(){return c(o,s,arguments)};u?u(e.exports,"apply",{value:h}):e.exports.apply=h},9584:e=>{
/*! cornerstone-core - 0.0.0-semantically-released - 2024-01-19 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */
window,e.exports=function(){return t=[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=o(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==o(e)?e:String(e)}(a.key),a)}}n.r(t),n.d(t,"drawImage",(function(){return w})),n.d(t,"generateLut",(function(){return It})),n.d(t,"getDefaultViewport",(function(){return b})),n.d(t,"setDefaultViewport",(function(){return g})),n.d(t,"requestAnimationFrame",(function(){return Xt})),n.d(t,"storedPixelDataToCanvasImageData",(function(){return _e})),n.d(t,"storedColorPixelDataToCanvasImageData",(function(){return Lt})),n.d(t,"storedPixelDataToCanvasImageDataColorLUT",(function(){return Bt})),n.d(t,"storedPixelDataToCanvasImageDataPseudocolorLUT",(function(){return Nt})),n.d(t,"internal",(function(){return rn})),n.d(t,"renderLabelMapImage",(function(){return Ft})),n.d(t,"renderPseudoColorImage",(function(){return Ut})),n.d(t,"renderColorImage",(function(){return Rt})),n.d(t,"renderGrayscaleImage",(function(){return Dt})),n.d(t,"renderWebImage",(function(){return fn})),n.d(t,"renderToCanvas",(function(){return mn})),n.d(t,"canvasToPixel",(function(){return Ae})),n.d(t,"disable",(function(){return Me})),n.d(t,"displayImage",(function(){return Pe})),n.d(t,"draw",(function(){return Le})),n.d(t,"drawInvalidated",(function(){return ke})),n.d(t,"enable",(function(){return $t})),n.d(t,"getElementData",(function(){return Z})),n.d(t,"removeElementData",(function(){return K})),n.d(t,"getEnabledElement",(function(){return l})),n.d(t,"addEnabledElement",(function(){return c})),n.d(t,"getEnabledElementsByImageId",(function(){return u})),n.d(t,"getEnabledElements",(function(){return d})),n.d(t,"addLayer",(function(){return C})),n.d(t,"removeLayer",(function(){return A})),n.d(t,"getLayer",(function(){return M})),n.d(t,"getLayers",(function(){return D})),n.d(t,"getVisibleLayers",(function(){return P})),n.d(t,"setActiveLayer",(function(){return L})),n.d(t,"getActiveLayer",(function(){return O})),n.d(t,"purgeLayers",(function(){return R})),n.d(t,"setLayerImage",(function(){return k})),n.d(t,"fitToWindow",(function(){return Oe})),n.d(t,"getDefaultViewportForImage",(function(){return en})),n.d(t,"getDisplayedArea",(function(){return x})),n.d(t,"getImage",(function(){return tn})),n.d(t,"getPixels",(function(){return on})),n.d(t,"getStoredPixels",(function(){return nn})),n.d(t,"getViewport",(function(){return an})),n.d(t,"loadImage",(function(){return ce})),n.d(t,"loadAndCacheImage",(function(){return ue})),n.d(t,"registerImageLoader",(function(){return de})),n.d(t,"registerUnknownImageLoader",(function(){return he})),n.d(t,"invalidate",(function(){return sn})),n.d(t,"invalidateImageId",(function(){return ln})),n.d(t,"pageToPixel",(function(){return dn})),n.d(t,"pixelToCanvas",(function(){return hn})),n.d(t,"reset",(function(){return pn})),n.d(t,"resize",(function(){return Re})),n.d(t,"setToPixelCoordinateSystem",(function(){return Be})),n.d(t,"setViewport",(function(){return vn})),n.d(t,"updateImage",(function(){return T})),n.d(t,"pixelDataToFalseColorData",(function(){return q})),n.d(t,"rendering",(function(){return gn})),n.d(t,"imageCache",(function(){return re})),n.d(t,"metaData",(function(){return un})),n.d(t,"webGL",(function(){return pt})),n.d(t,"colors",(function(){return z})),n.d(t,"convertImageToFalseColorImage",(function(){return G})),n.d(t,"convertToFalseColorImage",(function(){return Y})),n.d(t,"restoreImage",(function(){return W})),n.d(t,"EVENTS",(function(){return i})),n.d(t,"events",(function(){return r})),n.d(t,"triggerEvent",(function(){return I})),n.d(t,"imageLoadPoolManager",(function(){return xe})),n.d(t,"imageRetrievalPoolManager",(function(){return we})),n.d(t,"RequestPoolManager",(function(){return be}));var i={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_PROGRESS:"cornerstoneimageloadprogress",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"},r=new(function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.listeners={},this.namespaces={}}var t,n,o;return t=e,(n=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){0<e.indexOf(".")?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(0<e.indexOf("."))this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],o=0,a=n.length;o<a;o++)if(n[o]===t)return void n.splice(o,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type].slice(),n=0,o=t.length;n<o;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&a(t.prototype,n),o&&a(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}()),s=[];function l(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<s.length;t++)if(s[t].element===e)return s[t];throw new Error("element not enabled")}function c(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");s.push(e)}function u(e){var t=[];return s.forEach((function(n){n.image&&n.image.imageId===e&&t.push(n)})),t}function d(){return s}function h(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var m=function(){return"".concat(h()+h(),"-").concat(h(),"-").concat(h(),"-").concat(h(),"-").concat(h()).concat(h()).concat(h())},f={viewport:{}},g=function(e){f.viewport=e||{}};function p(e,t){if(null==e)throw new Error(t)}function v(e,t){var n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=(p(e,"getImageScale: parameter windowSize must not be undefined"),p(t,"getImageScale: parameter image must not be undefined"),o=y(t,o),1),i=1;return{verticalScale:((n=t.rowPixelSpacing||1)<(t=t.columnPixelSpacing||1)?i=t/n:a=n/t,n=e.height/o.height/a),horizontalScale:t=e.width/o.width/i,scaleFactor:Math.min(t,n)}}var y=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return p(e,"getImageSize: parameter image must not be undefined"),p(e.width,"getImageSize: parameter image must have width"),p(e.height,"getImageSize: parameter image must have height"),null!=t&&0!==t&&180!==t?{height:e.width,width:e.height}:{width:e.width,height:e.height}},b=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:void 0},f.viewport):{scale:v(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:void 0}},x=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(t&&t.displayedArea)return t.displayedArea;if(void 0===e)throw new Error("getDisplayedArea: parameter image must not be undefined");return{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:void 0===e.rowPixelSpacing?1:e.rowPixelSpacing,columnPixelSpacing:void 0===e.columnPixelSpacing?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}},w=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)},T=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e=l(e),w(e,t)};function I(e,t){var n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:o,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,o),e.dispatchEvent(n)}function E(e,t,n){I(t.element,e,{viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n})}function S(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n,o,a=e.image,i=t.image;a.imageId&&i.imageId&&(o=x(i,t.viewport),n=x(a,e.viewport),o=o.columnPixelSpacing*i.width/(n.columnPixelSpacing*a.width),i=t.viewport.scale/e.viewport.scale*o,t.viewport.scale=e.viewport.scale*i)}function C(e,t,n){var o=m(),a=l(e),r=a.layers,s=(t&&(s=b(a.canvas,t),n)&&n.viewport&&(s=Object.assign(s,n.viewport)),!1!==a.syncViewports&&(a.syncViewports=!0),{image:t,layerId:o,viewport:s,options:n||{},renderingTools:{}});return r.length&&t&&S(r[0],s),r.push(s),E(i.LAYER_ADDED,a,o),1===r.length&&t&&L(e,o),o}function A(e,t){var n=l(e),o=n.layers,a=n.layers.findIndex((function(e){return e.layerId===t}));-1!==a&&(o.splice(a,1),t===n.activeLayerId&&o.length&&L(e,o[0].layerId),E(i.LAYER_REMOVED,n,t))}function M(e,t){return l(e).layers.find((function(e){return e.layerId===t}))}function D(e){return l(e).layers}function P(e){return l(e).layers.filter((function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity}))}function L(e,t){var n=l(e);if(n.activeLayerId!==t){var o=n.layers.findIndex((function(e){return e.layerId===t}));if(-1===o)throw new Error("setActiveLayer: layer not found in layers array");if(!(o=n.layers[o]).image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=o.image,n.viewport=o.viewport,T(e),E(i.ACTIVE_LAYER_CHANGED,n,t)}}function k(e,t,n){var o=l(e),a=o.layers[0];if(!(e=n?M(e,n):O(e)))throw new Error("setLayerImage: Layer not found");(e.image=t)?e.viewport||(o=b(o.canvas,t),e.options&&e.options.viewport&&(e.viewport=Object.assign(o,e.options.viewport)),a.layerId!==n&&S(a,e)):e.viewport=void 0}function O(e){var t=l(e);return t.layers.find((function(e){return e.layerId===t.activeLayerId}))}function R(e){(e=l(e)).layers=[],delete e.activeLayerId,delete e.lastSyncViewportsState}function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=N(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=N(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==N(e)?e:String(e)}(o.key),o)}}var U=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t,n,o;return t=e,(n=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(1<this.Table.length)||e){this.Table=[];var t,n,o,a,i=this.NumberOfColors-1;i?(t=(this.HueRange[1]-this.HueRange[0])/i,n=(this.SaturationRange[1]-this.SaturationRange[0])/i,o=(this.ValueRange[1]-this.ValueRange[0])/i,a=(this.AlphaRange[1]-this.AlphaRange[0])/i):t=n=o=a=0;for(var r=0;r<=i;r++){var s=this.HueRange[0]+r*t,l=this.SaturationRange[0]+r*n,c=this.ValueRange[0]+r*o,u=this.AlphaRange[0]+r*a,d=function(e,t,n){if(1<e)throw new Error("HSVToRGB expects hue < 1");var o=[];if(0===t)o[0]=n,o[1]=n,o[2]=n;else{var a=Math.floor(6*e),i=n*(1-t),r=n*(1-t*(e=6*e-a)),s=n*(1-t*(1-e));switch(a){case 0:case 6:o[0]=n,o[1]=s,o[2]=i;break;case 1:o[0]=r,o[1]=n,o[2]=i;break;case 2:o[0]=i,o[1]=n,o[2]=s;break;case 3:o[0]=i,o[1]=r,o[2]=n;break;case 4:o[0]=s,o[1]=i,o[2]=n;break;case 5:o[0]=n,o[1]=i,o[2]=r}}return o}(s,l,c),h=[];switch(this.Ramp){case"scurve":h[0]=Math.floor(127.5*(1+Math.cos((1-d[0])*Math.PI))),h[1]=Math.floor(127.5*(1+Math.cos((1-d[1])*Math.PI))),h[2]=Math.floor(127.5*(1+Math.cos((1-d[2])*Math.PI))),h[3]=Math.floor(255*u);break;case"linear":h[0]=Math.floor(255*d[0]+.5),h[1]=Math.floor(255*d[1]+.5),h[2]=Math.floor(255*d[2]+.5),h[3]=Math.floor(255*u+.5);break;case"sqrt":h[0]=Math.floor(255*Math.sqrt(d[0])+.5),h[1]=Math.floor(255*Math.sqrt(d[1])+.5),h[2]=Math.floor(255*Math.sqrt(d[2])+.5),h[3]=Math.floor(255*Math.sqrt(u)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(h)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+0,n=e+1,o=e+2;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[o]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};return t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e)?-1:(e=e<t.Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale,(t=Math.floor(e))===this.NumberOfColors+0?t=0:t===this.NumberOfColors+1&&(t=this.NumberOfColors-1),t)}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&_(t.prototype,n),o&&_(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),B=[0,0,0,0],V={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function F(e,t){var n,o=[],a=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<a;n++)o[n]=function(e,t){for(var n=0,o=e.length-1;n<=o;){var a=n+Math.floor((o-n)/2),i=e[a];if(i===t)return a;t<i?o=a-1:n=a+1}return n}(e,t[n]);return o}function H(e,t,n){var o=[],a=[],i=[],r=[];for(n=null===n?1:n,c=0;c<t.length;c++){var s=t[c];o.push((e-1)*s[0]),a.push(s[1]),i.push(s[1])}for(var l=function(e,t,n){for(var o=(t-e)/((n=null===n?100:n)-1),a=[];0<n--;)a.push(e),e+=o;return a[a.length-1]=t,a}(0,1,e),c=0;c<e;c++)l[c]=(e-1)*Math.pow(l[c],n);var u=F(o,l);for(c=1;c<e-1;c++){var d=u[c],h=(l[c]-o[d-1])/(o[d]-o[d-1]);r[c]=h*(a[d]-i[d-1])+i[d-1]}return r[0]=i[0],r[e-1]=a[t.length-1],r}function j(e,t){var n=V[e];return!(n=n||(V[e]=t||{name:"",colors:[]})).colors&&n.segmentedData&&(n.colors=function(e,t,n){for(var o=[],a=H(t=null===t?256:t,e.red,n=null===n?1:n),i=H(t,e.green,n),r=H(t,e.blue,n),s=0;s<t;s++){var l=Math.round(255*a[s]),c=Math.round(255*i[s]),u=Math.round(255*r[s]);o.push([l,c,u,255])}return o}(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(B);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:B},getColorRepeating:function(e){var t=n.colors.length;return this.getColor(e=t?e%t:0)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=n.colors.length;e.setNumberOfTableValues(t);for(var o=0;o<t;o++)e.setTableValue(o,n.colors[o])}},createLookupTable:function(){var e=new U;return this.buildLookupTable(e),e},isValidIndex:function(e){return 0<=e&&e<n.colors.length}}}var z={getColormap:j,getColormapsList:function(){var e=[];return Object.keys(V).forEach((function(t){var n;V.hasOwnProperty(t)&&(n=V[t],e.push({id:t,name:n.name}))})),e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),e},LookupTable:U};function q(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,o,a=e.minPixelValue,i=0,r=0,s=e.width*e.height,l=e.origPixelData||e.getPixelData(),c=new Uint8Array(4*s);if(e.color=!0,e.falseColor=!0,e.origPixelData=l,t instanceof z.LookupTable)for(t.build();r<s;)n=l[r++],o=t.mapValue(n),c[i++]=o[0],c[i++]=o[1],c[i++]=o[2],c[i++]=o[3];else if(a<0)for(;r<s;)n=l[r++],c[i++]=t[n+-a][0],c[i++]=t[n+-a][1],c[i++]=t[n+-a][2],c[i++]=t[n+-a][3];else for(;r<s;)n=l[r++],c[i++]=t[n][0],c[i++]=t[n][1],c[i++]=t[n][2],c[i++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return c}}function W(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function G(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,o,a,i,r,s,l,c,u,d,h,m=(t=m=(m=t)&&"string"==typeof m?j(m):m).getId();return e.colormapId!==m&&(W(e),m&&(o=e.minPixelValue||0,n=e.maxPixelValue||255,e.restore=(a=e).restore||(i=a.color,r=a.rgba,s=a.cachedLut,l=a.slope,c=a.windowWidth,u=a.windowCenter,d=a.minPixelValue,h=a.maxPixelValue,function(){var e;a.color=i,a.rgba=r,a.cachedLut=s,a.slope=l,a.windowWidth=c,a.windowCenter=u,a.minPixelValue=d,a.maxPixelValue=h,a.origPixelData&&(e=a.origPixelData,a.getPixelData=function(){return e}),a.origPixelData=void 0,a.colormapId=void 0,a.falseColor=void 0}),(t=t.createLookupTable()).setTableRange(o,n),q(e,t),o=function(e){for(var t,n=Number.MAX_VALUE,o=Number.MIN_VALUE,a=e.length,i=0;i<a;i++)n=n<(t=e[i])?n:t,o=t<o?o:t;return{minPixelValue:n,maxPixelValue:o}}(e.getPixelData()),e.minPixelValue=o.minPixelValue,e.maxPixelValue=o.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=m),!0)}function Y(e,t){return G(l(e).image,t)}function Z(e,t){return!1===(e=l(e)).data.hasOwnProperty(t)&&(e.data[t]={}),e.data[t]}function K(e,t){delete l(e).data[t]}var X=1073741824,J=0,Q={},$=[];function ee(){if(!(J<=X)){for($.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));X<J;){var e=$[$.length-1].imageId;oe(e),I(r,i.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=ae();I(r,i.IMAGE_CACHE_FULL,t)}}function te(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===Q.hasOwnProperty(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};Q[e]=n,$.push(n),t.promise.then((function(e){if(-1!==$.indexOf(n)){if(n.loaded=!0,void 0===(n.image=e).sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,J+=n.sizeInBytes;var t={action:"addImage",image:n};I(r,i.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,ee()}}),(function(){var t=Q[e];$.splice($.indexOf(t),1),delete Q[e]}))}function ne(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");if(void 0!==(e=Q[e]))return e.timeStamp=Date.now(),e.imageLoadObject}function oe(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t,n=Q[e];if(void 0===n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");$.splice($.indexOf(n),1),J-=n.sizeInBytes,I(r,i.IMAGE_CACHE_CHANGED,{action:"deleteImage",image:n}),(t=n.imageLoadObject).promise.then((function(){t.decache&&t.decache()}),(function(){t.decache&&t.decache()})),delete Q[e]}function ae(){return{maximumSizeInBytes:X,cacheSizeInBytes:J,numberOfImagesCached:$.length}}var ie,re={imageCache:Q,cachedImages:$,setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");X=e,I(r,i.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),ee()},putImageLoadObject:te,getImageLoadObject:ne,removeImageLoadObject:oe,getCacheInfo:ae,purgeCache:function(){for(;0<$.length;)oe($[0].imageId)},changeImageIdCacheSize:function(e,t){var n=Q[e];n&&n.imageLoadObject.promise.then((function(e){var o=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,J+=o,o={action:"changeImageSize",image:e},I(r,i.IMAGE_CACHE_CHANGED,o)}))}},se={};function le(e,t){var n=e.indexOf(":");if(n=e.substring(0,n),null==(n=se[n])){if(void 0!==ie)return ie(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}return(n=n(e,t)).promise.then((function(e){I(r,i.IMAGE_LOADED,{image:e})}),(function(t){I(r,i.IMAGE_LOAD_FAILED,{imageId:e,error:t})})),n}function ce(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=ne(e);return(void 0!==n?n:le(e,t)).promise}function ue(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=ne(e);return void 0===n&&te(e,n=le(e,t)),n.promise}function de(e,t){se[e]=t}function he(e){var t=ie;return ie=e,t}function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){var n,o,a,i,r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return o=!(n=!0),{s:function(){r=r.call(e)},n:function(){var e=r.next();return n=e.done,e},e:function(e){o=!0,a=e},f:function(){try{n||null==r.return||r.return()}finally{if(o)throw a}}};if(Array.isArray(e)||(r=function(e,t){var n;if(e)return"string"==typeof e?ge(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ge(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return r&&(e=r),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function pe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ye(o.key),o)}}function ve(e,t,n){(t=ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function ye(e){return e=function(e,t){if("object"!=me(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=me(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==me(e)?e:String(e)}var be=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");ve(this,"requestPool",void 0),ve(this,"awake",void 0),ve(this,"numRequests",void 0),ve(this,"maxNumRequests",void 0),ve(this,"grabDelay",void 0),ve(this,"timeoutHandle",void 0),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.awake=!1,this.grabDelay=5,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"addRequest",value:function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]&&arguments[4];e={requestFn:e,type:t,additionalDetails:n},void 0===this.requestPool[t][o]&&(this.requestPool[t][o]=[]),a?this.requestPool[t][o].unshift(e):this.requestPool[t][o].push(e),this.awake||(this.awake=!0,this.startGrabbing())}},{key:"filterRequests",value:function(e){var t=this;Object.keys(this.requestPool).forEach((function(n){var o=t.requestPool[n];Object.keys(o).forEach((function(t){o[t]=o[t].filter((function(t){return e(t)}))}))}))}},{key:"clearRequestStack",value:function(e){if(!this.requestPool[e])throw new Error("No category for the type ".concat(e," found"));this.requestPool[e]={0:[]}}},{key:"sendRequest",value:function(e){var t=this,n=e.requestFn,o=e.type;this.numRequests[o]++,this.awake=!0,n().finally((function(){t.numRequests[o]--,t.startAgain()}))}},{key:"startGrabbing",value:function(){for(var e=this.maxNumRequests.interaction+this.maxNumRequests.thumbnail+this.maxNumRequests.prefetch-(this.numRequests.interaction+this.numRequests.thumbnail+this.numRequests.prefetch),t=0;t<e;t++){var n=this.getNextRequest();if(!1===n)break;n&&this.sendRequest(n)}}},{key:"startAgain",value:function(){var e=this;this.awake&&(this.grabDelay?this.timeoutHandle=window.setTimeout((function(){e.startGrabbing()}),this.grabDelay):this.startGrabbing())}},{key:"getSortedPriorityGroups",value:function(e){var t=this;return Object.keys(this.requestPool[e]).map(Number).filter((function(n){return t.requestPool[e][n].length})).sort()}},{key:"getNextRequest",value:function(){var e,t=this.getSortedPriorityGroups("interaction"),n=fe(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;if(this.requestPool.interaction[o].length&&this.numRequests.interaction<this.maxNumRequests.interaction)return this.requestPool.interaction[o].shift()}}catch(e){n.e(e)}finally{n.f()}var a,i=this.getSortedPriorityGroups("thumbnail"),r=fe(i);try{for(r.s();!(a=r.n()).done;){var s=a.value;if(this.requestPool.thumbnail[s].length&&this.numRequests.thumbnail<this.maxNumRequests.thumbnail)return this.requestPool.thumbnail[s].shift()}}catch(e){r.e(e)}finally{r.f()}var l,c=this.getSortedPriorityGroups("prefetch"),u=fe(c);try{for(u.s();!(l=u.n()).done;){var d=l.value;if(this.requestPool.prefetch[d].length&&this.numRequests.prefetch<this.maxNumRequests.prefetch)return this.requestPool.prefetch[d].shift()}}catch(e){u.e(e)}finally{u.f()}return t.length||i.length||c.length||(this.awake=!1),!1}},{key:"getRequestPool",value:function(){return this.requestPool}}])&&pe(t.prototype,n),o&&pe(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),xe=((n=new be).maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3},n.grabDelay=0,n),we=((n=new be).maxNumRequests={interaction:20,thumbnail:20,prefetch:20},n.grabDelay=0,n);function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=Te(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=Te(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==Te(e)?e:String(e)}(o.key),o)}}function Ee(e){return Ce(e)}var Se=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.reset()}var t,n,o;return t=e,(n=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],o=this.m[0]*e.m[2]+this.m[2]*e.m[3],a=this.m[1]*e.m[2]+this.m[3]*e.m[3],i=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4];e=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5],this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=a,this.m[4]=i,this.m[5]=e}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,o=-this.m[2]*e,a=this.m[0]*e,i=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);e*=this.m[1]*this.m[4]-this.m[0]*this.m[5],this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=a,this.m[4]=i,this.m[5]=e}},{key:"rotate",value:function(e){var t=Math.cos(e),n=(e=Math.sin(e),this.m[0]*t+this.m[2]*e),o=this.m[1]*t+this.m[3]*e,a=this.m[0]*-e+this.m[2]*t;e=this.m[1]*-e+this.m[3]*t,this.m[0]=n,this.m[1]=o,this.m[2]=a,this.m[3]=e}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,o=t;return{x:e=n*this.m[0]+o*this.m[2]+this.m[4],y:t=n*this.m[1]+o*this.m[3]+this.m[5]}}}])&&Ie(t.prototype,n),o&&Ie(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Ce=function(e,t){var n,o,a=new Se,i=(a.translate(e.canvas.width/2,e.canvas.height/2),e.viewport.rotation),r=(0!==i&&a.rotate(i*Math.PI/180),e.viewport.scale),s=e.viewport.scale,l=x(e.image,e.viewport),c=l.tlhc.x-1,u=l.tlhc.y-1,d=l.brhc.x-c,h=l.brhc.y-u;return"NONE"===l.presentationSizeMode?e.image.rowPixelSpacing<e.image.columnPixelSpacing?r*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(s*=e.image.rowPixelSpacing/e.image.columnPixelSpacing):(r=l.columnPixelSpacing,s=l.rowPixelSpacing,"SCALE TO FIT"===l.presentationSizeMode&&(n=e.canvas.height/(h*s),o=e.canvas.width/(d*r),r=s=Math.min(o,n),l.rowPixelSpacing<l.columnPixelSpacing?r*=l.columnPixelSpacing/l.rowPixelSpacing:l.columnPixelSpacing<l.rowPixelSpacing&&(s*=l.rowPixelSpacing/l.columnPixelSpacing))),a.scale(r,s),0!==i&&a.rotate(-i*Math.PI/180),a.translate(e.viewport.translation.x,e.viewport.translation.y),0!==i&&a.rotate(i*Math.PI/180),void 0!==t&&a.scale(t,t),e.viewport.hflip&&a.scale(-1,1),e.viewport.vflip&&a.scale(1,-1),a.translate(-d/2,-h/2),a.translate(-c,-u),a},Ae=function(e,t){return(e=Ee(e=l(e))).invert(),e.transformPoint(t.x,t.y)},Me=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=s,n=0;n<t.length;n++)if(t[n].element===e){var o={element:e};I(e,i.ELEMENT_DISABLED,o),I(r,i.ELEMENT_DISABLED,o),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}},De=function(){return(window.performance?performance:Date).now()},Pe=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var o,a=l(e),r=a.image;if(a.image=t,a.layers&&a.layers.length&&k(e,t),void 0===a.viewport&&(a.viewport=b(a.canvas,t)),n)for(var s in n)null!==n[s]&&(a.viewport[s]=n[s]);void 0!==a.lastImageTimeStamp&&(o=(1e3/(De()-a.lastImageTimeStamp)).toFixed()),a.lastImageTimeStamp=De(),t={viewport:a.viewport,element:a.element,image:a.image,oldImage:r,enabledElement:a,frameRate:o},I(a.element,i.NEW_IMAGE,t),T(e)},Le=function(e){e=l(e),w(e)},ke=function(){for(var e=s,t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&w(n,!0)}},Oe=function(e){var t=l(e),n=t.image;t.viewport.scale=v(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,T(e)},Re=function(e,t){var n,o,a,r,s,c=l(e),u=c.canvas.width,d=c.canvas.height;o=e,(n=c.canvas).width!==o.clientWidth&&(n.width=o.clientWidth,n.style.width="".concat(o.clientWidth,"px")),n.height!==o.clientHeight&&(n.height=o.clientHeight,n.style.height="".concat(o.clientHeight,"px")),I(e,i.ELEMENT_RESIZED,{element:e}),void 0!==c.image&&(t||(n=u,o=d,a=(t=c).viewport.scale,r=y(t.image,t.viewport.rotation),s=Math.round(r.width*a),r=Math.round(r.height*a),a=t.viewport.translation.x,t=t.viewport.translation.y,s===n&&r<=o)||s<=n&&r===o&&0===a&&0===t?Oe:(n=(s=c).viewport.scale,r=s.canvas.width,o=s.canvas.height,r=Math.sqrt(r/u*(o/d)),s.viewport.scale=r*n,T))(e)},Ne=function(e){var t=(e.viewport||{}).invert;return e=(e.options||{}).fillStyle,-1!==["black","white"].indexOf(e)&&t?"white":"black"},_e=function(e,t,n){var o=De(),a=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=De()-o,a.length),r=e.minPixelValue,s=3,l=0;if(o=De(),a instanceof Int16Array)if(r<0)for(;l<i;)n[s]=t[a[l++]+-r],s+=4;else for(;l<i;)n[s]=t[a[l++]],s+=4;else if(a instanceof Uint16Array)for(;l<i;)n[s]=t[a[l++]],s+=4;else if(r<0)for(;l<i;)n[s]=t[a[l++]+-r],s+=4;else for(;l<i;)n[s]=t[a[l++]],s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=De()-o},Ue=function(e,t,n){var o,a=De(),i=e.getPixelData(),r=(e.stats.lastGetPixelDataTime=De()-a,i.length),s=e.minPixelValue,l=0,c=0;if(a=De(),i instanceof Int16Array)if(s<0)for(;c<r;)o=t[i[c++]+-s],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else for(;c<r;)o=t[i[c++]],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else if(i instanceof Uint16Array)for(;c<r;)o=t[i[c++]],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else if(s<0)for(;c<r;)o=t[i[c++]+-s],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else for(;c<r;)o=t[i[c++]],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=De()-a},Be=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");e=Ce(e,n),t.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5])},Ve={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),o=0,a=0;a<t.length;a++){var i=Math.abs(t[a]);n[o++]=255&i,n[o++]=i>>8,n[o++]=t[a]<0?0:1}return n}},Fe=((n={}).frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),He={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),o=0,a=0;a<t.length;a++)n[o++]=t[a],n[o++]=t[a]<0?0:1;return n}},je=(Fe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),ze={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,o=0,a=e.width*e.height*4,i=e.width*e.height*3,r=e.getPixelData(),s=new Uint8Array(i);if(t<0)for(;o<a;)s[n++]=r[o++]+-t,s[n++]=r[o++]+-t,s[n++]=r[o++]+-t,o+=1;else for(;o<a;)s[n++]=r[o++],s[n++]=r[o++],s[n++]=r[o++],o+=1;return s}},qe=(je.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}",{}),We={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),o=0,a=0;a<t.length;a++){var i=t[a];n[o++]=255&i,n[o++]=i>>8}return n}},Ge=(qe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),Ye={storedPixelDataToImageData:function(e){return e.getPixelData()}},Ze=(Ge.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{int16:n,int8:Fe,rgb:je,uint16:qe,uint8:Ge}),Ke={int16:Ve,int8:He,rgb:ze,uint16:We,uint8:Ye},Xe="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",Je={},Qe=[],$e=268435456,et=0;function tt(){if(!(et<=$e)){for(Qe.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));$e<et;){var e=Qe[Qe.length-1];et-=e.sizeInBytes,delete Je[e.imageId],Qe.pop(),I(r,i.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:$e,cacheSizeInBytes:et,numberOfImagesCached:Qe.length};I(r,i.WEBGL_TEXTURE_CACHE_FULL,t)}}var nt={purgeCache:function(){for(;0<Qe.length;){var e=Qe.pop();delete Je[e.imageId]}et=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");if(void 0!==(e=Je[e]))return e.timeStamp=new Date,e.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(Je,n))throw new Error("putImageTexture: imageId already in cache");if(e={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes},Je[n]=e,Qe.push(e),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");et+=e.sizeInBytes,tt()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=Je[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return Qe.splice(Qe.indexOf(t),1),et-=t.sizeInBytes,delete Je[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");$e=e,tt()}};function ot(e,t,n){return n=e.createShader(n),e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||e.isContextLost()||(t=e.getShaderInfoLog(n),console.error("Could not compile shader:\n".concat(t))),n}var at,it,rt,st=function(e,t,n){var o;return t=ot(e,t,e.VERTEX_SHADER),n=ot(e,n,e.FRAGMENT_SHADER),o=e.createProgram(),e.attachShader(o,t),e.attachShader(o,n),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||e.isContextLost()||(t=e.getProgramInfoLog(o),console.error("WebGL program filed to link:\n".concat(t))),o},lt=document.createElement("canvas"),ct=!1;function ut(){if(!0!==ct&&function(e){at=null;try{var t={desynchronized:!0,preserveDrawingBuffer:!0};at=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",dt,!1),e.addEventListener("webglcontextlost",dt,!1),e.removeEventListener("webglcontextrestored",ht,!1),e.addEventListener("webglcontextrestored",ht,!1)}catch(e){throw new Error("Error creating WebGL context")}return at||(console.error("Unable to initialize WebGL. Your browser may not support it."),at=null),at}(lt)){for(var e in rt=at.createBuffer(),at.bindBuffer(at.ARRAY_BUFFER,rt),at.bufferData(at.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),at.STATIC_DRAW),it=at.createBuffer(),at.bindBuffer(at.ARRAY_BUFFER,it),at.bufferData(at.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),at.STATIC_DRAW),Ze)(e=Ze[e]).attributes={},e.uniforms={},e.vert=Xe,e.program=st(at,e.vert,e.frag),e.attributes.texCoordLocation=at.getAttribLocation(e.program,"a_texCoord"),at.enableVertexAttribArray(e.attributes.texCoordLocation),e.attributes.positionLocation=at.getAttribLocation(e.program,"a_position"),at.enableVertexAttribArray(e.attributes.positionLocation),e.uniforms.resolutionLocation=at.getUniformLocation(e.program,"u_resolution");ct=!0}}function dt(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function ht(e){e.preventDefault(),ct=!1,nt.purgeCache(),ut()}function mt(e){return e.color?"rgb":(e=e.getPixelData())instanceof Int16Array?"int16":e instanceof Uint16Array?"uint16":e instanceof Int8Array?"int8":"uint8"}function ft(e){var t,n,o,a,i,r=nt.getImageTexture(e.imageId);return r||(t=e,n=(n={uint8:at.LUMINANCE,int8:at.LUMINANCE_ALPHA,uint16:at.LUMINANCE_ALPHA,int16:at.RGB,rgb:at.RGB})[o=mt(t)],a=at.createTexture(),at.bindTexture(at.TEXTURE_2D,a),at.texParameteri(at.TEXTURE_2D,at.TEXTURE_MIN_FILTER,at.NEAREST),at.texParameteri(at.TEXTURE_2D,at.TEXTURE_MAG_FILTER,at.NEAREST),at.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_S,at.CLAMP_TO_EDGE),at.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_T,at.CLAMP_TO_EDGE),at.pixelStorei(at.UNPACK_ALIGNMENT,1),i=Ke[o].storedPixelDataToImageData(t,t.width,t.height),at.texImage2D(at.TEXTURE_2D,0,n,t.width,t.height,0,n,at.UNSIGNED_BYTE,i),r={texture:a,sizeInBytes:t.width*t.height*{int8:1,uint16:2,int16:3,rgb:3}[o]},nt.putImageTexture(e,r)),r.texture}function gt(e,t,n,o,a){for(var i in at.clearColor(1,0,0,1),at.viewport(0,0,o,a),at.clear(at.COLOR_BUFFER_BIT|at.DEPTH_BUFFER_BIT),at.useProgram(e.program),at.bindBuffer(at.ARRAY_BUFFER,it),at.vertexAttribPointer(e.attributes.texCoordLocation,2,at.FLOAT,!1,0,0),at.bindBuffer(at.ARRAY_BUFFER,rt),at.vertexAttribPointer(e.attributes.positionLocation,2,at.FLOAT,!1,0,0),t){var r,s=at.getUniformLocation(e.program,i);s&&(r=(i=t[i]).type,i=i.value,"i"===r?at.uniform1i(s,i):"f"===r?at.uniform1f(s,i):"2f"===r&&at.uniform2f(s,i[0],i[1]))}var l;(l=at).bufferData(l.ARRAY_BUFFER,new Float32Array([o,a,0,a,o,0,0,0]),l.STATIC_DRAW),at.activeTexture(at.TEXTURE0),at.bindTexture(at.TEXTURE_2D,n),at.drawArrays(at.TRIANGLE_STRIP,0,4)}n={createProgramFromString:st,renderer:{render:function(e){var t=e.image,n=(lt.width=t.width,lt.height=t.height,e=e.viewport,n=mt(n=t),Ze.hasOwnProperty(n)?Ze[n]:Ze.rgb),o=ft(t);return gt(n,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:e.voi.windowCenter},ww:{type:"f",value:e.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:e.invert?1:0}},o,t.width,t.height),lt},initRenderer:ut,getRenderCanvas:function(){return lt},isWebGLAvailable:function(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}},textureCache:nt};var pt=(Object.defineProperty(n,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return ct}}),n);function vt(e,t){var n,o;(o=e).voiLUT&&o.voiLUT.lut&&0<o.voiLUT.lut.length||void 0!==o.voi.windowWidth&&void 0!==o.voi.windowCenter||(n=(o=t.maxPixelValue*t.slope+t.intercept)-(t=t.minPixelValue*t.slope+t.intercept),o=(o+t)/2,void 0===e.voi?e.voi={windowWidth:n,windowCenter:o}:(e.voi.windowWidth=n,e.voi.windowCenter=o))}function yt(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}function bt(e,t,n){var o,a,i,r,s,l;return n?(a=(o=n).lut[0],i=o.lut[o.lut.length-1],r=o.firstValueMapped+o.lut.length,function(e){return e<o.firstValueMapped?a:r<=e?i:o.lut[e]}):(s=e,l=t,function(e){return e*s+l})}function xt(e){return function(e){if(Array.isArray(e))return wt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?wt(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wt(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var Tt=function(e,t,n,o){var a,i,r,s,l,c,u,d;return n?(a=n,i=o,r=Math.max.apply(Math,xt(a.lut)).toString(2).length-8,s=a.lut[0]>>r,l=a.lut[a.lut.length-1]>>r,c=a.firstValueMapped+a.lut.length-1,function(e){return e<a.firstValueMapped?s:c<=e?l:i?a.lut[Math.round(e)-a.firstValueMapped]>>r:a.lut[e-a.firstValueMapped]>>r}):(u=e,d=t,function(e){return 255*((e-d)/u+.5)})},It=function(e,t,n,o,a,i){var r=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0),c=(void 0===e.cachedLut&&(u=r-l+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(u)),e.cachedLut.lutArray),u=Boolean(e.slope%1)||Boolean(e.intercept%1),d=bt(e.slope,e.intercept,a),h=Tt(t,n,i,u);if(!0===o)for(var m=s;m<=r;m++)c[m+-l]=255-h(d(m));else for(var f=s;f<=r;f++)c[f+-l]=h(d(f));return c},Et=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&yt(e.cachedLut.modalityLUT,t.modalityLUT)&&yt(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(vt(t,e),It(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray},St=function(e,t){var n=e.renderingTools.lastRenderedImageId,o=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!o||o.windowCenter!==e.viewport.voi.windowCenter||o.windowWidth!==e.viewport.voi.windowWidth||o.invert!==e.viewport.invert||o.rotation!==e.viewport.rotation||o.hflip!==e.viewport.hflip||o.vflip!==e.viewport.vflip||o.modalityLUT!==e.viewport.modalityLUT||o.voiLUT!==e.viewport.voiLUT||o.colormap!==e.viewport.colormap},Ct=function(e,t){var n=((o=e.renderingTools.renderCanvas).width=t.width,o.height=t.height,o.getContext("2d",{desynchronized:!0})),o=(n.fillStyle="white",n.fillRect(0,0,o.width,o.height),n.getImageData(0,0,t.width,t.height));e.renderingTools.renderCanvasContext=n,e.renderingTools.renderCanvasData=o},At=function(e){var t=e.image.imageId,n=e.viewport,o=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=o,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools};function Mt(e,t,n,o){o=!(3<arguments.length&&void 0!==o)||o;var a,i,r=!0===e.renderingTools.lastRenderedIsColor;return e.renderingTools.renderCanvas&&!r||(e.renderingTools.renderCanvas=document.createElement("canvas"),Ct(e,t)),r=e.renderingTools.renderCanvas,!1===St(e,t)&&!0!==n||(r.width===t.width&&r.height===t.height||Ct(e,t),a=De(),n=Et(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=De()-a,i=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(o?_e:Ue)(t,n,i.data),a=De(),e.putImageData(i,0,0),t.stats.lastPutImageDataTime=De()-a),r}function Dt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var o=e.canvas.getContext("2d",{desynchronized:!0}),a=(o.setTransform(1,0,0,1,0,0),o.fillStyle=Ne(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,Be(e,o),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?pt.renderer.render(e):Mt(e,n,t),t=x(e.image,e.viewport)).tlhc.x-1,i=t.tlhc.y-1,r=t.brhc.x-a;t=t.brhc.y-i,o.drawImage(n,a,i,r,t,a,i,r,t),e.renderingTools=At(e)}function Pt(e,t,n,o,a){var i,r=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0),c=(void 0===e.cachedLut&&(i=r-l+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(i)),e.cachedLut.lutArray),u=Tt(t,n,a);if(!0===o)for(var d=s;d<=r;d++)c[d+-l]=255-u(d);else for(var h=s;h<=r;h++)c[h+-l]=u(h)}var Lt=function(e,t,n){var o=De(),a=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=De()-o,e.minPixelValue),r=0,s=0,l=a.length;if(o=De(),i<0)for(;s<l;)n[r++]=t[a[s++]+-i],n[r++]=t[a[s++]+-i],n[r]=t[a[s]+-i],s+=2,r+=2;else for(;s<l;)n[r++]=t[a[s++]],n[r++]=t[a[s++]],n[r]=t[a[s]],s+=2,r+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=De()-o},kt=function(e,t,n){var o=De(),a=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=De()-o,e.minPixelValue),r=0,s=0,l=a.length;if(o=De(),i<0)for(;s<l;)n[r++]=t[a[s++]+-i],n[r++]=t[a[s++]+-i],n[r++]=t[a[s++]+-i],n[r++]=a[s++];else for(;s<l;)n[r++]=t[a[s++]],n[r++]=t[a[s++]],n[r++]=t[a[s++]],n[r++]=a[s++];e.stats.lastStoredPixelDataToCanvasImageDataTime=De()-o};function Ot(e,t,n){var o,a,i=!0===e.renderingTools.lastRenderedIsColor;return e.renderingTools.renderCanvas&&i||(e.renderingTools.renderCanvas=document.createElement("canvas")),i=e.renderingTools.renderCanvas,255!==e.viewport.voi.windowWidth&&256!==e.viewport.voi.windowWidth||127!==e.viewport.voi.windowCenter&&128!==e.viewport.voi.windowCenter||!1!==e.viewport.invert||!t.getCanvas||!t.getCanvas()?(!1===St(e,t)&&!0!==n||(i.width===t.width&&i.height===t.height||Ct(e,t),n=De(),a=t,o=e.viewport,void 0!==a.cachedLut&&a.cachedLut.windowCenter===o.voi.windowCenter&&a.cachedLut.windowWidth===o.voi.windowWidth&&a.cachedLut.invert===o.invert||(Pt(a,o.voi.windowWidth,o.voi.windowCenter,o.invert),a.cachedLut.windowWidth=o.voi.windowWidth,a.cachedLut.windowCenter=o.voi.windowCenter,a.cachedLut.invert=o.invert),o=a.cachedLut.lutArray,t.stats=t.stats||{},t.stats.lastLutGenerateTime=De()-n,a=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(t.rgba?kt:Lt)(t,o,a.data),n=De(),e.putImageData(a,0,0),t.stats.lastPutImageDataTime=De()-n),i):t.getCanvas()}function Rt(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var o=e.canvas.getContext("2d",{desynchronized:!0}),a=(o.setTransform(1,0,0,1,0,0),o.fillStyle=Ne(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,Be(e,o),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?pt.renderer.render(e):Ot(e,n,t),t=x(e.image,e.viewport)).tlhc.x-1,i=t.tlhc.y-1,r=t.brhc.x-a;t=t.brhc.y-i,o.drawImage(n,a,i,r,t,a,i,r,t),e.renderingTools=At(e)}var Nt=function(e,t,n,o){var a,i,r=De(),s=e.getPixelData(),l=(e.stats.lastGetPixelDataTime=De()-r,s.length),c=e.minPixelValue,u=0,d=0,h=(r=De(),n instanceof z.LookupTable?n.Table:n);if(!0===e.color||!0===e.rgba)if(c<0)for(;d<l;)a=t[s[d]+-c],d+=4,i=h[a],o[u++]=i[0],o[u++]=i[1],o[u++]=i[2],o[u++]=i[3];else for(;d<l;)a=t[s[d]],d+=4,i=h[a],o[u++]=i[0],o[u++]=i[1],o[u++]=i[2],o[u++]=i[3];else if(c<0)for(;d<l;)i=h[a=t[s[d++]+-c]],o[u++]=i[0],o[u++]=i[1],o[u++]=i[2],o[u++]=i[3];else for(;d<l;)i=h[a=t[s[d++]]],o[u++]=i[0],o[u++]=i[1],o[u++]=i[2],o[u++]=i[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=De()-r};function _t(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var o,a,i=e.renderingTools.renderCanvas,r=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),r=r&&"string"==typeof r?z.getColormap(r):r)return a=r.getId(),!1===St(e,t)&&!0!==n&&e.renderingTools.colormapId===a||(i.width===t.width&&i.height===t.height||Ct(e,t),o=De(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===a||(r.setNumberOfColors(256),e.renderingTools.colorLut=r.createLookupTable(),e.renderingTools.colormapId=a),r=Et(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=De()-o,a=e.renderingTools.colorLut,n=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,Nt(t,r,a,n.data),o=De(),e.putImageData(n,0,0),t.stats.lastPutImageDataTime=De()-o),i;throw new Error("renderPseudoColorImage: colormap not found.")}function Ut(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");if(void 0===(o=e.image))throw new Error("drawImage: image must be loaded before it can be drawn");var n=e.canvas.getContext("2d",{desynchronized:!0}),o=(n.setTransform(1,0,0,1,0,0),n.fillStyle=Ne(e),n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Be(e,n),_t(e,o,t)),a=(t=x(e.image,e.viewport)).tlhc.x-1,i=t.tlhc.y-1,r=t.brhc.x-a;t=t.brhc.y-i,n.drawImage(o,a,i,r,t,a,i,r,t),e.renderingTools=At(e)}var Bt=function(e,t,n){var o,a=De(),i=e.getPixelData(),r=(e.stats.lastGetPixelDataTime=De()-a,i.length),s=e.minPixelValue,l=0,c=0,u=(a=De(),t instanceof z.LookupTable?t.Table:t);if(s<0)for(;c<r;)o=u[i[c++]+-s],n[l++]=o[0],n[l++]=o[1],n[l++]=o[2],n[l++]=o[3];else for(;c<r;)o=u[i[c++]],n[l++]=o[0],n[l++]=o[1],n[l++]=o[2],n[l++]=o[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=De()-a};function Vt(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var o,a,i=e.renderingTools.renderCanvas,r=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),r=r&&"string"==typeof r?z.getColormap(r):r)return a=r.getId(),!1===St(e,t)&&!0!==n&&e.renderingTools.colormapId===a||(i.width===t.width&&i.height===t.height||Ct(e,t),o=De(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===a||(e.renderingTools.colorLut=r.createLookupTable(),e.renderingTools.colormapId=a),t.stats=t.stats||{},t.stats.lastLutGenerateTime=De()-o,n=e.renderingTools.colorLut,r=e.renderingTools.renderCanvasData,a=e.renderingTools.renderCanvasContext,Bt(t,n,r.data),o=De(),a.putImageData(r,0,0),t.stats.lastPutImageDataTime=De()-o),i;throw new Error("renderLabelMapImage: colormap not found.")}function Ft(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");if(void 0===(o=e.image))throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var n=e.canvas.getContext("2d",{desynchronized:!0}),o=(n.setTransform(1,0,0,1,0,0),n.fillStyle=Ne(e),n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Be(e,n),Vt(e,o,t)),a=(t=x(e.image,e.viewport)).tlhc.x-1,i=t.tlhc.y-1,r=t.brhc.x-a;t=t.brhc.y-i,n.drawImage(o,a,i,r,t,a,i,r,t),e.renderingTools=At(e)}function Ht(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}function jt(e,t){e.forEach((function(e){var n,o;e!==t&&e.viewport&&t.viewport&&(e.syncProps||Ht(e),o=e,(n=t).syncProps||Ht(n),o.syncProps||Ht(o),o=o.syncProps.originalScale/n.syncProps.originalScale,e.viewport.scale=t.viewport.scale*o,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/o,y:t.viewport.translation.y/o},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip)}))}function zt(e,t,n){t.forEach((function(t,o){if(t.image){e.save(),t.canvas=e.canvas,Be(t,e);var a=t.viewport.colormap||t.options.colormap,i=t.viewport.labelmap,r=t.invalid||n;if(a&&""!==a&&!0===i){var s=r;if(void 0===(i=t))throw new Error("addLabelMapLayer: layer parameter must not be undefined");var l=i.image;if(void 0===l)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");i.canvas=Vt(i,l,s),(l=i.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!i.viewport.pixelReplication,l.mozImageSmoothingEnabled=l.imageSmoothingEnabled,i.renderingTools=At(i)}else if(a&&""!==a){if(l=r,void 0===(s=t))throw new Error("addPseudoColorLayer: layer parameter must not be undefined");if(void 0===(i=s.image))throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");s.canvas=_t(s,i,l),(i=s.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!s.viewport.pixelReplication,i.mozImageSmoothingEnabled=i.imageSmoothingEnabled,s.renderingTools=At(s)}else if(!0===t.image.color){if(i=r,void 0===(a=t))throw new Error("addColorLayer: layer parameter must not be undefined");var c=a.image;if(void 0===c)throw new Error("addColorLayer: image must be loaded before it can be drawn");c.rgba=!0,a.canvas=Ot(a,c,i),(c=a.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!a.viewport.pixelReplication,c.mozImageSmoothingEnabled=c.imageSmoothingEnabled,a.renderingTools=At(a)}else!function(e,t,n){if(n=2<arguments.length&&void 0!==n&&n,void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var o=e.image;if(void 0===o)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=Mt(e,o,t,n),(o=e.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,e.renderingTools=At(e)}(t,r,0===o);t.options&&t.options.opacity?e.globalAlpha=t.options.opacity:e.globalAlpha=1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),e.imageSmoothingEnabled=!t.viewport.pixelReplication,e.mozImageSmoothingEnabled=e.imageSmoothingEnabled,c=(i=x(t.image,t.viewport)).tlhc.x-1,a=i.tlhc.y-1,r=i.brhc.x-c,o=i.brhc.y-a,e.drawImage(t.canvas,c,a,r,o,c,a,r,o),e.restore(),t.invalid=!1}}))}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Wt=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i=(b="function"==typeof Symbol?Symbol:{}).iterator||"@@iterator",r=b.asyncIterator||"@@asyncIterator",s=b.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(t,n,o,i){var r,s,l,c;return n=n&&n.prototype instanceof p?n:p,n=Object.create(n.prototype),i=new C(i||[]),a(n,"_invoke",{value:(r=t,s=o,l=i,c=d,function(t,n){if(c===m)throw new Error("Generator is already running");if(c===f){if("throw"===t)throw n;return{value:e,done:!0}}for(l.method=t,l.arg=n;;){var o=l.delegate;if(o&&(o=function t(n,o){var a=o.method,i=n.iterator[a];return i===e?(o.delegate=null,"throw"===a&&n.iterator.return&&(o.method="return",o.arg=e,t(n,o),"throw"===o.method)||"return"!==a&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+a+"' method")),g):"throw"===(a=u(i,n.iterator,o.arg)).type?(o.method="throw",o.arg=a.arg,o.delegate=null,g):(i=a.arg)?i.done?(o[n.resultName]=i.value,o.next=n.nextLoc,"return"!==o.method&&(o.method="next",o.arg=e),o.delegate=null,g):i:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,g)}(o,l),o)){if(o===g)continue;return o}if("next"===l.method)l.sent=l._sent=l.arg;else if("throw"===l.method){if(c===d)throw c=f,l.arg;l.dispatchException(l.arg)}else"return"===l.method&&l.abrupt("return",l.arg);if(c=m,"normal"===(o=u(r,s,l)).type){if(c=l.done?f:h,o.arg===g)continue;return{value:o.arg,done:l.done}}"throw"===o.type&&(c=f,l.method="throw",l.arg=o.arg)}})}),n}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d="suspendedStart",h="suspendedYield",m="executing",f="completed",g={};function p(){}function v(){}function y(){}var b,x,w=(l(b={},i,(function(){return this})),(x=(x=Object.getPrototypeOf)&&x(x(A([]))))&&x!==n&&o.call(x,i)&&(b=x),y.prototype=p.prototype=Object.create(b));function T(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){var n;a(this,"_invoke",{value:function(a,i){function r(){return new t((function(n,r){!function n(a,i,r,s){var l;if("throw"!==(a=u(e[a],e,i)).type)return(i=(l=a.arg).value)&&"object"==qt(i)&&o.call(i,"__await")?t.resolve(i.__await).then((function(e){n("next",e,r,s)}),(function(e){n("throw",e,r,s)})):t.resolve(i).then((function(e){l.value=e,r(l)}),(function(e){return n("throw",e,r,s)}));s(a.arg)}(a,i,n,r)}))}return n=n?n.then(r,r):r()}})}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function A(t){if(t||""===t){var n,a=t[i];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(a=function a(){for(;++n<t.length;)if(o.call(t,n))return a.value=t[n],a.done=!1,a;return a.value=e,a.done=!0,a}).next=a}throw new TypeError(qt(t)+" is not iterable")}return a(w,"constructor",{value:v.prototype=y,configurable:!0}),a(y,"constructor",{value:v,configurable:!0}),v.displayName=l(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},T(I.prototype),l(I.prototype,r,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,o,a,i){void 0===i&&(i=Promise);var r=new I(c(e,n,o,a),i);return t.isGeneratorFunction(n)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},T(w),l(w,s,"Generator"),l(w,i,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t,n=Object(e),o=[];for(t in n)o.push(t);return o.reverse(),function e(){for(;o.length;){var t=o.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},t.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(o,a){return s.type="throw",s.arg=t,n.next=o,a&&(n.method="next",n.arg=e),!!a}for(var i=this.tryEntries.length-1;0<=i;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var l=o.call(r,"catchLoc"),c=o.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}var r=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,o,a=this.tryEntries[t];if(a.tryLoc===e)return"throw"===(n=a.completion).type&&(o=n.arg,S(a)),o}throw new Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:A(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),g}},t}function Gt(e,t,n,o,a,i,r){try{var s=e[i](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}function Yt(e,t){return Zt.apply(this,arguments)}function Zt(){var e;return e=Wt().mark((function e(t,n){var o,a,r,s,l,c;return Wt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.image,r=t.element,s=t.layers||[],t.canvas&&t.image){e.next=5;break}return e.abrupt("return");case 5:return c=De(),a.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},s&&s.length?(d=n,g=h=f=m=h=void 0,m=D(h=(u=t).element),f=O(h),h=P(h),g=!u.lastSyncViewportsState&&u.syncViewports,u.lastSyncViewportsState=u.syncViewports,g&&m.forEach((function(e){e.viewport&&Ht(e)})),!0===u.syncViewports&&jt(h,f),(g=u.canvas.getContext("2d",{desynchronized:!0})).setTransform(1,0,0,1,0,0),g.fillStyle="black",g.fillRect(0,0,u.canvas.width,u.canvas.height),zt(g,h,d)):a&&((l=a.render)||(l=t.viewport.colormap&&""!==t.viewport.colormap&&!0===t.image.labelmap?Ft:t.viewport.colormap&&""!==t.viewport.colormap?Ut:a.color?Rt:Dt,a._render=l),l(t,n)),l=De()-c,c={viewport:t.viewport,element:r,image:a,enabledElement:t,canvasContext:t.canvas.getContext("2d",{desynchronized:!0}),renderTimeInMs:l},a.stats.lastRenderTime=l,t.invalid=!1,t.needsRedraw=!1,e.next=15,null==(o=globalThis.drawImageSyncHandler)?void 0:o.call(globalThis,c);case 15:I(r,i.IMAGE_RENDERED,c);case 16:case"end":return e.stop()}var u,d,h,m,f,g}),e)})),(Zt=function(){var t=this,n=arguments;return new Promise((function(o,a){var i=e.apply(t,n);function r(e){Gt(i,o,a,r,s,"next",e)}function s(e){Gt(i,o,a,r,s,"throw",e)}r(void 0)}))}).apply(this,arguments)}function Kt(e){pt.renderer.isWebGLAvailable()?(pt.renderer.initRenderer(),e.renderer="webgl",e.desynchronized=!0,e.preserveDrawingBuffer=!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,delete e.preserveDrawingBuffer)}var Xt=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||void window.setTimeout(e,1e3/60)},Jt="cornerstone-canvas";function Qt(e){var t="canvas.".concat(Jt);return e.querySelector(t)||(t=e,(e=document.createElement("canvas")).style.display="block",e.classList.add(Jt),t.appendChild(e),e)}var $t=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&Kt(t);var n,o={element:e,canvas:Qt(e),image:void 0,invalid:!1,needsRedraw:!0,options:Object.assign({},t),layers:[],data:{},renderingTools:{},uuid:(n=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(n+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})))};c(o),I(r,i.ELEMENT_ENABLED,o),Re(e,!0),function e(t){void 0!==o.canvas&&(I(o.element,i.PRE_RENDER,{enabledElement:o,timestamp:t}),o.needsRedraw&&(void 0!==(t=o).image||0<t.layers.length)&&Yt(o,o.invalid),Xt(e))}()},en=function(e,t){return e=l(e),b(e.canvas,t)},tn=function(e){return l(e).image},nn=function(e,t,n,o,a){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var i=l(e),r=[],s=0,c=i.image.getPixelData(),u=0;u<a;u++)for(var d=0;d<o;d++){var h=(u+n)*i.image.columns+(d+t);r[s++]=c[h]}return r},on=function(e,t,n,o,a){return t=nn(e,t,n,o,a),o=bt((n=l(e)).image.slope,n.image.intercept,n.viewport.modalityLUT),t.map(o)},an=function(e){if(void 0!==(e=l(e).viewport))return Object.assign({},e)},rn={drawImage:w,generateLut:It,getDefaultViewport:b,requestAnimationFrame:Xt,setDefaultViewport:g,storedPixelDataToCanvasImageData:_e,storedPixelDataToCanvasImageDataRGBA:Ue,storedPixelDataToCanvasImageDataColorLUT:Bt,storedPixelDataToCanvasImageDataPseudocolorLUT:Nt,storedColorPixelDataToCanvasImageData:Lt,getTransform:Ee,calculateTransform:Ce,Transform:Se},sn=function(e){var t=l(e);t.invalid=!0,t.needsRedraw=!0,I(e,i.INVALIDATED,{element:e})},ln=function(e){u(e).forEach((function(e){w(e,!0)}))},cn=[],un={addProvider:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0;n<cn.length&&!(cn[n].priority<=t);n++);cn.splice(n,0,{priority:t,provider:e})},removeProvider:function(e){for(var t=0;t<cn.length;t++)if(cn[t].provider===e){cn.splice(t,1);break}},get:function(e,t){for(var n=0;n<cn.length;n++){var o=cn[n].provider(e,t);if(void 0!==o)return o}}},dn=function(e,t,n){var o=l(e);if(void 0===o.image)throw new Error("image has not been loaded yet");return t={x:t-(e=e.getBoundingClientRect()).left-window.pageXOffset,y:n-e.top-window.pageYOffset},(n=Ee(o)).invert(),n.transformPoint(t.x,t.y)},hn=function(e,t){return Ee(e=l(e)).transformPoint(t.x,t.y)},mn=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");o&&o.renderer&&"webgl"===o.renderer.toLowerCase()&&Kt(o);var a=b(e,t);n={enabledElement:(n&&Object.assign(a,n),e={element:n=e,canvas:n,image:t,invalid:!0,needsRedraw:!0,options:o,layers:[],data:{},renderingTools:{},viewport:a}),timestamp:Date.now()},I(e.element,i.PRE_RENDER,n),Yt(e,e.invalid)};function fn(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n,o,a,i,r,s=e.image;if(void 0===s)throw new Error("renderWebImage: image must be loaded before it can be drawn");e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert?((n=e.canvas.getContext("2d",{desynchronized:!0})).setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Be(e,n),o=(r=x(e.image,e.viewport)).tlhc.x-1,a=r.tlhc.y-1,i=r.brhc.x-o,r=r.brhc.y-a,n.drawImage(s.getImage(),o,a,i,r,o,a,i,r)):Rt(e,t)}var gn={colorImage:Rt,grayscaleImage:Dt,webImage:fn,pseudoColorImage:Ut,labelMapImage:Ft,toCanvas:mn},pn=function(e){var t=l(e);t.viewport=b(t.canvas,t.image),T(e)},vn=function(e,t){var n=l(e);if(void 0===n.viewport&&(n.viewport=b(n.canvas)),t)for(var o in t)null!==t[o]&&(n.viewport[o]=t[o]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(n.viewport.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(n.viewport.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&T(e)};t.default={drawImage:w,generateLut:It,getDefaultViewport:b,requestAnimationFrame:Xt,storedPixelDataToCanvasImageData:_e,storedColorPixelDataToCanvasImageData:Lt,storedPixelDataToCanvasImageDataColorLUT:Bt,storedPixelDataToCanvasImageDataPseudocolorLUT:Nt,internal:rn,renderLabelMapImage:Ft,renderPseudoColorImage:Ut,renderColorImage:Rt,renderGrayscaleImage:Dt,renderWebImage:fn,renderToCanvas:mn,canvasToPixel:Ae,disable:Me,displayImage:Pe,draw:Le,drawInvalidated:ke,enable:$t,getElementData:Z,removeElementData:K,getEnabledElement:l,addEnabledElement:c,getEnabledElementsByImageId:u,getEnabledElements:d,addLayer:C,removeLayer:A,getLayer:M,getLayers:D,getVisibleLayers:P,setActiveLayer:L,getActiveLayer:O,purgeLayers:R,setLayerImage:k,fitToWindow:Oe,getDefaultViewportForImage:en,getDisplayedArea:x,setDefaultViewport:g,getImage:tn,getPixels:on,getStoredPixels:nn,getViewport:an,loadImage:ce,loadAndCacheImage:ue,registerImageLoader:de,registerUnknownImageLoader:he,invalidate:sn,invalidateImageId:ln,pageToPixel:dn,pixelToCanvas:hn,reset:pn,resize:Re,setToPixelCoordinateSystem:Be,setViewport:vn,updateImage:T,pixelDataToFalseColorData:q,rendering:gn,imageCache:re,metaData:un,webGL:pt,colors:z,convertImageToFalseColorImage:G,convertToFalseColorImage:Y,restoreImage:W,EVENTS:i,events:r,triggerEvent:I,imageLoadPoolManager:xe,imageRetrievalPoolManager:we,RequestPoolManager:be}}],n={},e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)e.d(o,a,function(e){return t[e]}.bind(null,a));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=0);function e(o){var a;return(n[o]||(a=n[o]={i:o,l:!1,exports:{}},t[o].call(a.exports,a,a.exports,e),a.l=!0,a)).exports}var t,n}()},7869:e=>{
/*! cornerstone-math - 0.1.10 - 2022-06-09 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneMath */
window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),i=n(1),r=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=o||0}return o(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,o=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*o,this.y=a[1]*t+a[4]*n+a[7]*o,this.z=a[2]*t+a[5]*n+a[8]*o,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,o=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*o+a[12],this.y=a[1]*t+a[5]*n+a[9]*o+a[13],this.z=a[2]*t+a[6]*n+a[10]*o+a[14],this}},{key:"applyProjection",value:function(e){var t=this.x,n=this.y,o=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*o+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*o+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*o+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*o+a[14])*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,o=this.z,a=e.x,i=e.y,r=e.z,s=e.w,l=s*t+i*o-r*n,c=s*n+r*t-a*o,u=s*o+a*n-i*t,d=-a*t-i*n-r*o;return this.x=l*s+d*-a+c*-r-u*-i,this.y=c*s+d*-i+u*-a-l*-r,this.z=u*s+d*-r+l*-i-c*-a,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,o=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*o,this.y=a[1]*t+a[5]*n+a[9]*o,this.z=a[2]*t+a[6]*n+a[10]*o,this.normalize(),this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this}},{key:"max",value:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this}},{key:"clamp",value:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,o=this.y,a=this.z;return this.x=o*e.z-a*e.y,this.y=a*e.x-n*e.z,this.z=n*e.y-o*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,o=e.y,a=e.z,i=t.x,r=t.y,s=t.z;return this.x=o*s-a*r,this.y=a*i-n*s,this.z=n*r-o*i,this}},{key:"angleTo",value:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos((0,i.clamp)(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,o=this.z-e.z;return t*t+n*n+o*o}},{key:"setFromMatrixPosition",value:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),o=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=o,this}},{key:"setFromMatrixColumn",value:function(e,t){var n=4*e,o=t.elements;return this.x=o[n],this.y=o[n+1],this.z=o[n+2],this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();r.prototype.projectOnVector=function(){var e=void 0,t=void 0;return function(n){return void 0===e&&(e=new r),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),r.prototype.projectOnPlane=function(){var e=void 0;return function(t){return void 0===e&&(e=new r),e.copy(this).projectOnVector(t),this.sub(e)}}(),r.prototype.reflect=function(){var e=void 0;return function(t){return void 0===e&&(e=new r),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),r.prototype.clampScalar=function(){var e=void 0,t=void 0;return function(n,o){return void 0===e&&(e=new r,t=new r),e.set(n,n,n),t.set(o,o,o),this.clamp(e,t)}}(),r.prototype.applyAxisAngle=function(){var e=void 0;return function(t,n){return void 0===e&&(e=new a.default),this.applyQuaternion(e.setFromAxisAngle(t.normalize(),n)),this}}(),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=1e-4;t.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.degToRad=function(e){return e*(Math.PI/180)},t.approximatelyEquals=function(e,t,n){var a=n||o;return Math.abs(e-t)<=a*Math.max(1,Math.abs(e),Math.abs(t))},t.radToDeg=function(e){return e*(180/Math.PI)},t.sign=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){function e(t,n,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=o||0,this.w=void 0!==a?a:1}return o(e,[{key:"setFromAxisAngle",value:function(e,t){var n=t/2,o=Math.sin(n);return this.x=e.x*o,this.y=e.y*o,this.z=e.z*o,this.w=Math.cos(n),this}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,o=e.y,a=e.z,i=e.w,r=t.x,s=t.y,l=t.z,c=t.w;return this.x=n*c+i*r+o*l-a*s,this.y=o*c+i*s+a*r-n*l,this.z=a*c+i*l+n*s-o*r,this.w=i*c-n*r-o*s-a*l,this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],o=t[4],a=t[8],i=t[1],r=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+r+u,h=void 0;return d>0?(h=.5/Math.sqrt(d+1),this.w=.25/h,this.x=(c-s)*h,this.y=(a-l)*h,this.z=(i-o)*h):n>r&&n>u?(h=2*Math.sqrt(1+n-r-u),this.w=(c-s)/h,this.x=.25*h,this.y=(o+i)/h,this.z=(a+l)/h):r>u?(h=2*Math.sqrt(1+r-n-u),this.w=(a-l)/h,this.x=(o+i)/h,this.y=.25*h,this.z=(s+c)/h):(h=2*Math.sqrt(1+u-n-r),this.w=(i-o)/h,this.x=(a+l)/h,this.y=(s+c)/h,this.z=.25*h),this}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1);function a(e){return e*e}function i(e,t){return a(e.x-t.x)+a(e.y-t.y)}var r={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var n=i(e.start,e.end);if(0===n)return i(t,e.start);var o=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/n;return i(t,o<0?e.start:o>1?e.end:{x:e.start.x+o*(e.end.x-e.start.x),y:e.start.y+o*(e.end.y-e.start.y)})}(e,t))},intersectLine:function(e,t){var n,a,i,r,s,l,c,u,d,h,m,f={},g=e.start.x,p=e.start.y,v=e.end.x,y=e.end.y,b=t.start.x,x=t.start.y,w=t.end.x,T=t.end.y,I=void 0;if(h=(n=y-p)*w+(i=g-v)*T+(s=v*p-g*y),(0===(d=n*b+i*x+s)||0===h||(0,o.sign)(d)!==(0,o.sign)(h))&&(u=(a=T-x)*v+(r=b-w)*y+(l=w*x-b*T),0===(c=a*g+r*p+l)||0===u||(0,o.sign)(c)!==(0,o.sign)(u))){m=n*r-a*i,I=i*l-r*s;var E=parseFloat(I/m);I=a*s-n*l;var S=parseFloat(I/m);return f.x=E,f.y=S,f}}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=t.rect=t.quaternion=t.point=t.Plane=t.Matrix4=t.sign=t.radToDeg=t.degToRad=t.clamp=t.lineSegment=t.Line3=void 0;var o=h(n(5)),a=h(n(3)),i=n(1),r=h(n(6)),s=h(n(7)),l=h(n(8)),c=h(n(2)),u=h(n(9)),d=h(n(0));function h(e){return e&&e.__esModule?e:{default:e}}var m={Line3:o.default,lineSegment:a.default,clamp:i.clamp,degToRad:i.degToRad,radToDeg:i.radToDeg,sign:i.sign,Matrix4:r.default,Plane:s.default,point:l.default,quaternion:c.default,rect:u.default,Vector3:d.default};t.Line3=o.default,t.lineSegment=a.default,t.clamp=i.clamp,t.degToRad=i.degToRad,t.radToDeg=i.radToDeg,t.sign=i.sign,t.Matrix4=r.default,t.Plane=s.default,t.point=l.default,t.quaternion=c.default,t.rect=u.default,t.Vector3=d.default,t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),i=n(1),r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=void 0!==t?t:new a.default,this.end=void 0!==n?n:new a.default}return o(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"center",value:function(e){return(e||new a.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return(e||new a.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){var n=t||new a.default;return this.delta(n).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){var n=new a.default,o=new a.default;n.subVectors(e,this.start),o.subVectors(this.end,this.start);var r=o.dot(o),s=o.dot(n)/r;return t&&(s=(0,i.clamp)(s,0,1)),s}},{key:"closestPointToPoint",value:function(e,t,n){var o=this.closestPointToPointParameter(e,t),i=n||new a.default;return this.delta(i).multiplyScalar(o).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"intersectLine",value:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),o=e.start.clone().sub(this.start),a=t.clone().cross(n),r=o.clone().cross(n),s=o.dot(a)/(o.lengthSq()*a.lengthSq());if((0,i.approximatelyEquals)(s,0)){var l=r.dot(a)/a.lengthSq();if(!(l>1||isNaN(l))){var c=this.start.clone().add(t.clone().multiplyScalar(l));return c.clone().sub(e.start).lengthSq()+c.clone().sub(e.end).lengthSq()<=e.distanceSq()?c:void 0}}}}]),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),i=function(){function e(t,n,o,a,i,r,s,l,c,u,d,h,m,f,g,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Float32Array(16);var v=this.elements;v[0]=void 0!==t?t:1,v[4]=n||0,v[8]=o||0,v[12]=a||0,v[1]=i||0,v[5]=void 0!==r?r:1,v[9]=s||0,v[13]=l||0,v[2]=c||0,v[6]=u||0,v[10]=void 0!==d?d:1,v[14]=h||0,v[3]=m||0,v[7]=f||0,v[11]=g||0,v[15]=void 0!==p?p:1}return o(e,[{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,n=e.x,o=e.y,a=e.z,i=e.w,r=n+n,s=o+o,l=a+a,c=n*r,u=n*s,d=n*l,h=o*s,m=o*l,f=a*l,g=i*r,p=i*s,v=i*l;return t[0]=1-(h+f),t[4]=u-v,t[8]=d+p,t[1]=u+v,t[5]=1-(c+f),t[9]=m-g,t[2]=d-p,t[6]=m+g,t[10]=1-(c+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,o=t.elements,a=this.elements,i=n[0],r=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],m=n[2],f=n[6],g=n[10],p=n[14],v=n[3],y=n[7],b=n[11],x=n[15],w=o[0],T=o[4],I=o[8],E=o[12],S=o[1],C=o[5],A=o[9],M=o[13],D=o[2],P=o[6],L=o[10],k=o[14],O=o[3],R=o[7],N=o[11],_=o[15];return a[0]=i*w+r*S+s*D+l*O,a[4]=i*T+r*C+s*P+l*R,a[8]=i*I+r*A+s*L+l*N,a[12]=i*E+r*M+s*k+l*_,a[1]=c*w+u*S+d*D+h*O,a[5]=c*T+u*C+d*P+h*R,a[9]=c*I+u*A+d*L+h*N,a[13]=c*E+u*M+d*k+h*_,a[2]=m*w+f*S+g*D+p*O,a[6]=m*T+f*C+g*P+p*R,a[10]=m*I+f*A+g*L+p*N,a[14]=m*E+f*M+g*k+p*_,a[3]=v*w+y*S+b*D+x*O,a[7]=v*T+y*C+b*P+x*R,a[11]=v*I+y*A+b*L+x*N,a[15]=v*E+y*M+b*k+x*_,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"getInverse",value:function(e,t){var n=this.elements,o=e.elements,a=o[0],i=o[4],r=o[8],s=o[12],l=o[1],c=o[5],u=o[9],d=o[13],h=o[2],m=o[6],f=o[10],g=o[14],p=o[3],v=o[7],y=o[11],b=o[15];n[0]=u*g*v-d*f*v+d*m*y-c*g*y-u*m*b+c*f*b,n[4]=s*f*v-r*g*v-s*m*y+i*g*y+r*m*b-i*f*b,n[8]=r*d*v-s*u*v+s*c*y-i*d*y-r*c*b+i*u*b,n[12]=s*u*m-r*d*m-s*c*f+i*d*f+r*c*g-i*u*g,n[1]=d*f*p-u*g*p-d*h*y+l*g*y+u*h*b-l*f*b,n[5]=r*g*p-s*f*p+s*h*y-a*g*y-r*h*b+a*f*b,n[9]=s*u*p-r*d*p-s*l*y+a*d*y+r*l*b-a*u*b,n[13]=r*d*h-s*u*h+s*l*f-a*d*f-r*l*g+a*u*g,n[2]=c*g*p-d*m*p+d*h*v-l*g*v-c*h*b+l*m*b,n[6]=s*m*p-i*g*p-s*h*v+a*g*v+i*h*b-a*m*b,n[10]=i*d*p-s*c*p+s*l*v-a*d*v-i*l*b+a*c*b,n[14]=s*c*h-i*d*h-s*l*m+a*d*m+i*l*g-a*c*g,n[3]=u*m*p-c*f*p-u*h*v+l*f*v+c*h*y-l*m*y,n[7]=i*f*p-r*m*p+r*h*v-a*f*v-i*h*y+a*m*y,n[11]=r*c*p-i*u*p-r*l*v+a*u*v+i*l*y-a*c*y,n[15]=i*u*h-r*c*h+r*l*m-a*u*m-i*l*f+a*c*f;var x=a*n[0]+l*n[4]+h*n[8]+p*n[12];if(0===x){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/x),this}},{key:"applyToVector3Array",value:function(){var e=new a.default;return function(t,n,o){void 0===n&&(n=0),void 0===o&&(o=t.length);for(var a=0,i=n;a<o;a+=3,i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyMatrix4(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"set",value:function(e,t,n,o,a,i,r,s,l,c,u,d,h,m,f,g){var p=this.elements;return p[0]=e,p[4]=t,p[8]=n,p[12]=o,p[1]=a,p[5]=i,p[9]=r,p[13]=s,p[2]=l,p[6]=c,p[10]=u,p[14]=d,p[3]=h,p[7]=m,p[11]=f,p[15]=g,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=void 0!==t?t:new a.default(1,0,0),this.constant=void 0!==n?n:0}return o(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,o){return this.normal.set(e,t,n),this.constant=o,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return this.orthoPoint(e,t).sub(e).negate()}},{key:"orthoPoint",value:function(e,t){var n=this.distanceToPoint(e);return(t||new a.default).copy(this.normal).multiplyScalar(n)}},{key:"isIntersectionLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectPlane",value:function(e){var t=this.normal.clone().cross(e.normal),n={origin:new a.default,direction:t};if(this.normal.clone().cross(e.normal).length<1e-10)return n.direction=new a.default,n;var o=this.constant,i=e.constant,r=this.normal.clone().dot(e.normal),s=-(o-i*r)/(1-r*r),l=-(i-o*r)/(1-r*r);return n.origin=this.normal.clone().multiplyScalar(s).add(e.normal.clone().multiplyScalar(l)),n}},{key:"coplanarPoint",value:function(e){return(e||new a.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant=this.constant-e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();i.prototype.setFromCoplanarPoints=function(){var e=new a.default,t=new a.default;return function(n,o,a){var i=e.subVectors(a,o).cross(t.subVectors(n,o)).normalize();return this.setFromNormalAndCoplanarPoint(i,n),this}}(),i.prototype.intersectLine=function(){var e=new a.default;return function(t,n){var o=n||new a.default,i=t.delta(e),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(t.start)?o.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/r;return s<0||s>1?void 0:o.copy(i).multiplyScalar(s).add(t.start)}}(),t.default=i},function(e,t,n){"use strict";function o(e,t){return{x:e.x-t.x,y:e.y-t.y}}function a(e,t){return Math.sqrt(i(e,t))}function i(e,t){var n=o(e,t);return n.x*n.x+n.y*n.y}Object.defineProperty(t,"__esModule",{value:!0});var r={subtract:o,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:a,distanceSquared:i,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)},findClosestPoint:function(e,t){var n=[],o=void 0;return e.forEach((function(e,i){var r=a(e,t);n.push(r),o=0===i?r:Math.min(r,o)})),e[n.indexOf(o)]}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function a(e){return{topLeft:{x:e.left,y:e.top},bottomRight:{x:e.left+e.width,y:e.top+e.height}}}var i={distanceToPoint:function(e,t){var n=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(e).forEach((function(e){var a=o.default.distanceToPoint(e,t);a<n&&(n=a)})),n},getIntersectionRect:function(e,t){var n={topLeft:{},bottomRight:{}};if(function(e,t){var n=void 0,o=void 0,i=a(e),r=a(t);return n=e.width>=0?t.width>=0?!(i.bottomRight.x<=r.topLeft.x||r.bottomRight.x<=i.topLeft.x):!(i.bottomRight.x<=r.bottomRight.x||r.topLeft.x<=i.topLeft.x):t.width>=0?!(i.topLeft.x<=r.topLeft.x||r.bottomRight.x<=i.bottomRight.x):!(i.topLeft.x<=r.bottomRight.x||r.topLeft.x<=i.bottomRight.x),o=e.height>=0?t.height>=0?!(i.bottomRight.y<=r.topLeft.y||r.bottomRight.y<=i.topLeft.y):!(i.bottomRight.y<=r.bottomRight.y||r.topLeft.y<=i.topLeft.y):t.height>=0?!(i.topLeft.y<=r.topLeft.y||r.bottomRight.y<=i.bottomRight.y):!(i.topLeft.y<=r.bottomRight.y||r.top<=i.bottomRight.y),n&&o}(e,t)){var o=a(e),i=a(t);return e.width>=0?t.width>=0?(n.topLeft.x=Math.max(o.topLeft.x,i.topLeft.x),n.bottomRight.x=Math.min(o.bottomRight.x,i.bottomRight.x)):(n.topLeft.x=Math.max(o.topLeft.x,i.bottomRight.x),n.bottomRight.x=Math.min(o.bottomRight.x,i.topLeft.x)):t.width>=0?(n.topLeft.x=Math.min(o.topLeft.x,i.bottomRight.x),n.bottomRight.x=Math.max(o.bottomRight.x,i.topLeft.x)):(n.topLeft.x=Math.min(o.topLeft.x,i.topLeft.x),n.bottomRight.x=Math.max(o.bottomRight.x,i.bottomRight.x)),e.height>=0?t.height>=0?(n.topLeft.y=Math.max(o.topLeft.y,i.topLeft.y),n.bottomRight.y=Math.min(o.bottomRight.y,i.bottomRight.y)):(n.topLeft.y=Math.max(o.topLeft.y,i.bottomRight.y),n.bottomRight.y=Math.min(o.bottomRight.y,i.topLeft.y)):t.height>=0?(n.topLeft.y=Math.min(o.topLeft.y,i.bottomRight.y),n.bottomRight.y=Math.max(o.bottomRight.y,i.topLeft.y)):(n.topLeft.y=Math.min(o.topLeft.y,i.topLeft.y),n.bottomRight.y=Math.max(o.bottomRight.y,i.bottomRight.y)),n}}};t.default=i}])},281:e=>{
/*! cornerstone-tools - 6.0.10 - 2023-07-21 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=25)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t,n){var o=n(8),a=n(5);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?a(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(14);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var o=n(16),a=n(17),i=n(18);e.exports=function(e){return o(e)||a(e)||i()}},function(e,t,n){var o=n(20),a=n(21),i=n(22);e.exports=function(e,t){return o(e)||a(e,t)||i()}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=o=function(e){return n(e)}:e.exports=o=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},o(t)}e.exports=o},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";(function(e){var o=n(12),a={formatArgs:function(e){if(e[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),"+").concat(i.humanize(this.diff)),this.useColors){var t="color: ".concat(this.color);e.splice(1,0,t,"color: inherit");var n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))})),e.splice(o,0,t)}},save:function(e){try{e?a.storage.setItem("debug",e):a.storage.removeItem("debug")}catch(e){}},load:function(){var t;try{t=a.storage.getItem("debug")}catch(e){}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},storage:function(){try{return localStorage}catch(e){}}(),colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"]};a.log=console.debug||console.log||function(){};var i=Object(o.a)(a);i.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: ".concat(e.message)}},t.a=i}).call(this,n(15))},function(e,t,n){e.exports=n(23)},function(e,t,n){"use strict";var o=n(6),a=n.n(o);t.a=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return o.colors[Math.abs(t)%o.colors.length]}function o(e){var n;function a(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(a.enabled){var r=a,s=Number(new Date),l=s-(n||s);r.diff=l,r.prev=n,r.curr=s,n=s,t[0]=o.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var c=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;c++;var a=o.formatters[n];if("function"==typeof a){var i=t[c];e=a.call(r,i),t.splice(c,1),c--}return e})),o.formatArgs.call(r,t),(r.log||o.log).apply(r,t)}}return a.namespace=e,a.enabled=o.enabled(e),a.useColors=o.useColors(),a.color=t(e),a.destroy=i,a.extend=r,"function"==typeof o.init&&o.init(a),o.instances.push(a),a}function i(){var e=o.instances.indexOf(this);return-1!==e&&(o.instances.splice(e,1),!0)}function r(e,t){var n=o(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return o.debug=o,o.default=o,o.coerce=function(e){return e instanceof Error?e.stack||e.message:e},o.disable=function(){var e=[].concat(a()(o.names.map(s)),a()(o.skips.map(s).map((function(e){return"-".concat(e)})))).join(",");return o.enable(""),e},o.enable=function(e){var t;o.save(e),o.names=[],o.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),a=n.length;for(t=0;t<a;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?o.skips.push(new RegExp("^".concat(e.substr(1),"$"))):o.names.push(new RegExp("^".concat(e,"$"))));for(t=0;t<o.instances.length;t++){var i=o.instances[t];i.enabled=o.enabled(i.namespace)}},o.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=o.skips.length;t<n;t++)if(o.skips[t].test(e))return!1;for(t=0,n=o.names.length;t<n;t++)if(o.names[t].test(e))return!0;return!1},o.humanize=n(19),Object.keys(e).forEach((function(t){o[t]=e[t]})),o.instances=[],o.names=[],o.skips=[],o.formatters={},o.selectColor=t,o.enable(o.load()),o}},function(e,t){function n(e,t,n,o,a,i,r){try{var s=e[i](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}e.exports=function(e){return function(){var t=this,o=arguments;return new Promise((function(a,i){var r=e.apply(t,o);function s(e){n(r,a,i,s,l,"next",e)}function l(e){n(r,a,i,s,l,"throw",e)}s(void 0)}))}}},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t){var n,o,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:r}catch(e){o=r}}();var l,c=[],u=!1,d=-1;function h(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&m())}function m(){if(!u){var e=s(h);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===r||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||s(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){var n=1e3,o=6e4,a=60*o,i=24*a;function r(e,t,n,o){var a=t>=1.5*n;return Math.round(e/n)+" "+o+(a?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*i;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=i?r(e,t,i,"day"):t>=a?r(e,t,a,"hour"):t>=o?r(e,t,o,"minute"):t>=n?r(e,t,n,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=i?Math.round(e/i)+"d":t>=a?Math.round(e/a)+"h":t>=o?Math.round(e/o)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],o=!0,a=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(a)throw i}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var o=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=o.regeneratorRuntime&&Object.getOwnPropertyNames(o).indexOf("regeneratorRuntime")>=0,i=a&&o.regeneratorRuntime;if(o.regeneratorRuntime=void 0,e.exports=n(24),a)o.regeneratorRuntime=i;else try{delete o.regeneratorRuntime}catch(e){o.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,o=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",r=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag",l="object"==typeof e,c=t.regeneratorRuntime;if(c)l&&(e.exports=c);else{(c=t.regeneratorRuntime=l?e.exports:{}).wrap=g;var u={},d={};d[i]=function(){return this};var h=Object.getPrototypeOf,m=h&&h(h(C([])));m&&m!==n&&o.call(m,i)&&(d=m);var f=b.prototype=v.prototype=Object.create(d);y.prototype=f.constructor=b,b.constructor=y,b[s]=y.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(f),e},c.awrap=function(e){return{__await:e}},x(w.prototype),w.prototype[r]=function(){return this},c.AsyncIterator=w,c.async=function(e,t,n,o){var a=new w(g(e,t,n,o));return c.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(f),f[s]="Generator",f[i]=function(){return this},f.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var o=t.pop();if(o in e)return n.value=o,n.done=!1,n}return n.done=!0,n}},c.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return r.type="throw",r.arg=e,t.next=n,o&&(t.method="next",t.arg=void 0),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],r=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var a=o.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}}}function g(e,t,n,o){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),r=new S(o||[]);return i._invoke=function(e,t,n){var o="suspendedStart";return function(a,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===a)throw i;return A()}for(n.method=a,n.arg=i;;){var r=n.delegate;if(r){var s=T(r,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var l=p(e,t,n);if("normal"===l.type){if(o=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o="completed",n.method="throw",n.arg=l.arg)}}}(e,n,r),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function x(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(n,a){function i(){return new Promise((function(t,i){!function t(n,a,i,r){var s=p(e[n],e,a);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,i,r)}),(function(e){t("throw",e,i,r)})):Promise.resolve(c).then((function(e){l.value=e,i(l)}),(function(e){return t("throw",e,i,r)}))}r(s.arg)}(n,a,t,i)}))}return t=t?t.then(i,i):i()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=p(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var o={};n.r(o),n.d(o,"drawBrushPixels",(function(){return te})),n.d(o,"eraseIfSegmentIndex",(function(){return ee})),n.d(o,"eraseOutsideBoundingBox",(function(){return ne})),n.d(o,"eraseInsideShape",(function(){return se})),n.d(o,"eraseOutsideShape",(function(){return le})),n.d(o,"fillOutsideBoundingBox",(function(){return ce})),n.d(o,"fillInsideShape",(function(){return he})),n.d(o,"fillOutsideShape",(function(){return me})),n.d(o,"floodFill",(function(){return fe})),n.d(o,"getBoundingBoxAroundCircle",(function(){return be})),n.d(o,"getBoundingBoxAroundPolygon",(function(){return xe})),n.d(o,"getCircle",(function(){return we})),n.d(o,"getPixelPathBetweenPixels",(function(){return Ee})),n.d(o,"isSameSegment",(function(){return ie})),n.d(o,"triggerLabelmapModifiedEvent",(function(){return ke})),n.d(o,"getDiffBetweenPixelData",(function(){return Oe}));var a={};n.r(a),n.d(a,"angleCursor",(function(){return xa})),n.d(a,"arrowAnnotateCursor",(function(){return wa})),n.d(a,"bidirectionalCursor",(function(){return Ta})),n.d(a,"cobbAngleCursor",(function(){return Ia})),n.d(a,"circleRoiCursor",(function(){return Ea})),n.d(a,"ellipticalRoiCursor",(function(){return Sa})),n.d(a,"freehandRoiCursor",(function(){return Ca})),n.d(a,"freehandRoiSculptorCursor",(function(){return Aa})),n.d(a,"lengthCursor",(function(){return Ma})),n.d(a,"probeCursor",(function(){return Da})),n.d(a,"rectangleRoiCursor",(function(){return Pa})),n.d(a,"textMarkerCursor",(function(){return La})),n.d(a,"crosshairsCursor",(function(){return ka})),n.d(a,"eraserCursor",(function(){return Oa})),n.d(a,"magnifyCursor",(function(){return Ra})),n.d(a,"panCursor",(function(){return Na})),n.d(a,"rotateCursor",(function(){return _a})),n.d(a,"stackScrollCursor",(function(){return Ua})),n.d(a,"wwwcRegionCursor",(function(){return Ba})),n.d(a,"wwwcCursor",(function(){return Va})),n.d(a,"zoomCursor",(function(){return Fa})),n.d(a,"freehandEraseInsideCursor",(function(){return Ya})),n.d(a,"freehandFillInsideCursor",(function(){return Za})),n.d(a,"freehandEraseOutsideCursor",(function(){return Ka})),n.d(a,"freehandFillOutsideCursor",(function(){return Xa})),n.d(a,"segRectangleEraseInsideCursor",(function(){return Ja})),n.d(a,"segRectangleFillInsideCursor",(function(){return Qa})),n.d(a,"segRectangleEraseOutsideCursor",(function(){return $a})),n.d(a,"segRectangleFillOutsideCursor",(function(){return ei})),n.d(a,"segCircleEraseInsideCursor",(function(){return ti})),n.d(a,"segCircleFillInsideCursor",(function(){return ni})),n.d(a,"segCircleEraseOutsideCursor",(function(){return oi})),n.d(a,"segCircleFillOutsideCursor",(function(){return ai}));var i=n(0),r=n.n(i),s=n(1),l=n.n(s),c=n(2),u=n.n(c),d=n(3),h=n.n(d),m=n(4),f=n.n(m),g=window.cornerstone,p=window.cornerstoneMath,v=window.Hammer,y={set cornerstone(e){g=e},get cornerstone(){return g},set cornerstoneMath(e){p=e},get cornerstoneMath(){return p},set Hammer(e){v=e},get Hammer(){return v}},b=n(8),x=n.n(b),w={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"};function T(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:o,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,o),e.dispatchEvent(n)}function I(e){return e instanceof HTMLElement?e:yt.enabledElementByUID(e)}var E={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1},S=E.UINT_16_ARRAY,C=E.FLOAT_32_ARRAY;function A(e,t,n){var o,a=xt("segmentation").configuration;switch(a.arrayType){case S:o=2;break;case C:o=4;break;default:throw new Error("Unsupported Array Type ".concat(a.arrayType))}e.labelmaps3D[t]={buffer:new ArrayBuffer(n*o),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}function M(){var e={};function t(t,n,o){!1===e.hasOwnProperty(t)&&(e[t]={});var a=e[t];!1===a.hasOwnProperty(n)&&(a[n]={data:[]}),a[n].data.push(o)}function n(t,n){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n))return o[n]}}function o(t,n,o){e[t][n]=o}function a(t){!1!==e.hasOwnProperty(t)&&delete e[t]}return{get:function(e,t){var o=y.cornerstone.getEnabledElement(e);if(o.image)return n(o.image.imageId,t)},add:function(e,n,o){var a=y.cornerstone.getEnabledElement(e);a.image&&t(a.image.imageId,n,o)},set:function(e,t,n){var a=y.cornerstone.getEnabledElement(e);a.image&&o(a.image.imageId,t,n)},clear:function(e){var t=y.cornerstone.getEnabledElement(e);t.image&&a(t.image.imageId)},getImageIdToolState:n,addImageIdToolState:t,setImageIdToolState:o,clearImageIdToolState:a,saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var D=M();function P(e){var t=y.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=D),t.toolStateManager}function L(e,t,n){var o=P(e);n.uuid=n.uuid||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),o.add(e,t,n),T(e,w.MEASUREMENT_ADDED,{toolName:t,toolType:t,element:e,measurementData:n})}function k(e,t){return P(e).get(e,t)}function O(e,t,n){var o=P(e).get(e,t);if(o&&o.data&&o.data.length){for(var a=-1,i=0;i<o.data.length;i++)o.data[i]===n&&(a=i);-1!==a&&(o.data.splice(a,1),T(e,w.MEASUREMENT_REMOVED,{toolName:t,toolType:t,element:e,measurementData:n}))}}function R(e,t){var n=P(e).get(e,t);void 0!==n&&(n.data=[])}function N(e,t){y.cornerstone.getEnabledElement(e).toolStateManager=t}var _=n(10),U=Object(_.a)("cornerstoneTools"),B=function(e){var t=U.extend(e);return{log:t,warn:t,error:void 0}},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat("cornerstoneTools",":*");return _.a.enable(e)},F=function(){return _.a.disable()},H={series:{},colorLutTables:[]},j=B("store:modules:segmentationModule:metadata");function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"increase",n=xt("segmentation").configuration,o=k(e,"stack").data[0].imageIds[0],a=H.series[o];if(a){var i=a.activeLabelmapIndex,r=a.labelmaps3D[i];switch(t){case"increase":r.activeSegmentIndex++,r.activeSegmentIndex>n.segmentsPerLabelmap&&(r.activeSegmentIndex=1);break;case"decrease":r.activeSegmentIndex--,r.activeSegmentIndex<=0&&(r.activeSegmentIndex=n.segmentsPerLabelmap)}}}var q=B("store:modules:segmentationModule:segmentVisibility"),W=B("store:modules:segmentationModule:getLabelmaps3D");function G(e){var t=I(e);if(t){var n=k(t,"stack");if(n){var o,a,i=n.data[0],r=i.imageIds[0],s=H.series[r];return s&&(o=s.labelmaps3D,a=s.activeLabelmapIndex),{labelmaps3D:o,activeLabelmapIndex:a,currentImageIdIndex:i.currentImageIdIndex}}W.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function Y(e,t){var n=G(e),o=n.labelmaps3D,a=n.activeLabelmapIndex;return o[t=void 0!==t?t:a]}var Z=E.UINT_16_ARRAY,K=E.FLOAT_32_ARRAY;function X(e,t){var n=I(e);if(n){var o=G(n).labelmaps3D;if(!o)return[];var a,i,r=xt("segmentation").configuration;switch(r.arrayType){case Z:a="Uint16Array",i="2";break;case K:a="Float32Array",i="4";break;default:throw new Error("Unsupported Array Type ".concat(r.arrayType))}var s=H.colorLutTables;if(void 0!==t){var l=o[t];return l?{labelmapIndex:t,bytesPerVoxel:i,type:a,buffer:l.buffer,colorLUT:s[l.colorLUTIndex]}:void 0}for(var c=[],u=0;u<o.length;u++){var d=o[u];d&&c.push({labelmapIndex:u,bytesPerVoxel:2,buffer:d.buffer,colorLUT:s[d.colorLUTIndex]})}return c}}var J=n(6),Q=n.n(J);function $(e){return Q()(new Set(e))}function ee(e,t,n){t[e]===n&&(t[e]=0)}function te(e,t,n,o){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=function(e,t){return t*o+e};e.forEach((function(e){var o=i.apply(void 0,Q()(e));a?ee(o,t,n):t[o]=n}))}function ne(e,t,n,o){for(var a=e.detail,i=t.pixelData,r=t.segmentIndex,s=a.image,l=s.width,c=s.height,u=0;u<l;u++)for(var d=0;d<n[1];d++)ee(d*l+u,i,r);for(var h=0;h<n[0];h++)for(var m=n[1];m<o[1];m++)ee(m*l+h,i,r);for(var f=o[0];f<l;f++)for(var g=n[1];g<o[1];g++)ee(g*l+f,i,r);for(var p=0;p<l;p++)for(var v=o[1];v<c;v++)ee(v*l+p,i,r)}var oe=n(7),ae=n.n(oe);function ie(e,t,n){return t[e]===n}function re(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",r=e.detail.image.width,s=t.pixelData,l=t.segmentIndex,c=ae()(o,2),u=c[0],d=c[1],h=ae()(a,2),m=h[0],f=h[1];"outside"===i&&ne(e,t,o,a);for(var g=u;g<m;g++)for(var p=d;p<f;p++){var v=p*r+g;ie(v,s,l)&&n({x:g,y:p})&&(s[v]=0)}}function se(e,t,n,o,a){re(e,t,n,o,a,"inside")}function le(e,t,n,o,a){re(e,t,(function(e){return!n(e)}),o,a,"outside")}function ce(e,t,n,o){for(var a=t.pixelData,i=t.segmentIndex,r=e.detail.image,s=r.width,l=r.height,c=0;c<s;c++)for(var u=0;u<n[1];u++)a[u*s+c]=i;for(var d=0;d<n[0];d++)for(var h=n[1];h<o[1];h++)a[h*s+d]=i;for(var m=o[0];m<s;m++)for(var f=n[1];f<o[1];f++)a[f*s+m]=i;for(var g=0;g<s;g++)for(var p=o[1];p<l;p++)a[p*s+g]=i}B("util:segmentation:operations:eraseOutsideCircle");var ue=B("util:segmentation:operations:helpers:fillShape");function de(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",r=t.pixelData,s=t.segmentIndex;if(void 0!==r&&void 0!==s){var l=e.detail.image.width,c=ae()(o,2),u=c[0],d=c[1],h=ae()(a,2),m=h[0],f=h[1];"outside"===i&&ce(e,t,o,a);for(var g=u;g<m;g++)for(var p=d;p<f;p++){var v=p*l+g;n({x:g,y:p})&&(r[v]=s)}}else ue.error("fillInsideShape requires operationData to contain pixelData and segmentIndex")}function he(e,t,n,o,a){de(e,t,n,o,a,"inside")}function me(e,t,n,o,a){de(e,t,(function(e){return!n(e)}),o,a,"outside")}var fe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.onFlood||function(){},a=n.onBoundary||function(){},i=n.equals||ge,r=n.diagonals||!1,s=x(t),l=T(),c=[],u=[],d={},h={};for(c.push({currentArgs:t});c.length>0;)m(c.pop());return{flooded:u,boundaries:E()};function m(e){var t=e.currentArgs,n=e.previousArgs;f(t)||(g(t),p(t)?(v(t),b(t)):y(n))}function f(e){return!0===d[e]}function g(e){d[e]=!0}function p(e){var t=w(x,[e]);return w(i,[t,s])}function v(e){u.push(e),o.apply(void 0,Q()(e))}function y(e){h[e]=e,a.apply(void 0,Q()(e))}function b(e){for(var t=0;t<l.length;t+=1){for(var n=l[t],o=e.slice(0),a=0;a<e.length;a+=1)o[a]+=n[a];c.push({currentArgs:o,previousArgs:e})}}function x(t){return e.apply(void 0,Q()(t))}function w(e,t){try{return e.apply(void 0,Q()(t))}catch(e){return}}function T(){return I(t.length).filter((function(e){var t=pe(e);return 0!==t&&(1===t||r)}))}function I(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},o=0;o<Math.pow(3,e);o+=1){var a=ve(o.toString(3),"0",e);t.push(n(a))}return t}function E(){var e=[];for(var t in h)h.hasOwnProperty(t)&&e.unshift(h[t]);return e}};function ge(e,t){return e===t}function pe(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function ve(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}function ye(e,t){var n=(0,y.cornerstoneMath.point.distance)(e,t);return{left:Math.floor(Math.min(e.x-n,t.x)),top:Math.floor(Math.min(e.y-n,t.y)),width:2*n,height:2*n}}function be(e){var t=e.detail.handles,n=e.detail.image,o=n.width,a=n.height,i=ye(t.start,t.end),r=i.width+i.left,s=i.left,l=i.top+i.height,c=i.top;return s=Math.floor(s),c=Math.floor(c),r=Math.floor(r),l=Math.floor(l),r=Math.min(o,r),s=Math.max(0,s),l=Math.min(a,l),[[s,c=Math.max(0,c)],[r,l]]}function xe(e,t){var n=1/0,o=0,a=1/0,i=0,r=t.width,s=t.height;return e.forEach((function(e){n=Math.min(e[0],n),o=Math.max(e[0],o),a=Math.min(e[1],a),i=Math.max(e[1],i)})),n=Math.floor(n),a=Math.floor(a),o=Math.floor(o),i=Math.floor(i),o=Math.min(r,o),n=Math.max(0,n),i=Math.min(s,i),a=Math.max(0,a),[[n,a],[o,i]]}function we(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=Math.floor(o),r=Math.floor(a);if(1===e)return[[i,r]];for(var s=[],l=0,c=-e;c<=e;c++){var u=r+c;if(!(u>t||u<0))for(var d=-e;d<=e;d++){var h=i+d;h>=n||h<0||d*d+c*c<e*e&&(s[l++]=[i+d,r+c])}}return s}var Te=1/Math.sqrt(2),Ie={up:{x:0,y:1},upRight:{x:Te,y:Te},right:{x:1,y:0},downRight:{x:Te,y:-Te},down:{x:0,y:1},downLeft:{x:-Te,y:-Te},left:{x:-1,y:0},upLeft:{x:-Te,y:Te}},Ee=function(e,t){for(var n={x:e.x,y:e.y},o=[];t.x!==n.x||t.y!==n.y;)t.x===n.x?t.y>n.y?n.y++:n.y--:t.y===n.y?t.x>n.x?n.x++:n.x--:t.y>n.y?t.x>n.x?Se(n,t):Ce(n,t):t.x>n.x?Ae(n,t):Me(n,t),o.push({x:n.x,y:n.y});return o.pop(),o};function Se(e,t){var n=De(e,t);switch(Le([Pe(n,Ie.up),Pe(n,Ie.right),Pe(n,Ie.upRight)])){case 0:e.y++;break;case 1:e.x++;break;case 2:e.y++,e.x++}}function Ce(e,t){var n=De(e,t);switch(Le([Pe(n,Ie.up),Pe(n,Ie.left),Pe(n,Ie.upLeft)])){case 0:e.y++;break;case 1:e.x--;break;case 2:e.y++,e.x--}}function Ae(e,t){var n=De(e,t);switch(Le([Pe(n,Ie.down),Pe(n,Ie.right),Pe(n,Ie.downRight)])){case 0:e.y--;break;case 1:e.x++;break;case 2:e.y--,e.x++}}function Me(e,t){var n=De(e,t);switch(Le([Pe(n,Ie.down),Pe(n,Ie.left),Pe(n,Ie.downLeft)])){case 0:e.y--;break;case 1:e.x--;break;case 2:e.y--,e.x--}}function De(e,t){var n=y.cornerstoneMath.point.distance(e,t);return{x:(t.x-e.x)/n,y:(t.y-e.y)/n}}function Pe(e,t){return e.x*t.x+e.y*t.y}function Le(e){var t=e[0]>e[1]?0:1;return e[2]>e[t]&&(t=2),t}function ke(e,t){var n=xt("segmentation").getters;t=void 0===t?n.activeLabelmapIndex(e):t,y.cornerstone.triggerEvent(e,w.LABELMAP_MODIFIED,{labelmapIndex:t})}function Oe(e,t){for(var n=[],o=0;o<e.length;o++)e[o]!==t[o]&&n.push([o,e[o],t[o]]);return n}var Re=E.UINT_16_ARRAY,Ne=E.FLOAT_32_ARRAY;function _e(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=xt("segmentation").configuration,l=H.series[e];l||(H.series[e]={activeLabelmapIndex:n,labelmaps3D:[]},l=H.series[e]),l.labelmaps3D[n]={buffer:t,labelmaps2D:[],metadata:o,activeSegmentIndex:1,colorLUTIndex:r,segmentsHidden:[],undo:[],redo:[]};for(var c=l.labelmaps3D[n].labelmaps2D,u=t.byteLength/a,d=0;d<a;d++){var h=void 0;switch(s.arrayType){case Re:h=new Uint16Array(t,u*d,u/2);break;case Ne:h=new Float32Array(t,u*d,u/4);break;default:throw new Error("Unsupported Array Type ".concat(s.arrayType))}var m=i?i[d]:$(h);m&&m.some((function(e){return e}))&&(c[d]={pixelData:h,segmentsOnLabelmap:m})}}var Ue=B("store:modules:segmentationModule:getLabelmapStats");function Be(e,t,n){var o=e.length,a=t[n].imagePositionPatient;if(0===n)return Ve(a,t[n+1].imagePositionPatient);if(n===o-1)return Ve(a,t[n-1].imagePositionPatient);var i=t[n-1].imagePositionPatient,r=t[n+1].imagePositionPatient;return(Ve(a,i)+Ve(a,r))/2}function Ve(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}var Fe=E.UINT_16_ARRAY,He=E.FLOAT_32_ARRAY;function je(e,t,n,o,a){var i,r=xt("segmentation").configuration,s=o*a,l=s*n;switch(r.arrayType){case Fe:i=new Uint16Array(e.labelmaps3D[t].buffer,2*l,s);break;case He:i=new Float32Array(e.labelmaps3D[t].buffer,4*l,s);break;default:throw new Error("Unsupported Array Type ".concat(r.arrayType))}e.labelmaps3D[t].labelmaps2D[n]={pixelData:i,segmentsOnLabelmap:[]}}var ze=E.UINT_16_ARRAY,qe=E.FLOAT_32_ARRAY,We=B("store:modules:segmentationModule:getLabelmap2D");function Ge(e,t,n){var o=e.x,a=e.y;return o<n&&o>=0&&a<t&&a>=0}var Ye=B("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent"),Ze=B("store:modules:segmentationModule:setColorLUT");function Ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=xt("segmentation").configuration.segmentsPerLabelmap;t?(Je(t,n),t.length<n&&(t=[].concat(Q()(t),Q()(Qe(n-t.length))))):t=t||Qe(n),t.unshift([0,0,0,0]),H.colorLutTables[e]=t}function Xe(e){return"number"==typeof e?H.colorLutTables[e]:H.colorLutTables[e.colorLUTIndex]}function Je(e,t){e.length<t?Ze.warn("The provided colorLUT only provides ".concat(e.length," labels, whereas segmentsPerLabelmap is set to ").concat(t,". Autogenerating the rest.")):e.length>t&&Ze.warn("segmentsPerLabelmap is set to ".concat(t,", and the provided colorLUT provides ").concat(e.length,". Using the first ").concat(t," colors from the LUT."))}function Qe(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,t=[],n=0;n<e;n++)t.push(ot(et(),nt()));return t}var $e=222.5;function et(){return($e+=137.5)>=360&&($e-=360),$e}var tt=.6;function nt(){return(tt+=.07)>.82&&(tt=tt-.82+.3),tt}function ot(e){var t,n,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=(1-Math.abs(2*i-1))*a,l=s*(1-Math.abs(e/60%2-1)),c=i-s/2;return e<60?(t=s,n=l,o=0):e<120?(t=l,n=s,o=0):e<180?(t=0,n=s,o=l):e<240?(t=0,n=l,o=s):e<300?(t=l,n=0,o=s):e<360&&(t=s,n=0,o=l),[255*(t+c),255*(n+c),255*(o+c),r]}var at=B("store:modules:segmentationModule:getBrushColor"),it={renderOutline:!0,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:E.UINT_16_ARRAY},rt=B("util:segmentation:labelmap3DHistory");function st(e,t,n){var o=e.labelmaps2D;t.forEach((function(e){for(var t=e.imageIdIndex,a=e.diff,i=o[t].pixelData,r=0;r<a.length;r++){var s=a[r];i[s[0]]=s[n]}}))}var lt={state:H,configuration:it,onRegisterCallback:function(){Ke(0)},getters:{metadata:function(e,t,n){var o=I(e);if(o){var a=k(o,"stack").data[0].imageIds[0],i=H.series[a];if(i){if(t=void 0===t?i.activeLabelmapIndex:t,i.labelmaps3D[t]){var r=i.labelmaps3D[t];return void 0===n?r.metadata:r.metadata[n]}j.warn("No labelmap3D of labelmap index ".concat(t," on stack."))}else j.warn("brushStackState is undefined")}},labelmap3D:Y,labelmaps3D:G,activeLabelmapIndex:function(e){var t=I(e);if(t){var n=k(t,"stack").data[0].imageIds[0],o=H.series[n];if(o)return o.activeLabelmapIndex}},activeSegmentIndex:function(e,t){var n=I(e);if(n){var o=k(n,"stack").data[0].imageIds[0],a=H.series[o];if(a){t=void 0===t?a.activeLabelmapIndex:t;var i=a.labelmaps3D[t];if(i)return i.activeSegmentIndex}return 1}},isSegmentVisible:function(e,t,n){if(t){var o=I(e);if(o){var a=k(o,"stack").data[0].imageIds[0],i=H.series[a];if(i){if(n=void 0===n?i.activeLabelmapIndex:n,i.labelmaps3D[n])return!i.labelmaps3D[n].segmentsHidden[t];q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},labelmap2D:function(e){var t=I(e);if(t){var n=y.cornerstone,o=k(t,"stack");if(o){var a,i=o.data[0],r=n.getEnabledElement(t),s=i.currentImageIdIndex,l=r.image,c=l.rows,u=l.columns,d=i.imageIds.length,h=i.imageIds[0],m=H.series[h];m?(a=m.activeLabelmapIndex,m.labelmaps3D[a]||A(m,a,c*u*d),m.labelmaps3D[a].labelmaps2D[s]||je(m,a,s,c,u)):(a=0,H.series[h]={activeLabelmapIndex:a,labelmaps3D:[]},A(m=H.series[h],a,c*u*d),je(m,a,s,c,u));var f=m.labelmaps3D[a];return{labelmap2D:f.labelmaps2D[s],labelmap3D:f,currentImageIdIndex:s,activeLabelmapIndex:a}}We.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmap2DByImageIdIndex:function(e,t,n,o){if(!e.labelmaps2D[t]){var a,i=xt("segmentation").configuration,r=n*o,s=r*t;switch(i.arrayType){case ze:a=new Uint16Array(e.buffer,2*s,r);break;case qe:a=new Float32Array(e.buffer,4*s,r);break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}e.labelmaps2D[t]={pixelData:a,segmentsOnLabelmap:$(a)}}return e.labelmaps2D[t]},labelmapStats:function(e,t,n){var o=y.cornerstone,a=I(e);if(!a)return null;var i=k(a,"stack").data[0].imageIds,r=i[0];return new Promise((function(e){var a=H.series[r];a||e(null);var s=function(e){for(var t=[],n=y.cornerstone.metaData,o=!0,a=0;a<e.length;a++){var i=n.get("imagePlaneModule",e[a]);if(!i){o=!1;break}t.push(i)}return{sufficientMetadata:o,imagePlanes:t}}(i),l=s.sufficientMetadata,c=s.imagePlanes;l||(Ue.warn("Insufficient imagePlaneModule information to calculate volume statistics."),e(null)),n=void 0===n?a.activeLabelmapIndex:n;for(var u=a.labelmaps3D[n],d=[],h=0;h<i.length;h++)d.push(o.loadAndCacheImage(i[h]));Promise.all(d).then((function(n){var o=function(e,t,n,o){for(var a=function(e,t,n,o){for(var a=t[0],i=a.rowPixelSpacing,r=a.columnPixelSpacing,s=e.labelmaps2D,l=[],c=0;c<s.length;c++){var u=s[c];if(u&&u.segmentsOnLabelmap.includes(o)){for(var d=Be(t,n,c)*i*r,h=u.pixelData,m=t[c].getPixelData(),f=[],g=0;g<h.length;g++)h[g]===o&&f.push(m[g]);l.push({voxelInMM3:d,values:f})}}return l}(e,t,n,o),i=0,r=a[0].values[0],s=r,l=0,c=0;c<a.length;c++){var u=a[c],d=u.values,h=u.voxelInMM3;l+=h*d.length;var m=0;d.forEach((function(e){e>r?r=e:e<s&&(s=e),m+=e})),i+=m*h}i/=l;for(var f=0,g=0;g<a.length;g++){var p=a[g],v=(d=p.values,h=p.voxelInMM3,0);d.forEach((function(e){v+=Math.pow(e-i,2)})),f+=v*h}return f/=l,f=Math.sqrt(f),{volume:l,mean:i,stdDev:f,max:r,min:s}}(u,n,c,t);e(o)}))}))},segmentOfActiveLabelmapAtEvent:function(e){var t=e.detail,n=t.element,o=t.image,a=t.currentPoints;if(a){var i=o.width,r=o.height;if(n){var s=k(n,"stack").data[0],l=s.currentImageIdIndex,c=s.imageIds[0],u=H.series[c],d=u.activeLabelmapIndex,h=u.labelmaps3D[d];if(h){var m=h.labelmaps2D[l];if(m){var f=m.pixelData,g=a.image,p=g.x,v=g.y;if(Ge({x:p=Math.floor(p),y:v=Math.floor(v)},r,i)){var y=f[v*i+p];if(0===y)return;return{segmentIndex:y,metadata:h.metadata[y]}}}}}}else Ye.warn("Not a cornerstone input event.")},brushColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=I(e);if(n){var o=k(n,"stack");if(o){var a,i=o.data[0].imageIds[0],r=H.series[i];if(r){var s=r.activeLabelmapIndex,l=r.labelmaps3D[s],c=l.activeSegmentIndex;a=H.colorLutTables[l.colorLUTIndex][c]}else a=H.colorLutTables[0][1];return t?"rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 1.0 )"):"rgba(".concat(a[0],", ").concat(a[1],", ").concat(a[2],", 0.8 )")}at.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmapBuffers:X,activeLabelmapBuffer:function(e){var t=I(e);if(t){var n=k(t,"stack").data[0].imageIds[0],o=H.series[n];if(o)return X(t,o.activeLabelmapIndex)}},colorLUT:Xe,colorForSegmentIndexColorLUT:function(e,t){return Xe(e)[t]}},setters:{metadata:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,a=I(e);if(a){var i=y.cornerstone,r=k(a,"stack").data[0],s=r.imageIds[0],l=H.series[s];if(l||(H.series[s]={labelmapIndex:t,labelmaps3D:[]},l=H.series[s]),!l.labelmaps3D[t]){var c=i.getEnabledElement(a).image;A(l,t,c.rows*c.columns*r.imageIds.length)}l.labelmaps3D[t].metadata[n]=o}},labelmap3DForElement:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=I(e);if(r){var s=k(r,"stack"),l=s.data[0].imageIds.length;_e(s.data[0].imageIds[0],t,n,o,l,a,i),ke(r,n)}},labelmap3DByFirstImageId:_e,incrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"increase")},decrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"decrease")},activeSegmentIndex:function(e,t){var n=I(e);if(n){var o=k(n,"stack").data[0].imageIds[0],a=H.series[o];if(a){var i=a.activeLabelmapIndex,r=a.labelmaps3D[i],s=xt("segmentation").configuration;t<=0?t=1:t>s.segmentsPerLabelmap&&(t=s.segmentsPerLabelmap),r.activeSegmentIndex=t}}},toggleSegmentVisibility:function(e,t,n){if(t){var o=I(e);if(o){var a=k(o,"stack").data[0].imageIds[0],i=H.series[a];if(i){if(n=void 0===n?i.activeLabelmapIndex:n,i.labelmaps3D[n]){var r=i.labelmaps3D[n].segmentsHidden;return r[t]=!r[t],!r[t]}q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},updateSegmentsOnLabelmap2D:function(e){e.segmentsOnLabelmap=$(e.pixelData)},deleteSegment:function(e,t,n){if(t){var o=I(e);if(o){var a=k(o,"stack").data[0].imageIds[0],i=H.series[a];if(i){n=void 0===n?i.activeLabelmapIndex:n;var r=i.labelmaps3D[n];if(r){delete r.metadata[t];for(var s=r.labelmaps2D,l=0;l<s.length;l++){var c=s[l];if(c&&c.segmentsOnLabelmap.includes(t)){var u=c.pixelData,d=c.segmentsOnLabelmap.indexOf(t);c.segmentsOnLabelmap.splice(d,1);for(var h=0;h<u.length;h++)u[h]===t&&(u[h]=0)}}y.cornerstone.updateImage(o)}}}}},colorLUT:Ke,colorLUTIndexForLabelmap3D:function(e,t){e.colorLUTIndex=t},colorForSegmentIndexOfColorLUT:function(e,t,n){Xe(e)[t]=n},activeLabelmapIndex:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=I(e);if(n){var o=y.cornerstone,a=k(n,"stack").data[0],i=o.getEnabledElement(n).image,r=i.rows*i.columns*a.imageIds.length,s=a.imageIds[0],l=H.series[s];l?(l.activeLabelmapIndex=t,l.labelmaps3D[t]||A(l,t,r)):(H.series[s]={activeLabelmapIndex:t,labelmaps3D:[]},A(l=H.series[s],t,r)),o.updateImage(n)}},radius:function(e){var t=xt("segmentation").configuration;t.radius=Math.min(Math.max(e,t.minRadius),t.maxRadius)},pushState:function(e,t,n){var o=Y(e,n);o.undo.push(t),o.redo=[]},undo:function(e,t){var n=Y(e,t),o=n.undo,a=n.redo;if(o.length){var i=o.pop();st(n,i,1),a.push(i),y.cornerstone.updateImage(e)}else rt.warn("No undos left.")},redo:function(e,t){var n=Y(e,t),o=n.undo,a=n.redo;if(a.length){var i=a.pop();st(n,i,2),o.push(i),y.cornerstone.updateImage(e)}else rt.warn("No redos left.")}}},ct={activeManipulators:{}};function ut(e){var t=y.cornerstone.getEnabledElement(e).uuid;delete ct.activeManipulators[t]}function dt(e){var t=ct.activeManipulators,n=t[e];"function"==typeof n&&n(),delete t[e]}function ht(e){ut(e.detail.element)}var mt={setters:{addActiveManipulatorForElement:function(e,t){var n=y.cornerstone.getEnabledElement(e).uuid;ct.activeManipulators[n]=t},removeActiveManipulatorForElement:ut,cancelActiveManipulatorsForElement:function(e){dt(y.cornerstone.getEnabledElement(e).uuid)},cancelActiveManipulators:function(){var e=ct.activeManipulators;Object.keys(e).forEach((function(e){return dt(e)}))}},state:ct,enabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ht),e.addEventListener(t,ht)},removeEnabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ht),ut(e)}},ft={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  '},gt={configuration:ft,getters:{defaultOptions:function(){return ft}},setters:{defaultOptions:function(e){Object.assign(ft,e)}}},pt={configuration:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]}},vt=(B("store:modules:storeLogger"),{globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,preventTextBoxOutsideDisplayedArea:!1,handleTouchOffset:{x:0,y:-57},svgCursorUrl:null}),yt={mouseTools:function(){return vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Mouse")}))},touchTools:function(){return vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Touch")}))},enabledElementByUID:function(e){return vt.enabledElements.find((function(t){return y.cornerstone.getEnabledElement(t).uuid===e}))}},bt={segmentation:lt,cursor:gt,globalConfiguration:pt,manipulatorState:mt};function xt(e){return bt[e]}var wt={modules:bt,state:vt,getters:yt},Tt=function(e,t){return vt.tools.find((function(n){return n.element===e&&n.name===t}))},It=bt.globalConfiguration;function Et(e,t){if(It.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),o=t.mousePoint,a=window.URL.createObjectURL(n);e.style.cursor="url('".concat(a,"') ").concat(o,", auto"),vt.svgCursorUrl=a}}function St(e){It.configuration.showSVGCursors&&Ct(e,"none")}function Ct(e,t){vt.svgCursorUrl&&window.URL.revokeObjectURL(vt.svgCursorUrl),vt.svgCursorUrl=null,e.style.cursor=t}var At=xt("globalConfiguration"),Mt=B("store:setToolMode"),Dt=function(e,t,n,o){void 0===o&&Array.isArray(n)&&(o=n,n=null);var a=Tt(e,t);a&&(function(e,t,n,o){t.supportedInteractionTypes.forEach((function(a){if(void 0===o||o.includes(a)){var i=Ht[a];i?i(t,e,n):Mt.warn("Unable to resolve input conflicts for type %s",a)}})),wt.state.tools.filter((function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0})).forEach((function(t){var n=!1;t.supportedInteractionTypes.forEach((function(e){t.options["is".concat(e,"Active")]&&(n=!0)})),n||(Mt.log("Setting tool %s's to PASSIVE",t.name),Nt(e,t.name))}))}(e,a,n,o),a.supportedInteractionTypes.forEach((function(e){void 0===o||o.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),At.configuration.showSVGCursors&&a.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){("number"==typeof t?[t]:t.mouseButtonMask).includes(1)&&(n.svgCursor?Et(n.element,n.svgCursor):n.hideDefaultCursor?St(e):function(e){Ct(e,"initial")}(e))}(e,n,a)),Ut("active",null,e,t,n)},Pt=function(e,t,n){Ft("active",e,t,n),wt.state.enabledElements.forEach((function(o){Dt(o,e,t,n)}))},Lt=Ut.bind(null,"disabled",null),kt=Bt.bind(null,"disabled",null),Ot=Ut.bind(null,"enabled",null),Rt=Bt.bind(null,"enabled",null),Nt=Ut.bind(null,"passive",w.TOOL_DEACTIVATED),_t=Bt.bind(null,"passive",w.TOOL_DEACTIVATED);function Ut(e,t,n,o,a){var i,r,s=Tt(n,o);s?(a=jt(a),Array.isArray(a.mouseButtonMask)&&0!==a.mouseButtonMask.length&&Array.isArray(s.options.mouseButtonMask)&&(a.mouseButtonMask=(i=a.mouseButtonMask,r=s.options.mouseButtonMask,i.concat(r).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]))),s.mode=e,s.mergeOptions(a),s["".concat(e,"Callback")]&&s["".concat(e,"Callback")](n,a),t&&T(n,t,{options:a,toolName:o,toolType:o,type:t})):Mt.warn('Unable to find tool "%s" for enabledElement',o)}function Bt(e,t,n,o){Ft(e,n,o),wt.state.enabledElements.forEach((function(a){Ut(e,t,a,n,o)}))}function Vt(e,t,n){var o="is".concat(e,"Active"),a=wt.state.tools.find((function(e){return e.element===n&&"active"===e.mode&&!0===e.options[o]}));a&&(Mt.log("Setting tool %s's %s to false",a.name,o),a.options[o]=!1)}function Ft(e,t,n,o){if(At.configuration.globalToolSyncEnabled){var a={mode:e,args:[t,n]};o&&a.push(o),wt.state.globalToolChangeHistory.push(a),wt.state.globalToolChangeHistory.length>50&&wt.state.globalToolChangeHistory.shift();var i=wt.state.globalTools[t];if(i)if("active"===e){var r=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var o=[],a=wt.state.globalTools[e];if(a){var i=new a.tool(a.props);i.supportedInteractionTypes.forEach((function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var a=jt(t).mouseButtonMask;Array.isArray(a)&&a.length>0?a.forEach((function(t){return o.push("".concat(e,"-").concat(t))})):Array.isArray(a)&&0===a.length&&o.push("".concat(e,"-DELETE"))}else"MultiTouch"===e?o.push("".concat(e,"-").concat(i.configuration.touchPointers)):o.push(e)}))}return o}(t,n,o);Object.keys(wt.state.globalTools).forEach((function(e){var t=wt.state.globalTools[e];t.activeBindings=t.activeBindings.filter((function(e){return!r.includes(e)}))})),r.some((function(e){return e.includes("Mouse-DELETE")}))&&(i.activeBindings=i.activeBindings.filter((function(e){return!e.includes("Mouse")})),r=r.filter((function(e){return!e.includes("Mouse")}))),i.activeBindings=i.activeBindings.concat(r)}else i.activeBindings=[];else Mt.warn("setToolMode call for tool not available globally: ".concat(t))}}var Ht={Mouse:function(e,t,n){var o=jt(n).mouseButtonMask;if(Array.isArray(o)&&o.length>0){var a=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some((function(e){return o.includes(e)}))}));a&&(a.options.mouseButtonMask=a.options.mouseButtonMask.filter((function(e){return!o.includes(e)})),0===a.options.mouseButtonMask.length&&(a.options.isMouseActive=!1))}},MouseWheel:Vt.bind(void 0,"MouseWheel"),Touch:function(e,t){var n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),o=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers}));n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1),o&&(Mt.log("Setting tool %s's isTouchActive to false",o.name),o.options.isMultiTouchActive=!1)},TouchPinch:Vt.bind(void 0,"TouchPinch"),TouchRotate:Vt.bind(void 0,"TouchRotate"),DoubleTap:Vt.bind(void 0,"DoubleTap"),MultiTouch:function(e,t){var n,o=wt.state.tools.find((function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers}));1===e.configuration.touchPointers&&(n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}))),o&&(Mt.log("Setting tool %s's isMultiTouchActive to false",o.name),o.options.isMultiTouchActive=!1),n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1)}};function jt(e){return Array.isArray(e)?e={mouseButtonMask:e}:e!==Object(e)&&(e={mouseButtonMask:[e]}),e.hasOwnProperty("mouseButtonMask")||(e.mouseButtonMask=[]),Array.isArray(e.mouseButtonMask)||(e.mouseButtonMask=[e.mouseButtonMask]),e.mouseButtonMask=e.mouseButtonMask.filter((function(e){return"number"==typeof e&&0!==e})),e}var zt={passiveCallback:function(e){Lt(e,this.name)},enabledCallback:function(e){Dt(e,this.name)}},qt={passiveCallback:function(e){Lt(e,this.name)},activeCallback:function(e){Ot(e,this.name)}},Wt=function(e,t){e.save(),t(e),e.restore()},Gt=1,Yt=2,Zt={setToolWidth:function(e){Gt=e},getToolWidth:function(){return Gt},setActiveWidth:function(e){Yt=e},getActiveWidth:function(){return Yt}},Kt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=t.color,a=t.lineWidth,i=t.fillStyle,r=t.lineDash,s=t.shouldDrawLines,l=void 0===s||s;e.beginPath(),e.strokeStyle=o||e.strokeStyle,e.lineWidth=a||void 0===a&&Zt.getToolWidth()||e.lineWidth,r&&e.setLineDash(r),n(e),i&&(e.fillStyle=i,e.fill()),l&&e.stroke(),r&&e.setLineDash([])};function Xt(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Kt(e,a,(function(e){"pixel"===i&&(n=y.cornerstone.pixelToCanvas(t,n),o=y.cornerstone.pixelToCanvas(t,o)),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y)}))}var Jt=function(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Kt(e,a,(function(e){"pixel"===i&&(n=y.cornerstone.pixelToCanvas(t,n),o=o.map((function(e){return y.cornerstone.pixelToCanvas(t,e)}))),e.moveTo(n.x,n.y),o.forEach((function(t){var n=t.x,o=t.y;e.lineTo(n,o)}))}))},Qt=function(e,t,n,o,a,i){var r=Math.atan2(n.y-t.y,n.x-t.x),s={color:o,lineWidth:a};i&&(s.lineDash=i),Xt(e,void 0,t,n,s,"canvas"),s={color:o,lineWidth:a,fillStyle:o};var l=[{x:n.x-10*Math.cos(r-Math.PI/7),y:n.y-10*Math.sin(r-Math.PI/7)},{x:n.x-10*Math.cos(r+Math.PI/7),y:n.y-10*Math.sin(r+Math.PI/7)},n];Jt(e,void 0,n,l,s,"canvas")},$t=function(e,t,n,o,a){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n)),Kt(e,a,(function(e){e.arc(n.x,n.y,o,0,2*Math.PI)}))};function en(e){var t=y.cornerstoneMath;if(e instanceof t.Vector3)return e;var n=Object.keys(e);return n.includes("x")&&n.includes("y")&&n.includes("z")?new t.Vector3(e.x,e.y,e.z):new t.Vector3(e[0],e[1],e[2])}function tn(e,t){var n=en(t.rowCosines),o=en(t.columnCosines),a=en(t.imagePositionPatient),i=e.clone().sub(a);return{x:n.dot(i)/t.columnPixelSpacing,y:o.dot(i)/t.rowPixelSpacing}}function nn(e,t){var n=en(t.rowCosines),o=en(t.columnCosines),a=en(t.imagePositionPatient),i=n.clone().multiplyScalar(e.x);i.multiplyScalar(t.columnPixelSpacing);var r=o.clone().multiplyScalar(e.y);r.multiplyScalar(t.rowPixelSpacing);var s=i.add(r);return s.add(a),s}function on(e,t){var n=en(e.rowCosines),o=en(e.columnCosines),a=en(e.imagePositionPatient),i=en(t.rowCosines),r=en(t.columnCosines),s=en(t.imagePositionPatient),l=n.clone().cross(o),c=new y.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,a);var u=i.clone().cross(r),d=new y.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var h=d.clone().intersectPlane(c),m=h.origin,f=h.direction,g=nn({x:t.columns,y:t.rows},t),p=s.distanceTo(g),v=new y.cornerstoneMath.Line3;v.start=m,v.end=m.clone().add(f.multiplyScalar(p));var b=function(e,t){var n=[];return Object.keys(t).forEach((function(o){var a=t[o],i=e.intersectLine(a);i&&n.push(i)})),n}(v,function(e){var t=nn({x:0,y:0},e),n=nn({x:e.columns,y:0},e),o=nn({x:0,y:e.rows},e),a=nn({x:e.columns,y:e.rows},e);return{top:new y.cornerstoneMath.Line3(t,n),left:new y.cornerstoneMath.Line3(t,o),right:new y.cornerstoneMath.Line3(n,a),bottom:new y.cornerstoneMath.Line3(o,a)}}(t));if(2===b.length)return{start:b[0],end:b[1]}}function an(e,t,n){var o=n*(Math.PI/180);return{x:Math.cos(o)*(e.x-t.x)-Math.sin(o)*(e.y-t.y)+t.x,y:Math.sin(o)*(e.x-t.x)+Math.cos(o)*(e.y-t.y)+t.y}}var rn=function(e,t,n,o,a){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n),o=y.cornerstone.pixelToCanvas(t,o));var r=y.cornerstone.getViewport(t),s=t.clientWidth,l=t.clientHeight,c=r.scale,u=r.translation,d=r.rotation-i,h={x:s/2+u.x*c,y:l/2+u.y*c};Math.abs(d)>.05&&(n=an(n,h,-d),o=an(o,h,-d));var m=Math.abs(n.x-o.x),f=Math.abs(n.y-o.y),g=Math.min(n.x,o.x),p=Math.min(n.y,o.y),v={x:g+m/2,y:p+f/2};Math.abs(d)>.05&&(v=an(v,h,d));var b=d*Math.PI/180;Kt(e,a,(function(e){e.ellipse(v.x,v.y,m/2,f/2,b,0,2*Math.PI),e.closePath()}))},sn="white",ln="greenyellow",cn="transparent",un={setFillColor:function(e){cn=e},getFillColor:function(){return cn},setToolColor:function(e){sn=e},getToolColor:function(){return sn},setActiveColor:function(e){ln=e},getActiveColor:function(){return ln},getColorIfActive:function(e){return e.color?e.color:e.active?ln:sn}},dn=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=t.element,i=un.getToolColor();e.strokeStyle=o.color||i;for(var r=Object.keys(n),s=function(t){var i=r[t],s=n[i];if(!0===s.drawnIndependently)return"continue";if(!0===o.drawHandlesIfActive&&!s.active)return"continue";if(o.hideHandlesIfMoving&&s.moving)return"continue";var l={lineWidth:s.active?Zt.getActiveWidth():Zt.getToolWidth(),fillStyle:o.fill};o.lineDash&&(l.lineDash=o.lineDash),Kt(e,l,(function(e){var t=y.cornerstone.pixelToCanvas(a,s),n=s.radius||o.handleRadius||vt.handleRadius;e.arc(t.x,t.y,n,0,2*Math.PI)}))},l=0;l<r.length;l++)s(l)},hn=function(e,t,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";Kt(e,o,(function(e){n.forEach((function(n){var o=n.start,i=n.end;if("pixel"===a){var r=y.cornerstone;o=r.pixelToCanvas(t,o),i=r.pixelToCanvas(t,i)}e.moveTo(o.x,o.y),e.lineTo(i.x,i.y)}))}))},mn=function(e,t,n,o,a,i){var r=e.length>0?y.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Xt(o,void 0,r,y.cornerstoneMath.point.findClosestPoint(s,r),{color:a,lineWidth:i,lineDash:[2,3]},"canvas")},fn={fontSize:15,fontFamily:"Arial",backgroundColor:"transparent"};function gn(e){if("string"!=typeof e)throw new Error("Font family must be a valid string");fn.fontFamily=e}function pn(e){if("number"!=typeof e||isNaN(e)||!isFinite(e))throw new Error("Font size must be a valid number");fn.fontSize=parseFloat(e)}var vn={setFont:function(e){var t=e.split("px ");2===t.length&&(pn(parseFloat(t[0])),gn(t[1]))},getFont:function(){return"".concat(fn.fontSize,"px ").concat(fn.fontFamily)},setFontSize:pn,getFontSize:function(){return fn.fontSize},setFontFamily:gn,getFontFamily:function(){return fn.fontFamily},setBackgroundColor:function(e){fn.backgroundColor=e},getBackgroundColor:function(){return fn.backgroundColor}},yn=function(e,t,n,o,a){var i=vn.getFontSize();e.font=vn.getFont(),e.textBaseline="top",e.fillStyle=o,n.forEach((function(n,o){e.fillText(n,t.left+a,t.top+a+o*(i+a))}))},bn=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)};function xn(e,t,n){var o=vn.getFont(),a=e.font;o&&o!==a&&(e.font=o);var i=e.measureText(t).width;return o&&o!==a&&(e.font=a),i+2*n}var wn=function(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var r=5,s=vn.getFontSize(),l=vn.getBackgroundColor(),c=0;t.forEach((function(t){var n=xn(e,t,r);c=Math.max(c,n)}));var u={width:c,height:r+t.length*(s+r)};return Wt(e,(function(e){e.strokeStyle=a,i.centering&&(!0===i.centering.x&&(n-=u.width/2),!0===i.centering.y&&(o-=u.height/2)),u.left=n,u.top=o,"function"==typeof i.displacer&&i.displacer(u),bn(e,u,l),yn(e,u,t,a,r)})),u};function Tn(e,t,n){return Math.min(Math.max(t,e),n)}function In(e,t){var n=t.left||0,o=t.top||0;e.x=Tn(e.x,n,n+t.width),e.y=Tn(e.y,o,o+t.height)}var En=function(e,t,n,o,a,i){i-a<o-n?(e[t]+=a-n,e[t]+=(i-a)/2,e[t]-=(o-n)/2):n<a?e[t]+=a-n:o>i&&(e[t]-=o-i)};function Sn(e,t){var n=y.cornerstone,o=n.pixelToCanvas,a=n.canvasToPixel,i=n.getViewport,r=n.getEnabledElement,s=n.getDisplayedArea,l=a(e,{x:t.left,y:t.top}),c=function(e,t){var n=function(t){return y.cornerstone.canvasToPixel(e,t)},o=t.top,a=t.left,i=t.width,r=t.height,s=[n({x:a,y:o}),n({x:a+i,y:o}),n({x:a,y:o+r}),n({x:a+i,y:o+r})],l=s.map((function(e){return e.x})),c=s.map((function(e){return e.y}));return{minX:Math.min.apply(Math,Q()(l)),minY:Math.min.apply(Math,Q()(c)),maxX:Math.max.apply(Math,Q()(l)),maxY:Math.max.apply(Math,Q()(c))}}(e,t),u=c.minX,d=c.minY,h=c.maxX,m=c.maxY,f=i(e),g=s(r(e).image,f),p=f.displayedArea?f.displayedArea:g,v=p.tlhc,b=p.brhc,x=v.y-1,w=v.x-1,T=b.y,I=b.x;En(l,"y",d,m,x,T),En(l,"x",u,h,w,I);var E=o(e,l);t.top=E.y,t.left=E.x}var Cn=Tn,An=function(e,t,n,o,a,i,r,s,l,c){var u=y.cornerstone.pixelToCanvas,d=u(t,n);l&&(d.x+=l);var h={centering:{x:!1,y:c}};if(vt.preventTextBoxOutsideDisplayedArea&&(h.displacer=function(e){return Sn(t,e)}),n.boundingBox=wn(e,o,d.x,d.y,r,h),n.hasMoved){var m=i(a).map((function(e){return u(t,e)}));mn(m,d,n.boundingBox,e,r,s)}},Mn=function(e,t,n,o,a){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var r=y.cornerstone;n=r.pixelToCanvas(t,n),o=r.pixelToCanvas(t,o)}var s=y.cornerstone.getViewport(t),l=t.clientWidth,c=t.clientHeight,u=s.scale,d=s.translation,h=s.rotation-i,m={x:l/2+d.x*u,y:c/2+d.y*u};Math.abs(h)>.05&&(n=an(n,m,-h),o=an(o,m,-h));var f=Math.abs(n.x-o.x),g=Math.abs(n.y-o.y);n={x:Math.min(n.x,o.x),y:Math.min(n.y,o.y)},o={x:n.x+f,y:n.y+g};var p={x:n.x+f,y:n.y},v={x:n.x,y:n.y+g};Math.abs(h)>.05&&(n=an(n,m,h),o=an(o,m,h),p=an(p,m,h),v=an(v,m,h)),Kt(e,a,(function(e){e.moveTo(n.x,n.y),e.lineTo(p.x,p.y),e.lineTo(o.x,o.y),e.lineTo(v.x,v.y),e.lineTo(n.x,n.y)}))},Dn=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},Pn=function(e,t){return void 0===e?t:e},Ln=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Pn(t.shadowColor,"#000000"),e.shadowBlur=Pn(t.shadowBlur,0),e.shadowOffsetX=Pn(t.shadowOffsetX,1),e.shadowOffsetY=Pn(t.shadowOffsetY,1))},kn=function(e){return 0===Object.keys(e).length&&e.constructor===Object},On=xt("segmentation"),Rn=On.getters,Nn=On.setters;function _n(){this.handles={start:{},end:{}}}function Un(e){var t=e.detail.element,n=e.detail.currentPoints.image;return kn(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function Bn(e){var t=e.detail,n=t.element,o=t.currentPoints.image;this.handles.end=o,y.cornerstone.updateImage(n)}function Vn(e){e.detail.handles=this.handles;var t=e.detail.element,n=Rn.labelmap2D(t),o=n.labelmap2D,a=n.labelmap3D,i=n.currentImageIdIndex,r=o.pixelData,s=r.slice(),l={points:{start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},pixelData:r,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:i,diff:Oe(s,r)};Nn.pushState(this.element,[c]),Nn.updateSegmentsOnLabelmap2D(o),y.cornerstone.updateImage(t),this._resetHandles()}var Fn={postTouchStartCallback:Un,postMouseDownCallback:Un,mouseClickCallback:Un,touchDragCallback:Bn,mouseDragCallback:Bn,mouseMoveCallback:Bn,touchEndCallback:Vn,mouseUpCallback:Vn,initializeMixin:_n,renderToolData:function(e){var t=this,n=e.detail,o=n.element,a=Rn.brushColor(o,!0),i=Dn(n.canvasContext.canvas),r=y.cornerstoneMath.point.distance;Wt(i,(function(e){if(!t.handles)return null;var n=y.cornerstone.pixelToCanvas(o,t.handles.start),i=y.cornerstone.pixelToCanvas(o,t.handles.end),s=r(n,i);$t(e,o,t.handles.start,s,{color:a})}))},_resetHandles:_n,_applyStrategy:Vn},Hn=B("tools:ScissorsTool"),jn=xt("segmentation"),zn=jn.getters,qn=jn.setters;function Wn(e){var t=e.detail.element,n=e.detail.currentPoints.image,o=this.handles.points;if(!o.length)return Hn.warn("Something went wrong, empty handles detected."),null;o.push({x:n.x,y:n.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(t)}function Gn(e){var t=e.detail,n=e.detail.element;this._addPoint(t),y.cornerstone.updateImage(n)}function Yn(e){var t=this.handles.points,n=e.detail.element,o=zn.labelmap2D(n),a=o.labelmap2D,i=o.labelmap3D,r=o.currentImageIdIndex,s=a.pixelData,l=s.slice(),c={points:t,pixelData:s,segmentIndex:i.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"};this.applyActiveStrategy(e,c);var u={imageIdIndex:r,diff:Oe(l,s)};qn.pushState(this.element,[u]),qn.updateSegmentsOnLabelmap2D(a),y.cornerstone.updateImage(n),this._resetHandles()}function Zn(){this.handles={points:[]},this.currentHandle=0}var Kn={postTouchStartCallback:Wn,postMouseDownCallback:Wn,mouseClickCallback:Wn,touchDragCallback:Gn,mouseDragCallback:Gn,mouseMoveCallback:Gn,touchEndCallback:Yn,mouseUpCallback:Yn,initializeMixin:Zn,renderToolData:function(e){var t=e.detail,n=t.element,o=zn.brushColor(n,!0),a=Dn(t.canvasContext.canvas),i=this.handles.points;i.length<2||Wt(a,(function(e){for(var t=0;t<i.length;t++){var a=Q()(i[t].lines);t===i.length-1&&a.push(i[0]),Jt(e,n,i[t],a,{color:o})}}))},_resetHandles:Zn,_addPoint:function(e){var t=this.handles.points;t.length&&t[this.currentHandle-1].lines.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),t.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(e.element)},_applyStrategy:Yn},Xn=xt("segmentation").getters,Jn=Object.assign({},Kn,{renderToolData:function(e){var t=this,n=e.detail,o=n.element,a=Xn.brushColor(o,!0),i=Dn(n.canvasContext.canvas),r=this.handles;Wt(i,(function(e){if(r.points.length>1)for(var n=0;n<r.points.length;n++){var i=Q()(r.points[n].lines);Jt(e,o,t.handles.points[n],i,{color:a})}}))}}),Qn=xt("segmentation"),$n=Qn.getters,eo=Qn.setters;function to(e){var t=e.detail.element,n=e.detail.currentPoints.image;return kn(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function no(e){var t=e.detail,n=t.element,o=t.currentPoints.image;this.handles.end=o,y.cornerstone.updateImage(n)}function oo(e){e.detail.handles=this.handles;var t=e.detail.element,n=$n.labelmap2D(t),o=n.labelmap2D,a=n.labelmap3D,i=n.currentImageIdIndex,r=o.pixelData,s=r.slice(),l={points:[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],pixelData:r,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:i,diff:Oe(s,r)};eo.pushState(this.element,[c]),eo.updateSegmentsOnLabelmap2D(o),y.cornerstone.updateImage(t),this._resetHandles()}function ao(){this.handles={start:{},end:{}}}var io={activeOrDisabledBinaryTool:zt,enabledOrDisabledBinaryTool:qt,circleSegmentationMixin:Fn,polylineSegmentationMixin:Jn,freehandSegmentationMixin:Kn,rectangleSegmentationMixin:{postTouchStartCallback:to,postMouseDownCallback:to,mouseClickCallback:to,touchDragCallback:no,mouseDragCallback:no,mouseMoveCallback:no,touchEndCallback:oo,mouseUpCallback:oo,initializeMixin:ao,renderToolData:function(e){var t=this,n=e.detail,o=n.element,a=$n.brushColor(o,!0),i=Dn(n.canvasContext.canvas);Wt(i,(function(e){Mn(e,o,t.handles.start,t.handles.end,{color:a})}))},_resetHandles:ao,_applyStrategy:oo},renderBrushMixin:{renderBrush:function(e){var t,n=y.cornerstone,o=xt("segmentation"),a=o.getters,i=o.configuration,r=e.detail,s=r.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=wt.state.mousePositionImage,t){var l=r.image,c=l.rows,u=l.columns,d=t,h=d.x,m=d.y;if(!(h<0||h>u||m<0||m>c)){var f=i.radius,g=r.canvasContext,p=r.element,v=a.brushColor(p,this._drawing);g.setTransform(1,0,0,1,0,0);var b=f*s.scale,x=n.pixelToCanvas(p,t);g.beginPath(),g.strokeStyle=v,g.ellipse(x.x,x.y,b,b,0,0,2*Math.PI),g.stroke()}}}}},ro=function(e){return e&&"object"===x()(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},so=function(e,t){var n;return t&&!0===t.clone&&ro(e)?uo((n=e,Array.isArray(n)?[]:{}),e,t):e},lo=function(e,t,n){var o=e.slice();return t.forEach((function(t,a){void 0===o[a]?o[a]=so(t,n):ro(t)?o[a]=uo(e[a],t,n):-1===e.indexOf(t)&&o.push(so(t,n))})),o},co=function(e,t,n){var o={};return ro(e)&&Object.keys(e).forEach((function(t){o[t]=so(e[t],n)})),Object.keys(t).forEach((function(a){ro(t[a])&&e[a]?o[a]=uo(e[a],t[a],n):o[a]=so(t[a],n)})),o},uo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=Array.isArray(t),a=(n||{arrayMerge:lo}).arrayMerge||lo;if(o)return Array.isArray(e)?a(e,t,n):so(t,n);var i=co(e,t,n);return Object.getPrototypeOf(e)!==Object.prototype&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i},ho=uo,mo=B("tools:base:BaseTool"),fo=xt("globalConfiguration"),go=function(){function e(t,n){r()(this,e),this.initialConfiguration=ho(n,t);var o=this.initialConfiguration,a=o.name,i=o.strategies,s=o.defaultStrategy,l=o.configuration,c=o.supportedInteractionTypes,u=o.mixins,d=o.svgCursor;this.name=a,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=c||[],this.strategies=i||{},this.defaultStrategy=s||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,d&&(this.svgCursor=d),this._options={},this._configuration=Object.assign({},l),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,u&&u.length&&this._applyMixins(u),this._cursors=Object.assign({},this.initialConfiguration.cursors);var h=this.defaultStrategy&&this._cursors[this.activeStrategy];h&&(this.svgCursor=h)}return l()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=io["".concat(e[t])];"object"===x()(n)?(Object.assign(this,n),"function"==typeof this.initializeMixin&&this.initializeMixin()):mo.warn("".concat(this.name,": mixin ").concat(io[t]," does not exist."))}"function"===this.initializeMixin&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(e){this.activeStrategy=e,fo.configuration.showSVGCursors&&this.changeCursor(this.element,e)}},{key:"changeCursor",value:function(e,t){if(e){var n=this._cursors[t];n&&(this.svgCursor=n,"active"===this.mode&&Et(e,n))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}(),po=function(e,t){if(e.boundingBox)return y.cornerstoneMath.point.insideRect(t,e.boundingBox)},vo=function(e,t,n,o){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(po(e,n))return!0}else{var a=y.cornerstone.pixelToCanvas(t,e);if(y.cornerstoneMath.point.distance(a,n)<=o)return!0}return!1},yo=function e(t,n,o,a){var i;if(n){if(Array.isArray(n))for(var r=Object.keys(n),s=0;s<r.length;s++){var l=n[r[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&vo(l,t,o,a)){i=l;break}}else if("object"===x()(n))for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];if(Array.isArray(n[d])){if(i=e(t,n[d],o,a))break}else{var h=n[d];if(vo(h,t,o,a)){i=h;break}}}return i}},bo=function(e,t,n,o){o||(o=6);var a=function(e){var t;return Object.keys(e).forEach((function(n){var o=e[n];!0!==o.active||(t=o)})),t}(t),i=yo(e,t,n,o);return a!==i&&(void 0!==i&&(i.active=!0),void 0!==a&&(a.active=!1),!0)},xo=n(9),wo=n.n(xo),To=function(e,t){var n=e.image,o={left:0,top:0,width:n.width,height:n.height},a=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===y.cornerstoneMath.point.insideRect(n,o)&&(a=!0)})),a},Io=function(e,t){var n=e.currentPoints,o=e.element,a=n.page,i=vt.handleTouchOffset,r=0,s=0;return"touch"===t&&(r=i.x,s=i.y),y.cornerstone.pageToPixel(o,a.x+r,a.y+s)},Eo=function(e,t,n){return t.filter((function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])}))},So=n(5),Co=n.n(So),Ao=function(e,t){return"active"===Tt(e,t).mode},Mo=xt("segmentation"),Do=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r()(this,t),o.configuration||(o.configuration={alwaysEraseOnClick:!1}),(n=u()(this,h()(t).call(this,e,o))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(Co()(n)),n}return f()(t,e),l()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image,this._drawing&&this._paint(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=t.element,o=t.currentPoints;return this._startPainting(e),this._lastImageCoords=o.image,this._drawing=!0,this._startListeningForMouseUp(n),this._paint(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element,o=Mo.configuration,a=Mo.getters.labelmap2D(n),i=a.labelmap2D,r=a.labelmap3D,s=a.currentImageIdIndex,l=a.activeLabelmapIndex,c=this._isCtrlDown(t)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:i,labelmap3D:r,currentImageIdIndex:s,activeLabelmapIndex:l,shouldErase:c},o.storeHistory){var u=i.pixelData.slice();this.paintEventData.previousPixelData=u}}},{key:"_endPainting",value:function(e){for(var t=Mo.configuration,n=Mo.setters,o=this.paintEventData,a=o.labelmap2D,i=o.currentImageIdIndex,r=new Set(a.pixelData).values(),s=[],l=!1;!l;){var c=r.next();(l=c.done)||s.push(c.value)}if(a.segmentsOnLabelmap=s,t.storeHistory){var u={imageIdIndex:i,diff:Oe(this.paintEventData.previousPixelData,a.pixelData)};n.pushState(this.element,[u])}ke(this.element)}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image}},{key:"renderToolData",value:function(e){var t=e.detail.element;Ao(t,this.name)&&this.renderBrush(e)}},{key:"passiveCallback",value:function(e){try{y.cornerstone.updateImage(this.element)}catch(e){return}}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._endPainting(e),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"newImageCallback",value:function(e){this._drawing&&(this._endPainting(e),this._startPainting(e))}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"increaseBrushSize",value:function(){var e=Mo.configuration,t=Mo.setters,n=e.radius,o=Math.floor(1.2*n);o===n&&(o+=1),t.radius(o)}},{key:"decreaseBrushSize",value:function(){var e=Mo.configuration,t=Mo.setters,n=e.radius,o=Math.floor(.8*n);t.radius(o)}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(go),Po=function(e){return e.filter((function(e){return!(e.isMultiPartTool||e instanceof ga||e instanceof Do)}))};function Lo(e,t){var n;if("touch"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")?n=(n=Eo(e,yt.touchTools())).filter((function(e){return e.options.isTouchActive})):(n=(n=Eo(e,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&t&&e.options.mouseButtonMask.includes(t)&&e.options.isMouseActive})),vt.isMultiPartToolActive&&(n=Po(n))),0!==n.length)return n[0]}var ko=B("manipulators:moveAllHandles"),Oo=xt("manipulatorState"),Ro={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},No={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},_o=function(e,t,n,o){var a=e.element,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;i=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},i);var l=Uo.bind(this,t,n,i,r),c=function e(o){Vo(t,n,i,r,{dragHandler:l,upOrEndHandler:e},o,s)};Oo.setters.addActiveManipulatorForElement(a,Bo.bind(null,n,i,r,{dragHandler:l,upOrEndHandler:c},a,s)),n.active=!0,vt.isToolLocked=!0,Ro[r].forEach((function(e){a.addEventListener(e,l)})),No[r].forEach((function(e){a.addEventListener(e,c)}))};function Uo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=a.detail,r=i.element,s=i.image,l=i.buttons,c=a.detail.deltaPoints.image,u=c.x,d=c.y;t.active=!0,t.invalidated=!0;for(var h=Object.keys(t.handles),m=0;m<h.length;m++){var f=h[m],g=t.handles[f];!0!==g.movesIndependently&&g.hasOwnProperty("x")&&g.hasOwnProperty("y")&&(g.x+=u,g.y+=d,n.preventHandleOutsideImage&&In(g,s))}y.cornerstone.updateImage(r);var p=Lo(r,l,o);p instanceof ga&&p.updateCachedStats(s,r,t),T(r,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:r,measurementData:t}),a.preventDefault(),a.stopPropagation()}function Bo(e){var t=arguments.length>3?arguments[3]:void 0;Fo(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,{dragHandler:t.dragHandler,upOrEndHandler:t.upOrEndHandler},arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,!1)}function Vo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=a.dragHandler,r=a.upOrEndHandler,s=arguments.length>6?arguments[6]:void 0,l=(arguments.length>5?arguments[5]:void 0).detail,c=l.element;Oo.setters.removeActiveManipulatorForElement(c),n.deleteIfHandleOutsideImage&&To(l,t.handles)&&O(c,e,t),Fo(t,n,o,{dragHandler:i,upOrEndHandler:r},c,s,!0)}function Fo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,a=o.dragHandler,i=o.upOrEndHandler,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.active=!1,e.invalidated=!0,vt.isToolLocked=!1,Ro[n].forEach((function(e){r.removeEventListener(e,a)})),No[n].forEach((function(e){r.removeEventListener(e,i)})),"function"==typeof t.doneMovingCallback&&(ko.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(l)),"function"==typeof s&&s(l),y.cornerstone.updateImage(r)}var Ho=B("manipulators:moveHandle"),jo=xt("manipulatorState"),zo={value:!1},qo={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},Wo={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},Go=function(e,t,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",r=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},a);var s=e.element,l=Yo.bind(this,t,n,o,a,i),c=function s(){Ko(t,e,n,o,a,i,{dragHandler:l,upOrEndHandler:s},r)};if(jo.setters.addActiveManipulatorForElement(s,Zo.bind(null,t,e,n,o,a,i,{dragHandler:l,upOrEndHandler:c},r)),o.active=!0,o.moving=!0,n.active=!0,vt.isToolLocked=!0,qo[i].forEach((function(e){s.addEventListener(e,l)})),Wo[i].forEach((function(e){s.addEventListener(e,c)})),"touch"===i){zo.value=!0;var u=y.cornerstone.getEnabledElement(s),d=Io(e,i);Jo(o,zo,u,d)}};function Yo(e,t,n,o,a,i){var r=i.detail,s=r.image,l=r.element,c=r.buttons,u=Io(i.detail,a);zo.value=!1,n.active=!0,n.hasMoved=!0,n.x=u.x,n.y=u.y,t.invalidated=!0,o.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Lo(l,c,a);d instanceof ga&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function Zo(e,t,n,o){var a=arguments.length>6?arguments[6]:void 0;Xo(e,t,n,o,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},arguments.length>5?arguments[5]:void 0,{dragHandler:a.dragHandler,upOrEndHandler:a.upOrEndHandler},arguments.length>7?arguments[7]:void 0,!1)}function Ko(e,t,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,s=r.dragHandler,l=r.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=t.element;jo.setters.removeActiveManipulatorForElement(u),Xo(e,t,n,o,a,i,{dragHandler:s,upOrEndHandler:l},c,!0)}function Xo(e,t,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,s=r.dragHandler,l=r.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],d=t.element;o.active=!1,o.moving=!1,n.active=!1,n.invalidated=!0,zo.value=!1,vt.isToolLocked=!1,qo[i].forEach((function(e){d.removeEventListener(e,s)})),Wo[i].forEach((function(e){d.removeEventListener(e,l)})),a.deleteIfHandleOutsideImage&&To(t,n.handles)&&O(d,e,n),"function"==typeof a.doneMovingCallback&&(Ho.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),a.doneMovingCallback(u)),"function"==typeof c&&c(u),y.cornerstone.updateImage(d)}function Jo(e,t,n,o){if(t.value){var a=Math.abs(e.y-o.y),i=a/10;if(a<1)return e.y=o.y,void(t.value=!1);e.y>o.y?e.y-=i:e.y<o.y&&(e.y+=i),y.cornerstone.updateImage(n.element),y.cornerstone.requestAnimationFrame((function(){Jo(e,t,n,o)}))}}var Qo=B("manipulators:moveNewHandle"),$o=xt("manipulatorState"),ea={mouse:[w.MOUSE_MOVE,w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},ta={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_PINCH,w.TAP]},na=function(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",r=arguments.length>6?arguments[6]:void 0;(a=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},a)).hasMoved=!1;var s=e.element;function l(e){oa(t,n,o,a,i,e)}function c(e){ia(t,n,o,a,i,{moveHandler:l,moveEndHandler:c},e,r)}n.active=!0,o.moving=!0,o.active=!0,vt.isToolLocked=!0,ea[i].forEach((function(e){s.addEventListener(e,l)})),s.addEventListener(w.TOUCH_START,sa),ta[i].forEach((function(e){s.addEventListener(e,c)})),$o.setters.addActiveManipulatorForElement(s,ra.bind(null,n,o,a,i,{moveHandler:l,moveEndHandler:c},s,r))};function oa(e,t,n,o,a,i){var r=i.detail,s=r.image,l=r.element,c=r.buttons,u=Io(i.detail,a);o.hasMoved=!0,t.invalidated=!0,n.active=!0,n.x=u.x,n.y=u.y,o&&o.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Lo(l,c,a);d instanceof ga&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function aa(e,t,n,o,a){var i=o.moveHandler,r=o.moveEndHandler,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];ea[e].forEach((function(e){n.removeEventListener(e,i)})),ta[e].forEach((function(e){n.removeEventListener(e,r)})),n.removeEventListener(w.TOUCH_START,sa),vt.isToolLocked=!1,"function"==typeof a&&a(s),"function"==typeof t.doneMovingCallback&&(Qo.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(s)),y.cornerstone.updateImage(n)}function ia(e,t,n,o,a,i,r,s){var l=i.moveHandler,c=i.moveEndHandler,u=r.detail,d=u.element,h=!0;if(!1!==o.hasMoved){var m=Io(u,a);t.active=!1,t.invalidated=!0,n.active=!1,n.moving=!1,n.x=m.x,n.y=m.y,$o.setters.removeActiveManipulatorForElement(d),o.preventHandleOutsideImage&&In(n,r.detail.image),o.deleteIfHandleOutsideImage&&To(r.detail,t.handles)&&(t.cancelled=!0,h=!1,O(d,e,t)),aa(a,o,d,{moveHandler:l,moveEndHandler:c},s,h)}}function ra(e,t,n,o,a,i,r){var s=a.moveHandler,l=a.moveEndHandler;e.active=!1,e.invalidated=!0,t.active=!1,aa(o,n,i,{moveHandler:s,moveEndHandler:l},r,!1)}function sa(e){return e.stopImmediatePropagation(),!1}function la(e,t){var n=vt.clickProximity,o=vt.touchProximity,a=vt.tools.find((function(e){return e.name===t}));return a&&a.configuration&&(n=a.configuration.clickProximity||n,o=a.configuration.touchProximity||o),"mouse"===e?n:o}function ca(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ca(n,!0).forEach((function(t){wo()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ca(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var da=function(e,t,n,o,a){n.active=!0,vt.isToolLocked=!0,Go(e.detail,t.name,n,o,t.options,a,(function(t){var o=e.detail.element,a=n.toolType||n.toolName,i={toolName:a,toolType:a,element:o,measurementData:ua({},n,{active:!1})};T(o,w.MEASUREMENT_COMPLETED,i)})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},ha=function(e,t,n,o){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",i=0;i<t.data.length;i++){var r=t.data[i],s=yo(e,r.handles,o,la(a,n));if(s)return{handle:s,data:r}}},ma=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";n.active=!0,vt.isToolLocked=!0,_o(e.detail,t.name,n,null,t.options,o,(function(){n.active=!1,vt.isToolLocked=!1})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},fa=B("baseAnnotationTool"),ga=function(e){function t(){return r()(this,t),u()(this,h()(t).apply(this,arguments))}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,o=t.currentPoints.canvas,a=k(n,this.name),i=!1,r=0;r<a.data.length;r++){var s=a.data[r];!0===bo(n,s.handles,o)&&(i=!0);var l=this.pointNearTool(n,s,o,"mouse")&&!s.active,c=!this.pointNearTool(n,s,o,"mouse")&&s.active;(l||c)&&(s.active=!s.active,i=!0)}return i}},{key:"handleSelectedCallback",value:function(e,t,n){da(e,this,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")}},{key:"toolSelectedCallback",value:function(e,t){ma(e,this,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")}},{key:"updateCachedStats",value:function(e,t,n){fa.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),t}(go),pa=function(e,t,n,o){var a=y.cornerstone,i={start:a.pixelToCanvas(e,t),end:a.pixelToCanvas(e,n)};return y.cornerstoneMath.lineSegment.distanceToPoint(i,o)},va=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},ya=bt.cursor,ba=function(){function e(t,n){r()(this,e),this.iconGroupString=t,this.options=Object.assign({},ya.getters.defaultOptions(),n)}return l()(e,[{key:"getIconSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,o=t.iconSize,a=t.viewBox,i=o/Math.max(a.x,a.y),r=16+o,s='\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(r,'" height="').concat(r,'" viewBox="0 0 ').concat(r," ").concat(r,'"\n      >\n        <g>\n          ').concat(n,'\n        </g>\n        <g transform="translate(16, 16) scale(').concat(i,')">\n          ').concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,o=t.viewBox,a='\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(n,'" height="').concat(n,'" viewBox="0 0\n        ').concat(o.x," ").concat(o.y,'"\n      >\n        ').concat(this.iconGroupString,"\n      </svg>");return this._injectColors(a,t)}},{key:"_injectColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||un.getActiveColor(),o=t.toolColor||un.getToolColor(),a=t.fillColor||un.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(o)).replace(/FILL_COLOR/g,"".concat(a))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}(),xa=new ba('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />',{viewBox:{x:1792,y:1792}}),wa=new ba('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',{viewBox:{x:24,y:24}}),Ta=new ba('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',{viewBox:{x:48,y:48}}),Ia=new ba('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',{viewBox:{x:32,y:32}}),Ea=new ba('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),Sa=new ba('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />',{viewBox:{x:32,y:32}}),Ca=new ba('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',{viewBox:{x:18,y:18}}),Aa=new ba('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>',{viewBox:{x:18,y:18}}),Ma=new ba('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',{viewBox:{x:24,y:24}}),Da=new ba('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />',{viewBox:{x:1792,y:1792}}),Pa=new ba('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),La=new ba('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />',{viewBox:{x:1792,y:1792}}),ka=new ba('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />',{viewBox:{x:1792,y:1792}}),Oa=new ba('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />',{viewBox:{x:2048,y:1792}}),Ra=new ba('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />',{viewBox:{x:512,y:512}}),Na=new ba('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />',{viewBox:{x:1792,y:1792}}),_a=new ba('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />',{viewBox:{x:1792,y:1792}}),Ua=new ba('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />',{viewBox:{x:24,y:28}}),Ba=new ba('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),Va=new ba('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />',{viewBox:{x:18,y:18}}),Fa=new ba('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />',{viewBox:{x:640,y:512}}),Ha={x:127,y:60},ja=function(){return'<rect fill="'.concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR",'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},za=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(e,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},qa='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Wa='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Ga='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Ya=new ba("".concat(qa," ").concat(ja()),{viewBox:Ha}),Za=new ba("".concat(qa," ").concat(za()),{viewBox:Ha}),Ka=new ba("".concat(qa," ").concat(ja()),{viewBox:Ha}),Xa=new ba("".concat(qa," ").concat(za()),{viewBox:Ha}),Ja=new ba("".concat(Wa," ").concat(ja()),{viewBox:Ha}),Qa=new ba("".concat(Wa," ").concat(za()),{viewBox:Ha}),$a=new ba("".concat(Wa," ").concat(ja()),{viewBox:Ha}),ei=new ba("".concat(Wa," ").concat(za()),{viewBox:Ha}),ti=new ba("".concat(Ga," ").concat(ja()),{viewBox:Ha}),ni=new ba("".concat(Ga," ").concat(za()),{viewBox:Ha}),oi=new ba("".concat(Ga," ").concat(ja()),{viewBox:Ha}),ai=new ba("".concat(Ga," ").concat(za()),{viewBox:Ha});function ii(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId);return t?{rowPixelSpacing:t.rowPixelSpacing||t.rowImagePixelSpacing,colPixelSpacing:t.columnPixelSpacing||t.colImagePixelSpacing}:{rowPixelSpacing:e.rowPixelSpacing,colPixelSpacing:e.columnPixelSpacing}}var ri=function(e){var t=x()(e);return null!==e&&("object"===t||"function"===t)},si=function(e,t,n){var o,a,i,r,s,l,c=0,u=!1,d=!1,h=!0,m=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=o,i=a;return o=a=void 0,c=t,r=e.apply(i,n)}function g(e,t){return m?window.requestAnimationFrame(e):setTimeout(e,t)}function p(e){return c=e,s=g(y,t),u?f(e):r}function v(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=i}function y(){var e=Date.now();if(v(e))return b(e);s=g(y,function(e){var n=e-c,o=t-(e-l);return d?Math.min(o,i-n):o}(e))}function b(e){return s=void 0,h&&o?f(e):(o=a=void 0,r)}function x(){for(var e=Date.now(),n=v(e),i=arguments.length,c=new Array(i),u=0;u<i;u++)c[u]=arguments[u];if(o=c,a=this,l=e,n){if(void 0===s)return p(l);if(d)return s=g(y,t),f(l)}return void 0===s&&(s=g(y,t)),r}return t=Number(t)||0,ri(n)&&(u=Boolean(n.leading),i=(d="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):i,h="trailing"in n?Boolean(n.trailing):h),x.cancel=function(){void 0!==s&&function(e){if(m)return window.cancelAnimationFrame(e);clearTimeout(e)}(s),c=0,o=l=a=s=void 0},x.flush=function(){return void 0===s?r:b(Date.now())},x.pending=function(){return void 0!==s},x},li=function(e,t,n){var o=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ri(n)&&(o="leading"in n?Boolean(n.leading):o,a="trailing"in n?Boolean(n.trailing):a),si(e,t,{leading:o,trailing:a,maxWait:t})},ci=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:xa,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,h()(t).call(this,n,o))).preventNewMeasurement=!1,e.throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(pa(e,t.handles.start,t.handles.middle,n)<25||pa(e,t.handles.middle,t.handles.end,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var o=di(e,n.handles.middle,n.handles.start),a=di(e,n.handles.end,n.handles.middle),i=di(e,n.handles.end,n.handles.start),r=ui(o),s=ui(a),l=ui(i),c=Math.acos((Math.pow(r,2)+Math.pow(s,2)-Math.pow(l,2))/(2*r*s));c*=180/Math.PI,n.rAngle=va(c,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=n.enabledElement,a=this.configuration,i=a.handleRadius,r=a.drawHandlesOnHover,s=a.hideHandlesIfMoving,l=a.renderDashed,c=k(e.currentTarget,this.name),u=xt("globalConfiguration").configuration.lineDash;if(c)for(var d=Dn(n.canvasContext.canvas),h=n.image,m=n.element,f=ii(h),g=f.rowPixelSpacing,p=f.colPixelSpacing,v=Zt.getToolWidth(),b=function(e){var a=c.data[e];if(!1===a.visible)return"continue";Wt(d,(function(e){Ln(e,t.configuration);var c=un.getColorIfActive(a),d=y.cornerstone.pixelToCanvas(n.element,a.handles.start),f=y.cornerstone.pixelToCanvas(n.element,a.handles.middle),b={color:c};l&&(b.lineDash=u),Jt(e,n.element,a.handles.start,[a.handles.middle,a.handles.end],b);var x={color:c,handleRadius:i,drawHandlesIfActive:r,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&dn(e,n,a.handles,x),!0===a.invalidated&&(a.rAngle?t.throttledUpdateCachedStats(h,m,a):t.updateCachedStats(h,m,a)),a.rAngle){var T,I=function(e,t,n){var o=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+o}(a,g,p);if(!a.handles.textBox.hasMoved){T={x:f.x,y:f.y};var E=xn(e,I,5);f.x<d.x?T.x-=15+E+10:T.x+=15;var S=y.cornerstone.internal.getTransform(o);S.invert();var C=S.transformPoint(T.x,T.y);a.handles.textBox.x=C.x,a.handles.textBox.y=C.y}An(e,n.element,a.handles.textBox,I,a.handles,w,c,v,0,!0)}}))},x=0;x<c.data.length;x++)b(x);function w(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var o=e.detail,a=this.createNewMeasurement(o),i=e.detail.element;L(i,this.name,a),y.cornerstone.updateImage(i),na(o,this.name,a,a.handles.middle,this.options,t,(function(e){if(a.active=!1,!e)return O(i,n.name,a),void(n.preventNewMeasurement=!1);a.handles.end.active=!0,y.cornerstone.updateImage(i),na(o,n.name,a,a.handles.end,n.options,t,(function(e){e?(a.active=!1,y.cornerstone.updateImage(i)):O(i,n.name,a),n.preventNewMeasurement=!1,y.cornerstone.updateImage(i);var t={toolName:n.name,toolType:n.name,element:i,measurementData:a};T(i,w.MEASUREMENT_COMPLETED,t)}))}))}}}]),t}(ga);function ui(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function di(e,t,n){var o=ii(e),a=o.rowPixelSpacing,i=o.colPixelSpacing;return{x:(t.x-n.x)*(i||1),y:(t.y-n.y)*(a||1)}}var hi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:mi,changeTextCallback:fi,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:wa};return(e=u()(this,h()(t).call(this,n,o))).preventNewMeasurement=!1,e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&pa(e,t.handles.start,t.handles.end,n)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=n.element,a=n.enabledElement,i=this.configuration,r=i.handleRadius,s=i.drawHandlesOnHover,l=i.hideHandlesIfMoving,c=i.renderDashed,u=k(o,this.name);if(u){var d,h=e.detail.canvasContext.canvas,m=Dn(h),f=Zt.getToolWidth();c&&(d=xt("globalConfiguration").configuration.lineDash);for(var g=function(n){var i=u.data[n];if(!1===i.visible)return"continue";Wt(m,(function(n){Ln(n,t.configuration);var c=un.getColorIfActive(i),u=y.cornerstone.pixelToCanvas(o,i.handles.start),h=y.cornerstone.pixelToCanvas(o,i.handles.end);t.configuration.arrowFirst?Qt(n,h,u,c,f,d):Qt(n,u,h,c,f,d);var m={color:c,handleRadius:r,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&dn(n,e.detail,i.handles,m);var g=function(e){return e.text}(i);if(g&&""!==g){var p=xn(n,g,5),b=vn.getFontSize()+10,x=Math.max(p,b)/2+5;if(h.x<u.x&&(x=-x),!i.handles.textBox.hasMoved){var w;w=t.configuration.arrowFirst?{x:h.x-p/2+x,y:h.y-b/2}:{x:u.x-p/2-x,y:u.y-b/2};var T=y.cornerstone.internal.getTransform(a);T.invert();var I=T.transformPoint(w.x,w.y);i.handles.textBox.x=I.x,i.handles.textBox.y=I.y}An(n,o,i.handles.textBox,g,i.handles,v,c,f,0,!1)}}))},p=0;p<u.data.length;p++)g(p)}function v(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,o=e.detail.element,a=this.createNewMeasurement(e),i=this.configuration.allowEmptyLabel;L(o,this.name,a),y.cornerstone.updateImage(o),na(e.detail,this.name,a,a.handles.end,this.options,t,(function(t){t?void 0===a.text&&n.configuration.getTextCallback((function(e){if(e||i){a.text=e,a.active=!1;var t={toolName:n.name,toolType:n.name,element:o,measurementData:a};y.cornerstone.updateImage(o),T(o,w.MEASUREMENT_COMPLETED,t)}else O(o,n.name,a)}),e.detail):O(o,n.name,a),y.cornerstone.updateImage(o)}))}},{key:"doubleClickCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,o=k(t,this.name);if(!o)return!1;for(var a=0;a<o.data.length;a++){var i=o.data[a];if(this.pointNearTool(t,i,n)||po(i.handles.textBox,n))return i.active=!0,y.cornerstone.updateImage(t),this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,t,i)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,o){!0===o?O(e,this.name,t):t.text=n,t.active=!1,y.cornerstone.updateImage(e),T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}]),t}(ga);function mi(e){e(prompt("Enter your annotation:"))}function fi(e,t,n){n(prompt("Change your annotation:"))}var gi=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},o)},pi=function(e){var t=e.currentPoints.image,n=t.x,o=t.y;return{toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:gi(n,o,0),end:gi(n,o,1,{active:!0}),perpendicularStart:gi(n,o,2,{locked:!0}),perpendicularEnd:gi(n,o,3),textBox:gi(n-50,o-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},vi=function(e,t,n,o){var a=y.cornerstone,i=y.cornerstoneMath,r={start:a.pixelToCanvas(e,t.perpendicularStart),end:a.pixelToCanvas(e,t.perpendicularEnd)};return i.lineSegment.distanceToPoint(r,n)<o},yi=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",a=y.cornerstone,i=y.cornerstoneMath,r=t.handles,s={start:a.pixelToCanvas(e,r.start),end:a.pixelToCanvas(e,r.end)},l=i.lineSegment.distanceToPoint(s,n);if(po(r.textBox,n))return!0;var c=la(o,"Bidirectional");return!!vi(e,r,n,c)||l<c};function bi(e,t,n,o){var a=(n.x-o.x)*e,i=(n.y-o.y)*t,r=Math.sqrt(a*a+i*i);return{x:a/r,y:i/r,length:r}}function xi(e,t){if(!t.handles.perpendicularStart.locked)return!1;var n,o,a,i,r=t.handles,s=r.start,l=r.end,c=e.image,u=c.columnPixelSpacing,d=void 0===u?1:u,h=c.rowPixelSpacing,m=void 0===h?1:h;if(s.x===l.x&&s.y===l.y)n=s.x,o=s.y,a=l.x,i=l.y;else{var f={x:(s.x+l.x)/2,y:(s.y+l.y)/2},g=bi(d,m,s,l),p=g.length/2,v=p/(2*m),y=p/(2*d);n=f.x+y*g.y,o=f.y-v*g.x,a=f.x-y*g.y,i=f.y+v*g.x}return t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=o,t.handles.perpendicularEnd.x=a,t.handles.perpendicularEnd.y=i,!0}var wi,Ti=function(e){var t=this,n=e.detail,o=n.element,a=n.canvasContext,i=n.image,r=this.configuration,s=r.handleRadius,l=r.drawHandlesOnHover,c=r.hideHandlesIfMoving,u=r.renderDashed,d=xt("globalConfiguration").configuration.lineDash,h=k(o,this.name);if(h){var m=ii(i),f=m.rowPixelSpacing,g=m.colPixelSpacing;if(f&&g)for(var p,v=Dn(a.canvas),y=Zt.getToolWidth(),b=function(e){var a=h.data[e];if(!1===a.visible)return"continue";p=un.getColorIfActive(a),!0===a.invalidated&&(a.longestDiameter&&a.shortestDiameter?t.throttledUpdateCachedStats(i,o,a):t.updateCachedStats(i,o,a)),Wt(v,(function(e){Ln(e,t.configuration);var i=a.handles,r=i.start,h=i.end,m=i.perpendicularStart,v=i.perpendicularEnd,b=i.textBox,x={color:p},w={color:p,strokeWidth:T};u&&(x.lineDash=d,w.lineDash=d),Xt(e,o,r,h,x);var T=y;xi(n,a),Xt(e,o,m,v,w);var I={color:p,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&dn(e,n,a.handles,I);var E=Ii(a,f,g);An(e,o,b,E,a.handles,(function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]}),p,y,10,!0)}))},x=0;x<h.data.length;x++)b(x)}},Ii=function(e,t,n){var o=" mm";t&&n||(o=" pixels");var a=" L ".concat(e.longestDiameter).concat(o),i=" W ".concat(e.shortestDiameter).concat(o),r=e.labels;return r&&Array.isArray(r)?[].concat(Q()(r),[a,i]):[a,i]},Ei=function(e,t){var n=this,o=e.detail,a=o.element,i=o.image,r=o.buttons,s=this.configuration;if(!Si(i)){var l=this.createNewMeasurement(o),c=function(){l.active=!1,y.cornerstone.updateImage(a)};L(a,this.name,l),y.cornerstone.updateImage(a);var u=(new Date).getTime(),d=l.handles,h=d.end,m=d.perpendicularStart;na(o,this.name,l,h,{},t,(function(e){if(e){var d=l.handles,h=l.longestDiameter,f=l.shortestDiameter,g=To(o,d),p=parseFloat(h)||0,v=parseFloat(f)||0,b=p<1||v<1,x=(new Date).getTime()-u<150;g||b||x?(l.cancelled=!0,O(a,n.name,l)):s.getMeasurementLocationCallback(l,o,c),xi(o,l),m.locked=!1,l.invalidated=!0,y.cornerstone.updateImage(a);var I=Lo(a,r,t);I instanceof Xi&&I.updateCachedStats(i,a,l);var E={toolName:n.name,toolType:n.name,element:a,measurementData:l};T(a,w.MEASUREMENT_MODIFIED,E),T(a,w.MEASUREMENT_COMPLETED,E)}else O(a,n.name,l)}))}},Si=function(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,o=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,o=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!o},Ci={setCoords:function(e){wi=e.currentPoints.canvas},getCoords:function(){return wi}},Ai=function(e){var t=this,n=e.detail,o=n.element;Ci.setCoords(n);var a=k(o,this.name);if(a){for(var i=!1,r=function(e){var r=n.currentPoints.canvas,s=a.data[e],l=function(e,t,n){var o=yo(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:6),a=!1;return Object.keys(t).forEach((function(e){if("textBox"!==e){var n=t[e],i=n===o;n.active!==i&&(a=!0),n.active=i}})),a}(o,s.handles,r);Object.keys(s.handles).forEach((function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active}})),l&&(i=!0);var c=t.pointNearTool(o,s,r,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,i=!0)},s=0;s<a.data.length;s++)r(s);!0===i&&y.cornerstone.updateImage(o)}},Mi=function(e,t,n){"touch"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)};function Di(e,t,n,o){var a=(n.x-o.x)/t,i=(n.y-o.y)/e;return Math.sqrt(a*a+i*i)}function Pi(e,t){return{start:e,end:t}}function Li(e,t,n){var o=y.cornerstoneMath.lineSegment,a=e.handles,i=a.start,r=a.end,s=a.perpendicularStart,l=a.perpendicularEnd,c=t.image,u=c.columnPixelSpacing,d=void 0===u?1:u,h=c.rowPixelSpacing,m=void 0===h?1:h,f=Pi(i,r),g=Pi(s,l),p=o.intersectLine(f,g);return{columnPixelSpacing:d,rowPixelSpacing:m,start:i,end:r,perpendicularStart:s,perpendicularEnd:l,longLine:f,intersection:p,distanceToFixed:Di(d,m,n,p),fixedPoint:n}}function ki(e,t,n,o){var a=Li(t,n,o),i=a.columnPixelSpacing,r=a.rowPixelSpacing,s=a.distanceToFixed,l=Di(i,r,o,e);if(l<=s)return!1;var c=s/l,u=function(e,t){var n=e.columnPixelSpacing,o=e.rowPixelSpacing,a=e.start,i=e.perpendicularStart,r=e.perpendicularEnd,s=e.intersection,l=e.fixedPoint,c=Di(n,o,i,s),u=Di(n,o,r,s),d=bi(n,o,l,t),h=l===a?1:-1,m=h*o,f=h*n;return{start:{x:t.x+d.y*c*m,y:t.y+d.x*c*f*-1},end:{x:t.x+d.y*u*m*-1,y:t.y+d.x*u*f}}}(a,{x:o.x+(e.x-o.x)*c,y:o.y+(e.y-o.y)*c});return t.handles.perpendicularStart.x=u.start.x,t.handles.perpendicularStart.y=u.start.y,t.handles.perpendicularEnd.x=u.end.x,t.handles.perpendicularEnd.y=u.end.y,!0}function Oi(e,t){return e===t}function Ri(e,t){return Oi(e,t)?-1:1}function Ni(e,t,n,o){var a,i=e.columnPixelSpacing,r=e.rowPixelSpacing,s=e.fixedPoint,l=e.perpendicularStart,c=e.perpendicularEnd,u=e.distanceToFixed,d=Ri(s,c)*u,h=function(e,t,n){return Oi(e,n)?t:n}(s,l,c)===l,m=h?"start":"end",f=h?"end":"start";return a={},wo()(a,m,{x:n.start.x,y:n.start.y}),wo()(a,f,{x:t.x+o.y*r*d,y:t.y+o.x*i*d*-1}),a}function _i(e,t,n,o){var a=y.cornerstoneMath.lineSegment,i=Li(t,n,o),r=i.columnPixelSpacing,s=i.rowPixelSpacing,l=i.start,c=i.longLine,u=i.intersection;if(!function(e,t,n){return 0!==Di(e,t,n.start,n.end)}(r,s,c))return!1;var d=bi(r,s,l,u),h=function(e,t,n){var o=e.columnPixelSpacing,a=e.rowPixelSpacing,i=e.perpendicularEnd,r=e.fixedPoint,s=Number.MAX_SAFE_INTEGER,l=Ri(r,i)*s;return{start:t,end:{x:t.x+n.y*a*l,y:t.y+n.x*o*l*-1}}}(i,e,d),m=a.intersectLine(c,h);if(!m)return!1;var f=Ni(i,m,h,d);return t.handles.perpendicularStart.x=f.start.x,t.handles.perpendicularStart.y=f.start.y,t.handles.perpendicularEnd.x=f.end.x,t.handles.perpendicularEnd.y=f.end.y,!0}var Ui=function(e,t,n,o){var a,i,r,s,l={},c={},u={x:t.currentPoints.image.x+o.x,y:t.currentPoints.image.y+o.y};0===e.index?ki(u,n,t,n.handles.end)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?ki(u,n,t,n.handles.start)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(a=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(i=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},i=y.cornerstoneMath.lineSegment.intersectLine(l,c),r=y.cornerstoneMath.point.distance(i,n.handles.start),s=y.cornerstoneMath.point.distance(i,n.handles.end),(!i||r<3||s<3)&&(a=!0)),a||_i(u,n,t,n.handles.perpendicularEnd)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(a=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(i=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},i=y.cornerstoneMath.lineSegment.intersectLine(l,c),r=y.cornerstoneMath.point.distance(i,n.handles.start),s=y.cornerstoneMath.point.distance(i,n.handles.end),(!i||r<3||s<3)&&(a=!0)),a||_i(u,n,t,n.handles.perpendicularStart)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))},Bi=function(e,t,n){var o=e[n],a=t[n];e[n]=a,t[n]=o},Vi=function(e,t){Bi(e,t,"x"),Bi(e,t,"y"),Bi(e,t,"moving"),Bi(e,t,"hover"),Bi(e,t,"active"),Bi(e,t,"selected")},Fi=function(e){var t,n=this,o=e.detail,a=o.element,i=la("mouse",this.name),r=function(e){t.invalidated=!0,To(o,t.handles)&&O(a,n.name,t),e&&(e.moving=!1,e.selected=!0),Et(n.element,n.svgCursor),y.cornerstone.updateImage(a),a.addEventListener(w.MOUSE_MOVE,n._moveCallback),a.addEventListener(w.TOUCH_START,n._moveCallback)},s=o.startPoints.canvas,l=k(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[a,t.handles,s,i],d=yo.apply(void 0,u);if(d)return a.removeEventListener(w.MOUSE_MOVE,n._moveCallback),a.removeEventListener(w.TOUCH_START,n._moveCallback),t.active=!0,Hi(t.handles),d.moving=!0,(d=function(e,t,n){var o=e.image,a=o.rowPixelSpacing,i=o.columnPixelSpacing,r=t.handles,s=r.start,l=r.end,c=r.perpendicularStart,u=r.perpendicularEnd,d=(s.x-l.x)*(i||1),h=(s.y-l.y)*(a||1),m=Math.sqrt(d*d+h*h),f=(c.x-u.x)*(i||1),g=(c.y-u.y)*(a||1);return(Math.sqrt(f*f+g*g)||0)>m?(Vi(s,l),Vi(s,c),Vi(l,u),Object.values(r).find((function(e){return!0===e.moving}))):n}(o,t,d)).hasBoundingBox||St(n.element),function(e,t,n,o,a,i){var r=e.element,s=e.image,l=e.buttons,c={x:o.x-e.currentPoints.image.x,y:o.y-e.currentPoints.image.y},u=function(e){var a=e.detail;o.hasMoved=!0,void 0===o.index||null===o.index?(o.x=a.currentPoints.image.x+c.x,o.y=a.currentPoints.image.y+c.y):Ui(o,a,n,c),i&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,a.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,a.image.height)),n.invalidated=!0,y.cornerstone.updateImage(r);var u=Lo(r,l,"mouse");u instanceof ga&&u.updateCachedStats(s,r,n);var d={toolName:t,toolType:t,element:r,measurementData:n};y.cornerstone.triggerEvent(r,w.MEASUREMENT_MODIFIED,d)};o.active=!0,o.moving=!0,vt.isToolLocked=!0,r.addEventListener(w.MOUSE_DRAG,u),r.addEventListener(w.TOUCH_DRAG,u);var d=y.cornerstone.getImage(r),h=function(){y.cornerstone.getImage(r).imageId!==d.imageId&&m()};r.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,h);var m=function e(){o.active=!1,vt.isToolLocked=!1,r.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,h),r.removeEventListener(w.MOUSE_DRAG,u),r.removeEventListener(w.MOUSE_UP,e),r.removeEventListener(w.MOUSE_CLICK,e),r.removeEventListener(w.TOUCH_DRAG,u),r.removeEventListener(w.TOUCH_DRAG_END,e),r.removeEventListener(w.TAP,e),y.cornerstone.updateImage(r),"function"==typeof a&&a()};r.addEventListener(w.MOUSE_UP,m),r.addEventListener(w.MOUSE_CLICK,m),r.addEventListener(w.TOUCH_DRAG_END,m),r.addEventListener(w.TAP,m)}(o,n.name,t,d,(function(){return r(d)})),zi(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===x()(d))return d.v}var h=function(e){return function(){ji(e,!1),r()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(a,t,s,"mouse")){a.removeEventListener(w.MOUSE_MOVE,this._moveCallback),a.removeEventListener(w.TOUCH_START,this._moveCallback),t.active=!0,Hi(t.handles),ji(t.handles,!0);var m=h(t.handles);return _o(o,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",m),zi(e),!0}}},Hi=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},ji=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},zi=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},qi=[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP],Wi=function(e){var t,n=this,o=e.detail,a=o.element,i=vt.touchProximity,r=function(e){t.invalidated=!0,To(o,t.handles)&&O(a,n.name,t),e&&(e.moving=!1,e.selected=!0),y.cornerstone.updateImage(a),a.addEventListener(w.TOUCH_DRAG,n._moveCallback)},s=o.startPoints.canvas,l=k(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[a,t.handles,s,i],d=yo.apply(void 0,u);if(d)return a.removeEventListener(w.TOUCH_DRAG,n._moveCallback),t.active=!0,Gi(t.handles),d.moving=!0,function(e,t,n,o,a,i){var r=e.element,s=e.image,l=e.buttons,c={x:o.x-e.currentPoints.image.x,y:o.y-e.currentPoints.image.y},u=function(e){var a=e.detail;o.hasMoved=!0,void 0===o.index||null===o.index?(o.x=a.currentPoints.image.x+c.x,o.y=a.currentPoints.image.y+c.y):Ui(o,a,n,c),i&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,a.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,a.image.height)),n.invalidated=!0,y.cornerstone.updateImage(r);var u=Lo(r,l,"touch");u instanceof ga&&u.updateCachedStats(s,r,n);var d={toolName:t,toolType:t,element:r,measurementData:n};y.cornerstone.triggerEvent(r,w.MEASUREMENT_MODIFIED,d)};o.active=!0,vt.isToolLocked=!0,r.addEventListener(w.TOUCH_DRAG,u);var d=function e(){o.active=!1,vt.isToolLocked=!1,r.removeEventListener(w.TOUCH_DRAG,u),qi.forEach((function(t){r.removeEventListener(t,e)})),y.cornerstone.updateImage(r),"function"==typeof a&&a()};qi.forEach((function(e){r.addEventListener(e,d)}))}(o,n.name,t,d,(function(){return r(d)})),Zi(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===x()(d))return d.v}var h=function(e){return function(){Yi(e,!1),r()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(a,t,s,"touch")){a.removeEventListener(w.TOUCH_DRAG,this._moveCallback),t.active=!0,Gi(t.handles),Yi(t.handles,!0);var m=h(t.handles);return _o(o,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",m),Zi(e),!0}}},Gi=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Yi=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},Zi=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Ki=function(e,t,n){return n()},Xi=function(e){function t(e){var n;r()(this,t);var o={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:Ki,getMeasurementLocationCallback:Ki,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:Ta};return(n=u()(this,h()(t).call(this,e,o))).throttledUpdateCachedStats=li(n.updateCachedStats,110),n.createNewMeasurement=pi.bind(Co()(n)),n.pointNearTool=yi.bind(Co()(n)),n.renderToolData=Ti.bind(Co()(n)),n.addNewMeasurement=Ei.bind(Co()(n)),n._moveCallback=Ai.bind(Co()(n)),n.handleSelectedCallback=Mi.bind(Co()(n)),n.handleSelectedMouseCallback=Fi.bind(Co()(n)),n.handleSelectedTouchCallback=Wi.bind(Co()(n)),n}return f()(t,e),l()(t,[{key:"updateCachedStats",value:function(e,t,n){if(n.toolName===this.name){var o=function(e,t){var n=t.rowPixelSpacing,o=t.colPixelSpacing,a=e.handles,i=a.start,r=a.end,s=a.perpendicularStart,l=a.perpendicularEnd,c=(i.x-r.x)*(o||1),u=(i.y-r.y)*(n||1),d=Math.sqrt(c*c+u*u),h=(s.x-l.x)*(o||1),m=(s.y-l.y)*(n||1),f=Math.sqrt(h*h+m*m);if(f||(f=0),f>d){var g=d;d=f,f=g}return{longestDiameter:d.toFixed(1),shortestDiameter:f.toFixed(1)}}(n,ii(e)),a=o.longestDiameter,i=o.shortestDiameter;n.longestDiameter=a,n.shortestDiameter=i,n.invalidated=!1}}}]),t}(ga),Ji=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=y.cornerstone,a=o.metaData.get("patientStudyModule",e.imageId),i=o.metaData.get("generalSeriesModule",e.imageId);if(a&&i&&"PT"===i.modality){var r=n?t:t*e.slope+e.intercept,s=a.patientWeight;if(s){var l=o.metaData.get("petIsotopeModule",e.imageId);if(l){var c=l.radiopharmaceuticalInfo,u=c.radiopharmaceuticalStartTime,d=c.radionuclideTotalDose,h=c.radionuclideHalfLife,m=i.seriesTime;if(u&&d&&h&&m){var f=Qi(m.fractionalSeconds||0)+m.seconds+60*m.minutes+60*m.hours*60-(Qi(u.fractionalSeconds||0)+u.seconds+60*u.minutes+60*u.hours*60);return r*s/(d*Math.exp(-f*Math.log(2)/h))*1e3}}}}};function Qi(e){return parseFloat(".".concat(e))}var $i=function(e,t){var n=e.width/2,o=e.height/2;if(n<=0||o<=0)return!1;var a=e.left+n,i=e.top+o,r=t.x-a,s=t.y-i;return r*r/(n*n)+s*s/(o*o)<=1},er=function(e,t){for(var n=0,o=0,a=0,i=0,r=null,s=null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)$i(t,{x:c,y:l})&&(null===r&&(r=e[i],s=e[i]),n+=e[i],o+=e[i]*e[i],r=Math.min(r,e[i]),s=Math.max(s,e[i]),a++),i++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/a,d=o/a-u*u;return{count:a,mean:u,variance:d,stdDev:Math.sqrt(d),min:r,max:s}},tr={calculateEllipseStatistics:er,pointInEllipse:$i};function nr(e,t){var n=function(e){var t=[e.start,e.end].sort((function(e,t){return e.x<t.x?-1:1})),n=[e.start,e.end].sort((function(e,t){return e.y<t.y?-1:1})),o=t[0],a=t[t.length-1];return{top:n[0],left:o,bottom:n[n.length-1],right:a}}(t),o=(n.left.x+n.right.x)/2,a=(n.top.y+n.bottom.y)/2,i={};return e.rotation>=0&&e.rotation<90&&(i.x=e.hflip?n.left.x:n.right.x,i.y=a),e.rotation>=90&&e.rotation<180&&(i.x=o,i.y=e.vflip?n.bottom.y:n.top.y),e.rotation>=180&&e.rotation<270&&(i.x=e.hflip?n.right.x:n.left.x,i.y=a),e.rotation>=270&&e.rotation<360&&(i.x=o,i.y=e.vflip?n.top.y:n.bottom.y),i}var or=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},ar=B("tools:annotation:CircleRoiTool"),ir=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ea,configuration:{centerPointRadius:0,renderDashed:!1,hideHandlesIfMoving:!1}};return(e=u()(this,h()(t).call(this,n,o))).throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};ar.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,o){var a=t&&t.handles&&t.handles.start&&t.handles.end,i=y.cornerstoneMath.point.distance;if(a||ar.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;var r="mouse"===o?15:25,s=y.cornerstone.pixelToCanvas(e,t.handles.start),l=y.cornerstone.pixelToCanvas(e,t.handles.end),c=i(s,n),u=i(s,l);return c>u-r/2&&c<u+r/2}},{key:"updateCachedStats",value:function(e,t,n){var o=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,a=ii(e),i=function(e,t,n,o,a){var i,r=ye(n.start,n.end),s=y.cornerstone.getPixels(t,r.left,r.top,r.width,r.height),l=er(s,r);"PT"===o&&(i={mean:Ji(e,l.mean,!0)||0,stdDev:Ji(e,l.stdDev,!0)||0});var c=r.width*(a&&a.colPixelSpacing||1)/2,u=2*Math.PI*c;return{area:Math.PI*(r.width*(a&&a.colPixelSpacing||1)/2)*(r.height*(a&&a.rowPixelSpacing||1)/2)||0,radius:c||0,perimeter:u||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:i}}(e,t,n.handles,o,a);n.cachedStats=i,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=k(e.currentTarget,this.name);if(n){var o=y.cornerstoneMath.point.distance,a=e.detail,i=a.image,r=a.element,s=a.canvasContext,l=Zt.getToolWidth(),c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,h=c.hideHandlesIfMoving,m=c.renderDashed,f=c.centerPointRadius,g=Dn(s.canvas),p=ii(i),v=p.rowPixelSpacing,b=p.colPixelSpacing,x=xt("globalConfiguration").configuration.lineDash,w=(y.cornerstone.metaData.get("generalSeriesModule",i.imageId)||{}).modality,T=v&&b;Wt(g,(function(e){for(var s=0;s<n.data.length;s++){var c=n.data[s];if(!1!==c.visible){var g=un.getColorIfActive(c),p={color:g,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:h};Ln(e,t.configuration);var v=y.cornerstone.pixelToCanvas(r,c.handles.start),b=y.cornerstone.pixelToCanvas(r,c.handles.end),I=o(v,b),E={color:g};if(m&&(E.lineDash=x),$t(e,r,c.handles.start,I,E,"pixel"),f&&I>3*f&&$t(e,r,c.handles.start,f,E,"pixel"),c.handles&&(c.handles.start.drawnIndependently=!0,c.handles.end.drawnIndependently=!0),dn(e,a,c.handles,p),!0===c.invalidated&&(c.cachedStats?t.throttledUpdateCachedStats(i,r,c):t.updateCachedStats(i,r,c)),!c.handles.textBox.hasMoved){var S=nr(a.viewport,c.handles);Object.assign(c.handles.textBox,S)}var C=sr(e,i.color,c.cachedStats,w,T,t.configuration);c.unit=rr(w,t.configuration.showHounsfieldUnits),An(e,r,c.handles.textBox,C,c.handles,(function(e){return n=(t=ye(e.start,e.end)).left,o=t.top,[{x:n+(a=t.width)/2,y:o},{x:n,y:o+(i=t.height)/2},{x:n+a/2,y:o+i},{x:n+a,y:o+i/2}];var t,n,o,a,i}),g,l,10,!0)}}}))}}}]),t}(ga);function rr(e,t){return"CT"===e&&!1!==t?"HU":""}function sr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.area,a=void 0===o?0:o,i=n.radius,r=void 0===i?0:i,s=n.perimeter,l=void 0===s?0:s,c=n.mean,u=void 0===c?0:c,d=n.stdDev,h=void 0===d?0:d,m=n.min,f=void 0===m?0:m,g=n.max,p=void 0===g?0:g,v=n.meanStdDevSUV,y=void 0===v?0:v,b=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},T=w.showMinMax||!1,I=[],E=[];if(!t){var S=y&&0!==y.mean,C=rr(b,w.showHounsfieldUnits),A="Mean: ".concat(or(u.toFixed(2))," ").concat(C),M="Std Dev: ".concat(or(h.toFixed(2))," ").concat(C);if(S){for(var D=" SUV: ",P="".concat(D).concat(or(y.mean.toFixed(2))),L="".concat(D).concat(or(y.stdDev.toFixed(2))),k=Math.floor(e.measureText("".concat(M,"     ")).width);e.measureText(A).width<k;)A+=" ";E.push("".concat(A).concat(P)),E.push("".concat(M,"     ").concat(L))}else E.push("".concat(A,"     ").concat(M));if(T){for(var O="Min: ".concat(f," ").concat(C),R="Max: ".concat(p," ").concat(C),N=S?Math.floor(e.measureText("".concat(M,"     ")).width):Math.floor(e.measureText("".concat(A,"     ")).width);e.measureText(O).width<N;)O+=" ";E.push("".concat(O).concat(R))}}return I.push(lr(a,x)),r&&I.push(cr(r,"Radius",x)),l&&I.push(cr(l,"Perimeter",x)),E.forEach((function(e){return I.push(e)})),I}function lr(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(or(e.toFixed(2))).concat(n)}function cr(e,t,n){if(!e)return"";var o=n?" mm":" px";return"".concat(t,": ").concat(or(e.toFixed(1))).concat(o)}var ur=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ia,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,h()(t).call(this,n,o))).hasIncomplete=!1,e.throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(this.hasIncomplete)return!1;var o=pa(e,t.handles.start,t.handles.end,n)<25,a=pa(e,t.handles.start2,t.handles.end2,n)<25;return o||a}},{key:"updateCachedStats",value:function(e,t,n){var o=ii(e),a=o.rowPixelSpacing,i=o.colPixelSpacing,r=(Math.ceil(n.handles.start.x)-Math.ceil(n.handles.end.x))*(i||1),s=(Math.ceil(n.handles.start.y)-Math.ceil(n.handles.end.y))*(a||1),l=(Math.ceil(n.handles.start2.x)-Math.ceil(n.handles.end2.x))*(i||1),c=(Math.ceil(n.handles.start2.y)-Math.ceil(n.handles.end2.y))*(a||1),u=Math.acos(Math.abs((r*l+s*c)/(Math.sqrt(r*r+s*s)*Math.sqrt(l*l+c*c))));u*=180/Math.PI,n.rAngle=va(u,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=this.configuration,a=o.handleRadius,i=o.drawHandlesOnHover,r=o.hideHandlesIfMoving,s=o.renderDashed,l=k(e.currentTarget,this.name);if(l)for(var c=Dn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=xt("globalConfiguration").configuration.lineDash,h=vn.getFont(),m=e.detail.element,f=ii(y.cornerstone.getEnabledElement(m).image),g=f.rowPixelSpacing,p=f.colPixelSpacing,v=function(e){var o=l.data[e];if(!1===o.visible)return"continue";o.value||(o.value=t.textBoxText(o,g,p)),Wt(c,(function(e){Ln(e,t.configuration);var l=un.getColorIfActive(o),c={color:l};s&&(c.lineDash=d),Xt(e,n.element,o.handles.start,o.handles.end,c),o.complete&&Xt(e,n.element,o.handles.start2,o.handles.end2,c);var m={color:l,handleRadius:a,drawHandlesIfActive:i,hideHandlesIfMoving:r};t.configuration.drawHandles&&dn(e,n,o.handles,m),e.fillStyle=l;var f=o.value;if(!o.handles.textBox.hasMoved){var g={x:(o.handles.start.x+o.handles.end.x)/2,y:(o.handles.start.y+o.handles.end.y)/2-10};e.font=h,o.handles.textBox.x=g.x,o.handles.textBox.y=g.y}An(e,n.element,o.handles.textBox,f,o.handles,x,l,u,0,!0)}))},b=0;b<l.data.length;b++)v(b);function x(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=k(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))}},{key:"addNewMeasurement",value:function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var o,a,i=e.detail,r=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,a={toolName:n.name,toolType:n.name,element:s,measurementData:o};T(s,t,a)}else O(s,n.name,o)},s=e.detail.element,l=this.getIncomplete(s);l?((o=l).complete=!0,o.handles.start2={x:i.currentPoints.image.x,y:i.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},o.handles.end2={x:i.currentPoints.image.x,y:i.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},a=o.handles.end2,this.hasIncomplete=!1,r=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,a={toolName:n.name,toolType:n.name,element:s,measurementData:o};T(s,t,a)}else O(s,n.name,o)}):(o=this.createNewMeasurement(i),L(s,this.name,o),a=o.handles.end),y.cornerstone.updateImage(s),na(i,this.name,o,a,this.options,t,r)}},{key:"onMeasureModified",value:function(e){var t=e.detail.element,n=y.cornerstone.getEnabledElement(t).image,o=ii(n),a=o.rowPixelSpacing,i=o.colPixelSpacing;if(e.detail.toolName===this.name){var r=e.detail.measurementData;!0===r.invalidated&&(r.rAngle?this.throttledUpdateCachedStats(n,t,r):this.updateCachedStats(n,t,r)),r.value=this.textBoxText(r,a,i)}}},{key:"textBoxText",value:function(e,t,n){var o=e.rAngle;if(void 0===o)return"";if(Number.isNaN(o))return"";var a=t&&n?"":" (isotropic)";return"".concat(o,"").concat(a)}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(ga),dr=B("tools:annotation:EllipticalRoiTool"),hr=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Sa};return(e=u()(this,h()(t).call(this,n,o))).throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};dr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,o){var a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||dr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;if(yo(e,t.handles,n,6))return!0;var i="mouse"===o?15:25,r=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,s.x)+i/2,top:Math.min(r.y,s.y)+i/2,width:Math.abs(r.x-s.x)-i,height:Math.abs(r.y-s.y)-i},c={left:Math.min(r.x,s.x)-i/2,top:Math.min(r.y,s.y)-i/2,width:Math.abs(r.x-s.x)+i,height:Math.abs(r.y-s.y)+i},u=$i(l,n);return!(!$i(c,n)||u)}},{key:"updateCachedStats",value:function(e,t,n){var o=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,a=ii(e),i=function(e,t,n,o,a){var i,r=pr(n.start,n.end),s=y.cornerstone.getPixels(t,r.left,r.top,r.width,r.height),l=er(s,r);return"PT"===o&&(i={mean:Ji(e,l.mean,!0)||0,stdDev:Ji(e,l.stdDev,!0)||0}),{area:Math.PI*(r.width*(a.colPixelSpacing||1)/2)*(r.height*(a.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:i}}(e,t,n.handles,o,a);n.cachedStats=i,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=k(e.currentTarget,this.name);if(n){var o=e.detail,a=o.image,i=o.element,r=Zt.getToolWidth(),s=xt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,m=Dn(o.canvasContext.canvas),f=ii(a),g=f.rowPixelSpacing,p=f.colPixelSpacing,v=(y.cornerstone.metaData.get("generalSeriesModule",a.imageId)||{}).modality,b=g&&p;Wt(m,(function(e){for(var l=0;l<n.data.length;l++){var m=n.data[l];if(!1!==m.visible){var f=un.getColorIfActive(m),g={color:f,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};Ln(e,t.configuration);var p={color:f};if(h&&(p.lineDash=s),rn(e,i,m.handles.start,m.handles.end,p,"pixel",m.handles.initialRotation),dn(e,o,m.handles,g),!0===m.invalidated&&(m.cachedStats?t.throttledUpdateCachedStats(a,i,m):t.updateCachedStats(a,i,m)),!m.handles.textBox.hasMoved){var y=nr(o.viewport,m.handles);Object.assign(m.handles.textBox,y)}var x=fr(e,a.color,m.cachedStats,v,b,t.configuration);m.unit=mr(v,t.configuration.showHounsfieldUnits),An(e,i,m.handles.textBox,x,m.handles,(function(e){return n=(t=pr(e.start,e.end)).left,o=t.top,[{x:n+(a=t.width)/2,y:o},{x:n,y:o+(i=t.height)/2},{x:n+a/2,y:o+i},{x:n+a,y:o+i/2}];var t,n,o,a,i}),f,r,10,!0)}}}))}}}]),t}(ga);function mr(e,t){return"CT"===e&&!1!==t?"HU":""}function fr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.area,a=void 0===o?0:o,i=n.mean,r=void 0===i?0:i,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,h=void 0===d?0:d,m=n.meanStdDevSUV,f=void 0===m?0:m,g=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=v.showMinMax||!1,b=[],x=[];if(!t){var w=f&&0!==f.mean,T=mr(g,v.showHounsfieldUnits),I="Mean: ".concat(or(r.toFixed(2))," ").concat(T),E="Std Dev: ".concat(or(l.toFixed(2))," ").concat(T);if(w){for(var S=" SUV: ",C="".concat(S).concat(or(f.mean.toFixed(2))),A="".concat(S).concat(or(f.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(E,"     ")).width);e.measureText(I).width<M;)I+=" ";x.push("".concat(I).concat(C)),x.push("".concat(E,"     ").concat(A))}else x.push("".concat(I)),x.push("".concat(E));if(y){for(var D="Min: ".concat(u," ").concat(T),P="Max: ".concat(h," ").concat(T),L=w?Math.floor(e.measureText("".concat(E,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(D).width<L;)D+=" ";x.push("".concat(D).concat(P))}}return b.push(gr(a,p)),x.forEach((function(e){return b.push(e)})),b}function gr(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(or(e.toFixed(2))).concat(n)}function pr(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var vr=function(e,t){for(var n=!1,o=e.length-1,a=0;a<e.length;a++)yr(t,e[a],e[o])&&(n=!n),o=a;return n};function yr(e,t,n){return o=e.y,a=t.y,i=n.y,!(!(a<o&&o<i||i<o&&o<a)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var o=t;t=n,n=o}var a=function(e,t,n){var o=(n.y-t.y)/(n.x-t.x);return{value:t.y+o*(e.x-t.x),gradient:o}}(e,t,n);return Math.sign(a.gradient)*e.y>Math.sign(a.gradient)*a.value}(e,t,n));var o,a,i}function br(e,t,n,o){vr(e,t)&&(n.value+=o,n.squared+=o*o,n.count++)}var xr=function e(t,n){r()(this,e),this.toolIndex=t,this.handleIndexArray=n},wr=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=o,this.lines=[]};function Tr(e,t,n,o){for(var a=e.length-1,i=0;i<e.length;i++)if(-1===o.indexOf(i)&&-1===o.indexOf(a)){if(Ir(t,n,Er(e[a]),Er(e[i])))return!0;a=i}else a=i;return!1}function Ir(e,t,n,o){var a=!1,i=[Sr(e,t,n),Sr(e,t,o),Sr(n,o,e),Sr(n,o,t)];return i[0]!==i[1]&&i[2]!==i[3]||((0===i[0]&&Cr(e,n,t)||0===i[1]&&Cr(e,o,t)||0===i[2]&&Cr(n,e,o)||0===i[3]&&Cr(n,t,o))&&(a=!0),a)}function Er(e){return{x:e.x,y:e.y}}function Sr(e,t,n){var o=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===o?0:o>0?1:2}function Cr(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}var Ar={newHandle:function(e,t){var n=t.length-1;return Tr(t,Er(t[n]),Er(e),[n])},end:function(e){var t=e.length-1;return Tr(e,Er(e[t]),Er(e[0]),[t,0])},modify:function(e,t){var n=Er(e[t]),o=t-1;0===t&&(o=e.length-1);var a=Er(e[o]);return!!Tr(e,n,a,[t,o])||Tr(e,n,a=Er(e[o=t===e.length-1?0:t+1]),[t,o])}},Mr=function(){function e(t,n){r()(this,e),this._eventData=t,this._toolName=n}return l()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=k(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var o=this._nearestHandleToPoint(n);null!==o&&o.distance<t.distance&&(t=o)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],o=n.handles.points;if(void 0===o)return null;if(!1===n.visible)return null;for(var a={toolIndex:e,handleIndex:null,distance:1/0},i=0;i<o.length;i++){var r=y.cornerstone.pixelToCanvas(t.element,o[i]),s=y.cornerstoneMath.point.distance(r,this._mousePoint);s<a.distance&&(a.handleIndex=i,a.distance=s)}return a}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,o=[],a=0;a<n.length;a++){var i=e.getNextHandleIndex(a,n.length);this._distanceOfPointfromLine(n[a],n[i])<10&&o.push([a,i])}return o}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new xr(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var o=this._eventData,a=this._toolData.data[t],i=a.handles.points;if(void 0!==a.handles.points){if(!1===a.visible)return!1;var r=i[n[0]],s=i[n[1]],l=e.getCanvasPointsFromHandles(r,s,o.element),c=e.getLineAsVector(l),u=this._getLineOriginToMouseAsVector(l),d=(u[0]*c[0]+u[1]*c[1])/c.magnitude;return d>0&&d<c.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,o=y.cornerstone.pixelToCanvas(n.element,e),a=y.cornerstone.pixelToCanvas(n.element,t),i=this._mousePoint;return Math.abs((a.y-o.y)*i.x-(a.x-o.x)*i.y+a.x*o.y-a.y*o.x)/y.cornerstoneMath.point.distance(o,a)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var o=[];return e.x<t.x?(o.push(y.cornerstone.pixelToCanvas(n,e)),o.push(y.cornerstone.pixelToCanvas(n,t))):(o.push(y.cornerstone.pixelToCanvas(n,t)),o.push(y.cornerstone.pixelToCanvas(n,e))),o}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=y.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),Dr=function(e,t){t===e.length-1?e[t].lines.push(e[0]):e[t].lines.push(e[t+1])};function Pr(e,t){var n=k(e.element,this.name);if(void 0!==n){var o=t.handleIndex,a=t.toolIndex,i=n.data[a],r=i.handles.points;r.length<=3||(o===r.length-1?(r[o-1].lines.pop(),r[o-1].lines.push(r[0])):0===o?(r[r.length-1].lines.pop(),r[r.length-1].lines.push(r[o+1])):(r[o-1].lines.pop(),r[o-1].lines.push(r[o+1])),r.splice(o,1),i.invalidated=!0,i.active=!0,i.highlight=!0,y.cornerstone.updateImage(e.element))}}function Lr(e,t){var n=k(e.element,this.name);if(void 0!==n){var o=n.data[t.toolIndex],a=function(e){for(var t=e.handleIndexArray,n=1/0,o=t.includes(0),a=0;a<t.length;a++){var i=t[a];0!==i&&i<n&&(n=i)}return o&&1===n&&(n=0),++n}(t);if(a!==1/0){var i=new wr(e.currentPoints.image),r=o.handles.points;r.splice(a,0,i),r[a-1].lines.pop(),r[a-1].lines.push(e.currentPoints.image),Dr(r,a),o.active=!0,o.highlight=!0,o.invalidated=!0,y.cornerstone.updateImage(e.element)}}}var kr={calculateFreehandStatistics:function(e,t,n){var o={count:0,mean:0,variance:0,stdDev:0},a=function(e,t,n){for(var o={value:0,squared:0,count:0},a=0,i=t.top;i<t.top+t.height;i++)for(var r=t.left;r<t.left+t.width;r++)br(n,{x:r,y:i},o,e[a]),a++;return o}(e,t,n);return 0===a.count||(o.count=a.count,o.mean=a.value/a.count,o.variance=a.squared/a.count-o.mean*o.mean,o.stdDev=Math.sqrt(o.variance)),o},ClickedLineData:xr,freehandArea:function(e,t){var n=0,o=e.length-1;t=t||1;for(var a=0;a<e.length;a++)n+=(e[o].x+e[a].x)*(e[o].y-e[a].y),o=a;return Math.abs(n*t/2)},FreehandHandleData:wr,freehandIntersect:Ar,FreehandLineFinder:Mr,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby){var o={toolIndex:t.toolIndex,handleIndex:t.handleNearby};Pr.call(this,n,o)}else{var a=new Mr(n,this.name).findLine();a&&Lr.call(this,n,a)}},pointInFreehand:vr,addLine:Dr},Or=B("tools:annotation:FreehandRoiTool"),Rr=kr.insertOrDelete,Nr=kr.freehandArea,_r=kr.calculateFreehandStatistics,Ur=kr.freehandIntersect,Br=kr.FreehandHandleData,Vr=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1},svgCursor:Ca};return(e=u()(this,h()(t).call(this,n,o))).isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(Co()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(Co()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(Co()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(Co()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(Co()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(Co()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(Co()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(Co()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(Co()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(Co()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(Co()(e)),e.throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}Or.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var o=t&&t.handles&&t.handles.points;if(!o)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!o||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var o=1/0,a=0;a<t.handles.points.length;a++){var i=y.cornerstoneMath.point.distance(t.handles.points[a],n);o=Math.min(o,i)}return o===1/0?-1:o}},{key:"distanceFromPointCanvas",value:function(e,t,n){var o=1/0;if(!t)return-1;for(var a=y.cornerstone.pixelToCanvas(e,n),i=t.handles.points,r=0;r<i.length;r++){var s=y.cornerstone.pixelToCanvas(e,i[r]),l=y.cornerstoneMath.point.distance(s,a);o=Math.min(o,l)}return o===1/0?-1:o}},{key:"updateCachedStats",value:function(e,t,n){for(var o,a,i=y.cornerstone.metaData.get("generalSeriesModule",e.imageId),r=i?i.modality:null,s=n.handles.points,l={left:s[0].x,right:s[0].x,bottom:s[0].y,top:s[0].x},c=0;c<s.length;c++)l.left=Math.min(l.left,s[c].x),l.right=Math.max(l.right,s[c].x),l.bottom=Math.min(l.bottom,s[c].y),l.top=Math.max(l.top,s[c].y);var u={left:l.left,top:l.bottom,width:Math.abs(l.right-l.left),height:Math.abs(l.top-l.bottom)};if(n.polyBoundingBox=u,!e.color){var d=y.cornerstone.getPixels(t,u.left,u.top,u.width,u.height);o=_r.call(this,d,u,n.handles.points),"PT"===r&&(a={mean:Ji(e,(o.mean-e.intercept)/e.slope),stdDev:Ji(e,(o.stdDev-e.intercept)/e.slope)}),o&&!isNaN(o.mean)&&(n.meanStdDev=o,n.meanStdDevSUV=a)}var h=ii(e),m=(h.colPixelSpacing||1)*(h.rowPixelSpacing||1),f=Nr(n.handles.points,m);isNaN(f)||(n.area=f),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=k(e.currentTarget,this.name);if(o)for(var a=n.image,i=n.element,r=this.configuration,s=y.cornerstone.metaData.get("generalSeriesModule",a.imageId),l=s?s.modality:null,c=Dn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=r.renderDashed,h=xt("globalConfiguration").configuration.lineDash,m=function(e){var s=o.data[e];if(!1===s.visible)return"continue";Wt(c,(function(e){var o,l=un.getColorIfActive(s);s.active?s.handles.invalidHandlePlacement?(l=r.invalidColor,o=r.invalidColor):(l=un.getColorIfActive(s),o=un.getFillColor()):o=un.getToolColor();var c={color:l};if(d&&(c.lineDash=h),s.handles.points.length){var m=s.handles.points;Jt(e,i,m[0],m,c),s.polyBoundingBox?Jt(e,i,m[m.length-1],[m[0]],c):Jt(e,i,m[m.length-1],[r.mouseLocation.handles.start],c)}if(c={color:l,fill:o},(r.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(c.handleRadius=r.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,s.handles.points,c)),s.canComplete){c.handleRadius=r.completeHandleRadius;var f=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[f],c)}if(s.active&&!s.polyBoundingBox){c.handleRadius=r.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,r.mouseLocation.handles,c);var v=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[v],c)}if(!0!==s.invalidated||s.active||(s.meanStdDev&&s.meanStdDevSUV&&s.area?t.throttledUpdateCachedStats(a,i,s):t.updateCachedStats(a,i,s)),s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var y=g.call(t,s);An(e,i,s.handles.textBox,y,s.handles.points,p,l,u,0,!0)}}))},f=0;f<o.data.length;f++)m(f);function g(e){var t=e.meanStdDev,n=e.meanStdDevSUV,o=e.area,i=[];if(t&&void 0!==t.mean){var r="";"CT"===l&&(r="HU"),e.unit=r;var s="Mean: ".concat(or(t.mean.toFixed(2))," ").concat(r),c="StdDev: ".concat(or(t.stdDev.toFixed(2))," ").concat(r);n&&void 0!==n.mean&&(s+=" SUV: "+or(n.mean.toFixed(2)),c+=" SUV: "+or(n.stdDev.toFixed(2))),i.push(s),i.push(c)}if(o){var u=" mm".concat(String.fromCharCode(178)),d=ii(a),h=d.rowPixelSpacing,m=d.colPixelSpacing;h&&m||(u=" pixels".concat(String.fromCharCode(178)));var f="Area: ".concat(or(o.toFixed(2))).concat(u);i.push(f)}return i}function p(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),Fr(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||Rr.call(this,e,n),Fr(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",a=e.detail.element,i=k(a,this.name);if(n.hasBoundingBox)da(e,this,t,n,o);else{var r=this.configuration;r.dragOrigin={x:n.x,y:n.y};for(var s=0;s<i.data.length;s++)for(var l=i.data[s].handles.points,c=0;c<l.length;c++)l[c]===n&&(r.currentHandle=c,r.currentTool=s);this._modifying=!0,this._activateModify(a),Fr(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.currentPoints,o=t.element,a=k(o,this.name),i=this.configuration,r=i.currentTool,s=a.data[r],l=n.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(s,t);var c=this._pointNearHandle(o,s,l),u=s.handles.points;void 0!==c&&!c.hasBoundingBox&&c<u.length-1&&(i.mouseLocation.handles.start.x=u[c].x,i.mouseLocation.handles.start.y=u[c].y),y.cornerstone.updateImage(o)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=t.element,o=k(n,this.name),a=this.configuration.currentTool,i=o.data[a];this._getMouseLocation(t),this._checkInvalidHandleLocation(i,t),this._addPointPencilMode(t,i.handles.points),this._dragging=!0,y.cornerstone.updateImage(n)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;if(this._dragging){this._dragging=!1;var n=this.configuration,o=n.currentTool,a=k(t,this.name).data[o];if(!Ur.end(a.handles.points)&&a.canComplete){var i=n.currentHandle;this._endDrawing(t,i)}Fr(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.buttons,o=t.currentPoints,a=t.element;if(this.options.mouseButtonMask.includes(n)){var i=o.canvas,r=this.configuration,s=r.currentTool,l=k(a,this.name).data[s],c=this._pointNearHandle(a,l,i);if(!Ur.end(l.handles.points)&&l.canComplete){var u=r.currentHandle;this._endDrawing(a,u)}else void 0===c&&this._addPoint(t);Fr(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.currentPoints,o=t.element,a=n.canvas,i=this.configuration,r=i.currentTool,s=k(o,this.name).data[r],l=this._pointNearHandle(o,s,a);if(!Ur.end(s.handles.points)&&s.canComplete){var c=i.currentHandle;this._endDrawing(o,c)}else void 0===l&&this._addPoint(t);Fr(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=k(e,this.name),n=this.configuration,o=t.data[n.currentTool];if(!Ur.end(o.handles.points)&&o.handles.points.length>=2){var a=n.currentHandle;o.polyBoundingBox={},this._endDrawing(e,a)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fr(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fr(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=t.element,o=t.buttons;if(this.options.mouseButtonMask.includes(o)){var a,i=k(n,this.name),r=this.configuration,s=i.data[r.currentTool],l=r.currentHandle,c=s.handles.points;if(this._getMouseLocation(t),s.handles.invalidHandlePlacement=Ur.modify(c,l),s.active=!0,s.highlight=!0,c[l].x=r.mouseLocation.handles.start.x,c[l].y=r.mouseLocation.handles.start.y,a=this._getPrevHandleIndex(l,c),l>=0){var u=c[a].lines.length-1,d=c[a].lines[u];d.x=r.mouseLocation.handles.start.x,d.y=r.mouseLocation.handles.start.y}y.cornerstone.updateImage(n)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,o=n.element,a=k(o,this.name),i=this.configuration,r=a.data[i.currentTool],s=i.currentHandle,l=r.handles.points;if(this._getMouseLocation(n),r.handles.invalidHandlePlacement=Ur.modify(l,s),r.active=!0,r.highlight=!0,l[s].x=i.mouseLocation.handles.start.x,l[s].y=i.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(s,l),s>=0){var c=l[t].lines.length-1,u=l[t].lines[c];u.x=i.mouseLocation.handles.start.x,u.y=i.mouseLocation.handles.start.y}y.cornerstone.updateImage(o)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,o=k(n,this.name);this._deactivateModify(n),this._dropHandle(t,o),this._endDrawing(n),y.cornerstone.updateImage(n)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,o=n.currentTool,a=t.data[o].handles,i=a.points;if(a.invalidHandlePlacement){var r,s=n.currentHandle,l=i[s];r=0===s?i[i.length-1]:i[s-1],l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,r.lines[0]=l,a.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,o=this.createNewMeasurement(n),a=n.element,i=this.configuration;e.type===w.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===w.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(a,t),this._getMouseLocation(n),L(a,this.name,o);var r=k(a,this.name);i.currentTool=r.data.length-1,this._activeDrawingToolReference=r.data[i.currentTool]}},{key:"_addPoint",value:function(e){var t=e.currentPoints,n=e.element,o=k(n,this.name),a=this.configuration,i=o.data[a.currentTool];if(!i.handles.invalidHandlePlacement){var r=new Br(t.image);i.handles.points.length&&i.handles.points[a.currentHandle-1].lines.push(t.image),i.handles.points.push(r),a.currentHandle+=1,y.cornerstone.updateImage(n),this.fireModifiedEvent(n,i)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,o=this.configuration,a=e.element,i=o.mouseLocation.handles.start;t.every((function(e){return n._isDistanceLargerThanSpacing(a,e,i)}))&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=k(e,this.name),o=this.configuration,a=n.data[o.currentTool];if(a.active=!1,a.highlight=!1,a.handles.invalidHandlePlacement=!1,void 0!==t){var i=a.handles.points;i[o.currentHandle-1].lines.push(i[0])}this._modifying&&(this._modifying=!1,a.invalidated=!0),o.currentHandle=0,o.currentTool=-1,a.canComplete=!1,this._drawing&&this._deactivateDraw(e),y.cornerstone.updateImage(e),this.fireModifiedEvent(e,a),this.fireCompletedEvent(e,a)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var o=0;o<t.handles.points.length;o++){var a=y.cornerstone.pixelToCanvas(e,t.handles.points[o]);if(y.cornerstoneMath.point.distance(a,n)<6)return o}return t.handles.textBox&&po(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.currentPoints,n=e.element,o=t.canvas,a=k(n,this.name);if(a)for(var i,r=0;r<a.data.length;r++)if(void 0!==(i=this._pointNearHandle(n,a.data[r],o)))return{handleNearby:i,toolIndex:r}}},{key:"_getMouseLocation",value:function(e){var t=e.currentPoints,n=e.image,o=this.configuration;o.mouseLocation.handles.start.x=t.image.x,o.mouseLocation.handles.start.y=t.image.y,In(o.mouseLocation.handles.start,n)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(e.handles.points.length<2)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,o=t.element,a=n.mouseLocation.handles.start,i=e.handles.points,r=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(o,i[0],a)&&!Ur.end(i)&&i.length>2?(e.canComplete=!0,r=!1):r=Ur.newHandle(a,i),r}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,o=e.handles.points,a=Ur.newHandle(n,o);return!1===a&&(a=this._invalidHandlePencilMode(e,t)),a}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,o=t.element,a=n.mouseLocation.handles.start,i=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(o,i[0],a))return e.canComplete=!0,!1;e.canComplete=!1;for(var r=1;r<i.length-1;r++)if(this._isDistanceSmallerThanSpacing(o,i[r],a))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var o,a=y.cornerstone.pixelToCanvas(e,t),i=y.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?o=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(o=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,a,i,"<",o)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===o?y.cornerstoneMath.point.distance(t,n)>a:y.cornerstoneMath.point.distance(t,n)<a}},{key:"_activateDraw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,vt.isMultiPartToolActive=!0,St(this.element),e.addEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(w.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(w.DOUBLE_TAP,this._drawingDoubleTapClickCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,vt.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,Et(this.element,this.svgCursor),e.removeEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(w.TOUCH_END,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){vt.isToolLocked=!0,e.addEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(w.TOUCH_END,this._editMouseUpCallback),e.addEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){vt.isToolLocked=!1,e.removeEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),y.cornerstone.updateImage(e)}}},{key:"fireModifiedEvent",value:function(e,t){T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"fireCompletedEvent",value:function(e,t){T(e,w.MEASUREMENT_COMPLETED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=k(e,this.name),n=this.configuration,o=t.data[n.currentTool];o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,o.canComplete=!1,O(e,this.name,o),this._deactivateDraw(e),y.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,o=this._activeDrawingToolReference;o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1;var a=o.handles.points;a[t.currentHandle-1].lines.push(a[0]),t.currentHandle=0,t.currentTool=-1,o.canComplete=!1,this._deactivateDraw(n),y.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,y.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,y.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,y.cornerstone.updateImage(this.element)}}]),t}(ga);function Fr(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}var Hr=B("tools:annotation:LengthTool"),jr=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ma,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return(e=u()(this,h()(t).call(this,n,o))).throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,o=t.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:n,y:o,highlight:!0,active:!1},end:{x:n,y:o,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}Hr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&pa(e,t.handles.start,t.handles.end,n)<25:(Hr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(e,t,n){var o=ii(e),a=o.rowPixelSpacing,i=o.colPixelSpacing,r=(n.handles.end.x-n.handles.start.x)*(i||1),s=(n.handles.end.y-n.handles.start.y)*(a||1),l=Math.sqrt(r*r+s*s);n.length=l,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=this.configuration,a=o.handleRadius,i=o.drawHandlesOnHover,r=o.hideHandlesIfMoving,s=o.renderDashed,l=o.digits,c=k(e.currentTarget,this.name);if(c)for(var u=Dn(n.canvasContext.canvas),d=n.image,h=n.element,m=ii(d),f=m.rowPixelSpacing,g=m.colPixelSpacing,p=Zt.getToolWidth(),v=xt("globalConfiguration").configuration.lineDash,y=function(e){var o=c.data[e];if(!1===o.visible)return"continue";Wt(u,(function(e){Ln(e,t.configuration);var c=un.getColorIfActive(o),u={color:c};s&&(u.lineDash=v),Xt(e,h,o.handles.start,o.handles.end,u);var m={color:c,handleRadius:a,drawHandlesIfActive:i,hideHandlesIfMoving:r};if(t.configuration.drawHandles&&dn(e,n,o.handles,m),!o.handles.textBox.hasMoved){var y={x:Math.max(o.handles.start.x,o.handles.end.x)};y.x===o.handles.start.x?y.y=o.handles.start.y:y.y=o.handles.end.y,o.handles.textBox.x=y.x,o.handles.textBox.y=y.y}!0===o.invalidated&&(o.length?t.throttledUpdateCachedStats(d,h,o):t.updateCachedStats(d,h,o));var b=function(e,t,n){var o,a,i=(o=e.length,a=Number(o),isNaN(a)?void 0:a);if(!i)return"";var r="mm";return t&&n||(r="pixels"),e.unit=r,"".concat(i.toFixed(l)," ").concat(r)}(o,f,g);An(e,h,o.handles.textBox,b,o.handles,x,c,p,10,!0)}))},b=0;b<c.data.length;b++)y(b);function x(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}}]),t}(ga),zr=function(e,t,n,o,a){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i,r,s,l=y.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(r=0;r<a;r++)for(s=0;s<o;s++){var h=d[i=4*((r+n)*l.image.columns+(s+t))],m=d[i+1],f=d[i+2],g=d[i+3];c[u++]=h,c[u++]=m,c[u++]=f,c[u++]=g}return c},qr=B("tools:annotation:ProbeTool"),Wr=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Da,configuration:{drawHandles:!0,renderDashed:!1}};return(e=u()(this,h()(t).call(this,n,o))).throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};qr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var o=t&&t.handles&&t.handles.end;if(o||qr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var a=y.cornerstone.pixelToCanvas(e,t.handles.end);return y.cornerstoneMath.point.distance(a,n)<5}},{key:"updateCachedStats",value:function(e,t,n){var o=Math.round(n.handles.end.x),a=Math.round(n.handles.end.y),i={};o>=0&&a>=0&&o<e.columns&&a<e.rows&&(i.x=o,i.y=a,e.color?i.storedPixels=zr(t,o,a,1,1):(i.storedPixels=y.cornerstone.getStoredPixels(t,o,a,1,1),i.sp=i.storedPixels[0],i.mo=i.sp*e.slope+e.intercept,i.suv=Ji(e,i.sp))),n.cachedStats=i,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=this.configuration,a=o.handleRadius,i=o.renderDashed,r=k(e.currentTarget,this.name);if(r)for(var s=Dn(n.canvasContext.canvas),l=n.image,c=n.element,u=vn.getFontSize(),d=xt("globalConfiguration").configuration.lineDash,h=function(e){var o=r.data[e];if(!1===o.visible)return"continue";Wt(s,(function(e){var r,s,h=un.getColorIfActive(o);if(t.configuration.drawHandles){var m={handleRadius:a,color:h};i&&(m.lineDash=d),dn(e,n,o.handles,m)}!0===o.invalidated&&(o.cachedStats?t.throttledUpdateCachedStats(l,c,o):t.updateCachedStats(l,c,o));var f=o.cachedStats,g=f.x,p=f.y,v=f.storedPixels,b=f.sp,x=f.mo,w=f.suv;if(g>=0&&p>=0&&g<l.columns&&p<l.rows){r="".concat(g,", ").concat(p),l.color?s="R: ".concat(v[0]," G: ").concat(v[1]," B: ").concat(v[2]):(s="SP: ".concat(b," MO: ").concat(parseFloat(x.toFixed(3))),w&&(s+=" SUV: ".concat(parseFloat(w.toFixed(3)))));var T={x:o.handles.end.x+3,y:o.handles.end.y-3},I=y.cornerstone.pixelToCanvas(n.element,T);wn(e,s,I.x,I.y+u+5,h),wn(e,r,I.x,I.y,h)}}))},m=0;m<r.data.length;m++)h(m)}}]),t}(ga),Gr=B("tools:annotation:RectangleRoiTool"),Yr=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Pa};return(e=u()(this,h()(t).call(this,n,o))).throttledUpdateCachedStats=li(e.updateCachedStats,110),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Gr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,o){var a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||Gr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;var i="mouse"===o?15:25,r=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,s.x),top:Math.min(r.y,s.y),width:Math.abs(r.x-s.x),height:Math.abs(r.y-s.y)};return y.cornerstoneMath.rect.distanceToPoint(l,n)<i}},{key:"updateCachedStats",value:function(e,t,n){var o=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,a=ii(e),i=function(e,t,n,o,a){var i,r=Zr(n.start,n.end),s=function(e,t){for(var n=0,o=0,a=0,i=0,r=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[i],o+=e[i]*e[i],r=Math.min(r,e[i]),s=Math.max(s,e[i]),a++,i++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/a,d=o/a-u*u;return{count:a,mean:u,variance:d,stdDev:Math.sqrt(d),min:r,max:s}}(y.cornerstone.getPixels(t,r.left,r.top,r.width,r.height),r);return"PT"===o&&(i={mean:Ji(e,s.mean,!0)||0,stdDev:Ji(e,s.stdDev,!0)||0}),{area:r.width*(a.colPixelSpacing||1)*(r.height*(a.rowPixelSpacing||1))||0,perimeter:2*r.width*(a.colPixelSpacing||1)+2*r.height*(a.rowPixelSpacing||1),count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:i}}(e,t,n.handles,o,a);n.cachedStats=i,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=k(e.currentTarget,this.name);if(n){var o=e.detail,a=o.image,i=o.element,r=Zt.getToolWidth(),s=xt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,h=l.renderDashed,m=Dn(o.canvasContext.canvas),f=ii(a),g=f.rowPixelSpacing,p=f.colPixelSpacing,v=(y.cornerstone.metaData.get("generalSeriesModule",a.imageId)||{}).modality,b=g&&p;Wt(m,(function(e){for(var l=0;l<n.data.length;l++){var m=n.data[l];if(!1!==m.visible){var f=un.getColorIfActive(m),g={color:f,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};Ln(e,t.configuration);var p={color:f};if(h&&(p.lineDash=s),Mn(e,i,m.handles.start,m.handles.end,p,"pixel",m.handles.initialRotation),t.configuration.drawHandles&&dn(e,o,m.handles,g),!0===m.invalidated&&(m.cachedStats?t.throttledUpdateCachedStats(a,i,m):t.updateCachedStats(a,i,m)),!m.handles.textBox.hasMoved){var y=nr(o.viewport,m.handles);Object.assign(m.handles.textBox,y)}var x=Jr(e,a.color,m.cachedStats,v,b,t.configuration);m.unit=Xr(v,t.configuration.showHounsfieldUnits),An(e,i,m.handles.textBox,x,m.handles,(function(e){return n=(t=Zr(e.start,e.end)).left,o=t.top,[{x:n+(a=t.width)/2,y:o},{x:n,y:o+(i=t.height)/2},{x:n+a/2,y:o+i},{x:n+a,y:o+i/2}];var t,n,o,a,i}),f,r,10,!0)}}}))}}}]),t}(ga);function Zr(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function Kr(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(or(e.toFixed(2))).concat(n)}function Xr(e,t){return"CT"===e&&!1!==t?"HU":""}function Jr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.area,a=void 0===o?0:o,i=n.mean,r=void 0===i?0:i,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,h=void 0===d?0:d,m=n.meanStdDevSUV,f=void 0===m?0:m,g=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=v.showMinMax||!1,b=[],x=[];if(!t){var w=f&&0!==f.mean,T=Xr(g,v.showHounsfieldUnits),I="Mean: ".concat(or(r.toFixed(2))," ").concat(T),E="Std Dev: ".concat(or(l.toFixed(2))," ").concat(T);if(w){for(var S=" SUV: ",C="".concat(S).concat(or(f.mean.toFixed(2))),A="".concat(S).concat(or(f.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(E,"     ")).width);e.measureText(I).width<M;)I+=" ";x.push("".concat(I).concat(C)),x.push("".concat(E,"     ").concat(A))}else x.push("".concat(I)),x.push("".concat(E));if(y){for(var D="Min: ".concat(u," ").concat(T),P="Max: ".concat(h," ").concat(T),L=w?Math.floor(e.measureText("".concat(E,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(D).width<L;)D+=" ";x.push("".concat(D).concat(P))}}return b.push(Kr(a,p)),x.forEach((function(e){return b.push(e)})),b}var Qr=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:$r},svgCursor:La};return(e=u()(this,h()(t).call(this,n,o))).touchPressCallback=e._changeText.bind(Co()(e)),e.doubleClickCallback=e._changeText.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},o={left:0,top:0,width:e.image.width,height:e.image.height};if(y.cornerstoneMath.point.insideRect(n.handles.end,o)){var a=t.markers.indexOf(t.current);return(a+=t.ascending?1:-1)>=t.markers.length?a=t.loop?0:-1:a<0&&(a=t.loop?t.markers.length:-1),t.current=t.markers[a],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var o=y.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),a=po(t.handles.end,n);return o<10||a}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,o=k(t.element,this.name);if(o)for(var a=Dn(t.canvasContext.canvas),i=function(e){var i=o.data[e];if(!1===i.visible)return"continue";var r=un.getColorIfActive(i);Wt(a,(function(e){Ln(e,n);var o=y.cornerstone.pixelToCanvas(t.element,i.handles.end);i.handles.end.boundingBox=wn(e,i.text,o.x,o.y-10,r,{centering:{x:!0,y:!0}})}))},r=0;r<o.data.length;r++)i(r)}},{key:"_changeText",value:function(e){var t,n=e.detail,o=n.element,a=n.currentPoints;function i(e,t,n){!0===n?O(o,this.name,e):e.text=t,e.active=!1,y.cornerstone.updateImage(o)}var r=this.configuration,s=a.canvas,l=k(o,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(o,t,s))return t.active=!0,y.cornerstone.updateImage(o),r.changeTextCallback(t,n,i),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(ga),$r=function(e,t,n){n(e,prompt("Change your annotation:"))},es=(B("tools:BrushTool"),xt("segmentation")),ts=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return(e=u()(this,h()(t).call(this,n,o))).touchDragCallback=e._paint.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_paint",value:function(e){var t=es.configuration,n=e.detail,o=(n.element,n.image),a=o.rows,i=o.columns,r=n.currentPoints.image,s=r.x,l=r.y;if(!(s<0||s>i||l<0||l>a)){var c=we(t.radius,a,i,s,l),u=this.paintEventData,d=u.labelmap2D,h=u.labelmap3D,m=u.shouldErase;te(c,d.pixelData,h.activeSegmentIndex,i,m),y.cornerstone.updateImage(e.detail.element)}}}]),t}(Do),ns=B("tools:SphericalBrushTool"),os=xt("segmentation"),as=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return(e=u()(this,h()(t).call(this,n,o))).touchDragCallback=e._paint.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_startPainting",value:function(e){var t,n=os.configuration,o=os.getters,a=e.detail,i=a.element,r=a.image,s=y.cornerstone,l=n.radius,c=r.rows,u=r.columns,d=Math.max(r.rowPixelSpacing,r.columnPixelSpacing),h=k(i,"stack").data[0].imageIds,m=o.labelmap2D(i),f=m.labelmap2D,g=m.labelmap3D,p=m.currentImageIdIndex,v=m.activeLabelmapIndex,b=this._isCtrlDown(a)||this.configuration.alwaysEraseOnClick,x=s.metaData.get("imagePlaneModule",r.imageId);if(x){var w=x.imagePositionPatient;t=this._getImagesInRange(p,w,h,l,d)}else ns.warn("No imagePlane metadata found for image, defaulting to circle brush application."),t=[{imageIdIndex:p,radiusOnImage:l}];if(this.paintEventData={labelmap2D:f,labelmap3D:g,currentImageIdIndex:p,activeLabelmapIndex:v,shouldErase:b,imagesInRange:t},n.storeHistory){for(var T=[],I=0;I<t.length;I++){var E=t[I].imageIdIndex,S=o.labelmap2DByImageIdIndex(g,E,c,u).pixelData.slice();T.push(S)}this.paintEventData.previousPixeldataForImagesInRange=T}}},{key:"_paint",value:function(e){var t=os.getters,n=e.detail,o=(n.element,n.image),a=o.rows,i=o.columns,r=n.currentPoints.image,s=r.x,l=r.y;if(!(s<0||s>i||l<0||l>a)){for(var c=this.paintEventData,u=c.labelmap3D,d=c.imagesInRange,h=c.shouldErase,m=0;m<d.length;m++){var f=d[m],g=f.imageIdIndex;te(we(f.radiusOnImage,a,i,s,l),t.labelmap2DByImageIdIndex(u,g,a,i).pixelData,u.activeSegmentIndex,i,h)}y.cornerstone.updateImage(e.detail.element)}}},{key:"_getImagesInRange",value:function(e,t,n,o,a){for(var i=o*a,r=[{imageIdIndex:e,radiusOnImage:o}],s=e+1;s<n.length;s++){var l=this._getRadiusOnImage(n[s],t,i,a);if(!l)break;r.push({imageIdIndex:s,radiusOnImage:l})}for(var c=e-1;c>=0;c--){var u=this._getRadiusOnImage(n[c],t,i,a);if(!u)break;r.push({imageIdIndex:c,radiusOnImage:u})}return r}},{key:"_getRadiusOnImage",value:function(e,t,n,o){var a=y.cornerstone.metaData.get("imagePlaneModule",e);if(a){var i=a.imagePositionPatient,r=Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)+Math.pow(i[2]-t[2],2));if(!(r>n))return Math.floor(Math.sqrt(Math.pow(n,2)-Math.pow(r,2))/o)}else ns.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(e,","))}},{key:"_endPainting",value:function(e){for(var t=this.paintEventData,n=t.labelmap3D,o=t.imagesInRange,a=[],i=os.configuration,r=os.setters,s=0;s<o.length;s++){for(var l=o[s].imageIdIndex,c=n.labelmaps2D[l],u=new Set(c.pixelData).values(),d=[],h=!1;!h;){var m=u.next();(h=m.done)||d.push(m.value)}if(c.segmentsOnLabelmap=d,i.storeHistory){var f=this.paintEventData.previousPixeldataForImagesInRange[s],g=n.labelmaps2D[l].pixelData;a.push({imageIdIndex:l,diff:Oe(f,g)})}}i.storeHistory&&r.pushState(this.element,a),ke(this.element)}}]),t}(Do),is=B("util:segmentation:operations:correction");function rs(e,t){var n=t.pixelData,o=t.segmentIndex,a=t.segmentationMixinType;if("freehandSegmentationMixin"===a){var i=function(e,t){for(var n=t.pixelData,o=t.points,a=e.detail.image,i=a.width,r=a.height,s=[],l=0;l<o.length;l++){var c=o[l],u=Math.floor(c.x),d=Math.floor(c.y);u=Cn(u,0,i-1),d=Cn(d,0,r-1);var h=s[s.length-1];h&&u===h.x&&d===h.y||s.push({x:u,y:d,segment:n[d*i+u]})}return s}(e,t),r=function(e,t){for(var n=!0,o=!0,a=0;a<e.length&&(e[a].segment===t?o=!1:n=!1,n||o);a++);return o?{isScissorOperation:!0,operation:"fillInsideFreehand"}:n?{isScissorOperation:!0,operation:"eraseInsideFreehand"}:{isScissorOperation:!1}}(i,o);if(r.isScissorOperation)"fillInsideFreehand"===r.operation?(is.warn("The line never intersects a segment."),ws(e,t)):"eraseInsideFreehand"===r.operation&&(is.warn("The line is only ever inside the segment."),ms(e,t));else{var s=new Uint8Array(n.length);(function(e,t){var n=e[0].segment===t,o=[];o.push({additive:!n,nodes:[]});for(var a=0,i=0;i<e.length;i++){var r=e[i];n?(o[a].nodes.push(r),r.segment!==t&&(a++,n=!n,o.push({additive:!0,nodes:[]}),o[a].nodes.push(e[i-1]),o[a].nodes.push(r))):(o[a].nodes.push(r),r.segment===t&&(a++,n=!n,o.push({additive:!1,nodes:[]}),o[a].nodes.push(e[i-1]),o[a].nodes.push(r)))}return o.pop(),o.shift(),o})(i,o).forEach((function(t){!function(e,t,n,o,a){var i=a.detail.image,r=i.width,s=i.height,l=e.nodes,c=e.additive,u=c?0:1,d=function(e){return e.y*r+e.x},h=function(e){return{x:e%r,y:Math.floor(e/r)}};c?is.warn("additive operation..."):is.warn("subtractive operation...");for(var m=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push(e[n]),t.push.apply(t,Q()(Ee(e[n],e[n+1])));t.push[e[e.length-1]];for(var o=[],a=[],i=0;i<t.length-1;i++){var r=cs(t[i],t[i+1]),s=r.left,l=r.right;o.push(s),a.push(l)}return{pixelPath:t,leftPath:o,rightPath:a}}(l),f=m.pixelPath,g=m.leftPath,p=m.rightPath,v=f[0],y={xMin:v.x,xMax:v.x,yMin:v.y,yMax:v.y},b=0;b<n.length;b++)t[b]===o?(ss(y,h(b)),n[b]=1):n[b]=0;for(var x=0;x<f.length;x++){var w=f[x];n[d(w)]=2,ss(y,w)}!function(e,t,n){e.xMax=Math.min(e.xMax+2,n),e.xMin=Math.max(e.xMin-2,0),e.yMax=Math.min(e.yMax+2,t),e.yMin=Math.max(e.yMin-2,0)}(y,s,r);var T=y.xMin,I=y.xMax,E=y.yMin,S=y.yMax;function C(e,t){if(!(e>=I||e<T||t>=S||t<E))return n[t*r+e]}for(var A=0,M=0,D=0;D<g.length;D++){var P=g[D];n[d(P)]===u&&Ge(P,s,r)&&(A+=ls(P,3,n,C,r));var L=p[D];n[d(L)]===u&&Ge(L,s,r)&&(M+=ls(L,4,n,C,r))}if(0!==A&&0!==M){for(var k=c?o:0,O=A<M?3:4,R=0;R<n.length;R++)n[R]===O&&(t[R]=k);if(k===o)for(var N=0;N<f.length;N++)t[d(f[N])]=o;else for(var _=0;_<f.length;_++){var U=d(f[_]);t[U]===o&&(t[U]=0)}}}(t,n,s,o,e)}))}}else is.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(a))}function ss(e,t){var n=t.x,o=t.y;n<e.xMin&&(e.xMin=n),n>e.xMax&&(e.xMax=n),o<e.yMin&&(e.yMin=o),o>e.yMax&&(e.yMax=o)}function ls(e,t,n,o,a){for(var i=fe(o,[e.x,e.y]).flooded,r=0;r<i.length;r++){var s=i[r];n[s[1]*a+s[0]]=t}return i.length}function cs(e,t){var n={x:t.x-e.x,y:t.y-e.y};return-1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y-1},right:{x:e.x+1,y:e.y+1}}:0===n.x&&1===n.y?{left:{x:e.x-1,y:e.y},right:{x:e.x+1,y:e.y}}:1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y+1},right:{x:e.x+1,y:e.y-1}}:1===n.x&&0===n.y?{left:{x:e.x,y:e.y+1},right:{x:e.x,y:e.y-1}}:1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y+1},right:{x:e.x-1,y:e.y-1}}:0===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y},right:{x:e.x-1,y:e.y}}:-1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y-1},right:{x:e.x-1,y:e.y+1}}:-1===n.x&&0===n.y?{left:{x:e.x,y:e.y-1},right:{x:e.x,y:e.y+1}}:void is.error("Unable to find left and right paths for flood fill ",e,t,n)}function us(e,t){for(var n=e[0],o=e[1],a=!1,i=0,r=t.length-1;i<t.length;r=i++){var s=t[i][0],l=t[i][1],c=t[r][0],u=t[r][1];l>o!=u>o&&n<(c-s)*(o-l)/(u-l)+s&&(a=!a)}return a}var ds=B("util:segmentation:operations:eraseInsideFreehand");function hs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,a=t.segmentationMixinType;if("freehandSegmentationMixin"===a){var i=e.detail.image,r=o.map((function(e){return[e.x,e.y]})),s=xe(r,i),l=ae()(s,2),c=l[0],u=l[1];n?se(e,t,(function(e){return us([e.x,e.y],r)}),c,u):le(e,t,(function(e){return us([e.x,e.y],r)}),c,u)}else ds.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(a))}function ms(e,t){hs(e,t,!0)}function fs(e,t){hs(e,t,!1)}var gs=B("util:segmentation:operations:eraseInsideRectangle");function ps(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,a=t.segmentationMixinType;if("rectangleSegmentationMixin"===a){var i=e.detail.image,r=o.map((function(e){return[e.x,e.y]})),s=xe(r,i),l=ae()(s,2),c=l[0],u=l[1];n?se(e,t,(function(){return!0}),c,u):ne(e,t,c,u)}else gs.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(a))}function vs(e,t){ps(e,t,!0)}function ys(e,t){ps(e,t,!1)}var bs=B("util:segmentation:operations:fillInsideFreehand");function xs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,a=t.segmentationMixinType;if("freehandSegmentationMixin"===a){var i=e.detail.image,r=o.map((function(e){return[e.x,e.y]})),s=xe(r,i),l=ae()(s,2),c=l[0],u=l[1];n?he(e,t,(function(e){return us([e.x,e.y],r)}),c,u):me(e,t,(function(e){return us([e.x,e.y],r)}),c,u)}else bs.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(a))}function ws(e,t){xs(e,t,!0)}function Ts(e,t){xs(e,t,!1)}var Is=B("util:segmentation:operations:fillInsideRectangle");function Es(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,a=t.segmentationMixinType;if("rectangleSegmentationMixin"===a){var i=e.detail.image,r=o.map((function(e){return[e.x,e.y]})),s=xe(r,i),l=ae()(s,2),c=l[0],u=l[1];n?he(e,t,(function(){return!0}),c,u):ce(e,t,c,u)}else Is.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(a))}function Ss(e,t){Es(e,t,!0)}function Cs(e,t){Es(e,t,!1)}var As=B("util:segmentation:operations:fillCircle");function Ms(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.segmentationMixinType;if("circleSegmentationMixin"===o){var a=e.detail,i=be(e),r=ae()(i,2),s=r[0],l=r[1],c=ye(a.handles.start,a.handles.end);n?he(e,t,(function(e){return $i(c,e)}),s,l):me(e,t,(function(e){return $i(c,e)}),s,l)}else As.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(o))}function Ds(e,t){Ms(e,t,!0)}function Ps(e,t){Ms(e,t,!1)}var Ls=B("util:segmentation:operations:eraseInsideCircle");function ks(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.segmentationMixinType;if("circleSegmentationMixin"===o){var a=e.detail,i=be(e),r=ae()(i,2),s=r[0],l=r[1],c=ye(a.handles.start,a.handles.end);n?se(e,t,(function(e){return $i(c,e)}),s,l):le(e,t,(function(e){return $i(c,e)}),s,l)}else Ls.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(o))}function Os(e,t){ks(e,t,!0)}function Rs(e,t){ks(e,t,!1)}var Ns=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"FreehandScissors",strategies:{FILL_INSIDE:ws,FILL_OUTSIDE:Ts,ERASE_OUTSIDE:fs,ERASE_INSIDE:ms},cursors:{FILL_INSIDE:Za,FILL_OUTSIDE:Xa,ERASE_OUTSIDE:Ka,ERASE_INSIDE:Ya},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Za,mixins:["freehandSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),t}(go),_s=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"RectangleScissors",strategies:{FILL_INSIDE:Ss,FILL_OUTSIDE:Cs,ERASE_OUTSIDE:ys,ERASE_INSIDE:vs},cursors:{FILL_INSIDE:Qa,FILL_OUTSIDE:ei,ERASE_OUTSIDE:$a,ERASE_INSIDE:Ja},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),t}(go),Us=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"CircleScissors",strategies:{FILL_INSIDE:Ds,FILL_OUTSIDE:Ps,ERASE_OUTSIDE:Rs,ERASE_INSIDE:Os},cursors:{FILL_INSIDE:ni,FILL_OUTSIDE:ai,ERASE_OUTSIDE:oi,ERASE_INSIDE:ti},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:ni,mixins:["circleSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),t}(go),Bs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"CorrectionScissors",strategies:{CORRECTION:rs},cursors:{CORRECTION:Za},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Za,mixins:["polylineSegmentationMixin"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),t}(go),Vs={},Fs={},Hs={};function js(e){if(!e)return"DEFAULT";var t=y.cornerstone.getEnabledElement(e).uuid;if(!t)throw new Error("Something went wrong when getting uuid from element");return t}var zs={setStartLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=js(t);Vs[n]=e},getStartLoadHandler:function(e){var t=js(e);return Vs[t]||Vs.DEFAULT},setEndLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=js(t);Fs[n]=e},getEndLoadHandler:function(e){var t=js(e);return Fs[t]||Fs.DEFAULT},setErrorLoadingHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=js(t);Hs[n]=e},getErrorLoadingHandler:function(e){var t=js(e);return Hs[t]||Hs.DEFAULT},removeHandlers:function(e){var t=js(e);delete Vs[t],delete Fs[t],delete Hs[t]}},qs={};function Ws(e,t){if(!qs[e])return{};var n=qs[e].find((function(e){return e.element===t}));return n?n.options:{}}function Gs(e,t,n){if(qs[e]){var o=qs[e].findIndex((function(e){return e.element===t}));if(-1===o)qs[e].push({element:t,options:n});else{var a=qs[e][o].options||{};qs[e][o].options=Object.assign(a,n)}}else qs[e]=[{element:t,options:n}]}var Ys=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:ka};return(e=u()(this,h()(t).call(this,n,o))).preMouseDownCallback=e._chooseLocation.bind(Co()(e)),e.mouseDragCallback=e._chooseLocation.bind(Co()(e)),e.touchDragCallback=e._chooseLocation.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var o=k(n,this.name);if(o){var a=n,i=y.cornerstone.getEnabledElement(a).image.imageId,r=y.cornerstone.metaData.get("imagePlaneModule",i);if(r){var s=nn(t.currentPoints.image,r);o.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==a){var t=Number.MAX_VALUE,n=-1,o=k(e,"stack");if(void 0!==o){var i=o.data[0];if(i.imageIds.forEach((function(e,o){var a=y.cornerstone.metaData.get("imagePlaneModule",e);if(a&&a.imagePositionPatient&&a.rowCosines&&a.columnCosines){var i=en(a.imagePositionPatient),r=en(a.rowCosines),l=en(a.columnCosines).clone().cross(r.clone()),c=Math.abs(l.clone().dot(i)-l.clone().dot(s));c<t&&(t=c,n=o)}})),n!==i.currentImageIdIndex&&-1!==n&&void 0!==i.imageIds[n]){var r=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);r&&r(e),(!0===i.preventCache?y.cornerstone.loadImage(i.imageIds[n]):y.cornerstone.loadAndCacheImage(i.imageIds[n])).then((function(t){var o=y.cornerstone.getViewport(e);i.currentImageIdIndex=n,y.cornerstone.displayImage(e,t,o),l&&l(e,t)}),(function(t){var o=i.imageIds[n];c&&c(e,o,t)}))}}}}))}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,o=t.synchronizationContext;Gs(this.name,e,{mouseButtonMask:n}),R(e,this.name),L(e,this.name,{synchronizationContext:o})}}]),t}(go),Zs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;y.cornerstone.fitToWindow(t.element)}}]),t}(go),Ks=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"DragProbe",strategies:{default:Xs,minimal:Js},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Da};return(e=u()(this,h()(t).call(this,n,o))).touchDragCallback=e._movingEventCallback.bind(Co()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(Co()(e)),e.mouseDragCallback=e._movingEventCallback.bind(Co()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(Co()(e)),e.dragEventData={},e}return f()(t,e),l()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,y.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},y.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(go);function Xs(e){var t=this.configuration,n=y.cornerstone,o=e.detail,a=o.element,i=o.image,r=o.currentPoints,s=o.canvasContext,l=Dn(s.canvas),c=un.getActiveColor(),u=vn.getFontSize(),d=Math.round(r.image.x),h=Math.round(r.image.y);d<0||h<0||d>=i.columns||h>=i.rows||Wt(l,(function(e){Ln(e,t);var o,s,l="".concat(d,", ").concat(h);if(i.color)o=zr(a,d,h,1,1),s="R: ".concat(o[0]," G: ").concat(o[1]," B: ").concat(o[2]," A: ").concat(o[3]);else{var m=(o=n.getStoredPixels(a,d,h,1,1))[0],f=m*i.slope+i.intercept,g=Ji(i,m);s="SP: ".concat(m," MO: ").concat(parseFloat(f.toFixed(3))),g&&(s+=" SUV: ".concat(parseFloat(g.toFixed(3))))}var p={x:r.canvas.x+5,y:r.canvas.y-5};wn(e,s,p.x,p.y+u+5,c),wn(e,l,p.x,p.y,c)}))}function Js(e){var t=this.configuration,n=y.cornerstone,o=e.detail,a=o.element,i=o.image,r=o.currentPoints,s=o.canvasContext,l=o.isTouchEvent,c=Dn(s.canvas),u=un.getActiveColor(),d=r.page.y-vn.getFontSize()/2;l&&(d=r.page.y-4*vn.getFontSize());var h=n.pageToPixel(a,r.page.x,d);h.x<0||h.y<0||h.x>=i.columns||h.y>=i.rows||Wt(c,(function(e){Ln(e,t);var o,r=n.metaData.get("generalSeriesModule",i.imageId),s=r&&r.modality,c="";if(i.color)o=zr(a,h.x,h.y,1,1),c="R: ".concat(o[0]," G: ").concat(o[1]," B: ").concat(o[2]);else{var d=(o=n.getStoredPixels(a,h.x,h.y,1,1))[0],m=d*i.slope+i.intercept,f=parseFloat(m.toFixed(2));if("CT"===s)c+="HU: ".concat(f);else if("PT"===s){c+=f;var g=Ji(i,d);g&&(c+=" SUV: ".concat(parseFloat(g.toFixed(2))))}else c+=f}var p=n.pixelToCanvas(a,h),v={x:12,y:-(vn.getFontSize()+10)/2},y=xn(e,c,5);l&&(v={x:-y/2,y:-vn.getFontSize()-10-12}),$t(e,a,p,6,{color:u},"canvas"),wn(e,c,p.x+v.x,p.y+v.y,u)}))}var Qs=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Oa};return(e=u()(this,h()(t).call(this,n,o))).preMouseDownCallback=e._deleteAllNearbyTools.bind(Co()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;return vt.tools.forEach((function(e){var o=k(n,e.name);o&&o.data.forEach((function(o){"function"==typeof e.pointNearTool&&e.pointNearTool(n,o,t)&&(O(n,e.name,o),y.cornerstone.updateImage(n))}))})),!0}}]),t}(go),$s=kr.FreehandHandleData,el=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:tl(),svgCursor:Aa};return(e=u()(this,h()(t).call(this,n,o))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.referencedToolName=e.initialConfiguration.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(Co()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(Co()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,o=this.configuration;if(!k(n,this.referencedToolName).data[o.currentTool])return!1;if(this._active){var a=t.canvasContext.canvas.getContext("2d"),i={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};dn(a,t,this.configuration.mouseLocation.handles,i)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,o=k(n.element,this.referencedToolName);if(o){var a=o.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,a),y.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,o=this.configuration;this._active=!1,vt.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),o.mouseUpRender=!0,this._deactivateSculpt(n),y.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,o=n.element,a=n.canvasContext.canvas.getContext("2d"),i=k(o,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=vt.mousePositionImage;var r=Tt(o,this.referencedToolName).distanceFromPointCanvas(o,i,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=r;r=this._limitCursorRadiusCanvas(n,r),s>this.configuration.hoverCursorFadeDistance*r&&(a.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:r};dn(a,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(a.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,o=this._getClosestFreehandToolOnElement(n,e);void 0!==o&&(t.currentTool=o,St(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=k(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var o=0;o<n.length;o++)n[o].active=o===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,o=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,vt.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(o,n.currentTool),this._activateSculpt(o),y.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:Math.max(this._toolSizeImage,2*n.minSpacing)};var o=this._pushHandles();void 0!==o.first&&(this._insertNewHandles(o),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,o=e.toolSize,a={},i=0;i<t.length;i++){var r=y.cornerstoneMath.point.distance(t[i],n);r>o||(this._pushOneHandle(i,r),void 0===a.first?(a.first=i,a.last=i):a.last=i)}return a}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,o=n.points,a=n.mousePoint,i=n.toolSize,r=n.image,s=o[e],l=(s.x-a.x)/t,c=(s.y-a.y)/t,u={x:a.x+i*l,y:a.y+i*c};In(u,r),s.x=u.x,s.y=u.y;var d=this.constructor._getPreviousHandleIndex(e,o.length);o[d].lines.pop(),o[d].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,o=0;o<t.length;o++){var a=t[o]+1+n;this._insertHandleRadially(a),n++}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,o=t.maxSpacing,a=[],i=e.first;i<=e.last;i++)this._checkSpacing(i,n,a,o);var r=this.constructor._getNextHandleIndex(e.last,n.length);if(r!==e.first){this._checkSpacing(r,n,a,o);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==r&&this._checkSpacing(s,n,a,o)}return a}},{key:"_checkSpacing",value:function(e,t,n,o){var a=this.constructor._getNextHandleIndex(e,t.length);y.cornerstoneMath.point.distance(t[e],t[a])>o&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,o=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),a=this._getInsertPosition(e,n,o),i=new $s(a);t.splice(e,0,i),t[n].lines.pop(),t[n].lines.push(t[e]),kr.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(this._sculptData.points.length<=3)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,o=[],a=t.length,i=0;i<a;i++){var r=this.constructor._getNextHandleIndex(i,t.length);if(y.cornerstoneMath.point.distance(t[i],t[r])<n){var s=[i,r];o.push(s),0===i&&(a-=1),i++}}return o}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0;n<e.length;n++){var o=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(o),t++}var a=this._findCloseHandlePairs();a.length&&this._mergeCloseHandles(a)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,o=t.image,a={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};In(a,o),n[e[0]].x=a.x,n[e[0]].y=a.y;var i=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[i]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,o=n.currentTool,a=e.currentPoints.image,i=k(t,this.referencedToolName).data[o],r=Tt(t,this.referencedToolName),s=r.distanceFromPoint(t,i,a),l=r.distanceFromPointCanvas(t,i,a);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,In(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;k(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=k(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var o=0;o<n.data.length;o++)n.data[o].active=!1;Et(this.element,this.svgCursor),y.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e.element,a=e.image,i=this.configuration,r=k(o,this.referencedToolName).data[i.currentTool],s=1;if(n){var l=y.cornerstone.pixelToCanvas(o,{x:0,y:0}),c=y.cornerstone.pixelToCanvas(o,{x:a.width,y:a.height});s=(c.x-l.x)*(c.y-l.y)/(a.width*a.height)}var u=r.area*s,d=Math.pow(u/Math.PI,.5);return Math.min(t,d)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=Tt(e,this.referencedToolName),o=k(e,this.referencedToolName);if(o){for(var a=o.data,i=t.currentPoints.image,r={distance:1/0,toolIndex:null},s=0;s<a.length;s++){var l=n.distanceFromPoint(e,a[s],i);-1!==l&&l<r.distance&&(r.distance=l,r.toolIndex=s)}return r.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var o,a=this._sculptData,i=a.points,r=a.toolSize,s=a.mousePoint,l=a.image,c={x:(i[t].x+i[n].x)/2,y:(i[t].y+i[n].y)/2},u=y.cornerstoneMath.point.distance(s,c);if(u<r){var d={x:(c.x-s.x)/u,y:(c.y-s.y)/u};o={x:s.x+r*d.x,y:s.y+r*d.y}}else o=c;return In(o,l),o}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,y.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,y.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(go);function tl(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:un.getActiveColor(),hoverColor:un.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}var nl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:Ra};return(e=u()(this,h()(t).call(this,n,o))).zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(Co()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(Co()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(Co()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(Co()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(Co()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(Co()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(Co()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.newImageCallback=e._drawMagnificationTool.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame((function(){return t._drawMagnificationTool(e)})),St(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;Et(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var o=t.querySelector("canvas:not(.magnifyTool)"),a=Dn(n),i=y.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),r=Math.min(this.configuration.magnifySize,o.width,o.height),s=this.configuration.magnificationLevel;n.width=r,n.height=r,i.x=Math.max(i.x,.5*r/s),i.x=Math.min(i.x,o.width-.5*r/s),i.y=Math.max(i.y,.5*r/s),i.y=Math.min(i.y,o.height-.5*r/s);var l={x:i.x*s-.5*r,y:i.y*s-.5*r};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),a.drawImage(this.zoomCanvas,l.x,l.y,r,r,0,0,r,r);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(i.y-.5*r-c,0),left:Math.max(i.x-.5*r,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,o.height-d.height),u.left=Math.min(u.left,o.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=y.cornerstone.getEnabledElement(t));var o=this.configuration.magnificationLevel,a=n.canvas,i=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=a.width*o,this.zoomElement.height=a.height*o,y.cornerstone.enable(this.zoomElement,n.options));var r=y.cornerstone.getEnabledElement(this.zoomElement),s=y.cornerstone.getViewport(n.element);this.zoomCanvas=r.canvas,this.zoomCanvas.width=a.width*o,this.zoomCanvas.height=a.height*o,r.viewport=Object.assign({},s),s.scale*=o,y.cornerstone.displayImage(this.zoomElement,i),y.cornerstone.setViewport(this.zoomElement,s)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(y.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}]),t}(go),ol=bt.globalConfiguration,al=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},a=Object.assign(o,n);return(e=u()(this,h()(t).call(this,a))).initialConfiguration=a,e}return f()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"setupRender",value:function(e){if(e){var t=y.cornerstone.metaData.get("overlayPlaneModule",e.imageId);if(t&&t.overlays&&t.overlays.length)return t}}},{key:"setupViewport",value:function(e){if(void 0===e.overlayColor&&(e.overlayColor=ol.configuration.overlayColor||"white"),!1!==e.overlayColor)return!0}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.enabledElement,o=t.image,a=t.viewport,i=t.canvasContext,r=this.setupRender(o);if(t&&n&&r&&this.setupViewport(a)){var s=o.columns,l=o.rows;r.overlays.forEach((function(e){if(!1!==e.visible){var t=document.createElement("canvas");t.width=s,t.height=l;var n=t.getContext("2d");n.fillStyle=e.fillStyle||a.overlayColor,"R"===e.type&&(n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation="xor");for(var o=0,r=0;r<e.rows;r++)for(var c=0;c<e.columns;c++)e.pixelData[o++]>0&&n.fillRect(c,r,1,1);var u=!isNaN(parseFloat(e.x))&&isFinite(e.x)?e.x:0,d=!isNaN(parseFloat(e.y))&&isFinite(e.y)?e.y:0;i.drawImage(t,u,d)}}))}}}]),t}(go),il={getOrientationString:function(e){for(var t=en(e),n="",o=t.x<0?"R":"L",a=t.y<0?"A":"P",i=t.z<0?"F":"H",r=new y.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=1e-4,l=0;l<3;l++)if(r.x>s&&r.x>r.y&&r.x>r.z)n+=o,r.x=0;else if(r.y>s&&r.y>r.x&&r.y>r.z)n+=a,r.y=0;else if(r.z>s&&r.z>r.x&&r.z>r.y)n+=i,r.z=0;else if(r.x>s&&r.y>s&&r.x===r.y)n+=o+a,r.x=0,r.y=0;else if(r.x>s&&r.z>s&&r.x===r.z)n+=o+i,r.x=0,r.z=0;else{if(!(r.y>s&&r.z>s&&r.y===r.z))break;n+=a+i,r.y=0,r.z=0}return n},invertOrientationString:function(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},rl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){var t=y.cornerstone;t.getEnabledElement(e).image&&t.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Dn(t.canvasContext.canvas),o=t.element,a=cl(o);if(a){var i=ul(o,a),r=un.getToolColor(),s={top:xn(n,a.top,0),left:xn(n,a.left,0),right:xn(n,a.right,0),bottom:xn(n,a.bottom,0),height:xn(n,"M",0)};sl(n,a,i,s,r),this.configuration.drawAllMarkers&&ll(n,a,i,s,r)}}}]),t}(go),sl=function(e,t,n,o,a){wn(e,t.top,n.top.x-o.top/2,n.top.y,a),wn(e,t.left,n.left.x-o.left/2,n.left.y,a)},ll=function(e,t,n,o,a){wn(e,t.right,n.right.x-o.right,n.right.y,a),wn(e,t.bottom,n.bottom.x-o.bottom/2,n.bottom.y-o.height,a)},cl=function(e){var t=y.cornerstone,n=t.getEnabledElement(e),o=t.metaData.get("imagePlaneModule",n.image.imageId);if(o&&o.rowCosines&&o.columnCosines){var a=il.getOrientationString(o.rowCosines),i=il.getOrientationString(o.columnCosines),r=il.invertOrientationString(a);return{top:il.invertOrientationString(i),bottom:i,left:r,right:a}}},ul=function(e){var t=y.cornerstone.getEnabledElement(e);return{top:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:5}),bottom:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:t.image.height-15}),left:y.cornerstone.pixelToCanvas(e,{x:5,y:t.image.height/2}),right:y.cornerstone.pixelToCanvas(e,{x:t.image.width-10,y:t.image.height/2})}},dl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return(e=u()(this,h()(t).call(this,n,o))).multiTouchDragCallback=e._dragCallback.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport;if(t.numPointers===this.configuration.touchPointers){var a=this._getTranslation(t);this._applyTranslation(o,a),y.cornerstone.setViewport(n,o)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,o=e.deltaPoints,a=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?a*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:o.page.x/a,y:o.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(go),hl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Na};return(e=u()(this,h()(t).call(this,n,o))).touchDragCallback=e._dragCallback.bind(Co()(e)),e.mouseDragCallback=e._dragCallback.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,a=this._getTranslation(t);this._applyTranslation(o,a),y.cornerstone.setViewport(n,o)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,o=e.deltaPoints,a=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?a*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:o.page.x/a,y:o.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(go),ml=n(11),fl=n.n(ml),gl=n(13),pl=n.n(gl),vl=function(e,t,n,o){var a=y.cornerstone,i=a.getEnabledElement(n).image,r=a.getEnabledElement(o).image;if(i&&r){var s=a.metaData.get("imagePlaneModule",i.imageId),l=a.metaData.get("imagePlaneModule",r.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=en(s.rowCosines),s.columnCosines=en(s.columnCosines),s.imagePositionPatient=en(s.imagePositionPatient),l.rowCosines=en(l.rowCosines),l.columnCosines=en(l.columnCosines),l.imagePositionPatient=en(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!((d=Math.abs(d))<.5)){var h=function(e,t){var n=on(e,t);if(n)return{start:tn(n.start,e),end:tn(n.end,e)}}(s,l);if(h){var m=un.getActiveColor();e.setTransform(1,0,0,1,0,0),Wt(e,(function(e){Xt(e,t.element,h.start,h.end,{color:m})}))}}}}},yl=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function bl(e){try{var t=y.cornerstone.getEnabledElement(e);return t.image?t:yl(250).then((function(){return bl(e)}))}catch(e){return null}}var xl=B("tools:ReferenceLinesTool"),wl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:vl}};return(e=u()(this,h()(t).call(this,n,o))).renderer=null,e.synchronizationContext=null,e}var n;return f()(t,e),l()(t,[{key:"enabledCallback",value:(n=pl()(fl.a.mark((function e(t){var n,o,a,i=arguments;return fl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},o=n.synchronizationContext,a=this.configuration.renderer,e.next=4,bl(t);case 4:if(e.sent&&a&&o){e.next=8;break}return xl.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=a,this.synchronizationContext=o,this.forceImageUpdate(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var o=this.synchronizationContext.getSourceElements(),a=Dn(n.canvasContext.canvas);y.cornerstone.setToPixelCoordinateSystem(n.enabledElement,a),o.forEach((function(o){o!==e.currentTarget&&t.renderer(a,n,e.currentTarget,o)}))}}}]),t}(go),Tl=function(e,t,n){var o=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),i=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(o,2)+Math.pow(a,2)-Math.pow(i,2))/(2*o*a))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},Il=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"Rotate",strategies:{default:El,horizontal:Sl,vertical:Cl},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:_a};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(go);function El(e){var t=this.configuration,n=t.roundAngles,o=t.rotateScale,a=e.detail,i=a.element,r=a.viewport,s=a.startPoints,l=a.currentPoints,c=r.initialRotation?r.initialRotation:r.rotation,u=i.getBoundingClientRect(i),d=i.clientWidth,h=i.clientHeight,m=r.scale,f=r.translation,g={x:u.left+d/2+f.x*m,y:u.top+h/2+f.y*m},p=Tl(g,s.client,l.client);p.angle*=o,n&&(p.angle=Math.ceil(p.angle)),p.direction<0&&(p.angle=-p.angle),r.rotation=c+p.angle}function Sl(e){var t=this.configuration,n=t.roundAngles,o=t.flipHorizontal,a=t.rotateScale,i=e.detail,r=i.viewport,s=i.startPoints,l=i.currentPoints,c=r.initialRotation,u=s.client.x,d=(l.client.x-u)*a;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),o&&(d=-d),r.rotation=c+d}function Cl(e){var t=this.configuration,n=t.roundAngles,o=t.flipVertical,a=t.rotateScale,i=e.detail,r=i.viewport,s=i.startPoints,l=i.currentPoints,c=r.initialRotation,u=s.client.y,d=(l.client.y-u)*a;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),o&&(d=-d),r.rotation=c+d}var Al=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,a=t.rotation;o.rotation+=a,y.cornerstone.setViewport(n,o)}}]),t}(go),Ml=B("tools:ScaleOverlayTool"),Dl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Dn(t.canvasContext.canvas),o=t.image,a=t.viewport,i=t.element,r=o.rowPixelSpacing,s=o.columnPixelSpacing,l=y.cornerstone.metaData.get("imagePlaneModule",o.imageId);if(l&&(r=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),r&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/r*a.scale,d=10/s*a.scale,h=Pl(c,.25,.05),m=Pl(c,.05,.15);if(c.width&&c.height&&h&&m){var f=un.getToolColor(),g=Zt.getToolWidth(),p=Object.assign({},{hscaleBounds:h,vscaleBounds:m,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:m.bottomRight.x,y:m.topLeft.y},end:{x:m.bottomRight.x,y:m.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:f,lineWidth:g},this.configuration);Wt(n,(function(e){Ln(e,p),Xt(e,i,p.verticalLine.start,p.verticalLine.end,{color:p.color,lineWidth:p.lineWidth},"canvas"),Ll(e,i,p),Xt(e,i,p.horizontalLine.start,p.horizontalLine.end,{color:p.color,lineWidth:p.lineWidth},"canvas"),kl(e,i,p)}))}}else Ml.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(go),Pl=function(e,t,n){var o=t*Math.min(1e3,e.width),a=n*Math.min(1e3,e.height),i={left:o,top:a,width:e.width-2*o,height:e.height-2*a};return{topLeft:{x:i.left,y:i.top},bottomRight:{x:i.left+i.width,y:i.top+i.height}}},Ll=function(e,t,n){for(var o=0;n.verticalLine.start.y+o*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var a=n.color,i=n.lineWidth,r={x:n.verticalLine.start.x,y:n.verticalLine.start.y+o*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+o*n.verticalMinorTick};s.x=o%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Xt(e,t,r,s,{color:a,lineWidth:i},"canvas"),o++}},kl=function(e,t,n){for(var o=0;n.horizontalLine.start.x+o*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var a=n.color,i=n.lineWidth,r={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:0};s.y=o%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Xt(e,t,r,s,{color:a,lineWidth:i},"canvas"),o++}},Ol=function(e,t){var n=k(e,"stack");if(n&&n.data&&n.data.length){var o,a=y.cornerstone;if(n.data.length>1){var i=k(e,"stackRenderer");i&&i.data&&i.data.length&&(o=i.data[0])}var r=n.data[0];t<0&&(t+=r.imageIds.length);var s=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);if(t!==r.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-r.currentImageIdIndex};r.currentImageIdIndex=t;var d=r.imageIds[t];(Boolean(r.preventCache)?a.loadImage(d):a.loadAndCacheImage(d)).then((function(i){if(r.currentImageIdIndex===t){try{a.getEnabledElement(e)}catch(e){return}o?(o.currentImageIdIndex=t,o.render(e,n.data)):a.displayImage(e,i),l&&l(e,i)}}),(function(n){var o=r.imageIds[t];c&&c(e,o,n)})),T(e,w.STACK_SCROLL,u)}}},Rl=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=k(e,"stack");if(a&&a.data&&a.data.length){var i=a.data[0];i.pending||(i.pending=[]);var r=i.currentImageIdIndex+t;if(n?r%=i.imageIds.length:r=Cn(r,0,i.imageIds.length-1),o)Ol(e,r);else{var s={index:r};i.pending.push(s),Nl(i,s,e)}}};function Nl(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index)return e.pending.splice(e.pending.indexOf(t),1),void(e.pending.length>0&&Nl(e,e.pending[0],n));n.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,(function o(a){e.imageIds.indexOf(a.detail.image.imageId)===t.index&&(e.pending.splice(e.pending.indexOf(t),1),n.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,o),e.pending.length>0&&Nl(e,e.pending[0],n))})),Ol(n,t.index)}}var _l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,o=t.element,a=this.configuration,i=a.loop,r=a.allowSkipping,s=a.invert;Rl(o,s?-n:n,i,r)}}]),t}(go),Ul=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return(e=u()(this,h()(t).call(this,n,o))).multiTouchDragCallback=e._dragCallback.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,o=t.deltaPoints,a=this.configuration,i=a.loop,r=a.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,o.page.y);if(!l)return;if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,i,r),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=k(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(go),Bl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:Ua};return(e=u()(this,h()(t).call(this,n,o))).mouseDragCallback=e._dragCallback.bind(Co()(e)),e.touchDragCallback=e._dragCallback.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,o=t.deltaPoints,a=this.configuration,i=a.loop,r=a.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,o.page.y);if(l){if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,i,r),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=k(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(go),Vl=function(e,t,n,o,a){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i,r,s,l=y.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(r=0;r<a;r++)for(s=0;s<o;s++){var h=d[i=4*((r+n)*l.columns+(s+t))],m=d[i+1],f=d[i+2];c[u++]=.2126*h+.7152*m+.0722*f}else for(r=0;r<a;r++)for(s=0;s<o;s++)i=(r+n)*l.columns+(s+t),c[u++]=d[i]*l.slope+l.intercept;return c},Fl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var o={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:Ba};return(e=u()(this,h()(t).call(this,n,o)))._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(Co()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(Co()(e)),e.touchEndCallback=e._applyStrategy.bind(Co()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(Co()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(Co()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(Co()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(Co()(e)),e.mouseUpCallback=e._applyStrategy.bind(Co()(e)),e}return f()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=n.element,a=un.getColorIfActive({active:!0}),i=Dn(n.canvasContext.canvas);Wt(i,(function(e){Mn(e,o,t.handles.start,t.handles.end,{color:a})}))}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Hl(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,y.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){Hl(this.handles.start)||Hl(this.handles.end)||(e.detail.handles=this.handles,jl(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(go),Hl=function(e){return 0===Object.keys(e).length&&e.constructor===Object},jl=function(e,t){var n=e.detail,o=n.image,a=n.element,i=e.detail.handles,r=i.start,s=i.end,l=Math.min(r.x,s.x),c=Math.min(r.y,s.y),u=Math.abs(r.x-s.x),d=Math.abs(r.y-s.y);l=Cn(l,0,o.width),c=Cn(c,0,o.height),u=Math.floor(Math.min(u,Math.abs(o.width-l))),d=Math.floor(Math.min(d,Math.abs(o.height-c)));var h=Vl(a,l,c,u,d),m=zl(h,o.minPixelValue,o.maxPixelValue),f=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),f.voi.windowWidth=Math.max(Math.abs(m.max-m.min),t.minWindowWidth),f.voi.windowCenter=m.mean,f.voiLUT=void 0,y.cornerstone.setViewport(a,f),y.cornerstone.updateImage(a)},zl=function(e,t,n){var o=e.length,a=n,i=t,r=0;if(o<2)return{min:a,max:i,mean:(t+n)/2};for(var s=0;s<o;s++){var l=e[s];a=Math.min(a,l),i=Math.max(i,l),r+=l}return{min:a,max:i,mean:r/o}},ql=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"Wwwc",strategies:{basicLevelingStrategy:Wl},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:Va};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(go);function Wl(e){var t=this.configuration.orientation,n=e.detail,o=(n.image.maxPixelValue*n.image.slope+n.image.intercept-(n.image.minPixelValue*n.image.slope+n.image.intercept))/1024,a=n.deltaPoints.page.x*o,i=n.deltaPoints.page.y*o;0===t?(n.viewport.voi.windowWidth+=a,n.viewport.voi.windowCenter+=i):(n.viewport.voi.windowWidth+=i,n.viewport.voi.windowCenter+=a),n.viewport.voiLUT=void 0}var Gl=function(e,t,n){var o=n.maxScale,a=n.minScale,i=Math.log(e.scale)/Math.log(1.7)+t,r=Math.pow(1.7,i);return e.scale=o&&r>o?o:a&&r<a?a:r,e},Yl={changeViewportScale:Gl,correctShift:function(e,t){var n=t.hflip,o=t.vflip,a=t.rotation;if(e.x*=n?-1:1,e.y*=o?-1:1,0!==a){var i=a*Math.PI/180,r=Math.cos(i),s=Math.sin(i),l=e.x*r-e.y*s,c=e.x*s+e.y*r;e.x=l,e.y=c}return e}},Zl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,a=t.spinY,i=this.configuration,r=i.invert,s=i.maxScale,l=i.minScale,c=Gl(o,r?a/4:-a/4,{maxScale:s,minScale:l});y.cornerstone.setViewport(n,c)}}]),t}(go),Kl=Yl.correctShift,Xl=Yl.changeViewportScale,Jl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"Zoom",strategies:{default:$l,translate:ec,zoomToCenter:tc},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:Fa};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){Ql.call(this,e)}},{key:"mouseDragCallback",value:function(e){Ql.call(this,e)}}]),t}(go),Ql=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function $l(e){var t=this.configuration,n=t.invert,o=t.maxScale,a=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],m=u[2],f=u[3],g=Xl(c,r,{maxScale:o,minScale:a});y.cornerstone.setViewport(l,g);var p=y.cornerstone.pageToPixel(l,d,h),v={x:m-p.x,y:f-p.y};v=Kl(v,g),c.translation.x-=v.x,c.translation.y-=v.y}function ec(e){var t=this.configuration,n=t.invert,o=t.preventZoomOutsideImage,a=t.maxScale,i=t.minScale,r=e.detail.deltaPoints.page.y,s=n?-r/100:r/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],m=Xl(c,s,{maxScale:a,minScale:i}),f={x:0,y:0};if(s<0)m.scale<3&&(Math.abs(m.translation.x)<.01?m.translation.x=0:f.x=m.translation.x/8,Math.abs(m.translation.y)<.01?m.translation.y=0:f.y=m.translation.y/8);else{o&&In(e.detail.startPoints.image,l);var g={x:l.width/2-d,y:l.height/2-h};g=Kl(g,m);var p={x:m.translation.x-g.x,y:m.translation.y-g.y};Math.abs(p.x)<.01?m.translation.x=g.x:f.x=p.x/8,Math.abs(p.y)<.01?m.translation.y=g.y:f.y=p.y/8}m.translation.x-=f.x,m.translation.y-=f.y}function tc(e){var t=this.configuration,n=t.invert,o=t.maxScale,a=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail.viewport;Xl(s,r,{maxScale:o,minScale:a})}var nc=Yl.correctShift,oc=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return u()(this,h()(t).call(this,e,n))}return f()(t,e),l()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,a=t.scaleChange,i=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],r=i[0],s=i[1],l=i[2],c=i[3],u=this.configuration,d=u.maxScale,h=u.minScale;o.scale+=a*o.scale,d&&o.scale>d?o.scale=d:h&&o.scale<h&&(o.scale=h),y.cornerstone.setViewport(n,o);var m=y.cornerstone.pageToPixel(n,r,s),f={x:l-m.x,y:c-m.y};f=nc(f,o),o.translation.x-=f.x,o.translation.y-=f.y,y.cornerstone.setViewport(n,o)}}]),t}(go),ac=function(e){return{page:ic(e.page),image:ic(e.image),client:ic(e.client),canvas:ic(e.canvas)}};function ic(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{x:e.x,y:e.y}}var rc,sc=B("eventListeners:mouseEventListeners"),lc=!0,cc=new Map;function uc(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function dc(){lc=!1}function hc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var o=w.MOUSE_DOUBLE_CLICK,a={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};a.canvas=y.cornerstone.pixelToCanvas(t,a.image);var i=ac(a);sc.log("double-click: %o",uc(e)),T(t,o,{event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:i,currentPoints:a,deltaPoints:{x:0,y:0},type:o})}}function mc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){rc=setTimeout(dc,200),t.removeEventListener("mousemove",fc);var o={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=y.cornerstone.pixelToCanvas(t,o.image);var a=ac(o),i={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:a,currentPoints:o,deltaPoints:{x:0,y:0},type:w.MOUSE_DOWN};T(i.element,w.MOUSE_DOWN,i)&&(i.type=w.MOUSE_DOWN_ACTIVATE,T(i.element,w.MOUSE_DOWN_ACTIVATE,i)),document.addEventListener("mousemove",r),document.addEventListener("mouseup",s),cc.set(r,"mousemove"),cc.set(s,"mouseup")}function r(e){var i=w.MOUSE_DRAG,r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var s={page:y.cornerstoneMath.point.subtract(r.page,a.page),image:y.cornerstoneMath.point.subtract(r.image,a.image),client:y.cornerstoneMath.point.subtract(r.client,a.client),canvas:y.cornerstoneMath.point.subtract(r.canvas,a.canvas)};sc.log("mousemove: %o",uc(e));var l={buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:a,currentPoints:r,deltaPoints:s,type:i,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};T(l.element,i,l),a=ac(r)}function s(e){clearTimeout(rc);var i=w.MOUSE_UP;lc&&(i=w.MOUSE_CLICK);var l={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=y.cornerstone.pixelToCanvas(t,l.image);var c={page:y.cornerstoneMath.point.subtract(l.page,a.page),image:y.cornerstoneMath.point.subtract(l.image,a.image),client:y.cornerstoneMath.point.subtract(l.client,a.client),canvas:y.cornerstoneMath.point.subtract(l.canvas,a.canvas)};sc.log("mouseup: %o",uc(e));var u={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:a,currentPoints:l,deltaPoints:c,type:i};T(u.element,i,u),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s),cc.delete(r),cc.delete(s),t.addEventListener("mousemove",fc),lc=!0}}function fc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var o=w.MOUSE_MOVE,a={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};a.canvas=y.cornerstone.pixelToCanvas(t,a.image);var i=ac(a),r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var s={page:y.cornerstoneMath.point.subtract(r.page,i.page),image:y.cornerstoneMath.point.subtract(r.image,i.image),client:y.cornerstoneMath.point.subtract(r.client,i.client),canvas:y.cornerstoneMath.point.subtract(r.canvas,i.canvas)};T(t,o,{viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:i,currentPoints:r,deltaPoints:s,type:o}),i=ac(r)}}function gc(e){e.removeEventListener("mousedown",mc),e.removeEventListener("mousemove",fc),e.removeEventListener("dblclick",hc),cc.forEach((function(e,t){document.removeEventListener(e,t)})),cc.clear()}var pc={enable:function(e){gc(e),e.addEventListener("mousedown",mc),e.addEventListener("mousemove",fc),e.addEventListener("dblclick",hc)},disable:gc};function vc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image&&!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var o=e.pageX,a=e.pageY,i=y.cornerstone.pageToPixel(t,o,a),r=function(e){var t=0,n=0,o=0,a=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),o=10*t,a=10*n,"deltaY"in e&&(a=e.deltaY),"deltaX"in e&&(o=e.deltaX),(o||a)&&e.deltaMode&&(1===e.deltaMode?(o*=40,a*=40):(o*=800,a*=800)),o&&!t&&(t=o<1?-1:1),a&&!n&&(n=a<1?-1:1),{spinX:t,spinY:n,pixelX:o,pixelY:a}}(e),s=r.spinX,l=r.spinY,c=r.pixelX,u=r.pixelY,d=l<0?-1:1,h={element:t,viewport:y.cornerstone.getViewport(t),detail:e,image:n.image,direction:d,spinX:s,spinY:l,pixelX:c,pixelY:u,pageX:o,pageY:a,imageX:i.x,imageY:i.y};T(t,w.MOUSE_WHEEL,h)}}function yc(e){e.removeEventListener("wheel",vc,{passive:!1})}var bc,xc,wc={enable:function(e){yc(e),e.addEventListener("wheel",vc,{passive:!1})},disable:yc},Tc=0,Ic=1;function Ec(e,t){var n=Date.now();if(e!==bc){if(n-xc<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;bc=e}xc=n}var Sc=Ec.bind(null,Tc),Cc=Ec.bind(null,Ic);function Ac(e,t,n){var o=n?Sc:Cc;t.forEach((function(t){e.addEventListener(t,o,{passive:!1})}))}function Mc(e,t,n){var o=n?Sc:Cc;t.forEach((function(t){e.removeEventListener(t,o)}))}var Dc=["mousedown","mouseup"],Pc=["touchstart","touchend"];function Lc(e){Mc(e,Dc,Tc),Mc(e,Pc,Ic)}var kc,Oc,Rc,Nc,_c,Uc,Bc,Vc,Fc,Hc={enable:function(e){Lc(e),Ac(e,Dc,Tc),Ac(e,Pc,Ic)},disable:Lc},jc=1,zc=0,qc=!1,Wc=!1;function Gc(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var o,a,i,r;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(Wc=!1,clearTimeout(Bc)),e.type){case"tap":Wc=!1,clearTimeout(Bc),(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),o=w.TAP,_c={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Oc,type:o,isTouchEvent:!0},T(t,o,_c);break;case"doubletap":Wc=!1,clearTimeout(Bc),(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),o=w.DOUBLE_TAP,_c={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Oc,type:o,isTouchEvent:!0},T(t,o,_c);break;case"pinchstart":Wc=!1,clearTimeout(Bc),jc=1;break;case"pinchmove":if(Wc=!1,clearTimeout(Bc),!0===qc){jc=e.scale,qc=!1;break}a=(e.scale-jc)/jc,(kc={page:e.center,image:y.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),o=w.TOUCH_PINCH,_c={event:e,startPoints:kc,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:a,type:o,isTouchEvent:!0},T(t,o,_c),jc=e.scale;break;case"touchstart":jc=1,clearTimeout(Bc),clearTimeout(Uc),Uc=setTimeout((function(){(kc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),o=w.TOUCH_START,e.touches.length>1&&(o=w.MULTI_TOUCH_START),_c={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:kc,currentPoints:kc,type:o,isTouchEvent:!0},!0===T(t,o,_c)&&(o=w.TOUCH_START_ACTIVE,e.touches.length>1&&(o=w.MULTI_TOUCH_START_ACTIVE),_c.type=o,T(t,o,_c)),Rc=ac(kc)}),50),Wc=!0,Vc=0,Bc=setTimeout((function(){Wc&&((Oc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),o=w.TOUCH_PRESS,_c={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Oc,type:o,isTouchEvent:!0},T(t,o,_c))}),700);break;case"touchend":jc=1,Wc=!1,clearTimeout(Bc),setTimeout((function(){(kc={page:y.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:y.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),o=w.TOUCH_END,_c={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:kc,currentPoints:kc,type:o,isTouchEvent:!0},T(t,o,_c)}),50);break;case"panmove":i={x:e.deltaX-Fc.x,y:e.deltaY-Fc.y},Fc={x:e.deltaX,y:e.deltaY},(Oc={page:{x:Rc.page.x+i.x,y:Rc.page.y+i.y},image:y.cornerstone.pageToPixel(t,Rc.page.x+i.x,Rc.page.y+i.y),client:{x:Rc.client.x+i.x,y:Rc.client.y+i.y}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),Nc={page:y.cornerstoneMath.point.subtract(Oc.page,Rc.page),image:y.cornerstoneMath.point.subtract(Oc.image,Rc.image),client:y.cornerstoneMath.point.subtract(Oc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(Oc.canvas,Rc.canvas)},(Vc+=Math.sqrt(Nc.page.x*Nc.page.x+Nc.page.y*Nc.page.y))>5&&(Wc=!1,clearTimeout(Bc)),o=w.TOUCH_DRAG,e.pointers.length>1&&(o=w.MULTI_TOUCH_DRAG),_c={viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:kc,lastPoints:Rc,currentPoints:Oc,deltaPoints:Nc,numPointers:e.pointers.length,type:o,isTouchEvent:!0},T(t,o,_c),Rc=ac(Oc);break;case"panstart":Fc={x:e.deltaX,y:e.deltaY},(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),Rc=ac(Oc);break;case"panend":if(Wc=!1,clearTimeout(Bc),!Rc)return!1;(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),Nc={page:y.cornerstoneMath.point.subtract(Oc.page,Rc.page),image:y.cornerstoneMath.point.subtract(Oc.image,Rc.image),client:y.cornerstoneMath.point.subtract(Oc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(Oc.canvas,Rc.canvas)},o=w.TOUCH_DRAG_END,_c={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:kc,lastPoints:Rc,currentPoints:Oc,deltaPoints:Nc,type:o,isTouchEvent:!0},T(t,o,_c),2==e.pointers.length-e.changedPointers.length&&(qc=!0);break;case"rotatemove":Wc=!1,clearTimeout(Bc),r=e.rotation-zc,zc=e.rotation,o=w.TOUCH_ROTATE,_c={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,rotation:r,type:o},T(t,o,_c)}return!1}}function Yc(e){Hc.disable(e),["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,Gc)}));var t=Ws("touchInput",e),n=t.hammer;n&&(n.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),n.input.destroy()),t.hammer=null,function(e,t){var n=qs[e];n&&(qs[e]=n.filter((function(e){return e.element!==t})))}("touchInput",e)}var Zc={enable:function(e){Yc(e);var t=y.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},o=new t.Manager(e,n),a={pointers:0,direction:t.DIRECTION_ALL,threshold:0},i=new t.Pan(a),r=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});r.recognizeWith(i),r.recognizeWith(s),s.recognizeWith(i);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(i),o.add([l,i,s,r]),o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),Hc.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,Gc,{passive:!1})}));var c=Ws("touchInput",e);c.hammer=o,Gs("touchInput",e,c)},disable:Yc},Kc=xt("segmentation");function Xc(e,t,n,o,a){!function(e,t,n){var o=Kc.configuration,a=e.detail,i=a.canvasContext,r=a.element,s=a.image,l=a.viewport,c=i.getTransform(),u=Dn(i.canvas),d=y.cornerstone.pixelToCanvas(r,{x:0,y:0}),h=y.cornerstone.pixelToCanvas(r,{x:s.width,y:0}),m=y.cornerstone.pixelToCanvas(r,{x:s.width,y:s.height}),f=y.cornerstoneMath.point.distance(d,h),g=y.cornerstoneMath.point.distance(h,m),p=i.canvas,v=u.imageSmoothingEnabled,b=u.globalAlpha;u.imageSmoothingEnabled=!1,u.globalAlpha=n?o.fillAlpha:o.fillAlphaInactive,function(e,t,n){if(n.hflip||n.vflip||n.rotation){var o={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(o.x,o.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-o.x,-o.y)}}(u,p,l);var x=function(e){var t=e.viewport,n=e.image,o=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:t.translation.x*o,y:t.translation.y*a}}(a);u.drawImage(t,p.width/2-f/2+x.x,p.height/2-g/2+x.y,f,g),u.globalAlpha=b,u.imageSmoothingEnabled=v,u.setTransform(c)}(e,function(e,t,n){var o=Kc.state,a=e.detail.image,i=a.width,r=a.height,s=t.segmentsHidden,l=n.pixelData,c=o.colorLutTables[t.colorLUTIndex],u=document.createElement("canvas");u.width=i,u.height=r;for(var d=Dn(u),h=new ImageData(i,r),m=h.data,f=0;f<l.length;f++){var g=l[f];if(0!==g&&!s[g]){var p=c[l[f]];m[4*f]=p[0],m[4*f+1]=p[1],m[4*f+2]=p[2],m[4*f+3]=p[3]}}return d.putImageData(h,0,0),u}(e,t,n),a)}var Jc=xt("segmentation");function Qc(e,t,n,o,a){!function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Jc.configuration,i=Jc.state,r=e.detail,s=r.element,l=r.canvasContext,c=a.outlineWidth||1,u=l.getTransform(),d=Dn(l.canvas),h=i.colorLutTables[n],m=d.globalAlpha;d.globalAlpha=o?a.outlineAlpha:a.outlineAlphaInactive,Wt(d,(function(e){for(var n=1;n<t.length;n++)if(t[n]){var o=h[n];hn(e,s,t[n],{color:"rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1.0 )"),lineWidth:c},"canvas")}})),d.globalAlpha=m,d.setTransform(u)}(e,function(e,t,n,o){var a=e.detail,i=a.element,r=a.image,s=a.viewport,l=r.width,c=r.height;o=o||1;var u,d=t.segmentsHidden,h=n.pixelData,m=t.activeSegmentIndex,f=[];n.segmentsOnLabelmap.forEach((function(e){!d[e]&&(f[e]=[])})),f[m]||(f[m]=[]);for(var g=function(e,t){var n=t/2,o=e.rotation;o*=Math.PI/180;var a=Math.cos(o),i=Math.sin(o),r=[a,i],s=[-i,a],l={x:n*r[0],y:n*r[1]},c={x:n*s[0],y:n*s[1]};return e.hflip&&(l.x*=-1,l.y*=-1),e.vflip&&(c.x*=-1,c.y*=-1),{i:l,j:c}}(s,o),p=0;p<h.length;p++){var v=h[p];if(0!==v&&!d[v]){var y={x:(u=p)%l,y:Math.floor(u/l)},b=$c(y,c,l);void 0!==b.top&&h[b.top]===v||au(f[v],i,y,g),void 0!==b.bottom&&h[b.bottom]===v||iu(f[v],i,y,g),void 0!==b.left&&h[b.left]===v||ru(f[v],i,y,g),void 0!==b.right&&h[b.right]===v||su(f[v],i,y,g),void 0!==b.topLeft&&h[b.topLeft]!==v&&h[b.top]===v&&h[b.left]===v&&eu(f[v],i,y,g),void 0!==b.topRight&&h[b.topRight]!==v&&h[b.top]===v&&h[b.right]===v&&tu(f[v],i,y,g),void 0!==b.bottomLeft&&h[b.bottomLeft]!==v&&h[b.bottom]===v&&h[b.left]===v&&nu(f[v],i,y,g),void 0!==b.bottomRight&&h[b.bottomRight]!==v&&h[b.bottom]===v&&h[b.right]===v&&ou(f[v],i,y,g)}}return f}(e,t,n,Jc.configuration.outlineWidth),t.colorLUTIndex,a)}function $c(e,t,n){var o=e.y*n+e.x,a={},i=e.y-1>=0,r=e.y+1<t,s=e.x-1>=0,l=e.x+1<n;return i&&(a.top=o-n,l&&(a.topRight=a.top+1),s&&(a.topLeft=a.top-1)),r&&(a.bottom=o+n,l&&(a.bottomRight=a.bottom+1),s&&(a.bottomLeft=a.bottom-1)),s&&(a.left=o-1),l&&(a.right=o+1),a}function eu(e,t,n,o){var a=(0,y.cornerstone.pixelToCanvas)(t,n);a.x+=o.j.x,a.y+=o.j.y;var i={x:a.x,y:a.y};i.x+=2*o.i.x,i.y+=2*o.i.y,e.push({start:a,end:i})}function tu(e,t,n,o){var a=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y});a.x+=o.j.x,a.y+=o.j.y;var i={x:a.x,y:a.y};i.x-=2*o.i.x,i.y-=2*o.i.y,e.push({start:a,end:i})}function nu(e,t,n,o){var a=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x,y:n.y+1});a.x-=o.j.x,a.y-=o.j.y;var i={x:a.x,y:a.y};i.x+=2*o.i.x,i.y+=2*o.i.y,e.push({start:a,end:i})}function ou(e,t,n,o){var a=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y+1});a.x-=o.j.x,a.y-=o.j.y;var i={x:a.x,y:a.y};i.x-=2*o.i.x,i.y-=2*o.i.y,e.push({start:a,end:i})}function au(e,t,n,o){var a=y.cornerstone.pixelToCanvas,i=a(t,n),r=a(t,{x:n.x+1,y:n.y});i.x+=o.j.x,i.y+=o.j.y,r.x+=o.j.x,r.y+=o.j.y,e.push({start:i,end:r})}function iu(e,t,n,o){var a=y.cornerstone.pixelToCanvas,i=a(t,{x:n.x,y:n.y+1}),r=a(t,{x:n.x+1,y:n.y+1});i.x-=o.j.x,i.y-=o.j.y,r.x-=o.j.x,r.y-=o.j.y,e.push({start:i,end:r})}function ru(e,t,n,o){var a=y.cornerstone.pixelToCanvas,i=a(t,n),r=a(t,{x:n.x,y:n.y+1});i.x+=o.i.x,i.y+=o.i.y,r.x+=o.i.x,r.y+=o.i.y,e.push({start:i,end:r})}function su(e,t,n,o){var a=y.cornerstone.pixelToCanvas,i=a(t,{x:n.x+1,y:n.y}),r=a(t,{x:n.x+1,y:n.y+1});i.x-=o.i.x,i.y-=o.i.y,r.x-=o.i.x,r.y-=o.i.y,e.push({start:i,end:r})}var lu=xt("segmentation");function cu(e,t,n,o,a){(function(e){var t=lu.configuration;return t.renderFill&&(e&&0!==t.fillAlpha||!e&&0!==t.fillAlphaInactive)})(a)&&Xc(e,t,o,0,a),function(e){var t=lu.configuration;return t.renderOutline&&(e&&0!==t.outlineAlpha||!e&&0!==t.outlineAlphaInactive)}(a)&&Qc(e,t,o,0,a)}var uu=xt("segmentation"),du=function(e){var t=e.detail.element,n=uu.configuration,o=uu.getters.labelmaps3D(t),a=o.activeLabelmapIndex,i=o.labelmaps3D,r=o.currentImageIdIndex;i&&(n.shouldRenderInactiveLabelmaps&&function(e,t,n,o){for(var a=0;a<t.length;a++){var i=t[a];if(a!==n&&i){var r=i.labelmaps2D[o];r&&cu(e,i,0,r,!1)}}}(e,i,a,r),function(e,t,n,o){var a=t[n];if(a){var i=a.labelmaps2D[o];i&&cu(e,a,0,i,!0)}}(e,i,a,r))},hu=xt("segmentation"),mu=function(e){var t=e.detail,n=t.element,o=vt.tools.filter((function(e){return e.element===n&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)})),a=k(n,"stack"),i=hu.configuration;a&&(i.renderFill||i.renderOutline)&&du(e);var r=t.canvasContext.canvas.getContext("2d");o.forEach((function(t){t.renderToolData&&(r.save(),t.renderToolData(e),r.restore())}))},fu=function(e){e.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,mu)},gu=function(e){e.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,mu)},pu=function(e,t,n){if(vt.isToolLocked)return!1;var o=n.detail.element,a=vt.tools.filter((function(t){return t.supportedInteractionTypes.includes(e)}));if(a=(a=Eo(o,a,e)).filter((function(e){return"function"==typeof e[t]})),vt.isMultiPartToolActive&&(a=Po(a)),0===a.length)return!1;a[0][t](n)},vu=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";return t.filter((function(t){for(var a=la(o,t.name),i=k(e,t.name),r=0;r<i.data.length;r++)if(void 0!==yo(e,i.data[r].handles,n,a))return!0;return!1}))},yu=function(e,t){return t.filter((function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)}))},bu=function(e,t){return t.filter((function(t){var n=k(e,t.name);return n&&n.data.length>0}))},xu=function(e){if(!vt.isToolLocked){var t=e.detail,n=e.detail.element,o=e.detail.currentPoints.canvas,a=yu(n,yt.mouseTools()),i=a.filter((function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}));if(vt.isMultiPartToolActive&&(i=Po(i)),i.length>0){var r=i.find((function(e){return"function"==typeof e.preMouseDownCallback}));if(r&&r.preMouseDownCallback(e))return}if(!vt.isMultiPartToolActive){var s=bu(n,a),l=vu(n,s,o,"mouse");if(l.length>0){var c=l[0],u=k(n,c.name),d=ha(n,u,c.name,o),h=d.handle,m=d.data;c.handleSelectedCallback(e,m,h,"mouse")}else{var f=a.filter((function(e){var t=k(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,o,"mouse")}))}));if(f.length>0){var g=f[0],p=k(n,g.name).data.find((function(e){return g.pointNearTool(n,e,o)}));g.toolSelectedCallback(e,p,"mouse")}else if(i.length>0){var v=i.find((function(e){return"function"==typeof e.postMouseDownCallback}));if(v&&v.postMouseDownCallback(e))return}}}}},wu=B("eventDispatchers:mouseEventHandlers"),Tu=function(e){if(!vt.isToolLocked){var t=e.detail,n=Lo(t.element,t.buttons,"mouse");if(n){if("function"==typeof n.preMouseDownActivateCallback&&n.preMouseDownActivateCallback(e))return;vt.isMultiPartToolActive||(n.addNewMeasurement?n.addNewMeasurement(e,"mouse"):n instanceof ga&&function(e,t){wu.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,o=n.element,a=t.createNewMeasurement(n);if(a){L(o,t.name,a),y.cornerstone.updateImage(o);var i=1===Object.keys(a.handles).length?Go:na,r=(new Date).getTime();i(n,t.name,a,a.handles.end,t.options,"mouse",(function(e){if(!a.cancelled){var n=!(!t.configuration||!Object(t.configuration).hasOwnProperty("measurementCreationThreshold"))&&(new Date).getTime()-r<t.configuration.measurementCreationThreshold;if(e&&!1===n){var i=w.MEASUREMENT_COMPLETED,s={toolName:t.name,toolType:t.name,element:o,measurementData:a};T(o,i,s)}else O(o,t.name,a)}}))}}(e,n))}}},Iu=function(e){if(!vt.isToolLocked){var t,n=e.detail,o=n.element;t=(t=(t=Eo(o,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive}))).filter((function(e){return"function"==typeof e.mouseDragCallback})),vt.isMultiPartToolActive&&(t=Po(t)),0!==t.length&&t[0].mouseDragCallback(e)}},Eu=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t,n=e.detail,o=n.element,a=n.currentPoints;vt.mousePositionImage=a.image;var i=(t=yu(o,yt.mouseTools())).filter((function(e){return"active"===e.mode&&e.options.isMouseActive})),r=!1;i.length>0&&(r=i.some((function(e){return e.updateOnMouseMove}))),t=bu(o,t);for(var s=0;s<t.length;s++){var l=t[s];"function"==typeof l.mouseMoveCallback&&(r=l.mouseMoveCallback(e)||r)}!0===r&&y.cornerstone.updateImage(o)}},Su=pu.bind(null,"Mouse","mouseClickCallback"),Cu=pu.bind(null,"Mouse","doubleClickCallback"),Au=pu.bind(null,"Mouse","mouseUpCallback"),Mu=pu.bind(null,"MouseWheel","mouseWheelCallback"),Du=function(e){e.addEventListener(w.MOUSE_CLICK,Su),e.addEventListener(w.MOUSE_DOWN,xu),e.addEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.addEventListener(w.MOUSE_DOUBLE_CLICK,Cu),e.addEventListener(w.MOUSE_DRAG,Iu),e.addEventListener(w.MOUSE_MOVE,Eu),e.addEventListener(w.MOUSE_UP,Au),e.addEventListener(w.MOUSE_WHEEL,Mu)},Pu=function(e){e.removeEventListener(w.MOUSE_CLICK,Su),e.removeEventListener(w.MOUSE_DOWN,xu),e.removeEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,Cu),e.removeEventListener(w.MOUSE_DRAG,Iu),e.removeEventListener(w.MOUSE_MOVE,Eu),e.removeEventListener(w.MOUSE_UP,Au),e.removeEventListener(w.MOUSE_WHEEL,Mu)},Lu=function(e){if(vt.isToolLocked)return!1;var t=e.detail.element,n=vt.tools.filter((function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)}));if(0===n.length)return!1;n.forEach((function(t){t.newImageCallback&&t.newImageCallback(e)}))},ku=function(e){e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,Lu)},Ou=function(e){e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,Lu)},Ru=function(e){if(vt.isToolLocked)return!1;var t=e.detail,n=t.element,o=t.numPointers,a=vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("MultiTouch")}));if(a=(a=Eo(n,a,"MultiTouch")).filter((function(e){return"function"==typeof e.multiTouchDragCallback&&o===e.configuration.touchPointers})),vt.isMultiPartToolActive&&(a=Po(a)),0===a.length)return!1;a[0].multiTouchDragCallback(e)},Nu=B("eventDispatchers:touchEventHandlers"),_u=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t=Lo(e.detail.element,null,"touch");t&&t.addNewMeasurement?t.addNewMeasurement(e,"touch"):t instanceof ga&&function(e,t){Nu.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,o=n.element,a=t.createNewMeasurement(n);if(a){if(L(o,t.name,a),1===Object.keys(a.handles).length&&n.type===w.TAP)return a.active=!1,a.handles.end.active=!1,a.handles.end.highlight=!1,a.invalidated=!0,(vt.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&To(n,a.handles)&&O(o,t.name,a),void y.cornerstone.updateImage(o);y.cornerstone.updateImage(o),na(n,t.name,a,a.handles.end,t.options,"touch",(function(){var e=w.MEASUREMENT_COMPLETED,n={toolName:t.name,toolType:t.name,element:o,measurementData:a};T(o,e,n)}))}}(e,t)}},Uu=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&Bu(n.handles)}};function Bu(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}var Vu,Fu=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t,n=e.detail.element,o=e.detail.currentPoints.canvas;t=Eo(n,yt.touchTools());var a=(t=bu(n,t)).filter((function(e){for(var t=k(n,e.name),a=0;a<t.data.length;a++)if(void 0!==yo(n,t.data[a].handles,o,28))return!0;return!1}));if(a.length>0){var i=a[0],r=k(n,i.name),s=r.data.find((function(e){return void 0!==yo(n,e.handles,o,28)}));return r.data.active=!0,s.active=!0,y.cornerstone.updateImage(n),Go(e.detail,i.name,r.data,s,i.options,"touch",(function(){return Uu(r)})),e.stopImmediatePropagation(),void e.preventDefault()}var l=t.filter((function(e){var t=k(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,o)}))}));if(l.length>0){var c=l[0],u=k(n,c.name),d=u.data.find((function(e){return c.pointNearTool(n,e,o)}));return d.active=!0,y.cornerstone.updateImage(n),_o(e.detail,c.name,d,null,c.options,"touch",(function(){return Uu(u)})),e.stopImmediatePropagation(),void e.preventDefault()}var h=Eo(n,yt.touchTools());return h.length>0&&h[0].touchStartActiveCallback?h[0].touchStartActiveCallback(e):_u(e),!1}},Hu=function(e){if(!vt.isToolLocked){var t=e.detail,n=t.element,o=t.startPoints.canvas,a=yu(n,yt.touchTools()),i=a.filter((function(e){return"active"===e.mode&&e.options.isTouchActive}));if(vt.isMultiPartToolActive&&(i=Po(i)),i.length>0){var r=i.find((function(e){return"function"==typeof e.preTouchStartCallback}));if(r&&r.preTouchStartCallback(e))return}if(!vt.isMultiPartToolActive){var s=bu(n,a),l=vu(n,s,o,"touch");if(l.length>0){var c=l[0],u=k(n,c.name),d=ha(n,u,c.name,o,"touch"),h=d.handle,m=d.data;c.handleSelectedCallback(e,m,h,"touch")}else{var f=s.filter((function(e){var t=k(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,o,"touch")}))}));if(f.length>0){var g=f[0],p=k(n,g.name).data.find((function(e){return g.pointNearTool(n,e,o)}));g.toolSelectedCallback(e,p,"touch")}else if(i.length>0){var v=i.find((function(e){return"function"==typeof e.postTouchStartCallback}));if(v&&v.postTouchStartCallback(e))return}}}}},ju=pu.bind(null,"DoubleTap","doubleTapCallback"),zu=pu.bind(null,"Touch","touchDragCallback"),qu=pu.bind(null,"Touch","touchEndCallback"),Wu=pu.bind(null,"TouchPinch","touchPinchCallback"),Gu=pu.bind(null,"Touch","touchPressCallback"),Yu=pu.bind(null,"TouchRotate","touchRotateCallback"),Zu=function(e){e.addEventListener(w.TAP,Fu),e.addEventListener(w.TOUCH_START,Hu,{passive:!1}),e.addEventListener(w.TOUCH_DRAG,zu,{passive:!1}),e.addEventListener(w.TOUCH_END,qu),e.addEventListener(w.TOUCH_START_ACTIVE,_u),e.addEventListener(w.TOUCH_PRESS,Gu),e.addEventListener(w.DOUBLE_TAP,ju),e.addEventListener(w.TOUCH_PINCH,Wu),e.addEventListener(w.TOUCH_ROTATE,Yu),e.addEventListener(w.MULTI_TOUCH_DRAG,Ru)},Ku=function(e){e.removeEventListener(w.TAP,Fu),e.removeEventListener(w.TOUCH_START,Hu),e.removeEventListener(w.TOUCH_DRAG,zu),e.removeEventListener(w.TOUCH_END,qu),e.removeEventListener(w.TOUCH_START_ACTIVE,_u),e.removeEventListener(w.TOUCH_PRESS,Gu),e.removeEventListener(w.DOUBLE_TAP,ju),e.removeEventListener(w.TOUCH_PINCH,Wu),e.removeEventListener(w.TOUCH_ROTATE,Yu),e.removeEventListener(w.MULTI_TOUCH_DRAG,Ru)},Xu=B("addTool"),Ju=function(e,t,n){var o=new t(n);Tt(e,o.name)?Xu.warn("%s has already been added to the target element",o.name):(o.element=e,wt.state.tools.push(o))},Qu=function(e,t){$u(e,t),wt.state.enabledElements.forEach((function(n){Ju(n,e,t)}))},$u=function(e,t){if(xt("globalConfiguration").configuration.globalToolSyncEnabled){var n=new e(t);void 0!==wt.state.globalTools[n.name]?Xu.warn("%s has already been added globally",n.name):wt.state.globalTools[n.name]={tool:e,props:t,activeBindings:[]}}},ed=B("internals:addEnabledElement"),td=function(e){ed.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;fu(t),ku(t);var n=xt("globalConfiguration").configuration;n.mouseEnabled&&(pc.enable(t),wc.enable(t),Du(t)),n.touchEnabled&&(Zc.enable(t),Zu(t)),nd(t)},nd=function(e){wt.state.enabledElements.push(e),wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)}))}(e),function(e){xt("globalConfiguration").configuration.globalToolSyncEnabled&&Object.keys(wt.state.globalTools).forEach((function(t){var n=wt.state.globalTools[t],o=n.tool,a=n.props;Ju(e,o,a)}))}(e),function(e){if(xt("globalConfiguration").configuration.globalToolSyncEnabled){var t={active:Dt,passive:Nt,enabled:Ot,disabled:Lt};wt.state.globalToolChangeHistory.forEach((function(n){var o=n.args.slice(0);o.unshift(e),t[n.mode].apply(null,o)}))}}(e)},od=B("internals:removeEnabledElement"),ad=function(e){od.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element,n=xt("globalConfiguration").configuration;gu(t),Ou(t),n.mouseEnabled&&(pc.disable(t),wc.disable(t),Pu(t)),n.touchEnabled&&(Zc.disable(t),Ku(t)),id(t),rd(t),sd(t)},id=function(e){wt.state.tools.forEach((function(t){t.element===e&&Lt(t.element,t.name)})),wt.state.tools=wt.state.tools.filter((function(t){return t.element!==e}))},rd=function(e){wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)}))}(e);var t=wt.state.enabledElements.findIndex((function(t){return t===e}));t>-1?wt.state.enabledElements.splice(t,1):od.warn("unable to remove element")},sd=function(e){zs.removeHandlers(e)},ld=function(){window.removeEventListener("resize",cd,!1)};function cd(){Vu||(Vu=setTimeout((function(){Vu=null,ud()}),66))}var ud=function(){vt.enabledElements.forEach((function(e){y.cornerstone.resize(e)}))},dd=function(){ld(),window.addEventListener("resize",cd,!1)},hd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};md(),fd();var t=xt("globalConfiguration");Array.isArray(e)?e.forEach((function(e){var t=e.moduleName,n=e.configuration,o=xt(t);o&&(o.configuration=Object.assign({},o.configuration,n))})):t.configuration=Object.assign({},t.configuration,e),t.configuration.autoResizeViewports&&dd()};function md(){!function(){var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,td),e.events.removeEventListener(n,ad)}();var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,td),e.events.addEventListener(n,ad)}function fd(){var e=wt.modules;Object.keys(e).forEach((function(t){"function"==typeof e[t].onRegisterCallback&&e[t].onRegisterCallback()}))}var gd,pd=B("stackTools:stackPrefetch"),vd={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function yd(e,t){e=Math.round(e)||0;var n=[],o=(t=Math.round(t)||0)-e+1;if(o<=0)return n;for(;o--;)n[o]=t--;return n}function bd(e){var t=k(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],o=k(e,"stackPrefetch");if(o){var a=o.data[0]||{};if(a.indicesToRequest&&a.indicesToRequest.length||(a.enabled=!1),!1!==a.enabled&&(o.data[0].indicesToRequest.sort((function(e,t){return e-t})),a.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&y.cornerstone.imageCache.getImageLoadObject(t)&&w(e)})),a.indicesToRequest.length)){vd.preserveExistingPool||y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch");for(var i,r,s,l,c,u,d,h=(i=a.indicesToRequest,r=n.currentImageIdIndex,s=0,l=i.length-1,i.forEach((function(e,t){e<r?s=Math.max(t,s):e>r&&(l=Math.min(t,l))})),{low:s,high:l}),m=(zs.getErrorLoadingHandler(e),h.low),f=h.high,g=[];m>=0||f<a.indicesToRequest.length;){var p=n.currentImageIdIndex,v=!(p-a.indicesToRequest[m]>vd.maxImagesToPrefetch)&&m>=0,b=!(a.indicesToRequest[f]-p>vd.maxImagesToPrefetch)&&f<a.indicesToRequest.length;if(!b&&!v)break;v&&(u=a.indicesToRequest[m--],c=n.imageIds[u],g.push(c)),b&&(u=a.indicesToRequest[f++],c=n.imageIds[u],g.push(c))}var x={addToBeginning:!0,priority:0,requestType:"prefetch"};d=function(e){return y.cornerstone.loadAndCacheImage(e,x)},g.reverse().forEach((function(e){y.cornerstone.imageLoadPoolManager.addRequest(d.bind(null,e),"prefetch",{imageId:e},0,!0)}))}}}function w(e){var t=a.indicesToRequest.indexOf(e);t>-1&&a.indicesToRequest.splice(t,1)}}function xd(e){return function(t){var n,o=t.detail;try{n=k(e,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var a=n.data[0].imageIds.indexOf(o.imageId);if(!(a<0)){var i=k(e,"stackPrefetch");i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(a)}}}}function wd(e){clearTimeout(gd),gd=setTimeout((function(){var t=e.target;try{bd(t)}catch(e){return}}),10)}var Td={enable:function(e){k(e,"stackPrefetch").data=[];var t=k(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var o={indicesToRequest:yd(0,n.imageIds.length-1),enabled:!0,direction:1},a=o.indicesToRequest.indexOf(n.currentImageIdIndex);o.indicesToRequest.splice(a,1),L(e,"stackPrefetch",o),bd(e),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd),e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var i=xd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i),y.cornerstone.events.addEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i)}else pd.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(gd),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var t=xd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=k(e,"stackPrefetch");n&&n.data.length&&(n.data[0].enabled=!1,y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch"))},getConfiguration:function(){return vd},setConfiguration:function(e){vd=e}},Id=function(){function e(){r()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return l()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=k(e,"stack").data);var o=y.cornerstone,a=t[0],i=a.imageIds[this.currentImageIdIndex],r=t.slice(1,t.length);o.loadAndCacheImage(i).then((function(t){var s=n.layerIds[0];s?o.setLayerImage(e,t,s):(s=o.addLayer(e,t,a.options),n.layerIds.push(s)),o.displayImage(e,t),r.forEach((function(t,a){var r=n.findImageFn(t.imageIds,i),l=a+1,c=n.layerIds[l];c||(c=o.addLayer(e,void 0,t.options),n.layerIds.push(c)),r?o.loadAndCacheImage(r).then((function(t){o.setLayerImage(e,t,c),o.updateImage(e)})):(o.setLayerImage(e,void 0,c),o.setActiveLayer(e,s),o.updateImage(e))}))}))}}]),e}(),Ed={};Ed.FusionRenderer=Id;var Sd=Ed;function Cd(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function Ad(e,t){var n,o;if(void 0===e)throw new Error("playClip: element must not be undefined");var a=k(e,"stack");if(a&&a.data&&a.data.length){var i,r=y.cornerstone;if(a.data.length>1){var s=k(e,"stackRenderer");s&&s.data&&s.data.length&&(i=s.data[0])}var l=a.data[0],c=k(e,"playClip");c&&c.data&&c.data.length?Cd(n=c.data[0]):L(e,"playClip",n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(o=function(e,t){var n,o,a,i=0,r=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<r;n++)a=Number(e[n])/t|0,s.push(a),1===n?o=a:a!==o&&(s.isTimeVarying=!0),i+=a;return s.length>0&&(a=s.isTimeVarying?i/s.length|0:s[0],s.push(a)),s}(n.frameTimeVector,n.speed));var u=function(){var t,o,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(c<0||c>=u))return Cd(n),void function(e){T(e,w.CLIP_STOPPED,{element:e})}(e);c>=u&&(c=0),c<0&&(c=u-1),c!==l.currentImageIdIndex&&(t=zs.getStartLoadHandler(e),o=zs.getEndLoadHandler(e),s=zs.getErrorLoadingHandler(e),t&&t(e),(!0===l.preventCache?r.loadImage(l.imageIds[c]):r.loadAndCacheImage(l.imageIds[c])).then((function(t){try{l.currentImageIdIndex=c,i?(i.currentImageIdIndex=c,i.render(e,a.data)):r.displayImage(e,t),o&&o(e,t)}catch(e){return}}),(function(t){var n=l.imageIds[c];s&&s(e,n,t)})))};o&&o.length>0&&o.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,o[l.currentImageIdIndex]),u()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/Math.abs(n.framesPerSecond)))}}function Md(e){var t=k(e,"playClip");t&&t.data&&t.data.length&&Cd(t.data[0])}var Dd=function(e,t){var n=wt.state.tools.findIndex((function(n){return n.element===e&&n.name===t}));n>=0&&wt.state.tools.splice(n,1)},Pd=function(e){Ld(e),wt.state.enabledElements.forEach((function(t){Dd(t,e)}))},Ld=function(e){xt("globalConfiguration").configuration.globalToolSyncEnabled&&wt.state.globalTools[e]&&delete wt.state.globalTools[e]},kd=function(e,t,n){var o=Tt(e,t);o&&o.mergeOptions(n)},Od=function(e,t){vt.enabledElements.forEach((function(n){kd(n,e,t)}))};function Rd(e,t){var n={};return{get:function(o,a){return e.indexOf(a)>=0?(!1===n.hasOwnProperty(a)&&(n[a]={data:[]}),n[a]):t.get(o,a)},add:function(o,a,i){if(!(e.indexOf(a)>=0))return t.add(o,a,i);!1===n.hasOwnProperty(a)&&(n[a]={data:[]}),n[a].data.push(i)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var Nd=[];function _d(e,t){var n=P(e);n||(n=D);var o=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(o=o.concat(t));var a=Rd(o,n);Nd.push(a),N(e,a)}var Ud={newStackSpecificToolStateManager:Rd,addStackStateManager:_d};function Bd(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n))return o[n]}},add:function(t,n,o){!1===e.hasOwnProperty(t)&&(e[t]={});var a=e[t];!1===a.hasOwnProperty(n)&&(a[n]={data:[]}),a[n].data.push(o)},remove:function(t,n,o){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n)){for(var i=a[n],r=-1,s=0;s<i.data.length;s++)i.data[s]===o&&(r=s);-1!==r&&i.data.splice(r,1)}}}}}var Vd=Bd(),Fd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",o=e.querySelector("canvas");if(o.msToBlob){var a=o.msToBlob();return window.navigator.msSaveBlob(a,t)}var i=document.createElement("a");if(i.download=t,i.href=o.toDataURL(n,1),document.createEvent){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(r)}else i.fireEvent&&i.fireEvent("onclick")},Hd=B("thirdParty:registerModule"),jd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=zd(e);!o||n?(o&&Hd.warn("Overwriting module %s",e),bt[e]=t,"function"==typeof bt[e].onRegisterCallback&&bt[e].onRegisterCallback()):Hd.warn("A module with the name %s is already registered",e)};function zd(e){return void 0!==bt[e]}function qd(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}var Wd={"base/BaseTool":go,"base/BaseAnnotationTool":ga,"base/BaseBrushTool":Do,"tools/cursors/MouseCursor":ba,"tools/cursors":a,"manipulators/anyHandlesOutsideImage":To,"manipulators/getHandleNearImagePoint":yo,"manipulators/getHandlePixelPosition":Io,"manipulators/handleActivator":bo,"manipulators/moveAllHandles":_o,"manipulators/moveHandle":Go,"manipulators/moveNewHandle":na,"manipulators/moveHandleNearImagePoint":da,"manipulators/findHandleDataNearImagePoint":ha,"manipulators/moveAnnotation":ma,"mixins/activeOrDisabledBinaryTool":io.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":io.enabledOrDisabledBinaryTool,"drawing/getNewContext":Dn,"drawing/draw":Wt,"drawing/path":Kt,"drawing/setShadow":Ln,"drawing/drawLine":Xt,"drawing/drawLines":hn,"drawing/drawJoinedLines":Jt,"drawing/drawCircle":$t,"drawing/drawEllipse":rn,"drawing/drawRect":Mn,"drawing/fillOutsideRect":function(e,t,n,o,a){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=y.cornerstone;n=i.pixelToCanvas(t,n),o=i.pixelToCanvas(t,o)}var r=Math.min(n.x,o.x),s=Math.min(n.y,o.y),l=Math.abs(n.x-o.x),c=Math.abs(n.y-o.y);Kt(e,a,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(r+l,s,-l,c)}))},"drawing/drawTextBox":wn,"drawing/drawArrow":Qt,"drawing/fillBox":bn,"drawing/fillTextLines":yn,"drawing/drawLink":mn,"drawing/drawLinkedTextBox":An,"drawing/drawHandles":dn,"drawing/textBoxWidth":xn,"util/getActiveTool":Lo,"util/getLuminance":Vl,"util/getROITextBoxCoords":nr,"util/copyPoints":ac,"util/calculateSUV":Ji,"util/setContextToDisplayFontSize":function(e,t,n){return y.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":Ol,"util/scroll":Rl,"util/roundToDecimal":va,"util/projectPatientPointToImagePlane":tn,"util/imagePointToPatientPoint":nn,"util/planePlaneIntersection":on,"util/pointInsideBoundingBox":po,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")},"util/getRGBPixels":zr,"util/getBrowserInfo":qd,"util/isMobileDevice":function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)},"util/angleBetweenPoints":Tl,"util/numbersWithCommas":or,"util/lineSegDistance":pa,"util/triggerEvent":T,"util/convertToVector3":en,"util/clip":Tn,"util/clipToBox":In,"util/clipBoxToDisplayedArea":Sn,"util/debounce":si,"util/deepmerge":ho,"util/getDefault":Pn,"util/getProximityThreshold":la,"util/getPixelSpacing":ii,"util/isEmptyObject":kn,"util/isObject":ri,"util/isPointInImage":Ge,"util/isPointInPolygon":us,"util/getLogger":B,"util/throttle":li,"util/wait":yl,"util/waitForEnabledElementImageToLoad":bl,"util/getKeyPressData":function(e){var t=y.cornerstone,n=e.currentTarget,o=t.getEnabledElement(n);if(o&&o.image){var a=wt.state.mousePositionImage;return{event:window.event||e,element:n,viewport:t.getViewport(n),image:o.image,currentPoints:{image:a,canvas:t.pixelToCanvas(n,a)},keyCode:e.keyCode,which:e.which}}},"util/ellipseUtils":tr,"util/freehandUtils":kr,"util/segmentationUtils":o,"util/zoomUtils":Yl},Gd=B("thirdParty:registerMixin"),Yd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Zd(e);!o||n?(o&&Gd.warn("Overwriting mixins/%s",e),io[e]=t,Wd["mixins/".concat(e)]=io[e]):Gd.warn("mixins/%s is already registered",e)};function Zd(e){return void 0!==io[e]}var Kd=B("thirdParty:registerType"),Xd=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a="".concat(e,"/").concat(t),i=Jd(a);!i||o?(i&&Kd.warn("Overwriting %s",a),Wd[a]=n):Kd.warn("%s is already registered",a)};function Jd(e){return void 0!==Wd[e]}var Qd=B("thirdParty:register"),$d=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(eh(e,t,n))switch(e){case"module":jd(t,n,o);break;case"mixin":Yd(t,n,o);break;default:Xd(e,t,n,o)}};function eh(e,t,n){return e?t?"object"===x()(n)||"function"==typeof n||(Qd.warn("The %s is a %s, it should be an Object or a function.",n,x()(n)),!1):(Qd.warn("The %s must have a name in order to register.",e),!1):(Qd.warn("The type must be given in order to register."),!1)}var th=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach((function(e){var n=e.type,o=e.name,a=e.item;$d(n,o,a,t)}))},nh=function(e,t,n){if(n!==t){var o=y.cornerstone,a=o.getViewport(t),i=o.getViewport(n);i.voi.windowWidth===a.voi.windowWidth&&i.voi.windowCenter===a.voi.windowCenter&&i.invert===a.invert||(i.voi.windowWidth=a.voi.windowWidth,i.voi.windowCenter=a.voi.windowCenter,i.invert=a.invert,e.setViewport(n,i))}},oh=function(e,t,n){n!==t&&y.cornerstone.updateImage(n)};function ah(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}var ih=function(e,t){y.cornerstone;var n=this,o=[],a=[],i=!1,r={},s=t;function l(e){var t=e.detail.element;n.remove(t),function(e){for(var t in qs)qs[t]=qs[t].filter((function(t){return t.element!==e}))}(t)}this.enabled=!0,this.setHandler=function(e){s=e},this.getHandler=function(){return s},this.getDistances=function(){if(o.length&&a.length){var e=y.cornerstone;r.distances={},r.imageIds={sourceElements:[],targetElements:[]},o.forEach((function(t){var n=e.getEnabledElement(t);if(n&&n.image){var o=n.image.imageId,i=e.metaData.get("imagePlaneModule",o);if(i&&i.imagePositionPatient){var s=en(i.imagePositionPatient);r.hasOwnProperty(n)||(r.distances[o]={},r.imageIds.sourceElements.push(o),a.forEach((function(n){var a=e.getEnabledElement(n);if(a&&a.image){var i=a.image.imageId;if(r.imageIds.targetElements.push(i),t!==n&&o!==i&&!r.distances[o].hasOwnProperty(i)){var l=e.metaData.get("imagePlaneModule",i);if(l&&l.imagePositionPatient){var c=en(l.imagePositionPatient);r.distances[o][i]=c.clone().sub(s)}}}})),Object.keys(r.distances[o]).length||delete r.distances[o])}}}))}},this.fireEvent=function(e,t){var l=!n.enabled,c=!o.length||!a.length;l||c||(i=!0,a.forEach((function(i){var l=a.indexOf(i);if(-1!==l){var c=r.imageIds.targetElements[l],u=o.indexOf(e);if(-1!==u){var d,h=r.imageIds.sourceElements[u];h===c?d=0:void 0!==r.distances[h]&&(d=r.distances[h][c]),s(n,e,i,t,d)}}})),i=!1)},this.onEvent=function(e){var t=e.detail;!0!==i&&n.fireEvent(e.currentTarget,t)},this.addSource=function(t){-1===o.indexOf(t)&&(o.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,n.onEvent)})),n.getDistances(),n.updateDisableHandlers())},this.addTarget=function(e){-1===a.indexOf(e)&&(a.push(e),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.add=function(e){n.addSource(e),n.addTarget(e)},this.removeSource=function(t){var a=o.indexOf(t);-1!==a&&(o.splice(a,1),e.split(" ").forEach((function(e){t.removeEventListener(e,n.onEvent)})),n.getDistances(),n.fireEvent(t),n.updateDisableHandlers())},this.removeTarget=function(e){var t=a.indexOf(e);-1!==t&&(a.splice(t,1),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.remove=function(e){n.removeTarget(e),n.removeSource(e)},this.getSourceElements=function(){return o},this.getTargetElements=function(){return a},this.displayImage=function(e,t,n){i=!0,y.cornerstone.displayImage(e,t,n),i=!1},this.setViewport=function(e,t){i=!0,y.cornerstone.setViewport(e,t),i=!1},this.updateDisableHandlers=function(){ah(o.concat(a)).forEach((function(e){e.removeEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l),e.addEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l)}))},this.destroy=function(){ah(o.concat(a)).forEach((function(e){n.remove(e)}))}},rh=function(e,t,n,o){if(t!==n&&o&&o.direction){var a=y.cornerstone,i=k(n,"stack").data[0],r=i.currentImageIdIndex+o.direction;if(r=Cn(r,0,i.imageIds.length-1),i.currentImageIdIndex!==r){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);i.currentImageIdIndex=r;var u=i.imageIds[r];s&&s(n),(!0===i.preventCache?a.loadImage(u):a.loadAndCacheImage(u)).then((function(t){var o=a.getViewport(n);i.currentImageIdIndex===r&&(e.displayImage(n,t,o),l&&l(n,t))}),(function(e){var t=i.imageIds[r];c&&c(n,t,e)}))}}},sh=function(e,t,n){if(n!==t){var o=y.cornerstone,a=k(t,"stack").data[0],i=a.imageIds[a.currentImageIdIndex],r=o.metaData.get("imagePlaneModule",i);if(void 0!==r&&void 0!==r.imagePositionPatient){var s=en(r.imagePositionPatient),l=k(n,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(l.imageIds.forEach((function(e,t){var n=o.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=en(n.imagePositionPatient).distanceToSquared(s);a<c&&(c=a,u=t)}})),u!==l.currentImageIdIndex){var d=zs.getStartLoadHandler(n),h=zs.getEndLoadHandler(n),m=zs.getErrorLoadingHandler(n);l.currentImageIdIndex=u;var f=l.imageIds[u];d&&d(n),-1!==u&&(!0===l.preventCache?o.loadImage(f):o.loadAndCacheImage(f)).then((function(t){var a=o.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,a),h&&h(n,t))}),(function(e){var t=l.imageIds[u];m&&m(n,t,e)}))}}}},lh=function(e,t,n,o,a){if(n!==t){var i=y.cornerstone,r=k(t,"stack").data[0],s=r.imageIds[r.currentImageIdIndex],l=i.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=en(l.imagePositionPatient),u=k(n,"stack").data[0],d=Number.MAX_VALUE,h=-1;if(a){var m=c.clone().add(a);if(u.imageIds.forEach((function(e,t){var n=i.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var o=en(n.imagePositionPatient),a=m.distanceToSquared(o);a<d&&(d=a,h=t)}})),h!==u.currentImageIdIndex&&-1!==h){var f=zs.getStartLoadHandler(n),g=zs.getEndLoadHandler(n),p=zs.getErrorLoadingHandler(n);u.currentImageIdIndex=h;var v=u.imageIds[h];f&&f(n),(!0===u.preventCache?i.loadImage(v):i.loadAndCacheImage(v)).then((function(t){var o=i.getViewport(n);u.currentImageIdIndex===h&&(e.displayImage(n,t,o),g&&g(n,t))}),(function(e){var t=u.imageIds[h];p&&p(n,t,e)}))}}}}},ch=function(e,t,n){if(n!==t){var o=y.cornerstone,a=k(t,"stack").data[0],i=k(n,"stack").data[0],r=a.currentImageIdIndex;if((r=Cn(r,0,i.imageIds.length-1))!==i.currentImageIdIndex){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);s&&s(n),(!0===i.preventCache?o.loadImage(i.imageIds[r]):o.loadAndCacheImage(i.imageIds[r])).then((function(t){var a=o.getViewport(n);i.currentImageIdIndex=r,e.displayImage(n,t,a),l&&l(n,t)}),(function(e){var t=i.imageIds[r];c&&c(n,t,e)}))}}},uh=function(e,t,n){if(n!==t){var o=y.cornerstone,a=o.getViewport(t),i=o.getViewport(n);i.scale===a.scale&&i.translation.x===a.translation.x&&i.translation.y===a.translation.y||(i.scale=a.scale,i.translation.x=a.translation.x,i.translation.y=a.translation.y,e.setViewport(n,i))}},dh=function(e){return Wd[e]};n.d(t,"AngleTool",(function(){return ci})),n.d(t,"ArrowAnnotateTool",(function(){return hi})),n.d(t,"BidirectionalTool",(function(){return Xi})),n.d(t,"CircleRoiTool",(function(){return ir})),n.d(t,"CobbAngleTool",(function(){return ur})),n.d(t,"EllipticalRoiTool",(function(){return hr})),n.d(t,"FreehandRoiTool",(function(){return Vr})),n.d(t,"LengthTool",(function(){return jr})),n.d(t,"ProbeTool",(function(){return Wr})),n.d(t,"RectangleRoiTool",(function(){return Yr})),n.d(t,"TextMarkerTool",(function(){return Qr})),n.d(t,"BrushTool",(function(){return ts})),n.d(t,"SphericalBrushTool",(function(){return as})),n.d(t,"RectangleScissorsTool",(function(){return _s})),n.d(t,"FreehandScissorsTool",(function(){return Ns})),n.d(t,"CircleScissorsTool",(function(){return Us})),n.d(t,"CorrectionScissorsTool",(function(){return Bs})),n.d(t,"CrosshairsTool",(function(){return Ys})),n.d(t,"DoubleTapFitToWindowTool",(function(){return Zs})),n.d(t,"DragProbeTool",(function(){return Ks})),n.d(t,"EraserTool",(function(){return Qs})),n.d(t,"FreehandRoiSculptorTool",(function(){return el})),n.d(t,"MagnifyTool",(function(){return nl})),n.d(t,"OverlayTool",(function(){return al})),n.d(t,"OrientationMarkersTool",(function(){return rl})),n.d(t,"PanMultiTouchTool",(function(){return dl})),n.d(t,"PanTool",(function(){return hl})),n.d(t,"ReferenceLinesTool",(function(){return wl})),n.d(t,"RotateTool",(function(){return Il})),n.d(t,"RotateTouchTool",(function(){return Al})),n.d(t,"ScaleOverlayTool",(function(){return Dl})),n.d(t,"StackScrollMouseWheelTool",(function(){return _l})),n.d(t,"StackScrollMultiTouchTool",(function(){return Ul})),n.d(t,"StackScrollTool",(function(){return Bl})),n.d(t,"WwwcRegionTool",(function(){return Fl})),n.d(t,"WwwcTool",(function(){return ql})),n.d(t,"ZoomMouseWheelTool",(function(){return Zl})),n.d(t,"ZoomTool",(function(){return Jl})),n.d(t,"ZoomTouchPinchTool",(function(){return oc})),n.d(t,"init",(function(){return hd})),n.d(t,"stackPrefetch",(function(){return Td})),n.d(t,"stackRenderers",(function(){return Sd})),n.d(t,"playClip",(function(){return Ad})),n.d(t,"stopClip",(function(){return Md})),n.d(t,"store",(function(){return wt})),n.d(t,"getModule",(function(){return xt})),n.d(t,"getToolForElement",(function(){return Tt})),n.d(t,"addTool",(function(){return Qu})),n.d(t,"addToolForElement",(function(){return Ju})),n.d(t,"removeTool",(function(){return Pd})),n.d(t,"removeToolForElement",(function(){return Dd})),n.d(t,"setToolOptions",(function(){return Od})),n.d(t,"setToolOptionsForElement",(function(){return kd})),n.d(t,"isToolActiveForElement",(function(){return Ao})),n.d(t,"setToolActive",(function(){return Pt})),n.d(t,"setToolActiveForElement",(function(){return Dt})),n.d(t,"setToolEnabled",(function(){return Rt})),n.d(t,"setToolEnabledForElement",(function(){return Ot})),n.d(t,"setToolDisabled",(function(){return kt})),n.d(t,"setToolDisabledForElement",(function(){return Lt})),n.d(t,"setToolPassive",(function(){return _t})),n.d(t,"setToolPassiveForElement",(function(){return Nt})),n.d(t,"addToolState",(function(){return L})),n.d(t,"getToolState",(function(){return k})),n.d(t,"removeToolState",(function(){return O})),n.d(t,"clearToolState",(function(){return R})),n.d(t,"setElementToolStateManager",(function(){return N})),n.d(t,"getElementToolStateManager",(function(){return P})),n.d(t,"textStyle",(function(){return vn})),n.d(t,"toolStyle",(function(){return Zt})),n.d(t,"toolColors",(function(){return un})),n.d(t,"toolCoordinates",(function(){return Ci})),n.d(t,"stackSpecificStateManager",(function(){return Ud})),n.d(t,"newStackSpecificToolStateManager",(function(){return Rd})),n.d(t,"addStackStateManager",(function(){return _d})),n.d(t,"loadHandlerManager",(function(){return zs})),n.d(t,"newImageIdSpecificToolStateManager",(function(){return M})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return D})),n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return Bd})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return Vd})),n.d(t,"forceEnabledElementResize",(function(){return ud})),n.d(t,"orientation",(function(){return il})),n.d(t,"SaveAs",(function(){return Fd})),n.d(t,"enableLogger",(function(){return V})),n.d(t,"disableLogger",(function(){return F})),n.d(t,"register",(function(){return $d})),n.d(t,"registerSome",(function(){return th})),n.d(t,"wwwcSynchronizer",(function(){return nh})),n.d(t,"updateImageSynchronizer",(function(){return oh})),n.d(t,"Synchronizer",(function(){return ih})),n.d(t,"stackScrollSynchronizer",(function(){return rh})),n.d(t,"stackImagePositionSynchronizer",(function(){return sh})),n.d(t,"stackImagePositionOffsetSynchronizer",(function(){return lh})),n.d(t,"stackImageIndexSynchronizer",(function(){return ch})),n.d(t,"panZoomSynchronizer",(function(){return uh})),n.d(t,"importInternal",(function(){return dh})),n.d(t,"external",(function(){return y})),n.d(t,"EVENTS",(function(){return w})),n.d(t,"version",(function(){return"6.0.10"})),n.d(t,"import",(function(){return dh}));var hh={AngleTool:ci,ArrowAnnotateTool:hi,BidirectionalTool:Xi,CircleRoiTool:ir,CobbAngleTool:ur,EllipticalRoiTool:hr,FreehandRoiTool:Vr,LengthTool:jr,ProbeTool:Wr,RectangleRoiTool:Yr,TextMarkerTool:Qr,BrushTool:ts,SphericalBrushTool:as,RectangleScissorsTool:_s,FreehandScissorsTool:Ns,CircleScissorsTool:Us,CorrectionScissorsTool:Bs,CrosshairsTool:Ys,DoubleTapFitToWindowTool:Zs,DragProbeTool:Ks,EraserTool:Qs,FreehandRoiSculptorTool:el,MagnifyTool:nl,OverlayTool:al,OrientationMarkersTool:rl,PanMultiTouchTool:dl,PanTool:hl,ReferenceLinesTool:wl,RotateTool:Il,RotateTouchTool:Al,ScaleOverlayTool:Dl,StackScrollMouseWheelTool:_l,StackScrollMultiTouchTool:Ul,StackScrollTool:Bl,WwwcRegionTool:Fl,WwwcTool:ql,ZoomMouseWheelTool:Zl,ZoomTool:Jl,ZoomTouchPinchTool:oc,init:hd,stackPrefetch:Td,stackRenderers:Sd,playClip:Ad,stopClip:Md,store:wt,getModule:xt,getToolForElement:Tt,addTool:Qu,addToolForElement:Ju,removeTool:Pd,removeToolForElement:Dd,setToolOptions:Od,setToolOptionsForElement:kd,isToolActiveForElement:Ao,setToolActive:Pt,setToolActiveForElement:Dt,setToolEnabled:Rt,setToolEnabledForElement:Ot,setToolDisabled:kt,setToolDisabledForElement:Lt,setToolPassive:_t,setToolPassiveForElement:Nt,addToolState:L,getToolState:k,removeToolState:O,clearToolState:R,setElementToolStateManager:N,getElementToolStateManager:P,textStyle:vn,toolStyle:Zt,toolColors:un,toolCoordinates:Ci,stackSpecificStateManager:Ud,newStackSpecificToolStateManager:Rd,addStackStateManager:_d,loadHandlerManager:zs,newImageIdSpecificToolStateManager:M,globalImageIdSpecificToolStateManager:D,newFrameOfReferenceSpecificToolStateManager:Bd,globalFrameOfReferenceSpecificToolStateManager:Vd,forceEnabledElementResize:ud,orientation:il,SaveAs:Fd,enableLogger:V,disableLogger:F,importInternal:dh,import:dh,register:$d,registerSome:th,wwwcSynchronizer:nh,updateImageSynchronizer:oh,Synchronizer:ih,stackScrollSynchronizer:rh,stackImagePositionSynchronizer:sh,stackImagePositionOffsetSynchronizer:lh,stackImageIndexSynchronizer:ch,panZoomSynchronizer:uh,external:y,EVENTS:w,version:"6.0.10"};t.default=hh}])},6439:e=>{
/*! cornerstone-web-image-loader - 2.1.1 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWebImageLoader */
window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var o,a=(o=n(4))&&o.__esModule?o:{default:o},i=void 0,r={set cornerstone(e){i=e,(0,a.default)(i)},get cornerstone(){return i}};t.external=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=function(e){var t=o.external.cornerstone,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",s.beforeSend(n),n.onprogress=function(n){if(n.lengthComputable){var o=n.loaded,a=n.total,i=Math.round(o/a*100),r={imageId:e,loaded:o,total:a,percentComplete:i};t.triggerEvent(t.events,"cornerstoneimageloadprogress",r)}},{promise:new Promise((function(t,o){n.onload=function(){(0,a.default)(this.response).then((function(n){var o=(0,i.default)(n,e);t(o)}),o)},n.send()})),cancelFn:function(){n.abort()}}},t.configure=function(e){s=e};var o=n(0),a=r(n(3)),i=r(n(2));function r(e){return e&&e.__esModule?e:{default:e}}var s={beforeSend:function(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.naturalHeight,r=e.naturalWidth;return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,render:o.external.cornerstone.renderWebImage,getPixelData:function(){return(n=void 0,i===t?n=a.getContext("2d"):(a.height=e.naturalHeight,a.width=e.naturalWidth,(n=a.getContext("2d")).drawImage(e,0,0),i=t),n.getImageData(0,0,e.naturalWidth,e.naturalHeight)).data;var n},getCanvas:function(){return i===t||(a.height=e.naturalHeight,a.width=e.naturalWidth,a.getContext("2d").drawImage(e,0,0),i=t),a},getImage:function(){return e},rows:n,columns:r,height:n,width:r,color:!0,rgba:!1,columnPixelSpacing:void 0,rowPixelSpacing:void 0,invert:!1,sizeInBytes:n*r*4}};var o=n(0),a=document.createElement("canvas"),i=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((function(t,n){var o=new Image,a=new Uint8Array(e),i=new Blob([a]),r=window.URL||window.webkitURL,s=r.createObjectURL(i);o.src=s,o.onload=function(){t(o),r.revokeObjectURL(s)},o.onerror=function(e){r.revokeObjectURL(s),n(e)}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.registerImageLoader("http",o.loadImage),e.registerImageLoader("https",o.loadImage)};var o=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.configure=t.loadImage=t.createImage=t.arrayBufferToImage=void 0;var o=s(n(3)),a=s(n(2)),i=n(1),r=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var l={arrayBufferToImage:o.default,createImage:a.default,loadImage:i.loadImage,configure:i.configure,external:r.external};t.arrayBufferToImage=o.default,t.createImage=a.default,t.loadImage=i.loadImage,t.configure=i.configure,t.external=r.external,t.default=l}])},41:(e,t,n)=>{"use strict";var o=n(655),a=n(8068),i=n(9675),r=n(5795);e.exports=function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new i("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new i("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new i("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new i("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new i("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new i("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],d=!!r&&r(e,t);if(o)o(e,t,{configurable:null===c&&d?d.configurable:!c,enumerable:null===s&&d?d.enumerable:!s,value:n,writable:null===l&&d?d.writable:!l});else{if(!u&&(s||l||c))throw new a("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=n}}},5915:function(e,t,n){
/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */
e.exports=function(e){return n=[function(t,n){t.exports=e},function(e,t,n){"use strict";n.r(t),n.d(t,"isStringVr",(function(){return a})),n.d(t,"isPrivateTag",(function(){return i})),n.d(t,"parsePN",(function(){return r})),n.d(t,"parseTM",(function(){return s})),n.d(t,"parseDA",(function(){return c})),n.d(t,"explicitElementToString",(function(){return u})),n.d(t,"explicitDataSetToJS",(function(){return d})),n.d(t,"createJPEGBasicOffsetTable",(function(){return f})),n.d(t,"parseDicomDataSetExplicit",(function(){return k})),n.d(t,"parseDicomDataSetImplicit",(function(){return O})),n.d(t,"readFixedString",(function(){return y})),n.d(t,"alloc",(function(){return R})),n.d(t,"version",(function(){return N})),n.d(t,"bigEndianByteArrayParser",(function(){return _})),n.d(t,"ByteStream",(function(){return V})),n.d(t,"sharedCopy",(function(){return U})),n.d(t,"DataSet",(function(){return w})),n.d(t,"findAndSetUNElementLength",(function(){return v})),n.d(t,"findEndOfEncapsulatedElement",(function(){return p})),n.d(t,"findItemDelimitationItemAndSetElementLength",(function(){return T})),n.d(t,"littleEndianByteArrayParser",(function(){return F})),n.d(t,"parseDicom",(function(){return z})),n.d(t,"readDicomElementExplicit",(function(){return L})),n.d(t,"readDicomElementImplicit",(function(){return E})),n.d(t,"readEncapsulatedImageFrame",(function(){return Z})),n.d(t,"readEncapsulatedPixelData",(function(){return X})),n.d(t,"readEncapsulatedPixelDataFromFragments",(function(){return W})),n.d(t,"readPart10Header",(function(){return H})),n.d(t,"readSequenceItemsExplicit",(function(){return D})),n.d(t,"readSequenceItemsImplicit",(function(){return A})),n.d(t,"readSequenceItem",(function(){return S})),n.d(t,"readTag",(function(){return g}));var o={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},a=function(e){return o[e]},i=function(e){if(e=parseInt(e[4],16),isNaN(e))throw"dicomParser.isPrivateTag: cannot parse last character of group";return e%2==1},r=function(e){if(void 0!==e)return{familyName:(e=e.split("^"))[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}};function s(e,t){if(2<=e.length){var n=parseInt(e.substring(0,2),10),o=4<=e.length?parseInt(e.substring(2,4),10):void 0,a=6<=e.length?parseInt(e.substring(4,6),10):void 0,i=(i=8<=e.length?e.substring(7,13):void 0)?parseInt(i,10)*Math.pow(10,6-i.length):void 0;if(t&&(isNaN(n)||void 0!==o&&isNaN(o)||void 0!==a&&isNaN(a)||void 0!==i&&isNaN(i)||n<0||23<n||o&&(o<0||59<o)||a&&(a<0||59<a)||i&&(i<0||999999<i)))throw"invalid TM '".concat(e,"'");return{hours:n,minutes:o,seconds:a,fractionalSeconds:i}}if(t)throw"invalid TM '".concat(e,"'")}function l(e,t,n){return!isNaN(n)&&0<t&&t<=12&&0<e&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}function c(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),o=parseInt(e.substring(4,6),10),a=parseInt(e.substring(6,8),10);if(t&&!0!==l(a,o,n))throw"invalid DA '".concat(e,"'");return{year:n,month:o,day:a}}if(t)throw"invalid DA '".concat(e,"'")}function u(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,o=t.vr,i=t.tag;function r(t,n){for(var o="",a=0;a<t;a++)0!==a&&(o+="/"),o+=n.call(e,i,a).toString();return o}if(!0===a(o))n=e.string(i);else{if("AT"===o){var s=e.uint32(i);return void 0===s?void 0:"x".concat((s=s<0?4294967295+s+1:s).toString(16).toUpperCase())}"US"===o?n=r(t.length/2,e.uint16):"SS"===o?n=r(t.length/2,e.int16):"UL"===o?n=r(t.length/4,e.uint32):"SL"===o?n=r(t.length/4,e.int32):"FD"===o?n=r(t.length/8,e.double):"FL"===o&&(n=r(t.length/4,e.float))}return n}function d(e,t){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";t=t||{omitPrivateAttibutes:!0,maxElementLength:128};var n,o={};for(n in e.elements){var a=e.elements[n];if(!0!==t.omitPrivateAttibutes||!i(n))if(a.items){for(var r=[],s=0;s<a.items.length;s++)r.push(d(a.items[s].dataSet,t));o[n]=r}else{var l=void 0;a.length<t.maxElementLength&&(l=u(e,a)),o[n]=void 0!==l?l:{dataOffset:a.dataOffset,length:a.length}}}return o}function h(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function m(e,t,n){for(var o,a,i=n;i<t.fragments.length;i++)if(a=i,h(o=e,(a=t.fragments[a]).position+a.length-2)||h(o,a.position+a.length-3))return i}function f(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var o=[],a=0;;){o.push(t.fragments[a].offset);var i=m(e,t,a);if(void 0===i||i===t.fragments.length-1)return o;a=i+1}}function g(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256;return e=e.readUint16(),"x".concat("00000000".concat((t+e).toString(16)).substr(-8))}function p(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==g(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var o=e.readUint32()/4,a=0;a<o;a++){var i=e.readUint32();t.basicOffsetTable.push(i)}for(var r=e.position;e.position<e.byteArray.length;){var s=g(e),l=e.readUint32();if("xfffee0dd"===s)return e.seek(l),void(t.length=e.position-t.dataOffset);if("xfffee000"!==s)return n&&n.push("unexpected tag ".concat(s," while searching for end of pixel data element with undefined length")),l>e.byteArray.length-e.position&&(l=e.byteArray.length-e.position),t.fragments.push({offset:e.position-r-8,position:e.position,length:l}),e.seek(l),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-r-8,position:e.position,length:l}),e.seek(l)}n&&n.push("pixel data element ".concat(t.tag," missing sequence delimiter tag xfffee0dd"))}function v(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}function y(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var o,a="",i=0;i<n;i++){if(0===(o=e[t+i]))return t+=n,a;a+=String.fromCharCode(o)}return a}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function x(e,t){return void 0!==e.parser?e.parser:t}var w=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=o}var t,n,o;return t=e,(n=[{key:"uint16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readUint16(this.byteArray,e.dataOffset+2*t)}},{key:"int16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readInt16(this.byteArray,e.dataOffset+2*t)}},{key:"uint32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readUint32(this.byteArray,e.dataOffset+4*t)}},{key:"int32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readInt32(this.byteArray,e.dataOffset+4*t)}},{key:"float",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readFloat(this.byteArray,e.dataOffset+4*t)}},{key:"double",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readDouble(this.byteArray,e.dataOffset+8*t)}},{key:"numStringValues",value:function(e){if((e=this.elements[e])&&0<e.length)return null===(e=y(this.byteArray,e.dataOffset,e.length).match(/\\/g))?1:e.length+1}},{key:"string",value:function(e,t){return(e=this.elements[e])&&e.Value?e.Value:e&&0<e.length?(e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].trim():e.trim()):void 0}},{key:"text",value:function(e,t){if((e=this.elements[e])&&0<e.length)return e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].replace(/ +$/,""):e.replace(/ +$/,"")}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseFloat(t)}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseInt(t)}},{key:"attributeTag",value:function(e){if((n=this.elements[e])&&4===n.length){var t=x(n,this.byteArrayParser).readUint16,n=(e=this.byteArray,n.dataOffset);return"x".concat("00000000".concat((256*t(e,n)*256+t(e,n+2)).toString(16)).substr(-8))}}}])&&b(t.prototype,n),o&&b(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function T(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}var I=function(e,t){return void 0!==e.vr?"SQ"===e.vr:t.position+4<=t.byteArray.length?(e=g(t),t.seek(-4),"xfffee000"===e||"xfffee0dd"===e):(t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function E(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var o;return 4294967295===(o={tag:o=g(e),vr:void 0!==n?n(o):void 0,length:e.readUint32(),dataOffset:e.position}).length&&(o.hadUndefinedLength=!0),o.tag===t||(!I(o,e)||i(o.tag)&&!o.hadUndefinedLength?o.hadUndefinedLength?T(e,o):e.seek(o.length):(A(e,o,n),i(o.tag)&&(o.items=void 0))),o}function S(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:g(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(e.position);return t}function C(e,t){var n=S(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var o=E(e,void 0,t);if("xfffee00d"===(n[o.tag]=o).tag)return new w(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),O(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}function A(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var o=g(e);if(e.seek(-4),"xfffee0dd"===o)return t.length=e.position-t.dataOffset,e.seek(8);o=C(e,n),t.items.push(o)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}:function(e,t,n){for(var o=t.dataOffset+t.length;e.position<o;){var a=C(e,n);t.items.push(a)}})(e,t,n)}function M(e,t){var n=S(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var o=L(e,t);if("xfffee00d"===(n[o.tag]=o).tag)return new w(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),k(n.dataSet,e,e.position+n.length)),n}function D(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var o=g(e);if(e.seek(-4),"xfffee0dd"===o)return t.length=e.position-t.dataOffset,e.seek(8);o=M(e,n),t.items.push(o)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}:function(e,t,n){for(var o=t.dataOffset+t.length;e.position<o;){var a=M(e,n);t.items.push(a)}})(e,t,n)}var P=function(e){return"OB"===e||"OD"===e||"OL"===e||"OW"===e||"SQ"===e||"OF"===e||"UC"===e||"UR"===e||"UT"===e||"UN"===e?4:2};function L(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var o={tag:g(e),vr:e.readFixedString(2)};return 2===P(o.vr)?o.length=e.readUint16():(e.seek(2),o.length=e.readUint32()),o.dataOffset=e.position,4294967295===o.length&&(o.hadUndefinedLength=!0),o.tag===n||("SQ"===o.vr?D(e,o,t):4294967295===o.length?"x7fe00010"===o.tag?p(e,o,t):("UN"===o.vr?A:T)(e,o):e.seek(o.length)),o}function k(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?t.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var a=e.elements;t.position<n;){var i=L(t,e.warnings,o.untilTag);if((a[i.tag]=i).tag===o.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function O(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?e.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;t.position<n;){var i=E(t,o.untilTag,o.vrCallback);if((a[i.tag]=i).tag===o.untilTag)return}}function R(e,t){if("undefined"!=typeof Buffer&&e instanceof Buffer)return Buffer.alloc(t);if(e instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"}var N="1.8.12",_={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=(e[t]<<8)+e[t+1])?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}};function U(e,t,n){if("undefined"!=typeof Buffer&&e instanceof Buffer)return e.slice(t,t+n);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+t,n);throw"dicomParser.from: unknown type for byteArray"}function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var V=function(){function e(t,n,o){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==0&&("undefined"==typeof Buffer||n instanceof Buffer==0))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(o<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(o>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=t,this.byteArray=n,this.position=o||0,this.warnings=[]}var t,n,o;return t=e,(n=[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=U(this.byteArray,this.position,t);return this.position+=t,new e(this.byteArrayParser,n)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=y(this.byteArray,this.position,e);return this.position+=e,t}}])&&B(t.prototype,n),o&&B(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),F={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=e[t]+(e[t+1]<<8))?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}};function H(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=t.TransferSyntaxUID,o=new V(F,e);return function(){var e=function(){if(o.getSize()<=132&&n)return!1;if(o.seek(128),"DICM"===o.readFixedString(4))return!0;if(!(t||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return o.seek(0),!1}(),a=[],i={};if(!e)return o.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:n}},warnings:a};for(;o.position<o.byteArray.length;){var r=o.position,s=L(o,a);if("x0002ffff"<s.tag){o.position=r;break}s.parser=F,i[s.tag]=s}return(e=new w(o.byteArrayParser,o.byteArray,i)).warnings=o.warnings,e.position=o.position,e}()}var j="1.2.840.10008.1.2.2";function z(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var o,a=function(t){if(void 0===t.elements.x00020010)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return(t=t.elements.x00020010)&&t.Value||y(e,t.dataOffset,t.length)};function i(o){var i="1.2.840.10008.1.2"!==(r=a(o)),r=function(o,a){var i="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);if("1.2.840.10008.1.2.1.99"!==o)return new V(o===j?_:F,e,a);if(t&&t.inflater)return o=t.inflater(e,a),new V(F,o,0);if(1==i){var r=n(0),s=U(e,a,e.length-a);return r=r.inflateRawSync(s),s=R(e,r.length+a),e.copy(s,0,0,a),r.copy(s,a),new V(F,s,0)}if("undefined"==typeof pako)throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return r=e.slice(a),s=pako.inflateRaw(r),(r=R(e,s.length+a)).set(e.slice(0,a),0),r.set(s,a),new V(F,r,0)}(r,o.position);(o=new w(r.byteArrayParser,r.byteArray,{})).warnings=r.warnings;try{(i?k:O)(o,r,r.byteArray.length,t)}catch(r){throw{exception:r,dataSet:o}}return o}return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(o=H(e,t),i(o))}var q=function(e,t,n){for(var o=0,a=t;a<t+n;a++)o+=e[a].length;return o};function W(e,t,n,o,a){if(a=a||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(o=o||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(o<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+o>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var i=new V(e.byteArrayParser,e.byteArray,t.dataOffset);if("xfffee000"!==(t=S(i)).tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";i.seek(t.length);var r=i.position;if(1===o)return U(i.byteArray,r+a[n].offset+8,a[n].length);t=q(a,n,o);for(var s=R(i.byteArray,t),l=0,c=n;c<n+o;c++)for(var u=r+a[c].offset+8,d=0;d<a[c].length;d++)s[l++]=i.byteArray[u++];return s}var G=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},Y=function(e,t,n,o){if(e===t.length-1)return n.length-o;for(var a=t[e+1],i=o+1;i<n.length;i++)if(n[i].offset===a)return i-o;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function Z(e,t,n,o,a){if(o=o||t.basicOffsetTable,a=a||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===o)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===o.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=o.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var i=o[n];if(void 0===(i=G(a,i)))throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return W(e,t,i,Y(n,o,a,i),a)}var K=!1;function X(e,t,n){if(K||(K=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?Z(e,t,n):W(e,t,0,t.fragments.length)}t.default={isStringVr:a,isPrivateTag:i,parsePN:r,parseTM:s,parseDA:c,explicitElementToString:u,explicitDataSetToJS:d,createJPEGBasicOffsetTable:f,parseDicomDataSetExplicit:k,parseDicomDataSetImplicit:O,readFixedString:y,alloc:R,version:N,bigEndianByteArrayParser:_,ByteStream:V,sharedCopy:U,DataSet:w,findAndSetUNElementLength:v,findEndOfEncapsulatedElement:p,findItemDelimitationItemAndSetElementLength:T,littleEndianByteArrayParser:F,parseDicom:z,readDicomElementExplicit:L,readDicomElementImplicit:E,readEncapsulatedImageFrame:Z,readEncapsulatedPixelData:X,readEncapsulatedPixelDataFromFragments:W,readPart10Header:H,readSequenceItemsExplicit:D,readSequenceItemsImplicit:A,readSequenceItem:S,readTag:g,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],o={},t.m=n,t.c=o,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(o,a,function(t){return e[t]}.bind(null,a));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1);function t(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return n[e].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n,o}(n(6559))},655:(e,t,n)=>{"use strict";var o=n(453)("%Object.defineProperty%",!0)||!1;if(o)try{o({},"a",{value:1})}catch(e){o=!1}e.exports=o},1237:e=>{"use strict";e.exports=EvalError},9383:e=>{"use strict";e.exports=Error},9290:e=>{"use strict";e.exports=RangeError},9538:e=>{"use strict";e.exports=ReferenceError},8068:e=>{"use strict";e.exports=SyntaxError},9675:e=>{"use strict";e.exports=TypeError},5345:e=>{"use strict";e.exports=URIError},9353:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,o=function(e,t){for(var n=[],o=0;o<e.length;o+=1)n[o]=e[o];for(var a=0;a<t.length;a+=1)n[a+e.length]=t[a];return n};e.exports=function(e){var a=this;if("function"!=typeof a||"[object Function]"!==t.apply(a))throw new TypeError("Function.prototype.bind called on incompatible "+a);for(var i,r=function(e,t){for(var n=[],o=t||0,a=0;o<e.length;o+=1,a+=1)n[a]=e[o];return n}(arguments,1),s=n(0,a.length-r.length),l=[],c=0;c<s;c++)l[c]="$"+c;if(i=Function("binder","return function ("+function(e,t){for(var n="",o=0;o<e.length;o+=1)n+=e[o],o+1<e.length&&(n+=t);return n}(l,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var t=a.apply(this,o(r,arguments));return Object(t)===t?t:this}return a.apply(e,o(r,arguments))})),a.prototype){var u=function(){};u.prototype=a.prototype,i.prototype=new u,u.prototype=null}return i}},6743:(e,t,n)=>{"use strict";var o=n(9353);e.exports=Function.prototype.bind||o},453:(e,t,n)=>{"use strict";var o,a=n(9383),i=n(1237),r=n(9290),s=n(9538),l=n(8068),c=n(9675),u=n(5345),d=Function,h=function(e){try{return d('"use strict"; return ('+e+").constructor;")()}catch(e){}},m=Object.getOwnPropertyDescriptor;if(m)try{m({},"")}catch(e){m=null}var f=function(){throw new c},g=m?function(){try{return f}catch(e){try{return m(arguments,"callee").get}catch(e){return f}}}():f,p=n(4039)(),v=n(24)(),y=Object.getPrototypeOf||(v?function(e){return e.__proto__}:null),b={},x="undefined"!=typeof Uint8Array&&y?y(Uint8Array):o,w={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?o:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?o:ArrayBuffer,"%ArrayIteratorPrototype%":p&&y?y([][Symbol.iterator]()):o,"%AsyncFromSyncIteratorPrototype%":o,"%AsyncFunction%":b,"%AsyncGenerator%":b,"%AsyncGeneratorFunction%":b,"%AsyncIteratorPrototype%":b,"%Atomics%":"undefined"==typeof Atomics?o:Atomics,"%BigInt%":"undefined"==typeof BigInt?o:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?o:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?o:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?o:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":a,"%eval%":eval,"%EvalError%":i,"%Float32Array%":"undefined"==typeof Float32Array?o:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?o:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?o:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":b,"%Int8Array%":"undefined"==typeof Int8Array?o:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?o:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?o:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":p&&y?y(y([][Symbol.iterator]())):o,"%JSON%":"object"==typeof JSON?JSON:o,"%Map%":"undefined"==typeof Map?o:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&p&&y?y((new Map)[Symbol.iterator]()):o,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?o:Promise,"%Proxy%":"undefined"==typeof Proxy?o:Proxy,"%RangeError%":r,"%ReferenceError%":s,"%Reflect%":"undefined"==typeof Reflect?o:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?o:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&p&&y?y((new Set)[Symbol.iterator]()):o,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?o:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":p&&y?y(""[Symbol.iterator]()):o,"%Symbol%":p?Symbol:o,"%SyntaxError%":l,"%ThrowTypeError%":g,"%TypedArray%":x,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?o:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?o:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?o:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?o:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?o:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?o:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?o:WeakSet};if(y)try{null.error}catch(e){var T=y(y(e));w["%Error.prototype%"]=T}var I=function e(t){var n;if("%AsyncFunction%"===t)n=h("async function () {}");else if("%GeneratorFunction%"===t)n=h("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=h("async function* () {}");else if("%AsyncGenerator%"===t){var o=e("%AsyncGeneratorFunction%");o&&(n=o.prototype)}else if("%AsyncIteratorPrototype%"===t){var a=e("%AsyncGenerator%");a&&y&&(n=y(a.prototype))}return w[t]=n,n},E={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},S=n(6743),C=n(9957),A=S.call(Function.call,Array.prototype.concat),M=S.call(Function.apply,Array.prototype.splice),D=S.call(Function.call,String.prototype.replace),P=S.call(Function.call,String.prototype.slice),L=S.call(Function.call,RegExp.prototype.exec),k=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,O=/\\(\\)?/g,R=function(e,t){var n,o=e;if(C(E,o)&&(o="%"+(n=E[o])[0]+"%"),C(w,o)){var a=w[o];if(a===b&&(a=I(o)),void 0===a&&!t)throw new c("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:o,value:a}}throw new l("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new c('"allowMissing" argument must be a boolean');if(null===L(/^%?[^%]*%?$/,e))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=P(e,0,1),n=P(e,-1);if("%"===t&&"%"!==n)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new l("invalid intrinsic syntax, expected opening `%`");var o=[];return D(e,k,(function(e,t,n,a){o[o.length]=n?D(a,O,"$1"):t||e})),o}(e),o=n.length>0?n[0]:"",a=R("%"+o+"%",t),i=a.name,r=a.value,s=!1,u=a.alias;u&&(o=u[0],M(n,A([0,1],u)));for(var d=1,h=!0;d<n.length;d+=1){var f=n[d],g=P(f,0,1),p=P(f,-1);if(('"'===g||"'"===g||"`"===g||'"'===p||"'"===p||"`"===p)&&g!==p)throw new l("property names with quotes must have matching quotes");if("constructor"!==f&&h||(s=!0),C(w,i="%"+(o+="."+f)+"%"))r=w[i];else if(null!=r){if(!(f in r)){if(!t)throw new c("base intrinsic for "+e+" exists, but the property is not available.");return}if(m&&d+1>=n.length){var v=m(r,f);r=(h=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:r[f]}else h=C(r,f),r=r[f];h&&!s&&(w[i]=r)}}return r}},5795:(e,t,n)=>{"use strict";var o=n(453)("%Object.getOwnPropertyDescriptor%",!0);if(o)try{o([],"length")}catch(e){o=null}e.exports=o},730:(e,t,n)=>{var o;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(a,i,r,s){"use strict";function l(e,t,n){return setTimeout(m(e,n),t)}function c(e,t,n){return!!Array.isArray(e)&&(u(e,n[t],n),!0)}function u(e,t,n){var o;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(o=0;o<e.length;)t.call(n,e[o],o,e),o++;else for(o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)}function d(e,t,n){var o="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=a.console&&(a.console.warn||a.console.log);return i&&i.call(a.console,o,n),e.apply(this,arguments)}}function h(e,t,n){var o,a=t.prototype;(o=e.prototype=Object.create(a)).constructor=e,o._super=a,n&&se(o,n)}function m(e,t){return function(){return e.apply(t,arguments)}}function f(e,t){return typeof e==ue?e.apply(t&&t[0]||s,t):e}function g(e,t){return e===s?t:e}function p(e,t,n){u(x(t),(function(t){e.addEventListener(t,n,!1)}))}function v(e,t,n){u(x(t),(function(t){e.removeEventListener(t,n,!1)}))}function y(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function b(e,t){return e.indexOf(t)>-1}function x(e){return e.trim().split(/\s+/g)}function w(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var o=0;o<e.length;){if(n&&e[o][n]==t||!n&&e[o]===t)return o;o++}return-1}function T(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var o=[],a=[],i=0;i<e.length;){var r=t?e[i][t]:e[i];w(a,r)<0&&o.push(e[i]),a[i]=r,i++}return n&&(o=t?o.sort((function(e,n){return e[t]>n[t]})):o.sort()),o}function E(e,t){for(var n,o,a=t[0].toUpperCase()+t.slice(1),i=0;i<le.length;){if((o=(n=le[i])?n+a:t)in e)return o;i++}return s}function S(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||a}function C(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){f(e.options.enable,[e])&&n.handler(t)},this.init()}function A(e,t,n){var o=n.pointers.length,a=n.changedPointers.length,i=t&Ie&&o-a==0,r=t&(Se|Ce)&&o-a==0;n.isFirst=!!i,n.isFinal=!!r,i&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,o=t.pointers,a=o.length;n.firstInput||(n.firstInput=D(t)),a>1&&!n.firstMultiple?n.firstMultiple=D(t):1===a&&(n.firstMultiple=!1);var i=n.firstInput,r=n.firstMultiple,s=r?r.center:i.center,l=t.center=P(o);t.timeStamp=me(),t.deltaTime=t.timeStamp-i.timeStamp,t.angle=R(s,l),t.distance=O(s,l),function(e,t){var n=t.center,o=e.offsetDelta||{},a=e.prevDelta||{},i=e.prevInput||{};t.eventType!==Ie&&i.eventType!==Se||(a=e.prevDelta={x:i.deltaX||0,y:i.deltaY||0},o=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=a.x+(n.x-o.x),t.deltaY=a.y+(n.y-o.y)}(n,t),t.offsetDirection=k(t.deltaX,t.deltaY);var c=L(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=he(c.x)>he(c.y)?c.x:c.y,t.scale=r?function(e,t){return O(t[0],t[1],_e)/O(e[0],e[1],_e)}(r.pointers,o):1,t.rotation=r?function(e,t){return R(t[1],t[0],_e)+R(e[1],e[0],_e)}(r.pointers,o):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,M(n,t);var u=e.element;y(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function M(e,t){var n,o,a,i,r=e.lastInterval||t,l=t.timeStamp-r.timeStamp;if(t.eventType!=Ce&&(l>Te||r.velocity===s)){var c=t.deltaX-r.deltaX,u=t.deltaY-r.deltaY,d=L(l,c,u);o=d.x,a=d.y,n=he(d.x)>he(d.y)?d.x:d.y,i=k(c,u),e.lastInterval=t}else n=r.velocity,o=r.velocityX,a=r.velocityY,i=r.direction;t.velocity=n,t.velocityX=o,t.velocityY=a,t.direction=i}function D(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:de(e.pointers[n].clientX),clientY:de(e.pointers[n].clientY)},n++;return{timeStamp:me(),pointers:t,center:P(t),deltaX:e.deltaX,deltaY:e.deltaY}}function P(e){var t=e.length;if(1===t)return{x:de(e[0].clientX),y:de(e[0].clientY)};for(var n=0,o=0,a=0;t>a;)n+=e[a].clientX,o+=e[a].clientY,a++;return{x:de(n/t),y:de(o/t)}}function L(e,t,n){return{x:t/e||0,y:n/e||0}}function k(e,t){return e===t?Ae:he(e)>=he(t)?0>e?Me:De:0>t?Pe:Le}function O(e,t,n){n||(n=Ne);var o=t[n[0]]-e[n[0]],a=t[n[1]]-e[n[1]];return Math.sqrt(o*o+a*a)}function R(e,t,n){n||(n=Ne);var o=t[n[0]]-e[n[0]],a=t[n[1]]-e[n[1]];return 180*Math.atan2(a,o)/Math.PI}function N(){this.evEl=Be,this.evWin=Ve,this.pressed=!1,C.apply(this,arguments)}function _(){this.evEl=je,this.evWin=ze,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function U(){this.evTarget=We,this.evWin=Ge,this.started=!1,C.apply(this,arguments)}function B(e,t){var n=T(e.touches),o=T(e.changedTouches);return t&(Se|Ce)&&(n=I(n.concat(o),"identifier",!0)),[n,o]}function V(){this.evTarget=Ze,this.targetIds={},C.apply(this,arguments)}function F(e,t){var n=T(e.touches),o=this.targetIds;if(t&(Ie|Ee)&&1===n.length)return o[n[0].identifier]=!0,[n,n];var a,i,r=T(e.changedTouches),s=[],l=this.target;if(i=n.filter((function(e){return y(e.target,l)})),t===Ie)for(a=0;a<i.length;)o[i[a].identifier]=!0,a++;for(a=0;a<r.length;)o[r[a].identifier]&&s.push(r[a]),t&(Se|Ce)&&delete o[r[a].identifier],a++;return s.length?[I(i.concat(s),"identifier",!0),s]:void 0}function H(){C.apply(this,arguments);var e=m(this.handler,this);this.touch=new V(this.manager,e),this.mouse=new N(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function j(e,t){e&Ie?(this.primaryTouch=t.changedPointers[0].identifier,z.call(this,t)):e&(Se|Ce)&&z.call(this,t)}function z(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var o=this.lastTouches;setTimeout((function(){var e=o.indexOf(n);e>-1&&o.splice(e,1)}),Ke)}}function q(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,o=0;o<this.lastTouches.length;o++){var a=this.lastTouches[o],i=Math.abs(t-a.x),r=Math.abs(n-a.y);if(Xe>=i&&Xe>=r)return!0}return!1}function W(e,t){this.manager=e,this.set(t)}function G(e){this.options=se({},this.defaults,e||{}),this.id=pe++,this.manager=null,this.options.enable=g(this.options.enable,!0),this.state=rt,this.simultaneous={},this.requireFail=[]}function Y(e){return e&dt?"cancel":e&ct?"end":e&lt?"move":e&st?"start":""}function Z(e){return e==Le?"down":e==Pe?"up":e==Me?"left":e==De?"right":""}function K(e,t){var n=t.manager;return n?n.get(e):e}function X(){G.apply(this,arguments)}function J(){X.apply(this,arguments),this.pX=null,this.pY=null}function Q(){X.apply(this,arguments)}function $(){G.apply(this,arguments),this._timer=null,this._input=null}function ee(){X.apply(this,arguments)}function te(){X.apply(this,arguments)}function ne(){G.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function oe(e,t){return(t=t||{}).recognizers=g(t.recognizers,oe.defaults.preset),new ae(e,t)}function ae(e,t){this.options=se({},oe.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(ye?_:be?V:ve?H:N))(e,A)}(this),this.touchAction=new W(this,this.options.touchAction),ie(this,!0),u(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function ie(e,t){var n,o=e.element;o.style&&(u(e.options.cssProps,(function(a,i){n=E(o.style,i),t?(e.oldCssProps[n]=o.style[n],o.style[n]=a):o.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}function re(e,t){var n=i.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}var se,le=["","webkit","Moz","MS","ms","o"],ce=i.createElement("div"),ue="function",de=Math.round,he=Math.abs,me=Date.now;se="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(o!==s&&null!==o)for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])}return t}:Object.assign;var fe=d((function(e,t,n){for(var o=Object.keys(t),a=0;a<o.length;)(!n||n&&e[o[a]]===s)&&(e[o[a]]=t[o[a]]),a++;return e}),"extend","Use `assign`."),ge=d((function(e,t){return fe(e,t,!0)}),"merge","Use `assign`."),pe=1,ve="ontouchstart"in a,ye=E(a,"PointerEvent")!==s,be=ve&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),xe="touch",we="mouse",Te=25,Ie=1,Ee=2,Se=4,Ce=8,Ae=1,Me=2,De=4,Pe=8,Le=16,ke=Me|De,Oe=Pe|Le,Re=ke|Oe,Ne=["x","y"],_e=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(S(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(S(this.element),this.evWin,this.domHandler)}};var Ue={mousedown:Ie,mousemove:Ee,mouseup:Se},Be="mousedown",Ve="mousemove mouseup";h(N,C,{handler:function(e){var t=Ue[e.type];t&Ie&&0===e.button&&(this.pressed=!0),t&Ee&&1!==e.which&&(t=Se),this.pressed&&(t&Se&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:we,srcEvent:e}))}});var Fe={pointerdown:Ie,pointermove:Ee,pointerup:Se,pointercancel:Ce,pointerout:Ce},He={2:xe,3:"pen",4:we,5:"kinect"},je="pointerdown",ze="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(je="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel"),h(_,C,{handler:function(e){var t=this.store,n=!1,o=e.type.toLowerCase().replace("ms",""),a=Fe[o],i=He[e.pointerType]||e.pointerType,r=i==xe,s=w(t,e.pointerId,"pointerId");a&Ie&&(0===e.button||r)?0>s&&(t.push(e),s=t.length-1):a&(Se|Ce)&&(n=!0),0>s||(t[s]=e,this.callback(this.manager,a,{pointers:t,changedPointers:[e],pointerType:i,srcEvent:e}),n&&t.splice(s,1))}});var qe={touchstart:Ie,touchmove:Ee,touchend:Se,touchcancel:Ce},We="touchstart",Ge="touchstart touchmove touchend touchcancel";h(U,C,{handler:function(e){var t=qe[e.type];if(t===Ie&&(this.started=!0),this.started){var n=B.call(this,e,t);t&(Se|Ce)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:xe,srcEvent:e})}}});var Ye={touchstart:Ie,touchmove:Ee,touchend:Se,touchcancel:Ce},Ze="touchstart touchmove touchend touchcancel";h(V,C,{handler:function(e){var t=Ye[e.type],n=F.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:xe,srcEvent:e})}});var Ke=2500,Xe=25;h(H,C,{handler:function(e,t,n){var o=n.pointerType==xe,a=n.pointerType==we;if(!(a&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(o)j.call(this,t,n);else if(a&&q.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Je=E(ce.style,"touchAction"),Qe=Je!==s,$e="compute",et="auto",tt="manipulation",nt="none",ot="pan-x",at="pan-y",it=function(){if(!Qe)return!1;var e={},t=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||a.CSS.supports("touch-action",n)})),e}();W.prototype={set:function(e){e==$e&&(e=this.compute()),Qe&&this.manager.element.style&&it[e]&&(this.manager.element.style[Je]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return u(this.manager.recognizers,(function(t){f(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(b(e,nt))return nt;var t=b(e,ot),n=b(e,at);return t&&n?nt:t||n?t?ot:at:b(e,tt)?tt:et}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(!this.manager.session.prevented){var o=this.actions,a=b(o,nt)&&!it[nt],i=b(o,at)&&!it[at],r=b(o,ot)&&!it[ot];if(a){var s=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(s&&l&&c)return}return r&&i?void 0:a||i&&n&ke||r&&n&Oe?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var rt=1,st=2,lt=4,ct=8,ut=ct,dt=16,ht=32;G.prototype={defaults:{},set:function(e){return se(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(c(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=K(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return c(e,"dropRecognizeWith",this)||(e=K(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(c(e,"requireFailure",this))return this;var t=this.requireFail;return-1===w(t,e=K(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(c(e,"dropRequireFailure",this))return this;e=K(e,this);var t=w(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,o=this.state;ct>o&&t(n.options.event+Y(o)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),o>=ct&&t(n.options.event+Y(o))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=ht)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ht|rt)))return!1;e++}return!0},recognize:function(e){var t=se({},e);return f(this.options.enable,[this,t])?(this.state&(ut|dt|ht)&&(this.state=rt),this.state=this.process(t),void(this.state&(st|lt|ct|dt)&&this.tryEmit(t))):(this.reset(),void(this.state=ht))},process:function(e){},getTouchAction:function(){},reset:function(){}},h(X,G,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,o=t&(st|lt),a=this.attrTest(e);return o&&(n&Ce||!a)?t|dt:o||a?n&Se?t|ct:t&st?t|lt:st:ht}}),h(J,X,{defaults:{event:"pan",threshold:10,pointers:1,direction:Re},getTouchAction:function(){var e=this.options.direction,t=[];return e&ke&&t.push(at),e&Oe&&t.push(ot),t},directionTest:function(e){var t=this.options,n=!0,o=e.distance,a=e.direction,i=e.deltaX,r=e.deltaY;return a&t.direction||(t.direction&ke?(a=0===i?Ae:0>i?Me:De,n=i!=this.pX,o=Math.abs(e.deltaX)):(a=0===r?Ae:0>r?Pe:Le,n=r!=this.pY,o=Math.abs(e.deltaY))),e.direction=a,n&&o>t.threshold&&a&t.direction},attrTest:function(e){return X.prototype.attrTest.call(this,e)&&(this.state&st||!(this.state&st)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Z(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),h(Q,X,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&st)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),h($,G,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[et]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,o=e.distance<t.threshold,a=e.deltaTime>t.time;if(this._input=e,!o||!n||e.eventType&(Se|Ce)&&!a)this.reset();else if(e.eventType&Ie)this.reset(),this._timer=l((function(){this.state=ut,this.tryEmit()}),t.time,this);else if(e.eventType&Se)return ut;return ht},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ut&&(e&&e.eventType&Se?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=me(),this.manager.emit(this.options.event,this._input)))}}),h(ee,X,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&st)}}),h(te,X,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ke|Oe,pointers:1},getTouchAction:function(){return J.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(ke|Oe)?t=e.overallVelocity:n&ke?t=e.overallVelocityX:n&Oe&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&he(t)>this.options.velocity&&e.eventType&Se},emit:function(e){var t=Z(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),h(ne,G,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[tt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,o=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),e.eventType&Ie&&0===this.count)return this.failTimeout();if(o&&a&&n){if(e.eventType!=Se)return this.failTimeout();var i=!this.pTime||e.timeStamp-this.pTime<t.interval,r=!this.pCenter||O(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,r&&i?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=l((function(){this.state=ut,this.tryEmit()}),t.interval,this),st):ut}return ht},failTimeout:function(){return this._timer=l((function(){this.state=ht}),this.options.interval,this),ht},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),oe.VERSION="2.0.7",oe.defaults={domEvents:!1,touchAction:$e,enable:!0,inputTarget:null,inputClass:null,preset:[[ee,{enable:!1}],[Q,{enable:!1},["rotate"]],[te,{direction:ke}],[J,{direction:ke},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[$]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ae.prototype={set:function(e){return se(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,o=this.recognizers,a=t.curRecognizer;(!a||a&&a.state&ut)&&(a=t.curRecognizer=null);for(var i=0;i<o.length;)n=o[i],2===t.stopped||a&&n!=a&&!n.canRecognizeWith(a)?n.reset():n.recognize(e),!a&&n.state&(st|lt|ct)&&(a=t.curRecognizer=n),i++}},get:function(e){if(e instanceof G)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(c(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(c(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=w(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return u(x(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==s){var n=this.handlers;return u(x(e),(function(e){t?n[e]&&n[e].splice(w(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&re(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var o=0;o<n.length;)n[o](t),o++}},destroy:function(){this.element&&ie(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},se(oe,{INPUT_START:Ie,INPUT_MOVE:Ee,INPUT_END:Se,INPUT_CANCEL:Ce,STATE_POSSIBLE:rt,STATE_BEGAN:st,STATE_CHANGED:lt,STATE_ENDED:ct,STATE_RECOGNIZED:ut,STATE_CANCELLED:dt,STATE_FAILED:ht,DIRECTION_NONE:Ae,DIRECTION_LEFT:Me,DIRECTION_RIGHT:De,DIRECTION_UP:Pe,DIRECTION_DOWN:Le,DIRECTION_HORIZONTAL:ke,DIRECTION_VERTICAL:Oe,DIRECTION_ALL:Re,Manager:ae,Input:C,TouchAction:W,TouchInput:V,MouseInput:N,PointerEventInput:_,TouchMouseInput:H,SingleTouchInput:U,Recognizer:G,AttrRecognizer:X,Tap:ne,Pan:J,Swipe:te,Pinch:Q,Rotate:ee,Press:$,on:p,off:v,each:u,merge:ge,extend:fe,assign:se,inherit:h,bindFn:m,prefixed:E}),(void 0!==a?a:"undefined"!=typeof self?self:{}).Hammer=oe,void 0===(o=function(){return oe}.call(t,n,t,e))||(e.exports=o)}(window,document)},592:(e,t,n)=>{"use strict";var o=n(655),a=function(){return!!o};a.hasArrayLengthDefineBug=function(){if(!o)return null;try{return 1!==o([],"length",{value:1}).length}catch(e){return!0}},e.exports=a},24:e=>{"use strict";var t={__proto__:null,foo:{}},n=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof n)}},4039:(e,t,n)=>{"use strict";var o="undefined"!=typeof Symbol&&Symbol,a=n(1333);e.exports=function(){return"function"==typeof o&&("function"==typeof Symbol&&("symbol"==typeof o("foo")&&("symbol"==typeof Symbol("bar")&&a())))}},1333:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var o=Object.getOwnPropertySymbols(e);if(1!==o.length||o[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var a=Object.getOwnPropertyDescriptor(e,t);if(42!==a.value||!0!==a.enumerable)return!1}return!0}},9957:(e,t,n)=>{"use strict";var o=Function.prototype.call,a=Object.prototype.hasOwnProperty,i=n(6743);e.exports=i.call(o,a)},346:function(e,t,n){var o,a,i;void 0!==n.g?n.g:window||this.window||this.global,a=[],o=function(e){"use strict";var t={},n="iziToast",o=(document.querySelector("body"),!!/Mobi/.test(navigator.userAgent)),a=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),i="undefined"!=typeof InstallTrigger,r="ontouchstart"in document.documentElement,s=["bottomRight","bottomLeft","bottomCenter","topRight","topLeft","topCenter","center"],l={info:{color:"blue",icon:"ico-info"},success:{color:"green",icon:"ico-success"},warning:{color:"orange",icon:"ico-warning"},error:{color:"red",icon:"ico-error"},question:{color:"yellow",icon:"ico-question"}},c=568,u={};t.children={};var d={id:null,class:"",title:"",titleColor:"",titleSize:"",titleLineHeight:"",message:"",messageColor:"",messageSize:"",messageLineHeight:"",backgroundColor:"",theme:"light",color:"",icon:"",iconText:"",iconColor:"",iconUrl:null,image:"",imageWidth:50,maxWidth:null,zindex:null,layout:1,balloon:!1,close:!0,closeOnEscape:!1,closeOnClick:!1,displayMode:0,position:"bottomRight",target:"",targetFirst:!0,timeout:5e3,rtl:!1,animateInside:!0,drag:!0,pauseOnHover:!0,resetOnHover:!1,progressBar:!0,progressBarColor:"",progressBarEasing:"linear",overlay:!1,overlayClose:!1,overlayColor:"rgba(0, 0, 0, 0.6)",transitionIn:"fadeInUp",transitionOut:"fadeOut",transitionInMobile:"fadeInUp",transitionOutMobile:"fadeOutDown",buttons:{},inputs:{},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){}};if("remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),"function"!=typeof window.CustomEvent){var h=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};h.prototype=window.Event.prototype,window.CustomEvent=h}var m=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(n,e[o],o,e);else if(e)for(var a=0,i=e.length;i>a;a++)t.call(n,e[a],a,e)},f=function(e,t){var n={};return m(e,(function(t,o){n[o]=e[o]})),m(t,(function(e,o){n[o]=t[o]})),n},g=function(e){var t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.firstChild);return t},p=function(e){return btoa(encodeURIComponent(e)).replace(/=/g,"")},v=function(e){return"#"==e.substring(0,1)||"rgb"==e.substring(0,3)||"hsl"==e.substring(0,3)},y=function(e){try{return btoa(atob(e))==e}catch(e){return!1}},b={move:function(e,t,o,r){var s,l=.3,c=180;0!==r&&(e.classList.add(n+"-dragged"),e.style.transform="translateX("+r+"px)",r>0?l>(s=(c-r)/c)&&t.hide(f(o,{transitionOut:"fadeOutRight",transitionOutMobile:"fadeOutRight"}),e,"drag"):l>(s=(c+r)/c)&&t.hide(f(o,{transitionOut:"fadeOutLeft",transitionOutMobile:"fadeOutLeft"}),e,"drag"),e.style.opacity=s,l>s&&((a||i)&&(e.style.left=r+"px"),e.parentNode.style.opacity=l,this.stopMoving(e,null)))},startMoving:function(e,t,n,o){o=o||window.event;var a=r?o.touches[0].clientX:o.clientX,i=e.style.transform.replace("px)",""),s=a-(i=i.replace("translateX(",""));n.transitionIn&&e.classList.remove(n.transitionIn),n.transitionInMobile&&e.classList.remove(n.transitionInMobile),e.style.transition="",r?document.ontouchmove=function(o){o.preventDefault();var a=(o=o||window.event).touches[0].clientX-s;b.move(e,t,n,a)}:document.onmousemove=function(o){o.preventDefault();var a=(o=o||window.event).clientX-s;b.move(e,t,n,a)}},stopMoving:function(e,t){r?document.ontouchmove=function(){}:document.onmousemove=function(){},e.style.opacity="",e.style.transform="",e.classList.contains(n+"-dragged")&&(e.classList.remove(n+"-dragged"),e.style.transition="transform 0.4s ease, opacity 0.4s ease",setTimeout((function(){e.style.transition=""}),400))}};return t.setSetting=function(e,n,o){t.children[e][n]=o},t.getSetting=function(e,n){return t.children[e][n]},t.destroy=function(){m(document.querySelectorAll("."+n+"-overlay"),(function(e,t){e.remove()})),m(document.querySelectorAll("."+n+"-wrapper"),(function(e,t){e.remove()})),m(document.querySelectorAll("."+n),(function(e,t){e.remove()})),this.children={},document.removeEventListener(n+"-opened",{},!1),document.removeEventListener(n+"-opening",{},!1),document.removeEventListener(n+"-closing",{},!1),document.removeEventListener(n+"-closed",{},!1),document.removeEventListener("keyup",{},!1),u={}},t.settings=function(e){t.destroy(),u=e,d=f(d,e||{})},m(l,(function(e,n){t[n]=function(t){var n=f(u,t||{});n=f(e,n||{}),this.show(n)}})),t.progress=function(e,t,o){var a=this,i=t.getAttribute("data-iziToast-ref"),r=f(this.children[i],e||{}),s=t.querySelector("."+n+"-progressbar div");return{start:function(){void 0===r.time.REMAINING&&(t.classList.remove(n+"-reseted"),null!==s&&(s.style.transition="width "+r.timeout+"ms "+r.progressBarEasing,s.style.width="0%"),r.time.START=(new Date).getTime(),r.time.END=r.time.START+r.timeout,r.time.TIMER=setTimeout((function(){clearTimeout(r.time.TIMER),t.classList.contains(n+"-closing")||(a.hide(r,t,"timeout"),"function"==typeof o&&o.apply(a))}),r.timeout),a.setSetting(i,"time",r.time))},pause:function(){if(void 0!==r.time.START&&!t.classList.contains(n+"-paused")&&!t.classList.contains(n+"-reseted")){if(t.classList.add(n+"-paused"),r.time.REMAINING=r.time.END-(new Date).getTime(),clearTimeout(r.time.TIMER),a.setSetting(i,"time",r.time),null!==s){var e=window.getComputedStyle(s).getPropertyValue("width");s.style.transition="none",s.style.width=e}"function"==typeof o&&setTimeout((function(){o.apply(a)}),10)}},resume:function(){void 0!==r.time.REMAINING?(t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="width "+r.time.REMAINING+"ms "+r.progressBarEasing,s.style.width="0%"),r.time.END=(new Date).getTime()+r.time.REMAINING,r.time.TIMER=setTimeout((function(){clearTimeout(r.time.TIMER),t.classList.contains(n+"-closing")||(a.hide(r,t,"timeout"),"function"==typeof o&&o.apply(a))}),r.time.REMAINING),a.setSetting(i,"time",r.time)):this.start()},reset:function(){clearTimeout(r.time.TIMER),delete r.time.REMAINING,a.setSetting(i,"time",r.time),t.classList.add(n+"-reseted"),t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="none",s.style.width="100%"),"function"==typeof o&&setTimeout((function(){o.apply(a)}),10)}}},t.hide=function(e,t,a){"object"!=typeof t&&(t=document.querySelector(t));var i=this,r=f(this.children[t.getAttribute("data-iziToast-ref")],e||{});r.closedBy=a||null,delete r.time.REMAINING,t.classList.add(n+"-closing"),function(){var e=document.querySelector("."+n+"-overlay");if(null!==e){var t=e.getAttribute("data-iziToast-ref"),o=(t=t.split(",")).indexOf(String(r.ref));-1!==o&&t.splice(o,1),e.setAttribute("data-iziToast-ref",t.join()),0===t.length&&(e.classList.remove("fadeIn"),e.classList.add("fadeOut"),setTimeout((function(){e.remove()}),700))}}(),r.transitionIn&&t.classList.remove(r.transitionIn),r.transitionInMobile&&t.classList.remove(r.transitionInMobile),o||window.innerWidth<=c?r.transitionOutMobile&&t.classList.add(r.transitionOutMobile):r.transitionOut&&t.classList.add(r.transitionOut);var s=t.parentNode.offsetHeight;t.parentNode.style.height=s+"px",t.style.pointerEvents="none",(!o||window.innerWidth>c)&&(t.parentNode.style.transitionDelay="0.2s");try{var l=new CustomEvent(n+"-closing",{detail:r,bubbles:!0,cancelable:!0});document.dispatchEvent(l)}catch(e){console.warn(e)}setTimeout((function(){t.parentNode.style.height="0px",t.parentNode.style.overflow="",setTimeout((function(){delete i.children[r.ref],t.parentNode.remove();try{var e=new CustomEvent(n+"-closed",{detail:r,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}void 0!==r.onClosed&&r.onClosed.apply(null,[r,t,a])}),1e3)}),200),void 0!==r.onClosing&&r.onClosing.apply(null,[r,t,a])},t.show=function(e){var a=this,i=f(u,e||{});if((i=f(d,i)).time={},null===i.id&&(i.id=p(i.title+i.message+i.color)),1===i.displayMode||"once"==i.displayMode)try{if(document.querySelectorAll("."+n+"#"+i.id).length>0)return!1}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+i.id+". Try to set an valid id.")}if(2===i.displayMode||"replace"==i.displayMode)try{m(document.querySelectorAll("."+n+"#"+i.id),(function(e,t){a.hide(i,e,"replaced")}))}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+i.id+". Try to set an valid id.")}i.ref=(new Date).getTime()+Math.floor(1e7*Math.random()+1),t.children[i.ref]=i;var l,h={body:document.querySelector("body"),overlay:document.createElement("div"),toast:document.createElement("div"),toastBody:document.createElement("div"),toastTexts:document.createElement("div"),toastCapsule:document.createElement("div"),cover:document.createElement("div"),buttons:document.createElement("div"),inputs:document.createElement("div"),icon:i.iconUrl?document.createElement("img"):document.createElement("i"),wrapper:null};h.toast.setAttribute("data-iziToast-ref",i.ref),h.toast.appendChild(h.toastBody),h.toastCapsule.appendChild(h.toast),function(){if(h.toast.classList.add(n),h.toast.classList.add(n+"-opening"),h.toastCapsule.classList.add(n+"-capsule"),h.toastBody.classList.add(n+"-body"),h.toastTexts.classList.add(n+"-texts"),o||window.innerWidth<=c?i.transitionInMobile&&h.toast.classList.add(i.transitionInMobile):i.transitionIn&&h.toast.classList.add(i.transitionIn),i.class){var e=i.class.split(" ");m(e,(function(e,t){h.toast.classList.add(e)}))}i.id&&(h.toast.id=i.id),i.rtl&&(h.toast.classList.add(n+"-rtl"),h.toast.setAttribute("dir","rtl")),i.layout>1&&h.toast.classList.add(n+"-layout"+i.layout),i.balloon&&h.toast.classList.add(n+"-balloon"),i.maxWidth&&(isNaN(i.maxWidth)?h.toast.style.maxWidth=i.maxWidth:h.toast.style.maxWidth=i.maxWidth+"px"),""===i.theme&&"light"===i.theme||h.toast.classList.add(n+"-theme-"+i.theme),i.color&&(v(i.color)?h.toast.style.background=i.color:h.toast.classList.add(n+"-color-"+i.color)),i.backgroundColor&&(h.toast.style.background=i.backgroundColor,i.balloon&&(h.toast.style.borderColor=i.backgroundColor))}(),i.image&&(h.cover.classList.add(n+"-cover"),h.cover.style.width=i.imageWidth+"px",y(i.image.replace(/ /g,""))?h.cover.style.backgroundImage="url(data:image/png;base64,"+i.image.replace(/ /g,"")+")":h.cover.style.backgroundImage="url("+i.image+")",i.rtl?h.toastBody.style.marginRight=i.imageWidth+10+"px":h.toastBody.style.marginLeft=i.imageWidth+10+"px",h.toast.appendChild(h.cover)),i.close?(h.buttonClose=document.createElement("button"),h.buttonClose.type="button",h.buttonClose.classList.add(n+"-close"),h.buttonClose.addEventListener("click",(function(e){e.target,a.hide(i,h.toast,"button")})),h.toast.appendChild(h.buttonClose)):i.rtl?h.toast.style.paddingLeft="18px":h.toast.style.paddingRight="18px",i.progressBar&&(h.progressBar=document.createElement("div"),h.progressBarDiv=document.createElement("div"),h.progressBar.classList.add(n+"-progressbar"),h.progressBarDiv.style.background=i.progressBarColor,h.progressBar.appendChild(h.progressBarDiv),h.toast.appendChild(h.progressBar)),i.timeout&&(i.pauseOnHover&&!i.resetOnHover&&(h.toast.addEventListener("mouseenter",(function(e){a.progress(i,h.toast).pause()})),h.toast.addEventListener("mouseleave",(function(e){a.progress(i,h.toast).resume()}))),i.resetOnHover&&(h.toast.addEventListener("mouseenter",(function(e){a.progress(i,h.toast).reset()})),h.toast.addEventListener("mouseleave",(function(e){a.progress(i,h.toast).start()})))),i.iconUrl?(h.icon.setAttribute("class",n+"-icon"),h.icon.setAttribute("src",i.iconUrl)):i.icon&&(h.icon.setAttribute("class",n+"-icon "+i.icon),i.iconText&&h.icon.appendChild(document.createTextNode(i.iconText)),i.iconColor&&(h.icon.style.color=i.iconColor)),(i.icon||i.iconUrl)&&(i.rtl?h.toastBody.style.paddingRight="33px":h.toastBody.style.paddingLeft="33px",h.toastBody.appendChild(h.icon)),i.title.length>0&&(h.strong=document.createElement("strong"),h.strong.classList.add(n+"-title"),h.strong.appendChild(g(i.title)),h.toastTexts.appendChild(h.strong),i.titleColor&&(h.strong.style.color=i.titleColor),i.titleSize&&(isNaN(i.titleSize)?h.strong.style.fontSize=i.titleSize:h.strong.style.fontSize=i.titleSize+"px"),i.titleLineHeight&&(isNaN(i.titleSize)?h.strong.style.lineHeight=i.titleLineHeight:h.strong.style.lineHeight=i.titleLineHeight+"px")),i.message.length>0&&(h.p=document.createElement("p"),h.p.classList.add(n+"-message"),h.p.appendChild(g(i.message)),h.toastTexts.appendChild(h.p),i.messageColor&&(h.p.style.color=i.messageColor),i.messageSize&&(isNaN(i.titleSize)?h.p.style.fontSize=i.messageSize:h.p.style.fontSize=i.messageSize+"px"),i.messageLineHeight&&(isNaN(i.titleSize)?h.p.style.lineHeight=i.messageLineHeight:h.p.style.lineHeight=i.messageLineHeight+"px")),i.title.length>0&&i.message.length>0&&(i.rtl?h.strong.style.marginLeft="10px":2===i.layout||i.rtl||(h.strong.style.marginRight="10px")),h.toastBody.appendChild(h.toastTexts),i.inputs.length>0&&(h.inputs.classList.add(n+"-inputs"),m(i.inputs,(function(e,t){h.inputs.appendChild(g(e[0])),(l=h.inputs.childNodes)[t].classList.add(n+"-inputs-child"),e[3]&&setTimeout((function(){l[t].focus()}),300),l[t].addEventListener(e[1],(function(t){return(0,e[2])(a,h.toast,this,t)}))})),h.toastBody.appendChild(h.inputs)),i.buttons.length>0&&(h.buttons.classList.add(n+"-buttons"),m(i.buttons,(function(e,t){h.buttons.appendChild(g(e[0]));var o=h.buttons.childNodes;o[t].classList.add(n+"-buttons-child"),e[2]&&setTimeout((function(){o[t].focus()}),300),o[t].addEventListener("click",(function(t){return t.preventDefault(),(0,e[1])(a,h.toast,this,t,l)}))}))),h.toastBody.appendChild(h.buttons),i.message.length>0&&(i.inputs.length>0||i.buttons.length>0)&&(h.p.style.marginBottom="0"),(i.inputs.length>0||i.buttons.length>0)&&(i.rtl?h.toastTexts.style.marginLeft="10px":h.toastTexts.style.marginRight="10px",i.inputs.length>0&&i.buttons.length>0&&(i.rtl?h.inputs.style.marginLeft="8px":h.inputs.style.marginRight="8px")),h.toastCapsule.style.visibility="hidden",setTimeout((function(){var e=h.toast.offsetHeight,t=h.toast.currentStyle||window.getComputedStyle(h.toast),n=t.marginTop;n=n.split("px"),n=parseInt(n[0]);var o=t.marginBottom;o=o.split("px"),o=parseInt(o[0]),h.toastCapsule.style.visibility="",h.toastCapsule.style.height=e+o+n+"px",setTimeout((function(){h.toastCapsule.style.height="auto",i.target&&(h.toastCapsule.style.overflow="visible")}),500),i.timeout&&a.progress(i,h.toast).start()}),100),function(){var e=i.position;if(i.target)h.wrapper=document.querySelector(i.target),h.wrapper.classList.add(n+"-target"),i.targetFirst?h.wrapper.insertBefore(h.toastCapsule,h.wrapper.firstChild):h.wrapper.appendChild(h.toastCapsule);else{if(-1==s.indexOf(i.position))return void console.warn("["+n+"] Incorrect position.\nIt can be  "+s);e=o||window.innerWidth<=c?"bottomLeft"==i.position||"bottomRight"==i.position||"bottomCenter"==i.position?n+"-wrapper-bottomCenter":"topLeft"==i.position||"topRight"==i.position||"topCenter"==i.position?n+"-wrapper-topCenter":n+"-wrapper-center":n+"-wrapper-"+e,h.wrapper=document.querySelector("."+n+"-wrapper."+e),h.wrapper||(h.wrapper=document.createElement("div"),h.wrapper.classList.add(n+"-wrapper"),h.wrapper.classList.add(e),document.body.appendChild(h.wrapper)),"topLeft"==i.position||"topCenter"==i.position||"topRight"==i.position?h.wrapper.insertBefore(h.toastCapsule,h.wrapper.firstChild):h.wrapper.appendChild(h.toastCapsule)}isNaN(i.zindex)?console.warn("["+n+"] Invalid zIndex."):h.wrapper.style.zIndex=i.zindex}(),i.overlay&&(null!==document.querySelector("."+n+"-overlay.fadeIn")?(h.overlay=document.querySelector("."+n+"-overlay"),h.overlay.setAttribute("data-iziToast-ref",h.overlay.getAttribute("data-iziToast-ref")+","+i.ref),isNaN(i.zindex)||null===i.zindex||(h.overlay.style.zIndex=i.zindex-1)):(h.overlay.classList.add(n+"-overlay"),h.overlay.classList.add("fadeIn"),h.overlay.style.background=i.overlayColor,h.overlay.setAttribute("data-iziToast-ref",i.ref),isNaN(i.zindex)||null===i.zindex||(h.overlay.style.zIndex=i.zindex-1),document.querySelector("body").appendChild(h.overlay)),i.overlayClose?(h.overlay.removeEventListener("click",{}),h.overlay.addEventListener("click",(function(e){a.hide(i,h.toast,"overlay")}))):h.overlay.removeEventListener("click",{})),function(){if(i.animateInside){h.toast.classList.add(n+"-animateInside");var e=[200,100,300];"bounceInLeft"!=i.transitionIn&&"bounceInRight"!=i.transitionIn||(e=[400,200,400]),i.title.length>0&&setTimeout((function(){h.strong.classList.add("slideIn")}),e[0]),i.message.length>0&&setTimeout((function(){h.p.classList.add("slideIn")}),e[1]),(i.icon||i.iconUrl)&&setTimeout((function(){h.icon.classList.add("revealIn")}),e[2]);var t=150;i.buttons.length>0&&h.buttons&&setTimeout((function(){m(h.buttons.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150}))}),i.inputs.length>0?150:0),i.inputs.length>0&&h.inputs&&(t=150,m(h.inputs.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150})))}}(),i.onOpening.apply(null,[i,h.toast]);try{var x=new CustomEvent(n+"-opening",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(x)}catch(e){console.warn(e)}setTimeout((function(){h.toast.classList.remove(n+"-opening"),h.toast.classList.add(n+"-opened");try{var e=new CustomEvent(n+"-opened",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}i.onOpened.apply(null,[i,h.toast])}),1e3),i.drag&&(r?(h.toast.addEventListener("touchstart",(function(e){b.startMoving(this,a,i,e)}),!1),h.toast.addEventListener("touchend",(function(e){b.stopMoving(this,e)}),!1)):(h.toast.addEventListener("mousedown",(function(e){e.preventDefault(),b.startMoving(this,a,i,e)}),!1),h.toast.addEventListener("mouseup",(function(e){e.preventDefault(),b.stopMoving(this,e)}),!1))),i.closeOnEscape&&document.addEventListener("keyup",(function(e){27==(e=e||window.event).keyCode&&a.hide(i,h.toast,"esc")})),i.closeOnClick&&h.toast.addEventListener("click",(function(e){a.hide(i,h.toast,"toast")})),a.toast=h.toast},t}(),void 0===(i="function"==typeof o?o.apply(t,a):o)||(e.exports=i)},5947:function(e,t,n){var o,a;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */o=function(){var e,t,n={version:"0.2.0"},o=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function a(e,t,n){return e<t?t:e>n?n:e}function i(e){return 100*(-1+e)}function r(e,t,n){var a;return(a="translate3d"===o.positionUsing?{transform:"translate3d("+i(e)+"%,0,0)"}:"translate"===o.positionUsing?{transform:"translate("+i(e)+"%,0)"}:{"margin-left":i(e)+"%"}).transition="all "+t+"ms "+n,a}n.configure=function(e){var t,n;for(t in e)void 0!==(n=e[t])&&e.hasOwnProperty(t)&&(o[t]=n);return this},n.status=null,n.set=function(e){var t=n.isStarted();e=a(e,o.minimum,1),n.status=1===e?null:e;var i=n.render(!t),c=i.querySelector(o.barSelector),u=o.speed,d=o.easing;return i.offsetWidth,s((function(t){""===o.positionUsing&&(o.positionUsing=n.getPositioningCSS()),l(c,r(e,u,d)),1===e?(l(i,{transition:"none",opacity:1}),i.offsetWidth,setTimeout((function(){l(i,{transition:"all "+u+"ms linear",opacity:0}),setTimeout((function(){n.remove(),t()}),u)}),u)):setTimeout(t,u)})),this},n.isStarted=function(){return"number"==typeof n.status},n.start=function(){n.status||n.set(0);var e=function(){setTimeout((function(){n.status&&(n.trickle(),e())}),o.trickleSpeed)};return o.trickle&&e(),this},n.done=function(e){return e||n.status?n.inc(.3+.5*Math.random()).set(1):this},n.inc=function(e){var t=n.status;return t?("number"!=typeof e&&(e=(1-t)*a(Math.random()*t,.1,.95)),t=a(t+e,0,.994),n.set(t)):n.start()},n.trickle=function(){return n.inc(Math.random()*o.trickleRate)},e=0,t=0,n.promise=function(o){return o&&"resolved"!==o.state()?(0===t&&n.start(),e++,t++,o.always((function(){0==--t?(e=0,n.done()):n.set((e-t)/e)})),this):this},n.render=function(e){if(n.isRendered())return document.getElementById("nprogress");u(document.documentElement,"nprogress-busy");var t=document.createElement("div");t.id="nprogress",t.innerHTML=o.template;var a,r=t.querySelector(o.barSelector),s=e?"-100":i(n.status||0),c=document.querySelector(o.parent);return l(r,{transition:"all 0 linear",transform:"translate3d("+s+"%,0,0)"}),o.showSpinner||(a=t.querySelector(o.spinnerSelector))&&m(a),c!=document.body&&u(c,"nprogress-custom-parent"),c.appendChild(t),t},n.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(o.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&m(e)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"};var s=function(){var e=[];function t(){var n=e.shift();n&&n(t)}return function(n){e.push(n),1==e.length&&t()}}(),l=function(){var e=["Webkit","O","Moz","ms"],t={};function n(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()}))}function o(t){var n=document.body.style;if(t in n)return t;for(var o,a=e.length,i=t.charAt(0).toUpperCase()+t.slice(1);a--;)if((o=e[a]+i)in n)return o;return t}function a(e){return e=n(e),t[e]||(t[e]=o(e))}function i(e,t,n){t=a(t),e.style[t]=n}return function(e,t){var n,o,a=arguments;if(2==a.length)for(n in t)void 0!==(o=t[n])&&t.hasOwnProperty(n)&&i(e,n,o);else i(e,a[1],a[2])}}();function c(e,t){return("string"==typeof e?e:h(e)).indexOf(" "+t+" ")>=0}function u(e,t){var n=h(e),o=n+t;c(n,t)||(e.className=o.substring(1))}function d(e,t){var n,o=h(e);c(e,t)&&(n=o.replace(" "+t+" "," "),e.className=n.substring(1,n.length-1))}function h(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function m(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return n},void 0===(a="function"==typeof o?o.call(t,n,t,e):o)||(e.exports=a)},8859:(e,t,n)=>{var o="function"==typeof Map&&Map.prototype,a=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=o&&a&&"function"==typeof a.get?a.get:null,r=o&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&l&&"function"==typeof l.get?l.get:null,u=s&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,m="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,g=Object.prototype.toString,p=Function.prototype.toString,v=String.prototype.match,y=String.prototype.slice,b=String.prototype.replace,x=String.prototype.toUpperCase,w=String.prototype.toLowerCase,T=RegExp.prototype.test,I=Array.prototype.concat,E=Array.prototype.join,S=Array.prototype.slice,C=Math.floor,A="function"==typeof BigInt?BigInt.prototype.valueOf:null,M=Object.getOwnPropertySymbols,D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,L="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||"symbol")?Symbol.toStringTag:null,k=Object.prototype.propertyIsEnumerable,O=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||T.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var o=e<0?-C(-e):C(e);if(o!==e){var a=String(o),i=y.call(t,a.length+1);return b.call(a,n,"$&_")+"."+b.call(b.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var N=n(2634),_=N.custom,U=j(_)?_:null;function B(e,t,n){var o="double"===(n.quoteStyle||t)?'"':"'";return o+e+o}function V(e){return b.call(String(e),/"/g,"&quot;")}function F(e){return!("[object Array]"!==W(e)||L&&"object"==typeof e&&L in e)}function H(e){return!("[object RegExp]"!==W(e)||L&&"object"==typeof e&&L in e)}function j(e){if(P)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!D)return!1;try{return D.call(e),!0}catch(e){}return!1}e.exports=function e(t,o,a,s){var l=o||{};if(q(l,"quoteStyle")&&"single"!==l.quoteStyle&&"double"!==l.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(q(l,"maxStringLength")&&("number"==typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var g=!q(l,"customInspect")||l.customInspect;if("boolean"!=typeof g&&"symbol"!==g)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(q(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(q(l,"numericSeparator")&&"boolean"!=typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=l.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return Y(t,l);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var T=String(t);return x?R(t,T):T}if("bigint"==typeof t){var C=String(t)+"n";return x?R(t,C):C}var M=void 0===l.depth?5:l.depth;if(void 0===a&&(a=0),a>=M&&M>0&&"object"==typeof t)return F(t)?"[Array]":"[Object]";var _=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=E.call(Array(e.indent+1)," ")}return{base:n,prev:E.call(Array(t+1),n)}}(l,a);if(void 0===s)s=[];else if(G(s,t)>=0)return"[Circular]";function z(t,n,o){if(n&&(s=S.call(s)).push(n),o){var i={depth:l.depth};return q(l,"quoteStyle")&&(i.quoteStyle=l.quoteStyle),e(t,i,a+1,s)}return e(t,l,a+1,s)}if("function"==typeof t&&!H(t)){var Z=function(e){if(e.name)return e.name;var t=v.call(p.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),ee=$(t,z);return"[Function"+(Z?": "+Z:" (anonymous)")+"]"+(ee.length>0?" { "+E.call(ee,", ")+" }":"")}if(j(t)){var te=P?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):D.call(t);return"object"!=typeof t||P?te:K(te)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var ne="<"+w.call(String(t.nodeName)),oe=t.attributes||[],ae=0;ae<oe.length;ae++)ne+=" "+oe[ae].name+"="+B(V(oe[ae].value),"double",l);return ne+=">",t.childNodes&&t.childNodes.length&&(ne+="..."),ne+="</"+w.call(String(t.nodeName))+">"}if(F(t)){if(0===t.length)return"[]";var ie=$(t,z);return _&&!function(e){for(var t=0;t<e.length;t++)if(G(e[t],"\n")>=0)return!1;return!0}(ie)?"["+Q(ie,_)+"]":"[ "+E.call(ie,", ")+" ]"}if(function(e){return!("[object Error]"!==W(e)||L&&"object"==typeof e&&L in e)}(t)){var re=$(t,z);return"cause"in Error.prototype||!("cause"in t)||k.call(t,"cause")?0===re.length?"["+String(t)+"]":"{ ["+String(t)+"] "+E.call(re,", ")+" }":"{ ["+String(t)+"] "+E.call(I.call("[cause]: "+z(t.cause),re),", ")+" }"}if("object"==typeof t&&g){if(U&&"function"==typeof t[U]&&N)return N(t,{depth:M-a});if("symbol"!==g&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!i||!e||"object"!=typeof e)return!1;try{i.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var se=[];return r&&r.call(t,(function(e,n){se.push(z(n,t,!0)+" => "+z(e,t))})),J("Map",i.call(t),se,_)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{i.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var le=[];return u&&u.call(t,(function(e){le.push(z(e,t))})),J("Set",c.call(t),le,_)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return X("WeakMap");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return X("WeakSet");if(function(e){if(!m||!e||"object"!=typeof e)return!1;try{return m.call(e),!0}catch(e){}return!1}(t))return X("WeakRef");if(function(e){return!("[object Number]"!==W(e)||L&&"object"==typeof e&&L in e)}(t))return K(z(Number(t)));if(function(e){if(!e||"object"!=typeof e||!A)return!1;try{return A.call(e),!0}catch(e){}return!1}(t))return K(z(A.call(t)));if(function(e){return!("[object Boolean]"!==W(e)||L&&"object"==typeof e&&L in e)}(t))return K(f.call(t));if(function(e){return!("[object String]"!==W(e)||L&&"object"==typeof e&&L in e)}(t))return K(z(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===n.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==W(e)||L&&"object"==typeof e&&L in e)}(t)&&!H(t)){var ce=$(t,z),ue=O?O(t)===Object.prototype:t instanceof Object||t.constructor===Object,de=t instanceof Object?"":"null prototype",he=!ue&&L&&Object(t)===t&&L in t?y.call(W(t),8,-1):de?"Object":"",me=(ue||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(he||de?"["+E.call(I.call([],he||[],de||[]),": ")+"] ":"");return 0===ce.length?me+"{}":_?me+"{"+Q(ce,_)+"}":me+"{ "+E.call(ce,", ")+" }"}return String(t)};var z=Object.prototype.hasOwnProperty||function(e){return e in this};function q(e,t){return z.call(e,t)}function W(e){return g.call(e)}function G(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function Y(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,o="... "+n+" more character"+(n>1?"s":"");return Y(y.call(e,0,t.maxStringLength),t)+o}return B(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Z),"single",t)}function Z(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+x.call(t.toString(16))}function K(e){return"Object("+e+")"}function X(e){return e+" { ? }"}function J(e,t,n,o){return e+" ("+t+") {"+(o?Q(n,o):E.call(n,", "))+"}"}function Q(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+E.call(e,","+n)+"\n"+t.prev}function $(e,t){var n=F(e),o=[];if(n){o.length=e.length;for(var a=0;a<e.length;a++)o[a]=q(e,a)?t(e[a],e):""}var i,r="function"==typeof M?M(e):[];if(P){i={};for(var s=0;s<r.length;s++)i["$"+r[s]]=r[s]}for(var l in e)q(e,l)&&(n&&String(Number(l))===l&&l<e.length||P&&i["$"+l]instanceof Symbol||(T.call(/[^\w$]/,l)?o.push(t(l,e)+": "+t(e[l],e)):o.push(l+": "+t(e[l],e))));if("function"==typeof M)for(var c=0;c<r.length;c++)k.call(e,r[c])&&o.push("["+t(r[c])+"]: "+t(e[r[c]],e));return o}},4765:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,o="RFC1738",a="RFC3986";e.exports={default:a,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:o,RFC3986:a}},5373:(e,t,n)=>{"use strict";var o=n(8636),a=n(2642),i=n(4765);e.exports={formats:i,parse:a,stringify:o}},2642:(e,t,n)=>{"use strict";var o=n(7720),a=Object.prototype.hasOwnProperty,i=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:o.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,o){if(e){var i=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,r=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(i),c=s?i.slice(0,s.index):i,u=[];if(c){if(!n.plainObjects&&a.call(Object.prototype,c)&&!n.allowPrototypes)return;u.push(c)}for(var d=0;n.depth>0&&null!==(s=r.exec(i))&&d<n.depth;){if(d+=1,!n.plainObjects&&a.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+i.slice(s.index)+"]"),function(e,t,n,o){for(var a=o?t:l(t,n),i=e.length-1;i>=0;--i){var r,s=e[i];if("[]"===s&&n.parseArrays)r=n.allowEmptyArrays&&""===a?[]:[].concat(a);else{r=n.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=n.decodeDotInKeys?c.replace(/%2E/g,"."):c,d=parseInt(u,10);n.parseArrays||""!==u?!isNaN(d)&&s!==u&&String(d)===u&&d>=0&&n.parseArrays&&d<=n.arrayLimit?(r=[])[d]=a:"__proto__"!==u&&(r[u]=a):r={0:a}}a=r}return a}(u,t,n,o)}};e.exports=function(e,t){var n=function(e){if(!e)return r;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?r.charset:e.charset,n=void 0===e.duplicates?r.duplicates:e.duplicates;if("combine"!==n&&"first"!==n&&"last"!==n)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||r.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:r.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:r.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:r.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:r.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:r.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:r.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:r.decoder,delimiter:"string"==typeof e.delimiter||o.isRegExp(e.delimiter)?e.delimiter:r.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:r.depth,duplicates:n,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:r.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:r.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:r.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var n,c={__proto__:null},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,h=u.split(t.delimiter,d),m=-1,f=t.charset;if(t.charsetSentinel)for(n=0;n<h.length;++n)0===h[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[n]?f="utf-8":"utf8=%26%2310003%3B"===h[n]&&(f="iso-8859-1"),m=n,n=h.length);for(n=0;n<h.length;++n)if(n!==m){var g,p,v=h[n],y=v.indexOf("]="),b=-1===y?v.indexOf("="):y+1;-1===b?(g=t.decoder(v,r.decoder,f,"key"),p=t.strictNullHandling?null:""):(g=t.decoder(v.slice(0,b),r.decoder,f,"key"),p=o.maybeMap(l(v.slice(b+1),t),(function(e){return t.decoder(e,r.decoder,f,"value")}))),p&&t.interpretNumericEntities&&"iso-8859-1"===f&&(p=s(p)),v.indexOf("[]=")>-1&&(p=i(p)?[p]:p);var x=a.call(c,g);x&&"combine"===t.duplicates?c[g]=o.combine(c[g],p):x&&"last"!==t.duplicates||(c[g]=p)}return c}(e,n):e,d=n.plainObjects?Object.create(null):{},h=Object.keys(u),m=0;m<h.length;++m){var f=h[m],g=c(f,u[f],n,"string"==typeof e);d=o.merge(d,g,n)}return!0===n.allowSparse?d:o.compact(d)}},8636:(e,t,n)=>{"use strict";var o=n(920),a=n(7720),i=n(4765),r=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,l(t)?t:[t])},d=Date.prototype.toISOString,h=i.default,m={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:a.encode,encodeValuesOnly:!1,format:h,formatter:i.formatters[h],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},f={},g=function e(t,n,i,r,s,c,d,h,g,p,v,y,b,x,w,T,I,E){for(var S,C=t,A=E,M=0,D=!1;void 0!==(A=A.get(f))&&!D;){var P=A.get(t);if(M+=1,void 0!==P){if(P===M)throw new RangeError("Cyclic object value");D=!0}void 0===A.get(f)&&(M=0)}if("function"==typeof p?C=p(n,C):C instanceof Date?C=b(C):"comma"===i&&l(C)&&(C=a.maybeMap(C,(function(e){return e instanceof Date?b(e):e}))),null===C){if(c)return g&&!T?g(n,m.encoder,I,"key",x):n;C=""}if("string"==typeof(S=C)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||a.isBuffer(C))return g?[w(T?n:g(n,m.encoder,I,"key",x))+"="+w(g(C,m.encoder,I,"value",x))]:[w(n)+"="+w(String(C))];var L,k=[];if(void 0===C)return k;if("comma"===i&&l(C))T&&g&&(C=a.maybeMap(C,g)),L=[{value:C.length>0?C.join(",")||null:void 0}];else if(l(p))L=p;else{var O=Object.keys(C);L=v?O.sort(v):O}var R=h?n.replace(/\./g,"%2E"):n,N=r&&l(C)&&1===C.length?R+"[]":R;if(s&&l(C)&&0===C.length)return N+"[]";for(var _=0;_<L.length;++_){var U=L[_],B="object"==typeof U&&void 0!==U.value?U.value:C[U];if(!d||null!==B){var V=y&&h?U.replace(/\./g,"%2E"):U,F=l(C)?"function"==typeof i?i(N,V):N:N+(y?"."+V:"["+V+"]");E.set(t,M);var H=o();H.set(f,E),u(k,e(B,F,i,r,s,c,d,h,"comma"===i&&T&&l(C)?null:g,p,v,y,b,x,w,T,I,H))}}return k};e.exports=function(e,t){var n,a=e,c=function(e){if(!e)return m;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||m.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=i.default;if(void 0!==e.format){if(!r.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var o,a=i.formatters[n],c=m.filter;if(("function"==typeof e.filter||l(e.filter))&&(c=e.filter),o=e.arrayFormat in s?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":m.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var u=void 0===e.allowDots?!0===e.encodeDotInKeys||m.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:m.addQueryPrefix,allowDots:u,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:m.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:m.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:void 0===e.delimiter?m.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:m.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:m.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:m.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:m.encodeValuesOnly,filter:c,format:n,formatter:a,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:m.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:m.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:m.strictNullHandling}}(t);"function"==typeof c.filter?a=(0,c.filter)("",a):l(c.filter)&&(n=c.filter);var d=[];if("object"!=typeof a||null===a)return"";var h=s[c.arrayFormat],f="comma"===h&&c.commaRoundTrip;n||(n=Object.keys(a)),c.sort&&n.sort(c.sort);for(var p=o(),v=0;v<n.length;++v){var y=n[v];c.skipNulls&&null===a[y]||u(d,g(a[y],y,h,f,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,p))}var b=d.join(c.delimiter),x=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?x+="utf8=%26%2310003%3B&":x+="utf8=%E2%9C%93&"),b.length>0?x+b:""}},7720:(e,t,n)=>{"use strict";var o=n(4765),a=Object.prototype.hasOwnProperty,i=Array.isArray,r=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},o=0;o<e.length;++o)void 0!==e[o]&&(n[o]=e[o]);return n},l=1024;e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],o=0;o<t.length;++o)for(var a=t[o],r=a.obj[a.prop],s=Object.keys(r),l=0;l<s.length;++l){var c=s[l],u=r[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:r,prop:c}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(i(n)){for(var o=[],a=0;a<n.length;++a)void 0!==n[a]&&o.push(n[a]);t.obj[t.prop]=o}}}(t),e},decode:function(e,t,n){var o=e.replace(/\+/g," ");if("iso-8859-1"===n)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(e){return o}},encode:function(e,t,n,a,i){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",u=0;u<s.length;u+=l){for(var d=s.length>=l?s.slice(u,u+l):s,h=[],m=0;m<d.length;++m){var f=d.charCodeAt(m);45===f||46===f||95===f||126===f||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||i===o.RFC1738&&(40===f||41===f)?h[h.length]=d.charAt(m):f<128?h[h.length]=r[f]:f<2048?h[h.length]=r[192|f>>6]+r[128|63&f]:f<55296||f>=57344?h[h.length]=r[224|f>>12]+r[128|f>>6&63]+r[128|63&f]:(m+=1,f=65536+((1023&f)<<10|1023&d.charCodeAt(m)),h[h.length]=r[240|f>>18]+r[128|f>>12&63]+r[128|f>>6&63]+r[128|63&f])}c+=h.join("")}return c},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(i(e)){for(var n=[],o=0;o<e.length;o+=1)n.push(t(e[o]));return n}return t(e)},merge:function e(t,n,o){if(!n)return t;if("object"!=typeof n){if(i(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(o&&(o.plainObjects||o.allowPrototypes)||!a.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var r=t;return i(t)&&!i(n)&&(r=s(t,o)),i(t)&&i(n)?(n.forEach((function(n,i){if(a.call(t,i)){var r=t[i];r&&"object"==typeof r&&n&&"object"==typeof n?t[i]=e(r,n,o):t.push(n)}else t[i]=n})),t):Object.keys(n).reduce((function(t,i){var r=n[i];return a.call(t,i)?t[i]=e(t[i],r,o):t[i]=r,t}),r)}}},6897:(e,t,n)=>{"use strict";var o=n(453),a=n(41),i=n(592)(),r=n(5795),s=n(9675),l=o("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new s("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||l(t)!==t)throw new s("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],o=!0,c=!0;if("length"in e&&r){var u=r(e,"length");u&&!u.configurable&&(o=!1),u&&!u.writable&&(c=!1)}return(o||c||!n)&&(i?a(e,"length",t,!0,!0):a(e,"length",t)),e}},920:(e,t,n)=>{"use strict";var o=n(453),a=n(8075),i=n(8859),r=n(9675),s=o("%WeakMap%",!0),l=o("%Map%",!0),c=a("WeakMap.prototype.get",!0),u=a("WeakMap.prototype.set",!0),d=a("WeakMap.prototype.has",!0),h=a("Map.prototype.get",!0),m=a("Map.prototype.set",!0),f=a("Map.prototype.has",!0),g=function(e,t){for(var n,o=e;null!==(n=o.next);o=n)if(n.key===t)return o.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,o={assert:function(e){if(!o.has(e))throw new r("Side channel does not contain "+i(e))},get:function(o){if(s&&o&&("object"==typeof o||"function"==typeof o)){if(e)return c(e,o)}else if(l){if(t)return h(t,o)}else if(n)return function(e,t){var n=g(e,t);return n&&n.value}(n,o)},has:function(o){if(s&&o&&("object"==typeof o||"function"==typeof o)){if(e)return d(e,o)}else if(l){if(t)return f(t,o)}else if(n)return function(e,t){return!!g(e,t)}(n,o);return!1},set:function(o,a){s&&o&&("object"==typeof o||"function"==typeof o)?(e||(e=new s),u(e,o,a)):l?(t||(t=new l),m(t,o,a)):(n||(n={key:{},next:null}),function(e,t,n){var o=g(e,t);o?o.value=n:e.next={key:t,next:e.next,value:n}}(n,o,a))}};return o}},5485:e=>{
/*! For license information please see simple.min.js.LICENSE.txt */
self,e.exports=function(){"use strict";var e={362:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=(...e)=>{const t=[],n=e.length;for(let a=0;a<n;a++){const i=e[a];"Array"===(0,o.dataType)(i)&&i.forEach(((e,o)=>{t[a+o*n]=e}))}return t.filter((e=>null!=e))}},114:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.arraysLaminated=void 0;var a=n(362);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return o(a).default}})},537:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t=!1)=>{try{if(TextDecoder){const t=new TextDecoder("utf-8");return JSON.parse(t.decode(new Uint8Array(e)))}const t=new Uint8Array(e),n=String.fromCharCode.apply(null,t);return JSON.parse(n)}catch(e){return void(t&&console.log(e))}}},415:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isDICM=t.arrayBufferToJson=void 0;var a=n(537);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return o(a).default}});var i=n(754);Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return o(i).default}})},754:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{if(!e||!e.byteLength||e.byteLength<=132)return!1;let t="";const n=new Uint8Array(e,128,4);for(let e=0;e<n.length;e++)t+=String.fromCharCode(n[e]);return"DICM"===t}},80:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.store=new Map}get(e,...t){const n=JSON.stringify(t);if(!this.store.has(e)){const o=e(...t),a=new Map;return a.set(n,o),this.store.set(e,a),o}const o=this.store.get(e);if(!(null==o?void 0:o.has(n))){const a=e(...t);return null==o||o.set(n,a),a}return o.get(n)}}},983:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,n=1){this.db=void 0,this.dbName=e,this.storeName=t,this.version=n}open(){return new Promise(((e,t)=>{const n=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB;if(!n){const e=new Error("IndexedDB is not supported");return console.warn(e),t(e)}const o=n.open(this.dbName,this.version);o.onsuccess=t=>{var n;this.db=null===(n=t.target)||void 0===n?void 0:n.result,e(t)},o.onerror=function(e){t(e),console.log("...")},o.onupgradeneeded=e=>{var t;const n=this.storeName,o=null===(t=e.target)||void 0===t?void 0:t.result;o.objectStoreNames.contains(n)||o.createObjectStore(n)}}))}dispatch(e,t={},...n){const{mode:o="readwrite",more:a=!1}=t;return new Promise(((i,r)=>{try{const t=this.getObjectStore(o),s=t[e];if(!(e in t))return r(`${e} is undefined, reference resources:https://developer.mozilla.org/zh-CN/docs/Web/API/IDBObjectStore`);if("function"==typeof s){const o=t[e](...n);o.onsuccess=e=>{var n;const r=null===(n=e.target)||void 0===n?void 0:n.result;i(a?{res:o,event:e,result:r,objectStore:t,bd:this.db}:r)},o.onerror=r}else i(s)}catch(o){r({message:o,arguments:{func:e,options:t,args:n}})}}))}getObjectStore(e="readwrite"){if(!this.db)throw new Error("No database connection available , please use IndexedDB=>open to connect");return this.db.transaction([this.storeName],e).objectStore(this.storeName)}}},497:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.func=e,this.result}run(...e){return void 0!==this.result||(this.result=this.func(...e)),this.result}}},137:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.taskId=0,this.count=0,this.arr=[],this.limit=0,this.pendingTask=[],this.func=()=>({}),this.finishSResolve=()=>({})}init(e){const{arr:t=[],func:n,limit:o=6}=e||{};return t.length&&n?(this.arr.length&&this.pendingTask.push({arr:[...this.arr],func:this.func,limit:this.limit}),this.count=0,this.arr=[...t],this.limit=Math.min(o,t.length),this.func=n,this.loop(this.taskId),new Promise((e=>{this.finishSResolve=e}))):Promise.reject("arr and func is required")}loop(e){return n(this,void 0,void 0,(function*(){if(e===this.taskId)if(0!==this.arr.length)this.count+=1,this.count<this.limit&&this.loop(this.taskId),yield this.func(this.arr.shift()),e===this.taskId&&(this.count>=this.limit&&this.loop(this.taskId),this.count-=1);else if(this.count<=0){this.finishSResolve("finish");const{arr:e,func:t,limit:n}=this.pendingTask.shift()||{};(null==e?void 0:e.length)&&t&&(this.taskId+=1,this.init({arr:e,func:t,limit:n}))}else setTimeout((()=>this.loop(this.taskId)),100)}))}cancel(){return this.taskId+=1,this.arr.length=0,this.pendingTask.length=0,Promise.resolve("cancel")}}},182:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=e||{},{tagName:o="div"}=t,a=n(t,["tagName"]),i=document.createElement(o);for(const[e,t]of Object.entries(a))i[e]=t;return i}},368:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=function(e,t,n){let a,i,r,s,l,c,u=0,d=!1,h=!1,m=!0;const f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){const n=a,o=i;return a=i=void 0,u=t,r=e.apply(o,n),r}function p(e,t=0){return f?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){const n=e-(c||0);return void 0===c||n>=(t||0)||n<0||h&&e-u>=(s||0)}function y(){const e=Date.now();if(v(e))return b(e);l=p(y,function(e){const n=e-u,o=(t||0)-(e-(c||0));return h?Math.min(o,(s||0)-n):o}(e))}function b(e){return l=void 0,m&&a?g(e):(a=i=void 0,r)}function x(...e){const n=Date.now(),o=v(n);if(a=e,i=this,c=n,o){if(void 0===l)return function(e){return u=e,l=p(y,t),d?g(e):r}(c);if(h)return l=p(y,t),g(c)}return void 0===l&&(l=p(y,t)),r}return t=Number(t)||0,n&&"Object"===(0,o.dataType)(n)&&(d=Boolean(n.leading),h="maxWait"in n,s=h?Math.max(Number(n.maxWait)||0,t):s,m="trailing"in n?Boolean(n.trailing):m),x.cancel=function(){void 0!==l&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),u=0,a=c=i=l=void 0},x.flush=function(){return void 0===l?r:b(Date.now())},x.pending=function(){return void 0!==l},x}},456:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createElement=t.throttle=t.debounce=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=void 0;var a=n(137);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return o(a).default}});var i=n(80);Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return o(i).default}});var r=n(497);Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return o(r).default}});var s=n(983);Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return o(s).default}});var l=n(935);Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return o(l).default}});var c=n(378);Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return o(c).default}});var u=n(368);Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return o(u).default}});var d=n(539);Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return o(d).default}});var h=n(182);Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return o(h).default}})},935:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=function e(t,n){if("Object"!==(0,o.dataType)(t))return"";const a=Object.keys(t);return a.reduce(((i,r,s)=>{const l=t[r];return 0!==s||n||(i+="?"),"Object"===(0,o.dataType)(l)?i+=e(l,n?`${n}[${r}]`:r):i+=n?`${n}[${r}]=${l}`:`${r}=${l}`,s!==a.length-1&&(i+="&"),i}),"")}},378:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e=e||location.search;const t={};if("function"==typeof URLSearchParams){const n=new URLSearchParams(e);for(const[e,o]of n)t[e]=o}else{const n=e.replace("?","").split("&");for(const e of n){const[n,o]=e.split("=");t[n]=o}}return t}},539:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=function(e,t=0,n){let a=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return n&&"Object"===(0,o.dataType)(n)&&(a="leading"in n?Boolean(n.leading):a,i="trailing"in n?Boolean(n.trailing):i),(0,o.debounce)(e,t,{leading:a,trailing:i,maxWait:t})}},337:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=void 0;const o=(e,t="image/png")=>{const n=document.createElement("canvas"),o=n.getContext("2d");return n.height=e.height,n.width=e.width,null==o||o.putImageData(e,0,0),n.toDataURL(t)};t.ImageDataToDataURL=o;const a=(e,t)=>new Promise(((n,a)=>{const i=o(e,t),r=new Image;r.src=i,r.onload=()=>{n(r)},r.onerror=e=>{a(e)}}));t.ImageDataToImage=a;const i=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const n=o(e,t),a=yield fetch(n);return Promise.resolve(a.arrayBuffer())}catch(e){return Promise.reject(e)}}));t.ImageDataToArraybuffer=i,t.default={ImageDataToDataURL:o,ImageDataToImage:a,ImageDataToArraybuffer:i}},37:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=(e,t,n={})=>{const{interceptors:a,crossOrigin:i="Anonymous",zoom:r=1,debug:s=!1}=n;return new Promise(((n,l)=>{try{const c=null==e?void 0:e.getContext("2d"),u=e.width,d=e.height;let h=1;const m=new Image;m.crossOrigin=i,m.src=t,m.onload=()=>{let e=m.width,t=m.height;h=u/d>e/t?d/t:u/e,e=e*h*r,t=t*h*r,s&&console.log({cW:u,cH:d,scale:h,zoom:r,originIW:m.width,originIH:m.height,iW:e,iH:t});const[i,f,g,p]=[(u-e)/2,(d-t)/2,e,t];if("function"!=typeof a)null==c||c.drawImage(m,i,f,g,p),n("success");else{const e=a();if("Promise"!==(0,o.dataType)(e))throw l(new Error("interceptors must be Promise"));e.then((e=>{e?(null==c||c.drawImage(m,i,f,g,p),n("success")):l("cancel")}),(()=>{l("cancel")}))}},m.onerror=e=>{l(e)}}catch(e){l(e)}}))}},176:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=void 0;var a=n(37);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return o(a).default}});var i=n(337);Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return i.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return i.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return i.ImageDataToArraybuffer}})},814:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,n={})=>{var o;if(t&&(t=`script${t}`,document.querySelector(`#${t}`)))return;const a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),t&&a.setAttribute("id",t);for(const[e,t]of Object.entries(n))a.setAttribute(e,t);null===(o=document.querySelector("head"))||void 0===o||o.appendChild(a)}},826:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.importScript=void 0;var a=n(814);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return o(a).default}})},607:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=t.httpRequest=t.importScript=t.isDICM=t.arrayBufferToJson=t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=t.dataType=t.env=t.isCanvasBlank=t.isNull=t.createElement=t.throttle=t.debounce=t.arraysLaminated=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=t.version=void 0;const a=n(456);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return a.PromiseQueue}}),Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return a.ComputeStore}}),Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return a.Once}}),Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return a.IndexedDB}}),Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return a.objectToQuery}}),Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return a.queryToObject}}),Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return a.debounce}}),Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return a.throttle}}),Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return a.createElement}});const i=n(114);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return i.arraysLaminated}});const r=n(693);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return r.isNull}}),Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return r.isCanvasBlank}}),Object.defineProperty(t,"env",{enumerable:!0,get:function(){return r.env}}),Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return r.dataType}});const s=n(176);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return s.canvasDrawImage}}),Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return s.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return s.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return s.ImageDataToArraybuffer}});const l=n(415);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return l.arrayBufferToJson}}),Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return l.isDICM}});const c=n(826);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return c.importScript}});const u=n(855);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return u.httpRequest}});const d=n(895);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return d.copyText}});const h=o(n(147)),{version:m}=h.default;t.version=m,t.default={version:m,PromiseQueue:a.PromiseQueue,ComputeStore:a.ComputeStore,Once:a.Once,IndexedDB:a.IndexedDB,objectToQuery:a.objectToQuery,queryToObject:a.queryToObject,arraysLaminated:i.arraysLaminated,debounce:a.debounce,throttle:a.throttle,createElement:a.createElement,isNull:r.isNull,isCanvasBlank:r.isCanvasBlank,env:r.env,dataType:r.dataType,canvasDrawImage:s.canvasDrawImage,ImageDataToDataURL:s.ImageDataToDataURL,ImageDataToImage:s.ImageDataToImage,ImageDataToArraybuffer:s.ImageDataToArraybuffer,arrayBufferToJson:l.arrayBufferToJson,isDICM:l.isDICM,importScript:c.importScript,httpRequest:u.httpRequest,copyText:d.copyText}},363:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t={},o)=>new Promise(((a,i)=>{const r=new XMLHttpRequest;"function"==typeof o&&o(r),r.onreadystatechange=()=>{const{status:e,readyState:t}=r;if(0!==t&&1!==t)return 200!==e?i(r):4===t?a(r):void 0},r.onerror=()=>{i(r)};const{method:s="GET",async:l=!0,username:c,password:u,send:d,open:h}=t,m=n(t,["method","async","username","password","send","open"]);h&&console.log(new Error("don't config open ,please configure asyncusernamepassword")),r.open(s,e,l,c,u);for(const[e,t]of Object.entries(m)){if(!(e in r))return i(`${e} is undefined, reference resources: https://www.w3school.com.cn/xmldom/dom_http.asp`);if("function"==typeof r[e]){const{args:n}=t;n&&n.constructor===Array?r[e](...t):r[e](t)}else r[e]=t}r.send(d)}))},855:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.httpRequest=void 0;var a=n(363);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return o(a).default}})},185:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const n=typeof e,{lowercase:o=!1}=t||{};if("object"===n){const t=Object.prototype.toString.call(e).slice(8,-1);return o?t.toLowerCase():t}return n}},865:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const{userAgent:n,platform:o}=navigator;return e=e||n,{isWin:(t=t||o).includes("Win"),isMac:t.includes("Mac"),isLinux:!!t.match(/Linux|X11/i),isIpad:!!e.match(/iPad/i),isMobile:!!e.match(/mobile|phone/i),isAndroid:!!e.match(/android/i),IsIphone:!!e.match(/iphone/i),isWM:!!e.match(/windows mobile/i),isWeChat:!!e.match(/MicroMessenger/i)}}},693:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dataType=t.env=t.isCanvasBlank=t.isNull=void 0;var a=n(123);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return o(a).default}});var i=n(41);Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return o(i).default}});var r=n(865);Object.defineProperty(t,"env",{enumerable:!0,get:function(){return o(r).default}});var s=n(185);Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return o(s).default}})},41:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()}},123:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>[void 0,'""','" "',"null","[]","{}"].includes(JSON.stringify(e))},874:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>new Promise(((t,n)=>{const o=navigator.clipboard;if(!o){if(document.execCommand){const o=document.createElement("input");document.body.appendChild(o),o.setAttribute("value",e),o.select();try{return document.execCommand("Copy"),o.remove(),t("success")}catch(e){return o.remove(),n(e)}}return n("")}o.writeText(e).then((()=>{t("success")}),(e=>{n(e)}))}))},895:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=void 0;var a=n(874);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return o(a).default}})},147:function(e){e.exports=JSON.parse('{"name":"simple2k13","version":"1.1.0","description":"some simple functions","main":"dist/simple.min.js","types":"dist/index.d.ts","scripts":{"test":"jest","test:watch":"jest --watch","test:staged":"jest --bail --findRelatedTests","start":"webpack-dev-server --env development --node-env development","build":"webpack --env production --node-env production --progress && tsc","prepare":"is-ci || husky install","lint":"eslint ./src --ext .js,.tsx,.ts","lint:fix":"eslint ./src --ext .js,.tsx,.ts --fix","lint:staged":"lint-staged","publish:major":"npm run lint:staged && npm version major && npm run build && npm publish","publish:minor":"npm run lint:staged && npm version minor && npm run build && npm publish","publish:patch":"npm run lint:staged && npm version patch && npm run build && npm publish","publish:prerelease":"npm run lint:staged && npm version prerelease && npm run build && npm publish"},"lint-staged":{"src/**/*.{js,ts,tsx}":["eslint","jest --bail --findRelatedTests"]},"repository":{"type":"git","url":"https://github.com/npm-for-cw/simple2k13"},"keywords":["functions","simple","simple2k13","js","cw"],"author":"cw<cw2k13as@gmail.com>","license":"LGPL-3.0","homepage":"https://github.com/npm-for-cw/simple2k13","files":["/dist","example"],"devDependencies":{"@babel/core":"^7.18.10","@babel/preset-env":"^7.18.10","@babel/preset-typescript":"^7.18.6","@commitlint/cli":"^17.1.1","@commitlint/config-conventional":"^17.1.0","@types/jest":"^28.1.3","@types/node":"^18.7.2","@types/webpack":"^5.28.0","@typescript-eslint/eslint-plugin":"^5.37.0","@typescript-eslint/parser":"^5.36.2","babel-jest":"^28.1.3","eslint":"^8.0.1","eslint-plugin-import":"^2.25.2","eslint-plugin-n":"^15.0.0","eslint-plugin-promise":"^6.0.0","fake-indexeddb":"^4.0.0","html-webpack-plugin":"^5.5.3","husky":"^8.0.0","is-ci":"^3.0.1","jest":"^28.1.3","jest-canvas-mock":"^2.4.0","jest-environment-jsdom":"^28.1.3","jest-fetch-mock":"^3.0.3","lint-staged":"^13.0.3","pinst":"^3.0.0","text-encoding":"^0.7.0","ts-jest":"^28.0.7","ts-loader":"^9.3.1","ts-node":"^10.9.1","tslint":"^6.1.3","typescript":"^4.7.4","webpack":"^5.74.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.15.1"},"dependencies":{}}')}},t={};return function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(607).default}()},1278:()=>{!function(){const e={AI:{calcification:"",groundGlass:"",partSolid:"",solid:"",pleural:"",lesions:"",benign:"",borderlineBenign:"",borderlineMalignant:"",malignant:"",number:"",longShortMeridian:"",volume:"",type:""},DICOMTags:{age:"",date:"",imageNumber:"",modality:"",name:"",scale:"",sex:"",thickness:"",KVP:"",windowCenter:"",windowWidth:"",birthday:"",patientID:"ID",hospitals:"",acquisitionDate:"",acquisitionTime:"",studyDate:"",studyTime:"",description:"",accessionNumber:"",seriesID:"ID",seriesUID:"UID",seriesDescription:"",rows:"",cols:"",pixelSpacingX:"X",pixelSpacingY:"Y",bitsAllocated:"",bitsStored:"",highBit:"",rescaleIntercept:"",rescaleSlope:"",pixelRepresentation:"",samplesPerPixel:"",photometricInterpretation:"",imagePosition:"",imageOrientation:"",orientationLeft:"",orientationRight:"",orientationTop:"",orientationBottom:"",blocks:"",manufacturer:"",sopInstanceUID:"",studyID:"ID",studyUID:"UID",transferSyntaxUID:"UID",fileName:""},tools:{AI:"AI","2D":"2D","3D":"3D",crosshairs2D:"3D",crosshairs:"",MPR:"MPR",fusion:"",reload:"",release:"",restore:"",reset:"",seriesBar:"",stackScroll:"",stackPositionSynchronizer:"",stackIndexSynchronizer:"",stackScrollSynchronizer:"",seriesLayout:"",sharpen:"",saveImage:"",saveLabels:"",synchronizer:"",imagesLayout:"",markersImage:"",measure:"",modulation:"",modulationPreset:"",major:"",pan:"",player:"",rotate:"",invert:"",zoom:"",magnifier:"",length:"",freehandRoi:"",annotate:"",annotateText:"",annotateArrow:"",blur:"",blendModes:"",blendComposite:"",blendMax:"",blendMin:"",blendAverage:"",markerL:"",markerR:"",more:"",aboutUs:"",angle:"",aroundInfo:"",cancelLabels:"",cobbAngle:"cobb",colorMap:"",disSeries:"",rectangleRoi:"",referenceLine:"",ellipticalRoi:"",circleRoi:"",CTR:"",deleteLabel:"",enhance:"",probeCT:"CT",useCacheImage:"",imageCacheType:"",knifeIn:"",knifeOut:"",VRTModulation:"",volume:"",visibilityLabels:"",viewportPresets:"",viewportPresetsDefault:"",fusionLayout:"",fusionLayoutDefault:" (C/S/A)",fusionLayoutCoronal:"Coronal",fusionLayoutSagittal:"Sagittal",fusionLayoutAxial:"Axial",quality:"",thickness:"",modes:{speed:"",standard:"",major:""},DICOMInfo:"DICOM"},DICOMInfo:{patient:"",examinations:"",series:"",image:"",device:"",UID:"UID",other:""},aboutUs:{description:"2DMPR",copyright:"",tel:"400 800 5557",releaseVersion:"",fullVersion:""},synchronizerSwitch:{title:"",on:"",off:"",onError:""},response:{statusCode:{401:"",403:"",404:""},fail:"!",unknown:"",metaDataError:"Metauuid",DCMPathDataError:"dcm",VRTPathDataError:"3D",AIDataError:"AI"},rotate:{restore:"",counterclockwise90:"90",clockwise90:"90",HFlip:"",VFlip:""},player:{first:"",prev:"",next:"",last:"",play:"",pause:"",custom:""},other:{close:"",custom:"",toggleStudy:""},toast:{AIConfigError:"AI",disCacheImage:{reconfirm:"!",reconfirmForAllLoad:""},reDestroy:",nullundefined",globalContainerExistence:"destroy",referenceLinesWarn:"1.2.",saveSuccess:"",saveFail:"",saveImage:"",setLanguage:"!",speedPriority:"!",MPRLevel:"()",imageLayoutError:"!",inputDataError:"",languagePackageInit:"",languagePackageReLoad:"",languagePackageNoInit:"",deviceTypeChange:"",indexedDBDelete:":",is32System:"3264",kernelVersionLow:"(Google Chrome)Edge360",memoryRatioTips:"",noSerise:"",noImagePositionMPR:"MPR",noImagePosition3D:"3D",noRenderSerise:["","","",""],seriesNumLow:["",""],studiesLoading:"",NoPTData:"PET/CT,PETCT",interGPU:{close:"",disReminders:",",title:"",tips:["intel","MPR/","",""]},MPR:{loading:",",crossOrigin:'"MPR"httpshttps',unMPRModule:"MPR",renderError:"MPR",sharedArrayBuffer:{manual:'"MPR"',http:'"MPR"!',https:'"MPR"crossOriginIsolated',disabled:'"MPR"',enabled:'"MPR"',unEnabled:'"MPR"'},versionError:["MPR",""],GPUBenchmarksURL:{null:"GPUBenchmarksURL",error:"GPUBenchmarksURLGPU"}},"3D":{noURL:"3D",loading:"3D,",close:"3D",error:"3D!"},loadAndCacheImage:{parsingFailed:"",validationFailed:"",dataError:"",acquisitionFailed:"",networkDis:"",notSupportedBlocks:"",versionLow:""},prompt:{enterScale:"",enterKeyImageDescription:"",enterWL:"",enterText:"",changeText:"",enterComment:"",changeComment:"",enter:"",OK:"",cancel:"",verificationError:"",example:"",fusionTitle:"",PTLabel:"PET",CTLabel:"CT"}}},t="zh-CN";window.webDicomViewLocal||(window.webDicomViewLocal={default:void 0}),window.webDicomViewLocal[t]?console.info(`${t} ${e.toast.languagePackageReLoad}`):console.info(`${t} ${e.toast.languagePackageInit}`),window.webDicomViewLocal[t]={name:"",locale:e,language:t},void 0===window.webDicomViewLocal.default&&(window.webDicomViewLocal.default=window.webDicomViewLocal[t])}()},1948:function(e,t,n){var o;o=e=>(()=>{"use strict";var t={578:(e,t,n)=>{const o=n(823),a=n(187),i=n(592),r=n(604),s=n(249),l=n(968),c=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:d,Z_OK:h,Z_STREAM_END:m,Z_NEED_DICT:f,Z_STREAM_ERROR:g,Z_DATA_ERROR:p,Z_MEM_ERROR:v}=n(684);function y(e){this.options=a.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let n=o.inflateInit2(this.strm,t.windowBits);if(n!==h)throw new Error(r[n]);if(this.header=new l,o.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=o.inflateSetDictionary(this.strm,t.dictionary),n!==h)))throw new Error(r[n])}y.prototype.push=function(e,t){const n=this.strm,a=this.options.chunkSize,r=this.options.dictionary;let s,l,y;if(this.ended)return!1;for(l=t===~~t?t:!0===t?d:u,"[object ArrayBuffer]"===c.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),s=o.inflate(n,l),s===f&&r&&(s=o.inflateSetDictionary(n,r),s===h?s=o.inflate(n,l):s===p&&(s=f));n.avail_in>0&&s===m&&n.state.wrap>0&&0!==e[n.next_in];)o.inflateReset(n),s=o.inflate(n,l);switch(s){case g:case p:case f:case v:return this.onEnd(s),this.ended=!0,!1}if(y=n.avail_out,n.next_out&&(0===n.avail_out||s===m))if("string"===this.options.to){let e=i.utf8border(n.output,n.next_out),t=n.next_out-e,o=i.buf2string(n.output,e);n.next_out=t,n.avail_out=a-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(o)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==h||0!==y){if(s===m)return s=o.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Hq=function(e,t){return(t=t||{}).raw=!0,function(e,t){const n=new y(t);if(n.push(e),n.err)throw n.msg||r[n.err];return n.result}(e,t)},n(684)},187:e=>{const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);e.exports.assign=function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const o=n.shift();if(o){if("object"!=typeof o)throw new TypeError(o+"must be non-object");for(const n in o)t(o,n)&&(e[n]=o[n])}}return e},e.exports.flattenChunks=e=>{let t=0;for(let n=0,o=e.length;n<o;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,o=0,a=e.length;t<a;t++){let a=e[t];n.set(a,o),o+=a.length}return n}},592:e=>{let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const n=new Uint8Array(256);for(let e=0;e<256;e++)n[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;n[254]=n[254]=1,e.exports.string2buf=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,o,a,i,r=e.length,s=0;for(a=0;a<r;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<r&&(o=e.charCodeAt(a+1),56320==(64512&o)&&(n=65536+(n-55296<<10)+(o-56320),a++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),i=0,a=0;i<s;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<r&&(o=e.charCodeAt(a+1),56320==(64512&o)&&(n=65536+(n-55296<<10)+(o-56320),a++)),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},e.exports.buf2string=(e,o)=>{const a=o||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,o));let i,r;const s=new Array(2*a);for(r=0,i=0;i<a;){let t=e[i++];if(t<128){s[r++]=t;continue}let o=n[t];if(o>4)s[r++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<a;)t=t<<6|63&e[i++],o--;o>1?s[r++]=65533:t<65536?s[r++]=t:(t-=65536,s[r++]=55296|t>>10&1023,s[r++]=56320|1023&t)}}return((e,n)=>{if(n<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===n?e:e.subarray(0,n));let o="";for(let t=0;t<n;t++)o+=String.fromCharCode(e[t]);return o})(s,r)},e.exports.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let o=t-1;for(;o>=0&&128==(192&e[o]);)o--;return o<0||0===o?t:o+n[e[o]]>t?o:t}},693:e=>{e.exports=(e,t,n,o)=>{let a=65535&e,i=e>>>16&65535,r=0;for(;0!==n;){r=n>2e3?2e3:n,n-=r;do{a=a+t[o++]|0,i=i+a|0}while(--r);a%=65521,i%=65521}return a|i<<16}},684:e=>{e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},464:e=>{const t=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());e.exports=(e,n,o,a)=>{const i=t,r=a+o;e^=-1;for(let t=a;t<r;t++)e=e>>>8^i[255&(e^n[t])];return~e}},968:e=>{e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},365:e=>{const t=16209;e.exports=function(e,n){let o,a,i,r,s,l,c,u,d,h,m,f,g,p,v,y,b,x,w,T,I,E,S,C;const A=e.state;o=e.next_in,S=e.input,a=o+(e.avail_in-5),i=e.next_out,C=e.output,r=i-(n-e.avail_out),s=i+(e.avail_out-257),l=A.dmax,c=A.wsize,u=A.whave,d=A.wnext,h=A.window,m=A.hold,f=A.bits,g=A.lencode,p=A.distcode,v=(1<<A.lenbits)-1,y=(1<<A.distbits)-1;e:do{f<15&&(m+=S[o++]<<f,f+=8,m+=S[o++]<<f,f+=8),b=g[m&v];t:for(;;){if(x=b>>>24,m>>>=x,f-=x,x=b>>>16&255,0===x)C[i++]=65535&b;else{if(!(16&x)){if(!(64&x)){b=g[(65535&b)+(m&(1<<x)-1)];continue t}if(32&x){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=t;break e}w=65535&b,x&=15,x&&(f<x&&(m+=S[o++]<<f,f+=8),w+=m&(1<<x)-1,m>>>=x,f-=x),f<15&&(m+=S[o++]<<f,f+=8,m+=S[o++]<<f,f+=8),b=p[m&y];n:for(;;){if(x=b>>>24,m>>>=x,f-=x,x=b>>>16&255,!(16&x)){if(!(64&x)){b=p[(65535&b)+(m&(1<<x)-1)];continue n}e.msg="invalid distance code",A.mode=t;break e}if(T=65535&b,x&=15,f<x&&(m+=S[o++]<<f,f+=8,f<x&&(m+=S[o++]<<f,f+=8)),T+=m&(1<<x)-1,T>l){e.msg="invalid distance too far back",A.mode=t;break e}if(m>>>=x,f-=x,x=i-r,T>x){if(x=T-x,x>u&&A.sane){e.msg="invalid distance too far back",A.mode=t;break e}if(I=0,E=h,0===d){if(I+=c-x,x<w){w-=x;do{C[i++]=h[I++]}while(--x);I=i-T,E=C}}else if(d<x){if(I+=c+d-x,x-=d,x<w){w-=x;do{C[i++]=h[I++]}while(--x);if(I=0,d<w){x=d,w-=x;do{C[i++]=h[I++]}while(--x);I=i-T,E=C}}}else if(I+=d-x,x<w){w-=x;do{C[i++]=h[I++]}while(--x);I=i-T,E=C}for(;w>2;)C[i++]=E[I++],C[i++]=E[I++],C[i++]=E[I++],w-=3;w&&(C[i++]=E[I++],w>1&&(C[i++]=E[I++]))}else{I=i-T;do{C[i++]=C[I++],C[i++]=C[I++],C[i++]=C[I++],w-=3}while(w>2);w&&(C[i++]=C[I++],w>1&&(C[i++]=C[I++]))}break}}break}}while(o<a&&i<s);w=f>>3,o-=w,f-=w<<3,m&=(1<<f)-1,e.next_in=o,e.next_out=i,e.avail_in=o<a?a-o+5:5-(o-a),e.avail_out=i<s?s-i+257:257-(i-s),A.hold=m,A.bits=f}},823:(e,t,n)=>{const o=n(693),a=n(464),i=n(365),r=n(446),{Z_FINISH:s,Z_BLOCK:l,Z_TREES:c,Z_OK:u,Z_STREAM_END:d,Z_NEED_DICT:h,Z_STREAM_ERROR:m,Z_DATA_ERROR:f,Z_MEM_ERROR:g,Z_BUF_ERROR:p,Z_DEFLATED:v}=n(684),y=16180,b=16190,x=16191,w=16192,T=16194,I=16199,E=16200,S=16206,C=16209,A=16210,M=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function D(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const P=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<y||t.mode>16211?1:0},L=e=>{if(P(e))return m;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=y,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,u},k=e=>{if(P(e))return m;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,L(e)},O=(e,t)=>{let n;if(P(e))return m;const o=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?m:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,k(e))},R=(e,t)=>{if(!e)return m;const n=new D;e.state=n,n.strm=e,n.window=null,n.mode=y;const o=O(e,t);return o!==u&&(e.state=null),o};let N,_,U=!0;const B=e=>{if(U){N=new Int32Array(512),_=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(r(1,e.lens,0,288,N,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;r(2,e.lens,0,32,_,0,e.work,{bits:5}),U=!1}e.lencode=N,e.lenbits=9,e.distcode=_,e.distbits=5},V=(e,t,n,o)=>{let a;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),o>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>o&&(a=o),i.window.set(t.subarray(n-o,n-o+a),i.wnext),(o-=a)?(i.window.set(t.subarray(n-o,n),0),i.wnext=o,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0};e.exports.inflateReset=k,e.exports.inflateReset2=O,e.exports.inflateResetKeep=L,e.exports.inflateInit=e=>R(e,15),e.exports.inflateInit2=R,e.exports.inflate=(e,t)=>{let n,D,L,k,O,R,N,_,U,F,H,j,z,q,W,G,Y,Z,K,X,J,Q,$=0;const ee=new Uint8Array(4);let te,ne;const oe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(P(e)||!e.output||!e.input&&0!==e.avail_in)return m;n=e.state,n.mode===x&&(n.mode=w),O=e.next_out,L=e.output,N=e.avail_out,k=e.next_in,D=e.input,R=e.avail_in,_=n.hold,U=n.bits,F=R,H=N,Q=u;e:for(;;)switch(n.mode){case y:if(0===n.wrap){n.mode=w;break}for(;U<16;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(2&n.wrap&&35615===_){0===n.wbits&&(n.wbits=15),n.check=0,ee[0]=255&_,ee[1]=_>>>8&255,n.check=a(n.check,ee,2,0),_=0,U=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",n.mode=C;break}if((15&_)!==v){e.msg="unknown compression method",n.mode=C;break}if(_>>>=4,U-=4,J=8+(15&_),0===n.wbits&&(n.wbits=J),J>15||J>n.wbits){e.msg="invalid window size",n.mode=C;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&_?16189:x,_=0,U=0;break;case 16181:for(;U<16;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(n.flags=_,(255&n.flags)!==v){e.msg="unknown compression method",n.mode=C;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=C;break}n.head&&(n.head.text=_>>8&1),512&n.flags&&4&n.wrap&&(ee[0]=255&_,ee[1]=_>>>8&255,n.check=a(n.check,ee,2,0)),_=0,U=0,n.mode=16182;case 16182:for(;U<32;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}n.head&&(n.head.time=_),512&n.flags&&4&n.wrap&&(ee[0]=255&_,ee[1]=_>>>8&255,ee[2]=_>>>16&255,ee[3]=_>>>24&255,n.check=a(n.check,ee,4,0)),_=0,U=0,n.mode=16183;case 16183:for(;U<16;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}n.head&&(n.head.xflags=255&_,n.head.os=_>>8),512&n.flags&&4&n.wrap&&(ee[0]=255&_,ee[1]=_>>>8&255,n.check=a(n.check,ee,2,0)),_=0,U=0,n.mode=16184;case 16184:if(1024&n.flags){for(;U<16;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}n.length=_,n.head&&(n.head.extra_len=_),512&n.flags&&4&n.wrap&&(ee[0]=255&_,ee[1]=_>>>8&255,n.check=a(n.check,ee,2,0)),_=0,U=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(j=n.length,j>R&&(j=R),j&&(n.head&&(J=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(D.subarray(k,k+j),J)),512&n.flags&&4&n.wrap&&(n.check=a(n.check,D,j,k)),R-=j,k+=j,n.length-=j),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===R)break e;j=0;do{J=D[k+j++],n.head&&J&&n.length<65536&&(n.head.name+=String.fromCharCode(J))}while(J&&j<R);if(512&n.flags&&4&n.wrap&&(n.check=a(n.check,D,j,k)),R-=j,k+=j,J)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===R)break e;j=0;do{J=D[k+j++],n.head&&J&&n.length<65536&&(n.head.comment+=String.fromCharCode(J))}while(J&&j<R);if(512&n.flags&&4&n.wrap&&(n.check=a(n.check,D,j,k)),R-=j,k+=j,J)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;U<16;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(4&n.wrap&&_!==(65535&n.check)){e.msg="header crc mismatch",n.mode=C;break}_=0,U=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=x;break;case 16189:for(;U<32;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}e.adler=n.check=M(_),_=0,U=0,n.mode=b;case b:if(0===n.havedict)return e.next_out=O,e.avail_out=N,e.next_in=k,e.avail_in=R,n.hold=_,n.bits=U,h;e.adler=n.check=1,n.mode=x;case x:if(t===l||t===c)break e;case w:if(n.last){_>>>=7&U,U-=7&U,n.mode=S;break}for(;U<3;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}switch(n.last=1&_,_>>>=1,U-=1,3&_){case 0:n.mode=16193;break;case 1:if(B(n),n.mode=I,t===c){_>>>=2,U-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=C}_>>>=2,U-=2;break;case 16193:for(_>>>=7&U,U-=7&U;U<32;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",n.mode=C;break}if(n.length=65535&_,_=0,U=0,n.mode=T,t===c)break e;case T:n.mode=16195;case 16195:if(j=n.length,j){if(j>R&&(j=R),j>N&&(j=N),0===j)break e;L.set(D.subarray(k,k+j),O),R-=j,k+=j,N-=j,O+=j,n.length-=j;break}n.mode=x;break;case 16196:for(;U<14;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(n.nlen=257+(31&_),_>>>=5,U-=5,n.ndist=1+(31&_),_>>>=5,U-=5,n.ncode=4+(15&_),_>>>=4,U-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=C;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;U<3;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}n.lens[oe[n.have++]]=7&_,_>>>=3,U-=3}for(;n.have<19;)n.lens[oe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,te={bits:n.lenbits},Q=r(0,n.lens,0,19,n.lencode,0,n.work,te),n.lenbits=te.bits,Q){e.msg="invalid code lengths set",n.mode=C;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;$=n.lencode[_&(1<<n.lenbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=U);){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(Y<16)_>>>=W,U-=W,n.lens[n.have++]=Y;else{if(16===Y){for(ne=W+2;U<ne;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(_>>>=W,U-=W,0===n.have){e.msg="invalid bit length repeat",n.mode=C;break}J=n.lens[n.have-1],j=3+(3&_),_>>>=2,U-=2}else if(17===Y){for(ne=W+3;U<ne;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}_>>>=W,U-=W,J=0,j=3+(7&_),_>>>=3,U-=3}else{for(ne=W+7;U<ne;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}_>>>=W,U-=W,J=0,j=11+(127&_),_>>>=7,U-=7}if(n.have+j>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=C;break}for(;j--;)n.lens[n.have++]=J}}if(n.mode===C)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=C;break}if(n.lenbits=9,te={bits:n.lenbits},Q=r(1,n.lens,0,n.nlen,n.lencode,0,n.work,te),n.lenbits=te.bits,Q){e.msg="invalid literal/lengths set",n.mode=C;break}if(n.distbits=6,n.distcode=n.distdyn,te={bits:n.distbits},Q=r(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,te),n.distbits=te.bits,Q){e.msg="invalid distances set",n.mode=C;break}if(n.mode=I,t===c)break e;case I:n.mode=E;case E:if(R>=6&&N>=258){e.next_out=O,e.avail_out=N,e.next_in=k,e.avail_in=R,n.hold=_,n.bits=U,i(e,H),O=e.next_out,L=e.output,N=e.avail_out,k=e.next_in,D=e.input,R=e.avail_in,_=n.hold,U=n.bits,n.mode===x&&(n.back=-1);break}for(n.back=0;$=n.lencode[_&(1<<n.lenbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=U);){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(G&&!(240&G)){for(Z=W,K=G,X=Y;$=n.lencode[X+((_&(1<<Z+K)-1)>>Z)],W=$>>>24,G=$>>>16&255,Y=65535&$,!(Z+W<=U);){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}_>>>=Z,U-=Z,n.back+=Z}if(_>>>=W,U-=W,n.back+=W,n.length=Y,0===G){n.mode=16205;break}if(32&G){n.back=-1,n.mode=x;break}if(64&G){e.msg="invalid literal/length code",n.mode=C;break}n.extra=15&G,n.mode=16201;case 16201:if(n.extra){for(ne=n.extra;U<ne;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}n.length+=_&(1<<n.extra)-1,_>>>=n.extra,U-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;$=n.distcode[_&(1<<n.distbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=U);){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(!(240&G)){for(Z=W,K=G,X=Y;$=n.distcode[X+((_&(1<<Z+K)-1)>>Z)],W=$>>>24,G=$>>>16&255,Y=65535&$,!(Z+W<=U);){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}_>>>=Z,U-=Z,n.back+=Z}if(_>>>=W,U-=W,n.back+=W,64&G){e.msg="invalid distance code",n.mode=C;break}n.offset=Y,n.extra=15&G,n.mode=16203;case 16203:if(n.extra){for(ne=n.extra;U<ne;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}n.offset+=_&(1<<n.extra)-1,_>>>=n.extra,U-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=C;break}n.mode=16204;case 16204:if(0===N)break e;if(j=H-N,n.offset>j){if(j=n.offset-j,j>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=C;break}j>n.wnext?(j-=n.wnext,z=n.wsize-j):z=n.wnext-j,j>n.length&&(j=n.length),q=n.window}else q=L,z=O-n.offset,j=n.length;j>N&&(j=N),N-=j,n.length-=j;do{L[O++]=q[z++]}while(--j);0===n.length&&(n.mode=E);break;case 16205:if(0===N)break e;L[O++]=n.length,N--,n.mode=E;break;case S:if(n.wrap){for(;U<32;){if(0===R)break e;R--,_|=D[k++]<<U,U+=8}if(H-=N,e.total_out+=H,n.total+=H,4&n.wrap&&H&&(e.adler=n.check=n.flags?a(n.check,L,H,O-H):o(n.check,L,H,O-H)),H=N,4&n.wrap&&(n.flags?_:M(_))!==n.check){e.msg="incorrect data check",n.mode=C;break}_=0,U=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;U<32;){if(0===R)break e;R--,_+=D[k++]<<U,U+=8}if(4&n.wrap&&_!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=C;break}_=0,U=0}n.mode=16208;case 16208:Q=d;break e;case C:Q=f;break e;case A:return g;default:return m}return e.next_out=O,e.avail_out=N,e.next_in=k,e.avail_in=R,n.hold=_,n.bits=U,(n.wsize||H!==e.avail_out&&n.mode<C&&(n.mode<S||t!==s))&&V(e,e.output,e.next_out,H-e.avail_out)?(n.mode=A,g):(F-=e.avail_in,H-=e.avail_out,e.total_in+=F,e.total_out+=H,n.total+=H,4&n.wrap&&H&&(e.adler=n.check=n.flags?a(n.check,L,H,e.next_out-H):o(n.check,L,H,e.next_out-H)),e.data_type=n.bits+(n.last?64:0)+(n.mode===x?128:0)+(n.mode===I||n.mode===T?256:0),(0===F&&0===H||t===s)&&Q===u&&(Q=p),Q)},e.exports.inflateEnd=e=>{if(P(e))return m;let t=e.state;return t.window&&(t.window=null),e.state=null,u},e.exports.inflateGetHeader=(e,t)=>{if(P(e))return m;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,u):m},e.exports.inflateSetDictionary=(e,t)=>{const n=t.length;let a,i,r;return P(e)?m:(a=e.state,0!==a.wrap&&a.mode!==b?m:a.mode===b&&(i=1,i=o(i,t,n,0),i!==a.check)?f:(r=V(e,t,n,n),r?(a.mode=A,g):(a.havedict=1,u)))},e.exports.inflateInfo="pako inflate (from Nodeca project)"},446:e=>{const t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),o=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),a=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,i,r,s,l,c,u,d)=>{const h=d.bits;let m,f,g,p,v,y,b=0,x=0,w=0,T=0,I=0,E=0,S=0,C=0,A=0,M=0,D=null;const P=new Uint16Array(16),L=new Uint16Array(16);let k,O,R,N=null;for(b=0;b<=15;b++)P[b]=0;for(x=0;x<s;x++)P[i[r+x]]++;for(I=h,T=15;T>=1&&0===P[T];T--);if(I>T&&(I=T),0===T)return l[c++]=20971520,l[c++]=20971520,d.bits=1,0;for(w=1;w<T&&0===P[w];w++);for(I<w&&(I=w),C=1,b=1;b<=15;b++)if(C<<=1,C-=P[b],C<0)return-1;if(C>0&&(0===e||1!==T))return-1;for(L[1]=0,b=1;b<15;b++)L[b+1]=L[b]+P[b];for(x=0;x<s;x++)0!==i[r+x]&&(u[L[i[r+x]]++]=x);if(0===e?(D=N=u,y=20):1===e?(D=t,N=n,y=257):(D=o,N=a,y=0),M=0,x=0,b=w,v=c,E=I,S=0,g=-1,A=1<<I,p=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){k=b-S,u[x]+1<y?(O=0,R=u[x]):u[x]>=y?(O=N[u[x]-y],R=D[u[x]-y]):(O=96,R=0),m=1<<b-S,f=1<<E,w=f;do{f-=m,l[v+(M>>S)+f]=k<<24|O<<16|R}while(0!==f);for(m=1<<b-1;M&m;)m>>=1;if(0!==m?(M&=m-1,M+=m):M=0,x++,0==--P[b]){if(b===T)break;b=i[r+u[x]]}if(b>I&&(M&p)!==g){for(0===S&&(S=I),v+=w,E=b-S,C=1<<E;E+S<T&&(C-=P[E+S],!(C<=0));)E++,C<<=1;if(A+=1<<E,1===e&&A>852||2===e&&A>592)return 1;g=M&p,l[g]=I<<24|E<<16|v-c}}return 0!==M&&(l[v+M]=b-S<<24|64<<16),d.bits=I,0}},604:e=>{e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},249:e=>{e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},713:t=>{t.exports=e}},n={};function o(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var a=n.length-1;a>-1&&!e;)e=n[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})();var a={};return(()=>{function e(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");const o=e.length/3;let a=0,i=0;if(n)for(let n=0;n<o;n++)t[i++]=e[a++],t[i++]=e[a++],t[i++]=e[a++],t[i++]=255;else t.set(e)}function t(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");const o=e.length/3;let a=0,i=0,r=o,s=2*o;if(n)for(let n=0;n<o;n++)t[a++]=e[i++],t[a++]=e[r++],t[a++]=e[s++],t[a++]=255;else for(let n=0;n<o;n++)t[a++]=e[i++],t[a++]=e[r++],t[a++]=e[s++]}function n(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const o=e.length/3;let a=0,i=0;if(n)for(let n=0;n<o;n++){const n=e[a++],o=e[a++],r=e[a++];t[i++]=n+1.402*(r-128),t[i++]=n-.34414*(o-128)-.71414*(r-128),t[i++]=n+1.772*(o-128),t[i++]=255}else for(let n=0;n<o;n++){const n=e[a++],o=e[a++],r=e[a++];t[i++]=n+1.402*(r-128),t[i++]=n-.34414*(o-128)-.71414*(r-128),t[i++]=n+1.772*(o-128)}}function i(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const o=e.length/3;let a=0,i=0,r=o,s=2*o;if(n)for(let n=0;n<o;n++){const n=e[i++],o=e[r++],l=e[s++];t[a++]=n+1.402*(l-128),t[a++]=n-.34414*(o-128)-.71414*(l-128),t[a++]=n+1.772*(o-128),t[a++]=255}else for(let n=0;n<o;n++){const n=e[i++],o=e[r++],l=e[s++];t[a++]=n+1.402*(l-128),t[a++]=n-.34414*(o-128)-.71414*(l-128),t[a++]=n+1.772*(o-128)}}o.r(a),o.d(a,{configure:()=>Qe,convertColorSpace:()=>B,convertPALETTECOLOR:()=>Je,convertRGBColorByPixel:()=>e,convertRGBColorByPlane:()=>t,convertYBRFullByPixel:()=>n,convertYBRFullByPlane:()=>i,createImage:()=>re,decodeImageFrame:()=>te,decodeJPEGBaseline8BitColor:()=>V,default:()=>et,external:()=>Ke,getImageFrame:()=>ne,getMinMax:()=>_,getPixelData:()=>N,internal:()=>O,isColorImage:()=>oe,isJPEGBaseline8BitColor:()=>$e,wadors:()=>le,wadouri:()=>qe,webWorkerManager:()=>Q});const r=function(e,t,n){return t=t||0,e&&e.Value?e.Value.length<=t?n:e.Value[t]:n},s=function(e,t){const n=r(e,t);if(void 0!==n)return parseFloat(n)},l=function(e,t){if(!e)return;if(!e.Value)return;if(!Array.isArray(e.Value))return;if(t&&e.Value.length<t)return;const n=[];for(let t=0;t<e.Value.length;t++)n.push(parseFloat(e.Value[t]));return n};function c(e){const t=e.indexOf(":");return e.substring(t+1)}function u(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&e.Value?e.Value[0]&&t?e.Value[0]:e.Value:e}function d(e,t,n){return{shared:(t?Object.values(t[0]):[]).map((e=>e[0])).filter((e=>void 0!==e&&"object"==typeof e)),perFrame:(e?Object.values(e[n-1]):[]).map((e=>e.Value[0])).filter((e=>void 0!==e&&"object"==typeof e))}}function h(e){let{52009230:t,52009229:n,"00280008":o,...a}=e;return t=u(t,!1),n=u(n,!1),o=u(o),{PerFrameFunctionalGroupsSequence:t,SharedFunctionalGroupsSequence:n,NumberOfFrames:o,rest:a}}function m(e){const t=e.indexOf("/frames/")+8,n=e.slice(0,t),o=parseInt(e.slice(t),10);return{metadata:g[`${n}1`],frame:o}}const f={_retrieveMultiframeMetadata:m,retrieveMultiframeMetadata:function(e){return m(c(e))},isMultiframe:function(e){const t=r(e["00280008"]);return t&&t>1}};let g=[],p={};const v={add:function(e,t){const n=c(e);t.isMultiframe=f.isMultiframe(t),g[n]=t},get:function(e){const t=c(e),n=g[t];if(n&&!n?.isMultiframe)return n;const o=p[t];if(o)return o;const a=f._retrieveMultiframeMetadata(t);if(!a||!a.metadata)return;const{metadata:i,frame:r}=a;if(i){const e=function(e,t){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:o,NumberOfFrames:a,rest:i}=h(t);if(n||a>1){const{shared:r,perFrame:s}=d(n,o,e),l=Object.assign(t,{frameNumber:e});return[...r,...s].forEach((e=>{Object.entries(e).forEach((e=>{let[t,n]=e;l[t]=n}))})),Object.assign(i,{"00280008":a},l)}return t}(r,i);return p[t]=e,e}},remove:function(e){const t=c(e);g[t]=void 0,p[t]=void 0},purge:function(){g=[],p={}}};function y(e){return"RECON TOMO"===e||"RECON GATED TOMO"===e}function b(e){return r(e["00080060"]).includes("NM")}function x(e,t){const n=u(e["00080008"],!1);if(n)return n[t]}function w(e){let t=l(e["00200037"],6);return!t&&b(e)&&(t=function(e){let t;const n=x(e,2);if(n&&y(n)){const n=u(e["00540022"]);n&&(t=l(n["00200037"],6))}return t}(e)),t}function T(e){let t=l(e["00200032"],3);return!t&&b(e)&&(t=function(e){let t;const n=x(e,2);if(n&&y(n)){const n=u(e["00540022"]);n&&(t=l(n["00200032"],3))}return t}(e)),t}function I(e,t,n){const o={};for(const a of n)try{const n=t(a,e);if(n){const e={};for(const t in n)t in n&&(e[E(t)]=n[t]);Object.assign(o,e)}}catch(e){console.error(`Error retrieving ${a} data:`,e)}return o}const E=e=>e.charAt(0).toUpperCase()+e.slice(1),S=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"],C=function e(t,n){if("multiframeModule"===t){const{metadata:e,frame:t}=f.retrieveMultiframeMetadata(n);if(!e)return;const{PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:a,NumberOfFrames:i}=h(e);if(o||i>1){const{shared:e,perFrame:n}=d(o,a,t);return{NumberOfFrames:i,PerFrameFunctionalInformation:n,SharedFunctionalInformation:e}}return{NumberOfFrames:i}}const{dicomParser:o}=Ke,a=v.get(n);if(a){if("generalSeriesModule"===t)return{modality:r(a["00080060"]),seriesInstanceUID:r(a["0020000E"]),seriesNumber:s(a["00200011"]),studyInstanceUID:r(a["0020000D"]),seriesDate:o.parseDA(r(a["00080021"])),seriesTime:o.parseTM(r(a["00080031"],0,"")),acquisitionDate:o.parseDA(r(a["00080022"]),""),acquisitionTime:o.parseTM(r(a["00080032"],0,""))};if("patientStudyModule"===t)return{patientAge:s(a["00101010"]),patientSize:s(a["00101020"]),patientSex:r(a["00100040"]),patientWeight:s(a["00101030"])};if("nmMultiframeGeometryModule"===t){const e=r(a["00080060"]),t=x(a,2);return{modality:e,imageType:r(a["00080008"]),imageSubType:t,imageOrientationPatient:w(a),imagePositionPatient:T(a),sliceThickness:s(a["00180050"]),pixelSpacing:l(a["00280030"],2),numberOfFrames:s(a["00280008"]),isNMReconstructable:y(t)&&e.includes("NM")}}if("imagePlaneModule"===t){const e=w(a),t=T(a),n=l(a["00280030"],2);let o=null,i=null;n&&(i=n[0],o=n[1]);let c=null,u=null;return e&&(c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])],u=[parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[5])]),{frameOfReferenceUID:r(a["00200052"]),rows:s(a["00280010"]),columns:s(a["00280011"]),imageOrientationPatient:e,rowCosines:c,columnCosines:u,imagePositionPatient:t,sliceThickness:s(a["00180050"]),sliceLocation:s(a["00201041"]),pixelSpacing:n,rowPixelSpacing:i,columnPixelSpacing:o}}if("imagePixelModule"===t)return{samplesPerPixel:s(a["00280002"]),photometricInterpretation:r(a["00280004"]),rows:s(a["00280010"]),columns:s(a["00280011"]),bitsAllocated:s(a["00280100"]),bitsStored:s(a["00280101"]),highBit:r(a["00280102"]),pixelRepresentation:s(a["00280103"]),planarConfiguration:s(a["00280006"]),pixelAspectRatio:r(a["00280034"]),smallestPixelValue:s(a["00280106"]),largestPixelValue:s(a["00280107"]),redPaletteColorLookupTableDescriptor:l(a["00281101"]),greenPaletteColorLookupTableDescriptor:l(a["00281102"]),bluePaletteColorLookupTableDescriptor:l(a["00281103"]),redPaletteColorLookupTableData:l(a["00281201"]),greenPaletteColorLookupTableData:l(a["00281202"]),bluePaletteColorLookupTableData:l(a["00281203"])};if("voiLutModule"===t)return{windowCenter:l(a["00281050"],1),windowWidth:l(a["00281051"],1)};if("modalityLutModule"===t)return{rescaleIntercept:s(a["00281052"]),rescaleSlope:s(a["00281053"]),rescaleType:r(a["00281054"])};if("sopCommonModule"===t)return{sopClassUID:r(a["00080016"]),sopInstanceUID:r(a["00080018"])};if("petIsotopeModule"===t){const e=r(a["00540016"]);if(void 0===e)return;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:o.parseTM(r(e["00181072"],0,"")),radiopharmaceuticalStartDateTime:r(e["00181078"],0,""),radionuclideTotalDose:s(e["00181074"]),radionuclideHalfLife:s(e["00181075"])}}}return"overlayPlaneModule"===t?function(e){const t=[];for(let n=0;n<=30;n+=2){let o=`x60${n.toString(16)}`;4===o.length&&(o=`x600${n.toString(16)}`);const a=r(e[`${o}3000`]);if(!a)continue;const i=[];for(let t=0;t<a.length;t++)for(let n=0;n<8;n++){const o=e.Value[a.dataOffset+t];i[8*t+n]=o>>n&1}t.push({rows:s(e[`${o}0010`]),columns:s(e[`${o}0011`]),type:r(e[`${o}0040`]),x:s(e[`${o}0050`],1)-1,y:s(e[`${o}0050`],0)-1,pixelData:i,description:r(e[`${o}0022`]),label:r(e[`${o}1500`]),roiArea:r(e[`${o}1301`]),roiMean:r(e[`${o}1302`]),roiStandardDeviation:r(e[`${o}1303`])})}return{overlays:t}}(a):"transferSyntax"===t?{transferSyntaxUID:r(a["00020010"])}:"petSeriesModule"===t?{correctedImage:r(a["00280051"]),units:r(a["00541001"]),decayCorrection:r(a["00541102"])}:"petImageModule"===t?{frameReferenceTime:s(a["00541300"]),actualFrameDuration:s(a["00181242"])}:"instance"===t?I(n,e,S):void 0}};function A(e,t,n){if(n+e.length>t.length)return!1;let o=n;for(let n=0;n<e.length;n++)if(e[n]!==t[o++])return!1;return!0}const M=function(e,t,n){n=n||0;const o=function(e){const t=new Uint8Array(e.length);for(let n=0,o=e.length;n<o;n++)t[n]=e.charCodeAt(n);return t}(t);for(let t=n;t<e.length;t++)if(o[0]===e[t]&&A(o,e,t))return t;return-1};let D={open(e,t){e.open("get",t,!0)},beforeSend(){},beforeProcessing:e=>Promise.resolve(e.response),imageCreated(){},strict:!1,decodeConfig:{convertFloatPixelDataToInt:!0,use16BitDataType:!1}};function P(e){D=Object.assign(D,e)}function L(){return D}const k=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{cornerstone:a}=Ke,i=L(),r=e=>{if("function"==typeof i.errorInterceptor){const t=new Error("request failed");t.request=e,t.response=e.response,t.status=e.status,i.errorInterceptor(t)}},s=new XMLHttpRequest,l=new Promise(((l,c)=>{i.open(s,e,n,o);const u=i.beforeSend(s,t,n,o);s.responseType="arraybuffer";const d=Object.assign({},n,u);Object.keys(d).forEach((function(t){null!==d[t]&&("Accept"===t&&-1!==e.indexOf("accept=")||s.setRequestHeader(t,d[t]))})),o.deferred={resolve:l,reject:c},o.url=e,o.imageId=t,s.onloadstart=function(n){i.onloadstart&&i.onloadstart(n,o);const r={url:e,imageId:t};a.triggerEvent(a.events,"cornerstoneimageloadstart",r)},s.onloadend=function(n){i.onloadend&&i.onloadend(n,o);const r={url:e,imageId:t};a.triggerEvent(a.events,"cornerstoneimageloadend",r)},s.onreadystatechange=function(e){i.onreadystatechange?i.onreadystatechange(e,o):4===s.readyState&&(200===s.status?i.beforeProcessing(s).then(l).catch((()=>{r(s),c(s)})):(r(s),c(s)))},s.onprogress=function(e){const t=e.loaded;let n,a;e.lengthComputable&&(n=e.total,a=Math.round(t/n*100)),i.onprogress&&i.onprogress(e,o)},s.onerror=function(){r(s),c(s)},s.onabort=function(){r(s),c(s)},s.send()}));return l.xhr=s,l},O={xhrRequest:k,setOptions:P,getOptions:L};function R(e){for(let t=0;t<e.length;t++)if("Content-Type:"===e[t].substr(0,13))return e[t].substr(13).trim()}const N=function(e,t){const n={Accept:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream"};return new Promise(((o,a)=>{const i=k(e,t,n),{xhr:r}=i;i.then((function(e){const t=new Uint8Array(e),n=r.getResponseHeader("Content-Type")||"application/octet-stream";if(-1===n.indexOf("multipart"))return void o({contentType:n,imageFrame:{pixelData:t}});const i=M(t,"\r\n\r\n");-1===i&&a(new Error("invalid response - no multipart mime header"));const s=function(e,t,n){t=t||0,n=n||e.length-t;let o="";for(let a=t;a<t+n;a++)o+=String.fromCharCode(e[a]);return o}(t,0,i),l=s.split("\r\n"),c=function(e){for(let t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}(l);c||a(new Error("invalid response - no boundary marker"));const u=i+4,d=M(t,c,u);-1===d&&a(new Error("invalid response - terminating boundary not found"));const h=d-u-2;o({contentType:R(l),imageFrame:{pixelData:new Uint8Array(e,u,h)}})}),a)}))},_=function(e){let t,n=e[0],o=e[0];const a=e.length;for(let i=1;i<a;i++)t=e[i],n=Math.min(n,t),o=Math.max(o,t);return{min:n,max:o}};function U(n,o,a){0===n.planarConfiguration?e(n.pixelData,o,a):t(n.pixelData,o,a)}function B(e,t,o){if("RGB"===e.photometricInterpretation)U(e,t,o);else if("YBR_RCT"===e.photometricInterpretation)U(e,t,o);else if("YBR_ICT"===e.photometricInterpretation)U(e,t,o);else if("PALETTE COLOR"===e.photometricInterpretation)Je(e,t,o);else if("YBR_FULL_422"===e.photometricInterpretation)!function(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%2!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const o=e.length/2;let a=0,i=0;if(n)for(let n=0;n<o;n+=2){const n=e[a++],o=e[a++],r=e[a++],s=e[a++];t[i++]=n+1.402*(s-128),t[i++]=n-.34414*(r-128)-.71414*(s-128),t[i++]=n+1.772*(r-128),t[i++]=255,t[i++]=o+1.402*(s-128),t[i++]=o-.34414*(r-128)-.71414*(s-128),t[i++]=o+1.772*(r-128),t[i++]=255}else for(let n=0;n<o;n+=2){const n=e[a++],o=e[a++],r=e[a++],s=e[a++];t[i++]=n+1.402*(s-128),t[i++]=n-.34414*(r-128)-.71414*(s-128),t[i++]=n+1.772*(r-128),t[i++]=o+1.402*(s-128),t[i++]=o-.34414*(r-128)-.71414*(s-128),t[i++]=o+1.772*(r-128)}}(e.pixelData,t,o);else{if("YBR_FULL"!==e.photometricInterpretation)throw new Error(`No color space conversion for photometric interpretation ${e.photometricInterpretation}`);!function(e,t,o){0===e.planarConfiguration?n(e.pixelData,t,o):i(e.pixelData,t,o)}(e,t,o)}}const V=function(e,t,n){const o=(new Date).getTime(),a=new Blob([t],{type:"image/jpeg"});return new Promise(((t,i)=>{const r=new FileReader;void 0===r.readAsBinaryString?r.readAsArrayBuffer(a):r.readAsBinaryString(a),r.onload=function(){const a=new Image;a.onload=function(){n.height=a.height,n.width=a.width,e.rows=a.height,e.columns=a.width;const i=n.getContext("2d");i.drawImage(this,0,0);const r=i.getImageData(0,0,a.width,a.height),s=(new Date).getTime();e.pixelData=new Uint8Array(r.data.buffer),e.imageData=r,e.decodeTimeInMS=s-o;const l=_(e.pixelData);e.smallestPixelValue=l.min,e.largestPixelValue=l.max,e.pixelDataLength=e.pixelData.length,t(e)},a.onerror=function(e){i(e)},void 0===r.readAsBinaryString?a.src=`data:image/jpeg;base64,${window.btoa(function(e){return function(e){let t;try{return decodeURIComponent(escape(e))}catch(n){if(t=n,t instanceof URIError)return e;throw t}}(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}(r.result))}`:a.src=`data:image/jpeg;base64,${window.btoa(r.result)}`},r.onerror=e=>{i(e)}}))};function F(){return new Worker(o.p+"index.worker.e62ecca63f1a2e124230.worker.js")}let H=0;const j=[],z=[],q=L(),W={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!1,strict:q.strict}}};let G;const Y={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};function Z(){if(j.length){for(let e=0;e<z.length;e++)if("ready"===z[e].status){z[e].status="busy";const t=j.shift();t.start=(new Date).getTime();const n=(new Date).getTime();return Y.totalTimeDelayedInMS+=n-t.added,z[e].task=t,z[e].worker.postMessage({taskType:t.taskType,workerIndex:e,data:t.data},t.transferList),void Y.numTasksExecuting++}z.length<G.maxWebWorkers&&X()}}function K(e){if("initialize"===e.data.taskType)z[e.data.workerIndex].status="ready",Z();else{const t=z[e.data.workerIndex].task.start,n="success"===e.data.status?"resolve":"reject";try{z[e.data.workerIndex].task.deferred[n](e.data.result)}catch(e){console.warn("Caught error delivering response",e)}z[e.data.workerIndex].task=void 0,Y.numTasksExecuting--,z[e.data.workerIndex].status="ready",Y.numTasksCompleted++;const o=(new Date).getTime();Y.totalTaskTimeInMS+=o-t,Z()}}function X(){if(z.length>=G.maxWebWorkers)return;const e=new F;z.push({worker:e,status:"initializing"}),e.addEventListener("message",K),e.postMessage({taskType:"initialize",workerIndex:z.length-1,config:G})}function J(e){if(G=e=e||W,G.maxWebWorkers=G.maxWebWorkers||navigator.hardwareConcurrency||1,!G.startWebWorkersOnDemand)for(let e=0;e<G.maxWebWorkers;e++)X()}const Q={initialize:J,loadWebWorkerTask:function(e,t){G.webWorkerTaskPaths.push(e),t&&(G.taskConfiguration=Object.assign(G.taskConfiguration,t));for(let t=0;t<z.length;t++)z[t].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:z.length-1,sourcePath:e,config:G})},addTask:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;G||J();let a={resolve:void 0,reject:void 0};const i=new Promise(((e,t)=>{a={resolve:e,reject:t}}));let r;for(r=0;r<j.length&&!(j[r].priority<n);r++);const s=H++;return j.splice(r,0,{taskId:s,taskType:e,status:"ready",added:(new Date).getTime(),data:t,deferred:a,priority:n,transferList:o}),Z(),{taskId:s,promise:i}},getStatistics:function(){return Y.maxWebWorkers=G.maxWebWorkers,Y.numWebWorkers=z.length,Y.numTasksQueued=j.length,Y},setTaskPriority:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<j.length;n++)if(j[n].taskId===e){const e=j.splice(n,1)[0];for(e.priority=t,n=0;n<j.length&&!(j[n].priority<t);n++);return j.splice(n,0,e),!0}return!1},cancelTask:function(e,t){for(let n=0;n<j.length;n++)if(j[n].taskId===e)return j.splice(n,1).deferred.reject(t),!0;return!1},webWorkers:z,terminate:function(){for(let e=0;e<z.length;e++)z[e].worker.terminate();z.length=0,G=void 0}};var $=o(578);function ee(e,t,n,o,a){const i=o.priority||void 0,r=o.transferPixelData?[n.buffer]:void 0;return Q.addTask("decodeTask",{imageFrame:e,transferSyntax:t,pixelData:n,options:o,decodeConfig:a},i,r).promise}window.pako={inflateRaw:$.Hq};const te=function(e,t,n,o){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5?arguments[5]:void 0;switch(t){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":case"1.2.840.10008.1.2.2":case"1.2.840.10008.1.2.1.99":case"1.2.840.10008.1.2.5":case"1.2.840.10008.1.2.4.51":case"1.2.840.10008.1.2.4.57":case"1.2.840.10008.1.2.4.70":case"1.2.840.10008.1.2.4.80":case"1.2.840.10008.1.2.4.81":case"1.2.840.10008.1.2.4.90":case"1.2.840.10008.1.2.4.91":case"3.2.840.10008.1.2.4.96":return ee(e,t,n,a,i);case"1.2.840.10008.1.2.4.50":return 8!==e.bitsAllocated||3!==e.samplesPerPixel&&4!==e.samplesPerPixel?ee(e,t,n,a,i):V(e,n,o)}return Promise.reject(new Error(`No decoder for transfer syntax ${t}`))},ne=function(e){const{cornerstone:t}=Ke,n=t.metaData.get("imagePixelModule",e);return{samplesPerPixel:n.samplesPerPixel,photometricInterpretation:n.photometricInterpretation,planarConfiguration:n.planarConfiguration,rows:n.rows,columns:n.columns,bitsAllocated:n.bitsAllocated,bitsStored:n.bitsStored,pixelRepresentation:n.pixelRepresentation,smallestPixelValue:n.smallestPixelValue,largestPixelValue:n.largestPixelValue,redPaletteColorLookupTableDescriptor:n.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:n.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:n.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:n.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:n.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:n.bluePaletteColorLookupTableData,pixelData:void 0,imageId:e}};function oe(e){return"RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e}const ae={"1.2.840.10008.1.2.1":"application/octet-stream","1.2.840.10008.1.2":"application/octet-stream","1.2.840.10008.1.2.2":"application/octet-stream","1.2.840.10008.1.2.5":"image/dicom-rle"};let ie="";const re=function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=o.useRGBA;if(o.preScale={enabled:!(!o.preScale||void 0===o.preScale.enabled)&&o.preScale.enabled},!t||!t.length)return Promise.reject(new Error("The file does not contain image data."));const{cornerstone:i}=Ke,r=document.createElement("canvas"),s=ne(e);if(o.preScale.enabled){const t=function(e,t){const n=e.get("modalityLutModule",t)||{},o=e.get("generalSeriesModule",t)||{},{modality:a}=o,i={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:a},r=e.get("scalingModule",t)||{};return{...i,..."PT"===a&&{suvbw:r.suvbw}}}(i.metaData,e);t&&(o.preScale={...o.preScale,scalingParameters:t})}o.isSharedArrayBuffer=o.targetBuffer?.arrayBuffer&&o.targetBuffer.arrayBuffer instanceof SharedArrayBuffer;const{decodeConfig:l}=L(),c=te(s,n,t,r,o,l),{use16BitDataType:u}=l,d=oe(s.photometricInterpretation);return new Promise(((t,s)=>{c.then((function(s){if(o.skipCreateImage)return t(s);let l=!1;if(o.targetBuffer&&o.targetBuffer.type&&!d){const{arrayBuffer:e,type:t,offset:n=0,length:a}=o.targetBuffer,i=s.pixelDataLength,r=n,c=null!=a?a:i-r,d={Uint8Array,Uint16Array:u?Uint16Array:void 0,Int16Array:u?Int16Array:void 0,Float32Array};if(c!==s.pixelDataLength)throw new Error(`target array for image does not have the same length (${c}) as the decoded image length (${s.pixelDataLength}).`);const h=d[t],m=e?new h(e,r,c):new h(s.pixelData);if(c!==s.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");s.pixelData=m,l=!0}l||function(e){const t=function(e,t){let n;return Number.isInteger(e)&&Number.isInteger(t)?e>=0?t<=255?n=Uint8Array:t<=65535&&(n=Uint16Array):e>=-128&&t<=127?n=Int8Array:e>=-32768&&t<=32767&&(n=Int16Array):n=Float32Array,n}(e.smallestPixelValue,e.largestPixelValue);if(!t)throw new Error("Could not apply a typed array to the pixel data");{const n=new t(e.pixelData);e.pixelData=n}}(s);const c=i.metaData.get("imagePlaneModule",e)||{},h=i.metaData.get("voiLutModule",e)||{},m=i.metaData.get("modalityLutModule",e)||{},f=i.metaData.get("sopCommonModule",e)||{};if(d){const{rows:e,columns:t}=s;if(ae[n]){r.height=s.rows,r.width=s.columns;const e=r.getContext("2d").createImageData(s.columns,s.rows);B(s,e.data,a),s.imageData=e,s.pixelData=e.data,s.pixelDataLength=e.data.length}else if(!a&&s.pixelDataLength===4*e*t){const e=new Uint8Array(s.pixelData.length/4*3);s.pixelData=function(e,t){const n=e.length/4;let o=0,a=0;for(let i=0;i<n;i++)t[a++]=e[o++],t[a++]=e[o++],t[a++]=e[o++],o++;return t}(s.pixelData,e),s.pixelDataLength=s.pixelData.length}const o=_(s.pixelData);s.smallestPixelValue=o.min,s.largestPixelValue=o.max}const g={imageId:e,color:d,columnPixelSpacing:c.columnPixelSpacing,columns:s.columns,height:s.rows,preScale:s.preScale,intercept:m.rescaleIntercept?m.rescaleIntercept:0,slope:m.rescaleSlope?m.rescaleSlope:1,invert:"MONOCHROME1"===s.photometricInterpretation,minPixelValue:s.smallestPixelValue,maxPixelValue:s.largestPixelValue,rowPixelSpacing:c.rowPixelSpacing,rows:s.rows,sizeInBytes:s.pixelData.byteLength,width:s.columns,windowCenter:h.windowCenter?h.windowCenter[0]:void 0,windowWidth:h.windowWidth?h.windowWidth[0]:void 0,voiLUTFunction:h.voiLUTFunction?h.voiLUTFunction:void 0,decodeTimeInMS:s.decodeTimeInMS,floatPixelData:void 0,imageFrame:s,rgba:d&&a,getPixelData:()=>s.pixelData,getCanvas:void 0,numComps:void 0};var p;if(window.image=g,g.color&&(g.getCanvas=function(){if(ie===e)return r;const t=g.columns,n=g.rows;r.height=n,r.width=t;const o=r.getContext("2d"),a=o.createImageData(t,n),i=s.pixelData;if(i.length===t*n*4)for(let e=0;e<i.length;e++)a.data[e]=i[e];else if(i.length===t*n*3){let e=0;for(let t=0;t<i.length;t+=3)a.data[e++]=i[t],a.data[e++]=i[t+1],a.data[e++]=i[t+2],a.data[e++]=255}return s.pixelData=a.data,s.pixelDataLength=a.data.length,s.imageData=a,o.putImageData(s.imageData,0,0),ie=e,r}),m.modalityLUTSequence&&m.modalityLUTSequence.length>0&&"1.2.840.10008.5.1.4.1.1.12.1"!==(p=f.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==p&&(g.modalityLUT=m.modalityLUTSequence[0]),h.voiLUTSequence&&h.voiLUTSequence.length>0&&(g.voiLUT=h.voiLUTSequence[0]),g.color&&(g.windowWidth=256,g.windowCenter=128),void 0===g.windowCenter||void 0===g.windowWidth){const e=g.imageFrame.minAfterScale,t=g.imageFrame.maxAfterScale;g.windowWidth=t-e,g.windowCenter=(t+e)/2}t(g)}),s)}))},se=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Ke.cornerstone.imageRetrievalPoolManager,o=(new Date).getTime();return{promise:new Promise(((a,i)=>{const r=t.requestType||"interaction",s=t.additionalDetails||{imageId:e},l=void 0===t.priority?5:t.priority,c=t.addToBeginning||!1,u=e.substring(7);n.addRequest(function(e,n,r){return N(e,n,r).then((e=>{const r=function(e){const t="1.2.840.10008.1.2";if(!e)return t;const n=e.split(";"),o={};n.forEach((e=>{const t=e.split("=");if(2!==t.length)return;const n=t[1].trim().replace(/"/g,"");o[t[0].trim()]=n}));const a={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return o["transfer-syntax"]?o["transfer-syntax"]:e&&!Object.keys(o).length&&a[e]?a[e]:o.type&&a[o.type]?a[o.type]:a[e]?a[e]:t}(e.contentType),s=e.imageFrame.pixelData;re(n,s,r,t).then((e=>{const t=(new Date).getTime();e.loadTimeInMS=t-o,a(e)}),i)}),i).catch((e=>{i(e)}))}.bind(this,u,e,"multipart/related; type=application/octet-stream; transfer-syntax=*"),r,s,l,c)})),cancelFn:void 0}},le={metaData:{getNumberString:function(e,t,n){const o=r(e,t,n);if(void 0!==o)return parseFloat(o)},getNumberValue:s,getNumberValues:l,getValue:r,metaDataProvider:C},findIndexOfString:M,getPixelData:N,loadImage:se,metaDataManager:v,register:function(e){e.registerImageLoader("wadors",se),e.metaData.addProvider(C)}};function ce(e,t){if(e.elements[t]&&6===e.elements[t].length)return[e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]}function ue(e,t,n){const o=[],a=e.elements[t];for(let i=0;i<n[0];i++)16===n[2]?o[i]=e.uint16(t,i):o[i]=e.byteArray[i+a.dataOffset];return o}const de=function(e){const t={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return function(e,t){0===e.uint16("x00280103")?(t.smallestPixelValue=e.uint16("x00280106"),t.largestPixelValue=e.uint16("x00280107")):(t.smallestPixelValue=e.int16("x00280106"),t.largestPixelValue=e.int16("x00280107"))}(e,t),"PALETTE COLOR"===t.photometricInterpretation&&e.elements.x00281101&&function(e,t){t.redPaletteColorLookupTableDescriptor=ce(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=ce(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=ce(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);const n=t.redPaletteColorLookupTableDescriptor[0],o=e.elements.x00281201.length===n?8:16;t.redPaletteColorLookupTableDescriptor[2]!==o&&(t.redPaletteColorLookupTableDescriptor[2]=o,t.greenPaletteColorLookupTableDescriptor[2]=o,t.bluePaletteColorLookupTableDescriptor[2]=o),t.redPaletteColorLookupTableData=ue(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=ue(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=ue(e,"x00281203",t.bluePaletteColorLookupTableDescriptor)}(e,t),t};function he(e,t){let n=t.uint16("x00283002",0);0===n&&(n=65535);let o=0;o=0===e?t.uint16("x00283002",1):t.int16("x00283002",1);const a={id:"1",firstValueMapped:o,numBitsPerEntry:t.uint16("x00283002",2),lut:[]};for(let o=0;o<n;o++)a.lut[o]=0===e?t.uint16("x00283006",o):t.int16("x00283006",o);return a}const me=function(e,t){if(!t||!t.items||!t.items.length)return;const n=[];for(let o=0;o<t.items.length;o++){const a=he(e,t.items[o].dataSet);a&&n.push(a)}return n},fe=function(e){const t=e.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===t||"1.2.840.10008.5.1.4.1.1.2.1"===t)return 1;const n=e.floatString("x00281052"),o=e.floatString("x00281053");if(void 0!==n&&void 0!==o){const t=function(e){const t=e.uint16("x00280103"),n=e.uint16("x00280101");return 0===t?0:-1<<n-1}(e);return t*o+n<0?1:0}return e.elements.x00283000&&e.elements.x00283000.length>0?0:e.uint16("x00280103")},ge=function(e,t,n){const o=[],a=e.string(t);if(!a)return;const i=a.split("\\");if(!(n&&i.length<n)){for(let e=0;e<i.length;e++)o.push(parseFloat(i[e]));return o}},pe=function(e){const t=e.indexOf(":");let n=e.substring(t+1);const o=n.indexOf("frame=");let a;if(-1!==o){const e=n.substring(o+6);a=parseInt(e,10),n=n.substring(0,o-1)}return{scheme:e.substring(0,t),url:n,frame:a,pixelDataFrame:void 0!==a?a-1:void 0}};async function ve(e,t,n){const o=function(e){const{dicomParser:t}=Ke;let n,o=t.parseDicom(e,{untilTag:"x7fe00010"});o.elements.x7fe00010||console.warn("Pixel data not found!");try{n=t.parseDicom(e)}catch(e){console.error(e),console.log("pixel data dataset:",e.dataSet),n=e.dataSet}return o.elements.x7fe00010=n.elements.x7fe00010,o=function(e){const t=e.elements.x7fe00010.fragments,n=e.byteArray.length;for(const e of t){const{position:t,length:o}=e;o>n-t&&(console.log(`Truncated fragment, changing fragment length from ${e.length} to ${n-t}`),e.length=n-t)}return e}(o),o}(e),{uri:a,imageId:i,fileTotalLength:r}=n;return o.fetchMore=async function(s){const l=Object.assign({uri:a,imageId:i,fetchedLength:e.length,lengthToFetch:r-e.length},s),{fetchedLength:c,lengthToFetch:u}=l,{arrayBuffer:d}=await t(a,i,{byteRange:`${c}-${c+u}`}),h=new Uint8Array(d),m=new Uint8Array(o.byteArray.length+h.length);return m.set(o.byteArray),m.set(h,o.byteArray.length),ve(m,t,n)},o}function ye(e,t,n){const o={};(t?Object.values(t.items[0].dataSet.elements):[]).map((e=>o[e.tag]=e));const a={};return(e?Object.values(e.items[n-1].dataSet.elements):[]).map((e=>a[e.tag]=e)),{shared:o,perFrame:a}}function be(e){if(!e)return;const{elements:t,...n}=e,{x52009230:o,x52009229:a,...i}=t;return{NumberOfFrames:e.intString("x00280008"),PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:a,otherElements:i,otherAttributtes:n}}const xe=function(e){const t=function(e){return e.indexOf("&frame=")}(e),n=-1===t?e:e.slice(0,t),o=parseInt(e.slice(t+7),10)||1;let a;return a=Te[n]?Te[n].dataSet:void 0,{dataSet:a,frame:o}};let we=0,Te={},Ie={};function Ee(){return{cacheSizeInBytes:we,numberOfDataSetsCached:Object.keys(Te).length}}const Se={isLoaded:function(e){return void 0!==Te[e]},load:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k,n=arguments.length>2?arguments[2]:void 0;const{cornerstone:o,dicomParser:a}=Ke;if(Te[e])return new Promise((t=>{Te[e].cacheCount++,t(Te[e].dataSet)}));if(Ie[e])return Ie[e].cacheCount++,Ie[e];const i=t(e,n),r=new Promise(((s,l)=>{i.then((async function(i){const c={isPartialContent:!1,fileTotalLength:null};if(!(i instanceof ArrayBuffer)){if(!i.arrayBuffer)return l(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=i.flags.isPartialContent,c.fileTotalLength=i.flags.fileTotalLength,i=i.arrayBuffer}const u=new Uint8Array(i);let d;try{d=c.isPartialContent?await ve(u,t,{uri:e,imageId:n,fileTotalLength:c.fileTotalLength}):a.parseDicom(u)}catch(e){return l(e)}Te[e]={dataSet:d,cacheCount:r.cacheCount},we+=d.byteArray.length,s(d),o.triggerEvent(o.events,"datasetscachechanged",{uri:e,action:"loaded",cacheInfo:Ee()})}),l).then((()=>{delete Ie[e]}),(()=>{delete Ie[e]}))}));return r.cacheCount=1,Ie[e]=r,r},unload:function(e){const{cornerstone:t}=Ke;Te[e]&&(Te[e].cacheCount--,0===Te[e].cacheCount&&(we-=Te[e].dataSet.byteArray.length,delete Te[e],t.triggerEvent(t.events,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:Ee()})))},getInfo:Ee,purge:function(){Te={},Ie={},we=0},get:function(e){let t;if(e.includes("&frame=")){const{frame:n,dataSet:o}=xe(e);t=function(e,t){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:a,otherElements:i}=be(t);if(o||n>1){const{shared:n,perFrame:r}=ye(o,a,e),s={elements:{...i,...n,...r}},l=Object.create(t);return Object.assign(l,s)}return t}(n,o)}else Te[e]&&(t=Te[e].dataSet);return t},update:function(e,t){const n=Te[e];n?(we-=n.dataSet.byteArray.length,n.dataSet=t,we+=t.byteArray.length,Ke.cornerstone.triggerEvent(Ke.cornerstone.events,"datasetscachechanged",{uri:e,action:"updated",cacheInfo:Ee()})):console.error(`No loaded dataSet for uri ${e}`)}};function Ce(e,t){const n=e.string("x00080008");if(n){const e=n.split("\\");if(e.length>t)return e[t]}}function Ae(e){let t=ge(e,"x00200037",6);return!t&&e.elements.x00209116&&(t=ge(e.elements.x00209116.items[0].dataSet,"x00200037",6)),t||(t=function(e){let t;if(e.string("x00080060").includes("NM")){const n=Ce(e,2);n&&y(n)&&e.elements.x00540022&&(t=ge(e.elements.x00540022.items[0].dataSet,"x00200037",6))}return t}(e)),t}function Me(e){let t=ge(e,"x00200032",3);return!t&&e.elements.x00209113&&(t=ge(e.elements.x00209113.items[0].dataSet,"x00200032",3)),t||(t=function(e){let t;if(e.string("x00080060").includes("NM")){const n=Ce(e,2);n&&y(n)&&e.elements.x00540022&&(t=ge(e.elements.x00540022.items[0].dataSet,"x00200032",3))}return t}(e)),t}function De(e){let t=ge(e,"x00280030",2);return!t&&e.elements.x00289110&&(t=ge(e.elements.x00289110.items[0].dataSet,"x00280030",2)),t}function Pe(e){let t;return e.elements.x00180050?t=e.floatString("x00180050"):e.elements.x00289110&&e.elements.x00289110.items.length&&e.elements.x00289110.items[0].dataSet.elements.x00180050&&(t=e.elements.x00289110.items[0].dataSet.floatString("x00180050")),t}const Le=function e(t,n){const{dicomParser:o}=Ke,a=pe(n);if("multiframeModule"===t){const e=xe(a.url);if(!e.dataSet)return;const t=function(e,t){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:a}=be(e);if(o||n>1){const{shared:e,perFrame:i}=ye(o,a,t);return{NumberOfFrames:n,PerFrameFunctionalInformation:i,SharedFunctionalInformation:e}}return{NumberOfFrames:n}}(e.dataSet,e.frame);return t}let i=a.url;a.frame&&(i=`${i}&frame=${a.frame}`);const r=Se.get(i);if(r){if("generalSeriesModule"===t)return{modality:r.string("x00080060"),seriesInstanceUID:r.string("x0020000e"),seriesNumber:r.intString("x00200011"),studyInstanceUID:r.string("x0020000d"),seriesDate:o.parseDA(r.string("x00080021")),seriesTime:o.parseTM(r.string("x00080031")||""),acquisitionDate:o.parseDA(r.string("x00080022")||""),acquisitionTime:o.parseTM(r.string("x00080032")||"")};if("patientStudyModule"===t)return{patientAge:r.intString("x00101010"),patientSize:r.floatString("x00101020"),patientWeight:r.floatString("x00101030")};if("imagePlaneModule"===t){const e=Ae(r),t=Me(r),n=De(r);let o;r.elements.x00200052&&(o=r.string("x00200052"));const a=Pe(r);let i;r.elements.x00201041&&(i=r.floatString("x00201041"));let s=null,l=null;n&&(l=n[0],s=n[1]);let c=null,u=null;return e&&(c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])],u=[parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[5])]),{frameOfReferenceUID:o,rows:r.uint16("x00280010"),columns:r.uint16("x00280011"),imageOrientationPatient:e,rowCosines:c,columnCosines:u,imagePositionPatient:t,sliceThickness:a,sliceLocation:i,pixelSpacing:n,rowPixelSpacing:l,columnPixelSpacing:s}}if("nmMultiframeGeometryModule"===t){const e=r.string("x00080060"),t=Ce(r,2);return{modality:e,imageType:r.string("x00080008"),imageSubType:t,imageOrientationPatient:Ae(r),imagePositionPatient:Me(r),sliceThickness:Pe(r),pixelSpacing:De(r),numberOfFrames:r.uint16("x00280008"),isNMReconstructable:y(t)&&e.includes("NM")}}if("imagePixelModule"===t)return de(r);if("modalityLutModule"===t)return{rescaleIntercept:r.floatString("x00281052"),rescaleSlope:r.floatString("x00281053"),rescaleType:r.string("x00281054"),modalityLUTSequence:me(r.uint16("x00280103"),r.elements.x00283000)};if("voiLutModule"===t){const e=fe(r);return{windowCenter:ge(r,"x00281050",1),windowWidth:ge(r,"x00281051",1),voiLUTSequence:me(e,r.elements.x00283010)}}if("sopCommonModule"===t)return{sopClassUID:r.string("x00080016"),sopInstanceUID:r.string("x00080018")};if("petIsotopeModule"===t){const e=r.elements.x00540016;if(void 0===e)return;const t=e.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:o.parseTM(t.string("x00181072")||""),radionuclideTotalDose:t.floatString("x00181074"),radionuclideHalfLife:t.floatString("x00181075")}}}return"overlayPlaneModule"===t?function(e){const t=[];for(let n=0;n<=30;n+=2){let o=`x60${n.toString(16)}`;4===o.length&&(o=`x600${n.toString(16)}`);const a=e.elements[`${o}3000`];if(!a)continue;const i=[];for(let t=0;t<a.length;t++)for(let n=0;n<8;n++){const o=e.byteArray[a.dataOffset+t];i[8*t+n]=o>>n&1}t.push({rows:e.uint16(`${o}0010`),columns:e.uint16(`${o}0011`),type:e.string(`${o}0040`),x:e.int16(`${o}0050`,1)-1,y:e.int16(`${o}0050`,0)-1,pixelData:i,description:e.string(`${o}0022`),label:e.string(`${o}1500`),roiArea:e.string(`${o}1301`),roiMean:e.string(`${o}1302`),roiStandardDeviation:e.string(`${o}1303`)})}return{overlays:t}}(r):"transferSyntax"===t?{transferSyntaxUID:r.string("x00020010")}:"petSeriesModule"===t?{correctedImage:r.string("x00280051"),units:r.string("x00541001"),decayCorrection:r.string("x00541102")}:"petImageModule"===t?{frameReferenceTime:r.floatString(r.string("x00541300")||""),actualFrameDuration:r.intString(r.string("x00181242"))}:"instance"===t?I(n,e,S):void 0}};let ke=[];const Oe={add:function(e){return"dicomfile:"+(ke.push(e)-1)},get:function(e){return ke[e]},remove:function(e){ke[e]=void 0},purge:function(){ke=[]}};var Re=o(713);function Ne(e,t){const{dicomParser:n}=Ke;if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t);if(function(e){return e.intString("x00280008")!==e.elements.x7fe00010.fragments.length}(e)){const o=n.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t,o)}const o=e.elements.x7fe00010.fragments,a=new Re.ByteStream(e.byteArrayParser,e.byteArray,e.elements.x7fe00010.dataOffset),i=(0,Re.readSequenceItem)(a);if("xfffee000"!==i.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";a.seek(i.length);const r=a.position;if(t+1>o.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=r+o[t].offset+8,l=o[t].length;return new Uint8Array(a.byteArray.buffer.slice(a.byteArray.byteOffset+s,a.byteArray.byteOffset+s+l))}function _e(e,t){return e&1<<t}const Ue=function(e,t,n){const o=new Uint8Array(n);for(let a=0;a<n;a++){const n=e[Math.floor(a/8)+t],i=a%8;o[a]=_e(n,i)?1:0}return o},Be=function(e,t){const n=e.elements.x7fe00010||e.elements.x7fe00008,o=e.uint16("x00280100"),a=e.uint16("x00280010"),i=e.uint16("x00280011");let r=e.uint16("x00280002");"YBR_FULL_422"===e.string("x00280004")&&(r=2,console.warn("Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.\n      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information."));const s=n.dataOffset,l=a*i*r;let c;if(8===o){if(c=s+t*l,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+l))}if(16===o){if(c=s+t*l*2,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+2*l))}if(1===o){if(c=s+t*l*.125,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return Ue(e.byteArray,c,l)}if(32===o){if(c=s+t*l*4,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+4*l))}throw new Error("unsupported pixel format")},Ve=function(e){const t=pe(e),n=parseInt(t.url,10),o=Oe.get(n);return new Promise(((e,t)=>{const n=new FileReader;n.onload=t=>{const n=t.target.result;e(n)},n.onerror=t,n.readAsArrayBuffer(o)}))},Fe=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=e.elements.x7fe00010||e.elements.x7fe00008;return n?n.encapsulatedPixelData?Ne(e,t):Be(e,t):null};function He(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;const r=(new Date).getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise(((l,c)=>{e.then((e=>{const u=Fe(e,n),d=e.string("x00020010"),h=(new Date).getTime(),m=re(t,u,d,a);!function(e,t){e.decache=function(){const e=pe(t);Se.unload(e.url)}}(s,t),m.then((t=>{t.data=e,t.sharedCacheKey=o;const n=(new Date).getTime();t.loadTimeInMS=h-r,t.totalTimeInMS=n-r,void 0!==i&&void 0!==i.imageDoneCallback&&i.imageDoneCallback(t),l(t)}),(function(t){c({error:t,dataSet:e})}))}),(function(e){c({error:e})}))})),s}function je(e){return"dicomweb"===e||"wadouri"===e?k:"dicomfile"===e?Ve:void 0}function ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=pe(e);t=Object.assign({},t);let o=t.loader;return void 0===o?o=je(n.scheme):delete t.loader,Se.isLoaded(n.url)?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;const i=(new Date).getTime();return{promise:new Promise(((r,s)=>{const l=(new Date).getTime();let c;try{const o=Fe(e,n),i=e.string("x00020010");c=re(t,o,i,a)}catch(t){return void s({error:t,dataSet:e})}c.then((t=>{t.data=e,t.sharedCacheKey=o;const n=(new Date).getTime();t.loadTimeInMS=l-i,t.totalTimeInMS=n-i,r(t)}),s)})),cancelFn:void 0}}(Se.get(n.url,o,e),e,n.pixelDataFrame,n.url,t):He(Se.load(n.url,void 0,e),e,n.frame,n.url,t)}const qe={metaData:{getImagePixelModule:de,getLUTs:me,getModalityLUTOutputPixelRepresentation:fe,getNumberValues:ge,metaDataProvider:Le},dataSetCacheManager:Se,fileManager:Oe,getEncapsulatedImageFrame:Ne,getUncompressedImageFrame:Be,loadFileRequest:Ve,loadImageFromPromise:He,getLoaderForScheme:je,loadImage:ze,parseImageId:pe,unpackBinaryFrame:Ue,register:function(e){e.registerImageLoader("dicomweb",ze),e.registerImageLoader("wadouri",ze),e.registerImageLoader("dicomfile",ze),e.metaData.addProvider(Le)}},We=function(e){le.register(e),qe.register(e)};let Ge,Ye;const Ze={set cornerstone(e){Ge=e,We(Ge)},get cornerstone(){if(!Ge){if(Ge=window&&window.cornerstone,!Ge)throw new Error("cornerstoneDICOMImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneDICOMImageLoader.external.cornerstone = cornerstone; to your application.");We(Ge)}return Ge},set dicomParser(e){Ye=e},get dicomParser(){if(!Ye){if(!window||!window.dicomParser)throw new Error("cornerstoneDICOMImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneDICOMImageLoader.external.dicomParser = dicomParser; to your application.");Ye=window.dicomParser}return Ye}},Ke=Ze;function Xe(e,t){const n=e.length,o=new Uint8ClampedArray(n);for(let a=0;a<n;++a)o[a]=e[a]>>t;return o}function Je(e,t,n){const o=e.columns*e.rows,a=e.pixelData;let i=e.redPaletteColorLookupTableData;i||(i=Ke.cornerstone.metaData.get("imagePixelModule",e.imageId)?.redPaletteColorLookupTableData);let r=e.greenPaletteColorLookupTableData;r||(r=Ke.cornerstone.metaData.get("imagePixelModule",e.imageId)?.greenPaletteColorLookupTableData);let s=e.bluePaletteColorLookupTableData;if(s||(s=Ke.cornerstone.metaData.get("imagePixelModule",e.imageId)?.bluePaletteColorLookupTableData),!i||!r||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const l=e.redPaletteColorLookupTableData.length;let c=0,u=0;const d=e.redPaletteColorLookupTableDescriptor[1],h=8===e.redPaletteColorLookupTableDescriptor[2]?0:8,m=Xe(i,h),f=Xe(r,h),g=Xe(s,h);if(n)for(let e=0;e<o;++e){let e=a[c++];e<d?e=0:e>d+l-1?e=l-1:e-=d,t[u++]=m[e],t[u++]=f[e],t[u++]=g[e],t[u++]=255}else for(let e=0;e<o;++e){let e=a[c++];e<d?e=0:e>d+l-1?e=l-1:e-=d,t[u++]=m[e],t[u++]=f[e],t[u++]=g[e]}}const Qe=function(e){P(e)},$e=function(e,t){if(t=t||e.transferSyntax,8===e.bitsAllocated&&"1.2.840.10008.1.2.4.50"===t&&(3===e.samplesPerPixel||4===e.samplesPerPixel))return!0},et={convertRGBColorByPixel:e,convertRGBColorByPlane:t,convertYBRFullByPixel:n,convertYBRFullByPlane:i,convertPALETTECOLOR:Je,wadouri:qe,wadors:le,configure:Qe,convertColorSpace:B,createImage:re,decodeImageFrame:te,decodeJPEGBaseline8BitColor:V,getImageFrame:ne,getPixelData:N,getMinMax:_,isColorImage:oe,isJPEGBaseline8BitColor:$e,webWorkerManager:Q,internal:O,external:Ze}})(),a})(),e.exports=o(n(5915))},8011:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAV1BMVEX2AgD2EAD4eAD3QgD4bgD2HgD3TgD3ZQD3VgD2FgD2NwD3XAD2JwD2LgD99hf6owP6mQT4iAD5hAD7uwv6rQb5jwH81w/85hT83xL8zw/7xgv+/hv97BZTj7ayAAAB6klEQVQ4y9VRCY4cIRAD6qSAvnvn/P87456NEq3yglh9CGwZl0n/GXLOVbqI9DEk53/4Wms4RY/moY26/JRkqbmO3gqTrSbaIv9Q5BBi07atPdWy2rYWkvijECHyc12XeS5Y6jyf67m5yGXSc8Z5xOu6rctxXIJ2zOtWCmsVzWnkoUJwsG3blvkUGXxuYEePyBSpZu1BmLBzKWUrhu9ZfGCn5lQd8SmrY0ptqlzMCsCCkeqVMZAQHvEx8LCyLcdSOETcCRboC+MiaLRmFtHKPr2mrwJSVfG9Cvz0gRJQ4Ij2nm7vaY8QUtRZUYV08MMUa7iU6cJOCp7IRSO5okc1cOdzt+V1f35NN2M2CEgQfy8JLtSO+35f9vvbzObXfT+Px4xZSdO0wQHgx9fX8ZwmJt9ft+eOlfQ8It0MITFM9WVelvlxOx7vHbfyLIFb6JTmSEClUG+N1I9pWpprKd54ZImk/TIINncya9oesyEjOyrVnCWRpDyqlut6HAnpNKB5Q+OURVJ0ESIIjISaOjGpsw9i1h4owcxV3dlGHd4uKQVWgq5JcUyCE06EdUVmgDR6xBjaEAVkYi74IyP1WuUDSHOND/3tAB5wufYrWLwAEjGQwF58wzSY9y8ShH0QJQbMQz6b36X+fr71vwDwJBeEP0nA0AAAAABJRU5ErkJggg=="},3522:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABEVBMVEX3+//i7fja6fbo8vrU5fTl7/nv9v19tdne6/fO4vKky+TB2u2gyOOBt9rG3e+u0OfX5/WnzOWSwd+Ku9yPvt55sti92OyrzeaYw+Dr8/u41eq21Om71uubxuJrqNSz0+mx0eiGudsUNnJnpdHy+P7K4PCdxeGEuNvD3O6+2ex0r9ZjotBJjcWVwt8oVpIlS4WZv91WlslghK5Teqo3ZJsfQnsVO3gRMGuiw9+dvNhyrdV5rdRcnM2DqMtjjLhJcKE0XZMWP39wptF+rdCPrMt2nsRplcBAhL9Pib1nk7xcj7xGgrhQhLVAeLA4cqxAbKFHZ5g2Wo4aR4ksUIeHsdWWttRlnMg6fLtYiLc2bKcxaqcwQHXtAAACnElEQVQ4y9WRVY5cMRBFTc/c9mOmZu4enuDMhJk5+19I3FF+oqwgV7LLch3XLbnAfyZKC44IQj4RU7+g/+QhQkpWhqhGKzsrif83Qn2E0FQ0q2EfjWORzRQk+E/hCQATqvxsGPd5OxYAPhzH7fhOTxbYZQAuigL5ZZmvx+vjzeaue3Nrs1mv1612DXkFIB6sBKmj8bodHz/79tABR8824zZJBhIhy4HxlCRp2eu4bdvjzT0fLQb32mRuzXSpvL4ECEqRWgz5NEqSVXsnThJ2L9ELiDkvKNLA81OYNQXmQRNk8zthuFolyVx4yCCPUloC7DoJFEQiYlptWfvy9OWjKCVEByXisOCAI4gFXDTNNlcLzd6NLkef7ssO2c7qklMKuO8q4S4KtTRTc/v84uOD0XulUNpXuuMKA58UlJrYWjub5fn90cUDB9RZ2lWqln6WAmkphV0+2z76evYmPrncn30Y7b9En4+yOq1IIMGbu5MJJ8vZ693b/dW7/fnt/Ojk8tP101dnrwPhVRaMntAJxth7fLPbvfp5MXqcBteXH3+83e1OfYLFApzfpoBiWvBbV8+Pr05u9qcfzq+fvHh+dr8WHIslOFEOoLBUNsubtAtORxcvtLQDJnVsMFEgE86iUFEsgzQPdXbr5nsYxoNYxiwJOPRBTTCeooCxKJvKcJvXT4/CMJxJzVZJx30CjCBumJKxPCWVtoGaV72OpOiGkRVGZyDMgz7I5DA23OimrrO7lZHzkCBb1TZmDDA2GAzjcFtzCIkgogqMMEsj+iYPh8kqAQMnx4SyEuggHyHuWLQMGUvYocLA7QdEEg/C30m3nEjZRMP58GDhPKKm8w//6TnoIO9wQsSkJYjmUZQHS8Kx565x4cJvErpwwH4BGi5IMMkKl1sAAAAASUVORK5CYII="},2007:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABBVBMVEUAAAAZGSQdHSkVFR4SERkjIzFmboZka4NOUGs9PVVSVnAHBgtJSmZgZX8oKDhpcohCQ1sPDhVueI1ZXXhWWnMzNUcuL0ErKzwLCxF2gpU7O1L2+fpdYnxbYHpPVGkgIC5KTWM3OEsyMkR6h5lsdYtAQlcEBAZMT2hESFw4OE+Rmaecoq+Qo62Cj59dZHZaXXFERV/+/v7v9PXa4OPP19zKz9XBydCdr7iImaZ8i5tHSWE9QFHq7/Di6Oq2xsu7vcSlrLaVprFye49ydYro6+7g4+bT29+2vsauvMSzt8GftLuqsbqMkZ9+hZNgaXtqbXrX2d+Zm6VygItvfYZpdoFSXGVJUlt63FDBAAACl0lEQVQ4y9WRRZIcMRBFJZVUwlIxczVzD4+HwTxkvv9RXD0bh8Mn8F+kIuM9ZS4S/GeRMjEQqRHRcYwS+Q+HEM3YKNStqGZnAdfob0UiBFGkhfd8vk7XeipCSJJXksjxjodk+rx2RDogAH8bFOnAc0jnAjAGbuJKVPPz6s3gzent8kdv/1ou+yatEIHYBRob5zHhVjpIB6cnn7/3ws+T5SD1PNogNIUgMrqGZOejapOm6elyhWBMV6lHnSgOQzxqAYKNbqfYQLE1HHrpXWkP7dWQdRAj5CaoArjO4LRKMGrEpKF3pe953pBqA0U1llK2wCUIN+FugFnNfDOd38zvrYwQxjiCRgIBrA1XG50QfhCGwv6Q7+Vf7pkDp1vFOJQSoNpIpDuySsHCKNy8zS8v8utwVmfKYSMYuoDoRCZRcaZU0Oc+37/Yz6+5yrbbjLNataCaSgmdQPje6vhh/XXv4Pgwf7e26Kbh3CGKgY/eeAxJJk7eXx3MPxy83fj+Yu/g0+rkeKFiPFIgf5Jj13Xxy9Hh4eer/fyFV9d7l1cf3x/eIO1GM3C5kWCMZQKr+e3pfHH07uHo4tPT4+3xXRZDrDOwaMdAjg0+U5Mg4NvJTb4/F0yZNhNFh8kMqFj2F+1owRj3S6HE0aIoLNNihT1sICSAE9eN4JlpWipipe/zx6AsC8GE7Q0dSAgINSEZn9h2kBFHqElGR46wWOxQ6yzumAJ+MHGUYrSIYMQCzpU36hj1Ndo6XBWmCWzTNKlV+hz2CzWJeRPqro0iRwQlHXoeMKm5U0rmxKgPqWvUqwZqfdPuP9tgV2zaKxOCIdzBHTegQbiwKKW9QE1KLeEQjLGxy45jo2+QjjIOLGpZvmoJfKU46Z/e/FN/A92MRrSJbLGPAAAAAElFTkSuQmCC"},6030:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAA9lBMVEVP//9M4/97h/5kqP92jP5M5/9M7P9N3P9no/9qnv9O/f9Q1v9Q0f9cuv9wlv9O2f9btv9M8f9esf9N4P9TzP9VyP/vBPxZvP9yk/5N9f9+hP6Jdf5ZwP+Bf/5opf5N+P9tmf+gWv5U2/9zkP5+gv5Q3P9Ww/9gtf9Q5P+tS/5lrf9rm/5zmP6Gef6aY/7dGf3kDvxR8f9U0P9cxP9frf9hq/9un/6FgP6lVP6+PP1U6P9jsf94kv58iv6Ncv6OcP6Sa/6oWf24P/3CNf3NK/3RI/3WH/z3APxgvf6XZ/6zSv3HLv1bzP6MfP5e1f52qv56oP6Ljf7KZtzfAAACoElEQVQ4y9WPh47dIBREwWDAz4B7736997a9b3r5/58Jm40UKX+QkS7o6gwzAvxf6lTJ+qI1277J/S/tuur8y0eURswd8PxQ5rvpcNMmf8C7M2lpvx/4h+JqeJXJzcTIobn+jZxEWTrV1rq8ku5hnn3rXHy9iedZcWkG645ixCFOawlxuLm5+XhqjurN96a5zW7nZd/0LgjgOhS+aXczpcV4/FXF/Tg12bzX01C/nXgggFtkCjEsZ9k8WzR37ejL9V1WYDfw81wffgAWRJv8kkDq415azAuZpuldrxxAQilx+iXQrQhOSodQZKAJLqQsil56vYH9wNKryvkACLd0tB1ZPtbKXGpZM256seBmiUTfg84IQAuSzWhrGPU0z430HL6GL0fm0ksXMUGTBFALOokzxNJgg2AwW4WrVXjOI0vsXDb0Bmtgccdxgni3R4ZKOYZvehRIuG5klyaKQDlJkpFbG7K4e/w0u39dfn4Ol1fd6xkSts0RAw/HqqI8OoxfzsvFebma1fL+9eXh4/jzCfm6vQPhbdIhhFz8fHp+Hj+G4bVdnl9Xjw8vz59aTvwcLGdJpyKJ4xlNs2jun5afnlYPt4vT5+MHnxIuwH1UdZxqJKI9mk7Fjo3DcGGwvZYyIw50HgHEVYWzxTFjopYMGU+nOO6qNdZ6yIMWsE1CfDrRtC4KWCxr+2MtZWwwIy16Q880wcA3ubCRltbCtI09irDtsi7zXYz3/oAhIKfIRYjhOKABm9o2KuwAYckt17VRrGlAU8JdKW0KPc65b6OcD6IgcI06xqoGaPi3RTLXp9SyTMuingchjaSmpYqA9P3GGJk69KingtQomcLoYozfK3DXGKrf6PCvdB1aPIhsgBWtUWR6+hsmjq4Y0dWi5u38BZRBTiq+AwTyAAAAAElFTkSuQmCC"},9141:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACVVBMVEU/S7/W3OfU2uhVa9pfeORngeleduKctvvK1u5cc+BZcN/G1fPa2+C0yfpyjO3R2uu5zPVjfOarxPxOYdJLXM6wx/qguvqetvd/mvPD0fF4kvGKnutIVsaWsvytw/m8z/eku/eTrPaasfS+zvO6yfBvi+5sh+xpf+PY1dzi1tJEUsWzDSemwP2Ur/e1yfayxfWtvvGouvGEnvF/l+2otupwiepqhOqksuluhuhjeuJSZtfm1s1JWcuyID25HTC2y/qMqPnB0vWCnfV6lvKXrPDG0+90j++ywO17lO2NouzFz+qsuerO1+l9lOlqguZlfuaFleJZbttiddlMXtBRX8ro1MjuwKmuAR+vw/WLpvWgtfKSqfKIofLN2O6Qpe6Dmuu4w+p5kOqVpud0ieSyu+Ntg+PQ0eKxt9+ys97Nyt1ofNxfdNzIxttqfdvf2dhVaNXYz9RqedTk1M1TXsWymsPrxrXBlam3W3e6RV3NVVe1ESiowPeGove+yeydr+qKnOXU1eKRn+HEx+C+wuCboNvCwdpvgdrU0NnFudPk2NGhl89hbc3i0czqz8HKrrebhbTNnqnxvaS+iKGye5/Kjpq5fZrxspfZl5PPhozaioLbf3TBXm+mO2XGSFG+OEi5MUbGPUK/JzKcq+jKz+SfquKpq95/idOYkNDczc64q86/ts2eisRsbsLAqb/Wtrrfvri2k7bhubGugabhrqTbpqGMWpbnp5SxbJHxqo2/dIutYYeiVoTHcH2nUHviiHixTnDNaW6/VWnFWWLFUFytN1uzME3DMjdGkMgXAAADLElEQVQ4y9WQ05IkYRBG/6rqUpfbtm3MdPfYxs6szbG1tm3bto3n2pq929gn2C8vMjLPiciIBP9ZDLnO/cO7VjUna+Otw52Gf3i7O2Vl1PMq6pbWBNeb1bW7/lYMq1Lu5ljtSs/OHfdGdi5LL9VnV3T+IfIO3yzfnLnRt33+Gu/IAzB66MC2A8VDm5KtowD4AFKE5PpdlZVr5hTPGT969JBoH+7qEgdvjXtF+yACKkhseROLbxsp3rt3/NSbiVnhVFfxgMezuqGnP50FG7DWBBusvNaw3TvgHe96PLz/Vt9BL91oicX1eunyrSCFJZrq0ogEbbpO07R3qH63Z8tBT40+24aigx09KwGZXJBNr5QjaJSPRFcPaLU07dm9bgXmXpKR5gyKrQDRuXojejITJ+Aaq3bLnSNnjuypX1CdDDM2dwsmbweCU4Is69U7zGX2xQv5dR/83f6fY2F1TzQgC9maFQqAOkm5omhTI2UumRcrvZ0vXPnlvxAPZmyyAD8/W9cJWF1Rh3xJvUymNDscG8dmClevzlxYbDIGAkY8vMq0HESicgWmKjNv3PPo/Jm177svf53y5/fV312bsOGqamUJOPvQ52vWGdecvvjp0snzl/I3HUtfd1+enDj97URE06aSgZlnOZ/47tGX36enX50r+O/j6c/dV86dvTg92V87WG4E+X0KkEMU8vYdx188PXZyKv/xR2HyybHnX8Zam1qQuBG8qzOADl+vzSqb67Djgchbf2EixMhWr2N4Qi9dZgVRjQIg8s0cUcLgZVSJsmHqRBVFwARDQHQDKrAAZxFE405AMGHawFBUGX58LUVRfIiHaHp+i7MalGpYXRCfC0H2YLXKLFMa+9QWfhFTbmkk1mvmhUxAa1dalEqGq4qhS0J2XGUaUpcyjVpdxqLCTVUwBCAIgjmConBUQHUVFeXqRKlm4eJYuYW3V3HiGQDDkFgwFVZpXC6Xk3U6XWiLIEkt0MKQGBiIWGwwzIWTUkFIoaggoKhEDFvpIDiOAyKdvcGrWUQqJTFM8icYJiUlqG6h1QYWcYsI7VwrK0hJcY8UiVIbgrSJTfRJjPwNFme7zxtIt3oAAAAASUVORK5CYII="},642:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAwFBMVEUAAAAcEQkqGQ+QXTgTCwYhFAxoQiiJVzVWNiF/UjE6JRYKBgJ3TC5ySSwwHhJsRSqNWzdFKxo0IRMmFw6VYDtjPiZRMx9JLxxbOiNvRitePCT4wHmhaEB6UDCma0I/KBiEVTROMR6ZYjyCUzP7xn3osG+pbkTnqWvKhlTDfk7bpGeqd0q4d0nuuHT3t3PUn2TYmF/ElF7EjVi6iFa7gFCwgE+wekywcUbem2HNll3WklvUiVXBhFKjdkqaa0LdqmwjTj//AAACZElEQVQ4y9WNZ3LbMBBG0RtRBBAk2CmqWJJ7d5qd+98qsJ0fyeQEeYMZLPZ7iwX/GUVBILII2TArRIp/clqixTVJJdMulRYK/a0UKDMrs1kLOUlVmUQD+Ug+/yq87bhszDBZADfTdpg2jfXkQyAkT9fCnE1nl8cTzq3qdMqPoUWhJAQoCGtlxXqahuny+/eYhfZ4moYYV6xEHQUeemZr0bhxGIbL0wsqFX8ZIu+8SgmKBSDKVOogRTPHcTNsJMb4JTpPIUKEIAegrWnVElIywyq+kTJuYuQBohnBoihqQAKCzEOkOHbLiIfnH894WwfrnEAlJRRQBImCXutRp2Tw137X/1y5ruw61gpUFABZSArScGlcmpO56q+vd3dpQXXVmab0BNhACPGyYkwbrVd9ZncnWM5r4RBLwFWkoJ02Yzy7PcrX3f7mvN+Pa66ZEE1gLfgW85pQm/vD7f7i6/5Ka/m029+fHc8fmYJNBXZvBSCZ8fxwOH7peync3e769tvh8IAUUQnsdQEKWBDqLh4vn5/O9w83V/dvFz++xFqVUNXgackCoKKumNaicg99f2FchbEzWw/DAph6X5G4bJ3QsmXm5nEr16t1K3FkJbVABEJmlCfWzLdSjuJVy+1WtwZvYlPaAJKyoRYMY12HxjBW86YzvJ0bzqvZtwyMmnWMtVz6cm61ECw23vExoKoR1RZjgFerFd9KKRAtgwpKsKR88nNntOQ4xixgnCXpGoUy1lqESkrRMuYg81vIOAtzv8xhWeYKWqHXnHPwnnK+No2FH9B3PisUfC0Az+nIFpub+RDyfv3JL+wXNhoUBI2IAAAAAElFTkSuQmCC"},1008:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAnFBMVEUAAAAXFxd0dHQdHR0jIyMQEBBWVlZoaGhfX18JCQkwMDApKSlubm5bW1tJSUlGRkY5OTlRUVF4eHhkZGR7e3s9PT1BQUF+fn5NTU01NTWFhYX4+PiMjIyIiIitra2jo6NDQ0O+vr7y8vKdnZ3Pz8+SkpL+/v7s7OzV1dWmpqaZmZnn5+fi4uLf39/a2trExMS5ubmxsbGXl5fJycmVOdM0AAACQklEQVQ4y9VRR5IbMQxkBHOanEc5bV7//2+mtPLB5Re4D0CRaDaAJvrPoJTC7A6tNePqnzqmrAYfdS1dk6TX7G+KYpSyXsvWBjELnWSkhj+FHzEyb0Unh9kg3s5imFvP4oPBOVeMbYKc5un7uhb5Kq37aZoGyQzlHGmMN9oEO0/DfFu+2kxwyzoNVUWA0o6iHkcwm+BdOQzDbT0yqslxqGzX67rmvkYMg647jqm2RdEOrSiq4li5iDmlXFGHMGtocoqzJCGRVoiqzeoGs57hPHyDuMkaETNtCdQlmffLvrKNMQ4CpVhhRBnmGkcpy7KuZbEdT+N7BZ52CVygSt0JSvFsgnSxr8vz+HIet7Fhm9Q5T7MVxnClepESyKzSjrvdbtwGCKlrPDCoEXRK0a7MtenjS+xPr78uu1drSQkheAMOfVYIUdO45X37dtu+nUUp1tPb53E5XEFzn9A4K8Qz7OFyWT52Iwlue3r52L5fFqZ5X6OXUiGUx8Byv37vr4fXr8P5c/pef7WNplxv0LVBKO8S6vuUIcEy7m53ywonRcSmQaBVFohWOAhlDvKwCmGJddnzRKlBwXDe00SIheiEKP2xFCKbIou28pQZFLXJnwlFUW6MlwAN8Z2zrvfWJh0dIFFCBwBERNo7GTxUPuaTYckHEISggmRYIQLNDbXRHmod677vZClsboPIDwR4zZ7IVMwaQYr7Y0RyfqgAw/QPMKbYbKR9EB6w0udt8A/oMzMdm4DyyraExvzcZs+f4Z5wzr8B8scsKGLwyjkAAAAASUVORK5CYII="},9572:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACZFBMVEUKAABHAABsAABcAABNAAA0AABYAgD3PAD3QQD3NwBBAAAqAAAeAADaAwD0GgDTBQB0AABmAABgAABRAABKAAAUAAD2agDGBADBAQCMAAA9AAC8AgCCAQAkAACNCwHvKwD1JwDfCQDkBgC4AQCzAQBjAACrDwHzUQD3TQD2MgDNIQDuIACRAgCtAQCiAQA6AAD//emUEQLvEgH3dgD2cgDDLADmJwDoHADjFgDiEQDuBQCbAgBxAgDgAQCGAAB6AABTAAD///3yPwXpFQTPEwT4fQD3VAD3RwDSRADDGgDUEgD1DwDaDgC5DgDpDQC2BwCpAwCWAwB+AwD+9+/96db5xaX6sgbaHQX5nQOkCQLnPwHyNQDyLwD2LgDBIwC2IQCuHQDnBQCEAAD+/tT34NP+/8v44bb89qb955j6u4zwpIz944f0t3jih3T1l2D81lHohFH3sUf7y0bigUT1d0LdSTL4qyfCOSfUKhH70Qv6uAbmSQH4iwD3ZAD2WwDwVwDaTgDbPwDBNwDQKwC7JADfIgClHQCSGgCaFACCEgDCDQCbDQAuCwB3CABSBwD+8+n+/93+89v43sj3ysL93L/+/7zuv7L+/6rftqP82aHgrqD215H60IfimYPtrID7y3fOiHPXqm7yg2LWfk31j0qVaEjzlkf820H3gT/Kej7oXTnCRjX5nC/hfy/iUCy5NSj6vSXwPiD3cRzXTBb2kRTuThPBKBP83xLUaw3BlAmSZwn6vgfOOgbylASEWQTOhAPISAOXJwPFVgLFfAGmKQHqYwDmVwDvOwBPHwBxGwBHDQDOAACwWnJmAAADLElEQVQ4y9WS07IkYRCE/3ZPu6dnWmObO/baR2vbtm3btm3bL7VzNvZun2Dzoioq8suomwT/mRiGpnBR9MEdmhWnmX98FDHG3APj1u2bwm18Wp1o/IuY/8ZFI45oHdl1fT58zPTZM25TSqrQfxza1okwdvHz+j4DN8pdvoPd77pskDNfxsN2ujOfwDAbAvv9G3t26Tn81cpPTfrtyqHNQw4b4b0JDFghaHsH3Loh00XODF/x7EUTeLliaGZNYN2qsTgyXgJl047NQsy/NdtHXiMPH/pm788fq1bLwW87o9ZUitq6DfhMm/ekxuuoccfIYO9e8trc1wC5OhCOSjpixGx4FlBwmzQuSyeQvoVw35FrI1ygVzCwvgIhmkgxZts2kBBEqIcdEieOJsJt+W7y9bmLHzhGCHA/d6sRR2kUNGAUs5rah7X0T+8qF7rNTnYddGjJABVX+Krba7QxAIEh2ob5R3GlCfFo/N7g/ceOJE/aY7CH/TXBgpcxANcxmrbneLZa6l7YsiQ5acqU5HE/6+F5jzpAZOMg3JdmJCXdknvycMaC9+e7Hp4xZN/kZY5Hr/t6LYpQLYGFz81mpO7NLph+beqi2dMGL093n9N16tk7S09f7adRCguSNxgzhmG7r5yaNf3+vEmDbll6zOw6bd7CE7Mu4FZMi4HJyxjA6Axtejr/9uP5F4ccPHN08Mybi5aeu5uyIrrVA+aMMAObGfXEWHZLdwvfb+6gA4tbXHy3bu6iw04JXtCjZjNjtH10ZILbkuZK1WFDLnOc0+BwcWRwLC7BQBUwTEPGEYSTbXf3799fvbQ8wkVaikWyV3AgDgsgXqsIXksPksx7BaXEVr0jLUrR6dLUUaN5reziQS7vUlysO+SIIlqxu0dlAwPLrlGRuk9RVN5BEIAkDIYxTo7zIA28PrFeax0br7XvikZ3FvKRMb17BYHBQBBNhhug1nw+UYRh2IfgDck3IkeQvUmCBGTnNjQ1AKakRrPaUgNBTKiEVvzDHKFQqPMFYQg5C5aKrlMQBKF/BJkoCDV2tMdawZiQ05nv1ybgFGRCTQmsaegJXYdMEEVBzfkbXuqtTGcwvUsAAAAASUVORK5CYII="},8962:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAA9AACkAAAyAABCAADgAAAsAAAjAADIAACXAABOAAARAADjAACwAACrAACJAABgAAA2AAAXAAByAADnAQDMAAB+AABUAAAvAAAeAABsAAAIAAD1BABGAQDrAAC7AABJAAA5AAAoAABoAQG1AgCfAQCNAAB6AABaAADXAADUAACQAADvAQC4AACFAAC+BADbAADQAADBAACtAACTAAD1DgDwCwDdAACoAABdAAD//v3+8OWbBQHDAQCEAACCAAD98u/96dr53dX948rikXzYDgT2PAD0LQB1AAD+8uvy2NPzx8DzyLT8z6b2tKTUqaPrrqLxn4r6q4TLeXLccWPGX0n0cUjgYkbPXUD4gz3lSjzLSjO/NS6ZKybwTyTPIhmnGxG7JQyvEwh6CAfDKwaoDQbKDgH2VwD2QQD1HQDhCwDdBwDy0sn82rrit7H1x6D6t5fbmpD6sI7xqY7LkYjrl4bzg3e8fXf1lHPLhm7qalbMZlT5glOIVUfWUUTuYT/zeDi4UzigPTi2PDTtXy+gLif3WB7iMhqVHhTrOA6eEQ25EAxyDgvTFQjrFwd+JQX3YgK1PgH3RgDoLgCGLABPErVgAAAC7ElEQVQ4y9WS1a4bQQxAZ2ZnmZmShWQpfAMNlJmZmZmZmZk/uNuqb/2C+sGSdY5tyTL4z4LnNQdzVcwVioJd/h+uQmwNW3qRJ6K1MMyK6l/F/9uOIcT1Ymgw3d54YLOJrnLuH6Lx/m+uRxnTa0ntcRXQJ+ctMipkFnnu737adXkcLelO51Xmrfl+9lhpfzm7uizaIuZi2gUF5SyZcV1mXKlU1pz5+q0Ufp5ZXakIxgRByMbAc7yUW9KVUaddGqt/4Fg5fW4cNNi6slan5BxgAs3yEU1ApR8Ewfg8QwoXzgmSrtIQuhqWAFW1VFbSaIhClDYDhgna5y/0bQfXqzXf5y1A25hCulNVGqSULyI/77+//0jfsrmhJOOY0AigRgRdEHoYMr21erLq9rr5SzcclEaQZZEoQ40HMKI03s0aZkfU6/qh5cs2XVq3pZ5XF6ds0op1F0S2q2memSIUJkn4YsGyFSsWbDmBuixrZWKEcoBYjVfZQdg78ubW7uN35m/YtnnB+lfMsaMLF8steyqCpyd9H9rWqSdX923ctfLK8qO9Dzvmb1x54OW2PUihWilY8Iz3aZrWHt3Yfv31vhVLn3ffX5u/6eHuzdvvwcJVcrD+EA/8Gq8Rbx8cfrd359aLNy8vX3lg7+G7Bz8qkC4Wgx0nfKD5hJwjlIQym+5cuuyxKKWrPg07fY+yLbBwxgNa0xtmeZlFTIJObd3DmH2yL5pCgGI1AjJH03W4UBCayBNNZiDvOs6Y5VE6RjsYxREHdIXjlsiSYQwW260OkqzTLTZpisqo0UwVT0SAGUxZaSrOmR6siz05Q6syT5pj7Co7ypApCMAgSXKuaTIyVKE9s5UsXTvz8nqd7QyYRtBuA3IikAJJmsORgnH581EVw1glsMWQRiD8mWAYv6dMJI5SYwyhqkLoqATBdcPm3NwECMKfHWGLo2s1ynEIgigpRVAUgQvPkkFj0mgumlpcTFElpN2aQ9R+q4RTJsqhfgHJO3I6nMyA7AAAAABJRU5ErkJggg=="},2723:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACf1BMVEUAAAABAEACAEYAACUAADgAADEAACsAAC9SAJYAAAwGAFgdAKpaAYUAADUAACAAABMDAE8JAHEFAGADAFQBABgCABBOAJ0MAIwCAEw6AK0XAKQVAF0KADNDAKAPAJxWAJEYAI4TAIgKAIUMAHtsDWULAEgDADz98+0pALI+AKUlAaQrAKEfAKESAIQTBHgfAXYtAW00BmsGAGoHAGUMAGP//v40ALcuBKgzAKAbAJ4pAJ05AJscApglAJhEAJUSAJEkAo1YAIwZAIoKAIATAH4rBHsWAHNmB24SA2odAVyEHDeOIisAABz38fTr3uX95tYyAK0kAKxJAKRKAJnus5IbAJFMAZBVAotJBYdeB31iBXc+CW0fBWtYCWoTAGVAB2EsBl5WE1UVAlJxE1BWEEwNAECXJx+5PhrwZgvOTAr+7+bi2OT66eDjz9nIssvjy8mqlsW4qcT507mPdLjuw7C4jqs2CanZrKWldKNYO6BYHZyKU5uYZZoXAJotA5g+ApUlE5QyAZFCAo03Ao2GXIo8LYo4EolZEYk8B4ZRA4WGVHY2B3HXgGBnFF83CF9qEFoqBFJgEUyDHktKDkt7FUmBGUU0CUUkBkWNIjOLHzCIIS2SIyOmMB9sLBmqPxiXNhHXUgsSBwrSxeLDt9fNtdL84MzFoMChkrqLe7reuLjJnrKPeabCmqKMZp1rR503HZdeNJXVmpGxjI9POYswHIpJMIeSZoamaISUU4RlKIK/eXlAH3kyBHaLN3VdLHVXF3G8bWncimfqk2G/a2FvWGByHVvli1exWVd5G1F+M01tEkq8WEOpRT9lFjwlBDZ6HDVrGi7WZisSASQrCxLeVQOSa1CeAAADLklEQVQ4y9WN05ocURRGzzmlLnS53T1tG2Obse1kJrZt27Zt29YDpSbJXZ4g6+a/WGt/G/xn0AaVtPsRMjOybUyb4R+vh9DLxiWmedAG76KQiRnzN6H/jAHBAMwyw0Zt2/1172j/8EEjcVH9bVSB7sxsaPen0ckdLXt/gGNHWkfsb/0y3DzS0HmP8bwAUcPgHQdax477efSIVh862jG2dWxLGvrtGA9kkmpmxLoR+w+07BvX3n64M2jv2Ldzy6ghaXsgZQcZYs9msS45fPPolp27xnUctn//vOng9sZ1NTmm2UZu3QMQkfY3pzACjhwycKBv19vl77cMOOirH4pjEPKCfRggUQJPDVMxWL+sPjVk1JLZPp9v07YxBByKSJoWtgJMQWSVjUK5XtxD74oB2+/OXTC/f4PiX8y6IU6pFMDNBM9QTStCBYVDm8rXzArmdzl+tdyF98mz9nBDVQDQTKkGfvA6S4iVMtKqruOnnwpOa6pFnry8HjUBSQVmpU0QbP3LrNZQ4eK184ITu3UbPy1RrPlaU9QfawAbkoIBd3UvXHvv0fn7Iy7kTzp9ssuEW/0fP6hPeCoVlgUb39E0VDyDXsx8PeX2xZldrxTOnpE/Zdb6p3PuVMlYpRUE1xtojMeOvZzTu/e359263PAsnZo//dnGc72v2xk+6wUTVgmAxgSVunnpzceFMyZPOnOi69TLKz9cmzeYCWCMB5xN0ECgCbfXWra6yJRXNTc4cUEktmjNfDbqsJFKLSiTtRdtNmOYZU3dLT2sSycvtFgc/SrYMNeYxnEzMIk8n4WpaqcjlmELCgpMK1eXhsORkijna0ziogIkWVTi7iqOK42LlSErW/vE3SfaM5J19e3bR5YiZaC0KOaKFbPGilwgV9LdbSp+VSdF+pYyyFVpKq7o1w9wTp2uZ9hiiUMcMrKSrUtLstSUy9SUFC3pNaBxINBpaI2l3CUjDbMZIYjjetSwnOO4amc14HTVHKfTGXUliNTjCA/ocQgpvV4vJpdV9DIagdOpWaMjWiNiGEVRhF6DICiCpAjIZLxx4DD2dBSVJ0ScJAmC4Ns0gWloQ2oQ1C83prpOjqKhXgAAAABJRU5ErkJggg=="},6178:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACxFBMVEX2AABM/7v4jQBe/z9M/8JM/6z4nQJL/7RQ/2FR/1H3qQP4hABM/5Fh/VZ4/CzdFCPzSwL4lgH3cQD2FgBL/ONM/89M/51L/n9N/nhS/UZ9+UK7vSS05B/kqgz5sgP2NQA9vvVD0OpL/shM/6Zl16FM/25b/Gll/kmK/SqW9Cp//Smv1SXd2RLUwBDXlg/11gznGgf5vwXzewP4ogH1JAH2ZQD1WwD3QAA4tfw+yftL7dxL/NZU/JZN/4R98nSK32esSV6S0FCN+UZR/z5+3jl7+zeO+jWftTRb/yya7Suq/CapxSTPQiC1yRzC6xvEehnH4BjM0hbCkRXVsRPhJRLYcQ3ptgnfMAnsjwXxigXwYwPxMgMrT/5D3vc/wehM39uBRLdN1Zha+I571oaEeYRW/oGmGoCTL35/4HWyL2eB+mZd/WB36F/tAFxT8Vhl8Fd+6U2cfkhc50fANENa9EDPHz6F8Dyf5Dmq1zla/zZv5ja2xi7HYCuD6iij5ii9WyX0ACSw8yPOxB7OsBrP7hnoBxbchhLYzBDy3Q/j0A7fsQzjnAztCAr1zAn0vAfvbQMnPf4wcv0nHf0yDf0ylPc2buVK5M5Cws14K8dWV8RDz7tP87dg17d1WrdenrZJu61W7KZsjZN3y4Rz7n9o/Xxj8nzgA3uJhndX/3JU6nHHEnCUeG2F12h3tWGVz15w+1yPv1unfVt21Fier1idaU7zAEKX5UGsyEFx+z622j67Pj2RwjiKuTdk/zC1qzCpuCjPNyiX4iS2eSDTfRnk6hbFpBXLbxTZuQ/Zpg7kvw3gSg3mkgnqYQfpeQZI8PFRRORVW9VIedN3FsxX9cpgc8VlIbNhvbFF47BN54lxpolwuohSu4Vh2HByvXCiZm6Vn2Z5k2atcU+AnU6aqjyI4Tpm8TST1jOiiyefrx/EwxbsPAX4eAAG0MznAAADV0lEQVQ4y9WM03pjYRiF/2QnaezGbOxJGtS2bWtqT227Y9u2bdu25yZmt0/P5gpmHX3P975rgf8s8zJTo7ovJyT083/+6E6d9w+/bpy6xA3ojT+1xUdzEtsWHTunMObqCSnjQkF8Ye7zD+sl8j7fbafuXEudJVQHY4Z/Sdy/Vl67WSppAJRVEnmOu3R/YmjSTJ9ut2XG3jrevNlN4rZs8cJVsD1/YZabu5t0izHh+m0biEOm+/OHQ+Q5kmz3RUuWPJsRFme5Zy/3eFJ6JXbvEBDQzpeOavz9S+XS+9mLspZ1RH3asDSHieAJ+CdOEA4eAWPpvn0tvtO0FP5GT08P6YqCXI8XS5f76NLoQiHVMVQIkIldab6FVLqwfGd5+ZpctsKDuXr12n6a8cJNi9UqPgLo+lv3KkPvjfFlCJ/w4jUrNhW9euvVrO+vCQwyjqdRk4FoBJNxPjlyK1aBbdFhN74fBBMXD5J4sW3nWklfb2aKgXkESRXb/dFsHLdLEBFJOba9qud2nCaxM+wcLmgoNBWMXrU7qO1eUCuEq67ednbwWFVVT1QXpA0LU5NrrjWeBZW1DvGdkwrsrjfr/fJed4AFfqcHk8683He4NoRM7msMBCs3MRjCX53v1u1+vGCP325KUHV9HWztWFdWVBNpIbeCnkNWRobdlnSxrKTkwUrKxAVtWzfYnpdXVtJwJfquTg2SzmQC67T4d/L3uqeP9tQ1UDqiKEc/73g4f187f5werQWXL1mBg5EcFA417lKqw+qPTlA+cnFQfj5XSWwnGDTgW5wYZFBDZd6BXK2Cw4XqTxdx2EQEC8d2YfqIXEcBedhmizbuRSGIUC+Oo8CSDx329vbGVmBdmJ4Boht6EBFn0GtCDjg7F3cOB+OgQHV+MK+CSIppQrNUMb0kFSjYqeJBEA7tpRNGVijVWtWGgAgSujh+jBdMVnmhUMAFgUDIiGxOyBRepB+4OhBQGREjaNHF8JQcosyTyQQIJ9hwQrNJwQOTJpNpxGSaNIvwrinNBShnZ5fZBfhwgkO6QcDjJ6fMeJHZjHHFYwzHt7JkaDRAoZzgAZayyUD/Q0DSaBgYumKQGAISkxIvCG8CLDSLyDkQbsDDHxqNbrekp1mmM+5a0pEEAhLOX/KQAIVSSOoqAAAAAElFTkSuQmCC"},904:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACtVBMVEUHAH8VBPMUAup4/5dx/6Cn/WATAeMWAvsdMPN0/5wRAtVm+LRu/6V//o5+BgIXDPsVAu8PA8le+sNg9L8JA5chSPsYFPpJ5OgXHNpU6tVU29ERBc8NAbZs/qqI84eH/4We/WscLvsgPPo7vfgylfgoYvhAy/I1l/IZHvEnW+syd+oYG+pFz+c6oeQdLeJL3uBP3NhY+MxW5ssYK8Jm6rIMA68NEowbJ/kqcPgfOfExgO88rOwbKew6lug/qOUlN+VI1ONGx+M0a+EtX+ETBN5LztoaKdofRco4bcgQC8VVo8Fe378OAr1ctKwLAah16KAKA59nnp0IAY19fnDm6yKAHhUznfwkVvo1ovktf/kwh/cmWvNC0/I5q/Izh+8/v+4zj+0iSOw+supK3uQlWOMXEOMoUOAZGeBLvd4UDN5Q8d1Cl9sfQNpEq9dHutZM0tQxctQTEdJBhdEcLMtJkchUuMVc7cRLnsNIgMJPqsBavb4eRLoPDbpFe7Vo/7Bt8qgOEKR31J0eR514+poSIJF82omO+X5zaHKc9W2GuGldN2aRklay/lXJ8TyyoDqDSDKcUCLTkBWwXA+HEgOjBwCSBAAvjvwaHPspavhG2+06pew5huQ1Wd8pVts1gNowaNhQtM9OoMs7kctW0sVc1sIQEMAxd7sXKrpg6rlv+KZrzqRutKJwxZsTFZYhQpGN6XmV/XaFo3RuY1++/UlqI0etv0SHXD+TXTRzMTTMwy2pgCzb6SrFkByDLBz01Q+vKwetEQBDw+lV+tNLoc84Wcw9gMNdrrQcObQlWa8THK9HZK5Zlq1jo6t24JpJipo0ZZV565N8xo84RH0eIHxfTHOX0G6Jjm56cVyAfll5b1Wlv1JwSFC51kmBPEi/30aNezySNht2EhqVIhmuRg72xgmVGQHHHABfgbLgAAADTklEQVQ4y9XL03pcYQCF4X9rOnvUsW17Gtt2bce2k8ZGbdu2bdu4ju706VmvoOv0/Rb4zzaFe7Ct7U5cXMHikl1tK6b847tjjfMXhaxRR9ZVzpgnClpc/zfJ/HuP4y+zzAq41dnxqAc7EFZRt2FJwYo/kizlTvgue83TA/kpSuwZeH4S29eNHa4gxxMFF1BYkpZ64/pNDzCsfyA7+x1Rv84+34/1K+vK427fZQF1dO7NpeT5rRimxAYu/RgkgreXzmNH5PIntZ76aiHQwTcS/eaWlSXu7z6iHMj+dOjQ447jSkVz6KyNJZspNY0geEliWGSFBOYvTaPTFcpO72E5cpxeGbWMYrE0SMtTACk4cEl1ipRiKRRvuf6wk+NSKOTyjjCSfbOdkp7uawSUAGNpUXxp8GJqe2VgUnt3T1/PPq9ZFVa81hYrFPo8AOLDrI2eku0ilyjS7Ez7PMZgnMmIWecp0sx22OypqWDSalKyL3lbMztP4D/NPz5n/NeVlScWzLAb9BpHYeymFuCnYkmlUd55+tl5TvGO+2Pj40Rgtmo1mlXTiwus28CWQmmqMMglSmp9efrc/l7GxVNDjK+N3ozE/LlT5wQsEoCRo9xM4QJtyuD3kS9Zpy/nbBWJjzG+nXo1ONy33CQJ0oOVXdzMnQ0JB3uHR0fPjvxk3NOGvmdcvnBhePRjualh1gyQU5MO0hNSW3aXdZ38kJU1dLH3TM6xjKyz5zI2LF0mWbAKvDBzgY/rsQXqI3a4tZrlbxhjRx3h89LSBGJOFClgJljI82UmJMfLOAKBtootmL18qI/DpqJUBxuhV0OQH5hKlrBMsbU4TrXqHGzXtaldtRwORxTjRBT0fIjsB/x5ZNVMQxGCJM0nz8nTr53Zagh1NoVPC93bvJCnc0aAPe7wIKt1EW2PyRJV7DZMj5CHrAnfW6U2Lpwz/aoXxwGCo6iMynYZJkOQSq3ihWz15+kiTdNsYneVjK6gA5SGojhKY8es400mtprPnzxpEsTkm5PaEQTBEYCgCB1BURotJpgEMQmcGESMvH47VSajARwnVEYV28iUaBLMhCeMCcNMEgwZ1bq5IaCJ1kR1RwSSIUKZMIUVnSuUsBJ2lubCJBIMw9G/AXbV85RKPEmDAAAAAElFTkSuQmCC"},6446:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACmlBMVEUAAAAINTUMP0FvA+9mDOcGLCtNLscEIiIBCQwIMTFqCepDO7w9QbU7Rq8BEhIFJycBGBhiE+FVJNIQTU9aHdZTJ84QLkI2T6cmVoYmT4MHLy8HEBpdGdwtU5UaWWoTN00QQkwOREYONkF3APKSEck3SacyU6UtWZ4rQoO+QnQbOF8VUFwTS1YUP1MUJUULPTwJOjkLMDgOJTj//v358/V6C9yIDtORDNFNLb9FMrE/O7BDJKI8YpszRpsyQpYvTpUoYJEmZo0qVo0kZIcpO3wfUXQlQHQcS2oXVGEaQWETVFgOSkn88ezt4+tqD992DtZYHM795MqMGceXFMWCGcKhksFINL9ORLRgKLJJRLFQH6v2zag8QKc9NqYwT5s4MpdRc5SuMZEtPo46NIwqMnkeZXfaf3UrJnUkOHMpLm4YXWQWS1wRRk8ZFUV/Aezk4up4COX+8OTj1OSHBOONBtr969fNwNRpHM/hw865vch2IsPAqr/XsL6qdb5sL75ENblNN7ZqF7aGd7XotLSXlbLkrbChIbB0KK5dJK5HJK1sdKxHL6i/caWWhKSVip7Se5lIapdGSJZSMZZSYJMwSpAuN4o9LYU0JYQoXoAjXHkeQWwiNmwZMFLTV0gfDDYNFSsOChf15enXzunSueHBid7Iz9ltJNWyqtTJptSZWdRrRcxjHcvk0se8wcKos8FsGsCWqb9eMb+aYb1qW7z827nUmrZRJrTGpK2RRq2rfKlmOamxVahySKivnZ1ghZxuFZxINppRJZmmRJg/J5ivVpVqX5Q6Q5SQcZFgO5E8WY6+aoyAe4aiOYNBGYPHWYIgb34iTXiDTXQtVHFxaW2FLG2SMGwkYGrDSWolImgsDmCWRTzdZDRvNTFgLTDQUIJRAAADMklEQVQ4y9WQ07IdURRFd+/2aZ8+tu1r27HNa8S2bdu2bdvGv6STt1S+ILNqrVW1xnia4D8LxZt3d8R0rvZwzZcOM/UPT7mgkbVWtJVfyjF4iaJw7G+FskMdrKoZkDH35W3PkujIOZVJu/kPEUXqN2+xb5rbb8O6TM8usOejp1+vrF4joy17FABIkjTHHIHA3Z4ez/DPwQ+K/TMY7JnVM3O5bkdqNwmqTfTmUHtpvx5ZEyYM3/n9myL82BnMGt81o8vSVOy+DtiQljzZsHHknSWZo8YPD77o2PV18aIebqmgKlRfj29qAs5kXqh8qIDA0HEUHZPZq1vXjMmLui6tTOIQkmJsAMAdgWTeAFGAg/sMGjw5gyDGuKdNO72D1m234xTFbwZCrRMf3GRy1Fi65BiJLj3OzTx6TBOI2HO4EToXIqZAXEbIUKo5myCI8krm0IFOaen7zucW6Ib69bNHQJ4HUKZFnhwqqRn2ja1hWOeJAy90mvppi9Pg8zOFrmYzkGtJUdzezafXM/37Zy/rNLF797Ent3jL/P6y4hz7oHqw9pHII0MIpu+NK9NXPFmQNu7I/vTRw84+XP/UUGKN5LKg8S1FwYhh3Yr5jVNWXR7YeU3fvr3TTkx//GzG1UFVeJEPjH3OU4JS9/sZC+e/auyefqskf2rawNWrpyy8qQuTttdg9DAeUAJvptcsuH5vZe9J404d7Hx43soHF5e9q3EJbWXgzFYK8FRyhNGn7z/H4M/vnb53Hsf5Zs1i+2ia8agB5FfzgBSbJDXHlRBaRp8/aaZWrcE0rFrlXg4RGZTIJFnlykNRjdfGqrVE8ar1WrVSCoOOQgvjDhk0VLfXGktzUZQwRqyMniu7Zh3CWFhboWTRt1YwHNAS3BCOYzFNJdw2mygt9i62NrCSNgILrMVeDaYCqEqlwjRqbSlMwHC4trVo7dbWivJttoI+hFZC3W6AYSpMUdRsUbXTWVcny3V1MI4gMNANQ1FUhQJllIthWK4DTySccZhIQIgoiW7MtkgYBlAUU2LJLnQIOE7TNPInNIKbENhWYdwAJEyyEJwxGlc+NCKQuMIEATfRNI6blP0L9GTBDZUfhasAAAAASUVORK5CYII="},6206:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACoFBMVEUAAABDFU9MDU88iDVgXqZAH1QeAx0KBg8/kDhra7pVVJI8JlkxKVM3IU5DPXZIJ2E6gTRRUoU9NmxHMGg2MF9AEkk9ezsTEhj59O5ob6ZYaYlJQX1OWXxIRXlUf3JNdWhAMWdKbGRIblxGelZHF1U6IFJcwFEsIUETBxdoca1gaJ1idJlaYpdaaY9Yb4ZMSoRXd31OZXZEN29LOWdUlGIzLFlGZ1ZQp0dJB0ZEjEVGnT8zFD86Cz8vDjYfESv++/nj4NpydKBdXqBVWYxRTYxxjYFYaIFPaXNReHFMYW5IUWxJQ2ZDO2Y+L2BCRF1GI1xKg1lSmFdTq1JKh1FcxU9Yy01ABz8qIDooEjUpBSju7OL039He2tHDw8aqprNna67MyaZjaaVbWZ7srJpcaJXZx5JecI5XX41vcYdSWoZhdYBSYoBehH1MT3lSbnhMO3RFQ3FPcHBITWZOfGRNZ2OTvV9FU11HXlpFcVVASFFLGVHNxE9Rkk9Ef01DdE1GEE1Z00xZuEs3F0dAgEQpKkFAlTkzBzQ4ejMhIy8zAS0PAA7S0cnGvsFubr+Qkq51c67Eu6Cyrp+YnJmtnInhs4iMsYaekIONg31PS3RLVXN1pGpPW2ZUg2Jfh15bol1YfFtMRVvEr1pSi1rG0FlXsldEM1c8QFa/1FRmtlSr1VCiylCFzk9rxU5OoEpNl0gyHUZhXy8ZDCIkOSEZIx/m5+Z4eNB6fLv1xLq1sLjYwK/vuK2op6h/hqDY1J+ux5TNt5KDgpFpZ5GdsYfBv4Xlm4KUmH2epHp3dXWRkGyhsWa2umXNuWOtmWB6Z2Cmoluex1qAglmCklhrrldHgFbaeVY4LlWptVS7oVOQyVKOpUxnzktBXUuApUU3X0E4TkCVkj8EsvciAAADTklEQVQ4y9WMU58bYRhH35nMTDixbTtpsuHa9m5ta217a9u2bdv2V+m0v/aqn6D/m+finPOA/2xkskg03M9g8LkK/rCI/A83Geg0yxyXN6dOxbEvTGH2/1H+Hga9tXBxXt3e9m/Hjf68emWtPl/0m4yMjP7iLaxAsX/eVuPR00D09ajfWLZ3C2s/YYyCwcEErD9/U86O7vLuF3sOfCLskwcOfS7vNrrxd8PxCsAUwI378uf4y8uNZR/b2n78EtoOl/WUlBQHKk1NrcAF79SqObVbVLvLeoyHDzWcOXO69MjBcEiu8O3MjTS1ABas2d/YVKGn+/zhcLDndV0w2H7kmDYXqkAL41hlJ4BZC6BAZ3WCPtOdqSkume8uCW7fvH2foNXHipLJ2HcQ9dKjngJBoa+jvWaBsvjgutvr0pULuPRsCwfFe09FgIEPVfAqc7WZmpm1i2y7r4sTE5PSPXLTLOoyaQ7djAEGXzCCVTeWNkskabK05LGX394dN0FBYyHLqI5NeJ4ZqLmD1VjuVuskqm2mTblcPG3atAsTaFSESp2KZOPWAjA3A8NMdqdzfvqrlU+3XUkcP3mJOGn2/AezM1IRhEc9Bz68JAOGd2r9oxm7xq9ZuTYpOfn8RPGlVQ+f37g/U1GFUMG4DWZyVTwuejZ5xrU9T8aJryIrJiSu3fV48ow1Jm9cRgNnk83AXIWdqry1uqFh/cQlSRfHj126fP37Ozc35qGxRVPBRJoZYKMmWtoUyVx3ClWySjx2tcQ2ZdsOq0dXIODRwCQmBmLVLcJmiyWlRmuZtGLpPXdAFyrKyDoe1uJ6NUDUsZgM/UIh6aa4HIEaJ7JhtjJLZXM6KcFj2QaWGrhkPC6Hk02haGnqFKlVQktPnbewU8qUlxZJmQqPAzRrrPbp06V9usWoL6M+FXFsnpUm7cvysux2ZPqbUAhQSCSSUKfSpNJRlMvkMuVzXbLFBYtk8oVZytKB8ABgs9kkEntI5ZjFHEOMz+ePYeAoRN+oC1EGiJj4QKFQhthsoScfQvV0A8NgYDAgYrwcTVGfcAgQOYkt7Micw0uAYZgAKI7jJ3pPdMH6Qq6CIwcdQmGRah6Hhwq6IKg3Gk2AoUisKhKBYCLoggU/Aep54rZnCVVxAAAAAElFTkSuQmCC"},2489:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACqVBMVEUAAAAqpB4sqh1iAphdApsmeMorlrA1E69zAJMupVguqkhEBaVVAZ0voZwskJstpjIjYq8lAq81AqZpAJcunJIup2Irpj0pBz0rqBooWbg7JbFHHqZNAqFOEKBYApVsApMwpI9lAYxAYXlgAHkso3NWAW46zCAxuBsFDBMsL74mObkrWK08PKUya5g9QZVfEY9NBIw9F4k5SIhpAIUupIMrlX9LBHoskHY1dGk2hWcvm0490DAtrCkroygJGBojZ9DLyMYqjcQylb/JxL4jJL4neLcxb7O+wbEnP6kxoacocqcohqZMH5sxVZopb5UseY0qiYsrgXqqsHkzBm4mL2wqHGssnGorn0Z30TUOAyk92yNE1CNA4SIvshwRAhsdRckjPckaEMAsFrmqurYwm7QyRrKAma61u6gpMag6I6YnaKJVGaIofKFcnpertJU4SZQqkJDIlIwxWYsuLIMvdX97lnhBBXEtqW49Hm5MrWosgmXTbmEsn2BLAV4oB1dDAFYwA0inuzY1sDU2wTIhAywytyV56SE81yGj8h+P8B8NKhwnbLzJw7WZm7FEirA5HJ3OrpxChZo4O5p1o5ZGNpaRppNCI5KhspBSI45BOIsrl4h4r4RdfXzSh3swZHpDS3QqjmeCt2WwtWTPlGQ7VWR2k2IpmGBjvF85Yl41lluHo1oYMFcbJVJErk00fk1Dwkw5pkQ8vT6PtzwRMTA0uSs1xCpV5yJedhoXPhrc7RgjWcUkar9JdrtCZ7qWrbR/gJ9DbpsZIpUlEZQdVI5HQ4xJlIUjZ4F1aXxWP3qdhHhIHHjCx3EsVHG8xWu/q2efn2dIlGZhYWYjU2A3clsbVFYrGlBkoU0WOUm9yD4gazuRmTjZTzi5mTWZ3itduiYfACVwuB/I8RyPrxtXnw92AAADUUlEQVQ4y9WN45IcYRSGv+me6Z7uYcY2MrZnbVvZ7Mb22nZs27Zt28aVpDeVf7mCPFXnVJ163rcO+M8YWxE7cvp9ce3NmbffnI4d+48/4uKweWyzZEFLgThLl5V++G+k+m+9WO6Qz5wV6mV9jKkMZ9f57HBt7B+jbe8j9NhX2ZoTB2eHDJUXQOyPSiwy2KuRPiES34Ha4xEeRnNqQuPHjR8YGvpGdM4PDRNHJOAqPvLWA0ywcs9GlI2NG2cYHLh48ddo4OfwoKH3DCtYUhx0gInwgyBq0WgKDkYMhoHh8pGRCz3nKo2sXOsat9up2QOkyuA69zY1WbYGr6oyGiJl/f0nz51pscNqGq2h/dExwJXmKA4c01Pldb68e/jZxsazxpPH8Q0Kx51sp1DYeQCoJ6OOuu0OuVXQU2DR9UT279zfjOWg60IM2waXs6MJ0MfQPfYmd4uvUbdgAe/EziXx8VPu5s8uyUtANtmWC7sAbQys1es1OKZiTDNPuJq29XPriqXJl2alJibw8lw1QoBO8uj19jAydaqKxyudt6R1a+uipWKEkpAQRwnUMreB/Fx9uytF5/U2v3v+6cX1+Bnr5ydNucHfsnKumJIiYWaAL3v7qm/NXBw69ax7fn3h7hnLVIzpSYvW7j1VeIiZXpSKgEVbKqqLOoqELwufPv76YUXSlbjEa/G7u7sLdz1sMndMiwNpyyqAsKirqyR1dXl5/er5M6ZPSVs7r7581zzrKrnfSgHTxRWgs6/EJkYQlfdy4tTNSWmbGQzk6NGMQNlGpVQMEk2d1X7tdlYZg0HRtTGQjPWH+BgexVX8qDEoI6OAItE2pGe/hiCcOZHH5+so91fyMcy7yQsZ+3Nl0slggkky2cIugKB9qWiKCsmIa86c7RMsNGWy8LnJZh8ThPcxM5lMXkzZKrk9ULqYknWcPXEhq00yZ24KJSscjQIIIpFiBFgbm0aXocmTJrHzJpjS3VZzbqCUL6gyVgHCi4jBFmYmczhjRuHQZHSYlhOOQpBIJALEhkQkgvzlSrKMQ6PR6RwOFybDc2p24KwYEiDk6I8dtllqqpJLGDKZTnYqFFQqd45kmsUGBCSWoDTfIqWrqTCs0GqVZLLf729wKrhUAi78Gx5i6x+jvtqtAAAAAElFTkSuQmCC"},9662:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAxlBMVEX3APz4cYj4V6D3A+T5dYT3BuH3Bej4XZv3Ra/4U6P3D9v4T6f4ZJT3GtP3OLv3AO73A/P3QbX3Kcj4a433C973FNn3JMv4fH33McL4YZf4Z5H5h3P3S6v4eYD3H9D3M7/3P7T9+B73Pbf5g3f6olv3Et/3Gtz3Hdj3Ftb3LMT5kGz84C/6m2T6rVX80Dz98yH3Cu33Hc/5i3D6mGj7sk77uk37xkH82DT97CX6plv7vkb+/hz3D+f3I9X3L8n5bJL6omL85yoC7QzSAAACeUlEQVQ4y9WSVY4cMRRFbZfLDMWMzdzT3AOh/W8qnslXlBXkyHpXeud+WJbBf0YQvMwX35ZL3UXfly/BP34uhEGs6HqKTEPDbPl3JVgKkUYdyuOwqtWpoUXSvXwZa798sWKxYmhafwMfeV1N65zp4qtBrLXL1WTCz+fz5XWG3UrOZuf6PEVpt/iwIPP8SaaHqnbsrtfcFdB+VudtC/liwQRY+2upJ5OBl9NpvZttlovvcDNtIYuyvvcGA1JfZj0jvojits2nucIt3mBeJEQIYlMOvJVJGmQ9ISmXMK9UnrcYnjyxTr0gsAaQLvVk4aVRDLkpcb3b73BstEYoTIVP5iBZ+SSbF5Sqsi8QfhvfxwfmbMEa6So2cAXPWjLEFUV91NPn+HyOt8LoQTLERE+A7qy166qRklJa4nE8HsfbIIemMSHS0gDe2GDOSqrazf2qLu/b++G4VTEs5RCyE0fghoNg0Rm6375tL2/bZ1mqn+/b62Z/eOURCSUYpwEghHz8ODwe1/vx+CNEt/df97fH4zXNSGTALxqAgLivgHazy+71sN0fnrd6M7vnJhMkm4CfJgAWzAcjOaVhw/fj8YKQhBjRKvK0ATKzgNgCVu5lSoUkOswqd8cYVbiVia9BqAmJ0gbjmK+RUmW4oapSFFGctyzRGvSZ7kzIMS4nmlHJDWQMxShiMG6iAnGgKGecI1itRYRoGPKcFQiqTjQslBWEAEMMYaxUKPzklHXRIPus6KOI0VLBNm8B/IPiLEsderUSSeL7wiiIPwH4M6EDac9PnHRDeL7v6wmN3Rr8sTFlmhDP4X/iwh1xWpsBfNqSG518OWJdEIdrONz8DcHFP4n/xvdzAAAAAElFTkSuQmCC"},8774:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAb1BMVEUigWcvjmdrsmhkr2hfrGhTpWg7lmc0kmdDm2d8u2lKn2gqiWeAvmksi2c4k2dZqGhxtWgmhmeNxWl1uGh5umhPomiFwWio02mZy2iy2Gj3/Gni8WnR6Gmhz2jy+Wnr9mnZ7GnI42nC4Gm83Wn+/2rMqbF9AAACIUlEQVQ4y9VRC67cIAwEG4MhBEiA/Pa/2/ufsc4+qVLVE3QUJbZnYsNY/WeYpkEna+VhTsP0D6+dC0jBBsCQgTj9LZmSc44tLpXKDDZD0Hb4Mj+9ppByLYTzbJVe5rLMS7Zh+AqGYUqpn9y8rWuUEq43SRZM1o2DsloTW6pSmbd9X0QA6zovMXrjUnaKdTC2EyGI4rZuyXHb5tgycwgjdeW04ZBH7bjGKKNLjHGLGLSUhsGhGlPXGSU0YExdCkRBszpxGsUaUqOVHkHy2jCAn2/7LdZuLRpKWg9a/NGD1QEEIaB/H7+OZzTkcjZIbpq+gmmgWhADB3gcj8fxDiFRziIQK5IVnks2BgTLcb/fjzeZnnMnTKYrzNOk88ltr72svy6v6/1SqgdDRNag+og1znbYn+/L7X15AJyqz7ZfV8MjGXXM02n36K/X5/66H63j59fj9Xk+d5nOQV1gUtMoY1BsvK3Xy359fGQrr6WzG7mrtSsld6FwnrJnsx/3DY3xHrHIyrsyfI4I5zUJChq4rqWUVlE8N1on1e0wsJM/qmEsALQBFFGjX2LWyarAyXYyMUK3JL17o4wVOdeamdEoACMmYSvsGIHILMSmgXVZ4uK98t63WgqQ09oKyATLgTkjQJXFKt+8oAESO0FKyWmBC+Bj9N8OP0HDNEpd2PMlsAS1taaE8q1VIDuMovgDSZzlTqq2WkHman3Sw6kaBZL+fH4Dv4kk7qhIC7sAAAAASUVORK5CYII="},7990:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAe1BMVEUYAP4YEPMYGe8idcUeXdAcU9UYBPkbRdsYI+sfZM0YKucaOeAgacocTNcYCvYYH+wke8IdWNImiLwZM+QiccchbcgaPd4aQdwlf8Awpa4yr6o2vaMojblI+Ycun7E7zptG9Iork7csmrM+2JdA4JNC5ZFE7Y1K/4U4xJ9hpzG+AAACLUlEQVQ4y9WSR7LcMAwFGQAxZ+UwOfj+JzTm12xsn8C9UYlsvYIAsP+MrosiaZ20bS3x7p97IcRYlLMOYESjrP5T6TQJzcI8KF+9RXBcx2/wx+xcUoMPUKtlfK6+1jkkxxkRydBJTbDX/bYsko5wOe37XiFpQaVYzier1VD3Wm/rOpMA66nOOUsUKXDmuEM9KVVMnettuSbR+mvNfWjWOa5GJjhaFzgXdsh5rrOnT6+5OB6FiJ0ojOtJhBKjQEDsZ+9nSu81F9QLKm9kUVOG48n2soxG1tN6ysOodSkqCYphPPFouQMwZnQgt+N93HMJIgQEJagH4pMUVe+huObM6/J8HZsb04SBBBeZttQJ5xERKCUfx+VybAqnECZVNI6shK4TwdDd/ms1p/fjfL88/SANKhU0AtsyCXaC9bE9btvjZYxZ3o/tup4XbFwhO2rX8Rj5cL7f11+XS69gez9/bfSWbGwje5qOdZxWAU7L7bScn+v5te3X5TyPVnA7sWUkgQk1YjFGYVmPyw0AZQbwjeuRoe1oou7zm8p4QDgvnmocipcZhdBM6cibQCkHbOAp5GqM9wAg5xyE1sxZTcMkwUxaAeIkVYABWugHtA6QGVNCQZDeiQagFGblSm9sCkGhl5JJoh+8UbST1tqm0NEitBbA+D7PmYQffAlWpPRZ+0QqFzRZmeVPwpeiaWu+cEJPMPR9/xUGUJra+YUCfh7WTYr1VIHBSdMRETv+F78BzJImqyQDEWEAAAAASUVORK5CYII="},1972:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM1IiBoZWlnaHQ9IjE0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBmaWxsPSIjZmZmIj48cmVjdCB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTIwOzExMDsxMDA7OTA7ODA7NzA7NjA7NTA7NDA7MTQwOzEyMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ5IiBiZWdpbj0iMC41cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSIzMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMjA7MTEwOzEwMDs5MDs4MDs3MDs2MDs1MDs0MDsxNDA7MTIwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InkiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSI2MCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjE0MCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjkwIiB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjEyMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTA7MTU7MjA7MjU7MzA7MzU7NDA7NDU7NTA7MDsxMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48L3JlY3Q+PC9zdmc+"},5738:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAAAqCAMAAACN4OndAAAAqFBMVEUAAADKysrLy8vT09PKysrKysrKysrPz8/KysrKysrMzMzLy8vLy8vKysrKysrJycnJycnKysrKysrLy8vKysrLy8vIyMjMzMzKysrMzMzLy8vMzMzLy8vLy8vKysrLy8vKysrHx8fLy8vKysrLy8vLy8vKysrJycnKysrKysrKysrLy8vKysrLy8vKysrKysrNzc3Pz8/R0dHU1NTW1tbT09PS0tLY2NiaiJAkAAAAL3RSTlMA9aMJ8eTaFuvfNxPGaYYiHfpCW/wnEHIwm0ltj3l+isMF1c2plrJGuDxPvVRfK+IvMiAAAATbSURBVFjDtdiLkpowFAbgg4iCgOIN76ugonhLUNT3f7NycmpbQrDu0P6zM0g2JB8hYBAwO41lsZrwYfTm59Ehl4ND0eFtZFWnVZ4X29XMT6O5kMuGY65r+JYqWGr1snRfPYzS5NOko1xP9pphbqdvquaclWSQzIDSWrY/zbKX66lVp7bgeyqIZ3LcDcNc57MxVI2bYFM8nL5LR1Kp49Ko96B6jpyGXXubE/i+rx9INcTPn6kCWwodp8vFgXTzPphItyQDhuFrcLKEYq+7dpz18iNVcxI28jnucMyPUmk4yY//klTrfkn2pNoDxzDa4zyJ8BY7rl6J+iqVv+eiPoU+D2KwWaGYHf0/VRp1tAB1/JBh0h1g3zRWmrNaOXOA6MapaewhcRWqoUmnXKN0hWUCdPt2IypdMYx2gd85E6oLJTmk1C6dSSzu1wbtTG/iyEbDojYChUrUNztAmV9RVYMaqpIaUDyDYcbwK8FRlDzmZaoVjW87dw96gFlQ274diDpPr0xlvFRfOdUEKLYlq1o/L6AO6sRXhqmPAdx9NI9J5R+j/eGnCme9UKXlKu+tym/Iqjk9rLa/Wkkx919ImlU8wqq3xGmRSn/iF8TnqlY/y8mWVFvvnBXviiqPiWivdjp0iQcvVb9LqiadwC/VnV2/obIO9ewRY4xllcu7XbYvqqKE7spArfJX1M0CKqrwsHqvoLpne0XVmBOiB2rV6SGeo45eUTVVqw63bM+RVcGKYx41KFHt+iJjqKhq4UabyqoeqkJZFZt1jKYrVFIqqYwLbronWTVOsz1TUkn5j6oObgZnSTXppDiESlV/JjJUqVxaNnlVVb6JG1dW+U+srVQNmEisUq05o2n6L1R8VFDhJlWpmoziqVSbROydK6vw9PhXQaXhYbZCNWbkAJWqja1gcxVVdoSqrazSTax9Uaj6ooQ7StXhRkuPoKpqwlFTUIW4MDjpRdVSlCQbpWrIheqoV1Q1vxJ8igeSKsAL+zgrVHtqqK9UeSajc62qOj/weuiyas+xgaCg8ull8NlUqmz6L29WVR3uuFiUVbDhuFtUXWg0NFCqgs3PbiqqvDFO0K4vq+aocqCg6g1o5siq3Ky7LquqmilWKKi+cGsWVbNETPb22/UVNyqqOnDDCmNZNcJtvVlQbbhQnUpUnTr1o5er2h+pTJ6VHxaS6jxA1bCgMl/LcrUKaD/pK1R0ptxyXcFjT/uNaoXPgIWkopcTbSerLjdREDbLVDSWfKNSeQMa6ITW/g0oV4nvrmttJKlaYoVzllVf9OIcQZnqRBUMlQpO1j19JQmH71Qzq9GwCipvhS/zrqwyuCgYlaogoUscA0wStsqrwPZ+x4d3Kt3OUnhegY/F8mzvEIoPy1V7qrLABQSPJJWUctW33gcXhAqhXHW608QKUFX7i2pWSZX/Erwv3qg84WCmDSvOt/F71eQvqrZS1bRyqgsZHr8NrYGs0iPqaQoOT9rlqloYhhZd7fSiVPmjL40WRjnVYRHlf5OZGlYWYyOOn2yzmNSuKVSUmfWzksUf51jjWSz9xu+SyrklScIx1wiUqo72EKikl1NNbvT1svKhmOnzkYUznv09JgEUYxlmL24YWRzdNEwXctmuHcp+pCtVr2XRugV5Ff2WtbVBkdg0XmlQu1J+ABT1EjoBoYiGAAAAAElFTkSuQmCC"},6559:()=>{},2634:()=>{}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";n.d(o,{default:()=>rd});var e={};n.r(e),n.d(e,{SpeedUnit:()=>Le});var t={};n.r(t),n.d(t,{BlendModes:()=>he,CalibrationTypes:()=>Ce,ContourType:()=>xe,DynamicOperatorType:()=>Ee,Events:()=>ne,GeometryType:()=>ye,ImageQualityStatus:()=>Pe,InterpolationType:()=>le,MetadataModules:()=>Oe,OrientationAxis:()=>fe,RequestType:()=>ae,SharedArrayBufferModes:()=>pe,VOILUTFunctionType:()=>Te,VideoEnums:()=>e,ViewportStatus:()=>Me,ViewportType:()=>re});var a={};n.r(a),n.d(a,{hasBrowserEnv:()=>bl,hasStandardBrowserEnv:()=>xl,hasStandardBrowserWebWorkerEnv:()=>Tl,origin:()=>Il});var i=n(9584),r=n.n(i),s=n(5485),l=n.n(s);function c(){return(0,s.env)().isMobile||(0,s.env)().isIpad||(0,s.env)().isAndroid?"mobile":"PC"}var u=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};function d(e,t="x"){e.addEventListener("mousewheel",(n=>{e["x"===t?"scrollLeft":"scrollTop"]+=150*(n.deltaY>0?1:-1)}))}function h(e){return(null===structuredClone||void 0===structuredClone?void 0:structuredClone(e))||JSON.parse(JSON.stringify(e))}function m(e,t,n){return Math.min(Math.max(e,t),n)}function f(e,t,n="active"){e.forEach((e=>{e.classList.toggle(n,e==t)}))}function g(e,t=0,n={behavior:"smooth",inline:"center",block:"center"}){return u(this,void 0,void 0,(function*(){yield E(t),null==e||e.scrollIntoView(n)}))}function p(e){return e.charAt(0).toUpperCase()+e.slice(1)}function v(e,t,n="-"){const o=e.split(n);return o[o.length-1]=t,o.join(n)}function y(e,t){return u(this,void 0,void 0,(function*(){try{const n=e.getContext("2d",{willReadFrequently:!0});return e.height=t.height,e.width=t.width,null==n||n.putImageData(t,0,0),Promise.resolve(function(e){const t=e.split(",")[1],n=atob(t),o=n.length,a=new ArrayBuffer(o),i=new Uint8Array(a);for(let e=0;e<o;e++)i[e]=n.charCodeAt(e);return a}(e.toDataURL()))}catch(e){return Promise.reject(e)}}))}function b(e){return e.split("?")[0]}function x(e,t){if(t<=0||t>100)throw new Error("Percentage must be between 0 and 100.");const n=e.length,o=Math.floor(n*(t/100)),a=[];for(let t=0;t<o;t++){const i=Math.floor(t*(n/o));a.push(e[i])}return a}function w(e,t=1){t-=1;for(let n of[...Array.from((null==e?void 0:e.childNodes)||[])])t&&(null==n?void 0:n.childNodes)&&w(n,t),null==n||n.remove(),n=void 0}function T(e,t){const n=document.createElement("a");n.style.display="none",n.setAttribute("target","_blank"),t&&n.setAttribute("download",t),n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function I(e,t){const n=new Date(e.replace(/-/g,"/")),o={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in o)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[e]:("00"+o[e]).substr((""+o[e]).length)));return t}function E(e=0){return new Promise((t=>setTimeout(t,e)))}const S=JSON.parse('{"version":"1.5.0.240909"}');n(1278);let C=JSON.parse(localStorage.getItem("language"))||navigator.language||navigator.userLanguage||"en";const A=n.g.webDicomViewLocal,M=(e=C)=>{if(!A[e]){const t=e.split("-")[0];return A[t]?(P(t,!1),!0):(console.warn(`${e} ${k("toast.languagePackageNoInit","default")}`),P(A.default.language,!1),!1)}return!0},D=()=>C,P=(e,t=!0)=>{if(e){if(!A[e]){if(M(e))return;throw new Error(`Language '${e}' is not supported. supported language: ${Object.keys(A)}`)}C=e,t&&localStorage.setItem("language",JSON.stringify(e))}},L=e=>{try{if(JSON.parse(localStorage.getItem("language")))return;P(e,!1)}catch(e){console.error(e)}},k=(e,t)=>{try{const n=function(e,t){return t.split(".").reduce(((e,t)=>e[t]),e)}(A[t||C].locale,e);if(!n)throw new Error("unknown translate key");return n}catch(t){return console.warn(`Translation for '${e}' not found in '${C}' language.`,"error:",t),e}};M();const O={getLanguage:D,setLanguage:P,setLanguageDefault:L,translate:k};var R,N,_;const U=c(),B="mobile"===U,V=((null===(N=null===(R=window.performance)||void 0===R?void 0:R.memory)||void 0===N?void 0:N.jsHeapSizeLimit)||0)/1024/1024/1024,{version:F}=S,H={instanceOptions:{},env:U,isMobile:B,webDicomView:"",sharedArrayBuffer:void 0,forceIM:!0,imageTypeDefault:void 0,_imageType:JSON.parse(localStorage.getItem("imageType")),get imageType(){var e;return null!==(e=this._imageType)&&void 0!==e?e:this.imageTypeDefault},set imageType(e){this._imageType=e,localStorage.setItem("imageType",JSON.stringify(e))},tackSynchronizerTypeDefault:"stackIndexSynchronizer",_tackSynchronizerType:JSON.parse(localStorage.getItem("tackSynchronizerType")),get tackSynchronizerType(){return this._tackSynchronizerType||this.tackSynchronizerTypeDefault},set tackSynchronizerType(e){this._tackSynchronizerType=e,localStorage.setItem("tackSynchronizerType",JSON.stringify(e))},_imageCacheTypeDefault:null!==(_=JSON.parse(localStorage.getItem("imageCacheTypeDefault")))&&void 0!==_?_:0,get imageCacheTypeDefault(){return this._imageCacheTypeDefault},set imageCacheTypeDefault(e){this._imageCacheTypeDefault=e,localStorage.setItem("imageCacheTypeDefault",JSON.stringify(e))},logoURL:n(5738),cavanAroundInfo:!0,minRenderCountMPR3D:10,preload:{scroll:!0,scrollNum:9,seriesFetchNum:0,fullLoad:!1},AI:{resultURL:void 0,parseSuccess:!1,active:!1,jumpFirstAI:!1,getParseHandler:void 0},toolsBar:{navigationBottomLayout:!0,seriesBarVisibility:!0,VRTVisibility:!0,MPRVisibility:!0,MPRFusionVisibility:!0,MPRFusion2Visibility:!1,AIVisibility:!0,enhanceVisibility:!1,aboutUsVisibility:!0,fastImageModeVisibility:void 0,fasModeVisibility:!0,staModeVisibility:!0,majModeVisibility:!1,imageModeVisibility:!0,languageVisibility:!1,customMenu:{main:void 0,MPR:void 0,VRT:void 0}},toolsOptions:{toolColor:"#FF7F0E",zoomTool:{minScale:.1,maxScale:100}},DBCacheImages:{dbName:"ClearDicomView",version:Number(null==F?void 0:F.replace(/[^\d]/g,"").slice(-6)),storeName:"cornerstoneStore",temporaryEnable:!1,enableDefault:!0,_enable:JSON.parse(localStorage.getItem("enableDBCacheImages")),get enable(){var e;return null!==(e=this._enable)&&void 0!==e?e:this.enableDefault},set enable(e){this._enable=e,localStorage.setItem("enableDBCacheImages",JSON.stringify(e))}},aboutUs:{imgURl:void 0,description:()=>k("aboutUs.description"),originVersion:F,version:null==F?void 0:F.replace("_","."),copyright:()=>k("aboutUs.copyright"),tel:()=>k("aboutUs.tel")},toolsData:{main:void 0,MPR:void 0,VRT:void 0},tipRecord:{GPUBenchmarksSuccess:!1,sharedArrayBufferGuide:!1},systemInfo:{jsHeapSizeLimit:V,performanceLevel:function(e){return e>=3.8?2:e>=2?1.5:e?1:.6}(V)},fusionData:{PT:[],CT:[]}},j=H,{DBCacheImages:z,systemInfo:q}=j,{cachedImages:W,setMaximumSizeBytes:G,getCacheInfo:Y,removeImageLoadObject:Z}=i.imageCache;let K;const X=e=>{e!==i.EVENTS.IMAGE_CACHE_FULL&&(K=e)},J=(e,t,n=300)=>{try{if("MPR"===K)return X(e),!1;if(X(e),t||0===j.imageCacheTypeDefault&&j.DBCacheImages.enable&&W.length>n){0;const e=(0,i.getEnabledElements)().map((({image:e})=>null==e?void 0:e.imageId)),t=W.map((({imageId:e})=>e)),n=t.length,o=.15*n,a=n-o;return t.forEach(((t,n)=>{n<=o||n>=a||e.includes(t)||Z(t)})),!0}return!1}catch(e){return console.error(e),!1}};(()=>{const e=(e=>{let t=1073741824;return e>=2?t:e>=1.5?858993459.2:e>=1?644245094.4:e<1?429496729.6:void 0})(q.performanceLevel)*(z.enable?.8:1);G(e)})();const Q=(0,s.debounce)(J,300,{leading:!1,trailing:!0});var $,ee=n(5915),te=n.n(ee);!function(e){e.ERROR_EVENT="CORNERSTONE_ERROR",e.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",e.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",e.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",e.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",e.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",e.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",e.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",e.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",e.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",e.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",e.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",e.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",e.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",e.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",e.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",e.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",e.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",e.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",e.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",e.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",e.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",e.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",e.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",e.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",e.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",e.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",e.STACK_VIEWPORT_NEW_STACK="CORNERSTONE_STACK_VIEWPORT_NEW_STACK",e.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",e.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",e.VOLUME_SCROLL_OUT_OF_BOUNDS="VOLUME_SCROLL_OUT_OF_BOUNDS",e.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",e.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",e.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",e.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED"}($||($={}));const ne=$;var oe;!function(e){e.Interaction="interaction",e.Thumbnail="thumbnail",e.Prefetch="prefetch",e.Compute="compute"}(oe||(oe={}));const ae=oe;var ie;!function(e){e.STACK="stack",e.ORTHOGRAPHIC="orthographic",e.PERSPECTIVE="perspective",e.VOLUME_3D="volume3d",e.VIDEO="video",e.WholeSlide="wholeSlide"}(ie||(ie={}));const re=ie;var se;!function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e[e.FAST_LINEAR=2]="FAST_LINEAR"}(se||(se={}));const le=se;var ce={BlendMode:{COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5},FilterMode:{OFF:0,NORMALIZED:1,RAW:2}};const{BlendMode:ue}=ce;var de;!function(e){e[e.COMPOSITE=0]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=1]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=2]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=3]="AVERAGE_INTENSITY_BLEND"}(de||(de={}));const he=de;var me;!function(e){e.AXIAL="axial",e.CORONAL="coronal",e.SAGITTAL="sagittal",e.ACQUISITION="acquisition"}(me||(me={}));const fe=me;var ge;!function(e){e.TRUE="true",e.FALSE="false",e.AUTO="auto"}(ge||(ge={}));const pe=ge;var ve;!function(e){e.CONTOUR="contour",e.SURFACE="Surface"}(ve||(ve={}));const ye=ve;var be;!function(e){e.CLOSED_PLANAR="CLOSED_PLANAR",e.OPEN_PLANAR="OPEN_PLANAR"}(be||(be={}));const xe=be;var we;!function(e){e.LINEAR="LINEAR",e.SAMPLED_SIGMOID="SIGMOID"}(we||(we={}));const Te=we;var Ie;!function(e){e.SUM="SUM",e.AVERAGE="AVERAGE",e.SUBTRACT="SUBTRACT"}(Ie||(Ie={}));const Ee=Ie;var Se;!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated"}(Se||(Se={}));const Ce=Se;var Ae;!function(e){e.NO_DATA="noData",e.LOADING="loading",e.PRE_RENDER="preRender",e.RESIZE="resize",e.RENDERED="rendered"}(Ae||(Ae={}));const Me=Ae;var De;!function(e){e[e.FAR_REPLICATE=1]="FAR_REPLICATE",e[e.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",e[e.SUBRESOLUTION=6]="SUBRESOLUTION",e[e.LOSSY=7]="LOSSY",e[e.FULL_RESOLUTION=8]="FULL_RESOLUTION"}(De||(De={}));const Pe=De;var Le,ke;!function(e){e.FRAME="f",e.SECOND="s"}(Le||(Le={})),function(e){e.CALIBRATION="calibrationModule",e.CINE="cineModule",e.GENERAL_IMAGE="generalImageModule",e.GENERAL_SERIES="generalSeriesModule",e.GENERAL_STUDY="generalStudyModule",e.IMAGE_PIXEL="imagePixelModule",e.IMAGE_PLANE="imagePlaneModule",e.IMAGE_URL="imageUrlModule",e.MODALITY_LUT="modalityLutModule",e.MULTIFRAME="multiframeModule",e.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",e.OVERLAY_PLANE="overlayPlaneModule",e.PATIENT="patientModule",e.PATIENT_STUDY="patientStudyModule",e.PET_IMAGE="petImageModule",e.PET_ISOTOPE="petIsotopeModule",e.PET_SERIES="petSeriesModule",e.SOP_COMMON="sopCommonModule",e.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",e.VOI_LUT="voiLutModule",e.WADO_WEB_CLIENT="wadoWebClient"}(ke||(ke={}));const Oe=ke;"function"==typeof SuppressedError&&SuppressedError;const Re="undefined"==typeof window;(()=>{if(Re)return;const{userAgent:e,platform:t,maxTouchPoints:n}=window.navigator,o=/(iphone|ipod|ipad)/i.test(e),a="iPad"===t||"MacIntel"===t&&n>0&&!window.MSStream;/android/i.test(e),/Version\/12.+Safari/.test(e),/Firefox/.test(e)})();Error;pe.TRUE;const Ne={gpuTier:void 0,detectGPUConfig:{},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useNorm16Texture:!1,strictZSpacingForVolumeViewport:!0},enableCacheOptimization:!0,peerImport:e=>null};function _e(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}var Ue=n(6439),Be=n(1948),Ve=n.n(Be);const{getOptions:Fe}=Be.internal;let He="";function je(e){const t=function(e,t){let n;return Number.isInteger(e)&&Number.isInteger(t)&&(e>=0?t<=255?n=Uint8Array:t<=65535&&(n=Uint16Array):e>=-128&&t<=127?n=Int8Array:e>=-32768&&t<=32767&&(n=Int16Array)),n||Float32Array}(e.smallestPixelValue,e.largestPixelValue);if(!t)throw new Error("Could not apply a typed array to the pixel data");{const n=new t(e.pixelData);e.pixelData=n}}const ze=function(e,t,n={}){let o=!0;if(void 0!==n.useRGBA&&(o=n.useRGBA),n.preScale={enabled:!(!n.preScale||void 0===n.preScale.enabled)&&n.preScale.enabled},!t)return Promise.reject(new Error("The file does not contain image data."));const a=document.createElement("canvas");if(n.preScale.enabled){const t=function(e,t){const n=e.get("modalityLutModule",t)||{},o=e.get("generalSeriesModule",t)||{},{modality:a}=o,i={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:a},r=e.get("scalingModule",t)||{};return Object.assign(Object.assign({},i),"PT"===a&&{suvbw:r.suvbw})}(i.metaData,e);t&&(n.preScale=Object.assign(Object.assign({},n.preScale),{scalingParameters:t}))}const{decodeConfig:r}=Fe(),s=i.metaData.get("_grayImageModule",e),l=(new Date).getTime(),c=Be.webWorkerManager.addTask("encryptionPngDecode",{buffer:t,info:Object.assign(Object.assign({},s),{isIM:!0})}).promise,{use16BitDataType:u}=r;return new Promise(((r,s)=>{c.then((function({data:c,isPng:d,width:h,height:m}){const f=(new Date).getTime(),g=(0,Be.getImageFrame)(e),p=(0,Be.isColorImage)(g.photometricInterpretation);let v=!1;if(d||(g.pixelData=c,g.pixelDataLength=c.length),g.decodeTimeInMS=f-l,p||d){return void(0,Ue.arrayBufferToImage)(t).then((t=>{r((0,Ue.createImage)(t,e,n))}),s)}const y=i.metaData.get("imagePlaneModule",e)||{},b=i.metaData.get("voiLutModule",e)||{},x=i.metaData.get("modalityLutModule",e)||{},w=i.metaData.get("sopCommonModule",e)||{};if(n.targetBuffer){let e,t,{offset:o=0,length:a}=n.targetBuffer;const{arrayBuffer:i,type:r}=n.targetBuffer,{imageFrameLength:s}=g,{rescaleIntercept:l}=x;switch(a=null!=a?a:s-o,r){case"Uint8Array":e=Uint8Array;break;case u&&"Uint16Array":e=Uint16Array;break;case u&&"Int16Array":e=Int16Array;break;case"Float32Array":e=Float32Array;break;default:throw new Error("target array for image does not have a valid type.")}if(a!==g.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");if(t=i?new e(i,o,a):new e(g.pixelData),a!==g.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");if(l)for(let e=0;e<t.length;e++)t[e]=t[e]+l;g.pixelData=t,v=!0}const T=(0,Be.getMinMax)(g.pixelData);g.smallestPixelValue=T.min,g.largestPixelValue=T.max,v||je(g);const{columns:I,rows:E}=g;h===I&&m===E||(g.columns=h,g.rows=m,console.warn("Image row col is inconsistent",{columns:I,rows:E,width:h,height:m}));const S={imageId:e,color:p,columnPixelSpacing:y.columnPixelSpacing,columns:g.columns,height:g.rows,preScale:g.preScale,intercept:x.rescaleIntercept?x.rescaleIntercept:0,slope:x.rescaleSlope?x.rescaleSlope:1,invert:"MONOCHROME1"===g.photometricInterpretation,minPixelValue:g.smallestPixelValue,maxPixelValue:g.largestPixelValue,rowPixelSpacing:y.rowPixelSpacing,rows:g.rows,sizeInBytes:g.pixelData.byteLength,width:g.columns,windowCenter:b.windowCenter?b.windowCenter[0]:void 0,windowWidth:b.windowWidth?b.windowWidth[0]:void 0,voiLUTFunction:b.voiLUTFunction?b.voiLUTFunction:void 0,decodeTimeInMS:g.decodeTimeInMS,floatPixelData:void 0,imageFrame:g,rgba:p&&o,getPixelData:()=>g.pixelData,getCanvas:void 0,numComps:void 0};var C;if(S.color&&(S.getCanvas=function(){if(He===e)return a;a.height=S.rows,a.width=S.columns;return a.getContext("2d",{willReadFrequently:!0}).putImageData(g.imageData,0,0),He=e,a}),x.modalityLUTSequence&&x.modalityLUTSequence.length>0&&("1.2.840.10008.5.1.4.1.1.12.1"!==(C=w.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==C)&&(S.modalityLUT=x.modalityLUTSequence[0]),b.voiLUTSequence&&b.voiLUTSequence.length>0&&(S.voiLUT=b.voiLUTSequence[0]),S.color&&(S.windowWidth=255,S.windowCenter=127),void 0===S.windowCenter||void 0===S.windowWidth){const e=S.maxPixelValue*S.slope+S.intercept,t=S.minPixelValue*S.slope+S.intercept;S.windowWidth=e-t,S.windowCenter=(e+t)/2}r(S)}),s)}))},{getOptions:qe}=Be.internal,We=(e,t,n={},o={})=>{const a=new XMLHttpRequest,r=qe(),s=e=>{if("function"==typeof r.errorInterceptor){const t=new Error("request failed");t.request=e,t.response=e.response,t.status=e.status,r.errorInterceptor(t)}},l=new Promise(((l,c)=>{r.open(a,e,n,o),a.responseType="arraybuffer";const u=r.beforeSend(a,t,n,o),d=Object.assign({},n,u);Object.keys(d).forEach((function(t){null!==d[t]&&("Accept"===t&&-1!==e.indexOf("accept=")||a.setRequestHeader(t,d[t]))})),o.deferred={resolve:l,reject:c},o.url=e,o.imageId=t,a.onloadstart=function(n){r.onloadstart&&r.onloadstart(n,o);const a={url:e,imageId:t};(0,i.triggerEvent)(i.events,"cornerstoneimageloadstart",a)},a.onloadend=function(n){r.onloadend&&r.onloadend(n,o);const a={url:e,imageId:t};(0,i.triggerEvent)(i.events,"cornerstoneimageloadend",a)},a.onreadystatechange=function(e){r.onreadystatechange?r.onreadystatechange(e,o):4===a.readyState&&(200===a.status?r.beforeProcessing(a).then(l).catch((()=>{s(a),c(a)})):(s(a),c(a)))},a.onprogress=function(n){const a=n.loaded;let s,l;n.lengthComputable&&(s=n.total,l=Math.round(a/s*100)),r.onprogress&&r.onprogress(n,o);const c={url:e,imageId:t,loaded:a,total:s,percentComplete:l};(0,i.triggerEvent)(i.events,i.EVENTS.IMAGE_LOAD_PROGRESS,c)},a.onerror=function(){s(a),c(a)},a.onabort=function(){s(a),c(a)},a.send()}));return l.xhr=a,l},{parseImageId:Ge}=Be.wadouri,Ye=(e,t={})=>{const n=Ge(e),o=We(n.url,e),a=(new Date).getTime();return{promise:new Promise(((n,i)=>{o.then((o=>{try{const r=(new Date).getTime();ze(e,o,t).then((t=>{const o=(new Date).getTime();t.sharedCacheKey=e,t.loadTimeInMS=r-a,t.totalTimeInMS=o-a,n(t)}),i)}catch(e){i({error:e,buffer:o})}}),i)})),cancelFn:()=>{o.xhr.abort()}}},Ze=e=>{e.registerImageLoader("IM",Ye)},Ke=document.createElement("canvas");let Xe;const Je=function(e,t,n={}){const o=e.naturalHeight,a=e.naturalWidth;function i(n){const o=function(){let n;Xe===t?n=Ke.getContext("2d",{willReadFrequently:!0}):(Ke.height=e.naturalHeight,Ke.width=e.naturalWidth,n=Ke.getContext("2d",{willReadFrequently:!0}),n.drawImage(e,0,0),Xe=t);return n.getImageData(0,0,e.naturalWidth,e.naturalHeight)}();let a;return a=(null==n?void 0:n.arrayBuffer)?new Uint8Array(n.arrayBuffer,n.offset,n.length):new Uint8Array(o.width*o.height*3),function(e,t){for(let n=0,o=0;n<e.data.length;n+=4,o+=3)t[o]=e.data[n],t[o+1]=e.data[n+1],t[o+2]=e.data[n+2]}(o,a),a}return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,getPixelData:i,getCanvas:function(){return Xe===t||(Ke.height=e.naturalHeight,Ke.width=e.naturalWidth,Ke.getContext("2d",{willReadFrequently:!0}).drawImage(e,0,0),Xe=t),Ke},getImage:()=>e,rows:o,columns:a,height:o,width:a,color:!0,rgba:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:o*a*3,pixelData:(null==n?void 0:n.targetBuffer)?i(n.targetBuffer):void 0}},{parseImageId:Qe}=Be.wadouri,$e=(e,t={})=>{const n=Qe(e),o=We(n.url,e),a=(new Date).getTime();return{promise:new Promise(((n,i)=>{o.then((o=>{try{const r=(0,Ue.arrayBufferToImage)(o),s=(new Date).getTime();r.then((o=>{const i=Je(o,e,t),r=(new Date).getTime();o.sharedCacheKey=e,o.loadTimeInMS=s-a,o.totalTimeInMS=r-a,n(i)}),i)}catch(e){i({error:e,response:o})}}),i)})),cancelFn:()=>{o.xhr.abort()}}},et=e=>{e.registerImageLoader("web",$e)},tt=new s.ComputeStore,nt=["fasM","staM","majM"],ot=()=>{const{speed:e,standard:t,major:n}=k("tools.modes");return[e,t,n]},at=()=>tt.get(ot);function it(e,t){const n=e.includes("isMprDcm=1")?nt[2]:nt[t+1],o=e.replace(/((http|https):\/\/[^/]*)|(wadouri:|IM:)|([&?](sign|Signature|Token|Authorization|AccessKeySecret|X-Subject-Token|X-Date|Date|Expires|t|X-Expires-At|isDcm|dicomInfo|isMprDcm|x-oss-process|imageMogr2\/format\/jpeg)[^&^?]*)/gi,"");return{imageTypeEN:n,indexedDBKeyPeel:o,indexedDBKey:`${n}:${o}`}}var rt=n(346),st=n.n(rt);let lt=new Map;const ct=(e,t,...n)=>{const o=lt.get(e);return o?o(...n):(lt.set(e,t),t(...n))},ut=(e,t,n="error",o=[void 0,void 0],a,...i)=>{var r;const l=500*t.length+2e3;ct(e,(0,s.throttle)((()=>{var e;null==a||a(...i),st()[n]({title:t,timeout:null!==(e=o[1])&&void 0!==e?e:l})}),null!==(r=o[0])&&void 0!==r?r:l,{trailing:!1}))};var dt=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const{dbName:ht,storeName:mt,version:ft}=j.DBCacheImages,gt=new s.IndexedDB(ht,mt,ft),pt=new s.Once((e=>{let t=[];const n=(e,t)=>{for(const n of e.slice(0,t))gt.dispatch("delete",{},n)};gt.dispatch("count",{mode:"readonly"}).then((o=>{if(o>5e3){const a=Math.ceil(o*String.prototype.slice.call(o,0,1)*.1);gt.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.upperBound(`${e}_0`)).then((o=>{t=o,o.length>=a?n(t,a):gt.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.lowerBound(`${e}_z`)).then((e=>{t=[...t,...e],n(t,a)}))}))}o>15e3&&(console.info("Too many data stores, indexedDB is cleaning up"),gt.dispatch("clear"))}))}));dt(void 0,void 0,void 0,(function*(){const e=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB;try{const t=yield null==e?void 0:e.databases();for(const{name:n,version:o}of t)if(n===ht&&o!==ft){e.deleteDatabase(n),console.info("indexedDB is upgraded to version "+ft);break}}catch(e){console.error(e)}finally{dt(void 0,void 0,void 0,(function*(){yield gt.open(),pt.run("com")}))}}));const vt=gt;var yt=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};r()._renderWebImage=i.renderWebImage,r().renderWebImage=void 0,r().Enums=t,r().canRenderFloatTextures=function(){return!_e()};const bt=XMLHttpRequest.prototype,xt=bt.open;bt.open=function(e,t,n,o,a){this._url=t,xt.apply(this,[e,t,n,o,a])};const wt=function(){let e=!0;try{new OffscreenCanvas(0,0)}catch(t){e=!1}return e}(),Tt=.5*(navigator.hardwareConcurrency||1)-(j.systemInfo.performanceLevel<1?1:0),It=e=>yt(void 0,void 0,void 0,(function*(){const{DBCacheImages:t,imageType:n}=j,{indexedDBKey:o}=it(e,n);if(t.enable||t.temporaryEnable){yield vt.open();const e=yield vt.dispatch("get",{mode:"readonly"},o);if(e)return e;throw{indexedDBKey:o}}throw{indexedDBKey:o}})),Et=e=>{e.addEventListener("error",(e=>{const{acquisitionFailed:t,networkDis:n}=k("toast.loadAndCacheImage");ut("xhrError",navigator.onLine?t:n),console.error(e)})),e.addEventListener("timeout",(()=>{const{acquisitionFailed:e}=k("toast.loadAndCacheImage");ut("xhrTimeout",e)}))};Ue.external.cornerstone=r(),Be.external.cornerstone=r(),Be.external.dicomParser=te(),Ze(r()),et(r()),(0,Ue.configure)({beforeSend:e=>yt(void 0,void 0,void 0,(function*(){e._send=e.send,e.send=()=>{},e.timeout=3e4;try{const t=yield It(e._url);Object.defineProperty(e,"response",{writable:!0}),e.response=t,e.onload(e),e=void 0}catch(t){e._onload=e.onload,e.onload=()=>{},Et(e),e.addEventListener("load",(()=>yt(void 0,void 0,void 0,(function*(){const n=r().metaData.get("_grayImageModule",e._url);let o=!1,a=!0;if(n){const{photometricInterpretation:t,bitsAllocated:r,blocks:l}=n;if(o=l>1,o&&(a=!1,ut("multiImage",k("toast.lazyHandleToast.notSupportedBlocks"))),!o&&(s=r,!((i=t)?(0,Be.isColorImage)(i):s<=8))){wt||ut("isOffscreenCanvasSupported",k("toast.lazyHandleToast.versionLow"));let{data:t,isImageData:o}=yield Be.webWorkerManager.addTask("encryptionPngDecode",{buffer:e.response,info:Object.assign({},n)}).promise;Object.defineProperty(e,"response",{writable:!0}),o&&(t=yield y(document.createElement("canvas"),t)),e.response=t}}var i,s;e._onload(e);const{indexedDBKey:l}=t;try{a&&l&&e.response.byteLength&&vt.dispatch("put",{},e.response,l)}catch(e){console.error(e)}e=void 0})))),e._send()}}))}),(0,Be.configure)({useWebWorkers:!0,strict:!1,decodeConfig:{convertFloatPixelDataToInt:!1,use16BitDataType:!0},beforeSend:(e,t,n,o)=>yt(void 0,void 0,void 0,(function*(){e._send=e.send,e.send=()=>{},e.timeout=3e4;try{const t=yield It(e._url);o.deferred.resolve(t),e=void 0}catch(t){Et(e),e.addEventListener("load",(()=>{try{const{indexedDBKey:n}=t;n&&e.response.byteLength&&vt.dispatch("put",{},e.response,n)}catch(e){console.error(e)}e=void 0})),e._send()}}))}),Be.webWorkerManager.initialize({maxWebWorkers:Math.max(Math.floor(Tt),1),startWebWorkersOnDemand:!0,taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!0,strict:!1,loadCodecsOnStartup:!0},decodingoldPlatformImages:{}},webWorkerTaskPaths:["./encryptionPngDecode.worker.js"]});var St=n(730),Ct=n.n(St),At=n(7869),Mt=n.n(At),Dt=n(281);const Pt=new Map,Lt={},kt={store:{},IDArr:void 0,add:function(e,t){this.store[e]||(this.store[e]=[]),this.store[e].push(Number(t))},sort:function(){this.IDArr=[];for(const e in this.store)this.IDArr.push(e),this.store[e].sort(((e,t)=>e-t))},getFirstIndex:function(e){var t;return null===(t=this.store[e])||void 0===t?void 0:t[0]},getSeriesIDArr:function(){if(!this.IDArr){this.IDArr=[];for(const e in this.store)this.IDArr.push(e)}return this.IDArr}};let Ot;const Rt=(e,t)=>{Ot=Ot||k("AI"),Lt[t]=!0;for(const t of e){const{nodule_bbox:e,seriesID:n,nodule_type:o,nodule_bm_prob:a}=t;for(const i in e){const r=Number(i)-1,{position:s,size:l}=e[i],c=`${n}?index=${r}`,u=Pt.get(c),d=s.x-l.w,h=s.y-l.h,m=s.x+l.w,f=s.y+l.h,g=Object.assign(Object.assign({},t),{noduleType:Nt(o),noduleBmProbCN:_t(a),instanceNumber:Number(i),visible:!0,active:!1,invalidated:!0,handles:{start:{x:d,y:h,movesIndependently:!0,hasBoundingBox:!0},end:{x:m,y:f,movesIndependently:!0,hasBoundingBox:!0},textBox:{x:m,y:f,active:!1,hasMoved:!0,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}});g.textBoxContent=Ut(g),Pt.set(c,[...u||[],g]),kt.add(n,r)}}kt.sort()};function Nt(e){const t={Calcification:Ot.calcification,Ground_Glass:Ot.groundGlass,Part_Solid:Ot.partSolid,Solid:Ot.solid,pleural:Ot.pleural};let n=[];for(const o in e){const a={name:o,value:e[o],typeText:t[o]};n.push(a)}return n.sort(((e,t)=>t.value-e.value)),n[0].typeText}function _t(e){return e<.25?Ot.benign:e<.5?Ot.borderlineBenign:e<.75?Ot.borderlineMalignant:e<1?Ot.malignant:void 0}function Ut(e){const{nodule_no:t,nodule_volume:n,nodule_maxHU:o,nodule_minHU:a,nodule_cross:[{major_diameter_length_mm:i,minor_diameter_length_mm:r}],noduleType:s,noduleBmProbCN:l}=e;return[`${Ot.number}:N${t}`,`${Ot.longShortMeridian}: ${i.toFixed(2)}*${r.toFixed(2)}mm`,`${Ot.volume}: ${n.toFixed(2)}mm${String.fromCharCode(179)}`,`Min: ${a}HU  Max: ${o}HU`,`${Ot.type}: ${s}  ${Ot.lesions}: ${l}`]}const Bt=(0,Dt.importInternal)("base/BaseAnnotationTool"),Vt=(0,Dt.importInternal)("drawing/getNewContext"),Ft=(0,Dt.importInternal)("drawing/draw"),Ht=(0,Dt.importInternal)("drawing/drawRect"),jt=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),zt=(0,Dt.importInternal)("util/getLogger"),qt=zt?zt("tools:annotation:LengthTool"):console;const Wt=(0,Dt.importInternal)("drawing/path");function Gt(e,t,n,o,a,r="pixel",s){"pixel"===r&&(n=(0,i.pixelToCanvas)(t,n)),Wt(e,a,(e=>{e.arc(n.x,n.y,o,0,2*Math.PI)})),s&&Wt(e,a,(e=>{e.font=`${o}px lighter`,e.fillStyle="#ceff82";const t=e.measureText(s).width>>1;e.fillText(s,n.x-t,n.y+t)}))}const Yt=(0,Dt.importInternal)("base/BaseAnnotationTool"),{circleRoiCursor:Zt}=(0,Dt.importInternal)("tools/cursors"),Kt=(0,Dt.importInternal)("drawing/getNewContext"),Xt=(0,Dt.importInternal)("drawing/draw"),Jt=(0,Dt.importInternal)("drawing/setShadow"),Qt=(0,Dt.importInternal)("util/calculateSUV"),{calculateEllipseStatistics:$t}=(0,Dt.importInternal)("util/ellipseUtils"),en=(0,Dt.importInternal)("util/getROITextBoxCoords"),tn=(0,Dt.importInternal)("util/throttle"),nn=(0,Dt.importInternal)("util/getPixelSpacing");class on extends Yt{constructor(e={}){const{markerFlag:t="L"}=e;super(e,{name:"Ann"+t,supportedInteractionTypes:["Mouse","Touch"],svgCursor:Zt,configuration:{renderDashed:!1,hideHandlesIfMoving:!0,type:t}}),this.markerFlag=t,this.throttledUpdateCachedStats=tn(this.updateCachedStats,0)}createNewMeasurement(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error(`required eventData not supplied to tool ${this.name}'s createNewMeasurement`)}pointNearTool(e,t,n,o){const a=t&&t.handles&&t.handles.start&&t.handles.end,i=Dt.external.cornerstoneMath.point.distance;if(a||console.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!a||!1===t.visible)return!1;const r="mouse"===o?15:25,s=Dt.external.cornerstone.pixelToCanvas(e,t.handles.start),l=Dt.external.cornerstone.pixelToCanvas(e,t.handles.end),c=i(s,n),u=i(s,l);return c>u-r/2&&c<u+r/2}updateCachedStats(e,t,n){const o=(Dt.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,a=nn(e),i=function(e,t,n,o,a){const i=function(e,t){const{distance:n}=Mt().point,o=n(e,t);return{left:Math.floor(Math.min(e.x-o,t.x)),top:Math.floor(Math.min(e.y-o,t.y)),width:2*o,height:2*o}}(n.start,n.end),r=Dt.external.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),s=$t(r,i);let l;"PT"===o&&(l={mean:Qt(e,s.mean,!0)||0,stdDev:Qt(e,s.stdDev,!0)||0});const c=Math.PI*(i.width*(a.colPixelSpacing||1)/2)*(i.height*(a.rowPixelSpacing||1)/2);return{area:c||0,count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:l}}(e,t,n.handles,o,a);n.cachedStats=i,n.invalidated=!1}renderToolData(e){const t=(0,Dt.getToolState)(e.currentTarget,this.name);if(!t)return;const n=Dt.external.cornerstoneMath.point.distance,o=e.detail,{image:a,element:i,canvasContext:r}=o,{renderDashed:s}=this.configuration,l=Kt(r.canvas),c=(0,Dt.getModule)("globalConfiguration").configuration.lineDash;Xt(l,(e=>{for(let r=0;r<t.data.length;r++){const l=t.data[r];if(!1===l.visible)continue;const u=Dt.toolColors.getColorIfActive(l)||"#ff8000";Jt(e,this.configuration);const d=Dt.external.cornerstone.pixelToCanvas(i,l.handles.start),h=Dt.external.cornerstone.pixelToCanvas(i,l.handles.end),m=n(d,h),f={color:u,lineDash:void 0};if(s&&(f.lineDash=c),Gt(e,i,l.handles.start,m,f,"pixel",this.markerFlag),!0===l.invalidated&&(l.cachedStats?this.throttledUpdateCachedStats(a,i,l):this.updateCachedStats(a,i,l)),!l.handles.textBox.hasMoved){const e=en(o.viewport,l.handles);Object.assign(l.handles.textBox,e)}}}))}}const an=(0,Dt.importInternal)("base/BaseAnnotationTool"),rn=(0,Dt.importInternal)("drawing/getNewContext"),sn=(0,Dt.importInternal)("drawing/draw"),ln=(0,Dt.importInternal)("drawing/setShadow"),cn=(0,Dt.importInternal)("drawing/drawLine"),un=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),dn=(0,Dt.importInternal)("drawing/drawHandles"),hn=(0,Dt.importInternal)("util/lineSegDistance"),mn=(0,Dt.importInternal)("util/getLogger"),fn=(0,Dt.importInternal)("util/throttle"),gn=(0,Dt.importInternal)("util/getPixelSpacing"),pn=mn?mn("tools:annotation:LengthTool"):console,{bidirectionalCursor:vn}=(0,Dt.importInternal)("tools/cursors");st().settings({timeout:5e3});const yn=e=>{try{const t=e.parentElement.parentElement,n=document.querySelector(".iziToast-overlay"),o=j.webDicomView.globalContainer;n.setAttribute("style",`\n        // display: block;\n        position: absolute;\n        top: 0;\n        // left: 0;\n        // right: 0;\n        bottom: 0;\n        // z-index: 997;\n        ${n.getAttribute("style")}\n    \t`);for(const e of[t,n])"BODY"===e.parentElement.tagName&&o.appendChild(e)}catch(e){console.error(e)}};function bn(e,t,n,o="",a){return new Promise((i=>{const{enter:r,OK:l,cancel:c}=k("toast.prompt");st().question(Object.assign({class:j.isMobile?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:e,position:"center",icon:"",progressBar:!1,inputs:[[`<input type="text" value='${o}' maxLength=32 placeholder='${r}' >`,"keyup",function(e,t,n,o){""!==n.value&&(n.placeholder=r)},!0]],buttons:[[`<button class='confirm' >${l}</button>`,function(e,o,a,r,l){const{value:c}=l[0];if((e=>{let n=!0;switch((0,s.dataType)(t)){case"RegExp":n=t.test(e);break;case"function":n=t(e);break;default:console.error("verification is necessary, interceptor required for RegExp or Function")}return n})(c))return e.destroy(),void i(c);l[0].value="",l[0].placeholder=n},!1],[`<button class='cancel' >${c}</button>`,function(e,t,n,o){e.hide({},t,"cancel")},!1]],onOpening:(e,t)=>{yn(t)},onClosing:function(e,t,n){"confirm"!==n&&i(null)}},a))}))}var xn=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const wn=(0,Dt.importInternal)("base/BaseAnnotationTool"),Tn=(0,Dt.importInternal)("manipulators/moveNewHandle"),In=(0,Dt.importInternal)("util/pointInsideBoundingBox"),En=(0,Dt.importInternal)("util/lineSegDistance"),Sn=(0,Dt.importInternal)("util/triggerEvent"),Cn=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),An=(0,Dt.importInternal)("drawing/getNewContext"),Mn=(0,Dt.importInternal)("drawing/draw"),Dn=(0,Dt.importInternal)("drawing/setShadow"),Pn=(0,Dt.importInternal)("drawing/drawArrow"),Ln=(0,Dt.importInternal)("drawing/drawHandles"),kn=(0,Dt.importInternal)("drawing/textBoxWidth"),{arrowAnnotateCursor:On}=(0,Dt.importInternal)("tools/cursors");function Rn(e){return xn(this,void 0,void 0,(function*(){e(yield bn(k("toast.prompt.enterComment")))}))}function Nn(e,t,n){return xn(this,void 0,void 0,(function*(){n(yield bn(k("toast.prompt.changeComment")))}))}var _n=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const Un=(0,Dt.importInternal)("base/BaseAnnotationTool"),Bn=(0,Dt.importInternal)("manipulators/moveHandle"),Vn=(0,Dt.importInternal)("util/pointInsideBoundingBox"),Fn=(0,Dt.importInternal)("util/triggerEvent"),Hn=(0,Dt.importInternal)("util/getLogger"),jn=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),zn=(0,Dt.importInternal)("drawing/getNewContext"),qn=(0,Dt.importInternal)("drawing/draw"),Wn=(0,Dt.importInternal)("drawing/setShadow"),Gn=(0,Dt.importInternal)("drawing/drawHandles"),Yn=(0,Dt.importInternal)("drawing/textBoxWidth"),{textMarkerCursor:Zn}=(0,Dt.importInternal)("tools/cursors"),Kn=Hn("tools:annotation:ProbeTool");function Xn(e){return _n(this,void 0,void 0,(function*(){e(yield bn(k("toast.prompt.enterText")))}))}function Jn(e,t,n){return _n(this,void 0,void 0,(function*(){n(yield bn(k("toast.prompt.enterText")))}))}const Qn=(0,Dt.importInternal)("base/BaseAnnotationTool"),$n=(0,Dt.importInternal)("manipulators/moveNewHandle"),eo=(0,Dt.importInternal)("drawing/getNewContext"),to=(0,Dt.importInternal)("drawing/draw"),no=(0,Dt.importInternal)("drawing/setShadow"),oo=(0,Dt.importInternal)("drawing/drawJoinedLines"),ao=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),io=(0,Dt.importInternal)("drawing/drawHandles"),ro=(0,Dt.importInternal)("util/triggerEvent"),so=(0,Dt.importInternal)("util/lineSegDistance"),lo=(0,Dt.importInternal)("util/roundToDecimal"),co=(0,Dt.importInternal)("util/throttle"),uo=(0,Dt.importInternal)("util/getPixelSpacing"),ho=(0,Dt.importInternal)("drawing/textBoxWidth"),{angleCursor:mo}=(0,Dt.importInternal)("tools/cursors");function fo(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function go(e,t,n){const{rowPixelSpacing:o,colPixelSpacing:a}=uo(e);return{x:(t.x-n.x)*(a||1),y:(t.y-n.y)*(o||1)}}var po=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const vo=(0,Dt.importInternal)("base/BaseTool"),yo=(0,Dt.importInternal)("util/debounce"),{panCursor:bo}=(0,Dt.importInternal)("tools/cursors");const xo=(0,Dt.importInternal)("base/BaseAnnotationTool"),wo=(0,Dt.importInternal)("manipulators/moveNewHandle"),To=(0,Dt.importInternal)("drawing/getNewContext"),Io=(0,Dt.importInternal)("drawing/draw"),Eo=(0,Dt.importInternal)("drawing/setShadow"),So=(0,Dt.importInternal)("drawing/drawLine"),Co=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),Ao=(0,Dt.importInternal)("drawing/drawHandles"),Mo=(0,Dt.importInternal)("util/triggerEvent"),Do=(0,Dt.importInternal)("util/lineSegDistance"),Po=(0,Dt.importInternal)("util/roundToDecimal"),Lo=(0,Dt.importInternal)("util/throttle"),ko=(0,Dt.importInternal)("util/getPixelSpacing"),{cobbAngleCursor:Oo}=(0,Dt.importInternal)("tools/cursors");function Ro(e,t,n){let o,a,i,r;const{columnPixelSpacing:s=1,rowPixelSpacing:l=1}=e.image,c={x:(t.x+n.x)/2,y:(t.y+n.y)/2};if(t.x===n.x&&t.y===n.y)o=t.x,a=t.y,i=n.x,r=n.y;else{const e=function(e,t,n,o){const a=(n.x-o.x)*e,i=(n.y-o.y)*t,r=Math.sqrt(a*a+i*i);return{x:a/r,y:i/r,length:r}}(s,l,t,n),u=10*e.length,d=u/(2*l),h=u/(2*s);o=c.x+h*e.y,a=c.y-d*e.x,i=c.x-h*e.y,r=c.y+d*e.x}return{start:{x:o,y:a},mid:c,end:{x:i,y:r}}}var No=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};function _o(e){return No(this,void 0,void 0,(function*(){const t=(0,i.getEnabledElements)();let n;return e&&(n=t.find((({element:e,image:t})=>!t||!(0,Dt.getToolState)(e,"stack")))),0===t.length||n?E(250).then((()=>_o(e))):t}))}var Uo=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const Bo=function(e,t){return Uo(this,void 0,void 0,(function*(){const n=yield _o(t);e.destroy();for(const{element:t}of n)e.add(t);return n}))},Vo={stackPositionSynchronizer:Dt.stackImagePositionSynchronizer,stackIndexSynchronizer:Dt.stackImageIndexSynchronizer,stackScrollSynchronizer:Dt.stackScrollSynchronizer};let Fo=new Dt.Synchronizer(`${i.EVENTS.NEW_IMAGE} ${Dt.EVENTS.STACK_SCROLL}`,Vo[j.tackSynchronizerType]);const Ho=(0,s.debounce)((function(){return Bo(Fo,!0)}),500);function jo(){Fo.destroy()}const zo=(0,Dt.importInternal)("base/BaseTool"),qo=(0,Dt.importInternal)("drawing/getNewContext"),Wo=(0,Dt.importInternal)("drawing/draw"),Go=(0,Dt.importInternal)("drawing/setShadow"),Yo=(0,Dt.importInternal)("drawing/drawTextBox"),Zo=(0,Dt.importInternal)("drawing/drawLine"),Ko=(0,Dt.importInternal)("util/imagePointToPatientPoint"),Xo=(0,Dt.importInternal)("util/projectPatientPointToImagePlane"),Jo=(0,Dt.importInternal)("util/convertToVector3"),Qo=(0,Dt.importInternal)("util/debounce"),{crosshairsCursor:$o}=(0,Dt.importInternal)("tools/cursors"),ea={_enabled:!1,set enabled(e){this._enabled=e},get enabled(){return this._enabled},state:{},init(e){this.enabled=!0,this.state=e}};const ta=(0,Dt.importInternal)("base/BaseAnnotationTool"),na=(0,Dt.importInternal)("manipulators/getHandleNearImagePoint"),oa=(0,Dt.importInternal)("drawing/getNewContext"),aa=(0,Dt.importInternal)("drawing/draw"),ia=(0,Dt.importInternal)("drawing/setShadow"),ra=(0,Dt.importInternal)("drawing/drawEllipse"),sa=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),la=(0,Dt.importInternal)("drawing/drawLine"),ca=(0,Dt.importInternal)("drawing/drawHandles"),ua=(0,Dt.importInternal)("util/getROITextBoxCoords"),da=(0,Dt.importInternal)("util/numbersWithCommas"),ha=(0,Dt.importInternal)("util/calculateSUV"),{calculateEllipseStatistics:ma,pointInEllipse:fa}=(0,Dt.importInternal)("util/ellipseUtils"),ga=(0,Dt.importInternal)("util/getLogger"),pa=(0,Dt.importInternal)("util/throttle"),va=(0,Dt.importInternal)("util/getPixelSpacing"),ya=ga?ga("tools:annotation:LengthTool"):console,{ellipticalRoiCursor:ba}=(0,Dt.importInternal)("tools/cursors");function xa(e,t){const{top:n,left:o,bottom:a,right:i}=e,{top:r,left:s,bottom:l,right:c}=t;n.active?(e.start.y+=n.y-r.y,e.top.x=a.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):o.active?(e.start.x+=o.x-s.x,e.left.y=i.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2):a.active?(e.end.y+=a.y-l.y,e.bottom.x=n.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):i.active&&(e.end.x+=i.x-c.x,e.right.y=o.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2)}function wa(e,t){const{left:n,top:o,width:a,height:i}=Ea(e,t);return[{x:n+a/2,y:o},{x:n,y:o+i/2},{x:n+a/2,y:o+i},{x:n+a,y:o+i/2}]}function Ta(e,t){return"CT"===e&&!1!==t?"HU":""}function Ia(e,t,{area:n,mean:o,stdDev:a,min:i,max:r,meanStdDevSUV:s}={},l,c,u={}){const d=u.showMinMax||!1,h=[],m=[];if(!t){const t=s&&0!==s.mean,n=Ta(l,u.showHounsfieldUnits);let c=`Mean: ${da(o.toFixed(2))} ${n}`;const h=`Std Dev: ${da(a.toFixed(2))} ${n}`;if(t){const t=" SUV: ",n=`${t}${da(s.mean.toFixed(2))}`,o=`${t}${da(s.stdDev.toFixed(2))}`,a=Math.floor(e.measureText(`${h}     `).width);for(;e.measureText(c).width<a;)c+=" ";m.push(`${c}${n}`),m.push(`${h}     ${o}`)}else m.push(`${c}`),m.push(`${h}`);if(d){let o=`Min: ${i} ${n}`;const a=`Max: ${r} ${n}`,s=t?Math.floor(e.measureText(`${h}     `).width):Math.floor(e.measureText(`${c}     `).width);for(;e.measureText(o).width<s;)o+=" ";m.push(`${o}${a}`)}}return h.push(function(e,t){const n=t?` mm${String.fromCharCode(178)}`:` px${String.fromCharCode(178)}`;return`Area: ${da(e.toFixed(2))}${n}`}(n,c)),m.forEach((e=>h.push(e))),h}function Ea(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}const Sa=(0,Dt.importInternal)("base/BaseTool"),Ca=(0,Dt.importInternal)("util/getPixelSpacing"),Aa=(0,Dt.importInternal)("drawing/getNewContext"),Ma=(0,Dt.importInternal)("drawing/draw"),Da=(0,Dt.importInternal)("drawing/setShadow"),Pa=(0,Dt.importInternal)("drawing/drawLine"),La=(0,Dt.importInternal)("drawing/drawTextBox"),ka=(0,Dt.importInternal)("util/getLogger")("tools:ScaleOverlayTool");const Oa=(e,t,n)=>{let o=0;const{color:a,lineWidth:i}=n;for(;n.verticalLine.start.y+o*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){const r={x:n.verticalLine.start.x,y:n.verticalLine.start.y+o*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+o*n.verticalMinorTick};s.x=o%10==0?n.verticalLine.start.x-n.majorTickLength:o%5==0?n.verticalLine.start.x-n.minorTickLength:n.verticalLine.start.x-n.minorTickLength/2,Pa(e,t,r,s,{color:a,lineWidth:i},"canvas"),o++}const r=10*(o-1)+"mm";La(e,r,n.verticalLine.end.x-e.measureText(r).width-10,n.verticalLine.end.y,Dt.toolColors.getToolColor())},Ra=(e,t,n)=>{let o=0;const{color:a,lineWidth:i}=n;for(n.horizontalMinorTick!==n.verticalMinorTick&&(n.horizontalMinorTick=n.verticalMinorTick);n.horizontalLine.start.x+o*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){const r={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:0};s.y=o%10==0?n.horizontalLine.start.y-n.majorTickLength:o%5==0?n.horizontalLine.start.y-n.minorTickLength:n.horizontalLine.start.y-n.minorTickLength/2,Pa(e,t,r,s,{color:a,lineWidth:i},"canvas"),o++}La(e,10*(o-1)+"mm",n.horizontalLine.end.x,n.horizontalLine.end.y-Dt.textStyle.getFontSize(),Dt.toolColors.getToolColor())};var Na=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const _a=(0,Dt.importInternal)("base/BaseTool"),Ua=(0,Dt.importInternal)("util/debounce"),{panCursor:Ba}=(0,Dt.importInternal)("tools/cursors");const Va=(0,Dt.importInternal)("base/BaseAnnotationTool"),Fa=(0,Dt.importInternal)("drawing/getNewContext"),Ha=(0,Dt.importInternal)("drawing/draw"),ja=(0,Dt.importInternal)("drawing/setShadow"),za=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),qa=(0,Dt.importInternal)("drawing/drawLine"),Wa=(0,Dt.importInternal)("drawing/drawHandles"),Ga=(0,Dt.importInternal)("util/getLogger"),Ya=(0,Dt.importInternal)("util/throttle"),Za=(0,Dt.importInternal)("util/getPixelSpacing"),Ka=(0,Dt.importInternal)("util/lineSegDistance"),Xa=Ga?Ga("tools:annotation:LengthTool"):console,{lengthCursor:Ja}=(0,Dt.importInternal)("tools/cursors");const{state:Qa,modules:$a}=Dt.store,ei=$a.globalConfiguration;function ti(e,t){Qa.svgCursorUrl&&window.URL.revokeObjectURL(Qa.svgCursorUrl),Qa.svgCursorUrl=null,e.style.cursor=t}const ni=(0,Dt.importInternal)("base/BaseTool"),oi=(0,Dt.importInternal)("drawing/getNewContext"),{magnifyCursor:ai}=(0,Dt.importInternal)("tools/cursors");const ii=(0,Dt.importInternal)("base/BaseAnnotationTool"),ri=(0,Dt.importInternal)("drawing/getNewContext"),si=(0,Dt.importInternal)("drawing/draw"),li=(0,Dt.importInternal)("drawing/setShadow"),ci=(0,Dt.importInternal)("drawing/drawRect"),ui=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),di=(0,Dt.importInternal)("drawing/drawHandles"),hi=(0,Dt.importInternal)("util/getLogger"),mi=(0,Dt.importInternal)("util/throttle"),fi=(0,Dt.importInternal)("util/getPixelSpacing"),gi=(0,Dt.importInternal)("util/calculateSUV"),pi=(0,Dt.importInternal)("util/getROITextBoxCoords"),vi=(0,Dt.importInternal)("util/numbersWithCommas"),yi=hi?hi("tools:annotation:LengthTool"):console,{rectangleRoiCursor:bi}=(0,Dt.importInternal)("tools/cursors");function xi(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function wi(e,t){const{left:n,top:o,width:a,height:i}=xi(e,t);return[{x:n+a/2,y:o},{x:n,y:o+i/2},{x:n+a/2,y:o+i},{x:n+a,y:o+i/2}]}function Ti(e,t){return"CT"===e&&!1!==t?"HU":""}function Ii(e,t,{area:n,mean:o,stdDev:a,min:i,max:r,meanStdDevSUV:s},l,c,u={}){const d=u.showMinMax||!1,h=[],m=[];if(!t){const t=s&&0!==s.mean,n=Ti(l,u.showHounsfieldUnits);let c=`Mean: ${vi(o.toFixed(2))} ${n}`;const h=`Std Dev: ${vi(a.toFixed(2))} ${n}`;if(t){const t=" SUV: ",n=`${t}${vi(s.mean.toFixed(2))}`,o=`${t}${vi(s.stdDev.toFixed(2))}`,a=Math.floor(e.measureText(`${h}     `).width);for(;e.measureText(c).width<a;)c+=" ";m.push(`${c}${n}`),m.push(`${h}     ${o}`)}else m.push(`${c}`),m.push(`${h}`);if(d){let o=`Min: ${i} ${n}`;const a=`Max: ${r} ${n}`,s=t?Math.floor(e.measureText(`${h}     `).width):Math.floor(e.measureText(`${c}     `).width);for(;e.measureText(o).width<s;)o+=" ";m.push(`${o}${a}`)}}return h.push(function(e,t){const n=t?` mm${String.fromCharCode(178)}`:` px${String.fromCharCode(178)}`;return`Area: ${vi(e.toFixed(2))}${n}`}(n,c)),m.forEach((e=>h.push(e))),h}(0,Dt.importInternal)("base/BaseTool"),(0,Dt.importInternal)("drawing/getNewContext"),(0,Dt.importInternal)("drawing/draw"),(0,Dt.importInternal)("drawing/drawTextBox");const Ei=(0,Dt.importInternal)("base/BaseTool");const Si=(0,Dt.importInternal)("base/BaseAnnotationTool"),Ci=(0,Dt.importInternal)("manipulators/moveHandle"),Ai=(0,Dt.importInternal)("drawing/getNewContext"),Mi=(0,Dt.importInternal)("drawing/draw"),Di=(0,Dt.importInternal)("drawing/drawHandles"),Pi=(0,Dt.importInternal)("drawing/drawLinkedTextBox"),Li=(0,Dt.importInternal)("util/triggerEvent"),ki=(0,Dt.importInternal)("util/getRGBPixels"),Oi=(0,Dt.importInternal)("util/calculateSUV"),Ri=(0,Dt.importInternal)("util/getLogger"),Ni=(0,Dt.importInternal)("util/throttle"),{probeCursor:_i}=(0,Dt.importInternal)("tools/cursors"),Ui=Ri("tools:annotation:ProbeTool");const Bi=(0,Dt.importInternal)("base/BaseTool");const Vi=(0,Dt.importInternal)("base/BaseTool"),Fi=(0,Dt.importInternal)("util/angleBetweenPoints"),{rotateCursor:Hi}=(0,Dt.importInternal)("tools/cursors");function ji(e){var t;const{roundAngles:n,rotateScale:o}=this.configuration,{element:a,viewport:i,startPoints:r,currentPoints:s}=e.detail,l=null!==(t=i.initialRotation)&&void 0!==t?t:i.rotation,c=a.getBoundingClientRect(a),{clientWidth:u,clientHeight:d}=a,{scale:h,translation:m}=i,f={x:c.left+u/2+m.x*h,y:c.top+d/2+m.y*h},g=Fi(f,r.client,s.client);g.angle*=o,n&&(g.angle=Math.ceil(g.angle)),g.direction<0&&(g.angle=-g.angle),i.rotation=l+g.angle}function zi(e){const{roundAngles:t,flipHorizontal:n,rotateScale:o}=this.configuration,{viewport:a,startPoints:i,currentPoints:r}=e.detail,s=a.initialRotation,l=i.client.x;let c=(r.client.x-l)*o;t&&(c=Math.round(Math.abs(c))*(c>0?1:-1)),n&&(c=-c),a.rotation=s+c}function qi(e){const{roundAngles:t,flipVertical:n,rotateScale:o}=this.configuration,{viewport:a,startPoints:i,currentPoints:r}=e.detail,s=a.initialRotation,l=i.client.y;let c=(r.client.y-l)*o;t&&(c=Math.round(Math.abs(c))*(c>0?1:-1)),n&&(c=-c),a.rotation=s+c}const Wi=(0,Dt.importInternal)("base/BaseAnnotationTool"),Gi=new s.ComputeStore;function Yi(){return function(){const e=[];for(const[t,{tool:n}]of Object.entries(Dt.store.state.globalTools))new n instanceof Wi&&e.push(n);return e}().map((e=>(new e).name))}var Zi=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};let Ki=!0;function Xi(e){return Zi(this,void 0,void 0,(function*(){Ki=e;const{layoutView:t}=j.webDicomView;if(t){Ki?(yield E(),t.toggleClassName(t.querySelectorForTool(".visibilityLabels"),void 0,"active",!1)):t.querySelectorForTool(".disableAllTool").click();for(let{element:e}of(0,i.getEnabledElements)())(0,i.updateImage)(e)}}))}Dt.globalImageIdSpecificToolStateManager._get=Dt.globalImageIdSpecificToolStateManager.get,Dt.globalImageIdSpecificToolStateManager.get=function(e,t){if(!Ki&&Gi.get(Yi).includes(t))return;const{imageId:n}=(0,i.getImage)(e),{imageUID:o}=i.metaData.get("_IDModule",n);return Dt.globalImageIdSpecificToolStateManager.getImageIdToolState(o,t)},Dt.globalImageIdSpecificToolStateManager._add=Dt.globalImageIdSpecificToolStateManager.add,Dt.globalImageIdSpecificToolStateManager.add=function(e,t,n){Ki||Xi(!0);const{imageId:o}=(0,i.getImage)(e),{imageUID:a,seriesUID:r,studyUID:s}=i.metaData.get("_IDModule",o);Dt.globalImageIdSpecificToolStateManager.addImageIdToolState(a,t,n),Dt.globalImageIdSpecificToolStateManager.setImageIdToolState(a,"baseInfo",{imageUID:a,seriesUID:r,studyUID:s})},Dt.globalImageIdSpecificToolStateManager._set=Dt.globalImageIdSpecificToolStateManager.set,Dt.globalImageIdSpecificToolStateManager.set=function(e,t,n){const{imageId:o}=(0,i.getImage)(e),{imageUID:a,seriesUID:r,studyUID:s}=i.metaData.get("_IDModule",o);Dt.globalImageIdSpecificToolStateManager.setImageIdToolState(a,t,n),Dt.globalImageIdSpecificToolStateManager.setImageIdToolState(a,"baseInfo",{imageUID:a,seriesUID:r,studyUID:s})},Dt.globalImageIdSpecificToolStateManager._clear=Dt.globalImageIdSpecificToolStateManager.clear,Dt.globalImageIdSpecificToolStateManager.clear=function(e){const{imageId:t}=(0,i.getImage)(e),{imageUID:n}=i.metaData.get("_IDModule",t);return Dt.globalImageIdSpecificToolStateManager.clearImageIdToolState(n)};const{toolColor:Ji,zoomTool:{minScale:Qi,maxScale:$i}}=j.toolsOptions,er={configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:Qi,maxScale:$i}};function tr(){(0,Dt.setToolEnabled)("PersistentSate"),(0,Dt.setToolEnabled)("ScaleOverlay"),(0,Dt.setToolEnabled)("OrientationMarkers"),j.isMobile?((0,Dt.setToolActive)("ZoomTouchPinch",{}),(0,Dt.setToolActive)("PanMultiTouch",{})):((0,Dt.setToolActive)("StackScrollMouseWheel",{}),(0,Dt.setToolActive)("Wwwc",{mouseButtonMask:2}),(0,Dt.setToolActive)("Pan",{mouseButtonMask:4}))}Dt.external.cornerstoneMath=Mt(),Dt.external.cornerstone=r(),Dt.external.Hammer=Ct(),(0,Dt.init)({globalToolSyncEnabled:!0,mouseEnabled:!0,showSVGCursors:!0,autoResizeViewports:!0}),(0,Dt.addTool)(Dt.WwwcTool),(0,Dt.addTool)(class extends Vi{constructor(e={}){super(e,{name:"Rotate",strategies:{default:ji,horizontal:zi,vertical:qi},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:Hi})}touchDragCallback(e){this.dragCallback(e)}mouseDragCallback(e){this.dragCallback(e)}postTouchStartCallback(e){this.initialRotation=e.detail.viewport.rotation}postMouseDownCallback(e){this.initialRotation=e.detail.viewport.rotation}dragCallback(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),Dt.external.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}),(0,Dt.addTool)(Dt.ReferenceLinesTool),(0,Dt.addTool)(class extends zo{constructor(e={}){super(e,{name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:$o}),this.synchronizationContext=null,this.debounceClear=Qo(this.clear,10),this.stackEEventListener=Qo((e=>{const t=n=>{e.removeEventListener(n.type,t),this.debounceClear()};e.addEventListener(Dt.EVENTS.STACK_SCROLL,t)}),100,{leading:!0}),this.postTouchStartCallback=this._downCallback.bind(this),this.postMouseDownCallback=this._downCallback.bind(this),this.touchDragCallback=this._chooseLocation.bind(this),this.mouseDragCallback=this._chooseLocation.bind(this),this.touchEndCallback=this.debounceClear.bind(this),this.mouseUpCallback=this.debounceClear.bind(this)}clear(){ea.enabled=!1,this.updateImages()}updateImages(){for(const e of this.synchronizationContext.getSourceElements())(0,i.updateImage)(e)}renderToolData(e){if(!ea.enabled)return;const{patientPoint:t}=ea.state||{},{element:n,canvasContext:o,viewport:{scale:a}}=e.detail,r=qo(o.canvas),l=Dt.toolColors.getActiveColor(),c=30/a,u={color:l,lineWidth:2},d=i.metaData.get("imagePlaneModule",(0,i.getEnabledElement)(n).image.imageId);if(!d||(0,s.isNull)(d.imagePositionPatient)||(0,s.isNull)(d.imageOrientationPatient))return;const h=Xo(Jo(t),d);Go(r,this.configuration),Wo(r,(e=>{Zo(e,n,{x:h.x-c,y:h.y},{x:h.x+c,y:h.y},u),Zo(e,n,{x:h.x,y:h.y-c},{x:h.x,y:h.y+c},u);const t=(0,i.pixelToCanvas)(n,h),o=Ko(h,d);Yo(e,[`X: ${o.x.toFixed(2)}`,`Y: ${o.y.toFixed(2)}`,`Z: ${o.z.toFixed(2)}`],t.x+20,t.y+10,l)}))}activeCallback(e,{synchronizationContext:t}){this.synchronizationContext=t}_chooseLocation(e){Fo.enabled=!1;const t=e.detail,{element:n,currentPoints:o,viewport:{scale:a}}=t;if(!(0,Dt.getToolState)(n,this.name))return;this.stackEEventListener(n);const r=n,l=i.metaData.get("imagePlaneModule",(0,i.getEnabledElement)(n).image.imageId);if(!l||(0,s.isNull)(l.imagePositionPatient)||(0,s.isNull)(l.imageOrientationPatient))return;const c=o.image;if(j.isMobile){const{handleTouchOffset:{x:e,y:t}}=Dt.store.state;c.x+=e/a,c.y+=t/a}const u=Ko(c,l),d=this.synchronizationContext.getSourceElements();ea.init({sourceElement:r,sourceImagePoint:c,sourceImagePlane:l,patientPoint:u,eventData:t}),d.forEach((e=>{if(e===r)return void(1===d.length&&this.updateImages());let t=Number.MAX_VALUE,n=-1;const o=(0,Dt.getToolState)(e,"stack");if(void 0===o)return;const a=o.data[0];for(let e=0;e<a.imageIds.length;e++){const o=i.metaData.get("imagePlaneModule",a.imageIds[e]);if(!(o&&o.imagePositionPatient&&o.rowCosines&&o.columnCosines))return;const r=Jo(o.imagePositionPatient),s=Jo(o.rowCosines),l=Jo(o.columnCosines).clone().cross(s.clone()),c=Math.abs(l.clone().dot(r)-l.clone().dot(u));c<t&&(t=c,n=e)}if(-1!==n&&void 0!==a.imageIds[n]){const t=Dt.loadHandlerManager.getStartLoadHandler(e),o=Dt.loadHandlerManager.getEndLoadHandler(e),r=Dt.loadHandlerManager.getErrorLoadingHandler(e);let s;t&&t(e),s=!0===a.preventCache?(0,i.loadImage)(a.imageIds[n]):(0,i.loadAndCacheImage)(a.imageIds[n]),s.then((t=>{const r=(0,i.getViewport)(e);a.currentImageIdIndex=n,(0,i.displayImage)(e,t,r),o&&o(e,t)}),(t=>{const o=a.imageIds[n];r&&r(e,o,t)})).finally((()=>{!function(e){Fo.enabled=!1,Fo.timer&&clearTimeout(Fo.timer),Fo.timer=setTimeout((()=>{Fo.enabled=!0}),e)}(100)}))}}))}_downCallback(e){const{element:t}=e.detail,n=e=>{t.removeEventListener(e.type,n),this.debounceClear()};this._chooseLocation(e),t.addEventListener(j.isMobile?"touchend":"mouseup",n)}}),(0,Dt.addTool)(class extends ta{constructor(e={}){super(e,{name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:ba}),this.throttledUpdateCachedStats=pa(this.updateCachedStats,110),this.throttledHandlesMove=pa(xa,0)}createNewMeasurement(e){const{currentPoints:{image:t},image:n}=e||{currentPoints:{}};if(t)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};ya.error(`required eventData not supplied to tool ${this.name}'s createNewMeasurement`)}pointNearTool(e,t,n,o){const a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||ya.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!a||!1===t.visible)return!1;if(na(e,t.handles,n,6))return!0;const i="mouse"===o?15:25,r=Dt.external.cornerstone.pixelToCanvas(e,t.handles.start),s=Dt.external.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,s.x)+i/2,top:Math.min(r.y,s.y)+i/2,width:Math.abs(r.x-s.x)-i,height:Math.abs(r.y-s.y)-i},c={left:Math.min(r.x,s.x)-i/2,top:Math.min(r.y,s.y)-i/2,width:Math.abs(r.x-s.x)+i,height:Math.abs(r.y-s.y)+i},u=fa(l,n);return!(!fa(c,n)||u)}updateCachedStats(e,t,n){const o=(Dt.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,a=va(e),i=function(e,t,n,o,a){const i=Ea(n.start,n.end),r=Dt.external.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),s=ma(r,i);let l;"PT"===o&&(l={mean:ha(e,s.mean,!0)||0,stdDev:ha(e,s.stdDev,!0)||0});const c=Math.PI*(i.width*(a.colPixelSpacing||1)/2)*(i.height*(a.rowPixelSpacing||1)/2);return{area:c||0,count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:l,handles:h(n)}}(e,t,n.handles,o,a);n.cachedStats=i,n.invalidated=!1}renderToolData(e){const t=(0,Dt.getToolState)(e.currentTarget,this.name);if(!t)return;const n=e.detail,{image:o,element:a}=n,i=Dt.toolStyle.getToolWidth(),r=(0,Dt.getModule)("globalConfiguration").configuration.lineDash,{handleRadius:s,drawHandlesOnHover:l,hideHandlesIfMoving:c,renderDashed:u}=this.configuration,d=oa(n.canvasContext.canvas),{rowPixelSpacing:h,colPixelSpacing:m}=va(o),f=(Dt.external.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,g=h&&m;aa(d,(e=>{for(let d=0;d<t.data.length;d++){const h=t.data[d];if(!1===h.visible)continue;const m=Dt.toolColors.getColorIfActive(h),p={color:m,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};ia(e,this.configuration);const v={color:m};if(u&&(v.lineDash=r),ra(e,a,h.handles.start,h.handles.end,v,"pixel",h.handles.initialRotation),this.configuration.drawHandles&&h.active){ca(e,n,Object.assign(Object.assign({},h.handles),{top:{drawnIndependently:!0},left:{drawnIndependently:!0},bottom:{drawnIndependently:!0},right:{drawnIndependently:!0}}),p);const t={color:m,lineWidth:i,lineDash:[2,3]};la(e,a,h.handles.start,h.handles.end,t)}if(!0===h.invalidated&&(h.cachedStats?this.throttledUpdateCachedStats(o,a,h):this.updateCachedStats(o,a,h)),!h.handles.textBox.hasMoved){const e=ua(n.viewport,h.handles);Object.assign(h.handles.textBox,e)}const y=e=>wa(e.start,e.end),b=Ia(e,o.color,h.cachedStats,f,g,this.configuration);h.unit=Ta(f,this.configuration.showHounsfieldUnits),sa(e,a,h.handles.textBox,b,h.handles,y,m,i,10,!0)}}))}},{configuration:{showMinMax:!0}}),(0,Dt.addTool)(Dt.StackScrollTool),(0,Dt.addTool)(Dt.FreehandRoiTool,{configuration:{showMinMax:!0}}),(0,Dt.addTool)(Dt.CircleRoiTool,{configuration:{showMinMax:!0}}),(0,Dt.addTool)(class extends ni{constructor(e={}){super(e,{name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:ai}),this.zoomCanvas=void 0,this.zoomElement=void 0,this.activeCallback=this._createMagnificationCanvas.bind(this),this.enabledCallback=this._createMagnificationCanvas.bind(this),this.disabledCallback=this._destroyMagnificationCanvas.bind(this),this.postTouchStartCallback=this._addMagnifyingGlass.bind(this),this.touchDragCallback=this._updateMagnifyingGlass.bind(this),this.touchEndCallback=this._removeMagnifyingGlass.bind(this),this.touchDragEndCallback=this._removeMagnifyingGlass.bind(this),this.postMouseDownCallback=this._addMagnifyingGlass.bind(this),this.mouseDragCallback=this._updateMagnifyingGlass.bind(this),this.mouseUpCallback=this._removeMagnifyingGlass.bind(this),this.mouseClickCallback=this._removeMagnifyingGlass.bind(this),this.newImageCallback=this._drawMagnificationTool.bind(this)}_addMagnifyingGlass(e){var t;(this._removeZoomElement(),e.detail.element.querySelector(".active"))||(this._drawZoomedElement(e),window.requestAnimationFrame((()=>this._drawMagnificationTool(e))),t=e.detail.element,ei.configuration.showSVGCursors&&ti(t,"none"),e.preventDefault(),e.stopPropagation())}_updateMagnifyingGlass(e){e.detail.element.querySelector(".active")||(this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation())}_removeMagnifyingGlass(e){const t=e.detail.element;!function(e,t){if(!ei.configuration.showSVGCursors)return;const n=t.getIconWithPointerSVG(),o=t.mousePoint,a=window.URL.createObjectURL(n);e.style.cursor=`url('${a}') ${o}, auto`,Qa.svgCursorUrl=a}(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}_drawMagnificationTool(e){const t=e.detail.element,n=t.querySelector(".magnifyTool");if(void 0===this.zoomCanvas)return;const o=t.querySelector("canvas:not(.magnifyTool)"),a=oi(n),i=Dt.external.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),r=Math.min(this.configuration.magnifySize,o.width,o.height),s=this.configuration.magnificationLevel;n.width=r,n.height=r,i.x=Math.max(i.x,.5*r/s),i.x=Math.min(i.x,o.width-.5*r/s),i.y=Math.max(i.y,.5*r/s),i.y=Math.min(i.y,o.height-.5*r/s);const l={x:i.x*s-.5*r,y:i.y*s-.5*r};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),a.drawImage(this.zoomCanvas,l.x,l.y,r,r,0,0,r,r);const c=e.detail.isTouchEvent?120:0,u={top:Math.max(i.y-.5*r-c,0),left:Math.max(i.x-.5*r,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,o.height-d.height),u.left=Math.min(u.left,o.width-d.width),n.style.top=`${u.top}px`,n.style.left=`${u.left}px`,n.style.display="block"}_drawZoomedElement(e){const t=e.detail.element;let n=e.detail.enabledElement;void 0===n&&(n=Dt.external.cornerstone.getEnabledElement(t));const o=this.configuration.magnificationLevel,a=n.canvas,i=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=a.width*o,this.zoomElement.height=a.height*o,Dt.external.cornerstone.enable(this.zoomElement,n.options));const r=Dt.external.cornerstone.getEnabledElement(this.zoomElement),s=Dt.external.cornerstone.getViewport(n.element);this.zoomCanvas=r.canvas,this.zoomCanvas.width=a.width*o,this.zoomCanvas.height=a.height*o,r.viewport=Object.assign({},s),s.scale*=o,Dt.external.cornerstone.displayImage(this.zoomElement,i),Dt.external.cornerstone.setViewport(this.zoomElement,s)}_removeZoomElement(){void 0!==this.zoomElement&&(Dt.external.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}_createMagnificationCanvas(e){if(null===e.querySelector(".magnifyTool")){const t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}_destroyMagnificationCanvas(e){const t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}),(0,Dt.addTool)(Dt.EraserTool),(0,Dt.addTool)(Dt.PanTool),(0,Dt.addTool)(class extends wn{constructor(e={}){super(e,{name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Rn,changeTextCallback:Nn,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:On}),this.preventNewMeasurement=!1}createNewMeasurement(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}pointNearTool(e,t,n,o){if(!1===t.visible)return!1;const a="mouse"===o?15:25;return En(e,t.handles.start,t.handles.end,n)<a}updateCachedStats(){}renderToolData(e){const{element:t,enabledElement:n}=e.detail,{handleRadius:o,drawHandlesOnHover:a,hideHandlesIfMoving:i,renderDashed:r}=this.configuration,s=(0,Dt.getToolState)(t,this.name);if(!s)return;const l=e.detail.canvasContext.canvas,c=An(l),u=Dt.toolStyle.getToolWidth();let d;r&&(d=(0,Dt.getModule)("globalConfiguration").configuration.lineDash);for(let r=0;r<s.data.length;r++){const l=s.data[r];!1!==l.visible&&Mn(c,(r=>{Dn(r,this.configuration);const s=Dt.toolColors.getColorIfActive(l),c=Dt.external.cornerstone.pixelToCanvas(t,l.handles.start),f=Dt.external.cornerstone.pixelToCanvas(t,l.handles.end);this.configuration.arrowFirst?Pn(r,f,c,s,u,d):Pn(r,c,f,s,u,d);const g={color:s,handleRadius:o,drawHandlesIfActive:a,hideHandlesIfMoving:i};this.configuration.drawHandles&&l.active&&Ln(r,e.detail,l.handles,g);const p=h(l);if(p&&""!==p){const e=kn(r,p,5),o=Dt.textStyle.getFontSize()+10;let a=Math.max(e,o)/2+5;if(f.x<c.x&&(a=-a),!l.handles.textBox.hasMoved){let t;t=this.configuration.arrowFirst?{x:f.x-e/2+a,y:f.y-o/2}:{x:c.x-e/2-a,y:c.y-o/2};const i=Dt.external.cornerstone.internal.getTransform(n);i.invert();const r=i.transformPoint(t.x,t.y);l.handles.textBox.x=r.x,l.handles.textBox.y=r.y}Cn(r,t,l.handles.textBox,p,l.handles,m,s,u,0,!1)}}))}function h(e){return e.text}function m(e){const t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}addNewMeasurement(e,t){const n=e.detail.element,o=this.createNewMeasurement(e),{allowEmptyLabel:a}=this.configuration;(0,Dt.addToolState)(n,this.name,o),Dt.external.cornerstone.updateImage(n),Tn(e.detail,this.name,o,o.handles.end,this.options,t,(t=>{t?void 0===o.text&&this.configuration.getTextCallback((e=>{if(e||a){o.text=e,o.active=!1;const t={toolName:this.name,toolType:this.name,element:n,measurementData:o};Dt.external.cornerstone.updateImage(n),Sn(n,Dt.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,Dt.removeToolState)(n,this.name,o)}),e.detail):(0,Dt.removeToolState)(n,this.name,o),Dt.external.cornerstone.updateImage(n)}))}doubleClickCallback(e){return this._updateTextForNearbyAnnotation(e,"mouse")}touchPressCallback(e){return this._updateTextForNearbyAnnotation(e,"touch")}_updateTextForNearbyAnnotation(e,t){const n=e.detail.element,o=e.detail.currentPoints.canvas,a=(0,Dt.getToolState)(n,this.name);if(!a)return!1;for(let i=0;i<a.data.length;i++){const r=a.data[i];if(this.pointNearTool(n,r,o,t)||In(r.handles.textBox,o))return r.active=!0,Dt.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(r,e.detail,this._doneChangingTextCallback.bind(this,n,r)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}_doneChangingTextCallback(e,t,n,o){!0===o?(0,Dt.removeToolState)(e,this.name,t):t.text=n,t.active=!1,Dt.external.cornerstone.updateImage(e),Sn(e,Dt.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{}),(0,Dt.addTool)(class extends ii{constructor(e={}){super(e,{name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:bi}),this.throttledUpdateCachedStats=mi(this.updateCachedStats,110)}createNewMeasurement(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};yi.error(`required eventData not supplied to tool ${this.name}'s createNewMeasurement`)}pointNearTool(e,t,n,o){const a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||yi.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!a||!1===t.visible)return!1;const i="mouse"===o?15:25,r=Dt.external.cornerstone.pixelToCanvas(e,t.handles.start),s=Dt.external.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,s.x),top:Math.min(r.y,s.y),width:Math.abs(r.x-s.x),height:Math.abs(r.y-s.y)};return Dt.external.cornerstoneMath.rect.distanceToPoint(l,n)<i}updateCachedStats(e,t,n){const o=(Dt.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,a=fi(e),i=function(e,t,n,o,a){const i=xi(n.start,n.end),r=Dt.external.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),s=function(e,t){let n=0,o=0,a=0,i=0,r=e?e[0]:null,s=e?e[0]:null;for(let l=t.top;l<t.top+t.height;l++)for(let l=t.left;l<t.left+t.width;l++)n+=e[i],o+=e[i]*e[i],r=Math.min(r,e[i]),s=Math.max(s,e[i]),a++,i++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0,min:0,max:0};const l=n/a,c=o/a-l*l;return{count:a,mean:l,variance:c,stdDev:Math.sqrt(c),min:r,max:s}}(r,i);let l;"PT"===o&&(l={mean:gi(e,s.mean,!0)||0,stdDev:gi(e,s.stdDev,!0)||0});const c=i.width*(a.colPixelSpacing||1)*(i.height*(a.rowPixelSpacing||1)),u=2*i.width*(a.colPixelSpacing||1)+2*i.height*(a.rowPixelSpacing||1);return{area:c||0,perimeter:u,count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:l}}(e,t,n.handles,o,a);n.cachedStats=i,n.invalidated=!1}renderToolData(e){const t=(0,Dt.getToolState)(e.currentTarget,this.name);if(!t)return;const n=e.detail,{image:o,element:a}=n,i=Dt.toolStyle.getToolWidth(),r=(0,Dt.getModule)("globalConfiguration").configuration.lineDash,{handleRadius:s,drawHandlesOnHover:l,hideHandlesIfMoving:c,renderDashed:u}=this.configuration,d=ri(n.canvasContext.canvas),{rowPixelSpacing:h,colPixelSpacing:m}=fi(o),f=(Dt.external.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,g=h&&m;si(d,(e=>{for(let d=0;d<t.data.length;d++){const h=t.data[d];if(!1===h.visible)continue;const m=Dt.toolColors.getColorIfActive(h),p={color:m,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};li(e,this.configuration);const v={color:m};if(u&&(v.lineDash=r),ci(e,a,h.handles.start,h.handles.end,v,"pixel",h.handles.initialRotation),this.configuration.drawHandles&&h.active&&di(e,n,h.handles,p),!0===h.invalidated&&(h.cachedStats?this.throttledUpdateCachedStats(o,a,h):this.updateCachedStats(o,a,h)),!h.handles.textBox.hasMoved){const e=pi(n.viewport,h.handles);Object.assign(h.handles.textBox,e)}const y=e=>wi(e.start,e.end),b=Ii(e,o.color,h.cachedStats,f,g,this.configuration);h.unit=Ti(f,this.configuration.showHounsfieldUnits),ui(e,a,h.handles.textBox,b,h.handles,y,m,i,10,!0)}}))}},{configuration:{showMinMax:!0}}),(0,Dt.addTool)(class extends Va{constructor(e={}){super(e,{name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ja,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}}),this.throttledUpdateCachedStats=Ya(this.updateCachedStats,110)}createNewMeasurement(e){var t;const n=null===(t=null==e?void 0:e.currentPoints)||void 0===t?void 0:t.image;if(!n)return void Xa.error(`required eventData not supplied to tool ${this.name}'s createNewMeasurement`);const{x:o,y:a}=n;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:o,y:a,highlight:!0,active:!1},end:{x:o,y:a,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}pointNearTool(e,t,n,o){if(!(t&&t.handles&&t.handles.start&&t.handles.end))return Xa.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!1;if(!1===t.visible)return!1;const a="mouse"===o?15:25;return Ka(e,t.handles.start,t.handles.end,n)<a}updateCachedStats(e,t,n){const{rowPixelSpacing:o,colPixelSpacing:a}=Za(e),i=(n.handles.end.x-n.handles.start.x)*(a||1),r=(n.handles.end.y-n.handles.start.y)*(o||1),s=Math.sqrt(i*i+r*r);n.length=s,n.invalidated=!1}renderToolData(e){const t=e.detail,{handleRadius:n,drawHandlesOnHover:o,hideHandlesIfMoving:a,renderDashed:i,digits:r}=this.configuration,s=(0,Dt.getToolState)(e.currentTarget,this.name);if(!s)return;const l=Fa(t.canvasContext.canvas),{image:c,element:u}=t,{rowPixelSpacing:d,colPixelSpacing:h}=Za(c),m=Dt.toolStyle.getToolWidth(),f=(0,Dt.getModule)("globalConfiguration").configuration.lineDash;for(let e=0;e<s.data.length;e++){const r=s.data[e];!1!==r.visible&&Ha(l,(e=>{ja(e,this.configuration);const s=Dt.toolColors.getColorIfActive(r),l={color:s};i&&(l.lineDash=f),qa(e,u,r.handles.start,r.handles.end,l);const v={color:s,handleRadius:n,drawHandlesIfActive:o,hideHandlesIfMoving:a};if(this.configuration.drawHandles&&r.active&&Wa(e,t,r.handles,v),!r.handles.textBox.hasMoved){const e={x:Math.max(r.handles.start.x,r.handles.end.x)};e.x===r.handles.start.x?e.y=r.handles.start.y:e.y=r.handles.end.y,r.handles.textBox.x=e.x,r.handles.textBox.y=e.y}!0===r.invalidated&&(r.length?this.throttledUpdateCachedStats(c,u,r):this.updateCachedStats(c,u,r));const y=g(r,d,h);za(e,u,r.handles.textBox,y,r.handles,p,s,m,10,!0)}))}function g(e,t,n){const o=function(e){const t=Number(e),n=!isNaN(t);return n?t:void 0}(e.length);if(!o)return"";let a="mm";return t&&n||(a="pixels"),e.unit=a,`${o.toFixed(r)} ${a}`}function p(e){const t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{}),(0,Dt.addTool)(class extends Qn{constructor(e={}){super(e,{name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:mo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}}),this.preventNewMeasurement=!1,this.throttledUpdateCachedStats=co(this.updateCachedStats,110)}createNewMeasurement(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}pointNearTool(e,t,n,o){if(!1===t.visible)return!1;const a="mouse"===o?15:25;return so(e,t.handles.start,t.handles.middle,n)<a||so(e,t.handles.middle,t.handles.end,n)<a}updateCachedStats(e,t,n){if(!n.handles.middle)return;const o=go(e,n.handles.middle,n.handles.start),a=go(e,n.handles.end,n.handles.middle),i=go(e,n.handles.end,n.handles.start),r=fo(o),s=fo(a),l=fo(i);let c=Math.acos((Math.pow(r,2)+Math.pow(s,2)-Math.pow(l,2))/(2*r*s));c*=180/Math.PI,n.rAngle=lo(c,2),n.invalidated=!1}renderToolData(e){const t=e.detail,n=t.enabledElement,{handleRadius:o,drawHandlesOnHover:a,hideHandlesIfMoving:i,renderDashed:r}=this.configuration,s=(0,Dt.getToolState)(e.currentTarget,this.name),l=(0,Dt.getModule)("globalConfiguration").configuration.lineDash;if(!s)return;const c=eo(t.canvasContext.canvas),{image:u,element:d}=t,{rowPixelSpacing:h,colPixelSpacing:m}=uo(u),f=Dt.toolStyle.getToolWidth();for(let e=0;e<s.data.length;e++){const v=s.data[e];!1!==v.visible&&to(c,(e=>{no(e,this.configuration);const s=Dt.toolColors.getColorIfActive(v),c=Dt.external.cornerstone.pixelToCanvas(t.element,v.handles.start),y=Dt.external.cornerstone.pixelToCanvas(t.element,v.handles.middle),b={color:s};r&&(b.lineDash=l),oo(e,t.element,v.handles.start,[v.handles.middle,v.handles.end],b);const x={color:s,handleRadius:o,drawHandlesIfActive:a,hideHandlesIfMoving:i};if(this.configuration.drawHandles&&v.active&&io(e,t,v.handles,x),!0===v.invalidated&&(v.rAngle?this.throttledUpdateCachedStats(u,d,v):this.updateCachedStats(u,d,v)),v.rAngle){const o=g(v,h,m),a=15;let i;if(!v.handles.textBox.hasMoved){i={x:y.x,y:y.y};const t=ho(e,o,5);y.x<c.x?i.x-=a+t+10:i.x+=a;const r=Dt.external.cornerstone.internal.getTransform(n);r.invert();const s=r.transformPoint(i.x,i.y);v.handles.textBox.x=s.x,v.handles.textBox.y=s.y}ao(e,t.element,v.handles.textBox,o,v.handles,p,s,f,0,!0)}}))}function g(e,t,n){const o=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+o}function p(e){return[e.start,e.middle,e.end]}}addNewMeasurement(e,t){if(this.preventNewMeasurement)return;this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();const n=e.detail,o=this.createNewMeasurement(n),a=e.detail.element;(0,Dt.addToolState)(a,this.name,o),Dt.external.cornerstone.updateImage(a),$n(n,this.name,o,o.handles.middle,this.options,t,(e=>{if(o.active=!1,!e)return(0,Dt.removeToolState)(a,this.name,o),void(this.preventNewMeasurement=!1);o.handles.end.active=!0,Dt.external.cornerstone.updateImage(a),$n(n,this.name,o,o.handles.end,this.options,t,(e=>{e?(o.active=!1,Dt.external.cornerstone.updateImage(a)):(0,Dt.removeToolState)(a,this.name,o),this.preventNewMeasurement=!1,Dt.external.cornerstone.updateImage(a);const t={toolName:this.name,toolType:this.name,element:a,measurementData:o};ro(a,Dt.EVENTS.MEASUREMENT_COMPLETED,t)}))}))}},{}),(0,Dt.addTool)(class extends Bi{constructor(e={}){super(e,{name:"Pointer",supportedInteractionTypes:["Mouse","Touch"]})}}),(0,Dt.addTool)(class extends xo{constructor(e={}){super(e,{name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Oo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}}),this.hasIncomplete=!1,this.throttledUpdateCachedStats=Lo(this.updateCachedStats,110)}createNewMeasurement(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}pointNearTool(e,t,n,o){if(!1===t.visible)return!1;const a="mouse"===o?15:25,i=Do(e,t.handles.start,t.handles.end,n)<a,r=Do(e,t.handles.start2,t.handles.end2,n)<a;return i||r}updateCachedStats(e,t,n){const{rowPixelSpacing:o,colPixelSpacing:a}=ko(e),i=(n.handles.start.x-n.handles.end.x)*(a||1),r=(n.handles.start.y-n.handles.end.y)*(o||1),s=(n.handles.start2.x-n.handles.end2.x)*(a||1),l=(n.handles.start2.y-n.handles.end2.y)*(o||1);let c=Math.acos((i*s+r*l)/(Math.sqrt(i*i+r*r)*Math.sqrt(s*s+l*l)));c*=180/Math.PI,n.rAngle=Po(c,2),n.lAngle2=Po(360-c,2),n.invalidated=!1}renderToolData(e){const t=e.detail,{handleRadius:n,drawHandlesOnHover:o,hideHandlesIfMoving:a,renderDashed:i}=this.configuration,r=(0,Dt.getToolState)(e.currentTarget,this.name);if(!r)return;const s=To(t.canvasContext.canvas),l=Dt.toolStyle.getToolWidth(),c=(0,Dt.getModule)("globalConfiguration").configuration.lineDash,u=Dt.textStyle.getFont(),{element:d}=e.detail,h=Dt.external.cornerstone.getEnabledElement(d).image,{rowPixelSpacing:m,colPixelSpacing:f}=ko(h);for(let e=0;e<r.data.length;e++){const h=r.data[e],{start:p,end:v,start2:y,end2:b}=h.handles;!1!==h.visible&&(h.value||(h.value=this.textBoxText(h,m,f)),Io(s,(e=>{Eo(e,this.configuration);const r=Dt.toolColors.getColorIfActive(h),s={color:r};i&&(s.lineDash=c),So(e,t.element,p,v,s);const m={color:r,lineWidth:l,lineDash:[2,3]};if(h.active||!h.complete){const{start:n,end:o}=Ro(t,p,v);So(e,d,n,o,m)}if(h.complete&&(So(e,t.element,y,b,s),h.active)){const{start:n,end:o}=Ro(t,y,b);So(e,d,n,o,m)}const f={color:r,handleRadius:n,drawHandlesIfActive:o,hideHandlesIfMoving:a};this.configuration.drawHandles&&h.active&&Ao(e,t,h.handles,f),e.fillStyle=r;const x=h.value;if(!h.handles.textBox.hasMoved){const t={x:(p.x+v.x)/2,y:(p.y+v.y)/2+10};e.font=u,h.handles.textBox.x=t.x,h.handles.textBox.y=t.y}h.complete&&Co(e,t.element,h.handles.textBox,x,h.handles,g,r,l,0,!0)})))}function g(e){return[e.start,e.start2,e.end,e.end2]}}getIncomplete(e){const t=(0,Dt.getToolState)(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((({complete:e})=>!1===e))}addNewMeasurement(e,t){e.preventDefault(),e.stopPropagation();const n=e.detail;let o,a,i=e=>{if(!e)return void(0,Dt.removeToolState)(r,this.name,o);const t=Dt.EVENTS.MEASUREMENT_COMPLETED,n={toolName:this.name,toolType:this.name,element:r,measurementData:o};Mo(r,t,n)};const r=e.detail.element,s=this.getIncomplete(r);s?(o=s,o.complete=!0,o.handles.start2={x:n.currentPoints.image.x,y:n.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},o.handles.end2={x:n.currentPoints.image.x,y:n.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},a=o.handles.end2,this.hasIncomplete=!1,i=e=>{if(!e)return void(0,Dt.removeToolState)(r,this.name,o);const t=Dt.EVENTS.MEASUREMENT_COMPLETED,n={toolName:this.name,toolType:this.name,element:r,measurementData:o};Mo(r,t,n)}):(o=this.createNewMeasurement(n),(0,Dt.addToolState)(r,this.name,o),a=o.handles.end),Dt.external.cornerstone.updateImage(r),wo(n,this.name,o,a,this.options,t,i)}onMeasureModified(e){const{element:t}=e.detail,n=Dt.external.cornerstone.getEnabledElement(t).image,{rowPixelSpacing:o,colPixelSpacing:a}=ko(n);if(e.detail.toolName!==this.name)return;const i=e.detail.measurementData;!0===i.invalidated&&(i.rAngle?this.throttledUpdateCachedStats(n,t,i):this.updateCachedStats(n,t,i)),i.value=this.textBoxText(i,o,a)}textBoxText({rAngle:e,lAngle2:t},n,o){if(void 0===e)return"";if(Number.isNaN(e))return"";const a=n&&o?"":" (isotropic)";return`${e}${a} (${t}${a})`}activeCallback(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(Dt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)}passiveCallback(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(Dt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)}enabledCallback(e){e.removeEventListener(Dt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)}disabledCallback(e){e.removeEventListener(Dt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)}}),(0,Dt.addTool)(class extends Un{constructor(e={}){super(e,{name:"Annotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Xn,changeTextCallback:Jn,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,allowEmptyLabel:!1},svgCursor:Zn}),this.preventNewMeasurement=!1}createNewMeasurement(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}pointNearTool(e,t,n,o){const a=t&&t.handles&&t.handles.end;if(a||Kn.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!a||!1===t.visible)return!1;const i=Dt.external.cornerstone.pixelToCanvas(e,t.handles.end),r="mouse"===o?15:25;return Dt.external.cornerstoneMath.point.distance(i,n)<r}updateCachedStats(){}renderToolData(e){const{element:t,enabledElement:n}=e.detail,{handleRadius:o,drawHandlesOnHover:a,hideHandlesIfMoving:i}=this.configuration,r=(0,Dt.getToolState)(t,this.name);if(!r)return;const s=e.detail.canvasContext.canvas,l=zn(s),c=Dt.toolStyle.getToolWidth();for(let s=0;s<r.data.length;s++){const h=r.data[s];!1!==h.visible&&qn(l,(r=>{Wn(r,this.configuration);const s=Dt.toolColors.getColorIfActive(h),l=Dt.external.cornerstone.pixelToCanvas(t,h.handles.end),m={color:s,handleRadius:o,drawHandlesIfActive:a,hideHandlesIfMoving:i};this.configuration.drawHandles&&Gn(r,e.detail,h.handles,m);const f=u(h);if(f&&""!==f){const e=Yn(r,f,5),o=Dt.textStyle.getFontSize()+10;let a=Math.max(e,o)/2+5;if(!h.handles.textBox.hasMoved){let t={x:l.x-e/2+a,y:l.y-o/2};const i=Dt.external.cornerstone.internal.getTransform(n);i.invert();const r=i.transformPoint(t.x,t.y);h.handles.textBox.x=r.x,h.handles.textBox.y=r.y}jn(r,t,h.handles.textBox,f,h.handles,d,s,c,0,!1)}}))}function u(e){return e.text}function d(e){return[e.end]}}addNewMeasurement(e,t){const n=e.detail.element,o=this.createNewMeasurement(e),{allowEmptyLabel:a}=this.configuration;(0,Dt.addToolState)(n,this.name,o),Dt.external.cornerstone.updateImage(n),Bn(e.detail,this.name,o,o.handles.end,this.options,t,(t=>{t?void 0===o.text&&this.configuration.getTextCallback((e=>{if(e||a){o.text=e,o.active=!1;const t={toolName:this.name,toolType:this.name,element:n,measurementData:o};Dt.external.cornerstone.updateImage(n),Fn(n,Dt.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,Dt.removeToolState)(n,this.name,o)}),e.detail):(0,Dt.removeToolState)(n,this.name,o),Dt.external.cornerstone.updateImage(n)}))}doubleClickCallback(e){return this._updateTextForNearbyAnnotation(e,"mouse")}touchPressCallback(e){return this._updateTextForNearbyAnnotation(e,"touch")}_updateTextForNearbyAnnotation(e,t){const n=e.detail.element,o=e.detail.currentPoints.canvas,a=(0,Dt.getToolState)(n,this.name);if(!a)return!1;for(let i=0;i<a.data.length;i++){const r=a.data[i];if(this.pointNearTool(n,r,o,t)||Vn(r.handles.textBox,o))return r.active=!0,Dt.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(r,e.detail,this._doneChangingTextCallback.bind(this,n,r)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}_doneChangingTextCallback(e,t,n,o){!0===o?(0,Dt.removeToolState)(e,this.name,t):t.text=n,t.active=!1,Dt.external.cornerstone.updateImage(e),Fn(e,Dt.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}),(0,Dt.addTool)(class extends Sa{constructor(e={}){super(e,{name:"ScaleOverlay",configuration:{minorTickLength:14,majorTickLength:24},mixins:["enabledOrDisabledBinaryTool"]})}enabledCallback(e){this.forceImageUpdate(e)}disabledCallback(e){this.forceImageUpdate(e)}forceImageUpdate(e){Dt.external.cornerstone.getEnabledElement(e).image&&Dt.external.cornerstone.updateImage(e)}renderToolData(e){const t=e.detail,n=Aa(t.canvasContext.canvas),{image:o,viewport:a,element:i}=t,{rowPixelSpacing:r,colPixelSpacing:s}=Ca(o);if(!r||!s)return void ka.warn(`unable to define rowPixelSpacing or colPixelSpacing from data on ${this.name}'s renderToolData`);const l=n.canvas.width,c=n.canvas.height;if(l<200||c<200)return;const u=10/r*a.scale,d=10/s*a.scale,h={topLeft:{x:60,y:c-26},bottomRight:{x:l-150,y:c-26}},m={topLeft:{x:l-34,y:74},bottomRight:{x:l-30,y:c-114}};if(!(l&&c&&h&&m))return;const f=Dt.toolColors.getToolColor(),g=Dt.toolStyle.getToolWidth(),p=Object.assign({},{hscaleBounds:h,vscaleBounds:m,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:m.bottomRight.x,y:m.topLeft.y},end:{x:m.bottomRight.x,y:m.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:f,lineWidth:g},this.configuration);Ma(n,(e=>{Da(e,p),Pa(e,i,p.verticalLine.start,p.verticalLine.end,{color:p.color,lineWidth:p.lineWidth},"canvas"),Oa(e,i,p),Pa(e,i,p.horizontalLine.start,p.horizontalLine.end,{color:p.color,lineWidth:p.lineWidth},"canvas"),Ra(e,i,p)}))}}),(0,Dt.addTool)(class extends on{constructor(){super({markerFlag:"L"})}}),(0,Dt.addTool)(class extends on{constructor(){super({markerFlag:"R"})}}),(0,Dt.addTool)(class extends an{constructor(e={}){super(e,{name:"Heartratio",supportedInteractionTypes:["Mouse","Touch"],svgCursor:vn,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}}),this.throttledUpdateCachedStats=fn(this.updateCachedStats,110)}createNewMeasurement(e){const{currentPoints:{image:t},image:n}=e||{currentPoints:{}};if(!t)return void pn.error(`required eventData not supplied to tool ${this.name}'s createNewMeasurement`);const{x:o,y:a}=t,{columns:i,rows:r}=n||{};return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:o,y:a,highlight:!0,active:!1},end:{x:o,y:a,highlight:!0,active:!0},start2:{x:.6*o,y:Math.min(1.35*a,.9*r),highlight:!0,active:!1},end2:{x:Math.min(1.75*o,i),y:Math.min(1.35*a,.9*r),highlight:!0,active:!0},start3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},end3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}pointNearTool(e,t,n,o){if(!((null==t?void 0:t.handles.start)&&(null==t?void 0:t.handles.end)))return pn.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!1;if(!1===t.visible)return!1;const a="mouse"===o?15:25;return hn(e,t.handles.start,t.handles.end,n)<a||hn(e,t.handles.start2,t.handles.end2,n)<a||hn(e,t.handles.start3,t.handles.end3,n)<a}updateCachedStats(e,t,n){const{rowPixelSpacing:o,colPixelSpacing:a}=gn(e),{start:i,end:r,start2:s,end2:l}=n.handles,c=Math.abs(r.x-i.x)*(a||1),u=Math.abs(l.x-s.x)*(o||1),d=c>u?u/c:c/u;n.ratio=d,n.handles.start3.x=(i.x+r.x)/2,n.handles.start3.y=(i.y+r.y)/2,n.handles.end3.x=(s.x+l.x)/2,n.handles.end3.y=(s.y+l.y)/2,n.invalidated=!1}renderToolData(e){const t=e.detail,{handleRadius:n,drawHandlesOnHover:o,hideHandlesIfMoving:a,renderDashed:i}=this.configuration,r=(0,Dt.getToolState)(e.currentTarget,this.name);if(!r)return;const s=rn(t.canvasContext.canvas),{image:l,element:c}=t,u=Dt.toolStyle.getToolWidth(),d=(0,Dt.getModule)("globalConfiguration").configuration.lineDash;for(let e=0;e<r.data.length;e++){const m=r.data[e],{handles:{start:f,end:g,start2:p,end2:v,start3:y,end3:b}}=m;!1!==m.visible&&sn(s,(e=>{ln(e,this.configuration);const r=Dt.toolColors.getColorIfActive(m),s={color:r,lineDash:void 0};i&&(s.lineDash=d),cn(e,c,f,g,s),cn(e,c,p,v,s),cn(e,c,y,b,Object.assign(Object.assign({},s),{lineDash:d}));const x={color:r,handleRadius:n,drawHandlesIfActive:o,hideHandlesIfMoving:a};if(this.configuration.drawHandles&&m.active&&dn(e,t,m.handles,x),!m.handles.textBox.hasMoved){const e={x:(y.x+b.x)/2,y:(y.y+b.y)/2};m.handles.textBox.x=e.x,m.handles.textBox.y=e.y}!0===m.invalidated&&(m.ratio?this.throttledUpdateCachedStats(l,c,m):this.updateCachedStats(l,c,m)),un(e,c,m.handles.textBox,`Ratio:${m.ratio.toFixed(3)}`,m.handles,h,r,u,5,!0)}))}function h(e){const{start:t,end:n,start2:o,end2:a,start3:i,end3:r}=e;return[{x:(i.x+r.x)/2,y:(i.y+r.y)/2},t,n,o,a]}}}),(0,Dt.addTool)(class extends Si{constructor(e={}){super(e,{name:"ProbeCT",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_i,configuration:{drawHandles:!0,renderDashed:!1}}),this.throttledUpdateCachedStats=Ni(this.updateCachedStats,110)}createNewMeasurement(e){if(!(e&&e.currentPoints&&e.currentPoints.image))return void Ui.error(`required eventData not supplied to tool ${this.name}'s createNewMeasurement`);const{x:t,y:n}=e.currentPoints.image;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:t,y:n,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}pointNearTool(e,t,n,o){const a=t&&t.handles&&t.handles.end;if(a||Ui.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!a||!1===t.visible)return!1;const i="mouse"===o?15:25,r=Dt.external.cornerstone.pixelToCanvas(e,t.handles.end);return Dt.external.cornerstoneMath.point.distance(r,n)<i}updateCachedStats(e,t,n){const o=Math.round(n.handles.end.x),a=Math.round(n.handles.end.y),i={};o>=0&&a>=0&&o<e.columns&&a<e.rows&&(i.x=o,i.y=a,e.color?i.storedPixels=ki(t,o,a,1,1):(i.storedPixels=Dt.external.cornerstone.getStoredPixels(t,o,a,1,1),i.sp=i.storedPixels[0],i.mo=i.sp*e.slope+e.intercept,i.suv=Oi(e,i.sp))),n.cachedStats=i,n.invalidated=!1}renderToolData(e){const t=e.detail,{handleRadius:n,renderDashed:o}=this.configuration,a=(0,Dt.getToolState)(e.currentTarget,this.name);if(!a)return;const i=Ai(t.canvasContext.canvas),{image:r,element:s}=t,l=(0,Dt.getModule)("globalConfiguration").configuration.lineDash;for(let e=0;e<a.data.length;e++){const c=a.data[e];!1!==c.visible&&Mi(i,(e=>{const a=Dt.toolColors.getColorIfActive(c);if(this.configuration.drawHandles){const i={handleRadius:n,color:a};o&&(i.lineDash=l),Di(e,t,c.handles,i)}!0===c.invalidated&&(c.cachedStats?this.throttledUpdateCachedStats(r,s,c):this.updateCachedStats(r,s,c));let i,u=[];const{x:d,y:h,storedPixels:m,sp:f,mo:g,suv:p}=c.cachedStats;if(d>=0&&h>=0&&d<r.columns&&h<r.rows){if(i=`X: ${d}, Y: ${h}`,r.color?u.push(`R: ${m[0]} G: ${m[1]} B: ${m[2]}`):(u.push(`SP: ${f} HU`),u.push(`MO: ${parseFloat(g.toFixed(3))} HU`),p&&u.push(` SUV: ${parseFloat(p.toFixed(3))} HU`)),!c.handles.textBox.hasMoved){const e={x:c.handles.end.x,y:c.handles.end.y};c.handles.textBox.x=e.x,c.handles.textBox.y=e.y}const t=Dt.toolStyle.getToolWidth();Pi(e,s,c.handles.textBox,[i,...u],c.handles,(()=>[{x:c.handles.end.x,y:c.handles.end.y}]),a,t,10,!0)}}))}}addNewMeasurement(e,t){e.preventDefault(),e.stopPropagation();const n=e.detail,o=n.element,a=this.createNewMeasurement(n);a&&((0,Dt.addToolState)(o,this.name,a),Dt.external.cornerstone.updateImage(o),Ci(n,this.name,a,a.handles.end,this.options,t,(e=>{if(e){const e=Dt.EVENTS.MEASUREMENT_COMPLETED,t={toolName:this.name,toolType:this.name,element:o,measurementData:a};Li(o,e,t)}else(0,Dt.removeToolState)(o,this.name,a)})))}}),(0,Dt.addTool)(class extends _a{constructor(e={}){super(e,{name:"Sharpen",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ba}),this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this),this.lazy=!1,this.updateViewport=Ua((e=>{const{element:t,deltaPoints:{page:{y:n}}}=e.detail,o=(0,i.getViewport)(t);if(o.sharpen||(o.sharpen=0),this.lazy=!1,n<0)o.sharpen+=1,o.sharpen>11&&(o.sharpen=11);else{if(!(n>0))return;o.sharpen-=1,o.sharpen<0&&(o.sharpen=0)}Dt.external.cornerstone.setViewport(t,o)}),300),this.updateCavansLazy=Ua((e=>{this.updateCavans(e)}),300)}updateCavans(e){return Na(this,void 0,void 0,(function*(){const t=e.detail,{enabledElement:n,viewport:o,canvasContext:a}=t,{sharpen:i}=o;if(!t||!n||!i)return;const r=a.canvas.width,s=a.canvas.height,l=a.getImageData(0,0,r,s),c=yield Be.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"sharpen",sigma:i}}).promise;a.putImageData(c,0,0)}))}renderToolData(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)}_dragCallback(e){this.updateViewport(e)}}),(0,Dt.addTool)(class extends vo{constructor(e={}){super(e,{name:"Blur",supportedInteractionTypes:["Mouse","Touch"],svgCursor:bo}),this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this),this.lazy=!1,this.updateViewport=yo((e=>{const{element:t,deltaPoints:{page:{y:n}}}=e.detail,o=(0,i.getViewport)(t);if(o.blur||(o.blur=0),this.lazy=!1,n<0)o.blur+=1,o.blur>9&&(o.blur=9);else{if(!(n>0))return;o.blur-=1,o.blur<0&&(o.blur=0)}Dt.external.cornerstone.setViewport(t,o)}),300),this.updateCavansLazy=yo((e=>{this.updateCavans(e)}),300)}updateCavans(e){return po(this,void 0,void 0,(function*(){const t=e.detail,{enabledElement:n,viewport:o,canvasContext:a}=t,{blur:i}=o;if(!t||!n||!i)return;const r=a.canvas.width,s=a.canvas.height,l=a.getImageData(0,0,r,s),c=yield Be.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"blur",sigma:i}}).promise;a.putImageData(c,0,0)}))}renderToolData(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)}_dragCallback(e){this.updateViewport(e)}}),(0,Dt.addTool)(class extends Bt{constructor(e={}){super(e,{name:"AI",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}})}activeCallback(e){this.forceImageUpdate(e)}passiveCallback(e){this.forceImageUpdate(e)}enabledCallback(e){this.forceImageUpdate(e)}disabledCallback(e){this.forceImageUpdate(e)}forceImageUpdate(e){Dt.external.cornerstone.getEnabledElement(e).image&&Dt.external.cornerstone.updateImage(e)}createNewMeasurement(){}updateCachedStats(){}pointNearTool(e,t,n,o){const a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||qt.warn(`invalid parameters supplied to tool ${this.name}'s pointNearTool`),!a||!1===t.visible)return!1;const i="mouse"===o?15:25,r=Dt.external.cornerstone.pixelToCanvas(e,t.handles.start),s=Dt.external.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,s.x),top:Math.min(r.y,s.y),width:Math.abs(r.x-s.x),height:Math.abs(r.y-s.y)},c=Dt.external.cornerstoneMath.rect.distanceToPoint(l,n);return t.handles.disable=c<i,t.handles.disable}renderToolData(e){let t=(0,Dt.getToolState)(e.currentTarget,this.name);const{seriesUID:n,currentImageIdIndex:o}=e.currentTarget.dataset;if(!t){const a=Pt.get(`${n}?index=${o}`);if(!a)return;t={data:a},a.forEach(((n,o)=>{o>=1&&Dt.external.cornerstoneMath.point.distance(n.handles.textBox,t.data[o-1].handles.textBox)<100&&(n.textBoxPointsCompute=!0),(0,Dt.addToolState)(e.currentTarget,this.name,n)}))}const a=e.detail,{image:i,element:r}=a,s=Dt.toolStyle.getToolWidth(),l=(0,Dt.getModule)("globalConfiguration").configuration.lineDash,{handleRadius:c,drawHandlesOnHover:u,hideHandlesIfMoving:d,renderDashed:h}=this.configuration,m=Vt(a.canvasContext.canvas);Ft(m,(e=>{for(let n=0;n<t.data.length;n++){const o=t.data[n],a=Dt.toolColors.getColorIfActive(o),m={color:a,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};h&&({color:a}.lineDash=l),Ht(e,r,o.handles.start,o.handles.end,m,"pixel");const f=e=>[e.start,e.end];if(o.textBoxPointsCompute){const[e,t]=[200,150],a=i.height-t,r=i.width-e;let s={x:0,y:0};switch(n){case 2:s={x:r,y:0};break;case 3:s={x:0,y:a};break;case 4:s={x:r,y:a}}o.handles.textBox=Object.assign(Object.assign({},o.handles.textBox),s),o.textBoxPointsCompute=!1}jt(e,r,o.handles.textBox,o.textBoxContent,o.handles,f,a,s,20,!1)}}))}}),(0,Dt.addTool)(Dt.OrientationMarkersTool),(0,Dt.addTool)(Dt.ZoomTool,er),(0,Dt.addTool)(class extends Ei{constructor(e={}){super(e,{name:"PersistentSate",configuration:{},mixins:["enabledOrDisabledBinaryTool"]}),this.state="disabled"}enabledCallback(){this.state="enabled"}disabledCallback(){this.state="disabled"}}),j.isMobile?((0,Dt.addTool)(Dt.ZoomTouchPinchTool,er),(0,Dt.addTool)(Dt.PanMultiTouchTool)):(0,Dt.addTool)(Dt.StackScrollMouseWheelTool),Xi(!0),Dt.toolColors.setToolColor(Ji),Dt.store.state.clickProximity=20,Dt.store.state.touchProximity=30,Dt.store.state.handleRadius=8;const nr=(0,s.debounce)((function(){const{state:e}=Dt.store.state.tools.find((e=>"PersistentSate"===e.name))||{};if("disabled"===e){const e=j.webDicomView.layoutView.querySelectorForTool(".disableAllTool");tr(),console.info("ForceEnabledGlobalTools"),e.click()}}),2e3);tr();var or=n(5947);(0,or.configure)({parent:".viewerContentWrapper"});(function(){const e=function(){try{const e=navigator.userAgent.toLowerCase();if(e.indexOf("win32")>=0||e.indexOf("wow32")>=0)return 32;if(e.indexOf("win64")>=0||e.indexOf("wow64")>=0)return 64;if(new ActiveXObject("Wscript.Shell").RegRead("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\PROCESSOR_ARCHITECTURE").toLowerCase().indexOf("32")>=0)return 32}catch(e){}}();console.info("systemInfo",{performance,navigator,screen,history,location,window,systemArchitecture:e}),32===e&&st().info({title:k("toast.is32System"),timeout:0}),void 0===n.g.structuredClone&&(n.g.structuredClone=e=>JSON.parse(JSON.stringify(e)),st().info({title:k("toast.kernelVersionLow"),timeout:0}))})();const ar=(e,t)=>{try{(0,i.getEnabledElement)(e)}catch(n){(0,i.enable)(e,Object.assign({},t))}},ir=e=>{const{element:t,canvas:n}=e;try{const o={element:t};(0,i.triggerEvent)(t,i.EVENTS.ELEMENT_DISABLED,o),(0,i.triggerEvent)(i.events,i.EVENTS.ELEMENT_DISABLED,o),1===t.querySelectorAll("canvas").length&&(null==t||t.removeChild(n)),e.canvas=void 0}catch(e){console.info(e)}},rr=e=>{if(void 0===e)throw new Error("disable: element must not be undefined");const t=(0,i.getEnabledElements)();for(let n=0;n<t.length;n++){const o=t[n];if(o.element===e){const a=e.querySelectorAll("canvas");a.length>1&&a.forEach((e=>setTimeout((()=>rr(e.parentElement))))),ir(o),t.splice(n,1)}}},sr=()=>{const e=(0,i.getEnabledElements)();for(const t of e)ir(t);e.length=0},lr=rr,cr=new s.PromiseQueue;var ur=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};r().loadAndCacheImage=(e,t={})=>(0,i.loadAndCacheImage)(e,Object.assign(Object.assign({},t),{useRGBA:!0}));let dr=0;const hr=(e,t)=>new Promise(((n,o)=>ur(void 0,void 0,void 0,(function*(){try{const o=yield r().loadAndCacheImage(e,t);n(o)}catch(t){const{loadAndCacheImage:n,indexedDBDelete:a}=k("toast");o(t);let i=5e3;ct("loadAndCacheImage",(0,s.throttle)((e=>{const{status:t,response:o}=(null==e?void 0:e.error)||e||{};let a;a=void 0===t?n.parsingFailed:203===t?n.validationFailed:n.dataError,console.error({message:a,error:e,status:t,response:new TextDecoder("utf-8").decode(o)}),st().error({title:a,timeout:i})}),i,{trailing:!1}),t);const{indexedDBKey:r}=it(e,j.imageType);yield vt.open(),console.info(a,r),vt.dispatch("delete",{},r)}})))),mr=(e,t)=>ur(void 0,void 0,void 0,(function*(){const{cancel:n=!0,forceCancelAll:o=!1,countCallback:a}=t||{},i="function"==typeof a;let r=0;if(o)return cr.cancel();!j.preload.fullLoad&&n&&cr.cancel(),yield cr.init({arr:e,func:e=>ur(void 0,void 0,void 0,(function*(){try{const t=yield hr(e);r+=1,dr+=1,i&&a(t,e,r),Q("loadAndCacheImages",!1,400)&&(dr=0)}catch(e){console.error(e)}})),limit:6})})),fr=e=>{const t=(0,i.getEnabledElement)(e);t.renderingTools.colormapId=void 0,t.renderingTools.colorLut=void 0;const n=t.renderingTools.renderCanvas,o=n.getContext("2d",{willReadFrequently:!0});o.fillStyle="white",o.fillRect(0,0,n.width,n.height);const a=o.getImageData(0,0,n.width,n.height);t.renderingTools.renderCanvasContext=o,t.renderingTools.renderCanvasData=a},gr=[{type:"CT-Air"},{type:"CT-MIP"},{type:"CT-Soft-Tissue",name:"CT-"},{type:"CT-Fat",name:"CT-"},{type:"CT-Lung",name:"CT-"},{type:"CT-Muscle",name:"CT-"},{type:"CT-Bone",name:"CT-"},{type:"CT-Bones",name:"CT-"},{type:"CT-Cropped-Volume-Bone",name:"CT-"},{type:"CT-Cardiac",name:"CT-"},{type:"CT-Cardiac2",name:"CT-2"},{type:"CT-Cardiac3",name:"CT-3"},{type:"CT-Chest-Contrast-Enhanced",name:"CT-"},{type:"CT-Liver-Vasculature",name:"CT-"},{type:"CT-Chest-Vessels",name:"CT-"},{type:"CT-Coronary-Arteries",name:"CT-"},{type:"CT-Coronary-Arteries-2",name:"CT-2"},{type:"CT-Coronary-Arteries-3",name:"CT-3"},{type:"CT-Pulmonary-Arteries",name:"CT-"},{type:"CT-AAA"},{type:"CT-AAA2"},{type:"MR-Default"},{type:"MR-MIP"},{type:"MR-Angio",name:"MR-"},{type:"MR-T2-Brain",name:"MR-T2-"},{type:"DTI-FA-Brain",name:"DTI-FA-"}],pr=gr,vr=new s.ComputeStore,yr=()=>{const e=k("tools"),t=D().includes("zh");return{main:[{toolName:e.seriesBar,toolTag:"seriesBar",icon:"icon-dicom-side",disActive:!0,visibility:()=>j.isMobile&&j.toolsBar.seriesBarVisibility},{toolName:e.MPR,toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:()=>j.toolsBar.MPRVisibility},{toolName:e["3D"],toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:()=>j.toolsBar.VRTVisibility},{toolName:e.fusion,toolTag:"fusion",icon:"icon-dicom-fused",disActive:!0,visibility:()=>j.toolsBar.MPRFusionVisibility&&-1!==j.imageType},{toolName:e.AI,toolTag:"AI",icon:"icon-dicom-ai",isToggle:!0,visibility:()=>j.toolsBar.AIVisibility&&!(0,s.isNull)(j.instanceOptions.AI)},{toolName:()=>at()[j.imageType+1],toolTag:"imageType",icon:()=>["icon-dicom-mode3","icon-dicom-mode1","icon-dicom-mode2"][j.imageTypeDefault+1],disActive:!0,select:!0,visibility:()=>j.toolsBar.imageModeVisibility},{toolName:e.reload,toolTag:"reload",icon:"icon-dicom-reload",disActive:!0},{toolName:e.release,toolTag:"disableAllTool",icon:"icon-dicom-release"},{toolName:e.restore,toolTag:"cancelToolAndDefaultViewport",icon:"icon-dicom-restore",disActive:!0},{toolName:e.stackScroll,toolTag:"stackScroll",icon:"icon-dicom-paging",visibility:()=>j.isMobile},{toolName:e.modulation,toolTag:"modulation",icon:"icon-dicom-tiaochuang",select:!0},{toolName:e.modulationPreset,toolTag:"modulationMenu",icon:"icon-dicom-tiaochuang2",select:!0},{toolName:e.pan,toolTag:"pan",icon:"icon-dicom-move",visibility:()=>!j.isMobile},{toolName:e.seriesLayout,toolTag:"series",icon:"icon-dicom-series",disActive:!0,select:!0},{toolName:e.imagesLayout,toolTag:"image",icon:"icon-dicom-layout",disActive:!0,select:!0},{toolName:e.magnifier,toolTag:"magnify",icon:"icon-dicom-magnifier"},{toolName:e.player,toolTag:"player",icon:"icon-dicom-play",isToggle:!0},{toolName:e.rotate,toolTag:"rotate",icon:"icon-dicom-rotate",select:!0},{toolName:e.invert,toolTag:"invert",disActive:!0,icon:"icon-dicom-negative"},{toolName:e.zoom,toolTag:"zoom",icon:"icon-dicom-scale",select:!0,visibility:()=>!j.isMobile},{toolName:e.measure,toolTag:"measureGroup",icon:"icon-dicom-measure"},{toolName:e.length,toolTag:"length",icon:"icon-dicom-line"},{toolName:e.freehandRoi,toolTag:"freehandRoi",icon:"icon-dicom-curve"},{toolName:e.angle,toolTag:"angle",icon:"icon-dicom-angle"},{toolName:e.cobbAngle,toolTag:"cobbAngle",icon:"icon-dicom-cobb"},{toolName:e.rectangleRoi,toolTag:"rectangleRoi",icon:"icon-dicom-rectangle"},{toolName:e.ellipticalRoi,toolTag:"ellipticalRoi",icon:"icon-dicom-round"},{toolName:e.circleRoi,toolTag:"circleRoi",icon:"icon-dicom-round",visibility:!1},{toolName:e.probeCT,toolTag:"probeCT",icon:"icon-dicom-ct"},{toolName:e.annotate,toolTag:"annotateGroup",icon:"icon-dicom-annotate"},{toolName:e.annotateText,toolTag:"annotateText",icon:"icon-dicom-text"},{toolName:e.annotateArrow,toolTag:"annotateArrow",icon:"icon-dicom-one-line-arrow"},{toolName:e.markerL,toolTag:"markerL",icon:"icon-dicom-L"},{toolName:e.markerR,toolTag:"markerR",icon:"icon-dicom-R"},{toolName:e.saveLabels,toolTag:"saveLabels",icon:"icon-dicom-labels-save",disActive:!0,visibility:()=>j.instanceOptions.syncLabels},{toolName:e.visibilityLabels,toolTag:"visibilityLabels",icon:"icon-dicom-labels-hidden",isToggle:!0},{toolName:e.deleteLabel,toolTag:"eraser",icon:"icon-dicom-rubber"},{toolName:e.cancelLabels,toolTag:"cancelToolState",icon:"icon-dicom-clean",disActive:!0},{toolName:e.enhance,toolTag:"enhanceGroup",icon:"icon-dicom-enhance",visibility:()=>j.toolsBar.enhanceVisibility,disChildrenCustom:!0,children:[{toolName:e.sharpen,toolTag:"sharpen",icon:"icon-dicom-sharpen"},{toolName:e.blur,toolTag:"blur",icon:"icon-dicom-blur"}]},{toolName:e.colorMap,toolTag:"colorMap",disActive:!0,icon:"icon-dicom-color-map",select:!0},{toolName:e.referenceLine,toolTag:"referenceLine",isToggle:!0,icon:"icon-dicom-referenceLine"},{toolName:e.CTR,toolTag:"CTR",icon:"icon-dicom-CTR"},{toolName:e.crosshairs2D,toolTag:"crosshairs",icon:"icon-dicom-aim"},{toolName:e.synchronizer,toolTag:"stackImageSynchronizeMode",icon:"icon-dicom-sync-mode",isLonelyGroup:!0,disChildrenCustom:!0,disActive:!0,children:[{toolName:e.stackIndexSynchronizer,toolTag:"stackIndexSynchronizer",icon:"icon-dicom-sync-index",isActive:"stackIndexSynchronizer"===j.tackSynchronizerType},{toolName:e.stackPositionSynchronizer,toolTag:"stackPositionSynchronizer",icon:"icon-dicom-sync-position",isActive:"stackPositionSynchronizer"===j.tackSynchronizerType},{toolName:e.stackScrollSynchronizer,toolTag:"stackScrollSynchronizer",icon:"icon-dicom-sync-scroll",isActive:"stackScrollSynchronizer"===j.tackSynchronizerType}]},{toolName:e.more,toolTag:"moreGroup",icon:"icon-dicom-more",isLonelyGroup:!0},{toolName:e.DICOMInfo,toolTag:"DICOMMetaInfo",disActive:!0,icon:"icon-dicom-info"},{toolName:e.aroundInfo,toolTag:"cavanAroundInfo",isToggle:!0,isActive:j.cavanAroundInfo,icon:"icon-dicom-show"},{toolName:e.disSeries,toolTag:"disSeries",icon:"icon-dicom-delete",disActive:!0},{toolName:e.saveImage,toolTag:"saveImage",icon:"icon-dicom-img-save",disActive:!0},{toolName:e.markersImage,toolTag:"markersImage",icon:"icon-dicom-key-image-save",disActive:!0,visibility:()=>j.instanceOptions.syncMarkersImage},{toolName:e.useCacheImage,toolTag:"useCacheImage",icon:"icon-dicom-save",isToggle:!0,isActive:j.DBCacheImages.enable},{toolName:e.imageCacheType,toolTag:"imageCacheType",icon:"icon-dicom-speed",isToggle:!0,isActive:1===j.imageCacheTypeDefault},{toolName:"Language",toolTag:"languageGroup",icon:"icon-dicom-language",isLonelyGroup:!0,disChildrenCustom:!0,disActive:!0,children:[...Object.entries(n.g.webDicomViewLocal).map((([e,{name:t,language:n}])=>({toolName:t,toolType:n,toolTag:"setLanguage",isActive:D()==n,visibility:"default"!==e})))],visibility:()=>j.toolsBar.languageVisibility},{toolName:e.aboutUs,toolTag:"aboutUs",icon:"icon-dicom-about",disActive:!0,floatRight:!0,visibility:()=>j.toolsBar.aboutUsVisibility}],MPR:[{toolName:e["2D"],toolTag:"MPRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:e["3D"],toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:()=>j.toolsBar.VRTVisibility},{toolName:e.fusion,toolTag:"MPRFusion",icon:"icon-dicom-fused",select:!0,disActive:!0},{toolName:e.stackScroll,toolTag:"MPRStackScroll",icon:"icon-dicom-paging",visibility:()=>j.isMobile},{toolName:e.crosshairs,toolTag:"MPRCrosshairs",icon:"icon-dicom-aim"},{toolName:e.pan,toolTag:"MPRmove",icon:"icon-dicom-move",visibility:!1},{toolName:e.modulation,toolTag:"MPRModulation",icon:"icon-dicom-tiaochuang",visibility:()=>j.isMobile},{toolName:e.zoom,toolTag:"MPRZoom",icon:"icon-dicom-scale",visibility:()=>!j.isMobile},{toolName:e.reset,toolTag:"MPRReset",icon:"icon-dicom-reload",disActive:!0},{toolName:e.blendModes,toolTag:"blendGroup",icon:"icon-dicom-projection",isLonelyGroup:!0,disChildrenCustom:!0,disActive:!0,children:[{toolName:e.blendMax,toolTag:"MPRMaxIntensity"},{toolName:e.blendMin,toolTag:"MPRMinIntensity"},{toolName:e.blendAverage,toolTag:"MPRAverageIntensity"},{toolName:e.blendComposite,toolTag:"MPRComposite",isActive:!0}]},{toolName:e.thickness,toolTag:"MPRThickness",icon:"icon-dicom-thickness",isLonelyGroup:!0,select:!0},{toolName:e.volume,toolTag:"MPRVolume",icon:"icon-dicom-volume",isToggle:!0},{toolName:e.viewportPresets,toolTag:"MPRViewportPresets",icon:"icon-dicom-color-map",isLonelyGroup:!0,disChildrenCustom:!0,children:[{toolName:e.viewportPresetsDefault,toolType:"default",toolTag:"MPRApplyPreset"},...pr.map((({type:e,name:n})=>({toolName:t&&n||e,toolType:e,toolTag:"MPRApplyPreset"})))]},{toolName:e.fusionLayout,toolTag:"MPRFusionLayout",icon:"icon-dicom-layout",isLonelyGroup:!0,disChildrenCustom:!0,disActive:!0,children:[{toolName:e.fusionLayoutDefault,toolType:"ACS9",toolTag:"MPRApplyFusionLayout",isActive:!j.isMobile},{toolName:e.fusionLayoutCoronal,toolType:"coronal",toolTag:"MPRApplyFusionLayout",isActive:j.isMobile},{toolName:e.fusionLayoutSagittal,toolType:"sagittal",toolTag:"MPRApplyFusionLayout"},{toolName:e.fusionLayoutAxial,toolType:"axial",toolTag:"MPRApplyFusionLayout"}]},{toolName:e.quality,toolTag:"MPRLevel",icon:"icon-dicom-picture-quality2",disActive:!0,visibility:()=>!1===j.instanceOptions.losslessMPR}],VRT:[{toolName:e["2D"],toolTag:"VTRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:e.MPR,toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:()=>j.toolsBar.MPRVisibility},{toolName:e.rotate,toolTag:"VRTRotate",icon:"icon-dicom-rotate3d",visibility:()=>j.isMobile},{toolName:e.VRTModulation,toolTag:"VRTModulation",icon:"icon-dicom-tiaochuang",visibility:()=>j.isMobile},{toolName:e.knifeIn,toolTag:"VRTKnifeIn",icon:"icon-dicom-shoushudao1"},{toolName:e.knifeOut,toolTag:"VRTKnifeOut",icon:"icon-dicom-shoushudao"},{toolName:e.reset,toolTag:"VRTReset",icon:"icon-dicom-reload",disActive:!0}]}},br=()=>vr.get(yr);var xr=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const wr=new s.ComputeStore,Tr=()=>{const e=k("tools");return{main:[{toolName:e.MPR},{toolName:e["3D"]},{toolName:e.fusion},{toolName:e.AI},{toolTag:"imageType"},{toolName:e.reload},{toolName:e.release},{toolName:e.restore,divider:!0},{toolName:e.modulation},{toolName:e.pan},{toolName:e.seriesLayout},{toolName:e.imagesLayout},{toolName:e.magnifier},{toolName:e.player},{toolName:e.rotate},{toolName:e.invert},{toolName:e.zoom,divider:!0},{toolName:e.measure,children:[{toolName:e.length},{toolName:e.freehandRoi,toolNameAlias:e.freehandRoi},{toolName:e.angle},{toolName:e.cobbAngle},{toolName:e.rectangleRoi},{toolName:e.ellipticalRoi},{toolName:e.probeCT}]},{toolName:e.annotate,children:[{toolName:e.annotateText},{toolName:e.annotateArrow},{toolName:e.markerL},{toolName:e.markerR}]},{toolName:e.saveLabels},{toolName:e.visibilityLabels},{toolName:e.deleteLabel},{toolName:e.cancelLabels,divider:!0},{toolName:e.synchronizer},{toolName:e.enhance},{toolName:e.colorMap},{toolName:e.referenceLine},{toolName:e.CTR},{toolName:e.crosshairs2D,divider:!0},{toolName:"Language"},{toolName:e.more,children:[{toolName:e.DICOMInfo},{toolName:e.aroundInfo},{toolName:e.disSeries},{toolName:e.saveImage},{toolName:e.markersImage},{toolName:e.useCacheImage},{toolName:e.imageCacheType}]},{toolName:e.aboutUs}],MPR:[{toolName:e["2D"]},{toolName:e["3D"]},{toolName:e.fusion},{toolName:e.stackScroll},{toolName:e.crosshairs},{toolName:e.pan},{toolName:e.modulation},{toolName:e.zoom},{toolName:e.blendModes},{toolName:e.thickness},{toolName:e.reset,divider:!0},{toolName:e.volume},{toolName:e.viewportPresets,divider:!0},{toolName:e.fusionLayout},{toolName:e.quality}],VRT:[{toolName:e["2D"]},{toolName:e.MPR},{toolName:e.rotate},{toolName:e.VRTModulation},{toolName:e.knifeIn},{toolName:e.knifeOut},{toolName:e.reset}]}},Ir=()=>{const e=k("tools");return{main:[{toolName:e.seriesBar},{toolName:e.modulation,select:!1},{toolName:e.modulationPreset},{toolName:e.stackScroll},{toolName:e.MPR},{toolName:e.measure,children:[{toolName:e.length},{toolName:e.freehandRoi,toolNameAlias:e.freehandRoi},{toolName:e.angle},{toolName:e.cobbAngle},{toolName:e.rectangleRoi},{toolName:e.ellipticalRoi,divider:!0},{toolName:e.CTR},{toolName:e.referenceLine,divider:!0},{toolName:e.probeCT},{toolName:e.annotateText},{toolName:e.annotateArrow},{toolName:e.markerL},{toolName:e.markerR,divider:!0},{toolName:e.saveLabels},{toolName:e.visibilityLabels},{toolName:e.deleteLabel},{toolName:e.cancelLabels}]},{toolName:e.major,toolTag:"majorGroup",icon:"icon-dicom-box",children:[{toolName:e.reload},{toolName:e.release},{toolName:e.restore,divider:!0},{toolName:e["3D"]},{toolName:e.crosshairs2D},{toolName:e.fusion},{toolName:e.AI,divider:!0},{toolName:e.rotate},{toolName:e.magnifier},{toolName:e.invert},{toolName:e.colorMap},{toolName:e.player,divider:!0},{toolName:e.seriesLayout},{toolName:e.imagesLayout}]},{toolName:e.enhance},{toolName:"Language"},{toolName:e.more,floatRight:!0,children:[{toolTag:"imageType"},{toolName:e.synchronizer},{toolName:e.DICOMInfo},{toolName:e.aroundInfo},{toolName:e.disSeries},{toolName:e.saveImage},{toolName:e.markersImage},{toolName:e.useCacheImage},{toolName:e.imageCacheType},{toolName:e.aboutUs}]}],MPR:[{toolName:e["2D"]},{toolName:e["3D"]},{toolName:e.fusion},{toolName:e.stackScroll},{toolName:e.crosshairs},{toolName:e.pan},{toolName:e.modulation},{toolName:e.blendModes},{toolName:e.thickness},{toolName:e.reset,divider:!0},{toolName:e.volume},{toolName:e.viewportPresets},{toolName:e.fusionLayout},{toolName:e.quality}],VRT:[{toolName:e["2D"]},{toolName:e.MPR},{toolName:e.rotate},{toolName:e.VRTModulation},{toolName:e.knifeIn},{toolName:e.knifeOut},{toolName:e.reset}]}},Er=(e,t,n,o=!1)=>{const a=br()[t],i=[];for(const r of e()){const{toolName:e,toolTag:s,children:l}=r,c=xr(r,["toolName","toolTag","children"]);let u=a.find((t=>s?t.toolTag===s:t.toolName===e));if(s||e||console.warn('"toolTag" or "toolName" is require:',r),!u&&l&&(u=Object.assign({},r)),u){if(o&&(l&&console.warn("Multi-layer menu is not recommended, which affects the interactive experience.",l),(u.children||u.select)&&console.warn("Nesting of menus is not recommended, which affects the interactive experience.",u)),l){const e=Er((()=>l),t,n,!0);e&&(u.children=e)}i.push(Object.assign(Object.assign({},n?n(u):u),c))}}return i},Sr=()=>wr.get(j.isMobile?Ir:Tr),Cr=e=>{var t,o;void 0===e&&(e=Object.keys(n.g.webDicomViewLocal).length>2&&!(!j.instanceOptions.languageDefault&&!(null===(o=null===(t=j.instanceOptions)||void 0===t?void 0:t.toolsBar)||void 0===o?void 0:o.languageVisibility)));const a=wr.get(Ir),i=wr.get(Tr);if(console.info(e?"Return to i18n menu":"Return to zh-CN menu"),!e)return{mobile:a,PC:i};const r=e=>((e,...t)=>{const n={};(e=Object.assign({},e)).disChildrenCustom&&delete e.children,e.toolTag||console.warn('"toolTag" is require:',e);for(const o of t){const t=e[o];t&&"function"!=typeof t&&(n[o]=e[o])}return n})(e,"toolName","toolTag","children");return{mobile:{main:Er((()=>a.main),"main",r),MPR:Er((()=>a.MPR),"MPR",r),VRT:Er((()=>a.VRT),"VRT",r)},PC:{main:Er((()=>i.main),"main",r),MPR:Er((()=>i.MPR),"MPR",r),VRT:Er((()=>i.VRT),"VRT",r)}}},Ar=()=>Er((()=>j.toolsBar.customMenu.main||Sr().main),"main"),Mr=()=>Er((()=>j.toolsBar.customMenu.MPR||Sr().MPR),"MPR"),Dr=()=>Er((()=>j.toolsBar.customMenu.VRT||Sr().VRT),"VRT");function Pr(e){"Error: element not enabled"!==(null==e?void 0:e.toString())&&console.error(e)}var Lr=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const kr=(0,Dt.importInternal)("util/triggerEvent"),Or={x:null,y:null},Rr={client:Or,page:Or},Nr=e=>{try{if(!e)return;const{image:t}=(0,i.getEnabledElement)(e),n=j.isMobile?[Dt.EVENTS.TOUCH_DRAG,Dt.EVENTS.TOUCH_END]:[Dt.EVENTS.MOUSE_UP],{mode:o,args:[a,r]}=Dt.store.state.globalToolChangeHistory.slice(-1)[0]||{};if("active"!==o||!r.mouseButtonMask.includes(1))return;switch(a){case"Wwwc":case"Rotate":break;case"FreehandRoi":(0,Dt.getToolForElement)(e,"FreehandRoi").cancelDrawing(e);break;default:n.forEach((n=>{kr(e,n,{image:t,element:e,startPoints:Rr,lastPoints:Rr,currentPoints:Rr,deltaPoints:Rr,type:n,isTouchEvent:!0})}))}}catch(e){Pr(e)}},_r=()=>Lr(void 0,void 0,void 0,(function*(){for(const{element:e}of(0,i.getEnabledElements)())Nr(e);yield E(),Dt.store.state.isToolLocked=!1})),Ur=new Map;function Br(e){const{key:t}=e;if(Ur.has(t))throw"keyboard keys are registered, do not repeat";Ur.set(t,e)}const Vr=class{constructor(e){const{btnTarget:t,toolData:n,toolDefault:o,classNameCopilot:a}=e;new Fr(a||"moreLayout",e,(e=>{for(const a of n.children){const{toolName:r,toolNameAlias:l,toolType:c,toolTag:u="",icon:d,isActive:h,visibility:m,divider:f,select:g,children:p}=a,v=l||("function"==typeof r?r():r),y=Object.assign(Object.assign({},a),{parentData:n}),b=(0,s.createElement)({tagName:"i",className:"iconfont"});d&&b.classList.add("function"==typeof d?d():d);const x=(0,s.createElement)({className:"text",tagName:"span",innerText:v}),w=(0,s.createElement)({className:`select-popup-item tool-event-link ${c||u}`,title:v,onclick:e=>{(0,i.triggerEvent)(i.events,"tool_event",{events:e,toolData:y,btnTarget:w,btnOriginTarget:t})}});w.dataset.toolData=JSON.stringify(y),w.dataset.toolType=c||u,h&&(w.classList.add("active"),!n.disActive&&t.classList.add("active")),u===(null==o?void 0:o.toolTag)&&(w.classList.add("active"),E().then((()=>{(0,i.triggerEvent)(i.events,"tool_event",{toolData:y,btnTarget:w,btnOriginTarget:t})}))),(!1===m||"function"==typeof m&&!m())&&w.classList.add("hidden"),f&&w.classList.add("menu-divider"),(p||g)&&w.appendChild((0,s.createElement)({tagName:"i",className:"triangle"})),w.appendChild(b),w.appendChild(x),e.appendChild(w)}}))}};const Fr=class{constructor(e,t,n,o){this.className="select-popup-layout";const{btnTarget:a,events:i,forceRender:r,destroy:l}=t;let c=this.layout=a.querySelector(`.${this.className}.${e}`);if(this.layout&&(r||l)){const e=!this.layout.classList.contains("invisible");if(this.layout.remove(),this.layout=void 0,l||e)return}if(!this.layout){c=this.layout=(0,s.createElement)({className:`${this.className} ${e} invisible`,onclick:e=>{const t=e.target,n=t.classList.contains("tool-event-link")?t:t.parentElement,o=JSON.parse(n.dataset.toolData||"{}"),{select:a,children:i,toolTag:r}=o;if(e.stopPropagation(),t!==c)if(i){const e=n.classList.toggle("open-mark");new Vr({events:{},toolData:o,btnTarget:n,classNameCopilot:"menu-nest",isMenuNest:!0,destroy:!e})}else if(a){const e=j.webDicomView.layoutView.toolsContainer.querySelector(`.${this.className}.${r}:not(.invisible)`);e&&this.setLeft({btnTarget:n,_layout:e,forceShow:!0,isMenuNest:!0})}else this.hideLayout(!0)},ontouchmove:e=>{e.stopPropagation()}});const t=(0,s.createElement)({className:"select-popup-container"});null==n||n(t),c.appendChild(t),a.appendChild(c),a.addEventListener("mouseleave",(()=>this.mouseleaveHandle())),a.addEventListener("mouseenter",(()=>this.mouseenterHandle()))}null==o||o(c),i&&this.setLeft(t)}mouseleaveHandle(){this.timer=setTimeout((()=>{this.hideLayout()}),j.isMobile?0:300)}mouseenterHandle(){this.timer&&clearTimeout(this.timer)}hideLayout(e){this.layout.classList.add("invisible"),j.webDicomView.layoutView.removeOpenMark(),e&&j.webDicomView.layoutView.selectPopupHidden()}setLeft(e){const{btnTarget:t,isMenuNest:n,_layout:o,forceShow:a,direction:i}=e,{left:r,bottom:s,top:l,right:c}=(null==t?void 0:t.getBoundingClientRect())||{},u=o||this.layout,d=j.webDicomView.globalContainer.clientWidth,h=u.clientWidth,m=u.clientHeight;n?(u.style.left=`${d-c>r?c+h>d?d-h:c:r-h>0?r-h:0}px`,u.style.top=`${l}px`):(u.style.left=`${r+h>d?d-h:r}px`,u.style.top=`${s}px`),"top"===i&&(u.style.top=l-m+"px"),u.classList.toggle("invisible",!a&&!u.classList.contains("invisible"))}};const Hr=class{constructor(){const e=at();this.data=[{title:e[0],icon:"icon-dicom-mode3",type:-1,visibility:()=>{var e,t;return null!==(t=null===(e=j.toolsBar)||void 0===e?void 0:e.fastImageModeVisibility)&&void 0!==t?t:j.toolsBar.fasModeVisibility}},{title:e[1],icon:"icon-dicom-mode1",type:0,visibility:()=>j.toolsBar.staModeVisibility},{title:e[2],icon:"icon-dicom-mode2",type:1,visibility:()=>j.toolsBar.majModeVisibility}]}createLayout(e){new Fr("imageType",Object.assign(Object.assign({},e.detail),{forceRender:!0}),(t=>{for(const n of this.data){const{title:o,icon:a,type:r,visibility:l}=n;if(!1!==(null==l?void 0:l())){const l=(0,s.createElement)({tagName:"i",className:`iconfont ${a}`}),c=(0,s.createElement)({tagName:"span",innerText:o}),u=(0,s.createElement)({className:"select-popup-item "+(j.imageType===r?"active":""),title:o,onclick:()=>{(0,i.triggerEvent)(i.events,"tool_imageType",Object.assign(Object.assign({},n),e.detail))}});u.appendChild(l),u.appendChild(c),t.appendChild(u)}}}))}handleLayout(e){let{title:t,btnTarget:n,icon:o,custom:a}=e;if(a){const e=this.data.find((e=>e.type===j.imageType));t=e.title,o=e.icon,n=j.webDicomView.layoutView.querySelectorForTool(".imageType"),j.imageType}const i=n.querySelector(".toolbar-text")||n.querySelector(".text"),r=n.querySelector("i.iconfont");n.title=t,i.innerText=t,r.className="iconfont "+o}};var jr=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};function zr(){const{color:e,modality:t}=j.webDicomView.queryImage();return e||"CT"!==t}const qr=class{constructor(){this.t=k("toast.prompt"),this.isZh=D().includes("zh"),this.data=[{title:"",name:"lungs",WW:1750,WC:-500,keyboard:{key:"F1"}},{title:"",name:"mediastinum",WW:300,WC:40,keyboard:{key:"F2"}},{title:"",name:"bone",WW:1250,WC:300,keyboard:{key:"F3"}},{title:"",name:"skull",WW:90,WC:35,keyboard:{key:"F4"}},{title:"",name:"flab",WW:400,WC:50,divider:!0,keyboard:{key:"F5"}},{title:"/",name:"custom"}];for(const e of this.data){const{keyboard:t}=e;t&&Br(Object.assign(Object.assign({},t),{callback:()=>{zr()||(0,i.triggerEvent)(i.events,"tool_WwWc",e)}}))}}createLayout(e){new Fr("modulation",Object.assign(Object.assign({},e.detail),{forceRender:!0}),(e=>{for(const t of zr()?[this.data[5]]:this.data){const{title:n,name:o,divider:a,keyboard:r}=t,l=(0,s.createElement)({className:"select-popup-item",title:n,innerText:this.isZh?n:p(o),onclick:()=>{(0,i.triggerEvent)(i.events,"tool_WwWc",t)}});a&&l.classList.add("menu-divider"),r&&!j.isMobile&&(l.innerHTML+=`<span style='color:#ffffffb0;'>&nbsp;${r.key}</span>`),e.appendChild(l)}}))}handleLayout(e,t){return jr(this,void 0,void 0,(function*(){const{enterWL:n,example:o,verificationError:a}=this.t;let{name:r,WW:s,WC:l}=t;const c=e.querySelector(".layoutImage.active");if(e=c||e,"custom"===r){const e=yield bn(`${n}(${o}255&emsp;128`,/^[-+]?\d+(\.\d*)?[a-zA-Z\s;',/\\/]+[-+]?\d+(\.\d*)?$/,a);if(!e)return;const t=e.split(/[a-zA-Z\s;',/\\/]+/);[s,l]=[parseFloat(t[0]),parseFloat(t[1])]}isNaN(s)||isNaN(l)||(0,i.setViewport)(e,{voi:{windowWidth:s,windowCenter:l}})}))}};const Wr=class{constructor(){const{restore:e,counterclockwise90:t,clockwise90:n,HFlip:o,VFlip:a}=k("rotate");this.data=[{title:e,name:"default",icon:"icon-dicom-restore"},{title:t,name:"anticlockwise",icon:"icon-dicom-rotate90R"},{title:n,name:"clockwise",icon:"icon-dicom-rotate90L"},{title:o,name:"leftRight",icon:"icon-dicom-leftRight"},{title:a,name:"upDown",icon:"icon-dicom-upDown"}]}createLayout(e){new Fr("rotate",e.detail,(e=>{for(const t of this.data){const{title:n,icon:o}=t,a=(0,s.createElement)({tagName:"i",className:"iconfont "+o}),r=(0,s.createElement)({tagName:"span",innerText:n}),l=(0,s.createElement)({className:"select-popup-item",title:n,onclick:()=>{(0,i.triggerEvent)(i.events,"tool_rotate",t)}});l.appendChild(a),l.appendChild(r),e.appendChild(l)}}))}handleLayout(e,t){const{name:n}=t,o=e.querySelector(".layoutImage.active");e=o||e;let a=(0,i.getViewport)(e);switch(n){case"default":a.rotation=0,a.hflip=!1,a.vflip=!1;break;case"anticlockwise":a.rotation-=90;break;case"clockwise":a.rotation+=90;break;case"leftRight":a.hflip=!a.hflip;break;case"upDown":a.vflip=!a.vflip}(0,i.setViewport)(e,a)}},Gr=(0,Dt.importInternal)("util/convertToVector3"),Yr=.1;function Zr(e,t){if("stackPositionSynchronizer"===j.tackSynchronizerType){const n=i.metaData.get("imagePlaneModule",(0,i.getEnabledElement)(e).image.imageId),o=i.metaData.get("imagePlaneModule",(0,i.getEnabledElement)(t).image.imageId),a=Gr(n.rowCosines).distanceToSquared(Gr(o.rowCosines)),r=Gr(n.columnCosines).distanceToSquared(Gr(o.columnCosines));return a<Yr&&r<Yr}return!0}function Kr(e,t,n){if(n===t)return;if(!Zr(t,n))return;const o=(0,i.getViewport)(t),a=(0,i.getViewport)(n);a.colormap!==o.colormap&&(a.colormap=o.colormap,e.setViewport(n,a))}function Xr(e,t,n){if(n===t)return;if(!Zr(t,n))return;const o=(0,i.getViewport)(t),a=(0,i.getViewport)(n);a.invert!==o.invert&&(a.invert=o.invert,e.setViewport(n,a))}function Jr(e,t,n){if(n===t)return;if(!Zr(t,n))return;const o=(0,i.getViewport)(t),a=(0,i.getViewport)(n);a.rotation===o.rotation&&a.hflip===o.hflip&&a.vflip===o.vflip||(a.rotation=o.rotation,a.hflip=o.hflip,a.vflip=o.vflip,e.setViewport(n,a))}function Qr(e,t,n){if(n===t)return;if(!Zr(t,n))return;const o=(0,i.getViewport)(t),a=(0,i.getViewport)(n);a.translation.x===o.translation.x&&a.translation.y===o.translation.y||(a.translation.x=o.translation.x,a.translation.y=o.translation.y,e.setViewport(n,a))}function $r(e,t,n){if(n===t)return;if(!Zr(t,n))return;const o=(0,i.getViewport)(t),a=(0,i.getViewport)(n);a.voi.windowWidth===o.voi.windowWidth&&a.voi.windowCenter===o.voi.windowCenter||(a.voi.windowWidth=o.voi.windowWidth,a.voi.windowCenter=o.voi.windowCenter,e.setViewport(n,a))}function es(e,t,n){if(n===t)return;if(!Zr(t,n))return;const o=(0,i.getViewport)(t),a=(0,i.getViewport)(n);a.scale!==o.scale&&(a.scale=o.scale,e.setViewport(n,a))}let ts=new Dt.Synchronizer(i.EVENTS.IMAGE_RENDERED,(()=>{}));const ns=(0,s.debounce)((function(){return Bo(ts,!1)}),500);function os(e){const t=ts.getHandler();ts.setHandler(((n,o,a,i,...r)=>{null==t||t(n,o,a,i,...r),e(n,o,a,i,...r)}))}function as(){ts.destroy()}i.colors.getColormap("myCustomColorMap",{name:"myCustomColorMap",numColors:256,gamma:1,segmentedData:{red:[[0,1,0],[1,1,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}});const is=[{id:"gray",name:"",icon:n(1008)},{id:"blues",name:"",icon:n(3522)},{id:"bone",name:"",icon:n(2007)},{id:"cool",name:"Cool",icon:n(6030)},{id:"coolwarm",name:"",icon:n(9141)},{id:"copper",name:"",icon:n(642)},{id:"hot",name:"",icon:n(9572)},{id:"hotIron",name:"",icon:n(8962)},{id:"hotMetalBlue",name:"",icon:n(2723)},{id:"hsv",name:"HSV",icon:n(6178)},{id:"jet",name:"Jet",icon:n(904)},{id:"pet",name:"PET",icon:n(6446)},{id:"pet20Step",name:"PET 20 Step",icon:n(6206)},{id:"spectral",name:"",icon:n(2489)},{id:"spring",name:"",icon:n(9662)},{id:"summer",name:"",icon:n(8774)},{id:"autumn",name:"",icon:n(8011)},{id:"winter",name:"",icon:n(7990)}];const rs=class{constructor(){this.data=is}createLayout(e){new Fr("colorMap",e.detail,(e=>{for(const t of this.data){const{id:n,icon:o,name:a}=t,r=(0,s.createElement)({tagName:"div",className:"select-grid-item2",title:D().includes("zh")?n==a?n:`${n},${a}`:p(n),onclick:()=>{(0,i.triggerEvent)(i.events,"tool_colorMap",t)}}),l=(0,s.createElement)({tagName:"img",width:30,height:30,src:o});r.appendChild(l),e.appendChild(r)}e.setAttribute("style","\n\t\t\t\t\tdisplay: grid;\n\t\t\t\t\tgrid-template-columns: repeat(4, 40px);\n\t\t\t\t\tpadding: 4px;\n\t\t\t \t")}))}handleLayout(e,t){const{id:n}=t,o=e.querySelector(".layoutImage.active");e=o||e,os(Kr),(0,i.setViewport)(e,{colormap:n})}};var ss=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const{zoomTool:{minScale:ls,maxScale:cs}}=j.toolsOptions;const us=class{constructor(){this.t=k("toast.prompt"),this.data=[{title:k("other").custom,name:"custom"}]}createLayout(e){new Fr("scale",e.detail,(e=>{for(const t of this.data){const{title:n}=t,o=(0,s.createElement)({className:"select-popup-item",title:n,innerText:n,onclick:()=>{(0,i.triggerEvent)(i.events,"tool_scale",t)}});e.appendChild(o)}}))}handleLayout(e,t){return ss(this,void 0,void 0,(function*(){const{enterScale:n,example:o,verificationError:a}=this.t;let{name:r}=t,s=null;"custom"===r&&(s=yield bn(`${n}(${o}${ls}~${cs}`,(e=>/^\d+(\.\d*)?$/.test(e)&&e>=ls&&e<=cs),a)),null!==s&&(0,i.setViewport)(e,{scale:Number(s)})}))}};function ds(e,t=D()){return e&&""!=e?(e=e.replace(/^0+/,""),t.includes("zh")?(e=e.replace("Y","").replace("M","").replace("M","").replace("D","")).includes("")?e:e+"":e):""}function hs(e,t=D()){return e&&""!=e?(e=e.replace(/\s/g,""),t.includes("zh")?"F"==e?"":"M"==e?"":e:e):""}const ms=class{constructor(){this.DICOMTags=k("DICOMTags")}createSeriesMarker(e){const t=e.querySelector(".ltMarker"),n=e.querySelector(".rtMarker"),o=e.querySelector(".lbMarker"),a=e.querySelector(".rbMarker"),i="\n\t\tposition: absolute;\n\t\tfont-size: 10px;\n\t\ttext-shadow: 1px 1px 1px #000;\n\t\tcursor: default;\n\t\tpointer-events: none;\n\t\t";if(!t){const t=(0,s.createElement)({className:"ltMarker"});t.style.cssText=i+"left: 3px;top: 3px;text-align: left;",e.appendChild(t)}if(!n){const t=(0,s.createElement)({className:"rtMarker"});t.style.cssText=i+`right: ${j.isMobile?6:16}px;top: 3px;text-align: right;`,e.appendChild(t)}if(!o){const t=(0,s.createElement)({className:"lbMarker"});t.style.cssText=i+"left: 3px;bottom: 3px;text-align: left;",e.appendChild(t)}if(!a){const t=(0,s.createElement)({className:"rbMarker"});t.style.cssText=i+`right: ${j.isMobile?6:16}px;bottom: 3px;text-align: right;`,e.appendChild(t)}}createParagraph(e,t,n,o,a){this.createSeriesMarker(e);let i=e.querySelector(`.${t}`);const{name:r,modality:l,age:c,sex:u,date:d,imageNumber:h,KVP:m,thickness:f,scale:g,windowCenter:p,windowWidth:v}=this.DICOMTags;if(i)switch(i.innerHTML="",t){case"ltMarker":{const e=(0,s.createElement)({tagName:"p",innerText:`${r}${(null==a?void 0:a.name)||n.name}`}),t=(0,s.createElement)({tagName:"p",innerText:"ID"+((null==a?void 0:a.patientID)||n.patid)}),o=(0,s.createElement)({tagName:"p",innerText:`${l}${n.mod}`}),d=(0,s.createElement)({tagName:"p",innerText:`${u}${hs((null==a?void 0:a.sex)||n.sex)}`}),h=(0,s.createElement)({tagName:"p",innerText:`${c}${ds((null==a?void 0:a.age)||n.age)}`});i.appendChild(e),i.appendChild(t),i.appendChild(o),i.appendChild(d),i.appendChild(h);break}case"rtMarker":{const e=(0,s.createElement)({tagName:"p",innerText:`${d}${n.acqdt||(null==a?void 0:a.studydate)}`}),t=(0,s.createElement)({tagName:"p",className:"filmMarker",innerText:`${h}`+[(null==a?void 0:a.studyID)||n.stuid,n.serid,n.imgnum].join("-").replace(/-{2,}/,"-")});i.appendChild(e),i.appendChild(t);break}case"lbMarker":{const e=(0,s.createElement)({tagName:"p",innerText:`${m}${n.kv}`}),t=(0,s.createElement)({tagName:"p",innerText:`${f}${n.sliceth}`});i.appendChild(e),i.appendChild(t);break}case"rbMarker":{const e=(0,s.createElement)({tagName:"p",className:"scaleMarker",innerText:`${g}${Number(o.scale).toFixed(2)}`}),t=(0,s.createElement)({tagName:"p",className:"wwWMarker",innerText:`${p}${o.voi.windowWidth}`}),r=(0,s.createElement)({tagName:"p",className:"wwHMarker",innerText:`${v}${o.voi.windowCenter}`}),l=(0,s.createElement)({tagName:"p",innerText:(null==a?void 0:a.orgname)||n.inst});i.appendChild(e),i.appendChild(t),i.appendChild(r),i.appendChild(l);break}}}};var fs=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const gs=function(){return fs(this,void 0,void 0,(function*(){for(const{element:e}of yield _o(!1))(0,i.updateImage)(e)}))};function ps(e,t){return function(){return e.apply(t,arguments)}}const{toString:vs}=Object.prototype,{getPrototypeOf:ys}=Object,bs=(xs=Object.create(null),e=>{const t=vs.call(e);return xs[t]||(xs[t]=t.slice(8,-1).toLowerCase())});var xs;const ws=e=>(e=e.toLowerCase(),t=>bs(t)===e),Ts=e=>t=>typeof t===e,{isArray:Is}=Array,Es=Ts("undefined");const Ss=ws("ArrayBuffer");const Cs=Ts("string"),As=Ts("function"),Ms=Ts("number"),Ds=e=>null!==e&&"object"==typeof e,Ps=e=>{if("object"!==bs(e))return!1;const t=ys(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},Ls=ws("Date"),ks=ws("File"),Os=ws("Blob"),Rs=ws("FileList"),Ns=ws("URLSearchParams"),[_s,Us,Bs,Vs]=["ReadableStream","Request","Response","Headers"].map(ws);function Fs(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let o,a;if("object"!=typeof e&&(e=[e]),Is(e))for(o=0,a=e.length;o<a;o++)t.call(null,e[o],o,e);else{const a=n?Object.getOwnPropertyNames(e):Object.keys(e),i=a.length;let r;for(o=0;o<i;o++)r=a[o],t.call(null,e[r],r,e)}}function Hs(e,t){t=t.toLowerCase();const n=Object.keys(e);let o,a=n.length;for(;a-- >0;)if(o=n[a],t===o.toLowerCase())return o;return null}const js="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,zs=e=>!Es(e)&&e!==js;const qs=(Ws="undefined"!=typeof Uint8Array&&ys(Uint8Array),e=>Ws&&e instanceof Ws);var Ws;const Gs=ws("HTMLFormElement"),Ys=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Zs=ws("RegExp"),Ks=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),o={};Fs(n,((n,a)=>{let i;!1!==(i=t(n,a,e))&&(o[a]=i||n)})),Object.defineProperties(e,o)},Xs="abcdefghijklmnopqrstuvwxyz",Js="0123456789",Qs={DIGIT:Js,ALPHA:Xs,ALPHA_DIGIT:Xs+Xs.toUpperCase()+Js};const $s=ws("AsyncFunction"),el={isArray:Is,isArrayBuffer:Ss,isBuffer:function(e){return null!==e&&!Es(e)&&null!==e.constructor&&!Es(e.constructor)&&As(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||As(e.append)&&("formdata"===(t=bs(e))||"object"===t&&As(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ss(e.buffer),t},isString:Cs,isNumber:Ms,isBoolean:e=>!0===e||!1===e,isObject:Ds,isPlainObject:Ps,isReadableStream:_s,isRequest:Us,isResponse:Bs,isHeaders:Vs,isUndefined:Es,isDate:Ls,isFile:ks,isBlob:Os,isRegExp:Zs,isFunction:As,isStream:e=>Ds(e)&&As(e.pipe),isURLSearchParams:Ns,isTypedArray:qs,isFileList:Rs,forEach:Fs,merge:function e(){const{caseless:t}=zs(this)&&this||{},n={},o=(o,a)=>{const i=t&&Hs(n,a)||a;Ps(n[i])&&Ps(o)?n[i]=e(n[i],o):Ps(o)?n[i]=e({},o):Is(o)?n[i]=o.slice():n[i]=o};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Fs(arguments[e],o);return n},extend:(e,t,n,{allOwnKeys:o}={})=>(Fs(t,((t,o)=>{n&&As(t)?e[o]=ps(t,n):e[o]=t}),{allOwnKeys:o}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,o)=>{let a,i,r;const s={};if(t=t||{},null==e)return t;do{for(a=Object.getOwnPropertyNames(e),i=a.length;i-- >0;)r=a[i],o&&!o(r,e,t)||s[r]||(t[r]=e[r],s[r]=!0);e=!1!==n&&ys(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:bs,kindOfTest:ws,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const o=e.indexOf(t,n);return-1!==o&&o===n},toArray:e=>{if(!e)return null;if(Is(e))return e;let t=e.length;if(!Ms(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=n.next())&&!o.done;){const n=o.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const o=[];for(;null!==(n=e.exec(t));)o.push(n);return o},isHTMLForm:Gs,hasOwnProperty:Ys,hasOwnProp:Ys,reduceDescriptors:Ks,freezeMethods:e=>{Ks(e,((t,n)=>{if(As(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const o=e[n];As(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},o=e=>{e.forEach((e=>{n[e]=!0}))};return Is(e)?o(e):o(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Hs,global:js,isContextDefined:zs,ALPHABET:Qs,generateString:(e=16,t=Qs.ALPHA_DIGIT)=>{let n="";const{length:o}=t;for(;e--;)n+=t[Math.random()*o|0];return n},isSpecCompliantForm:function(e){return!!(e&&As(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,o)=>{if(Ds(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[o]=e;const a=Is(e)?[]:{};return Fs(e,((e,t)=>{const i=n(e,o+1);!Es(i)&&(a[t]=i)})),t[o]=void 0,a}}return e};return n(e,0)},isAsyncFn:$s,isThenable:e=>e&&(Ds(e)||As(e))&&As(e.then)&&As(e.catch)};function tl(e,t,n,o,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),o&&(this.request=o),a&&(this.response=a)}el.inherits(tl,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:el.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const nl=tl.prototype,ol={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{ol[e]={value:e}})),Object.defineProperties(tl,ol),Object.defineProperty(nl,"isAxiosError",{value:!0}),tl.from=(e,t,n,o,a,i)=>{const r=Object.create(nl);return el.toFlatObject(e,r,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),tl.call(r,e.message,t,n,o,a),r.cause=e,r.name=e.name,i&&Object.assign(r,i),r};const al=tl;function il(e){return el.isPlainObject(e)||el.isArray(e)}function rl(e){return el.endsWith(e,"[]")?e.slice(0,-2):e}function sl(e,t,n){return e?e.concat(t).map((function(e,t){return e=rl(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const ll=el.toFlatObject(el,{},null,(function(e){return/^is[A-Z]/.test(e)}));const cl=function(e,t,n){if(!el.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=el.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!el.isUndefined(t[e])}));const o=n.metaTokens,a=n.visitor||c,i=n.dots,r=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&el.isSpecCompliantForm(t);if(!el.isFunction(a))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(el.isDate(e))return e.toISOString();if(!s&&el.isBlob(e))throw new al("Blob is not supported. Use a Buffer instead.");return el.isArrayBuffer(e)||el.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,a){let s=e;if(e&&!a&&"object"==typeof e)if(el.endsWith(n,"{}"))n=o?n:n.slice(0,-2),e=JSON.stringify(e);else if(el.isArray(e)&&function(e){return el.isArray(e)&&!e.some(il)}(e)||(el.isFileList(e)||el.endsWith(n,"[]"))&&(s=el.toArray(e)))return n=rl(n),s.forEach((function(e,o){!el.isUndefined(e)&&null!==e&&t.append(!0===r?sl([n],o,i):null===r?n:n+"[]",l(e))})),!1;return!!il(e)||(t.append(sl(a,n,i),l(e)),!1)}const u=[],d=Object.assign(ll,{defaultVisitor:c,convertValue:l,isVisitable:il});if(!el.isObject(e))throw new TypeError("data must be an object");return function e(n,o){if(!el.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+o.join("."));u.push(n),el.forEach(n,(function(n,i){!0===(!(el.isUndefined(n)||null===n)&&a.call(t,n,el.isString(i)?i.trim():i,o,d))&&e(n,o?o.concat(i):[i])})),u.pop()}}(e),t};function ul(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function dl(e,t){this._pairs=[],e&&cl(e,this,t)}const hl=dl.prototype;hl.append=function(e,t){this._pairs.push([e,t])},hl.toString=function(e){const t=e?function(t){return e.call(this,t,ul)}:ul;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const ml=dl;function fl(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function gl(e,t,n){if(!t)return e;const o=n&&n.encode||fl,a=n&&n.serialize;let i;if(i=a?a(t,n):el.isURLSearchParams(t)?t.toString():new ml(t,n).toString(o),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}const pl=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){el.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},vl={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yl={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:ml,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},bl="undefined"!=typeof window&&"undefined"!=typeof document,xl=(wl="undefined"!=typeof navigator&&navigator.product,bl&&["ReactNative","NativeScript","NS"].indexOf(wl)<0);var wl;const Tl="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Il=bl&&window.location.href||"http://localhost",El={...a,...yl};const Sl=function(e){function t(e,n,o,a){let i=e[a++];if("__proto__"===i)return!0;const r=Number.isFinite(+i),s=a>=e.length;if(i=!i&&el.isArray(o)?o.length:i,s)return el.hasOwnProp(o,i)?o[i]=[o[i],n]:o[i]=n,!r;o[i]&&el.isObject(o[i])||(o[i]=[]);return t(e,n,o[i],a)&&el.isArray(o[i])&&(o[i]=function(e){const t={},n=Object.keys(e);let o;const a=n.length;let i;for(o=0;o<a;o++)i=n[o],t[i]=e[i];return t}(o[i])),!r}if(el.isFormData(e)&&el.isFunction(e.entries)){const n={};return el.forEachEntry(e,((e,o)=>{t(function(e){return el.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),o,n,0)})),n}return null};const Cl={transitional:vl,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",o=n.indexOf("application/json")>-1,a=el.isObject(e);a&&el.isHTMLForm(e)&&(e=new FormData(e));if(el.isFormData(e))return o?JSON.stringify(Sl(e)):e;if(el.isArrayBuffer(e)||el.isBuffer(e)||el.isStream(e)||el.isFile(e)||el.isBlob(e)||el.isReadableStream(e))return e;if(el.isArrayBufferView(e))return e.buffer;if(el.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return cl(e,new El.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,o){return El.isNode&&el.isBuffer(e)?(this.append(t,e.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=el.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return cl(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return a||o?(t.setContentType("application/json",!1),function(e,t,n){if(el.isString(e))try{return(t||JSON.parse)(e),el.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Cl.transitional,n=t&&t.forcedJSONParsing,o="json"===this.responseType;if(el.isResponse(e)||el.isReadableStream(e))return e;if(e&&el.isString(e)&&(n&&!this.responseType||o)){const n=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw al.from(e,al.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:El.classes.FormData,Blob:El.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};el.forEach(["delete","get","head","post","put","patch"],(e=>{Cl.headers[e]={}}));const Al=Cl,Ml=el.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Dl=Symbol("internals");function Pl(e){return e&&String(e).trim().toLowerCase()}function Ll(e){return!1===e||null==e?e:el.isArray(e)?e.map(Ll):String(e)}function kl(e,t,n,o,a){return el.isFunction(o)?o.call(this,t,n):(a&&(t=n),el.isString(t)?el.isString(o)?-1!==t.indexOf(o):el.isRegExp(o)?o.test(t):void 0:void 0)}class Ol{constructor(e){e&&this.set(e)}set(e,t,n){const o=this;function a(e,t,n){const a=Pl(t);if(!a)throw new Error("header name must be a non-empty string");const i=el.findKey(o,a);(!i||void 0===o[i]||!0===n||void 0===n&&!1!==o[i])&&(o[i||t]=Ll(e))}const i=(e,t)=>el.forEach(e,((e,n)=>a(e,n,t)));if(el.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(el.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let n,o,a;return e&&e.split("\n").forEach((function(e){a=e.indexOf(":"),n=e.substring(0,a).trim().toLowerCase(),o=e.substring(a+1).trim(),!n||t[n]&&Ml[n]||("set-cookie"===n?t[n]?t[n].push(o):t[n]=[o]:t[n]=t[n]?t[n]+", "+o:o)})),t})(e),t);else if(el.isHeaders(e))for(const[t,o]of e.entries())a(o,t,n);else null!=e&&a(t,e,n);return this}get(e,t){if(e=Pl(e)){const n=el.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=n.exec(e);)t[o[1]]=o[2];return t}(e);if(el.isFunction(t))return t.call(this,e,n);if(el.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Pl(e)){const n=el.findKey(this,e);return!(!n||void 0===this[n]||t&&!kl(0,this[n],n,t))}return!1}delete(e,t){const n=this;let o=!1;function a(e){if(e=Pl(e)){const a=el.findKey(n,e);!a||t&&!kl(0,n[a],a,t)||(delete n[a],o=!0)}}return el.isArray(e)?e.forEach(a):a(e),o}clear(e){const t=Object.keys(this);let n=t.length,o=!1;for(;n--;){const a=t[n];e&&!kl(0,this[a],a,e,!0)||(delete this[a],o=!0)}return o}normalize(e){const t=this,n={};return el.forEach(this,((o,a)=>{const i=el.findKey(n,a);if(i)return t[i]=Ll(o),void delete t[a];const r=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(a):String(a).trim();r!==a&&delete t[a],t[r]=Ll(o),n[r]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return el.forEach(this,((n,o)=>{null!=n&&!1!==n&&(t[o]=e&&el.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[Dl]=this[Dl]={accessors:{}}).accessors,n=this.prototype;function o(e){const o=Pl(e);t[o]||(!function(e,t){const n=el.toCamelCase(" "+t);["get","set","has"].forEach((o=>{Object.defineProperty(e,o+n,{value:function(e,n,a){return this[o].call(this,t,e,n,a)},configurable:!0})}))}(n,e),t[o]=!0)}return el.isArray(e)?e.forEach(o):o(e),this}}Ol.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),el.reduceDescriptors(Ol.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),el.freezeMethods(Ol);const Rl=Ol;function Nl(e,t){const n=this||Al,o=t||n,a=Rl.from(o.headers);let i=o.data;return el.forEach(e,(function(e){i=e.call(n,i,a.normalize(),t?t.status:void 0)})),a.normalize(),i}function _l(e){return!(!e||!e.__CANCEL__)}function Ul(e,t,n){al.call(this,null==e?"canceled":e,al.ERR_CANCELED,t,n),this.name="CanceledError"}el.inherits(Ul,al,{__CANCEL__:!0});const Bl=Ul;function Vl(e,t,n){const o=n.config.validateStatus;n.status&&o&&!o(n.status)?t(new al("Request failed with status code "+n.status,[al.ERR_BAD_REQUEST,al.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const Fl=function(e,t){e=e||10;const n=new Array(e),o=new Array(e);let a,i=0,r=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=o[r];a||(a=l),n[i]=s,o[i]=l;let u=r,d=0;for(;u!==i;)d+=n[u++],u%=e;if(i=(i+1)%e,i===r&&(r=(r+1)%e),l-a<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}};const Hl=function(e,t){let n=0;const o=1e3/t;let a=null;return function(){const t=!0===this,i=Date.now();if(t||i-n>o)return a&&(clearTimeout(a),a=null),n=i,e.apply(null,arguments);a||(a=setTimeout((()=>(a=null,n=Date.now(),e.apply(null,arguments))),o-(i-n)))}},jl=(e,t,n=3)=>{let o=0;const a=Fl(50,250);return Hl((n=>{const i=n.loaded,r=n.lengthComputable?n.total:void 0,s=i-o,l=a(s);o=i;const c={loaded:i,total:r,progress:r?i/r:void 0,bytes:s,rate:l||void 0,estimated:l&&r&&i<=r?(r-i)/l:void 0,event:n,lengthComputable:null!=r};c[t?"download":"upload"]=!0,e(c)}),n)},zl=El.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function o(n){let o=n;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=o(window.location.href),function(e){const t=el.isString(e)?o(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0},ql=El.hasStandardBrowserEnv?{write(e,t,n,o,a,i){const r=[e+"="+encodeURIComponent(t)];el.isNumber(n)&&r.push("expires="+new Date(n).toGMTString()),el.isString(o)&&r.push("path="+o),el.isString(a)&&r.push("domain="+a),!0===i&&r.push("secure"),document.cookie=r.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Wl(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Gl=e=>e instanceof Rl?{...e}:e;function Yl(e,t){t=t||{};const n={};function o(e,t,n){return el.isPlainObject(e)&&el.isPlainObject(t)?el.merge.call({caseless:n},e,t):el.isPlainObject(t)?el.merge({},t):el.isArray(t)?t.slice():t}function a(e,t,n){return el.isUndefined(t)?el.isUndefined(e)?void 0:o(void 0,e,n):o(e,t,n)}function i(e,t){if(!el.isUndefined(t))return o(void 0,t)}function r(e,t){return el.isUndefined(t)?el.isUndefined(e)?void 0:o(void 0,e):o(void 0,t)}function s(n,a,i){return i in t?o(n,a):i in e?o(void 0,n):void 0}const l={url:i,method:i,data:i,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:s,headers:(e,t)=>a(Gl(e),Gl(t),!0)};return el.forEach(Object.keys(Object.assign({},e,t)),(function(o){const i=l[o]||a,r=i(e[o],t[o],o);el.isUndefined(r)&&i!==s||(n[o]=r)})),n}const Zl=e=>{const t=Yl({},e);let n,{data:o,withXSRFToken:a,xsrfHeaderName:i,xsrfCookieName:r,headers:s,auth:l}=t;if(t.headers=s=Rl.from(s),t.url=gl(Wl(t.baseURL,t.url),e.params,e.paramsSerializer),l&&s.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),el.isFormData(o))if(El.hasStandardBrowserEnv||El.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(El.hasStandardBrowserEnv&&(a&&el.isFunction(a)&&(a=a(t)),a||!1!==a&&zl(t.url))){const e=i&&r&&ql.read(r);e&&s.set(i,e)}return t},Kl="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){const o=Zl(e);let a=o.data;const i=Rl.from(o.headers).normalize();let r,{responseType:s}=o;function l(){o.cancelToken&&o.cancelToken.unsubscribe(r),o.signal&&o.signal.removeEventListener("abort",r)}let c=new XMLHttpRequest;function u(){if(!c)return;const o=Rl.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());Vl((function(e){t(e),l()}),(function(e){n(e),l()}),{data:s&&"text"!==s&&"json"!==s?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:o,config:e,request:c}),c=null}c.open(o.method.toUpperCase(),o.url,!0),c.timeout=o.timeout,"onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(u)},c.onabort=function(){c&&(n(new al("Request aborted",al.ECONNABORTED,o,c)),c=null)},c.onerror=function(){n(new al("Network Error",al.ERR_NETWORK,o,c)),c=null},c.ontimeout=function(){let e=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const t=o.transitional||vl;o.timeoutErrorMessage&&(e=o.timeoutErrorMessage),n(new al(e,t.clarifyTimeoutError?al.ETIMEDOUT:al.ECONNABORTED,o,c)),c=null},void 0===a&&i.setContentType(null),"setRequestHeader"in c&&el.forEach(i.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),el.isUndefined(o.withCredentials)||(c.withCredentials=!!o.withCredentials),s&&"json"!==s&&(c.responseType=o.responseType),"function"==typeof o.onDownloadProgress&&c.addEventListener("progress",jl(o.onDownloadProgress,!0)),"function"==typeof o.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",jl(o.onUploadProgress)),(o.cancelToken||o.signal)&&(r=t=>{c&&(n(!t||t.type?new Bl(null,e,c):t),c.abort(),c=null)},o.cancelToken&&o.cancelToken.subscribe(r),o.signal&&(o.signal.aborted?r():o.signal.addEventListener("abort",r)));const d=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(o.url);d&&-1===El.protocols.indexOf(d)?n(new al("Unsupported protocol "+d+":",al.ERR_BAD_REQUEST,e)):c.send(a||null)}))},Xl=(e,t)=>{let n,o=new AbortController;const a=function(e){if(!n){n=!0,r();const t=e instanceof Error?e:this.reason;o.abort(t instanceof al?t:new Bl(t instanceof Error?t.message:t))}};let i=t&&setTimeout((()=>{a(new al(`timeout ${t} of ms exceeded`,al.ETIMEDOUT))}),t);const r=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach((e=>{e&&(e.removeEventListener?e.removeEventListener("abort",a):e.unsubscribe(a))})),e=null)};e.forEach((e=>e&&e.addEventListener&&e.addEventListener("abort",a)));const{signal:s}=o;return s.unsubscribe=r,[s,()=>{i&&clearTimeout(i),i=null}]},Jl=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let o,a=0;for(;a<n;)o=a+t,yield e.slice(a,o),a=o},Ql=(e,t,n,o,a)=>{const i=async function*(e,t,n){for await(const o of e)yield*Jl(ArrayBuffer.isView(o)?o:await n(String(o)),t)}(e,t,a);let r=0;return new ReadableStream({type:"bytes",async pull(e){const{done:t,value:a}=await i.next();if(t)return e.close(),void o();let s=a.byteLength;n&&n(r+=s),e.enqueue(new Uint8Array(a))},cancel:e=>(o(e),i.return())},{highWaterMark:2})},$l=(e,t)=>{const n=null!=e;return o=>setTimeout((()=>t({lengthComputable:n,total:e,loaded:o})))},ec="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,tc=ec&&"function"==typeof ReadableStream,nc=ec&&("function"==typeof TextEncoder?(oc=new TextEncoder,e=>oc.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var oc;const ac=tc&&(()=>{let e=!1;const t=new Request(El.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})(),ic=tc&&!!(()=>{try{return el.isReadableStream(new Response("").body)}catch(e){}})(),rc={stream:ic&&(e=>e.body)};var sc;ec&&(sc=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!rc[e]&&(rc[e]=el.isFunction(sc[e])?t=>t[e]():(t,n)=>{throw new al(`Response type '${e}' is not supported`,al.ERR_NOT_SUPPORT,n)})})));const lc=async(e,t)=>{const n=el.toFiniteNumber(e.getContentLength());return null==n?(async e=>null==e?0:el.isBlob(e)?e.size:el.isSpecCompliantForm(e)?(await new Request(e).arrayBuffer()).byteLength:el.isArrayBufferView(e)?e.byteLength:(el.isURLSearchParams(e)&&(e+=""),el.isString(e)?(await nc(e)).byteLength:void 0))(t):n},cc=ec&&(async e=>{let{url:t,method:n,data:o,signal:a,cancelToken:i,timeout:r,onDownloadProgress:s,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:h}=Zl(e);c=c?(c+"").toLowerCase():"text";let m,f,[g,p]=a||i||r?Xl([a,i],r):[];const v=()=>{!m&&setTimeout((()=>{g&&g.unsubscribe()})),m=!0};let y;try{if(l&&ac&&"get"!==n&&"head"!==n&&0!==(y=await lc(u,o))){let e,n=new Request(t,{method:"POST",body:o,duplex:"half"});el.isFormData(o)&&(e=n.headers.get("content-type"))&&u.setContentType(e),n.body&&(o=Ql(n.body,65536,$l(y,jl(l)),null,nc))}el.isString(d)||(d=d?"cors":"omit"),f=new Request(t,{...h,signal:g,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:o,duplex:"half",withCredentials:d});let a=await fetch(f);const i=ic&&("stream"===c||"response"===c);if(ic&&(s||i)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=a[t]}));const t=el.toFiniteNumber(a.headers.get("content-length"));a=new Response(Ql(a.body,65536,s&&$l(t,jl(s,!0)),i&&v,nc),e)}c=c||"text";let r=await rc[el.findKey(rc,c)||"text"](a,e);return!i&&v(),p&&p(),await new Promise(((t,n)=>{Vl(t,n,{data:r,headers:Rl.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:f})}))}catch(t){if(v(),t&&"TypeError"===t.name&&/fetch/i.test(t.message))throw Object.assign(new al("Network Error",al.ERR_NETWORK,e,f),{cause:t.cause||t});throw al.from(t,t&&t.code,e,f)}}),uc={http:null,xhr:Kl,fetch:cc};el.forEach(uc,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const dc=e=>`- ${e}`,hc=e=>el.isFunction(e)||null===e||!1===e,mc=e=>{e=el.isArray(e)?e:[e];const{length:t}=e;let n,o;const a={};for(let i=0;i<t;i++){let t;if(n=e[i],o=n,!hc(n)&&(o=uc[(t=String(n)).toLowerCase()],void 0===o))throw new al(`Unknown adapter '${t}'`);if(o)break;a[t||"#"+i]=o}if(!o){const e=Object.entries(a).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));let n=t?e.length>1?"since :\n"+e.map(dc).join("\n"):" "+dc(e[0]):"as no adapter specified";throw new al("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return o};function fc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Bl(null,e)}function gc(e){fc(e),e.headers=Rl.from(e.headers),e.data=Nl.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return mc(e.adapter||Al.adapter)(e).then((function(t){return fc(e),t.data=Nl.call(e,e.transformResponse,t),t.headers=Rl.from(t.headers),t}),(function(t){return _l(t)||(fc(e),t&&t.response&&(t.response.data=Nl.call(e,e.transformResponse,t.response),t.response.headers=Rl.from(t.response.headers))),Promise.reject(t)}))}const pc="1.7.2",vc={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{vc[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const yc={};vc.transitional=function(e,t,n){function o(e,t){return"[Axios v1.7.2] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,a,i)=>{if(!1===e)throw new al(o(a," has been removed"+(t?" in "+t:"")),al.ERR_DEPRECATED);return t&&!yc[a]&&(yc[a]=!0,console.warn(o(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,a,i)}};const bc={assertOptions:function(e,t,n){if("object"!=typeof e)throw new al("options must be an object",al.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let a=o.length;for(;a-- >0;){const i=o[a],r=t[i];if(r){const t=e[i],n=void 0===t||r(t,i,e);if(!0!==n)throw new al("option "+i+" must be "+n,al.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new al("Unknown option "+i,al.ERR_BAD_OPTION)}},validators:vc},xc=bc.validators;class wc{constructor(e){this.defaults=e,this.interceptors={request:new pl,response:new pl}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Yl(this.defaults,t);const{transitional:n,paramsSerializer:o,headers:a}=t;void 0!==n&&bc.assertOptions(n,{silentJSONParsing:xc.transitional(xc.boolean),forcedJSONParsing:xc.transitional(xc.boolean),clarifyTimeoutError:xc.transitional(xc.boolean)},!1),null!=o&&(el.isFunction(o)?t.paramsSerializer={serialize:o}:bc.assertOptions(o,{encode:xc.function,serialize:xc.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=a&&el.merge(a.common,a[t.method]);a&&el.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete a[e]})),t.headers=Rl.concat(i,a);const r=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,d=0;if(!s){const e=[gc.bind(this),void 0];for(e.unshift.apply(e,r),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=r.length;let h=t;for(d=0;d<u;){const e=r[d++],t=r[d++];try{h=e(h)}catch(e){t.call(this,e);break}}try{c=gc.call(this,h)}catch(e){return Promise.reject(e)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return gl(Wl((e=Yl(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}el.forEach(["delete","get","head","options"],(function(e){wc.prototype[e]=function(t,n){return this.request(Yl(n||{},{method:e,url:t,data:(n||{}).data}))}})),el.forEach(["post","put","patch"],(function(e){function t(t){return function(n,o,a){return this.request(Yl(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:o}))}}wc.prototype[e]=t(),wc.prototype[e+"Form"]=t(!0)}));const Tc=wc;class Ic{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const o=new Promise((e=>{n.subscribe(e),t=e})).then(e);return o.cancel=function(){n.unsubscribe(t)},o},e((function(e,o,a){n.reason||(n.reason=new Bl(e,o,a),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;const t=new Ic((function(t){e=t}));return{token:t,cancel:e}}}const Ec=Ic;const Sc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Sc).forEach((([e,t])=>{Sc[t]=e}));const Cc=Sc;const Ac=function e(t){const n=new Tc(t),o=ps(Tc.prototype.request,n);return el.extend(o,Tc.prototype,n,{allOwnKeys:!0}),el.extend(o,n,null,{allOwnKeys:!0}),o.create=function(n){return e(Yl(t,n))},o}(Al);Ac.Axios=Tc,Ac.CanceledError=Bl,Ac.CancelToken=Ec,Ac.isCancel=_l,Ac.VERSION=pc,Ac.toFormData=cl,Ac.AxiosError=al,Ac.Cancel=Ac.CanceledError,Ac.all=function(e){return Promise.all(e)},Ac.spread=function(e){return function(t){return e.apply(null,t)}},Ac.isAxiosError=function(e){return el.isObject(e)&&!0===e.isAxiosError},Ac.mergeConfig=Yl,Ac.AxiosHeaders=Rl,Ac.formToJSON=e=>Sl(el.isHTMLForm(e)?new FormData(e):e),Ac.getAdapter=mc,Ac.HttpStatusCode=Cc,Ac.default=Ac;const Mc=Ac,Dc=e=>{const{unknown:t}=k("response"),{message:n=t}=e;ut(n,n)},Pc=Mc.create({baseURL:"",timeout:6e4});Pc.interceptors.request.use((e=>{(0,or.start)();const t=D();return t&&e.headers&&(e.headers["Accept-Language"]=t),e}),(e=>Promise.reject(e))),Pc.interceptors.response.use((e=>{var t,n,o;try{(0,or.done)();const{data:a,config:{headers:i,params:r,data:s}}=e,l=null!==(o=null!==(t=null==i?void 0:i.disableToast)&&void 0!==t?t:null===(n=JSON.parse(s||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==o?o:null==r?void 0:r.disableToast,{statusCode:c,msg:u,message:d,success:h,data:m,result:f}=a||{};return!h&&void 0!==h||200!=c&&void 0!==c||null==(m||f)?(1!=l&&Dc({message:u||d}),Promise.reject(e)):e}catch(e){return Promise.reject(e)}}),(e=>{var t,n,o;(0,or.done)();const{statusCode:a,fail:i}=k("response"),{response:{status:r,config:s}={config:{}},config:l,message:c}=e,{headers:u,params:d,data:h}=l||s;if(null!==(o=null!==(t=null==u?void 0:u.disableToast)&&void 0!==t?t:null===(n=JSON.parse(h||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==o?o:null==d?void 0:d.disableToast)return Promise.reject(e);switch(r){case 401:Dc({message:a[401]});break;case 403:Dc({message:a[403]});break;case 404:console.error(a[404]);break;default:Dc({message:r?c:i,duration:5e3})}return Promise.reject(e)}));const Lc=Pc,kc="GetStudyMark",Oc="AddStudyMark",Rc="GetStudyKeyImage",Nc="AddStudyKeyImage";var _c=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))},Uc=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};const Bc=Mc.CancelToken.source(),Vc=e=>({Authorization:e?"bearer "+e:void 0});function Fc(e,t,n){return _c(this,void 0,void 0,(function*(){const{token:o,departCode:a,hospID:i,markJson:r}=n;return(yield Lc.post(`${e}/${Oc}`,{queryNo:t,orgCode:i,deptCode:a,markJson:r},{headers:Object.assign({},Vc(o))})).data}))}function Hc(e,t,n){return _c(this,void 0,void 0,(function*(){const{token:o,departCode:a,hospID:i,markKeyJson:r}=n;return(yield Lc.post(`${e}/${Nc}`,{queryNo:t,orgCode:i,deptCode:a,markKeyJson:r},{headers:Object.assign({},Vc(o))})).data}))}function jc(e,t){var n;return _c(this,void 0,void 0,(function*(){const o=yield Lc.get(`${e}`,{params:{studyUID:t}}),{data:a}=JSON.parse(null===(n=o.data)||void 0===n?void 0:n.result)||{};switch(a){case void 0:case"ALGOERROR":throw{studyUID:t,mesage:k("response.AIDataError"),data:a};default:if("Array"===(0,s.dataType)(a))return a;throw{studyUID:t,mesage:k("response.unknown"),data:a}}}))}var zc=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};let qc={};function Wc(e={}){qc=e}function Gc(e,t=!1){return zc(this,void 0,void 0,(function*(){if(!e)throw"studyUID must be provided";try{const{wado:n,hospID:o,token:a,departCode:i}=j.webDicomView,r=yield function(e,t,n){return _c(this,void 0,void 0,(function*(){const{token:o,hospID:a,departCode:i}=n;return(yield Lc.get(`${e}/${Rc}`,{params:{queryNo:t,orgCode:a,deptCode:i},data:{disableToast:!0},headers:Object.assign({},Vc(o))})).data}))}(n,e,{departCode:i,token:a,hospID:o}),s=JSON.parse(r.data.markKeyJson)||{};Wc(Object.assign(Object.assign({},qc),{[e]:s})),t&&gs()}catch(e){console.error(e)}}))}var Yc=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const Zc=class{constructor(){this.layoutclassName="crux-marker-description",this.EVENTSHandle=new Map}createLayout(e){let t=e.querySelector(`.${this.layoutclassName}`);if(!t){t=(0,s.createElement)({className:this.layoutclassName});const n=()=>{const{enable:t,description:n}=function(e){var t;const{imageId:n}=(0,i.getImage)(e),{imageUID:o,studyUID:a}=i.metaData.get("_IDModule",n);return null===(t=qc[a])||void 0===t?void 0:t[o]}(e)||{};e.querySelector(`.${this.layoutclassName}`).innerText=t?n:"",e.querySelector(".crux-marker-checkbox").checked=t},o=(0,s.createElement)({className:"crux-marker-checkbox"+(j.instanceOptions.syncMarkersImage?"":" hidden"),tagName:"input",type:"checkbox",ontouchstart:e=>{e.target.click()},onchange:n=>Yc(this,void 0,void 0,(function*(){const o=n.target;if(o.checked){const e=yield bn(k("toast.prompt.enterKeyImageDescription"),/\S/,k("toast.prompt.verificationError"));null===e&&(o.checked=!1),t.innerText=e}else t.innerText="";!function(e,t){if(!j.instanceOptions.syncMarkersImage)return;const{imageId:n}=(0,i.getImage)(e),{imageUID:o,seriesUID:a,studyUID:r}=i.metaData.get("_IDModule",n);qc[r]||(qc[r]={}),qc[r][o]=Object.assign(Object.assign({},t),{imageUID:o,seriesUID:a,studyUID:r})}(e,{enable:o.checked,description:t.innerText})}))}),a=e.querySelector(".rbMarker");a.prepend(o),a.prepend(t),this.EVENTSHandle.set(e,n),e.addEventListener(i.EVENTS.NEW_IMAGE,n),n()}}removeLayout(e){const t=this.EVENTSHandle.get(e),n=e.querySelector(`.${this.layoutclassName}`);e.removeEventListener(i.EVENTS.NEW_IMAGE,t),this.EVENTSHandle.delete(e),null==n||n.remove()}};var Kc=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))},Xc=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n};function Jc(e=Dt.globalImageIdSpecificToolStateManager.saveToolState()){const t=Dt.store.state.tools.filter((({mode:e})=>"active"===e)).map((({name:e})=>e)),n=new Set;for(const[o,a]of Object.entries(e)){const e=a||{},{baseInfo:o}=e,i=Xc(e,["baseInfo"]);for(const e in i)!t.includes(e)&&n.add(e)}for(const e of n)(0,Dt.setToolPassive)(e)}function Qc(e,t=!0,n=!1){return Kc(this,void 0,void 0,(function*(){if(!e)throw"studyUID must be provided";try{const o=Dt.globalImageIdSpecificToolStateManager.saveToolState(),{wado:a,hospID:i,token:r,departCode:s}=j.webDicomView,l=yield function(e,t,n){return _c(this,void 0,void 0,(function*(){const{token:o,hospID:a,departCode:i}=n;return(yield Lc.get(`${e}/${kc}`,{params:{queryNo:t,orgCode:a,deptCode:i},data:{disableToast:!0},headers:Object.assign({},Vc(o))})).data}))}(a,e,{departCode:s,token:r,hospID:i}),c=JSON.parse(l.data.markJson)||{};Dt.globalImageIdSpecificToolStateManager.restoreToolState(Object.assign(Object.assign({},o),c)),t&&Jc(c),n&&gs()}catch(e){console.error(e)}}))}var $c=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const eu=class{constructor(){}createTopTools(e,t,n,o="toolsChild",a=!1){const r=e.querySelectorAll(".toolsChild");let l=e.querySelector(`.toolsChild.${o}`);if(r.forEach((e=>{e.classList.remove("active")})),a&&(null==l||l.remove(),l=void 0),l)return void l.classList.add("active");let c=(0,s.createElement)({className:`toolsChild active ${o}`});for(const e of t){const{toolName:t,toolNameAlias:o,toolType:a,toolTag:r="",icon:l,iconText:u,iconImg:d,isActive:h,children:m,divider:f,floatRight:g,select:p,visibility:v}=e,y=o||("function"==typeof t?t():t),b=(0,s.createElement)({tagName:"span",className:`tool-btn-style tool-event-link ${a||r}`,title:y||u,onclick:t=>{const n={events:t,toolData:e,btnTarget:b};"Array"===(0,s.dataType)(m)&&new Vr(n),r&&(0,i.triggerEvent)(i.events,"tool_event",n)}});let x=(0,s.createElement)({tagName:"i",className:"iconfont"});const w=(0,s.createElement)({tagName:"span",className:"toolbar-text",innerText:y});b.dataset.toolData=JSON.stringify(e),b.dataset.toolType=a||r,d?x=(0,s.createElement)({tagName:"img",src:d,className:"iconfont-img"}):l?x.classList.add("function"==typeof l?l():l):(x.innerHTML=u,x.setAttribute("style","\n\t\t\t\t\tfont-size: 24px;\n\t\t\t\t\tpadding:0 2px\n\t\t\t\t\t"),y||(x.style.lineHeight="48px",w.style.display="none")),(!1===v||"function"==typeof v&&!v())&&b.classList.add("hidden"),r===(null==n?void 0:n.toolTag)&&(b.classList.add("active"),E().then((()=>{(0,i.triggerEvent)(i.events,"tool_event",{toolData:e,btnTarget:b})}))),h&&b.classList.add("active"),"Array"===(0,s.dataType)(m)&&(new Vr({toolData:e,btnTarget:b,toolDefault:n}),x.appendChild((0,s.createElement)({tagName:"i",className:"triangle"}))),p&&x.appendChild((0,s.createElement)({tagName:"i",className:"triangle"})),b.appendChild(x),b.appendChild(w),g&&c.appendChild((0,s.createElement)({className:"flex-1"})),c.appendChild(b),f&&c.appendChild((0,s.createElement)({tagName:"span",className:`divider ${a||r}`}))}e.appendChild(c)}clearTools(){for(const{name:e,mode:t,_options:{mouseButtonMask:n=[]}}of Dt.store.state.tools){if("active"!==t)continue;const o=n.findIndex((e=>1===e));-1!==o&&(1===n.length?(0,Dt.setToolPassive)(e):n.splice(o,1))}}disableAllTool(){this.clearTools(),ts.setHandler((()=>{})),(0,Dt.setToolActive)("Pointer",{mouseButtonMask:1,synchronizationContext:ts})}rectangleRoiTools(){(0,Dt.setToolActive)("RectangleRoi",{mouseButtonMask:1})}ellipticalRoiTools(){(0,Dt.setToolActive)("EllipticalRoi",{mouseButtonMask:1})}circleRoiTools(){(0,Dt.setToolActive)("CircleRoi",{mouseButtonMask:1})}lengthTools(){(0,Dt.setToolActive)("Length",{mouseButtonMask:1})}eraserTools(){(0,Dt.setToolActive)("Eraser",{mouseButtonMask:1})}angleTools(){(0,Dt.setToolActive)("Angle",{mouseButtonMask:1})}cobbAngleTools(){(0,Dt.setToolActive)("CobbAngle",{mouseButtonMask:1})}rotateTool(){ts.setHandler(Jr),(0,Dt.setToolActive)("Rotate",{mouseButtonMask:1,synchronizationContext:ts})}zoomTool(){ts.setHandler(es),(0,Dt.setToolActive)("Zoom",{mouseButtonMask:1,synchronizationContext:ts})}magnifyTool(){(0,Dt.setToolActive)("Magnify",{mouseButtonMask:1})}modulationTool(){ts.setHandler($r),(0,Dt.setToolActive)("Wwwc",{mouseButtonMask:1,synchronizationContext:ts})}stackScrollTool(){(0,Dt.setToolActive)("StackScroll",{mouseButtonMask:1})}sharpenTool(){(0,Dt.setToolActive)("Sharpen",{mouseButtonMask:1})}blurTool(){(0,Dt.setToolActive)("Blur",{mouseButtonMask:1})}panTool(){ts.setHandler(Qr),(0,Dt.setToolActive)("Pan",{mouseButtonMask:1,synchronizationContext:ts})}freehandRoiTool(){(0,Dt.setToolActive)("FreehandRoi",{mouseButtonMask:1})}probeCTTool(){(0,Dt.setToolActive)("ProbeCT",{mouseButtonMask:1})}arrowAnnotateTool(){(0,Dt.setToolActive)("ArrowAnnotate",{mouseButtonMask:1})}annotateTool(){(0,Dt.setToolActive)("Annotate",{mouseButtonMask:1})}LRMarkerTool(e){"L"===e?(0,Dt.setToolActive)("AnnL",{mouseButtonMask:1}):(0,Dt.setToolActive)("AnnR",{mouseButtonMask:1})}heartratioTool(){(0,Dt.setToolActive)("Heartratio",{mouseButtonMask:1})}AITool(e=!1){e?(0,Dt.setToolPassive)("AI"):(0,Dt.setToolDisabled)("AI")}cancelTool(e,t=!0){Dt.globalImageIdSpecificToolStateManager.clear(e),t&&(0,i.updateImage)(e)}cancelToolAndDefaultViewportTools(e=(0,i.getEnabledElements)().map((({element:e})=>e)),t=!1,n=!1){return $c(this,void 0,void 0,(function*(){t&&(yield function(e=!0){return Kc(this,void 0,void 0,(function*(){const{studyArr:t}=j.webDicomView;Dt.globalImageIdSpecificToolStateManager.restoreToolState({});for(const e of t){const{studyUID:t}=e||{};yield Qc(t,!1)}Jc(),e&&gs()}))}()),n&&(yield function(e=!1){return zc(this,void 0,void 0,(function*(){const{studyArr:t}=j.webDicomView;Wc({});for(const e of t){const{studyUID:t}=e||{};yield Gc(t,!1)}e&&gs()}))}());for(const n of e)try{if(!n)continue;const e=(0,i.getImage)(n),o=(0,i.getDefaultViewportForImage)(n,e),{colormap:a}=(0,i.getViewport)(n)||{};a&&fr(n),!t&&this.cancelTool(n,!1),(0,i.setViewport)(n,Object.assign(Object.assign({},o),{sharpen:0,blur:0}))}catch(e){Pr(e)}}))}},tu=(0,Dt.importInternal)("util/scrollToIndex");const nu=class{constructor(){this.layoutclassName="series-slider-layout",this.EVENTSHandle=new Map}changMarker(e,t){const n=e.querySelector(".filmMarker");n&&(n.innerText=v(n.innerText,String(t+1)))}createLayout(e,t,n){var o;let a=e.querySelector(`.${this.layoutclassName}`);const r=(()=>{const{imgRow:t,imgColumn:n}=e.dataset;return Number(null!=t?t:1)*Number(null!=n?n:1)})();let l=Math.ceil((null===(o=null==t?void 0:t.imgs)||void 0===o?void 0:o.length)/r);const c={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||a.clientHeight,this._scrollLen},set scrollLen(e){this._stepLen=0,this._scrollLen=e},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(l-1)/l,this._stepLen}},u=t=>{e.dataset.currentImageIdIndex=String(c.currentIndex),(0,i.triggerEvent)(i.events,"series_scroll",{element:e,imageIds:t,currentIndex:c.currentIndex,isSeriesImage:1!==r})};if(!a){const t=()=>{var t;const[{currentImageIdIndex:o=n||0,imageIds:i}]=(null===(t=(0,Dt.getToolState)(e,"stack"))||void 0===t?void 0:t.data)||[{}],{scrollLen:s}=c;if(a.scrollTop=s*o,o&&o%100==0&&Q("scroll",!1,400),1===r)this.changMarker(e,o),c.currentIndex=o;else{let t=o;if(t>=l&&(t=l,tu(e,j.webDicomView.layoutView.iconPlayer.playerStatus?0:t-1)),c.currentIndex===t)return;c.currentIndex=t}u(i)};a=(0,s.createElement)({className:this.layoutclassName});const o=(0,s.createElement)();o.style.height=`calc(100% * ${l})`,a.appendChild(o),e.appendChild(a),n&&(tu(e,n),a.scrollTop=c.scrollLen*n,n=void 0),this.EVENTSHandle.set(e,t),e.addEventListener(i.EVENTS.NEW_IMAGE,t),a.addEventListener("scroll",(t=>{var n;if(c.scrollLen!==a.clientHeight)return void(c.scrollLen=a.clientHeight);const o=t.target,{stepLen:s,currentIndex:d}=c,h=Math.floor(o.scrollTop/s);if(!(h>=l||d==h)&&(tu(e,h),c.currentIndex=h,(0,i.triggerEvent)(i.events,"canvas_active",{$canvas:e,type:"wheel"}),1!==r)){const[{imageIds:t}]=(null===(n=(0,Dt.getToolState)(e,"stack"))||void 0===n?void 0:n.data)||[{}];u(t)}}))}}removeLayout(e){const t=this.EVENTSHandle.get(e),n=e.querySelector(`.${this.layoutclassName}`);e.removeEventListener(i.EVENTS.NEW_IMAGE,t),this.EVENTSHandle.delete(e),null==n||n.remove()}};const ou=class{constructor(){this.className="study-slider-layout"}createLayout(e,t,n,o=!1){let a=e.querySelector(`.${this.className}`);const r=(()=>{const{x:e,y:t}=n;return Number(null!=e?e:1)*Number(null!=t?t:1)})(),l=Math.ceil(t.length/r),c=this.scrollData={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||a.clientHeight,this._scrollLen},set scrollLen(e){this._stepLen=0,this._scrollLen=e},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(l-1)/l,this._stepLen}};if(o&&(this.container.remove(),this.container=a=void 0),!a){this.container=a=(0,s.createElement)({className:this.className});const t=(0,s.createElement)();j.webDicomView.layoutView.canvasContainer.style.paddingRight=l<=1||j.isMobile?"0px":"12px",a.style.display=l>1?"block":"none",t.style.height=`calc(100% * ${l})`,a.appendChild(t),e.appendChild(a),a.addEventListener("scroll",(e=>{if(c.scrollLen!==a.clientHeight)return void(c.scrollLen=a.clientHeight);const{target:t}=e,{stepLen:n,currentIndex:o}=c,u=Math.floor(t.scrollTop/n);u>=l||o==u||(ct("triggerEvent_study_scroll",(0,s.debounce)((e=>{(0,i.triggerEvent)(i.events,"study_scroll",e)}),300),{currentIndex:u,layoutCount:r}),c.currentIndex=u)}))}}visibility(e){this.container.style.visibility=e?"visible":"hidden"}setIndex(e){this.container.scrollTop=this.scrollData.stepLen*e+1}};const au=class{constructor(e,t){this.iconPlayer=e,this.container=t}createLayout(e,t){const n=0===t;n&&this.createOrEditInfoBar(e,n),1===t&&this.createMenuBtn(),this.addItemMenu(e,n)}createOrEditInfoBar(e,t){const{modality:n,name:o,sex:a,age:i,studydate:r}=e,l=`<span class='name' title='${o}'>${o||"-"}</span> / ${hs(a)||"-"}  / ${ds(i)||"-"}  / ${r||"-"} `;if(t){this.infoBarContainer=(0,s.createElement)({className:"info-bar"});const e=(0,s.createElement)({className:"modality",innerText:`${n}`}),t=(0,s.createElement)({className:"details",innerHTML:l});this.infoBarContainer.appendChild(e),this.infoBarContainer.appendChild(t),this.container.appendChild(this.infoBarContainer)}else this.infoBarContainer.querySelector(".details").innerHTML=l,this.infoBarContainer.querySelector(".modality").innerText=n}createMenuBtn(){if(!this.infoBarContainer)return;const e=(0,s.createElement)({className:"menu-btn",innerText:k("other.toggleStudy"),onclick:()=>{this.iconPlayer.playerPause(),this.toggleMenuVisibility()}});this.infoBarContainer.appendChild(e)}activeFirst(){var e;const t=null===(e=this.menuContainer)||void 0===e?void 0:e.querySelector(".menu-item");null==t||t.click()}addItemMenu(e,t){const{modality:n,name:o,sex:a,age:i,studydate:r,studyUID:l}=e;t&&(this.menuContainer=(0,s.createElement)({className:"menu hidden"}),this.container.appendChild(this.menuContainer));const c=(0,s.createElement)({className:`menu-item ${t&&"active"}`,onclick:()=>{const t=this.container.parentElement.querySelectorAll(".study-navigation-body .study-navigation-container"),n=this.menuContainer.querySelectorAll(".menu-item");this.toggleElsClassName(t,l,"hidden","remove"),this.toggleElsClassName(n,l,"active","add"),this.createOrEditInfoBar(e,!1),this.toggleMenuVisibility(!1)}});c.dataset.studyUID=l;const u=(0,s.createElement)({className:"modality",innerText:`${n}`}),d=(0,s.createElement)({className:"info",innerHTML:`<span class='name' title='${o}'>${o}</span> / ${hs(a)}  / ${ds(i)} `}),h=(0,s.createElement)({className:"study-date",innerText:`${r}`}),m=(0,s.createElement)({className:"icon",innerHTML:'<i class="icon-dicom-arrow"</i>'});c.appendChild(u),c.appendChild(d),c.appendChild(h),c.appendChild(m),this.menuContainer.appendChild(c)}toggleElsClassName(e,t,n,o){e.forEach((e=>{const a=t===e.dataset.studyUID;e.classList.toggle(n,"add"===o?a:!a)}))}toggleMenuVisibility(e){const t=this.menuContainer;if(!t)return;const n=void 0!==e?e:t.classList.contains("hidden");t.classList.toggle("hidden",!n)}};function iu(e){try{return(0,i.getEnabledElement)(e),!0}catch(e){return!1}}const ru=class{constructor(e,t){this.data=[{title:"10FPS/S",val:10},{title:"20FPS/S",val:20},{title:"30FPS/S",val:30},{title:"40FPS/S",val:40},{title:"50FPS/S",val:50}];const n=e.target;new Fr("fps",{btnTarget:n,events:e,direction:"top"},(e=>{for(const{title:n,val:o}of this.data){const a=(0,s.createElement)({className:"select-popup-item",title:n,innerText:n,onclick:()=>{t(o)}});e.appendChild(a)}}))}};var su=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const lu=(0,Dt.importInternal)("util/scrollToIndex"),cu=e=>{var t;if(!iu(e))return{seriesImagesLen:0};const[{currentImageIdIndex:n=0,imageIds:o=[]}]=(null===(t=(0,Dt.getToolState)(e,"stack"))||void 0===t?void 0:t.data)||[{}];return{imageIds:o,currentImageIdIndex:Number(n),seriesImagesLen:o.length}};const uu=class{constructor(){this.eventNamespace="player",this.enableColor="white",this.disableColor="gray",this.framesPerSecond=10,this.toggleControlStyleLazy=(0,s.throttle)(this.toggleControlStyle,1e3);const e=this.t=k("player");this.EVENTSHandle=new Map,this.playerStatus=!0,this.elementPlayClip,this.playData=[{id:"player1001",title:e.first,flag:"control",icon:"icon-dicom-first",cssText:"display: none;"},{id:"player1002",title:e.prev,flag:"control",icon:"icon-dicom-previous"},{id:"player1003",title:e.play,flag:"control",cssText:`color: ${this.enableColor};`,icon:"icon-dicom-play"},{id:"player1004",title:e.next,flag:"control",icon:"icon-dicom-next"},{id:"player1005",title:e.last,flag:"control",icon:"icon-dicom-last",cssText:"display: none;"}],this.iconControls=[]}createPlayer(e,t,n,o=10){var a;const r=t.querySelector("div.player-bar");if(r)return this.playerStatus=!1,void t.removeChild(r);this.playerStatus=!((null===(a=n.loadIds)||void 0===a?void 0:a.length)>1),this.elementPlayClip=e,this.framesPerSecond=Math.round(o);const{seriesImagesLen:l,currentImageIdIndex:c}=cu(e);if(!l)return;const u=(0,s.createElement)({className:"player-bar"}),d=(0,s.createElement)({className:"slider-group"}),h=(0,s.createElement)({tagName:"input",className:"slider",type:"range",min:0,max:l-1,step:1,value:c,oninput:t=>{const n=Number(t.target.value);lu(e,n)},onmousedown:()=>{this.playerPause(e)},ontouchstart:()=>{this.playerPause(e)}}),f=(0,s.createElement)({className:"slider-info",innerText:`${c+1}/${l}`});d.appendChild(h),d.appendChild(f),u.appendChild(d);const g=(0,s.createElement)({className:"body-group"}),p=(0,s.createElement)({className:"fps-option",innerHTML:`${this.framesPerSecond}FPS/S`,onclick:e=>su(this,void 0,void 0,(function*(){yield E(100),new ru(e,(e=>{this.framesPerSecond=e,p.innerHTML=`${this.framesPerSecond}FPS/S`,y.value=String(this.framesPerSecond),this.playerStatus&&this.playerStart()}))}))}),v=(0,s.createElement)({className:"fps-custom"}),y=(0,s.createElement)({className:"custom-input hidden",tagName:"input",type:"tel",maxLength:100,value:this.framesPerSecond,onkeyup:e=>{var t;const n=e.target;if("Backspace"===e.key)return;const o=null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.replace(/[^\d]/g,"");if(n.value=String(m(""===o?this.framesPerSecond:Number(o),1,50)),"Enter"===e.key){if(l<=1)return;this.playerStart(),y.classList.add("hidden")}},onblur:e=>{const t=e.target,n=null==t?void 0:t.value;this.framesPerSecond=Number(n)||this.framesPerSecond||10,t.value=String(this.framesPerSecond),b.classList.remove("hidden"),y.classList.add("hidden"),p.innerHTML=`${this.framesPerSecond}FPS/S`,this.playerStatus&&this.playerStart()}}),b=(0,s.createElement)({tagName:"span",innerText:this.t.custom,onclick:()=>{b.classList.add("hidden"),y.classList.remove("hidden"),y.value="",y.focus()}}),x=(0,s.createElement)({className:"fps-play"});for(let t=0;t<this.playData.length;t++){const{flag:o,title:a,cssText:r,icon:l,id:c}=this.playData[t];switch(o){case"control":{const o=(0,s.createElement)({tagName:"i",className:`control ${l} ${c}`,title:a});o.style.cssText=r,o.addEventListener(j.isMobile?"touchstart":"click",(o=>{const a={event:o,series:n,playerData:this.playData[t],playerDom:e};(0,i.triggerEvent)(i.events,"iconplayer_series",a)})),this.iconControls.push(o),x.appendChild(o);break}}}v.appendChild(y),v.appendChild(b),g.appendChild(p),g.appendChild(v),g.appendChild(x),u.appendChild(g),t.appendChild(u),this.toggleControlStyle(c,l);const w=()=>{const{seriesImagesLen:t,currentImageIdIndex:n}=cu(e);f.innerText=`${n+1}/${t}`,h.value=String(n)};i.events.addEventNamespaceListener(`canvas_active.${this.eventNamespace}`,(e=>su(this,void 0,void 0,(function*(){const{$canvas:t}=e.detail,n=j.webDicomView.queryCurrentSeries();if(t===this.elementPlayClip||!iu(t))return this.playerPause();yield this.playerRemove(),this.createPlayer(t,t.parentElement,n)})))),this.EVENTSHandle.set(e,w),e.addEventListener(i.EVENTS.NEW_IMAGE,w),this.togglePalyerTool(!0)}playerToggle(e,t){if(t&&(this.elementPlayClip=t),!this.elementPlayClip)return;const n=this.elementPlayClip.parentElement.querySelector(".player1003");this.playerToggleHandle(n,e)}playerStart(e){this.playerToggle(!0,e)}playerPause(e){this.playerToggle(!1,e)}playerAllPauseAndRemove(){this.playerRemove();for(const{element:e}of(0,i.getEnabledElements)())(0,Dt.stopClip)(e)}playerRemove(e,t=!0){return su(this,void 0,void 0,(function*(){const n=e||this.elementPlayClip;if(n)try{const e=n.parentElement.querySelector("div.player-bar");e&&((0,Dt.stopClip)(n),e.remove(),t&&J("playerRemove"),this.togglePalyerTool(!1)),this.playerStatus=!1,this.iconControls=[],this.elementPlayClip=void 0}catch(e){Pr(e)}finally{const e=this.EVENTSHandle.get(n);yield i.events.removeEventNamespaceListener(`canvas_active.${this.eventNamespace}`),yield n.removeEventListener(i.EVENTS.NEW_IMAGE,e),this.EVENTSHandle.delete(n)}}))}playerBarClickHandle(e){const{playerData:t,playerDom:n,event:o}=e;if(o.target.style.color===this.disableColor)return;const a=e.event.target,{seriesImagesLen:i,currentImageIdIndex:r}=cu(n);let s=r;switch(t.id){case"player1001":0!==r&&(s=0);break;case"player1002":r>=1&&(s-=1);break;case"player1003":this.playerToggleHandle(a,!this.playerStatus);break;case"player1004":r<i-1&&(s+=1);break;case"player1005":r!==i-1&&(s=i-1)}lu(n,s)}playerToggleHandle(e,t=!1){const{currentImageIdIndex:n,seriesImagesLen:o}=cu(this.elementPlayClip);J(t?"playerResume":"playerPause"),(0,Dt.stopClip)(this.elementPlayClip),this.playerStatus=t,this.toggleControlStyle(n,o),t?(e.title=this.t.pause,e.classList.remove("icon-dicom-play"),e.classList.add("icon-dicom-pause"),(0,Dt.playClip)(this.elementPlayClip,this.framesPerSecond)):(e.title=this.t.play,e.classList.remove("icon-dicom-pause"),e.classList.add("icon-dicom-play"))}togglePalyerTool(e){return su(this,void 0,void 0,(function*(){const{layoutView:t}=j.webDicomView;yield E(),t.toggleClassName(t.querySelectorForTool(".player"),void 0,"active",e)}))}toggleControlStyle(e,t){if(this.iconControls.length){if(t<=1)return this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[2].style.color=this.disableColor,this.iconControls[3].style.color=this.disableColor,void(this.iconControls[4].style.color=this.disableColor);this.playerStatus&&(this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[3].style.color=this.disableColor,this.iconControls[4].style.color=this.disableColor),0===e&&t>0&&!this.playerStatus&&(this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[3].style.color=this.enableColor,this.iconControls[4].style.color=this.enableColor),e!==t-1||this.playerStatus||(this.iconControls[0].style.color=this.enableColor,this.iconControls[1].style.color=this.enableColor,this.iconControls[3].style.color=this.disableColor,this.iconControls[4].style.color=this.disableColor),e>0&&e<t-1&&!this.playerStatus&&(this.iconControls[0].style.color=this.enableColor,this.iconControls[1].style.color=this.enableColor,this.iconControls[3].style.color=this.enableColor,this.iconControls[4].style.color=this.enableColor)}}};const du=class{constructor(e,t,n){this.seriesSlider=e,this.studySlider=t,this.iconSynchronizer=n,this.seriesLayouts=[]}initSingle(e,t,n,o){n=Object.assign({imgRow:"1",imgColumn:"1"},n);const{synchronizerStatus:a,scrollIndex:i}=o||{};for(const[t,o]of Object.entries(n||{}))!(0,s.isNull)(o)&&(e.dataset[t]=o);(0,s.isNull)(t)||(this.seriesSlider.createLayout(e,t,i),this.iconSynchronizer.createIconSynchronizer(e,a))}createCanvasSeries(e,t,n,o=!0){var a;const r=[],l=n.y,c=n.x,u=l*c;null===(a=e.querySelector(".container"))||void 0===a||a.remove();const d=(0,s.createElement)({className:"container"});d.setAttribute("style",`\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(${c}, calc(100% / ${c}));\n\t\t\t\tgrid-template-rows: repeat(${l}, calc(100% / ${l}));\n\t\t\t\t`);for(let e=0;e<u;e++){const n=t[e],{seriesUID:a,studyUID:i,imgs:h,flatSeries:m}=n||{},f=(0,s.createElement)({className:"layoutCellsOuter"+(1===u?" singleBoxMode":"")}),g=(0,s.createElement)({className:"layoutCellsInner"}),p=(null==h?void 0:h.length)||0;a&&(g.dataset.seriesUID=a,g.dataset.studyUID=i,g.dataset.seriesIndex=String(e),g.dataset.seriesRow=String(l),g.dataset.seriesColumn=String(c),m&&(g.dataset.flatSeries=String(m))),this.initSeriesLayout(g,n),o&&p&&(this.seriesSlider.createLayout(g,n),this.iconSynchronizer.createIconSynchronizer(g)),r.push(g),f.appendChild(g),d.appendChild(f)}this.studySlider.createLayout(e,t,n),e.appendChild(d),(0,i.triggerEvent)(i.events,"first_active",{$canvas:r[0]})}createImagesLayout(e,t,n){const o=n.y,a=n.x,i=o*a;e.dataset.imgRow=String(o),e.dataset.imgColumn=String(a),this.seriesSlider.createLayout(e,t);const r=(0,s.createElement)({className:"imageLayoutGroup"});r.setAttribute("style",`\n\t\t\t\theight:100%;\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(${a}, calc(100% / ${a}));\n\t\t\t\tgrid-template-rows: repeat(${o}, calc(100% / ${o}));\n\t\t\t\t`);for(let t=0;t<i;t++){const n=(0,s.createElement)({className:0===t?"layoutImage active":"layoutImage"});new(Ct())(n).on("tap press panstart",(n=>{this.toggleStyle(e,t,"layoutImage"),n.preventDefault()})),r.appendChild(n)}e.appendChild(r)}dblclickCanvasLayout(e,t,n){if(e.classList.contains("singleBoxMode"))return;const o=t.querySelectorAll(".layoutImage"),a=null!=n?n:e.classList.contains("signBigLayout"),r=j.webDicomView.querySeries(t.dataset.seriesUID);e.classList.toggle("signBigLayout",!a),this.studySlider.visibility(a),this.seriesSlider.removeLayout(t),r&&(o.length?o.forEach((e=>{(0,i.resize)(e)})):(0,i.resize)(t),this.seriesSlider.createLayout(t,r,Number(t.dataset.currentImageIdIndex)))}initSeriesLayout(e,t){const n=(e,t)=>{(0,i.triggerEvent)(i.events,"canvas_active",{$canvas:e,type:t})};e.addEventListener("dragover",(e=>{e.preventDefault()})),e.addEventListener("drop",(t=>{t.preventDefault(),n(e,"drop")})),e.addEventListener("wheel",(()=>{n(e,"wheel")})),e.addEventListener("click",(t=>{"CANVAS"===t.target.tagName&&n(e,"click")})),e.addEventListener("touchstart",(t=>{const{type:o}=t;n(e,"touchstart"),(0,i.triggerEvent)(i.events,"layout_area_focus",{area:"seriesLayout",type:o})})),new(Ct())(e).on("doubletap",(t=>{"CANVAS"===t.target.tagName&&this.dblclickCanvasLayout(e.parentElement,e)})),e.addEventListener(i.EVENTS.IMAGE_RENDERED,(e=>{(0,i.triggerEvent)(i.events,"images_viewport",e.detail)})),this.seriesLayouts.push({seriesUID:null==t?void 0:t.seriesUID,seriesDom:e})}seriesLayoutsUpdate(e,t){this.seriesLayouts.forEach((n=>{e===n.seriesDom&&(n.seriesUID=t)}))}toggleSeriesStyle(e){const{target:t,seriesUID:n,seriesIndex:o}=e;j.webDicomView.layoutView.canvasContainer.querySelectorAll(".layoutCellsOuter").forEach((e=>{const a=e.querySelector(".layoutCellsInner"),{seriesUID:i,seriesIndex:r}=a.dataset;if(null!=t&&a===t||null!=n&&i===n||null!=o&&Number(r)===o){if(e.classList.add("active"),a.classList.add("active"),a.classList.contains("noActiveBorder")){const e=a.querySelector(".layoutImage");e?a.querySelector(".layoutImage.active")||e.click():a.classList.remove("noActiveBorder")}}else e.classList.remove("active"),a.classList.remove("active"),this.toggleStyle(e,-1,"layoutImage")}))}toggleStyle(e,t,n){const o=e.getElementsByClassName(n),a=o.length;for(let e=0;e<a;e++)e===t?o[e].classList.add("active"):o[e].classList.remove("active")}toggleNavigatorInfo(e,t=!0){j.webDicomView.layoutView.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper").forEach((n=>{if(n.dataset.seriesUID==e){n.classList.add("active"),t&&n.classList.add("showProgress");const e=n.parentElement.parentElement;if(e.classList.contains("active"))g(n);else{e.querySelector(".panel-info").click(),g(n,750)}}else n.classList.remove("active"),!j.preload.fullLoad&&n.classList.remove("showProgress")}))}};const hu=class{constructor(e){this.id=e,this.ElementContent=void 0}createLayout(){let e=j.webDicomView.globalContainer.querySelector(`#${this.id}`);if(e)e.style.zIndex="98";else{const t=j.webDicomView.globalContainer.querySelector(".viewerContentWrapper");this.ElementContent=e=(0,s.createElement)({id:this.id,oncontextmenu:e=>e.preventDefault()}),e.setAttribute("style","\n\t\t\t    position: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\tz-index: 98;\n\t\t\t\t\tbackground: #000;\n\t\t\t\t\tborder: 2px solid #CACACA;\n\t\t\t\t\tborder-top: none;\n\t\t\t\t\t// padding: 2px;\n\t\t\t\t\t// margin: 2px;\n\t\t"),e.addEventListener("touchmove",(e=>{const{type:t}=e;(0,i.triggerEvent)(i.events,"layout_area_focus",{area:"seriesMPROr3DLayout",type:t}),e.preventDefault()}),{passive:!1}),t.append(e)}return e}hidden(){this.ElementContent&&(this.ElementContent.style.zIndex="-1")}};const mu=class{constructor(){this.t=k("synchronizerSwitch")}createIconSynchronizer(e,t){let n=e.querySelector(".seriesSynchronizerLayout");if("stackPositionSynchronizer"===j.tackSynchronizerType)return this.removeSynchronizer(e),ns(),void Ho();if(n)return;const{seriesIndex:o}=e.dataset,a='iconCheckBox"'+o,{title:i,on:r,off:l}=this.t;n=(0,s.createElement)({className:"seriesSynchronizerLayout",title:i,onmousedown:e=>{e.stopPropagation()},onclick:t=>{var n;this.triggerEventHandle(e,null===(n=t.target)||void 0===n?void 0:n.checked)},ontouchstart:e=>{e.target.click()}});const c=(0,s.createElement)({tagName:"input",className:"checkbox-input",type:"checkbox",checked:t,id:a}),u=(0,s.createElement)({tagName:"label",className:"checkbox-label"});u.setAttribute("for",a),u.appendChild((0,s.createElement)({tagName:"span",className:"circle"})),u.appendChild((0,s.createElement)({tagName:"span",className:"text on",innerHTML:l})),u.appendChild((0,s.createElement)({tagName:"span",className:"text off",innerHTML:r})),n.appendChild(c),n.appendChild(u),e.appendChild(n),this.triggerEventHandle(e,t)}createIconSynchronizers(){for(const{element:e}of(0,i.getEnabledElements)())this.createIconSynchronizer(e,j.webDicomView.seriesLayoutState.getSynchronizerStatus(Number(e.dataset.seriesIndex)))}triggerEventHandle(e,t){const n={element:e};switch(t){case!0:(0,i.triggerEvent)(i.events,"series_synchronizer_add",n);break;case!1:(0,i.triggerEvent)(i.events,"series_synchronizer_remove",n)}}removeSynchronizer(e){const t=e.querySelector(".seriesSynchronizerLayout");null==t||t.remove()}};const fu=class{createLayout(e,t,n){const o=e=>e>=0?`${e||Math.max(n,.1)}mm`:"",a=k("DICOMTags.thickness");e.forceRender=!0,new Fr("thicknessLayout",e,(e=>{const n=(0,s.createElement)({tagName:"span",className:"label",innerText:`${a}`}),r=(0,s.createElement)({tagName:"span",className:"num",innerText:o(t)}),l=(0,s.createElement)({className:"select-popup-item tool-event-link thickness"}),c=(0,s.createElement)({tagName:"input",type:"range",min:0,max:10,step:1,value:t,onclick:e=>{e.stopPropagation()},oninput:e=>{const t=Number(e.target.value);r.innerText=o(t),(0,i.triggerEvent)(i.events,"tool_event",{events:e,toolData:{toolTag:"MPRThicknessChange",disActive:!0},value:t,btnTarget:l})}});l.appendChild(n),l.appendChild(c),l.appendChild(r),e.appendChild(l)}))}};const gu=class{constructor(){this.confirmSeries={},this.toastDict=k("toast"),this.formData=()=>[{label:this.toastDict.prompt.PTLabel,type:"PT",seriesArr:j.fusionData.PT},{label:this.toastDict.prompt.CTLabel,type:"CT",seriesArr:j.fusionData.CT}]}createLayout(e){return new Promise((t=>{var n,o;const{webDicomView:a,fusionData:i,fusionData:{PT:r,CT:l}}=j;if(!a.isStudiesLoaded(!0))return t(null);if(!r.length)return t(null),st().error({title:this.toastDict.NoPTData});if(1===r.length&&1===l.length)return t({PT:r[0],CT:l[0]});const{metaArrOriginal:[{mod:c}]}=e;this.activeSeries=(i[c]||[]).find((({seriesUID:t})=>t===e.seriesUID))||r[0],this.activeSeries2=a.queryFusionSeries(this.activeSeries.metaArrOriginal)[0];const{layoutView:u}=j.webDicomView,{prompt:{OK:h,cancel:m}}=this.toastDict,p=(0,s.createElement)({className:"fusionLayout fusion-form"});for(const{label:e,type:t,seriesArr:a}of this.formData()){const i=(0,s.createElement)({className:`form-item ${t}`}),r=(0,s.createElement)({className:"item-label",innerText:e}),l=(0,s.createElement)({className:"item-value"});d(l);for(const e of a){const{seriesUID:a}=e,i=(null===(n=this.activeSeries)||void 0===n?void 0:n.seriesUID)===a||(null===(o=this.activeSeries2)||void 0===o?void 0:o.seriesUID)===a,r=u.leftSideContainer.querySelector(`.viewer-navigator-wrapper[data-series-u-i-d='${a}']`).cloneNode(!0);r.onclick=n=>{f(l.childNodes,r),g(r),this.confirmSeries[t]=e},i&&E().then((()=>{r.click()})),l.appendChild(r)}l.querySelector(".viewer-navigator-wrapper").click(),i.appendChild(r),i.appendChild(l),p.appendChild(i)}st().question({class:j.isMobile?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:this.toastDict.prompt.fusionTitle,displayMode:1,position:"center",icon:"",progressBar:!1,inputs:[['<div class="fusion-temp"/>',"change",(e,t,n,o)=>{},!1]],buttons:[[`<button class='confirm' >${h}</button>`,(e,n,o,a,i)=>{e.destroy(),t(this.confirmSeries)},!1],[`<button class='cancel' >${m}</button>`,(e,t,n,o)=>{e.hide({},t,"cancel")},!1]],onOpening:(e,t)=>{yn(t),document.querySelector(".fusion-temp").append(p)},onClosing:function(e,n,o){"confirm"!==o&&t(null)}})}))}};const pu=class{createLayout(e,t){e.forceRender=!0,new Fr("fusionLayout2",e,(e=>{var n;const{layoutView:o}=j.webDicomView;for(const a of t){const{seriesUID:t}=a,r=(null===(n=this.activeSeries)||void 0===n?void 0:n.seriesUID)===t,l=(0,s.createElement)({className:"select-popup-item tool-event-link",onclick:e=>{this.activeSeries=r?void 0:a,(0,i.triggerEvent)(i.events,"tool_event",{events:e,toolData:{toolTag:"MPRFusionChange",disActive:!0},btnTarget:l,activeSeries:this.activeSeries})}}),c=o.leftSideContainer.querySelector(`.viewer-navigator-wrapper[data-series-u-i-d='${t}']`).cloneNode(!0);r&&(o.toggleClassName(l,void 0,"active",!0),o.toggleClassName(c,void 0,"active",!0)),l.appendChild(c),e.appendChild(l)}}))}},vu=()=>{const e=k("DICOMInfo"),t=k("DICOMTags");return[{title:e.patient,labels:[{title:"name",alias:t.name},{title:"sex",alias:t.sex,format:hs},{title:"age",alias:t.age,format:ds},{title:"birth",alias:t.birthday},{title:"patientID",alias:t.patientID}]},{title:e.examinations,labels:[{title:"orgname",alias:t.hospitals},{title:"studydate",alias:t.acquisitionDate},{title:"acqtm",alias:t.acquisitionTime},{title:"studt",alias:t.studyDate},{title:"stutm",alias:t.studyTime},{title:"studes",alias:t.description},{title:"accnum",alias:t.accessionNumber}]},{title:e.series,labels:[{title:"serid",alias:t.seriesID},{title:"seruid",alias:t.seriesUID},{title:"serdes",alias:t.seriesDescription}]},{title:e.series,labels:[{title:"imgnum",alias:t.imageNumber},{title:"wc",alias:t.windowCenter},{title:"ww",alias:t.windowWidth},{title:"kv",alias:t.KVP},{title:"sliceth",alias:t.thickness},{title:"row",alias:t.rows},{title:"col",alias:t.cols},{title:"pixx",alias:t.pixelSpacingX},{title:"pixy",alias:t.pixelSpacingY},{title:"bita",alias:t.bitsAllocated},{title:"bits",alias:t.bitsStored},{title:"hbit",alias:t.highBit},{title:"rescin",alias:t.rescaleIntercept},{title:"rescsl",alias:t.rescaleSlope},{title:"pixrep",alias:t.pixelRepresentation},{title:"frames",alias:"Frames"},{title:"sappix",alias:t.samplesPerPixel},{title:"phme",alias:t.photometricInterpretation},{title:"imgpos",alias:t.imagePosition},{title:"imgori",alias:t.imageOrientation},{title:"imgtype",alias:"ImgType"},{title:"orl",alias:t.orientationLeft},{title:"orr",alias:t.orientationRight},{title:"ort",alias:t.orientationTop},{title:"orb",alias:t.orientationBottom},{title:"scount",alias:"Scount"},{title:"blocks",alias:t.blocks}]},{title:e.device,labels:[{title:"mod",alias:t.modality},{title:"manu",alias:t.manufacturer}]},{title:e.UID,labels:[{title:"id",alias:"ID"},{title:"uid",alias:"UID"},{title:"uuid",alias:"UUID"},{title:"sopuid",alias:t.sopInstanceUID},{title:"studyid",alias:t.studyID},{title:"stuuid",alias:t.studyUID},{title:"stuuid",alias:t.studyUID},{title:"syntaxuid",alias:t.transferSyntaxUID},{title:"relationid",alias:"RelationID"}]},{title:e.other,labels:[{title:"fileName",alias:t.fileName},{title:"fileLocation",alias:"FileLocation"},{title:"dcmfile",alias:"DCMFile"}]}]};function yu(){const{publicPath:e}=j.instanceOptions;if(e)return e;return(window.location.pathname.match(/(\/[^/]*)+\//)||["/"])[0]+"dicomviewer-cornerstone/"}const bu=class{constructor(){this.toastDict=k("toast.interGPU")}get disTips(){return JSON.parse(localStorage.getItem("disTips"))}set disTips(e){localStorage.setItem("disTips",JSON.stringify(e))}createLayout(e){return new Promise((t=>{var n;const{isMobile:o,instanceOptions:{losslessMPR:a}}=j,{force:i,gpuTier:r,seriesData:l}=e,{series:c,fusionData:u}=l||{},{gpu:d}=r||{},h=!d.includes("intel");if(!i&&((null===(n=c||(null==u?void 0:u.CT))||void 0===n?void 0:n.loadIds.length)<=200||this.disTips||!h||!1===a))return t(null);const{close:m,disReminders:f,title:g,tips:p}=this.toastDict,v=(0,s.createElement)({innerText:(h?p[0]:"")+p[1]}),y=(0,s.createElement)({tagName:"a",target:"_blank",innerText:p[2],href:`${yu()}doc/IntelGPU&BrowserCompatibilitySolutions-${D().includes("zh")?"zh":"en"}.pdf`});Object.assign(y.style,{color:"var(--theme-color2-dicom-viewer)"});const b=(0,s.createElement)({tagName:"span",innerText:p[3]});v.appendChild(y),v.appendChild(b),st().question({class:o?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:g,displayMode:1,position:"center",icon:"",progressBar:!1,inputs:[['<div class="inter-GPU-temp"/>',"change",(e,t,n,o)=>{},!1]],buttons:[[`<button class='confirm' >${m}</button>`,(e,n,o,a,i)=>{e.destroy(),t("ok")},!1],[`<button class=' ${i?"hidden":"cancel"}' >${f}</button>`,(e,t,n,o)=>{e.hide({},t,"cancel")},!1]],onOpening:(e,t)=>{yn(t),document.querySelector(".inter-GPU-temp").append(v)},onClosing:(e,n,o)=>{"confirm"!==o&&(this.disTips=!0,t(null),y.click())}})}))}};var xu=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const wu=class{constructor(){this.toolsDataMPR=Mr(),this.toolsDataVRT=Dr(),this.toolsData=Ar(),this.topTools=new eu,this.rotatePop=new Wr,this.imageTypeLayout=new Hr,this.wwwcLayout=new qr,this.scale=new us,this.colorMap=new rs,this.seriesMarker=new ms,this.seriesImageCruxMarker=new Zc,this.seriesSlider=new nu,this.studySlider=new ou,this.iconSynchronizer=new mu,this.seriesLayout=new du(this.seriesSlider,this.studySlider,this.iconSynchronizer),this.mprLayout=new hu("MPRContent"),this.vrtLayout=new hu("VRTContent"),this.iconPlayer=new uu,this.ThicknessLayout=new fu,this.FusionLayout=new gu,this.FusionLayout2=new pu,this.IntelGPULayout=new bu}resizeLayout(e=this.canvasContainer){e.querySelectorAll(".layoutCellsInner").forEach((e=>{e.querySelectorAll(".layoutImage").forEach((e=>{try{(0,i.resize)(e)}catch(e){}}));try{(0,i.resize)(e)}catch(e){}}))}createImageTypeLayout(e){this.imageTypeLayout.createLayout(e)}createWWWCLayout(e){this.wwwcLayout.createLayout(e)}createRotateLayout(e){this.rotatePop.createLayout(e)}createScaleLayout(e){this.scale.createLayout(e)}createColorMapLayout(e){this.colorMap.createLayout(e)}createPopupLayout(e,t,n=""){const{globalContainer:o}=j.webDicomView;let a=o.querySelector(".popupLayout"),i=null==a?void 0:a.querySelector(".popup-info-content"),r=null==a?void 0:a.querySelector(".popup-info-title");const l=()=>{a.style.visibility="hidden"};if(a)i.innerHTML="",r.innerText=e,a.style.visibility="initial";else{a=(0,s.createElement)({className:"popupLayout"});const t=(0,s.createElement)({className:"popup-info-layout"}),n=(0,s.createElement)({className:"popup-info-title-bar"});r=(0,s.createElement)({className:"popup-info-title",innerText:e});const c=(0,s.createElement)({className:"popup-info-close",innerText:k("other.close"),onclick:l});i=(0,s.createElement)({className:"popup-info-content"}),n.append(r),n.append(c),t.append(n),t.append(i),a.append(t),o.appendChild(a)}i.setAttribute("style",n),"string"==typeof t?i.innerHTML=t:i.append(t)}createDICOMMetaInfoLayout(e){var t;let n="";for(const{title:o,labels:a}of vu()){n+=`<div class='title'>${o}</div>`;for(const{title:o,alias:i,format:r}of a){let a=null!==(t=e[o])&&void 0!==t?t:"";a="function"===(0,s.dataType)(r)?r(a):a,n+=`\n\t\t\t\t\t\t<div class='DICOM-meta-data-cell' title='${i&&i.toLowerCase()===o.toLowerCase()?"":i+","}${o}${a||"undefined"}'>\n\t\t\t\t\t\t<div class='label'>${i||o}</div>\n\t\t\t\t\t\t<div class='value'>${a}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`}}this.createPopupLayout(k("tools.DICOMInfo"),n)}createAboutUsLayout(e){const t=k("aboutUs"),{version:n,copyright:o,description:a,tel:i,imgURl:r}=e,l=(0,s.createElement)({tagName:"div",className:"about-Us-2"}),c=(0,s.createElement)({tagName:"div",className:"contains"}),u=(0,s.createElement)({tagName:"div",className:"bar"}),d=(0,s.createElement)({tagName:"div",className:"logo"}),h=a?(0,s.createElement)({tagName:"div",className:"dark description",innerHTML:`${"function"===(0,s.dataType)(a)?a():a}`}):"",m=n?(0,s.createElement)({tagName:"div",innerHTML:`<span class="dark">${t.releaseVersion}</span><span class="bold">V${String(n).split(".")[0]}</span>`}):"",f=n?(0,s.createElement)({tagName:"div",innerHTML:`<span class="dark">${t.fullVersion}</span><span class="bold">V${n}</span>`}):"",g=o?(0,s.createElement)({tagName:"div",innerHTML:`<i class="iconfont icon-dicom-contacts"></i><span class="bold">${"function"===(0,s.dataType)(o)?o():o}</span>`}):"",p=i?(0,s.createElement)({tagName:"div",innerHTML:`<i class="iconfont icon-dicom-tel"></i><span class="bold">${"function"===(0,s.dataType)(i)?i():i}</span>`}):"";u.append(g),u.append(p),r&&(d.style.backgroundImage=`url(${r})`),(r||void 0===r)&&c.append(d),c.append(h),c.append(m),c.append(f),l.append(c),l.append(u),this.createPopupLayout(k("tools.aboutUs"),l,"padding:0;height:auto;")}createImageLayout(e,t){const n=(0,s.createElement)({tagName:"img",src:e,alt:t});Object.assign(n.style,{margin:"auto",height:"100%"}),this.createPopupLayout(k("toast.saveImage"),n)}createSeriesMarker(e,t,n,o){const a=j.webDicomView.queryStudy(n.stuuid)||j.webDicomView.queryStudy(t.studyUID);this.seriesMarker.createParagraph(e,"ltMarker",n,o,a),this.seriesMarker.createParagraph(e,"rtMarker",n,o,a),this.seriesMarker.createParagraph(e,"lbMarker",n,o,a),this.seriesMarker.createParagraph(e,"rbMarker",n,o,a)}imageType(e){this.imageTypeLayout.handleLayout(e)}wwwcImage(e,t){this.wwwcLayout.handleLayout(e,t)}scaleImage(e,t){this.scale.handleLayout(e,t)}rotateImage(e,t){this.rotatePop.handleLayout(e,t)}colorMapImage(e,t){this.colorMap.handleLayout(e,t)}createSeriesCellLayout(e,t,n,o){const{x:a=6,y:r=6}=n||{};new Fr("series"===t?"series":"image",e.detail,(e=>{for(let n=1;n<=r;n++)for(let o=1;o<=a;o++){let a=(0,s.createElement)({className:"select-grid-item",onclick:()=>{(0,i.triggerEvent)(i.events,"series"===t?"tool_series_layout":"tool_series_image_layout",{type:t,ptCell:{x:o,y:n}})},onmouseover:()=>{this.changeCellStyle(e,{x:o,y:n})}});a.setAttribute("data-x",o+""),a.setAttribute("data-y",n+""),e.appendChild(a)}e.setAttribute("style",`\n\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\tgrid-template-columns: repeat(${a}, 24px);\n\t\t\t\t\t\tgrid-template-rows: repeat(${r}, 24px);\n\t\t\t\t\t\tpadding: 4px;\n\t\t\t\t\t\t`)}),(e=>{this.changeCellStyle(e,o)}))}initLayout(e){const t=(0,s.createElement)({className:"dicomViewToolbar"}),n=(0,s.createElement)({tagName:"img",src:j.logoURL,className:"logo",crossOrigin:"Anonymous"}),o=(0,s.createElement)({className:"divider"}),a=(0,s.createElement)({className:"viewerContentWrapper",id:"viewerContentWrapper"});if(this.leftSideContainer=(0,s.createElement)({className:"viewerLeftSidePanel"}),this.studyNavigationBody=(0,s.createElement)({className:"study-navigation-body"}),this.canvasContainer=(0,s.createElement)({className:"canvasbox",oncontextmenu:e=>e.preventDefault()}),this.toolsContainer=(0,s.createElement)({className:"toolbar"}),d(this.toolsContainer),this.toolsContainer.addEventListener("touchmove",(function(e){const{type:t}=e;(0,i.triggerEvent)(i.events,"layout_area_focus",{area:"toolbarLayout",type:t})}))," "!==j.logoURL){const e=this.logoGrouper=(0,s.createElement)({className:"logoGroup"});e.appendChild(o),e.appendChild(n),t.appendChild(e)}j.isMobile&&e.classList.add("isMobile"),j.toolsBar.navigationBottomLayout&&(e.classList.add("navigationBottomLayout"),this.studyNavigationHead=(0,s.createElement)({className:"study-navigation-head"}),this.studyMenuLayout=new au(this.iconPlayer,this.studyNavigationHead),this.leftSideContainer.style.height="118px",this.leftSideContainer.appendChild(this.studyNavigationHead)),this.leftSideContainer.appendChild(this.studyNavigationBody),a.appendChild(this.leftSideContainer),a.appendChild(this.canvasContainer),t.appendChild(this.toolsContainer),e.classList.add("dicomView"),e.addEventListener("touchstart",(function(e){e.stopPropagation()})),e.appendChild(t),e.appendChild(a)}initTop2DTools(e,t=!1){const n=br().main.find((t=>t.toolTag===e));this.topTools.createTopTools(this.toolsContainer,this.toolsData,n,"tools2d",t)}initTopMPRTools(e,t=!0){const n=br().MPR.find((t=>t.toolTag===e));this.topTools.createTopTools(this.toolsContainer,this.toolsDataMPR,n,"toolsMPR",t)}initTopVRTTools(e,t=!0){const n=br().VRT.find((t=>t.toolTag===e));this.topTools.createTopTools(this.toolsContainer,this.toolsDataVRT,n,"toolsVRT",t)}createStudyNavigationGroup(e,t){var n;const{seriesArr:o}=e,a=(0,s.createElement)({className:"study-navigation-container"}),i=o.length;a.dataset.studyUID=e.studyUID,this.studyNavigationBody.appendChild(a),this.navigatorStudyToggleStyle(a,i),j.toolsBar.navigationBottomLayout?(0===t?this.seriesBarIconToggle(!0):a.classList.add("hidden"),null===(n=this.studyMenuLayout)||void 0===n||n.createLayout(e,t)):this.renderStudyInfo(a,e,i),this.renderDicomIcon(a,o,t)}renderDicomIcon(e,t,n){let o=(0,s.createElement)({className:"body-bar"}),a=null;t.forEach(((e,t)=>{const{describ:r,icon:l,seriesUID:c,imgs:u,flatSeries:d}=e,h={series:e},m=(0,s.createElement)({className:"viewer-navigator-wrapper",draggable:!0,onclick:e=>{clearTimeout(a),a=setTimeout((()=>{(0,i.triggerEvent)(i.events,"navigator_active",Object.assign(Object.assign({},h),{target:e.target,type:"click",event:e})),g(m,e.isTrusted?0:500)}),200)},ondblclick:()=>{clearTimeout(a),(0,i.triggerEvent)(i.events,"navigator_dbClick_drag",Object.assign(Object.assign({},h),{type:"dblclick"})),g(m)},ondragend:e=>{"none"!==e.dataTransfer.dropEffect&&(0,i.triggerEvent)(i.events,"navigator_dbClick_drag",Object.assign(Object.assign({},h),{type:"drag"}))},oncontextmenu:e=>{e.preventDefault()}});j.isMobile&&new(Ct())(m).on("press doubletap",(()=>{(0,i.triggerEvent)(i.events,"navigator_dbClick_drag",Object.assign(Object.assign({},h),{type:"press doubletap"}))}));const f=(0,s.createElement)({className:"navigator-card"}),p=(0,s.createElement)({tagName:"div",className:"icon-image"}),v=(0,s.createElement)({tagName:"div",className:"navigator-text-wrapper"}),y=(0,s.createElement)({tagName:"div",className:"text",innerHTML:`<i class=icon-dicom-series-2></i> <span>${t+1}</span> `}),b=(0,s.createElement)({tagName:"div",className:"num",innerHTML:`<i class=icon-dicom-image></i> <span>${u.length}</span>`}),x=(0,s.createElement)({tagName:"div",className:"navigator-description",title:r,innerHTML:`${r||""}`}),w=(0,s.createElement)({tagName:"img",src:l,crossOrigin:"Anonymous",decoding:"async",draggable:!1}),T=(0,s.createElement)({className:"AI-icon",tagName:"span"}),I=(0,s.createElement)({tagName:"div",className:"progressGroup"}),E=(0,s.createElement)({tagName:"span",className:"progressNum"}),S=(0,s.createElement)({tagName:"div",className:"progressBar"});if(0==n&&0===t&&(m.classList.add("active"),E.innerText="0%"),m.dataset.seriesUID=c,m.dataset.index=String(t),d&&(m.dataset.flatSeries=String(d)),(0,s.env)().isWeChat){const e=(0,s.createElement)();e.setAttribute("style","\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t"),p.appendChild(e)}p.appendChild(w),p.appendChild(T),v.appendChild(y),v.appendChild(b),I.appendChild(E),I.appendChild(S),f.appendChild(p),f.appendChild(v),f.appendChild(x),m.appendChild(f),m.appendChild(I),o.appendChild(m)})),e.appendChild(o)}renderStudyInfo(e,t,n){const{name:o,sex:a,age:i,modality:r,studydate:l}=t,c=(0,s.createElement)({className:"panel-info"}),u=(0,s.createElement)({tagName:"p",innerHTML:`<span title='${o}'>${o||"-"}</span>/${hs(a)||"-"}/${ds(i)||"-"}`}),d=(0,s.createElement)({tagName:"p",innerText:r}),h=(0,s.createElement)({tagName:"p",innerText:l});c.appendChild(d),c.appendChild(u),c.appendChild(h),e.appendChild(c),c.onclick=()=>{this.navigatorStudyToggleStyle(e,n)}}navigatorStudyToggleStyle(e,t){e.classList.contains("active")?e.style.cssText=void 0:j.toolsBar.navigationBottomLayout?e.style.maxWidth=68*t+100+"px":e.style.maxHeight=120*t+100+"px",e.classList.toggle("active")}seriesBarToggle(e){var t;this.leftSideContainer.classList.toggle("show",e),null===(t=this.logoGrouper)||void 0===t||t.classList.toggle("show",e),this.seriesBarIconToggle(e)}seriesBarIconToggle(e){this.toggleClassName(this.querySelectorForTool(".seriesBar"),void 0,"active",e)}navigationMenuCloseHandle(e=!1){var t;return xu(this,void 0,void 0,(function*(){j.toolsBar.navigationBottomLayout&&(null===(t=this.studyMenuLayout)||void 0===t||t.toggleMenuVisibility(!1),e&&(yield E(500).then((()=>this.resizeLayout()))))}))}selectPopupHidden(){var e;null===(e=this.toolsContainer.querySelector(".select-popup-layout:not(.invisible)"))||void 0===e||e.classList.add("invisible"),this.removeOpenMark()}removeOpenMark(){var e;null===(e=this.toolsContainer.querySelector(".select-popup-layout .open-mark"))||void 0===e||e.classList.remove("open-mark")}toggleToolStyle(e){const{disActive:t,isToggle:n,btnTarget:o,toolType:a,toolTag:i,btnOriginTarget:r,parentData:s,children:l}=e||{},{isLonelyGroup:c,disActive:u}=s||{};if(t||e.isLonelyGroup||l)return;if(n&&o)return o.classList.toggle("active"),void(null==r||r.classList.toggle("active",!!o.parentElement.querySelector(".active")));let d=this.toolsContainer.querySelectorAll(".toolsChild.active .tool-event-link");c&&o&&(d=o.parentElement.querySelectorAll(".tool-event-link")),d.forEach((e=>xu(this,void 0,void 0,(function*(){const{disActive:t,isToggle:n,children:o,parentData:{isLonelyGroup:a}={isLonelyGroup:void 0}}=JSON.parse(e.dataset.toolData||"{}");t&&!o||n||(c===a&&e.classList.remove("active"),o&&!t&&(yield E(),e.classList.toggle("active",!!e.querySelector(".active"))))})))),null==o||o.classList.add("active"),!u&&(null==r||r.classList.add("active")),this.toolsContainer.querySelectorAll(`.tool-event-link.${a||i}:not(.active)`).forEach((e=>{e.classList.add("active")}))}changeCellStyle(e,t){if(!t)return;const n=e.getElementsByTagName("div");for(let e=0;e<n.length;e++){const o=Number(n[e].getAttribute("data-x")),a=Number(n[e].getAttribute("data-y"));o<=t.x&&a<=t.y?n[e].classList.add("active"):n[e].classList.remove("active")}}progressCountStyle(e,t,n=0,o=!1){const a=this.leftSideContainer.querySelector(`.viewer-navigator-wrapper[data-series-u-i-d='${e}']`);if(!a)return;if(o)a.classList.add("showProgress");else if(!a.classList.contains("showProgress")&&!a.classList.contains("active"))return;const i=a.querySelector(".progressNum"),r=a.querySelector(".progressBar");let s;if(t>=0&&(s=(n/t*100).toFixed(0)+"%",i.innerText=s,r.style.width=s),"100%"===s)return a.classList.add("loaded"),void a.classList.remove("showProgress");void 0!==t||o||a.classList.remove("showProgress")}toggleCavanAroundInfoStyle(e){this.canvasContainer.querySelectorAll(".ltMarker,.rtMarker,.bMarker,.rbMarker").forEach((t=>{t.style.opacity=e?"1":"0"}))}toggleAIIconStyle(e){var t;e?e.forEach((e=>{var t;null===(t=this.leftSideContainer.querySelector(`.viewer-navigator-wrapper[data-series-u-i-d='${e}']`))||void 0===t||t.classList.add("show-AI")})):null===(t=this.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper.show-AI"))||void 0===t||t.forEach((e=>{e.classList.remove("show-AI")}))}toggleClassName(e,t,n,o){const a=this.querySelector(e,t);null==a||a.classList.toggle(n,o)}querySelector(e=this.toolsContainer,t){return t?e.querySelector(t):e}querySelectorForTool(e,t){return this.toolsContainer.querySelector(`${t||""} .tool-event-link${e}`)}containsClassName(e,t){return null==e?void 0:e.classList.contains(t)}clearSeriesLayout(e,t=!1,n=!1){var o;const a=e.querySelector(".imageLayoutGroup"),i=e.querySelectorAll(".layoutImage"),r=e.querySelectorAll(".ltMarker,.rtMarker,.lbMarker,.rbMarker");if(this.iconPlayer.playerRemove(e),t?null===(o=e.querySelector("canvas"))||void 0===o||o.remove():lr(e),i.forEach((e=>{lr(e),null==e||e.remove()})),null==a||a.remove(),r.forEach((e=>{null==e||e.remove()})),this.seriesImageCruxMarker.removeLayout(e),this.seriesSlider.removeLayout(e),this.iconSynchronizer.removeSynchronizer(e),!n)for(const t of["studyUID","seriesUID","seriesColumn","seriesRow","seriesIndex","currentImageIdIndex"])delete e.dataset[t]}};var Tu=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const Iu=class{constructor(e){this.iziToast=st(),this.options=Object.assign({message:void 0,position:"center",class:j.isMobile?"custom-iziToast-mobile":"custom-iziToast",close:!1,theme:"dark",overlay:!0,image:n(1972),timeout:!1,progressBar:!1,onOpening:(e,t)=>{yn(t)}},e),this.loading=!1}get dicomViewContainer(){return this._dicomViewContainer=this._dicomViewContainer||j.webDicomView.globalContainer}show(e){this.loading||(this.loading=!0,st().show(Object.assign(Object.assign({},this.options),e)))}progress(e){return Tu(this,void 0,void 0,(function*(){return yield E(),st().progress(Object.assign({},e),this.$toast())}))}hidden(){this.loading&&(this.loading=!1,st().destroy())}$toast(){return document.querySelector("."+this.options.class)}};var Eu=n(5373),Su=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};class Cu{constructor(e,t){this.x=e,this.y=t}}const Au=class{constructor(){this.t=k("toast.3D"),this.ptLast={x:0,y:0},this.webDcmSocket=void 0,this.seriesUID=void 0,this.loadingAnimation=new Iu({message:this.t.loading}),this.zoomLazy=(0,s.throttle)((e=>{this.zoom(e)}),j.isMobile?150:40),this.KnifeMoveLazy=(0,s.throttle)((e=>{this.KnifeMove(e)}),40),this.rotateLazy=(0,s.throttle)((e=>{this.rotate(e)}),100),this.windowsLevelLazy=(0,s.throttle)((e=>{this.windowsLevel(e)}),60),this.panLazy=(0,s.throttle)((e=>{this.pan(e)}),100)}open(e,t){const{seriesUID:n,hospID:o,studyUID:a,wadoURL:i,vrtWsURl:r,layoutView:l}=t;if(!e.querySelector("#canvas-vrt")){const t=["touchstart","mousedown","touchmove","mousemove","touchend","mouseup","mouseout","mousewheel"],n=this.canvas=(0,s.createElement)({tagName:"canvas",id:"canvas-vrt",width:e.clientWidth,height:e.clientHeight});e.appendChild(n);const o=(0,s.throttle)((()=>{n.width=e.clientWidth,n.height=e.clientHeight,this.resizeCanvasDrawImage()}),500);this.resizeObserver=new ResizeObserver(o),this.resizeObserver.observe(e);for(const e of t)n.addEventListener(e,(e=>{this.msgTransform(e)}));const a=new(Ct().Manager)(n);a.add(new(Ct().Pinch)({threshold:.2})),a.add(new(Ct().Pan)({threshold:10,pointers:2})),a.on("pinch",(e=>{this.zoomLazy(e),e.preventDefault()})),a.on("panmove",(e=>{this.panLazy(e),e.preventDefault()}))}const c=b(n),u=i+"/GetImagesPath"+(0,Eu.stringify)({seruuid:n,seriesUID:n,hospcode:o,studyuid:a,studyUID:a},{addQueryPrefix:!0});if(!r)throw"3D service path is undefined";if(this.webDcmSocket){if(this.seriesUID===c)return void this.refresh();this.webDcmSocketClose()}this.seriesUID=c;let d=r+"/Wado?serurl="+encodeURIComponent(u);this.webDcmSocket=new WebSocket(d),this.loadingAnimation.show(),this.webDcmSocket.onclose=e=>{this.loadingAnimation.hidden(),"leave"!==e.reason&&(ut("webDcmSocketError",this.t.close),console.info("Connection closed",e))},this.webDcmSocket.onerror=e=>{this.loadingAnimation.hidden(),ut("webDcmSocketError",this.t.error),console.info("An error occur",e),l.initTop2DTools(),Lu()},this.webDcmSocket.onmessage=e=>{if("string"==typeof e.data)console.info(JSON.parse(e.data));else{let t=new FileReader;t.onload=e=>{e.target.readyState==FileReader.DONE&&(this.loadingAnimation.hidden(),this.webDcmSocketResult=t.result,(0,s.canvasDrawImage)(this.canvas,this.webDcmSocketResult))},t.readAsDataURL(e.data)}}}resizeCanvasDrawImage(){this.canvas&&this.webDcmSocketResult&&(0,s.canvasDrawImage)(this.canvas,this.webDcmSocketResult)}msgTransform(e){var t;if(!((null===(t=e.targetTouches)||void 0===t?void 0:t.length)>1))switch(e.type){case"touchstart":case"mousedown":{let t;if("touchstart"===e.type){const n=e.targetTouches[0];t=new Cu(n.pageX,n.pageY),this.which=1}else t=new Cu(e.pageX,e.pageY),this.which=e.which;this.ptLast=t}break;case"touchmove":case"mousemove":this.mouseDownMove(e);break;case"touchend":case"mouseup":case"mouseout":this.mouseUp(),this.which=void 0;break;case"mousewheel":this.zoomLazy(e)}}mouseDownMove(e){if(1===this.which)switch(this.toolType){case"KnifeIn":case"KnifeOut":this.KnifeMoveLazy(e);break;case"Modulation":this.windowsLevelLazy(e);break;default:this.rotateLazy(e)}else 3===this.which?this.windowsLevelLazy(e):2===this.which&&this.panLazy(e)}mouseUp(){switch(this.toolType){case"KnifeIn":case"KnifeOut":this.knifeEnd(),this.toolType=void 0}}errorHandle(e,t){"cancel"!==t&&console.error(e,t)}getPosition(e){const{pageX:t,pageY:n}="touchmove"==e.type?e.targetTouches[0]:e,o=new Cu(t,n),a=this.ptLast.x,i=this.ptLast.y,r=o.x-a,s=o.y-i;if(0===r&&0===s)return Promise.reject("cancel");const l=e.target.getBoundingClientRect(),c=Math.round(l.left+window.scrollX),u=Math.round(l.top+window.scrollY);return this.ptLast=o,Promise.resolve({LastPosition:[a-c,i-u],NowPosition:[t-c,n-u],rect:l})}rotate(e){return Su(this,void 0,void 0,(function*(){try{const{LastPosition:t,NowPosition:n}=yield this.getPosition(e);this.webDcmSocketSend({Cmd:1,LastPosition:t,NowPosition:n})}catch(e){this.errorHandle("rotate",e)}}))}pan(e){return Su(this,void 0,void 0,(function*(){try{if("panmove"==e.type){const{x:t,y:n}=e.center||{};e.pageX=Math.floor(t),e.pageY=Math.floor(n)}const{LastPosition:t,NowPosition:n}=yield this.getPosition(e);this.webDcmSocketSend({Cmd:2,LastPosition:t,NowPosition:n})}catch(e){this.errorHandle("pan",e)}}))}zoom(e){const{type:t,scale:n,deltaY:o}=e;this.webDcmSocketSend({Cmd:3,DeltaY:"pinch"===t?n>=1?1:-1:o>0?-1:1})}windowsLevel(e){return Su(this,void 0,void 0,(function*(){try{const{LastPosition:t,NowPosition:n}=yield this.getPosition(e);this.webDcmSocketSend({Cmd:4,LastPosition:t,NowPosition:n})}catch(e){this.errorHandle("windowsLevel",e)}}))}KnifeMove(e){return Su(this,void 0,void 0,(function*(){try{const{LastPosition:t,NowPosition:n,rect:o}=yield this.getPosition(e);this.webDcmSocketSend({Cmd:5,LastPosition:t,NowPosition:n,ViewWidth:Math.round(o.width),ViewHeight:Math.round(o.height)})}catch(e){this.errorHandle("KnifeMove",e)}}))}toolsToggle(e){this.toolType=e}knifeBegin(e,t=(()=>{})){if("function"!=typeof t)throw"callback function is required";this.toolType=e,this.knifeFinishCallback=t,this.webDcmSocketSend({KnifeOut:{Cmd:6},KnifeIn:{Cmd:7}}[e])}knifeEnd(){const e=this.knifeFinishCallback;if(this.webDcmSocketSend({Cmd:8}),"function"!=typeof e)throw"callback function is required";e()}reset(){if(this.webDcmSocket.readyState>=2)return this.reconnect();this.webDcmSocketSend({Cmd:0})}refresh(){this.webDcmSocketSend({Cmd:99})}webDcmSocketClose(){this.webDcmSocket&&(this.webDcmSocket.close(1e3,"leave"),this.webDcmSocket=void 0)}webDcmSocketSend(e){this.webDcmSocket.send(JSON.stringify(e))}reconnect(){const{onclose:e,onerror:t,onmessage:n,onopen:o,url:a}=this.webDcmSocket;this.webDcmSocketClose(),this.webDcmSocket=new WebSocket(a),this.webDcmSocket.onclose=e,this.webDcmSocket.onmessage=n,this.webDcmSocket.onerror=t,this.webDcmSocket.onopen=o}destroy(){this.webDcmSocketClose(),this.resizeObserver.disconnect(),this.canvas.remove()}};let Mu,Du;const Pu=()=>{var e;null===(e=Du.toolsContainer.querySelector(".toolsChild .tool-event-link.VRTRotate"))||void 0===e||e.click()},Lu=()=>{if(Mu)try{Mu.destroy()}catch(e){console.error(e)}finally{Mu=void 0,Du.vrtLayout.hidden()}};const ku=class{constructor(e){this.states=[],this.originStates=[],this.addSeriesArr(e)}addSeriesArr(e){for(const t of e){const{studyUID:e,seriesUID:n}=t;this.states.push({studyUID:e,seriesUID:n,series:t,scrollIndex:0,synchronizerStatus:!1})}}getStates(){return this.states}getStatesLength(){return this.states.length}getSeries(e="states"){return("states"===e?this.states:this.originStates).map((({series:e})=>e))}getSeriesActiveIndex(e){let t;for(let n=0;n<this.states.length;n++){if(this.states[n].seriesUID===e){t=n;break}}return t}removeSerie(e){this.states[e]={studyUID:void 0,seriesUID:void 0,scrollIndex:void 0,synchronizerStatus:void 0,series:void 0}}syncState(e="states"){this[e]="states"===e?[...this.originStates]:[...this.states]}getOriginState(){return this.originStates}setState(e,t){this.states[e]=Object.assign(Object.assign({},this.states[e]),t)}setSynchronizerStatus(e,t){this.states[e]=Object.assign(Object.assign({},this.states[e]),{synchronizerStatus:t})}getSynchronizerStatus(e){const{synchronizerStatus:t}=this.states[e];return t}setScrollIndex(e,t){this.states[e]=Object.assign(Object.assign({},this.states[e]),{scrollIndex:t})}};const Ou=class{};const Ru=class extends Ou{constructor(e){super(),this.id=e.id,this.num=e.num,this.imageIcon=e.imageIcon,this.isLoadImage=e.isLoadImage}setInfo(e){if(this.name=e.name.replace(/\^/g,""),this.sex=e.sex,this.age=e.age,this.birth=e.birth,this.patid=e.patid,this.mod=e.mod,this.accnum=e.accnum,this.stuid=e.stuid,this.stuuid=e.stuuid,this.studes=e.studes,this.serid=e.serid,this.seruid=e.seruid,this.serdes=e.serdes,this.imgnum=e.imgnum,this.sopuid=e.sopuid,this.uid=e.uid,this.blocks=parseInt(e.blocks),this.studt=e.studt,this.stutm=e.stutm,"string"==typeof e.stutm&&e.stutm.indexOf(":")<0||"string"==typeof e.stutm&&e.studt.indexOf("-")<0)for(let t=0;t<2;t++){const n=e.stutm.substr(2*t,2),o=e.studt.substr(2*t+4,2);0==t&&(this.stutm=n,this.studt=e.studt.substr(0,4)),this.stutm+=":"+n,this.studt+="-"+o}else this.stutm=e.stutm,this.studt=e.studt;if(this.acqdt=e.acqdt,this.acqtm=e.acqtm,this.acqtm&&(this.acqtm=parseFloat(e.acqtm).toFixed(3)),this.wc=parseFloat(e.wc),this.ww=parseFloat(e.ww),this.ma=e.ma,this.kv=e.kv,this.sliceth=e.sliceth,this.manu=e.manu,this.inst=e.inst,this.row=parseInt(e.row),this.col=parseInt(e.col),"string"==typeof e.pixx&&"string"==typeof e.pixx){if(-1!=e.pixx.indexOf(" ")){const t=e.pixx.split(" ");2==t.length&&(this.pixx=parseFloat(t[0]),this.pixy=parseFloat(t[1]))}this.pixx=parseFloat(e.pixx),this.pixy=parseFloat(e.pixy)}this.bita=parseInt(e.bita),this.bits=e.bits,this.hbit=e.hbit,this.rescin=parseInt(e.rescin),this.rescsl=parseFloat(e.rescsl),(""===e.rescin||null===e.rescin||isNaN(this.rescin))&&(this.rescin=0),(""===e.rescsl||null===e.rescsl||isNaN(this.rescsl)||this.rescsl<1)&&(this.rescsl=1),this.pixrep=parseInt(e.pixrep),this.sappix=parseInt(e.sappix),this.phme=e.phme,this.orl=e.orl,this.ort=e.ort,this.orr=e.orr,this.orb=e.orb,this.strScount=e.scount}setData(e){void 0!==e&&(this.pixelBuffer=e,this.isLoadImage=!0,this.getMaxMinGary())}getMaxMinGary(){let e,t=1e6,n=-1e6;for(let o=0;o<this.pixelBuffer.length;o++)e=this.pixelBuffer[o],e>t&&(t=e),e<n&&(n=e);this.minGary=n,this.maxGary=t}};const Nu=class{constructor({describ:e,icon:t,imgs:n,num:o,uid:a,uuid:i,flatSeries:r,studyUID:s}){this.flatSeries=!1,this.describ=e,this.imgs=n,this.num=o,this.uid=a,this.uuid=i,this.seriesUID=i||a,this.studyUID=s,this.icon=t,this.flatSeries=r}initSeries(){this.imgs.forEach((e=>{const t=new Ru({id:e.id,num:e.num,imageIcon:this.icon,isLoadImage:!1});this.dicomInfos.push(t)}))}initMeta(e,t){e.sort(((e,t)=>Number(e.imgnum)-Number(t.imgnum)));const{studyUID:n,imgs:o,flatSeries:a,seriesUID:i}=this,r=e.length,s=(e,t)=>e+(e.includes("?")?"&":"?")+`v=${t}`;let l=[];for(let t=0;t<r;t++){const{url:r}=o[a?0:t]||{},{url:c,id:u,acqtm:d,isIM:h,blocks:m}=e[t];let f;1===j.imageType?(f=r||c||j.webDicomView.wado+"/GetBlock/"+u+(0,Eu.stringify)({studyuid:n,hospitalid:j.webDicomView.hospID,seriesId:i,blockIndex:0,imageType:1},{addQueryPrefix:!0}),f=s(f,d),e[t].url=f,f="wadouri:"+f):(f=r||c||j.webDicomView.wado+"/GetBlock/"+u+(0,Eu.stringify)({studyuid:n,hospitalid:j.webDicomView.hospID,seriesId:i,blockIndex:0},{addQueryPrefix:!0}),f=s(f,d),e[t].url=f,(h||j.forceIM)&&Number(m||1)<=1&&(f="IM:"+f+"&isIM")),e[t].imageIdURL=f,l.push(f)}this.seriesIndex=t,this.loadIds=a?l.filter(((e,n)=>n===t)):l,this.metaArrOriginal=a?e.filter(((e,n)=>n===t)):e,this.multiframe={numFrames:void 0,frameRate:void 0}}};const _u=class{constructor({age:e,hasDesensitize:t,hasseries:n,hospID:o,imgs:a,imgcount:i,modality:r,name:s,orginaltype:l,orgname:c,patientid:u,seriescount:d,serieses:h,sex:m,storageType:f,studydate:g,studyid:p,studyuid:v,studyuuid:y},b){this.seriesArr=[],this.images=[],this.wado=b,this.age=e,this.hasDesensitize=t,this.hospID=o,this.studyID=p,this.studyUID=y||v||p,this.studyUUID=y||v||p,this.hasseries=parseInt(n),this.orgname=c,this.imgCount=parseInt(i),this.imgs=a,this.modality=null==r?void 0:r.toUpperCase(),this.name=s.replace(/\^/g,""),this.originalType=l,this.patientID=u,this.seriescount=d,this.studydate=I(g,"yyyy-MM-dd"),this.studytime=I(g,"hh:mm:ss"),this.seriesArrOriginal=h.sort(((e,t)=>Number(e.num)-Number(t.num))),this.sex=m,this.storageType=f,this.totaltype="RAW",this.hasseries?this.setSeries():this.setImages(a)}setSeries(e=this.seriesArrOriginal){delete this.seriesArrOriginal,e.forEach(((e,t)=>{const{desp:n,imgs:o,num:a,uid:i,uuid:r,sign:s,flatSeries:l}=e;e.imgs.sort(((e,t)=>Number(e.num)-Number(t.num))),this.seriesArr.push(new Nu({describ:n,imgs:o,flatSeries:l,uid:i+(l?"?index="+t:""),uuid:r+(l?"?index="+t:""),num:a,studyUID:this.studyUID,wado:this.wado,icon:this.wado+"/GetImageThumb/"+o[0].id+(0,Eu.stringify)({studyuid:this.studyUID,studyUID:this.studyUID,seriesId:r||i,seriesID:r||i,hospId:this.hospID,hospID:this.hospID,sign:s},{addQueryPrefix:!0})}))}))}setImages(e){void 0!==e&&e.forEach((e=>{let t=new Ru({id:e.id,num:e.num,imageIcon:this.wado+"/GetImageThumb"+e.id,isLoadImage:!1});this.images.push(t)}))}setSeriesDicom(e){e instanceof Array&&e.forEach((e=>{this.setDicomMeta(e)}))}setDicomMeta(e){for(let t=0;t<this.seriesArr.length;t++){let n=this.seriesArr[t];for(let t=0;t<n.dicomInfos.length;t++){let o=n.dicomInfos[t];o.id==e.id&&o.setInfo(e)}}}deepCopy(e,t){t=t||new Nu(null);for(let n in e)"object"==typeof e[n]&&null!=e[n]?(t[n]=e[n].constructor===Array?[]:{},this.deepCopy(e[n],t[n])):t[n]=e[n];return t}getStudyType(){let e="";return"JPG"==this.totaltype?e="jpg":"RAW"==this.totaltype&&(e="series"),e}getSeriesLayoutCount(){const{x:e,y:t}=j.instanceOptions.seriesLayoutDefault||{},n={x:1,y:1};return e&&t?{x:Math.max(Math.trunc(e)||0,1),y:Math.max(Math.trunc(t)||0,1)}:j.isMobile?n:["CT","MR"].includes(this.modality)?{x:2,y:2}:n}getDicomByID(e){let t=null,n=null;for(let o=0;o<this.seriesArr.length;o++){t=this.seriesArr[o];for(let o=0;o<t.arrImage.length;o++)if(n=t.arrImage[o],n.id==e)return n}}getAllDicom(){let e=[];return this.seriesArr.forEach((t=>{t.dicomInfos.forEach((t=>{e.push(t)}))})),e}};const Uu=function(e,t,n,o){let a=!1;0===e.indexOf("_")&&(t=t.replace("wadouri:","")),t.includes("web:")&&(t=t.replace("web:",""),a=!0),t.includes("cacheDB:")&&(t=t.replace(/(cacheDB:)|(wadouri:)/g,"")),"cornerstone3D"===o&&t.includes("wadouri:")&&(t=t.replace("wadouri:","")),t.includes("frame")&&(t=t.replace(/[?&]frame=[^?&]*/,""));const i=n.get(t)||n.get("IM:"+t)||n.get("wadouri:"+t);if(i){if("_grayImageModule"===e){const{transferSyntaxUID:e,rows:t,columns:n,rescaleIntercept:o,rescaleSlope:r,bitsAllocated:s,photometricInterpretation:l,pixelRepresentation:c,windowCenter:u,windowWidth:d,blocks:h}=i;return Object.assign({windowWidth:d[0],windowCenter:u[0],rows:t,columns:n,rescaleSlope:r,rescaleIntercept:o,photometricInterpretation:l,bitsAllocated:s,pixelRepresentation:c,blocks:h,transferSyntaxUID:e},a&&{windowWidth:[256],windowCenter:[128],photometricInterpretation:"RGB",bitsAllocated:24,pixelRepresentation:0})}if("_imageOrientationTagModule"===e){const{imageBottomTag:e,imageleftTag:t,imagetightTag:n,imagetopTag:o}=i;return{imageBottomTag:e,imageleftTag:t,imagetightTag:n,imagetopTag:o}}if("_IDModule"===e){const{studyInstanceUID:e,seriesInstanceUID:t,origin:{uid:n,uuid:o,queryParams:a,queryParams:{studyUID:r,seriesUID:s,hospID:l}}}=i;return{studyUID:r,studyInstanceUID:e,seriesUID:s,seriesInstanceUID:t,hospID:l,imageUID:o||n,queryParams:a}}if("generalSeriesModule"===e){const{modality:e,seriesInstanceUID:t,seriesNumber:n,studyInstanceUID:o,seriesDate:a,seriesTime:r,acquisitionDate:s,acquisitionTime:l}=i;return{modality:e,seriesInstanceUID:t,seriesNumber:n,studyInstanceUID:o,seriesDate:a,seriesTime:r,acquisitionDate:s,acquisitionTime:l}}if("patientStudyModule"===e){const{patientAge:e}=i;return{patientAge:e}}if("imagePlaneModule"===e){const{frameOfReferenceUID:e,rows:t,columns:n,rowPixelSpacing:o,columnPixelSpacing:a,pixelSpacing:r,rowCosines:s,columnCosines:l,imageOrientationPatient:c,imagePositionPatient:u,sliceThickness:d,sliceLocation:h}=i;return{frameOfReferenceUID:e,rows:t,columns:n,imageOrientationPatient:c,rowCosines:s,columnCosines:l,imagePositionPatient:u,sliceThickness:d,sliceLocation:h,pixelSpacing:r,rowPixelSpacing:o,columnPixelSpacing:a}}if("imagePixelModule"===e){const{rows:e,columns:t,bitsAllocated:n,bitsStored:o,highBit:r,photometricInterpretation:s,pixelRepresentation:l,samplesPerPixel:c}=i;return Object.assign({samplesPerPixel:c,photometricInterpretation:s,rows:e,columns:t,bitsAllocated:n,bitsStored:o,highBit:r,pixelRepresentation:l},a&&{pixelRepresentation:0,bitsAllocated:24,bitsStored:24,highBit:24,photometricInterpretation:"RGB",samplesPerPixel:3})}if("voiLutModule"===e){if(a)return{windowWidth:[256],windowCenter:[128]};const{windowCenter:e,windowWidth:t}=i;return{windowCenter:e,windowWidth:t}}if("modalityLutModule"===e){const{rescaleIntercept:e,rescaleSlope:t}=i;return{rescaleIntercept:e,rescaleSlope:t}}if("sopCommonModule"===e){const{sopInstanceUID:e}=i;return{sopClassUID:void 0,sopInstanceUID:e}}if("transferSyntax"===e){const{transferSyntaxUID:e}=i;return{transferSyntaxUID:e}}0}},Bu=e=>e?e.split(/\|{1,2}/).map((e=>parseFloat(e))):[],Vu=e=>{const{mod:t,syntaxuid:n,seruid:o,stuuid:a,serid:i,stutm:r,studt:s,acqdt:l,acqtm:c,age:u,row:d,col:h,imgori:m,imgpos:f,orb:g,orl:p,orr:v,ort:y,pixx:b,pixy:x,sliceth:w,bita:T,bits:I,hbit:E,phme:S,pixrep:C,sappix:A,wc:M,ww:D,rescin:P,rescsl:L,sopuid:k,blocks:O}=e,R=Bu(m),N=Bu(f),_=parseFloat(L)||1,U=parseFloat(P)||0,B=parseFloat(C);let V,F,H,j,z=[parseFloat(b),parseFloat(x)];const q=Bu(String(b));return q.length>=2&&(z=q),z&&(F=z[0],V=z[1]),R&&(H=[R[0],R[1],R[2]],j=[R[3],R[4],R[5]]),{modality:t,frameOfReferenceUID:a,transferSyntaxUID:n,seriesInstanceUID:o,studyInstanceUID:a,sopInstanceUID:k,seriesNumber:parseFloat(i),seriesTime:te().parseTM(r||""),seriesDate:te().parseDA(s||""),acquisitionTime:te().parseTM(c||""),acquisitionDate:te().parseDA(l||""),patientAge:u,rows:parseFloat(d),columns:parseFloat(h),rescaleIntercept:U,rescaleSlope:_,rowPixelSpacing:F,columnPixelSpacing:V,pixelSpacing:z,rowCosines:H,columnCosines:j,imageBottomTag:g,imageleftTag:p,imagetightTag:v,imagetopTag:y,imageOrientationPatient:R,imagePositionPatient:N,sliceThickness:parseFloat(w),sliceLocation:N[2],bitsAllocated:parseFloat(T),bitsStored:parseFloat(I),highBit:parseFloat(E),photometricInterpretation:S,pixelRepresentation:B,samplesPerPixel:parseFloat(A),windowCenter:[parseFloat(M)],windowWidth:[parseFloat(D)],blocks:parseFloat(O),origin:e}},Fu=new Map,Hu=e=>{e.addProvider(((e,t)=>Uu(e,t,Fu,"cornerstone3D")))},ju=(e,t,n)=>{t.queryParams=n,Fu.set(e,Vu(t))},zu=()=>{Fu.clear()};i.metaData.addProvider(((e,t)=>Uu(e,t,Fu)));const qu="cornerstone-canvas";function Wu(e){const t=`canvas.${qu}`;return e.querySelector(t)||function(e){const t=document.createElement("canvas");return t.style.display="block",t.classList.add(qu),e.appendChild(t),t}(e)}let Gu=new Dt.Synchronizer(i.EVENTS.NEW_IMAGE,Dt.updateImageSynchronizer);function Yu(){return Bo(Gu,!1)}(0,s.debounce)(Yu,500);function Zu(){Gu.destroy(),Gu=void 0}const Ku=({toastDict:e,store:t})=>{let o=!0;const a=e.MPR.crossOrigin,{sharedArrayBuffer:i,tipRecord:r}=t;if(window.SharedArrayBuffer)Object.defineProperty(window,"crossOriginIsolated",{writable:!0}),window.crossOriginIsolated=!0;else if(i&&!r.sharedArrayBufferGuide){const t=navigator.userAgent.indexOf("WebKit")>-1,{protocol:o}=location;"http:"===o&&(0,s.env)().isWin&&t?(n.g.getSpeedMPRBat=function(){const e=URL.createObjectURL(new Blob(['@REM chcp 65001\n@REM chcp 936\n\n@echo off\nSetlocal enabledelayedexpansion\nset SCRIPT="%TEMP%\\%RANDOM%-%RANDOM%-%RANDOM%-%RANDOM%.vbs"\n\n:loop\n\n@REM utf-8\nchcp 65001\n\necho.\nset /p "lnkPath=chromeEdge360360QQ():"\n\n@REM GB2312 \nchcp 936\n\nif exist "%lnkPath%" ( echo. & echo ... ) else (  echo. & echo   & goto loop)\n\necho Set oWS = WScript.CreateObject("WScript.Shell") >> %SCRIPT%\n\necho sLinkFile = "%lnkPath:"=%" >> %SCRIPT%\n\necho Set oLink = oWS.CreateShortcut(sLinkFile) >> %SCRIPT%\n\necho oLink.Arguments= "--enable-features=SharedArrayBuffer"  >> %SCRIPT%\n\n@REM echo oLink.WorkingDirectory = "%workingDir%" >> %SCRIPT%\n\necho oLink.Save >> %SCRIPT%\n\ncscript /nologo %SCRIPT%\n\ndel %SCRIPT%\n\n@REM utf-8\nchcp 65001\n\necho.\necho MPRMPR\n\necho.\necho.\n\necho MPR\necho.\necho \necho.\necho 1.\necho.\necho 2.========--enable-features=SharedArrayBuffer".exe" --enable-features=SharedArrayBuffer\n\necho.\necho.\n\npause',{type:"application/x-msdownload"}]));T(e,"-MPR.bat"),URL.revokeObjectURL(e)},console.info("MPR,getSpeedMPRBat().bat")):console.error("http:"===o?`${a}${e.MPR.sharedArrayBuffer.http}`:e.MPR.sharedArrayBuffer.https),r.sharedArrayBufferGuide=!0}return!0!==i&&!1!==i||(o=i,console.warn(e.MPR.sharedArrayBuffer.manual,i)),1!==t.imageType?(o=!1,console.info(e.MPR.sharedArrayBuffer.disabled)):window.crossOriginIsolated?console.info(e.MPR.sharedArrayBuffer.enabled):(o=!1,console.info(e.MPR.sharedArrayBuffer.unEnabled),console.warn(`${a}Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated`)),o};function Xu(){(function(){var e;const{usedJSHeapSize:t,totalJSHeapSize:n}=(null===(e=window.performance)||void 0===e?void 0:e.memory)||{};return t/n})()>.99&&console.error(k("toast.memoryRatioTips"))}var Ju=function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const Qu=(0,Dt.importInternal)("util/scrollToIndex"),{aboutUs:$u,toolsBar:ed,AI:td,DBCacheImages:nd,preload:od,systemInfo:ad}=j;class id{constructor(e,t,n,o,a){this.eventNamespace="clear",this.studyScrollIndex=0,this.isDestroy=!1,this.getMenuDefault=Cr;const{sharedArrayBuffer:r,GPUBenchmarksURL:l,imageTypeDefault:c,cacheImagesDefault:u=nd.enableDefault,scrollPreload:d=od.scroll,scrollPreloadNum:h=od.scrollNum,seriesPreFetchNum:m=od.seriesFetchNum,fullLoad:f=od.fullLoad,token:g,isDesensitize:p=!1,departCode:v,isKeyImage:y=!1,isInternal:b=!1,clientType:x=0,forceIM:w,languageDefault:T,logoURL:I,minRenderCountMPR3D:E,theme:S,toolsBar:C,AI:A,aboutUs:M}=a||{};if(this.wado=new URL(null==t?void 0:t.replace(/^:*\/\//,location.protocol+"//"),origin).href,this.hospID=n,this.studyUIDArr=[...new Set(null==o?void 0:o.split(",").filter((e=>e)))],this.studyArr=[],this.reqStudyCount=0,j.imageTypeDefault=(null!=c?c:C.majModeVisibility&&!j.isMobile)?1:0,this.imageType=j.imageType,this.token=g,this.departCode=v,this.GPUBenchmarksURL=l,this.isDesensitize=p?1:0,this.isKeyImage=y?1:0,this.isInternal=b?1:0,this.clientType=x,this.seriesCount={x:1,y:1},this.imageCount={x:1,y:1},nd.enableDefault=u,od.scroll=d,od.scrollNum=h,od.seriesFetchNum=m,od.fullLoad=f,j.aboutUs=Object.assign(Object.assign({},$u),M),j.toolsBar=Object.assign(Object.assign({},ed),C),j.toolsBar.navigationBottomLayout=j.isMobile&&j.toolsBar.navigationBottomLayout,j.AI=Object.assign(Object.assign({},td),A),j.forceIM=null!=w?w:j.forceIM,j.logoURL=j.toolsBar.navigationBottomLayout?" ":null!=I?I:j.logoURL,j.sharedArrayBuffer=null!=r?r:j.sharedArrayBuffer,j.minRenderCountMPR3D=null!=E?E:j.minRenderCountMPR3D,j.instanceOptions=Object.assign({container:e,wado:t,hospID:n,studyUID:o},a),j.webDicomView=this,L(T),this.toastDict=k("toast"),this.globalContainer=(0,s.dataType)(e).includes("Element")?e:document.getElementById(e),!this.globalContainer)throw new Error("container is required, type is id:string or HTMLDivElement");if(this.globalContainer.childElementCount)throw new Error(this.toastDict.globalContainerExistence);for(const e in S)this.globalContainer.style.setProperty(`--theme-${e}-dicom-viewer`,S[e]);this.layoutView=new wu,this.bindEvents(),i.events.addEventNamespaceListener("tool_event.VRT",(e=>{const{toolData:{toolTag:t=""}={}}=e.detail;if(Mu)switch(t){case"VTRReload2D":Du.initTop2DTools();case"MPR":Lu();break;case"VRTKnifeIn":Mu.knifeBegin("KnifeIn",Pu);break;case"VRTKnifeOut":Mu.knifeBegin("KnifeOut",Pu);break;case"VRTModulation":Mu.toolsToggle("Modulation");break;case"VRTRotate":Mu.toolsToggle("Rotate");break;case"VRTReset":Mu.reset()}})),this.layoutView.initLayout(this.globalContainer),this.layoutView.initTop2DTools(j.isMobile?"stackScroll":"zoom"),this.initAI(void 0,!0).finally((()=>{this.getStudyInfos().then((()=>{this.initAI()}))})),j.toolsBar.VRTVisibility&&this.initVRTPath(),j.toolsBar.enhanceVisibility&&Be.webWorkerManager.loadWebWorkerTask("./opencvDecode.worker.js")}getStudyInfoHandle(e,t){var n;return Ju(this,void 0,void 0,(function*(){try{if(t>0&&!this.studyArr[0]&&(t=0),!this.wado||!e)throw console.warn("wadoURL:",this.wado,"studyUID:",e),"wadoURL,studyUID is required";const o=yield function(e,t,n,o){return _c(this,void 0,void 0,(function*(){const{token:a,imageType:i,isDesensitize:r}=o,s=Uc(o,["token","imageType","isDesensitize"]);return(yield Lc.get(`${e}/GetStudyInfo`,{params:Object.assign({studyUID:t,hospId:n,hospID:n,isDcm:i,imageType:i,hasDesensitize:r},s),headers:Object.assign({},Vc(a))})).data}))}(this.wado,e,this.hospID,{clientType:this.clientType,departCode:this.departCode,token:this.token,imageType:this.imageType,isKeyImage:this.isKeyImage,isInternal:this.isInternal,isDesensitize:this.isDesensitize});if(this.studyArr[t]=new _u(Object.assign(Object.assign({},o.data),{hospID:this.hospID}),this.wado),0==t){const e=this.studyArr[0],{seriesUID:t,studyUID:o}=(null===(n=e.seriesArr)||void 0===n?void 0:n[0])||{};this.selectSeries={seriesUID:t,studyUID:o,seriesIndex:0},this.studyScrollIndex=0,this.initFirstStudySeriesLayoutState(e),this.seriesCount=e.getSeriesLayoutCount(),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,e.seriesArr,this.seriesCount)}else this.seriesLayoutState.addSeriesArr(this.studyArr[t].seriesArr);Qc(e),Gc(e),this.initStudyNavigation(t),this.seriesLayoutState.syncState("originStates"),yield this.initSeries(t),t>0&&this.addSeries(this.seriesLayoutState.getSeries("originStates"))}catch(e){console.error(e)}finally{this.reqStudyCount+=1,this.isStudiesLoaded()&&this.setFusionData()}}))}getStudyInfos(){return Ju(this,void 0,void 0,(function*(){if(!this.studyUIDArr.length)throw"studyUID is empty";for(const[e,t]of Object.entries(this.studyUIDArr))yield this.getStudyInfoHandle(t,Number(e))}))}addStudy(e){return Ju(this,void 0,void 0,(function*(){if("string"!=typeof e)throw"studyUID is required";if(this.studyUIDArr.includes(e))return;const t=this.studyUIDArr.length;if(!this.isStudiesLoaded())return yield E(1e3),void this.addStudy(e);this.studyUIDArr.push(e);const n=t;this.getStudyInfoHandle(e,n)}))}setFusionData(){const e=this.queryModalitySeries("PT");e.length&&(j.fusionData.PT=e,j.fusionData.CT=this.queryModalitySeries("CT"))}activeAI(e){j.AI=Object.assign(Object.assign(Object.assign({},j.AI),{parseSuccess:!0,active:!0}),e),this.initAI()}renderLayoutImageToCanvas(e,t,n,o=0){ar(e);const a=(0,i.getDefaultViewportForImage)(e,t);(0,i.displayImage)(e,t,Object.assign({},a));const r=n.metaArrOriginal[o];r&&(this.layoutView.createSeriesMarker(e,n,r,a),this.layoutView.seriesImageCruxMarker.createLayout(e),this.layoutView.toggleCavanAroundInfoStyle(j.cavanAroundInfo)),this.initDicomTools(e,n,void 0)}initDicomTools(e,t,n){const{loadIds:o,multiframe:{numFrames:a,frameRate:i}}=t;o&&o.length>0&&((0,Dt.addStackStateManager)(e,["stack","Crosshairs","ReferenceLines","stackRenderer"]),(0,Dt.addToolState)(e,"stack",{currentImageIdIndex:n||0,imageIds:o,series:t}),a&&i&&this.layoutView.iconPlayer.createPlayer(e,e.parentElement,t))}displaySeriesByImageindex(e,t,n=0){return Ju(this,void 0,void 0,(function*(){if(!t)throw"series is not defined";try{ar(e);const o=yield hr(t.loadIds[n]);return this.renderLayoutImageToCanvas(e,o,t,n),o}catch(e){throw console.error(e),e}}))}displayDcmByImages(e,t,n){const o=e.querySelectorAll(".layoutImage"),a=o.length;a>0&&o.forEach(((o,r)=>Ju(this,void 0,void 0,(function*(){const s=(n||0)*a+r,l=t[s];if(l){Wu(o).classList.remove("hidden"),ar(o);const e=yield hr(l);(0,i.displayImage)(o,e)}else{Wu(o).classList.add("hidden");e.querySelector("div.player-bar")&&s>t.length&&Qu(e,0)}}))))}displayDcmBySlider(e,t,n,o){let a=n[o];a&&hr(a).then((function(n){const a=e.seriesDom.clientWidth,r=e.seriesDom.clientHeight;let s=(0,i.getDefaultViewportForImage)(e.seriesDom,n),l=r/n.height,c=a/n.width;s.scale=c<l?parseFloat(c.toFixed(2)):parseFloat(l.toFixed(2)),(0,i.displayImage)(e.seriesDom,n,s),t.currentImageIdIndex=o}),(function(e){}))}initVRTPath(){return Ju(this,void 0,void 0,(function*(){const e=e=>{const t=this.layoutView.querySelectorForTool(".VRT");j.toolsBar.VRTVisibility=e,null==t||t.classList.toggle("hidden",!e)};try{const t=yield function(e,t){return _c(this,void 0,void 0,(function*(){const n=e=>{if("Object"!=(0,s.dataType)(e.data))throw k("response.VRTPathDataError")};try{const o=yield Lc.get(`${e}/getPath3d`,{data:{disableToast:!0},headers:Object.assign({},Vc(t))});return n(o),o.data}catch(e){throw n(e),new Error(e)}}))}(this.wado,this.token),{path:n}=(null==t?void 0:t.data)||{};if(!n)throw"3D service path is undefined";this.VRTWsURl=n,e(!0)}catch(t){e(!1),console.error(t)}}))}initAI(e,t){return Ju(this,void 0,void 0,(function*(){let n=0;const{resultURL:o,parseSuccess:a,getParseHandler:r,active:s,jumpFirstAI:l}=j.AI,c=this.layoutView.querySelectorForTool(".AI"),u=(e,t=!1)=>{if(!e)throw"seriesID is required";return new Promise((n=>{if(t){const t=kt.getFirstIndex(e),o=this.layoutView.canvasContainer.querySelector(`.layoutCellsInner[data-series-u-i-d='${e}']`);o&&Qu(o,t),n(o)}else{const t=i.EVENTS.NEW_IMAGE,o=this.layoutView.canvasContainer.querySelectorAll(".layoutCellsInner"),a=i=>Ju(this,void 0,void 0,(function*(){yield E();const{target:r,target:{dataset:s}}=i;s.seriesUID===e&&(o.forEach((e=>{e.removeEventListener(t,a);const n=kt.getFirstIndex(e.dataset.seriesUID);n&&Qu(e,n)})),n(r))}));o.forEach((e=>{e.addEventListener(t,a)}))}}))};try{const i=()=>{if(E(100).then((()=>{null==c||c.classList.remove("active")})),"function"!=typeof r)throw"AI configure error";r({studyArr:this.studyUIDArr,departCode:this.departCode,hospID:this.hospID,hospId:this.hospID}),console.info("GetParseHandler has been run")};if(!1===e)return this.layoutView.toggleAIIconStyle(),void this.layoutView.topTools.AITool();if(!a)return e?i():void 0;if(!s&&!e)return;if(!o)throw"AI configure error";for(const t of this.studyUIDArr.filter((e=>!Lt[e])))try{const e=yield jc(o,t);Rt(e,t),null==c||c.classList.add("active")}catch(t){n+=1,console.error(t),e&&n>=this.studyUIDArr.length&&i()}if(t)return;if(this.layoutView.toggleAIIconStyle(kt.getSeriesIDArr()),this.layoutView.topTools.AITool(!0),l){let e;for(const t in kt.store){const n=yield u(t,!0);n&&(e=n)}if(!e){const e=this.layoutView.leftSideContainer.querySelector(".viewer-navigator-wrapper.show-AI");if(!e)return;e.click(),u(e.dataset.seriesUID,!1)}}}catch(e){yield E(),null==c||c.classList.remove("active"),console.error("AI configure error"===e?this.toastDict.AIConfigError:e)}}))}initSeries(e){return Ju(this,void 0,void 0,(function*(){const t=this.studyArr[e];let n=0,o=[];if(yield(new s.PromiseQueue).init({arr:t.seriesArr,func:t=>Ju(this,void 0,void 0,(function*(){yield this.getSeriesMeta(t,e,n++)})),limit:6}),0==e)try{if(od.fullLoad)for(const{loadIds:e,seriesUID:n}of t.seriesArr){const t=e.slice(1);t.length?mr(t,{cancel:!1,countCallback:(e,o,a)=>{this.layoutView.progressCountStyle(n,t.length,a,!0)}}):this.layoutView.progressCountStyle(n,1,1,!0)}else{const e=Math.max(od.seriesFetchNum||(t.seriesArr.length<=6?7:5),0);for(const{loadIds:n}of t.seriesArr)o=[...o,...n.slice(1,e)];o.length&&mr(o,{cancel:!1});const{loadIds:n,seriesUID:a}=t.seriesArr[0],i=n.slice(e);i.length?mr(i,{cancel:!1,countCallback:(e,t,n)=>{this.layoutView.progressCountStyle(a,i.length,n)}}):this.layoutView.progressCountStyle(a,1,1,!0)}}catch(e){console.error("first series load error: "+e)}}))}addSeries(e){if(!(null==e?void 0:e.length))return;const{seriesLayouts:t}=this.layoutView.seriesLayout;t.forEach((({seriesDom:t},n)=>Ju(this,void 0,void 0,(function*(){const o=e[n];!iu(t)&&o&&(yield this.displaySeriesByImageindex(t,o),this.layoutView.seriesLayout.initSingle(t,o,{seriesUID:o.seriesUID,studyUID:o.studyUID,seriesIndex:n}),this.layoutView.seriesLayout.seriesLayoutsUpdate(t,o.seriesUID))})))),this.layoutView.studySlider.createLayout(this.layoutView.canvasContainer,e,this.seriesCount,!0),this.layoutView.resizeLayout()}restoreSeries(e){if(!(null==e?void 0:e.length))return;this.layoutView.iconPlayer.playerAllPauseAndRemove(),as(),jo(),sr(),this.studyScrollIndex=0,this.layoutView.seriesLayout.seriesLayouts=[],w(this.layoutView.canvasContainer),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,e,this.seriesCount);const{seriesLayouts:t}=this.layoutView.seriesLayout;t.forEach((({seriesDom:t},n)=>{const o=e[n];o&&this.displaySeriesByImageindex(t,o)})),this.reloadSynchronizerTools()}getSeriesMeta(e,t,n){const{studyUID:o,seriesUID:a}=e;let i;if(0===t){i=this.layoutView.seriesLayout.seriesLayouts[n];const t=()=>null==i?void 0:i.seriesDom.querySelector("canvas");if(i&&!t()){ar(i.seriesDom);const n=t();(0,s.canvasDrawImage)(n,e.icon,{interceptors:()=>Promise.resolve((0,s.isCanvasBlank)(n))}).catch((()=>{}))}}return function(e,t,n,o,a){return _c(this,void 0,void 0,(function*(){try{n=b(n);const{token:i,imageType:r,isDesensitize:s}=a,l=Uc(a,["token","imageType","isDesensitize"]);return(yield Lc.get(`${e}/GetSeriesMeta`,{params:Object.assign({studyuid:t,studyUID:t,uuid:n,seriesUID:n,hospId:o,hospid:o,hospitalid:o,hospID:o,isDcm:r,imageType:r,hasDesensitize:s},l),headers:Object.assign({},Vc(i)),cancelToken:Bc.token})).data}catch(e){throw{message:k("response.metaDataError")+n,error:e}}}))}(this.wado,o,a,this.hospID,{clientType:this.clientType,departCode:this.departCode,token:this.token,imageType:this.imageType,isKeyImage:this.isKeyImage,isInternal:this.isInternal,isDesensitize:this.isDesensitize}).then((({data:r})=>Ju(this,void 0,void 0,(function*(){e.initMeta(r.imgs,n);const{metaArrOriginal:s,loadIds:[l]}=e;for(const e of s)ju(e.imageIdURL,e,{seriesUID:a,studyUID:o,hospID:this.hospID});if(0===t){const t=this.seriesCount.x*this.seriesCount.y==1,o=kt.getSeriesIDArr(),r=o.length,s=()=>hr(l).then((o=>{var a,s;const c=Number((null===(a=o.data)||void 0===a?void 0:a.string("x00280008"))||0);if(c){const t=1e3/Number(null===(s=o.data)||void 0===s?void 0:s.string("x00181063")),n=l.includes("?")?"&":"?";e.multiframe={numFrames:c,frameRate:t};for(let t=1;t<c;t++)e.loadIds[t]=`${l}${n}frame=${t}`}!i||t&&(0!==n||r)||this.renderLayoutImageToCanvas(i.seriesDom,o,e)}),(e=>{console.error("loadAndCacheImage",e)}));o.includes(a)?yield s():s()}})))).catch((e=>{console.error(e)}))}initFirstStudySeriesLayoutState({seriesArr:e}){this.seriesLayoutState=new ku(e)}initStudyNavigation(e){var t;const n=this.studyArr[e];((null===(t=this.layoutView.studyNavigationBody)||void 0===t?void 0:t.childElementCount)||0)<this.studyArr.length&&this.layoutView.createStudyNavigationGroup(n,e)}reload2d(){return Ju(this,void 0,void 0,(function*(){yield this.layoutView.topTools.cancelToolAndDefaultViewportTools(void 0,!0,!0),this.layoutView.initTop2DTools();const e=this.studyArr[0];this.seriesCount=e.getSeriesLayoutCount(),this.seriesLayoutState.syncState(),this.restoreSeries(this.seriesLayoutState.getSeries()),nr()}))}initMPR(e){var t,o,a,i,s;return Ju(this,void 0,void 0,(function*(){const c=new Iu({progressBar:!0});try{const{originalSeriesData:s,levelDefault:u=(!1===j.instanceOptions.losslessMPR?null:10),modality:d="all",isFusionMode:f=!1,fusionData:g,series:p,matchFusionSeries:v}=e,y=s||{series:p,matchFusionSeries:v,fusionData:g},b=h(y),{performanceLevel:w}=ad,{color:T}=yield hr(f?b.fusionData.PT.loadIds[0]:b.series.loadIds[0]);if(void 0===T)throw"isReturn";let I=10;if(f)for(const[e,t]of Object.entries(b.fusionData)){const{loadIds:e}=t;if(e.length>60*w*.6||u){const n=u||m(Math.round(80*w/e.length*10*.6),1,10);t.loadIds=x(e,10*n),I=Math.min(n,10)}T&&(t.loadIds=t.loadIds.map((e=>e.replace("IM","web"))))}else{const{loadIds:e}=b.series;if(e.length>60*w||u){const n=u||m(Math.round(80*w/e.length*10*(v?.6:1)),1,10);b.series.loadIds=x(e,10*n),null===(t=null==b?void 0:b.matchFusionSeries)||void 0===t||t.forEach((e=>{e.loadIds=x(e.loadIds,10*n)})),I=n}T&&(b.series.loadIds=b.series.loadIds.map((e=>e.replace("IM","web"))),null===(o=null==b?void 0:b.matchFusionSeries)||void 0===o||o.forEach((e=>{e.loadIds=e.loadIds.map((e=>e.replace("IM","web")))})))}const E=this.layoutView.mprLayout.createLayout(),S=(null===(a=b.series)||void 0===a?void 0:a.loadIds)||[...b.fusionData.CT.loadIds,...b.fusionData.PT.loadIds];c.show({message:this.toastDict.MPR.loading});const C=c.$toast().querySelector(".iziToast-progressbar div");if(yield mr(S,{type:"MPR",countCallback:(e,t,n)=>{n%5==0&&(C.style.width=n/S.length*100+"%")}}),c.hidden(),Xu(),void 0===n.g.webDicomViewMPR)throw"unMPRModule";this.layoutView.initTopMPRTools(j.isMobile?"MPRStackScroll":"MPRCrosshairs"),this.layoutView.querySelector(void 0,".toolsMPR").classList.toggle("isFusionMode",f),yield null===(i=n.g.webDicomViewMPR)||void 0===i?void 0:i.MPRRun(E,{seriesData:b,originalSeriesData:y,isFusionMode:f,GPUBenchmarksURL:this.GPUBenchmarksURL,layoutView:this.layoutView,useSharedArrayBuffer:Ku({toastDict:this.toastDict,store:j}),recommendLevel:I,modality:d,globalVar:{cornerstone:r(),cornerstoneWADOImageLoader:Ve(),iziToast:st(),simple2k13:l(),Hammer:Ct(),store:j,utils:{clearImageCache:J,customPrompt:bn,init3DProvider:Hu,registerIMImageLoader:Ze,registerWebImageLoader:et,getPublicPath:yu,i18n:O}}})}catch(e){if(Xu(),this.layoutView.mprLayout.hidden(),this.layoutView.initTop2DTools(),"isReturn"===e)return;if("unMPRModule"===e)return void console.error(this.toastDict.MPR.unMPRModule);console.error(e),st().error({title:this.toastDict.MPR.renderError}),null===(s=n.g.webDicomViewMPR)||void 0===s||s.MPRDestroy()}finally{c.hidden()}}))}initVRT(){try{const{seriesDom:e,seriesUID:t}=this.queryCurrentContainer()||{};if(!t)throw this.toastDict.noSerise;const{loadIds:n,studyUID:o,metaArrOriginal:[{imgpos:a}]}=this.querySeries(t);if(this.VRTWsURl||console.error(this.toastDict["3D"].noURL),!n||!e.dataset.seriesUID)throw this.toastDict.noSerise;if(!a)throw this.toastDict.noImagePosition3D;if(n.length<j.minRenderCountMPR3D)throw`${this.toastDict.seriesNumLow[0]}${j.minRenderCountMPR3D}${this.toastDict.seriesNumLow[1]} 3D`;((e,t)=>{try{const{layoutView:n}=t;Mu=new Au,Du=n,Mu.open(e,t)}catch(e){throw console.error(e),e}})(this.layoutView.vrtLayout.createLayout(),{vrtWsURl:this.VRTWsURl,wadoURL:this.wado,hospID:this.hospID,studyUID:o,seriesUID:t,layoutView:this.layoutView}),this.layoutView.initTopVRTTools("VRTRotate")}catch(e){this.layoutView.vrtLayout.hidden(),this.layoutView.initTop2DTools(),console.error(e),st().error({title:e})}}reloadSynchronizerTools(){return Ju(this,void 0,void 0,(function*(){yield this.referenceLineTool(this.layoutView.containsClassName(this.layoutView.querySelectorForTool(".referenceLine"),"active")),yield this.crosshairsTool(this.layoutView.containsClassName(this.layoutView.querySelectorForTool(".crosshairs"),"active"))}))}cancelToolAndDefaultViewport(){return Ju(this,void 0,void 0,(function*(){const{seriesDom:e}=this.queryCurrentContainer()||{},t=null==e?void 0:e.querySelector(".layoutImage.active");yield this.layoutView.topTools.cancelToolAndDefaultViewportTools([...ts.getSourceElements(),t||e])}))}saveImageTool(){var e,t,n;const{seriesDom:o,seriesUID:a}=this.queryCurrentContainer()||{},i=o.querySelector(".layoutImage.active"),r=null===(e=o.querySelector(".filmMarker"))||void 0===e?void 0:e.textContent.split("")[1],l=null===(t=i||o)||void 0===t?void 0:t.querySelector("canvas");if(!a||!l)return st().error({title:this.toastDict.noSerise});const c=l.toDataURL("image/png",1),[{name:u,mod:d,age:h,studt:m}]=(null===(n=this.querySeries(a))||void 0===n?void 0:n.metaArrOriginal)||[{}],f=[u,h,d,m,r].join("_").replace(".","_"),{isWeChat:g,isMobile:p}=(0,s.env)();if(g&&p)return this.layoutView.createImageLayout(c,f);T(c,f)}disableSeriesTool(){const{seriesDom:e}=this.queryCurrentContainer()||{},{seriesIndex:t}=e.dataset;this.seriesLayoutState.removeSerie(Number(t)),delete e.dataset.seriesUID,this.layoutView.clearSeriesLayout(e,!0)}invertTool(){let{seriesDom:e}=this.queryCurrentContainer();const t=e.querySelector(".layoutImage.active");e=t||e;const{invert:n}=(0,i.getViewport)(e)||{};os(Xr),(0,i.setViewport)(e,{invert:!n})}crosshairsTool(e){return Ju(this,void 0,void 0,(function*(){if(J(e?"CrosshairsOpen":"CrosshairsClose"),!e)return(0,Dt.setToolDisabled)("Crosshairs");yield Yu(),(0,Dt.setToolActive)("Crosshairs",{mouseButtonMask:1,synchronizationContext:Gu})}))}referenceLineTool(e){var t;return Ju(this,void 0,void 0,(function*(){if(J(e?"ReferenceLinesOpen":"ReferenceLinesClose"),!e)return(0,Dt.setToolDisabled)("ReferenceLines");const{seriesLayouts:n}=(null===(t=this.layoutView)||void 0===t?void 0:t.seriesLayout)||{};yield Yu(),(0,Dt.setToolEnabled)("ReferenceLines",{synchronizationContext:Gu}),n.length<this.seriesLayoutState.getStatesLength()&&console.warn(this.toastDict.referenceLinesWarn)}))}isStudiesLoaded(e=!1){const t=this.reqStudyCount===this.studyUIDArr.length;return e&&!t&&ut("studiesLoading",this.toastDict.studiesLoading),t}magnifyTool(){this.layoutView.topTools.magnifyTool()}queryImage(){const{seriesDom:e,seriesUID:t}=this.queryCurrentContainer()||{};if(!e||!t)throw st().error({title:this.toastDict.noSerise}),"seriesDom and seriesUID is required ";const n=this.querySeries(t),o=(0,i.getImage)(e),{metaArrOriginal:[{mod:a}]}=n;return Object.assign(Object.assign({},o),{modality:a})}queryStudy(e){return this.studyArr.find((({studyUID:t}={})=>e===t))}querySeries(e){let t;for(const n of this.studyArr){const{seriesArr:o=[]}=n||{};if(t=o.find((({seriesUID:t})=>t===e)),t)break}return t}queryCurrentContainer(){return this.layoutView.seriesLayout.seriesLayouts.find((({seriesDom:e})=>e.classList.contains("active")||e.parentElement.classList.contains("active")))}queryCurrentSeries(e=this.queryCurrentContainer()){const{seriesUID:t}=e;return this.querySeries(t)}queryFusionSeries(e){const[{mod:t,imgpos:n}]=e,o=e.length;if(!["CT","PT"].includes(t))return[];let a=[];for(const e of this.studyArr){const{seriesArr:i=[]}=e||{};a=[...a,...i.filter((({metaArrOriginal:e,metaArrOriginal:[{mod:a,imgpos:i}]})=>e.length===o&&a===("CT"==t?"PT":"CT")&&Math.abs(Bu(n)[2]-Bu(i)[2])<=.01))]}return a.sort(((e,t)=>e.seriesIndex-t.seriesIndex))}queryModalitySeries(e){let t=[];for(const n of this.studyArr){const{seriesArr:o=[]}=n||{};t=[...t,...o.filter((({metaArrOriginal:[{mod:t}]})=>t===e))]}return t.sort(((e,t)=>e.seriesIndex-t.seriesIndex))}bindEvents(){const e=this.eventNamespace,t=(0,s.debounce)((()=>(0,i.triggerEvent)(i.events,"window_resize")),50);Br({key:"Escape",callback:_r}),window.addEventListener("keydown",(function(e){const t=Ur.get(e.key);if(!t)return;const{altKey:n=!1,ctrlKey:o=!1,metaKey:a=!1,shiftKey:i=!1,callback:r}=t;n===e.altKey&&o===e.ctrlKey&&a===e.metaKey&&i===e.shiftKey&&(null==r||r(),e.preventDefault())})),window.addEventListener("resize",(function(){t()}));for(const e of["beforeunload","unload","pagehide","visibilitychange"])window.addEventListener(e,(function(){const{instanceOptions:{closePageResetDefault:{imageType:e,cacheImages:t,tackSynchronizerType:n}={}},DBCacheImages:o}=j;e&&(j.imageType=null),t&&(o.enable=null),n&&(j.tackSynchronizerType=null)}));i.events.addEventNamespaceListener(`layout_area_focus.${e}`,(e=>{const{area:t}=e.detail;ct("layout_area_focus",(0,s.throttle)((()=>{switch(t){case"toolbarLayout":case"seriesLayout":case"seriesMPROr3DLayout":j.toolsBar.navigationBottomLayout||this.layoutView.seriesBarToggle(!1),this.layoutView.selectPopupHidden(),this.layoutView.navigationMenuCloseHandle()}}),500,{trailing:!1}))})),i.events.addEventNamespaceListener(`tool_series_layout.${e}`,(e=>{const{ptCell:t}=e.detail;this.seriesCount=t,this.restoreSeries(this.seriesLayoutState.getSeries())})),i.events.addEventNamespaceListener(`tool_series_image_layout.${e}`,(e=>Ju(this,void 0,void 0,(function*(){const t=e.detail,{ptCell:n,ptCell:{x:o,y:a}}=t,{seriesDom:r,seriesUID:l}=this.queryCurrentContainer()||{};if(!l)return;const c=this.querySeries(l),u=o*a==1;if(Qu(r,0),this.layoutView.clearSeriesLayout(r,!0,!0),u){const{seriesIndex:e}=r.dataset,t=this.seriesLayoutState.getSynchronizerStatus(Number(e));r.classList.remove("noActiveBorder"),lr(r),yield this.displaySeriesByImageindex(r,c),this.layoutView.seriesLayout.initSingle(r,c,void 0,{synchronizerStatus:t})}else{r.classList.add("noActiveBorder"),(0,i.triggerEvent)(i.events,"series_synchronizer_remove",{seriesDom:r,setSynchronizerStatus:!1}),this.layoutView.seriesLayout.createImagesLayout(r,c,n),this.displayDcmByImages(r,c.loadIds),yield Yu();const{isWeChat:e,isAndroid:t}=(0,s.env)();if(e&&t){const{x:e,y:t}=this.seriesCount;o*a+e*t>8&&console.warn(this.toastDict.imageLayoutError)}}(0,i.triggerEvent)(i.events,"image_active",{$canvas:r})})))),i.events.addEventNamespaceListener(`study_scroll.${e}`,(e=>Ju(this,void 0,void 0,(function*(){const{currentIndex:t=0,layoutCount:n=1}=e.detail,o=this.seriesLayoutState.getStates(),{seriesLayouts:a}=this.layoutView.seriesLayout,r=t*n;this.studyScrollIndex=t,_r();for(const e in a)try{const t=Number(e)+r,n=a[e],{seriesDom:i}=n,{seriesUID:s,studyUID:l,series:c,synchronizerStatus:u,scrollIndex:d}=o[t]||{};n.seriesUID=s,this.layoutView.clearSeriesLayout(i),c&&(yield this.displaySeriesByImageindex(i,c)),this.layoutView.seriesLayout.initSingle(i,c,{seriesUID:s,studyUID:l,seriesIndex:t},{synchronizerStatus:u,scrollIndex:d})}catch(e){console.error(e)}const{seriesUID:s}=this.selectSeries||{};(0,i.triggerEvent)(i.events,"image_active",{}),this.layoutView.seriesLayout.toggleSeriesStyle({seriesUID:s}),yield this.reloadSynchronizerTools(),t%2==1&&nr()})))),i.events.addEventNamespaceListener(`series_scroll.${e}`,(e=>{const{element:t,currentIndex:n,isSeriesImage:o,imageIds:a}=e.detail;o&&this.displayDcmByImages(t,a,n),this.seriesLayoutState.setScrollIndex(t.dataset.seriesIndex,n),this.layoutView.iconPlayer.toggleControlStyleLazy(n,null==a?void 0:a.length),function(e){ts.enabled=!1,ts.timer&&clearTimeout(ts.timer),ts.timer=setTimeout((()=>{ts.enabled=!0}),e)}(500)})),i.events.addEventNamespaceListener(`tool_imageType.${e}`,(e=>Ju(this,void 0,void 0,(function*(){const{type:t,custom:n}=e.detail;n||(j.imageType=t,this.imageType=t),this.studyArr=[],this.reqStudyCount=0,this.layoutView.seriesLayout.seriesLayouts=[],this.layoutView.imageType(e.detail),this.layoutView.iconPlayer.playerAllPauseAndRemove(),sr(),zu(),J("imageTypeToggle",!0),mr([],{forceCancelAll:!0}),document.querySelectorAll(".iziToast").forEach((e=>{st().hide({},e)})),w(this.layoutView.canvasContainer),w(this.layoutView.studyNavigationBody),w(this.layoutView.studyNavigationHead),this.layoutView.toggleClassName(this.layoutView.querySelectorForTool(".fusion"),void 0,"hidden",-1===t),yield this.getStudyInfos(),this.reloadSynchronizerTools()})))),i.events.addEventNamespaceListener(`tool_WwWc.${e}`,(e=>{const{seriesDom:t}=this.queryCurrentContainer();this.layoutView.wwwcImage(t,e.detail)})),i.events.addEventNamespaceListener(`tool_scale.${e}`,(e=>{const{seriesDom:t}=this.queryCurrentContainer();this.layoutView.scaleImage(t,e.detail)})),i.events.addEventNamespaceListener(`tool_rotate.${e}`,(e=>{const{seriesDom:t}=this.queryCurrentContainer();this.layoutView.rotateImage(t,e.detail)})),i.events.addEventNamespaceListener(`tool_colorMap.${e}`,(e=>{const{seriesDom:t}=this.queryCurrentContainer();this.layoutView.colorMapImage(t,e.detail)})),i.events.addEventNamespaceListener(`window_resize.${e}`,(()=>{this.layoutView.resizeLayout(),j.env!==c()&&st().info({title:this.toastDict.deviceTypeChange})}));const n=(e,t)=>{J("downloadActive"),mr(e,{countCallback:(n,o,a)=>{this.layoutView.progressCountStyle(t,e.length,a)}})};i.events.addEventNamespaceListener(`navigator_dbClick_drag.${e}`,(e=>Ju(this,void 0,void 0,(function*(){let{series:t}=e.detail;const{loadIds:o,studyUID:a,seriesUID:i}=t,r=this.queryCurrentContainer(),{seriesDom:s}=r,{seriesIndex:l}=s.dataset;this.selectSeries={seriesUID:i,studyUID:a,seriesIndex:Number(l)},this.layoutView.seriesLayout.toggleNavigatorInfo(i),n(o,i),this.layoutView.clearSeriesLayout(s),r.seriesUID=i,this.seriesLayoutState.setState(Number(l),{studyUID:a,seriesUID:i,series:t,scrollIndex:0,synchronizerStatus:!1}),yield this.displaySeriesByImageindex(s,t),this.layoutView.seriesLayout.initSingle(s,t,this.selectSeries),this.reloadSynchronizerTools()})))),i.events.addEventNamespaceListener(`first_active.${e}`,(e=>{var t;const{detail:{$canvas:n}}=e;(0,i.triggerEvent)(i.events,"canvas_active",{$canvas:n}),null===(t=this.layoutView.studyMenuLayout)||void 0===t||t.activeFirst()})),i.events.addEventNamespaceListener(`navigator_active.${e}`,(e=>Ju(this,void 0,void 0,(function*(){let{series:t,target:o,event:{isTrusted:a}}=e.detail;const{loadIds:r,studyUID:s,seriesUID:l,seriesIndex:c}=t,{x:u,y:d}=this.seriesCount,h=u*d,m=this.seriesLayoutState.getSeriesActiveIndex(l);if(void 0===m){const{noRenderSerise:e}=this.toastDict;return st().error({title:`${e[0]}${j.isMobile?e[1]:e[2]}${e[3]}`,timeout:15e3})}this.selectSeries={seriesUID:l,studyUID:s,seriesIndex:c},this.layoutView.seriesLayout.toggleNavigatorInfo(l),a?n(r,l):this.layoutView.progressCountStyle(l);const f=Math.floor(m/h),g=f!==this.studyScrollIndex;g?this.layoutView.studySlider.setIndex(f):(this.layoutView.iconPlayer.playerAllPauseAndRemove(),(0,i.triggerEvent)(i.events,"image_active",{}),this.layoutView.seriesLayout.toggleSeriesStyle({seriesUID:l}));const p=this.layoutView.canvasContainer.querySelector(".signBigLayout");if(p){yield E();let e=this.layoutView.canvasContainer.querySelector(".layoutCellsOuter.active");if(!e||g&&e==p)return void(null==o||o.click());this.layoutView.seriesLayout.dblclickCanvasLayout(p,p.querySelector(".layoutCellsInner"),!0),this.layoutView.seriesLayout.dblclickCanvasLayout(e,e.querySelector(".layoutCellsInner"),!1)}})))),i.events.addEventNamespaceListener(`canvas_active.${e}`,(e=>{var t;const{detail:{$canvas:n,type:o}}=e,{seriesUID:a,seriesIndex:r,studyUID:s}=n.dataset,{seriesUID:l}=this.selectSeries;if((0,i.triggerEvent)(i.events,"image_active",{$canvas:n}),this.selectSeries={seriesUID:a,seriesIndex:r,studyUID:s},this.layoutView.seriesLayout.toggleSeriesStyle({target:n}),this.layoutView.seriesLayout.toggleNavigatorInfo(a,!1),("wheel"===o||l!==a)&&a)try{const[{imageIds:e=[],currentImageIdIndex:o=0}]=(null===(t=(0,Dt.getToolState)(n,"stack"))||void 0===t?void 0:t.data)||[{}];od.scroll?(mr(e.slice(o,o+Math.max(od.scrollNum,1))),this.layoutView.progressCountStyle(a,void 0,void 0,od.fullLoad)):mr(e,{countCallback:(t,n,o)=>{this.layoutView.progressCountStyle(a,e.length,o,od.fullLoad)}})}catch(e){Pr(e)}})),i.events.addEventNamespaceListener(`tool_event.${e}`,(e=>Ju(this,void 0,void 0,(function*(){var t,n,o;const{toolData:a={},btnTarget:r,btnOriginTarget:s}=e.detail,l=!(null==r?void 0:r.classList.contains("active"));let c=!0,u=!0;switch(a.btnTarget=r,a.btnOriginTarget=s,_r(),a.toolTag){case"seriesBar":u=!1,this.layoutView.seriesBarToggle(),this.layoutView.navigationMenuCloseHandle(!0);break;case"MPR":try{J("MPR"),this.layoutView.seriesBarToggle(!1);const{seriesDom:e,seriesUID:t}=this.queryCurrentContainer()||{};if(!t)throw this.toastDict.noSerise;const n=this.querySeries(t),{loadIds:o,metaArrOriginal:a,metaArrOriginal:[{mod:i,imgpos:r}]}=n;if(!o||!e.dataset.seriesUID)throw this.toastDict.noSerise;if(!r)throw this.toastDict.noImagePositionMPR;const{minRenderCountMPR3D:s}=j;if(o.length<s)throw`${this.toastDict.seriesNumLow[0]}${j.minRenderCountMPR3D}${this.toastDict.seriesNumLow[1]} MPR`;const l=j.toolsBar.MPRFusion2Visibility?this.queryFusionSeries(a):[];this.initMPR({modality:i,isFusionMode:!1,series:n,matchFusionSeries:l.length?l:void 0})}catch(e){console.error(e),st().error({title:e})}break;case"VRT":J("VRT"),this.layoutView.seriesBarToggle(!1),this.initVRT();break;case"AI":this.initAI(l);break;case"fusion":try{const{seriesUID:e}=this.queryCurrentContainer(),t=this.querySeries(e),n=yield this.layoutView.FusionLayout.createLayout(t);if(!n)return;const{minRenderCountMPR3D:o}=j,{PT:a,CT:i}=n;if(a.loadIds.length<o||i.loadIds.length<o)throw`${this.toastDict.seriesNumLow[0]}${j.minRenderCountMPR3D}${this.toastDict.seriesNumLow[1]} Fusion`;this.initMPR({isFusionMode:!0,modality:"CT",fusionData:n})}catch(e){console.error(e),st().error({title:e})}break;case"imageType":this.layoutView.createImageTypeLayout(e);break;case"stackPositionSynchronizer":case"stackIndexSynchronizer":case"stackScrollSynchronizer":!function(e){const t=Vo[e];if(!t)throw"synchronizer is not available";j.tackSynchronizerType=e,Fo.setHandler(t)}(a.toolTag),this.layoutView.iconSynchronizer.createIconSynchronizers();break;case"reload":J("reload"),this.reload2d();break;case"disableAllTool":this.layoutView.topTools.disableAllTool();break;case"modulation":this.layoutView.topTools.modulationTool();case"modulationMenu":(a.select||"modulationMenu"===a.toolTag)&&this.layoutView.createWWWCLayout(e);break;case"stackScroll":this.layoutView.topTools.stackScrollTool();break;case"sharpen":this.layoutView.topTools.sharpenTool();break;case"blur":this.layoutView.topTools.blurTool();break;case"series":this.layoutView.createSeriesCellLayout(e,"series",{x:3,y:3},this.seriesCount);break;case"image":{const{imgRow:n=1,imgColumn:o=1}=(null===(t=this.queryCurrentContainer())||void 0===t?void 0:t.seriesDom.dataset)||{};this.layoutView.createSeriesCellLayout(e,"image",j.isMobile?{x:3,y:3}:{x:5,y:5},{x:Number(o),y:Number(n)});break}case"pan":this.layoutView.topTools.panTool();break;case"zoom":this.layoutView.topTools.zoomTool(),a.select&&this.layoutView.createScaleLayout(e);break;case"rotate":this.layoutView.topTools.rotateTool(),a.select&&this.layoutView.createRotateLayout(e);break;case"invert":this.invertTool();break;case"colorMap":this.layoutView.createColorMapLayout(e);break;case"referenceLine":this.referenceLineTool(l);break;case"crosshairs":this.crosshairsTool(!0);break;case"DICOMMetaInfo":{const{seriesUID:e,seriesDom:t}=this.queryCurrentContainer();if(!t.querySelector("canvas"))return st().error({title:this.toastDict.noSerise});const[{currentImageIdIndex:o=0}]=(null===(n=(0,Dt.getToolState)(t,"stack"))||void 0===n?void 0:n.data)||[{}],a=this.querySeries(e),i=(null==a?void 0:a.metaArrOriginal[o])||{},{age:r,name:s,patientID:l,studydate:c,studyID:u,orgname:d}=this.queryStudy(a.studyUID)||{};this.layoutView.createDICOMMetaInfoLayout(Object.assign(Object.assign({},i),{age:r,name:s,patientID:l,studydate:c,studyID:u,orgname:d}));break}case"cavanAroundInfo":j.cavanAroundInfo=!j.cavanAroundInfo,this.layoutView.toggleCavanAroundInfoStyle(l);break;case"magnify":this.magnifyTool();break;case"angle":this.layoutView.topTools.angleTools();break;case"cobbAngle":this.layoutView.topTools.cobbAngleTools();break;case"length":this.layoutView.topTools.lengthTools();break;case"rectangleRoi":this.layoutView.topTools.rectangleRoiTools();break;case"ellipticalRoi":this.layoutView.topTools.ellipticalRoiTools();break;case"circleRoi":this.layoutView.topTools.circleRoiTools();break;case"freehandRoi":this.layoutView.topTools.freehandRoiTool();break;case"player":{const{seriesDom:e,seriesUID:t}=this.queryCurrentContainer(),n=this.querySeries(t),a=null===(o=n.loadIds)||void 0===o?void 0:o.length;if(u=!1,a>=1){const t=e.parentElement,o=t.querySelector("div.player-bar");this.layoutView.iconPlayer.playerAllPauseAndRemove(),o||(this.layoutView.iconPlayer.createPlayer(e,t,n),a>1&&this.layoutView.iconPlayer.playerStart())}else st().error({title:this.toastDict.noSerise});break}case"probeCT":this.layoutView.topTools.probeCTTool();break;case"annotateArrow":this.layoutView.topTools.arrowAnnotateTool();break;case"annotateText":this.layoutView.topTools.annotateTool();break;case"markerL":this.layoutView.topTools.LRMarkerTool("L");break;case"markerR":this.layoutView.topTools.LRMarkerTool("R");break;case"CTR":this.layoutView.topTools.heartratioTool();break;case"cancelToolAndDefaultViewport":this.cancelToolAndDefaultViewport();break;case"cancelToolState":{const{seriesDom:e}=this.queryCurrentContainer()||{},t=e.querySelector(".layoutImage.active");this.layoutView.topTools.cancelTool(e),t&&this.layoutView.topTools.cancelTool(t);break}case"saveLabels":!function(){Kc(this,void 0,void 0,(function*(){try{if(!j.instanceOptions.syncLabels)return;const e=Dt.globalImageIdSpecificToolStateManager.saveToolState(),t={};for(const[n,o]of Object.entries(e)){const{baseInfo:e}=o||{},{studyUID:a}=e||{};Object.prototype.hasOwnProperty.call(t,a)||(t[a]={}),t[a][n]=o}const{studyArr:n,wado:o,hospID:a,token:i,departCode:r}=j.webDicomView;for(const e of n)try{const{studyUID:n}=e||{},s=t[n]||{};yield Fc(o,n,{departCode:r,hospID:a,token:i,markJson:JSON.stringify(s)}),st().success({message:k("toast.saveSuccess")})}catch(e){console.error(e),st().error({message:k("toast.saveFail")})}}catch(e){st().error({message:e}),console.error(e)}}))}();break;case"visibilityLabels":Xi(!l);break;case"eraser":this.layoutView.topTools.eraserTools();break;case"saveImage":this.saveImageTool();break;case"markersImage":!function(){zc(this,void 0,void 0,(function*(){try{if(!j.instanceOptions.syncMarkersImage)return;const{studyArr:e,wado:t,hospID:n,token:o,departCode:a}=j.webDicomView;for(const i of e)try{const{studyUID:e}=i||{},r=qc[e]||{};yield Hc(t,e,{departCode:a,hospID:n,token:o,markKeyJson:JSON.stringify(r)}),st().success({message:k("toast.saveSuccess")})}catch(e){console.error(e),st().error({message:k("toast.saveFail")})}}catch(e){st().error({message:e}),console.error(e)}}))}();break;case"disSeries":this.disableSeriesTool();break;case"useCacheImage":if(mr([],{forceCancelAll:!0}),!l){let e=this.toastDict.disCacheImage.reconfirm;if(od.fullLoad){e=this.toastDict.disCacheImage.reconfirmForAllLoad;const t=yield(d=e,new Promise((e=>{const{OK:t,cancel:n}=k("toast.prompt");st().question(Object.assign({class:j.isMobile?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:d,position:"center",icon:"",progressBar:!1,buttons:[[`<button class='confirm' >${t}</button>`,function(t,n,o,a,i){return e("ok")},!1],[`<button class='cancel' >${n}</button>`,function(e,t,n,o){e.hide({},t,"cancel")},!1]],onOpening:(e,t)=>{yn(t)},onClosing:function(t,n,o){"confirm"!==o&&e(null)}},h))})));if(!t){c=!1;break}}else yield E(),st().info({title:e,timeout:1e4});(0,i.triggerEvent)(i.events,"tool_imageType",{custom:!0})}nd.enable=l;break;case"imageCacheType":if(l)st().info({title:this.toastDict.speedPriority,timeout:1e4});else if(!nd.enable){const e=this.layoutView.toolsContainer.querySelector(".select-popup-item.useCacheImage");null==e||e.click()}j.imageCacheTypeDefault=l?1:0,J("imageCacheType");break;case"setLanguage":try{if(!l)return;const{toolType:e}=a;if(!confirm(k("toast.setLanguage",e)))return;P(e),window.close(),window.history.back()}catch(e){}break;case"aboutUs":this.layoutView.createAboutUsLayout(j.aboutUs)}var d,h;c&&this.layoutView.toggleToolStyle(a),u&&this.layoutView.iconPlayer.playerPause()})))),i.events.addEventNamespaceListener(`images_viewport.${e}`,(e=>{const{element:t,viewport:{voi:{windowWidth:n,windowCenter:o},scale:a}}=e.detail,i=t.querySelector(".wwWMarker"),r=t.querySelector(".wwHMarker"),s=t.querySelector(".scaleMarker");i&&(i.innerText=v(i.innerText,null==n?void 0:n.toFixed(2),"")),r&&(r.innerText=v(r.innerText,null==o?void 0:o.toFixed(2),"")),s&&(s.innerText=v(s.innerText,null==a?void 0:a.toFixed(2),""))})),i.events.addEventNamespaceListener(`iconplayer_series.${e}`,(e=>{let t=e.detail;this.layoutView.iconPlayer.playerBarClickHandle(t)})),i.events.addEventNamespaceListener(`series_synchronizer_add.${e}`,(e=>{const{element:t}=e.detail;ts.add(t),Fo.add(t),this.seriesLayoutState.setSynchronizerStatus(t.dataset.seriesIndex,!0)})),i.events.addEventNamespaceListener(`series_synchronizer_remove.${e}`,(e=>{const{element:t,setSynchronizerStatus:n=!0}=e.detail;ts.remove(t),Fo.remove(t),n&&this.seriesLayoutState.setSynchronizerStatus(t.dataset.seriesIndex,!1)})),i.events.addEventNamespaceListener(`${i.EVENTS.IMAGE_CACHE_FULL}.${e}`,(e=>{console.error("Insufficient image cache",e),J(i.EVENTS.IMAGE_CACHE_FULL,!0)})),i.events.addEventNamespaceListener(`${i.EVENTS.WEBGL_TEXTURE_CACHE_FULL}.${e}`,(e=>{console.error("Insufficient WEBGL cache",e),J(i.EVENTS.WEBGL_TEXTURE_CACHE_FULL,!0)}))}removeEventListener(){const e=this.eventNamespace,t=["tool_series_layout","tool_series_image_layout","study_scroll","series_scroll","tool_imageType","tool_WwWc","tool_scale","tool_rotate","tool_colorMap","window_resize","navigator_dbClick_drag","first_active","image_active","navigator_active","canvas_active","canvas_active.player","tool_event","tool_event.VRT","layout_area_focus","images_viewport","iconplayer_series","series_synchronizer_add","series_synchronizer_remove"];window.onresize=void 0;for(let n of t)n.indexOf(".")<=0&&(n+=`.${e}`),i.events.removeEventNamespaceListener(n)}destroy(){var e;if(this.isDestroy)throw new Error(this.toastDict.reDestroy);this.layoutView.iconPlayer.playerAllPauseAndRemove(),_r(),lt.clear(),zu(),null===(e=n.g.webDicomViewMPR)||void 0===e||e.MPRDestroy(),Lu(),sr(),J("destroy",!0),mr([],{forceCancelAll:!0}),(0,or.configure)({parent:"body"}),this.layoutView.seriesLayout.seriesLayouts=[],this.studyUIDArr=[],this.studyArr=[],this.selectSeries={},this.removeEventListener(),w(this.layoutView.canvasContainer),w(this.globalContainer),this.globalContainer.classList.remove("dicomView"),as(),ts=void 0,jo(),Fo=void 0,Zu(),this.seriesLayoutState=void 0,this.globalContainer=void 0,this.isDestroy=!0}}id.i18n={getLanguage:D,translate:k};const rd=id})(),o=o.default})()));