!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WebDicomView",[],t):"object"==typeof exports?exports.WebDicomView=t():e.WebDicomView=t()}("undefined"!=typeof self?self:this,(()=>(()=>{var e={8075:(e,t,n)=>{"use strict";var o=n(453),r=n(487),a=r(o("String.prototype.indexOf"));e.exports=function(e,t){var n=o(e,!!t);return"function"==typeof n&&a(e,".prototype.")>-1?r(n):n}},487:(e,t,n)=>{"use strict";var o=n(6743),r=n(453),a=n(6897),i=n(9675),s=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),c=r("%Reflect.apply%",!0)||o.call(l,s),u=n(655),d=r("%Math.max%");e.exports=function(e){if("function"!=typeof e)throw new i("a function is required");var t=c(o,l,arguments);return a(t,1+d(0,e.length-(arguments.length-1)),!0)};var f=function(){return c(o,s,arguments)};u?u(e.exports,"apply",{value:f}):e.exports.apply=f},9584:e=>{
/*! cornerstone-core - 0.0.0-semantically-released - 2024-01-19 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */
window,e.exports=function(){return t=[function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=o(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==o(e)?e:String(e)}(r.key),r)}}n.r(t),n.d(t,"drawImage",(function(){return w})),n.d(t,"generateLut",(function(){return It})),n.d(t,"getDefaultViewport",(function(){return b})),n.d(t,"setDefaultViewport",(function(){return m})),n.d(t,"requestAnimationFrame",(function(){return Kt})),n.d(t,"storedPixelDataToCanvasImageData",(function(){return Ne})),n.d(t,"storedColorPixelDataToCanvasImageData",(function(){return Lt})),n.d(t,"storedPixelDataToCanvasImageDataColorLUT",(function(){return Ut})),n.d(t,"storedPixelDataToCanvasImageDataPseudocolorLUT",(function(){return _t})),n.d(t,"internal",(function(){return an})),n.d(t,"renderLabelMapImage",(function(){return Ft})),n.d(t,"renderPseudoColorImage",(function(){return Bt})),n.d(t,"renderColorImage",(function(){return Rt})),n.d(t,"renderGrayscaleImage",(function(){return Pt})),n.d(t,"renderWebImage",(function(){return pn})),n.d(t,"renderToCanvas",(function(){return hn})),n.d(t,"canvasToPixel",(function(){return Ae})),n.d(t,"disable",(function(){return Me})),n.d(t,"displayImage",(function(){return De})),n.d(t,"draw",(function(){return Le})),n.d(t,"drawInvalidated",(function(){return Oe})),n.d(t,"enable",(function(){return $t})),n.d(t,"getElementData",(function(){return Z})),n.d(t,"removeElementData",(function(){return X})),n.d(t,"getEnabledElement",(function(){return l})),n.d(t,"addEnabledElement",(function(){return c})),n.d(t,"getEnabledElementsByImageId",(function(){return u})),n.d(t,"getEnabledElements",(function(){return d})),n.d(t,"addLayer",(function(){return C})),n.d(t,"removeLayer",(function(){return A})),n.d(t,"getLayer",(function(){return M})),n.d(t,"getLayers",(function(){return P})),n.d(t,"getVisibleLayers",(function(){return D})),n.d(t,"setActiveLayer",(function(){return L})),n.d(t,"getActiveLayer",(function(){return k})),n.d(t,"purgeLayers",(function(){return R})),n.d(t,"setLayerImage",(function(){return O})),n.d(t,"fitToWindow",(function(){return ke})),n.d(t,"getDefaultViewportForImage",(function(){return en})),n.d(t,"getDisplayedArea",(function(){return x})),n.d(t,"getImage",(function(){return tn})),n.d(t,"getPixels",(function(){return on})),n.d(t,"getStoredPixels",(function(){return nn})),n.d(t,"getViewport",(function(){return rn})),n.d(t,"loadImage",(function(){return ce})),n.d(t,"loadAndCacheImage",(function(){return ue})),n.d(t,"registerImageLoader",(function(){return de})),n.d(t,"registerUnknownImageLoader",(function(){return fe})),n.d(t,"invalidate",(function(){return sn})),n.d(t,"invalidateImageId",(function(){return ln})),n.d(t,"pageToPixel",(function(){return dn})),n.d(t,"pixelToCanvas",(function(){return fn})),n.d(t,"reset",(function(){return gn})),n.d(t,"resize",(function(){return Re})),n.d(t,"setToPixelCoordinateSystem",(function(){return Ue})),n.d(t,"setViewport",(function(){return vn})),n.d(t,"updateImage",(function(){return T})),n.d(t,"pixelDataToFalseColorData",(function(){return q})),n.d(t,"rendering",(function(){return mn})),n.d(t,"imageCache",(function(){return ie})),n.d(t,"metaData",(function(){return un})),n.d(t,"webGL",(function(){return gt})),n.d(t,"colors",(function(){return z})),n.d(t,"convertImageToFalseColorImage",(function(){return G})),n.d(t,"convertToFalseColorImage",(function(){return Y})),n.d(t,"restoreImage",(function(){return W})),n.d(t,"EVENTS",(function(){return a})),n.d(t,"events",(function(){return i})),n.d(t,"triggerEvent",(function(){return I})),n.d(t,"imageLoadPoolManager",(function(){return xe})),n.d(t,"imageRetrievalPoolManager",(function(){return we})),n.d(t,"RequestPoolManager",(function(){return be}));var a={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_PROGRESS:"cornerstoneimageloadprogress",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"},i=new(function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.listeners={},this.namespaces={}}var t,n,o;return t=e,(n=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){0<e.indexOf(".")?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(0<e.indexOf("."))this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],o=0,r=n.length;o<r;o++)if(n[o]===t)return void n.splice(o,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type].slice(),n=0,o=t.length;n<o;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&r(t.prototype,n),o&&r(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}()),s=[];function l(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<s.length;t++)if(s[t].element===e)return s[t];throw new Error("element not enabled")}function c(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");s.push(e)}function u(e){var t=[];return s.forEach((function(n){n.image&&n.image.imageId===e&&t.push(n)})),t}function d(){return s}function f(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var h=function(){return"".concat(f()+f(),"-").concat(f(),"-").concat(f(),"-").concat(f(),"-").concat(f()).concat(f()).concat(f())},p={viewport:{}},m=function(e){p.viewport=e||{}};function g(e,t){if(null==e)throw new Error(t)}function v(e,t){var n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=(g(e,"getImageScale: parameter windowSize must not be undefined"),g(t,"getImageScale: parameter image must not be undefined"),o=y(t,o),1),a=1;return{verticalScale:((n=t.rowPixelSpacing||1)<(t=t.columnPixelSpacing||1)?a=t/n:r=n/t,n=e.height/o.height/r),horizontalScale:t=e.width/o.width/a,scaleFactor:Math.min(t,n)}}var y=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return g(e,"getImageSize: parameter image must not be undefined"),g(e.width,"getImageSize: parameter image must have width"),g(e.height,"getImageSize: parameter image must have height"),null!=t&&0!==t&&180!==t?{height:e.width,width:e.height}:{width:e.width,height:e.height}},b=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:void 0},p.viewport):{scale:v(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:void 0}},x=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(t&&t.displayedArea)return t.displayedArea;if(void 0===e)throw new Error("getDisplayedArea: parameter image must not be undefined");return{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:void 0===e.rowPixelSpacing?1:e.rowPixelSpacing,columnPixelSpacing:void 0===e.columnPixelSpacing?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}},w=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)},T=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e=l(e),w(e,t)};function I(e,t){var n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:o,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,o),e.dispatchEvent(n)}function E(e,t,n){I(t.element,e,{viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n})}function S(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n,o,r=e.image,a=t.image;r.imageId&&a.imageId&&(o=x(a,t.viewport),n=x(r,e.viewport),o=o.columnPixelSpacing*a.width/(n.columnPixelSpacing*r.width),a=t.viewport.scale/e.viewport.scale*o,t.viewport.scale=e.viewport.scale*a)}function C(e,t,n){var o=h(),r=l(e),i=r.layers,s=(t&&(s=b(r.canvas,t),n)&&n.viewport&&(s=Object.assign(s,n.viewport)),!1!==r.syncViewports&&(r.syncViewports=!0),{image:t,layerId:o,viewport:s,options:n||{},renderingTools:{}});return i.length&&t&&S(i[0],s),i.push(s),E(a.LAYER_ADDED,r,o),1===i.length&&t&&L(e,o),o}function A(e,t){var n=l(e),o=n.layers,r=n.layers.findIndex((function(e){return e.layerId===t}));-1!==r&&(o.splice(r,1),t===n.activeLayerId&&o.length&&L(e,o[0].layerId),E(a.LAYER_REMOVED,n,t))}function M(e,t){return l(e).layers.find((function(e){return e.layerId===t}))}function P(e){return l(e).layers}function D(e){return l(e).layers.filter((function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity}))}function L(e,t){var n=l(e);if(n.activeLayerId!==t){var o=n.layers.findIndex((function(e){return e.layerId===t}));if(-1===o)throw new Error("setActiveLayer: layer not found in layers array");if(!(o=n.layers[o]).image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=o.image,n.viewport=o.viewport,T(e),E(a.ACTIVE_LAYER_CHANGED,n,t)}}function O(e,t,n){var o=l(e),r=o.layers[0];if(!(e=n?M(e,n):k(e)))throw new Error("setLayerImage: Layer not found");(e.image=t)?e.viewport||(o=b(o.canvas,t),e.options&&e.options.viewport&&(e.viewport=Object.assign(o,e.options.viewport)),r.layerId!==n&&S(r,e)):e.viewport=void 0}function k(e){var t=l(e);return t.layers.find((function(e){return e.layerId===t.activeLayerId}))}function R(e){(e=l(e)).layers=[],delete e.activeLayerId,delete e.lastSyncViewportsState}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=_(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=_(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==_(e)?e:String(e)}(o.key),o)}}var B=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t,n,o;return t=e,(n=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(1<this.Table.length)||e){this.Table=[];var t,n,o,r,a=this.NumberOfColors-1;a?(t=(this.HueRange[1]-this.HueRange[0])/a,n=(this.SaturationRange[1]-this.SaturationRange[0])/a,o=(this.ValueRange[1]-this.ValueRange[0])/a,r=(this.AlphaRange[1]-this.AlphaRange[0])/a):t=n=o=r=0;for(var i=0;i<=a;i++){var s=this.HueRange[0]+i*t,l=this.SaturationRange[0]+i*n,c=this.ValueRange[0]+i*o,u=this.AlphaRange[0]+i*r,d=function(e,t,n){if(1<e)throw new Error("HSVToRGB expects hue < 1");var o=[];if(0===t)o[0]=n,o[1]=n,o[2]=n;else{var r=Math.floor(6*e),a=n*(1-t),i=n*(1-t*(e=6*e-r)),s=n*(1-t*(1-e));switch(r){case 0:case 6:o[0]=n,o[1]=s,o[2]=a;break;case 1:o[0]=i,o[1]=n,o[2]=a;break;case 2:o[0]=a,o[1]=n,o[2]=s;break;case 3:o[0]=a,o[1]=i,o[2]=n;break;case 4:o[0]=s,o[1]=a,o[2]=n;break;case 5:o[0]=n,o[1]=a,o[2]=i}}return o}(s,l,c),f=[];switch(this.Ramp){case"scurve":f[0]=Math.floor(127.5*(1+Math.cos((1-d[0])*Math.PI))),f[1]=Math.floor(127.5*(1+Math.cos((1-d[1])*Math.PI))),f[2]=Math.floor(127.5*(1+Math.cos((1-d[2])*Math.PI))),f[3]=Math.floor(255*u);break;case"linear":f[0]=Math.floor(255*d[0]+.5),f[1]=Math.floor(255*d[1]+.5),f[2]=Math.floor(255*d[2]+.5),f[3]=Math.floor(255*u+.5);break;case"sqrt":f[0]=Math.floor(255*Math.sqrt(d[0])+.5),f[1]=Math.floor(255*Math.sqrt(d[1])+.5),f[2]=Math.floor(255*Math.sqrt(d[2])+.5),f[3]=Math.floor(255*Math.sqrt(u)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(f)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+0,n=e+1,o=e+2;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[o]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};return t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e)?-1:(e=e<t.Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale,(t=Math.floor(e))===this.NumberOfColors+0?t=0:t===this.NumberOfColors+1&&(t=this.NumberOfColors-1),t)}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&N(t.prototype,n),o&&N(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),U=[0,0,0,0],V={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function F(e,t){var n,o=[],r=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<r;n++)o[n]=function(e,t){for(var n=0,o=e.length-1;n<=o;){var r=n+Math.floor((o-n)/2),a=e[r];if(a===t)return r;t<a?o=r-1:n=r+1}return n}(e,t[n]);return o}function j(e,t,n){var o=[],r=[],a=[],i=[];for(n=null===n?1:n,c=0;c<t.length;c++){var s=t[c];o.push((e-1)*s[0]),r.push(s[1]),a.push(s[1])}for(var l=function(e,t,n){for(var o=(t-e)/((n=null===n?100:n)-1),r=[];0<n--;)r.push(e),e+=o;return r[r.length-1]=t,r}(0,1,e),c=0;c<e;c++)l[c]=(e-1)*Math.pow(l[c],n);var u=F(o,l);for(c=1;c<e-1;c++){var d=u[c],f=(l[c]-o[d-1])/(o[d]-o[d-1]);i[c]=f*(r[d]-a[d-1])+a[d-1]}return i[0]=a[0],i[e-1]=r[t.length-1],i}function H(e,t){var n=V[e];return!(n=n||(V[e]=t||{name:"",colors:[]})).colors&&n.segmentedData&&(n.colors=function(e,t,n){for(var o=[],r=j(t=null===t?256:t,e.red,n=null===n?1:n),a=j(t,e.green,n),i=j(t,e.blue,n),s=0;s<t;s++){var l=Math.round(255*r[s]),c=Math.round(255*a[s]),u=Math.round(255*i[s]);o.push([l,c,u,255])}return o}(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(U);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:U},getColorRepeating:function(e){var t=n.colors.length;return this.getColor(e=t?e%t:0)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=n.colors.length;e.setNumberOfTableValues(t);for(var o=0;o<t;o++)e.setTableValue(o,n.colors[o])}},createLookupTable:function(){var e=new B;return this.buildLookupTable(e),e},isValidIndex:function(e){return 0<=e&&e<n.colors.length}}}var z={getColormap:H,getColormapsList:function(){var e=[];return Object.keys(V).forEach((function(t){var n;V.hasOwnProperty(t)&&(n=V[t],e.push({id:t,name:n.name}))})),e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),e},LookupTable:B};function q(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,o,r=e.minPixelValue,a=0,i=0,s=e.width*e.height,l=e.origPixelData||e.getPixelData(),c=new Uint8Array(4*s);if(e.color=!0,e.falseColor=!0,e.origPixelData=l,t instanceof z.LookupTable)for(t.build();i<s;)n=l[i++],o=t.mapValue(n),c[a++]=o[0],c[a++]=o[1],c[a++]=o[2],c[a++]=o[3];else if(r<0)for(;i<s;)n=l[i++],c[a++]=t[n+-r][0],c[a++]=t[n+-r][1],c[a++]=t[n+-r][2],c[a++]=t[n+-r][3];else for(;i<s;)n=l[i++],c[a++]=t[n][0],c[a++]=t[n][1],c[a++]=t[n][2],c[a++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return c}}function W(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function G(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,o,r,a,i,s,l,c,u,d,f,h=(t=h=(h=t)&&"string"==typeof h?H(h):h).getId();return e.colormapId!==h&&(W(e),h&&(o=e.minPixelValue||0,n=e.maxPixelValue||255,e.restore=(r=e).restore||(a=r.color,i=r.rgba,s=r.cachedLut,l=r.slope,c=r.windowWidth,u=r.windowCenter,d=r.minPixelValue,f=r.maxPixelValue,function(){var e;r.color=a,r.rgba=i,r.cachedLut=s,r.slope=l,r.windowWidth=c,r.windowCenter=u,r.minPixelValue=d,r.maxPixelValue=f,r.origPixelData&&(e=r.origPixelData,r.getPixelData=function(){return e}),r.origPixelData=void 0,r.colormapId=void 0,r.falseColor=void 0}),(t=t.createLookupTable()).setTableRange(o,n),q(e,t),o=function(e){for(var t,n=Number.MAX_VALUE,o=Number.MIN_VALUE,r=e.length,a=0;a<r;a++)n=n<(t=e[a])?n:t,o=t<o?o:t;return{minPixelValue:n,maxPixelValue:o}}(e.getPixelData()),e.minPixelValue=o.minPixelValue,e.maxPixelValue=o.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=h),!0)}function Y(e,t){return G(l(e).image,t)}function Z(e,t){return!1===(e=l(e)).data.hasOwnProperty(t)&&(e.data[t]={}),e.data[t]}function X(e,t){delete l(e).data[t]}var K=1073741824,Q=0,J={},$=[];function ee(){if(!(Q<=K)){for($.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));K<Q;){var e=$[$.length-1].imageId;oe(e),I(i,a.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=re();I(i,a.IMAGE_CACHE_FULL,t)}}function te(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===J.hasOwnProperty(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};J[e]=n,$.push(n),t.promise.then((function(e){if(-1!==$.indexOf(n)){if(n.loaded=!0,void 0===(n.image=e).sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,Q+=n.sizeInBytes;var t={action:"addImage",image:n};I(i,a.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,ee()}}),(function(){var t=J[e];$.splice($.indexOf(t),1),delete J[e]}))}function ne(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");if(void 0!==(e=J[e]))return e.timeStamp=Date.now(),e.imageLoadObject}function oe(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t,n=J[e];if(void 0===n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");$.splice($.indexOf(n),1),Q-=n.sizeInBytes,I(i,a.IMAGE_CACHE_CHANGED,{action:"deleteImage",image:n}),(t=n.imageLoadObject).promise.then((function(){t.decache&&t.decache()}),(function(){t.decache&&t.decache()})),delete J[e]}function re(){return{maximumSizeInBytes:K,cacheSizeInBytes:Q,numberOfImagesCached:$.length}}var ae,ie={imageCache:J,cachedImages:$,setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");K=e,I(i,a.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),ee()},putImageLoadObject:te,getImageLoadObject:ne,removeImageLoadObject:oe,getCacheInfo:re,purgeCache:function(){for(;0<$.length;)oe($[0].imageId)},changeImageIdCacheSize:function(e,t){var n=J[e];n&&n.imageLoadObject.promise.then((function(e){var o=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,Q+=o,o={action:"changeImageSize",image:e},I(i,a.IMAGE_CACHE_CHANGED,o)}))}},se={};function le(e,t){var n=e.indexOf(":");if(n=e.substring(0,n),null==(n=se[n])){if(void 0!==ae)return ae(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}return(n=n(e,t)).promise.then((function(e){I(i,a.IMAGE_LOADED,{image:e})}),(function(t){I(i,a.IMAGE_LOAD_FAILED,{imageId:e,error:t})})),n}function ce(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=ne(e);return(void 0!==n?n:le(e,t)).promise}function ue(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=ne(e);return void 0===n&&te(e,n=le(e,t)),n.promise}function de(e,t){se[e]=t}function fe(e){var t=ae;return ae=e,t}function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){var n,o,r,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return o=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){o=!0,r=e},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw r}}};if(Array.isArray(e)||(i=function(e,t){var n;if(e)return"string"==typeof e?me(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ge(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ye(o.key),o)}}function ve(e,t,n){(t=ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function ye(e){return e=function(e,t){if("object"!=he(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=he(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==he(e)?e:String(e)}var be=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");ve(this,"requestPool",void 0),ve(this,"awake",void 0),ve(this,"numRequests",void 0),ve(this,"maxNumRequests",void 0),ve(this,"grabDelay",void 0),ve(this,"timeoutHandle",void 0),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.awake=!1,this.grabDelay=5,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}var t,n,o;return t=e,(n=[{key:"destroy",value:function(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"addRequest",value:function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]&&arguments[4];e={requestFn:e,type:t,additionalDetails:n},void 0===this.requestPool[t][o]&&(this.requestPool[t][o]=[]),r?this.requestPool[t][o].unshift(e):this.requestPool[t][o].push(e),this.awake||(this.awake=!0,this.startGrabbing())}},{key:"filterRequests",value:function(e){var t=this;Object.keys(this.requestPool).forEach((function(n){var o=t.requestPool[n];Object.keys(o).forEach((function(t){o[t]=o[t].filter((function(t){return e(t)}))}))}))}},{key:"clearRequestStack",value:function(e){if(!this.requestPool[e])throw new Error("No category for the type ".concat(e," found"));this.requestPool[e]={0:[]}}},{key:"sendRequest",value:function(e){var t=this,n=e.requestFn,o=e.type;this.numRequests[o]++,this.awake=!0,n().finally((function(){t.numRequests[o]--,t.startAgain()}))}},{key:"startGrabbing",value:function(){for(var e=this.maxNumRequests.interaction+this.maxNumRequests.thumbnail+this.maxNumRequests.prefetch-(this.numRequests.interaction+this.numRequests.thumbnail+this.numRequests.prefetch),t=0;t<e;t++){var n=this.getNextRequest();if(!1===n)break;n&&this.sendRequest(n)}}},{key:"startAgain",value:function(){var e=this;this.awake&&(this.grabDelay?this.timeoutHandle=window.setTimeout((function(){e.startGrabbing()}),this.grabDelay):this.startGrabbing())}},{key:"getSortedPriorityGroups",value:function(e){var t=this;return Object.keys(this.requestPool[e]).map(Number).filter((function(n){return t.requestPool[e][n].length})).sort()}},{key:"getNextRequest",value:function(){var e,t=this.getSortedPriorityGroups("interaction"),n=pe(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;if(this.requestPool.interaction[o].length&&this.numRequests.interaction<this.maxNumRequests.interaction)return this.requestPool.interaction[o].shift()}}catch(e){n.e(e)}finally{n.f()}var r,a=this.getSortedPriorityGroups("thumbnail"),i=pe(a);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(this.requestPool.thumbnail[s].length&&this.numRequests.thumbnail<this.maxNumRequests.thumbnail)return this.requestPool.thumbnail[s].shift()}}catch(e){i.e(e)}finally{i.f()}var l,c=this.getSortedPriorityGroups("prefetch"),u=pe(c);try{for(u.s();!(l=u.n()).done;){var d=l.value;if(this.requestPool.prefetch[d].length&&this.numRequests.prefetch<this.maxNumRequests.prefetch)return this.requestPool.prefetch[d].shift()}}catch(e){u.e(e)}finally{u.f()}return t.length||a.length||c.length||(this.awake=!1),!1}},{key:"getRequestPool",value:function(){return this.requestPool}}])&&ge(t.prototype,n),o&&ge(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),xe=((n=new be).maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3},n.grabDelay=0,n),we=((n=new be).maxNumRequests={interaction:20,thumbnail:20,prefetch:20},n.grabDelay=0,n);function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=Te(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=Te(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==Te(e)?e:String(e)}(o.key),o)}}function Ee(e){return Ce(e)}var Se=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.reset()}var t,n,o;return t=e,(n=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],o=this.m[0]*e.m[2]+this.m[2]*e.m[3],r=this.m[1]*e.m[2]+this.m[3]*e.m[3],a=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4];e=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5],this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=r,this.m[4]=a,this.m[5]=e}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,o=-this.m[2]*e,r=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);e*=this.m[1]*this.m[4]-this.m[0]*this.m[5],this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=r,this.m[4]=a,this.m[5]=e}},{key:"rotate",value:function(e){var t=Math.cos(e),n=(e=Math.sin(e),this.m[0]*t+this.m[2]*e),o=this.m[1]*t+this.m[3]*e,r=this.m[0]*-e+this.m[2]*t;e=this.m[1]*-e+this.m[3]*t,this.m[0]=n,this.m[1]=o,this.m[2]=r,this.m[3]=e}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,o=t;return{x:e=n*this.m[0]+o*this.m[2]+this.m[4],y:t=n*this.m[1]+o*this.m[3]+this.m[5]}}}])&&Ie(t.prototype,n),o&&Ie(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Ce=function(e,t){var n,o,r=new Se,a=(r.translate(e.canvas.width/2,e.canvas.height/2),e.viewport.rotation),i=(0!==a&&r.rotate(a*Math.PI/180),e.viewport.scale),s=e.viewport.scale,l=x(e.image,e.viewport),c=l.tlhc.x-1,u=l.tlhc.y-1,d=l.brhc.x-c,f=l.brhc.y-u;return"NONE"===l.presentationSizeMode?e.image.rowPixelSpacing<e.image.columnPixelSpacing?i*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(s*=e.image.rowPixelSpacing/e.image.columnPixelSpacing):(i=l.columnPixelSpacing,s=l.rowPixelSpacing,"SCALE TO FIT"===l.presentationSizeMode&&(n=e.canvas.height/(f*s),o=e.canvas.width/(d*i),i=s=Math.min(o,n),l.rowPixelSpacing<l.columnPixelSpacing?i*=l.columnPixelSpacing/l.rowPixelSpacing:l.columnPixelSpacing<l.rowPixelSpacing&&(s*=l.rowPixelSpacing/l.columnPixelSpacing))),r.scale(i,s),0!==a&&r.rotate(-a*Math.PI/180),r.translate(e.viewport.translation.x,e.viewport.translation.y),0!==a&&r.rotate(a*Math.PI/180),void 0!==t&&r.scale(t,t),e.viewport.hflip&&r.scale(-1,1),e.viewport.vflip&&r.scale(1,-1),r.translate(-d/2,-f/2),r.translate(-c,-u),r},Ae=function(e,t){return(e=Ee(e=l(e))).invert(),e.transformPoint(t.x,t.y)},Me=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=s,n=0;n<t.length;n++)if(t[n].element===e){var o={element:e};I(e,a.ELEMENT_DISABLED,o),I(i,a.ELEMENT_DISABLED,o),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}},Pe=function(){return(window.performance?performance:Date).now()},De=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var o,r=l(e),i=r.image;if(r.image=t,r.layers&&r.layers.length&&O(e,t),void 0===r.viewport&&(r.viewport=b(r.canvas,t)),n)for(var s in n)null!==n[s]&&(r.viewport[s]=n[s]);void 0!==r.lastImageTimeStamp&&(o=(1e3/(Pe()-r.lastImageTimeStamp)).toFixed()),r.lastImageTimeStamp=Pe(),t={viewport:r.viewport,element:r.element,image:r.image,oldImage:i,enabledElement:r,frameRate:o},I(r.element,a.NEW_IMAGE,t),T(e)},Le=function(e){e=l(e),w(e)},Oe=function(){for(var e=s,t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&w(n,!0)}},ke=function(e){var t=l(e),n=t.image;t.viewport.scale=v(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,T(e)},Re=function(e,t){var n,o,r,i,s,c=l(e),u=c.canvas.width,d=c.canvas.height;o=e,(n=c.canvas).width!==o.clientWidth&&(n.width=o.clientWidth,n.style.width="".concat(o.clientWidth,"px")),n.height!==o.clientHeight&&(n.height=o.clientHeight,n.style.height="".concat(o.clientHeight,"px")),I(e,a.ELEMENT_RESIZED,{element:e}),void 0!==c.image&&(t||(n=u,o=d,r=(t=c).viewport.scale,i=y(t.image,t.viewport.rotation),s=Math.round(i.width*r),i=Math.round(i.height*r),r=t.viewport.translation.x,t=t.viewport.translation.y,s===n&&i<=o)||s<=n&&i===o&&0===r&&0===t?ke:(n=(s=c).viewport.scale,i=s.canvas.width,o=s.canvas.height,i=Math.sqrt(i/u*(o/d)),s.viewport.scale=i*n,T))(e)},_e=function(e){var t=(e.viewport||{}).invert;return e=(e.options||{}).fillStyle,-1!==["black","white"].indexOf(e)&&t?"white":"black"},Ne=function(e,t,n){var o=Pe(),r=e.getPixelData(),a=(e.stats.lastGetPixelDataTime=Pe()-o,r.length),i=e.minPixelValue,s=3,l=0;if(o=Pe(),r instanceof Int16Array)if(i<0)for(;l<a;)n[s]=t[r[l++]+-i],s+=4;else for(;l<a;)n[s]=t[r[l++]],s+=4;else if(r instanceof Uint16Array)for(;l<a;)n[s]=t[r[l++]],s+=4;else if(i<0)for(;l<a;)n[s]=t[r[l++]+-i],s+=4;else for(;l<a;)n[s]=t[r[l++]],s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-o},Be=function(e,t,n){var o,r=Pe(),a=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=Pe()-r,a.length),s=e.minPixelValue,l=0,c=0;if(r=Pe(),a instanceof Int16Array)if(s<0)for(;c<i;)o=t[a[c++]+-s],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else for(;c<i;)o=t[a[c++]],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else if(a instanceof Uint16Array)for(;c<i;)o=t[a[c++]],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else if(s<0)for(;c<i;)o=t[a[c++]+-s],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;else for(;c<i;)o=t[a[c++]],n[l++]=o,n[l++]=o,n[l++]=o,n[l++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-r},Ue=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");e=Ce(e,n),t.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5])},Ve={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),o=0,r=0;r<t.length;r++){var a=Math.abs(t[r]);n[o++]=255&a,n[o++]=a>>8,n[o++]=t[r]<0?0:1}return n}},Fe=((n={}).frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),je={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),o=0,r=0;r<t.length;r++)n[o++]=t[r],n[o++]=t[r]<0?0:1;return n}},He=(Fe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),ze={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,o=0,r=e.width*e.height*4,a=e.width*e.height*3,i=e.getPixelData(),s=new Uint8Array(a);if(t<0)for(;o<r;)s[n++]=i[o++]+-t,s[n++]=i[o++]+-t,s[n++]=i[o++]+-t,o+=1;else for(;o<r;)s[n++]=i[o++],s[n++]=i[o++],s[n++]=i[o++],o+=1;return s}},qe=(He.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}",{}),We={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),o=0,r=0;r<t.length;r++){var a=t[r];n[o++]=255&a,n[o++]=a>>8}return n}},Ge=(qe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),Ye={storedPixelDataToImageData:function(e){return e.getPixelData()}},Ze=(Ge.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{int16:n,int8:Fe,rgb:He,uint16:qe,uint8:Ge}),Xe={int16:Ve,int8:je,rgb:ze,uint16:We,uint8:Ye},Ke="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",Qe={},Je=[],$e=268435456,et=0;function tt(){if(!(et<=$e)){for(Je.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));$e<et;){var e=Je[Je.length-1];et-=e.sizeInBytes,delete Qe[e.imageId],Je.pop(),I(i,a.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:$e,cacheSizeInBytes:et,numberOfImagesCached:Je.length};I(i,a.WEBGL_TEXTURE_CACHE_FULL,t)}}var nt={purgeCache:function(){for(;0<Je.length;){var e=Je.pop();delete Qe[e.imageId]}et=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");if(void 0!==(e=Qe[e]))return e.timeStamp=new Date,e.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(Qe,n))throw new Error("putImageTexture: imageId already in cache");if(e={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes},Qe[n]=e,Je.push(e),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");et+=e.sizeInBytes,tt()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=Qe[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return Je.splice(Je.indexOf(t),1),et-=t.sizeInBytes,delete Qe[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");$e=e,tt()}};function ot(e,t,n){return n=e.createShader(n),e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||e.isContextLost()||(t=e.getShaderInfoLog(n),console.error("Could not compile shader:\n".concat(t))),n}var rt,at,it,st=function(e,t,n){var o;return t=ot(e,t,e.VERTEX_SHADER),n=ot(e,n,e.FRAGMENT_SHADER),o=e.createProgram(),e.attachShader(o,t),e.attachShader(o,n),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||e.isContextLost()||(t=e.getProgramInfoLog(o),console.error("WebGL program filed to link:\n".concat(t))),o},lt=document.createElement("canvas"),ct=!1;function ut(){if(!0!==ct&&function(e){rt=null;try{var t={desynchronized:!0,preserveDrawingBuffer:!0};rt=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",dt,!1),e.addEventListener("webglcontextlost",dt,!1),e.removeEventListener("webglcontextrestored",ft,!1),e.addEventListener("webglcontextrestored",ft,!1)}catch(e){throw new Error("Error creating WebGL context")}return rt||(console.error("Unable to initialize WebGL. Your browser may not support it."),rt=null),rt}(lt)){for(var e in it=rt.createBuffer(),rt.bindBuffer(rt.ARRAY_BUFFER,it),rt.bufferData(rt.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),rt.STATIC_DRAW),at=rt.createBuffer(),rt.bindBuffer(rt.ARRAY_BUFFER,at),rt.bufferData(rt.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),rt.STATIC_DRAW),Ze)(e=Ze[e]).attributes={},e.uniforms={},e.vert=Ke,e.program=st(rt,e.vert,e.frag),e.attributes.texCoordLocation=rt.getAttribLocation(e.program,"a_texCoord"),rt.enableVertexAttribArray(e.attributes.texCoordLocation),e.attributes.positionLocation=rt.getAttribLocation(e.program,"a_position"),rt.enableVertexAttribArray(e.attributes.positionLocation),e.uniforms.resolutionLocation=rt.getUniformLocation(e.program,"u_resolution");ct=!0}}function dt(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function ft(e){e.preventDefault(),ct=!1,nt.purgeCache(),ut()}function ht(e){return e.color?"rgb":(e=e.getPixelData())instanceof Int16Array?"int16":e instanceof Uint16Array?"uint16":e instanceof Int8Array?"int8":"uint8"}function pt(e){var t,n,o,r,a,i=nt.getImageTexture(e.imageId);return i||(t=e,n=(n={uint8:rt.LUMINANCE,int8:rt.LUMINANCE_ALPHA,uint16:rt.LUMINANCE_ALPHA,int16:rt.RGB,rgb:rt.RGB})[o=ht(t)],r=rt.createTexture(),rt.bindTexture(rt.TEXTURE_2D,r),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_MIN_FILTER,rt.NEAREST),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_MAG_FILTER,rt.NEAREST),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_WRAP_S,rt.CLAMP_TO_EDGE),rt.texParameteri(rt.TEXTURE_2D,rt.TEXTURE_WRAP_T,rt.CLAMP_TO_EDGE),rt.pixelStorei(rt.UNPACK_ALIGNMENT,1),a=Xe[o].storedPixelDataToImageData(t,t.width,t.height),rt.texImage2D(rt.TEXTURE_2D,0,n,t.width,t.height,0,n,rt.UNSIGNED_BYTE,a),i={texture:r,sizeInBytes:t.width*t.height*{int8:1,uint16:2,int16:3,rgb:3}[o]},nt.putImageTexture(e,i)),i.texture}function mt(e,t,n,o,r){for(var a in rt.clearColor(1,0,0,1),rt.viewport(0,0,o,r),rt.clear(rt.COLOR_BUFFER_BIT|rt.DEPTH_BUFFER_BIT),rt.useProgram(e.program),rt.bindBuffer(rt.ARRAY_BUFFER,at),rt.vertexAttribPointer(e.attributes.texCoordLocation,2,rt.FLOAT,!1,0,0),rt.bindBuffer(rt.ARRAY_BUFFER,it),rt.vertexAttribPointer(e.attributes.positionLocation,2,rt.FLOAT,!1,0,0),t){var i,s=rt.getUniformLocation(e.program,a);s&&(i=(a=t[a]).type,a=a.value,"i"===i?rt.uniform1i(s,a):"f"===i?rt.uniform1f(s,a):"2f"===i&&rt.uniform2f(s,a[0],a[1]))}var l;(l=rt).bufferData(l.ARRAY_BUFFER,new Float32Array([o,r,0,r,o,0,0,0]),l.STATIC_DRAW),rt.activeTexture(rt.TEXTURE0),rt.bindTexture(rt.TEXTURE_2D,n),rt.drawArrays(rt.TRIANGLE_STRIP,0,4)}n={createProgramFromString:st,renderer:{render:function(e){var t=e.image,n=(lt.width=t.width,lt.height=t.height,e=e.viewport,n=ht(n=t),Ze.hasOwnProperty(n)?Ze[n]:Ze.rgb),o=pt(t);return mt(n,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:e.voi.windowCenter},ww:{type:"f",value:e.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:e.invert?1:0}},o,t.width,t.height),lt},initRenderer:ut,getRenderCanvas:function(){return lt},isWebGLAvailable:function(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}},textureCache:nt};var gt=(Object.defineProperty(n,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return ct}}),n);function vt(e,t){var n,o;(o=e).voiLUT&&o.voiLUT.lut&&0<o.voiLUT.lut.length||void 0!==o.voi.windowWidth&&void 0!==o.voi.windowCenter||(n=(o=t.maxPixelValue*t.slope+t.intercept)-(t=t.minPixelValue*t.slope+t.intercept),o=(o+t)/2,void 0===e.voi?e.voi={windowWidth:n,windowCenter:o}:(e.voi.windowWidth=n,e.voi.windowCenter=o))}function yt(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}function bt(e,t,n){var o,r,a,i,s,l;return n?(r=(o=n).lut[0],a=o.lut[o.lut.length-1],i=o.firstValueMapped+o.lut.length,function(e){return e<o.firstValueMapped?r:i<=e?a:o.lut[e]}):(s=e,l=t,function(e){return e*s+l})}function xt(e){return function(e){if(Array.isArray(e))return wt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?wt(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wt(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var Tt=function(e,t,n,o){var r,a,i,s,l,c,u,d;return n?(r=n,a=o,i=Math.max.apply(Math,xt(r.lut)).toString(2).length-8,s=r.lut[0]>>i,l=r.lut[r.lut.length-1]>>i,c=r.firstValueMapped+r.lut.length-1,function(e){return e<r.firstValueMapped?s:c<=e?l:a?r.lut[Math.round(e)-r.firstValueMapped]>>i:r.lut[e-r.firstValueMapped]>>i}):(u=e,d=t,function(e){return 255*((e-d)/u+.5)})},It=function(e,t,n,o,r,a){var i=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0),c=(void 0===e.cachedLut&&(u=i-l+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(u)),e.cachedLut.lutArray),u=Boolean(e.slope%1)||Boolean(e.intercept%1),d=bt(e.slope,e.intercept,r),f=Tt(t,n,a,u);if(!0===o)for(var h=s;h<=i;h++)c[h+-l]=255-f(d(h));else for(var p=s;p<=i;p++)c[p+-l]=f(d(p));return c},Et=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&yt(e.cachedLut.modalityLUT,t.modalityLUT)&&yt(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(vt(t,e),It(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray},St=function(e,t){var n=e.renderingTools.lastRenderedImageId,o=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!o||o.windowCenter!==e.viewport.voi.windowCenter||o.windowWidth!==e.viewport.voi.windowWidth||o.invert!==e.viewport.invert||o.rotation!==e.viewport.rotation||o.hflip!==e.viewport.hflip||o.vflip!==e.viewport.vflip||o.modalityLUT!==e.viewport.modalityLUT||o.voiLUT!==e.viewport.voiLUT||o.colormap!==e.viewport.colormap},Ct=function(e,t){var n=((o=e.renderingTools.renderCanvas).width=t.width,o.height=t.height,o.getContext("2d",{desynchronized:!0})),o=(n.fillStyle="white",n.fillRect(0,0,o.width,o.height),n.getImageData(0,0,t.width,t.height));e.renderingTools.renderCanvasContext=n,e.renderingTools.renderCanvasData=o},At=function(e){var t=e.image.imageId,n=e.viewport,o=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=o,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools};function Mt(e,t,n,o){o=!(3<arguments.length&&void 0!==o)||o;var r,a,i=!0===e.renderingTools.lastRenderedIsColor;return e.renderingTools.renderCanvas&&!i||(e.renderingTools.renderCanvas=document.createElement("canvas"),Ct(e,t)),i=e.renderingTools.renderCanvas,!1===St(e,t)&&!0!==n||(i.width===t.width&&i.height===t.height||Ct(e,t),r=Pe(),n=Et(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-r,a=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(o?Ne:Be)(t,n,a.data),r=Pe(),e.putImageData(a,0,0),t.stats.lastPutImageDataTime=Pe()-r),i}function Pt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var o=e.canvas.getContext("2d",{desynchronized:!0}),r=(o.setTransform(1,0,0,1,0,0),o.fillStyle=_e(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,Ue(e,o),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?gt.renderer.render(e):Mt(e,n,t),t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-r;t=t.brhc.y-a,o.drawImage(n,r,a,i,t,r,a,i,t),e.renderingTools=At(e)}function Dt(e,t,n,o,r){var a,i=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0),c=(void 0===e.cachedLut&&(a=i-l+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(a)),e.cachedLut.lutArray),u=Tt(t,n,r);if(!0===o)for(var d=s;d<=i;d++)c[d+-l]=255-u(d);else for(var f=s;f<=i;f++)c[f+-l]=u(f)}var Lt=function(e,t,n){var o=Pe(),r=e.getPixelData(),a=(e.stats.lastGetPixelDataTime=Pe()-o,e.minPixelValue),i=0,s=0,l=r.length;if(o=Pe(),a<0)for(;s<l;)n[i++]=t[r[s++]+-a],n[i++]=t[r[s++]+-a],n[i]=t[r[s]+-a],s+=2,i+=2;else for(;s<l;)n[i++]=t[r[s++]],n[i++]=t[r[s++]],n[i]=t[r[s]],s+=2,i+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-o},Ot=function(e,t,n){var o=Pe(),r=e.getPixelData(),a=(e.stats.lastGetPixelDataTime=Pe()-o,e.minPixelValue),i=0,s=0,l=r.length;if(o=Pe(),a<0)for(;s<l;)n[i++]=t[r[s++]+-a],n[i++]=t[r[s++]+-a],n[i++]=t[r[s++]+-a],n[i++]=r[s++];else for(;s<l;)n[i++]=t[r[s++]],n[i++]=t[r[s++]],n[i++]=t[r[s++]],n[i++]=r[s++];e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-o};function kt(e,t,n){var o,r,a=!0===e.renderingTools.lastRenderedIsColor;return e.renderingTools.renderCanvas&&a||(e.renderingTools.renderCanvas=document.createElement("canvas")),a=e.renderingTools.renderCanvas,255!==e.viewport.voi.windowWidth&&256!==e.viewport.voi.windowWidth||127!==e.viewport.voi.windowCenter&&128!==e.viewport.voi.windowCenter||!1!==e.viewport.invert||!t.getCanvas||!t.getCanvas()?(!1===St(e,t)&&!0!==n||(a.width===t.width&&a.height===t.height||Ct(e,t),n=Pe(),r=t,o=e.viewport,void 0!==r.cachedLut&&r.cachedLut.windowCenter===o.voi.windowCenter&&r.cachedLut.windowWidth===o.voi.windowWidth&&r.cachedLut.invert===o.invert||(Dt(r,o.voi.windowWidth,o.voi.windowCenter,o.invert),r.cachedLut.windowWidth=o.voi.windowWidth,r.cachedLut.windowCenter=o.voi.windowCenter,r.cachedLut.invert=o.invert),o=r.cachedLut.lutArray,t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-n,r=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(t.rgba?Ot:Lt)(t,o,r.data),n=Pe(),e.putImageData(r,0,0),t.stats.lastPutImageDataTime=Pe()-n),a):t.getCanvas()}function Rt(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var o=e.canvas.getContext("2d",{desynchronized:!0}),r=(o.setTransform(1,0,0,1,0,0),o.fillStyle=_e(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,Ue(e,o),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?gt.renderer.render(e):kt(e,n,t),t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-r;t=t.brhc.y-a,o.drawImage(n,r,a,i,t,r,a,i,t),e.renderingTools=At(e)}var _t=function(e,t,n,o){var r,a,i=Pe(),s=e.getPixelData(),l=(e.stats.lastGetPixelDataTime=Pe()-i,s.length),c=e.minPixelValue,u=0,d=0,f=(i=Pe(),n instanceof z.LookupTable?n.Table:n);if(!0===e.color||!0===e.rgba)if(c<0)for(;d<l;)r=t[s[d]+-c],d+=4,a=f[r],o[u++]=a[0],o[u++]=a[1],o[u++]=a[2],o[u++]=a[3];else for(;d<l;)r=t[s[d]],d+=4,a=f[r],o[u++]=a[0],o[u++]=a[1],o[u++]=a[2],o[u++]=a[3];else if(c<0)for(;d<l;)a=f[r=t[s[d++]+-c]],o[u++]=a[0],o[u++]=a[1],o[u++]=a[2],o[u++]=a[3];else for(;d<l;)a=f[r=t[s[d++]]],o[u++]=a[0],o[u++]=a[1],o[u++]=a[2],o[u++]=a[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-i};function Nt(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var o,r,a=e.renderingTools.renderCanvas,i=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i=i&&"string"==typeof i?z.getColormap(i):i)return r=i.getId(),!1===St(e,t)&&!0!==n&&e.renderingTools.colormapId===r||(a.width===t.width&&a.height===t.height||Ct(e,t),o=Pe(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===r||(i.setNumberOfColors(256),e.renderingTools.colorLut=i.createLookupTable(),e.renderingTools.colormapId=r),i=Et(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-o,r=e.renderingTools.colorLut,n=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,_t(t,i,r,n.data),o=Pe(),e.putImageData(n,0,0),t.stats.lastPutImageDataTime=Pe()-o),a;throw new Error("renderPseudoColorImage: colormap not found.")}function Bt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");if(void 0===(o=e.image))throw new Error("drawImage: image must be loaded before it can be drawn");var n=e.canvas.getContext("2d",{desynchronized:!0}),o=(n.setTransform(1,0,0,1,0,0),n.fillStyle=_e(e),n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Ue(e,n),Nt(e,o,t)),r=(t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-r;t=t.brhc.y-a,n.drawImage(o,r,a,i,t,r,a,i,t),e.renderingTools=At(e)}var Ut=function(e,t,n){var o,r=Pe(),a=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=Pe()-r,a.length),s=e.minPixelValue,l=0,c=0,u=(r=Pe(),t instanceof z.LookupTable?t.Table:t);if(s<0)for(;c<i;)o=u[a[c++]+-s],n[l++]=o[0],n[l++]=o[1],n[l++]=o[2],n[l++]=o[3];else for(;c<i;)o=u[a[c++]],n[l++]=o[0],n[l++]=o[1],n[l++]=o[2],n[l++]=o[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-r};function Vt(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var o,r,a=e.renderingTools.renderCanvas,i=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i=i&&"string"==typeof i?z.getColormap(i):i)return r=i.getId(),!1===St(e,t)&&!0!==n&&e.renderingTools.colormapId===r||(a.width===t.width&&a.height===t.height||Ct(e,t),o=Pe(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===r||(e.renderingTools.colorLut=i.createLookupTable(),e.renderingTools.colormapId=r),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-o,n=e.renderingTools.colorLut,i=e.renderingTools.renderCanvasData,r=e.renderingTools.renderCanvasContext,Ut(t,n,i.data),o=Pe(),r.putImageData(i,0,0),t.stats.lastPutImageDataTime=Pe()-o),a;throw new Error("renderLabelMapImage: colormap not found.")}function Ft(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");if(void 0===(o=e.image))throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var n=e.canvas.getContext("2d",{desynchronized:!0}),o=(n.setTransform(1,0,0,1,0,0),n.fillStyle=_e(e),n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Ue(e,n),Vt(e,o,t)),r=(t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-r;t=t.brhc.y-a,n.drawImage(o,r,a,i,t,r,a,i,t),e.renderingTools=At(e)}function jt(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}function Ht(e,t){e.forEach((function(e){var n,o;e!==t&&e.viewport&&t.viewport&&(e.syncProps||jt(e),o=e,(n=t).syncProps||jt(n),o.syncProps||jt(o),o=o.syncProps.originalScale/n.syncProps.originalScale,e.viewport.scale=t.viewport.scale*o,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/o,y:t.viewport.translation.y/o},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip)}))}function zt(e,t,n){t.forEach((function(t,o){if(t.image){e.save(),t.canvas=e.canvas,Ue(t,e);var r=t.viewport.colormap||t.options.colormap,a=t.viewport.labelmap,i=t.invalid||n;if(r&&""!==r&&!0===a){var s=i;if(void 0===(a=t))throw new Error("addLabelMapLayer: layer parameter must not be undefined");var l=a.image;if(void 0===l)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");a.canvas=Vt(a,l,s),(l=a.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!a.viewport.pixelReplication,l.mozImageSmoothingEnabled=l.imageSmoothingEnabled,a.renderingTools=At(a)}else if(r&&""!==r){if(l=i,void 0===(s=t))throw new Error("addPseudoColorLayer: layer parameter must not be undefined");if(void 0===(a=s.image))throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");s.canvas=Nt(s,a,l),(a=s.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!s.viewport.pixelReplication,a.mozImageSmoothingEnabled=a.imageSmoothingEnabled,s.renderingTools=At(s)}else if(!0===t.image.color){if(a=i,void 0===(r=t))throw new Error("addColorLayer: layer parameter must not be undefined");var c=r.image;if(void 0===c)throw new Error("addColorLayer: image must be loaded before it can be drawn");c.rgba=!0,r.canvas=kt(r,c,a),(c=r.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!r.viewport.pixelReplication,c.mozImageSmoothingEnabled=c.imageSmoothingEnabled,r.renderingTools=At(r)}else!function(e,t,n){if(n=2<arguments.length&&void 0!==n&&n,void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var o=e.image;if(void 0===o)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=Mt(e,o,t,n),(o=e.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,e.renderingTools=At(e)}(t,i,0===o);t.options&&t.options.opacity?e.globalAlpha=t.options.opacity:e.globalAlpha=1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),e.imageSmoothingEnabled=!t.viewport.pixelReplication,e.mozImageSmoothingEnabled=e.imageSmoothingEnabled,c=(a=x(t.image,t.viewport)).tlhc.x-1,r=a.tlhc.y-1,i=a.brhc.x-c,o=a.brhc.y-r,e.drawImage(t.canvas,c,r,i,o,c,r,i,o),e.restore(),t.invalid=!1}}))}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Wt=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a=(b="function"==typeof Symbol?Symbol:{}).iterator||"@@iterator",i=b.asyncIterator||"@@asyncIterator",s=b.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(t,n,o,a){var i,s,l,c;return n=n&&n.prototype instanceof g?n:g,n=Object.create(n.prototype),a=new C(a||[]),r(n,"_invoke",{value:(i=t,s=o,l=a,c=d,function(t,n){if(c===h)throw new Error("Generator is already running");if(c===p){if("throw"===t)throw n;return{value:e,done:!0}}for(l.method=t,l.arg=n;;){var o=l.delegate;if(o&&(o=function t(n,o){var r=o.method,a=n.iterator[r];return a===e?(o.delegate=null,"throw"===r&&n.iterator.return&&(o.method="return",o.arg=e,t(n,o),"throw"===o.method)||"return"!==r&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m):"throw"===(r=u(a,n.iterator,o.arg)).type?(o.method="throw",o.arg=r.arg,o.delegate=null,m):(a=r.arg)?a.done?(o[n.resultName]=a.value,o.next=n.nextLoc,"return"!==o.method&&(o.method="next",o.arg=e),o.delegate=null,m):a:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,m)}(o,l),o)){if(o===m)continue;return o}if("next"===l.method)l.sent=l._sent=l.arg;else if("throw"===l.method){if(c===d)throw c=p,l.arg;l.dispatchException(l.arg)}else"return"===l.method&&l.abrupt("return",l.arg);if(c=h,"normal"===(o=u(i,s,l)).type){if(c=l.done?p:f,o.arg===m)continue;return{value:o.arg,done:l.done}}"throw"===o.type&&(c=p,l.method="throw",l.arg=o.arg)}})}),n}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d="suspendedStart",f="suspendedYield",h="executing",p="completed",m={};function g(){}function v(){}function y(){}var b,x,w=(l(b={},a,(function(){return this})),(x=(x=Object.getPrototypeOf)&&x(x(A([]))))&&x!==n&&o.call(x,a)&&(b=x),y.prototype=g.prototype=Object.create(b));function T(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){var n;r(this,"_invoke",{value:function(r,a){function i(){return new t((function(n,i){!function n(r,a,i,s){var l;if("throw"!==(r=u(e[r],e,a)).type)return(a=(l=r.arg).value)&&"object"==qt(a)&&o.call(a,"__await")?t.resolve(a.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(a).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,s)}));s(r.arg)}(r,a,n,i)}))}return n=n?n.then(i,i):i()}})}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function A(t){if(t||""===t){var n,r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(r=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r}).next=r}throw new TypeError(qt(t)+" is not iterable")}return r(w,"constructor",{value:v.prototype=y,configurable:!0}),r(y,"constructor",{value:v,configurable:!0}),v.displayName=l(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},T(I.prototype),l(I.prototype,i,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,o,r,a){void 0===a&&(a=Promise);var i=new I(c(e,n,o,r),a);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},T(w),l(w,s,"Generator"),l(w,a,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t,n=Object(e),o=[];for(t in n)o.push(t);return o.reverse(),function e(){for(;o.length;){var t=o.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},t.values=A,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(o,r){return s.type="throw",s.arg=t,n.next=o,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;0<=a;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}var i=(a=a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc?null:a)?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,o,r=this.tryEntries[t];if(r.tryLoc===e)return"throw"===(n=r.completion).type&&(o=n.arg,S(r)),o}throw new Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:A(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),m}},t}function Gt(e,t,n,o,r,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function Yt(e,t){return Zt.apply(this,arguments)}function Zt(){var e;return e=Wt().mark((function e(t,n){var o,r,i,s,l,c;return Wt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.image,i=t.element,s=t.layers||[],t.canvas&&t.image){e.next=5;break}return e.abrupt("return");case 5:return c=Pe(),r.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},s&&s.length?(d=n,m=f=p=h=f=void 0,h=P(f=(u=t).element),p=k(f),f=D(f),m=!u.lastSyncViewportsState&&u.syncViewports,u.lastSyncViewportsState=u.syncViewports,m&&h.forEach((function(e){e.viewport&&jt(e)})),!0===u.syncViewports&&Ht(f,p),(m=u.canvas.getContext("2d",{desynchronized:!0})).setTransform(1,0,0,1,0,0),m.fillStyle="black",m.fillRect(0,0,u.canvas.width,u.canvas.height),zt(m,f,d)):r&&((l=r.render)||(l=t.viewport.colormap&&""!==t.viewport.colormap&&!0===t.image.labelmap?Ft:t.viewport.colormap&&""!==t.viewport.colormap?Bt:r.color?Rt:Pt,r._render=l),l(t,n)),l=Pe()-c,c={viewport:t.viewport,element:i,image:r,enabledElement:t,canvasContext:t.canvas.getContext("2d",{desynchronized:!0}),renderTimeInMs:l},r.stats.lastRenderTime=l,t.invalid=!1,t.needsRedraw=!1,e.next=15,null==(o=globalThis.drawImageSyncHandler)?void 0:o.call(globalThis,c);case 15:I(i,a.IMAGE_RENDERED,c);case 16:case"end":return e.stop()}var u,d,f,h,p,m}),e)})),(Zt=function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function i(e){Gt(a,o,r,i,s,"next",e)}function s(e){Gt(a,o,r,i,s,"throw",e)}i(void 0)}))}).apply(this,arguments)}function Xt(e){gt.renderer.isWebGLAvailable()?(gt.renderer.initRenderer(),e.renderer="webgl",e.desynchronized=!0,e.preserveDrawingBuffer=!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,delete e.preserveDrawingBuffer)}var Kt=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||void window.setTimeout(e,1e3/60)},Qt="cornerstone-canvas";function Jt(e){var t="canvas.".concat(Qt);return e.querySelector(t)||(t=e,(e=document.createElement("canvas")).style.display="block",e.classList.add(Qt),t.appendChild(e),e)}var $t=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&Xt(t);var n,o={element:e,canvas:Jt(e),image:void 0,invalid:!1,needsRedraw:!0,options:Object.assign({},t),layers:[],data:{},renderingTools:{},uuid:(n=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(n+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})))};c(o),I(i,a.ELEMENT_ENABLED,o),Re(e,!0),function e(t){void 0!==o.canvas&&(I(o.element,a.PRE_RENDER,{enabledElement:o,timestamp:t}),o.needsRedraw&&(void 0!==(t=o).image||0<t.layers.length)&&Yt(o,o.invalid),Kt(e))}()},en=function(e,t){return e=l(e),b(e.canvas,t)},tn=function(e){return l(e).image},nn=function(e,t,n,o,r){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var a=l(e),i=[],s=0,c=a.image.getPixelData(),u=0;u<r;u++)for(var d=0;d<o;d++){var f=(u+n)*a.image.columns+(d+t);i[s++]=c[f]}return i},on=function(e,t,n,o,r){return t=nn(e,t,n,o,r),o=bt((n=l(e)).image.slope,n.image.intercept,n.viewport.modalityLUT),t.map(o)},rn=function(e){if(void 0!==(e=l(e).viewport))return Object.assign({},e)},an={drawImage:w,generateLut:It,getDefaultViewport:b,requestAnimationFrame:Kt,setDefaultViewport:m,storedPixelDataToCanvasImageData:Ne,storedPixelDataToCanvasImageDataRGBA:Be,storedPixelDataToCanvasImageDataColorLUT:Ut,storedPixelDataToCanvasImageDataPseudocolorLUT:_t,storedColorPixelDataToCanvasImageData:Lt,getTransform:Ee,calculateTransform:Ce,Transform:Se},sn=function(e){var t=l(e);t.invalid=!0,t.needsRedraw=!0,I(e,a.INVALIDATED,{element:e})},ln=function(e){u(e).forEach((function(e){w(e,!0)}))},cn=[],un={addProvider:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0;n<cn.length&&!(cn[n].priority<=t);n++);cn.splice(n,0,{priority:t,provider:e})},removeProvider:function(e){for(var t=0;t<cn.length;t++)if(cn[t].provider===e){cn.splice(t,1);break}},get:function(e,t){for(var n=0;n<cn.length;n++){var o=cn[n].provider(e,t);if(void 0!==o)return o}}},dn=function(e,t,n){var o=l(e);if(void 0===o.image)throw new Error("image has not been loaded yet");return t={x:t-(e=e.getBoundingClientRect()).left-window.pageXOffset,y:n-e.top-window.pageYOffset},(n=Ee(o)).invert(),n.transformPoint(t.x,t.y)},fn=function(e,t){return Ee(e=l(e)).transformPoint(t.x,t.y)},hn=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");o&&o.renderer&&"webgl"===o.renderer.toLowerCase()&&Xt(o);var r=b(e,t);n={enabledElement:(n&&Object.assign(r,n),e={element:n=e,canvas:n,image:t,invalid:!0,needsRedraw:!0,options:o,layers:[],data:{},renderingTools:{},viewport:r}),timestamp:Date.now()},I(e.element,a.PRE_RENDER,n),Yt(e,e.invalid)};function pn(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n,o,r,a,i,s=e.image;if(void 0===s)throw new Error("renderWebImage: image must be loaded before it can be drawn");e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert?((n=e.canvas.getContext("2d",{desynchronized:!0})).setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Ue(e,n),o=(i=x(e.image,e.viewport)).tlhc.x-1,r=i.tlhc.y-1,a=i.brhc.x-o,i=i.brhc.y-r,n.drawImage(s.getImage(),o,r,a,i,o,r,a,i)):Rt(e,t)}var mn={colorImage:Rt,grayscaleImage:Pt,webImage:pn,pseudoColorImage:Bt,labelMapImage:Ft,toCanvas:hn},gn=function(e){var t=l(e);t.viewport=b(t.canvas,t.image),T(e)},vn=function(e,t){var n=l(e);if(void 0===n.viewport&&(n.viewport=b(n.canvas)),t)for(var o in t)null!==t[o]&&(n.viewport[o]=t[o]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(n.viewport.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(n.viewport.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&T(e)};t.default={drawImage:w,generateLut:It,getDefaultViewport:b,requestAnimationFrame:Kt,storedPixelDataToCanvasImageData:Ne,storedColorPixelDataToCanvasImageData:Lt,storedPixelDataToCanvasImageDataColorLUT:Ut,storedPixelDataToCanvasImageDataPseudocolorLUT:_t,internal:an,renderLabelMapImage:Ft,renderPseudoColorImage:Bt,renderColorImage:Rt,renderGrayscaleImage:Pt,renderWebImage:pn,renderToCanvas:hn,canvasToPixel:Ae,disable:Me,displayImage:De,draw:Le,drawInvalidated:Oe,enable:$t,getElementData:Z,removeElementData:X,getEnabledElement:l,addEnabledElement:c,getEnabledElementsByImageId:u,getEnabledElements:d,addLayer:C,removeLayer:A,getLayer:M,getLayers:P,getVisibleLayers:D,setActiveLayer:L,getActiveLayer:k,purgeLayers:R,setLayerImage:O,fitToWindow:ke,getDefaultViewportForImage:en,getDisplayedArea:x,setDefaultViewport:m,getImage:tn,getPixels:on,getStoredPixels:nn,getViewport:rn,loadImage:ce,loadAndCacheImage:ue,registerImageLoader:de,registerUnknownImageLoader:fe,invalidate:sn,invalidateImageId:ln,pageToPixel:dn,pixelToCanvas:fn,reset:gn,resize:Re,setToPixelCoordinateSystem:Ue,setViewport:vn,updateImage:T,pixelDataToFalseColorData:q,rendering:mn,imageCache:ie,metaData:un,webGL:gt,colors:z,convertImageToFalseColorImage:G,convertToFalseColorImage:Y,restoreImage:W,EVENTS:a,events:i,triggerEvent:I,imageLoadPoolManager:xe,imageRetrievalPoolManager:we,RequestPoolManager:be}}],n={},e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(o,r,function(e){return t[e]}.bind(null,r));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=0);function e(o){var r;return(n[o]||(r=n[o]={i:o,l:!1,exports:{}},t[o].call(r.exports,r,r.exports,e),r.l=!0,r)).exports}var t,n}()},7869:e=>{
/*! cornerstone-math - 0.1.10 - 2022-06-09 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneMath */
window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),a=n(1),i=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=o||0}return o(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*o,this.y=r[1]*t+r[4]*n+r[7]*o,this.z=r[2]*t+r[5]*n+r[8]*o,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*o+r[12],this.y=r[1]*t+r[5]*n+r[9]*o+r[13],this.z=r[2]*t+r[6]*n+r[10]*o+r[14],this}},{key:"applyProjection",value:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*o+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*o+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*o+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*o+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,o=this.z,r=e.x,a=e.y,i=e.z,s=e.w,l=s*t+a*o-i*n,c=s*n+i*t-r*o,u=s*o+r*n-a*t,d=-r*t-a*n-i*o;return this.x=l*s+d*-r+c*-i-u*-a,this.y=c*s+d*-a+u*-r-l*-i,this.z=u*s+d*-i+l*-a-c*-r,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*o,this.y=r[1]*t+r[5]*n+r[9]*o,this.z=r[2]*t+r[6]*n+r[10]*o,this.normalize(),this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this}},{key:"max",value:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this}},{key:"clamp",value:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,o=this.y,r=this.z;return this.x=o*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-o*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,o=e.y,r=e.z,a=t.x,i=t.y,s=t.z;return this.x=o*s-r*i,this.y=r*a-n*s,this.z=n*i-o*a,this}},{key:"angleTo",value:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos((0,a.clamp)(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,o=this.z-e.z;return t*t+n*n+o*o}},{key:"setFromMatrixPosition",value:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),o=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=o,this}},{key:"setFromMatrixColumn",value:function(e,t){var n=4*e,o=t.elements;return this.x=o[n],this.y=o[n+1],this.z=o[n+2],this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();i.prototype.projectOnVector=function(){var e=void 0,t=void 0;return function(n){return void 0===e&&(e=new i),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),i.prototype.projectOnPlane=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),e.copy(this).projectOnVector(t),this.sub(e)}}(),i.prototype.reflect=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),i.prototype.clampScalar=function(){var e=void 0,t=void 0;return function(n,o){return void 0===e&&(e=new i,t=new i),e.set(n,n,n),t.set(o,o,o),this.clamp(e,t)}}(),i.prototype.applyAxisAngle=function(){var e=void 0;return function(t,n){return void 0===e&&(e=new r.default),this.applyQuaternion(e.setFromAxisAngle(t.normalize(),n)),this}}(),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=1e-4;t.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.degToRad=function(e){return e*(Math.PI/180)},t.approximatelyEquals=function(e,t,n){var r=n||o;return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))},t.radToDeg=function(e){return e*(180/Math.PI)},t.sign=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(){function e(t,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=o||0,this.w=void 0!==r?r:1}return o(e,[{key:"setFromAxisAngle",value:function(e,t){var n=t/2,o=Math.sin(n);return this.x=e.x*o,this.y=e.y*o,this.z=e.z*o,this.w=Math.cos(n),this}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,o=e.y,r=e.z,a=e.w,i=t.x,s=t.y,l=t.z,c=t.w;return this.x=n*c+a*i+o*l-r*s,this.y=o*c+a*s+r*i-n*l,this.z=r*c+a*l+n*s-o*i,this.w=a*c-n*i-o*s-r*l,this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],o=t[4],r=t[8],a=t[1],i=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+i+u,f=void 0;return d>0?(f=.5/Math.sqrt(d+1),this.w=.25/f,this.x=(c-s)*f,this.y=(r-l)*f,this.z=(a-o)*f):n>i&&n>u?(f=2*Math.sqrt(1+n-i-u),this.w=(c-s)/f,this.x=.25*f,this.y=(o+a)/f,this.z=(r+l)/f):i>u?(f=2*Math.sqrt(1+i-n-u),this.w=(r-l)/f,this.x=(o+a)/f,this.y=.25*f,this.z=(s+c)/f):(f=2*Math.sqrt(1+u-n-i),this.w=(a-o)/f,this.x=(r+l)/f,this.y=(s+c)/f,this.z=.25*f),this}}]),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1);function r(e){return e*e}function a(e,t){return r(e.x-t.x)+r(e.y-t.y)}var i={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var n=a(e.start,e.end);if(0===n)return a(t,e.start);var o=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/n;return a(t,o<0?e.start:o>1?e.end:{x:e.start.x+o*(e.end.x-e.start.x),y:e.start.y+o*(e.end.y-e.start.y)})}(e,t))},intersectLine:function(e,t){var n,r,a,i,s,l,c,u,d,f,h,p={},m=e.start.x,g=e.start.y,v=e.end.x,y=e.end.y,b=t.start.x,x=t.start.y,w=t.end.x,T=t.end.y,I=void 0;if(f=(n=y-g)*w+(a=m-v)*T+(s=v*g-m*y),(0===(d=n*b+a*x+s)||0===f||(0,o.sign)(d)!==(0,o.sign)(f))&&(u=(r=T-x)*v+(i=b-w)*y+(l=w*x-b*T),0===(c=r*m+i*g+l)||0===u||(0,o.sign)(c)!==(0,o.sign)(u))){h=n*i-r*a,I=a*l-i*s;var E=parseFloat(I/h);I=r*s-n*l;var S=parseFloat(I/h);return p.x=E,p.y=S,p}}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=t.rect=t.quaternion=t.point=t.Plane=t.Matrix4=t.sign=t.radToDeg=t.degToRad=t.clamp=t.lineSegment=t.Line3=void 0;var o=f(n(5)),r=f(n(3)),a=n(1),i=f(n(6)),s=f(n(7)),l=f(n(8)),c=f(n(2)),u=f(n(9)),d=f(n(0));function f(e){return e&&e.__esModule?e:{default:e}}var h={Line3:o.default,lineSegment:r.default,clamp:a.clamp,degToRad:a.degToRad,radToDeg:a.radToDeg,sign:a.sign,Matrix4:i.default,Plane:s.default,point:l.default,quaternion:c.default,rect:u.default,Vector3:d.default};t.Line3=o.default,t.lineSegment=r.default,t.clamp=a.clamp,t.degToRad=a.degToRad,t.radToDeg=a.radToDeg,t.sign=a.sign,t.Matrix4=i.default,t.Plane=s.default,t.point=l.default,t.quaternion=c.default,t.rect=u.default,t.Vector3=d.default,t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=n(1),i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=void 0!==t?t:new r.default,this.end=void 0!==n?n:new r.default}return o(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"center",value:function(e){return(e||new r.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return(e||new r.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){var n=t||new r.default;return this.delta(n).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){var n=new r.default,o=new r.default;n.subVectors(e,this.start),o.subVectors(this.end,this.start);var i=o.dot(o),s=o.dot(n)/i;return t&&(s=(0,a.clamp)(s,0,1)),s}},{key:"closestPointToPoint",value:function(e,t,n){var o=this.closestPointToPointParameter(e,t),a=n||new r.default;return this.delta(a).multiplyScalar(o).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"intersectLine",value:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),o=e.start.clone().sub(this.start),r=t.clone().cross(n),i=o.clone().cross(n),s=o.dot(r)/(o.lengthSq()*r.lengthSq());if((0,a.approximatelyEquals)(s,0)){var l=i.dot(r)/r.lengthSq();if(!(l>1||isNaN(l))){var c=this.start.clone().add(t.clone().multiplyScalar(l));return c.clone().sub(e.start).lengthSq()+c.clone().sub(e.end).lengthSq()<=e.distanceSq()?c:void 0}}}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n,o,r,a,i,s,l,c,u,d,f,h,p,m,g){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Float32Array(16);var v=this.elements;v[0]=void 0!==t?t:1,v[4]=n||0,v[8]=o||0,v[12]=r||0,v[1]=a||0,v[5]=void 0!==i?i:1,v[9]=s||0,v[13]=l||0,v[2]=c||0,v[6]=u||0,v[10]=void 0!==d?d:1,v[14]=f||0,v[3]=h||0,v[7]=p||0,v[11]=m||0,v[15]=void 0!==g?g:1}return o(e,[{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,n=e.x,o=e.y,r=e.z,a=e.w,i=n+n,s=o+o,l=r+r,c=n*i,u=n*s,d=n*l,f=o*s,h=o*l,p=r*l,m=a*i,g=a*s,v=a*l;return t[0]=1-(f+p),t[4]=u-v,t[8]=d+g,t[1]=u+v,t[5]=1-(c+p),t[9]=h-m,t[2]=d-g,t[6]=h+m,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,o=t.elements,r=this.elements,a=n[0],i=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],f=n[13],h=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],w=o[0],T=o[4],I=o[8],E=o[12],S=o[1],C=o[5],A=o[9],M=o[13],P=o[2],D=o[6],L=o[10],O=o[14],k=o[3],R=o[7],_=o[11],N=o[15];return r[0]=a*w+i*S+s*P+l*k,r[4]=a*T+i*C+s*D+l*R,r[8]=a*I+i*A+s*L+l*_,r[12]=a*E+i*M+s*O+l*N,r[1]=c*w+u*S+d*P+f*k,r[5]=c*T+u*C+d*D+f*R,r[9]=c*I+u*A+d*L+f*_,r[13]=c*E+u*M+d*O+f*N,r[2]=h*w+p*S+m*P+g*k,r[6]=h*T+p*C+m*D+g*R,r[10]=h*I+p*A+m*L+g*_,r[14]=h*E+p*M+m*O+g*N,r[3]=v*w+y*S+b*P+x*k,r[7]=v*T+y*C+b*D+x*R,r[11]=v*I+y*A+b*L+x*_,r[15]=v*E+y*M+b*O+x*N,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"getInverse",value:function(e,t){var n=this.elements,o=e.elements,r=o[0],a=o[4],i=o[8],s=o[12],l=o[1],c=o[5],u=o[9],d=o[13],f=o[2],h=o[6],p=o[10],m=o[14],g=o[3],v=o[7],y=o[11],b=o[15];n[0]=u*m*v-d*p*v+d*h*y-c*m*y-u*h*b+c*p*b,n[4]=s*p*v-i*m*v-s*h*y+a*m*y+i*h*b-a*p*b,n[8]=i*d*v-s*u*v+s*c*y-a*d*y-i*c*b+a*u*b,n[12]=s*u*h-i*d*h-s*c*p+a*d*p+i*c*m-a*u*m,n[1]=d*p*g-u*m*g-d*f*y+l*m*y+u*f*b-l*p*b,n[5]=i*m*g-s*p*g+s*f*y-r*m*y-i*f*b+r*p*b,n[9]=s*u*g-i*d*g-s*l*y+r*d*y+i*l*b-r*u*b,n[13]=i*d*f-s*u*f+s*l*p-r*d*p-i*l*m+r*u*m,n[2]=c*m*g-d*h*g+d*f*v-l*m*v-c*f*b+l*h*b,n[6]=s*h*g-a*m*g-s*f*v+r*m*v+a*f*b-r*h*b,n[10]=a*d*g-s*c*g+s*l*v-r*d*v-a*l*b+r*c*b,n[14]=s*c*f-a*d*f-s*l*h+r*d*h+a*l*m-r*c*m,n[3]=u*h*g-c*p*g-u*f*v+l*p*v+c*f*y-l*h*y,n[7]=a*p*g-i*h*g+i*f*v-r*p*v-a*f*y+r*h*y,n[11]=i*c*g-a*u*g-i*l*v+r*u*v+a*l*y-r*c*y,n[15]=a*u*f-i*c*f+i*l*h-r*u*h-a*l*p+r*c*p;var x=r*n[0]+l*n[4]+f*n[8]+g*n[12];if(0===x){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/x),this}},{key:"applyToVector3Array",value:function(){var e=new r.default;return function(t,n,o){void 0===n&&(n=0),void 0===o&&(o=t.length);for(var r=0,a=n;r<o;r+=3,a+=3)e.x=t[a],e.y=t[a+1],e.z=t[a+2],e.applyMatrix4(this),t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z;return t}}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"set",value:function(e,t,n,o,r,a,i,s,l,c,u,d,f,h,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=o,g[1]=r,g[5]=a,g[9]=i,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=f,g[7]=h,g[11]=p,g[15]=m,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=void 0!==t?t:new r.default(1,0,0),this.constant=void 0!==n?n:0}return o(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,o){return this.normal.set(e,t,n),this.constant=o,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return this.orthoPoint(e,t).sub(e).negate()}},{key:"orthoPoint",value:function(e,t){var n=this.distanceToPoint(e);return(t||new r.default).copy(this.normal).multiplyScalar(n)}},{key:"isIntersectionLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectPlane",value:function(e){var t=this.normal.clone().cross(e.normal),n={origin:new r.default,direction:t};if(this.normal.clone().cross(e.normal).length<1e-10)return n.direction=new r.default,n;var o=this.constant,a=e.constant,i=this.normal.clone().dot(e.normal),s=-(o-a*i)/(1-i*i),l=-(a-o*i)/(1-i*i);return n.origin=this.normal.clone().multiplyScalar(s).add(e.normal.clone().multiplyScalar(l)),n}},{key:"coplanarPoint",value:function(e){return(e||new r.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant=this.constant-e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();a.prototype.setFromCoplanarPoints=function(){var e=new r.default,t=new r.default;return function(n,o,r){var a=e.subVectors(r,o).cross(t.subVectors(n,o)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),a.prototype.intersectLine=function(){var e=new r.default;return function(t,n){var o=n||new r.default,a=t.delta(e),i=this.normal.dot(a);if(0===i)return 0===this.distanceToPoint(t.start)?o.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?void 0:o.copy(a).multiplyScalar(s).add(t.start)}}(),t.default=a},function(e,t,n){"use strict";function o(e,t){return{x:e.x-t.x,y:e.y-t.y}}function r(e,t){return Math.sqrt(a(e,t))}function a(e,t){var n=o(e,t);return n.x*n.x+n.y*n.y}Object.defineProperty(t,"__esModule",{value:!0});var i={subtract:o,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:r,distanceSquared:a,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)},findClosestPoint:function(e,t){var n=[],o=void 0;return e.forEach((function(e,a){var i=r(e,t);n.push(i),o=0===a?i:Math.min(i,o)})),e[n.indexOf(o)]}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function r(e){return{topLeft:{x:e.left,y:e.top},bottomRight:{x:e.left+e.width,y:e.top+e.height}}}var a={distanceToPoint:function(e,t){var n=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(e).forEach((function(e){var r=o.default.distanceToPoint(e,t);r<n&&(n=r)})),n},getIntersectionRect:function(e,t){var n={topLeft:{},bottomRight:{}};if(function(e,t){var n=void 0,o=void 0,a=r(e),i=r(t);return n=e.width>=0?t.width>=0?!(a.bottomRight.x<=i.topLeft.x||i.bottomRight.x<=a.topLeft.x):!(a.bottomRight.x<=i.bottomRight.x||i.topLeft.x<=a.topLeft.x):t.width>=0?!(a.topLeft.x<=i.topLeft.x||i.bottomRight.x<=a.bottomRight.x):!(a.topLeft.x<=i.bottomRight.x||i.topLeft.x<=a.bottomRight.x),o=e.height>=0?t.height>=0?!(a.bottomRight.y<=i.topLeft.y||i.bottomRight.y<=a.topLeft.y):!(a.bottomRight.y<=i.bottomRight.y||i.topLeft.y<=a.topLeft.y):t.height>=0?!(a.topLeft.y<=i.topLeft.y||i.bottomRight.y<=a.bottomRight.y):!(a.topLeft.y<=i.bottomRight.y||i.top<=a.bottomRight.y),n&&o}(e,t)){var o=r(e),a=r(t);return e.width>=0?t.width>=0?(n.topLeft.x=Math.max(o.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.min(o.bottomRight.x,a.bottomRight.x)):(n.topLeft.x=Math.max(o.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.min(o.bottomRight.x,a.topLeft.x)):t.width>=0?(n.topLeft.x=Math.min(o.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.max(o.bottomRight.x,a.topLeft.x)):(n.topLeft.x=Math.min(o.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.max(o.bottomRight.x,a.bottomRight.x)),e.height>=0?t.height>=0?(n.topLeft.y=Math.max(o.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.min(o.bottomRight.y,a.bottomRight.y)):(n.topLeft.y=Math.max(o.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.min(o.bottomRight.y,a.topLeft.y)):t.height>=0?(n.topLeft.y=Math.min(o.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.max(o.bottomRight.y,a.topLeft.y)):(n.topLeft.y=Math.min(o.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.max(o.bottomRight.y,a.bottomRight.y)),n}}};t.default=a}])},2662:e=>{
/*! cornerstone-tools - 6.0.10 - 2023-07-21 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=25)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t,n){var o=n(8),r=n(5);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(14);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var o=n(16),r=n(17),a=n(18);e.exports=function(e){return o(e)||r(e)||a()}},function(e,t,n){var o=n(20),r=n(21),a=n(22);e.exports=function(e,t){return o(e)||r(e,t)||a()}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=o=function(e){return n(e)}:e.exports=o=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},o(t)}e.exports=o},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";(function(e){var o=n(12),r={formatArgs:function(e){if(e[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),"+").concat(a.humanize(this.diff)),this.useColors){var t="color: ".concat(this.color);e.splice(1,0,t,"color: inherit");var n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))})),e.splice(o,0,t)}},save:function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},load:function(){var t;try{t=r.storage.getItem("debug")}catch(e){}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},storage:function(){try{return localStorage}catch(e){}}(),colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"]};r.log=console.debug||console.log||function(){};var a=Object(o.a)(r);a.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: ".concat(e.message)}},t.a=a}).call(this,n(15))},function(e,t,n){e.exports=n(23)},function(e,t,n){"use strict";var o=n(6),r=n.n(o);t.a=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return o.colors[Math.abs(t)%o.colors.length]}function o(e){var n;function r(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(r.enabled){var i=r,s=Number(new Date),l=s-(n||s);i.diff=l,i.prev=n,i.curr=s,n=s,t[0]=o.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var c=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;c++;var r=o.formatters[n];if("function"==typeof r){var a=t[c];e=r.call(i,a),t.splice(c,1),c--}return e})),o.formatArgs.call(i,t),(i.log||o.log).apply(i,t)}}return r.namespace=e,r.enabled=o.enabled(e),r.useColors=o.useColors(),r.color=t(e),r.destroy=a,r.extend=i,"function"==typeof o.init&&o.init(r),o.instances.push(r),r}function a(){var e=o.instances.indexOf(this);return-1!==e&&(o.instances.splice(e,1),!0)}function i(e,t){var n=o(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return o.debug=o,o.default=o,o.coerce=function(e){return e instanceof Error?e.stack||e.message:e},o.disable=function(){var e=[].concat(r()(o.names.map(s)),r()(o.skips.map(s).map((function(e){return"-".concat(e)})))).join(",");return o.enable(""),e},o.enable=function(e){var t;o.save(e),o.names=[],o.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?o.skips.push(new RegExp("^".concat(e.substr(1),"$"))):o.names.push(new RegExp("^".concat(e,"$"))));for(t=0;t<o.instances.length;t++){var a=o.instances[t];a.enabled=o.enabled(a.namespace)}},o.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=o.skips.length;t<n;t++)if(o.skips[t].test(e))return!1;for(t=0,n=o.names.length;t<n;t++)if(o.names[t].test(e))return!0;return!1},o.humanize=n(19),Object.keys(e).forEach((function(t){o[t]=e[t]})),o.instances=[],o.names=[],o.skips=[],o.formatters={},o.selectColor=t,o.enable(o.load()),o}},function(e,t){function n(e,t,n,o,r,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}e.exports=function(e){return function(){var t=this,o=arguments;return new Promise((function(r,a){var i=e.apply(t,o);function s(e){n(i,r,a,s,l,"next",e)}function l(e){n(i,r,a,s,l,"throw",e)}s(void 0)}))}}},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t){var n,o,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{o="function"==typeof clearTimeout?clearTimeout:i}catch(e){o=i}}();var l,c=[],u=!1,d=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&h())}function h(){if(!u){var e=s(f);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===i||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){var n=1e3,o=6e4,r=60*o,a=24*r;function i(e,t,n,o){var r=t>=1.5*n;return Math.round(e/n)+" "+o+(r?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*o;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=a?i(e,t,a,"day"):t>=r?i(e,t,r,"hour"):t>=o?i(e,t,o,"minute"):t>=n?i(e,t,n,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=r?Math.round(e/r)+"h":t>=o?Math.round(e/o)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw a}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var o=function(){return this||"object"==typeof self&&self}()||Function("return this")(),r=o.regeneratorRuntime&&Object.getOwnPropertyNames(o).indexOf("regeneratorRuntime")>=0,a=r&&o.regeneratorRuntime;if(o.regeneratorRuntime=void 0,e.exports=n(24),r)o.regeneratorRuntime=a;else try{delete o.regeneratorRuntime}catch(e){o.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,o=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag",l="object"==typeof e,c=t.regeneratorRuntime;if(c)l&&(e.exports=c);else{(c=t.regeneratorRuntime=l?e.exports:{}).wrap=m;var u={},d={};d[a]=function(){return this};var f=Object.getPrototypeOf,h=f&&f(f(C([])));h&&h!==n&&o.call(h,a)&&(d=h);var p=b.prototype=v.prototype=Object.create(d);y.prototype=p.constructor=b,b.constructor=y,b[s]=y.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(p),e},c.awrap=function(e){return{__await:e}},x(w.prototype),w.prototype[i]=function(){return this},c.AsyncIterator=w,c.async=function(e,t,n,o){var r=new w(m(e,t,n,o));return c.isGeneratorFunction(t)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},x(p),p[s]="Generator",p[a]=function(){return this},p.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var o=t.pop();if(o in e)return n.value=o,n.done=!1,n}return n.done=!0,n}},c.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return i.type="throw",i.arg=e,t.next=n,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=o.call(a,"catchLoc"),l=o.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;E(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}}}function m(e,t,n,o){var r=t&&t.prototype instanceof v?t:v,a=Object.create(r.prototype),i=new S(o||[]);return a._invoke=function(e,t,n){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return A()}for(n.method=r,n.arg=a;;){var i=n.delegate;if(i){var s=T(i,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var l=g(e,t,n);if("normal"===l.type){if(o=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o="completed",n.method="throw",n.arg=l.arg)}}}(e,n,i),a}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function x(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(n,r){function a(){return new Promise((function(t,a){!function t(n,r,a,i){var s=g(e[n],e,r);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,a,i)}),(function(e){t("throw",e,a,i)})):Promise.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return t("throw",e,a,i)}))}i(s.arg)}(n,r,t,a)}))}return t=t?t.then(a,a):a()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var o=g(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,u;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:A}}function A(){return{value:void 0,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var o={};n.r(o),n.d(o,"drawBrushPixels",(function(){return te})),n.d(o,"eraseIfSegmentIndex",(function(){return ee})),n.d(o,"eraseOutsideBoundingBox",(function(){return ne})),n.d(o,"eraseInsideShape",(function(){return se})),n.d(o,"eraseOutsideShape",(function(){return le})),n.d(o,"fillOutsideBoundingBox",(function(){return ce})),n.d(o,"fillInsideShape",(function(){return fe})),n.d(o,"fillOutsideShape",(function(){return he})),n.d(o,"floodFill",(function(){return pe})),n.d(o,"getBoundingBoxAroundCircle",(function(){return be})),n.d(o,"getBoundingBoxAroundPolygon",(function(){return xe})),n.d(o,"getCircle",(function(){return we})),n.d(o,"getPixelPathBetweenPixels",(function(){return Ee})),n.d(o,"isSameSegment",(function(){return ae})),n.d(o,"triggerLabelmapModifiedEvent",(function(){return Oe})),n.d(o,"getDiffBetweenPixelData",(function(){return ke}));var r={};n.r(r),n.d(r,"angleCursor",(function(){return xr})),n.d(r,"arrowAnnotateCursor",(function(){return wr})),n.d(r,"bidirectionalCursor",(function(){return Tr})),n.d(r,"cobbAngleCursor",(function(){return Ir})),n.d(r,"circleRoiCursor",(function(){return Er})),n.d(r,"ellipticalRoiCursor",(function(){return Sr})),n.d(r,"freehandRoiCursor",(function(){return Cr})),n.d(r,"freehandRoiSculptorCursor",(function(){return Ar})),n.d(r,"lengthCursor",(function(){return Mr})),n.d(r,"probeCursor",(function(){return Pr})),n.d(r,"rectangleRoiCursor",(function(){return Dr})),n.d(r,"textMarkerCursor",(function(){return Lr})),n.d(r,"crosshairsCursor",(function(){return Or})),n.d(r,"eraserCursor",(function(){return kr})),n.d(r,"magnifyCursor",(function(){return Rr})),n.d(r,"panCursor",(function(){return _r})),n.d(r,"rotateCursor",(function(){return Nr})),n.d(r,"stackScrollCursor",(function(){return Br})),n.d(r,"wwwcRegionCursor",(function(){return Ur})),n.d(r,"wwwcCursor",(function(){return Vr})),n.d(r,"zoomCursor",(function(){return Fr})),n.d(r,"freehandEraseInsideCursor",(function(){return Yr})),n.d(r,"freehandFillInsideCursor",(function(){return Zr})),n.d(r,"freehandEraseOutsideCursor",(function(){return Xr})),n.d(r,"freehandFillOutsideCursor",(function(){return Kr})),n.d(r,"segRectangleEraseInsideCursor",(function(){return Qr})),n.d(r,"segRectangleFillInsideCursor",(function(){return Jr})),n.d(r,"segRectangleEraseOutsideCursor",(function(){return $r})),n.d(r,"segRectangleFillOutsideCursor",(function(){return ea})),n.d(r,"segCircleEraseInsideCursor",(function(){return ta})),n.d(r,"segCircleFillInsideCursor",(function(){return na})),n.d(r,"segCircleEraseOutsideCursor",(function(){return oa})),n.d(r,"segCircleFillOutsideCursor",(function(){return ra}));var a=n(0),i=n.n(a),s=n(1),l=n.n(s),c=n(2),u=n.n(c),d=n(3),f=n.n(d),h=n(4),p=n.n(h),m=window.cornerstone,g=window.cornerstoneMath,v=window.Hammer,y={set cornerstone(e){m=e},get cornerstone(){return m},set cornerstoneMath(e){g=e},get cornerstoneMath(){return g},set Hammer(e){v=e},get Hammer(){return v}},b=n(8),x=n.n(b),w={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"};function T(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:o,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,o),e.dispatchEvent(n)}function I(e){return e instanceof HTMLElement?e:yt.enabledElementByUID(e)}var E={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1},S=E.UINT_16_ARRAY,C=E.FLOAT_32_ARRAY;function A(e,t,n){var o,r=xt("segmentation").configuration;switch(r.arrayType){case S:o=2;break;case C:o=4;break;default:throw new Error("Unsupported Array Type ".concat(r.arrayType))}e.labelmaps3D[t]={buffer:new ArrayBuffer(n*o),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}function M(){var e={};function t(t,n,o){!1===e.hasOwnProperty(t)&&(e[t]={});var r=e[t];!1===r.hasOwnProperty(n)&&(r[n]={data:[]}),r[n].data.push(o)}function n(t,n){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n))return o[n]}}function o(t,n,o){e[t][n]=o}function r(t){!1!==e.hasOwnProperty(t)&&delete e[t]}return{get:function(e,t){var o=y.cornerstone.getEnabledElement(e);if(o.image)return n(o.image.imageId,t)},add:function(e,n,o){var r=y.cornerstone.getEnabledElement(e);r.image&&t(r.image.imageId,n,o)},set:function(e,t,n){var r=y.cornerstone.getEnabledElement(e);r.image&&o(r.image.imageId,t,n)},clear:function(e){var t=y.cornerstone.getEnabledElement(e);t.image&&r(t.image.imageId)},getImageIdToolState:n,addImageIdToolState:t,setImageIdToolState:o,clearImageIdToolState:r,saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var P=M();function D(e){var t=y.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=P),t.toolStateManager}function L(e,t,n){var o=D(e);n.uuid=n.uuid||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),o.add(e,t,n),T(e,w.MEASUREMENT_ADDED,{toolName:t,toolType:t,element:e,measurementData:n})}function O(e,t){return D(e).get(e,t)}function k(e,t,n){var o=D(e).get(e,t);if(o&&o.data&&o.data.length){for(var r=-1,a=0;a<o.data.length;a++)o.data[a]===n&&(r=a);-1!==r&&(o.data.splice(r,1),T(e,w.MEASUREMENT_REMOVED,{toolName:t,toolType:t,element:e,measurementData:n}))}}function R(e,t){var n=D(e).get(e,t);void 0!==n&&(n.data=[])}function _(e,t){y.cornerstone.getEnabledElement(e).toolStateManager=t}var N=n(10),B=Object(N.a)("cornerstoneTools"),U=function(e){var t=B.extend(e);return{log:t,warn:t,error:void 0}},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat("cornerstoneTools",":*");return N.a.enable(e)},F=function(){return N.a.disable()},j={series:{},colorLutTables:[]},H=U("store:modules:segmentationModule:metadata");function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"increase",n=xt("segmentation").configuration,o=O(e,"stack").data[0].imageIds[0],r=j.series[o];if(r){var a=r.activeLabelmapIndex,i=r.labelmaps3D[a];switch(t){case"increase":i.activeSegmentIndex++,i.activeSegmentIndex>n.segmentsPerLabelmap&&(i.activeSegmentIndex=1);break;case"decrease":i.activeSegmentIndex--,i.activeSegmentIndex<=0&&(i.activeSegmentIndex=n.segmentsPerLabelmap)}}}var q=U("store:modules:segmentationModule:segmentVisibility"),W=U("store:modules:segmentationModule:getLabelmaps3D");function G(e){var t=I(e);if(t){var n=O(t,"stack");if(n){var o,r,a=n.data[0],i=a.imageIds[0],s=j.series[i];return s&&(o=s.labelmaps3D,r=s.activeLabelmapIndex),{labelmaps3D:o,activeLabelmapIndex:r,currentImageIdIndex:a.currentImageIdIndex}}W.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function Y(e,t){var n=G(e),o=n.labelmaps3D,r=n.activeLabelmapIndex;return o[t=void 0!==t?t:r]}var Z=E.UINT_16_ARRAY,X=E.FLOAT_32_ARRAY;function K(e,t){var n=I(e);if(n){var o=G(n).labelmaps3D;if(!o)return[];var r,a,i=xt("segmentation").configuration;switch(i.arrayType){case Z:r="Uint16Array",a="2";break;case X:r="Float32Array",a="4";break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}var s=j.colorLutTables;if(void 0!==t){var l=o[t];return l?{labelmapIndex:t,bytesPerVoxel:a,type:r,buffer:l.buffer,colorLUT:s[l.colorLUTIndex]}:void 0}for(var c=[],u=0;u<o.length;u++){var d=o[u];d&&c.push({labelmapIndex:u,bytesPerVoxel:2,buffer:d.buffer,colorLUT:s[d.colorLUTIndex]})}return c}}var Q=n(6),J=n.n(Q);function $(e){return J()(new Set(e))}function ee(e,t,n){t[e]===n&&(t[e]=0)}function te(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(e,t){return t*o+e};e.forEach((function(e){var o=a.apply(void 0,J()(e));r?ee(o,t,n):t[o]=n}))}function ne(e,t,n,o){for(var r=e.detail,a=t.pixelData,i=t.segmentIndex,s=r.image,l=s.width,c=s.height,u=0;u<l;u++)for(var d=0;d<n[1];d++)ee(d*l+u,a,i);for(var f=0;f<n[0];f++)for(var h=n[1];h<o[1];h++)ee(h*l+f,a,i);for(var p=o[0];p<l;p++)for(var m=n[1];m<o[1];m++)ee(m*l+p,a,i);for(var g=0;g<l;g++)for(var v=o[1];v<c;v++)ee(v*l+g,a,i)}var oe=n(7),re=n.n(oe);function ae(e,t,n){return t[e]===n}function ie(e,t,n,o,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=e.detail.image.width,s=t.pixelData,l=t.segmentIndex,c=re()(o,2),u=c[0],d=c[1],f=re()(r,2),h=f[0],p=f[1];"outside"===a&&ne(e,t,o,r);for(var m=u;m<h;m++)for(var g=d;g<p;g++){var v=g*i+m;ae(v,s,l)&&n({x:m,y:g})&&(s[v]=0)}}function se(e,t,n,o,r){ie(e,t,n,o,r,"inside")}function le(e,t,n,o,r){ie(e,t,(function(e){return!n(e)}),o,r,"outside")}function ce(e,t,n,o){for(var r=t.pixelData,a=t.segmentIndex,i=e.detail.image,s=i.width,l=i.height,c=0;c<s;c++)for(var u=0;u<n[1];u++)r[u*s+c]=a;for(var d=0;d<n[0];d++)for(var f=n[1];f<o[1];f++)r[f*s+d]=a;for(var h=o[0];h<s;h++)for(var p=n[1];p<o[1];p++)r[p*s+h]=a;for(var m=0;m<s;m++)for(var g=o[1];g<l;g++)r[g*s+m]=a}U("util:segmentation:operations:eraseOutsideCircle");var ue=U("util:segmentation:operations:helpers:fillShape");function de(e,t,n,o,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=t.pixelData,s=t.segmentIndex;if(void 0!==i&&void 0!==s){var l=e.detail.image.width,c=re()(o,2),u=c[0],d=c[1],f=re()(r,2),h=f[0],p=f[1];"outside"===a&&ce(e,t,o,r);for(var m=u;m<h;m++)for(var g=d;g<p;g++){var v=g*l+m;n({x:m,y:g})&&(i[v]=s)}}else ue.error("fillInsideShape requires operationData to contain pixelData and segmentIndex")}function fe(e,t,n,o,r){de(e,t,n,o,r,"inside")}function he(e,t,n,o,r){de(e,t,(function(e){return!n(e)}),o,r,"outside")}var pe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.onFlood||function(){},r=n.onBoundary||function(){},a=n.equals||me,i=n.diagonals||!1,s=x(t),l=T(),c=[],u=[],d={},f={};for(c.push({currentArgs:t});c.length>0;)h(c.pop());return{flooded:u,boundaries:E()};function h(e){var t=e.currentArgs,n=e.previousArgs;p(t)||(m(t),g(t)?(v(t),b(t)):y(n))}function p(e){return!0===d[e]}function m(e){d[e]=!0}function g(e){var t=w(x,[e]);return w(a,[t,s])}function v(e){u.push(e),o.apply(void 0,J()(e))}function y(e){f[e]=e,r.apply(void 0,J()(e))}function b(e){for(var t=0;t<l.length;t+=1){for(var n=l[t],o=e.slice(0),r=0;r<e.length;r+=1)o[r]+=n[r];c.push({currentArgs:o,previousArgs:e})}}function x(t){return e.apply(void 0,J()(t))}function w(e,t){try{return e.apply(void 0,J()(t))}catch(e){return}}function T(){return I(t.length).filter((function(e){var t=ge(e);return 0!==t&&(1===t||i)}))}function I(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},o=0;o<Math.pow(3,e);o+=1){var r=ve(o.toString(3),"0",e);t.push(n(r))}return t}function E(){var e=[];for(var t in f)f.hasOwnProperty(t)&&e.unshift(f[t]);return e}};function me(e,t){return e===t}function ge(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function ve(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}function ye(e,t){var n=(0,y.cornerstoneMath.point.distance)(e,t);return{left:Math.floor(Math.min(e.x-n,t.x)),top:Math.floor(Math.min(e.y-n,t.y)),width:2*n,height:2*n}}function be(e){var t=e.detail.handles,n=e.detail.image,o=n.width,r=n.height,a=ye(t.start,t.end),i=a.width+a.left,s=a.left,l=a.top+a.height,c=a.top;return s=Math.floor(s),c=Math.floor(c),i=Math.floor(i),l=Math.floor(l),i=Math.min(o,i),s=Math.max(0,s),l=Math.min(r,l),[[s,c=Math.max(0,c)],[i,l]]}function xe(e,t){var n=1/0,o=0,r=1/0,a=0,i=t.width,s=t.height;return e.forEach((function(e){n=Math.min(e[0],n),o=Math.max(e[0],o),r=Math.min(e[1],r),a=Math.max(e[1],a)})),n=Math.floor(n),r=Math.floor(r),o=Math.floor(o),a=Math.floor(a),o=Math.min(i,o),n=Math.max(0,n),a=Math.min(s,a),r=Math.max(0,r),[[n,r],[o,a]]}function we(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Math.floor(o),i=Math.floor(r);if(1===e)return[[a,i]];for(var s=[],l=0,c=-e;c<=e;c++){var u=i+c;if(!(u>t||u<0))for(var d=-e;d<=e;d++){var f=a+d;f>=n||f<0||d*d+c*c<e*e&&(s[l++]=[a+d,i+c])}}return s}var Te=1/Math.sqrt(2),Ie={up:{x:0,y:1},upRight:{x:Te,y:Te},right:{x:1,y:0},downRight:{x:Te,y:-Te},down:{x:0,y:1},downLeft:{x:-Te,y:-Te},left:{x:-1,y:0},upLeft:{x:-Te,y:Te}},Ee=function(e,t){for(var n={x:e.x,y:e.y},o=[];t.x!==n.x||t.y!==n.y;)t.x===n.x?t.y>n.y?n.y++:n.y--:t.y===n.y?t.x>n.x?n.x++:n.x--:t.y>n.y?t.x>n.x?Se(n,t):Ce(n,t):t.x>n.x?Ae(n,t):Me(n,t),o.push({x:n.x,y:n.y});return o.pop(),o};function Se(e,t){var n=Pe(e,t);switch(Le([De(n,Ie.up),De(n,Ie.right),De(n,Ie.upRight)])){case 0:e.y++;break;case 1:e.x++;break;case 2:e.y++,e.x++}}function Ce(e,t){var n=Pe(e,t);switch(Le([De(n,Ie.up),De(n,Ie.left),De(n,Ie.upLeft)])){case 0:e.y++;break;case 1:e.x--;break;case 2:e.y++,e.x--}}function Ae(e,t){var n=Pe(e,t);switch(Le([De(n,Ie.down),De(n,Ie.right),De(n,Ie.downRight)])){case 0:e.y--;break;case 1:e.x++;break;case 2:e.y--,e.x++}}function Me(e,t){var n=Pe(e,t);switch(Le([De(n,Ie.down),De(n,Ie.left),De(n,Ie.downLeft)])){case 0:e.y--;break;case 1:e.x--;break;case 2:e.y--,e.x--}}function Pe(e,t){var n=y.cornerstoneMath.point.distance(e,t);return{x:(t.x-e.x)/n,y:(t.y-e.y)/n}}function De(e,t){return e.x*t.x+e.y*t.y}function Le(e){var t=e[0]>e[1]?0:1;return e[2]>e[t]&&(t=2),t}function Oe(e,t){var n=xt("segmentation").getters;t=void 0===t?n.activeLabelmapIndex(e):t,y.cornerstone.triggerEvent(e,w.LABELMAP_MODIFIED,{labelmapIndex:t})}function ke(e,t){for(var n=[],o=0;o<e.length;o++)e[o]!==t[o]&&n.push([o,e[o],t[o]]);return n}var Re=E.UINT_16_ARRAY,_e=E.FLOAT_32_ARRAY;function Ne(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=xt("segmentation").configuration,l=j.series[e];l||(j.series[e]={activeLabelmapIndex:n,labelmaps3D:[]},l=j.series[e]),l.labelmaps3D[n]={buffer:t,labelmaps2D:[],metadata:o,activeSegmentIndex:1,colorLUTIndex:i,segmentsHidden:[],undo:[],redo:[]};for(var c=l.labelmaps3D[n].labelmaps2D,u=t.byteLength/r,d=0;d<r;d++){var f=void 0;switch(s.arrayType){case Re:f=new Uint16Array(t,u*d,u/2);break;case _e:f=new Float32Array(t,u*d,u/4);break;default:throw new Error("Unsupported Array Type ".concat(s.arrayType))}var h=a?a[d]:$(f);h&&h.some((function(e){return e}))&&(c[d]={pixelData:f,segmentsOnLabelmap:h})}}var Be=U("store:modules:segmentationModule:getLabelmapStats");function Ue(e,t,n){var o=e.length,r=t[n].imagePositionPatient;if(0===n)return Ve(r,t[n+1].imagePositionPatient);if(n===o-1)return Ve(r,t[n-1].imagePositionPatient);var a=t[n-1].imagePositionPatient,i=t[n+1].imagePositionPatient;return(Ve(r,a)+Ve(r,i))/2}function Ve(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}var Fe=E.UINT_16_ARRAY,je=E.FLOAT_32_ARRAY;function He(e,t,n,o,r){var a,i=xt("segmentation").configuration,s=o*r,l=s*n;switch(i.arrayType){case Fe:a=new Uint16Array(e.labelmaps3D[t].buffer,2*l,s);break;case je:a=new Float32Array(e.labelmaps3D[t].buffer,4*l,s);break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}e.labelmaps3D[t].labelmaps2D[n]={pixelData:a,segmentsOnLabelmap:[]}}var ze=E.UINT_16_ARRAY,qe=E.FLOAT_32_ARRAY,We=U("store:modules:segmentationModule:getLabelmap2D");function Ge(e,t,n){var o=e.x,r=e.y;return o<n&&o>=0&&r<t&&r>=0}var Ye=U("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent"),Ze=U("store:modules:segmentationModule:setColorLUT");function Xe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=xt("segmentation").configuration.segmentsPerLabelmap;t?(Qe(t,n),t.length<n&&(t=[].concat(J()(t),J()(Je(n-t.length))))):t=t||Je(n),t.unshift([0,0,0,0]),j.colorLutTables[e]=t}function Ke(e){return"number"==typeof e?j.colorLutTables[e]:j.colorLutTables[e.colorLUTIndex]}function Qe(e,t){e.length<t?Ze.warn("The provided colorLUT only provides ".concat(e.length," labels, whereas segmentsPerLabelmap is set to ").concat(t,". Autogenerating the rest.")):e.length>t&&Ze.warn("segmentsPerLabelmap is set to ".concat(t,", and the provided colorLUT provides ").concat(e.length,". Using the first ").concat(t," colors from the LUT."))}function Je(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,t=[],n=0;n<e;n++)t.push(ot(et(),nt()));return t}var $e=222.5;function et(){return($e+=137.5)>=360&&($e-=360),$e}var tt=.6;function nt(){return(tt+=.07)>.82&&(tt=tt-.82+.3),tt}function ot(e){var t,n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=(1-Math.abs(2*a-1))*r,l=s*(1-Math.abs(e/60%2-1)),c=a-s/2;return e<60?(t=s,n=l,o=0):e<120?(t=l,n=s,o=0):e<180?(t=0,n=s,o=l):e<240?(t=0,n=l,o=s):e<300?(t=l,n=0,o=s):e<360&&(t=s,n=0,o=l),[255*(t+c),255*(n+c),255*(o+c),i]}var rt=U("store:modules:segmentationModule:getBrushColor"),at={renderOutline:!0,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:E.UINT_16_ARRAY},it=U("util:segmentation:labelmap3DHistory");function st(e,t,n){var o=e.labelmaps2D;t.forEach((function(e){for(var t=e.imageIdIndex,r=e.diff,a=o[t].pixelData,i=0;i<r.length;i++){var s=r[i];a[s[0]]=s[n]}}))}var lt={state:j,configuration:at,onRegisterCallback:function(){Xe(0)},getters:{metadata:function(e,t,n){var o=I(e);if(o){var r=O(o,"stack").data[0].imageIds[0],a=j.series[r];if(a){if(t=void 0===t?a.activeLabelmapIndex:t,a.labelmaps3D[t]){var i=a.labelmaps3D[t];return void 0===n?i.metadata:i.metadata[n]}H.warn("No labelmap3D of labelmap index ".concat(t," on stack."))}else H.warn("brushStackState is undefined")}},labelmap3D:Y,labelmaps3D:G,activeLabelmapIndex:function(e){var t=I(e);if(t){var n=O(t,"stack").data[0].imageIds[0],o=j.series[n];if(o)return o.activeLabelmapIndex}},activeSegmentIndex:function(e,t){var n=I(e);if(n){var o=O(n,"stack").data[0].imageIds[0],r=j.series[o];if(r){t=void 0===t?r.activeLabelmapIndex:t;var a=r.labelmaps3D[t];if(a)return a.activeSegmentIndex}return 1}},isSegmentVisible:function(e,t,n){if(t){var o=I(e);if(o){var r=O(o,"stack").data[0].imageIds[0],a=j.series[r];if(a){if(n=void 0===n?a.activeLabelmapIndex:n,a.labelmaps3D[n])return!a.labelmaps3D[n].segmentsHidden[t];q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},labelmap2D:function(e){var t=I(e);if(t){var n=y.cornerstone,o=O(t,"stack");if(o){var r,a=o.data[0],i=n.getEnabledElement(t),s=a.currentImageIdIndex,l=i.image,c=l.rows,u=l.columns,d=a.imageIds.length,f=a.imageIds[0],h=j.series[f];h?(r=h.activeLabelmapIndex,h.labelmaps3D[r]||A(h,r,c*u*d),h.labelmaps3D[r].labelmaps2D[s]||He(h,r,s,c,u)):(r=0,j.series[f]={activeLabelmapIndex:r,labelmaps3D:[]},A(h=j.series[f],r,c*u*d),He(h,r,s,c,u));var p=h.labelmaps3D[r];return{labelmap2D:p.labelmaps2D[s],labelmap3D:p,currentImageIdIndex:s,activeLabelmapIndex:r}}We.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmap2DByImageIdIndex:function(e,t,n,o){if(!e.labelmaps2D[t]){var r,a=xt("segmentation").configuration,i=n*o,s=i*t;switch(a.arrayType){case ze:r=new Uint16Array(e.buffer,2*s,i);break;case qe:r=new Float32Array(e.buffer,4*s,i);break;default:throw new Error("Unsupported Array Type ".concat(a.arrayType))}e.labelmaps2D[t]={pixelData:r,segmentsOnLabelmap:$(r)}}return e.labelmaps2D[t]},labelmapStats:function(e,t,n){var o=y.cornerstone,r=I(e);if(!r)return null;var a=O(r,"stack").data[0].imageIds,i=a[0];return new Promise((function(e){var r=j.series[i];r||e(null);var s=function(e){for(var t=[],n=y.cornerstone.metaData,o=!0,r=0;r<e.length;r++){var a=n.get("imagePlaneModule",e[r]);if(!a){o=!1;break}t.push(a)}return{sufficientMetadata:o,imagePlanes:t}}(a),l=s.sufficientMetadata,c=s.imagePlanes;l||(Be.warn("Insufficient imagePlaneModule information to calculate volume statistics."),e(null)),n=void 0===n?r.activeLabelmapIndex:n;for(var u=r.labelmaps3D[n],d=[],f=0;f<a.length;f++)d.push(o.loadAndCacheImage(a[f]));Promise.all(d).then((function(n){var o=function(e,t,n,o){for(var r=function(e,t,n,o){for(var r=t[0],a=r.rowPixelSpacing,i=r.columnPixelSpacing,s=e.labelmaps2D,l=[],c=0;c<s.length;c++){var u=s[c];if(u&&u.segmentsOnLabelmap.includes(o)){for(var d=Ue(t,n,c)*a*i,f=u.pixelData,h=t[c].getPixelData(),p=[],m=0;m<f.length;m++)f[m]===o&&p.push(h[m]);l.push({voxelInMM3:d,values:p})}}return l}(e,t,n,o),a=0,i=r[0].values[0],s=i,l=0,c=0;c<r.length;c++){var u=r[c],d=u.values,f=u.voxelInMM3;l+=f*d.length;var h=0;d.forEach((function(e){e>i?i=e:e<s&&(s=e),h+=e})),a+=h*f}a/=l;for(var p=0,m=0;m<r.length;m++){var g=r[m],v=(d=g.values,f=g.voxelInMM3,0);d.forEach((function(e){v+=Math.pow(e-a,2)})),p+=v*f}return p/=l,p=Math.sqrt(p),{volume:l,mean:a,stdDev:p,max:i,min:s}}(u,n,c,t);e(o)}))}))},segmentOfActiveLabelmapAtEvent:function(e){var t=e.detail,n=t.element,o=t.image,r=t.currentPoints;if(r){var a=o.width,i=o.height;if(n){var s=O(n,"stack").data[0],l=s.currentImageIdIndex,c=s.imageIds[0],u=j.series[c],d=u.activeLabelmapIndex,f=u.labelmaps3D[d];if(f){var h=f.labelmaps2D[l];if(h){var p=h.pixelData,m=r.image,g=m.x,v=m.y;if(Ge({x:g=Math.floor(g),y:v=Math.floor(v)},i,a)){var y=p[v*a+g];if(0===y)return;return{segmentIndex:y,metadata:f.metadata[y]}}}}}}else Ye.warn("Not a cornerstone input event.")},brushColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=I(e);if(n){var o=O(n,"stack");if(o){var r,a=o.data[0].imageIds[0],i=j.series[a];if(i){var s=i.activeLabelmapIndex,l=i.labelmaps3D[s],c=l.activeSegmentIndex;r=j.colorLutTables[l.colorLUTIndex][c]}else r=j.colorLutTables[0][1];return t?"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 1.0 )"):"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 0.8 )")}rt.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmapBuffers:K,activeLabelmapBuffer:function(e){var t=I(e);if(t){var n=O(t,"stack").data[0].imageIds[0],o=j.series[n];if(o)return K(t,o.activeLabelmapIndex)}},colorLUT:Ke,colorForSegmentIndexColorLUT:function(e,t){return Ke(e)[t]}},setters:{metadata:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,r=I(e);if(r){var a=y.cornerstone,i=O(r,"stack").data[0],s=i.imageIds[0],l=j.series[s];if(l||(j.series[s]={labelmapIndex:t,labelmaps3D:[]},l=j.series[s]),!l.labelmaps3D[t]){var c=a.getEnabledElement(r).image;A(l,t,c.rows*c.columns*i.imageIds.length)}l.labelmaps3D[t].metadata[n]=o}},labelmap3DForElement:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=I(e);if(i){var s=O(i,"stack"),l=s.data[0].imageIds.length;Ne(s.data[0].imageIds[0],t,n,o,l,r,a),Oe(i,n)}},labelmap3DByFirstImageId:Ne,incrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"increase")},decrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"decrease")},activeSegmentIndex:function(e,t){var n=I(e);if(n){var o=O(n,"stack").data[0].imageIds[0],r=j.series[o];if(r){var a=r.activeLabelmapIndex,i=r.labelmaps3D[a],s=xt("segmentation").configuration;t<=0?t=1:t>s.segmentsPerLabelmap&&(t=s.segmentsPerLabelmap),i.activeSegmentIndex=t}}},toggleSegmentVisibility:function(e,t,n){if(t){var o=I(e);if(o){var r=O(o,"stack").data[0].imageIds[0],a=j.series[r];if(a){if(n=void 0===n?a.activeLabelmapIndex:n,a.labelmaps3D[n]){var i=a.labelmaps3D[n].segmentsHidden;return i[t]=!i[t],!i[t]}q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},updateSegmentsOnLabelmap2D:function(e){e.segmentsOnLabelmap=$(e.pixelData)},deleteSegment:function(e,t,n){if(t){var o=I(e);if(o){var r=O(o,"stack").data[0].imageIds[0],a=j.series[r];if(a){n=void 0===n?a.activeLabelmapIndex:n;var i=a.labelmaps3D[n];if(i){delete i.metadata[t];for(var s=i.labelmaps2D,l=0;l<s.length;l++){var c=s[l];if(c&&c.segmentsOnLabelmap.includes(t)){var u=c.pixelData,d=c.segmentsOnLabelmap.indexOf(t);c.segmentsOnLabelmap.splice(d,1);for(var f=0;f<u.length;f++)u[f]===t&&(u[f]=0)}}y.cornerstone.updateImage(o)}}}}},colorLUT:Xe,colorLUTIndexForLabelmap3D:function(e,t){e.colorLUTIndex=t},colorForSegmentIndexOfColorLUT:function(e,t,n){Ke(e)[t]=n},activeLabelmapIndex:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=I(e);if(n){var o=y.cornerstone,r=O(n,"stack").data[0],a=o.getEnabledElement(n).image,i=a.rows*a.columns*r.imageIds.length,s=r.imageIds[0],l=j.series[s];l?(l.activeLabelmapIndex=t,l.labelmaps3D[t]||A(l,t,i)):(j.series[s]={activeLabelmapIndex:t,labelmaps3D:[]},A(l=j.series[s],t,i)),o.updateImage(n)}},radius:function(e){var t=xt("segmentation").configuration;t.radius=Math.min(Math.max(e,t.minRadius),t.maxRadius)},pushState:function(e,t,n){var o=Y(e,n);o.undo.push(t),o.redo=[]},undo:function(e,t){var n=Y(e,t),o=n.undo,r=n.redo;if(o.length){var a=o.pop();st(n,a,1),r.push(a),y.cornerstone.updateImage(e)}else it.warn("No undos left.")},redo:function(e,t){var n=Y(e,t),o=n.undo,r=n.redo;if(r.length){var a=r.pop();st(n,a,2),o.push(a),y.cornerstone.updateImage(e)}else it.warn("No redos left.")}}},ct={activeManipulators:{}};function ut(e){var t=y.cornerstone.getEnabledElement(e).uuid;delete ct.activeManipulators[t]}function dt(e){var t=ct.activeManipulators,n=t[e];"function"==typeof n&&n(),delete t[e]}function ft(e){ut(e.detail.element)}var ht={setters:{addActiveManipulatorForElement:function(e,t){var n=y.cornerstone.getEnabledElement(e).uuid;ct.activeManipulators[n]=t},removeActiveManipulatorForElement:ut,cancelActiveManipulatorsForElement:function(e){dt(y.cornerstone.getEnabledElement(e).uuid)},cancelActiveManipulators:function(){var e=ct.activeManipulators;Object.keys(e).forEach((function(e){return dt(e)}))}},state:ct,enabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ft),e.addEventListener(t,ft)},removeEnabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ft),ut(e)}},pt={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  '},mt={configuration:pt,getters:{defaultOptions:function(){return pt}},setters:{defaultOptions:function(e){Object.assign(pt,e)}}},gt={configuration:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]}},vt=(U("store:modules:storeLogger"),{globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,preventTextBoxOutsideDisplayedArea:!1,handleTouchOffset:{x:0,y:-57},svgCursorUrl:null}),yt={mouseTools:function(){return vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Mouse")}))},touchTools:function(){return vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Touch")}))},enabledElementByUID:function(e){return vt.enabledElements.find((function(t){return y.cornerstone.getEnabledElement(t).uuid===e}))}},bt={segmentation:lt,cursor:mt,globalConfiguration:gt,manipulatorState:ht};function xt(e){return bt[e]}var wt={modules:bt,state:vt,getters:yt},Tt=function(e,t){return vt.tools.find((function(n){return n.element===e&&n.name===t}))},It=bt.globalConfiguration;function Et(e,t){if(It.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),o=t.mousePoint,r=window.URL.createObjectURL(n);e.style.cursor="url('".concat(r,"') ").concat(o,", auto"),vt.svgCursorUrl=r}}function St(e){It.configuration.showSVGCursors&&Ct(e,"none")}function Ct(e,t){vt.svgCursorUrl&&window.URL.revokeObjectURL(vt.svgCursorUrl),vt.svgCursorUrl=null,e.style.cursor=t}var At=xt("globalConfiguration"),Mt=U("store:setToolMode"),Pt=function(e,t,n,o){void 0===o&&Array.isArray(n)&&(o=n,n=null);var r=Tt(e,t);r&&(function(e,t,n,o){t.supportedInteractionTypes.forEach((function(r){if(void 0===o||o.includes(r)){var a=jt[r];a?a(t,e,n):Mt.warn("Unable to resolve input conflicts for type %s",r)}})),wt.state.tools.filter((function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0})).forEach((function(t){var n=!1;t.supportedInteractionTypes.forEach((function(e){t.options["is".concat(e,"Active")]&&(n=!0)})),n||(Mt.log("Setting tool %s's to PASSIVE",t.name),_t(e,t.name))}))}(e,r,n,o),r.supportedInteractionTypes.forEach((function(e){void 0===o||o.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),At.configuration.showSVGCursors&&r.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){("number"==typeof t?[t]:t.mouseButtonMask).includes(1)&&(n.svgCursor?Et(n.element,n.svgCursor):n.hideDefaultCursor?St(e):function(e){Ct(e,"initial")}(e))}(e,n,r)),Bt("active",null,e,t,n)},Dt=function(e,t,n){Ft("active",e,t,n),wt.state.enabledElements.forEach((function(o){Pt(o,e,t,n)}))},Lt=Bt.bind(null,"disabled",null),Ot=Ut.bind(null,"disabled",null),kt=Bt.bind(null,"enabled",null),Rt=Ut.bind(null,"enabled",null),_t=Bt.bind(null,"passive",w.TOOL_DEACTIVATED),Nt=Ut.bind(null,"passive",w.TOOL_DEACTIVATED);function Bt(e,t,n,o,r){var a,i,s=Tt(n,o);s?(r=Ht(r),Array.isArray(r.mouseButtonMask)&&0!==r.mouseButtonMask.length&&Array.isArray(s.options.mouseButtonMask)&&(r.mouseButtonMask=(a=r.mouseButtonMask,i=s.options.mouseButtonMask,a.concat(i).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]))),s.mode=e,s.mergeOptions(r),s["".concat(e,"Callback")]&&s["".concat(e,"Callback")](n,r),t&&T(n,t,{options:r,toolName:o,toolType:o,type:t})):Mt.warn('Unable to find tool "%s" for enabledElement',o)}function Ut(e,t,n,o){Ft(e,n,o),wt.state.enabledElements.forEach((function(r){Bt(e,t,r,n,o)}))}function Vt(e,t,n){var o="is".concat(e,"Active"),r=wt.state.tools.find((function(e){return e.element===n&&"active"===e.mode&&!0===e.options[o]}));r&&(Mt.log("Setting tool %s's %s to false",r.name,o),r.options[o]=!1)}function Ft(e,t,n,o){if(At.configuration.globalToolSyncEnabled){var r={mode:e,args:[t,n]};o&&r.push(o),wt.state.globalToolChangeHistory.push(r),wt.state.globalToolChangeHistory.length>50&&wt.state.globalToolChangeHistory.shift();var a=wt.state.globalTools[t];if(a)if("active"===e){var i=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var o=[],r=wt.state.globalTools[e];if(r){var a=new r.tool(r.props);a.supportedInteractionTypes.forEach((function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var r=Ht(t).mouseButtonMask;Array.isArray(r)&&r.length>0?r.forEach((function(t){return o.push("".concat(e,"-").concat(t))})):Array.isArray(r)&&0===r.length&&o.push("".concat(e,"-DELETE"))}else"MultiTouch"===e?o.push("".concat(e,"-").concat(a.configuration.touchPointers)):o.push(e)}))}return o}(t,n,o);Object.keys(wt.state.globalTools).forEach((function(e){var t=wt.state.globalTools[e];t.activeBindings=t.activeBindings.filter((function(e){return!i.includes(e)}))})),i.some((function(e){return e.includes("Mouse-DELETE")}))&&(a.activeBindings=a.activeBindings.filter((function(e){return!e.includes("Mouse")})),i=i.filter((function(e){return!e.includes("Mouse")}))),a.activeBindings=a.activeBindings.concat(i)}else a.activeBindings=[];else Mt.warn("setToolMode call for tool not available globally: ".concat(t))}}var jt={Mouse:function(e,t,n){var o=Ht(n).mouseButtonMask;if(Array.isArray(o)&&o.length>0){var r=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some((function(e){return o.includes(e)}))}));r&&(r.options.mouseButtonMask=r.options.mouseButtonMask.filter((function(e){return!o.includes(e)})),0===r.options.mouseButtonMask.length&&(r.options.isMouseActive=!1))}},MouseWheel:Vt.bind(void 0,"MouseWheel"),Touch:function(e,t){var n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),o=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers}));n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1),o&&(Mt.log("Setting tool %s's isTouchActive to false",o.name),o.options.isMultiTouchActive=!1)},TouchPinch:Vt.bind(void 0,"TouchPinch"),TouchRotate:Vt.bind(void 0,"TouchRotate"),DoubleTap:Vt.bind(void 0,"DoubleTap"),MultiTouch:function(e,t){var n,o=wt.state.tools.find((function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers}));1===e.configuration.touchPointers&&(n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}))),o&&(Mt.log("Setting tool %s's isMultiTouchActive to false",o.name),o.options.isMultiTouchActive=!1),n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1)}};function Ht(e){return Array.isArray(e)?e={mouseButtonMask:e}:e!==Object(e)&&(e={mouseButtonMask:[e]}),e.hasOwnProperty("mouseButtonMask")||(e.mouseButtonMask=[]),Array.isArray(e.mouseButtonMask)||(e.mouseButtonMask=[e.mouseButtonMask]),e.mouseButtonMask=e.mouseButtonMask.filter((function(e){return"number"==typeof e&&0!==e})),e}var zt={passiveCallback:function(e){Lt(e,this.name)},enabledCallback:function(e){Pt(e,this.name)}},qt={passiveCallback:function(e){Lt(e,this.name)},activeCallback:function(e){kt(e,this.name)}},Wt=function(e,t){e.save(),t(e),e.restore()},Gt=1,Yt=2,Zt={setToolWidth:function(e){Gt=e},getToolWidth:function(){return Gt},setActiveWidth:function(e){Yt=e},getActiveWidth:function(){return Yt}},Xt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=t.color,r=t.lineWidth,a=t.fillStyle,i=t.lineDash,s=t.shouldDrawLines,l=void 0===s||s;e.beginPath(),e.strokeStyle=o||e.strokeStyle,e.lineWidth=r||void 0===r&&Zt.getToolWidth()||e.lineWidth,i&&e.setLineDash(i),n(e),a&&(e.fillStyle=a,e.fill()),l&&e.stroke(),i&&e.setLineDash([])};function Kt(e,t,n,o,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Xt(e,r,(function(e){"pixel"===a&&(n=y.cornerstone.pixelToCanvas(t,n),o=y.cornerstone.pixelToCanvas(t,o)),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y)}))}var Qt=function(e,t,n,o,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Xt(e,r,(function(e){"pixel"===a&&(n=y.cornerstone.pixelToCanvas(t,n),o=o.map((function(e){return y.cornerstone.pixelToCanvas(t,e)}))),e.moveTo(n.x,n.y),o.forEach((function(t){var n=t.x,o=t.y;e.lineTo(n,o)}))}))},Jt=function(e,t,n,o,r,a){var i=Math.atan2(n.y-t.y,n.x-t.x),s={color:o,lineWidth:r};a&&(s.lineDash=a),Kt(e,void 0,t,n,s,"canvas"),s={color:o,lineWidth:r,fillStyle:o};var l=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];Qt(e,void 0,n,l,s,"canvas")},$t=function(e,t,n,o,r){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n)),Xt(e,r,(function(e){e.arc(n.x,n.y,o,0,2*Math.PI)}))};function en(e){var t=y.cornerstoneMath;if(e instanceof t.Vector3)return e;var n=Object.keys(e);return n.includes("x")&&n.includes("y")&&n.includes("z")?new t.Vector3(e.x,e.y,e.z):new t.Vector3(e[0],e[1],e[2])}function tn(e,t){var n=en(t.rowCosines),o=en(t.columnCosines),r=en(t.imagePositionPatient),a=e.clone().sub(r);return{x:n.dot(a)/t.columnPixelSpacing,y:o.dot(a)/t.rowPixelSpacing}}function nn(e,t){var n=en(t.rowCosines),o=en(t.columnCosines),r=en(t.imagePositionPatient),a=n.clone().multiplyScalar(e.x);a.multiplyScalar(t.columnPixelSpacing);var i=o.clone().multiplyScalar(e.y);i.multiplyScalar(t.rowPixelSpacing);var s=a.add(i);return s.add(r),s}function on(e,t){var n=en(e.rowCosines),o=en(e.columnCosines),r=en(e.imagePositionPatient),a=en(t.rowCosines),i=en(t.columnCosines),s=en(t.imagePositionPatient),l=n.clone().cross(o),c=new y.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,r);var u=a.clone().cross(i),d=new y.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var f=d.clone().intersectPlane(c),h=f.origin,p=f.direction,m=nn({x:t.columns,y:t.rows},t),g=s.distanceTo(m),v=new y.cornerstoneMath.Line3;v.start=h,v.end=h.clone().add(p.multiplyScalar(g));var b=function(e,t){var n=[];return Object.keys(t).forEach((function(o){var r=t[o],a=e.intersectLine(r);a&&n.push(a)})),n}(v,function(e){var t=nn({x:0,y:0},e),n=nn({x:e.columns,y:0},e),o=nn({x:0,y:e.rows},e),r=nn({x:e.columns,y:e.rows},e);return{top:new y.cornerstoneMath.Line3(t,n),left:new y.cornerstoneMath.Line3(t,o),right:new y.cornerstoneMath.Line3(n,r),bottom:new y.cornerstoneMath.Line3(o,r)}}(t));if(2===b.length)return{start:b[0],end:b[1]}}function rn(e,t,n){var o=n*(Math.PI/180);return{x:Math.cos(o)*(e.x-t.x)-Math.sin(o)*(e.y-t.y)+t.x,y:Math.sin(o)*(e.x-t.x)+Math.cos(o)*(e.y-t.y)+t.y}}var an=function(e,t,n,o,r){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n),o=y.cornerstone.pixelToCanvas(t,o));var i=y.cornerstone.getViewport(t),s=t.clientWidth,l=t.clientHeight,c=i.scale,u=i.translation,d=i.rotation-a,f={x:s/2+u.x*c,y:l/2+u.y*c};Math.abs(d)>.05&&(n=rn(n,f,-d),o=rn(o,f,-d));var h=Math.abs(n.x-o.x),p=Math.abs(n.y-o.y),m=Math.min(n.x,o.x),g=Math.min(n.y,o.y),v={x:m+h/2,y:g+p/2};Math.abs(d)>.05&&(v=rn(v,f,d));var b=d*Math.PI/180;Xt(e,r,(function(e){e.ellipse(v.x,v.y,h/2,p/2,b,0,2*Math.PI),e.closePath()}))},sn="white",ln="greenyellow",cn="transparent",un={setFillColor:function(e){cn=e},getFillColor:function(){return cn},setToolColor:function(e){sn=e},getToolColor:function(){return sn},setActiveColor:function(e){ln=e},getActiveColor:function(){return ln},getColorIfActive:function(e){return e.color?e.color:e.active?ln:sn}},dn=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=t.element,a=un.getToolColor();e.strokeStyle=o.color||a;for(var i=Object.keys(n),s=function(t){var a=i[t],s=n[a];if(!0===s.drawnIndependently)return"continue";if(!0===o.drawHandlesIfActive&&!s.active)return"continue";if(o.hideHandlesIfMoving&&s.moving)return"continue";var l={lineWidth:s.active?Zt.getActiveWidth():Zt.getToolWidth(),fillStyle:o.fill};o.lineDash&&(l.lineDash=o.lineDash),Xt(e,l,(function(e){var t=y.cornerstone.pixelToCanvas(r,s),n=s.radius||o.handleRadius||vt.handleRadius;e.arc(t.x,t.y,n,0,2*Math.PI)}))},l=0;l<i.length;l++)s(l)},fn=function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";Xt(e,o,(function(e){n.forEach((function(n){var o=n.start,a=n.end;if("pixel"===r){var i=y.cornerstone;o=i.pixelToCanvas(t,o),a=i.pixelToCanvas(t,a)}e.moveTo(o.x,o.y),e.lineTo(a.x,a.y)}))}))},hn=function(e,t,n,o,r,a){var i=e.length>0?y.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Kt(o,void 0,i,y.cornerstoneMath.point.findClosestPoint(s,i),{color:r,lineWidth:a,lineDash:[2,3]},"canvas")},pn={fontSize:15,fontFamily:"Arial",backgroundColor:"transparent"};function mn(e){if("string"!=typeof e)throw new Error("Font family must be a valid string");pn.fontFamily=e}function gn(e){if("number"!=typeof e||isNaN(e)||!isFinite(e))throw new Error("Font size must be a valid number");pn.fontSize=parseFloat(e)}var vn={setFont:function(e){var t=e.split("px ");2===t.length&&(gn(parseFloat(t[0])),mn(t[1]))},getFont:function(){return"".concat(pn.fontSize,"px ").concat(pn.fontFamily)},setFontSize:gn,getFontSize:function(){return pn.fontSize},setFontFamily:mn,getFontFamily:function(){return pn.fontFamily},setBackgroundColor:function(e){pn.backgroundColor=e},getBackgroundColor:function(){return pn.backgroundColor}},yn=function(e,t,n,o,r){var a=vn.getFontSize();e.font=vn.getFont(),e.textBaseline="top",e.fillStyle=o,n.forEach((function(n,o){e.fillText(n,t.left+r,t.top+r+o*(a+r))}))},bn=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)};function xn(e,t,n){var o=vn.getFont(),r=e.font;o&&o!==r&&(e.font=o);var a=e.measureText(t).width;return o&&o!==r&&(e.font=r),a+2*n}var wn=function(e,t,n,o,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=5,s=vn.getFontSize(),l=vn.getBackgroundColor(),c=0;t.forEach((function(t){var n=xn(e,t,i);c=Math.max(c,n)}));var u={width:c,height:i+t.length*(s+i)};return Wt(e,(function(e){e.strokeStyle=r,a.centering&&(!0===a.centering.x&&(n-=u.width/2),!0===a.centering.y&&(o-=u.height/2)),u.left=n,u.top=o,"function"==typeof a.displacer&&a.displacer(u),bn(e,u,l),yn(e,u,t,r,i)})),u};function Tn(e,t,n){return Math.min(Math.max(t,e),n)}function In(e,t){var n=t.left||0,o=t.top||0;e.x=Tn(e.x,n,n+t.width),e.y=Tn(e.y,o,o+t.height)}var En=function(e,t,n,o,r,a){a-r<o-n?(e[t]+=r-n,e[t]+=(a-r)/2,e[t]-=(o-n)/2):n<r?e[t]+=r-n:o>a&&(e[t]-=o-a)};function Sn(e,t){var n=y.cornerstone,o=n.pixelToCanvas,r=n.canvasToPixel,a=n.getViewport,i=n.getEnabledElement,s=n.getDisplayedArea,l=r(e,{x:t.left,y:t.top}),c=function(e,t){var n=function(t){return y.cornerstone.canvasToPixel(e,t)},o=t.top,r=t.left,a=t.width,i=t.height,s=[n({x:r,y:o}),n({x:r+a,y:o}),n({x:r,y:o+i}),n({x:r+a,y:o+i})],l=s.map((function(e){return e.x})),c=s.map((function(e){return e.y}));return{minX:Math.min.apply(Math,J()(l)),minY:Math.min.apply(Math,J()(c)),maxX:Math.max.apply(Math,J()(l)),maxY:Math.max.apply(Math,J()(c))}}(e,t),u=c.minX,d=c.minY,f=c.maxX,h=c.maxY,p=a(e),m=s(i(e).image,p),g=p.displayedArea?p.displayedArea:m,v=g.tlhc,b=g.brhc,x=v.y-1,w=v.x-1,T=b.y,I=b.x;En(l,"y",d,h,x,T),En(l,"x",u,f,w,I);var E=o(e,l);t.top=E.y,t.left=E.x}var Cn=Tn,An=function(e,t,n,o,r,a,i,s,l,c){var u=y.cornerstone.pixelToCanvas,d=u(t,n);l&&(d.x+=l);var f={centering:{x:!1,y:c}};if(vt.preventTextBoxOutsideDisplayedArea&&(f.displacer=function(e){return Sn(t,e)}),n.boundingBox=wn(e,o,d.x,d.y,i,f),n.hasMoved){var h=a(r).map((function(e){return u(t,e)}));hn(h,d,n.boundingBox,e,i,s)}},Mn=function(e,t,n,o,r){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=y.cornerstone;n=i.pixelToCanvas(t,n),o=i.pixelToCanvas(t,o)}var s=y.cornerstone.getViewport(t),l=t.clientWidth,c=t.clientHeight,u=s.scale,d=s.translation,f=s.rotation-a,h={x:l/2+d.x*u,y:c/2+d.y*u};Math.abs(f)>.05&&(n=rn(n,h,-f),o=rn(o,h,-f));var p=Math.abs(n.x-o.x),m=Math.abs(n.y-o.y);n={x:Math.min(n.x,o.x),y:Math.min(n.y,o.y)},o={x:n.x+p,y:n.y+m};var g={x:n.x+p,y:n.y},v={x:n.x,y:n.y+m};Math.abs(f)>.05&&(n=rn(n,h,f),o=rn(o,h,f),g=rn(g,h,f),v=rn(v,h,f)),Xt(e,r,(function(e){e.moveTo(n.x,n.y),e.lineTo(g.x,g.y),e.lineTo(o.x,o.y),e.lineTo(v.x,v.y),e.lineTo(n.x,n.y)}))},Pn=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},Dn=function(e,t){return void 0===e?t:e},Ln=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Dn(t.shadowColor,"#000000"),e.shadowBlur=Dn(t.shadowBlur,0),e.shadowOffsetX=Dn(t.shadowOffsetX,1),e.shadowOffsetY=Dn(t.shadowOffsetY,1))},On=function(e){return 0===Object.keys(e).length&&e.constructor===Object},kn=xt("segmentation"),Rn=kn.getters,_n=kn.setters;function Nn(){this.handles={start:{},end:{}}}function Bn(e){var t=e.detail.element,n=e.detail.currentPoints.image;return On(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function Un(e){var t=e.detail,n=t.element,o=t.currentPoints.image;this.handles.end=o,y.cornerstone.updateImage(n)}function Vn(e){e.detail.handles=this.handles;var t=e.detail.element,n=Rn.labelmap2D(t),o=n.labelmap2D,r=n.labelmap3D,a=n.currentImageIdIndex,i=o.pixelData,s=i.slice(),l={points:{start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},pixelData:i,segmentIndex:r.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:a,diff:ke(s,i)};_n.pushState(this.element,[c]),_n.updateSegmentsOnLabelmap2D(o),y.cornerstone.updateImage(t),this._resetHandles()}var Fn={postTouchStartCallback:Bn,postMouseDownCallback:Bn,mouseClickCallback:Bn,touchDragCallback:Un,mouseDragCallback:Un,mouseMoveCallback:Un,touchEndCallback:Vn,mouseUpCallback:Vn,initializeMixin:Nn,renderToolData:function(e){var t=this,n=e.detail,o=n.element,r=Rn.brushColor(o,!0),a=Pn(n.canvasContext.canvas),i=y.cornerstoneMath.point.distance;Wt(a,(function(e){if(!t.handles)return null;var n=y.cornerstone.pixelToCanvas(o,t.handles.start),a=y.cornerstone.pixelToCanvas(o,t.handles.end),s=i(n,a);$t(e,o,t.handles.start,s,{color:r})}))},_resetHandles:Nn,_applyStrategy:Vn},jn=U("tools:ScissorsTool"),Hn=xt("segmentation"),zn=Hn.getters,qn=Hn.setters;function Wn(e){var t=e.detail.element,n=e.detail.currentPoints.image,o=this.handles.points;if(!o.length)return jn.warn("Something went wrong, empty handles detected."),null;o.push({x:n.x,y:n.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(t)}function Gn(e){var t=e.detail,n=e.detail.element;this._addPoint(t),y.cornerstone.updateImage(n)}function Yn(e){var t=this.handles.points,n=e.detail.element,o=zn.labelmap2D(n),r=o.labelmap2D,a=o.labelmap3D,i=o.currentImageIdIndex,s=r.pixelData,l=s.slice(),c={points:t,pixelData:s,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"};this.applyActiveStrategy(e,c);var u={imageIdIndex:i,diff:ke(l,s)};qn.pushState(this.element,[u]),qn.updateSegmentsOnLabelmap2D(r),y.cornerstone.updateImage(n),this._resetHandles()}function Zn(){this.handles={points:[]},this.currentHandle=0}var Xn={postTouchStartCallback:Wn,postMouseDownCallback:Wn,mouseClickCallback:Wn,touchDragCallback:Gn,mouseDragCallback:Gn,mouseMoveCallback:Gn,touchEndCallback:Yn,mouseUpCallback:Yn,initializeMixin:Zn,renderToolData:function(e){var t=e.detail,n=t.element,o=zn.brushColor(n,!0),r=Pn(t.canvasContext.canvas),a=this.handles.points;a.length<2||Wt(r,(function(e){for(var t=0;t<a.length;t++){var r=J()(a[t].lines);t===a.length-1&&r.push(a[0]),Qt(e,n,a[t],r,{color:o})}}))},_resetHandles:Zn,_addPoint:function(e){var t=this.handles.points;t.length&&t[this.currentHandle-1].lines.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),t.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(e.element)},_applyStrategy:Yn},Kn=xt("segmentation").getters,Qn=Object.assign({},Xn,{renderToolData:function(e){var t=this,n=e.detail,o=n.element,r=Kn.brushColor(o,!0),a=Pn(n.canvasContext.canvas),i=this.handles;Wt(a,(function(e){if(i.points.length>1)for(var n=0;n<i.points.length;n++){var a=J()(i.points[n].lines);Qt(e,o,t.handles.points[n],a,{color:r})}}))}}),Jn=xt("segmentation"),$n=Jn.getters,eo=Jn.setters;function to(e){var t=e.detail.element,n=e.detail.currentPoints.image;return On(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function no(e){var t=e.detail,n=t.element,o=t.currentPoints.image;this.handles.end=o,y.cornerstone.updateImage(n)}function oo(e){e.detail.handles=this.handles;var t=e.detail.element,n=$n.labelmap2D(t),o=n.labelmap2D,r=n.labelmap3D,a=n.currentImageIdIndex,i=o.pixelData,s=i.slice(),l={points:[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],pixelData:i,segmentIndex:r.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:a,diff:ke(s,i)};eo.pushState(this.element,[c]),eo.updateSegmentsOnLabelmap2D(o),y.cornerstone.updateImage(t),this._resetHandles()}function ro(){this.handles={start:{},end:{}}}var ao={activeOrDisabledBinaryTool:zt,enabledOrDisabledBinaryTool:qt,circleSegmentationMixin:Fn,polylineSegmentationMixin:Qn,freehandSegmentationMixin:Xn,rectangleSegmentationMixin:{postTouchStartCallback:to,postMouseDownCallback:to,mouseClickCallback:to,touchDragCallback:no,mouseDragCallback:no,mouseMoveCallback:no,touchEndCallback:oo,mouseUpCallback:oo,initializeMixin:ro,renderToolData:function(e){var t=this,n=e.detail,o=n.element,r=$n.brushColor(o,!0),a=Pn(n.canvasContext.canvas);Wt(a,(function(e){Mn(e,o,t.handles.start,t.handles.end,{color:r})}))},_resetHandles:ro,_applyStrategy:oo},renderBrushMixin:{renderBrush:function(e){var t,n=y.cornerstone,o=xt("segmentation"),r=o.getters,a=o.configuration,i=e.detail,s=i.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=wt.state.mousePositionImage,t){var l=i.image,c=l.rows,u=l.columns,d=t,f=d.x,h=d.y;if(!(f<0||f>u||h<0||h>c)){var p=a.radius,m=i.canvasContext,g=i.element,v=r.brushColor(g,this._drawing);m.setTransform(1,0,0,1,0,0);var b=p*s.scale,x=n.pixelToCanvas(g,t);m.beginPath(),m.strokeStyle=v,m.ellipse(x.x,x.y,b,b,0,0,2*Math.PI),m.stroke()}}}}},io=function(e){return e&&"object"===x()(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},so=function(e,t){var n;return t&&!0===t.clone&&io(e)?uo((n=e,Array.isArray(n)?[]:{}),e,t):e},lo=function(e,t,n){var o=e.slice();return t.forEach((function(t,r){void 0===o[r]?o[r]=so(t,n):io(t)?o[r]=uo(e[r],t,n):-1===e.indexOf(t)&&o.push(so(t,n))})),o},co=function(e,t,n){var o={};return io(e)&&Object.keys(e).forEach((function(t){o[t]=so(e[t],n)})),Object.keys(t).forEach((function(r){io(t[r])&&e[r]?o[r]=uo(e[r],t[r],n):o[r]=so(t[r],n)})),o},uo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=Array.isArray(t),r=(n||{arrayMerge:lo}).arrayMerge||lo;if(o)return Array.isArray(e)?r(e,t,n):so(t,n);var a=co(e,t,n);return Object.getPrototypeOf(e)!==Object.prototype&&Object.setPrototypeOf(a,Object.getPrototypeOf(e)),a},fo=uo,ho=U("tools:base:BaseTool"),po=xt("globalConfiguration"),mo=function(){function e(t,n){i()(this,e),this.initialConfiguration=fo(n,t);var o=this.initialConfiguration,r=o.name,a=o.strategies,s=o.defaultStrategy,l=o.configuration,c=o.supportedInteractionTypes,u=o.mixins,d=o.svgCursor;this.name=r,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=c||[],this.strategies=a||{},this.defaultStrategy=s||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,d&&(this.svgCursor=d),this._options={},this._configuration=Object.assign({},l),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,u&&u.length&&this._applyMixins(u),this._cursors=Object.assign({},this.initialConfiguration.cursors);var f=this.defaultStrategy&&this._cursors[this.activeStrategy];f&&(this.svgCursor=f)}return l()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=ao["".concat(e[t])];"object"===x()(n)?(Object.assign(this,n),"function"==typeof this.initializeMixin&&this.initializeMixin()):ho.warn("".concat(this.name,": mixin ").concat(ao[t]," does not exist."))}"function"===this.initializeMixin&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(e){this.activeStrategy=e,po.configuration.showSVGCursors&&this.changeCursor(this.element,e)}},{key:"changeCursor",value:function(e,t){if(e){var n=this._cursors[t];n&&(this.svgCursor=n,"active"===this.mode&&Et(e,n))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}(),go=function(e,t){if(e.boundingBox)return y.cornerstoneMath.point.insideRect(t,e.boundingBox)},vo=function(e,t,n,o){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(go(e,n))return!0}else{var r=y.cornerstone.pixelToCanvas(t,e);if(y.cornerstoneMath.point.distance(r,n)<=o)return!0}return!1},yo=function e(t,n,o,r){var a;if(n){if(Array.isArray(n))for(var i=Object.keys(n),s=0;s<i.length;s++){var l=n[i[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&vo(l,t,o,r)){a=l;break}}else if("object"===x()(n))for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];if(Array.isArray(n[d])){if(a=e(t,n[d],o,r))break}else{var f=n[d];if(vo(f,t,o,r)){a=f;break}}}return a}},bo=function(e,t,n,o){o||(o=6);var r=function(e){var t;return Object.keys(e).forEach((function(n){var o=e[n];!0!==o.active||(t=o)})),t}(t),a=yo(e,t,n,o);return r!==a&&(void 0!==a&&(a.active=!0),void 0!==r&&(r.active=!1),!0)},xo=n(9),wo=n.n(xo),To=function(e,t){var n=e.image,o={left:0,top:0,width:n.width,height:n.height},r=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===y.cornerstoneMath.point.insideRect(n,o)&&(r=!0)})),r},Io=function(e,t){var n=e.currentPoints,o=e.element,r=n.page,a=vt.handleTouchOffset,i=0,s=0;return"touch"===t&&(i=a.x,s=a.y),y.cornerstone.pageToPixel(o,r.x+i,r.y+s)},Eo=function(e,t,n){return t.filter((function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])}))},So=n(5),Co=n.n(So),Ao=function(e,t){return"active"===Tt(e,t).mode},Mo=xt("segmentation"),Po=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,t),o.configuration||(o.configuration={alwaysEraseOnClick:!1}),(n=u()(this,f()(t).call(this,e,o))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(Co()(n)),n}return p()(t,e),l()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image,this._drawing&&this._paint(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=t.element,o=t.currentPoints;return this._startPainting(e),this._lastImageCoords=o.image,this._drawing=!0,this._startListeningForMouseUp(n),this._paint(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element,o=Mo.configuration,r=Mo.getters.labelmap2D(n),a=r.labelmap2D,i=r.labelmap3D,s=r.currentImageIdIndex,l=r.activeLabelmapIndex,c=this._isCtrlDown(t)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:a,labelmap3D:i,currentImageIdIndex:s,activeLabelmapIndex:l,shouldErase:c},o.storeHistory){var u=a.pixelData.slice();this.paintEventData.previousPixelData=u}}},{key:"_endPainting",value:function(e){for(var t=Mo.configuration,n=Mo.setters,o=this.paintEventData,r=o.labelmap2D,a=o.currentImageIdIndex,i=new Set(r.pixelData).values(),s=[],l=!1;!l;){var c=i.next();(l=c.done)||s.push(c.value)}if(r.segmentsOnLabelmap=s,t.storeHistory){var u={imageIdIndex:a,diff:ke(this.paintEventData.previousPixelData,r.pixelData)};n.pushState(this.element,[u])}Oe(this.element)}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image}},{key:"renderToolData",value:function(e){var t=e.detail.element;Ao(t,this.name)&&this.renderBrush(e)}},{key:"passiveCallback",value:function(e){try{y.cornerstone.updateImage(this.element)}catch(e){return}}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._endPainting(e),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"newImageCallback",value:function(e){this._drawing&&(this._endPainting(e),this._startPainting(e))}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"increaseBrushSize",value:function(){var e=Mo.configuration,t=Mo.setters,n=e.radius,o=Math.floor(1.2*n);o===n&&(o+=1),t.radius(o)}},{key:"decreaseBrushSize",value:function(){var e=Mo.configuration,t=Mo.setters,n=e.radius,o=Math.floor(.8*n);t.radius(o)}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(mo),Do=function(e){return e.filter((function(e){return!(e.isMultiPartTool||e instanceof mr||e instanceof Po)}))};function Lo(e,t){var n;if("touch"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")?n=(n=Eo(e,yt.touchTools())).filter((function(e){return e.options.isTouchActive})):(n=(n=Eo(e,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&t&&e.options.mouseButtonMask.includes(t)&&e.options.isMouseActive})),vt.isMultiPartToolActive&&(n=Do(n))),0!==n.length)return n[0]}var Oo=U("manipulators:moveAllHandles"),ko=xt("manipulatorState"),Ro={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},_o={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},No=function(e,t,n,o){var r=e.element,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},a);var l=Bo.bind(this,t,n,a,i),c=function e(o){Vo(t,n,a,i,{dragHandler:l,upOrEndHandler:e},o,s)};ko.setters.addActiveManipulatorForElement(r,Uo.bind(null,n,a,i,{dragHandler:l,upOrEndHandler:c},r,s)),n.active=!0,vt.isToolLocked=!0,Ro[i].forEach((function(e){r.addEventListener(e,l)})),_o[i].forEach((function(e){r.addEventListener(e,c)}))};function Bo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=r.detail,i=a.element,s=a.image,l=a.buttons,c=r.detail.deltaPoints.image,u=c.x,d=c.y;t.active=!0,t.invalidated=!0;for(var f=Object.keys(t.handles),h=0;h<f.length;h++){var p=f[h],m=t.handles[p];!0!==m.movesIndependently&&m.hasOwnProperty("x")&&m.hasOwnProperty("y")&&(m.x+=u,m.y+=d,n.preventHandleOutsideImage&&In(m,s))}y.cornerstone.updateImage(i);var g=Lo(i,l,o);g instanceof mr&&g.updateCachedStats(s,i,t),T(i,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:i,measurementData:t}),r.preventDefault(),r.stopPropagation()}function Uo(e){var t=arguments.length>3?arguments[3]:void 0;Fo(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,{dragHandler:t.dragHandler,upOrEndHandler:t.upOrEndHandler},arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,!1)}function Vo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=r.dragHandler,i=r.upOrEndHandler,s=arguments.length>6?arguments[6]:void 0,l=(arguments.length>5?arguments[5]:void 0).detail,c=l.element;ko.setters.removeActiveManipulatorForElement(c),n.deleteIfHandleOutsideImage&&To(l,t.handles)&&k(c,e,t),Fo(t,n,o,{dragHandler:a,upOrEndHandler:i},c,s,!0)}function Fo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,r=o.dragHandler,a=o.upOrEndHandler,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.active=!1,e.invalidated=!0,vt.isToolLocked=!1,Ro[n].forEach((function(e){i.removeEventListener(e,r)})),_o[n].forEach((function(e){i.removeEventListener(e,a)})),"function"==typeof t.doneMovingCallback&&(Oo.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(l)),"function"==typeof s&&s(l),y.cornerstone.updateImage(i)}var jo=U("manipulators:moveHandle"),Ho=xt("manipulatorState"),zo={value:!1},qo={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},Wo={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},Go=function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;r=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},r);var s=e.element,l=Yo.bind(this,t,n,o,r,a),c=function s(){Xo(t,e,n,o,r,a,{dragHandler:l,upOrEndHandler:s},i)};if(Ho.setters.addActiveManipulatorForElement(s,Zo.bind(null,t,e,n,o,r,a,{dragHandler:l,upOrEndHandler:c},i)),o.active=!0,o.moving=!0,n.active=!0,vt.isToolLocked=!0,qo[a].forEach((function(e){s.addEventListener(e,l)})),Wo[a].forEach((function(e){s.addEventListener(e,c)})),"touch"===a){zo.value=!0;var u=y.cornerstone.getEnabledElement(s),d=Io(e,a);Qo(o,zo,u,d)}};function Yo(e,t,n,o,r,a){var i=a.detail,s=i.image,l=i.element,c=i.buttons,u=Io(a.detail,r);zo.value=!1,n.active=!0,n.hasMoved=!0,n.x=u.x,n.y=u.y,t.invalidated=!0,o.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Lo(l,c,r);d instanceof mr&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function Zo(e,t,n,o){var r=arguments.length>6?arguments[6]:void 0;Ko(e,t,n,o,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},arguments.length>5?arguments[5]:void 0,{dragHandler:r.dragHandler,upOrEndHandler:r.upOrEndHandler},arguments.length>7?arguments[7]:void 0,!1)}function Xo(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=t.element;Ho.setters.removeActiveManipulatorForElement(u),Ko(e,t,n,o,r,a,{dragHandler:s,upOrEndHandler:l},c,!0)}function Ko(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],d=t.element;o.active=!1,o.moving=!1,n.active=!1,n.invalidated=!0,zo.value=!1,vt.isToolLocked=!1,qo[a].forEach((function(e){d.removeEventListener(e,s)})),Wo[a].forEach((function(e){d.removeEventListener(e,l)})),r.deleteIfHandleOutsideImage&&To(t,n.handles)&&k(d,e,n),"function"==typeof r.doneMovingCallback&&(jo.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),r.doneMovingCallback(u)),"function"==typeof c&&c(u),y.cornerstone.updateImage(d)}function Qo(e,t,n,o){if(t.value){var r=Math.abs(e.y-o.y),a=r/10;if(r<1)return e.y=o.y,void(t.value=!1);e.y>o.y?e.y-=a:e.y<o.y&&(e.y+=a),y.cornerstone.updateImage(n.element),y.cornerstone.requestAnimationFrame((function(){Qo(e,t,n,o)}))}}var Jo=U("manipulators:moveNewHandle"),$o=xt("manipulatorState"),er={mouse:[w.MOUSE_MOVE,w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},tr={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_PINCH,w.TAP]},nr=function(e,t,n,o,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;(r=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},r)).hasMoved=!1;var s=e.element;function l(e){or(t,n,o,r,a,e)}function c(e){ar(t,n,o,r,a,{moveHandler:l,moveEndHandler:c},e,i)}n.active=!0,o.moving=!0,o.active=!0,vt.isToolLocked=!0,er[a].forEach((function(e){s.addEventListener(e,l)})),s.addEventListener(w.TOUCH_START,sr),tr[a].forEach((function(e){s.addEventListener(e,c)})),$o.setters.addActiveManipulatorForElement(s,ir.bind(null,n,o,r,a,{moveHandler:l,moveEndHandler:c},s,i))};function or(e,t,n,o,r,a){var i=a.detail,s=i.image,l=i.element,c=i.buttons,u=Io(a.detail,r);o.hasMoved=!0,t.invalidated=!0,n.active=!0,n.x=u.x,n.y=u.y,o&&o.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Lo(l,c,r);d instanceof mr&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function rr(e,t,n,o,r){var a=o.moveHandler,i=o.moveEndHandler,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];er[e].forEach((function(e){n.removeEventListener(e,a)})),tr[e].forEach((function(e){n.removeEventListener(e,i)})),n.removeEventListener(w.TOUCH_START,sr),vt.isToolLocked=!1,"function"==typeof r&&r(s),"function"==typeof t.doneMovingCallback&&(Jo.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(s)),y.cornerstone.updateImage(n)}function ar(e,t,n,o,r,a,i,s){var l=a.moveHandler,c=a.moveEndHandler,u=i.detail,d=u.element,f=!0;if(!1!==o.hasMoved){var h=Io(u,r);t.active=!1,t.invalidated=!0,n.active=!1,n.moving=!1,n.x=h.x,n.y=h.y,$o.setters.removeActiveManipulatorForElement(d),o.preventHandleOutsideImage&&In(n,i.detail.image),o.deleteIfHandleOutsideImage&&To(i.detail,t.handles)&&(t.cancelled=!0,f=!1,k(d,e,t)),rr(r,o,d,{moveHandler:l,moveEndHandler:c},s,f)}}function ir(e,t,n,o,r,a,i){var s=r.moveHandler,l=r.moveEndHandler;e.active=!1,e.invalidated=!0,t.active=!1,rr(o,n,a,{moveHandler:s,moveEndHandler:l},i,!1)}function sr(e){return e.stopImmediatePropagation(),!1}function lr(e,t){var n=vt.clickProximity,o=vt.touchProximity,r=vt.tools.find((function(e){return e.name===t}));return r&&r.configuration&&(n=r.configuration.clickProximity||n,o=r.configuration.touchProximity||o),"mouse"===e?n:o}function cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cr(n,!0).forEach((function(t){wo()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cr(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dr=function(e,t,n,o,r){n.active=!0,vt.isToolLocked=!0,Go(e.detail,t.name,n,o,t.options,r,(function(t){var o=e.detail.element,r=n.toolType||n.toolName,a={toolName:r,toolType:r,element:o,measurementData:ur({},n,{active:!1})};T(o,w.MEASUREMENT_COMPLETED,a)})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},fr=function(e,t,n,o){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",a=0;a<t.data.length;a++){var i=t.data[a],s=yo(e,i.handles,o,lr(r,n));if(s)return{handle:s,data:i}}},hr=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";n.active=!0,vt.isToolLocked=!0,No(e.detail,t.name,n,null,t.options,o,(function(){n.active=!1,vt.isToolLocked=!1})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},pr=U("baseAnnotationTool"),mr=function(e){function t(){return i()(this,t),u()(this,f()(t).apply(this,arguments))}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,o=t.currentPoints.canvas,r=O(n,this.name),a=!1,i=0;i<r.data.length;i++){var s=r.data[i];!0===bo(n,s.handles,o)&&(a=!0);var l=this.pointNearTool(n,s,o,"mouse")&&!s.active,c=!this.pointNearTool(n,s,o,"mouse")&&s.active;(l||c)&&(s.active=!s.active,a=!0)}return a}},{key:"handleSelectedCallback",value:function(e,t,n){dr(e,this,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")}},{key:"toolSelectedCallback",value:function(e,t){hr(e,this,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")}},{key:"updateCachedStats",value:function(e,t,n){pr.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),t}(mo),gr=function(e,t,n,o){var r=y.cornerstone,a={start:r.pixelToCanvas(e,t),end:r.pixelToCanvas(e,n)};return y.cornerstoneMath.lineSegment.distanceToPoint(a,o)},vr=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},yr=bt.cursor,br=function(){function e(t,n){i()(this,e),this.iconGroupString=t,this.options=Object.assign({},yr.getters.defaultOptions(),n)}return l()(e,[{key:"getIconSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,o=t.iconSize,r=t.viewBox,a=o/Math.max(r.x,r.y),i=16+o,s='\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 ').concat(i," ").concat(i,'"\n      >\n        <g>\n          ').concat(n,'\n        </g>\n        <g transform="translate(16, 16) scale(').concat(a,')">\n          ').concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,o=t.viewBox,r='\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(n,'" height="').concat(n,'" viewBox="0 0\n        ').concat(o.x," ").concat(o.y,'"\n      >\n        ').concat(this.iconGroupString,"\n      </svg>");return this._injectColors(r,t)}},{key:"_injectColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||un.getActiveColor(),o=t.toolColor||un.getToolColor(),r=t.fillColor||un.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(o)).replace(/FILL_COLOR/g,"".concat(r))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}(),xr=new br('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />',{viewBox:{x:1792,y:1792}}),wr=new br('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',{viewBox:{x:24,y:24}}),Tr=new br('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',{viewBox:{x:48,y:48}}),Ir=new br('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',{viewBox:{x:32,y:32}}),Er=new br('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),Sr=new br('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />',{viewBox:{x:32,y:32}}),Cr=new br('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',{viewBox:{x:18,y:18}}),Ar=new br('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>',{viewBox:{x:18,y:18}}),Mr=new br('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',{viewBox:{x:24,y:24}}),Pr=new br('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />',{viewBox:{x:1792,y:1792}}),Dr=new br('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),Lr=new br('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />',{viewBox:{x:1792,y:1792}}),Or=new br('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />',{viewBox:{x:1792,y:1792}}),kr=new br('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />',{viewBox:{x:2048,y:1792}}),Rr=new br('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />',{viewBox:{x:512,y:512}}),_r=new br('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />',{viewBox:{x:1792,y:1792}}),Nr=new br('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />',{viewBox:{x:1792,y:1792}}),Br=new br('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />',{viewBox:{x:24,y:28}}),Ur=new br('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),Vr=new br('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />',{viewBox:{x:18,y:18}}),Fr=new br('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />',{viewBox:{x:640,y:512}}),jr={x:127,y:60},Hr=function(){return'<rect fill="'.concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR",'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},zr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(e,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},qr='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Wr='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Gr='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Yr=new br("".concat(qr," ").concat(Hr()),{viewBox:jr}),Zr=new br("".concat(qr," ").concat(zr()),{viewBox:jr}),Xr=new br("".concat(qr," ").concat(Hr()),{viewBox:jr}),Kr=new br("".concat(qr," ").concat(zr()),{viewBox:jr}),Qr=new br("".concat(Wr," ").concat(Hr()),{viewBox:jr}),Jr=new br("".concat(Wr," ").concat(zr()),{viewBox:jr}),$r=new br("".concat(Wr," ").concat(Hr()),{viewBox:jr}),ea=new br("".concat(Wr," ").concat(zr()),{viewBox:jr}),ta=new br("".concat(Gr," ").concat(Hr()),{viewBox:jr}),na=new br("".concat(Gr," ").concat(zr()),{viewBox:jr}),oa=new br("".concat(Gr," ").concat(Hr()),{viewBox:jr}),ra=new br("".concat(Gr," ").concat(zr()),{viewBox:jr});function aa(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId);return t?{rowPixelSpacing:t.rowPixelSpacing||t.rowImagePixelSpacing,colPixelSpacing:t.columnPixelSpacing||t.colImagePixelSpacing}:{rowPixelSpacing:e.rowPixelSpacing,colPixelSpacing:e.columnPixelSpacing}}var ia=function(e){var t=x()(e);return null!==e&&("object"===t||"function"===t)},sa=function(e,t,n){var o,r,a,i,s,l,c=0,u=!1,d=!1,f=!0,h=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=o,a=r;return o=r=void 0,c=t,i=e.apply(a,n)}function m(e,t){return h?window.requestAnimationFrame(e):setTimeout(e,t)}function g(e){return c=e,s=m(y,t),u?p(e):i}function v(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=a}function y(){var e=Date.now();if(v(e))return b(e);s=m(y,function(e){var n=e-c,o=t-(e-l);return d?Math.min(o,a-n):o}(e))}function b(e){return s=void 0,f&&o?p(e):(o=r=void 0,i)}function x(){for(var e=Date.now(),n=v(e),a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];if(o=c,r=this,l=e,n){if(void 0===s)return g(l);if(d)return s=m(y,t),p(l)}return void 0===s&&(s=m(y,t)),i}return t=Number(t)||0,ia(n)&&(u=Boolean(n.leading),a=(d="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):a,f="trailing"in n?Boolean(n.trailing):f),x.cancel=function(){void 0!==s&&function(e){if(h)return window.cancelAnimationFrame(e);clearTimeout(e)}(s),c=0,o=l=r=s=void 0},x.flush=function(){return void 0===s?i:b(Date.now())},x.pending=function(){return void 0!==s},x},la=function(e,t,n){var o=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ia(n)&&(o="leading"in n?Boolean(n.leading):o,r="trailing"in n?Boolean(n.trailing):r),sa(e,t,{leading:o,trailing:r,maxWait:t})},ca=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:xr,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,o))).preventNewMeasurement=!1,e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(gr(e,t.handles.start,t.handles.middle,n)<25||gr(e,t.handles.middle,t.handles.end,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var o=da(e,n.handles.middle,n.handles.start),r=da(e,n.handles.end,n.handles.middle),a=da(e,n.handles.end,n.handles.start),i=ua(o),s=ua(r),l=ua(a),c=Math.acos((Math.pow(i,2)+Math.pow(s,2)-Math.pow(l,2))/(2*i*s));c*=180/Math.PI,n.rAngle=vr(c,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=n.enabledElement,r=this.configuration,a=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=O(e.currentTarget,this.name),u=xt("globalConfiguration").configuration.lineDash;if(c)for(var d=Pn(n.canvasContext.canvas),f=n.image,h=n.element,p=aa(f),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=Zt.getToolWidth(),b=function(e){var r=c.data[e];if(!1===r.visible)return"continue";Wt(d,(function(e){Ln(e,t.configuration);var c=un.getColorIfActive(r),d=y.cornerstone.pixelToCanvas(n.element,r.handles.start),p=y.cornerstone.pixelToCanvas(n.element,r.handles.middle),b={color:c};l&&(b.lineDash=u),Qt(e,n.element,r.handles.start,[r.handles.middle,r.handles.end],b);var x={color:c,handleRadius:a,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&dn(e,n,r.handles,x),!0===r.invalidated&&(r.rAngle?t.throttledUpdateCachedStats(f,h,r):t.updateCachedStats(f,h,r)),r.rAngle){var T,I=function(e,t,n){var o=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+o}(r,m,g);if(!r.handles.textBox.hasMoved){T={x:p.x,y:p.y};var E=xn(e,I,5);p.x<d.x?T.x-=15+E+10:T.x+=15;var S=y.cornerstone.internal.getTransform(o);S.invert();var C=S.transformPoint(T.x,T.y);r.handles.textBox.x=C.x,r.handles.textBox.y=C.y}An(e,n.element,r.handles.textBox,I,r.handles,w,c,v,0,!0)}}))},x=0;x<c.data.length;x++)b(x);function w(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var o=e.detail,r=this.createNewMeasurement(o),a=e.detail.element;L(a,this.name,r),y.cornerstone.updateImage(a),nr(o,this.name,r,r.handles.middle,this.options,t,(function(e){if(r.active=!1,!e)return k(a,n.name,r),void(n.preventNewMeasurement=!1);r.handles.end.active=!0,y.cornerstone.updateImage(a),nr(o,n.name,r,r.handles.end,n.options,t,(function(e){e?(r.active=!1,y.cornerstone.updateImage(a)):k(a,n.name,r),n.preventNewMeasurement=!1,y.cornerstone.updateImage(a);var t={toolName:n.name,toolType:n.name,element:a,measurementData:r};T(a,w.MEASUREMENT_COMPLETED,t)}))}))}}}]),t}(mr);function ua(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function da(e,t,n){var o=aa(e),r=o.rowPixelSpacing,a=o.colPixelSpacing;return{x:(t.x-n.x)*(a||1),y:(t.y-n.y)*(r||1)}}var fa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:ha,changeTextCallback:pa,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:wr};return(e=u()(this,f()(t).call(this,n,o))).preventNewMeasurement=!1,e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&gr(e,t.handles.start,t.handles.end,n)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=n.element,r=n.enabledElement,a=this.configuration,i=a.handleRadius,s=a.drawHandlesOnHover,l=a.hideHandlesIfMoving,c=a.renderDashed,u=O(o,this.name);if(u){var d,f=e.detail.canvasContext.canvas,h=Pn(f),p=Zt.getToolWidth();c&&(d=xt("globalConfiguration").configuration.lineDash);for(var m=function(n){var a=u.data[n];if(!1===a.visible)return"continue";Wt(h,(function(n){Ln(n,t.configuration);var c=un.getColorIfActive(a),u=y.cornerstone.pixelToCanvas(o,a.handles.start),f=y.cornerstone.pixelToCanvas(o,a.handles.end);t.configuration.arrowFirst?Jt(n,f,u,c,p,d):Jt(n,u,f,c,p,d);var h={color:c,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&dn(n,e.detail,a.handles,h);var m=function(e){return e.text}(a);if(m&&""!==m){var g=xn(n,m,5),b=vn.getFontSize()+10,x=Math.max(g,b)/2+5;if(f.x<u.x&&(x=-x),!a.handles.textBox.hasMoved){var w;w=t.configuration.arrowFirst?{x:f.x-g/2+x,y:f.y-b/2}:{x:u.x-g/2-x,y:u.y-b/2};var T=y.cornerstone.internal.getTransform(r);T.invert();var I=T.transformPoint(w.x,w.y);a.handles.textBox.x=I.x,a.handles.textBox.y=I.y}An(n,o,a.handles.textBox,m,a.handles,v,c,p,0,!1)}}))},g=0;g<u.data.length;g++)m(g)}function v(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,o=e.detail.element,r=this.createNewMeasurement(e),a=this.configuration.allowEmptyLabel;L(o,this.name,r),y.cornerstone.updateImage(o),nr(e.detail,this.name,r,r.handles.end,this.options,t,(function(t){t?void 0===r.text&&n.configuration.getTextCallback((function(e){if(e||a){r.text=e,r.active=!1;var t={toolName:n.name,toolType:n.name,element:o,measurementData:r};y.cornerstone.updateImage(o),T(o,w.MEASUREMENT_COMPLETED,t)}else k(o,n.name,r)}),e.detail):k(o,n.name,r),y.cornerstone.updateImage(o)}))}},{key:"doubleClickCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,o=O(t,this.name);if(!o)return!1;for(var r=0;r<o.data.length;r++){var a=o.data[r];if(this.pointNearTool(t,a,n)||go(a.handles.textBox,n))return a.active=!0,y.cornerstone.updateImage(t),this.configuration.changeTextCallback(a,e.detail,this._doneChangingTextCallback.bind(this,t,a)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,o){!0===o?k(e,this.name,t):t.text=n,t.active=!1,y.cornerstone.updateImage(e),T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}]),t}(mr);function ha(e){e(prompt("Enter your annotation:"))}function pa(e,t,n){n(prompt("Change your annotation:"))}var ma=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},o)},ga=function(e){var t=e.currentPoints.image,n=t.x,o=t.y;return{toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:ma(n,o,0),end:ma(n,o,1,{active:!0}),perpendicularStart:ma(n,o,2,{locked:!0}),perpendicularEnd:ma(n,o,3),textBox:ma(n-50,o-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},va=function(e,t,n,o){var r=y.cornerstone,a=y.cornerstoneMath,i={start:r.pixelToCanvas(e,t.perpendicularStart),end:r.pixelToCanvas(e,t.perpendicularEnd)};return a.lineSegment.distanceToPoint(i,n)<o},ya=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",r=y.cornerstone,a=y.cornerstoneMath,i=t.handles,s={start:r.pixelToCanvas(e,i.start),end:r.pixelToCanvas(e,i.end)},l=a.lineSegment.distanceToPoint(s,n);if(go(i.textBox,n))return!0;var c=lr(o,"Bidirectional");return!!va(e,i,n,c)||l<c};function ba(e,t,n,o){var r=(n.x-o.x)*e,a=(n.y-o.y)*t,i=Math.sqrt(r*r+a*a);return{x:r/i,y:a/i,length:i}}function xa(e,t){if(!t.handles.perpendicularStart.locked)return!1;var n,o,r,a,i=t.handles,s=i.start,l=i.end,c=e.image,u=c.columnPixelSpacing,d=void 0===u?1:u,f=c.rowPixelSpacing,h=void 0===f?1:f;if(s.x===l.x&&s.y===l.y)n=s.x,o=s.y,r=l.x,a=l.y;else{var p={x:(s.x+l.x)/2,y:(s.y+l.y)/2},m=ba(d,h,s,l),g=m.length/2,v=g/(2*h),y=g/(2*d);n=p.x+y*m.y,o=p.y-v*m.x,r=p.x-y*m.y,a=p.y+v*m.x}return t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=o,t.handles.perpendicularEnd.x=r,t.handles.perpendicularEnd.y=a,!0}var wa,Ta=function(e){var t=this,n=e.detail,o=n.element,r=n.canvasContext,a=n.image,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=i.renderDashed,d=xt("globalConfiguration").configuration.lineDash,f=O(o,this.name);if(f){var h=aa(a),p=h.rowPixelSpacing,m=h.colPixelSpacing;if(p&&m)for(var g,v=Pn(r.canvas),y=Zt.getToolWidth(),b=function(e){var r=f.data[e];if(!1===r.visible)return"continue";g=un.getColorIfActive(r),!0===r.invalidated&&(r.longestDiameter&&r.shortestDiameter?t.throttledUpdateCachedStats(a,o,r):t.updateCachedStats(a,o,r)),Wt(v,(function(e){Ln(e,t.configuration);var a=r.handles,i=a.start,f=a.end,h=a.perpendicularStart,v=a.perpendicularEnd,b=a.textBox,x={color:g},w={color:g,strokeWidth:T};u&&(x.lineDash=d,w.lineDash=d),Kt(e,o,i,f,x);var T=y;xa(n,r),Kt(e,o,h,v,w);var I={color:g,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&dn(e,n,r.handles,I);var E=Ia(r,p,m);An(e,o,b,E,r.handles,(function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]}),g,y,10,!0)}))},x=0;x<f.data.length;x++)b(x)}},Ia=function(e,t,n){var o=" mm";t&&n||(o=" pixels");var r=" L ".concat(e.longestDiameter).concat(o),a=" W ".concat(e.shortestDiameter).concat(o),i=e.labels;return i&&Array.isArray(i)?[].concat(J()(i),[r,a]):[r,a]},Ea=function(e,t){var n=this,o=e.detail,r=o.element,a=o.image,i=o.buttons,s=this.configuration;if(!Sa(a)){var l=this.createNewMeasurement(o),c=function(){l.active=!1,y.cornerstone.updateImage(r)};L(r,this.name,l),y.cornerstone.updateImage(r);var u=(new Date).getTime(),d=l.handles,f=d.end,h=d.perpendicularStart;nr(o,this.name,l,f,{},t,(function(e){if(e){var d=l.handles,f=l.longestDiameter,p=l.shortestDiameter,m=To(o,d),g=parseFloat(f)||0,v=parseFloat(p)||0,b=g<1||v<1,x=(new Date).getTime()-u<150;m||b||x?(l.cancelled=!0,k(r,n.name,l)):s.getMeasurementLocationCallback(l,o,c),xa(o,l),h.locked=!1,l.invalidated=!0,y.cornerstone.updateImage(r);var I=Lo(r,i,t);I instanceof Ka&&I.updateCachedStats(a,r,l);var E={toolName:n.name,toolType:n.name,element:r,measurementData:l};T(r,w.MEASUREMENT_MODIFIED,E),T(r,w.MEASUREMENT_COMPLETED,E)}else k(r,n.name,l)}))}},Sa=function(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,o=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,o=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!o},Ca={setCoords:function(e){wa=e.currentPoints.canvas},getCoords:function(){return wa}},Aa=function(e){var t=this,n=e.detail,o=n.element;Ca.setCoords(n);var r=O(o,this.name);if(r){for(var a=!1,i=function(e){var i=n.currentPoints.canvas,s=r.data[e],l=function(e,t,n){var o=yo(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:6),r=!1;return Object.keys(t).forEach((function(e){if("textBox"!==e){var n=t[e],a=n===o;n.active!==a&&(r=!0),n.active=a}})),r}(o,s.handles,i);Object.keys(s.handles).forEach((function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active}})),l&&(a=!0);var c=t.pointNearTool(o,s,i,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,a=!0)},s=0;s<r.data.length;s++)i(s);!0===a&&y.cornerstone.updateImage(o)}},Ma=function(e,t,n){"touch"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)};function Pa(e,t,n,o){var r=(n.x-o.x)/t,a=(n.y-o.y)/e;return Math.sqrt(r*r+a*a)}function Da(e,t){return{start:e,end:t}}function La(e,t,n){var o=y.cornerstoneMath.lineSegment,r=e.handles,a=r.start,i=r.end,s=r.perpendicularStart,l=r.perpendicularEnd,c=t.image,u=c.columnPixelSpacing,d=void 0===u?1:u,f=c.rowPixelSpacing,h=void 0===f?1:f,p=Da(a,i),m=Da(s,l),g=o.intersectLine(p,m);return{columnPixelSpacing:d,rowPixelSpacing:h,start:a,end:i,perpendicularStart:s,perpendicularEnd:l,longLine:p,intersection:g,distanceToFixed:Pa(d,h,n,g),fixedPoint:n}}function Oa(e,t,n,o){var r=La(t,n,o),a=r.columnPixelSpacing,i=r.rowPixelSpacing,s=r.distanceToFixed,l=Pa(a,i,o,e);if(l<=s)return!1;var c=s/l,u=function(e,t){var n=e.columnPixelSpacing,o=e.rowPixelSpacing,r=e.start,a=e.perpendicularStart,i=e.perpendicularEnd,s=e.intersection,l=e.fixedPoint,c=Pa(n,o,a,s),u=Pa(n,o,i,s),d=ba(n,o,l,t),f=l===r?1:-1,h=f*o,p=f*n;return{start:{x:t.x+d.y*c*h,y:t.y+d.x*c*p*-1},end:{x:t.x+d.y*u*h*-1,y:t.y+d.x*u*p}}}(r,{x:o.x+(e.x-o.x)*c,y:o.y+(e.y-o.y)*c});return t.handles.perpendicularStart.x=u.start.x,t.handles.perpendicularStart.y=u.start.y,t.handles.perpendicularEnd.x=u.end.x,t.handles.perpendicularEnd.y=u.end.y,!0}function ka(e,t){return e===t}function Ra(e,t){return ka(e,t)?-1:1}function _a(e,t,n,o){var r,a=e.columnPixelSpacing,i=e.rowPixelSpacing,s=e.fixedPoint,l=e.perpendicularStart,c=e.perpendicularEnd,u=e.distanceToFixed,d=Ra(s,c)*u,f=function(e,t,n){return ka(e,n)?t:n}(s,l,c)===l,h=f?"start":"end",p=f?"end":"start";return r={},wo()(r,h,{x:n.start.x,y:n.start.y}),wo()(r,p,{x:t.x+o.y*i*d,y:t.y+o.x*a*d*-1}),r}function Na(e,t,n,o){var r=y.cornerstoneMath.lineSegment,a=La(t,n,o),i=a.columnPixelSpacing,s=a.rowPixelSpacing,l=a.start,c=a.longLine,u=a.intersection;if(!function(e,t,n){return 0!==Pa(e,t,n.start,n.end)}(i,s,c))return!1;var d=ba(i,s,l,u),f=function(e,t,n){var o=e.columnPixelSpacing,r=e.rowPixelSpacing,a=e.perpendicularEnd,i=e.fixedPoint,s=Number.MAX_SAFE_INTEGER,l=Ra(i,a)*s;return{start:t,end:{x:t.x+n.y*r*l,y:t.y+n.x*o*l*-1}}}(a,e,d),h=r.intersectLine(c,f);if(!h)return!1;var p=_a(a,h,f,d);return t.handles.perpendicularStart.x=p.start.x,t.handles.perpendicularStart.y=p.start.y,t.handles.perpendicularEnd.x=p.end.x,t.handles.perpendicularEnd.y=p.end.y,!0}var Ba=function(e,t,n,o){var r,a,i,s,l={},c={},u={x:t.currentPoints.image.x+o.x,y:t.currentPoints.image.y+o.y};0===e.index?Oa(u,n,t,n.handles.end)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?Oa(u,n,t,n.handles.start)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(r=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(a=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},a=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(a,n.handles.start),s=y.cornerstoneMath.point.distance(a,n.handles.end),(!a||i<3||s<3)&&(r=!0)),r||Na(u,n,t,n.handles.perpendicularEnd)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(r=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(a=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},a=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(a,n.handles.start),s=y.cornerstoneMath.point.distance(a,n.handles.end),(!a||i<3||s<3)&&(r=!0)),r||Na(u,n,t,n.handles.perpendicularStart)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))},Ua=function(e,t,n){var o=e[n],r=t[n];e[n]=r,t[n]=o},Va=function(e,t){Ua(e,t,"x"),Ua(e,t,"y"),Ua(e,t,"moving"),Ua(e,t,"hover"),Ua(e,t,"active"),Ua(e,t,"selected")},Fa=function(e){var t,n=this,o=e.detail,r=o.element,a=lr("mouse",this.name),i=function(e){t.invalidated=!0,To(o,t.handles)&&k(r,n.name,t),e&&(e.moving=!1,e.selected=!0),Et(n.element,n.svgCursor),y.cornerstone.updateImage(r),r.addEventListener(w.MOUSE_MOVE,n._moveCallback),r.addEventListener(w.TOUCH_START,n._moveCallback)},s=o.startPoints.canvas,l=O(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[r,t.handles,s,a],d=yo.apply(void 0,u);if(d)return r.removeEventListener(w.MOUSE_MOVE,n._moveCallback),r.removeEventListener(w.TOUCH_START,n._moveCallback),t.active=!0,ja(t.handles),d.moving=!0,(d=function(e,t,n){var o=e.image,r=o.rowPixelSpacing,a=o.columnPixelSpacing,i=t.handles,s=i.start,l=i.end,c=i.perpendicularStart,u=i.perpendicularEnd,d=(s.x-l.x)*(a||1),f=(s.y-l.y)*(r||1),h=Math.sqrt(d*d+f*f),p=(c.x-u.x)*(a||1),m=(c.y-u.y)*(r||1);return(Math.sqrt(p*p+m*m)||0)>h?(Va(s,l),Va(s,c),Va(l,u),Object.values(i).find((function(e){return!0===e.moving}))):n}(o,t,d)).hasBoundingBox||St(n.element),function(e,t,n,o,r,a){var i=e.element,s=e.image,l=e.buttons,c={x:o.x-e.currentPoints.image.x,y:o.y-e.currentPoints.image.y},u=function(e){var r=e.detail;o.hasMoved=!0,void 0===o.index||null===o.index?(o.x=r.currentPoints.image.x+c.x,o.y=r.currentPoints.image.y+c.y):Ba(o,r,n,c),a&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,r.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,r.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Lo(i,l,"mouse");u instanceof mr&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,w.MEASUREMENT_MODIFIED,d)};o.active=!0,o.moving=!0,vt.isToolLocked=!0,i.addEventListener(w.MOUSE_DRAG,u),i.addEventListener(w.TOUCH_DRAG,u);var d=y.cornerstone.getImage(i),f=function(){y.cornerstone.getImage(i).imageId!==d.imageId&&h()};i.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,f);var h=function e(){o.active=!1,vt.isToolLocked=!1,i.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,f),i.removeEventListener(w.MOUSE_DRAG,u),i.removeEventListener(w.MOUSE_UP,e),i.removeEventListener(w.MOUSE_CLICK,e),i.removeEventListener(w.TOUCH_DRAG,u),i.removeEventListener(w.TOUCH_DRAG_END,e),i.removeEventListener(w.TAP,e),y.cornerstone.updateImage(i),"function"==typeof r&&r()};i.addEventListener(w.MOUSE_UP,h),i.addEventListener(w.MOUSE_CLICK,h),i.addEventListener(w.TOUCH_DRAG_END,h),i.addEventListener(w.TAP,h)}(o,n.name,t,d,(function(){return i(d)})),za(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===x()(d))return d.v}var f=function(e){return function(){Ha(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(r,t,s,"mouse")){r.removeEventListener(w.MOUSE_MOVE,this._moveCallback),r.removeEventListener(w.TOUCH_START,this._moveCallback),t.active=!0,ja(t.handles),Ha(t.handles,!0);var h=f(t.handles);return No(o,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",h),za(e),!0}}},ja=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Ha=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},za=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},qa=[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP],Wa=function(e){var t,n=this,o=e.detail,r=o.element,a=vt.touchProximity,i=function(e){t.invalidated=!0,To(o,t.handles)&&k(r,n.name,t),e&&(e.moving=!1,e.selected=!0),y.cornerstone.updateImage(r),r.addEventListener(w.TOUCH_DRAG,n._moveCallback)},s=o.startPoints.canvas,l=O(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[r,t.handles,s,a],d=yo.apply(void 0,u);if(d)return r.removeEventListener(w.TOUCH_DRAG,n._moveCallback),t.active=!0,Ga(t.handles),d.moving=!0,function(e,t,n,o,r,a){var i=e.element,s=e.image,l=e.buttons,c={x:o.x-e.currentPoints.image.x,y:o.y-e.currentPoints.image.y},u=function(e){var r=e.detail;o.hasMoved=!0,void 0===o.index||null===o.index?(o.x=r.currentPoints.image.x+c.x,o.y=r.currentPoints.image.y+c.y):Ba(o,r,n,c),a&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,r.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,r.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Lo(i,l,"touch");u instanceof mr&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,w.MEASUREMENT_MODIFIED,d)};o.active=!0,vt.isToolLocked=!0,i.addEventListener(w.TOUCH_DRAG,u);var d=function e(){o.active=!1,vt.isToolLocked=!1,i.removeEventListener(w.TOUCH_DRAG,u),qa.forEach((function(t){i.removeEventListener(t,e)})),y.cornerstone.updateImage(i),"function"==typeof r&&r()};qa.forEach((function(e){i.addEventListener(e,d)}))}(o,n.name,t,d,(function(){return i(d)})),Za(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===x()(d))return d.v}var f=function(e){return function(){Ya(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(r,t,s,"touch")){r.removeEventListener(w.TOUCH_DRAG,this._moveCallback),t.active=!0,Ga(t.handles),Ya(t.handles,!0);var h=f(t.handles);return No(o,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",h),Za(e),!0}}},Ga=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Ya=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},Za=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Xa=function(e,t,n){return n()},Ka=function(e){function t(e){var n;i()(this,t);var o={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:Xa,getMeasurementLocationCallback:Xa,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:Tr};return(n=u()(this,f()(t).call(this,e,o))).throttledUpdateCachedStats=la(n.updateCachedStats,110),n.createNewMeasurement=ga.bind(Co()(n)),n.pointNearTool=ya.bind(Co()(n)),n.renderToolData=Ta.bind(Co()(n)),n.addNewMeasurement=Ea.bind(Co()(n)),n._moveCallback=Aa.bind(Co()(n)),n.handleSelectedCallback=Ma.bind(Co()(n)),n.handleSelectedMouseCallback=Fa.bind(Co()(n)),n.handleSelectedTouchCallback=Wa.bind(Co()(n)),n}return p()(t,e),l()(t,[{key:"updateCachedStats",value:function(e,t,n){if(n.toolName===this.name){var o=function(e,t){var n=t.rowPixelSpacing,o=t.colPixelSpacing,r=e.handles,a=r.start,i=r.end,s=r.perpendicularStart,l=r.perpendicularEnd,c=(a.x-i.x)*(o||1),u=(a.y-i.y)*(n||1),d=Math.sqrt(c*c+u*u),f=(s.x-l.x)*(o||1),h=(s.y-l.y)*(n||1),p=Math.sqrt(f*f+h*h);if(p||(p=0),p>d){var m=d;d=p,p=m}return{longestDiameter:d.toFixed(1),shortestDiameter:p.toFixed(1)}}(n,aa(e)),r=o.longestDiameter,a=o.shortestDiameter;n.longestDiameter=r,n.shortestDiameter=a,n.invalidated=!1}}}]),t}(mr),Qa=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=y.cornerstone,r=o.metaData.get("patientStudyModule",e.imageId),a=o.metaData.get("generalSeriesModule",e.imageId);if(r&&a&&"PT"===a.modality){var i=n?t:t*e.slope+e.intercept,s=r.patientWeight;if(s){var l=o.metaData.get("petIsotopeModule",e.imageId);if(l){var c=l.radiopharmaceuticalInfo,u=c.radiopharmaceuticalStartTime,d=c.radionuclideTotalDose,f=c.radionuclideHalfLife,h=a.seriesTime;if(u&&d&&f&&h){var p=Ja(h.fractionalSeconds||0)+h.seconds+60*h.minutes+60*h.hours*60-(Ja(u.fractionalSeconds||0)+u.seconds+60*u.minutes+60*u.hours*60);return i*s/(d*Math.exp(-p*Math.log(2)/f))*1e3}}}}};function Ja(e){return parseFloat(".".concat(e))}var $a=function(e,t){var n=e.width/2,o=e.height/2;if(n<=0||o<=0)return!1;var r=e.left+n,a=e.top+o,i=t.x-r,s=t.y-a;return i*i/(n*n)+s*s/(o*o)<=1},ei=function(e,t){for(var n=0,o=0,r=0,a=0,i=null,s=null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)$a(t,{x:c,y:l})&&(null===i&&(i=e[a],s=e[a]),n+=e[a],o+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),r++),a++;if(0===r)return{count:r,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/r,d=o/r-u*u;return{count:r,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}},ti={calculateEllipseStatistics:ei,pointInEllipse:$a};function ni(e,t){var n=function(e){var t=[e.start,e.end].sort((function(e,t){return e.x<t.x?-1:1})),n=[e.start,e.end].sort((function(e,t){return e.y<t.y?-1:1})),o=t[0],r=t[t.length-1];return{top:n[0],left:o,bottom:n[n.length-1],right:r}}(t),o=(n.left.x+n.right.x)/2,r=(n.top.y+n.bottom.y)/2,a={};return e.rotation>=0&&e.rotation<90&&(a.x=e.hflip?n.left.x:n.right.x,a.y=r),e.rotation>=90&&e.rotation<180&&(a.x=o,a.y=e.vflip?n.bottom.y:n.top.y),e.rotation>=180&&e.rotation<270&&(a.x=e.hflip?n.right.x:n.left.x,a.y=r),e.rotation>=270&&e.rotation<360&&(a.x=o,a.y=e.vflip?n.top.y:n.bottom.y),a}var oi=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},ri=U("tools:annotation:CircleRoiTool"),ai=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Er,configuration:{centerPointRadius:0,renderDashed:!1,hideHandlesIfMoving:!1}};return(e=u()(this,f()(t).call(this,n,o))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};ri.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,o){var r=t&&t.handles&&t.handles.start&&t.handles.end,a=y.cornerstoneMath.point.distance;if(r||ri.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var i="mouse"===o?15:25,s=y.cornerstone.pixelToCanvas(e,t.handles.start),l=y.cornerstone.pixelToCanvas(e,t.handles.end),c=a(s,n),u=a(s,l);return c>u-i/2&&c<u+i/2}},{key:"updateCachedStats",value:function(e,t,n){var o=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=aa(e),a=function(e,t,n,o,r){var a,i=ye(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=ei(s,i);"PT"===o&&(a={mean:Qa(e,l.mean,!0)||0,stdDev:Qa(e,l.stdDev,!0)||0});var c=i.width*(r&&r.colPixelSpacing||1)/2,u=2*Math.PI*c;return{area:Math.PI*(i.width*(r&&r.colPixelSpacing||1)/2)*(i.height*(r&&r.rowPixelSpacing||1)/2)||0,radius:c||0,perimeter:u||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,o,r);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=O(e.currentTarget,this.name);if(n){var o=y.cornerstoneMath.point.distance,r=e.detail,a=r.image,i=r.element,s=r.canvasContext,l=Zt.getToolWidth(),c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,f=c.hideHandlesIfMoving,h=c.renderDashed,p=c.centerPointRadius,m=Pn(s.canvas),g=aa(a),v=g.rowPixelSpacing,b=g.colPixelSpacing,x=xt("globalConfiguration").configuration.lineDash,w=(y.cornerstone.metaData.get("generalSeriesModule",a.imageId)||{}).modality,T=v&&b;Wt(m,(function(e){for(var s=0;s<n.data.length;s++){var c=n.data[s];if(!1!==c.visible){var m=un.getColorIfActive(c),g={color:m,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:f};Ln(e,t.configuration);var v=y.cornerstone.pixelToCanvas(i,c.handles.start),b=y.cornerstone.pixelToCanvas(i,c.handles.end),I=o(v,b),E={color:m};if(h&&(E.lineDash=x),$t(e,i,c.handles.start,I,E,"pixel"),p&&I>3*p&&$t(e,i,c.handles.start,p,E,"pixel"),c.handles&&(c.handles.start.drawnIndependently=!0,c.handles.end.drawnIndependently=!0),dn(e,r,c.handles,g),!0===c.invalidated&&(c.cachedStats?t.throttledUpdateCachedStats(a,i,c):t.updateCachedStats(a,i,c)),!c.handles.textBox.hasMoved){var S=ni(r.viewport,c.handles);Object.assign(c.handles.textBox,S)}var C=si(e,a.color,c.cachedStats,w,T,t.configuration);c.unit=ii(w,t.configuration.showHounsfieldUnits),An(e,i,c.handles.textBox,C,c.handles,(function(e){return n=(t=ye(e.start,e.end)).left,o=t.top,[{x:n+(r=t.width)/2,y:o},{x:n,y:o+(a=t.height)/2},{x:n+r/2,y:o+a},{x:n+r,y:o+a/2}];var t,n,o,r,a}),m,l,10,!0)}}}))}}}]),t}(mr);function ii(e,t){return"CT"===e&&!1!==t?"HU":""}function si(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.area,r=void 0===o?0:o,a=n.radius,i=void 0===a?0:a,s=n.perimeter,l=void 0===s?0:s,c=n.mean,u=void 0===c?0:c,d=n.stdDev,f=void 0===d?0:d,h=n.min,p=void 0===h?0:h,m=n.max,g=void 0===m?0:m,v=n.meanStdDevSUV,y=void 0===v?0:v,b=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},T=w.showMinMax||!1,I=[],E=[];if(!t){var S=y&&0!==y.mean,C=ii(b,w.showHounsfieldUnits),A="Mean: ".concat(oi(u.toFixed(2))," ").concat(C),M="Std Dev: ".concat(oi(f.toFixed(2))," ").concat(C);if(S){for(var P=" SUV: ",D="".concat(P).concat(oi(y.mean.toFixed(2))),L="".concat(P).concat(oi(y.stdDev.toFixed(2))),O=Math.floor(e.measureText("".concat(M,"     ")).width);e.measureText(A).width<O;)A+=" ";E.push("".concat(A).concat(D)),E.push("".concat(M,"     ").concat(L))}else E.push("".concat(A,"     ").concat(M));if(T){for(var k="Min: ".concat(p," ").concat(C),R="Max: ".concat(g," ").concat(C),_=S?Math.floor(e.measureText("".concat(M,"     ")).width):Math.floor(e.measureText("".concat(A,"     ")).width);e.measureText(k).width<_;)k+=" ";E.push("".concat(k).concat(R))}}return I.push(li(r,x)),i&&I.push(ci(i,"Radius",x)),l&&I.push(ci(l,"Perimeter",x)),E.forEach((function(e){return I.push(e)})),I}function li(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(oi(e.toFixed(2))).concat(n)}function ci(e,t,n){if(!e)return"";var o=n?" mm":" px";return"".concat(t,": ").concat(oi(e.toFixed(1))).concat(o)}var ui=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ir,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,o))).hasIncomplete=!1,e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(this.hasIncomplete)return!1;var o=gr(e,t.handles.start,t.handles.end,n)<25,r=gr(e,t.handles.start2,t.handles.end2,n)<25;return o||r}},{key:"updateCachedStats",value:function(e,t,n){var o=aa(e),r=o.rowPixelSpacing,a=o.colPixelSpacing,i=(Math.ceil(n.handles.start.x)-Math.ceil(n.handles.end.x))*(a||1),s=(Math.ceil(n.handles.start.y)-Math.ceil(n.handles.end.y))*(r||1),l=(Math.ceil(n.handles.start2.x)-Math.ceil(n.handles.end2.x))*(a||1),c=(Math.ceil(n.handles.start2.y)-Math.ceil(n.handles.end2.y))*(r||1),u=Math.acos(Math.abs((i*l+s*c)/(Math.sqrt(i*i+s*s)*Math.sqrt(l*l+c*c))));u*=180/Math.PI,n.rAngle=vr(u,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=this.configuration,r=o.handleRadius,a=o.drawHandlesOnHover,i=o.hideHandlesIfMoving,s=o.renderDashed,l=O(e.currentTarget,this.name);if(l)for(var c=Pn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=xt("globalConfiguration").configuration.lineDash,f=vn.getFont(),h=e.detail.element,p=aa(y.cornerstone.getEnabledElement(h).image),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=function(e){var o=l.data[e];if(!1===o.visible)return"continue";o.value||(o.value=t.textBoxText(o,m,g)),Wt(c,(function(e){Ln(e,t.configuration);var l=un.getColorIfActive(o),c={color:l};s&&(c.lineDash=d),Kt(e,n.element,o.handles.start,o.handles.end,c),o.complete&&Kt(e,n.element,o.handles.start2,o.handles.end2,c);var h={color:l,handleRadius:r,drawHandlesIfActive:a,hideHandlesIfMoving:i};t.configuration.drawHandles&&dn(e,n,o.handles,h),e.fillStyle=l;var p=o.value;if(!o.handles.textBox.hasMoved){var m={x:(o.handles.start.x+o.handles.end.x)/2,y:(o.handles.start.y+o.handles.end.y)/2-10};e.font=f,o.handles.textBox.x=m.x,o.handles.textBox.y=m.y}An(e,n.element,o.handles.textBox,p,o.handles,x,l,u,0,!0)}))},b=0;b<l.data.length;b++)v(b);function x(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=O(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))}},{key:"addNewMeasurement",value:function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var o,r,a=e.detail,i=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,r={toolName:n.name,toolType:n.name,element:s,measurementData:o};T(s,t,r)}else k(s,n.name,o)},s=e.detail.element,l=this.getIncomplete(s);l?((o=l).complete=!0,o.handles.start2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},o.handles.end2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},r=o.handles.end2,this.hasIncomplete=!1,i=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,r={toolName:n.name,toolType:n.name,element:s,measurementData:o};T(s,t,r)}else k(s,n.name,o)}):(o=this.createNewMeasurement(a),L(s,this.name,o),r=o.handles.end),y.cornerstone.updateImage(s),nr(a,this.name,o,r,this.options,t,i)}},{key:"onMeasureModified",value:function(e){var t=e.detail.element,n=y.cornerstone.getEnabledElement(t).image,o=aa(n),r=o.rowPixelSpacing,a=o.colPixelSpacing;if(e.detail.toolName===this.name){var i=e.detail.measurementData;!0===i.invalidated&&(i.rAngle?this.throttledUpdateCachedStats(n,t,i):this.updateCachedStats(n,t,i)),i.value=this.textBoxText(i,r,a)}}},{key:"textBoxText",value:function(e,t,n){var o=e.rAngle;if(void 0===o)return"";if(Number.isNaN(o))return"";var r=t&&n?"":" (isotropic)";return"".concat(o,"°").concat(r)}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(mr),di=U("tools:annotation:EllipticalRoiTool"),fi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Sr};return(e=u()(this,f()(t).call(this,n,o))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};di.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,o){var r=t&&t.handles&&t.handles.start&&t.handles.end;if(r||di.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;if(yo(e,t.handles,n,6))return!0;var a="mouse"===o?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x)+a/2,top:Math.min(i.y,s.y)+a/2,width:Math.abs(i.x-s.x)-a,height:Math.abs(i.y-s.y)-a},c={left:Math.min(i.x,s.x)-a/2,top:Math.min(i.y,s.y)-a/2,width:Math.abs(i.x-s.x)+a,height:Math.abs(i.y-s.y)+a},u=$a(l,n);return!(!$a(c,n)||u)}},{key:"updateCachedStats",value:function(e,t,n){var o=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=aa(e),a=function(e,t,n,o,r){var a,i=gi(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=ei(s,i);return"PT"===o&&(a={mean:Qa(e,l.mean,!0)||0,stdDev:Qa(e,l.stdDev,!0)||0}),{area:Math.PI*(i.width*(r.colPixelSpacing||1)/2)*(i.height*(r.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,o,r);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=O(e.currentTarget,this.name);if(n){var o=e.detail,r=o.image,a=o.element,i=Zt.getToolWidth(),s=xt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=Pn(o.canvasContext.canvas),p=aa(r),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=(y.cornerstone.metaData.get("generalSeriesModule",r.imageId)||{}).modality,b=m&&g;Wt(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=un.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};Ln(e,t.configuration);var g={color:p};if(f&&(g.lineDash=s),an(e,a,h.handles.start,h.handles.end,g,"pixel",h.handles.initialRotation),dn(e,o,h.handles,m),!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(r,a,h):t.updateCachedStats(r,a,h)),!h.handles.textBox.hasMoved){var y=ni(o.viewport,h.handles);Object.assign(h.handles.textBox,y)}var x=pi(e,r.color,h.cachedStats,v,b,t.configuration);h.unit=hi(v,t.configuration.showHounsfieldUnits),An(e,a,h.handles.textBox,x,h.handles,(function(e){return n=(t=gi(e.start,e.end)).left,o=t.top,[{x:n+(r=t.width)/2,y:o},{x:n,y:o+(a=t.height)/2},{x:n+r/2,y:o+a},{x:n+r,y:o+a/2}];var t,n,o,r,a}),p,i,10,!0)}}}))}}}]),t}(mr);function hi(e,t){return"CT"===e&&!1!==t?"HU":""}function pi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.area,r=void 0===o?0:o,a=n.mean,i=void 0===a?0:a,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,f=void 0===d?0:d,h=n.meanStdDevSUV,p=void 0===h?0:h,m=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=v.showMinMax||!1,b=[],x=[];if(!t){var w=p&&0!==p.mean,T=hi(m,v.showHounsfieldUnits),I="Mean: ".concat(oi(i.toFixed(2))," ").concat(T),E="Std Dev: ".concat(oi(l.toFixed(2))," ").concat(T);if(w){for(var S=" SUV: ",C="".concat(S).concat(oi(p.mean.toFixed(2))),A="".concat(S).concat(oi(p.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(E,"     ")).width);e.measureText(I).width<M;)I+=" ";x.push("".concat(I).concat(C)),x.push("".concat(E,"     ").concat(A))}else x.push("".concat(I)),x.push("".concat(E));if(y){for(var P="Min: ".concat(u," ").concat(T),D="Max: ".concat(f," ").concat(T),L=w?Math.floor(e.measureText("".concat(E,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(P).width<L;)P+=" ";x.push("".concat(P).concat(D))}}return b.push(mi(r,g)),x.forEach((function(e){return b.push(e)})),b}function mi(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(oi(e.toFixed(2))).concat(n)}function gi(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var vi=function(e,t){for(var n=!1,o=e.length-1,r=0;r<e.length;r++)yi(t,e[r],e[o])&&(n=!n),o=r;return n};function yi(e,t,n){return o=e.y,r=t.y,a=n.y,!(!(r<o&&o<a||a<o&&o<r)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var o=t;t=n,n=o}var r=function(e,t,n){var o=(n.y-t.y)/(n.x-t.x);return{value:t.y+o*(e.x-t.x),gradient:o}}(e,t,n);return Math.sign(r.gradient)*e.y>Math.sign(r.gradient)*r.value}(e,t,n));var o,r,a}function bi(e,t,n,o){vi(e,t)&&(n.value+=o,n.squared+=o*o,n.count++)}var xi=function e(t,n){i()(this,e),this.toolIndex=t,this.handleIndexArray=n},wi=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=o,this.lines=[]};function Ti(e,t,n,o){for(var r=e.length-1,a=0;a<e.length;a++)if(-1===o.indexOf(a)&&-1===o.indexOf(r)){if(Ii(t,n,Ei(e[r]),Ei(e[a])))return!0;r=a}else r=a;return!1}function Ii(e,t,n,o){var r=!1,a=[Si(e,t,n),Si(e,t,o),Si(n,o,e),Si(n,o,t)];return a[0]!==a[1]&&a[2]!==a[3]||((0===a[0]&&Ci(e,n,t)||0===a[1]&&Ci(e,o,t)||0===a[2]&&Ci(n,e,o)||0===a[3]&&Ci(n,t,o))&&(r=!0),r)}function Ei(e){return{x:e.x,y:e.y}}function Si(e,t,n){var o=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===o?0:o>0?1:2}function Ci(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}var Ai={newHandle:function(e,t){var n=t.length-1;return Ti(t,Ei(t[n]),Ei(e),[n])},end:function(e){var t=e.length-1;return Ti(e,Ei(e[t]),Ei(e[0]),[t,0])},modify:function(e,t){var n=Ei(e[t]),o=t-1;0===t&&(o=e.length-1);var r=Ei(e[o]);return!!Ti(e,n,r,[t,o])||Ti(e,n,r=Ei(e[o=t===e.length-1?0:t+1]),[t,o])}},Mi=function(){function e(t,n){i()(this,e),this._eventData=t,this._toolName=n}return l()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=O(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var o=this._nearestHandleToPoint(n);null!==o&&o.distance<t.distance&&(t=o)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],o=n.handles.points;if(void 0===o)return null;if(!1===n.visible)return null;for(var r={toolIndex:e,handleIndex:null,distance:1/0},a=0;a<o.length;a++){var i=y.cornerstone.pixelToCanvas(t.element,o[a]),s=y.cornerstoneMath.point.distance(i,this._mousePoint);s<r.distance&&(r.handleIndex=a,r.distance=s)}return r}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,o=[],r=0;r<n.length;r++){var a=e.getNextHandleIndex(r,n.length);this._distanceOfPointfromLine(n[r],n[a])<10&&o.push([r,a])}return o}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new xi(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var o=this._eventData,r=this._toolData.data[t],a=r.handles.points;if(void 0!==r.handles.points){if(!1===r.visible)return!1;var i=a[n[0]],s=a[n[1]],l=e.getCanvasPointsFromHandles(i,s,o.element),c=e.getLineAsVector(l),u=this._getLineOriginToMouseAsVector(l),d=(u[0]*c[0]+u[1]*c[1])/c.magnitude;return d>0&&d<c.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,o=y.cornerstone.pixelToCanvas(n.element,e),r=y.cornerstone.pixelToCanvas(n.element,t),a=this._mousePoint;return Math.abs((r.y-o.y)*a.x-(r.x-o.x)*a.y+r.x*o.y-r.y*o.x)/y.cornerstoneMath.point.distance(o,r)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var o=[];return e.x<t.x?(o.push(y.cornerstone.pixelToCanvas(n,e)),o.push(y.cornerstone.pixelToCanvas(n,t))):(o.push(y.cornerstone.pixelToCanvas(n,t)),o.push(y.cornerstone.pixelToCanvas(n,e))),o}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=y.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),Pi=function(e,t){t===e.length-1?e[t].lines.push(e[0]):e[t].lines.push(e[t+1])};function Di(e,t){var n=O(e.element,this.name);if(void 0!==n){var o=t.handleIndex,r=t.toolIndex,a=n.data[r],i=a.handles.points;i.length<=3||(o===i.length-1?(i[o-1].lines.pop(),i[o-1].lines.push(i[0])):0===o?(i[i.length-1].lines.pop(),i[i.length-1].lines.push(i[o+1])):(i[o-1].lines.pop(),i[o-1].lines.push(i[o+1])),i.splice(o,1),a.invalidated=!0,a.active=!0,a.highlight=!0,y.cornerstone.updateImage(e.element))}}function Li(e,t){var n=O(e.element,this.name);if(void 0!==n){var o=n.data[t.toolIndex],r=function(e){for(var t=e.handleIndexArray,n=1/0,o=t.includes(0),r=0;r<t.length;r++){var a=t[r];0!==a&&a<n&&(n=a)}return o&&1===n&&(n=0),++n}(t);if(r!==1/0){var a=new wi(e.currentPoints.image),i=o.handles.points;i.splice(r,0,a),i[r-1].lines.pop(),i[r-1].lines.push(e.currentPoints.image),Pi(i,r),o.active=!0,o.highlight=!0,o.invalidated=!0,y.cornerstone.updateImage(e.element)}}}var Oi={calculateFreehandStatistics:function(e,t,n){var o={count:0,mean:0,variance:0,stdDev:0},r=function(e,t,n){for(var o={value:0,squared:0,count:0},r=0,a=t.top;a<t.top+t.height;a++)for(var i=t.left;i<t.left+t.width;i++)bi(n,{x:i,y:a},o,e[r]),r++;return o}(e,t,n);return 0===r.count||(o.count=r.count,o.mean=r.value/r.count,o.variance=r.squared/r.count-o.mean*o.mean,o.stdDev=Math.sqrt(o.variance)),o},ClickedLineData:xi,freehandArea:function(e,t){var n=0,o=e.length-1;t=t||1;for(var r=0;r<e.length;r++)n+=(e[o].x+e[r].x)*(e[o].y-e[r].y),o=r;return Math.abs(n*t/2)},FreehandHandleData:wi,freehandIntersect:Ai,FreehandLineFinder:Mi,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby){var o={toolIndex:t.toolIndex,handleIndex:t.handleNearby};Di.call(this,n,o)}else{var r=new Mi(n,this.name).findLine();r&&Li.call(this,n,r)}},pointInFreehand:vi,addLine:Pi},ki=U("tools:annotation:FreehandRoiTool"),Ri=Oi.insertOrDelete,_i=Oi.freehandArea,Ni=Oi.calculateFreehandStatistics,Bi=Oi.freehandIntersect,Ui=Oi.FreehandHandleData,Vi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1},svgCursor:Cr};return(e=u()(this,f()(t).call(this,n,o))).isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(Co()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(Co()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(Co()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(Co()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(Co()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(Co()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(Co()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(Co()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(Co()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(Co()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(Co()(e)),e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}ki.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var o=t&&t.handles&&t.handles.points;if(!o)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!o||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var o=1/0,r=0;r<t.handles.points.length;r++){var a=y.cornerstoneMath.point.distance(t.handles.points[r],n);o=Math.min(o,a)}return o===1/0?-1:o}},{key:"distanceFromPointCanvas",value:function(e,t,n){var o=1/0;if(!t)return-1;for(var r=y.cornerstone.pixelToCanvas(e,n),a=t.handles.points,i=0;i<a.length;i++){var s=y.cornerstone.pixelToCanvas(e,a[i]),l=y.cornerstoneMath.point.distance(s,r);o=Math.min(o,l)}return o===1/0?-1:o}},{key:"updateCachedStats",value:function(e,t,n){for(var o,r,a=y.cornerstone.metaData.get("generalSeriesModule",e.imageId),i=a?a.modality:null,s=n.handles.points,l={left:s[0].x,right:s[0].x,bottom:s[0].y,top:s[0].x},c=0;c<s.length;c++)l.left=Math.min(l.left,s[c].x),l.right=Math.max(l.right,s[c].x),l.bottom=Math.min(l.bottom,s[c].y),l.top=Math.max(l.top,s[c].y);var u={left:l.left,top:l.bottom,width:Math.abs(l.right-l.left),height:Math.abs(l.top-l.bottom)};if(n.polyBoundingBox=u,!e.color){var d=y.cornerstone.getPixels(t,u.left,u.top,u.width,u.height);o=Ni.call(this,d,u,n.handles.points),"PT"===i&&(r={mean:Qa(e,(o.mean-e.intercept)/e.slope),stdDev:Qa(e,(o.stdDev-e.intercept)/e.slope)}),o&&!isNaN(o.mean)&&(n.meanStdDev=o,n.meanStdDevSUV=r)}var f=aa(e),h=(f.colPixelSpacing||1)*(f.rowPixelSpacing||1),p=_i(n.handles.points,h);isNaN(p)||(n.area=p),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=O(e.currentTarget,this.name);if(o)for(var r=n.image,a=n.element,i=this.configuration,s=y.cornerstone.metaData.get("generalSeriesModule",r.imageId),l=s?s.modality:null,c=Pn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=i.renderDashed,f=xt("globalConfiguration").configuration.lineDash,h=function(e){var s=o.data[e];if(!1===s.visible)return"continue";Wt(c,(function(e){var o,l=un.getColorIfActive(s);s.active?s.handles.invalidHandlePlacement?(l=i.invalidColor,o=i.invalidColor):(l=un.getColorIfActive(s),o=un.getFillColor()):o=un.getToolColor();var c={color:l};if(d&&(c.lineDash=f),s.handles.points.length){var h=s.handles.points;Qt(e,a,h[0],h,c),s.polyBoundingBox?Qt(e,a,h[h.length-1],[h[0]],c):Qt(e,a,h[h.length-1],[i.mouseLocation.handles.start],c)}if(c={color:l,fill:o},(i.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,s.handles.points,c)),s.canComplete){c.handleRadius=i.completeHandleRadius;var p=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[p],c)}if(s.active&&!s.polyBoundingBox){c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,i.mouseLocation.handles,c);var v=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[v],c)}if(!0!==s.invalidated||s.active||(s.meanStdDev&&s.meanStdDevSUV&&s.area?t.throttledUpdateCachedStats(r,a,s):t.updateCachedStats(r,a,s)),s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var y=m.call(t,s);An(e,a,s.handles.textBox,y,s.handles.points,g,l,u,0,!0)}}))},p=0;p<o.data.length;p++)h(p);function m(e){var t=e.meanStdDev,n=e.meanStdDevSUV,o=e.area,a=[];if(t&&void 0!==t.mean){var i="";"CT"===l&&(i="HU"),e.unit=i;var s="Mean: ".concat(oi(t.mean.toFixed(2))," ").concat(i),c="StdDev: ".concat(oi(t.stdDev.toFixed(2))," ").concat(i);n&&void 0!==n.mean&&(s+=" SUV: "+oi(n.mean.toFixed(2)),c+=" SUV: "+oi(n.stdDev.toFixed(2))),a.push(s),a.push(c)}if(o){var u=" mm".concat(String.fromCharCode(178)),d=aa(r),f=d.rowPixelSpacing,h=d.colPixelSpacing;f&&h||(u=" pixels".concat(String.fromCharCode(178)));var p="Area: ".concat(oi(o.toFixed(2))).concat(u);a.push(p)}return a}function g(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),Fi(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||Ri.call(this,e,n),Fi(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",r=e.detail.element,a=O(r,this.name);if(n.hasBoundingBox)dr(e,this,t,n,o);else{var i=this.configuration;i.dragOrigin={x:n.x,y:n.y};for(var s=0;s<a.data.length;s++)for(var l=a.data[s].handles.points,c=0;c<l.length;c++)l[c]===n&&(i.currentHandle=c,i.currentTool=s);this._modifying=!0,this._activateModify(r),Fi(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.currentPoints,o=t.element,r=O(o,this.name),a=this.configuration,i=a.currentTool,s=r.data[i],l=n.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(s,t);var c=this._pointNearHandle(o,s,l),u=s.handles.points;void 0!==c&&!c.hasBoundingBox&&c<u.length-1&&(a.mouseLocation.handles.start.x=u[c].x,a.mouseLocation.handles.start.y=u[c].y),y.cornerstone.updateImage(o)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=t.element,o=O(n,this.name),r=this.configuration.currentTool,a=o.data[r];this._getMouseLocation(t),this._checkInvalidHandleLocation(a,t),this._addPointPencilMode(t,a.handles.points),this._dragging=!0,y.cornerstone.updateImage(n)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;if(this._dragging){this._dragging=!1;var n=this.configuration,o=n.currentTool,r=O(t,this.name).data[o];if(!Bi.end(r.handles.points)&&r.canComplete){var a=n.currentHandle;this._endDrawing(t,a)}Fi(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.buttons,o=t.currentPoints,r=t.element;if(this.options.mouseButtonMask.includes(n)){var a=o.canvas,i=this.configuration,s=i.currentTool,l=O(r,this.name).data[s],c=this._pointNearHandle(r,l,a);if(!Bi.end(l.handles.points)&&l.canComplete){var u=i.currentHandle;this._endDrawing(r,u)}else void 0===c&&this._addPoint(t);Fi(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.currentPoints,o=t.element,r=n.canvas,a=this.configuration,i=a.currentTool,s=O(o,this.name).data[i],l=this._pointNearHandle(o,s,r);if(!Bi.end(s.handles.points)&&s.canComplete){var c=a.currentHandle;this._endDrawing(o,c)}else void 0===l&&this._addPoint(t);Fi(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=O(e,this.name),n=this.configuration,o=t.data[n.currentTool];if(!Bi.end(o.handles.points)&&o.handles.points.length>=2){var r=n.currentHandle;o.polyBoundingBox={},this._endDrawing(e,r)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fi(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fi(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=t.element,o=t.buttons;if(this.options.mouseButtonMask.includes(o)){var r,a=O(n,this.name),i=this.configuration,s=a.data[i.currentTool],l=i.currentHandle,c=s.handles.points;if(this._getMouseLocation(t),s.handles.invalidHandlePlacement=Bi.modify(c,l),s.active=!0,s.highlight=!0,c[l].x=i.mouseLocation.handles.start.x,c[l].y=i.mouseLocation.handles.start.y,r=this._getPrevHandleIndex(l,c),l>=0){var u=c[r].lines.length-1,d=c[r].lines[u];d.x=i.mouseLocation.handles.start.x,d.y=i.mouseLocation.handles.start.y}y.cornerstone.updateImage(n)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,o=n.element,r=O(o,this.name),a=this.configuration,i=r.data[a.currentTool],s=a.currentHandle,l=i.handles.points;if(this._getMouseLocation(n),i.handles.invalidHandlePlacement=Bi.modify(l,s),i.active=!0,i.highlight=!0,l[s].x=a.mouseLocation.handles.start.x,l[s].y=a.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(s,l),s>=0){var c=l[t].lines.length-1,u=l[t].lines[c];u.x=a.mouseLocation.handles.start.x,u.y=a.mouseLocation.handles.start.y}y.cornerstone.updateImage(o)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,o=O(n,this.name);this._deactivateModify(n),this._dropHandle(t,o),this._endDrawing(n),y.cornerstone.updateImage(n)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,o=n.currentTool,r=t.data[o].handles,a=r.points;if(r.invalidHandlePlacement){var i,s=n.currentHandle,l=a[s];i=0===s?a[a.length-1]:a[s-1],l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,i.lines[0]=l,r.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,o=this.createNewMeasurement(n),r=n.element,a=this.configuration;e.type===w.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===w.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(r,t),this._getMouseLocation(n),L(r,this.name,o);var i=O(r,this.name);a.currentTool=i.data.length-1,this._activeDrawingToolReference=i.data[a.currentTool]}},{key:"_addPoint",value:function(e){var t=e.currentPoints,n=e.element,o=O(n,this.name),r=this.configuration,a=o.data[r.currentTool];if(!a.handles.invalidHandlePlacement){var i=new Ui(t.image);a.handles.points.length&&a.handles.points[r.currentHandle-1].lines.push(t.image),a.handles.points.push(i),r.currentHandle+=1,y.cornerstone.updateImage(n),this.fireModifiedEvent(n,a)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,o=this.configuration,r=e.element,a=o.mouseLocation.handles.start;t.every((function(e){return n._isDistanceLargerThanSpacing(r,e,a)}))&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=O(e,this.name),o=this.configuration,r=n.data[o.currentTool];if(r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1,void 0!==t){var a=r.handles.points;a[o.currentHandle-1].lines.push(a[0])}this._modifying&&(this._modifying=!1,r.invalidated=!0),o.currentHandle=0,o.currentTool=-1,r.canComplete=!1,this._drawing&&this._deactivateDraw(e),y.cornerstone.updateImage(e),this.fireModifiedEvent(e,r),this.fireCompletedEvent(e,r)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var o=0;o<t.handles.points.length;o++){var r=y.cornerstone.pixelToCanvas(e,t.handles.points[o]);if(y.cornerstoneMath.point.distance(r,n)<6)return o}return t.handles.textBox&&go(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.currentPoints,n=e.element,o=t.canvas,r=O(n,this.name);if(r)for(var a,i=0;i<r.data.length;i++)if(void 0!==(a=this._pointNearHandle(n,r.data[i],o)))return{handleNearby:a,toolIndex:i}}},{key:"_getMouseLocation",value:function(e){var t=e.currentPoints,n=e.image,o=this.configuration;o.mouseLocation.handles.start.x=t.image.x,o.mouseLocation.handles.start.y=t.image.y,In(o.mouseLocation.handles.start,n)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(e.handles.points.length<2)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,o=t.element,r=n.mouseLocation.handles.start,a=e.handles.points,i=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(o,a[0],r)&&!Bi.end(a)&&a.length>2?(e.canComplete=!0,i=!1):i=Bi.newHandle(r,a),i}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,o=e.handles.points,r=Bi.newHandle(n,o);return!1===r&&(r=this._invalidHandlePencilMode(e,t)),r}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,o=t.element,r=n.mouseLocation.handles.start,a=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(o,a[0],r))return e.canComplete=!0,!1;e.canComplete=!1;for(var i=1;i<a.length-1;i++)if(this._isDistanceSmallerThanSpacing(o,a[i],r))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var o,r=y.cornerstone.pixelToCanvas(e,t),a=y.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?o=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(o=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,r,a,"<",o)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===o?y.cornerstoneMath.point.distance(t,n)>r:y.cornerstoneMath.point.distance(t,n)<r}},{key:"_activateDraw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,vt.isMultiPartToolActive=!0,St(this.element),e.addEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(w.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(w.DOUBLE_TAP,this._drawingDoubleTapClickCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,vt.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,Et(this.element,this.svgCursor),e.removeEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(w.TOUCH_END,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){vt.isToolLocked=!0,e.addEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(w.TOUCH_END,this._editMouseUpCallback),e.addEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){vt.isToolLocked=!1,e.removeEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),y.cornerstone.updateImage(e)}}},{key:"fireModifiedEvent",value:function(e,t){T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"fireCompletedEvent",value:function(e,t){T(e,w.MEASUREMENT_COMPLETED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=O(e,this.name),n=this.configuration,o=t.data[n.currentTool];o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,o.canComplete=!1,k(e,this.name,o),this._deactivateDraw(e),y.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,o=this._activeDrawingToolReference;o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1;var r=o.handles.points;r[t.currentHandle-1].lines.push(r[0]),t.currentHandle=0,t.currentTool=-1,o.canComplete=!1,this._deactivateDraw(n),y.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,y.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,y.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,y.cornerstone.updateImage(this.element)}}]),t}(mr);function Fi(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}var ji=U("tools:annotation:LengthTool"),Hi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Mr,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return(e=u()(this,f()(t).call(this,n,o))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,o=t.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:n,y:o,highlight:!0,active:!1},end:{x:n,y:o,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}ji.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&gr(e,t.handles.start,t.handles.end,n)<25:(ji.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(e,t,n){var o=aa(e),r=o.rowPixelSpacing,a=o.colPixelSpacing,i=(n.handles.end.x-n.handles.start.x)*(a||1),s=(n.handles.end.y-n.handles.start.y)*(r||1),l=Math.sqrt(i*i+s*s);n.length=l,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=this.configuration,r=o.handleRadius,a=o.drawHandlesOnHover,i=o.hideHandlesIfMoving,s=o.renderDashed,l=o.digits,c=O(e.currentTarget,this.name);if(c)for(var u=Pn(n.canvasContext.canvas),d=n.image,f=n.element,h=aa(d),p=h.rowPixelSpacing,m=h.colPixelSpacing,g=Zt.getToolWidth(),v=xt("globalConfiguration").configuration.lineDash,y=function(e){var o=c.data[e];if(!1===o.visible)return"continue";Wt(u,(function(e){Ln(e,t.configuration);var c=un.getColorIfActive(o),u={color:c};s&&(u.lineDash=v),Kt(e,f,o.handles.start,o.handles.end,u);var h={color:c,handleRadius:r,drawHandlesIfActive:a,hideHandlesIfMoving:i};if(t.configuration.drawHandles&&dn(e,n,o.handles,h),!o.handles.textBox.hasMoved){var y={x:Math.max(o.handles.start.x,o.handles.end.x)};y.x===o.handles.start.x?y.y=o.handles.start.y:y.y=o.handles.end.y,o.handles.textBox.x=y.x,o.handles.textBox.y=y.y}!0===o.invalidated&&(o.length?t.throttledUpdateCachedStats(d,f,o):t.updateCachedStats(d,f,o));var b=function(e,t,n){var o,r,a=(o=e.length,r=Number(o),isNaN(r)?void 0:r);if(!a)return"";var i="mm";return t&&n||(i="pixels"),e.unit=i,"".concat(a.toFixed(l)," ").concat(i)}(o,p,m);An(e,f,o.handles.textBox,b,o.handles,x,c,g,10,!0)}))},b=0;b<c.data.length;b++)y(b);function x(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}}]),t}(mr),zi=function(e,t,n,o,r){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var a,i,s,l=y.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(i=0;i<r;i++)for(s=0;s<o;s++){var f=d[a=4*((i+n)*l.image.columns+(s+t))],h=d[a+1],p=d[a+2],m=d[a+3];c[u++]=f,c[u++]=h,c[u++]=p,c[u++]=m}return c},qi=U("tools:annotation:ProbeTool"),Wi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Pr,configuration:{drawHandles:!0,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,o))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};qi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var o=t&&t.handles&&t.handles.end;if(o||qi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var r=y.cornerstone.pixelToCanvas(e,t.handles.end);return y.cornerstoneMath.point.distance(r,n)<5}},{key:"updateCachedStats",value:function(e,t,n){var o=Math.round(n.handles.end.x),r=Math.round(n.handles.end.y),a={};o>=0&&r>=0&&o<e.columns&&r<e.rows&&(a.x=o,a.y=r,e.color?a.storedPixels=zi(t,o,r,1,1):(a.storedPixels=y.cornerstone.getStoredPixels(t,o,r,1,1),a.sp=a.storedPixels[0],a.mo=a.sp*e.slope+e.intercept,a.suv=Qa(e,a.sp))),n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=this.configuration,r=o.handleRadius,a=o.renderDashed,i=O(e.currentTarget,this.name);if(i)for(var s=Pn(n.canvasContext.canvas),l=n.image,c=n.element,u=vn.getFontSize(),d=xt("globalConfiguration").configuration.lineDash,f=function(e){var o=i.data[e];if(!1===o.visible)return"continue";Wt(s,(function(e){var i,s,f=un.getColorIfActive(o);if(t.configuration.drawHandles){var h={handleRadius:r,color:f};a&&(h.lineDash=d),dn(e,n,o.handles,h)}!0===o.invalidated&&(o.cachedStats?t.throttledUpdateCachedStats(l,c,o):t.updateCachedStats(l,c,o));var p=o.cachedStats,m=p.x,g=p.y,v=p.storedPixels,b=p.sp,x=p.mo,w=p.suv;if(m>=0&&g>=0&&m<l.columns&&g<l.rows){i="".concat(m,", ").concat(g),l.color?s="R: ".concat(v[0]," G: ").concat(v[1]," B: ").concat(v[2]):(s="SP: ".concat(b," MO: ").concat(parseFloat(x.toFixed(3))),w&&(s+=" SUV: ".concat(parseFloat(w.toFixed(3)))));var T={x:o.handles.end.x+3,y:o.handles.end.y-3},I=y.cornerstone.pixelToCanvas(n.element,T);wn(e,s,I.x,I.y+u+5,f),wn(e,i,I.x,I.y,f)}}))},h=0;h<i.data.length;h++)f(h)}}]),t}(mr),Gi=U("tools:annotation:RectangleRoiTool"),Yi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Dr};return(e=u()(this,f()(t).call(this,n,o))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Gi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,o){var r=t&&t.handles&&t.handles.start&&t.handles.end;if(r||Gi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var a="mouse"===o?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x),top:Math.min(i.y,s.y),width:Math.abs(i.x-s.x),height:Math.abs(i.y-s.y)};return y.cornerstoneMath.rect.distanceToPoint(l,n)<a}},{key:"updateCachedStats",value:function(e,t,n){var o=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=aa(e),a=function(e,t,n,o,r){var a,i=Zi(n.start,n.end),s=function(e,t){for(var n=0,o=0,r=0,a=0,i=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[a],o+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),r++,a++;if(0===r)return{count:r,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/r,d=o/r-u*u;return{count:r,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}}(y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),i);return"PT"===o&&(a={mean:Qa(e,s.mean,!0)||0,stdDev:Qa(e,s.stdDev,!0)||0}),{area:i.width*(r.colPixelSpacing||1)*(i.height*(r.rowPixelSpacing||1))||0,perimeter:2*i.width*(r.colPixelSpacing||1)+2*i.height*(r.rowPixelSpacing||1),count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:a}}(e,t,n.handles,o,r);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=O(e.currentTarget,this.name);if(n){var o=e.detail,r=o.image,a=o.element,i=Zt.getToolWidth(),s=xt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=Pn(o.canvasContext.canvas),p=aa(r),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=(y.cornerstone.metaData.get("generalSeriesModule",r.imageId)||{}).modality,b=m&&g;Wt(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=un.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};Ln(e,t.configuration);var g={color:p};if(f&&(g.lineDash=s),Mn(e,a,h.handles.start,h.handles.end,g,"pixel",h.handles.initialRotation),t.configuration.drawHandles&&dn(e,o,h.handles,m),!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(r,a,h):t.updateCachedStats(r,a,h)),!h.handles.textBox.hasMoved){var y=ni(o.viewport,h.handles);Object.assign(h.handles.textBox,y)}var x=Qi(e,r.color,h.cachedStats,v,b,t.configuration);h.unit=Ki(v,t.configuration.showHounsfieldUnits),An(e,a,h.handles.textBox,x,h.handles,(function(e){return n=(t=Zi(e.start,e.end)).left,o=t.top,[{x:n+(r=t.width)/2,y:o},{x:n,y:o+(a=t.height)/2},{x:n+r/2,y:o+a},{x:n+r,y:o+a/2}];var t,n,o,r,a}),p,i,10,!0)}}}))}}}]),t}(mr);function Zi(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function Xi(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(oi(e.toFixed(2))).concat(n)}function Ki(e,t){return"CT"===e&&!1!==t?"HU":""}function Qi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.area,r=void 0===o?0:o,a=n.mean,i=void 0===a?0:a,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,f=void 0===d?0:d,h=n.meanStdDevSUV,p=void 0===h?0:h,m=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=v.showMinMax||!1,b=[],x=[];if(!t){var w=p&&0!==p.mean,T=Ki(m,v.showHounsfieldUnits),I="Mean: ".concat(oi(i.toFixed(2))," ").concat(T),E="Std Dev: ".concat(oi(l.toFixed(2))," ").concat(T);if(w){for(var S=" SUV: ",C="".concat(S).concat(oi(p.mean.toFixed(2))),A="".concat(S).concat(oi(p.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(E,"     ")).width);e.measureText(I).width<M;)I+=" ";x.push("".concat(I).concat(C)),x.push("".concat(E,"     ").concat(A))}else x.push("".concat(I)),x.push("".concat(E));if(y){for(var P="Min: ".concat(u," ").concat(T),D="Max: ".concat(f," ").concat(T),L=w?Math.floor(e.measureText("".concat(E,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(P).width<L;)P+=" ";x.push("".concat(P).concat(D))}}return b.push(Xi(r,g)),x.forEach((function(e){return b.push(e)})),b}var Ji=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:$i},svgCursor:Lr};return(e=u()(this,f()(t).call(this,n,o))).touchPressCallback=e._changeText.bind(Co()(e)),e.doubleClickCallback=e._changeText.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},o={left:0,top:0,width:e.image.width,height:e.image.height};if(y.cornerstoneMath.point.insideRect(n.handles.end,o)){var r=t.markers.indexOf(t.current);return(r+=t.ascending?1:-1)>=t.markers.length?r=t.loop?0:-1:r<0&&(r=t.loop?t.markers.length:-1),t.current=t.markers[r],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var o=y.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),r=go(t.handles.end,n);return o<10||r}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,o=O(t.element,this.name);if(o)for(var r=Pn(t.canvasContext.canvas),a=function(e){var a=o.data[e];if(!1===a.visible)return"continue";var i=un.getColorIfActive(a);Wt(r,(function(e){Ln(e,n);var o=y.cornerstone.pixelToCanvas(t.element,a.handles.end);a.handles.end.boundingBox=wn(e,a.text,o.x,o.y-10,i,{centering:{x:!0,y:!0}})}))},i=0;i<o.data.length;i++)a(i)}},{key:"_changeText",value:function(e){var t,n=e.detail,o=n.element,r=n.currentPoints;function a(e,t,n){!0===n?k(o,this.name,e):e.text=t,e.active=!1,y.cornerstone.updateImage(o)}var i=this.configuration,s=r.canvas,l=O(o,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(o,t,s))return t.active=!0,y.cornerstone.updateImage(o),i.changeTextCallback(t,n,a),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(mr),$i=function(e,t,n){n(e,prompt("Change your annotation:"))},es=(U("tools:BrushTool"),xt("segmentation")),ts=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return(e=u()(this,f()(t).call(this,n,o))).touchDragCallback=e._paint.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_paint",value:function(e){var t=es.configuration,n=e.detail,o=(n.element,n.image),r=o.rows,a=o.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>a||l<0||l>r)){var c=we(t.radius,r,a,s,l),u=this.paintEventData,d=u.labelmap2D,f=u.labelmap3D,h=u.shouldErase;te(c,d.pixelData,f.activeSegmentIndex,a,h),y.cornerstone.updateImage(e.detail.element)}}}]),t}(Po),ns=U("tools:SphericalBrushTool"),os=xt("segmentation"),rs=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return(e=u()(this,f()(t).call(this,n,o))).touchDragCallback=e._paint.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_startPainting",value:function(e){var t,n=os.configuration,o=os.getters,r=e.detail,a=r.element,i=r.image,s=y.cornerstone,l=n.radius,c=i.rows,u=i.columns,d=Math.max(i.rowPixelSpacing,i.columnPixelSpacing),f=O(a,"stack").data[0].imageIds,h=o.labelmap2D(a),p=h.labelmap2D,m=h.labelmap3D,g=h.currentImageIdIndex,v=h.activeLabelmapIndex,b=this._isCtrlDown(r)||this.configuration.alwaysEraseOnClick,x=s.metaData.get("imagePlaneModule",i.imageId);if(x){var w=x.imagePositionPatient;t=this._getImagesInRange(g,w,f,l,d)}else ns.warn("No imagePlane metadata found for image, defaulting to circle brush application."),t=[{imageIdIndex:g,radiusOnImage:l}];if(this.paintEventData={labelmap2D:p,labelmap3D:m,currentImageIdIndex:g,activeLabelmapIndex:v,shouldErase:b,imagesInRange:t},n.storeHistory){for(var T=[],I=0;I<t.length;I++){var E=t[I].imageIdIndex,S=o.labelmap2DByImageIdIndex(m,E,c,u).pixelData.slice();T.push(S)}this.paintEventData.previousPixeldataForImagesInRange=T}}},{key:"_paint",value:function(e){var t=os.getters,n=e.detail,o=(n.element,n.image),r=o.rows,a=o.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>a||l<0||l>r)){for(var c=this.paintEventData,u=c.labelmap3D,d=c.imagesInRange,f=c.shouldErase,h=0;h<d.length;h++){var p=d[h],m=p.imageIdIndex;te(we(p.radiusOnImage,r,a,s,l),t.labelmap2DByImageIdIndex(u,m,r,a).pixelData,u.activeSegmentIndex,a,f)}y.cornerstone.updateImage(e.detail.element)}}},{key:"_getImagesInRange",value:function(e,t,n,o,r){for(var a=o*r,i=[{imageIdIndex:e,radiusOnImage:o}],s=e+1;s<n.length;s++){var l=this._getRadiusOnImage(n[s],t,a,r);if(!l)break;i.push({imageIdIndex:s,radiusOnImage:l})}for(var c=e-1;c>=0;c--){var u=this._getRadiusOnImage(n[c],t,a,r);if(!u)break;i.push({imageIdIndex:c,radiusOnImage:u})}return i}},{key:"_getRadiusOnImage",value:function(e,t,n,o){var r=y.cornerstone.metaData.get("imagePlaneModule",e);if(r){var a=r.imagePositionPatient,i=Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2)+Math.pow(a[2]-t[2],2));if(!(i>n))return Math.floor(Math.sqrt(Math.pow(n,2)-Math.pow(i,2))/o)}else ns.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(e,","))}},{key:"_endPainting",value:function(e){for(var t=this.paintEventData,n=t.labelmap3D,o=t.imagesInRange,r=[],a=os.configuration,i=os.setters,s=0;s<o.length;s++){for(var l=o[s].imageIdIndex,c=n.labelmaps2D[l],u=new Set(c.pixelData).values(),d=[],f=!1;!f;){var h=u.next();(f=h.done)||d.push(h.value)}if(c.segmentsOnLabelmap=d,a.storeHistory){var p=this.paintEventData.previousPixeldataForImagesInRange[s],m=n.labelmaps2D[l].pixelData;r.push({imageIdIndex:l,diff:ke(p,m)})}}a.storeHistory&&i.pushState(this.element,r),Oe(this.element)}}]),t}(Po),as=U("util:segmentation:operations:correction");function is(e,t){var n=t.pixelData,o=t.segmentIndex,r=t.segmentationMixinType;if("freehandSegmentationMixin"===r){var a=function(e,t){for(var n=t.pixelData,o=t.points,r=e.detail.image,a=r.width,i=r.height,s=[],l=0;l<o.length;l++){var c=o[l],u=Math.floor(c.x),d=Math.floor(c.y);u=Cn(u,0,a-1),d=Cn(d,0,i-1);var f=s[s.length-1];f&&u===f.x&&d===f.y||s.push({x:u,y:d,segment:n[d*a+u]})}return s}(e,t),i=function(e,t){for(var n=!0,o=!0,r=0;r<e.length&&(e[r].segment===t?o=!1:n=!1,n||o);r++);return o?{isScissorOperation:!0,operation:"fillInsideFreehand"}:n?{isScissorOperation:!0,operation:"eraseInsideFreehand"}:{isScissorOperation:!1}}(a,o);if(i.isScissorOperation)"fillInsideFreehand"===i.operation?(as.warn("The line never intersects a segment."),ws(e,t)):"eraseInsideFreehand"===i.operation&&(as.warn("The line is only ever inside the segment."),hs(e,t));else{var s=new Uint8Array(n.length);(function(e,t){var n=e[0].segment===t,o=[];o.push({additive:!n,nodes:[]});for(var r=0,a=0;a<e.length;a++){var i=e[a];n?(o[r].nodes.push(i),i.segment!==t&&(r++,n=!n,o.push({additive:!0,nodes:[]}),o[r].nodes.push(e[a-1]),o[r].nodes.push(i))):(o[r].nodes.push(i),i.segment===t&&(r++,n=!n,o.push({additive:!1,nodes:[]}),o[r].nodes.push(e[a-1]),o[r].nodes.push(i)))}return o.pop(),o.shift(),o})(a,o).forEach((function(t){!function(e,t,n,o,r){var a=r.detail.image,i=a.width,s=a.height,l=e.nodes,c=e.additive,u=c?0:1,d=function(e){return e.y*i+e.x},f=function(e){return{x:e%i,y:Math.floor(e/i)}};c?as.warn("additive operation..."):as.warn("subtractive operation...");for(var h=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push(e[n]),t.push.apply(t,J()(Ee(e[n],e[n+1])));t.push[e[e.length-1]];for(var o=[],r=[],a=0;a<t.length-1;a++){var i=cs(t[a],t[a+1]),s=i.left,l=i.right;o.push(s),r.push(l)}return{pixelPath:t,leftPath:o,rightPath:r}}(l),p=h.pixelPath,m=h.leftPath,g=h.rightPath,v=p[0],y={xMin:v.x,xMax:v.x,yMin:v.y,yMax:v.y},b=0;b<n.length;b++)t[b]===o?(ss(y,f(b)),n[b]=1):n[b]=0;for(var x=0;x<p.length;x++){var w=p[x];n[d(w)]=2,ss(y,w)}!function(e,t,n){e.xMax=Math.min(e.xMax+2,n),e.xMin=Math.max(e.xMin-2,0),e.yMax=Math.min(e.yMax+2,t),e.yMin=Math.max(e.yMin-2,0)}(y,s,i);var T=y.xMin,I=y.xMax,E=y.yMin,S=y.yMax;function C(e,t){if(!(e>=I||e<T||t>=S||t<E))return n[t*i+e]}for(var A=0,M=0,P=0;P<m.length;P++){var D=m[P];n[d(D)]===u&&Ge(D,s,i)&&(A+=ls(D,3,n,C,i));var L=g[P];n[d(L)]===u&&Ge(L,s,i)&&(M+=ls(L,4,n,C,i))}if(0!==A&&0!==M){for(var O=c?o:0,k=A<M?3:4,R=0;R<n.length;R++)n[R]===k&&(t[R]=O);if(O===o)for(var _=0;_<p.length;_++)t[d(p[_])]=o;else for(var N=0;N<p.length;N++){var B=d(p[N]);t[B]===o&&(t[B]=0)}}}(t,n,s,o,e)}))}}else as.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(r))}function ss(e,t){var n=t.x,o=t.y;n<e.xMin&&(e.xMin=n),n>e.xMax&&(e.xMax=n),o<e.yMin&&(e.yMin=o),o>e.yMax&&(e.yMax=o)}function ls(e,t,n,o,r){for(var a=pe(o,[e.x,e.y]).flooded,i=0;i<a.length;i++){var s=a[i];n[s[1]*r+s[0]]=t}return a.length}function cs(e,t){var n={x:t.x-e.x,y:t.y-e.y};return-1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y-1},right:{x:e.x+1,y:e.y+1}}:0===n.x&&1===n.y?{left:{x:e.x-1,y:e.y},right:{x:e.x+1,y:e.y}}:1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y+1},right:{x:e.x+1,y:e.y-1}}:1===n.x&&0===n.y?{left:{x:e.x,y:e.y+1},right:{x:e.x,y:e.y-1}}:1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y+1},right:{x:e.x-1,y:e.y-1}}:0===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y},right:{x:e.x-1,y:e.y}}:-1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y-1},right:{x:e.x-1,y:e.y+1}}:-1===n.x&&0===n.y?{left:{x:e.x,y:e.y-1},right:{x:e.x,y:e.y+1}}:void as.error("Unable to find left and right paths for flood fill ",e,t,n)}function us(e,t){for(var n=e[0],o=e[1],r=!1,a=0,i=t.length-1;a<t.length;i=a++){var s=t[a][0],l=t[a][1],c=t[i][0],u=t[i][1];l>o!=u>o&&n<(c-s)*(o-l)/(u-l)+s&&(r=!r)}return r}var ds=U("util:segmentation:operations:eraseInsideFreehand");function fs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,r=t.segmentationMixinType;if("freehandSegmentationMixin"===r){var a=e.detail.image,i=o.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=re()(s,2),c=l[0],u=l[1];n?se(e,t,(function(e){return us([e.x,e.y],i)}),c,u):le(e,t,(function(e){return us([e.x,e.y],i)}),c,u)}else ds.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(r))}function hs(e,t){fs(e,t,!0)}function ps(e,t){fs(e,t,!1)}var ms=U("util:segmentation:operations:eraseInsideRectangle");function gs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,r=t.segmentationMixinType;if("rectangleSegmentationMixin"===r){var a=e.detail.image,i=o.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=re()(s,2),c=l[0],u=l[1];n?se(e,t,(function(){return!0}),c,u):ne(e,t,c,u)}else ms.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(r))}function vs(e,t){gs(e,t,!0)}function ys(e,t){gs(e,t,!1)}var bs=U("util:segmentation:operations:fillInsideFreehand");function xs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,r=t.segmentationMixinType;if("freehandSegmentationMixin"===r){var a=e.detail.image,i=o.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=re()(s,2),c=l[0],u=l[1];n?fe(e,t,(function(e){return us([e.x,e.y],i)}),c,u):he(e,t,(function(e){return us([e.x,e.y],i)}),c,u)}else bs.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(r))}function ws(e,t){xs(e,t,!0)}function Ts(e,t){xs(e,t,!1)}var Is=U("util:segmentation:operations:fillInsideRectangle");function Es(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.points,r=t.segmentationMixinType;if("rectangleSegmentationMixin"===r){var a=e.detail.image,i=o.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=re()(s,2),c=l[0],u=l[1];n?fe(e,t,(function(){return!0}),c,u):ce(e,t,c,u)}else Is.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(r))}function Ss(e,t){Es(e,t,!0)}function Cs(e,t){Es(e,t,!1)}var As=U("util:segmentation:operations:fillCircle");function Ms(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.segmentationMixinType;if("circleSegmentationMixin"===o){var r=e.detail,a=be(e),i=re()(a,2),s=i[0],l=i[1],c=ye(r.handles.start,r.handles.end);n?fe(e,t,(function(e){return $a(c,e)}),s,l):he(e,t,(function(e){return $a(c,e)}),s,l)}else As.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(o))}function Ps(e,t){Ms(e,t,!0)}function Ds(e,t){Ms(e,t,!1)}var Ls=U("util:segmentation:operations:eraseInsideCircle");function Os(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.segmentationMixinType;if("circleSegmentationMixin"===o){var r=e.detail,a=be(e),i=re()(a,2),s=i[0],l=i[1],c=ye(r.handles.start,r.handles.end);n?se(e,t,(function(e){return $a(c,e)}),s,l):le(e,t,(function(e){return $a(c,e)}),s,l)}else Ls.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(o))}function ks(e,t){Os(e,t,!0)}function Rs(e,t){Os(e,t,!1)}var _s=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"FreehandScissors",strategies:{FILL_INSIDE:ws,FILL_OUTSIDE:Ts,ERASE_OUTSIDE:ps,ERASE_INSIDE:hs},cursors:{FILL_INSIDE:Zr,FILL_OUTSIDE:Kr,ERASE_OUTSIDE:Xr,ERASE_INSIDE:Yr},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Zr,mixins:["freehandSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(mo),Ns=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RectangleScissors",strategies:{FILL_INSIDE:Ss,FILL_OUTSIDE:Cs,ERASE_OUTSIDE:ys,ERASE_INSIDE:vs},cursors:{FILL_INSIDE:Jr,FILL_OUTSIDE:ea,ERASE_OUTSIDE:$r,ERASE_INSIDE:Qr},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(mo),Bs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CircleScissors",strategies:{FILL_INSIDE:Ps,FILL_OUTSIDE:Ds,ERASE_OUTSIDE:Rs,ERASE_INSIDE:ks},cursors:{FILL_INSIDE:na,FILL_OUTSIDE:ra,ERASE_OUTSIDE:oa,ERASE_INSIDE:ta},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:na,mixins:["circleSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(mo),Us=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CorrectionScissors",strategies:{CORRECTION:is},cursors:{CORRECTION:Zr},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Zr,mixins:["polylineSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(mo),Vs={},Fs={},js={};function Hs(e){if(!e)return"DEFAULT";var t=y.cornerstone.getEnabledElement(e).uuid;if(!t)throw new Error("Something went wrong when getting uuid from element");return t}var zs={setStartLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);Vs[n]=e},getStartLoadHandler:function(e){var t=Hs(e);return Vs[t]||Vs.DEFAULT},setEndLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);Fs[n]=e},getEndLoadHandler:function(e){var t=Hs(e);return Fs[t]||Fs.DEFAULT},setErrorLoadingHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);js[n]=e},getErrorLoadingHandler:function(e){var t=Hs(e);return js[t]||js.DEFAULT},removeHandlers:function(e){var t=Hs(e);delete Vs[t],delete Fs[t],delete js[t]}},qs={};function Ws(e,t){if(!qs[e])return{};var n=qs[e].find((function(e){return e.element===t}));return n?n.options:{}}function Gs(e,t,n){if(qs[e]){var o=qs[e].findIndex((function(e){return e.element===t}));if(-1===o)qs[e].push({element:t,options:n});else{var r=qs[e][o].options||{};qs[e][o].options=Object.assign(r,n)}}else qs[e]=[{element:t,options:n}]}var Ys=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Or};return(e=u()(this,f()(t).call(this,n,o))).preMouseDownCallback=e._chooseLocation.bind(Co()(e)),e.mouseDragCallback=e._chooseLocation.bind(Co()(e)),e.touchDragCallback=e._chooseLocation.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var o=O(n,this.name);if(o){var r=n,a=y.cornerstone.getEnabledElement(r).image.imageId,i=y.cornerstone.metaData.get("imagePlaneModule",a);if(i){var s=nn(t.currentPoints.image,i);o.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==r){var t=Number.MAX_VALUE,n=-1,o=O(e,"stack");if(void 0!==o){var a=o.data[0];if(a.imageIds.forEach((function(e,o){var r=y.cornerstone.metaData.get("imagePlaneModule",e);if(r&&r.imagePositionPatient&&r.rowCosines&&r.columnCosines){var a=en(r.imagePositionPatient),i=en(r.rowCosines),l=en(r.columnCosines).clone().cross(i.clone()),c=Math.abs(l.clone().dot(a)-l.clone().dot(s));c<t&&(t=c,n=o)}})),n!==a.currentImageIdIndex&&-1!==n&&void 0!==a.imageIds[n]){var i=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);i&&i(e),(!0===a.preventCache?y.cornerstone.loadImage(a.imageIds[n]):y.cornerstone.loadAndCacheImage(a.imageIds[n])).then((function(t){var o=y.cornerstone.getViewport(e);a.currentImageIdIndex=n,y.cornerstone.displayImage(e,t,o),l&&l(e,t)}),(function(t){var o=a.imageIds[n];c&&c(e,o,t)}))}}}}))}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,o=t.synchronizationContext;Gs(this.name,e,{mouseButtonMask:n}),R(e,this.name),L(e,this.name,{synchronizationContext:o})}}]),t}(mo),Zs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;y.cornerstone.fitToWindow(t.element)}}]),t}(mo),Xs=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"DragProbe",strategies:{default:Ks,minimal:Qs},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Pr};return(e=u()(this,f()(t).call(this,n,o))).touchDragCallback=e._movingEventCallback.bind(Co()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(Co()(e)),e.mouseDragCallback=e._movingEventCallback.bind(Co()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(Co()(e)),e.dragEventData={},e}return p()(t,e),l()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,y.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},y.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(mo);function Ks(e){var t=this.configuration,n=y.cornerstone,o=e.detail,r=o.element,a=o.image,i=o.currentPoints,s=o.canvasContext,l=Pn(s.canvas),c=un.getActiveColor(),u=vn.getFontSize(),d=Math.round(i.image.x),f=Math.round(i.image.y);d<0||f<0||d>=a.columns||f>=a.rows||Wt(l,(function(e){Ln(e,t);var o,s,l="".concat(d,", ").concat(f);if(a.color)o=zi(r,d,f,1,1),s="R: ".concat(o[0]," G: ").concat(o[1]," B: ").concat(o[2]," A: ").concat(o[3]);else{var h=(o=n.getStoredPixels(r,d,f,1,1))[0],p=h*a.slope+a.intercept,m=Qa(a,h);s="SP: ".concat(h," MO: ").concat(parseFloat(p.toFixed(3))),m&&(s+=" SUV: ".concat(parseFloat(m.toFixed(3))))}var g={x:i.canvas.x+5,y:i.canvas.y-5};wn(e,s,g.x,g.y+u+5,c),wn(e,l,g.x,g.y,c)}))}function Qs(e){var t=this.configuration,n=y.cornerstone,o=e.detail,r=o.element,a=o.image,i=o.currentPoints,s=o.canvasContext,l=o.isTouchEvent,c=Pn(s.canvas),u=un.getActiveColor(),d=i.page.y-vn.getFontSize()/2;l&&(d=i.page.y-4*vn.getFontSize());var f=n.pageToPixel(r,i.page.x,d);f.x<0||f.y<0||f.x>=a.columns||f.y>=a.rows||Wt(c,(function(e){Ln(e,t);var o,i=n.metaData.get("generalSeriesModule",a.imageId),s=i&&i.modality,c="";if(a.color)o=zi(r,f.x,f.y,1,1),c="R: ".concat(o[0]," G: ").concat(o[1]," B: ").concat(o[2]);else{var d=(o=n.getStoredPixels(r,f.x,f.y,1,1))[0],h=d*a.slope+a.intercept,p=parseFloat(h.toFixed(2));if("CT"===s)c+="HU: ".concat(p);else if("PT"===s){c+=p;var m=Qa(a,d);m&&(c+=" SUV: ".concat(parseFloat(m.toFixed(2))))}else c+=p}var g=n.pixelToCanvas(r,f),v={x:12,y:-(vn.getFontSize()+10)/2},y=xn(e,c,5);l&&(v={x:-y/2,y:-vn.getFontSize()-10-12}),$t(e,r,g,6,{color:u},"canvas"),wn(e,c,g.x+v.x,g.y+v.y,u)}))}var Js=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:kr};return(e=u()(this,f()(t).call(this,n,o))).preMouseDownCallback=e._deleteAllNearbyTools.bind(Co()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;return vt.tools.forEach((function(e){var o=O(n,e.name);o&&o.data.forEach((function(o){"function"==typeof e.pointNearTool&&e.pointNearTool(n,o,t)&&(k(n,e.name,o),y.cornerstone.updateImage(n))}))})),!0}}]),t}(mo),$s=Oi.FreehandHandleData,el=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:tl(),svgCursor:Ar};return(e=u()(this,f()(t).call(this,n,o))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.referencedToolName=e.initialConfiguration.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(Co()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(Co()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,o=this.configuration;if(!O(n,this.referencedToolName).data[o.currentTool])return!1;if(this._active){var r=t.canvasContext.canvas.getContext("2d"),a={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};dn(r,t,this.configuration.mouseLocation.handles,a)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,o=O(n.element,this.referencedToolName);if(o){var r=o.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,r),y.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,o=this.configuration;this._active=!1,vt.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),o.mouseUpRender=!0,this._deactivateSculpt(n),y.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,o=n.element,r=n.canvasContext.canvas.getContext("2d"),a=O(o,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=vt.mousePositionImage;var i=Tt(o,this.referencedToolName).distanceFromPointCanvas(o,a,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=i;i=this._limitCursorRadiusCanvas(n,i),s>this.configuration.hoverCursorFadeDistance*i&&(r.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:i};dn(r,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(r.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,o=this._getClosestFreehandToolOnElement(n,e);void 0!==o&&(t.currentTool=o,St(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=O(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var o=0;o<n.length;o++)n[o].active=o===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,o=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,vt.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(o,n.currentTool),this._activateSculpt(o),y.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:Math.max(this._toolSizeImage,2*n.minSpacing)};var o=this._pushHandles();void 0!==o.first&&(this._insertNewHandles(o),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,o=e.toolSize,r={},a=0;a<t.length;a++){var i=y.cornerstoneMath.point.distance(t[a],n);i>o||(this._pushOneHandle(a,i),void 0===r.first?(r.first=a,r.last=a):r.last=a)}return r}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,o=n.points,r=n.mousePoint,a=n.toolSize,i=n.image,s=o[e],l=(s.x-r.x)/t,c=(s.y-r.y)/t,u={x:r.x+a*l,y:r.y+a*c};In(u,i),s.x=u.x,s.y=u.y;var d=this.constructor._getPreviousHandleIndex(e,o.length);o[d].lines.pop(),o[d].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,o=0;o<t.length;o++){var r=t[o]+1+n;this._insertHandleRadially(r),n++}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,o=t.maxSpacing,r=[],a=e.first;a<=e.last;a++)this._checkSpacing(a,n,r,o);var i=this.constructor._getNextHandleIndex(e.last,n.length);if(i!==e.first){this._checkSpacing(i,n,r,o);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==i&&this._checkSpacing(s,n,r,o)}return r}},{key:"_checkSpacing",value:function(e,t,n,o){var r=this.constructor._getNextHandleIndex(e,t.length);y.cornerstoneMath.point.distance(t[e],t[r])>o&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,o=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),r=this._getInsertPosition(e,n,o),a=new $s(r);t.splice(e,0,a),t[n].lines.pop(),t[n].lines.push(t[e]),Oi.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(this._sculptData.points.length<=3)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,o=[],r=t.length,a=0;a<r;a++){var i=this.constructor._getNextHandleIndex(a,t.length);if(y.cornerstoneMath.point.distance(t[a],t[i])<n){var s=[a,i];o.push(s),0===a&&(r-=1),a++}}return o}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0;n<e.length;n++){var o=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(o),t++}var r=this._findCloseHandlePairs();r.length&&this._mergeCloseHandles(r)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,o=t.image,r={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};In(r,o),n[e[0]].x=r.x,n[e[0]].y=r.y;var a=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[a]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,o=n.currentTool,r=e.currentPoints.image,a=O(t,this.referencedToolName).data[o],i=Tt(t,this.referencedToolName),s=i.distanceFromPoint(t,a,r),l=i.distanceFromPointCanvas(t,a,r);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,In(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;O(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=O(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var o=0;o<n.data.length;o++)n.data[o].active=!1;Et(this.element,this.svgCursor),y.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e.element,r=e.image,a=this.configuration,i=O(o,this.referencedToolName).data[a.currentTool],s=1;if(n){var l=y.cornerstone.pixelToCanvas(o,{x:0,y:0}),c=y.cornerstone.pixelToCanvas(o,{x:r.width,y:r.height});s=(c.x-l.x)*(c.y-l.y)/(r.width*r.height)}var u=i.area*s,d=Math.pow(u/Math.PI,.5);return Math.min(t,d)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=Tt(e,this.referencedToolName),o=O(e,this.referencedToolName);if(o){for(var r=o.data,a=t.currentPoints.image,i={distance:1/0,toolIndex:null},s=0;s<r.length;s++){var l=n.distanceFromPoint(e,r[s],a);-1!==l&&l<i.distance&&(i.distance=l,i.toolIndex=s)}return i.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var o,r=this._sculptData,a=r.points,i=r.toolSize,s=r.mousePoint,l=r.image,c={x:(a[t].x+a[n].x)/2,y:(a[t].y+a[n].y)/2},u=y.cornerstoneMath.point.distance(s,c);if(u<i){var d={x:(c.x-s.x)/u,y:(c.y-s.y)/u};o={x:s.x+i*d.x,y:s.y+i*d.y}}else o=c;return In(o,l),o}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,y.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,y.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(mo);function tl(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:un.getActiveColor(),hoverColor:un.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}var nl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:Rr};return(e=u()(this,f()(t).call(this,n,o))).zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(Co()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(Co()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(Co()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(Co()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(Co()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(Co()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(Co()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(Co()(e)),e.newImageCallback=e._drawMagnificationTool.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame((function(){return t._drawMagnificationTool(e)})),St(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;Et(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var o=t.querySelector("canvas:not(.magnifyTool)"),r=Pn(n),a=y.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),i=Math.min(this.configuration.magnifySize,o.width,o.height),s=this.configuration.magnificationLevel;n.width=i,n.height=i,a.x=Math.max(a.x,.5*i/s),a.x=Math.min(a.x,o.width-.5*i/s),a.y=Math.max(a.y,.5*i/s),a.y=Math.min(a.y,o.height-.5*i/s);var l={x:a.x*s-.5*i,y:a.y*s-.5*i};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),r.drawImage(this.zoomCanvas,l.x,l.y,i,i,0,0,i,i);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(a.y-.5*i-c,0),left:Math.max(a.x-.5*i,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,o.height-d.height),u.left=Math.min(u.left,o.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=y.cornerstone.getEnabledElement(t));var o=this.configuration.magnificationLevel,r=n.canvas,a=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=r.width*o,this.zoomElement.height=r.height*o,y.cornerstone.enable(this.zoomElement,n.options));var i=y.cornerstone.getEnabledElement(this.zoomElement),s=y.cornerstone.getViewport(n.element);this.zoomCanvas=i.canvas,this.zoomCanvas.width=r.width*o,this.zoomCanvas.height=r.height*o,i.viewport=Object.assign({},s),s.scale*=o,y.cornerstone.displayImage(this.zoomElement,a),y.cornerstone.setViewport(this.zoomElement,s)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(y.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}]),t}(mo),ol=bt.globalConfiguration,rl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},r=Object.assign(o,n);return(e=u()(this,f()(t).call(this,r))).initialConfiguration=r,e}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"setupRender",value:function(e){if(e){var t=y.cornerstone.metaData.get("overlayPlaneModule",e.imageId);if(t&&t.overlays&&t.overlays.length)return t}}},{key:"setupViewport",value:function(e){if(void 0===e.overlayColor&&(e.overlayColor=ol.configuration.overlayColor||"white"),!1!==e.overlayColor)return!0}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.enabledElement,o=t.image,r=t.viewport,a=t.canvasContext,i=this.setupRender(o);if(t&&n&&i&&this.setupViewport(r)){var s=o.columns,l=o.rows;i.overlays.forEach((function(e){if(!1!==e.visible){var t=document.createElement("canvas");t.width=s,t.height=l;var n=t.getContext("2d");n.fillStyle=e.fillStyle||r.overlayColor,"R"===e.type&&(n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation="xor");for(var o=0,i=0;i<e.rows;i++)for(var c=0;c<e.columns;c++)e.pixelData[o++]>0&&n.fillRect(c,i,1,1);var u=!isNaN(parseFloat(e.x))&&isFinite(e.x)?e.x:0,d=!isNaN(parseFloat(e.y))&&isFinite(e.y)?e.y:0;a.drawImage(t,u,d)}}))}}}]),t}(mo),al={getOrientationString:function(e){for(var t=en(e),n="",o=t.x<0?"R":"L",r=t.y<0?"A":"P",a=t.z<0?"F":"H",i=new y.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=1e-4,l=0;l<3;l++)if(i.x>s&&i.x>i.y&&i.x>i.z)n+=o,i.x=0;else if(i.y>s&&i.y>i.x&&i.y>i.z)n+=r,i.y=0;else if(i.z>s&&i.z>i.x&&i.z>i.y)n+=a,i.z=0;else if(i.x>s&&i.y>s&&i.x===i.y)n+=o+r,i.x=0,i.y=0;else if(i.x>s&&i.z>s&&i.x===i.z)n+=o+a,i.x=0,i.z=0;else{if(!(i.y>s&&i.z>s&&i.y===i.z))break;n+=r+a,i.y=0,i.z=0}return n},invertOrientationString:function(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},il=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){var t=y.cornerstone;t.getEnabledElement(e).image&&t.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Pn(t.canvasContext.canvas),o=t.element,r=cl(o);if(r){var a=ul(o,r),i=un.getToolColor(),s={top:xn(n,r.top,0),left:xn(n,r.left,0),right:xn(n,r.right,0),bottom:xn(n,r.bottom,0),height:xn(n,"M",0)};sl(n,r,a,s,i),this.configuration.drawAllMarkers&&ll(n,r,a,s,i)}}}]),t}(mo),sl=function(e,t,n,o,r){wn(e,t.top,n.top.x-o.top/2,n.top.y,r),wn(e,t.left,n.left.x-o.left/2,n.left.y,r)},ll=function(e,t,n,o,r){wn(e,t.right,n.right.x-o.right,n.right.y,r),wn(e,t.bottom,n.bottom.x-o.bottom/2,n.bottom.y-o.height,r)},cl=function(e){var t=y.cornerstone,n=t.getEnabledElement(e),o=t.metaData.get("imagePlaneModule",n.image.imageId);if(o&&o.rowCosines&&o.columnCosines){var r=al.getOrientationString(o.rowCosines),a=al.getOrientationString(o.columnCosines),i=al.invertOrientationString(r);return{top:al.invertOrientationString(a),bottom:a,left:i,right:r}}},ul=function(e){var t=y.cornerstone.getEnabledElement(e);return{top:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:5}),bottom:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:t.image.height-15}),left:y.cornerstone.pixelToCanvas(e,{x:5,y:t.image.height/2}),right:y.cornerstone.pixelToCanvas(e,{x:t.image.width-10,y:t.image.height/2})}},dl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return(e=u()(this,f()(t).call(this,n,o))).multiTouchDragCallback=e._dragCallback.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport;if(t.numPointers===this.configuration.touchPointers){var r=this._getTranslation(t);this._applyTranslation(o,r),y.cornerstone.setViewport(n,o)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,o=e.deltaPoints,r=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:o.page.x/r,y:o.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(mo),fl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_r};return(e=u()(this,f()(t).call(this,n,o))).touchDragCallback=e._dragCallback.bind(Co()(e)),e.mouseDragCallback=e._dragCallback.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,r=this._getTranslation(t);this._applyTranslation(o,r),y.cornerstone.setViewport(n,o)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,o=e.deltaPoints,r=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:o.page.x/r,y:o.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(mo),hl=n(11),pl=n.n(hl),ml=n(13),gl=n.n(ml),vl=function(e,t,n,o){var r=y.cornerstone,a=r.getEnabledElement(n).image,i=r.getEnabledElement(o).image;if(a&&i){var s=r.metaData.get("imagePlaneModule",a.imageId),l=r.metaData.get("imagePlaneModule",i.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=en(s.rowCosines),s.columnCosines=en(s.columnCosines),s.imagePositionPatient=en(s.imagePositionPatient),l.rowCosines=en(l.rowCosines),l.columnCosines=en(l.columnCosines),l.imagePositionPatient=en(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!((d=Math.abs(d))<.5)){var f=function(e,t){var n=on(e,t);if(n)return{start:tn(n.start,e),end:tn(n.end,e)}}(s,l);if(f){var h=un.getActiveColor();e.setTransform(1,0,0,1,0,0),Wt(e,(function(e){Kt(e,t.element,f.start,f.end,{color:h})}))}}}}},yl=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function bl(e){try{var t=y.cornerstone.getEnabledElement(e);return t.image?t:yl(250).then((function(){return bl(e)}))}catch(e){return null}}var xl=U("tools:ReferenceLinesTool"),wl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:vl}};return(e=u()(this,f()(t).call(this,n,o))).renderer=null,e.synchronizationContext=null,e}var n;return p()(t,e),l()(t,[{key:"enabledCallback",value:(n=gl()(pl.a.mark((function e(t){var n,o,r,a=arguments;return pl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},o=n.synchronizationContext,r=this.configuration.renderer,e.next=4,bl(t);case 4:if(e.sent&&r&&o){e.next=8;break}return xl.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=r,this.synchronizationContext=o,this.forceImageUpdate(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var o=this.synchronizationContext.getSourceElements(),r=Pn(n.canvasContext.canvas);y.cornerstone.setToPixelCoordinateSystem(n.enabledElement,r),o.forEach((function(o){o!==e.currentTarget&&t.renderer(r,n,e.currentTarget,o)}))}}}]),t}(mo),Tl=function(e,t,n){var o=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),r=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(o,2)+Math.pow(r,2)-Math.pow(a,2))/(2*o*r))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},Il=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Rotate",strategies:{default:El,horizontal:Sl,vertical:Cl},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:Nr};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(mo);function El(e){var t=this.configuration,n=t.roundAngles,o=t.rotateScale,r=e.detail,a=r.element,i=r.viewport,s=r.startPoints,l=r.currentPoints,c=i.initialRotation?i.initialRotation:i.rotation,u=a.getBoundingClientRect(a),d=a.clientWidth,f=a.clientHeight,h=i.scale,p=i.translation,m={x:u.left+d/2+p.x*h,y:u.top+f/2+p.y*h},g=Tl(m,s.client,l.client);g.angle*=o,n&&(g.angle=Math.ceil(g.angle)),g.direction<0&&(g.angle=-g.angle),i.rotation=c+g.angle}function Sl(e){var t=this.configuration,n=t.roundAngles,o=t.flipHorizontal,r=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.x,d=(l.client.x-u)*r;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),o&&(d=-d),i.rotation=c+d}function Cl(e){var t=this.configuration,n=t.roundAngles,o=t.flipVertical,r=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.y,d=(l.client.y-u)*r;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),o&&(d=-d),i.rotation=c+d}var Al=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,r=t.rotation;o.rotation+=r,y.cornerstone.setViewport(n,o)}}]),t}(mo),Ml=U("tools:ScaleOverlayTool"),Pl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Pn(t.canvasContext.canvas),o=t.image,r=t.viewport,a=t.element,i=o.rowPixelSpacing,s=o.columnPixelSpacing,l=y.cornerstone.metaData.get("imagePlaneModule",o.imageId);if(l&&(i=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),i&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/i*r.scale,d=10/s*r.scale,f=Dl(c,.25,.05),h=Dl(c,.05,.15);if(c.width&&c.height&&f&&h){var p=un.getToolColor(),m=Zt.getToolWidth(),g=Object.assign({},{hscaleBounds:f,vscaleBounds:h,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:h.bottomRight.x,y:h.topLeft.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},horizontalLine:{start:{x:f.topLeft.x,y:f.bottomRight.y},end:{x:f.bottomRight.x,y:f.bottomRight.y}},color:p,lineWidth:m},this.configuration);Wt(n,(function(e){Ln(e,g),Kt(e,a,g.verticalLine.start,g.verticalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),Ll(e,a,g),Kt(e,a,g.horizontalLine.start,g.horizontalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),Ol(e,a,g)}))}}else Ml.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(mo),Dl=function(e,t,n){var o=t*Math.min(1e3,e.width),r=n*Math.min(1e3,e.height),a={left:o,top:r,width:e.width-2*o,height:e.height-2*r};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},Ll=function(e,t,n){for(var o=0;n.verticalLine.start.y+o*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var r=n.color,a=n.lineWidth,i={x:n.verticalLine.start.x,y:n.verticalLine.start.y+o*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+o*n.verticalMinorTick};s.x=o%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Kt(e,t,i,s,{color:r,lineWidth:a},"canvas"),o++}},Ol=function(e,t,n){for(var o=0;n.horizontalLine.start.x+o*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var r=n.color,a=n.lineWidth,i={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:0};s.y=o%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Kt(e,t,i,s,{color:r,lineWidth:a},"canvas"),o++}},kl=function(e,t){var n=O(e,"stack");if(n&&n.data&&n.data.length){var o,r=y.cornerstone;if(n.data.length>1){var a=O(e,"stackRenderer");a&&a.data&&a.data.length&&(o=a.data[0])}var i=n.data[0];t<0&&(t+=i.imageIds.length);var s=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);if(t!==i.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-i.currentImageIdIndex};i.currentImageIdIndex=t;var d=i.imageIds[t];(Boolean(i.preventCache)?r.loadImage(d):r.loadAndCacheImage(d)).then((function(a){if(i.currentImageIdIndex===t){try{r.getEnabledElement(e)}catch(e){return}o?(o.currentImageIdIndex=t,o.render(e,n.data)):r.displayImage(e,a),l&&l(e,a)}}),(function(n){var o=i.imageIds[t];c&&c(e,o,n)})),T(e,w.STACK_SCROLL,u)}}},Rl=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=O(e,"stack");if(r&&r.data&&r.data.length){var a=r.data[0];a.pending||(a.pending=[]);var i=a.currentImageIdIndex+t;if(n?i%=a.imageIds.length:i=Cn(i,0,a.imageIds.length-1),o)kl(e,i);else{var s={index:i};a.pending.push(s),_l(a,s,e)}}};function _l(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index)return e.pending.splice(e.pending.indexOf(t),1),void(e.pending.length>0&&_l(e,e.pending[0],n));n.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,(function o(r){e.imageIds.indexOf(r.detail.image.imageId)===t.index&&(e.pending.splice(e.pending.indexOf(t),1),n.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,o),e.pending.length>0&&_l(e,e.pending[0],n))})),kl(n,t.index)}}var Nl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,o=t.element,r=this.configuration,a=r.loop,i=r.allowSkipping,s=r.invert;Rl(o,s?-n:n,a,i)}}]),t}(mo),Bl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return(e=u()(this,f()(t).call(this,n,o))).multiTouchDragCallback=e._dragCallback.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,o=t.deltaPoints,r=this.configuration,a=r.loop,i=r.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,o.page.y);if(!l)return;if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,a,i),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(mo),Ul=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:Br};return(e=u()(this,f()(t).call(this,n,o))).mouseDragCallback=e._dragCallback.bind(Co()(e)),e.touchDragCallback=e._dragCallback.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,o=t.deltaPoints,r=this.configuration,a=r.loop,i=r.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,o.page.y);if(l){if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,a,i),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(mo),Vl=function(e,t,n,o,r){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var a,i,s,l=y.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(i=0;i<r;i++)for(s=0;s<o;s++){var f=d[a=4*((i+n)*l.columns+(s+t))],h=d[a+1],p=d[a+2];c[u++]=.2126*f+.7152*h+.0722*p}else for(i=0;i<r;i++)for(s=0;s<o;s++)a=(i+n)*l.columns+(s+t),c[u++]=d[a]*l.slope+l.intercept;return c},Fl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var o={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:Ur};return(e=u()(this,f()(t).call(this,n,o)))._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(Co()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(Co()(e)),e.touchEndCallback=e._applyStrategy.bind(Co()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(Co()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(Co()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(Co()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(Co()(e)),e.mouseUpCallback=e._applyStrategy.bind(Co()(e)),e}return p()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,o=n.element,r=un.getColorIfActive({active:!0}),a=Pn(n.canvasContext.canvas);Wt(a,(function(e){Mn(e,o,t.handles.start,t.handles.end,{color:r})}))}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return jl(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,y.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){jl(this.handles.start)||jl(this.handles.end)||(e.detail.handles=this.handles,Hl(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(mo),jl=function(e){return 0===Object.keys(e).length&&e.constructor===Object},Hl=function(e,t){var n=e.detail,o=n.image,r=n.element,a=e.detail.handles,i=a.start,s=a.end,l=Math.min(i.x,s.x),c=Math.min(i.y,s.y),u=Math.abs(i.x-s.x),d=Math.abs(i.y-s.y);l=Cn(l,0,o.width),c=Cn(c,0,o.height),u=Math.floor(Math.min(u,Math.abs(o.width-l))),d=Math.floor(Math.min(d,Math.abs(o.height-c)));var f=Vl(r,l,c,u,d),h=zl(f,o.minPixelValue,o.maxPixelValue),p=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),p.voi.windowWidth=Math.max(Math.abs(h.max-h.min),t.minWindowWidth),p.voi.windowCenter=h.mean,p.voiLUT=void 0,y.cornerstone.setViewport(r,p),y.cornerstone.updateImage(r)},zl=function(e,t,n){var o=e.length,r=n,a=t,i=0;if(o<2)return{min:r,max:a,mean:(t+n)/2};for(var s=0;s<o;s++){var l=e[s];r=Math.min(r,l),a=Math.max(a,l),i+=l}return{min:r,max:a,mean:i/o}},ql=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Wwwc",strategies:{basicLevelingStrategy:Wl},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:Vr};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(mo);function Wl(e){var t=this.configuration.orientation,n=e.detail,o=(n.image.maxPixelValue*n.image.slope+n.image.intercept-(n.image.minPixelValue*n.image.slope+n.image.intercept))/1024,r=n.deltaPoints.page.x*o,a=n.deltaPoints.page.y*o;0===t?(n.viewport.voi.windowWidth+=r,n.viewport.voi.windowCenter+=a):(n.viewport.voi.windowWidth+=a,n.viewport.voi.windowCenter+=r),n.viewport.voiLUT=void 0}var Gl=function(e,t,n){var o=n.maxScale,r=n.minScale,a=Math.log(e.scale)/Math.log(1.7)+t,i=Math.pow(1.7,a);return e.scale=o&&i>o?o:r&&i<r?r:i,e},Yl={changeViewportScale:Gl,correctShift:function(e,t){var n=t.hflip,o=t.vflip,r=t.rotation;if(e.x*=n?-1:1,e.y*=o?-1:1,0!==r){var a=r*Math.PI/180,i=Math.cos(a),s=Math.sin(a),l=e.x*i-e.y*s,c=e.x*s+e.y*i;e.x=l,e.y=c}return e}},Zl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,r=t.spinY,a=this.configuration,i=a.invert,s=a.maxScale,l=a.minScale,c=Gl(o,i?r/4:-r/4,{maxScale:s,minScale:l});y.cornerstone.setViewport(n,c)}}]),t}(mo),Xl=Yl.correctShift,Kl=Yl.changeViewportScale,Ql=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Zoom",strategies:{default:$l,translate:ec,zoomToCenter:tc},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:Fr};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){Jl.call(this,e)}},{key:"mouseDragCallback",value:function(e){Jl.call(this,e)}}]),t}(mo),Jl=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function $l(e){var t=this.configuration,n=t.invert,o=t.maxScale,r=t.minScale,a=e.detail.deltaPoints.page.y,i=n?-a/100:a/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],f=u[1],h=u[2],p=u[3],m=Kl(c,i,{maxScale:o,minScale:r});y.cornerstone.setViewport(l,m);var g=y.cornerstone.pageToPixel(l,d,f),v={x:h-g.x,y:p-g.y};v=Xl(v,m),c.translation.x-=v.x,c.translation.y-=v.y}function ec(e){var t=this.configuration,n=t.invert,o=t.preventZoomOutsideImage,r=t.maxScale,a=t.minScale,i=e.detail.deltaPoints.page.y,s=n?-i/100:i/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],f=u[1],h=Kl(c,s,{maxScale:r,minScale:a}),p={x:0,y:0};if(s<0)h.scale<3&&(Math.abs(h.translation.x)<.01?h.translation.x=0:p.x=h.translation.x/8,Math.abs(h.translation.y)<.01?h.translation.y=0:p.y=h.translation.y/8);else{o&&In(e.detail.startPoints.image,l);var m={x:l.width/2-d,y:l.height/2-f};m=Xl(m,h);var g={x:h.translation.x-m.x,y:h.translation.y-m.y};Math.abs(g.x)<.01?h.translation.x=m.x:p.x=g.x/8,Math.abs(g.y)<.01?h.translation.y=m.y:p.y=g.y/8}h.translation.x-=p.x,h.translation.y-=p.y}function tc(e){var t=this.configuration,n=t.invert,o=t.maxScale,r=t.minScale,a=e.detail.deltaPoints.page.y,i=n?-a/100:a/100,s=e.detail.viewport;Kl(s,i,{maxScale:o,minScale:r})}var nc=Yl.correctShift,oc=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,o=t.viewport,r=t.scaleChange,a=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],i=a[0],s=a[1],l=a[2],c=a[3],u=this.configuration,d=u.maxScale,f=u.minScale;o.scale+=r*o.scale,d&&o.scale>d?o.scale=d:f&&o.scale<f&&(o.scale=f),y.cornerstone.setViewport(n,o);var h=y.cornerstone.pageToPixel(n,i,s),p={x:l-h.x,y:c-h.y};p=nc(p,o),o.translation.x-=p.x,o.translation.y-=p.y,y.cornerstone.setViewport(n,o)}}]),t}(mo),rc=function(e){return{page:ac(e.page),image:ac(e.image),client:ac(e.client),canvas:ac(e.canvas)}};function ac(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{x:e.x,y:e.y}}var ic,sc=U("eventListeners:mouseEventListeners"),lc=!0,cc=new Map;function uc(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function dc(){lc=!1}function fc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var o=w.MOUSE_DOUBLE_CLICK,r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var a=rc(r);sc.log("double-click: %o",uc(e)),T(t,o,{event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:a,currentPoints:r,deltaPoints:{x:0,y:0},type:o})}}function hc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){ic=setTimeout(dc,200),t.removeEventListener("mousemove",pc);var o={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=y.cornerstone.pixelToCanvas(t,o.image);var r=rc(o),a={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:r,currentPoints:o,deltaPoints:{x:0,y:0},type:w.MOUSE_DOWN};T(a.element,w.MOUSE_DOWN,a)&&(a.type=w.MOUSE_DOWN_ACTIVATE,T(a.element,w.MOUSE_DOWN_ACTIVATE,a)),document.addEventListener("mousemove",i),document.addEventListener("mouseup",s),cc.set(i,"mousemove"),cc.set(s,"mouseup")}function i(e){var a=w.MOUSE_DRAG,i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,r.page),image:y.cornerstoneMath.point.subtract(i.image,r.image),client:y.cornerstoneMath.point.subtract(i.client,r.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,r.canvas)};sc.log("mousemove: %o",uc(e));var l={buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:r,currentPoints:i,deltaPoints:s,type:a,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};T(l.element,a,l),r=rc(i)}function s(e){clearTimeout(ic);var a=w.MOUSE_UP;lc&&(a=w.MOUSE_CLICK);var l={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=y.cornerstone.pixelToCanvas(t,l.image);var c={page:y.cornerstoneMath.point.subtract(l.page,r.page),image:y.cornerstoneMath.point.subtract(l.image,r.image),client:y.cornerstoneMath.point.subtract(l.client,r.client),canvas:y.cornerstoneMath.point.subtract(l.canvas,r.canvas)};sc.log("mouseup: %o",uc(e));var u={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:r,currentPoints:l,deltaPoints:c,type:a};T(u.element,a,u),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s),cc.delete(i),cc.delete(s),t.addEventListener("mousemove",pc),lc=!0}}function pc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var o=w.MOUSE_MOVE,r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var a=rc(r),i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,a.page),image:y.cornerstoneMath.point.subtract(i.image,a.image),client:y.cornerstoneMath.point.subtract(i.client,a.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,a.canvas)};T(t,o,{viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:a,currentPoints:i,deltaPoints:s,type:o}),a=rc(i)}}function mc(e){e.removeEventListener("mousedown",hc),e.removeEventListener("mousemove",pc),e.removeEventListener("dblclick",fc),cc.forEach((function(e,t){document.removeEventListener(e,t)})),cc.clear()}var gc={enable:function(e){mc(e),e.addEventListener("mousedown",hc),e.addEventListener("mousemove",pc),e.addEventListener("dblclick",fc)},disable:mc};function vc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image&&!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var o=e.pageX,r=e.pageY,a=y.cornerstone.pageToPixel(t,o,r),i=function(e){var t=0,n=0,o=0,r=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),o=10*t,r=10*n,"deltaY"in e&&(r=e.deltaY),"deltaX"in e&&(o=e.deltaX),(o||r)&&e.deltaMode&&(1===e.deltaMode?(o*=40,r*=40):(o*=800,r*=800)),o&&!t&&(t=o<1?-1:1),r&&!n&&(n=r<1?-1:1),{spinX:t,spinY:n,pixelX:o,pixelY:r}}(e),s=i.spinX,l=i.spinY,c=i.pixelX,u=i.pixelY,d=l<0?-1:1,f={element:t,viewport:y.cornerstone.getViewport(t),detail:e,image:n.image,direction:d,spinX:s,spinY:l,pixelX:c,pixelY:u,pageX:o,pageY:r,imageX:a.x,imageY:a.y};T(t,w.MOUSE_WHEEL,f)}}function yc(e){e.removeEventListener("wheel",vc,{passive:!1})}var bc,xc,wc={enable:function(e){yc(e),e.addEventListener("wheel",vc,{passive:!1})},disable:yc},Tc=0,Ic=1;function Ec(e,t){var n=Date.now();if(e!==bc){if(n-xc<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;bc=e}xc=n}var Sc=Ec.bind(null,Tc),Cc=Ec.bind(null,Ic);function Ac(e,t,n){var o=n?Sc:Cc;t.forEach((function(t){e.addEventListener(t,o,{passive:!1})}))}function Mc(e,t,n){var o=n?Sc:Cc;t.forEach((function(t){e.removeEventListener(t,o)}))}var Pc=["mousedown","mouseup"],Dc=["touchstart","touchend"];function Lc(e){Mc(e,Pc,Tc),Mc(e,Dc,Ic)}var Oc,kc,Rc,_c,Nc,Bc,Uc,Vc,Fc,jc={enable:function(e){Lc(e),Ac(e,Pc,Tc),Ac(e,Dc,Ic)},disable:Lc},Hc=1,zc=0,qc=!1,Wc=!1;function Gc(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var o,r,a,i;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(Wc=!1,clearTimeout(Uc)),e.type){case"tap":Wc=!1,clearTimeout(Uc),(kc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),o=w.TAP,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:kc,type:o,isTouchEvent:!0},T(t,o,Nc);break;case"doubletap":Wc=!1,clearTimeout(Uc),(kc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),o=w.DOUBLE_TAP,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:kc,type:o,isTouchEvent:!0},T(t,o,Nc);break;case"pinchstart":Wc=!1,clearTimeout(Uc),Hc=1;break;case"pinchmove":if(Wc=!1,clearTimeout(Uc),!0===qc){Hc=e.scale,qc=!1;break}r=(e.scale-Hc)/Hc,(Oc={page:e.center,image:y.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),o=w.TOUCH_PINCH,Nc={event:e,startPoints:Oc,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:r,type:o,isTouchEvent:!0},T(t,o,Nc),Hc=e.scale;break;case"touchstart":Hc=1,clearTimeout(Uc),clearTimeout(Bc),Bc=setTimeout((function(){(Oc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),o=w.TOUCH_START,e.touches.length>1&&(o=w.MULTI_TOUCH_START),Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,currentPoints:Oc,type:o,isTouchEvent:!0},!0===T(t,o,Nc)&&(o=w.TOUCH_START_ACTIVE,e.touches.length>1&&(o=w.MULTI_TOUCH_START_ACTIVE),Nc.type=o,T(t,o,Nc)),Rc=rc(Oc)}),50),Wc=!0,Vc=0,Uc=setTimeout((function(){Wc&&((kc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),o=w.TOUCH_PRESS,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:kc,type:o,isTouchEvent:!0},T(t,o,Nc))}),700);break;case"touchend":Hc=1,Wc=!1,clearTimeout(Uc),setTimeout((function(){(Oc={page:y.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:y.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),o=w.TOUCH_END,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,currentPoints:Oc,type:o,isTouchEvent:!0},T(t,o,Nc)}),50);break;case"panmove":a={x:e.deltaX-Fc.x,y:e.deltaY-Fc.y},Fc={x:e.deltaX,y:e.deltaY},(kc={page:{x:Rc.page.x+a.x,y:Rc.page.y+a.y},image:y.cornerstone.pageToPixel(t,Rc.page.x+a.x,Rc.page.y+a.y),client:{x:Rc.client.x+a.x,y:Rc.client.y+a.y}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),_c={page:y.cornerstoneMath.point.subtract(kc.page,Rc.page),image:y.cornerstoneMath.point.subtract(kc.image,Rc.image),client:y.cornerstoneMath.point.subtract(kc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(kc.canvas,Rc.canvas)},(Vc+=Math.sqrt(_c.page.x*_c.page.x+_c.page.y*_c.page.y))>5&&(Wc=!1,clearTimeout(Uc)),o=w.TOUCH_DRAG,e.pointers.length>1&&(o=w.MULTI_TOUCH_DRAG),Nc={viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,lastPoints:Rc,currentPoints:kc,deltaPoints:_c,numPointers:e.pointers.length,type:o,isTouchEvent:!0},T(t,o,Nc),Rc=rc(kc);break;case"panstart":Fc={x:e.deltaX,y:e.deltaY},(kc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),Rc=rc(kc);break;case"panend":if(Wc=!1,clearTimeout(Uc),!Rc)return!1;(kc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,kc.image),_c={page:y.cornerstoneMath.point.subtract(kc.page,Rc.page),image:y.cornerstoneMath.point.subtract(kc.image,Rc.image),client:y.cornerstoneMath.point.subtract(kc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(kc.canvas,Rc.canvas)},o=w.TOUCH_DRAG_END,Nc={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,lastPoints:Rc,currentPoints:kc,deltaPoints:_c,type:o,isTouchEvent:!0},T(t,o,Nc),2==e.pointers.length-e.changedPointers.length&&(qc=!0);break;case"rotatemove":Wc=!1,clearTimeout(Uc),i=e.rotation-zc,zc=e.rotation,o=w.TOUCH_ROTATE,Nc={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,rotation:i,type:o},T(t,o,Nc)}return!1}}function Yc(e){jc.disable(e),["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,Gc)}));var t=Ws("touchInput",e),n=t.hammer;n&&(n.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),n.input.destroy()),t.hammer=null,function(e,t){var n=qs[e];n&&(qs[e]=n.filter((function(e){return e.element!==t})))}("touchInput",e)}var Zc={enable:function(e){Yc(e);var t=y.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},o=new t.Manager(e,n),r={pointers:0,direction:t.DIRECTION_ALL,threshold:0},a=new t.Pan(r),i=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});i.recognizeWith(a),i.recognizeWith(s),s.recognizeWith(a);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(a),o.add([l,a,s,i]),o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),jc.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,Gc,{passive:!1})}));var c=Ws("touchInput",e);c.hammer=o,Gs("touchInput",e,c)},disable:Yc},Xc=xt("segmentation");function Kc(e,t,n,o,r){!function(e,t,n){var o=Xc.configuration,r=e.detail,a=r.canvasContext,i=r.element,s=r.image,l=r.viewport,c=a.getTransform(),u=Pn(a.canvas),d=y.cornerstone.pixelToCanvas(i,{x:0,y:0}),f=y.cornerstone.pixelToCanvas(i,{x:s.width,y:0}),h=y.cornerstone.pixelToCanvas(i,{x:s.width,y:s.height}),p=y.cornerstoneMath.point.distance(d,f),m=y.cornerstoneMath.point.distance(f,h),g=a.canvas,v=u.imageSmoothingEnabled,b=u.globalAlpha;u.imageSmoothingEnabled=!1,u.globalAlpha=n?o.fillAlpha:o.fillAlphaInactive,function(e,t,n){if(n.hflip||n.vflip||n.rotation){var o={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(o.x,o.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-o.x,-o.y)}}(u,g,l);var x=function(e){var t=e.viewport,n=e.image,o=t.scale,r=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(r*=n.rowPixelSpacing/n.columnPixelSpacing),{x:t.translation.x*o,y:t.translation.y*r}}(r);u.drawImage(t,g.width/2-p/2+x.x,g.height/2-m/2+x.y,p,m),u.globalAlpha=b,u.imageSmoothingEnabled=v,u.setTransform(c)}(e,function(e,t,n){var o=Xc.state,r=e.detail.image,a=r.width,i=r.height,s=t.segmentsHidden,l=n.pixelData,c=o.colorLutTables[t.colorLUTIndex],u=document.createElement("canvas");u.width=a,u.height=i;for(var d=Pn(u),f=new ImageData(a,i),h=f.data,p=0;p<l.length;p++){var m=l[p];if(0!==m&&!s[m]){var g=c[l[p]];h[4*p]=g[0],h[4*p+1]=g[1],h[4*p+2]=g[2],h[4*p+3]=g[3]}}return d.putImageData(f,0,0),u}(e,t,n),r)}var Qc=xt("segmentation");function Jc(e,t,n,o,r){!function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=Qc.configuration,a=Qc.state,i=e.detail,s=i.element,l=i.canvasContext,c=r.outlineWidth||1,u=l.getTransform(),d=Pn(l.canvas),f=a.colorLutTables[n],h=d.globalAlpha;d.globalAlpha=o?r.outlineAlpha:r.outlineAlphaInactive,Wt(d,(function(e){for(var n=1;n<t.length;n++)if(t[n]){var o=f[n];fn(e,s,t[n],{color:"rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1.0 )"),lineWidth:c},"canvas")}})),d.globalAlpha=h,d.setTransform(u)}(e,function(e,t,n,o){var r=e.detail,a=r.element,i=r.image,s=r.viewport,l=i.width,c=i.height;o=o||1;var u,d=t.segmentsHidden,f=n.pixelData,h=t.activeSegmentIndex,p=[];n.segmentsOnLabelmap.forEach((function(e){!d[e]&&(p[e]=[])})),p[h]||(p[h]=[]);for(var m=function(e,t){var n=t/2,o=e.rotation;o*=Math.PI/180;var r=Math.cos(o),a=Math.sin(o),i=[r,a],s=[-a,r],l={x:n*i[0],y:n*i[1]},c={x:n*s[0],y:n*s[1]};return e.hflip&&(l.x*=-1,l.y*=-1),e.vflip&&(c.x*=-1,c.y*=-1),{i:l,j:c}}(s,o),g=0;g<f.length;g++){var v=f[g];if(0!==v&&!d[v]){var y={x:(u=g)%l,y:Math.floor(u/l)},b=$c(y,c,l);void 0!==b.top&&f[b.top]===v||ru(p[v],a,y,m),void 0!==b.bottom&&f[b.bottom]===v||au(p[v],a,y,m),void 0!==b.left&&f[b.left]===v||iu(p[v],a,y,m),void 0!==b.right&&f[b.right]===v||su(p[v],a,y,m),void 0!==b.topLeft&&f[b.topLeft]!==v&&f[b.top]===v&&f[b.left]===v&&eu(p[v],a,y,m),void 0!==b.topRight&&f[b.topRight]!==v&&f[b.top]===v&&f[b.right]===v&&tu(p[v],a,y,m),void 0!==b.bottomLeft&&f[b.bottomLeft]!==v&&f[b.bottom]===v&&f[b.left]===v&&nu(p[v],a,y,m),void 0!==b.bottomRight&&f[b.bottomRight]!==v&&f[b.bottom]===v&&f[b.right]===v&&ou(p[v],a,y,m)}}return p}(e,t,n,Qc.configuration.outlineWidth),t.colorLUTIndex,r)}function $c(e,t,n){var o=e.y*n+e.x,r={},a=e.y-1>=0,i=e.y+1<t,s=e.x-1>=0,l=e.x+1<n;return a&&(r.top=o-n,l&&(r.topRight=r.top+1),s&&(r.topLeft=r.top-1)),i&&(r.bottom=o+n,l&&(r.bottomRight=r.bottom+1),s&&(r.bottomLeft=r.bottom-1)),s&&(r.left=o-1),l&&(r.right=o+1),r}function eu(e,t,n,o){var r=(0,y.cornerstone.pixelToCanvas)(t,n);r.x+=o.j.x,r.y+=o.j.y;var a={x:r.x,y:r.y};a.x+=2*o.i.x,a.y+=2*o.i.y,e.push({start:r,end:a})}function tu(e,t,n,o){var r=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y});r.x+=o.j.x,r.y+=o.j.y;var a={x:r.x,y:r.y};a.x-=2*o.i.x,a.y-=2*o.i.y,e.push({start:r,end:a})}function nu(e,t,n,o){var r=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x,y:n.y+1});r.x-=o.j.x,r.y-=o.j.y;var a={x:r.x,y:r.y};a.x+=2*o.i.x,a.y+=2*o.i.y,e.push({start:r,end:a})}function ou(e,t,n,o){var r=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y+1});r.x-=o.j.x,r.y-=o.j.y;var a={x:r.x,y:r.y};a.x-=2*o.i.x,a.y-=2*o.i.y,e.push({start:r,end:a})}function ru(e,t,n,o){var r=y.cornerstone.pixelToCanvas,a=r(t,n),i=r(t,{x:n.x+1,y:n.y});a.x+=o.j.x,a.y+=o.j.y,i.x+=o.j.x,i.y+=o.j.y,e.push({start:a,end:i})}function au(e,t,n,o){var r=y.cornerstone.pixelToCanvas,a=r(t,{x:n.x,y:n.y+1}),i=r(t,{x:n.x+1,y:n.y+1});a.x-=o.j.x,a.y-=o.j.y,i.x-=o.j.x,i.y-=o.j.y,e.push({start:a,end:i})}function iu(e,t,n,o){var r=y.cornerstone.pixelToCanvas,a=r(t,n),i=r(t,{x:n.x,y:n.y+1});a.x+=o.i.x,a.y+=o.i.y,i.x+=o.i.x,i.y+=o.i.y,e.push({start:a,end:i})}function su(e,t,n,o){var r=y.cornerstone.pixelToCanvas,a=r(t,{x:n.x+1,y:n.y}),i=r(t,{x:n.x+1,y:n.y+1});a.x-=o.i.x,a.y-=o.i.y,i.x-=o.i.x,i.y-=o.i.y,e.push({start:a,end:i})}var lu=xt("segmentation");function cu(e,t,n,o,r){(function(e){var t=lu.configuration;return t.renderFill&&(e&&0!==t.fillAlpha||!e&&0!==t.fillAlphaInactive)})(r)&&Kc(e,t,o,0,r),function(e){var t=lu.configuration;return t.renderOutline&&(e&&0!==t.outlineAlpha||!e&&0!==t.outlineAlphaInactive)}(r)&&Jc(e,t,o,0,r)}var uu=xt("segmentation"),du=function(e){var t=e.detail.element,n=uu.configuration,o=uu.getters.labelmaps3D(t),r=o.activeLabelmapIndex,a=o.labelmaps3D,i=o.currentImageIdIndex;a&&(n.shouldRenderInactiveLabelmaps&&function(e,t,n,o){for(var r=0;r<t.length;r++){var a=t[r];if(r!==n&&a){var i=a.labelmaps2D[o];i&&cu(e,a,0,i,!1)}}}(e,a,r,i),function(e,t,n,o){var r=t[n];if(r){var a=r.labelmaps2D[o];a&&cu(e,r,0,a,!0)}}(e,a,r,i))},fu=xt("segmentation"),hu=function(e){var t=e.detail,n=t.element,o=vt.tools.filter((function(e){return e.element===n&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)})),r=O(n,"stack"),a=fu.configuration;r&&(a.renderFill||a.renderOutline)&&du(e);var i=t.canvasContext.canvas.getContext("2d");o.forEach((function(t){t.renderToolData&&(i.save(),t.renderToolData(e),i.restore())}))},pu=function(e){e.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,hu)},mu=function(e){e.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,hu)},gu=function(e,t,n){if(vt.isToolLocked)return!1;var o=n.detail.element,r=vt.tools.filter((function(t){return t.supportedInteractionTypes.includes(e)}));if(r=(r=Eo(o,r,e)).filter((function(e){return"function"==typeof e[t]})),vt.isMultiPartToolActive&&(r=Do(r)),0===r.length)return!1;r[0][t](n)},vu=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";return t.filter((function(t){for(var r=lr(o,t.name),a=O(e,t.name),i=0;i<a.data.length;i++)if(void 0!==yo(e,a.data[i].handles,n,r))return!0;return!1}))},yu=function(e,t){return t.filter((function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)}))},bu=function(e,t){return t.filter((function(t){var n=O(e,t.name);return n&&n.data.length>0}))},xu=function(e){if(!vt.isToolLocked){var t=e.detail,n=e.detail.element,o=e.detail.currentPoints.canvas,r=yu(n,yt.mouseTools()),a=r.filter((function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}));if(vt.isMultiPartToolActive&&(a=Do(a)),a.length>0){var i=a.find((function(e){return"function"==typeof e.preMouseDownCallback}));if(i&&i.preMouseDownCallback(e))return}if(!vt.isMultiPartToolActive){var s=bu(n,r),l=vu(n,s,o,"mouse");if(l.length>0){var c=l[0],u=O(n,c.name),d=fr(n,u,c.name,o),f=d.handle,h=d.data;c.handleSelectedCallback(e,h,f,"mouse")}else{var p=r.filter((function(e){var t=O(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,o,"mouse")}))}));if(p.length>0){var m=p[0],g=O(n,m.name).data.find((function(e){return m.pointNearTool(n,e,o)}));m.toolSelectedCallback(e,g,"mouse")}else if(a.length>0){var v=a.find((function(e){return"function"==typeof e.postMouseDownCallback}));if(v&&v.postMouseDownCallback(e))return}}}}},wu=U("eventDispatchers:mouseEventHandlers"),Tu=function(e){if(!vt.isToolLocked){var t=e.detail,n=Lo(t.element,t.buttons,"mouse");if(n){if("function"==typeof n.preMouseDownActivateCallback&&n.preMouseDownActivateCallback(e))return;vt.isMultiPartToolActive||(n.addNewMeasurement?n.addNewMeasurement(e,"mouse"):n instanceof mr&&function(e,t){wu.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,o=n.element,r=t.createNewMeasurement(n);if(r){L(o,t.name,r),y.cornerstone.updateImage(o);var a=1===Object.keys(r.handles).length?Go:nr,i=(new Date).getTime();a(n,t.name,r,r.handles.end,t.options,"mouse",(function(e){if(!r.cancelled){var n=!(!t.configuration||!Object(t.configuration).hasOwnProperty("measurementCreationThreshold"))&&(new Date).getTime()-i<t.configuration.measurementCreationThreshold;if(e&&!1===n){var a=w.MEASUREMENT_COMPLETED,s={toolName:t.name,toolType:t.name,element:o,measurementData:r};T(o,a,s)}else k(o,t.name,r)}}))}}(e,n))}}},Iu=function(e){if(!vt.isToolLocked){var t,n=e.detail,o=n.element;t=(t=(t=Eo(o,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive}))).filter((function(e){return"function"==typeof e.mouseDragCallback})),vt.isMultiPartToolActive&&(t=Do(t)),0!==t.length&&t[0].mouseDragCallback(e)}},Eu=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t,n=e.detail,o=n.element,r=n.currentPoints;vt.mousePositionImage=r.image;var a=(t=yu(o,yt.mouseTools())).filter((function(e){return"active"===e.mode&&e.options.isMouseActive})),i=!1;a.length>0&&(i=a.some((function(e){return e.updateOnMouseMove}))),t=bu(o,t);for(var s=0;s<t.length;s++){var l=t[s];"function"==typeof l.mouseMoveCallback&&(i=l.mouseMoveCallback(e)||i)}!0===i&&y.cornerstone.updateImage(o)}},Su=gu.bind(null,"Mouse","mouseClickCallback"),Cu=gu.bind(null,"Mouse","doubleClickCallback"),Au=gu.bind(null,"Mouse","mouseUpCallback"),Mu=gu.bind(null,"MouseWheel","mouseWheelCallback"),Pu=function(e){e.addEventListener(w.MOUSE_CLICK,Su),e.addEventListener(w.MOUSE_DOWN,xu),e.addEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.addEventListener(w.MOUSE_DOUBLE_CLICK,Cu),e.addEventListener(w.MOUSE_DRAG,Iu),e.addEventListener(w.MOUSE_MOVE,Eu),e.addEventListener(w.MOUSE_UP,Au),e.addEventListener(w.MOUSE_WHEEL,Mu)},Du=function(e){e.removeEventListener(w.MOUSE_CLICK,Su),e.removeEventListener(w.MOUSE_DOWN,xu),e.removeEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,Cu),e.removeEventListener(w.MOUSE_DRAG,Iu),e.removeEventListener(w.MOUSE_MOVE,Eu),e.removeEventListener(w.MOUSE_UP,Au),e.removeEventListener(w.MOUSE_WHEEL,Mu)},Lu=function(e){if(vt.isToolLocked)return!1;var t=e.detail.element,n=vt.tools.filter((function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)}));if(0===n.length)return!1;n.forEach((function(t){t.newImageCallback&&t.newImageCallback(e)}))},Ou=function(e){e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,Lu)},ku=function(e){e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,Lu)},Ru=function(e){if(vt.isToolLocked)return!1;var t=e.detail,n=t.element,o=t.numPointers,r=vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("MultiTouch")}));if(r=(r=Eo(n,r,"MultiTouch")).filter((function(e){return"function"==typeof e.multiTouchDragCallback&&o===e.configuration.touchPointers})),vt.isMultiPartToolActive&&(r=Do(r)),0===r.length)return!1;r[0].multiTouchDragCallback(e)},_u=U("eventDispatchers:touchEventHandlers"),Nu=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t=Lo(e.detail.element,null,"touch");t&&t.addNewMeasurement?t.addNewMeasurement(e,"touch"):t instanceof mr&&function(e,t){_u.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,o=n.element,r=t.createNewMeasurement(n);if(r){if(L(o,t.name,r),1===Object.keys(r.handles).length&&n.type===w.TAP)return r.active=!1,r.handles.end.active=!1,r.handles.end.highlight=!1,r.invalidated=!0,(vt.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&To(n,r.handles)&&k(o,t.name,r),void y.cornerstone.updateImage(o);y.cornerstone.updateImage(o),nr(n,t.name,r,r.handles.end,t.options,"touch",(function(){var e=w.MEASUREMENT_COMPLETED,n={toolName:t.name,toolType:t.name,element:o,measurementData:r};T(o,e,n)}))}}(e,t)}},Bu=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&Uu(n.handles)}};function Uu(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}var Vu,Fu=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t,n=e.detail.element,o=e.detail.currentPoints.canvas;t=Eo(n,yt.touchTools());var r=(t=bu(n,t)).filter((function(e){for(var t=O(n,e.name),r=0;r<t.data.length;r++)if(void 0!==yo(n,t.data[r].handles,o,28))return!0;return!1}));if(r.length>0){var a=r[0],i=O(n,a.name),s=i.data.find((function(e){return void 0!==yo(n,e.handles,o,28)}));return i.data.active=!0,s.active=!0,y.cornerstone.updateImage(n),Go(e.detail,a.name,i.data,s,a.options,"touch",(function(){return Bu(i)})),e.stopImmediatePropagation(),void e.preventDefault()}var l=t.filter((function(e){var t=O(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,o)}))}));if(l.length>0){var c=l[0],u=O(n,c.name),d=u.data.find((function(e){return c.pointNearTool(n,e,o)}));return d.active=!0,y.cornerstone.updateImage(n),No(e.detail,c.name,d,null,c.options,"touch",(function(){return Bu(u)})),e.stopImmediatePropagation(),void e.preventDefault()}var f=Eo(n,yt.touchTools());return f.length>0&&f[0].touchStartActiveCallback?f[0].touchStartActiveCallback(e):Nu(e),!1}},ju=function(e){if(!vt.isToolLocked){var t=e.detail,n=t.element,o=t.startPoints.canvas,r=yu(n,yt.touchTools()),a=r.filter((function(e){return"active"===e.mode&&e.options.isTouchActive}));if(vt.isMultiPartToolActive&&(a=Do(a)),a.length>0){var i=a.find((function(e){return"function"==typeof e.preTouchStartCallback}));if(i&&i.preTouchStartCallback(e))return}if(!vt.isMultiPartToolActive){var s=bu(n,r),l=vu(n,s,o,"touch");if(l.length>0){var c=l[0],u=O(n,c.name),d=fr(n,u,c.name,o,"touch"),f=d.handle,h=d.data;c.handleSelectedCallback(e,h,f,"touch")}else{var p=s.filter((function(e){var t=O(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,o,"touch")}))}));if(p.length>0){var m=p[0],g=O(n,m.name).data.find((function(e){return m.pointNearTool(n,e,o)}));m.toolSelectedCallback(e,g,"touch")}else if(a.length>0){var v=a.find((function(e){return"function"==typeof e.postTouchStartCallback}));if(v&&v.postTouchStartCallback(e))return}}}}},Hu=gu.bind(null,"DoubleTap","doubleTapCallback"),zu=gu.bind(null,"Touch","touchDragCallback"),qu=gu.bind(null,"Touch","touchEndCallback"),Wu=gu.bind(null,"TouchPinch","touchPinchCallback"),Gu=gu.bind(null,"Touch","touchPressCallback"),Yu=gu.bind(null,"TouchRotate","touchRotateCallback"),Zu=function(e){e.addEventListener(w.TAP,Fu),e.addEventListener(w.TOUCH_START,ju,{passive:!1}),e.addEventListener(w.TOUCH_DRAG,zu,{passive:!1}),e.addEventListener(w.TOUCH_END,qu),e.addEventListener(w.TOUCH_START_ACTIVE,Nu),e.addEventListener(w.TOUCH_PRESS,Gu),e.addEventListener(w.DOUBLE_TAP,Hu),e.addEventListener(w.TOUCH_PINCH,Wu),e.addEventListener(w.TOUCH_ROTATE,Yu),e.addEventListener(w.MULTI_TOUCH_DRAG,Ru)},Xu=function(e){e.removeEventListener(w.TAP,Fu),e.removeEventListener(w.TOUCH_START,ju),e.removeEventListener(w.TOUCH_DRAG,zu),e.removeEventListener(w.TOUCH_END,qu),e.removeEventListener(w.TOUCH_START_ACTIVE,Nu),e.removeEventListener(w.TOUCH_PRESS,Gu),e.removeEventListener(w.DOUBLE_TAP,Hu),e.removeEventListener(w.TOUCH_PINCH,Wu),e.removeEventListener(w.TOUCH_ROTATE,Yu),e.removeEventListener(w.MULTI_TOUCH_DRAG,Ru)},Ku=U("addTool"),Qu=function(e,t,n){var o=new t(n);Tt(e,o.name)?Ku.warn("%s has already been added to the target element",o.name):(o.element=e,wt.state.tools.push(o))},Ju=function(e,t){$u(e,t),wt.state.enabledElements.forEach((function(n){Qu(n,e,t)}))},$u=function(e,t){if(xt("globalConfiguration").configuration.globalToolSyncEnabled){var n=new e(t);void 0!==wt.state.globalTools[n.name]?Ku.warn("%s has already been added globally",n.name):wt.state.globalTools[n.name]={tool:e,props:t,activeBindings:[]}}},ed=U("internals:addEnabledElement"),td=function(e){ed.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;pu(t),Ou(t);var n=xt("globalConfiguration").configuration;n.mouseEnabled&&(gc.enable(t),wc.enable(t),Pu(t)),n.touchEnabled&&(Zc.enable(t),Zu(t)),nd(t)},nd=function(e){wt.state.enabledElements.push(e),wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)}))}(e),function(e){xt("globalConfiguration").configuration.globalToolSyncEnabled&&Object.keys(wt.state.globalTools).forEach((function(t){var n=wt.state.globalTools[t],o=n.tool,r=n.props;Qu(e,o,r)}))}(e),function(e){if(xt("globalConfiguration").configuration.globalToolSyncEnabled){var t={active:Pt,passive:_t,enabled:kt,disabled:Lt};wt.state.globalToolChangeHistory.forEach((function(n){var o=n.args.slice(0);o.unshift(e),t[n.mode].apply(null,o)}))}}(e)},od=U("internals:removeEnabledElement"),rd=function(e){od.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element,n=xt("globalConfiguration").configuration;mu(t),ku(t),n.mouseEnabled&&(gc.disable(t),wc.disable(t),Du(t)),n.touchEnabled&&(Zc.disable(t),Xu(t)),ad(t),id(t),sd(t)},ad=function(e){wt.state.tools.forEach((function(t){t.element===e&&Lt(t.element,t.name)})),wt.state.tools=wt.state.tools.filter((function(t){return t.element!==e}))},id=function(e){wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)}))}(e);var t=wt.state.enabledElements.findIndex((function(t){return t===e}));t>-1?wt.state.enabledElements.splice(t,1):od.warn("unable to remove element")},sd=function(e){zs.removeHandlers(e)},ld=function(){window.removeEventListener("resize",cd,!1)};function cd(){Vu||(Vu=setTimeout((function(){Vu=null,ud()}),66))}var ud=function(){vt.enabledElements.forEach((function(e){y.cornerstone.resize(e)}))},dd=function(){ld(),window.addEventListener("resize",cd,!1)},fd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};hd(),pd();var t=xt("globalConfiguration");Array.isArray(e)?e.forEach((function(e){var t=e.moduleName,n=e.configuration,o=xt(t);o&&(o.configuration=Object.assign({},o.configuration,n))})):t.configuration=Object.assign({},t.configuration,e),t.configuration.autoResizeViewports&&dd()};function hd(){!function(){var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,td),e.events.removeEventListener(n,rd)}();var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,td),e.events.addEventListener(n,rd)}function pd(){var e=wt.modules;Object.keys(e).forEach((function(t){"function"==typeof e[t].onRegisterCallback&&e[t].onRegisterCallback()}))}var md,gd=U("stackTools:stackPrefetch"),vd={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function yd(e,t){e=Math.round(e)||0;var n=[],o=(t=Math.round(t)||0)-e+1;if(o<=0)return n;for(;o--;)n[o]=t--;return n}function bd(e){var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],o=O(e,"stackPrefetch");if(o){var r=o.data[0]||{};if(r.indicesToRequest&&r.indicesToRequest.length||(r.enabled=!1),!1!==r.enabled&&(o.data[0].indicesToRequest.sort((function(e,t){return e-t})),r.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&y.cornerstone.imageCache.getImageLoadObject(t)&&w(e)})),r.indicesToRequest.length)){vd.preserveExistingPool||y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch");for(var a,i,s,l,c,u,d,f=(a=r.indicesToRequest,i=n.currentImageIdIndex,s=0,l=a.length-1,a.forEach((function(e,t){e<i?s=Math.max(t,s):e>i&&(l=Math.min(t,l))})),{low:s,high:l}),h=(zs.getErrorLoadingHandler(e),f.low),p=f.high,m=[];h>=0||p<r.indicesToRequest.length;){var g=n.currentImageIdIndex,v=!(g-r.indicesToRequest[h]>vd.maxImagesToPrefetch)&&h>=0,b=!(r.indicesToRequest[p]-g>vd.maxImagesToPrefetch)&&p<r.indicesToRequest.length;if(!b&&!v)break;v&&(u=r.indicesToRequest[h--],c=n.imageIds[u],m.push(c)),b&&(u=r.indicesToRequest[p++],c=n.imageIds[u],m.push(c))}var x={addToBeginning:!0,priority:0,requestType:"prefetch"};d=function(e){return y.cornerstone.loadAndCacheImage(e,x)},m.reverse().forEach((function(e){y.cornerstone.imageLoadPoolManager.addRequest(d.bind(null,e),"prefetch",{imageId:e},0,!0)}))}}}function w(e){var t=r.indicesToRequest.indexOf(e);t>-1&&r.indicesToRequest.splice(t,1)}}function xd(e){return function(t){var n,o=t.detail;try{n=O(e,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var r=n.data[0].imageIds.indexOf(o.imageId);if(!(r<0)){var a=O(e,"stackPrefetch");a&&a.data&&a.data.length&&a.data[0].indicesToRequest.push(r)}}}}function wd(e){clearTimeout(md),md=setTimeout((function(){var t=e.target;try{bd(t)}catch(e){return}}),10)}var Td={enable:function(e){O(e,"stackPrefetch").data=[];var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var o={indicesToRequest:yd(0,n.imageIds.length-1),enabled:!0,direction:1},r=o.indicesToRequest.indexOf(n.currentImageIdIndex);o.indicesToRequest.splice(r,1),L(e,"stackPrefetch",o),bd(e),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd),e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var a=xd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,a),y.cornerstone.events.addEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,a)}else gd.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(md),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var t=xd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=O(e,"stackPrefetch");n&&n.data.length&&(n.data[0].enabled=!1,y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch"))},getConfiguration:function(){return vd},setConfiguration:function(e){vd=e}},Id=function(){function e(){i()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return l()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=O(e,"stack").data);var o=y.cornerstone,r=t[0],a=r.imageIds[this.currentImageIdIndex],i=t.slice(1,t.length);o.loadAndCacheImage(a).then((function(t){var s=n.layerIds[0];s?o.setLayerImage(e,t,s):(s=o.addLayer(e,t,r.options),n.layerIds.push(s)),o.displayImage(e,t),i.forEach((function(t,r){var i=n.findImageFn(t.imageIds,a),l=r+1,c=n.layerIds[l];c||(c=o.addLayer(e,void 0,t.options),n.layerIds.push(c)),i?o.loadAndCacheImage(i).then((function(t){o.setLayerImage(e,t,c),o.updateImage(e)})):(o.setLayerImage(e,void 0,c),o.setActiveLayer(e,s),o.updateImage(e))}))}))}}]),e}(),Ed={};Ed.FusionRenderer=Id;var Sd=Ed;function Cd(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function Ad(e,t){var n,o;if(void 0===e)throw new Error("playClip: element must not be undefined");var r=O(e,"stack");if(r&&r.data&&r.data.length){var a,i=y.cornerstone;if(r.data.length>1){var s=O(e,"stackRenderer");s&&s.data&&s.data.length&&(a=s.data[0])}var l=r.data[0],c=O(e,"playClip");c&&c.data&&c.data.length?Cd(n=c.data[0]):L(e,"playClip",n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(o=function(e,t){var n,o,r,a=0,i=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)r=Number(e[n])/t|0,s.push(r),1===n?o=r:r!==o&&(s.isTimeVarying=!0),a+=r;return s.length>0&&(r=s.isTimeVarying?a/s.length|0:s[0],s.push(r)),s}(n.frameTimeVector,n.speed));var u=function(){var t,o,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(c<0||c>=u))return Cd(n),void function(e){T(e,w.CLIP_STOPPED,{element:e})}(e);c>=u&&(c=0),c<0&&(c=u-1),c!==l.currentImageIdIndex&&(t=zs.getStartLoadHandler(e),o=zs.getEndLoadHandler(e),s=zs.getErrorLoadingHandler(e),t&&t(e),(!0===l.preventCache?i.loadImage(l.imageIds[c]):i.loadAndCacheImage(l.imageIds[c])).then((function(t){try{l.currentImageIdIndex=c,a?(a.currentImageIdIndex=c,a.render(e,r.data)):i.displayImage(e,t),o&&o(e,t)}catch(e){return}}),(function(t){var n=l.imageIds[c];s&&s(e,n,t)})))};o&&o.length>0&&o.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,o[l.currentImageIdIndex]),u()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/Math.abs(n.framesPerSecond)))}}function Md(e){var t=O(e,"playClip");t&&t.data&&t.data.length&&Cd(t.data[0])}var Pd=function(e,t){var n=wt.state.tools.findIndex((function(n){return n.element===e&&n.name===t}));n>=0&&wt.state.tools.splice(n,1)},Dd=function(e){Ld(e),wt.state.enabledElements.forEach((function(t){Pd(t,e)}))},Ld=function(e){xt("globalConfiguration").configuration.globalToolSyncEnabled&&wt.state.globalTools[e]&&delete wt.state.globalTools[e]},Od=function(e,t,n){var o=Tt(e,t);o&&o.mergeOptions(n)},kd=function(e,t){vt.enabledElements.forEach((function(n){Od(n,e,t)}))};function Rd(e,t){var n={};return{get:function(o,r){return e.indexOf(r)>=0?(!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r]):t.get(o,r)},add:function(o,r,a){if(!(e.indexOf(r)>=0))return t.add(o,r,a);!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r].data.push(a)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var _d=[];function Nd(e,t){var n=D(e);n||(n=P);var o=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(o=o.concat(t));var r=Rd(o,n);_d.push(r),_(e,r)}var Bd={newStackSpecificToolStateManager:Rd,addStackStateManager:Nd};function Ud(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n))return o[n]}},add:function(t,n,o){!1===e.hasOwnProperty(t)&&(e[t]={});var r=e[t];!1===r.hasOwnProperty(n)&&(r[n]={data:[]}),r[n].data.push(o)},remove:function(t,n,o){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n)){for(var a=r[n],i=-1,s=0;s<a.data.length;s++)a.data[s]===o&&(i=s);-1!==i&&a.data.splice(i,1)}}}}}var Vd=Ud(),Fd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",o=e.querySelector("canvas");if(o.msToBlob){var r=o.msToBlob();return window.navigator.msSaveBlob(r,t)}var a=document.createElement("a");if(a.download=t,a.href=o.toDataURL(n,1),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(i)}else a.fireEvent&&a.fireEvent("onclick")},jd=U("thirdParty:registerModule"),Hd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=zd(e);!o||n?(o&&jd.warn("Overwriting module %s",e),bt[e]=t,"function"==typeof bt[e].onRegisterCallback&&bt[e].onRegisterCallback()):jd.warn("A module with the name %s is already registered",e)};function zd(e){return void 0!==bt[e]}function qd(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}var Wd={"base/BaseTool":mo,"base/BaseAnnotationTool":mr,"base/BaseBrushTool":Po,"tools/cursors/MouseCursor":br,"tools/cursors":r,"manipulators/anyHandlesOutsideImage":To,"manipulators/getHandleNearImagePoint":yo,"manipulators/getHandlePixelPosition":Io,"manipulators/handleActivator":bo,"manipulators/moveAllHandles":No,"manipulators/moveHandle":Go,"manipulators/moveNewHandle":nr,"manipulators/moveHandleNearImagePoint":dr,"manipulators/findHandleDataNearImagePoint":fr,"manipulators/moveAnnotation":hr,"mixins/activeOrDisabledBinaryTool":ao.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":ao.enabledOrDisabledBinaryTool,"drawing/getNewContext":Pn,"drawing/draw":Wt,"drawing/path":Xt,"drawing/setShadow":Ln,"drawing/drawLine":Kt,"drawing/drawLines":fn,"drawing/drawJoinedLines":Qt,"drawing/drawCircle":$t,"drawing/drawEllipse":an,"drawing/drawRect":Mn,"drawing/fillOutsideRect":function(e,t,n,o,r){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var a=y.cornerstone;n=a.pixelToCanvas(t,n),o=a.pixelToCanvas(t,o)}var i=Math.min(n.x,o.x),s=Math.min(n.y,o.y),l=Math.abs(n.x-o.x),c=Math.abs(n.y-o.y);Xt(e,r,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(i+l,s,-l,c)}))},"drawing/drawTextBox":wn,"drawing/drawArrow":Jt,"drawing/fillBox":bn,"drawing/fillTextLines":yn,"drawing/drawLink":hn,"drawing/drawLinkedTextBox":An,"drawing/drawHandles":dn,"drawing/textBoxWidth":xn,"util/getActiveTool":Lo,"util/getLuminance":Vl,"util/getROITextBoxCoords":ni,"util/copyPoints":rc,"util/calculateSUV":Qa,"util/setContextToDisplayFontSize":function(e,t,n){return y.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":kl,"util/scroll":Rl,"util/roundToDecimal":vr,"util/projectPatientPointToImagePlane":tn,"util/imagePointToPatientPoint":nn,"util/planePlaneIntersection":on,"util/pointInsideBoundingBox":go,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")},"util/getRGBPixels":zi,"util/getBrowserInfo":qd,"util/isMobileDevice":function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)},"util/angleBetweenPoints":Tl,"util/numbersWithCommas":oi,"util/lineSegDistance":gr,"util/triggerEvent":T,"util/convertToVector3":en,"util/clip":Tn,"util/clipToBox":In,"util/clipBoxToDisplayedArea":Sn,"util/debounce":sa,"util/deepmerge":fo,"util/getDefault":Dn,"util/getProximityThreshold":lr,"util/getPixelSpacing":aa,"util/isEmptyObject":On,"util/isObject":ia,"util/isPointInImage":Ge,"util/isPointInPolygon":us,"util/getLogger":U,"util/throttle":la,"util/wait":yl,"util/waitForEnabledElementImageToLoad":bl,"util/getKeyPressData":function(e){var t=y.cornerstone,n=e.currentTarget,o=t.getEnabledElement(n);if(o&&o.image){var r=wt.state.mousePositionImage;return{event:window.event||e,element:n,viewport:t.getViewport(n),image:o.image,currentPoints:{image:r,canvas:t.pixelToCanvas(n,r)},keyCode:e.keyCode,which:e.which}}},"util/ellipseUtils":ti,"util/freehandUtils":Oi,"util/segmentationUtils":o,"util/zoomUtils":Yl},Gd=U("thirdParty:registerMixin"),Yd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Zd(e);!o||n?(o&&Gd.warn("Overwriting mixins/%s",e),ao[e]=t,Wd["mixins/".concat(e)]=ao[e]):Gd.warn("mixins/%s is already registered",e)};function Zd(e){return void 0!==ao[e]}var Xd=U("thirdParty:registerType"),Kd=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r="".concat(e,"/").concat(t),a=Qd(r);!a||o?(a&&Xd.warn("Overwriting %s",r),Wd[r]=n):Xd.warn("%s is already registered",r)};function Qd(e){return void 0!==Wd[e]}var Jd=U("thirdParty:register"),$d=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(ef(e,t,n))switch(e){case"module":Hd(t,n,o);break;case"mixin":Yd(t,n,o);break;default:Kd(e,t,n,o)}};function ef(e,t,n){return e?t?"object"===x()(n)||"function"==typeof n||(Jd.warn("The %s is a %s, it should be an Object or a function.",n,x()(n)),!1):(Jd.warn("The %s must have a name in order to register.",e),!1):(Jd.warn("The type must be given in order to register."),!1)}var tf=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach((function(e){var n=e.type,o=e.name,r=e.item;$d(n,o,r,t)}))},nf=function(e,t,n){if(n!==t){var o=y.cornerstone,r=o.getViewport(t),a=o.getViewport(n);a.voi.windowWidth===r.voi.windowWidth&&a.voi.windowCenter===r.voi.windowCenter&&a.invert===r.invert||(a.voi.windowWidth=r.voi.windowWidth,a.voi.windowCenter=r.voi.windowCenter,a.invert=r.invert,e.setViewport(n,a))}},of=function(e,t,n){n!==t&&y.cornerstone.updateImage(n)};function rf(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}var af=function(e,t){y.cornerstone;var n=this,o=[],r=[],a=!1,i={},s=t;function l(e){var t=e.detail.element;n.remove(t),function(e){for(var t in qs)qs[t]=qs[t].filter((function(t){return t.element!==e}))}(t)}this.enabled=!0,this.setHandler=function(e){s=e},this.getHandler=function(){return s},this.getDistances=function(){if(o.length&&r.length){var e=y.cornerstone;i.distances={},i.imageIds={sourceElements:[],targetElements:[]},o.forEach((function(t){var n=e.getEnabledElement(t);if(n&&n.image){var o=n.image.imageId,a=e.metaData.get("imagePlaneModule",o);if(a&&a.imagePositionPatient){var s=en(a.imagePositionPatient);i.hasOwnProperty(n)||(i.distances[o]={},i.imageIds.sourceElements.push(o),r.forEach((function(n){var r=e.getEnabledElement(n);if(r&&r.image){var a=r.image.imageId;if(i.imageIds.targetElements.push(a),t!==n&&o!==a&&!i.distances[o].hasOwnProperty(a)){var l=e.metaData.get("imagePlaneModule",a);if(l&&l.imagePositionPatient){var c=en(l.imagePositionPatient);i.distances[o][a]=c.clone().sub(s)}}}})),Object.keys(i.distances[o]).length||delete i.distances[o])}}}))}},this.fireEvent=function(e,t){var l=!n.enabled,c=!o.length||!r.length;l||c||(a=!0,r.forEach((function(a){var l=r.indexOf(a);if(-1!==l){var c=i.imageIds.targetElements[l],u=o.indexOf(e);if(-1!==u){var d,f=i.imageIds.sourceElements[u];f===c?d=0:void 0!==i.distances[f]&&(d=i.distances[f][c]),s(n,e,a,t,d)}}})),a=!1)},this.onEvent=function(e){var t=e.detail;!0!==a&&n.fireEvent(e.currentTarget,t)},this.addSource=function(t){-1===o.indexOf(t)&&(o.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,n.onEvent)})),n.getDistances(),n.updateDisableHandlers())},this.addTarget=function(e){-1===r.indexOf(e)&&(r.push(e),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.add=function(e){n.addSource(e),n.addTarget(e)},this.removeSource=function(t){var r=o.indexOf(t);-1!==r&&(o.splice(r,1),e.split(" ").forEach((function(e){t.removeEventListener(e,n.onEvent)})),n.getDistances(),n.fireEvent(t),n.updateDisableHandlers())},this.removeTarget=function(e){var t=r.indexOf(e);-1!==t&&(r.splice(t,1),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.remove=function(e){n.removeTarget(e),n.removeSource(e)},this.getSourceElements=function(){return o},this.getTargetElements=function(){return r},this.displayImage=function(e,t,n){a=!0,y.cornerstone.displayImage(e,t,n),a=!1},this.setViewport=function(e,t){a=!0,y.cornerstone.setViewport(e,t),a=!1},this.updateDisableHandlers=function(){rf(o.concat(r)).forEach((function(e){e.removeEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l),e.addEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l)}))},this.destroy=function(){rf(o.concat(r)).forEach((function(e){n.remove(e)}))}},sf=function(e,t,n,o){if(t!==n&&o&&o.direction){var r=y.cornerstone,a=O(n,"stack").data[0],i=a.currentImageIdIndex+o.direction;if(i=Cn(i,0,a.imageIds.length-1),a.currentImageIdIndex!==i){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);a.currentImageIdIndex=i;var u=a.imageIds[i];s&&s(n),(!0===a.preventCache?r.loadImage(u):r.loadAndCacheImage(u)).then((function(t){var o=r.getViewport(n);a.currentImageIdIndex===i&&(e.displayImage(n,t,o),l&&l(n,t))}),(function(e){var t=a.imageIds[i];c&&c(n,t,e)}))}}},lf=function(e,t,n){if(n!==t){var o=y.cornerstone,r=O(t,"stack").data[0],a=r.imageIds[r.currentImageIdIndex],i=o.metaData.get("imagePlaneModule",a);if(void 0!==i&&void 0!==i.imagePositionPatient){var s=en(i.imagePositionPatient),l=O(n,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(l.imageIds.forEach((function(e,t){var n=o.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=en(n.imagePositionPatient).distanceToSquared(s);r<c&&(c=r,u=t)}})),u!==l.currentImageIdIndex){var d=zs.getStartLoadHandler(n),f=zs.getEndLoadHandler(n),h=zs.getErrorLoadingHandler(n);l.currentImageIdIndex=u;var p=l.imageIds[u];d&&d(n),-1!==u&&(!0===l.preventCache?o.loadImage(p):o.loadAndCacheImage(p)).then((function(t){var r=o.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,r),f&&f(n,t))}),(function(e){var t=l.imageIds[u];h&&h(n,t,e)}))}}}},cf=function(e,t,n,o,r){if(n!==t){var a=y.cornerstone,i=O(t,"stack").data[0],s=i.imageIds[i.currentImageIdIndex],l=a.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=en(l.imagePositionPatient),u=O(n,"stack").data[0],d=Number.MAX_VALUE,f=-1;if(r){var h=c.clone().add(r);if(u.imageIds.forEach((function(e,t){var n=a.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var o=en(n.imagePositionPatient),r=h.distanceToSquared(o);r<d&&(d=r,f=t)}})),f!==u.currentImageIdIndex&&-1!==f){var p=zs.getStartLoadHandler(n),m=zs.getEndLoadHandler(n),g=zs.getErrorLoadingHandler(n);u.currentImageIdIndex=f;var v=u.imageIds[f];p&&p(n),(!0===u.preventCache?a.loadImage(v):a.loadAndCacheImage(v)).then((function(t){var o=a.getViewport(n);u.currentImageIdIndex===f&&(e.displayImage(n,t,o),m&&m(n,t))}),(function(e){var t=u.imageIds[f];g&&g(n,t,e)}))}}}}},uf=function(e,t,n){if(n!==t){var o=y.cornerstone,r=O(t,"stack").data[0],a=O(n,"stack").data[0],i=r.currentImageIdIndex;if((i=Cn(i,0,a.imageIds.length-1))!==a.currentImageIdIndex){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);s&&s(n),(!0===a.preventCache?o.loadImage(a.imageIds[i]):o.loadAndCacheImage(a.imageIds[i])).then((function(t){var r=o.getViewport(n);a.currentImageIdIndex=i,e.displayImage(n,t,r),l&&l(n,t)}),(function(e){var t=a.imageIds[i];c&&c(n,t,e)}))}}},df=function(e,t,n){if(n!==t){var o=y.cornerstone,r=o.getViewport(t),a=o.getViewport(n);a.scale===r.scale&&a.translation.x===r.translation.x&&a.translation.y===r.translation.y||(a.scale=r.scale,a.translation.x=r.translation.x,a.translation.y=r.translation.y,e.setViewport(n,a))}},ff=function(e){return Wd[e]};n.d(t,"AngleTool",(function(){return ca})),n.d(t,"ArrowAnnotateTool",(function(){return fa})),n.d(t,"BidirectionalTool",(function(){return Ka})),n.d(t,"CircleRoiTool",(function(){return ai})),n.d(t,"CobbAngleTool",(function(){return ui})),n.d(t,"EllipticalRoiTool",(function(){return fi})),n.d(t,"FreehandRoiTool",(function(){return Vi})),n.d(t,"LengthTool",(function(){return Hi})),n.d(t,"ProbeTool",(function(){return Wi})),n.d(t,"RectangleRoiTool",(function(){return Yi})),n.d(t,"TextMarkerTool",(function(){return Ji})),n.d(t,"BrushTool",(function(){return ts})),n.d(t,"SphericalBrushTool",(function(){return rs})),n.d(t,"RectangleScissorsTool",(function(){return Ns})),n.d(t,"FreehandScissorsTool",(function(){return _s})),n.d(t,"CircleScissorsTool",(function(){return Bs})),n.d(t,"CorrectionScissorsTool",(function(){return Us})),n.d(t,"CrosshairsTool",(function(){return Ys})),n.d(t,"DoubleTapFitToWindowTool",(function(){return Zs})),n.d(t,"DragProbeTool",(function(){return Xs})),n.d(t,"EraserTool",(function(){return Js})),n.d(t,"FreehandRoiSculptorTool",(function(){return el})),n.d(t,"MagnifyTool",(function(){return nl})),n.d(t,"OverlayTool",(function(){return rl})),n.d(t,"OrientationMarkersTool",(function(){return il})),n.d(t,"PanMultiTouchTool",(function(){return dl})),n.d(t,"PanTool",(function(){return fl})),n.d(t,"ReferenceLinesTool",(function(){return wl})),n.d(t,"RotateTool",(function(){return Il})),n.d(t,"RotateTouchTool",(function(){return Al})),n.d(t,"ScaleOverlayTool",(function(){return Pl})),n.d(t,"StackScrollMouseWheelTool",(function(){return Nl})),n.d(t,"StackScrollMultiTouchTool",(function(){return Bl})),n.d(t,"StackScrollTool",(function(){return Ul})),n.d(t,"WwwcRegionTool",(function(){return Fl})),n.d(t,"WwwcTool",(function(){return ql})),n.d(t,"ZoomMouseWheelTool",(function(){return Zl})),n.d(t,"ZoomTool",(function(){return Ql})),n.d(t,"ZoomTouchPinchTool",(function(){return oc})),n.d(t,"init",(function(){return fd})),n.d(t,"stackPrefetch",(function(){return Td})),n.d(t,"stackRenderers",(function(){return Sd})),n.d(t,"playClip",(function(){return Ad})),n.d(t,"stopClip",(function(){return Md})),n.d(t,"store",(function(){return wt})),n.d(t,"getModule",(function(){return xt})),n.d(t,"getToolForElement",(function(){return Tt})),n.d(t,"addTool",(function(){return Ju})),n.d(t,"addToolForElement",(function(){return Qu})),n.d(t,"removeTool",(function(){return Dd})),n.d(t,"removeToolForElement",(function(){return Pd})),n.d(t,"setToolOptions",(function(){return kd})),n.d(t,"setToolOptionsForElement",(function(){return Od})),n.d(t,"isToolActiveForElement",(function(){return Ao})),n.d(t,"setToolActive",(function(){return Dt})),n.d(t,"setToolActiveForElement",(function(){return Pt})),n.d(t,"setToolEnabled",(function(){return Rt})),n.d(t,"setToolEnabledForElement",(function(){return kt})),n.d(t,"setToolDisabled",(function(){return Ot})),n.d(t,"setToolDisabledForElement",(function(){return Lt})),n.d(t,"setToolPassive",(function(){return Nt})),n.d(t,"setToolPassiveForElement",(function(){return _t})),n.d(t,"addToolState",(function(){return L})),n.d(t,"getToolState",(function(){return O})),n.d(t,"removeToolState",(function(){return k})),n.d(t,"clearToolState",(function(){return R})),n.d(t,"setElementToolStateManager",(function(){return _})),n.d(t,"getElementToolStateManager",(function(){return D})),n.d(t,"textStyle",(function(){return vn})),n.d(t,"toolStyle",(function(){return Zt})),n.d(t,"toolColors",(function(){return un})),n.d(t,"toolCoordinates",(function(){return Ca})),n.d(t,"stackSpecificStateManager",(function(){return Bd})),n.d(t,"newStackSpecificToolStateManager",(function(){return Rd})),n.d(t,"addStackStateManager",(function(){return Nd})),n.d(t,"loadHandlerManager",(function(){return zs})),n.d(t,"newImageIdSpecificToolStateManager",(function(){return M})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return P})),n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return Ud})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return Vd})),n.d(t,"forceEnabledElementResize",(function(){return ud})),n.d(t,"orientation",(function(){return al})),n.d(t,"SaveAs",(function(){return Fd})),n.d(t,"enableLogger",(function(){return V})),n.d(t,"disableLogger",(function(){return F})),n.d(t,"register",(function(){return $d})),n.d(t,"registerSome",(function(){return tf})),n.d(t,"wwwcSynchronizer",(function(){return nf})),n.d(t,"updateImageSynchronizer",(function(){return of})),n.d(t,"Synchronizer",(function(){return af})),n.d(t,"stackScrollSynchronizer",(function(){return sf})),n.d(t,"stackImagePositionSynchronizer",(function(){return lf})),n.d(t,"stackImagePositionOffsetSynchronizer",(function(){return cf})),n.d(t,"stackImageIndexSynchronizer",(function(){return uf})),n.d(t,"panZoomSynchronizer",(function(){return df})),n.d(t,"importInternal",(function(){return ff})),n.d(t,"external",(function(){return y})),n.d(t,"EVENTS",(function(){return w})),n.d(t,"version",(function(){return"6.0.10"})),n.d(t,"import",(function(){return ff}));var hf={AngleTool:ca,ArrowAnnotateTool:fa,BidirectionalTool:Ka,CircleRoiTool:ai,CobbAngleTool:ui,EllipticalRoiTool:fi,FreehandRoiTool:Vi,LengthTool:Hi,ProbeTool:Wi,RectangleRoiTool:Yi,TextMarkerTool:Ji,BrushTool:ts,SphericalBrushTool:rs,RectangleScissorsTool:Ns,FreehandScissorsTool:_s,CircleScissorsTool:Bs,CorrectionScissorsTool:Us,CrosshairsTool:Ys,DoubleTapFitToWindowTool:Zs,DragProbeTool:Xs,EraserTool:Js,FreehandRoiSculptorTool:el,MagnifyTool:nl,OverlayTool:rl,OrientationMarkersTool:il,PanMultiTouchTool:dl,PanTool:fl,ReferenceLinesTool:wl,RotateTool:Il,RotateTouchTool:Al,ScaleOverlayTool:Pl,StackScrollMouseWheelTool:Nl,StackScrollMultiTouchTool:Bl,StackScrollTool:Ul,WwwcRegionTool:Fl,WwwcTool:ql,ZoomMouseWheelTool:Zl,ZoomTool:Ql,ZoomTouchPinchTool:oc,init:fd,stackPrefetch:Td,stackRenderers:Sd,playClip:Ad,stopClip:Md,store:wt,getModule:xt,getToolForElement:Tt,addTool:Ju,addToolForElement:Qu,removeTool:Dd,removeToolForElement:Pd,setToolOptions:kd,setToolOptionsForElement:Od,isToolActiveForElement:Ao,setToolActive:Dt,setToolActiveForElement:Pt,setToolEnabled:Rt,setToolEnabledForElement:kt,setToolDisabled:Ot,setToolDisabledForElement:Lt,setToolPassive:Nt,setToolPassiveForElement:_t,addToolState:L,getToolState:O,removeToolState:k,clearToolState:R,setElementToolStateManager:_,getElementToolStateManager:D,textStyle:vn,toolStyle:Zt,toolColors:un,toolCoordinates:Ca,stackSpecificStateManager:Bd,newStackSpecificToolStateManager:Rd,addStackStateManager:Nd,loadHandlerManager:zs,newImageIdSpecificToolStateManager:M,globalImageIdSpecificToolStateManager:P,newFrameOfReferenceSpecificToolStateManager:Ud,globalFrameOfReferenceSpecificToolStateManager:Vd,forceEnabledElementResize:ud,orientation:al,SaveAs:Fd,enableLogger:V,disableLogger:F,importInternal:ff,import:ff,register:$d,registerSome:tf,wwwcSynchronizer:nf,updateImageSynchronizer:of,Synchronizer:af,stackScrollSynchronizer:sf,stackImagePositionSynchronizer:lf,stackImagePositionOffsetSynchronizer:cf,stackImageIndexSynchronizer:uf,panZoomSynchronizer:df,external:y,EVENTS:w,version:"6.0.10"};t.default=hf}])},6439:e=>{
/*! cornerstone-web-image-loader - 2.1.1 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWebImageLoader */
window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var o,r=(o=n(4))&&o.__esModule?o:{default:o},a=void 0,i={set cornerstone(e){a=e,(0,r.default)(a)},get cornerstone(){return a}};t.external=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=function(e){var t=o.external.cornerstone,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",s.beforeSend(n),n.onprogress=function(n){if(n.lengthComputable){var o=n.loaded,r=n.total,a=Math.round(o/r*100),i={imageId:e,loaded:o,total:r,percentComplete:a};t.triggerEvent(t.events,"cornerstoneimageloadprogress",i)}},{promise:new Promise((function(t,o){n.onload=function(){(0,r.default)(this.response).then((function(n){var o=(0,a.default)(n,e);t(o)}),o)},n.send()})),cancelFn:function(){n.abort()}}},t.configure=function(e){s=e};var o=n(0),r=i(n(3)),a=i(n(2));function i(e){return e&&e.__esModule?e:{default:e}}var s={beforeSend:function(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.naturalHeight,i=e.naturalWidth;return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,render:o.external.cornerstone.renderWebImage,getPixelData:function(){return(n=void 0,a===t?n=r.getContext("2d"):(r.height=e.naturalHeight,r.width=e.naturalWidth,(n=r.getContext("2d")).drawImage(e,0,0),a=t),n.getImageData(0,0,e.naturalWidth,e.naturalHeight)).data;var n},getCanvas:function(){return a===t||(r.height=e.naturalHeight,r.width=e.naturalWidth,r.getContext("2d").drawImage(e,0,0),a=t),r},getImage:function(){return e},rows:n,columns:i,height:n,width:i,color:!0,rgba:!1,columnPixelSpacing:void 0,rowPixelSpacing:void 0,invert:!1,sizeInBytes:n*i*4}};var o=n(0),r=document.createElement("canvas"),a=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((function(t,n){var o=new Image,r=new Uint8Array(e),a=new Blob([r]),i=window.URL||window.webkitURL,s=i.createObjectURL(a);o.src=s,o.onload=function(){t(o),i.revokeObjectURL(s)},o.onerror=function(e){i.revokeObjectURL(s),n(e)}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.registerImageLoader("http",o.loadImage),e.registerImageLoader("https",o.loadImage)};var o=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.configure=t.loadImage=t.createImage=t.arrayBufferToImage=void 0;var o=s(n(3)),r=s(n(2)),a=n(1),i=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var l={arrayBufferToImage:o.default,createImage:r.default,loadImage:a.loadImage,configure:a.configure,external:i.external};t.arrayBufferToImage=o.default,t.createImage=r.default,t.loadImage=a.loadImage,t.configure=a.configure,t.external=i.external,t.default=l}])},41:(e,t,n)=>{"use strict";var o=n(655),r=n(8068),a=n(9675),i=n(5795);e.exports=function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new a("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],d=!!i&&i(e,t);if(o)o(e,t,{configurable:null===c&&d?d.configurable:!c,enumerable:null===s&&d?d.enumerable:!s,value:n,writable:null===l&&d?d.writable:!l});else{if(!u&&(s||l||c))throw new r("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=n}}},5915:function(e,t,n){
/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */
e.exports=function(e){return n=[function(t,n){t.exports=e},function(e,t,n){"use strict";n.r(t),n.d(t,"isStringVr",(function(){return r})),n.d(t,"isPrivateTag",(function(){return a})),n.d(t,"parsePN",(function(){return i})),n.d(t,"parseTM",(function(){return s})),n.d(t,"parseDA",(function(){return c})),n.d(t,"explicitElementToString",(function(){return u})),n.d(t,"explicitDataSetToJS",(function(){return d})),n.d(t,"createJPEGBasicOffsetTable",(function(){return p})),n.d(t,"parseDicomDataSetExplicit",(function(){return O})),n.d(t,"parseDicomDataSetImplicit",(function(){return k})),n.d(t,"readFixedString",(function(){return y})),n.d(t,"alloc",(function(){return R})),n.d(t,"version",(function(){return _})),n.d(t,"bigEndianByteArrayParser",(function(){return N})),n.d(t,"ByteStream",(function(){return V})),n.d(t,"sharedCopy",(function(){return B})),n.d(t,"DataSet",(function(){return w})),n.d(t,"findAndSetUNElementLength",(function(){return v})),n.d(t,"findEndOfEncapsulatedElement",(function(){return g})),n.d(t,"findItemDelimitationItemAndSetElementLength",(function(){return T})),n.d(t,"littleEndianByteArrayParser",(function(){return F})),n.d(t,"parseDicom",(function(){return z})),n.d(t,"readDicomElementExplicit",(function(){return L})),n.d(t,"readDicomElementImplicit",(function(){return E})),n.d(t,"readEncapsulatedImageFrame",(function(){return Z})),n.d(t,"readEncapsulatedPixelData",(function(){return K})),n.d(t,"readEncapsulatedPixelDataFromFragments",(function(){return W})),n.d(t,"readPart10Header",(function(){return j})),n.d(t,"readSequenceItemsExplicit",(function(){return P})),n.d(t,"readSequenceItemsImplicit",(function(){return A})),n.d(t,"readSequenceItem",(function(){return S})),n.d(t,"readTag",(function(){return m}));var o={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},r=function(e){return o[e]},a=function(e){if(e=parseInt(e[4],16),isNaN(e))throw"dicomParser.isPrivateTag: cannot parse last character of group";return e%2==1},i=function(e){if(void 0!==e)return{familyName:(e=e.split("^"))[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}};function s(e,t){if(2<=e.length){var n=parseInt(e.substring(0,2),10),o=4<=e.length?parseInt(e.substring(2,4),10):void 0,r=6<=e.length?parseInt(e.substring(4,6),10):void 0,a=(a=8<=e.length?e.substring(7,13):void 0)?parseInt(a,10)*Math.pow(10,6-a.length):void 0;if(t&&(isNaN(n)||void 0!==o&&isNaN(o)||void 0!==r&&isNaN(r)||void 0!==a&&isNaN(a)||n<0||23<n||o&&(o<0||59<o)||r&&(r<0||59<r)||a&&(a<0||999999<a)))throw"invalid TM '".concat(e,"'");return{hours:n,minutes:o,seconds:r,fractionalSeconds:a}}if(t)throw"invalid TM '".concat(e,"'")}function l(e,t,n){return!isNaN(n)&&0<t&&t<=12&&0<e&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}function c(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),o=parseInt(e.substring(4,6),10),r=parseInt(e.substring(6,8),10);if(t&&!0!==l(r,o,n))throw"invalid DA '".concat(e,"'");return{year:n,month:o,day:r}}if(t)throw"invalid DA '".concat(e,"'")}function u(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,o=t.vr,a=t.tag;function i(t,n){for(var o="",r=0;r<t;r++)0!==r&&(o+="/"),o+=n.call(e,a,r).toString();return o}if(!0===r(o))n=e.string(a);else{if("AT"===o){var s=e.uint32(a);return void 0===s?void 0:"x".concat((s=s<0?4294967295+s+1:s).toString(16).toUpperCase())}"US"===o?n=i(t.length/2,e.uint16):"SS"===o?n=i(t.length/2,e.int16):"UL"===o?n=i(t.length/4,e.uint32):"SL"===o?n=i(t.length/4,e.int32):"FD"===o?n=i(t.length/8,e.double):"FL"===o&&(n=i(t.length/4,e.float))}return n}function d(e,t){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";t=t||{omitPrivateAttibutes:!0,maxElementLength:128};var n,o={};for(n in e.elements){var r=e.elements[n];if(!0!==t.omitPrivateAttibutes||!a(n))if(r.items){for(var i=[],s=0;s<r.items.length;s++)i.push(d(r.items[s].dataSet,t));o[n]=i}else{var l=void 0;r.length<t.maxElementLength&&(l=u(e,r)),o[n]=void 0!==l?l:{dataOffset:r.dataOffset,length:r.length}}}return o}function f(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function h(e,t,n){for(var o,r,a=n;a<t.fragments.length;a++)if(r=a,f(o=e,(r=t.fragments[r]).position+r.length-2)||f(o,r.position+r.length-3))return a}function p(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var o=[],r=0;;){o.push(t.fragments[r].offset);var a=h(e,t,r);if(void 0===a||a===t.fragments.length-1)return o;r=a+1}}function m(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256;return e=e.readUint16(),"x".concat("00000000".concat((t+e).toString(16)).substr(-8))}function g(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==m(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var o=e.readUint32()/4,r=0;r<o;r++){var a=e.readUint32();t.basicOffsetTable.push(a)}for(var i=e.position;e.position<e.byteArray.length;){var s=m(e),l=e.readUint32();if("xfffee0dd"===s)return e.seek(l),void(t.length=e.position-t.dataOffset);if("xfffee000"!==s)return n&&n.push("unexpected tag ".concat(s," while searching for end of pixel data element with undefined length")),l>e.byteArray.length-e.position&&(l=e.byteArray.length-e.position),t.fragments.push({offset:e.position-i-8,position:e.position,length:l}),e.seek(l),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-i-8,position:e.position,length:l}),e.seek(l)}n&&n.push("pixel data element ".concat(t.tag," missing sequence delimiter tag xfffee0dd"))}function v(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}function y(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var o,r="",a=0;a<n;a++){if(0===(o=e[t+a]))return t+=n,r;r+=String.fromCharCode(o)}return r}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function x(e,t){return void 0!==e.parser?e.parser:t}var w=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=o}var t,n,o;return t=e,(n=[{key:"uint16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readUint16(this.byteArray,e.dataOffset+2*t)}},{key:"int16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readInt16(this.byteArray,e.dataOffset+2*t)}},{key:"uint32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readUint32(this.byteArray,e.dataOffset+4*t)}},{key:"int32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readInt32(this.byteArray,e.dataOffset+4*t)}},{key:"float",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readFloat(this.byteArray,e.dataOffset+4*t)}},{key:"double",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readDouble(this.byteArray,e.dataOffset+8*t)}},{key:"numStringValues",value:function(e){if((e=this.elements[e])&&0<e.length)return null===(e=y(this.byteArray,e.dataOffset,e.length).match(/\\/g))?1:e.length+1}},{key:"string",value:function(e,t){return(e=this.elements[e])&&e.Value?e.Value:e&&0<e.length?(e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].trim():e.trim()):void 0}},{key:"text",value:function(e,t){if((e=this.elements[e])&&0<e.length)return e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].replace(/ +$/,""):e.replace(/ +$/,"")}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseFloat(t)}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseInt(t)}},{key:"attributeTag",value:function(e){if((n=this.elements[e])&&4===n.length){var t=x(n,this.byteArrayParser).readUint16,n=(e=this.byteArray,n.dataOffset);return"x".concat("00000000".concat((256*t(e,n)*256+t(e,n+2)).toString(16)).substr(-8))}}}])&&b(t.prototype,n),o&&b(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function T(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}var I=function(e,t){return void 0!==e.vr?"SQ"===e.vr:t.position+4<=t.byteArray.length?(e=m(t),t.seek(-4),"xfffee000"===e||"xfffee0dd"===e):(t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function E(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var o;return 4294967295===(o={tag:o=m(e),vr:void 0!==n?n(o):void 0,length:e.readUint32(),dataOffset:e.position}).length&&(o.hadUndefinedLength=!0),o.tag===t||(!I(o,e)||a(o.tag)&&!o.hadUndefinedLength?o.hadUndefinedLength?T(e,o):e.seek(o.length):(A(e,o,n),a(o.tag)&&(o.items=void 0))),o}function S(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:m(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(e.position);return t}function C(e,t){var n=S(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var o=E(e,void 0,t);if("xfffee00d"===(n[o.tag]=o).tag)return new w(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),k(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}function A(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var o=m(e);if(e.seek(-4),"xfffee0dd"===o)return t.length=e.position-t.dataOffset,e.seek(8);o=C(e,n),t.items.push(o)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}:function(e,t,n){for(var o=t.dataOffset+t.length;e.position<o;){var r=C(e,n);t.items.push(r)}})(e,t,n)}function M(e,t){var n=S(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var o=L(e,t);if("xfffee00d"===(n[o.tag]=o).tag)return new w(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),O(n.dataSet,e,e.position+n.length)),n}function P(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var o=m(e);if(e.seek(-4),"xfffee0dd"===o)return t.length=e.position-t.dataOffset,e.seek(8);o=M(e,n),t.items.push(o)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}:function(e,t,n){for(var o=t.dataOffset+t.length;e.position<o;){var r=M(e,n);t.items.push(r)}})(e,t,n)}var D=function(e){return"OB"===e||"OD"===e||"OL"===e||"OW"===e||"SQ"===e||"OF"===e||"UC"===e||"UR"===e||"UT"===e||"UN"===e?4:2};function L(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var o={tag:m(e),vr:e.readFixedString(2)};return 2===D(o.vr)?o.length=e.readUint16():(e.seek(2),o.length=e.readUint32()),o.dataOffset=e.position,4294967295===o.length&&(o.hadUndefinedLength=!0),o.tag===n||("SQ"===o.vr?P(e,o,t):4294967295===o.length?"x7fe00010"===o.tag?g(e,o,t):("UN"===o.vr?A:T)(e,o):e.seek(o.length)),o}function O(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?t.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var r=e.elements;t.position<n;){var a=L(t,e.warnings,o.untilTag);if((r[a.tag]=a).tag===o.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function k(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?e.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var r=e.elements;t.position<n;){var a=E(t,o.untilTag,o.vrCallback);if((r[a.tag]=a).tag===o.untilTag)return}}function R(e,t){if("undefined"!=typeof Buffer&&e instanceof Buffer)return Buffer.alloc(t);if(e instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"}var _="1.8.12",N={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=(e[t]<<8)+e[t+1])?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}};function B(e,t,n){if("undefined"!=typeof Buffer&&e instanceof Buffer)return e.slice(t,t+n);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+t,n);throw"dicomParser.from: unknown type for byteArray"}function U(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var V=function(){function e(t,n,o){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==0&&("undefined"==typeof Buffer||n instanceof Buffer==0))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(o<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(o>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=t,this.byteArray=n,this.position=o||0,this.warnings=[]}var t,n,o;return t=e,(n=[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=B(this.byteArray,this.position,t);return this.position+=t,new e(this.byteArrayParser,n)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=y(this.byteArray,this.position,e);return this.position+=e,t}}])&&U(t.prototype,n),o&&U(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}(),F={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=e[t]+(e[t+1]<<8))?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}};function j(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=t.TransferSyntaxUID,o=new V(F,e);return function(){var e=function(){if(o.getSize()<=132&&n)return!1;if(o.seek(128),"DICM"===o.readFixedString(4))return!0;if(!(t||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return o.seek(0),!1}(),r=[],a={};if(!e)return o.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:n}},warnings:r};for(;o.position<o.byteArray.length;){var i=o.position,s=L(o,r);if("x0002ffff"<s.tag){o.position=i;break}s.parser=F,a[s.tag]=s}return(e=new w(o.byteArrayParser,o.byteArray,a)).warnings=o.warnings,e.position=o.position,e}()}var H="1.2.840.10008.1.2.2";function z(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var o,r=function(t){if(void 0===t.elements.x00020010)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return(t=t.elements.x00020010)&&t.Value||y(e,t.dataOffset,t.length)};function a(o){var a="1.2.840.10008.1.2"!==(i=r(o)),i=function(o,r){var a="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);if("1.2.840.10008.1.2.1.99"!==o)return new V(o===H?N:F,e,r);if(t&&t.inflater)return o=t.inflater(e,r),new V(F,o,0);if(1==a){var i=n(0),s=B(e,r,e.length-r);return i=i.inflateRawSync(s),s=R(e,i.length+r),e.copy(s,0,0,r),i.copy(s,r),new V(F,s,0)}if("undefined"==typeof pako)throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return i=e.slice(r),s=pako.inflateRaw(i),(i=R(e,s.length+r)).set(e.slice(0,r),0),i.set(s,r),new V(F,i,0)}(i,o.position);(o=new w(i.byteArrayParser,i.byteArray,{})).warnings=i.warnings;try{(a?O:k)(o,i,i.byteArray.length,t)}catch(i){throw{exception:i,dataSet:o}}return o}return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(o=j(e,t),a(o))}var q=function(e,t,n){for(var o=0,r=t;r<t+n;r++)o+=e[r].length;return o};function W(e,t,n,o,r){if(r=r||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(o=o||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(o<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+o>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var a=new V(e.byteArrayParser,e.byteArray,t.dataOffset);if("xfffee000"!==(t=S(a)).tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";a.seek(t.length);var i=a.position;if(1===o)return B(a.byteArray,i+r[n].offset+8,r[n].length);t=q(r,n,o);for(var s=R(a.byteArray,t),l=0,c=n;c<n+o;c++)for(var u=i+r[c].offset+8,d=0;d<r[c].length;d++)s[l++]=a.byteArray[u++];return s}var G=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},Y=function(e,t,n,o){if(e===t.length-1)return n.length-o;for(var r=t[e+1],a=o+1;a<n.length;a++)if(n[a].offset===r)return a-o;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function Z(e,t,n,o,r){if(o=o||t.basicOffsetTable,r=r||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===o)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===o.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=o.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var a=o[n];if(void 0===(a=G(r,a)))throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return W(e,t,a,Y(n,o,r,a),r)}var X=!1;function K(e,t,n){if(X||(X=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?Z(e,t,n):W(e,t,0,t.fragments.length)}t.default={isStringVr:r,isPrivateTag:a,parsePN:i,parseTM:s,parseDA:c,explicitElementToString:u,explicitDataSetToJS:d,createJPEGBasicOffsetTable:p,parseDicomDataSetExplicit:O,parseDicomDataSetImplicit:k,readFixedString:y,alloc:R,version:_,bigEndianByteArrayParser:N,ByteStream:V,sharedCopy:B,DataSet:w,findAndSetUNElementLength:v,findEndOfEncapsulatedElement:g,findItemDelimitationItemAndSetElementLength:T,littleEndianByteArrayParser:F,parseDicom:z,readDicomElementExplicit:L,readDicomElementImplicit:E,readEncapsulatedImageFrame:Z,readEncapsulatedPixelData:K,readEncapsulatedPixelDataFromFragments:W,readPart10Header:j,readSequenceItemsExplicit:P,readSequenceItemsImplicit:A,readSequenceItem:S,readTag:m,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],o={},t.m=n,t.c=o,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(t){return e[t]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1);function t(e){if(o[e])return o[e].exports;var r=o[e]={i:e,l:!1,exports:{}};return n[e].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n,o}(n(6559))},655:(e,t,n)=>{"use strict";var o=n(453)("%Object.defineProperty%",!0)||!1;if(o)try{o({},"a",{value:1})}catch(e){o=!1}e.exports=o},1237:e=>{"use strict";e.exports=EvalError},9383:e=>{"use strict";e.exports=Error},9290:e=>{"use strict";e.exports=RangeError},9538:e=>{"use strict";e.exports=ReferenceError},8068:e=>{"use strict";e.exports=SyntaxError},9675:e=>{"use strict";e.exports=TypeError},5345:e=>{"use strict";e.exports=URIError},9353:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,o=function(e,t){for(var n=[],o=0;o<e.length;o+=1)n[o]=e[o];for(var r=0;r<t.length;r+=1)n[r+e.length]=t[r];return n};e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==t.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var a,i=function(e,t){for(var n=[],o=t||0,r=0;o<e.length;o+=1,r+=1)n[r]=e[o];return n}(arguments,1),s=n(0,r.length-i.length),l=[],c=0;c<s;c++)l[c]="$"+c;if(a=Function("binder","return function ("+function(e,t){for(var n="",o=0;o<e.length;o+=1)n+=e[o],o+1<e.length&&(n+=t);return n}(l,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof a){var t=r.apply(this,o(i,arguments));return Object(t)===t?t:this}return r.apply(e,o(i,arguments))})),r.prototype){var u=function(){};u.prototype=r.prototype,a.prototype=new u,u.prototype=null}return a}},6743:(e,t,n)=>{"use strict";var o=n(9353);e.exports=Function.prototype.bind||o},453:(e,t,n)=>{"use strict";var o,r=n(9383),a=n(1237),i=n(9290),s=n(9538),l=n(8068),c=n(9675),u=n(5345),d=Function,f=function(e){try{return d('"use strict"; return ('+e+").constructor;")()}catch(e){}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch(e){h=null}var p=function(){throw new c},m=h?function(){try{return p}catch(e){try{return h(arguments,"callee").get}catch(e){return p}}}():p,g=n(4039)(),v=n(24)(),y=Object.getPrototypeOf||(v?function(e){return e.__proto__}:null),b={},x="undefined"!=typeof Uint8Array&&y?y(Uint8Array):o,w={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?o:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?o:ArrayBuffer,"%ArrayIteratorPrototype%":g&&y?y([][Symbol.iterator]()):o,"%AsyncFromSyncIteratorPrototype%":o,"%AsyncFunction%":b,"%AsyncGenerator%":b,"%AsyncGeneratorFunction%":b,"%AsyncIteratorPrototype%":b,"%Atomics%":"undefined"==typeof Atomics?o:Atomics,"%BigInt%":"undefined"==typeof BigInt?o:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?o:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?o:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?o:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":a,"%Float32Array%":"undefined"==typeof Float32Array?o:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?o:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?o:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":b,"%Int8Array%":"undefined"==typeof Int8Array?o:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?o:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?o:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":g&&y?y(y([][Symbol.iterator]())):o,"%JSON%":"object"==typeof JSON?JSON:o,"%Map%":"undefined"==typeof Map?o:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&g&&y?y((new Map)[Symbol.iterator]()):o,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?o:Promise,"%Proxy%":"undefined"==typeof Proxy?o:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":"undefined"==typeof Reflect?o:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?o:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&g&&y?y((new Set)[Symbol.iterator]()):o,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?o:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":g&&y?y(""[Symbol.iterator]()):o,"%Symbol%":g?Symbol:o,"%SyntaxError%":l,"%ThrowTypeError%":m,"%TypedArray%":x,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?o:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?o:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?o:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?o:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?o:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?o:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?o:WeakSet};if(y)try{null.error}catch(e){var T=y(y(e));w["%Error.prototype%"]=T}var I=function e(t){var n;if("%AsyncFunction%"===t)n=f("async function () {}");else if("%GeneratorFunction%"===t)n=f("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=f("async function* () {}");else if("%AsyncGenerator%"===t){var o=e("%AsyncGeneratorFunction%");o&&(n=o.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&y&&(n=y(r.prototype))}return w[t]=n,n},E={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},S=n(6743),C=n(9957),A=S.call(Function.call,Array.prototype.concat),M=S.call(Function.apply,Array.prototype.splice),P=S.call(Function.call,String.prototype.replace),D=S.call(Function.call,String.prototype.slice),L=S.call(Function.call,RegExp.prototype.exec),O=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k=/\\(\\)?/g,R=function(e,t){var n,o=e;if(C(E,o)&&(o="%"+(n=E[o])[0]+"%"),C(w,o)){var r=w[o];if(r===b&&(r=I(o)),void 0===r&&!t)throw new c("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:o,value:r}}throw new l("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new c('"allowMissing" argument must be a boolean');if(null===L(/^%?[^%]*%?$/,e))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=D(e,0,1),n=D(e,-1);if("%"===t&&"%"!==n)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new l("invalid intrinsic syntax, expected opening `%`");var o=[];return P(e,O,(function(e,t,n,r){o[o.length]=n?P(r,k,"$1"):t||e})),o}(e),o=n.length>0?n[0]:"",r=R("%"+o+"%",t),a=r.name,i=r.value,s=!1,u=r.alias;u&&(o=u[0],M(n,A([0,1],u)));for(var d=1,f=!0;d<n.length;d+=1){var p=n[d],m=D(p,0,1),g=D(p,-1);if(('"'===m||"'"===m||"`"===m||'"'===g||"'"===g||"`"===g)&&m!==g)throw new l("property names with quotes must have matching quotes");if("constructor"!==p&&f||(s=!0),C(w,a="%"+(o+="."+p)+"%"))i=w[a];else if(null!=i){if(!(p in i)){if(!t)throw new c("base intrinsic for "+e+" exists, but the property is not available.");return}if(h&&d+1>=n.length){var v=h(i,p);i=(f=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:i[p]}else f=C(i,p),i=i[p];f&&!s&&(w[a]=i)}}return i}},5795:(e,t,n)=>{"use strict";var o=n(453)("%Object.getOwnPropertyDescriptor%",!0);if(o)try{o([],"length")}catch(e){o=null}e.exports=o},730:(e,t,n)=>{var o;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(r,a,i,s){"use strict";function l(e,t,n){return setTimeout(h(e,n),t)}function c(e,t,n){return!!Array.isArray(e)&&(u(e,n[t],n),!0)}function u(e,t,n){var o;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(o=0;o<e.length;)t.call(n,e[o],o,e),o++;else for(o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)}function d(e,t,n){var o="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=r.console&&(r.console.warn||r.console.log);return a&&a.call(r.console,o,n),e.apply(this,arguments)}}function f(e,t,n){var o,r=t.prototype;(o=e.prototype=Object.create(r)).constructor=e,o._super=r,n&&se(o,n)}function h(e,t){return function(){return e.apply(t,arguments)}}function p(e,t){return typeof e==ue?e.apply(t&&t[0]||s,t):e}function m(e,t){return e===s?t:e}function g(e,t,n){u(x(t),(function(t){e.addEventListener(t,n,!1)}))}function v(e,t,n){u(x(t),(function(t){e.removeEventListener(t,n,!1)}))}function y(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function b(e,t){return e.indexOf(t)>-1}function x(e){return e.trim().split(/\s+/g)}function w(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var o=0;o<e.length;){if(n&&e[o][n]==t||!n&&e[o]===t)return o;o++}return-1}function T(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var o=[],r=[],a=0;a<e.length;){var i=t?e[a][t]:e[a];w(r,i)<0&&o.push(e[a]),r[a]=i,a++}return n&&(o=t?o.sort((function(e,n){return e[t]>n[t]})):o.sort()),o}function E(e,t){for(var n,o,r=t[0].toUpperCase()+t.slice(1),a=0;a<le.length;){if((o=(n=le[a])?n+r:t)in e)return o;a++}return s}function S(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||r}function C(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){p(e.options.enable,[e])&&n.handler(t)},this.init()}function A(e,t,n){var o=n.pointers.length,r=n.changedPointers.length,a=t&Ie&&o-r==0,i=t&(Se|Ce)&&o-r==0;n.isFirst=!!a,n.isFinal=!!i,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,o=t.pointers,r=o.length;n.firstInput||(n.firstInput=P(t)),r>1&&!n.firstMultiple?n.firstMultiple=P(t):1===r&&(n.firstMultiple=!1);var a=n.firstInput,i=n.firstMultiple,s=i?i.center:a.center,l=t.center=D(o);t.timeStamp=he(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=R(s,l),t.distance=k(s,l),function(e,t){var n=t.center,o=e.offsetDelta||{},r=e.prevDelta||{},a=e.prevInput||{};t.eventType!==Ie&&a.eventType!==Se||(r=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},o=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=r.x+(n.x-o.x),t.deltaY=r.y+(n.y-o.y)}(n,t),t.offsetDirection=O(t.deltaX,t.deltaY);var c=L(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=fe(c.x)>fe(c.y)?c.x:c.y,t.scale=i?function(e,t){return k(t[0],t[1],Ne)/k(e[0],e[1],Ne)}(i.pointers,o):1,t.rotation=i?function(e,t){return R(t[1],t[0],Ne)+R(e[1],e[0],Ne)}(i.pointers,o):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,M(n,t);var u=e.element;y(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function M(e,t){var n,o,r,a,i=e.lastInterval||t,l=t.timeStamp-i.timeStamp;if(t.eventType!=Ce&&(l>Te||i.velocity===s)){var c=t.deltaX-i.deltaX,u=t.deltaY-i.deltaY,d=L(l,c,u);o=d.x,r=d.y,n=fe(d.x)>fe(d.y)?d.x:d.y,a=O(c,u),e.lastInterval=t}else n=i.velocity,o=i.velocityX,r=i.velocityY,a=i.direction;t.velocity=n,t.velocityX=o,t.velocityY=r,t.direction=a}function P(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:de(e.pointers[n].clientX),clientY:de(e.pointers[n].clientY)},n++;return{timeStamp:he(),pointers:t,center:D(t),deltaX:e.deltaX,deltaY:e.deltaY}}function D(e){var t=e.length;if(1===t)return{x:de(e[0].clientX),y:de(e[0].clientY)};for(var n=0,o=0,r=0;t>r;)n+=e[r].clientX,o+=e[r].clientY,r++;return{x:de(n/t),y:de(o/t)}}function L(e,t,n){return{x:t/e||0,y:n/e||0}}function O(e,t){return e===t?Ae:fe(e)>=fe(t)?0>e?Me:Pe:0>t?De:Le}function k(e,t,n){n||(n=_e);var o=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(o*o+r*r)}function R(e,t,n){n||(n=_e);var o=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,o)/Math.PI}function _(){this.evEl=Ue,this.evWin=Ve,this.pressed=!1,C.apply(this,arguments)}function N(){this.evEl=He,this.evWin=ze,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function B(){this.evTarget=We,this.evWin=Ge,this.started=!1,C.apply(this,arguments)}function U(e,t){var n=T(e.touches),o=T(e.changedTouches);return t&(Se|Ce)&&(n=I(n.concat(o),"identifier",!0)),[n,o]}function V(){this.evTarget=Ze,this.targetIds={},C.apply(this,arguments)}function F(e,t){var n=T(e.touches),o=this.targetIds;if(t&(Ie|Ee)&&1===n.length)return o[n[0].identifier]=!0,[n,n];var r,a,i=T(e.changedTouches),s=[],l=this.target;if(a=n.filter((function(e){return y(e.target,l)})),t===Ie)for(r=0;r<a.length;)o[a[r].identifier]=!0,r++;for(r=0;r<i.length;)o[i[r].identifier]&&s.push(i[r]),t&(Se|Ce)&&delete o[i[r].identifier],r++;return s.length?[I(a.concat(s),"identifier",!0),s]:void 0}function j(){C.apply(this,arguments);var e=h(this.handler,this);this.touch=new V(this.manager,e),this.mouse=new _(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function H(e,t){e&Ie?(this.primaryTouch=t.changedPointers[0].identifier,z.call(this,t)):e&(Se|Ce)&&z.call(this,t)}function z(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var o=this.lastTouches;setTimeout((function(){var e=o.indexOf(n);e>-1&&o.splice(e,1)}),Xe)}}function q(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,o=0;o<this.lastTouches.length;o++){var r=this.lastTouches[o],a=Math.abs(t-r.x),i=Math.abs(n-r.y);if(Ke>=a&&Ke>=i)return!0}return!1}function W(e,t){this.manager=e,this.set(t)}function G(e){this.options=se({},this.defaults,e||{}),this.id=ge++,this.manager=null,this.options.enable=m(this.options.enable,!0),this.state=it,this.simultaneous={},this.requireFail=[]}function Y(e){return e&dt?"cancel":e&ct?"end":e&lt?"move":e&st?"start":""}function Z(e){return e==Le?"down":e==De?"up":e==Me?"left":e==Pe?"right":""}function X(e,t){var n=t.manager;return n?n.get(e):e}function K(){G.apply(this,arguments)}function Q(){K.apply(this,arguments),this.pX=null,this.pY=null}function J(){K.apply(this,arguments)}function $(){G.apply(this,arguments),this._timer=null,this._input=null}function ee(){K.apply(this,arguments)}function te(){K.apply(this,arguments)}function ne(){G.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function oe(e,t){return(t=t||{}).recognizers=m(t.recognizers,oe.defaults.preset),new re(e,t)}function re(e,t){this.options=se({},oe.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(ye?N:be?V:ve?j:_))(e,A)}(this),this.touchAction=new W(this,this.options.touchAction),ae(this,!0),u(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function ae(e,t){var n,o=e.element;o.style&&(u(e.options.cssProps,(function(r,a){n=E(o.style,a),t?(e.oldCssProps[n]=o.style[n],o.style[n]=r):o.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}function ie(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}var se,le=["","webkit","Moz","MS","ms","o"],ce=a.createElement("div"),ue="function",de=Math.round,fe=Math.abs,he=Date.now;se="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(o!==s&&null!==o)for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])}return t}:Object.assign;var pe=d((function(e,t,n){for(var o=Object.keys(t),r=0;r<o.length;)(!n||n&&e[o[r]]===s)&&(e[o[r]]=t[o[r]]),r++;return e}),"extend","Use `assign`."),me=d((function(e,t){return pe(e,t,!0)}),"merge","Use `assign`."),ge=1,ve="ontouchstart"in r,ye=E(r,"PointerEvent")!==s,be=ve&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),xe="touch",we="mouse",Te=25,Ie=1,Ee=2,Se=4,Ce=8,Ae=1,Me=2,Pe=4,De=8,Le=16,Oe=Me|Pe,ke=De|Le,Re=Oe|ke,_e=["x","y"],Ne=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(S(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(S(this.element),this.evWin,this.domHandler)}};var Be={mousedown:Ie,mousemove:Ee,mouseup:Se},Ue="mousedown",Ve="mousemove mouseup";f(_,C,{handler:function(e){var t=Be[e.type];t&Ie&&0===e.button&&(this.pressed=!0),t&Ee&&1!==e.which&&(t=Se),this.pressed&&(t&Se&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:we,srcEvent:e}))}});var Fe={pointerdown:Ie,pointermove:Ee,pointerup:Se,pointercancel:Ce,pointerout:Ce},je={2:xe,3:"pen",4:we,5:"kinect"},He="pointerdown",ze="pointermove pointerup pointercancel";r.MSPointerEvent&&!r.PointerEvent&&(He="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel"),f(N,C,{handler:function(e){var t=this.store,n=!1,o=e.type.toLowerCase().replace("ms",""),r=Fe[o],a=je[e.pointerType]||e.pointerType,i=a==xe,s=w(t,e.pointerId,"pointerId");r&Ie&&(0===e.button||i)?0>s&&(t.push(e),s=t.length-1):r&(Se|Ce)&&(n=!0),0>s||(t[s]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var qe={touchstart:Ie,touchmove:Ee,touchend:Se,touchcancel:Ce},We="touchstart",Ge="touchstart touchmove touchend touchcancel";f(B,C,{handler:function(e){var t=qe[e.type];if(t===Ie&&(this.started=!0),this.started){var n=U.call(this,e,t);t&(Se|Ce)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:xe,srcEvent:e})}}});var Ye={touchstart:Ie,touchmove:Ee,touchend:Se,touchcancel:Ce},Ze="touchstart touchmove touchend touchcancel";f(V,C,{handler:function(e){var t=Ye[e.type],n=F.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:xe,srcEvent:e})}});var Xe=2500,Ke=25;f(j,C,{handler:function(e,t,n){var o=n.pointerType==xe,r=n.pointerType==we;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(o)H.call(this,t,n);else if(r&&q.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Qe=E(ce.style,"touchAction"),Je=Qe!==s,$e="compute",et="auto",tt="manipulation",nt="none",ot="pan-x",rt="pan-y",at=function(){if(!Je)return!1;var e={},t=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||r.CSS.supports("touch-action",n)})),e}();W.prototype={set:function(e){e==$e&&(e=this.compute()),Je&&this.manager.element.style&&at[e]&&(this.manager.element.style[Qe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return u(this.manager.recognizers,(function(t){p(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(b(e,nt))return nt;var t=b(e,ot),n=b(e,rt);return t&&n?nt:t||n?t?ot:rt:b(e,tt)?tt:et}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(!this.manager.session.prevented){var o=this.actions,r=b(o,nt)&&!at[nt],a=b(o,rt)&&!at[rt],i=b(o,ot)&&!at[ot];if(r){var s=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(s&&l&&c)return}return i&&a?void 0:r||a&&n&Oe||i&&n&ke?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var it=1,st=2,lt=4,ct=8,ut=ct,dt=16,ft=32;G.prototype={defaults:{},set:function(e){return se(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(c(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=X(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return c(e,"dropRecognizeWith",this)||(e=X(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(c(e,"requireFailure",this))return this;var t=this.requireFail;return-1===w(t,e=X(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(c(e,"dropRequireFailure",this))return this;e=X(e,this);var t=w(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,o=this.state;ct>o&&t(n.options.event+Y(o)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),o>=ct&&t(n.options.event+Y(o))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=ft)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ft|it)))return!1;e++}return!0},recognize:function(e){var t=se({},e);return p(this.options.enable,[this,t])?(this.state&(ut|dt|ft)&&(this.state=it),this.state=this.process(t),void(this.state&(st|lt|ct|dt)&&this.tryEmit(t))):(this.reset(),void(this.state=ft))},process:function(e){},getTouchAction:function(){},reset:function(){}},f(K,G,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,o=t&(st|lt),r=this.attrTest(e);return o&&(n&Ce||!r)?t|dt:o||r?n&Se?t|ct:t&st?t|lt:st:ft}}),f(Q,K,{defaults:{event:"pan",threshold:10,pointers:1,direction:Re},getTouchAction:function(){var e=this.options.direction,t=[];return e&Oe&&t.push(rt),e&ke&&t.push(ot),t},directionTest:function(e){var t=this.options,n=!0,o=e.distance,r=e.direction,a=e.deltaX,i=e.deltaY;return r&t.direction||(t.direction&Oe?(r=0===a?Ae:0>a?Me:Pe,n=a!=this.pX,o=Math.abs(e.deltaX)):(r=0===i?Ae:0>i?De:Le,n=i!=this.pY,o=Math.abs(e.deltaY))),e.direction=r,n&&o>t.threshold&&r&t.direction},attrTest:function(e){return K.prototype.attrTest.call(this,e)&&(this.state&st||!(this.state&st)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Z(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),f(J,K,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&st)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),f($,G,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[et]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,o=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!o||!n||e.eventType&(Se|Ce)&&!r)this.reset();else if(e.eventType&Ie)this.reset(),this._timer=l((function(){this.state=ut,this.tryEmit()}),t.time,this);else if(e.eventType&Se)return ut;return ft},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ut&&(e&&e.eventType&Se?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=he(),this.manager.emit(this.options.event,this._input)))}}),f(ee,K,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&st)}}),f(te,K,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Oe|ke,pointers:1},getTouchAction:function(){return Q.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Oe|ke)?t=e.overallVelocity:n&Oe?t=e.overallVelocityX:n&ke&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&fe(t)>this.options.velocity&&e.eventType&Se},emit:function(e){var t=Z(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),f(ne,G,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[tt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,o=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&Ie&&0===this.count)return this.failTimeout();if(o&&r&&n){if(e.eventType!=Se)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||k(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,i&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=l((function(){this.state=ut,this.tryEmit()}),t.interval,this),st):ut}return ft},failTimeout:function(){return this._timer=l((function(){this.state=ft}),this.options.interval,this),ft},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),oe.VERSION="2.0.7",oe.defaults={domEvents:!1,touchAction:$e,enable:!0,inputTarget:null,inputClass:null,preset:[[ee,{enable:!1}],[J,{enable:!1},["rotate"]],[te,{direction:Oe}],[Q,{direction:Oe},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[$]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};re.prototype={set:function(e){return se(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,o=this.recognizers,r=t.curRecognizer;(!r||r&&r.state&ut)&&(r=t.curRecognizer=null);for(var a=0;a<o.length;)n=o[a],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(st|lt|ct)&&(r=t.curRecognizer=n),a++}},get:function(e){if(e instanceof G)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(c(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(c(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=w(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return u(x(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==s){var n=this.handlers;return u(x(e),(function(e){t?n[e]&&n[e].splice(w(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&ie(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var o=0;o<n.length;)n[o](t),o++}},destroy:function(){this.element&&ae(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},se(oe,{INPUT_START:Ie,INPUT_MOVE:Ee,INPUT_END:Se,INPUT_CANCEL:Ce,STATE_POSSIBLE:it,STATE_BEGAN:st,STATE_CHANGED:lt,STATE_ENDED:ct,STATE_RECOGNIZED:ut,STATE_CANCELLED:dt,STATE_FAILED:ft,DIRECTION_NONE:Ae,DIRECTION_LEFT:Me,DIRECTION_RIGHT:Pe,DIRECTION_UP:De,DIRECTION_DOWN:Le,DIRECTION_HORIZONTAL:Oe,DIRECTION_VERTICAL:ke,DIRECTION_ALL:Re,Manager:re,Input:C,TouchAction:W,TouchInput:V,MouseInput:_,PointerEventInput:N,TouchMouseInput:j,SingleTouchInput:B,Recognizer:G,AttrRecognizer:K,Tap:ne,Pan:Q,Swipe:te,Pinch:J,Rotate:ee,Press:$,on:g,off:v,each:u,merge:me,extend:pe,assign:se,inherit:f,bindFn:h,prefixed:E}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=oe,void 0===(o=function(){return oe}.call(t,n,t,e))||(e.exports=o)}(window,document)},592:(e,t,n)=>{"use strict";var o=n(655),r=function(){return!!o};r.hasArrayLengthDefineBug=function(){if(!o)return null;try{return 1!==o([],"length",{value:1}).length}catch(e){return!0}},e.exports=r},24:e=>{"use strict";var t={__proto__:null,foo:{}},n=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof n)}},4039:(e,t,n)=>{"use strict";var o="undefined"!=typeof Symbol&&Symbol,r=n(1333);e.exports=function(){return"function"==typeof o&&("function"==typeof Symbol&&("symbol"==typeof o("foo")&&("symbol"==typeof Symbol("bar")&&r())))}},1333:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var o=Object.getOwnPropertySymbols(e);if(1!==o.length||o[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(e,t);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},9957:(e,t,n)=>{"use strict";var o=Function.prototype.call,r=Object.prototype.hasOwnProperty,a=n(6743);e.exports=a.call(o,r)},346:function(e,t,n){var o,r,a;void 0!==n.g?n.g:window||this.window||this.global,r=[],o=function(e){"use strict";var t={},n="iziToast",o=(document.querySelector("body"),!!/Mobi/.test(navigator.userAgent)),r=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),a="undefined"!=typeof InstallTrigger,i="ontouchstart"in document.documentElement,s=["bottomRight","bottomLeft","bottomCenter","topRight","topLeft","topCenter","center"],l={info:{color:"blue",icon:"ico-info"},success:{color:"green",icon:"ico-success"},warning:{color:"orange",icon:"ico-warning"},error:{color:"red",icon:"ico-error"},question:{color:"yellow",icon:"ico-question"}},c=568,u={};t.children={};var d={id:null,class:"",title:"",titleColor:"",titleSize:"",titleLineHeight:"",message:"",messageColor:"",messageSize:"",messageLineHeight:"",backgroundColor:"",theme:"light",color:"",icon:"",iconText:"",iconColor:"",iconUrl:null,image:"",imageWidth:50,maxWidth:null,zindex:null,layout:1,balloon:!1,close:!0,closeOnEscape:!1,closeOnClick:!1,displayMode:0,position:"bottomRight",target:"",targetFirst:!0,timeout:5e3,rtl:!1,animateInside:!0,drag:!0,pauseOnHover:!0,resetOnHover:!1,progressBar:!0,progressBarColor:"",progressBarEasing:"linear",overlay:!1,overlayClose:!1,overlayColor:"rgba(0, 0, 0, 0.6)",transitionIn:"fadeInUp",transitionOut:"fadeOut",transitionInMobile:"fadeInUp",transitionOutMobile:"fadeOutDown",buttons:{},inputs:{},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){}};if("remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),"function"!=typeof window.CustomEvent){var f=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};f.prototype=window.Event.prototype,window.CustomEvent=f}var h=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(n,e[o],o,e);else if(e)for(var r=0,a=e.length;a>r;r++)t.call(n,e[r],r,e)},p=function(e,t){var n={};return h(e,(function(t,o){n[o]=e[o]})),h(t,(function(e,o){n[o]=t[o]})),n},m=function(e){var t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.firstChild);return t},g=function(e){return btoa(encodeURIComponent(e)).replace(/=/g,"")},v=function(e){return"#"==e.substring(0,1)||"rgb"==e.substring(0,3)||"hsl"==e.substring(0,3)},y=function(e){try{return btoa(atob(e))==e}catch(e){return!1}},b={move:function(e,t,o,i){var s,l=.3,c=180;0!==i&&(e.classList.add(n+"-dragged"),e.style.transform="translateX("+i+"px)",i>0?l>(s=(c-i)/c)&&t.hide(p(o,{transitionOut:"fadeOutRight",transitionOutMobile:"fadeOutRight"}),e,"drag"):l>(s=(c+i)/c)&&t.hide(p(o,{transitionOut:"fadeOutLeft",transitionOutMobile:"fadeOutLeft"}),e,"drag"),e.style.opacity=s,l>s&&((r||a)&&(e.style.left=i+"px"),e.parentNode.style.opacity=l,this.stopMoving(e,null)))},startMoving:function(e,t,n,o){o=o||window.event;var r=i?o.touches[0].clientX:o.clientX,a=e.style.transform.replace("px)",""),s=r-(a=a.replace("translateX(",""));n.transitionIn&&e.classList.remove(n.transitionIn),n.transitionInMobile&&e.classList.remove(n.transitionInMobile),e.style.transition="",i?document.ontouchmove=function(o){o.preventDefault();var r=(o=o||window.event).touches[0].clientX-s;b.move(e,t,n,r)}:document.onmousemove=function(o){o.preventDefault();var r=(o=o||window.event).clientX-s;b.move(e,t,n,r)}},stopMoving:function(e,t){i?document.ontouchmove=function(){}:document.onmousemove=function(){},e.style.opacity="",e.style.transform="",e.classList.contains(n+"-dragged")&&(e.classList.remove(n+"-dragged"),e.style.transition="transform 0.4s ease, opacity 0.4s ease",setTimeout((function(){e.style.transition=""}),400))}};return t.setSetting=function(e,n,o){t.children[e][n]=o},t.getSetting=function(e,n){return t.children[e][n]},t.destroy=function(){h(document.querySelectorAll("."+n+"-overlay"),(function(e,t){e.remove()})),h(document.querySelectorAll("."+n+"-wrapper"),(function(e,t){e.remove()})),h(document.querySelectorAll("."+n),(function(e,t){e.remove()})),this.children={},document.removeEventListener(n+"-opened",{},!1),document.removeEventListener(n+"-opening",{},!1),document.removeEventListener(n+"-closing",{},!1),document.removeEventListener(n+"-closed",{},!1),document.removeEventListener("keyup",{},!1),u={}},t.settings=function(e){t.destroy(),u=e,d=p(d,e||{})},h(l,(function(e,n){t[n]=function(t){var n=p(u,t||{});n=p(e,n||{}),this.show(n)}})),t.progress=function(e,t,o){var r=this,a=t.getAttribute("data-iziToast-ref"),i=p(this.children[a],e||{}),s=t.querySelector("."+n+"-progressbar div");return{start:function(){void 0===i.time.REMAINING&&(t.classList.remove(n+"-reseted"),null!==s&&(s.style.transition="width "+i.timeout+"ms "+i.progressBarEasing,s.style.width="0%"),i.time.START=(new Date).getTime(),i.time.END=i.time.START+i.timeout,i.time.TIMER=setTimeout((function(){clearTimeout(i.time.TIMER),t.classList.contains(n+"-closing")||(r.hide(i,t,"timeout"),"function"==typeof o&&o.apply(r))}),i.timeout),r.setSetting(a,"time",i.time))},pause:function(){if(void 0!==i.time.START&&!t.classList.contains(n+"-paused")&&!t.classList.contains(n+"-reseted")){if(t.classList.add(n+"-paused"),i.time.REMAINING=i.time.END-(new Date).getTime(),clearTimeout(i.time.TIMER),r.setSetting(a,"time",i.time),null!==s){var e=window.getComputedStyle(s).getPropertyValue("width");s.style.transition="none",s.style.width=e}"function"==typeof o&&setTimeout((function(){o.apply(r)}),10)}},resume:function(){void 0!==i.time.REMAINING?(t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="width "+i.time.REMAINING+"ms "+i.progressBarEasing,s.style.width="0%"),i.time.END=(new Date).getTime()+i.time.REMAINING,i.time.TIMER=setTimeout((function(){clearTimeout(i.time.TIMER),t.classList.contains(n+"-closing")||(r.hide(i,t,"timeout"),"function"==typeof o&&o.apply(r))}),i.time.REMAINING),r.setSetting(a,"time",i.time)):this.start()},reset:function(){clearTimeout(i.time.TIMER),delete i.time.REMAINING,r.setSetting(a,"time",i.time),t.classList.add(n+"-reseted"),t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="none",s.style.width="100%"),"function"==typeof o&&setTimeout((function(){o.apply(r)}),10)}}},t.hide=function(e,t,r){"object"!=typeof t&&(t=document.querySelector(t));var a=this,i=p(this.children[t.getAttribute("data-iziToast-ref")],e||{});i.closedBy=r||null,delete i.time.REMAINING,t.classList.add(n+"-closing"),function(){var e=document.querySelector("."+n+"-overlay");if(null!==e){var t=e.getAttribute("data-iziToast-ref"),o=(t=t.split(",")).indexOf(String(i.ref));-1!==o&&t.splice(o,1),e.setAttribute("data-iziToast-ref",t.join()),0===t.length&&(e.classList.remove("fadeIn"),e.classList.add("fadeOut"),setTimeout((function(){e.remove()}),700))}}(),i.transitionIn&&t.classList.remove(i.transitionIn),i.transitionInMobile&&t.classList.remove(i.transitionInMobile),o||window.innerWidth<=c?i.transitionOutMobile&&t.classList.add(i.transitionOutMobile):i.transitionOut&&t.classList.add(i.transitionOut);var s=t.parentNode.offsetHeight;t.parentNode.style.height=s+"px",t.style.pointerEvents="none",(!o||window.innerWidth>c)&&(t.parentNode.style.transitionDelay="0.2s");try{var l=new CustomEvent(n+"-closing",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(l)}catch(e){console.warn(e)}setTimeout((function(){t.parentNode.style.height="0px",t.parentNode.style.overflow="",setTimeout((function(){delete a.children[i.ref],t.parentNode.remove();try{var e=new CustomEvent(n+"-closed",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}void 0!==i.onClosed&&i.onClosed.apply(null,[i,t,r])}),1e3)}),200),void 0!==i.onClosing&&i.onClosing.apply(null,[i,t,r])},t.show=function(e){var r=this,a=p(u,e||{});if((a=p(d,a)).time={},null===a.id&&(a.id=g(a.title+a.message+a.color)),1===a.displayMode||"once"==a.displayMode)try{if(document.querySelectorAll("."+n+"#"+a.id).length>0)return!1}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+a.id+". Try to set an valid id.")}if(2===a.displayMode||"replace"==a.displayMode)try{h(document.querySelectorAll("."+n+"#"+a.id),(function(e,t){r.hide(a,e,"replaced")}))}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+a.id+". Try to set an valid id.")}a.ref=(new Date).getTime()+Math.floor(1e7*Math.random()+1),t.children[a.ref]=a;var l,f={body:document.querySelector("body"),overlay:document.createElement("div"),toast:document.createElement("div"),toastBody:document.createElement("div"),toastTexts:document.createElement("div"),toastCapsule:document.createElement("div"),cover:document.createElement("div"),buttons:document.createElement("div"),inputs:document.createElement("div"),icon:a.iconUrl?document.createElement("img"):document.createElement("i"),wrapper:null};f.toast.setAttribute("data-iziToast-ref",a.ref),f.toast.appendChild(f.toastBody),f.toastCapsule.appendChild(f.toast),function(){if(f.toast.classList.add(n),f.toast.classList.add(n+"-opening"),f.toastCapsule.classList.add(n+"-capsule"),f.toastBody.classList.add(n+"-body"),f.toastTexts.classList.add(n+"-texts"),o||window.innerWidth<=c?a.transitionInMobile&&f.toast.classList.add(a.transitionInMobile):a.transitionIn&&f.toast.classList.add(a.transitionIn),a.class){var e=a.class.split(" ");h(e,(function(e,t){f.toast.classList.add(e)}))}a.id&&(f.toast.id=a.id),a.rtl&&(f.toast.classList.add(n+"-rtl"),f.toast.setAttribute("dir","rtl")),a.layout>1&&f.toast.classList.add(n+"-layout"+a.layout),a.balloon&&f.toast.classList.add(n+"-balloon"),a.maxWidth&&(isNaN(a.maxWidth)?f.toast.style.maxWidth=a.maxWidth:f.toast.style.maxWidth=a.maxWidth+"px"),""===a.theme&&"light"===a.theme||f.toast.classList.add(n+"-theme-"+a.theme),a.color&&(v(a.color)?f.toast.style.background=a.color:f.toast.classList.add(n+"-color-"+a.color)),a.backgroundColor&&(f.toast.style.background=a.backgroundColor,a.balloon&&(f.toast.style.borderColor=a.backgroundColor))}(),a.image&&(f.cover.classList.add(n+"-cover"),f.cover.style.width=a.imageWidth+"px",y(a.image.replace(/ /g,""))?f.cover.style.backgroundImage="url(data:image/png;base64,"+a.image.replace(/ /g,"")+")":f.cover.style.backgroundImage="url("+a.image+")",a.rtl?f.toastBody.style.marginRight=a.imageWidth+10+"px":f.toastBody.style.marginLeft=a.imageWidth+10+"px",f.toast.appendChild(f.cover)),a.close?(f.buttonClose=document.createElement("button"),f.buttonClose.type="button",f.buttonClose.classList.add(n+"-close"),f.buttonClose.addEventListener("click",(function(e){e.target,r.hide(a,f.toast,"button")})),f.toast.appendChild(f.buttonClose)):a.rtl?f.toast.style.paddingLeft="18px":f.toast.style.paddingRight="18px",a.progressBar&&(f.progressBar=document.createElement("div"),f.progressBarDiv=document.createElement("div"),f.progressBar.classList.add(n+"-progressbar"),f.progressBarDiv.style.background=a.progressBarColor,f.progressBar.appendChild(f.progressBarDiv),f.toast.appendChild(f.progressBar)),a.timeout&&(a.pauseOnHover&&!a.resetOnHover&&(f.toast.addEventListener("mouseenter",(function(e){r.progress(a,f.toast).pause()})),f.toast.addEventListener("mouseleave",(function(e){r.progress(a,f.toast).resume()}))),a.resetOnHover&&(f.toast.addEventListener("mouseenter",(function(e){r.progress(a,f.toast).reset()})),f.toast.addEventListener("mouseleave",(function(e){r.progress(a,f.toast).start()})))),a.iconUrl?(f.icon.setAttribute("class",n+"-icon"),f.icon.setAttribute("src",a.iconUrl)):a.icon&&(f.icon.setAttribute("class",n+"-icon "+a.icon),a.iconText&&f.icon.appendChild(document.createTextNode(a.iconText)),a.iconColor&&(f.icon.style.color=a.iconColor)),(a.icon||a.iconUrl)&&(a.rtl?f.toastBody.style.paddingRight="33px":f.toastBody.style.paddingLeft="33px",f.toastBody.appendChild(f.icon)),a.title.length>0&&(f.strong=document.createElement("strong"),f.strong.classList.add(n+"-title"),f.strong.appendChild(m(a.title)),f.toastTexts.appendChild(f.strong),a.titleColor&&(f.strong.style.color=a.titleColor),a.titleSize&&(isNaN(a.titleSize)?f.strong.style.fontSize=a.titleSize:f.strong.style.fontSize=a.titleSize+"px"),a.titleLineHeight&&(isNaN(a.titleSize)?f.strong.style.lineHeight=a.titleLineHeight:f.strong.style.lineHeight=a.titleLineHeight+"px")),a.message.length>0&&(f.p=document.createElement("p"),f.p.classList.add(n+"-message"),f.p.appendChild(m(a.message)),f.toastTexts.appendChild(f.p),a.messageColor&&(f.p.style.color=a.messageColor),a.messageSize&&(isNaN(a.titleSize)?f.p.style.fontSize=a.messageSize:f.p.style.fontSize=a.messageSize+"px"),a.messageLineHeight&&(isNaN(a.titleSize)?f.p.style.lineHeight=a.messageLineHeight:f.p.style.lineHeight=a.messageLineHeight+"px")),a.title.length>0&&a.message.length>0&&(a.rtl?f.strong.style.marginLeft="10px":2===a.layout||a.rtl||(f.strong.style.marginRight="10px")),f.toastBody.appendChild(f.toastTexts),a.inputs.length>0&&(f.inputs.classList.add(n+"-inputs"),h(a.inputs,(function(e,t){f.inputs.appendChild(m(e[0])),(l=f.inputs.childNodes)[t].classList.add(n+"-inputs-child"),e[3]&&setTimeout((function(){l[t].focus()}),300),l[t].addEventListener(e[1],(function(t){return(0,e[2])(r,f.toast,this,t)}))})),f.toastBody.appendChild(f.inputs)),a.buttons.length>0&&(f.buttons.classList.add(n+"-buttons"),h(a.buttons,(function(e,t){f.buttons.appendChild(m(e[0]));var o=f.buttons.childNodes;o[t].classList.add(n+"-buttons-child"),e[2]&&setTimeout((function(){o[t].focus()}),300),o[t].addEventListener("click",(function(t){return t.preventDefault(),(0,e[1])(r,f.toast,this,t,l)}))}))),f.toastBody.appendChild(f.buttons),a.message.length>0&&(a.inputs.length>0||a.buttons.length>0)&&(f.p.style.marginBottom="0"),(a.inputs.length>0||a.buttons.length>0)&&(a.rtl?f.toastTexts.style.marginLeft="10px":f.toastTexts.style.marginRight="10px",a.inputs.length>0&&a.buttons.length>0&&(a.rtl?f.inputs.style.marginLeft="8px":f.inputs.style.marginRight="8px")),f.toastCapsule.style.visibility="hidden",setTimeout((function(){var e=f.toast.offsetHeight,t=f.toast.currentStyle||window.getComputedStyle(f.toast),n=t.marginTop;n=n.split("px"),n=parseInt(n[0]);var o=t.marginBottom;o=o.split("px"),o=parseInt(o[0]),f.toastCapsule.style.visibility="",f.toastCapsule.style.height=e+o+n+"px",setTimeout((function(){f.toastCapsule.style.height="auto",a.target&&(f.toastCapsule.style.overflow="visible")}),500),a.timeout&&r.progress(a,f.toast).start()}),100),function(){var e=a.position;if(a.target)f.wrapper=document.querySelector(a.target),f.wrapper.classList.add(n+"-target"),a.targetFirst?f.wrapper.insertBefore(f.toastCapsule,f.wrapper.firstChild):f.wrapper.appendChild(f.toastCapsule);else{if(-1==s.indexOf(a.position))return void console.warn("["+n+"] Incorrect position.\nIt can be › "+s);e=o||window.innerWidth<=c?"bottomLeft"==a.position||"bottomRight"==a.position||"bottomCenter"==a.position?n+"-wrapper-bottomCenter":"topLeft"==a.position||"topRight"==a.position||"topCenter"==a.position?n+"-wrapper-topCenter":n+"-wrapper-center":n+"-wrapper-"+e,f.wrapper=document.querySelector("."+n+"-wrapper."+e),f.wrapper||(f.wrapper=document.createElement("div"),f.wrapper.classList.add(n+"-wrapper"),f.wrapper.classList.add(e),document.body.appendChild(f.wrapper)),"topLeft"==a.position||"topCenter"==a.position||"topRight"==a.position?f.wrapper.insertBefore(f.toastCapsule,f.wrapper.firstChild):f.wrapper.appendChild(f.toastCapsule)}isNaN(a.zindex)?console.warn("["+n+"] Invalid zIndex."):f.wrapper.style.zIndex=a.zindex}(),a.overlay&&(null!==document.querySelector("."+n+"-overlay.fadeIn")?(f.overlay=document.querySelector("."+n+"-overlay"),f.overlay.setAttribute("data-iziToast-ref",f.overlay.getAttribute("data-iziToast-ref")+","+a.ref),isNaN(a.zindex)||null===a.zindex||(f.overlay.style.zIndex=a.zindex-1)):(f.overlay.classList.add(n+"-overlay"),f.overlay.classList.add("fadeIn"),f.overlay.style.background=a.overlayColor,f.overlay.setAttribute("data-iziToast-ref",a.ref),isNaN(a.zindex)||null===a.zindex||(f.overlay.style.zIndex=a.zindex-1),document.querySelector("body").appendChild(f.overlay)),a.overlayClose?(f.overlay.removeEventListener("click",{}),f.overlay.addEventListener("click",(function(e){r.hide(a,f.toast,"overlay")}))):f.overlay.removeEventListener("click",{})),function(){if(a.animateInside){f.toast.classList.add(n+"-animateInside");var e=[200,100,300];"bounceInLeft"!=a.transitionIn&&"bounceInRight"!=a.transitionIn||(e=[400,200,400]),a.title.length>0&&setTimeout((function(){f.strong.classList.add("slideIn")}),e[0]),a.message.length>0&&setTimeout((function(){f.p.classList.add("slideIn")}),e[1]),(a.icon||a.iconUrl)&&setTimeout((function(){f.icon.classList.add("revealIn")}),e[2]);var t=150;a.buttons.length>0&&f.buttons&&setTimeout((function(){h(f.buttons.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150}))}),a.inputs.length>0?150:0),a.inputs.length>0&&f.inputs&&(t=150,h(f.inputs.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150})))}}(),a.onOpening.apply(null,[a,f.toast]);try{var x=new CustomEvent(n+"-opening",{detail:a,bubbles:!0,cancelable:!0});document.dispatchEvent(x)}catch(e){console.warn(e)}setTimeout((function(){f.toast.classList.remove(n+"-opening"),f.toast.classList.add(n+"-opened");try{var e=new CustomEvent(n+"-opened",{detail:a,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}a.onOpened.apply(null,[a,f.toast])}),1e3),a.drag&&(i?(f.toast.addEventListener("touchstart",(function(e){b.startMoving(this,r,a,e)}),!1),f.toast.addEventListener("touchend",(function(e){b.stopMoving(this,e)}),!1)):(f.toast.addEventListener("mousedown",(function(e){e.preventDefault(),b.startMoving(this,r,a,e)}),!1),f.toast.addEventListener("mouseup",(function(e){e.preventDefault(),b.stopMoving(this,e)}),!1))),a.closeOnEscape&&document.addEventListener("keyup",(function(e){27==(e=e||window.event).keyCode&&r.hide(a,f.toast,"esc")})),a.closeOnClick&&f.toast.addEventListener("click",(function(e){r.hide(a,f.toast,"toast")})),r.toast=f.toast},t}(),void 0===(a="function"==typeof o?o.apply(t,r):o)||(e.exports=a)},5947:function(e,t,n){var o,r;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */o=function(){var e,t,n={version:"0.2.0"},o=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function r(e,t,n){return e<t?t:e>n?n:e}function a(e){return 100*(-1+e)}function i(e,t,n){var r;return(r="translate3d"===o.positionUsing?{transform:"translate3d("+a(e)+"%,0,0)"}:"translate"===o.positionUsing?{transform:"translate("+a(e)+"%,0)"}:{"margin-left":a(e)+"%"}).transition="all "+t+"ms "+n,r}n.configure=function(e){var t,n;for(t in e)void 0!==(n=e[t])&&e.hasOwnProperty(t)&&(o[t]=n);return this},n.status=null,n.set=function(e){var t=n.isStarted();e=r(e,o.minimum,1),n.status=1===e?null:e;var a=n.render(!t),c=a.querySelector(o.barSelector),u=o.speed,d=o.easing;return a.offsetWidth,s((function(t){""===o.positionUsing&&(o.positionUsing=n.getPositioningCSS()),l(c,i(e,u,d)),1===e?(l(a,{transition:"none",opacity:1}),a.offsetWidth,setTimeout((function(){l(a,{transition:"all "+u+"ms linear",opacity:0}),setTimeout((function(){n.remove(),t()}),u)}),u)):setTimeout(t,u)})),this},n.isStarted=function(){return"number"==typeof n.status},n.start=function(){n.status||n.set(0);var e=function(){setTimeout((function(){n.status&&(n.trickle(),e())}),o.trickleSpeed)};return o.trickle&&e(),this},n.done=function(e){return e||n.status?n.inc(.3+.5*Math.random()).set(1):this},n.inc=function(e){var t=n.status;return t?("number"!=typeof e&&(e=(1-t)*r(Math.random()*t,.1,.95)),t=r(t+e,0,.994),n.set(t)):n.start()},n.trickle=function(){return n.inc(Math.random()*o.trickleRate)},e=0,t=0,n.promise=function(o){return o&&"resolved"!==o.state()?(0===t&&n.start(),e++,t++,o.always((function(){0==--t?(e=0,n.done()):n.set((e-t)/e)})),this):this},n.render=function(e){if(n.isRendered())return document.getElementById("nprogress");u(document.documentElement,"nprogress-busy");var t=document.createElement("div");t.id="nprogress",t.innerHTML=o.template;var r,i=t.querySelector(o.barSelector),s=e?"-100":a(n.status||0),c=document.querySelector(o.parent);return l(i,{transition:"all 0 linear",transform:"translate3d("+s+"%,0,0)"}),o.showSpinner||(r=t.querySelector(o.spinnerSelector))&&h(r),c!=document.body&&u(c,"nprogress-custom-parent"),c.appendChild(t),t},n.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(o.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&h(e)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"};var s=function(){var e=[];function t(){var n=e.shift();n&&n(t)}return function(n){e.push(n),1==e.length&&t()}}(),l=function(){var e=["Webkit","O","Moz","ms"],t={};function n(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()}))}function o(t){var n=document.body.style;if(t in n)return t;for(var o,r=e.length,a=t.charAt(0).toUpperCase()+t.slice(1);r--;)if((o=e[r]+a)in n)return o;return t}function r(e){return e=n(e),t[e]||(t[e]=o(e))}function a(e,t,n){t=r(t),e.style[t]=n}return function(e,t){var n,o,r=arguments;if(2==r.length)for(n in t)void 0!==(o=t[n])&&t.hasOwnProperty(n)&&a(e,n,o);else a(e,r[1],r[2])}}();function c(e,t){return("string"==typeof e?e:f(e)).indexOf(" "+t+" ")>=0}function u(e,t){var n=f(e),o=n+t;c(n,t)||(e.className=o.substring(1))}function d(e,t){var n,o=f(e);c(e,t)&&(n=o.replace(" "+t+" "," "),e.className=n.substring(1,n.length-1))}function f(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function h(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return n},void 0===(r="function"==typeof o?o.call(t,n,t,e):o)||(e.exports=r)},8859:(e,t,n)=>{var o="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,a=o&&r&&"function"==typeof r.get?r.get:null,i=o&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&l&&"function"==typeof l.get?l.get:null,u=s&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,f="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,h="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,v=String.prototype.match,y=String.prototype.slice,b=String.prototype.replace,x=String.prototype.toUpperCase,w=String.prototype.toLowerCase,T=RegExp.prototype.test,I=Array.prototype.concat,E=Array.prototype.join,S=Array.prototype.slice,C=Math.floor,A="function"==typeof BigInt?BigInt.prototype.valueOf:null,M=Object.getOwnPropertySymbols,P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,D="function"==typeof Symbol&&"object"==typeof Symbol.iterator,L="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===D||"symbol")?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,k=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||T.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var o=e<0?-C(-e):C(e);if(o!==e){var r=String(o),a=y.call(t,r.length+1);return b.call(r,n,"$&_")+"."+b.call(b.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var _=n(2634),N=_.custom,B=H(N)?N:null;function U(e,t,n){var o="double"===(n.quoteStyle||t)?'"':"'";return o+e+o}function V(e){return b.call(String(e),/"/g,"&quot;")}function F(e){return!("[object Array]"!==W(e)||L&&"object"==typeof e&&L in e)}function j(e){return!("[object RegExp]"!==W(e)||L&&"object"==typeof e&&L in e)}function H(e){if(D)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!P)return!1;try{return P.call(e),!0}catch(e){}return!1}e.exports=function e(t,o,r,s){var l=o||{};if(q(l,"quoteStyle")&&"single"!==l.quoteStyle&&"double"!==l.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(q(l,"maxStringLength")&&("number"==typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var m=!q(l,"customInspect")||l.customInspect;if("boolean"!=typeof m&&"symbol"!==m)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(q(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(q(l,"numericSeparator")&&"boolean"!=typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var x=l.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return Y(t,l);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var T=String(t);return x?R(t,T):T}if("bigint"==typeof t){var C=String(t)+"n";return x?R(t,C):C}var M=void 0===l.depth?5:l.depth;if(void 0===r&&(r=0),r>=M&&M>0&&"object"==typeof t)return F(t)?"[Array]":"[Object]";var N=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=E.call(Array(e.indent+1)," ")}return{base:n,prev:E.call(Array(t+1),n)}}(l,r);if(void 0===s)s=[];else if(G(s,t)>=0)return"[Circular]";function z(t,n,o){if(n&&(s=S.call(s)).push(n),o){var a={depth:l.depth};return q(l,"quoteStyle")&&(a.quoteStyle=l.quoteStyle),e(t,a,r+1,s)}return e(t,l,r+1,s)}if("function"==typeof t&&!j(t)){var Z=function(e){if(e.name)return e.name;var t=v.call(g.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),ee=$(t,z);return"[Function"+(Z?": "+Z:" (anonymous)")+"]"+(ee.length>0?" { "+E.call(ee,", ")+" }":"")}if(H(t)){var te=D?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):P.call(t);return"object"!=typeof t||D?te:X(te)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var ne="<"+w.call(String(t.nodeName)),oe=t.attributes||[],re=0;re<oe.length;re++)ne+=" "+oe[re].name+"="+U(V(oe[re].value),"double",l);return ne+=">",t.childNodes&&t.childNodes.length&&(ne+="..."),ne+="</"+w.call(String(t.nodeName))+">"}if(F(t)){if(0===t.length)return"[]";var ae=$(t,z);return N&&!function(e){for(var t=0;t<e.length;t++)if(G(e[t],"\n")>=0)return!1;return!0}(ae)?"["+J(ae,N)+"]":"[ "+E.call(ae,", ")+" ]"}if(function(e){return!("[object Error]"!==W(e)||L&&"object"==typeof e&&L in e)}(t)){var ie=$(t,z);return"cause"in Error.prototype||!("cause"in t)||O.call(t,"cause")?0===ie.length?"["+String(t)+"]":"{ ["+String(t)+"] "+E.call(ie,", ")+" }":"{ ["+String(t)+"] "+E.call(I.call("[cause]: "+z(t.cause),ie),", ")+" }"}if("object"==typeof t&&m){if(B&&"function"==typeof t[B]&&_)return _(t,{depth:M-r});if("symbol"!==m&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!a||!e||"object"!=typeof e)return!1;try{a.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var se=[];return i&&i.call(t,(function(e,n){se.push(z(n,t,!0)+" => "+z(e,t))})),Q("Map",a.call(t),se,N)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{a.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var le=[];return u&&u.call(t,(function(e){le.push(z(e,t))})),Q("Set",c.call(t),le,N)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{f.call(e,f)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return K("WeakMap");if(function(e){if(!f||!e||"object"!=typeof e)return!1;try{f.call(e,f);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return K("WeakSet");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{return h.call(e),!0}catch(e){}return!1}(t))return K("WeakRef");if(function(e){return!("[object Number]"!==W(e)||L&&"object"==typeof e&&L in e)}(t))return X(z(Number(t)));if(function(e){if(!e||"object"!=typeof e||!A)return!1;try{return A.call(e),!0}catch(e){}return!1}(t))return X(z(A.call(t)));if(function(e){return!("[object Boolean]"!==W(e)||L&&"object"==typeof e&&L in e)}(t))return X(p.call(t));if(function(e){return!("[object String]"!==W(e)||L&&"object"==typeof e&&L in e)}(t))return X(z(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===n.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==W(e)||L&&"object"==typeof e&&L in e)}(t)&&!j(t)){var ce=$(t,z),ue=k?k(t)===Object.prototype:t instanceof Object||t.constructor===Object,de=t instanceof Object?"":"null prototype",fe=!ue&&L&&Object(t)===t&&L in t?y.call(W(t),8,-1):de?"Object":"",he=(ue||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(fe||de?"["+E.call(I.call([],fe||[],de||[]),": ")+"] ":"");return 0===ce.length?he+"{}":N?he+"{"+J(ce,N)+"}":he+"{ "+E.call(ce,", ")+" }"}return String(t)};var z=Object.prototype.hasOwnProperty||function(e){return e in this};function q(e,t){return z.call(e,t)}function W(e){return m.call(e)}function G(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function Y(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,o="... "+n+" more character"+(n>1?"s":"");return Y(y.call(e,0,t.maxStringLength),t)+o}return U(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Z),"single",t)}function Z(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+x.call(t.toString(16))}function X(e){return"Object("+e+")"}function K(e){return e+" { ? }"}function Q(e,t,n,o){return e+" ("+t+") {"+(o?J(n,o):E.call(n,", "))+"}"}function J(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+E.call(e,","+n)+"\n"+t.prev}function $(e,t){var n=F(e),o=[];if(n){o.length=e.length;for(var r=0;r<e.length;r++)o[r]=q(e,r)?t(e[r],e):""}var a,i="function"==typeof M?M(e):[];if(D){a={};for(var s=0;s<i.length;s++)a["$"+i[s]]=i[s]}for(var l in e)q(e,l)&&(n&&String(Number(l))===l&&l<e.length||D&&a["$"+l]instanceof Symbol||(T.call(/[^\w$]/,l)?o.push(t(l,e)+": "+t(e[l],e)):o.push(l+": "+t(e[l],e))));if("function"==typeof M)for(var c=0;c<i.length;c++)O.call(e,i[c])&&o.push("["+t(i[c])+"]: "+t(e[i[c]],e));return o}},4765:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,o="RFC1738",r="RFC3986";e.exports={default:r,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:o,RFC3986:r}},5373:(e,t,n)=>{"use strict";var o=n(8636),r=n(2642),a=n(4765);e.exports={formats:a,parse:r,stringify:o}},2642:(e,t,n)=>{"use strict";var o=n(7720),r=Object.prototype.hasOwnProperty,a=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:o.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,o){if(e){var a=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(a),c=s?a.slice(0,s.index):a,u=[];if(c){if(!n.plainObjects&&r.call(Object.prototype,c)&&!n.allowPrototypes)return;u.push(c)}for(var d=0;n.depth>0&&null!==(s=i.exec(a))&&d<n.depth;){if(d+=1,!n.plainObjects&&r.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+a.slice(s.index)+"]"),function(e,t,n,o){for(var r=o?t:l(t,n),a=e.length-1;a>=0;--a){var i,s=e[a];if("[]"===s&&n.parseArrays)i=n.allowEmptyArrays&&""===r?[]:[].concat(r);else{i=n.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=n.decodeDotInKeys?c.replace(/%2E/g,"."):c,d=parseInt(u,10);n.parseArrays||""!==u?!isNaN(d)&&s!==u&&String(d)===u&&d>=0&&n.parseArrays&&d<=n.arrayLimit?(i=[])[d]=r:"__proto__"!==u&&(i[u]=r):i={0:r}}r=i}return r}(u,t,n,o)}};e.exports=function(e,t){var n=function(e){if(!e)return i;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?i.charset:e.charset,n=void 0===e.duplicates?i.duplicates:e.duplicates;if("combine"!==n&&"first"!==n&&"last"!==n)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||i.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:i.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:i.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:i.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:i.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:i.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:i.decoder,delimiter:"string"==typeof e.delimiter||o.isRegExp(e.delimiter)?e.delimiter:i.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:i.depth,duplicates:n,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:i.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:i.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var n,c={__proto__:null},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,f=u.split(t.delimiter,d),h=-1,p=t.charset;if(t.charsetSentinel)for(n=0;n<f.length;++n)0===f[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[n]?p="utf-8":"utf8=%26%2310003%3B"===f[n]&&(p="iso-8859-1"),h=n,n=f.length);for(n=0;n<f.length;++n)if(n!==h){var m,g,v=f[n],y=v.indexOf("]="),b=-1===y?v.indexOf("="):y+1;-1===b?(m=t.decoder(v,i.decoder,p,"key"),g=t.strictNullHandling?null:""):(m=t.decoder(v.slice(0,b),i.decoder,p,"key"),g=o.maybeMap(l(v.slice(b+1),t),(function(e){return t.decoder(e,i.decoder,p,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===p&&(g=s(g)),v.indexOf("[]=")>-1&&(g=a(g)?[g]:g);var x=r.call(c,m);x&&"combine"===t.duplicates?c[m]=o.combine(c[m],g):x&&"last"!==t.duplicates||(c[m]=g)}return c}(e,n):e,d=n.plainObjects?Object.create(null):{},f=Object.keys(u),h=0;h<f.length;++h){var p=f[h],m=c(p,u[p],n,"string"==typeof e);d=o.merge(d,m,n)}return!0===n.allowSparse?d:o.compact(d)}},8636:(e,t,n)=>{"use strict";var o=n(920),r=n(7720),a=n(4765),i=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,l(t)?t:[t])},d=Date.prototype.toISOString,f=a.default,h={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:r.encode,encodeValuesOnly:!1,format:f,formatter:a.formatters[f],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},p={},m=function e(t,n,a,i,s,c,d,f,m,g,v,y,b,x,w,T,I,E){for(var S,C=t,A=E,M=0,P=!1;void 0!==(A=A.get(p))&&!P;){var D=A.get(t);if(M+=1,void 0!==D){if(D===M)throw new RangeError("Cyclic object value");P=!0}void 0===A.get(p)&&(M=0)}if("function"==typeof g?C=g(n,C):C instanceof Date?C=b(C):"comma"===a&&l(C)&&(C=r.maybeMap(C,(function(e){return e instanceof Date?b(e):e}))),null===C){if(c)return m&&!T?m(n,h.encoder,I,"key",x):n;C=""}if("string"==typeof(S=C)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||r.isBuffer(C))return m?[w(T?n:m(n,h.encoder,I,"key",x))+"="+w(m(C,h.encoder,I,"value",x))]:[w(n)+"="+w(String(C))];var L,O=[];if(void 0===C)return O;if("comma"===a&&l(C))T&&m&&(C=r.maybeMap(C,m)),L=[{value:C.length>0?C.join(",")||null:void 0}];else if(l(g))L=g;else{var k=Object.keys(C);L=v?k.sort(v):k}var R=f?n.replace(/\./g,"%2E"):n,_=i&&l(C)&&1===C.length?R+"[]":R;if(s&&l(C)&&0===C.length)return _+"[]";for(var N=0;N<L.length;++N){var B=L[N],U="object"==typeof B&&void 0!==B.value?B.value:C[B];if(!d||null!==U){var V=y&&f?B.replace(/\./g,"%2E"):B,F=l(C)?"function"==typeof a?a(_,V):_:_+(y?"."+V:"["+V+"]");E.set(t,M);var j=o();j.set(p,E),u(O,e(U,F,a,i,s,c,d,f,"comma"===a&&T&&l(C)?null:m,g,v,y,b,x,w,T,I,j))}}return O};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return h;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||h.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=a.default;if(void 0!==e.format){if(!i.call(a.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var o,r=a.formatters[n],c=h.filter;if(("function"==typeof e.filter||l(e.filter))&&(c=e.filter),o=e.arrayFormat in s?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":h.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var u=void 0===e.allowDots?!0===e.encodeDotInKeys||h.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:h.addQueryPrefix,allowDots:u,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:h.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:h.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:void 0===e.delimiter?h.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:h.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:h.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:h.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:h.encodeValuesOnly,filter:c,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:h.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:h.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:h.strictNullHandling}}(t);"function"==typeof c.filter?r=(0,c.filter)("",r):l(c.filter)&&(n=c.filter);var d=[];if("object"!=typeof r||null===r)return"";var f=s[c.arrayFormat],p="comma"===f&&c.commaRoundTrip;n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var g=o(),v=0;v<n.length;++v){var y=n[v];c.skipNulls&&null===r[y]||u(d,m(r[y],y,f,p,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,g))}var b=d.join(c.delimiter),x=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?x+="utf8=%26%2310003%3B&":x+="utf8=%E2%9C%93&"),b.length>0?x+b:""}},7720:(e,t,n)=>{"use strict";var o=n(4765),r=Object.prototype.hasOwnProperty,a=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},o=0;o<e.length;++o)void 0!==e[o]&&(n[o]=e[o]);return n},l=1024;e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],o=0;o<t.length;++o)for(var r=t[o],i=r.obj[r.prop],s=Object.keys(i),l=0;l<s.length;++l){var c=s[l],u=i[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:i,prop:c}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(a(n)){for(var o=[],r=0;r<n.length;++r)void 0!==n[r]&&o.push(n[r]);t.obj[t.prop]=o}}}(t),e},decode:function(e,t,n){var o=e.replace(/\+/g," ");if("iso-8859-1"===n)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(e){return o}},encode:function(e,t,n,r,a){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",u=0;u<s.length;u+=l){for(var d=s.length>=l?s.slice(u,u+l):s,f=[],h=0;h<d.length;++h){var p=d.charCodeAt(h);45===p||46===p||95===p||126===p||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||a===o.RFC1738&&(40===p||41===p)?f[f.length]=d.charAt(h):p<128?f[f.length]=i[p]:p<2048?f[f.length]=i[192|p>>6]+i[128|63&p]:p<55296||p>=57344?f[f.length]=i[224|p>>12]+i[128|p>>6&63]+i[128|63&p]:(h+=1,p=65536+((1023&p)<<10|1023&d.charCodeAt(h)),f[f.length]=i[240|p>>18]+i[128|p>>12&63]+i[128|p>>6&63]+i[128|63&p])}c+=f.join("")}return c},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(a(e)){for(var n=[],o=0;o<e.length;o+=1)n.push(t(e[o]));return n}return t(e)},merge:function e(t,n,o){if(!n)return t;if("object"!=typeof n){if(a(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(o&&(o.plainObjects||o.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var i=t;return a(t)&&!a(n)&&(i=s(t,o)),a(t)&&a(n)?(n.forEach((function(n,a){if(r.call(t,a)){var i=t[a];i&&"object"==typeof i&&n&&"object"==typeof n?t[a]=e(i,n,o):t.push(n)}else t[a]=n})),t):Object.keys(n).reduce((function(t,a){var i=n[a];return r.call(t,a)?t[a]=e(t[a],i,o):t[a]=i,t}),i)}}},6897:(e,t,n)=>{"use strict";var o=n(453),r=n(41),a=n(592)(),i=n(5795),s=n(9675),l=o("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new s("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||l(t)!==t)throw new s("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],o=!0,c=!0;if("length"in e&&i){var u=i(e,"length");u&&!u.configurable&&(o=!1),u&&!u.writable&&(c=!1)}return(o||c||!n)&&(a?r(e,"length",t,!0,!0):r(e,"length",t)),e}},920:(e,t,n)=>{"use strict";var o=n(453),r=n(8075),a=n(8859),i=n(9675),s=o("%WeakMap%",!0),l=o("%Map%",!0),c=r("WeakMap.prototype.get",!0),u=r("WeakMap.prototype.set",!0),d=r("WeakMap.prototype.has",!0),f=r("Map.prototype.get",!0),h=r("Map.prototype.set",!0),p=r("Map.prototype.has",!0),m=function(e,t){for(var n,o=e;null!==(n=o.next);o=n)if(n.key===t)return o.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,o={assert:function(e){if(!o.has(e))throw new i("Side channel does not contain "+a(e))},get:function(o){if(s&&o&&("object"==typeof o||"function"==typeof o)){if(e)return c(e,o)}else if(l){if(t)return f(t,o)}else if(n)return function(e,t){var n=m(e,t);return n&&n.value}(n,o)},has:function(o){if(s&&o&&("object"==typeof o||"function"==typeof o)){if(e)return d(e,o)}else if(l){if(t)return p(t,o)}else if(n)return function(e,t){return!!m(e,t)}(n,o);return!1},set:function(o,r){s&&o&&("object"==typeof o||"function"==typeof o)?(e||(e=new s),u(e,o,r)):l?(t||(t=new l),h(t,o,r)):(n||(n={key:{},next:null}),function(e,t,n){var o=m(e,t);o?o.value=n:e.next={key:t,next:e.next,value:n}}(n,o,r))}};return o}},5485:e=>{
/*! For license information please see simple.min.js.LICENSE.txt */
self,e.exports=function(){"use strict";var e={362:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=(...e)=>{const t=[],n=e.length;for(let r=0;r<n;r++){const a=e[r];"Array"===(0,o.dataType)(a)&&a.forEach(((e,o)=>{t[r+o*n]=e}))}return t.filter((e=>null!=e))}},114:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.arraysLaminated=void 0;var r=n(362);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return o(r).default}})},537:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t=!1)=>{try{if(TextDecoder){const t=new TextDecoder("utf-8");return JSON.parse(t.decode(new Uint8Array(e)))}const t=new Uint8Array(e),n=String.fromCharCode.apply(null,t);return JSON.parse(n)}catch(e){return void(t&&console.log(e))}}},415:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isDICM=t.arrayBufferToJson=void 0;var r=n(537);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return o(r).default}});var a=n(754);Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return o(a).default}})},754:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{if(!e||!e.byteLength||e.byteLength<=132)return!1;let t="";const n=new Uint8Array(e,128,4);for(let e=0;e<n.length;e++)t+=String.fromCharCode(n[e]);return"DICM"===t}},80:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.store=new Map}get(e,...t){const n=JSON.stringify(t);if(!this.store.has(e)){const o=e(...t),r=new Map;return r.set(n,o),this.store.set(e,r),o}const o=this.store.get(e);if(!(null==o?void 0:o.has(n))){const r=e(...t);return null==o||o.set(n,r),r}return o.get(n)}}},983:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,n=1){this.db=void 0,this.dbName=e,this.storeName=t,this.version=n}open(){return new Promise(((e,t)=>{const n=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB;if(!n){const e=new Error("IndexedDB is not supported");return console.warn(e),t(e)}const o=n.open(this.dbName,this.version);o.onsuccess=t=>{var n;this.db=null===(n=t.target)||void 0===n?void 0:n.result,e(t)},o.onerror=function(e){t(e),console.log("数据库打开失败...")},o.onupgradeneeded=e=>{var t;const n=this.storeName,o=null===(t=e.target)||void 0===t?void 0:t.result;o.objectStoreNames.contains(n)||o.createObjectStore(n)}}))}dispatch(e,t={},...n){const{mode:o="readwrite",more:r=!1}=t;return new Promise(((a,i)=>{try{const t=this.getObjectStore(o),s=t[e];if(!(e in t))return i(`${e} is undefined, reference resources:https://developer.mozilla.org/zh-CN/docs/Web/API/IDBObjectStore`);if("function"==typeof s){const o=t[e](...n);o.onsuccess=e=>{var n;const i=null===(n=e.target)||void 0===n?void 0:n.result;a(r?{res:o,event:e,result:i,objectStore:t,bd:this.db}:i)},o.onerror=i}else a(s)}catch(o){i({message:o,arguments:{func:e,options:t,args:n}})}}))}getObjectStore(e="readwrite"){if(!this.db)throw new Error("No database connection available , please use IndexedDB=>open to connect");return this.db.transaction([this.storeName],e).objectStore(this.storeName)}}},497:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.func=e,this.result}run(...e){return void 0!==this.result||(this.result=this.func(...e)),this.result}}},137:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.taskId=0,this.count=0,this.arr=[],this.limit=0,this.pendingTask=[],this.func=()=>({}),this.finishSResolve=()=>({})}init(e){const{arr:t=[],func:n,limit:o=6}=e||{};return t.length&&n?(this.arr.length&&this.pendingTask.push({arr:[...this.arr],func:this.func,limit:this.limit}),this.count=0,this.arr=[...t],this.limit=Math.min(o,t.length),this.func=n,this.loop(this.taskId),new Promise((e=>{this.finishSResolve=e}))):Promise.reject("arr and func is required")}loop(e){return n(this,void 0,void 0,(function*(){if(e===this.taskId)if(0!==this.arr.length)this.count+=1,this.count<this.limit&&this.loop(this.taskId),yield this.func(this.arr.shift()),e===this.taskId&&(this.count>=this.limit&&this.loop(this.taskId),this.count-=1);else if(this.count<=0){this.finishSResolve("finish");const{arr:e,func:t,limit:n}=this.pendingTask.shift()||{};(null==e?void 0:e.length)&&t&&(this.taskId+=1,this.init({arr:e,func:t,limit:n}))}else setTimeout((()=>this.loop(this.taskId)),100)}))}cancel(){return this.taskId+=1,this.arr.length=0,this.pendingTask.length=0,Promise.resolve("cancel")}}},182:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=e||{},{tagName:o="div"}=t,r=n(t,["tagName"]),a=document.createElement(o);for(const[e,t]of Object.entries(r))a[e]=t;return a}},368:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=function(e,t,n){let r,a,i,s,l,c,u=0,d=!1,f=!1,h=!0;const p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){const n=r,o=a;return r=a=void 0,u=t,i=e.apply(o,n),i}function g(e,t=0){return p?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){const n=e-(c||0);return void 0===c||n>=(t||0)||n<0||f&&e-u>=(s||0)}function y(){const e=Date.now();if(v(e))return b(e);l=g(y,function(e){const n=e-u,o=(t||0)-(e-(c||0));return f?Math.min(o,(s||0)-n):o}(e))}function b(e){return l=void 0,h&&r?m(e):(r=a=void 0,i)}function x(...e){const n=Date.now(),o=v(n);if(r=e,a=this,c=n,o){if(void 0===l)return function(e){return u=e,l=g(y,t),d?m(e):i}(c);if(f)return l=g(y,t),m(c)}return void 0===l&&(l=g(y,t)),i}return t=Number(t)||0,n&&"Object"===(0,o.dataType)(n)&&(d=Boolean(n.leading),f="maxWait"in n,s=f?Math.max(Number(n.maxWait)||0,t):s,h="trailing"in n?Boolean(n.trailing):h),x.cancel=function(){void 0!==l&&function(e){if(p)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),u=0,r=c=a=l=void 0},x.flush=function(){return void 0===l?i:b(Date.now())},x.pending=function(){return void 0!==l},x}},456:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createElement=t.throttle=t.debounce=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=void 0;var r=n(137);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return o(r).default}});var a=n(80);Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return o(a).default}});var i=n(497);Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return o(i).default}});var s=n(983);Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return o(s).default}});var l=n(935);Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return o(l).default}});var c=n(378);Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return o(c).default}});var u=n(368);Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return o(u).default}});var d=n(539);Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return o(d).default}});var f=n(182);Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return o(f).default}})},935:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=function e(t,n){if("Object"!==(0,o.dataType)(t))return"";const r=Object.keys(t);return r.reduce(((a,i,s)=>{const l=t[i];return 0!==s||n||(a+="?"),"Object"===(0,o.dataType)(l)?a+=e(l,n?`${n}[${i}]`:i):a+=n?`${n}[${i}]=${l}`:`${i}=${l}`,s!==r.length-1&&(a+="&"),a}),"")}},378:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e=e||location.search;const t={};if("function"==typeof URLSearchParams){const n=new URLSearchParams(e);for(const[e,o]of n)t[e]=o}else{const n=e.replace("?","").split("&");for(const e of n){const[n,o]=e.split("=");t[n]=o}}return t}},539:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=function(e,t=0,n){let r=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return n&&"Object"===(0,o.dataType)(n)&&(r="leading"in n?Boolean(n.leading):r,a="trailing"in n?Boolean(n.trailing):a),(0,o.debounce)(e,t,{leading:r,trailing:a,maxWait:t})}},337:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=void 0;const o=(e,t="image/png")=>{const n=document.createElement("canvas"),o=n.getContext("2d");return n.height=e.height,n.width=e.width,null==o||o.putImageData(e,0,0),n.toDataURL(t)};t.ImageDataToDataURL=o;const r=(e,t)=>new Promise(((n,r)=>{const a=o(e,t),i=new Image;i.src=a,i.onload=()=>{n(i)},i.onerror=e=>{r(e)}}));t.ImageDataToImage=r;const a=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const n=o(e,t),r=yield fetch(n);return Promise.resolve(r.arrayBuffer())}catch(e){return Promise.reject(e)}}));t.ImageDataToArraybuffer=a,t.default={ImageDataToDataURL:o,ImageDataToImage:r,ImageDataToArraybuffer:a}},37:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const o=n(607);t.default=(e,t,n={})=>{const{interceptors:r,crossOrigin:a="Anonymous",zoom:i=1,debug:s=!1}=n;return new Promise(((n,l)=>{try{const c=null==e?void 0:e.getContext("2d"),u=e.width,d=e.height;let f=1;const h=new Image;h.crossOrigin=a,h.src=t,h.onload=()=>{let e=h.width,t=h.height;f=u/d>e/t?d/t:u/e,e=e*f*i,t=t*f*i,s&&console.log({cW:u,cH:d,scale:f,zoom:i,originIW:h.width,originIH:h.height,iW:e,iH:t});const[a,p,m,g]=[(u-e)/2,(d-t)/2,e,t];if("function"!=typeof r)null==c||c.drawImage(h,a,p,m,g),n("success");else{const e=r();if("Promise"!==(0,o.dataType)(e))throw l(new Error("interceptors must be Promise"));e.then((e=>{e?(null==c||c.drawImage(h,a,p,m,g),n("success")):l("cancel")}),(()=>{l("cancel")}))}},h.onerror=e=>{l(e)}}catch(e){l(e)}}))}},176:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=void 0;var r=n(37);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return o(r).default}});var a=n(337);Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return a.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return a.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return a.ImageDataToArraybuffer}})},814:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,n={})=>{var o;if(t&&(t=`script${t}`,document.querySelector(`#${t}`)))return;const r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",e),t&&r.setAttribute("id",t);for(const[e,t]of Object.entries(n))r.setAttribute(e,t);null===(o=document.querySelector("head"))||void 0===o||o.appendChild(r)}},826:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.importScript=void 0;var r=n(814);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return o(r).default}})},607:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=t.httpRequest=t.importScript=t.isDICM=t.arrayBufferToJson=t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=t.dataType=t.env=t.isCanvasBlank=t.isNull=t.createElement=t.throttle=t.debounce=t.arraysLaminated=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=t.version=void 0;const r=n(456);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return r.PromiseQueue}}),Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return r.ComputeStore}}),Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return r.Once}}),Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return r.IndexedDB}}),Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return r.objectToQuery}}),Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return r.queryToObject}}),Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return r.debounce}}),Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return r.throttle}}),Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return r.createElement}});const a=n(114);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return a.arraysLaminated}});const i=n(693);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return i.isNull}}),Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return i.isCanvasBlank}}),Object.defineProperty(t,"env",{enumerable:!0,get:function(){return i.env}}),Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return i.dataType}});const s=n(176);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return s.canvasDrawImage}}),Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return s.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return s.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return s.ImageDataToArraybuffer}});const l=n(415);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return l.arrayBufferToJson}}),Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return l.isDICM}});const c=n(826);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return c.importScript}});const u=n(855);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return u.httpRequest}});const d=n(895);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return d.copyText}});const f=o(n(147)),{version:h}=f.default;t.version=h,t.default={version:h,PromiseQueue:r.PromiseQueue,ComputeStore:r.ComputeStore,Once:r.Once,IndexedDB:r.IndexedDB,objectToQuery:r.objectToQuery,queryToObject:r.queryToObject,arraysLaminated:a.arraysLaminated,debounce:r.debounce,throttle:r.throttle,createElement:r.createElement,isNull:i.isNull,isCanvasBlank:i.isCanvasBlank,env:i.env,dataType:i.dataType,canvasDrawImage:s.canvasDrawImage,ImageDataToDataURL:s.ImageDataToDataURL,ImageDataToImage:s.ImageDataToImage,ImageDataToArraybuffer:s.ImageDataToArraybuffer,arrayBufferToJson:l.arrayBufferToJson,isDICM:l.isDICM,importScript:c.importScript,httpRequest:u.httpRequest,copyText:d.copyText}},363:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t={},o)=>new Promise(((r,a)=>{const i=new XMLHttpRequest;"function"==typeof o&&o(i),i.onreadystatechange=()=>{const{status:e,readyState:t}=i;if(0!==t&&1!==t)return 200!==e?a(i):4===t?r(i):void 0},i.onerror=()=>{a(i)};const{method:s="GET",async:l=!0,username:c,password:u,send:d,open:f}=t,h=n(t,["method","async","username","password","send","open"]);f&&console.log(new Error("don't config open ,please configure async、username、password")),i.open(s,e,l,c,u);for(const[e,t]of Object.entries(h)){if(!(e in i))return a(`${e} is undefined, reference resources: https://www.w3school.com.cn/xmldom/dom_http.asp`);if("function"==typeof i[e]){const{args:n}=t;n&&n.constructor===Array?i[e](...t):i[e](t)}else i[e]=t}i.send(d)}))},855:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.httpRequest=void 0;var r=n(363);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return o(r).default}})},185:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const n=typeof e,{lowercase:o=!1}=t||{};if("object"===n){const t=Object.prototype.toString.call(e).slice(8,-1);return o?t.toLowerCase():t}return n}},865:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const{userAgent:n,platform:o}=navigator;return e=e||n,{isWin:(t=t||o).includes("Win"),isMac:t.includes("Mac"),isLinux:!!t.match(/Linux|X11/i),isIpad:!!e.match(/iPad/i),isMobile:!!e.match(/mobile|phone/i),isAndroid:!!e.match(/android/i),IsIphone:!!e.match(/iphone/i),isWM:!!e.match(/windows mobile/i),isWeChat:!!e.match(/MicroMessenger/i)}}},693:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dataType=t.env=t.isCanvasBlank=t.isNull=void 0;var r=n(123);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return o(r).default}});var a=n(41);Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return o(a).default}});var i=n(865);Object.defineProperty(t,"env",{enumerable:!0,get:function(){return o(i).default}});var s=n(185);Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return o(s).default}})},41:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()}},123:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>[void 0,'""','" "',"null","[]","{}"].includes(JSON.stringify(e))},874:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>new Promise(((t,n)=>{const o=navigator.clipboard;if(!o){if(document.execCommand){const o=document.createElement("input");document.body.appendChild(o),o.setAttribute("value",e),o.select();try{return document.execCommand("Copy"),o.remove(),t("success")}catch(e){return o.remove(),n(e)}}return n("该浏览器不支持自动复制")}o.writeText(e).then((()=>{t("success")}),(e=>{n(e)}))}))},895:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=void 0;var r=n(874);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return o(r).default}})},147:function(e){e.exports=JSON.parse('{"name":"simple2k13","version":"1.1.0","description":"some simple functions","main":"dist/simple.min.js","types":"dist/index.d.ts","scripts":{"test":"jest","test:watch":"jest --watch","test:staged":"jest --bail --findRelatedTests","start":"webpack-dev-server --env development --node-env development","build":"webpack --env production --node-env production --progress && tsc","prepare":"is-ci || husky install","lint":"eslint ./src --ext .js,.tsx,.ts","lint:fix":"eslint ./src --ext .js,.tsx,.ts --fix","lint:staged":"lint-staged","publish:major":"npm run lint:staged && npm version major && npm run build && npm publish","publish:minor":"npm run lint:staged && npm version minor && npm run build && npm publish","publish:patch":"npm run lint:staged && npm version patch && npm run build && npm publish","publish:prerelease":"npm run lint:staged && npm version prerelease && npm run build && npm publish"},"lint-staged":{"src/**/*.{js,ts,tsx}":["eslint","jest --bail --findRelatedTests"]},"repository":{"type":"git","url":"https://github.com/npm-for-cw/simple2k13"},"keywords":["functions","simple","simple2k13","js","cw"],"author":"cw<cw2k13as@gmail.com>","license":"LGPL-3.0","homepage":"https://github.com/npm-for-cw/simple2k13","files":["/dist","example"],"devDependencies":{"@babel/core":"^7.18.10","@babel/preset-env":"^7.18.10","@babel/preset-typescript":"^7.18.6","@commitlint/cli":"^17.1.1","@commitlint/config-conventional":"^17.1.0","@types/jest":"^28.1.3","@types/node":"^18.7.2","@types/webpack":"^5.28.0","@typescript-eslint/eslint-plugin":"^5.37.0","@typescript-eslint/parser":"^5.36.2","babel-jest":"^28.1.3","eslint":"^8.0.1","eslint-plugin-import":"^2.25.2","eslint-plugin-n":"^15.0.0","eslint-plugin-promise":"^6.0.0","fake-indexeddb":"^4.0.0","html-webpack-plugin":"^5.5.3","husky":"^8.0.0","is-ci":"^3.0.1","jest":"^28.1.3","jest-canvas-mock":"^2.4.0","jest-environment-jsdom":"^28.1.3","jest-fetch-mock":"^3.0.3","lint-staged":"^13.0.3","pinst":"^3.0.0","text-encoding":"^0.7.0","ts-jest":"^28.0.7","ts-loader":"^9.3.1","ts-node":"^10.9.1","tslint":"^6.1.3","typescript":"^4.7.4","webpack":"^5.74.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.15.1"},"dependencies":{}}')}},t={};return function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}(607).default}()},1278:()=>{!function(){const e={AI:{calcification:"钙化",groundGlass:"磨玻璃",partSolid:"部分实性",solid:"实性",pleural:"胸膜结节",lesions:"良恶性",benign:"良性",borderlineBenign:"偏良性",borderlineMalignant:"偏恶性",malignant:"恶性",number:"编号",longShortMeridian:"长短经",volume:"体积",type:"类型"},DICOMTags:{age:"年龄",date:"日期",imageNumber:"影像号",modality:"设备",name:"姓名",scale:"缩放",sex:"性别",thickness:"层厚",KVP:"电压",windowCenter:"窗位",windowWidth:"窗宽",birthday:"生日",patientID:"患者ID",hospitals:"机构医院",acquisitionDate:"图像获取日期",acquisitionTime:"图像获取时间",studyDate:"检查日期",studyTime:"检查时间",description:"检查描述",accessionNumber:"检查流水号",seriesID:"序列ID",seriesUID:"序列UID",seriesDescription:"序列描述",rows:"像素行数",cols:"像素列数",pixelSpacingX:"像素间X高距离",pixelSpacingY:"像素间Y高距离",bitsAllocated:"图像分配位数",bitsStored:"实际占用位数",highBit:"高位",rescaleIntercept:"偏移量",rescaleSlope:"调整斜率",pixelRepresentation:"符号标识",samplesPerPixel:"像象素所点位",photometricInterpretation:"图像光度",imagePosition:"图像位置",imageOrientation:"图像方位",orientationLeft:"图像方位左",orientationRight:"图像方位右",orientationTop:"图像方位上",orientationBottom:"图像方位下",blocks:"分片",manufacturer:"设备厂商",sopInstanceUID:"图像唯一号",studyID:"检查ID",studyUID:"检查UID",transferSyntaxUID:"传送语法UID",fileName:"文件名"},tools:{AI:"AI","2D":"2D","3D":"3D",MPR:"MPR",fusion:"融合",reload:"重载",release:"释放",restore:"恢复",reset:"重置视图",seriesBar:"序列栏",stackScroll:"翻页",seriesLayout:"序列",sharpen:"锐化",saveImage:"保存图片",imagesLayout:"图像",measure:"测量",modulation:"调窗",modulationPreset:"预设调窗",major:"专业",pan:"移动",player:"播放",rotate:"旋转",invert:"负像",zoom:"缩放",magnifier:"放大镜",length:"直线",freehandRoi:"自由测量",annotate:"批注",annotateText:"文本批注",annotateArrow:"箭头批注",blur:"平滑",blendModes:"密度投影",blendComposite:"默认",blendMax:"最大密度投影",blendMin:"最小密度投影",blendAverage:"平均密度投影",markerL:"左标记",markerR:"右标记",more:"更多",aboutUs:"关于我们",angle:"角度",aroundInfo:"四角信息",cancelLabels:"全部撤销",cobbAngle:"cobb角",colorMap:"伪彩",crosshairs:"十字准线",disSeries:"删除图像",rectangleRoi:"矩形",referenceLine:"定位线",ellipticalRoi:"椭圆",circleRoi:"圆形",CTR:"心胸比",deleteLabel:"删除标注",enhance:"增强",probeCT:"点CT值",useCacheImage:"使用缓存",imageCacheType:"速度优先",knifeIn:"手术刀内",knifeOut:"手术刀外",VRTModulation:"骨窗调节",volume:"容积",viewportPresets:"视图预设",viewportPresetsDefault:"默认",fusionLayout:"布局选择",fusionLayoutDefault:"默认 (C/S/A)",fusionLayoutCoronal:"冠状位Coronal",fusionLayoutSagittal:"矢状位Sagittal",fusionLayoutAxial:"轴状位Axial",quality:"画质调整",thickness:"层厚",modes:{speed:"有损模式",standard:"无损模式",major:"专业模式"},DICOMInfo:"DICOM信息"},DICOMInfo:{patient:"患者信息",examinations:"检查信息",series:"序列信息",image:"图像信息",device:"设备信息",UID:"UID信息",other:"其他信息"},aboutUs:{description:"给医生用户提供常用2D及MPR影像处理功能，支持多种影像加载模式。",copyright:"深圳市巨鼎医疗股份有限公司",tel:"400 800 5557",releaseVersion:"软件发布版本号",fullVersion:"软件完整版本号"},synchronizerSwitch:{title:"序列同步器",on:"联动",off:"关闭",onError:"序列同步器已打开，请重新选择需要同步的功能"},response:{statusCode:{401:"授权信息已失效！",403:"访问权限受限！",404:"请求接口地址不存在，请检查！"},fail:"获取数据失败，请稍后重试!",unknown:"未知错误",metaDataError:"Meta数据获取失败，uuid：",DCMPathDataError:"未获得dcm数据或该医院接口未支持，请切换到专业模式",VRTPathDataError:"未获得3D数据或该医院接口未支持，请联系管理员",AIDataError:"未获取到AI结果"},rotate:{restore:"恢复默认",counterclockwise90:"逆时针90°",clockwise90:"顺时针90°",HFlip:"垂直翻转",VFlip:"水平翻转"},player:{first:"第一张",prev:"上一张",next:"下一张",last:"最后一张",play:"播放",pause:"暂停",custom:"自定义"},other:{close:"关闭",custom:"自定义",toggleStudy:"切换检查"},toast:{AIConfigError:"该医院未正确配置或接入AI分析",disCacheImage:{reconfirm:"缓存功能即将关闭，低内存手机建议打开!",reconfirmForAllLoad:"全量下载模式下请保持缓存功能打开，否则可能影响下载效果！是否关闭？"},reDestroy:"实例已销毁，请勿重复调用,请将实例赋值为null或undefined",globalContainerExistence:"该容器已实例化或内有其他元素，请调用destroy方法或清除内部无关元素再试！",referenceLinesWarn:"温馨提示：可视序列窗口数量少于序列总量，可能导致定位线不工作。1.将相关序列置于可视序列窗口中；2.可设置序列窗口数量大于等于序列总量",saveImage:"长按保存图像",setLanguage:"是否切换语言？确认后重新进入设置将生效!",speedPriority:"高性能模式即将打开，建议高性能设备使用，如遇问题请关闭或刷新即会自动关闭!",MPRLevel:"请选择画质级别：(画质过高可能导致渲染缓慢、失败或崩溃)",imageLayoutError:"安卓版微信渲染序列图像过多可能导致失败!",inputDataError:"数据有误，请重新输入！",languagePackageInit:"语言包加载成功",languagePackageReLoad:"语言包重载成功",languagePackageNoInit:"语言包未加载",deviceTypeChange:"为了更好的体验，请刷新或重新进入",indexedDBDelete:"即将执行数据清除:",is32System:"检测到浏览器为32位，可能导致软件异常，请使用64浏览器！！",kernelVersionLow:"当前浏览器内核过低，请使用谷歌浏览器(Google Chrome)、微软Edge浏览器或360安全浏览器。",memoryRatioTips:"如遇渲染缓慢、失败或崩溃，可调整画质级别",noSerise:"请选择一个序列",noImagePositionMPR:"当前序列不支持MPR，图像中无空间坐标信息",noImagePosition3D:"当前序列不支持3D，图像中无空间坐标信息",noRenderSerise:["该序列不在序列窗口中，图像未渲染，请","长按添加","拖拽","或双击添加到序列窗"],seriesNumLow:["当前序列图像数量小于","无法构建"],studiesLoading:"检查加载中，请稍后再试",NoPTData:"未检测到可以融合的PET/CT数据,需同部位的PET序列和CT序列才可融合！",interGPU:{close:"关闭",disReminders:"获取方案,不再提醒",title:"温馨提示",tips:["intel显卡用户","如遇MPR/融合无法渲染，","请点击此处获取解决方案","，无异常请忽略。"]},MPR:{loading:"资源加载中,请耐心等待",crossOrigin:'"MPR渲染加速"必须使用https安全协议，未部署https安全协议？',unMPRModule:"MPR模块未加载，请稍后重试或联系管理员检查配置",renderError:"MPR生成失败，请稍后重试",sharedArrayBuffer:{manual:'"MPR渲染加速"已被手动设置为：',http:'将关闭"MPR渲染加速"!',https:'"MPR渲染加速"需配置crossOriginIsolated，请联系管理员',disabled:'"MPR渲染加速"已关闭',enabled:'"MPR渲染加速"已开启',unEnabled:'"MPR渲染加速"未开启'},versionError:["MPR模块版本不匹配：","可能导致功能异常，请退出稍后再试、清除缓存或联系管理员！"],GPUBenchmarksURL:{null:"GPUBenchmarksURL路径未配置，将默认系统路径：",error:"GPUBenchmarksURL路径不存在，将无法启用GPU加速，请联系管理员！"}},"3D":{noURL:"该医院未接入3D",loading:"3D资源加载中,请耐心等待",close:"3D服务器连接失败，请退出重试！",error:"3D服务器连接失败!"},loadAndCacheImage:{parsingFailed:"图像解析失败",validationFailed:"授权验证失效，请稍后重试！",dataError:"图像解析失败，请稍后重试！",acquisitionFailed:"影像获取失败",networkDis:"网络连接失败",notSupportedBlocks:"暂不支持分片处理，请切换到专业模式",versionLow:"当前浏览器版本过低，请升级浏览器版本或者切换至专业模式！"},prompt:{enterScale:"请输入缩放比例",enterWL:"请输入窗宽、窗位",enterText:"输入文本：",changeText:"更改文本：",enterComment:"输入注释：",changeComment:"更改注释：",enter:"请输入",OK:"确定",cancel:"取消",verificationError:"数据有误，请重新输入！",example:"例",fusionTitle:"融合",PTLabel:"PET序列",CTLabel:"CT序列"}}},t="zh-CN";window.webDicomViewLocal||(window.webDicomViewLocal={default:void 0}),window.webDicomViewLocal[t]?console.info(`${t} ${e.toast.languagePackageReLoad}`):console.info(`${t} ${e.toast.languagePackageInit}`),window.webDicomViewLocal[t]={name:"简体中文",locale:e,language:t},void 0===window.webDicomViewLocal.default&&(window.webDicomViewLocal.default=window.webDicomViewLocal[t])}()},1948:function(e,t,n){var o;o=e=>(()=>{"use strict";var t={578:(e,t,n)=>{const o=n(823),r=n(187),a=n(592),i=n(604),s=n(249),l=n(968),c=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:d,Z_OK:f,Z_STREAM_END:h,Z_NEED_DICT:p,Z_STREAM_ERROR:m,Z_DATA_ERROR:g,Z_MEM_ERROR:v}=n(684);function y(e){this.options=r.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let n=o.inflateInit2(this.strm,t.windowBits);if(n!==f)throw new Error(i[n]);if(this.header=new l,o.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=o.inflateSetDictionary(this.strm,t.dictionary),n!==f)))throw new Error(i[n])}y.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,l,y;if(this.ended)return!1;for(l=t===~~t?t:!0===t?d:u,"[object ArrayBuffer]"===c.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=o.inflate(n,l),s===p&&i&&(s=o.inflateSetDictionary(n,i),s===f?s=o.inflate(n,l):s===g&&(s=p));n.avail_in>0&&s===h&&n.state.wrap>0&&0!==e[n.next_in];)o.inflateReset(n),s=o.inflate(n,l);switch(s){case m:case g:case p:case v:return this.onEnd(s),this.ended=!0,!1}if(y=n.avail_out,n.next_out&&(0===n.avail_out||s===h))if("string"===this.options.to){let e=a.utf8border(n.output,n.next_out),t=n.next_out-e,o=a.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(o)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==f||0!==y){if(s===h)return s=o.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Hq=function(e,t){return(t=t||{}).raw=!0,function(e,t){const n=new y(t);if(n.push(e),n.err)throw n.msg||i[n.err];return n.result}(e,t)},n(684)},187:e=>{const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);e.exports.assign=function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const o=n.shift();if(o){if("object"!=typeof o)throw new TypeError(o+"must be non-object");for(const n in o)t(o,n)&&(e[n]=o[n])}}return e},e.exports.flattenChunks=e=>{let t=0;for(let n=0,o=e.length;n<o;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,o=0,r=e.length;t<r;t++){let r=e[t];n.set(r,o),o+=r.length}return n}},592:e=>{let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const n=new Uint8Array(256);for(let e=0;e<256;e++)n[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;n[254]=n[254]=1,e.exports.string2buf=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,o,r,a,i=e.length,s=0;for(r=0;r<i;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<i&&(o=e.charCodeAt(r+1),56320==(64512&o)&&(n=65536+(n-55296<<10)+(o-56320),r++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,r=0;a<s;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<i&&(o=e.charCodeAt(r+1),56320==(64512&o)&&(n=65536+(n-55296<<10)+(o-56320),r++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},e.exports.buf2string=(e,o)=>{const r=o||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,o));let a,i;const s=new Array(2*r);for(i=0,a=0;a<r;){let t=e[a++];if(t<128){s[i++]=t;continue}let o=n[t];if(o>4)s[i++]=65533,a+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&a<r;)t=t<<6|63&e[a++],o--;o>1?s[i++]=65533:t<65536?s[i++]=t:(t-=65536,s[i++]=55296|t>>10&1023,s[i++]=56320|1023&t)}}return((e,n)=>{if(n<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===n?e:e.subarray(0,n));let o="";for(let t=0;t<n;t++)o+=String.fromCharCode(e[t]);return o})(s,i)},e.exports.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let o=t-1;for(;o>=0&&128==(192&e[o]);)o--;return o<0||0===o?t:o+n[e[o]]>t?o:t}},693:e=>{e.exports=(e,t,n,o)=>{let r=65535&e,a=e>>>16&65535,i=0;for(;0!==n;){i=n>2e3?2e3:n,n-=i;do{r=r+t[o++]|0,a=a+r|0}while(--i);r%=65521,a%=65521}return r|a<<16}},684:e=>{e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},464:e=>{const t=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());e.exports=(e,n,o,r)=>{const a=t,i=r+o;e^=-1;for(let t=r;t<i;t++)e=e>>>8^a[255&(e^n[t])];return~e}},968:e=>{e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},365:e=>{const t=16209;e.exports=function(e,n){let o,r,a,i,s,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I,E,S,C;const A=e.state;o=e.next_in,S=e.input,r=o+(e.avail_in-5),a=e.next_out,C=e.output,i=a-(n-e.avail_out),s=a+(e.avail_out-257),l=A.dmax,c=A.wsize,u=A.whave,d=A.wnext,f=A.window,h=A.hold,p=A.bits,m=A.lencode,g=A.distcode,v=(1<<A.lenbits)-1,y=(1<<A.distbits)-1;e:do{p<15&&(h+=S[o++]<<p,p+=8,h+=S[o++]<<p,p+=8),b=m[h&v];t:for(;;){if(x=b>>>24,h>>>=x,p-=x,x=b>>>16&255,0===x)C[a++]=65535&b;else{if(!(16&x)){if(!(64&x)){b=m[(65535&b)+(h&(1<<x)-1)];continue t}if(32&x){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=t;break e}w=65535&b,x&=15,x&&(p<x&&(h+=S[o++]<<p,p+=8),w+=h&(1<<x)-1,h>>>=x,p-=x),p<15&&(h+=S[o++]<<p,p+=8,h+=S[o++]<<p,p+=8),b=g[h&y];n:for(;;){if(x=b>>>24,h>>>=x,p-=x,x=b>>>16&255,!(16&x)){if(!(64&x)){b=g[(65535&b)+(h&(1<<x)-1)];continue n}e.msg="invalid distance code",A.mode=t;break e}if(T=65535&b,x&=15,p<x&&(h+=S[o++]<<p,p+=8,p<x&&(h+=S[o++]<<p,p+=8)),T+=h&(1<<x)-1,T>l){e.msg="invalid distance too far back",A.mode=t;break e}if(h>>>=x,p-=x,x=a-i,T>x){if(x=T-x,x>u&&A.sane){e.msg="invalid distance too far back",A.mode=t;break e}if(I=0,E=f,0===d){if(I+=c-x,x<w){w-=x;do{C[a++]=f[I++]}while(--x);I=a-T,E=C}}else if(d<x){if(I+=c+d-x,x-=d,x<w){w-=x;do{C[a++]=f[I++]}while(--x);if(I=0,d<w){x=d,w-=x;do{C[a++]=f[I++]}while(--x);I=a-T,E=C}}}else if(I+=d-x,x<w){w-=x;do{C[a++]=f[I++]}while(--x);I=a-T,E=C}for(;w>2;)C[a++]=E[I++],C[a++]=E[I++],C[a++]=E[I++],w-=3;w&&(C[a++]=E[I++],w>1&&(C[a++]=E[I++]))}else{I=a-T;do{C[a++]=C[I++],C[a++]=C[I++],C[a++]=C[I++],w-=3}while(w>2);w&&(C[a++]=C[I++],w>1&&(C[a++]=C[I++]))}break}}break}}while(o<r&&a<s);w=p>>3,o-=w,p-=w<<3,h&=(1<<p)-1,e.next_in=o,e.next_out=a,e.avail_in=o<r?r-o+5:5-(o-r),e.avail_out=a<s?s-a+257:257-(a-s),A.hold=h,A.bits=p}},823:(e,t,n)=>{const o=n(693),r=n(464),a=n(365),i=n(446),{Z_FINISH:s,Z_BLOCK:l,Z_TREES:c,Z_OK:u,Z_STREAM_END:d,Z_NEED_DICT:f,Z_STREAM_ERROR:h,Z_DATA_ERROR:p,Z_MEM_ERROR:m,Z_BUF_ERROR:g,Z_DEFLATED:v}=n(684),y=16180,b=16190,x=16191,w=16192,T=16194,I=16199,E=16200,S=16206,C=16209,A=16210,M=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function P(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const D=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<y||t.mode>16211?1:0},L=e=>{if(D(e))return h;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=y,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,u},O=e=>{if(D(e))return h;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,L(e)},k=(e,t)=>{let n;if(D(e))return h;const o=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,O(e))},R=(e,t)=>{if(!e)return h;const n=new P;e.state=n,n.strm=e,n.window=null,n.mode=y;const o=k(e,t);return o!==u&&(e.state=null),o};let _,N,B=!0;const U=e=>{if(B){_=new Int32Array(512),N=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(i(1,e.lens,0,288,_,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;i(2,e.lens,0,32,N,0,e.work,{bits:5}),B=!1}e.lencode=_,e.lenbits=9,e.distcode=N,e.distbits=5},V=(e,t,n,o)=>{let r;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),o>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>o&&(r=o),a.window.set(t.subarray(n-o,n-o+r),a.wnext),(o-=r)?(a.window.set(t.subarray(n-o,n),0),a.wnext=o,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};e.exports.inflateReset=O,e.exports.inflateReset2=k,e.exports.inflateResetKeep=L,e.exports.inflateInit=e=>R(e,15),e.exports.inflateInit2=R,e.exports.inflate=(e,t)=>{let n,P,L,O,k,R,_,N,B,F,j,H,z,q,W,G,Y,Z,X,K,Q,J,$=0;const ee=new Uint8Array(4);let te,ne;const oe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(D(e)||!e.output||!e.input&&0!==e.avail_in)return h;n=e.state,n.mode===x&&(n.mode=w),k=e.next_out,L=e.output,_=e.avail_out,O=e.next_in,P=e.input,R=e.avail_in,N=n.hold,B=n.bits,F=R,j=_,J=u;e:for(;;)switch(n.mode){case y:if(0===n.wrap){n.mode=w;break}for(;B<16;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(2&n.wrap&&35615===N){0===n.wbits&&(n.wbits=15),n.check=0,ee[0]=255&N,ee[1]=N>>>8&255,n.check=r(n.check,ee,2,0),N=0,B=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&N)<<8)+(N>>8))%31){e.msg="incorrect header check",n.mode=C;break}if((15&N)!==v){e.msg="unknown compression method",n.mode=C;break}if(N>>>=4,B-=4,Q=8+(15&N),0===n.wbits&&(n.wbits=Q),Q>15||Q>n.wbits){e.msg="invalid window size",n.mode=C;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&N?16189:x,N=0,B=0;break;case 16181:for(;B<16;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(n.flags=N,(255&n.flags)!==v){e.msg="unknown compression method",n.mode=C;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=C;break}n.head&&(n.head.text=N>>8&1),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,n.check=r(n.check,ee,2,0)),N=0,B=0,n.mode=16182;case 16182:for(;B<32;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}n.head&&(n.head.time=N),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,ee[2]=N>>>16&255,ee[3]=N>>>24&255,n.check=r(n.check,ee,4,0)),N=0,B=0,n.mode=16183;case 16183:for(;B<16;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}n.head&&(n.head.xflags=255&N,n.head.os=N>>8),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,n.check=r(n.check,ee,2,0)),N=0,B=0,n.mode=16184;case 16184:if(1024&n.flags){for(;B<16;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}n.length=N,n.head&&(n.head.extra_len=N),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,n.check=r(n.check,ee,2,0)),N=0,B=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(H=n.length,H>R&&(H=R),H&&(n.head&&(Q=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(P.subarray(O,O+H),Q)),512&n.flags&&4&n.wrap&&(n.check=r(n.check,P,H,O)),R-=H,O+=H,n.length-=H),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===R)break e;H=0;do{Q=P[O+H++],n.head&&Q&&n.length<65536&&(n.head.name+=String.fromCharCode(Q))}while(Q&&H<R);if(512&n.flags&&4&n.wrap&&(n.check=r(n.check,P,H,O)),R-=H,O+=H,Q)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===R)break e;H=0;do{Q=P[O+H++],n.head&&Q&&n.length<65536&&(n.head.comment+=String.fromCharCode(Q))}while(Q&&H<R);if(512&n.flags&&4&n.wrap&&(n.check=r(n.check,P,H,O)),R-=H,O+=H,Q)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;B<16;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(4&n.wrap&&N!==(65535&n.check)){e.msg="header crc mismatch",n.mode=C;break}N=0,B=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=x;break;case 16189:for(;B<32;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}e.adler=n.check=M(N),N=0,B=0,n.mode=b;case b:if(0===n.havedict)return e.next_out=k,e.avail_out=_,e.next_in=O,e.avail_in=R,n.hold=N,n.bits=B,f;e.adler=n.check=1,n.mode=x;case x:if(t===l||t===c)break e;case w:if(n.last){N>>>=7&B,B-=7&B,n.mode=S;break}for(;B<3;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}switch(n.last=1&N,N>>>=1,B-=1,3&N){case 0:n.mode=16193;break;case 1:if(U(n),n.mode=I,t===c){N>>>=2,B-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=C}N>>>=2,B-=2;break;case 16193:for(N>>>=7&B,B-=7&B;B<32;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if((65535&N)!=(N>>>16^65535)){e.msg="invalid stored block lengths",n.mode=C;break}if(n.length=65535&N,N=0,B=0,n.mode=T,t===c)break e;case T:n.mode=16195;case 16195:if(H=n.length,H){if(H>R&&(H=R),H>_&&(H=_),0===H)break e;L.set(P.subarray(O,O+H),k),R-=H,O+=H,_-=H,k+=H,n.length-=H;break}n.mode=x;break;case 16196:for(;B<14;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(n.nlen=257+(31&N),N>>>=5,B-=5,n.ndist=1+(31&N),N>>>=5,B-=5,n.ncode=4+(15&N),N>>>=4,B-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=C;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;B<3;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}n.lens[oe[n.have++]]=7&N,N>>>=3,B-=3}for(;n.have<19;)n.lens[oe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,te={bits:n.lenbits},J=i(0,n.lens,0,19,n.lencode,0,n.work,te),n.lenbits=te.bits,J){e.msg="invalid code lengths set",n.mode=C;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;$=n.lencode[N&(1<<n.lenbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=B);){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(Y<16)N>>>=W,B-=W,n.lens[n.have++]=Y;else{if(16===Y){for(ne=W+2;B<ne;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(N>>>=W,B-=W,0===n.have){e.msg="invalid bit length repeat",n.mode=C;break}Q=n.lens[n.have-1],H=3+(3&N),N>>>=2,B-=2}else if(17===Y){for(ne=W+3;B<ne;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}N>>>=W,B-=W,Q=0,H=3+(7&N),N>>>=3,B-=3}else{for(ne=W+7;B<ne;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}N>>>=W,B-=W,Q=0,H=11+(127&N),N>>>=7,B-=7}if(n.have+H>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=C;break}for(;H--;)n.lens[n.have++]=Q}}if(n.mode===C)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=C;break}if(n.lenbits=9,te={bits:n.lenbits},J=i(1,n.lens,0,n.nlen,n.lencode,0,n.work,te),n.lenbits=te.bits,J){e.msg="invalid literal/lengths set",n.mode=C;break}if(n.distbits=6,n.distcode=n.distdyn,te={bits:n.distbits},J=i(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,te),n.distbits=te.bits,J){e.msg="invalid distances set",n.mode=C;break}if(n.mode=I,t===c)break e;case I:n.mode=E;case E:if(R>=6&&_>=258){e.next_out=k,e.avail_out=_,e.next_in=O,e.avail_in=R,n.hold=N,n.bits=B,a(e,j),k=e.next_out,L=e.output,_=e.avail_out,O=e.next_in,P=e.input,R=e.avail_in,N=n.hold,B=n.bits,n.mode===x&&(n.back=-1);break}for(n.back=0;$=n.lencode[N&(1<<n.lenbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=B);){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(G&&!(240&G)){for(Z=W,X=G,K=Y;$=n.lencode[K+((N&(1<<Z+X)-1)>>Z)],W=$>>>24,G=$>>>16&255,Y=65535&$,!(Z+W<=B);){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}N>>>=Z,B-=Z,n.back+=Z}if(N>>>=W,B-=W,n.back+=W,n.length=Y,0===G){n.mode=16205;break}if(32&G){n.back=-1,n.mode=x;break}if(64&G){e.msg="invalid literal/length code",n.mode=C;break}n.extra=15&G,n.mode=16201;case 16201:if(n.extra){for(ne=n.extra;B<ne;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}n.length+=N&(1<<n.extra)-1,N>>>=n.extra,B-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;$=n.distcode[N&(1<<n.distbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=B);){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(!(240&G)){for(Z=W,X=G,K=Y;$=n.distcode[K+((N&(1<<Z+X)-1)>>Z)],W=$>>>24,G=$>>>16&255,Y=65535&$,!(Z+W<=B);){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}N>>>=Z,B-=Z,n.back+=Z}if(N>>>=W,B-=W,n.back+=W,64&G){e.msg="invalid distance code",n.mode=C;break}n.offset=Y,n.extra=15&G,n.mode=16203;case 16203:if(n.extra){for(ne=n.extra;B<ne;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}n.offset+=N&(1<<n.extra)-1,N>>>=n.extra,B-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=C;break}n.mode=16204;case 16204:if(0===_)break e;if(H=j-_,n.offset>H){if(H=n.offset-H,H>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=C;break}H>n.wnext?(H-=n.wnext,z=n.wsize-H):z=n.wnext-H,H>n.length&&(H=n.length),q=n.window}else q=L,z=k-n.offset,H=n.length;H>_&&(H=_),_-=H,n.length-=H;do{L[k++]=q[z++]}while(--H);0===n.length&&(n.mode=E);break;case 16205:if(0===_)break e;L[k++]=n.length,_--,n.mode=E;break;case S:if(n.wrap){for(;B<32;){if(0===R)break e;R--,N|=P[O++]<<B,B+=8}if(j-=_,e.total_out+=j,n.total+=j,4&n.wrap&&j&&(e.adler=n.check=n.flags?r(n.check,L,j,k-j):o(n.check,L,j,k-j)),j=_,4&n.wrap&&(n.flags?N:M(N))!==n.check){e.msg="incorrect data check",n.mode=C;break}N=0,B=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;B<32;){if(0===R)break e;R--,N+=P[O++]<<B,B+=8}if(4&n.wrap&&N!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=C;break}N=0,B=0}n.mode=16208;case 16208:J=d;break e;case C:J=p;break e;case A:return m;default:return h}return e.next_out=k,e.avail_out=_,e.next_in=O,e.avail_in=R,n.hold=N,n.bits=B,(n.wsize||j!==e.avail_out&&n.mode<C&&(n.mode<S||t!==s))&&V(e,e.output,e.next_out,j-e.avail_out)?(n.mode=A,m):(F-=e.avail_in,j-=e.avail_out,e.total_in+=F,e.total_out+=j,n.total+=j,4&n.wrap&&j&&(e.adler=n.check=n.flags?r(n.check,L,j,e.next_out-j):o(n.check,L,j,e.next_out-j)),e.data_type=n.bits+(n.last?64:0)+(n.mode===x?128:0)+(n.mode===I||n.mode===T?256:0),(0===F&&0===j||t===s)&&J===u&&(J=g),J)},e.exports.inflateEnd=e=>{if(D(e))return h;let t=e.state;return t.window&&(t.window=null),e.state=null,u},e.exports.inflateGetHeader=(e,t)=>{if(D(e))return h;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,u):h},e.exports.inflateSetDictionary=(e,t)=>{const n=t.length;let r,a,i;return D(e)?h:(r=e.state,0!==r.wrap&&r.mode!==b?h:r.mode===b&&(a=1,a=o(a,t,n,0),a!==r.check)?p:(i=V(e,t,n,n),i?(r.mode=A,m):(r.havedict=1,u)))},e.exports.inflateInfo="pako inflate (from Nodeca project)"},446:e=>{const t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),o=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),r=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,a,i,s,l,c,u,d)=>{const f=d.bits;let h,p,m,g,v,y,b=0,x=0,w=0,T=0,I=0,E=0,S=0,C=0,A=0,M=0,P=null;const D=new Uint16Array(16),L=new Uint16Array(16);let O,k,R,_=null;for(b=0;b<=15;b++)D[b]=0;for(x=0;x<s;x++)D[a[i+x]]++;for(I=f,T=15;T>=1&&0===D[T];T--);if(I>T&&(I=T),0===T)return l[c++]=20971520,l[c++]=20971520,d.bits=1,0;for(w=1;w<T&&0===D[w];w++);for(I<w&&(I=w),C=1,b=1;b<=15;b++)if(C<<=1,C-=D[b],C<0)return-1;if(C>0&&(0===e||1!==T))return-1;for(L[1]=0,b=1;b<15;b++)L[b+1]=L[b]+D[b];for(x=0;x<s;x++)0!==a[i+x]&&(u[L[a[i+x]]++]=x);if(0===e?(P=_=u,y=20):1===e?(P=t,_=n,y=257):(P=o,_=r,y=0),M=0,x=0,b=w,v=c,E=I,S=0,m=-1,A=1<<I,g=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){O=b-S,u[x]+1<y?(k=0,R=u[x]):u[x]>=y?(k=_[u[x]-y],R=P[u[x]-y]):(k=96,R=0),h=1<<b-S,p=1<<E,w=p;do{p-=h,l[v+(M>>S)+p]=O<<24|k<<16|R}while(0!==p);for(h=1<<b-1;M&h;)h>>=1;if(0!==h?(M&=h-1,M+=h):M=0,x++,0==--D[b]){if(b===T)break;b=a[i+u[x]]}if(b>I&&(M&g)!==m){for(0===S&&(S=I),v+=w,E=b-S,C=1<<E;E+S<T&&(C-=D[E+S],!(C<=0));)E++,C<<=1;if(A+=1<<E,1===e&&A>852||2===e&&A>592)return 1;m=M&g,l[m]=I<<24|E<<16|v-c}}return 0!==M&&(l[v+M]=b-S<<24|64<<16),d.bits=I,0}},604:e=>{e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},249:e=>{e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},713:t=>{t.exports=e}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&!e;)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})();var r={};return(()=>{function e(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");const o=e.length/3;let r=0,a=0;if(n)for(let n=0;n<o;n++)t[a++]=e[r++],t[a++]=e[r++],t[a++]=e[r++],t[a++]=255;else t.set(e)}function t(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");const o=e.length/3;let r=0,a=0,i=o,s=2*o;if(n)for(let n=0;n<o;n++)t[r++]=e[a++],t[r++]=e[i++],t[r++]=e[s++],t[r++]=255;else for(let n=0;n<o;n++)t[r++]=e[a++],t[r++]=e[i++],t[r++]=e[s++]}function n(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const o=e.length/3;let r=0,a=0;if(n)for(let n=0;n<o;n++){const n=e[r++],o=e[r++],i=e[r++];t[a++]=n+1.402*(i-128),t[a++]=n-.34414*(o-128)-.71414*(i-128),t[a++]=n+1.772*(o-128),t[a++]=255}else for(let n=0;n<o;n++){const n=e[r++],o=e[r++],i=e[r++];t[a++]=n+1.402*(i-128),t[a++]=n-.34414*(o-128)-.71414*(i-128),t[a++]=n+1.772*(o-128)}}function a(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const o=e.length/3;let r=0,a=0,i=o,s=2*o;if(n)for(let n=0;n<o;n++){const n=e[a++],o=e[i++],l=e[s++];t[r++]=n+1.402*(l-128),t[r++]=n-.34414*(o-128)-.71414*(l-128),t[r++]=n+1.772*(o-128),t[r++]=255}else for(let n=0;n<o;n++){const n=e[a++],o=e[i++],l=e[s++];t[r++]=n+1.402*(l-128),t[r++]=n-.34414*(o-128)-.71414*(l-128),t[r++]=n+1.772*(o-128)}}o.r(r),o.d(r,{configure:()=>Je,convertColorSpace:()=>U,convertPALETTECOLOR:()=>Qe,convertRGBColorByPixel:()=>e,convertRGBColorByPlane:()=>t,convertYBRFullByPixel:()=>n,convertYBRFullByPlane:()=>a,createImage:()=>ie,decodeImageFrame:()=>te,decodeJPEGBaseline8BitColor:()=>V,default:()=>et,external:()=>Xe,getImageFrame:()=>ne,getMinMax:()=>N,getPixelData:()=>_,internal:()=>k,isColorImage:()=>oe,isJPEGBaseline8BitColor:()=>$e,wadors:()=>le,wadouri:()=>qe,webWorkerManager:()=>J});const i=function(e,t,n){return t=t||0,e&&e.Value?e.Value.length<=t?n:e.Value[t]:n},s=function(e,t){const n=i(e,t);if(void 0!==n)return parseFloat(n)},l=function(e,t){if(!e)return;if(!e.Value)return;if(!Array.isArray(e.Value))return;if(t&&e.Value.length<t)return;const n=[];for(let t=0;t<e.Value.length;t++)n.push(parseFloat(e.Value[t]));return n};function c(e){const t=e.indexOf(":");return e.substring(t+1)}function u(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&e.Value?e.Value[0]&&t?e.Value[0]:e.Value:e}function d(e,t,n){return{shared:(t?Object.values(t[0]):[]).map((e=>e[0])).filter((e=>void 0!==e&&"object"==typeof e)),perFrame:(e?Object.values(e[n-1]):[]).map((e=>e.Value[0])).filter((e=>void 0!==e&&"object"==typeof e))}}function f(e){let{52009230:t,52009229:n,"00280008":o,...r}=e;return t=u(t,!1),n=u(n,!1),o=u(o),{PerFrameFunctionalGroupsSequence:t,SharedFunctionalGroupsSequence:n,NumberOfFrames:o,rest:r}}function h(e){const t=e.indexOf("/frames/")+8,n=e.slice(0,t),o=parseInt(e.slice(t),10);return{metadata:m[`${n}1`],frame:o}}const p={_retrieveMultiframeMetadata:h,retrieveMultiframeMetadata:function(e){return h(c(e))},isMultiframe:function(e){const t=i(e["00280008"]);return t&&t>1}};let m=[],g={};const v={add:function(e,t){const n=c(e);t.isMultiframe=p.isMultiframe(t),m[n]=t},get:function(e){const t=c(e),n=m[t];if(n&&!n?.isMultiframe)return n;const o=g[t];if(o)return o;const r=p._retrieveMultiframeMetadata(t);if(!r||!r.metadata)return;const{metadata:a,frame:i}=r;if(a){const e=function(e,t){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:o,NumberOfFrames:r,rest:a}=f(t);if(n||r>1){const{shared:i,perFrame:s}=d(n,o,e),l=Object.assign(t,{frameNumber:e});return[...i,...s].forEach((e=>{Object.entries(e).forEach((e=>{let[t,n]=e;l[t]=n}))})),Object.assign(a,{"00280008":r},l)}return t}(i,a);return g[t]=e,e}},remove:function(e){const t=c(e);m[t]=void 0,g[t]=void 0},purge:function(){m=[],g={}}};function y(e){return"RECON TOMO"===e||"RECON GATED TOMO"===e}function b(e){return i(e["00080060"]).includes("NM")}function x(e,t){const n=u(e["00080008"],!1);if(n)return n[t]}function w(e){let t=l(e["00200037"],6);return!t&&b(e)&&(t=function(e){let t;const n=x(e,2);if(n&&y(n)){const n=u(e["00540022"]);n&&(t=l(n["00200037"],6))}return t}(e)),t}function T(e){let t=l(e["00200032"],3);return!t&&b(e)&&(t=function(e){let t;const n=x(e,2);if(n&&y(n)){const n=u(e["00540022"]);n&&(t=l(n["00200032"],3))}return t}(e)),t}function I(e,t,n){const o={};for(const r of n)try{const n=t(r,e);if(n){const e={};for(const t in n)t in n&&(e[E(t)]=n[t]);Object.assign(o,e)}}catch(e){console.error(`Error retrieving ${r} data:`,e)}return o}const E=e=>e.charAt(0).toUpperCase()+e.slice(1),S=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"],C=function e(t,n){if("multiframeModule"===t){const{metadata:e,frame:t}=p.retrieveMultiframeMetadata(n);if(!e)return;const{PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:r,NumberOfFrames:a}=f(e);if(o||a>1){const{shared:e,perFrame:n}=d(o,r,t);return{NumberOfFrames:a,PerFrameFunctionalInformation:n,SharedFunctionalInformation:e}}return{NumberOfFrames:a}}const{dicomParser:o}=Xe,r=v.get(n);if(r){if("generalSeriesModule"===t)return{modality:i(r["00080060"]),seriesInstanceUID:i(r["0020000E"]),seriesNumber:s(r["00200011"]),studyInstanceUID:i(r["0020000D"]),seriesDate:o.parseDA(i(r["00080021"])),seriesTime:o.parseTM(i(r["00080031"],0,"")),acquisitionDate:o.parseDA(i(r["00080022"]),""),acquisitionTime:o.parseTM(i(r["00080032"],0,""))};if("patientStudyModule"===t)return{patientAge:s(r["00101010"]),patientSize:s(r["00101020"]),patientSex:i(r["00100040"]),patientWeight:s(r["00101030"])};if("nmMultiframeGeometryModule"===t){const e=i(r["00080060"]),t=x(r,2);return{modality:e,imageType:i(r["00080008"]),imageSubType:t,imageOrientationPatient:w(r),imagePositionPatient:T(r),sliceThickness:s(r["00180050"]),pixelSpacing:l(r["00280030"],2),numberOfFrames:s(r["00280008"]),isNMReconstructable:y(t)&&e.includes("NM")}}if("imagePlaneModule"===t){const e=w(r),t=T(r),n=l(r["00280030"],2);let o=null,a=null;n&&(a=n[0],o=n[1]);let c=null,u=null;return e&&(c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])],u=[parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[5])]),{frameOfReferenceUID:i(r["00200052"]),rows:s(r["00280010"]),columns:s(r["00280011"]),imageOrientationPatient:e,rowCosines:c,columnCosines:u,imagePositionPatient:t,sliceThickness:s(r["00180050"]),sliceLocation:s(r["00201041"]),pixelSpacing:n,rowPixelSpacing:a,columnPixelSpacing:o}}if("imagePixelModule"===t)return{samplesPerPixel:s(r["00280002"]),photometricInterpretation:i(r["00280004"]),rows:s(r["00280010"]),columns:s(r["00280011"]),bitsAllocated:s(r["00280100"]),bitsStored:s(r["00280101"]),highBit:i(r["00280102"]),pixelRepresentation:s(r["00280103"]),planarConfiguration:s(r["00280006"]),pixelAspectRatio:i(r["00280034"]),smallestPixelValue:s(r["00280106"]),largestPixelValue:s(r["00280107"]),redPaletteColorLookupTableDescriptor:l(r["00281101"]),greenPaletteColorLookupTableDescriptor:l(r["00281102"]),bluePaletteColorLookupTableDescriptor:l(r["00281103"]),redPaletteColorLookupTableData:l(r["00281201"]),greenPaletteColorLookupTableData:l(r["00281202"]),bluePaletteColorLookupTableData:l(r["00281203"])};if("voiLutModule"===t)return{windowCenter:l(r["00281050"],1),windowWidth:l(r["00281051"],1)};if("modalityLutModule"===t)return{rescaleIntercept:s(r["00281052"]),rescaleSlope:s(r["00281053"]),rescaleType:i(r["00281054"])};if("sopCommonModule"===t)return{sopClassUID:i(r["00080016"]),sopInstanceUID:i(r["00080018"])};if("petIsotopeModule"===t){const e=i(r["00540016"]);if(void 0===e)return;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:o.parseTM(i(e["00181072"],0,"")),radiopharmaceuticalStartDateTime:i(e["00181078"],0,""),radionuclideTotalDose:s(e["00181074"]),radionuclideHalfLife:s(e["00181075"])}}}return"overlayPlaneModule"===t?function(e){const t=[];for(let n=0;n<=30;n+=2){let o=`x60${n.toString(16)}`;4===o.length&&(o=`x600${n.toString(16)}`);const r=i(e[`${o}3000`]);if(!r)continue;const a=[];for(let t=0;t<r.length;t++)for(let n=0;n<8;n++){const o=e.Value[r.dataOffset+t];a[8*t+n]=o>>n&1}t.push({rows:s(e[`${o}0010`]),columns:s(e[`${o}0011`]),type:i(e[`${o}0040`]),x:s(e[`${o}0050`],1)-1,y:s(e[`${o}0050`],0)-1,pixelData:a,description:i(e[`${o}0022`]),label:i(e[`${o}1500`]),roiArea:i(e[`${o}1301`]),roiMean:i(e[`${o}1302`]),roiStandardDeviation:i(e[`${o}1303`])})}return{overlays:t}}(r):"transferSyntax"===t?{transferSyntaxUID:i(r["00020010"])}:"petSeriesModule"===t?{correctedImage:i(r["00280051"]),units:i(r["00541001"]),decayCorrection:i(r["00541102"])}:"petImageModule"===t?{frameReferenceTime:s(r["00541300"]),actualFrameDuration:s(r["00181242"])}:"instance"===t?I(n,e,S):void 0}};function A(e,t,n){if(n+e.length>t.length)return!1;let o=n;for(let n=0;n<e.length;n++)if(e[n]!==t[o++])return!1;return!0}const M=function(e,t,n){n=n||0;const o=function(e){const t=new Uint8Array(e.length);for(let n=0,o=e.length;n<o;n++)t[n]=e.charCodeAt(n);return t}(t);for(let t=n;t<e.length;t++)if(o[0]===e[t]&&A(o,e,t))return t;return-1};let P={open(e,t){e.open("get",t,!0)},beforeSend(){},beforeProcessing:e=>Promise.resolve(e.response),imageCreated(){},strict:!1,decodeConfig:{convertFloatPixelDataToInt:!0,use16BitDataType:!1}};function D(e){P=Object.assign(P,e)}function L(){return P}const O=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{cornerstone:r}=Xe,a=L(),i=e=>{if("function"==typeof a.errorInterceptor){const t=new Error("request failed");t.request=e,t.response=e.response,t.status=e.status,a.errorInterceptor(t)}},s=new XMLHttpRequest,l=new Promise(((l,c)=>{a.open(s,e,n,o);const u=a.beforeSend(s,t,n,o);s.responseType="arraybuffer";const d=Object.assign({},n,u);Object.keys(d).forEach((function(t){null!==d[t]&&("Accept"===t&&-1!==e.indexOf("accept=")||s.setRequestHeader(t,d[t]))})),o.deferred={resolve:l,reject:c},o.url=e,o.imageId=t,s.onloadstart=function(n){a.onloadstart&&a.onloadstart(n,o);const i={url:e,imageId:t};r.triggerEvent(r.events,"cornerstoneimageloadstart",i)},s.onloadend=function(n){a.onloadend&&a.onloadend(n,o);const i={url:e,imageId:t};r.triggerEvent(r.events,"cornerstoneimageloadend",i)},s.onreadystatechange=function(e){a.onreadystatechange?a.onreadystatechange(e,o):4===s.readyState&&(200===s.status?a.beforeProcessing(s).then(l).catch((()=>{i(s),c(s)})):(i(s),c(s)))},s.onprogress=function(e){const t=e.loaded;let n,r;e.lengthComputable&&(n=e.total,r=Math.round(t/n*100)),a.onprogress&&a.onprogress(e,o)},s.onerror=function(){i(s),c(s)},s.onabort=function(){i(s),c(s)},s.send()}));return l.xhr=s,l},k={xhrRequest:O,setOptions:D,getOptions:L};function R(e){for(let t=0;t<e.length;t++)if("Content-Type:"===e[t].substr(0,13))return e[t].substr(13).trim()}const _=function(e,t){const n={Accept:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream"};return new Promise(((o,r)=>{const a=O(e,t,n),{xhr:i}=a;a.then((function(e){const t=new Uint8Array(e),n=i.getResponseHeader("Content-Type")||"application/octet-stream";if(-1===n.indexOf("multipart"))return void o({contentType:n,imageFrame:{pixelData:t}});const a=M(t,"\r\n\r\n");-1===a&&r(new Error("invalid response - no multipart mime header"));const s=function(e,t,n){t=t||0,n=n||e.length-t;let o="";for(let r=t;r<t+n;r++)o+=String.fromCharCode(e[r]);return o}(t,0,a),l=s.split("\r\n"),c=function(e){for(let t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}(l);c||r(new Error("invalid response - no boundary marker"));const u=a+4,d=M(t,c,u);-1===d&&r(new Error("invalid response - terminating boundary not found"));const f=d-u-2;o({contentType:R(l),imageFrame:{pixelData:new Uint8Array(e,u,f)}})}),r)}))},N=function(e){let t,n=e[0],o=e[0];const r=e.length;for(let a=1;a<r;a++)t=e[a],n=Math.min(n,t),o=Math.max(o,t);return{min:n,max:o}};function B(n,o,r){0===n.planarConfiguration?e(n.pixelData,o,r):t(n.pixelData,o,r)}function U(e,t,o){if("RGB"===e.photometricInterpretation)B(e,t,o);else if("YBR_RCT"===e.photometricInterpretation)B(e,t,o);else if("YBR_ICT"===e.photometricInterpretation)B(e,t,o);else if("PALETTE COLOR"===e.photometricInterpretation)Qe(e,t,o);else if("YBR_FULL_422"===e.photometricInterpretation)!function(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%2!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const o=e.length/2;let r=0,a=0;if(n)for(let n=0;n<o;n+=2){const n=e[r++],o=e[r++],i=e[r++],s=e[r++];t[a++]=n+1.402*(s-128),t[a++]=n-.34414*(i-128)-.71414*(s-128),t[a++]=n+1.772*(i-128),t[a++]=255,t[a++]=o+1.402*(s-128),t[a++]=o-.34414*(i-128)-.71414*(s-128),t[a++]=o+1.772*(i-128),t[a++]=255}else for(let n=0;n<o;n+=2){const n=e[r++],o=e[r++],i=e[r++],s=e[r++];t[a++]=n+1.402*(s-128),t[a++]=n-.34414*(i-128)-.71414*(s-128),t[a++]=n+1.772*(i-128),t[a++]=o+1.402*(s-128),t[a++]=o-.34414*(i-128)-.71414*(s-128),t[a++]=o+1.772*(i-128)}}(e.pixelData,t,o);else{if("YBR_FULL"!==e.photometricInterpretation)throw new Error(`No color space conversion for photometric interpretation ${e.photometricInterpretation}`);!function(e,t,o){0===e.planarConfiguration?n(e.pixelData,t,o):a(e.pixelData,t,o)}(e,t,o)}}const V=function(e,t,n){const o=(new Date).getTime(),r=new Blob([t],{type:"image/jpeg"});return new Promise(((t,a)=>{const i=new FileReader;void 0===i.readAsBinaryString?i.readAsArrayBuffer(r):i.readAsBinaryString(r),i.onload=function(){const r=new Image;r.onload=function(){n.height=r.height,n.width=r.width,e.rows=r.height,e.columns=r.width;const a=n.getContext("2d");a.drawImage(this,0,0);const i=a.getImageData(0,0,r.width,r.height),s=(new Date).getTime();e.pixelData=new Uint8Array(i.data.buffer),e.imageData=i,e.decodeTimeInMS=s-o;const l=N(e.pixelData);e.smallestPixelValue=l.min,e.largestPixelValue=l.max,e.pixelDataLength=e.pixelData.length,t(e)},r.onerror=function(e){a(e)},void 0===i.readAsBinaryString?r.src=`data:image/jpeg;base64,${window.btoa(function(e){return function(e){let t;try{return decodeURIComponent(escape(e))}catch(n){if(t=n,t instanceof URIError)return e;throw t}}(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}(i.result))}`:r.src=`data:image/jpeg;base64,${window.btoa(i.result)}`},i.onerror=e=>{a(e)}}))};function F(){return new Worker(o.p+"index.worker.e62ecca63f1a2e124230.worker.js")}let j=0;const H=[],z=[],q=L(),W={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!1,strict:q.strict}}};let G;const Y={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};function Z(){if(H.length){for(let e=0;e<z.length;e++)if("ready"===z[e].status){z[e].status="busy";const t=H.shift();t.start=(new Date).getTime();const n=(new Date).getTime();return Y.totalTimeDelayedInMS+=n-t.added,z[e].task=t,z[e].worker.postMessage({taskType:t.taskType,workerIndex:e,data:t.data},t.transferList),void Y.numTasksExecuting++}z.length<G.maxWebWorkers&&K()}}function X(e){if("initialize"===e.data.taskType)z[e.data.workerIndex].status="ready",Z();else{const t=z[e.data.workerIndex].task.start,n="success"===e.data.status?"resolve":"reject";try{z[e.data.workerIndex].task.deferred[n](e.data.result)}catch(e){console.warn("Caught error delivering response",e)}z[e.data.workerIndex].task=void 0,Y.numTasksExecuting--,z[e.data.workerIndex].status="ready",Y.numTasksCompleted++;const o=(new Date).getTime();Y.totalTaskTimeInMS+=o-t,Z()}}function K(){if(z.length>=G.maxWebWorkers)return;const e=new F;z.push({worker:e,status:"initializing"}),e.addEventListener("message",X),e.postMessage({taskType:"initialize",workerIndex:z.length-1,config:G})}function Q(e){if(G=e=e||W,G.maxWebWorkers=G.maxWebWorkers||navigator.hardwareConcurrency||1,!G.startWebWorkersOnDemand)for(let e=0;e<G.maxWebWorkers;e++)K()}const J={initialize:Q,loadWebWorkerTask:function(e,t){G.webWorkerTaskPaths.push(e),t&&(G.taskConfiguration=Object.assign(G.taskConfiguration,t));for(let t=0;t<z.length;t++)z[t].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:z.length-1,sourcePath:e,config:G})},addTask:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;G||Q();let r={resolve:void 0,reject:void 0};const a=new Promise(((e,t)=>{r={resolve:e,reject:t}}));let i;for(i=0;i<H.length&&!(H[i].priority<n);i++);const s=j++;return H.splice(i,0,{taskId:s,taskType:e,status:"ready",added:(new Date).getTime(),data:t,deferred:r,priority:n,transferList:o}),Z(),{taskId:s,promise:a}},getStatistics:function(){return Y.maxWebWorkers=G.maxWebWorkers,Y.numWebWorkers=z.length,Y.numTasksQueued=H.length,Y},setTaskPriority:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<H.length;n++)if(H[n].taskId===e){const e=H.splice(n,1)[0];for(e.priority=t,n=0;n<H.length&&!(H[n].priority<t);n++);return H.splice(n,0,e),!0}return!1},cancelTask:function(e,t){for(let n=0;n<H.length;n++)if(H[n].taskId===e)return H.splice(n,1).deferred.reject(t),!0;return!1},webWorkers:z,terminate:function(){for(let e=0;e<z.length;e++)z[e].worker.terminate();z.length=0,G=void 0}};var $=o(578);function ee(e,t,n,o,r){const a=o.priority||void 0,i=o.transferPixelData?[n.buffer]:void 0;return J.addTask("decodeTask",{imageFrame:e,transferSyntax:t,pixelData:n,options:o,decodeConfig:r},a,i).promise}window.pako={inflateRaw:$.Hq};const te=function(e,t,n,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0;switch(t){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":case"1.2.840.10008.1.2.2":case"1.2.840.10008.1.2.1.99":case"1.2.840.10008.1.2.5":case"1.2.840.10008.1.2.4.51":case"1.2.840.10008.1.2.4.57":case"1.2.840.10008.1.2.4.70":case"1.2.840.10008.1.2.4.80":case"1.2.840.10008.1.2.4.81":case"1.2.840.10008.1.2.4.90":case"1.2.840.10008.1.2.4.91":case"3.2.840.10008.1.2.4.96":return ee(e,t,n,r,a);case"1.2.840.10008.1.2.4.50":return 8!==e.bitsAllocated||3!==e.samplesPerPixel&&4!==e.samplesPerPixel?ee(e,t,n,r,a):V(e,n,o)}return Promise.reject(new Error(`No decoder for transfer syntax ${t}`))},ne=function(e){const{cornerstone:t}=Xe,n=t.metaData.get("imagePixelModule",e);return{samplesPerPixel:n.samplesPerPixel,photometricInterpretation:n.photometricInterpretation,planarConfiguration:n.planarConfiguration,rows:n.rows,columns:n.columns,bitsAllocated:n.bitsAllocated,bitsStored:n.bitsStored,pixelRepresentation:n.pixelRepresentation,smallestPixelValue:n.smallestPixelValue,largestPixelValue:n.largestPixelValue,redPaletteColorLookupTableDescriptor:n.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:n.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:n.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:n.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:n.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:n.bluePaletteColorLookupTableData,pixelData:void 0,imageId:e}};function oe(e){return"RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e}const re={"1.2.840.10008.1.2.1":"application/octet-stream","1.2.840.10008.1.2":"application/octet-stream","1.2.840.10008.1.2.2":"application/octet-stream","1.2.840.10008.1.2.5":"image/dicom-rle"};let ae="";const ie=function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=o.useRGBA;if(o.preScale={enabled:!(!o.preScale||void 0===o.preScale.enabled)&&o.preScale.enabled},!t||!t.length)return Promise.reject(new Error("The file does not contain image data."));const{cornerstone:a}=Xe,i=document.createElement("canvas"),s=ne(e);if(o.preScale.enabled){const t=function(e,t){const n=e.get("modalityLutModule",t)||{},o=e.get("generalSeriesModule",t)||{},{modality:r}=o,a={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:r},i=e.get("scalingModule",t)||{};return{...a,..."PT"===r&&{suvbw:i.suvbw}}}(a.metaData,e);t&&(o.preScale={...o.preScale,scalingParameters:t})}o.isSharedArrayBuffer=o.targetBuffer?.arrayBuffer&&o.targetBuffer.arrayBuffer instanceof SharedArrayBuffer;const{decodeConfig:l}=L(),c=te(s,n,t,i,o,l),{use16BitDataType:u}=l,d=oe(s.photometricInterpretation);return new Promise(((t,s)=>{c.then((function(s){if(o.skipCreateImage)return t(s);let l=!1;if(o.targetBuffer&&o.targetBuffer.type&&!d){const{arrayBuffer:e,type:t,offset:n=0,length:r}=o.targetBuffer,a=s.pixelDataLength,i=n,c=null!=r?r:a-i,d={Uint8Array,Uint16Array:u?Uint16Array:void 0,Int16Array:u?Int16Array:void 0,Float32Array};if(c!==s.pixelDataLength)throw new Error(`target array for image does not have the same length (${c}) as the decoded image length (${s.pixelDataLength}).`);const f=d[t],h=e?new f(e,i,c):new f(s.pixelData);if(c!==s.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");s.pixelData=h,l=!0}l||function(e){const t=function(e,t){let n;return Number.isInteger(e)&&Number.isInteger(t)?e>=0?t<=255?n=Uint8Array:t<=65535&&(n=Uint16Array):e>=-128&&t<=127?n=Int8Array:e>=-32768&&t<=32767&&(n=Int16Array):n=Float32Array,n}(e.smallestPixelValue,e.largestPixelValue);if(!t)throw new Error("Could not apply a typed array to the pixel data");{const n=new t(e.pixelData);e.pixelData=n}}(s);const c=a.metaData.get("imagePlaneModule",e)||{},f=a.metaData.get("voiLutModule",e)||{},h=a.metaData.get("modalityLutModule",e)||{},p=a.metaData.get("sopCommonModule",e)||{};if(d){const{rows:e,columns:t}=s;if(re[n]){i.height=s.rows,i.width=s.columns;const e=i.getContext("2d").createImageData(s.columns,s.rows);U(s,e.data,r),s.imageData=e,s.pixelData=e.data,s.pixelDataLength=e.data.length}else if(!r&&s.pixelDataLength===4*e*t){const e=new Uint8Array(s.pixelData.length/4*3);s.pixelData=function(e,t){const n=e.length/4;let o=0,r=0;for(let a=0;a<n;a++)t[r++]=e[o++],t[r++]=e[o++],t[r++]=e[o++],o++;return t}(s.pixelData,e),s.pixelDataLength=s.pixelData.length}const o=N(s.pixelData);s.smallestPixelValue=o.min,s.largestPixelValue=o.max}const m={imageId:e,color:d,columnPixelSpacing:c.columnPixelSpacing,columns:s.columns,height:s.rows,preScale:s.preScale,intercept:h.rescaleIntercept?h.rescaleIntercept:0,slope:h.rescaleSlope?h.rescaleSlope:1,invert:"MONOCHROME1"===s.photometricInterpretation,minPixelValue:s.smallestPixelValue,maxPixelValue:s.largestPixelValue,rowPixelSpacing:c.rowPixelSpacing,rows:s.rows,sizeInBytes:s.pixelData.byteLength,width:s.columns,windowCenter:f.windowCenter?f.windowCenter[0]:void 0,windowWidth:f.windowWidth?f.windowWidth[0]:void 0,voiLUTFunction:f.voiLUTFunction?f.voiLUTFunction:void 0,decodeTimeInMS:s.decodeTimeInMS,floatPixelData:void 0,imageFrame:s,rgba:d&&r,getPixelData:()=>s.pixelData,getCanvas:void 0,numComps:void 0};var g;if(window.image=m,m.color&&(m.getCanvas=function(){if(ae===e)return i;const t=m.columns,n=m.rows;i.height=n,i.width=t;const o=i.getContext("2d"),r=o.createImageData(t,n),a=s.pixelData;if(a.length===t*n*4)for(let e=0;e<a.length;e++)r.data[e]=a[e];else if(a.length===t*n*3){let e=0;for(let t=0;t<a.length;t+=3)r.data[e++]=a[t],r.data[e++]=a[t+1],r.data[e++]=a[t+2],r.data[e++]=255}return s.pixelData=r.data,s.pixelDataLength=r.data.length,s.imageData=r,o.putImageData(s.imageData,0,0),ae=e,i}),h.modalityLUTSequence&&h.modalityLUTSequence.length>0&&"1.2.840.10008.5.1.4.1.1.12.1"!==(g=p.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==g&&(m.modalityLUT=h.modalityLUTSequence[0]),f.voiLUTSequence&&f.voiLUTSequence.length>0&&(m.voiLUT=f.voiLUTSequence[0]),m.color&&(m.windowWidth=256,m.windowCenter=128),void 0===m.windowCenter||void 0===m.windowWidth){const e=m.imageFrame.minAfterScale,t=m.imageFrame.maxAfterScale;m.windowWidth=t-e,m.windowCenter=(t+e)/2}t(m)}),s)}))},se=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Xe.cornerstone.imageRetrievalPoolManager,o=(new Date).getTime();return{promise:new Promise(((r,a)=>{const i=t.requestType||"interaction",s=t.additionalDetails||{imageId:e},l=void 0===t.priority?5:t.priority,c=t.addToBeginning||!1,u=e.substring(7);n.addRequest(function(e,n,i){return _(e,n,i).then((e=>{const i=function(e){const t="1.2.840.10008.1.2";if(!e)return t;const n=e.split(";"),o={};n.forEach((e=>{const t=e.split("=");if(2!==t.length)return;const n=t[1].trim().replace(/"/g,"");o[t[0].trim()]=n}));const r={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return o["transfer-syntax"]?o["transfer-syntax"]:e&&!Object.keys(o).length&&r[e]?r[e]:o.type&&r[o.type]?r[o.type]:r[e]?r[e]:t}(e.contentType),s=e.imageFrame.pixelData;ie(n,s,i,t).then((e=>{const t=(new Date).getTime();e.loadTimeInMS=t-o,r(e)}),a)}),a).catch((e=>{a(e)}))}.bind(this,u,e,"multipart/related; type=application/octet-stream; transfer-syntax=*"),i,s,l,c)})),cancelFn:void 0}},le={metaData:{getNumberString:function(e,t,n){const o=i(e,t,n);if(void 0!==o)return parseFloat(o)},getNumberValue:s,getNumberValues:l,getValue:i,metaDataProvider:C},findIndexOfString:M,getPixelData:_,loadImage:se,metaDataManager:v,register:function(e){e.registerImageLoader("wadors",se),e.metaData.addProvider(C)}};function ce(e,t){if(e.elements[t]&&6===e.elements[t].length)return[e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]}function ue(e,t,n){const o=[],r=e.elements[t];for(let a=0;a<n[0];a++)16===n[2]?o[a]=e.uint16(t,a):o[a]=e.byteArray[a+r.dataOffset];return o}const de=function(e){const t={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return function(e,t){0===e.uint16("x00280103")?(t.smallestPixelValue=e.uint16("x00280106"),t.largestPixelValue=e.uint16("x00280107")):(t.smallestPixelValue=e.int16("x00280106"),t.largestPixelValue=e.int16("x00280107"))}(e,t),"PALETTE COLOR"===t.photometricInterpretation&&e.elements.x00281101&&function(e,t){t.redPaletteColorLookupTableDescriptor=ce(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=ce(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=ce(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);const n=t.redPaletteColorLookupTableDescriptor[0],o=e.elements.x00281201.length===n?8:16;t.redPaletteColorLookupTableDescriptor[2]!==o&&(t.redPaletteColorLookupTableDescriptor[2]=o,t.greenPaletteColorLookupTableDescriptor[2]=o,t.bluePaletteColorLookupTableDescriptor[2]=o),t.redPaletteColorLookupTableData=ue(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=ue(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=ue(e,"x00281203",t.bluePaletteColorLookupTableDescriptor)}(e,t),t};function fe(e,t){let n=t.uint16("x00283002",0);0===n&&(n=65535);let o=0;o=0===e?t.uint16("x00283002",1):t.int16("x00283002",1);const r={id:"1",firstValueMapped:o,numBitsPerEntry:t.uint16("x00283002",2),lut:[]};for(let o=0;o<n;o++)r.lut[o]=0===e?t.uint16("x00283006",o):t.int16("x00283006",o);return r}const he=function(e,t){if(!t||!t.items||!t.items.length)return;const n=[];for(let o=0;o<t.items.length;o++){const r=fe(e,t.items[o].dataSet);r&&n.push(r)}return n},pe=function(e){const t=e.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===t||"1.2.840.10008.5.1.4.1.1.2.1"===t)return 1;const n=e.floatString("x00281052"),o=e.floatString("x00281053");if(void 0!==n&&void 0!==o){const t=function(e){const t=e.uint16("x00280103"),n=e.uint16("x00280101");return 0===t?0:-1<<n-1}(e);return t*o+n<0?1:0}return e.elements.x00283000&&e.elements.x00283000.length>0?0:e.uint16("x00280103")},me=function(e,t,n){const o=[],r=e.string(t);if(!r)return;const a=r.split("\\");if(!(n&&a.length<n)){for(let e=0;e<a.length;e++)o.push(parseFloat(a[e]));return o}},ge=function(e){const t=e.indexOf(":");let n=e.substring(t+1);const o=n.indexOf("frame=");let r;if(-1!==o){const e=n.substring(o+6);r=parseInt(e,10),n=n.substring(0,o-1)}return{scheme:e.substring(0,t),url:n,frame:r,pixelDataFrame:void 0!==r?r-1:void 0}};async function ve(e,t,n){const o=function(e){const{dicomParser:t}=Xe;let n,o=t.parseDicom(e,{untilTag:"x7fe00010"});o.elements.x7fe00010||console.warn("Pixel data not found!");try{n=t.parseDicom(e)}catch(e){console.error(e),console.log("pixel data dataset:",e.dataSet),n=e.dataSet}return o.elements.x7fe00010=n.elements.x7fe00010,o=function(e){const t=e.elements.x7fe00010.fragments,n=e.byteArray.length;for(const e of t){const{position:t,length:o}=e;o>n-t&&(console.log(`Truncated fragment, changing fragment length from ${e.length} to ${n-t}`),e.length=n-t)}return e}(o),o}(e),{uri:r,imageId:a,fileTotalLength:i}=n;return o.fetchMore=async function(s){const l=Object.assign({uri:r,imageId:a,fetchedLength:e.length,lengthToFetch:i-e.length},s),{fetchedLength:c,lengthToFetch:u}=l,{arrayBuffer:d}=await t(r,a,{byteRange:`${c}-${c+u}`}),f=new Uint8Array(d),h=new Uint8Array(o.byteArray.length+f.length);return h.set(o.byteArray),h.set(f,o.byteArray.length),ve(h,t,n)},o}function ye(e,t,n){const o={};(t?Object.values(t.items[0].dataSet.elements):[]).map((e=>o[e.tag]=e));const r={};return(e?Object.values(e.items[n-1].dataSet.elements):[]).map((e=>r[e.tag]=e)),{shared:o,perFrame:r}}function be(e){if(!e)return;const{elements:t,...n}=e,{x52009230:o,x52009229:r,...a}=t;return{NumberOfFrames:e.intString("x00280008"),PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:r,otherElements:a,otherAttributtes:n}}const xe=function(e){const t=function(e){return e.indexOf("&frame=")}(e),n=-1===t?e:e.slice(0,t),o=parseInt(e.slice(t+7),10)||1;let r;return r=Te[n]?Te[n].dataSet:void 0,{dataSet:r,frame:o}};let we=0,Te={},Ie={};function Ee(){return{cacheSizeInBytes:we,numberOfDataSetsCached:Object.keys(Te).length}}const Se={isLoaded:function(e){return void 0!==Te[e]},load:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,n=arguments.length>2?arguments[2]:void 0;const{cornerstone:o,dicomParser:r}=Xe;if(Te[e])return new Promise((t=>{Te[e].cacheCount++,t(Te[e].dataSet)}));if(Ie[e])return Ie[e].cacheCount++,Ie[e];const a=t(e,n),i=new Promise(((s,l)=>{a.then((async function(a){const c={isPartialContent:!1,fileTotalLength:null};if(!(a instanceof ArrayBuffer)){if(!a.arrayBuffer)return l(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=a.flags.isPartialContent,c.fileTotalLength=a.flags.fileTotalLength,a=a.arrayBuffer}const u=new Uint8Array(a);let d;try{d=c.isPartialContent?await ve(u,t,{uri:e,imageId:n,fileTotalLength:c.fileTotalLength}):r.parseDicom(u)}catch(e){return l(e)}Te[e]={dataSet:d,cacheCount:i.cacheCount},we+=d.byteArray.length,s(d),o.triggerEvent(o.events,"datasetscachechanged",{uri:e,action:"loaded",cacheInfo:Ee()})}),l).then((()=>{delete Ie[e]}),(()=>{delete Ie[e]}))}));return i.cacheCount=1,Ie[e]=i,i},unload:function(e){const{cornerstone:t}=Xe;Te[e]&&(Te[e].cacheCount--,0===Te[e].cacheCount&&(we-=Te[e].dataSet.byteArray.length,delete Te[e],t.triggerEvent(t.events,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:Ee()})))},getInfo:Ee,purge:function(){Te={},Ie={},we=0},get:function(e){let t;if(e.includes("&frame=")){const{frame:n,dataSet:o}=xe(e);t=function(e,t){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:r,otherElements:a}=be(t);if(o||n>1){const{shared:n,perFrame:i}=ye(o,r,e),s={elements:{...a,...n,...i}},l=Object.create(t);return Object.assign(l,s)}return t}(n,o)}else Te[e]&&(t=Te[e].dataSet);return t},update:function(e,t){const n=Te[e];n?(we-=n.dataSet.byteArray.length,n.dataSet=t,we+=t.byteArray.length,Xe.cornerstone.triggerEvent(Xe.cornerstone.events,"datasetscachechanged",{uri:e,action:"updated",cacheInfo:Ee()})):console.error(`No loaded dataSet for uri ${e}`)}};function Ce(e,t){const n=e.string("x00080008");if(n){const e=n.split("\\");if(e.length>t)return e[t]}}function Ae(e){let t=me(e,"x00200037",6);return!t&&e.elements.x00209116&&(t=me(e.elements.x00209116.items[0].dataSet,"x00200037",6)),t||(t=function(e){let t;if(e.string("x00080060").includes("NM")){const n=Ce(e,2);n&&y(n)&&e.elements.x00540022&&(t=me(e.elements.x00540022.items[0].dataSet,"x00200037",6))}return t}(e)),t}function Me(e){let t=me(e,"x00200032",3);return!t&&e.elements.x00209113&&(t=me(e.elements.x00209113.items[0].dataSet,"x00200032",3)),t||(t=function(e){let t;if(e.string("x00080060").includes("NM")){const n=Ce(e,2);n&&y(n)&&e.elements.x00540022&&(t=me(e.elements.x00540022.items[0].dataSet,"x00200032",3))}return t}(e)),t}function Pe(e){let t=me(e,"x00280030",2);return!t&&e.elements.x00289110&&(t=me(e.elements.x00289110.items[0].dataSet,"x00280030",2)),t}function De(e){let t;return e.elements.x00180050?t=e.floatString("x00180050"):e.elements.x00289110&&e.elements.x00289110.items.length&&e.elements.x00289110.items[0].dataSet.elements.x00180050&&(t=e.elements.x00289110.items[0].dataSet.floatString("x00180050")),t}const Le=function e(t,n){const{dicomParser:o}=Xe,r=ge(n);if("multiframeModule"===t){const e=xe(r.url);if(!e.dataSet)return;const t=function(e,t){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:r}=be(e);if(o||n>1){const{shared:e,perFrame:a}=ye(o,r,t);return{NumberOfFrames:n,PerFrameFunctionalInformation:a,SharedFunctionalInformation:e}}return{NumberOfFrames:n}}(e.dataSet,e.frame);return t}let a=r.url;r.frame&&(a=`${a}&frame=${r.frame}`);const i=Se.get(a);if(i){if("generalSeriesModule"===t)return{modality:i.string("x00080060"),seriesInstanceUID:i.string("x0020000e"),seriesNumber:i.intString("x00200011"),studyInstanceUID:i.string("x0020000d"),seriesDate:o.parseDA(i.string("x00080021")),seriesTime:o.parseTM(i.string("x00080031")||""),acquisitionDate:o.parseDA(i.string("x00080022")||""),acquisitionTime:o.parseTM(i.string("x00080032")||"")};if("patientStudyModule"===t)return{patientAge:i.intString("x00101010"),patientSize:i.floatString("x00101020"),patientWeight:i.floatString("x00101030")};if("imagePlaneModule"===t){const e=Ae(i),t=Me(i),n=Pe(i);let o;i.elements.x00200052&&(o=i.string("x00200052"));const r=De(i);let a;i.elements.x00201041&&(a=i.floatString("x00201041"));let s=null,l=null;n&&(l=n[0],s=n[1]);let c=null,u=null;return e&&(c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])],u=[parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[5])]),{frameOfReferenceUID:o,rows:i.uint16("x00280010"),columns:i.uint16("x00280011"),imageOrientationPatient:e,rowCosines:c,columnCosines:u,imagePositionPatient:t,sliceThickness:r,sliceLocation:a,pixelSpacing:n,rowPixelSpacing:l,columnPixelSpacing:s}}if("nmMultiframeGeometryModule"===t){const e=i.string("x00080060"),t=Ce(i,2);return{modality:e,imageType:i.string("x00080008"),imageSubType:t,imageOrientationPatient:Ae(i),imagePositionPatient:Me(i),sliceThickness:De(i),pixelSpacing:Pe(i),numberOfFrames:i.uint16("x00280008"),isNMReconstructable:y(t)&&e.includes("NM")}}if("imagePixelModule"===t)return de(i);if("modalityLutModule"===t)return{rescaleIntercept:i.floatString("x00281052"),rescaleSlope:i.floatString("x00281053"),rescaleType:i.string("x00281054"),modalityLUTSequence:he(i.uint16("x00280103"),i.elements.x00283000)};if("voiLutModule"===t){const e=pe(i);return{windowCenter:me(i,"x00281050",1),windowWidth:me(i,"x00281051",1),voiLUTSequence:he(e,i.elements.x00283010)}}if("sopCommonModule"===t)return{sopClassUID:i.string("x00080016"),sopInstanceUID:i.string("x00080018")};if("petIsotopeModule"===t){const e=i.elements.x00540016;if(void 0===e)return;const t=e.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:o.parseTM(t.string("x00181072")||""),radionuclideTotalDose:t.floatString("x00181074"),radionuclideHalfLife:t.floatString("x00181075")}}}return"overlayPlaneModule"===t?function(e){const t=[];for(let n=0;n<=30;n+=2){let o=`x60${n.toString(16)}`;4===o.length&&(o=`x600${n.toString(16)}`);const r=e.elements[`${o}3000`];if(!r)continue;const a=[];for(let t=0;t<r.length;t++)for(let n=0;n<8;n++){const o=e.byteArray[r.dataOffset+t];a[8*t+n]=o>>n&1}t.push({rows:e.uint16(`${o}0010`),columns:e.uint16(`${o}0011`),type:e.string(`${o}0040`),x:e.int16(`${o}0050`,1)-1,y:e.int16(`${o}0050`,0)-1,pixelData:a,description:e.string(`${o}0022`),label:e.string(`${o}1500`),roiArea:e.string(`${o}1301`),roiMean:e.string(`${o}1302`),roiStandardDeviation:e.string(`${o}1303`)})}return{overlays:t}}(i):"transferSyntax"===t?{transferSyntaxUID:i.string("x00020010")}:"petSeriesModule"===t?{correctedImage:i.string("x00280051"),units:i.string("x00541001"),decayCorrection:i.string("x00541102")}:"petImageModule"===t?{frameReferenceTime:i.floatString(i.string("x00541300")||""),actualFrameDuration:i.intString(i.string("x00181242"))}:"instance"===t?I(n,e,S):void 0}};let Oe=[];const ke={add:function(e){return"dicomfile:"+(Oe.push(e)-1)},get:function(e){return Oe[e]},remove:function(e){Oe[e]=void 0},purge:function(){Oe=[]}};var Re=o(713);function _e(e,t){const{dicomParser:n}=Xe;if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t);if(function(e){return e.intString("x00280008")!==e.elements.x7fe00010.fragments.length}(e)){const o=n.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t,o)}const o=e.elements.x7fe00010.fragments,r=new Re.ByteStream(e.byteArrayParser,e.byteArray,e.elements.x7fe00010.dataOffset),a=(0,Re.readSequenceItem)(r);if("xfffee000"!==a.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";r.seek(a.length);const i=r.position;if(t+1>o.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=i+o[t].offset+8,l=o[t].length;return new Uint8Array(r.byteArray.buffer.slice(r.byteArray.byteOffset+s,r.byteArray.byteOffset+s+l))}function Ne(e,t){return e&1<<t}const Be=function(e,t,n){const o=new Uint8Array(n);for(let r=0;r<n;r++){const n=e[Math.floor(r/8)+t],a=r%8;o[r]=Ne(n,a)?1:0}return o},Ue=function(e,t){const n=e.elements.x7fe00010||e.elements.x7fe00008,o=e.uint16("x00280100"),r=e.uint16("x00280010"),a=e.uint16("x00280011");let i=e.uint16("x00280002");"YBR_FULL_422"===e.string("x00280004")&&(i=2,console.warn("Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.\n      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information."));const s=n.dataOffset,l=r*a*i;let c;if(8===o){if(c=s+t*l,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+l))}if(16===o){if(c=s+t*l*2,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+2*l))}if(1===o){if(c=s+t*l*.125,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return Be(e.byteArray,c,l)}if(32===o){if(c=s+t*l*4,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+4*l))}throw new Error("unsupported pixel format")},Ve=function(e){const t=ge(e),n=parseInt(t.url,10),o=ke.get(n);return new Promise(((e,t)=>{const n=new FileReader;n.onload=t=>{const n=t.target.result;e(n)},n.onerror=t,n.readAsArrayBuffer(o)}))},Fe=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=e.elements.x7fe00010||e.elements.x7fe00008;return n?n.encapsulatedPixelData?_e(e,t):Ue(e,t):null};function je(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;const i=(new Date).getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise(((l,c)=>{e.then((e=>{const u=Fe(e,n),d=e.string("x00020010"),f=(new Date).getTime(),h=ie(t,u,d,r);!function(e,t){e.decache=function(){const e=ge(t);Se.unload(e.url)}}(s,t),h.then((t=>{t.data=e,t.sharedCacheKey=o;const n=(new Date).getTime();t.loadTimeInMS=f-i,t.totalTimeInMS=n-i,void 0!==a&&void 0!==a.imageDoneCallback&&a.imageDoneCallback(t),l(t)}),(function(t){c({error:t,dataSet:e})}))}),(function(e){c({error:e})}))})),s}function He(e){return"dicomweb"===e||"wadouri"===e?O:"dicomfile"===e?Ve:void 0}function ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=ge(e);t=Object.assign({},t);let o=t.loader;return void 0===o?o=He(n.scheme):delete t.loader,Se.isLoaded(n.url)?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;const a=(new Date).getTime();return{promise:new Promise(((i,s)=>{const l=(new Date).getTime();let c;try{const o=Fe(e,n),a=e.string("x00020010");c=ie(t,o,a,r)}catch(t){return void s({error:t,dataSet:e})}c.then((t=>{t.data=e,t.sharedCacheKey=o;const n=(new Date).getTime();t.loadTimeInMS=l-a,t.totalTimeInMS=n-a,i(t)}),s)})),cancelFn:void 0}}(Se.get(n.url,o,e),e,n.pixelDataFrame,n.url,t):je(Se.load(n.url,void 0,e),e,n.frame,n.url,t)}const qe={metaData:{getImagePixelModule:de,getLUTs:he,getModalityLUTOutputPixelRepresentation:pe,getNumberValues:me,metaDataProvider:Le},dataSetCacheManager:Se,fileManager:ke,getEncapsulatedImageFrame:_e,getUncompressedImageFrame:Ue,loadFileRequest:Ve,loadImageFromPromise:je,getLoaderForScheme:He,loadImage:ze,parseImageId:ge,unpackBinaryFrame:Be,register:function(e){e.registerImageLoader("dicomweb",ze),e.registerImageLoader("wadouri",ze),e.registerImageLoader("dicomfile",ze),e.metaData.addProvider(Le)}},We=function(e){le.register(e),qe.register(e)};let Ge,Ye;const Ze={set cornerstone(e){Ge=e,We(Ge)},get cornerstone(){if(!Ge){if(Ge=window&&window.cornerstone,!Ge)throw new Error("cornerstoneDICOMImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneDICOMImageLoader.external.cornerstone = cornerstone; to your application.");We(Ge)}return Ge},set dicomParser(e){Ye=e},get dicomParser(){if(!Ye){if(!window||!window.dicomParser)throw new Error("cornerstoneDICOMImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneDICOMImageLoader.external.dicomParser = dicomParser; to your application.");Ye=window.dicomParser}return Ye}},Xe=Ze;function Ke(e,t){const n=e.length,o=new Uint8ClampedArray(n);for(let r=0;r<n;++r)o[r]=e[r]>>t;return o}function Qe(e,t,n){const o=e.columns*e.rows,r=e.pixelData;let a=e.redPaletteColorLookupTableData;a||(a=Xe.cornerstone.metaData.get("imagePixelModule",e.imageId)?.redPaletteColorLookupTableData);let i=e.greenPaletteColorLookupTableData;i||(i=Xe.cornerstone.metaData.get("imagePixelModule",e.imageId)?.greenPaletteColorLookupTableData);let s=e.bluePaletteColorLookupTableData;if(s||(s=Xe.cornerstone.metaData.get("imagePixelModule",e.imageId)?.bluePaletteColorLookupTableData),!a||!i||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const l=e.redPaletteColorLookupTableData.length;let c=0,u=0;const d=e.redPaletteColorLookupTableDescriptor[1],f=8===e.redPaletteColorLookupTableDescriptor[2]?0:8,h=Ke(a,f),p=Ke(i,f),m=Ke(s,f);if(n)for(let e=0;e<o;++e){let e=r[c++];e<d?e=0:e>d+l-1?e=l-1:e-=d,t[u++]=h[e],t[u++]=p[e],t[u++]=m[e],t[u++]=255}else for(let e=0;e<o;++e){let e=r[c++];e<d?e=0:e>d+l-1?e=l-1:e-=d,t[u++]=h[e],t[u++]=p[e],t[u++]=m[e]}}const Je=function(e){D(e)},$e=function(e,t){if(t=t||e.transferSyntax,8===e.bitsAllocated&&"1.2.840.10008.1.2.4.50"===t&&(3===e.samplesPerPixel||4===e.samplesPerPixel))return!0},et={convertRGBColorByPixel:e,convertRGBColorByPlane:t,convertYBRFullByPixel:n,convertYBRFullByPlane:a,convertPALETTECOLOR:Qe,wadouri:qe,wadors:le,configure:Je,convertColorSpace:U,createImage:ie,decodeImageFrame:te,decodeJPEGBaseline8BitColor:V,getImageFrame:ne,getPixelData:_,getMinMax:N,isColorImage:oe,isJPEGBaseline8BitColor:$e,webWorkerManager:J,internal:k,external:Ze}})(),r})(),e.exports=o(n(5915))},8011:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAV1BMVEX2AgD2EAD4eAD3QgD4bgD2HgD3TgD3ZQD3VgD2FgD2NwD3XAD2JwD2LgD99hf6owP6mQT4iAD5hAD7uwv6rQb5jwH81w/85hT83xL8zw/7xgv+/hv97BZTj7ayAAAB6klEQVQ4y9VRCY4cIRAD6qSAvnvn/P87456NEq3yglh9CGwZl0n/GXLOVbqI9DEk53/4Wms4RY/moY26/JRkqbmO3gqTrSbaIv9Q5BBi07atPdWy2rYWkvijECHyc12XeS5Y6jyf67m5yGXSc8Z5xOu6rctxXIJ2zOtWCmsVzWnkoUJwsG3blvkUGXxuYEePyBSpZu1BmLBzKWUrhu9ZfGCn5lQd8SmrY0ptqlzMCsCCkeqVMZAQHvEx8LCyLcdSOETcCRboC+MiaLRmFtHKPr2mrwJSVfG9Cvz0gRJQ4Ij2nm7vaY8QUtRZUYV08MMUa7iU6cJOCp7IRSO5okc1cOdzt+V1f35NN2M2CEgQfy8JLtSO+35f9vvbzObXfT+Px4xZSdO0wQHgx9fX8ZwmJt9ft+eOlfQ8It0MITFM9WVelvlxOx7vHbfyLIFb6JTmSEClUG+N1I9pWpprKd54ZImk/TIINncya9oesyEjOyrVnCWRpDyqlut6HAnpNKB5Q+OURVJ0ESIIjISaOjGpsw9i1h4owcxV3dlGHd4uKQVWgq5JcUyCE06EdUVmgDR6xBjaEAVkYi74IyP1WuUDSHOND/3tAB5wufYrWLwAEjGQwF58wzSY9y8ShH0QJQbMQz6b36X+fr71vwDwJBeEP0nA0AAAAABJRU5ErkJggg=="},3522:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABEVBMVEX3+//i7fja6fbo8vrU5fTl7/nv9v19tdne6/fO4vKky+TB2u2gyOOBt9rG3e+u0OfX5/WnzOWSwd+Ku9yPvt55sti92OyrzeaYw+Dr8/u41eq21Om71uubxuJrqNSz0+mx0eiGudsUNnJnpdHy+P7K4PCdxeGEuNvD3O6+2ex0r9ZjotBJjcWVwt8oVpIlS4WZv91WlslghK5Teqo3ZJsfQnsVO3gRMGuiw9+dvNhyrdV5rdRcnM2DqMtjjLhJcKE0XZMWP39wptF+rdCPrMt2nsRplcBAhL9Pib1nk7xcj7xGgrhQhLVAeLA4cqxAbKFHZ5g2Wo4aR4ksUIeHsdWWttRlnMg6fLtYiLc2bKcxaqcwQHXtAAACnElEQVQ4y9WRVY5cMRBFTc/c9mOmZu4enuDMhJk5+19I3FF+oqwgV7LLch3XLbnAfyZKC44IQj4RU7+g/+QhQkpWhqhGKzsrif83Qn2E0FQ0q2EfjWORzRQk+E/hCQATqvxsGPd5OxYAPhzH7fhOTxbYZQAuigL5ZZmvx+vjzeaue3Nrs1mv1612DXkFIB6sBKmj8bodHz/79tABR8824zZJBhIhy4HxlCRp2eu4bdvjzT0fLQb32mRuzXSpvL4ECEqRWgz5NEqSVXsnThJ2L9ELiDkvKNLA81OYNQXmQRNk8zthuFolyVx4yCCPUloC7DoJFEQiYlptWfvy9OWjKCVEByXisOCAI4gFXDTNNlcLzd6NLkef7ssO2c7qklMKuO8q4S4KtTRTc/v84uOD0XulUNpXuuMKA58UlJrYWjub5fn90cUDB9RZ2lWqln6WAmkphV0+2z76evYmPrncn30Y7b9En4+yOq1IIMGbu5MJJ8vZ693b/dW7/fnt/Ojk8tP101dnrwPhVRaMntAJxth7fLPbvfp5MXqcBteXH3+83e1OfYLFApzfpoBiWvBbV8+Pr05u9qcfzq+fvHh+dr8WHIslOFEOoLBUNsubtAtORxcvtLQDJnVsMFEgE86iUFEsgzQPdXbr5nsYxoNYxiwJOPRBTTCeooCxKJvKcJvXT4/CMJxJzVZJx30CjCBumJKxPCWVtoGaV72OpOiGkRVGZyDMgz7I5DA23OimrrO7lZHzkCBb1TZmDDA2GAzjcFtzCIkgogqMMEsj+iYPh8kqAQMnx4SyEuggHyHuWLQMGUvYocLA7QdEEg/C30m3nEjZRMP58GDhPKKm8w//6TnoIO9wQsSkJYjmUZQHS8Kx565x4cJvErpwwH4BGi5IMMkKl1sAAAAASUVORK5CYII="},2007:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABBVBMVEUAAAAZGSQdHSkVFR4SERkjIzFmboZka4NOUGs9PVVSVnAHBgtJSmZgZX8oKDhpcohCQ1sPDhVueI1ZXXhWWnMzNUcuL0ErKzwLCxF2gpU7O1L2+fpdYnxbYHpPVGkgIC5KTWM3OEsyMkR6h5lsdYtAQlcEBAZMT2hESFw4OE+Rmaecoq+Qo62Cj59dZHZaXXFERV/+/v7v9PXa4OPP19zKz9XBydCdr7iImaZ8i5tHSWE9QFHq7/Di6Oq2xsu7vcSlrLaVprFye49ydYro6+7g4+bT29+2vsauvMSzt8GftLuqsbqMkZ9+hZNgaXtqbXrX2d+Zm6VygItvfYZpdoFSXGVJUlt63FDBAAACl0lEQVQ4y9WRRZIcMRBFJZVUwlIxczVzD4+HwTxkvv9RXD0bh8Mn8F+kIuM9ZS4S/GeRMjEQqRHRcYwS+Q+HEM3YKNStqGZnAdfob0UiBFGkhfd8vk7XeipCSJJXksjxjodk+rx2RDogAH8bFOnAc0jnAjAGbuJKVPPz6s3gzent8kdv/1ou+yatEIHYBRob5zHhVjpIB6cnn7/3ws+T5SD1PNogNIUgMrqGZOejapOm6elyhWBMV6lHnSgOQzxqAYKNbqfYQLE1HHrpXWkP7dWQdRAj5CaoArjO4LRKMGrEpKF3pe953pBqA0U1llK2wCUIN+FugFnNfDOd38zvrYwQxjiCRgIBrA1XG50QfhCGwv6Q7+Vf7pkDp1vFOJQSoNpIpDuySsHCKNy8zS8v8utwVmfKYSMYuoDoRCZRcaZU0Oc+37/Yz6+5yrbbjLNataCaSgmdQPje6vhh/XXv4Pgwf7e26Kbh3CGKgY/eeAxJJk7eXx3MPxy83fj+Yu/g0+rkeKFiPFIgf5Jj13Xxy9Hh4eer/fyFV9d7l1cf3x/eIO1GM3C5kWCMZQKr+e3pfHH07uHo4tPT4+3xXRZDrDOwaMdAjg0+U5Mg4NvJTb4/F0yZNhNFh8kMqFj2F+1owRj3S6HE0aIoLNNihT1sICSAE9eN4JlpWipipe/zx6AsC8GE7Q0dSAgINSEZn9h2kBFHqElGR46wWOxQ6yzumAJ+MHGUYrSIYMQCzpU36hj1Ndo6XBWmCWzTNKlV+hz2CzWJeRPqro0iRwQlHXoeMKm5U0rmxKgPqWvUqwZqfdPuP9tgV2zaKxOCIdzBHTegQbiwKKW9QE1KLeEQjLGxy45jo2+QjjIOLGpZvmoJfKU46Z/e/FN/A92MRrSJbLGPAAAAAElFTkSuQmCC"},6030:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAA9lBMVEVP//9M4/97h/5kqP92jP5M5/9M7P9N3P9no/9qnv9O/f9Q1v9Q0f9cuv9wlv9O2f9btv9M8f9esf9N4P9TzP9VyP/vBPxZvP9yk/5N9f9+hP6Jdf5ZwP+Bf/5opf5N+P9tmf+gWv5U2/9zkP5+gv5Q3P9Ww/9gtf9Q5P+tS/5lrf9rm/5zmP6Gef6aY/7dGf3kDvxR8f9U0P9cxP9frf9hq/9un/6FgP6lVP6+PP1U6P9jsf94kv58iv6Ncv6OcP6Sa/6oWf24P/3CNf3NK/3RI/3WH/z3APxgvf6XZ/6zSv3HLv1bzP6MfP5e1f52qv56oP6Ljf7KZtzfAAACoElEQVQ4y9WPh47dIBREwWDAz4B7736997a9b3r5/58Jm40UKX+QkS7o6gwzAvxf6lTJ+qI1277J/S/tuur8y0eURswd8PxQ5rvpcNMmf8C7M2lpvx/4h+JqeJXJzcTIobn+jZxEWTrV1rq8ku5hnn3rXHy9iedZcWkG645ixCFOawlxuLm5+XhqjurN96a5zW7nZd/0LgjgOhS+aXczpcV4/FXF/Tg12bzX01C/nXgggFtkCjEsZ9k8WzR37ejL9V1WYDfw81wffgAWRJv8kkDq415azAuZpuldrxxAQilx+iXQrQhOSodQZKAJLqQsil56vYH9wNKryvkACLd0tB1ZPtbKXGpZM256seBmiUTfg84IQAuSzWhrGPU0z430HL6GL0fm0ksXMUGTBFALOokzxNJgg2AwW4WrVXjOI0vsXDb0Bmtgccdxgni3R4ZKOYZvehRIuG5klyaKQDlJkpFbG7K4e/w0u39dfn4Ol1fd6xkSts0RAw/HqqI8OoxfzsvFebma1fL+9eXh4/jzCfm6vQPhbdIhhFz8fHp+Hj+G4bVdnl9Xjw8vz59aTvwcLGdJpyKJ4xlNs2jun5afnlYPt4vT5+MHnxIuwH1UdZxqJKI9mk7Fjo3DcGGwvZYyIw50HgHEVYWzxTFjopYMGU+nOO6qNdZ6yIMWsE1CfDrRtC4KWCxr+2MtZWwwIy16Q880wcA3ubCRltbCtI09irDtsi7zXYz3/oAhIKfIRYjhOKABm9o2KuwAYckt17VRrGlAU8JdKW0KPc65b6OcD6IgcI06xqoGaPi3RTLXp9SyTMuingchjaSmpYqA9P3GGJk69KingtQomcLoYozfK3DXGKrf6PCvdB1aPIhsgBWtUWR6+hsmjq4Y0dWi5u38BZRBTiq+AwTyAAAAAElFTkSuQmCC"},9141:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACVVBMVEU/S7/W3OfU2uhVa9pfeORngeleduKctvvK1u5cc+BZcN/G1fPa2+C0yfpyjO3R2uu5zPVjfOarxPxOYdJLXM6wx/qguvqetvd/mvPD0fF4kvGKnutIVsaWsvytw/m8z/eku/eTrPaasfS+zvO6yfBvi+5sh+xpf+PY1dzi1tJEUsWzDSemwP2Ur/e1yfayxfWtvvGouvGEnvF/l+2otupwiepqhOqksuluhuhjeuJSZtfm1s1JWcuyID25HTC2y/qMqPnB0vWCnfV6lvKXrPDG0+90j++ywO17lO2NouzFz+qsuerO1+l9lOlqguZlfuaFleJZbttiddlMXtBRX8ro1MjuwKmuAR+vw/WLpvWgtfKSqfKIofLN2O6Qpe6Dmuu4w+p5kOqVpud0ieSyu+Ntg+PQ0eKxt9+ys97Nyt1ofNxfdNzIxttqfdvf2dhVaNXYz9RqedTk1M1TXsWymsPrxrXBlam3W3e6RV3NVVe1ESiowPeGove+yeydr+qKnOXU1eKRn+HEx+C+wuCboNvCwdpvgdrU0NnFudPk2NGhl89hbc3i0czqz8HKrrebhbTNnqnxvaS+iKGye5/Kjpq5fZrxspfZl5PPhozaioLbf3TBXm+mO2XGSFG+OEi5MUbGPUK/JzKcq+jKz+SfquKpq95/idOYkNDczc64q86/ts2eisRsbsLAqb/Wtrrfvri2k7bhubGugabhrqTbpqGMWpbnp5SxbJHxqo2/dIutYYeiVoTHcH2nUHviiHixTnDNaW6/VWnFWWLFUFytN1uzME3DMjdGkMgXAAADLElEQVQ4y9WQ05IkYRBG/6rqUpfbtm3MdPfYxs6szbG1tm3bto3n2pq929gn2C8vMjLPiciIBP9ZDLnO/cO7VjUna+Otw52Gf3i7O2Vl1PMq6pbWBNeb1bW7/lYMq1Lu5ljtSs/OHfdGdi5LL9VnV3T+IfIO3yzfnLnRt33+Gu/IAzB66MC2A8VDm5KtowD4AFKE5PpdlZVr5hTPGT969JBoH+7qEgdvjXtF+yACKkhseROLbxsp3rt3/NSbiVnhVFfxgMezuqGnP50FG7DWBBusvNaw3TvgHe96PLz/Vt9BL91oicX1eunyrSCFJZrq0ogEbbpO07R3qH63Z8tBT40+24aigx09KwGZXJBNr5QjaJSPRFcPaLU07dm9bgXmXpKR5gyKrQDRuXojejITJ+Aaq3bLnSNnjuypX1CdDDM2dwsmbweCU4Is69U7zGX2xQv5dR/83f6fY2F1TzQgC9maFQqAOkm5omhTI2UumRcrvZ0vXPnlvxAPZmyyAD8/W9cJWF1Rh3xJvUymNDscG8dmClevzlxYbDIGAkY8vMq0HESicgWmKjNv3PPo/Jm177svf53y5/fV312bsOGqamUJOPvQ52vWGdecvvjp0snzl/I3HUtfd1+enDj97URE06aSgZlnOZ/47tGX36enX50r+O/j6c/dV86dvTg92V87WG4E+X0KkEMU8vYdx188PXZyKv/xR2HyybHnX8Zam1qQuBG8qzOADl+vzSqb67Djgchbf2EixMhWr2N4Qi9dZgVRjQIg8s0cUcLgZVSJsmHqRBVFwARDQHQDKrAAZxFE405AMGHawFBUGX58LUVRfIiHaHp+i7MalGpYXRCfC0H2YLXKLFMa+9QWfhFTbmkk1mvmhUxAa1dalEqGq4qhS0J2XGUaUpcyjVpdxqLCTVUwBCAIgjmConBUQHUVFeXqRKlm4eJYuYW3V3HiGQDDkFgwFVZpXC6Xk3U6XWiLIEkt0MKQGBiIWGwwzIWTUkFIoaggoKhEDFvpIDiOAyKdvcGrWUQqJTFM8icYJiUlqG6h1QYWcYsI7VwrK0hJcY8UiVIbgrSJTfRJjPwNFme7zxtIt3oAAAAASUVORK5CYII="},642:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAwFBMVEUAAAAcEQkqGQ+QXTgTCwYhFAxoQiiJVzVWNiF/UjE6JRYKBgJ3TC5ySSwwHhJsRSqNWzdFKxo0IRMmFw6VYDtjPiZRMx9JLxxbOiNvRitePCT4wHmhaEB6UDCma0I/KBiEVTROMR6ZYjyCUzP7xn3osG+pbkTnqWvKhlTDfk7bpGeqd0q4d0nuuHT3t3PUn2TYmF/ElF7EjVi6iFa7gFCwgE+wekywcUbem2HNll3WklvUiVXBhFKjdkqaa0LdqmwjTj//AAACZElEQVQ4y9WNZ3LbMBBG0RtRBBAk2CmqWJJ7d5qd+98qsJ0fyeQEeYMZLPZ7iwX/GUVBILII2TArRIp/clqixTVJJdMulRYK/a0UKDMrs1kLOUlVmUQD+Ug+/yq87bhszDBZADfTdpg2jfXkQyAkT9fCnE1nl8cTzq3qdMqPoUWhJAQoCGtlxXqahuny+/eYhfZ4moYYV6xEHQUeemZr0bhxGIbL0wsqFX8ZIu+8SgmKBSDKVOogRTPHcTNsJMb4JTpPIUKEIAegrWnVElIywyq+kTJuYuQBohnBoihqQAKCzEOkOHbLiIfnH894WwfrnEAlJRRQBImCXutRp2Tw137X/1y5ruw61gpUFABZSArScGlcmpO56q+vd3dpQXXVmab0BNhACPGyYkwbrVd9ZncnWM5r4RBLwFWkoJ02Yzy7PcrX3f7mvN+Pa66ZEE1gLfgW85pQm/vD7f7i6/5Ka/m029+fHc8fmYJNBXZvBSCZ8fxwOH7peync3e769tvh8IAUUQnsdQEKWBDqLh4vn5/O9w83V/dvFz++xFqVUNXgackCoKKumNaicg99f2FchbEzWw/DAph6X5G4bJ3QsmXm5nEr16t1K3FkJbVABEJmlCfWzLdSjuJVy+1WtwZvYlPaAJKyoRYMY12HxjBW86YzvJ0bzqvZtwyMmnWMtVz6cm61ECw23vExoKoR1RZjgFerFd9KKRAtgwpKsKR88nNntOQ4xixgnCXpGoUy1lqESkrRMuYg81vIOAtzv8xhWeYKWqHXnHPwnnK+No2FH9B3PisUfC0Az+nIFpub+RDyfv3JL+wXNhoUBI2IAAAAAElFTkSuQmCC"},1008:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAnFBMVEUAAAAXFxd0dHQdHR0jIyMQEBBWVlZoaGhfX18JCQkwMDApKSlubm5bW1tJSUlGRkY5OTlRUVF4eHhkZGR7e3s9PT1BQUF+fn5NTU01NTWFhYX4+PiMjIyIiIitra2jo6NDQ0O+vr7y8vKdnZ3Pz8+SkpL+/v7s7OzV1dWmpqaZmZnn5+fi4uLf39/a2trExMS5ubmxsbGXl5fJycmVOdM0AAACQklEQVQ4y9VRR5IbMQxkBHOanEc5bV7//2+mtPLB5Re4D0CRaDaAJvrPoJTC7A6tNePqnzqmrAYfdS1dk6TX7G+KYpSyXsvWBjELnWSkhj+FHzEyb0Unh9kg3s5imFvP4oPBOVeMbYKc5un7uhb5Kq37aZoGyQzlHGmMN9oEO0/DfFu+2kxwyzoNVUWA0o6iHkcwm+BdOQzDbT0yqslxqGzX67rmvkYMg647jqm2RdEOrSiq4li5iDmlXFGHMGtocoqzJCGRVoiqzeoGs57hPHyDuMkaETNtCdQlmffLvrKNMQ4CpVhhRBnmGkcpy7KuZbEdT+N7BZ52CVygSt0JSvFsgnSxr8vz+HIet7Fhm9Q5T7MVxnClepESyKzSjrvdbtwGCKlrPDCoEXRK0a7MtenjS+xPr78uu1drSQkheAMOfVYIUdO45X37dtu+nUUp1tPb53E5XEFzn9A4K8Qz7OFyWT52Iwlue3r52L5fFqZ5X6OXUiGUx8Byv37vr4fXr8P5c/pef7WNplxv0LVBKO8S6vuUIcEy7m53ywonRcSmQaBVFohWOAhlDvKwCmGJddnzRKlBwXDe00SIheiEKP2xFCKbIou28pQZFLXJnwlFUW6MlwAN8Z2zrvfWJh0dIFFCBwBERNo7GTxUPuaTYckHEISggmRYIQLNDbXRHmod677vZClsboPIDwR4zZ7IVMwaQYr7Y0RyfqgAw/QPMKbYbKR9EB6w0udt8A/oMzMdm4DyyraExvzcZs+f4Z5wzr8B8scsKGLwyjkAAAAASUVORK5CYII="},9572:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACZFBMVEUKAABHAABsAABcAABNAAA0AABYAgD3PAD3QQD3NwBBAAAqAAAeAADaAwD0GgDTBQB0AABmAABgAABRAABKAAAUAAD2agDGBADBAQCMAAA9AAC8AgCCAQAkAACNCwHvKwD1JwDfCQDkBgC4AQCzAQBjAACrDwHzUQD3TQD2MgDNIQDuIACRAgCtAQCiAQA6AAD//emUEQLvEgH3dgD2cgDDLADmJwDoHADjFgDiEQDuBQCbAgBxAgDgAQCGAAB6AABTAAD///3yPwXpFQTPEwT4fQD3VAD3RwDSRADDGgDUEgD1DwDaDgC5DgDpDQC2BwCpAwCWAwB+AwD+9+/96db5xaX6sgbaHQX5nQOkCQLnPwHyNQDyLwD2LgDBIwC2IQCuHQDnBQCEAAD+/tT34NP+/8v44bb89qb955j6u4zwpIz944f0t3jih3T1l2D81lHohFH3sUf7y0bigUT1d0LdSTL4qyfCOSfUKhH70Qv6uAbmSQH4iwD3ZAD2WwDwVwDaTgDbPwDBNwDQKwC7JADfIgClHQCSGgCaFACCEgDCDQCbDQAuCwB3CABSBwD+8+n+/93+89v43sj3ysL93L/+/7zuv7L+/6rftqP82aHgrqD215H60IfimYPtrID7y3fOiHPXqm7yg2LWfk31j0qVaEjzlkf820H3gT/Kej7oXTnCRjX5nC/hfy/iUCy5NSj6vSXwPiD3cRzXTBb2kRTuThPBKBP83xLUaw3BlAmSZwn6vgfOOgbylASEWQTOhAPISAOXJwPFVgLFfAGmKQHqYwDmVwDvOwBPHwBxGwBHDQDOAACwWnJmAAADLElEQVQ4y9WS07IkYRCE/3ZPu6dnWmObO/baR2vbtm3btm3bL7VzNvZun2Dzoioq8suomwT/mRiGpnBR9MEdmhWnmX98FDHG3APj1u2bwm18Wp1o/IuY/8ZFI45oHdl1fT58zPTZM25TSqrQfxza1okwdvHz+j4DN8pdvoPd77pskDNfxsN2ujOfwDAbAvv9G3t26Tn81cpPTfrtyqHNQw4b4b0JDFghaHsH3Loh00XODF/x7EUTeLliaGZNYN2qsTgyXgJl047NQsy/NdtHXiMPH/pm788fq1bLwW87o9ZUitq6DfhMm/ekxuuoccfIYO9e8trc1wC5OhCOSjpixGx4FlBwmzQuSyeQvoVw35FrI1ygVzCwvgIhmkgxZts2kBBEqIcdEieOJsJt+W7y9bmLHzhGCHA/d6sRR2kUNGAUs5rah7X0T+8qF7rNTnYddGjJABVX+Krba7QxAIEh2ob5R3GlCfFo/N7g/ceOJE/aY7CH/TXBgpcxANcxmrbneLZa6l7YsiQ5acqU5HE/6+F5jzpAZOMg3JdmJCXdknvycMaC9+e7Hp4xZN/kZY5Hr/t6LYpQLYGFz81mpO7NLph+beqi2dMGL093n9N16tk7S09f7adRCguSNxgzhmG7r5yaNf3+vEmDbll6zOw6bd7CE7Mu4FZMi4HJyxjA6Axtejr/9uP5F4ccPHN08Mybi5aeu5uyIrrVA+aMMAObGfXEWHZLdwvfb+6gA4tbXHy3bu6iw04JXtCjZjNjtH10ZILbkuZK1WFDLnOc0+BwcWRwLC7BQBUwTEPGEYSTbXf3799fvbQ8wkVaikWyV3AgDgsgXqsIXksPksx7BaXEVr0jLUrR6dLUUaN5reziQS7vUlysO+SIIlqxu0dlAwPLrlGRuk9RVN5BEIAkDIYxTo7zIA28PrFeax0br7XvikZ3FvKRMb17BYHBQBBNhhug1nw+UYRh2IfgDck3IkeQvUmCBGTnNjQ1AKakRrPaUgNBTKiEVvzDHKFQqPMFYQg5C5aKrlMQBKF/BJkoCDV2tMdawZiQ05nv1ybgFGRCTQmsaegJXYdMEEVBzfkbXuqtTGcwvUsAAAAASUVORK5CYII="},8962:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAA9AACkAAAyAABCAADgAAAsAAAjAADIAACXAABOAAARAADjAACwAACrAACJAABgAAA2AAAXAAByAADnAQDMAAB+AABUAAAvAAAeAABsAAAIAAD1BABGAQDrAAC7AABJAAA5AAAoAABoAQG1AgCfAQCNAAB6AABaAADXAADUAACQAADvAQC4AACFAAC+BADbAADQAADBAACtAACTAAD1DgDwCwDdAACoAABdAAD//v3+8OWbBQHDAQCEAACCAAD98u/96dr53dX948rikXzYDgT2PAD0LQB1AAD+8uvy2NPzx8DzyLT8z6b2tKTUqaPrrqLxn4r6q4TLeXLccWPGX0n0cUjgYkbPXUD4gz3lSjzLSjO/NS6ZKybwTyTPIhmnGxG7JQyvEwh6CAfDKwaoDQbKDgH2VwD2QQD1HQDhCwDdBwDy0sn82rrit7H1x6D6t5fbmpD6sI7xqY7LkYjrl4bzg3e8fXf1lHPLhm7qalbMZlT5glOIVUfWUUTuYT/zeDi4UzigPTi2PDTtXy+gLif3WB7iMhqVHhTrOA6eEQ25EAxyDgvTFQjrFwd+JQX3YgK1PgH3RgDoLgCGLABPErVgAAAC7ElEQVQ4y9WS1a4bQQxAZ2ZnmZmShWQpfAMNlJmZmZmZmZk/uNuqb/2C+sGSdY5tyTL4z4LnNQdzVcwVioJd/h+uQmwNW3qRJ6K1MMyK6l/F/9uOIcT1Ymgw3d54YLOJrnLuH6Lx/m+uRxnTa0ntcRXQJ+ctMipkFnnu737adXkcLelO51Xmrfl+9lhpfzm7uizaIuZi2gUF5SyZcV1mXKlU1pz5+q0Ufp5ZXakIxgRByMbAc7yUW9KVUaddGqt/4Fg5fW4cNNi6slan5BxgAs3yEU1ApR8Ewfg8QwoXzgmSrtIQuhqWAFW1VFbSaIhClDYDhgna5y/0bQfXqzXf5y1A25hCulNVGqSULyI/77+//0jfsrmhJOOY0AigRgRdEHoYMr21erLq9rr5SzcclEaQZZEoQ40HMKI03s0aZkfU6/qh5cs2XVq3pZ5XF6ds0op1F0S2q2memSIUJkn4YsGyFSsWbDmBuixrZWKEcoBYjVfZQdg78ubW7uN35m/YtnnB+lfMsaMLF8steyqCpyd9H9rWqSdX923ctfLK8qO9Dzvmb1x54OW2PUihWilY8Iz3aZrWHt3Yfv31vhVLn3ffX5u/6eHuzdvvwcJVcrD+EA/8Gq8Rbx8cfrd359aLNy8vX3lg7+G7Bz8qkC4Wgx0nfKD5hJwjlIQym+5cuuyxKKWrPg07fY+yLbBwxgNa0xtmeZlFTIJObd3DmH2yL5pCgGI1AjJH03W4UBCayBNNZiDvOs6Y5VE6RjsYxREHdIXjlsiSYQwW260OkqzTLTZpisqo0UwVT0SAGUxZaSrOmR6siz05Q6syT5pj7Co7ypApCMAgSXKuaTIyVKE9s5UsXTvz8nqd7QyYRtBuA3IikAJJmsORgnH581EVw1glsMWQRiD8mWAYv6dMJI5SYwyhqkLoqATBdcPm3NwECMKfHWGLo2s1ynEIgigpRVAUgQvPkkFj0mgumlpcTFElpN2aQ9R+q4RTJsqhfgHJO3I6nMyA7AAAAABJRU5ErkJggg=="},2723:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACf1BMVEUAAAABAEACAEYAACUAADgAADEAACsAAC9SAJYAAAwGAFgdAKpaAYUAADUAACAAABMDAE8JAHEFAGADAFQBABgCABBOAJ0MAIwCAEw6AK0XAKQVAF0KADNDAKAPAJxWAJEYAI4TAIgKAIUMAHtsDWULAEgDADz98+0pALI+AKUlAaQrAKEfAKESAIQTBHgfAXYtAW00BmsGAGoHAGUMAGP//v40ALcuBKgzAKAbAJ4pAJ05AJscApglAJhEAJUSAJEkAo1YAIwZAIoKAIATAH4rBHsWAHNmB24SA2odAVyEHDeOIisAABz38fTr3uX95tYyAK0kAKxJAKRKAJnus5IbAJFMAZBVAotJBYdeB31iBXc+CW0fBWtYCWoTAGVAB2EsBl5WE1UVAlJxE1BWEEwNAECXJx+5PhrwZgvOTAr+7+bi2OT66eDjz9nIssvjy8mqlsW4qcT507mPdLjuw7C4jqs2CanZrKWldKNYO6BYHZyKU5uYZZoXAJotA5g+ApUlE5QyAZFCAo03Ao2GXIo8LYo4EolZEYk8B4ZRA4WGVHY2B3HXgGBnFF83CF9qEFoqBFJgEUyDHktKDkt7FUmBGUU0CUUkBkWNIjOLHzCIIS2SIyOmMB9sLBmqPxiXNhHXUgsSBwrSxeLDt9fNtdL84MzFoMChkrqLe7reuLjJnrKPeabCmqKMZp1rR503HZdeNJXVmpGxjI9POYswHIpJMIeSZoamaISUU4RlKIK/eXlAH3kyBHaLN3VdLHVXF3G8bWncimfqk2G/a2FvWGByHVvli1exWVd5G1F+M01tEkq8WEOpRT9lFjwlBDZ6HDVrGi7WZisSASQrCxLeVQOSa1CeAAADLklEQVQ4y9WN05ocURRGzzmlLnS53T1tG2Obse1kJrZt27Zt29YDpSbJXZ4g6+a/WGt/G/xn0AaVtPsRMjOybUyb4R+vh9DLxiWmedAG76KQiRnzN6H/jAHBAMwyw0Zt2/1172j/8EEjcVH9bVSB7sxsaPen0ckdLXt/gGNHWkfsb/0y3DzS0HmP8bwAUcPgHQdax477efSIVh862jG2dWxLGvrtGA9kkmpmxLoR+w+07BvX3n64M2jv2Ldzy6ghaXsgZQcZYs9msS45fPPolp27xnUctn//vOng9sZ1NTmm2UZu3QMQkfY3pzACjhwycKBv19vl77cMOOirH4pjEPKCfRggUQJPDVMxWL+sPjVk1JLZPp9v07YxBByKSJoWtgJMQWSVjUK5XtxD74oB2+/OXTC/f4PiX8y6IU6pFMDNBM9QTStCBYVDm8rXzArmdzl+tdyF98mz9nBDVQDQTKkGfvA6S4iVMtKqruOnnwpOa6pFnry8HjUBSQVmpU0QbP3LrNZQ4eK184ITu3UbPy1RrPlaU9QfawAbkoIBd3UvXHvv0fn7Iy7kTzp9ssuEW/0fP6hPeCoVlgUb39E0VDyDXsx8PeX2xZldrxTOnpE/Zdb6p3PuVMlYpRUE1xtojMeOvZzTu/e359263PAsnZo//dnGc72v2xk+6wUTVgmAxgSVunnpzceFMyZPOnOi69TLKz9cmzeYCWCMB5xN0ECgCbfXWra6yJRXNTc4cUEktmjNfDbqsJFKLSiTtRdtNmOYZU3dLT2sSycvtFgc/SrYMNeYxnEzMIk8n4WpaqcjlmELCgpMK1eXhsORkijna0ziogIkWVTi7iqOK42LlSErW/vE3SfaM5J19e3bR5YiZaC0KOaKFbPGilwgV9LdbSp+VSdF+pYyyFVpKq7o1w9wTp2uZ9hiiUMcMrKSrUtLstSUy9SUFC3pNaBxINBpaI2l3CUjDbMZIYjjetSwnOO4amc14HTVHKfTGXUliNTjCA/ocQgpvV4vJpdV9DIagdOpWaMjWiNiGEVRhF6DICiCpAjIZLxx4DD2dBSVJ0ScJAmC4Ns0gWloQ2oQ1C83prpOjqKhXgAAAABJRU5ErkJggg=="},6178:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACxFBMVEX2AABM/7v4jQBe/z9M/8JM/6z4nQJL/7RQ/2FR/1H3qQP4hABM/5Fh/VZ4/CzdFCPzSwL4lgH3cQD2FgBL/ONM/89M/51L/n9N/nhS/UZ9+UK7vSS05B/kqgz5sgP2NQA9vvVD0OpL/shM/6Zl16FM/25b/Gll/kmK/SqW9Cp//Smv1SXd2RLUwBDXlg/11gznGgf5vwXzewP4ogH1JAH2ZQD1WwD3QAA4tfw+yftL7dxL/NZU/JZN/4R98nSK32esSV6S0FCN+UZR/z5+3jl7+zeO+jWftTRb/yya7Suq/CapxSTPQiC1yRzC6xvEehnH4BjM0hbCkRXVsRPhJRLYcQ3ptgnfMAnsjwXxigXwYwPxMgMrT/5D3vc/wehM39uBRLdN1Zha+I571oaEeYRW/oGmGoCTL35/4HWyL2eB+mZd/WB36F/tAFxT8Vhl8Fd+6U2cfkhc50fANENa9EDPHz6F8Dyf5Dmq1zla/zZv5ja2xi7HYCuD6iij5ii9WyX0ACSw8yPOxB7OsBrP7hnoBxbchhLYzBDy3Q/j0A7fsQzjnAztCAr1zAn0vAfvbQMnPf4wcv0nHf0yDf0ylPc2buVK5M5Cws14K8dWV8RDz7tP87dg17d1WrdenrZJu61W7KZsjZN3y4Rz7n9o/Xxj8nzgA3uJhndX/3JU6nHHEnCUeG2F12h3tWGVz15w+1yPv1unfVt21Fier1idaU7zAEKX5UGsyEFx+z622j67Pj2RwjiKuTdk/zC1qzCpuCjPNyiX4iS2eSDTfRnk6hbFpBXLbxTZuQ/Zpg7kvw3gSg3mkgnqYQfpeQZI8PFRRORVW9VIedN3FsxX9cpgc8VlIbNhvbFF47BN54lxpolwuohSu4Vh2HByvXCiZm6Vn2Z5k2atcU+AnU6aqjyI4Tpm8TST1jOiiyefrx/EwxbsPAX4eAAG0MznAAADV0lEQVQ4y9WM03pjYRiF/2QnaezGbOxJGtS2bWtqT227Y9u2bdu25yZmt0/P5gpmHX3P975rgf8s8zJTo7ovJyT083/+6E6d9w+/bpy6xA3ojT+1xUdzEtsWHTunMObqCSnjQkF8Ye7zD+sl8j7fbafuXEudJVQHY4Z/Sdy/Vl67WSppAJRVEnmOu3R/YmjSTJ9ut2XG3jrevNlN4rZs8cJVsD1/YZabu5t0izHh+m0biEOm+/OHQ+Q5kmz3RUuWPJsRFme5Zy/3eFJ6JXbvEBDQzpeOavz9S+XS+9mLspZ1RH3asDSHieAJ+CdOEA4eAWPpvn0tvtO0FP5GT08P6YqCXI8XS5f76NLoQiHVMVQIkIldab6FVLqwfGd5+ZpctsKDuXr12n6a8cJNi9UqPgLo+lv3KkPvjfFlCJ/w4jUrNhW9euvVrO+vCQwyjqdRk4FoBJNxPjlyK1aBbdFhN74fBBMXD5J4sW3nWklfb2aKgXkESRXb/dFsHLdLEBFJOba9qud2nCaxM+wcLmgoNBWMXrU7qO1eUCuEq67ednbwWFVVT1QXpA0LU5NrrjWeBZW1DvGdkwrsrjfr/fJed4AFfqcHk8683He4NoRM7msMBCs3MRjCX53v1u1+vGCP325KUHV9HWztWFdWVBNpIbeCnkNWRobdlnSxrKTkwUrKxAVtWzfYnpdXVtJwJfquTg2SzmQC67T4d/L3uqeP9tQ1UDqiKEc/73g4f187f5werQWXL1mBg5EcFA417lKqw+qPTlA+cnFQfj5XSWwnGDTgW5wYZFBDZd6BXK2Cw4XqTxdx2EQEC8d2YfqIXEcBedhmizbuRSGIUC+Oo8CSDx329vbGVmBdmJ4Boht6EBFn0GtCDjg7F3cOB+OgQHV+MK+CSIppQrNUMb0kFSjYqeJBEA7tpRNGVijVWtWGgAgSujh+jBdMVnmhUMAFgUDIiGxOyBRepB+4OhBQGREjaNHF8JQcosyTyQQIJ9hwQrNJwQOTJpNpxGSaNIvwrinNBShnZ5fZBfhwgkO6QcDjJ6fMeJHZjHHFYwzHt7JkaDRAoZzgAZayyUD/Q0DSaBgYumKQGAISkxIvCG8CLDSLyDkQbsDDHxqNbrekp1mmM+5a0pEEAhLOX/KQAIVSSOoqAAAAAElFTkSuQmCC"},904:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACtVBMVEUHAH8VBPMUAup4/5dx/6Cn/WATAeMWAvsdMPN0/5wRAtVm+LRu/6V//o5+BgIXDPsVAu8PA8le+sNg9L8JA5chSPsYFPpJ5OgXHNpU6tVU29ERBc8NAbZs/qqI84eH/4We/WscLvsgPPo7vfgylfgoYvhAy/I1l/IZHvEnW+syd+oYG+pFz+c6oeQdLeJL3uBP3NhY+MxW5ssYK8Jm6rIMA68NEowbJ/kqcPgfOfExgO88rOwbKew6lug/qOUlN+VI1ONGx+M0a+EtX+ETBN5LztoaKdofRco4bcgQC8VVo8Fe378OAr1ctKwLAah16KAKA59nnp0IAY19fnDm6yKAHhUznfwkVvo1ovktf/kwh/cmWvNC0/I5q/Izh+8/v+4zj+0iSOw+supK3uQlWOMXEOMoUOAZGeBLvd4UDN5Q8d1Cl9sfQNpEq9dHutZM0tQxctQTEdJBhdEcLMtJkchUuMVc7cRLnsNIgMJPqsBavb4eRLoPDbpFe7Vo/7Bt8qgOEKR31J0eR514+poSIJF82omO+X5zaHKc9W2GuGldN2aRklay/lXJ8TyyoDqDSDKcUCLTkBWwXA+HEgOjBwCSBAAvjvwaHPspavhG2+06pew5huQ1Wd8pVts1gNowaNhQtM9OoMs7kctW0sVc1sIQEMAxd7sXKrpg6rlv+KZrzqRutKJwxZsTFZYhQpGN6XmV/XaFo3RuY1++/UlqI0etv0SHXD+TXTRzMTTMwy2pgCzb6SrFkByDLBz01Q+vKwetEQBDw+lV+tNLoc84Wcw9gMNdrrQcObQlWa8THK9HZK5Zlq1jo6t24JpJipo0ZZV565N8xo84RH0eIHxfTHOX0G6Jjm56cVyAfll5b1Wlv1JwSFC51kmBPEi/30aNezySNht2EhqVIhmuRg72xgmVGQHHHABfgbLgAAADTklEQVQ4y9XL03pcYQCF4X9rOnvUsW17Gtt2bce2k8ZGbdu2bdu4ju706VmvoOv0/Rb4zzaFe7Ct7U5cXMHikl1tK6b847tjjfMXhaxRR9ZVzpgnClpc/zfJ/HuP4y+zzAq41dnxqAc7EFZRt2FJwYo/kizlTvgue83TA/kpSuwZeH4S29eNHa4gxxMFF1BYkpZ64/pNDzCsfyA7+x1Rv84+34/1K+vK427fZQF1dO7NpeT5rRimxAYu/RgkgreXzmNH5PIntZ76aiHQwTcS/eaWlSXu7z6iHMj+dOjQ447jSkVz6KyNJZspNY0geEliWGSFBOYvTaPTFcpO72E5cpxeGbWMYrE0SMtTACk4cEl1ipRiKRRvuf6wk+NSKOTyjjCSfbOdkp7uawSUAGNpUXxp8GJqe2VgUnt3T1/PPq9ZFVa81hYrFPo8AOLDrI2eku0ilyjS7Ez7PMZgnMmIWecp0sx22OypqWDSalKyL3lbMztP4D/NPz5n/NeVlScWzLAb9BpHYeymFuCnYkmlUd55+tl5TvGO+2Pj40Rgtmo1mlXTiwus28CWQmmqMMglSmp9efrc/l7GxVNDjK+N3ozE/LlT5wQsEoCRo9xM4QJtyuD3kS9Zpy/nbBWJjzG+nXo1ONy33CQJ0oOVXdzMnQ0JB3uHR0fPjvxk3NOGvmdcvnBhePRjualh1gyQU5MO0hNSW3aXdZ38kJU1dLH3TM6xjKyz5zI2LF0mWbAKvDBzgY/rsQXqI3a4tZrlbxhjRx3h89LSBGJOFClgJljI82UmJMfLOAKBtootmL18qI/DpqJUBxuhV0OQH5hKlrBMsbU4TrXqHGzXtaldtRwORxTjRBT0fIjsB/x5ZNVMQxGCJM0nz8nTr53Zagh1NoVPC93bvJCnc0aAPe7wIKt1EW2PyRJV7DZMj5CHrAnfW6U2Lpwz/aoXxwGCo6iMynYZJkOQSq3ihWz15+kiTdNsYneVjK6gA5SGojhKY8es400mtprPnzxpEsTkm5PaEQTBEYCgCB1BURotJpgEMQmcGESMvH47VSajARwnVEYV28iUaBLMhCeMCcNMEgwZ1bq5IaCJ1kR1RwSSIUKZMIUVnSuUsBJ2lubCJBIMw9G/AXbV85RKPEmDAAAAAElFTkSuQmCC"},6446:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACmlBMVEUAAAAINTUMP0FvA+9mDOcGLCtNLscEIiIBCQwIMTFqCepDO7w9QbU7Rq8BEhIFJycBGBhiE+FVJNIQTU9aHdZTJ84QLkI2T6cmVoYmT4MHLy8HEBpdGdwtU5UaWWoTN00QQkwOREYONkF3APKSEck3SacyU6UtWZ4rQoO+QnQbOF8VUFwTS1YUP1MUJUULPTwJOjkLMDgOJTj//v358/V6C9yIDtORDNFNLb9FMrE/O7BDJKI8YpszRpsyQpYvTpUoYJEmZo0qVo0kZIcpO3wfUXQlQHQcS2oXVGEaQWETVFgOSkn88ezt4+tqD992DtZYHM795MqMGceXFMWCGcKhksFINL9ORLRgKLJJRLFQH6v2zag8QKc9NqYwT5s4MpdRc5SuMZEtPo46NIwqMnkeZXfaf3UrJnUkOHMpLm4YXWQWS1wRRk8ZFUV/Aezk4up4COX+8OTj1OSHBOONBtr969fNwNRpHM/hw865vch2IsPAqr/XsL6qdb5sL75ENblNN7ZqF7aGd7XotLSXlbLkrbChIbB0KK5dJK5HJK1sdKxHL6i/caWWhKSVip7Se5lIapdGSJZSMZZSYJMwSpAuN4o9LYU0JYQoXoAjXHkeQWwiNmwZMFLTV0gfDDYNFSsOChf15enXzunSueHBid7Iz9ltJNWyqtTJptSZWdRrRcxjHcvk0se8wcKos8FsGsCWqb9eMb+aYb1qW7z827nUmrZRJrTGpK2RRq2rfKlmOamxVahySKivnZ1ghZxuFZxINppRJZmmRJg/J5ivVpVqX5Q6Q5SQcZFgO5E8WY6+aoyAe4aiOYNBGYPHWYIgb34iTXiDTXQtVHFxaW2FLG2SMGwkYGrDSWolImgsDmCWRTzdZDRvNTFgLTDQUIJRAAADMklEQVQ4y9WQ07IdURRFd+/2aZ8+tu1r27HNa8S2bdu2bdvGv6STt1S+ILNqrVW1xnia4D8LxZt3d8R0rvZwzZcOM/UPT7mgkbVWtJVfyjF4iaJw7G+FskMdrKoZkDH35W3PkujIOZVJu/kPEUXqN2+xb5rbb8O6TM8usOejp1+vrF4joy17FABIkjTHHIHA3Z4ez/DPwQ+K/TMY7JnVM3O5bkdqNwmqTfTmUHtpvx5ZEyYM3/n9myL82BnMGt81o8vSVOy+DtiQljzZsHHknSWZo8YPD77o2PV18aIebqmgKlRfj29qAs5kXqh8qIDA0HEUHZPZq1vXjMmLui6tTOIQkmJsAMAdgWTeAFGAg/sMGjw5gyDGuKdNO72D1m234xTFbwZCrRMf3GRy1Fi65BiJLj3OzTx6TBOI2HO4EToXIqZAXEbIUKo5myCI8krm0IFOaen7zucW6Ib69bNHQJ4HUKZFnhwqqRn2ja1hWOeJAy90mvppi9Pg8zOFrmYzkGtJUdzezafXM/37Zy/rNLF797Ent3jL/P6y4hz7oHqw9pHII0MIpu+NK9NXPFmQNu7I/vTRw84+XP/UUGKN5LKg8S1FwYhh3Yr5jVNWXR7YeU3fvr3TTkx//GzG1UFVeJEPjH3OU4JS9/sZC+e/auyefqskf2rawNWrpyy8qQuTttdg9DAeUAJvptcsuH5vZe9J404d7Hx43soHF5e9q3EJbWXgzFYK8FRyhNGn7z/H4M/vnb53Hsf5Zs1i+2ia8agB5FfzgBSbJDXHlRBaRp8/aaZWrcE0rFrlXg4RGZTIJFnlykNRjdfGqrVE8ar1WrVSCoOOQgvjDhk0VLfXGktzUZQwRqyMniu7Zh3CWFhboWTRt1YwHNAS3BCOYzFNJdw2mygt9i62NrCSNgILrMVeDaYCqEqlwjRqbSlMwHC4trVo7dbWivJttoI+hFZC3W6AYSpMUdRsUbXTWVcny3V1MI4gMNANQ1FUhQJllIthWK4DTySccZhIQIgoiW7MtkgYBlAUU2LJLnQIOE7TNPInNIKbENhWYdwAJEyyEJwxGlc+NCKQuMIEATfRNI6blP0L9GTBDZUfhasAAAAASUVORK5CYII="},6206:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACoFBMVEUAAABDFU9MDU88iDVgXqZAH1QeAx0KBg8/kDhra7pVVJI8JlkxKVM3IU5DPXZIJ2E6gTRRUoU9NmxHMGg2MF9AEkk9ezsTEhj59O5ob6ZYaYlJQX1OWXxIRXlUf3JNdWhAMWdKbGRIblxGelZHF1U6IFJcwFEsIUETBxdoca1gaJ1idJlaYpdaaY9Yb4ZMSoRXd31OZXZEN29LOWdUlGIzLFlGZ1ZQp0dJB0ZEjEVGnT8zFD86Cz8vDjYfESv++/nj4NpydKBdXqBVWYxRTYxxjYFYaIFPaXNReHFMYW5IUWxJQ2ZDO2Y+L2BCRF1GI1xKg1lSmFdTq1JKh1FcxU9Yy01ABz8qIDooEjUpBSju7OL039He2tHDw8aqprNna67MyaZjaaVbWZ7srJpcaJXZx5JecI5XX41vcYdSWoZhdYBSYoBehH1MT3lSbnhMO3RFQ3FPcHBITWZOfGRNZ2OTvV9FU11HXlpFcVVASFFLGVHNxE9Rkk9Ef01DdE1GEE1Z00xZuEs3F0dAgEQpKkFAlTkzBzQ4ejMhIy8zAS0PAA7S0cnGvsFubr+Qkq51c67Eu6Cyrp+YnJmtnInhs4iMsYaekIONg31PS3RLVXN1pGpPW2ZUg2Jfh15bol1YfFtMRVvEr1pSi1rG0FlXsldEM1c8QFa/1FRmtlSr1VCiylCFzk9rxU5OoEpNl0gyHUZhXy8ZDCIkOSEZIx/m5+Z4eNB6fLv1xLq1sLjYwK/vuK2op6h/hqDY1J+ux5TNt5KDgpFpZ5GdsYfBv4Xlm4KUmH2epHp3dXWRkGyhsWa2umXNuWOtmWB6Z2Cmoluex1qAglmCklhrrldHgFbaeVY4LlWptVS7oVOQyVKOpUxnzktBXUuApUU3X0E4TkCVkj8EsvciAAADTklEQVQ4y9WMU58bYRhH35nMTDixbTtpsuHa9m5ta217a9u2bdv2V+m0v/aqn6D/m+finPOA/2xkskg03M9g8LkK/rCI/A83Geg0yxyXN6dOxbEvTGH2/1H+Hga9tXBxXt3e9m/Hjf68emWtPl/0m4yMjP7iLaxAsX/eVuPR00D09ajfWLZ3C2s/YYyCwcEErD9/U86O7vLuF3sOfCLskwcOfS7vNrrxd8PxCsAUwI378uf4y8uNZR/b2n78EtoOl/WUlBQHKk1NrcAF79SqObVbVLvLeoyHDzWcOXO69MjBcEiu8O3MjTS1ABas2d/YVKGn+/zhcLDndV0w2H7kmDYXqkAL41hlJ4BZC6BAZ3WCPtOdqSkume8uCW7fvH2foNXHipLJ2HcQ9dKjngJBoa+jvWaBsvjgutvr0pULuPRsCwfFe09FgIEPVfAqc7WZmpm1i2y7r4sTE5PSPXLTLOoyaQ7djAEGXzCCVTeWNkskabK05LGX394dN0FBYyHLqI5NeJ4ZqLmD1VjuVuskqm2mTblcPG3atAsTaFSESp2KZOPWAjA3A8NMdqdzfvqrlU+3XUkcP3mJOGn2/AezM1IRhEc9Bz68JAOGd2r9oxm7xq9ZuTYpOfn8RPGlVQ+f37g/U1GFUMG4DWZyVTwuejZ5xrU9T8aJryIrJiSu3fV48ow1Jm9cRgNnk83AXIWdqry1uqFh/cQlSRfHj126fP37Ozc35qGxRVPBRJoZYKMmWtoUyVx3ClWySjx2tcQ2ZdsOq0dXIODRwCQmBmLVLcJmiyWlRmuZtGLpPXdAFyrKyDoe1uJ6NUDUsZgM/UIh6aa4HIEaJ7JhtjJLZXM6KcFj2QaWGrhkPC6Hk02haGnqFKlVQktPnbewU8qUlxZJmQqPAzRrrPbp06V9usWoL6M+FXFsnpUm7cvysux2ZPqbUAhQSCSSUKfSpNJRlMvkMuVzXbLFBYtk8oVZytKB8ABgs9kkEntI5ZjFHEOMz+ePYeAoRN+oC1EGiJj4QKFQhthsoScfQvV0A8NgYDAgYrwcTVGfcAgQOYkt7Micw0uAYZgAKI7jJ3pPdMH6Qq6CIwcdQmGRah6Hhwq6IKg3Gk2AoUisKhKBYCLoggU/Aep54rZnCVVxAAAAAElFTkSuQmCC"},2489:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACqVBMVEUAAAAqpB4sqh1iAphdApsmeMorlrA1E69zAJMupVguqkhEBaVVAZ0voZwskJstpjIjYq8lAq81AqZpAJcunJIup2Irpj0pBz0rqBooWbg7JbFHHqZNAqFOEKBYApVsApMwpI9lAYxAYXlgAHkso3NWAW46zCAxuBsFDBMsL74mObkrWK08PKUya5g9QZVfEY9NBIw9F4k5SIhpAIUupIMrlX9LBHoskHY1dGk2hWcvm0490DAtrCkroygJGBojZ9DLyMYqjcQylb/JxL4jJL4neLcxb7O+wbEnP6kxoacocqcohqZMH5sxVZopb5UseY0qiYsrgXqqsHkzBm4mL2wqHGssnGorn0Z30TUOAyk92yNE1CNA4SIvshwRAhsdRckjPckaEMAsFrmqurYwm7QyRrKAma61u6gpMag6I6YnaKJVGaIofKFcnpertJU4SZQqkJDIlIwxWYsuLIMvdX97lnhBBXEtqW49Hm5MrWosgmXTbmEsn2BLAV4oB1dDAFYwA0inuzY1sDU2wTIhAywytyV56SE81yGj8h+P8B8NKhwnbLzJw7WZm7FEirA5HJ3OrpxChZo4O5p1o5ZGNpaRppNCI5KhspBSI45BOIsrl4h4r4RdfXzSh3swZHpDS3QqjmeCt2WwtWTPlGQ7VWR2k2IpmGBjvF85Yl41lluHo1oYMFcbJVJErk00fk1Dwkw5pkQ8vT6PtzwRMTA0uSs1xCpV5yJedhoXPhrc7RgjWcUkar9JdrtCZ7qWrbR/gJ9DbpsZIpUlEZQdVI5HQ4xJlIUjZ4F1aXxWP3qdhHhIHHjCx3EsVHG8xWu/q2efn2dIlGZhYWYjU2A3clsbVFYrGlBkoU0WOUm9yD4gazuRmTjZTzi5mTWZ3itduiYfACVwuB/I8RyPrxtXnw92AAADUUlEQVQ4y9WN45IcYRSGv+me6Z7uYcY2MrZnbVvZ7Mb22nZs27Zt28aVpDeVf7mCPFXnVJ163rcO+M8YWxE7cvp9ce3NmbffnI4d+48/4uKweWyzZEFLgThLl5V++G+k+m+9WO6Qz5wV6mV9jKkMZ9f57HBt7B+jbe8j9NhX2ZoTB2eHDJUXQOyPSiwy2KuRPiES34Ha4xEeRnNqQuPHjR8YGvpGdM4PDRNHJOAqPvLWA0ywcs9GlI2NG2cYHLh48ddo4OfwoKH3DCtYUhx0gInwgyBq0WgKDkYMhoHh8pGRCz3nKo2sXOsat9up2QOkyuA69zY1WbYGr6oyGiJl/f0nz51pscNqGq2h/dExwJXmKA4c01Pldb68e/jZxsazxpPH8Q0Kx51sp1DYeQCoJ6OOuu0OuVXQU2DR9UT279zfjOWg60IM2waXs6MJ0MfQPfYmd4uvUbdgAe/EziXx8VPu5s8uyUtANtmWC7sAbQys1es1OKZiTDNPuJq29XPriqXJl2alJibw8lw1QoBO8uj19jAydaqKxyudt6R1a+uipWKEkpAQRwnUMreB/Fx9uytF5/U2v3v+6cX1+Bnr5ydNucHfsnKumJIiYWaAL3v7qm/NXBw69ax7fn3h7hnLVIzpSYvW7j1VeIiZXpSKgEVbKqqLOoqELwufPv76YUXSlbjEa/G7u7sLdz1sMndMiwNpyyqAsKirqyR1dXl5/er5M6ZPSVs7r7581zzrKrnfSgHTxRWgs6/EJkYQlfdy4tTNSWmbGQzk6NGMQNlGpVQMEk2d1X7tdlYZg0HRtTGQjPWH+BgexVX8qDEoI6OAItE2pGe/hiCcOZHH5+so91fyMcy7yQsZ+3Nl0slggkky2cIugKB9qWiKCsmIa86c7RMsNGWy8LnJZh8ThPcxM5lMXkzZKrk9ULqYknWcPXEhq00yZ24KJSscjQIIIpFiBFgbm0aXocmTJrHzJpjS3VZzbqCUL6gyVgHCi4jBFmYmczhjRuHQZHSYlhOOQpBIJALEhkQkgvzlSrKMQ6PR6RwOFybDc2p24KwYEiDk6I8dtllqqpJLGDKZTnYqFFQqd45kmsUGBCSWoDTfIqWrqTCs0GqVZLLf729wKrhUAi78Gx5i6x+jvtqtAAAAAElFTkSuQmCC"},9662:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAxlBMVEX3APz4cYj4V6D3A+T5dYT3BuH3Bej4XZv3Ra/4U6P3D9v4T6f4ZJT3GtP3OLv3AO73A/P3QbX3Kcj4a433C973FNn3JMv4fH33McL4YZf4Z5H5h3P3S6v4eYD3H9D3M7/3P7T9+B73Pbf5g3f6olv3Et/3Gtz3Hdj3Ftb3LMT5kGz84C/6m2T6rVX80Dz98yH3Cu33Hc/5i3D6mGj7sk77uk37xkH82DT97CX6plv7vkb+/hz3D+f3I9X3L8n5bJL6omL85yoC7QzSAAACeUlEQVQ4y9WSVY4cMRRFbZfLDMWMzdzT3AOh/W8qnslXlBXkyHpXeud+WJbBf0YQvMwX35ZL3UXfly/BP34uhEGs6HqKTEPDbPl3JVgKkUYdyuOwqtWpoUXSvXwZa798sWKxYmhafwMfeV1N65zp4qtBrLXL1WTCz+fz5XWG3UrOZuf6PEVpt/iwIPP8SaaHqnbsrtfcFdB+VudtC/liwQRY+2upJ5OBl9NpvZttlovvcDNtIYuyvvcGA1JfZj0jvojits2nucIt3mBeJEQIYlMOvJVJGmQ9ISmXMK9UnrcYnjyxTr0gsAaQLvVk4aVRDLkpcb3b73BstEYoTIVP5iBZ+SSbF5Sqsi8QfhvfxwfmbMEa6So2cAXPWjLEFUV91NPn+HyOt8LoQTLERE+A7qy166qRklJa4nE8HsfbIIemMSHS0gDe2GDOSqrazf2qLu/b++G4VTEs5RCyE0fghoNg0Rm6375tL2/bZ1mqn+/b62Z/eOURCSUYpwEghHz8ODwe1/vx+CNEt/df97fH4zXNSGTALxqAgLivgHazy+71sN0fnrd6M7vnJhMkm4CfJgAWzAcjOaVhw/fj8YKQhBjRKvK0ATKzgNgCVu5lSoUkOswqd8cYVbiVia9BqAmJ0gbjmK+RUmW4oapSFFGctyzRGvSZ7kzIMS4nmlHJDWQMxShiMG6iAnGgKGecI1itRYRoGPKcFQiqTjQslBWEAEMMYaxUKPzklHXRIPus6KOI0VLBNm8B/IPiLEsderUSSeL7wiiIPwH4M6EDac9PnHRDeL7v6wmN3Rr8sTFlmhDP4X/iwh1xWpsBfNqSG518OWJdEIdrONz8DcHFP4n/xvdzAAAAAElFTkSuQmCC"},8774:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAb1BMVEUigWcvjmdrsmhkr2hfrGhTpWg7lmc0kmdDm2d8u2lKn2gqiWeAvmksi2c4k2dZqGhxtWgmhmeNxWl1uGh5umhPomiFwWio02mZy2iy2Gj3/Gni8WnR6Gmhz2jy+Wnr9mnZ7GnI42nC4Gm83Wn+/2rMqbF9AAACIUlEQVQ4y9VRC67cIAwEG4MhBEiA/Pa/2/ufsc4+qVLVE3QUJbZnYsNY/WeYpkEna+VhTsP0D6+dC0jBBsCQgTj9LZmSc44tLpXKDDZD0Hb4Mj+9ppByLYTzbJVe5rLMS7Zh+AqGYUqpn9y8rWuUEq43SRZM1o2DsloTW6pSmbd9X0QA6zovMXrjUnaKdTC2EyGI4rZuyXHb5tgycwgjdeW04ZBH7bjGKKNLjHGLGLSUhsGhGlPXGSU0YExdCkRBszpxGsUaUqOVHkHy2jCAn2/7LdZuLRpKWg9a/NGD1QEEIaB/H7+OZzTkcjZIbpq+gmmgWhADB3gcj8fxDiFRziIQK5IVnks2BgTLcb/fjzeZnnMnTKYrzNOk88ltr72svy6v6/1SqgdDRNag+og1znbYn+/L7X15AJyqz7ZfV8MjGXXM02n36K/X5/66H63j59fj9Xk+d5nOQV1gUtMoY1BsvK3Xy359fGQrr6WzG7mrtSsld6FwnrJnsx/3DY3xHrHIyrsyfI4I5zUJChq4rqWUVlE8N1on1e0wsJM/qmEsALQBFFGjX2LWyarAyXYyMUK3JL17o4wVOdeamdEoACMmYSvsGIHILMSmgXVZ4uK98t63WgqQ09oKyATLgTkjQJXFKt+8oAESO0FKyWmBC+Bj9N8OP0HDNEpd2PMlsAS1taaE8q1VIDuMovgDSZzlTqq2WkHman3Sw6kaBZL+fH4Dv4kk7qhIC7sAAAAASUVORK5CYII="},7990:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAe1BMVEUYAP4YEPMYGe8idcUeXdAcU9UYBPkbRdsYI+sfZM0YKucaOeAgacocTNcYCvYYH+wke8IdWNImiLwZM+QiccchbcgaPd4aQdwlf8Awpa4yr6o2vaMojblI+Ycun7E7zptG9Iork7csmrM+2JdA4JNC5ZFE7Y1K/4U4xJ9hpzG+AAACLUlEQVQ4y9WSR7LcMAwFGQAxZ+UwOfj+JzTm12xsn8C9UYlsvYIAsP+MrosiaZ20bS3x7p97IcRYlLMOYESjrP5T6TQJzcI8KF+9RXBcx2/wx+xcUoMPUKtlfK6+1jkkxxkRydBJTbDX/bYsko5wOe37XiFpQaVYzier1VD3Wm/rOpMA66nOOUsUKXDmuEM9KVVMnettuSbR+mvNfWjWOa5GJjhaFzgXdsh5rrOnT6+5OB6FiJ0ojOtJhBKjQEDsZ+9nSu81F9QLKm9kUVOG48n2soxG1tN6ysOodSkqCYphPPFouQMwZnQgt+N93HMJIgQEJagH4pMUVe+huObM6/J8HZsb04SBBBeZttQJ5xERKCUfx+VybAqnECZVNI6shK4TwdDd/ms1p/fjfL88/SANKhU0AtsyCXaC9bE9btvjZYxZ3o/tup4XbFwhO2rX8Rj5cL7f11+XS69gez9/bfSWbGwje5qOdZxWAU7L7bScn+v5te3X5TyPVnA7sWUkgQk1YjFGYVmPyw0AZQbwjeuRoe1oou7zm8p4QDgvnmocipcZhdBM6cibQCkHbOAp5GqM9wAg5xyE1sxZTcMkwUxaAeIkVYABWugHtA6QGVNCQZDeiQagFGblSm9sCkGhl5JJoh+8UbST1tqm0NEitBbA+D7PmYQffAlWpPRZ+0QqFzRZmeVPwpeiaWu+cEJPMPR9/xUGUJra+YUCfh7WTYr1VIHBSdMRETv+F78BzJImqyQDEWEAAAAASUVORK5CYII="},1972:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM1IiBoZWlnaHQ9IjE0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBmaWxsPSIjZmZmIj48cmVjdCB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTIwOzExMDsxMDA7OTA7ODA7NzA7NjA7NTA7NDA7MTQwOzEyMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ5IiBiZWdpbj0iMC41cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSIzMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMjA7MTEwOzEwMDs5MDs4MDs3MDs2MDs1MDs0MDsxNDA7MTIwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InkiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSI2MCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjE0MCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjkwIiB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjEyMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTA7MTU7MjA7MjU7MzA7MzU7NDA7NDU7NTA7MDsxMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48L3JlY3Q+PC9zdmc+"},5738:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAAAqCAMAAACN4OndAAAAqFBMVEUAAADKysrLy8vT09PKysrKysrKysrPz8/KysrKysrMzMzLy8vLy8vKysrKysrJycnJycnKysrKysrLy8vKysrLy8vIyMjMzMzKysrMzMzLy8vMzMzLy8vLy8vKysrLy8vKysrHx8fLy8vKysrLy8vLy8vKysrJycnKysrKysrKysrLy8vKysrLy8vKysrKysrNzc3Pz8/R0dHU1NTW1tbT09PS0tLY2NiaiJAkAAAAL3RSTlMA9aMJ8eTaFuvfNxPGaYYiHfpCW/wnEHIwm0ltj3l+isMF1c2plrJGuDxPvVRfK+IvMiAAAATbSURBVFjDtdiLkpowFAbgg4iCgOIN76ugonhLUNT3f7NycmpbQrDu0P6zM0g2JB8hYBAwO41lsZrwYfTm59Ehl4ND0eFtZFWnVZ4X29XMT6O5kMuGY65r+JYqWGr1snRfPYzS5NOko1xP9pphbqdvquaclWSQzIDSWrY/zbKX66lVp7bgeyqIZ3LcDcNc57MxVI2bYFM8nL5LR1Kp49Ko96B6jpyGXXubE/i+rx9INcTPn6kCWwodp8vFgXTzPphItyQDhuFrcLKEYq+7dpz18iNVcxI28jnucMyPUmk4yY//klTrfkn2pNoDxzDa4zyJ8BY7rl6J+iqVv+eiPoU+D2KwWaGYHf0/VRp1tAB1/JBh0h1g3zRWmrNaOXOA6MapaewhcRWqoUmnXKN0hWUCdPt2IypdMYx2gd85E6oLJTmk1C6dSSzu1wbtTG/iyEbDojYChUrUNztAmV9RVYMaqpIaUDyDYcbwK8FRlDzmZaoVjW87dw96gFlQ274diDpPr0xlvFRfOdUEKLYlq1o/L6AO6sRXhqmPAdx9NI9J5R+j/eGnCme9UKXlKu+tym/Iqjk9rLa/Wkkx919ImlU8wqq3xGmRSn/iF8TnqlY/y8mWVFvvnBXviiqPiWivdjp0iQcvVb9LqiadwC/VnV2/obIO9ewRY4xllcu7XbYvqqKE7spArfJX1M0CKqrwsHqvoLpne0XVmBOiB2rV6SGeo45eUTVVqw63bM+RVcGKYx41KFHt+iJjqKhq4UabyqoeqkJZFZt1jKYrVFIqqYwLbronWTVOsz1TUkn5j6oObgZnSTXppDiESlV/JjJUqVxaNnlVVb6JG1dW+U+srVQNmEisUq05o2n6L1R8VFDhJlWpmoziqVSbROydK6vw9PhXQaXhYbZCNWbkAJWqja1gcxVVdoSqrazSTax9Uaj6ooQ7StXhRkuPoKpqwlFTUIW4MDjpRdVSlCQbpWrIheqoV1Q1vxJ8igeSKsAL+zgrVHtqqK9UeSajc62qOj/weuiyas+xgaCg8ull8NlUqmz6L29WVR3uuFiUVbDhuFtUXWg0NFCqgs3PbiqqvDFO0K4vq+aocqCg6g1o5siq3Ky7LquqmilWKKi+cGsWVbNETPb22/UVNyqqOnDDCmNZNcJtvVlQbbhQnUpUnTr1o5er2h+pTJ6VHxaS6jxA1bCgMl/LcrUKaD/pK1R0ptxyXcFjT/uNaoXPgIWkopcTbSerLjdREDbLVDSWfKNSeQMa6ITW/g0oV4nvrmttJKlaYoVzllVf9OIcQZnqRBUMlQpO1j19JQmH71Qzq9GwCipvhS/zrqwyuCgYlaogoUscA0wStsqrwPZ+x4d3Kt3OUnhegY/F8mzvEIoPy1V7qrLABQSPJJWUctW33gcXhAqhXHW608QKUFX7i2pWSZX/Erwv3qg84WCmDSvOt/F71eQvqrZS1bRyqgsZHr8NrYGs0iPqaQoOT9rlqloYhhZd7fSiVPmjL40WRjnVYRHlf5OZGlYWYyOOn2yzmNSuKVSUmfWzksUf51jjWSz9xu+SyrklScIx1wiUqo72EKikl1NNbvT1svKhmOnzkYUznv09JgEUYxlmL24YWRzdNEwXctmuHcp+pCtVr2XRugV5Ff2WtbVBkdg0XmlQu1J+ABT1EjoBoYiGAAAAAElFTkSuQmCC"},6559:()=>{},2634:()=>{}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";n.d(o,{default:()=>oh});var e={};n.r(e),n.d(e,{SpeedUnit:()=>ke});var t={};n.r(t),n.d(t,{BlendModes:()=>pe,CalibrationTypes:()=>Me,ContourType:()=>Te,DynamicOperatorType:()=>Ce,Events:()=>re,GeometryType:()=>xe,ImageQualityStatus:()=>Oe,InterpolationType:()=>ue,MetadataModules:()=>_e,OrientationAxis:()=>ge,RequestType:()=>ie,SharedArrayBufferModes:()=>ye,VOILUTFunctionType:()=>Ee,VideoEnums:()=>e,ViewportStatus:()=>De,ViewportType:()=>le});var r={};n.r(r),n.d(r,{hasBrowserEnv:()=>od,hasStandardBrowserEnv:()=>rd,hasStandardBrowserWebWorkerEnv:()=>id,origin:()=>sd});var a=n(9584),i=n.n(a),s=n(5485),l=n.n(s);function c(){return(0,s.env)().isMobile||(0,s.env)().isIpad||(0,s.env)().isAndroid?"mobile":"PC"}var u=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},d=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},f=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},h=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},p=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function m(e,t){void 0===t&&(t="x"),e.addEventListener("mousewheel",(function(n){e["x"===t?"scrollLeft":"scrollTop"]+=150*(n.deltaY>0?1:-1)}))}function g(e){return(null===structuredClone||void 0===structuredClone?void 0:structuredClone(e))||JSON.parse(JSON.stringify(e))}function v(e,t,n){return Math.min(Math.max(e,t),n)}function y(e,t,n){void 0===t&&(t=0),void 0===n&&(n={behavior:"smooth",inline:"center",block:"center"}),setTimeout((function(){null==e||e.scrollIntoView(n)}),t)}function b(e){return e.charAt(0).toUpperCase()+e.slice(1)}function x(e,t,n){void 0===n&&(n="-");var o=e.split(n);return o[o.length-1]=t,o.join(n)}function w(e){for(var t=e.split(",")[1],n=atob(t),o=n.length,r=new ArrayBuffer(o),a=new Uint8Array(r),i=0;i<o;i++)a[i]=n.charCodeAt(i);return r}function T(e,t){return u(this,void 0,void 0,(function(){var n;return d(this,(function(o){try{return n=e.getContext("2d",{willReadFrequently:!0}),e.height=t.height,e.width=t.width,null==n||n.putImageData(t,0,0),[2,Promise.resolve(w(e.toDataURL()))]}catch(e){return[2,Promise.reject(e)]}return[2]}))}))}function I(e){return e.split("?")[0]}function E(e,t){if(t<=0||t>100)throw new Error("Percentage must be between 0 and 100.");for(var n=e.length,o=Math.floor(n*(t/100)),r=[],a=0;a<o;a++){var i=Math.floor(a*(n/o));r.push(e[i])}return r}function S(e,t){var n,o;void 0===t&&(t=1),t-=1;try{for(var r=p(h([],f(Array.from((null==e?void 0:e.childNodes)||[])),!1)),a=r.next();!a.done;a=r.next()){var i=a.value;t&&(null==i?void 0:i.childNodes)&&S(i,t),null==i||i.remove(),i=void 0}}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}}function C(e,t){var n=document.createElement("a");n.style.display="none",n.setAttribute("target","_blank"),t&&n.setAttribute("download",t),n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function A(e,t){var n=new Date(e),o={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[r]:("00"+o[r]).substr((""+o[r]).length)));return t}const M=JSON.parse('{"rE":"1.4.2.240716"}');n(1278);var P=JSON.parse(localStorage.getItem("language"))||navigator.language||navigator.userLanguage||"en",D=n.g.webDicomViewLocal,L=function(e){if(void 0===e&&(e=P),!D[e]){var t=e.split("-")[0];return D[t]?(k(t,!1),!0):(console.warn("".concat(e," ").concat(_("toast.languagePackageNoInit","default"))),k(D.default.language,!1),!1)}return!0},O=function(){return P},k=function(e,t){if(void 0===t&&(t=!0),e){if(!D[e]){if(L(e))return;throw new Error("Language '".concat(e,"' is not supported. supported language: ").concat(Object.keys(D)))}P=e,t&&localStorage.setItem("language",JSON.stringify(e))}},R=function(e){try{if(JSON.parse(localStorage.getItem("language")))return;k(e,!1)}catch(e){console.error(e)}},_=function(e,t){try{var n=function(e,t){return t.split(".").reduce((function(e,t){return e[t]}),e)}(D[t||P].locale,e);if(!n)throw new Error("unknown translate key");return n}catch(t){return console.warn("Translation for '".concat(e,"' not found in '").concat(P,"' language."),"error:",t),e}};L();const N={getLanguage:O,setLanguage:k,setLanguageDefault:R,translate:_};var B,U,V=c(),F="mobile"===V,j=((null===(U=null===(B=window.performance)||void 0===B?void 0:B.memory)||void 0===U?void 0:U.jsHeapSizeLimit)||0)/1024/1024/1024,H=M.rE,z={instanceOptions:{},env:V,isMobile:F,webDicomView:"",sharedArrayBuffer:void 0,forceIM:!0,imageTypeDefault:void 0,_imageType:JSON.parse(localStorage.getItem("imageType")),get imageType(){var e;return null!==(e=this._imageType)&&void 0!==e?e:this.imageTypeDefault},set imageType(e){this._imageType=e,localStorage.setItem("imageType",JSON.stringify(e))},_imageCacheTypeDefault:JSON.parse(localStorage.getItem("imageCacheTypeDefault"))||0,get imageCacheTypeDefault(){return this._imageCacheTypeDefault},set imageCacheTypeDefault(e){this._imageCacheTypeDefault=e,localStorage.setItem("imageCacheTypeDefault",JSON.stringify(e))},logoURL:n(5738),cavanAroundInfo:!0,minRenderCountMPR3D:10,preload:{scroll:!0,scrollNum:9,seriesFetchNum:0,fullLoad:!1},AI:{resultURL:void 0,parseSuccess:!1,active:!1,jumpFirstAI:!1,getParseHandler:void 0},toolsBar:{navigationBottomLayout:!0,seriesBarVisibility:!0,VRTVisibility:!0,MPRVisibility:!0,MPRFusionVisibility:!0,MPRFusion2Visibility:!1,AIVisibility:!0,enhanceVisibility:!1,aboutUsVisibility:!0,fastImageModeVisibility:void 0,fasModeVisibility:!0,staModeVisibility:!0,majModeVisibility:!1,imageModeVisibility:!0,languageVisibility:!1,customMenu:{main:void 0,MPR:void 0,VRT:void 0}},toolsOptions:{toolColor:"#FF7F0E",zoomTool:{minScale:.1,maxScale:100}},DBCacheImages:{dbName:"ClearDicomView",version:Number(null==H?void 0:H.replace(/[^\d]/g,"").slice(-6)),storeName:"cornerstoneStore",temporaryEnable:!1,enableDefault:!0,_enable:JSON.parse(localStorage.getItem("enableDBCacheImages")),get enable(){var e;return null!==(e=this._enable)&&void 0!==e?e:this.enableDefault},set enable(e){var t=!!e;this._enable=t,localStorage.setItem("enableDBCacheImages",JSON.stringify(t))}},aboutUs:{imgURl:void 0,description:function(){return _("aboutUs.description")},originVersion:H,version:null==H?void 0:H.replace("_","."),copyright:function(){return _("aboutUs.copyright")},tel:function(){return _("aboutUs.tel")}},toolsData:{main:void 0,MPR:void 0,VRT:void 0},tipRecord:{GPUBenchmarksSuccess:!1,sharedArrayBufferGuide:!1},systemInfo:{jsHeapSizeLimit:j,performanceLevel:function(e){return e>=3.8?2:e>=2?1.5:e?1:.6}(j)},fusionData:{PT:[],CT:[]}};const q=z;var W,G,Y=q.DBCacheImages,Z=q.systemInfo,X=a.imageCache.cachedImages,K=a.imageCache.setMaximumSizeBytes,Q=(a.imageCache.getCacheInfo,a.imageCache.removeImageLoadObject),J=function(e){e!==a.EVENTS.IMAGE_CACHE_FULL&&(W=e)},$=function(e,t,n){void 0===n&&(n=300);try{if("MPR"===W)return J(e),!1;if(J(e),t||0===q.imageCacheTypeDefault&&q.DBCacheImages.enable&&X.length>n){0;var o=(0,a.getEnabledElements)().map((function(e){var t=e.image;return null==t?void 0:t.imageId})),r=X.map((function(e){return e.imageId})),i=r.length,s=.15*i,l=i-s;return r.forEach((function(e,t){t<=s||t>=l||o.includes(e)||Q(e)})),!0}return!1}catch(e){return console.error(e),!1}};G=function(e){var t=1073741824;return e>=2?t:e>=1.5?858993459.2:e>=1?644245094.4:e<1?429496729.6:void 0}(Z.performanceLevel)*(Y.enable?.8:1),K(G);var ee,te=(0,s.debounce)($,300,{leading:!1,trailing:!0}),ne=n(5915),oe=n.n(ne);!function(e){e.ERROR_EVENT="CORNERSTONE_ERROR",e.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",e.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",e.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",e.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",e.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",e.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",e.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",e.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",e.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",e.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",e.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",e.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",e.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",e.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",e.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",e.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",e.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",e.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",e.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",e.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",e.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",e.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",e.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",e.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",e.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",e.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",e.STACK_VIEWPORT_NEW_STACK="CORNERSTONE_STACK_VIEWPORT_NEW_STACK",e.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",e.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",e.VOLUME_SCROLL_OUT_OF_BOUNDS="VOLUME_SCROLL_OUT_OF_BOUNDS",e.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",e.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",e.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",e.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED"}(ee||(ee={}));const re=ee;var ae;!function(e){e.Interaction="interaction",e.Thumbnail="thumbnail",e.Prefetch="prefetch",e.Compute="compute"}(ae||(ae={}));const ie=ae;var se;!function(e){e.STACK="stack",e.ORTHOGRAPHIC="orthographic",e.PERSPECTIVE="perspective",e.VOLUME_3D="volume3d",e.VIDEO="video",e.WholeSlide="wholeSlide"}(se||(se={}));const le=se;var ce;!function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e[e.FAST_LINEAR=2]="FAST_LINEAR"}(ce||(ce={}));const ue=ce;var de={BlendMode:{COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5},FilterMode:{OFF:0,NORMALIZED:1,RAW:2}};const{BlendMode:fe}=de;var he;!function(e){e[e.COMPOSITE=0]="COMPOSITE",e[e.MAXIMUM_INTENSITY_BLEND=1]="MAXIMUM_INTENSITY_BLEND",e[e.MINIMUM_INTENSITY_BLEND=2]="MINIMUM_INTENSITY_BLEND",e[e.AVERAGE_INTENSITY_BLEND=3]="AVERAGE_INTENSITY_BLEND"}(he||(he={}));const pe=he;var me;!function(e){e.AXIAL="axial",e.CORONAL="coronal",e.SAGITTAL="sagittal",e.ACQUISITION="acquisition"}(me||(me={}));const ge=me;var ve;!function(e){e.TRUE="true",e.FALSE="false",e.AUTO="auto"}(ve||(ve={}));const ye=ve;var be;!function(e){e.CONTOUR="contour",e.SURFACE="Surface"}(be||(be={}));const xe=be;var we;!function(e){e.CLOSED_PLANAR="CLOSED_PLANAR",e.OPEN_PLANAR="OPEN_PLANAR"}(we||(we={}));const Te=we;var Ie;!function(e){e.LINEAR="LINEAR",e.SAMPLED_SIGMOID="SIGMOID"}(Ie||(Ie={}));const Ee=Ie;var Se;!function(e){e.SUM="SUM",e.AVERAGE="AVERAGE",e.SUBTRACT="SUBTRACT"}(Se||(Se={}));const Ce=Se;var Ae;!function(e){e.NOT_APPLICABLE="",e.ERMF="ERMF",e.USER="User",e.PROJECTION="Proj",e.REGION="Region",e.ERROR="Error",e.UNCALIBRATED="Uncalibrated"}(Ae||(Ae={}));const Me=Ae;var Pe;!function(e){e.NO_DATA="noData",e.LOADING="loading",e.PRE_RENDER="preRender",e.RESIZE="resize",e.RENDERED="rendered"}(Pe||(Pe={}));const De=Pe;var Le;!function(e){e[e.FAR_REPLICATE=1]="FAR_REPLICATE",e[e.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",e[e.SUBRESOLUTION=6]="SUBRESOLUTION",e[e.LOSSY=7]="LOSSY",e[e.FULL_RESOLUTION=8]="FULL_RESOLUTION"}(Le||(Le={}));const Oe=Le;var ke,Re;!function(e){e.FRAME="f",e.SECOND="s"}(ke||(ke={})),function(e){e.CALIBRATION="calibrationModule",e.CINE="cineModule",e.GENERAL_IMAGE="generalImageModule",e.GENERAL_SERIES="generalSeriesModule",e.GENERAL_STUDY="generalStudyModule",e.IMAGE_PIXEL="imagePixelModule",e.IMAGE_PLANE="imagePlaneModule",e.IMAGE_URL="imageUrlModule",e.MODALITY_LUT="modalityLutModule",e.MULTIFRAME="multiframeModule",e.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",e.OVERLAY_PLANE="overlayPlaneModule",e.PATIENT="patientModule",e.PATIENT_STUDY="patientStudyModule",e.PET_IMAGE="petImageModule",e.PET_ISOTOPE="petIsotopeModule",e.PET_SERIES="petSeriesModule",e.SOP_COMMON="sopCommonModule",e.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",e.VOI_LUT="voiLutModule",e.WADO_WEB_CLIENT="wadoWebClient"}(Re||(Re={}));const _e=Re;"function"==typeof SuppressedError&&SuppressedError;const Ne="undefined"==typeof window;(()=>{if(Ne)return;const{userAgent:e,platform:t,maxTouchPoints:n}=window.navigator,o=/(iphone|ipod|ipad)/i.test(e),r="iPad"===t||"MacIntel"===t&&n>0&&!window.MSStream;/android/i.test(e),/Version\/12.+Safari/.test(e),/Firefox/.test(e)})();Error;ye.TRUE;const Be={gpuTier:void 0,detectGPUConfig:{},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useNorm16Texture:!1,strictZSpacingForVolumeViewport:!0},enableCacheOptimization:!0,peerImport:e=>null};function Ue(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}var Ve=n(6439),Fe=n(1948),je=n.n(Fe),He=function(){return He=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},He.apply(this,arguments)};var ze=function(){return ze=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ze.apply(this,arguments)},qe=Fe.internal.getOptions,We="";function Ge(e){var t,n,o,r=e.smallestPixelValue,a=e.largestPixelValue,i=(t=r,n=a,Number.isInteger(t)&&Number.isInteger(n)&&(t>=0?n<=255?o=Uint8Array:n<=65535&&(o=Uint16Array):t>=-128&&n<=127?o=Int8Array:t>=-32768&&n<=32767&&(o=Int16Array)),o||Float32Array);if(!i)throw new Error("Could not apply a typed array to the pixel data");var s=new i(e.pixelData);e.pixelData=s}const Ye=function(e,t,n){void 0===n&&(n={});var o=!0;if(void 0!==n.useRGBA&&(o=n.useRGBA),n.preScale={enabled:!(!n.preScale||void 0===n.preScale.enabled)&&n.preScale.enabled},!t)return Promise.reject(new Error("The file does not contain image data."));var r=document.createElement("canvas");if(n.preScale.enabled){var i=function(e,t){var n=e.get("modalityLutModule",t)||{},o=(e.get("generalSeriesModule",t)||{}).modality,r={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:o},a=e.get("scalingModule",t)||{};return He(He({},r),"PT"===o&&{suvbw:a.suvbw})}(a.metaData,e);i&&(n.preScale=ze(ze({},n.preScale),{scalingParameters:i}))}var s=qe().decodeConfig,l=a.metaData.get("generateGrayImageModule",e),c=(new Date).getTime(),u=Fe.webWorkerManager.addTask("encryptionPngDecode",{buffer:t,info:ze(ze({},l),{isIM:!0})}).promise,d=s.use16BitDataType;return new Promise((function(i,s){u.then((function(l){var u=l.data,f=l.isPng,h=l.width,p=l.height,m=(new Date).getTime(),g=(0,Fe.getImageFrame)(e),v=(0,Fe.isColorImage)(g.photometricInterpretation),y=!1;if(f||(g.pixelData=u,g.pixelDataLength=u.length),g.decodeTimeInMS=m-c,v||f){(0,Ve.arrayBufferToImage)(t).then((function(t){i((0,Ve.createImage)(t,e,n))}),s)}else{var b=a.metaData.get("imagePlaneModule",e)||{},x=a.metaData.get("voiLutModule",e)||{},w=a.metaData.get("modalityLutModule",e)||{},T=a.metaData.get("sopCommonModule",e)||{};if(n.targetBuffer){var I=void 0,E=void 0,S=n.targetBuffer,C=S.offset,A=void 0===C?0:C,M=S.length,P=n.targetBuffer,D=P.arrayBuffer,L=P.type,O=g.imageFrameLength,k=w.rescaleIntercept;switch(M=null!=M?M:O-A,L){case"Uint8Array":I=Uint8Array;break;case d&&"Uint16Array":I=Uint16Array;break;case d&&"Int16Array":I=Int16Array;break;case"Float32Array":I=Float32Array;break;default:throw new Error("target array for image does not have a valid type.")}if(M!==g.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");if(E=D?new I(D,A,M):new I(g.pixelData),M!==g.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");if(k)for(var R=0;R<E.length;R++)E[R]=E[R]+k;g.pixelData=E,y=!0}var _=(0,Fe.getMinMax)(g.pixelData);g.smallestPixelValue=_.min,g.largestPixelValue=_.max,y||Ge(g);var N=g.columns,B=g.rows;h===N&&p===B||(g.columns=h,g.rows=p,console.warn("Image row col is inconsistent",{columns:N,rows:B,width:h,height:p}));var U,V={imageId:e,color:v,columnPixelSpacing:b.columnPixelSpacing,columns:g.columns,height:g.rows,preScale:g.preScale,intercept:w.rescaleIntercept?w.rescaleIntercept:0,slope:w.rescaleSlope?w.rescaleSlope:1,invert:"MONOCHROME1"===g.photometricInterpretation,minPixelValue:g.smallestPixelValue,maxPixelValue:g.largestPixelValue,rowPixelSpacing:b.rowPixelSpacing,rows:g.rows,sizeInBytes:g.pixelData.byteLength,width:g.columns,windowCenter:x.windowCenter?x.windowCenter[0]:void 0,windowWidth:x.windowWidth?x.windowWidth[0]:void 0,voiLUTFunction:x.voiLUTFunction?x.voiLUTFunction:void 0,decodeTimeInMS:g.decodeTimeInMS,floatPixelData:void 0,imageFrame:g,rgba:v&&o,getPixelData:function(){return g.pixelData},getCanvas:void 0,numComps:void 0};if(V.color&&(V.getCanvas=function(){return We===e||(r.height=V.rows,r.width=V.columns,r.getContext("2d",{willReadFrequently:!0}).putImageData(g.imageData,0,0),We=e),r}),w.modalityLUTSequence&&w.modalityLUTSequence.length>0&&("1.2.840.10008.5.1.4.1.1.12.1"!==(U=T.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==U)&&(V.modalityLUT=w.modalityLUTSequence[0]),x.voiLUTSequence&&x.voiLUTSequence.length>0&&(V.voiLUT=x.voiLUTSequence[0]),V.color&&(V.windowWidth=255,V.windowCenter=127),void 0===V.windowCenter||void 0===V.windowWidth){var F=V.maxPixelValue*V.slope+V.intercept,j=V.minPixelValue*V.slope+V.intercept;V.windowWidth=F-j,V.windowCenter=(F+j)/2}i(V)}}),s)}))};var Ze=Fe.internal.getOptions;const Xe=function(e,t,n,o){void 0===n&&(n={}),void 0===o&&(o={});var r=new XMLHttpRequest,i=Ze(),s=function(e){if("function"==typeof i.errorInterceptor){var t=new Error("request failed");t.request=e,t.response=e.response,t.status=e.status,i.errorInterceptor(t)}},l=new Promise((function(l,c){i.open(r,e,n,o),r.responseType="arraybuffer";var u=i.beforeSend(r,t,n,o),d=Object.assign({},n,u);Object.keys(d).forEach((function(t){null!==d[t]&&("Accept"===t&&-1!==e.indexOf("accept=")||r.setRequestHeader(t,d[t]))})),o.deferred={resolve:l,reject:c},o.url=e,o.imageId=t,r.onloadstart=function(n){i.onloadstart&&i.onloadstart(n,o);var r={url:e,imageId:t};(0,a.triggerEvent)(a.events,"cornerstoneimageloadstart",r)},r.onloadend=function(n){i.onloadend&&i.onloadend(n,o);var r={url:e,imageId:t};(0,a.triggerEvent)(a.events,"cornerstoneimageloadend",r)},r.onreadystatechange=function(e){i.onreadystatechange?i.onreadystatechange(e,o):4===r.readyState&&(200===r.status?i.beforeProcessing(r).then(l).catch((function(){s(r),c(r)})):(s(r),c(r)))},r.onprogress=function(n){var r,s,l=n.loaded;n.lengthComputable&&(r=n.total,s=Math.round(l/r*100)),i.onprogress&&i.onprogress(n,o);var c={url:e,imageId:t,loaded:l,total:r,percentComplete:s};(0,a.triggerEvent)(a.events,a.EVENTS.IMAGE_LOAD_PROGRESS,c)},r.onerror=function(){s(r),c(r)},r.onabort=function(){s(r),c(r)},r.send()}));return l.xhr=r,l};var Ke=Fe.wadouri.parseImageId;const Qe=function(e,t){void 0===t&&(t={});var n=Ke(e),o=Xe(n.url,e),r=(new Date).getTime();return{promise:new Promise((function(n,a){o.then((function(o){try{var i=(new Date).getTime();Ye(e,o,t).then((function(t){var o=(new Date).getTime();t.sharedCacheKey=e,t.loadTimeInMS=i-r,t.totalTimeInMS=o-r,n(t)}),a)}catch(e){a({error:e,buffer:o})}}),a)})),cancelFn:function(){o.xhr.abort()}}};const Je=function(e){e.registerImageLoader("IM",Qe)};var $e,et=document.createElement("canvas");const tt=function(e,t,n){void 0===n&&(n={});var o=e.naturalHeight,r=e.naturalWidth;function a(n){var o,r=function(){var n;$e===t?n=et.getContext("2d",{willReadFrequently:!0}):(et.height=e.naturalHeight,et.width=e.naturalWidth,(n=et.getContext("2d",{willReadFrequently:!0})).drawImage(e,0,0),$e=t);return n.getImageData(0,0,e.naturalWidth,e.naturalHeight)}();return function(e,t){for(var n=0,o=0;n<e.data.length;n+=4,o+=3)t[o]=e.data[n],t[o+1]=e.data[n+1],t[o+2]=e.data[n+2]}(r,o=(null==n?void 0:n.arrayBuffer)?new Uint8Array(n.arrayBuffer,n.offset,n.length):new Uint8Array(r.width*r.height*3)),o}return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,getPixelData:a,getCanvas:function(){return $e===t||(et.height=e.naturalHeight,et.width=e.naturalWidth,et.getContext("2d",{willReadFrequently:!0}).drawImage(e,0,0),$e=t),et},getImage:function(){return e},rows:o,columns:r,height:o,width:r,color:!0,rgba:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:o*r*3,pixelData:(null==n?void 0:n.targetBuffer)?a(n.targetBuffer):void 0}};var nt=Fe.wadouri.parseImageId;const ot=function(e,t){void 0===t&&(t={});var n=nt(e),o=Xe(n.url,e),r=(new Date).getTime();return{promise:new Promise((function(n,a){o.then((function(o){try{var i=(0,Ve.arrayBufferToImage)(o),s=(new Date).getTime();i.then((function(o){var a=tt(o,e,t),i=(new Date).getTime();o.sharedCacheKey=e,o.loadTimeInMS=s-r,o.totalTimeInMS=i-r,n(a)}),a)}catch(e){a({error:e,response:o})}}),a)})),cancelFn:function(){o.xhr.abort()}}};const rt=function(e){e.registerImageLoader("web",ot)};var at=new s.ComputeStore,it=["fasM","staM","majM"],st=function(){var e=_("tools.modes");return[e.speed,e.standard,e.major]},lt=function(){return at.get(st)};function ct(e,t){var n=e.includes("isMprDcm=1")?it[2]:it[t+1],o=e.replace(/((http|https):\/\/[^/]*)|(wadouri:|IM:)|([&?](sign|Signature|Token|Authorization|AccessKeySecret|X-Subject-Token|X-Date|Date|Expires|t|X-Expires-At|isDcm|dicomInfo|isMprDcm|x-oss-process|imageMogr2\/format\/jpeg)[^&^?]*)/gi,"");return{imageTypeEN:n,indexedDBKeyPeel:o,indexedDBKey:"".concat(n,":").concat(o)}}var ut=n(346),dt=n.n(ut),ft=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},ht=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},pt=new Map;const mt=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var r=pt.get(e);return r?r.apply(void 0,ht([],ft(n),!1)):(pt.set(e,t),t.apply(void 0,ht([],ft(n),!1)))};var gt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},vt=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};const yt=function(e,t,n,o,r){var a;void 0===n&&(n="error"),void 0===o&&(o=[void 0,void 0]);for(var i=[],l=5;l<arguments.length;l++)i[l-5]=arguments[l];var c=500*t.length+2e3;mt(e,(0,s.throttle)((function(){var e;null==r||r.apply(void 0,vt([],gt(i),!1)),dt()[n]({title:t,timeout:null!==(e=o[1])&&void 0!==e?e:c})}),null!==(a=o[0])&&void 0!==a?a:c,{trailing:!1}))};var bt=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},xt=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},wt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Tt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},It=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Et=q.DBCacheImages,St=Et.dbName,Ct=Et.storeName,At=Et.version,Mt=new s.IndexedDB(St,Ct,At),Pt=new s.Once((function(e){var t=[],n=function(e,t){var n,o;try{for(var r=wt(e.slice(0,t)),a=r.next();!a.done;a=r.next()){var i=a.value;Mt.dispatch("delete",{},i)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}};Mt.dispatch("count",{mode:"readonly"}).then((function(o){if(o>5e3){var r=Math.ceil(o*String.prototype.slice.call(o,0,1)*.1);Mt.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.upperBound("".concat(e,"_0"))).then((function(o){t=o,o.length>=r?n(t,r):Mt.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.lowerBound("".concat(e,"_z"))).then((function(e){t=It(It([],Tt(t),!1),Tt(e),!1),n(t,r)}))}))}o>15e3&&(console.info("Too many data stores, indexedDB is cleaning up"),Mt.dispatch("clear"))}))}));bt(void 0,void 0,void 0,(function(){var e,t,n,o,r,a,i,s,l,c;return xt(this,(function(u){switch(u.label){case 0:e=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB,u.label=1;case 1:return u.trys.push([1,3,4,5]),[4,null==e?void 0:e.databases()];case 2:t=u.sent();try{for(n=wt(t),o=n.next();!o.done;o=n.next())if(r=o.value,a=r.name,i=r.version,a===St&&i!==At){e.deleteDatabase(a),console.info("indexedDB is upgraded to version "+At);break}}catch(e){l={error:e}}finally{try{o&&!o.done&&(c=n.return)&&c.call(n)}finally{if(l)throw l.error}}return[3,5];case 3:return s=u.sent(),console.error(s),[3,5];case 4:return bt(void 0,void 0,void 0,(function(){return xt(this,(function(e){switch(e.label){case 0:return[4,Mt.open()];case 1:return e.sent(),Pt.run("com"),[2]}}))})),[7];case 5:return[2]}}))}));const Dt=Mt;var Lt=function(){return Lt=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Lt.apply(this,arguments)},Ot=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},kt=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};i()._renderWebImage=a.renderWebImage,i().renderWebImage=void 0,i().Enums=t,i().canRenderFloatTextures=function(){return!Ue()};var Rt=XMLHttpRequest.prototype,_t=Rt.open;Rt.open=function(e,t,n,o,r){this._url=t,_t.apply(this,[e,t,n,o,r])};var Nt=function(){var e=!0;try{new OffscreenCanvas(0,0)}catch(t){e=!1}return e}(),Bt=.5*(navigator.hardwareConcurrency||1)-(q.systemInfo.performanceLevel<1?1:0),Ut=function(e){return Ot(void 0,void 0,void 0,(function(){var t,n,o,r;return kt(this,(function(a){switch(a.label){case 0:return t=q.DBCacheImages,n=q.imageType,o=ct(e,n).indexedDBKey,t.enable||t.temporaryEnable?[4,Dt.open()]:[3,3];case 1:return a.sent(),[4,Dt.dispatch("get",{mode:"readonly"},o)];case 2:if(r=a.sent())return[2,r];throw{indexedDBKey:o};case 3:throw{indexedDBKey:o}}}))}))},Vt=function(e){e.addEventListener("error",(function(e){var t=_("toast.loadAndCacheImage"),n=t.acquisitionFailed,o=t.networkDis;yt("xhrError",navigator.onLine?n:o),console.error(e)})),e.addEventListener("timeout",(function(){var e=_("toast.loadAndCacheImage").acquisitionFailed;yt("xhrTimeout",e)}))};Ve.external.cornerstone=i(),Fe.external.cornerstone=i(),Fe.external.dicomParser=oe(),Je(i()),rt(i()),(0,Ve.configure)({beforeSend:function(e){return Ot(void 0,void 0,void 0,(function(){var t,n;return kt(this,(function(o){switch(o.label){case 0:e._send=e.send,e.send=function(){},e.timeout=3e4,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Ut(e._url)];case 2:return t=o.sent(),Object.defineProperty(e,"response",{writable:!0}),e.response=t,e.onload(e),e=void 0,[3,4];case 3:return n=o.sent(),e._onload=e.onload,e.onload=function(){},Vt(e),e.addEventListener("load",(function(){return Ot(void 0,void 0,void 0,(function(){var t,o,r,a,s,l,c,u,d,f;return kt(this,(function(h){switch(h.label){case 0:return t=!0,!1,(r=i().metaData.get("generateGrayImageModule",e._url))?(a=r.photometricInterpretation,s=r.bitsAllocated,l=r.blocks,(o=l>1)&&(t=!1,yt("multiImage",_("toast.lazyHandleToast.notSupportedBlocks"))),o||(m=s,(p=a)?(0,Fe.isColorImage)(p):m<=8)?[3,4]:(Nt||yt("isOffscreenCanvasSupported",_("toast.lazyHandleToast.versionLow")),[4,Fe.webWorkerManager.addTask("encryptionPngDecode",{buffer:e.response,info:Lt({},r)}).promise])):[3,4];case 1:return c=h.sent(),u=c.data,d=c.isImageData,Object.defineProperty(e,"response",{writable:!0}),d?[4,T(document.createElement("canvas"),u)]:[3,3];case 2:u=h.sent(),h.label=3;case 3:e.response=u,h.label=4;case 4:e._onload(e),f=n.indexedDBKey;try{t&&f&&e.response.byteLength&&Dt.dispatch("put",{},e.response,f)}catch(e){console.error(e)}return e=void 0,[2]}var p,m}))}))})),e._send(),[3,4];case 4:return[2]}}))}))}}),(0,Fe.configure)({useWebWorkers:!0,strict:!1,decodeConfig:{convertFloatPixelDataToInt:!1,use16BitDataType:!0},beforeSend:function(e,t,n,o){return Ot(void 0,void 0,void 0,(function(){var t,n;return kt(this,(function(r){switch(r.label){case 0:e._send=e.send,e.send=function(){},e.timeout=3e4,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Ut(e._url)];case 2:return t=r.sent(),o.deferred.resolve(t),e=void 0,[3,4];case 3:return n=r.sent(),Vt(e),e.addEventListener("load",(function(){var t=n.indexedDBKey;try{t&&e.response.byteLength&&Dt.dispatch("put",{},e.response,t)}catch(e){console.error(e)}e=void 0})),e._send(),[3,4];case 4:return[2]}}))}))}}),Fe.webWorkerManager.initialize({maxWebWorkers:Math.max(Math.floor(Bt),1),startWebWorkersOnDemand:!0,taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!0,strict:!1,loadCodecsOnStartup:!0},decodingoldPlatformImages:{}},webWorkerTaskPaths:["./encryptionPngDecode.worker.js"]});var Ft,jt=n(730),Ht=n.n(jt),zt=n(7869),qt=n.n(zt),Wt=n(2662),Gt=(Ft=function(e,t){return Ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ft(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ft(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Yt=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},Zt=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Xt=(0,Wt.importInternal)("base/BaseTool"),Kt=(0,Wt.importInternal)("util/debounce"),Qt=(0,Wt.importInternal)("tools/cursors").panCursor,Jt=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"Blur",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Qt};return(n=e.call(this,t,o)||this).touchDragCallback=n._dragCallback.bind(n),n.mouseDragCallback=n._dragCallback.bind(n),n.lazy=!1,n.updateViewport=Kt((function(e){var t=e.detail,o=t.element,r=t.deltaPoints.page.y,i=(0,a.getViewport)(o);if(i.blur||(i.blur=0),n.lazy=!1,r<0)i.blur+=1,i.blur>9&&(i.blur=9);else{if(!(r>0))return;i.blur-=1,i.blur<0&&(i.blur=0)}Wt.external.cornerstone.setViewport(o,i)}),300),n.updateCavansLazy=Kt((function(e){n.updateCavans(e)}),300),n}return Gt(t,e),t.prototype.updateCavans=function(e){return Yt(this,void 0,void 0,(function(){var t,n,o,r,a,i,s,l,c;return Zt(this,(function(u){switch(u.label){case 0:return t=e.detail,n=t.enabledElement,o=t.viewport,r=t.canvasContext,a=o.blur,t&&n&&a?(i=r.canvas.width,s=r.canvas.height,l=r.getImageData(0,0,i,s),[4,Fe.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"blur",sigma:a}}).promise]):[2];case 1:return c=u.sent(),r.putImageData(c,0,0),[2]}}))}))},t.prototype.renderToolData=function(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)},t.prototype._dragCallback=function(e){this.updateViewport(e)},t}(Xt);const $t=Jt;var en=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),tn=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},nn=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},on=(0,Wt.importInternal)("base/BaseTool"),rn=(0,Wt.importInternal)("util/debounce"),an=(0,Wt.importInternal)("tools/cursors").panCursor,sn=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"Sharpen",supportedInteractionTypes:["Mouse","Touch"],svgCursor:an};return(n=e.call(this,t,o)||this).touchDragCallback=n._dragCallback.bind(n),n.mouseDragCallback=n._dragCallback.bind(n),n.lazy=!1,n.updateViewport=rn((function(e){var t=e.detail,o=t.element,r=t.deltaPoints.page.y,i=(0,a.getViewport)(o);if(i.sharpen||(i.sharpen=0),n.lazy=!1,r<0)i.sharpen+=1,i.sharpen>11&&(i.sharpen=11);else{if(!(r>0))return;i.sharpen-=1,i.sharpen<0&&(i.sharpen=0)}Wt.external.cornerstone.setViewport(o,i)}),300),n.updateCavansLazy=rn((function(e){n.updateCavans(e)}),300),n}return en(t,e),t.prototype.updateCavans=function(e){return tn(this,void 0,void 0,(function(){var t,n,o,r,a,i,s,l,c;return nn(this,(function(u){switch(u.label){case 0:return t=e.detail,n=t.enabledElement,o=t.viewport,r=t.canvasContext,a=o.sharpen,t&&n&&a?(i=r.canvas.width,s=r.canvas.height,l=r.getImageData(0,0,i,s),[4,Fe.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"sharpen",sigma:a}}).promise]):[2];case 1:return c=u.sent(),r.putImageData(c,0,0),[2]}}))}))},t.prototype.renderToolData=function(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)},t.prototype._dragCallback=function(e){this.updateViewport(e)},t}(on);const ln=sn;var cn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),un=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},dn=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},fn=(0,Wt.importInternal)("base/BaseAnnotationTool"),hn=(0,Wt.importInternal)("manipulators/moveHandle"),pn=(0,Wt.importInternal)("drawing/getNewContext"),mn=(0,Wt.importInternal)("drawing/draw"),gn=(0,Wt.importInternal)("drawing/drawHandles"),vn=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),yn=(0,Wt.importInternal)("util/triggerEvent"),bn=(0,Wt.importInternal)("util/getRGBPixels"),xn=(0,Wt.importInternal)("util/calculateSUV"),wn=(0,Wt.importInternal)("util/getLogger"),Tn=(0,Wt.importInternal)("util/throttle"),In=(0,Wt.importInternal)("tools/cursors").probeCursor,En=wn("tools:annotation:ProbeTool"),Sn=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"ProbeCT",supportedInteractionTypes:["Mouse","Touch"],svgCursor:In,configuration:{drawHandles:!0,renderDashed:!1}};return(n=e.call(this,t,o)||this).throttledUpdateCachedStats=Tn(n.updateCachedStats,110),n}return cn(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:t.x,y:t.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}En.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,o){var r=t&&t.handles&&t.handles.end;if(r||En.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var a="mouse"===o?15:25,i=Wt.external.cornerstone.pixelToCanvas(e,t.handles.end);return Wt.external.cornerstoneMath.point.distance(i,n)<a},t.prototype.updateCachedStats=function(e,t,n){var o=Math.round(n.handles.end.x),r=Math.round(n.handles.end.y),a={};o>=0&&r>=0&&o<e.columns&&r<e.rows&&(a.x=o,a.y=r,e.color?a.storedPixels=bn(t,o,r,1,1):(a.storedPixels=Wt.external.cornerstone.getStoredPixels(t,o,r,1,1),a.sp=a.storedPixels[0],a.mo=a.sp*e.slope+e.intercept,a.suv=xn(e,a.sp))),n.cachedStats=a,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,o=this.configuration,r=o.handleRadius,a=o.renderDashed,i=(0,Wt.getToolState)(e.currentTarget,this.name);if(i)for(var s=pn(n.canvasContext.canvas),l=n.image,c=n.element,u=(0,Wt.getModule)("globalConfiguration").configuration.lineDash,d=function(e){var o=i.data[e];if(!1===o.visible)return"continue";mn(s,(function(e){var i=Wt.toolColors.getColorIfActive(o);if(t.configuration.drawHandles){var s={handleRadius:r,color:i};a&&(s.lineDash=u),gn(e,n,o.handles,s)}!0===o.invalidated&&(o.cachedStats?t.throttledUpdateCachedStats(l,c,o):t.updateCachedStats(l,c,o));var d,f=[],h=o.cachedStats,p=h.x,m=h.y,g=h.storedPixels,v=h.sp,y=h.mo,b=h.suv;if(p>=0&&m>=0&&p<l.columns&&m<l.rows){if(d="X: ".concat(p,", Y: ").concat(m),l.color?f.push("R: ".concat(g[0]," G: ").concat(g[1]," B: ").concat(g[2])):(f.push("SP: ".concat(v," HU")),f.push("MO: ".concat(parseFloat(y.toFixed(3))," HU")),b&&f.push(" SUV: ".concat(parseFloat(b.toFixed(3))," HU"))),!o.handles.textBox.hasMoved){var x={x:o.handles.end.x,y:o.handles.end.y};o.handles.textBox.x=x.x,o.handles.textBox.y=x.y}var w=Wt.toolStyle.getToolWidth();vn(e,c,o.handles.textBox,dn([d],un(f),!1),o.handles,(function(){return[{x:o.handles.end.x,y:o.handles.end.y}]}),i,w,10,!0)}}))},f=0;f<i.data.length;f++)d(f)},t.prototype.addNewMeasurement=function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var o=e.detail,r=o.element,a=this.createNewMeasurement(o);a&&((0,Wt.addToolState)(r,this.name,a),Wt.external.cornerstone.updateImage(r),hn(o,this.name,a,a.handles.end,this.options,t,(function(e){if(e){var t=Wt.EVENTS.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:r,measurementData:a};yn(r,t,o)}else(0,Wt.removeToolState)(r,n.name,a)})))},t}(fn);const Cn=Sn;var An=(0,Wt.importInternal)("drawing/path");function Mn(e,t,n,o,r,i,s){void 0===i&&(i="pixel"),"pixel"===i&&(n=(0,a.pixelToCanvas)(t,n)),An(e,r,(function(e){e.arc(n.x,n.y,o,0,2*Math.PI)})),s&&An(e,r,(function(e){e.font="".concat(o,"px lighter"),e.fillStyle="#ceff82";var t=e.measureText(s).width>>1;e.fillText(s,n.x-t,n.y+t)}))}var Pn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Dn=(0,Wt.importInternal)("base/BaseAnnotationTool"),Ln=(0,Wt.importInternal)("tools/cursors").circleRoiCursor,On=(0,Wt.importInternal)("drawing/getNewContext"),kn=(0,Wt.importInternal)("drawing/draw"),Rn=(0,Wt.importInternal)("drawing/setShadow"),_n=(0,Wt.importInternal)("util/calculateSUV"),Nn=(0,Wt.importInternal)("util/ellipseUtils").calculateEllipseStatistics,Bn=(0,Wt.importInternal)("util/getROITextBoxCoords"),Un=(0,Wt.importInternal)("util/throttle"),Vn=(0,Wt.importInternal)("util/getPixelSpacing"),Fn=function(e){function t(t){void 0===t&&(t={});var n=this,o=t.markerFlag,r=void 0===o?"L":o,a={name:"Ann"+r,supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ln,configuration:{renderDashed:!1,hideHandlesIfMoving:!0,type:r}};return(n=e.call(this,t,a)||this).markerFlag=r,n.throttledUpdateCachedStats=Un(n.updateCachedStats,0),n}return Pn(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,o){var r=t&&t.handles&&t.handles.start&&t.handles.end,a=Wt.external.cornerstoneMath.point.distance;if(r||console.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var i="mouse"===o?15:25,s=Wt.external.cornerstone.pixelToCanvas(e,t.handles.start),l=Wt.external.cornerstone.pixelToCanvas(e,t.handles.end),c=a(s,n),u=a(s,l);return c>u-i/2&&c<u+i/2},t.prototype.updateCachedStats=function(e,t,n){var o=(Wt.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=Vn(e),a=function(e,t,n,o,r){var a,i=(c=n.start,u=n.end,d=(0,qt().point.distance)(c,u),{left:Math.floor(Math.min(c.x-d,u.x)),top:Math.floor(Math.min(c.y-d,u.y)),width:2*d,height:2*d}),s=Wt.external.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=Nn(s,i);var c,u,d;"PT"===o&&(a={mean:_n(e,l.mean,!0)||0,stdDev:_n(e,l.stdDev,!0)||0});var f=Math.PI*(i.width*(r.colPixelSpacing||1)/2)*(i.height*(r.rowPixelSpacing||1)/2);return{area:f||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,o,r);n.cachedStats=a,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,Wt.getToolState)(e.currentTarget,this.name);if(n){var o=Wt.external.cornerstoneMath.point.distance,r=e.detail,a=r.image,i=r.element,s=r.canvasContext,l=this.configuration.renderDashed,c=On(s.canvas),u=(0,Wt.getModule)("globalConfiguration").configuration.lineDash;kn(c,(function(e){for(var s=0;s<n.data.length;s++){var c=n.data[s];if(!1!==c.visible){var d=Wt.toolColors.getColorIfActive(c)||"#ff8000";Rn(e,t.configuration);var f=Wt.external.cornerstone.pixelToCanvas(i,c.handles.start),h=Wt.external.cornerstone.pixelToCanvas(i,c.handles.end),p=o(f,h),m={color:d,lineDash:void 0};if(l&&(m.lineDash=u),Mn(e,i,c.handles.start,p,m,"pixel",t.markerFlag),!0===c.invalidated&&(c.cachedStats?t.throttledUpdateCachedStats(a,i,c):t.updateCachedStats(a,i,c)),!c.handles.textBox.hasMoved){var g=Bn(r.viewport,c.handles);Object.assign(c.handles.textBox,g)}}}}))}},t}(Dn);const jn=Fn;var Hn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),zn=function(){return zn=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},zn.apply(this,arguments)},qn=(0,Wt.importInternal)("base/BaseAnnotationTool"),Wn=(0,Wt.importInternal)("drawing/getNewContext"),Gn=(0,Wt.importInternal)("drawing/draw"),Yn=(0,Wt.importInternal)("drawing/setShadow"),Zn=(0,Wt.importInternal)("drawing/drawLine"),Xn=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),Kn=(0,Wt.importInternal)("drawing/drawHandles"),Qn=(0,Wt.importInternal)("util/lineSegDistance"),Jn=(0,Wt.importInternal)("util/getLogger"),$n=(0,Wt.importInternal)("util/throttle"),eo=(0,Wt.importInternal)("util/getPixelSpacing"),to=Jn?Jn("tools:annotation:LengthTool"):console,no=(0,Wt.importInternal)("tools/cursors").bidirectionalCursor,oo=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"Heartratio",supportedInteractionTypes:["Mouse","Touch"],svgCursor:no,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,o)||this).throttledUpdateCachedStats=$n(n.updateCachedStats,110),n}return Hn(t,e),t.prototype.createNewMeasurement=function(e){var t=e||{currentPoints:{}},n=t.currentPoints.image,o=t.image;if(n){var r=n.x,a=n.y,i=o||{},s=i.columns,l=i.rows;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:r,y:a,highlight:!0,active:!1},end:{x:r,y:a,highlight:!0,active:!0},start2:{x:.6*r,y:Math.min(1.35*a,.9*l),highlight:!0,active:!1},end2:{x:Math.min(1.75*r,s),y:Math.min(1.35*a,.9*l),highlight:!0,active:!0},start3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},end3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}to.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,o){if(!((null==t?void 0:t.handles.start)&&(null==t?void 0:t.handles.end)))return to.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1;if(!1===t.visible)return!1;var r="mouse"===o?15:25;return Qn(e,t.handles.start,t.handles.end,n)<r||Qn(e,t.handles.start2,t.handles.end2,n)<r||Qn(e,t.handles.start3,t.handles.end3,n)<r},t.prototype.updateCachedStats=function(e,t,n){var o=eo(e),r=o.rowPixelSpacing,a=o.colPixelSpacing,i=n.handles,s=i.start,l=i.end,c=i.start2,u=i.end2,d=Math.abs(l.x-s.x)*(a||1),f=Math.abs(u.x-c.x)*(r||1),h=d>f?f/d:d/f;n.ratio=h,n.handles.start3.x=(s.x+l.x)/2,n.handles.start3.y=(s.y+l.y)/2,n.handles.end3.x=(c.x+u.x)/2,n.handles.end3.y=(c.y+u.y)/2,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,o=this.configuration,r=o.handleRadius,a=o.drawHandlesOnHover,i=o.hideHandlesIfMoving,s=o.renderDashed,l=(0,Wt.getToolState)(e.currentTarget,this.name);if(l)for(var c=Wn(n.canvasContext.canvas),u=n.image,d=n.element,f=Wt.toolStyle.getToolWidth(),h=(0,Wt.getModule)("globalConfiguration").configuration.lineDash,p=function(e){var o=l.data[e],p=o.handles,m=p.start,v=p.end,y=p.start2,b=p.end2,x=p.start3,w=p.end3;if(!1===o.visible)return"continue";Gn(c,(function(e){Yn(e,t.configuration);var l=Wt.toolColors.getColorIfActive(o),c={color:l,lineDash:void 0};s&&(c.lineDash=h),Zn(e,d,m,v,c),Zn(e,d,y,b,c),Zn(e,d,x,w,zn(zn({},c),{lineDash:h}));var p={color:l,handleRadius:r,drawHandlesIfActive:a,hideHandlesIfMoving:i};if(t.configuration.drawHandles&&o.active&&Kn(e,n,o.handles,p),!o.handles.textBox.hasMoved){var T={x:(x.x+w.x)/2,y:(x.y+w.y)/2};o.handles.textBox.x=T.x,o.handles.textBox.y=T.y}!0===o.invalidated&&(o.ratio?t.throttledUpdateCachedStats(u,d,o):t.updateCachedStats(u,d,o)),Xn(e,d,o.handles.textBox,"Ratio:".concat(o.ratio.toFixed(3)),o.handles,g,l,f,5,!0)}))},m=0;m<l.data.length;m++)p(m);function g(e){var t=e.start,n=e.end,o=e.start2,r=e.end2,a=e.start3,i=e.end3;return[{x:(a.x+i.x)/2,y:(a.y+i.y)/2},t,n,o,r]}},t}(qn);const ro=oo;var ao=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};dt().settings({timeout:5e3});var io=function(e){var t,n;try{var o=e.parentElement.parentElement,r=document.querySelector(".iziToast-overlay"),a=q.webDicomView.globalContainer;r.setAttribute("style","\n        // display: block;\n        position: absolute;\n        top: 0;\n        // left: 0;\n        // right: 0;\n        bottom: 0;\n        // z-index: 997;\n        ".concat(r.getAttribute("style"),"\n    \t"));try{for(var i=ao([o,r]),s=i.next();!s.done;s=i.next()){var l=s.value;"BODY"===l.parentElement.tagName&&a.appendChild(l)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}catch(e){console.error(e)}},so=function(){return so=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},so.apply(this,arguments)};function lo(e,t,n,o,r){void 0===o&&(o="");return new Promise((function(a){var i=_("toast.prompt"),l=i.enter,c=i.OK,u=i.cancel;dt().question(so({class:q.isMobile?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:e,position:"center",icon:"",progressBar:!1,inputs:[['<input type="text" value=\''.concat(o,"' maxLength=100 placeholder='").concat(l,"' >"),"keyup",function(e,t,n,o){""!==n.value&&(n.placeholder=l)},!0]],buttons:[["<button class='confirm' >".concat(c,"</button>"),function(e,o,r,i,l){var c=l[0].value;if(function(e){var n=!0;switch((0,s.dataType)(t)){case"RegExp":n=t.test(e);break;case"function":n=t(e);break;default:console.error("verification is necessary, interceptor required for RegExp or Function")}return n}(c))return e.destroy(),void a(c);l[0].value="",l[0].placeholder=n},!1],["<button class='cancel' >".concat(u,"</button>"),function(e,t,n,o){e.hide({},t,"cancel")},!1]],onOpening:function(e,t){io(t)},onClosing:function(e,t,n){"confirm"!==n&&a(null)}},r))}))}var co=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),uo=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},fo=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},ho=(0,Wt.importInternal)("base/BaseAnnotationTool"),po=(0,Wt.importInternal)("manipulators/moveNewHandle"),mo=(0,Wt.importInternal)("util/pointInsideBoundingBox"),go=(0,Wt.importInternal)("util/lineSegDistance"),vo=(0,Wt.importInternal)("util/triggerEvent"),yo=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),bo=(0,Wt.importInternal)("drawing/getNewContext"),xo=(0,Wt.importInternal)("drawing/draw"),wo=(0,Wt.importInternal)("drawing/setShadow"),To=(0,Wt.importInternal)("drawing/drawArrow"),Io=(0,Wt.importInternal)("drawing/drawHandles"),Eo=(0,Wt.importInternal)("drawing/textBoxWidth"),So=(0,Wt.importInternal)("tools/cursors").arrowAnnotateCursor,Co=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Mo,changeTextCallback:Po,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:So};return(n=e.call(this,t,o)||this).preventNewMeasurement=!1,n}return co(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,o){if(!1===t.visible)return!1;var r="mouse"===o?15:25;return go(e,t.handles.start,t.handles.end,n)<r},t.prototype.updateCachedStats=function(){},t.prototype.renderToolData=function(e){var t=this,n=e.detail,o=n.element,r=n.enabledElement,a=this.configuration,i=a.handleRadius,s=a.drawHandlesOnHover,l=a.hideHandlesIfMoving,c=a.renderDashed,u=(0,Wt.getToolState)(o,this.name);if(u){var d,f=e.detail.canvasContext.canvas,h=bo(f),p=Wt.toolStyle.getToolWidth();c&&(d=(0,Wt.getModule)("globalConfiguration").configuration.lineDash);for(var m=function(n){var a=u.data[n];if(!1===a.visible)return"continue";xo(h,(function(n){wo(n,t.configuration);var c=Wt.toolColors.getColorIfActive(a),u=Wt.external.cornerstone.pixelToCanvas(o,a.handles.start),f=Wt.external.cornerstone.pixelToCanvas(o,a.handles.end);t.configuration.arrowFirst?To(n,f,u,c,p,d):To(n,u,f,c,p,d);var h={color:c,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&a.active&&Io(n,e.detail,a.handles,h);var m=function(e){return e.text}(a);if(m&&""!==m){var g=Eo(n,m,5),y=Wt.textStyle.getFontSize()+10,b=Math.max(g,y)/2+5;if(f.x<u.x&&(b=-b),!a.handles.textBox.hasMoved){var x=void 0;x=t.configuration.arrowFirst?{x:f.x-g/2+b,y:f.y-y/2}:{x:u.x-g/2-b,y:u.y-y/2};var w=Wt.external.cornerstone.internal.getTransform(r);w.invert();var T=w.transformPoint(x.x,x.y);a.handles.textBox.x=T.x,a.handles.textBox.y=T.y}yo(n,o,a.handles.textBox,m,a.handles,v,c,p,0,!1)}}))},g=0;g<u.data.length;g++)m(g)}function v(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this,o=e.detail.element,r=this.createNewMeasurement(e),a=this.configuration.allowEmptyLabel;(0,Wt.addToolState)(o,this.name,r),Wt.external.cornerstone.updateImage(o),po(e.detail,this.name,r,r.handles.end,this.options,t,(function(t){t?void 0===r.text&&n.configuration.getTextCallback((function(e){if(e||a){r.text=e,r.active=!1;var t={toolName:n.name,toolType:n.name,element:o,measurementData:r};Wt.external.cornerstone.updateImage(o),vo(o,Wt.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,Wt.removeToolState)(o,n.name,r)}),e.detail):(0,Wt.removeToolState)(o,n.name,r),Wt.external.cornerstone.updateImage(o)}))},t.prototype.doubleClickCallback=function(e){return this._updateTextForNearbyAnnotation(e,"mouse")},t.prototype.touchPressCallback=function(e){return this._updateTextForNearbyAnnotation(e,"touch")},t.prototype._updateTextForNearbyAnnotation=function(e,t){var n=e.detail.element,o=e.detail.currentPoints.canvas,r=(0,Wt.getToolState)(n,this.name);if(!r)return!1;for(var a=0;a<r.data.length;a++){var i=r.data[a];if(this.pointNearTool(n,i,o,t)||mo(i.handles.textBox,o))return i.active=!0,Wt.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,n,i)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}},t.prototype._doneChangingTextCallback=function(e,t,n,o){!0===o?(0,Wt.removeToolState)(e,this.name,t):t.text=n,t.active=!1,Wt.external.cornerstone.updateImage(e),vo(e,Wt.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})},t}(ho);const Ao=Co;function Mo(e){return uo(this,void 0,void 0,(function(){var t;return fo(this,(function(n){switch(n.label){case 0:return t=e,[4,lo(_("toast.prompt.enterComment"))];case 1:return t.apply(void 0,[n.sent()]),[2]}}))}))}function Po(e,t,n){return uo(this,void 0,void 0,(function(){var e;return fo(this,(function(t){switch(t.label){case 0:return e=n,[4,lo(_("toast.prompt.changeComment"))];case 1:return e.apply(void 0,[t.sent()]),[2]}}))}))}var Do=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Lo=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},Oo=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},ko=(0,Wt.importInternal)("base/BaseAnnotationTool"),Ro=(0,Wt.importInternal)("manipulators/moveHandle"),_o=(0,Wt.importInternal)("util/pointInsideBoundingBox"),No=(0,Wt.importInternal)("util/triggerEvent"),Bo=(0,Wt.importInternal)("util/getLogger"),Uo=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),Vo=(0,Wt.importInternal)("drawing/getNewContext"),Fo=(0,Wt.importInternal)("drawing/draw"),jo=(0,Wt.importInternal)("drawing/setShadow"),Ho=(0,Wt.importInternal)("drawing/drawHandles"),zo=(0,Wt.importInternal)("drawing/textBoxWidth"),qo=(0,Wt.importInternal)("tools/cursors").textMarkerCursor,Wo=Bo("tools:annotation:ProbeTool"),Go=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"Annotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Zo,changeTextCallback:Xo,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,allowEmptyLabel:!1},svgCursor:qo};return(n=e.call(this,t,o)||this).preventNewMeasurement=!1,n}return Do(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,o){var r=t&&t.handles&&t.handles.end;if(r||Wo.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var a=Wt.external.cornerstone.pixelToCanvas(e,t.handles.end),i="mouse"===o?15:25;return Wt.external.cornerstoneMath.point.distance(a,n)<i},t.prototype.updateCachedStats=function(){},t.prototype.renderToolData=function(e){var t=this,n=e.detail,o=n.element,r=n.enabledElement,a=this.configuration,i=a.handleRadius,s=a.drawHandlesOnHover,l=a.hideHandlesIfMoving,c=(0,Wt.getToolState)(o,this.name);if(c)for(var u=e.detail.canvasContext.canvas,d=Vo(u),f=Wt.toolStyle.getToolWidth(),h=function(n){var a=c.data[n];if(!1===a.visible)return"continue";Fo(d,(function(n){jo(n,t.configuration);var c=Wt.toolColors.getColorIfActive(a),u=Wt.external.cornerstone.pixelToCanvas(o,a.handles.end),d={color:c,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&Ho(n,e.detail,a.handles,d);var h=function(e){return e.text}(a);if(h&&""!==h){var p=zo(n,h,5),g=Wt.textStyle.getFontSize()+10,v=Math.max(p,g)/2+5;if(!a.handles.textBox.hasMoved){var y={x:u.x-p/2+v,y:u.y-g/2},b=Wt.external.cornerstone.internal.getTransform(r);b.invert();var x=b.transformPoint(y.x,y.y);a.handles.textBox.x=x.x,a.handles.textBox.y=x.y}Uo(n,o,a.handles.textBox,h,a.handles,m,c,f,0,!1)}}))},p=0;p<c.data.length;p++)h(p);function m(e){return[e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this,o=e.detail.element,r=this.createNewMeasurement(e),a=this.configuration.allowEmptyLabel;(0,Wt.addToolState)(o,this.name,r),Wt.external.cornerstone.updateImage(o),Ro(e.detail,this.name,r,r.handles.end,this.options,t,(function(t){t?void 0===r.text&&n.configuration.getTextCallback((function(e){if(e||a){r.text=e,r.active=!1;var t={toolName:n.name,toolType:n.name,element:o,measurementData:r};Wt.external.cornerstone.updateImage(o),No(o,Wt.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,Wt.removeToolState)(o,n.name,r)}),e.detail):(0,Wt.removeToolState)(o,n.name,r),Wt.external.cornerstone.updateImage(o)}))},t.prototype.doubleClickCallback=function(e){return this._updateTextForNearbyAnnotation(e,"mouse")},t.prototype.touchPressCallback=function(e){return this._updateTextForNearbyAnnotation(e,"touch")},t.prototype._updateTextForNearbyAnnotation=function(e,t){var n=e.detail.element,o=e.detail.currentPoints.canvas,r=(0,Wt.getToolState)(n,this.name);if(!r)return!1;for(var a=0;a<r.data.length;a++){var i=r.data[a];if(this.pointNearTool(n,i,o,t)||_o(i.handles.textBox,o))return i.active=!0,Wt.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,n,i)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}},t.prototype._doneChangingTextCallback=function(e,t,n,o){!0===o?(0,Wt.removeToolState)(e,this.name,t):t.text=n,t.active=!1,Wt.external.cornerstone.updateImage(e),No(e,Wt.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})},t}(ko);const Yo=Go;function Zo(e){return Lo(this,void 0,void 0,(function(){var t;return Oo(this,(function(n){switch(n.label){case 0:return t=e,[4,lo(_("toast.prompt.enterText"))];case 1:return t.apply(void 0,[n.sent()]),[2]}}))}))}function Xo(e,t,n){return Lo(this,void 0,void 0,(function(){var e;return Oo(this,(function(t){switch(t.label){case 0:return e=n,[4,lo(_("toast.prompt.enterText"))];case 1:return e.apply(void 0,[t.sent()]),[2]}}))}))}var Ko=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Qo=(0,Wt.importInternal)("base/BaseTool"),Jo=(0,Wt.importInternal)("util/getPixelSpacing"),$o=(0,Wt.importInternal)("drawing/getNewContext"),er=(0,Wt.importInternal)("drawing/draw"),tr=(0,Wt.importInternal)("drawing/setShadow"),nr=(0,Wt.importInternal)("drawing/drawLine"),or=(0,Wt.importInternal)("drawing/drawTextBox"),rr=(0,Wt.importInternal)("util/getLogger")("tools:ScaleOverlayTool"),ar=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"ScaleOverlay",configuration:{minorTickLength:14,majorTickLength:24},mixins:["enabledOrDisabledBinaryTool"]})||this}return Ko(t,e),t.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.forceImageUpdate=function(e){Wt.external.cornerstone.getEnabledElement(e).image&&Wt.external.cornerstone.updateImage(e)},t.prototype.renderToolData=function(e){var t=e.detail,n=$o(t.canvasContext.canvas),o=t.image,r=t.viewport,a=t.element,i=Jo(o),s=i.rowPixelSpacing,l=i.colPixelSpacing;if(s&&l){var c={width:n.canvas.width,height:n.canvas.height};if(!(c.width<200||c.height<200)){var u=10/s*r.scale,d=10/l*r.scale,f=sr(c,.2,.05),h=sr(c,.05,.2);if(c.width&&c.height&&f&&h){var p=Wt.toolColors.getToolColor(),m=Wt.toolStyle.getToolWidth(),g=Object.assign({},{hscaleBounds:f,vscaleBounds:h,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:h.bottomRight.x,y:h.topLeft.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},horizontalLine:{start:{x:f.topLeft.x,y:f.bottomRight.y},end:{x:f.bottomRight.x,y:f.bottomRight.y}},color:p,lineWidth:m},this.configuration);er(n,(function(e){tr(e,g),nr(e,a,g.verticalLine.start,g.verticalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),lr(e,a,g),nr(e,a,g.horizontalLine.start,g.horizontalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),cr(e,a,g)}))}}}else rr.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))},t}(Qo);const ir=ar;var sr=function(e,t,n){var o=t*Math.min(1e3,e.width),r=n*Math.min(1e3,e.height),a={left:o,top:r,width:e.width-2*o,height:e.height-2*r};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},lr=function(e,t,n){for(var o=0,r=n.color,a=n.lineWidth;n.verticalLine.start.y+o*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var i={x:n.verticalLine.start.x,y:n.verticalLine.start.y+o*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+o*n.verticalMinorTick};s.x=o%10==0?n.verticalLine.start.x-n.majorTickLength:o%5==0?n.verticalLine.start.x-n.minorTickLength:n.verticalLine.start.x-n.minorTickLength/2,nr(e,t,i,s,{color:r,lineWidth:a},"canvas"),o++}var l=10*(o-1)+"mm";or(e,l,n.verticalLine.end.x-e.measureText(l).width-10,n.verticalLine.end.y,Wt.toolColors.getToolColor())},cr=function(e,t,n){var o=0,r=n.color,a=n.lineWidth;for(n.horizontalMinorTick!==n.verticalMinorTick&&(n.horizontalMinorTick=n.verticalMinorTick);n.horizontalLine.start.x+o*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var i={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+o*n.horizontalMinorTick,y:0};s.y=o%10==0?n.horizontalLine.start.y-n.majorTickLength:o%5==0?n.horizontalLine.start.y-n.minorTickLength:n.horizontalLine.start.y-n.minorTickLength/2,nr(e,t,i,s,{color:r,lineWidth:a},"canvas"),o++}or(e,10*(o-1)+"mm",n.horizontalLine.end.x,n.horizontalLine.end.y-Wt.textStyle.getFontSize(),Wt.toolColors.getToolColor())},ur=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),dr=function(){return dr=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},dr.apply(this,arguments)},fr=(0,Wt.importInternal)("base/BaseAnnotationTool"),hr=(0,Wt.importInternal)("manipulators/getHandleNearImagePoint"),pr=(0,Wt.importInternal)("drawing/getNewContext"),mr=(0,Wt.importInternal)("drawing/draw"),gr=(0,Wt.importInternal)("drawing/setShadow"),vr=(0,Wt.importInternal)("drawing/drawEllipse"),yr=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),br=(0,Wt.importInternal)("drawing/drawLine"),xr=(0,Wt.importInternal)("drawing/drawHandles"),wr=(0,Wt.importInternal)("util/getROITextBoxCoords"),Tr=(0,Wt.importInternal)("util/numbersWithCommas"),Ir=(0,Wt.importInternal)("util/calculateSUV"),Er=(0,Wt.importInternal)("util/ellipseUtils"),Sr=Er.calculateEllipseStatistics,Cr=Er.pointInEllipse,Ar=(0,Wt.importInternal)("util/getLogger"),Mr=(0,Wt.importInternal)("util/throttle"),Pr=(0,Wt.importInternal)("util/getPixelSpacing"),Dr=Ar?Ar("tools:annotation:LengthTool"):console,Lr=(0,Wt.importInternal)("tools/cursors").ellipticalRoiCursor,Or=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Lr};return(n=e.call(this,t,o)||this).throttledUpdateCachedStats=Mr(n.updateCachedStats,110),n.throttledHandlesMove=Mr(Rr,0),n}return ur(t,e),t.prototype.createNewMeasurement=function(e){var t=e||{currentPoints:{}},n=t.currentPoints.image;t.image;if(n)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Dr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,o){var r=t&&t.handles&&t.handles.start&&t.handles.end;if(r||Dr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;if(hr(e,t.handles,n,6))return!0;var a="mouse"===o?15:25,i=Wt.external.cornerstone.pixelToCanvas(e,t.handles.start),s=Wt.external.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x)+a/2,top:Math.min(i.y,s.y)+a/2,width:Math.abs(i.x-s.x)-a,height:Math.abs(i.y-s.y)-a},c={left:Math.min(i.x,s.x)-a/2,top:Math.min(i.y,s.y)-a/2,width:Math.abs(i.x-s.x)+a,height:Math.abs(i.y-s.y)+a},u=Cr(l,n);return!(!Cr(c,n)||u)},t.prototype.updateCachedStats=function(e,t,n){var o=(Wt.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=Pr(e),a=function(e,t,n,o,r){var a,i=Ur(n.start,n.end),s=Wt.external.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=Sr(s,i);"PT"===o&&(a={mean:Ir(e,l.mean,!0)||0,stdDev:Ir(e,l.stdDev,!0)||0});var c=Math.PI*(i.width*(r.colPixelSpacing||1)/2)*(i.height*(r.rowPixelSpacing||1)/2);return{area:c||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a,handles:g(n)}}(e,t,n.handles,o,r);n.cachedStats=a,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,Wt.getToolState)(e.currentTarget,this.name);if(n){var o=e.detail,r=o.image,a=o.element,i=Wt.toolStyle.getToolWidth(),s=(0,Wt.getModule)("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=pr(o.canvasContext.canvas),p=Pr(r),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=(Wt.external.cornerstone.metaData.get("generalSeriesModule",r.imageId)||{}).modality,y=m&&g;mr(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=Wt.toolColors.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};gr(e,t.configuration);var g={color:p};if(f&&(g.lineDash=s),vr(e,a,h.handles.start,h.handles.end,g,"pixel",h.handles.initialRotation),t.configuration.drawHandles&&h.active){xr(e,o,dr(dr({},h.handles),{top:{drawnIndependently:!0},left:{drawnIndependently:!0},bottom:{drawnIndependently:!0},right:{drawnIndependently:!0}}),m);var b={color:p,lineWidth:i,lineDash:[2,3]};br(e,a,h.handles.start,h.handles.end,b)}if(!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(r,a,h):t.updateCachedStats(r,a,h)),!h.handles.textBox.hasMoved){var x=wr(o.viewport,h.handles);Object.assign(h.handles.textBox,x)}var w=Br(e,r.color,h.cachedStats,v,y,t.configuration);h.unit=Nr(v,t.configuration.showHounsfieldUnits),yr(e,a,h.handles.textBox,w,h.handles,(function(e){return _r(e.start,e.end)}),p,i,10,!0)}}}))}},t}(fr);const kr=Or;function Rr(e,t){var n=e.top,o=e.left,r=e.bottom,a=e.right,i=t.top,s=t.left,l=t.bottom,c=t.right;n.active?(e.start.y+=n.y-i.y,e.top.x=r.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):o.active?(e.start.x+=o.x-s.x,e.left.y=a.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2):r.active?(e.end.y+=r.y-l.y,e.bottom.x=n.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):a.active&&(e.end.x+=a.x-c.x,e.right.y=o.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2)}function _r(e,t){var n=Ur(e,t),o=n.left,r=n.top,a=n.width,i=n.height;return[{x:o+a/2,y:r},{x:o,y:r+i/2},{x:o+a/2,y:r+i},{x:o+a,y:r+i/2}]}function Nr(e,t){return"CT"===e&&!1!==t?"HU":""}function Br(e,t,n,o,r,a){var i=void 0===n?{}:n,s=i.area,l=i.mean,c=i.stdDev,u=i.min,d=i.max,f=i.meanStdDevSUV;void 0===a&&(a={});var h=a.showMinMax||!1,p=[],m=[];if(!t){var g=f&&0!==f.mean,v=Nr(o,a.showHounsfieldUnits),y="Mean: ".concat(Tr(l.toFixed(2))," ").concat(v),b="Std Dev: ".concat(Tr(c.toFixed(2))," ").concat(v);if(g){for(var x=" SUV: ",w="".concat(x).concat(Tr(f.mean.toFixed(2))),T="".concat(x).concat(Tr(f.stdDev.toFixed(2))),I=Math.floor(e.measureText("".concat(b,"     ")).width);e.measureText(y).width<I;)y+=" ";m.push("".concat(y).concat(w)),m.push("".concat(b,"     ").concat(T))}else m.push("".concat(y)),m.push("".concat(b));if(h){var E="Min: ".concat(u," ").concat(v),S="Max: ".concat(d," ").concat(v);for(I=g?Math.floor(e.measureText("".concat(b,"     ")).width):Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(E).width<I;)E+=" ";m.push("".concat(E).concat(S))}}return p.push(function(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Tr(e.toFixed(2))).concat(n)}(s,r)),m.forEach((function(e){return p.push(e)})),p}function Ur(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var Vr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Fr=(0,Wt.importInternal)("base/BaseAnnotationTool"),jr=(0,Wt.importInternal)("drawing/getNewContext"),Hr=(0,Wt.importInternal)("drawing/draw"),zr=(0,Wt.importInternal)("drawing/setShadow"),qr=(0,Wt.importInternal)("drawing/drawRect"),Wr=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),Gr=(0,Wt.importInternal)("drawing/drawHandles"),Yr=(0,Wt.importInternal)("util/getLogger"),Zr=(0,Wt.importInternal)("util/throttle"),Xr=(0,Wt.importInternal)("util/getPixelSpacing"),Kr=(0,Wt.importInternal)("util/calculateSUV"),Qr=(0,Wt.importInternal)("util/getROITextBoxCoords"),Jr=(0,Wt.importInternal)("util/numbersWithCommas"),$r=Yr?Yr("tools:annotation:LengthTool"):console,ea=(0,Wt.importInternal)("tools/cursors").rectangleRoiCursor,ta=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:ea};return(n=e.call(this,t,o)||this).throttledUpdateCachedStats=Zr(n.updateCachedStats,110),n}return Vr(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};$r.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,o){var r=t&&t.handles&&t.handles.start&&t.handles.end;if(r||$r.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var a="mouse"===o?15:25,i=Wt.external.cornerstone.pixelToCanvas(e,t.handles.start),s=Wt.external.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x),top:Math.min(i.y,s.y),width:Math.abs(i.x-s.x),height:Math.abs(i.y-s.y)};return Wt.external.cornerstoneMath.rect.distanceToPoint(l,n)<a},t.prototype.updateCachedStats=function(e,t,n){var o=(Wt.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,r=Xr(e),a=function(e,t,n,o,r){var a,i=oa(n.start,n.end),s=Wt.external.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=function(e,t){for(var n=0,o=0,r=0,a=0,i=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[a],o+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),r++,a++;if(0===r)return{count:r,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/r,d=o/r-u*u;return{count:r,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}}(s,i);"PT"===o&&(a={mean:Kr(e,l.mean,!0)||0,stdDev:Kr(e,l.stdDev,!0)||0});var c=i.width*(r.colPixelSpacing||1)*(i.height*(r.rowPixelSpacing||1)),u=2*i.width*(r.colPixelSpacing||1)+2*i.height*(r.rowPixelSpacing||1);return{area:c||0,perimeter:u,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,o,r);n.cachedStats=a,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,Wt.getToolState)(e.currentTarget,this.name);if(n){var o=e.detail,r=o.image,a=o.element,i=Wt.toolStyle.getToolWidth(),s=(0,Wt.getModule)("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=jr(o.canvasContext.canvas),p=Xr(r),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=(Wt.external.cornerstone.metaData.get("generalSeriesModule",r.imageId)||{}).modality,y=m&&g;Hr(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=Wt.toolColors.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};zr(e,t.configuration);var g={color:p};if(f&&(g.lineDash=s),qr(e,a,h.handles.start,h.handles.end,g,"pixel",h.handles.initialRotation),t.configuration.drawHandles&&h.active&&Gr(e,o,h.handles,m),!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(r,a,h):t.updateCachedStats(r,a,h)),!h.handles.textBox.hasMoved){var b=Qr(o.viewport,h.handles);Object.assign(h.handles.textBox,b)}var x=ia(e,r.color,h.cachedStats,v,y,t.configuration);h.unit=aa(v,t.configuration.showHounsfieldUnits),Wr(e,a,h.handles.textBox,x,h.handles,(function(e){return ra(e.start,e.end)}),p,i,10,!0)}}}))}},t}(Fr);const na=ta;function oa(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function ra(e,t){var n=oa(e,t),o=n.left,r=n.top,a=n.width,i=n.height;return[{x:o+a/2,y:r},{x:o,y:r+i/2},{x:o+a/2,y:r+i},{x:o+a,y:r+i/2}]}function aa(e,t){return"CT"===e&&!1!==t?"HU":""}function ia(e,t,n,o,r,a){var i=n.area,s=n.mean,l=n.stdDev,c=n.min,u=n.max,d=n.meanStdDevSUV;void 0===a&&(a={});var f=a.showMinMax||!1,h=[],p=[];if(!t){var m=d&&0!==d.mean,g=aa(o,a.showHounsfieldUnits),v="Mean: ".concat(Jr(s.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Jr(l.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Jr(d.mean.toFixed(2))),w="".concat(b).concat(Jr(d.stdDev.toFixed(2))),T=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<T;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(w))}else p.push("".concat(v)),p.push("".concat(y));if(f){var I="Min: ".concat(c," ").concat(g),E="Max: ".concat(u," ").concat(g);for(T=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(I).width<T;)I+=" ";p.push("".concat(I).concat(E))}}return h.push(function(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Jr(e.toFixed(2))).concat(n)}(i,r)),p.forEach((function(e){return h.push(e)})),h}var sa=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),la=(0,Wt.importInternal)("base/BaseAnnotationTool"),ca=(0,Wt.importInternal)("drawing/getNewContext"),ua=(0,Wt.importInternal)("drawing/draw"),da=(0,Wt.importInternal)("drawing/setShadow"),fa=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),ha=(0,Wt.importInternal)("drawing/drawLine"),pa=(0,Wt.importInternal)("drawing/drawHandles"),ma=(0,Wt.importInternal)("util/getLogger"),ga=(0,Wt.importInternal)("util/throttle"),va=(0,Wt.importInternal)("util/getPixelSpacing"),ya=(0,Wt.importInternal)("util/lineSegDistance"),ba=ma?ma("tools:annotation:LengthTool"):console,xa=(0,Wt.importInternal)("tools/cursors").lengthCursor,wa=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:xa,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return(n=e.call(this,t,o)||this).throttledUpdateCachedStats=ga(n.updateCachedStats,110),n}return sa(t,e),t.prototype.createNewMeasurement=function(e){var t,n=null===(t=null==e?void 0:e.currentPoints)||void 0===t?void 0:t.image;if(n){var o=n.x,r=n.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:o,y:r,highlight:!0,active:!1},end:{x:o,y:r,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}ba.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,o){if(!(t&&t.handles&&t.handles.start&&t.handles.end))return ba.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1;if(!1===t.visible)return!1;var r="mouse"===o?15:25;return ya(e,t.handles.start,t.handles.end,n)<r},t.prototype.updateCachedStats=function(e,t,n){var o=va(e),r=o.rowPixelSpacing,a=o.colPixelSpacing,i=(n.handles.end.x-n.handles.start.x)*(a||1),s=(n.handles.end.y-n.handles.start.y)*(r||1),l=Math.sqrt(i*i+s*s);n.length=l,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,o=this.configuration,r=o.handleRadius,a=o.drawHandlesOnHover,i=o.hideHandlesIfMoving,s=o.renderDashed,l=o.digits,c=(0,Wt.getToolState)(e.currentTarget,this.name);if(c)for(var u=ca(n.canvasContext.canvas),d=n.image,f=n.element,h=va(d),p=h.rowPixelSpacing,m=h.colPixelSpacing,g=Wt.toolStyle.getToolWidth(),v=(0,Wt.getModule)("globalConfiguration").configuration.lineDash,y=function(e){var o=c.data[e];if(!1===o.visible)return"continue";ua(u,(function(e){da(e,t.configuration);var c=Wt.toolColors.getColorIfActive(o),u={color:c};s&&(u.lineDash=v),ha(e,f,o.handles.start,o.handles.end,u);var h={color:c,handleRadius:r,drawHandlesIfActive:a,hideHandlesIfMoving:i};if(t.configuration.drawHandles&&o.active&&pa(e,n,o.handles,h),!o.handles.textBox.hasMoved){var y={x:Math.max(o.handles.start.x,o.handles.end.x)};y.x===o.handles.start.x?y.y=o.handles.start.y:y.y=o.handles.end.y,o.handles.textBox.x=y.x,o.handles.textBox.y=y.y}!0===o.invalidated&&(o.length?t.throttledUpdateCachedStats(d,f,o):t.updateCachedStats(d,f,o));var b=function(e,t,n){var o=function(e){var t=Number(e),n=!isNaN(t);return n?t:void 0}(e.length);if(!o)return"";var r="mm";t&&n||(r="pixels");return e.unit=r,"".concat(o.toFixed(l)," ").concat(r)}(o,p,m);fa(e,f,o.handles.textBox,b,o.handles,x,c,g,10,!0)}))},b=0;b<c.data.length;b++)y(b);function x(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}},t}(la);const Ta=wa;var Ia=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ea=(0,Wt.importInternal)("base/BaseAnnotationTool"),Sa=(0,Wt.importInternal)("manipulators/moveNewHandle"),Ca=(0,Wt.importInternal)("drawing/getNewContext"),Aa=(0,Wt.importInternal)("drawing/draw"),Ma=(0,Wt.importInternal)("drawing/setShadow"),Pa=(0,Wt.importInternal)("drawing/drawJoinedLines"),Da=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),La=(0,Wt.importInternal)("drawing/drawHandles"),Oa=(0,Wt.importInternal)("util/triggerEvent"),ka=(0,Wt.importInternal)("util/lineSegDistance"),Ra=(0,Wt.importInternal)("util/roundToDecimal"),_a=(0,Wt.importInternal)("util/throttle"),Na=(0,Wt.importInternal)("util/getPixelSpacing"),Ba=(0,Wt.importInternal)("drawing/textBoxWidth"),Ua=(0,Wt.importInternal)("tools/cursors").angleCursor,Va=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ua,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,o)||this).preventNewMeasurement=!1,n.throttledUpdateCachedStats=_a(n.updateCachedStats,110),n}return Ia(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,o){if(!1===t.visible)return!1;var r="mouse"===o?15:25;return ka(e,t.handles.start,t.handles.middle,n)<r||ka(e,t.handles.middle,t.handles.end,n)<r},t.prototype.updateCachedStats=function(e,t,n){if(n.handles.middle){var o=Ha(e,n.handles.middle,n.handles.start),r=Ha(e,n.handles.end,n.handles.middle),a=Ha(e,n.handles.end,n.handles.start),i=ja(o),s=ja(r),l=ja(a),c=Math.acos((Math.pow(i,2)+Math.pow(s,2)-Math.pow(l,2))/(2*i*s));c*=180/Math.PI,n.rAngle=Ra(c,2),n.invalidated=!1}},t.prototype.renderToolData=function(e){var t=this,n=e.detail,o=n.enabledElement,r=this.configuration,a=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=(0,Wt.getToolState)(e.currentTarget,this.name),u=(0,Wt.getModule)("globalConfiguration").configuration.lineDash;if(c)for(var d=Ca(n.canvasContext.canvas),f=n.image,h=n.element,p=Na(f),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=Wt.toolStyle.getToolWidth(),y=function(e){var r=c.data[e];if(!1===r.visible)return"continue";Aa(d,(function(e){Ma(e,t.configuration);var c=Wt.toolColors.getColorIfActive(r),d=Wt.external.cornerstone.pixelToCanvas(n.element,r.handles.start),p=Wt.external.cornerstone.pixelToCanvas(n.element,r.handles.middle),y={color:c};l&&(y.lineDash=u),Pa(e,n.element,r.handles.start,[r.handles.middle,r.handles.end],y);var b={color:c,handleRadius:a,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&r.active&&La(e,n,r.handles,b),!0===r.invalidated&&(r.rAngle?t.throttledUpdateCachedStats(f,h,r):t.updateCachedStats(f,h,r)),r.rAngle){var w=function(e,t,n){var o=t&&n?"":" (isotropic)",r="00B0";return e.rAngle.toString()+String.fromCharCode(parseInt(r,16))+o}(r,m,g),T=void 0;if(!r.handles.textBox.hasMoved){T={x:p.x,y:p.y};var I=Ba(e,w,5);p.x<d.x?T.x-=15+I+10:T.x+=15;var E=Wt.external.cornerstone.internal.getTransform(o);E.invert();var S=E.transformPoint(T.x,T.y);r.handles.textBox.x=S.x,r.handles.textBox.y=S.y}Da(e,n.element,r.handles.textBox,w,r.handles,x,c,v,0,!0)}}))},b=0;b<c.data.length;b++)y(b);function x(e){return[e.start,e.middle,e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var o=e.detail,r=this.createNewMeasurement(o),a=e.detail.element;(0,Wt.addToolState)(a,this.name,r),Wt.external.cornerstone.updateImage(a),Sa(o,this.name,r,r.handles.middle,this.options,t,(function(e){if(r.active=!1,!e)return(0,Wt.removeToolState)(a,n.name,r),void(n.preventNewMeasurement=!1);r.handles.end.active=!0,Wt.external.cornerstone.updateImage(a),Sa(o,n.name,r,r.handles.end,n.options,t,(function(e){e?(r.active=!1,Wt.external.cornerstone.updateImage(a)):(0,Wt.removeToolState)(a,n.name,r),n.preventNewMeasurement=!1,Wt.external.cornerstone.updateImage(a);var t={toolName:n.name,toolType:n.name,element:a,measurementData:r};Oa(a,Wt.EVENTS.MEASUREMENT_COMPLETED,t)}))}))}},t}(Ea);const Fa=Va;function ja(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function Ha(e,t,n){var o=Na(e),r=o.rowPixelSpacing,a=o.colPixelSpacing;return{x:(t.x-n.x)*(a||1),y:(t.y-n.y)*(r||1)}}var za=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const qa=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"Pointer",supportedInteractionTypes:["Mouse","Touch"]})||this}return za(t,e),t}((0,Wt.importInternal)("base/BaseTool"));var Wa=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ga=(0,Wt.importInternal)("base/BaseAnnotationTool"),Ya=(0,Wt.importInternal)("manipulators/moveNewHandle"),Za=(0,Wt.importInternal)("drawing/getNewContext"),Xa=(0,Wt.importInternal)("drawing/draw"),Ka=(0,Wt.importInternal)("drawing/setShadow"),Qa=(0,Wt.importInternal)("drawing/drawLine"),Ja=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),$a=(0,Wt.importInternal)("drawing/drawHandles"),ei=(0,Wt.importInternal)("util/triggerEvent"),ti=(0,Wt.importInternal)("util/lineSegDistance"),ni=(0,Wt.importInternal)("util/roundToDecimal"),oi=(0,Wt.importInternal)("util/throttle"),ri=(0,Wt.importInternal)("util/getPixelSpacing"),ai=(0,Wt.importInternal)("tools/cursors").cobbAngleCursor,ii=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:ai,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,o)||this).hasIncomplete=!1,n.throttledUpdateCachedStats=oi(n.updateCachedStats,110),n}return Wa(t,e),t.prototype.createNewMeasurement=function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,o){if(!1===t.visible)return!1;var r="mouse"===o?15:25,a=ti(e,t.handles.start,t.handles.end,n)<r,i=ti(e,t.handles.start2,t.handles.end2,n)<r;return a||i},t.prototype.updateCachedStats=function(e,t,n){var o=ri(e),r=o.rowPixelSpacing,a=o.colPixelSpacing,i=(n.handles.start.x-n.handles.end.x)*(a||1),s=(n.handles.start.y-n.handles.end.y)*(r||1),l=(n.handles.start2.x-n.handles.end2.x)*(a||1),c=(n.handles.start2.y-n.handles.end2.y)*(r||1),u=Math.acos((i*l+s*c)/(Math.sqrt(i*i+s*s)*Math.sqrt(l*l+c*c)));u*=180/Math.PI,n.rAngle=ni(u,2),n.lAngle2=ni(360-u,2),n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,o=this.configuration,r=o.handleRadius,a=o.drawHandlesOnHover,i=o.hideHandlesIfMoving,s=o.renderDashed,l=(0,Wt.getToolState)(e.currentTarget,this.name);if(l)for(var c=Za(n.canvasContext.canvas),u=Wt.toolStyle.getToolWidth(),d=(0,Wt.getModule)("globalConfiguration").configuration.lineDash,f=Wt.textStyle.getFont(),h=e.detail.element,p=Wt.external.cornerstone.getEnabledElement(h).image,m=ri(p),g=m.rowPixelSpacing,v=m.colPixelSpacing,y=function(e){var o=l.data[e],p=o.handles,m=p.start,y=p.end,x=p.start2,T=p.end2;if(!1===o.visible)return"continue";o.value||(o.value=b.textBoxText(o,g,v)),Xa(c,(function(e){Ka(e,t.configuration);var l=Wt.toolColors.getColorIfActive(o),c={color:l};s&&(c.lineDash=d),Qa(e,n.element,m,y,c);var p={color:l,lineWidth:u,lineDash:[2,3]};if(o.active||!o.complete){var g=li(n,m,y),v=g.start,b=g.end;Qa(e,h,v,b,p)}if(o.complete&&(Qa(e,n.element,x,T,c),o.active)){var I=li(n,x,T),E=I.start,S=I.end;Qa(e,h,E,S,p)}var C={color:l,handleRadius:r,drawHandlesIfActive:a,hideHandlesIfMoving:i};t.configuration.drawHandles&&o.active&&$a(e,n,o.handles,C),e.fillStyle=l;var A=o.value;if(!o.handles.textBox.hasMoved){var M={x:(m.x+y.x)/2,y:(m.y+y.y)/2+10};e.font=f,o.handles.textBox.x=M.x,o.handles.textBox.y=M.y}o.complete&&Ja(e,n.element,o.handles.textBox,A,o.handles,w,l,u,0,!0)}))},b=this,x=0;x<l.data.length;x++)y(x);function w(e){return[e.start,e.start2,e.end,e.end2]}},t.prototype.getIncomplete=function(e){var t=(0,Wt.getToolState)(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))},t.prototype.addNewMeasurement=function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var o,r,a=e.detail,i=function(e){if(e){var t=Wt.EVENTS.MEASUREMENT_COMPLETED,r={toolName:n.name,toolType:n.name,element:s,measurementData:o};ei(s,t,r)}else(0,Wt.removeToolState)(s,n.name,o)},s=e.detail.element,l=this.getIncomplete(s);l?((o=l).complete=!0,o.handles.start2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},o.handles.end2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},r=o.handles.end2,this.hasIncomplete=!1,i=function(e){if(e){var t=Wt.EVENTS.MEASUREMENT_COMPLETED,r={toolName:n.name,toolType:n.name,element:s,measurementData:o};ei(s,t,r)}else(0,Wt.removeToolState)(s,n.name,o)}):(o=this.createNewMeasurement(a),(0,Wt.addToolState)(s,this.name,o),r=o.handles.end),Wt.external.cornerstone.updateImage(s),Ya(a,this.name,o,r,this.options,t,i)},t.prototype.onMeasureModified=function(e){var t=e.detail.element,n=Wt.external.cornerstone.getEnabledElement(t).image,o=ri(n),r=o.rowPixelSpacing,a=o.colPixelSpacing;if(e.detail.toolName===this.name){var i=e.detail.measurementData;!0===i.invalidated&&(i.rAngle?this.throttledUpdateCachedStats(n,t,i):this.updateCachedStats(n,t,i)),i.value=this.textBoxText(i,r,a)}},t.prototype.textBoxText=function(e,t,n){var o=e.rAngle,r=e.lAngle2;if(void 0===o)return"";if(Number.isNaN(o))return"";var a=t&&n?"":" (isotropic)";return"".concat(o,"°").concat(a," (").concat(r,"°").concat(a,")")},t.prototype.activeCallback=function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(Wt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.passiveCallback=function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(Wt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.enabledCallback=function(e){e.removeEventListener(Wt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.disabledCallback=function(e){e.removeEventListener(Wt.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t}(Ga);const si=ii;function li(e,t,n){var o,r,a,i,s=e.image,l=s.columnPixelSpacing,c=void 0===l?1:l,u=s.rowPixelSpacing,d=void 0===u?1:u,f={x:(t.x+n.x)/2,y:(t.y+n.y)/2};if(t.x===n.x&&t.y===n.y)o=t.x,r=t.y,a=n.x,i=n.y;else{var h=function(e,t,n,o){var r=(n.x-o.x)*e,a=(n.y-o.y)*t,i=Math.sqrt(r*r+a*a);return{x:r/i,y:a/i,length:i}}(c,d,t,n),p=10*h.length,m=p/(2*d),g=p/(2*c);o=f.x+g*h.y,r=f.y-m*h.x,a=f.x-g*h.y,i=f.y+m*h.x}return{start:{x:o,y:r},mid:f,end:{x:a,y:i}}}var ci=Wt.store.state,ui=Wt.store.modules.globalConfiguration;function di(e,t){ci.svgCursorUrl&&window.URL.revokeObjectURL(ci.svgCursorUrl),ci.svgCursorUrl=null,e.style.cursor=t}var fi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),hi=(0,Wt.importInternal)("base/BaseTool"),pi=(0,Wt.importInternal)("drawing/getNewContext"),mi=(0,Wt.importInternal)("tools/cursors").magnifyCursor,gi=function(e){function t(t){void 0===t&&(t={});var n=this,o={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:mi};return(n=e.call(this,t,o)||this).zoomCanvas=void 0,n.zoomElement=void 0,n.activeCallback=n._createMagnificationCanvas.bind(n),n.enabledCallback=n._createMagnificationCanvas.bind(n),n.disabledCallback=n._destroyMagnificationCanvas.bind(n),n.postTouchStartCallback=n._addMagnifyingGlass.bind(n),n.touchDragCallback=n._updateMagnifyingGlass.bind(n),n.touchEndCallback=n._removeMagnifyingGlass.bind(n),n.touchDragEndCallback=n._removeMagnifyingGlass.bind(n),n.postMouseDownCallback=n._addMagnifyingGlass.bind(n),n.mouseDragCallback=n._updateMagnifyingGlass.bind(n),n.mouseUpCallback=n._removeMagnifyingGlass.bind(n),n.mouseClickCallback=n._removeMagnifyingGlass.bind(n),n.newImageCallback=n._drawMagnificationTool.bind(n),n}return fi(t,e),t.prototype._addMagnifyingGlass=function(e){var t,n=this;(this._removeZoomElement(),e.detail.element.querySelector(".active"))||(this._drawZoomedElement(e),window.requestAnimationFrame((function(){return n._drawMagnificationTool(e)})),t=e.detail.element,ui.configuration.showSVGCursors&&di(t,"none"),e.preventDefault(),e.stopPropagation())},t.prototype._updateMagnifyingGlass=function(e){e.detail.element.querySelector(".active")||(this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation())},t.prototype._removeMagnifyingGlass=function(e){var t=e.detail.element;!function(e,t){if(ui.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),o=t.mousePoint,r=window.URL.createObjectURL(n);e.style.cursor="url('".concat(r,"') ").concat(o,", auto"),ci.svgCursorUrl=r}}(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()},t.prototype._drawMagnificationTool=function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(void 0!==this.zoomCanvas){var o=t.querySelector("canvas:not(.magnifyTool)"),r=pi(n),a=Wt.external.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),i=Math.min(this.configuration.magnifySize,o.width,o.height),s=this.configuration.magnificationLevel;n.width=i,n.height=i,a.x=Math.max(a.x,.5*i/s),a.x=Math.min(a.x,o.width-.5*i/s),a.y=Math.max(a.y,.5*i/s),a.y=Math.min(a.y,o.height-.5*i/s);var l={x:a.x*s-.5*i,y:a.y*s-.5*i};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),r.drawImage(this.zoomCanvas,l.x,l.y,i,i,0,0,i,i);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(a.y-.5*i-c,0),left:Math.max(a.x-.5*i,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,o.height-d.height),u.left=Math.min(u.left,o.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}},t.prototype._drawZoomedElement=function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=Wt.external.cornerstone.getEnabledElement(t));var o=this.configuration.magnificationLevel,r=n.canvas,a=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=r.width*o,this.zoomElement.height=r.height*o,Wt.external.cornerstone.enable(this.zoomElement,n.options));var i=Wt.external.cornerstone.getEnabledElement(this.zoomElement),s=Wt.external.cornerstone.getViewport(n.element);this.zoomCanvas=i.canvas,this.zoomCanvas.width=r.width*o,this.zoomCanvas.height=r.height*o,i.viewport=Object.assign({},s),s.scale*=o,Wt.external.cornerstone.displayImage(this.zoomElement,a),Wt.external.cornerstone.setViewport(this.zoomElement,s)},t.prototype._removeZoomElement=function(){void 0!==this.zoomElement&&(Wt.external.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)},t.prototype._createMagnificationCanvas=function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}},t.prototype._destroyMagnificationCanvas=function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)},t}(hi);const vi=gi;var yi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),bi=(0,Wt.importInternal)("base/BaseTool"),xi=(0,Wt.importInternal)("util/angleBetweenPoints"),wi=(0,Wt.importInternal)("tools/cursors").rotateCursor;const Ti=function(e){function t(t){void 0===t&&(t={});var n={name:"Rotate",strategies:{default:Ii,horizontal:Ei,vertical:Si},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:wi};return e.call(this,t,n)||this}return yi(t,e),t.prototype.touchDragCallback=function(e){this.dragCallback(e)},t.prototype.mouseDragCallback=function(e){this.dragCallback(e)},t.prototype.postTouchStartCallback=function(e){this.initialRotation=e.detail.viewport.rotation},t.prototype.postMouseDownCallback=function(e){this.initialRotation=e.detail.viewport.rotation},t.prototype.dragCallback=function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),Wt.external.cornerstone.setViewport(e.detail.element,e.detail.viewport)},t}(bi);function Ii(e){var t,n=this.configuration,o=n.roundAngles,r=n.rotateScale,a=e.detail,i=a.element,s=a.viewport,l=a.startPoints,c=a.currentPoints,u=null!==(t=s.initialRotation)&&void 0!==t?t:s.rotation,d=i.getBoundingClientRect(i),f=i.clientWidth,h=i.clientHeight,p=s.scale,m=s.translation,g={x:d.left+f/2+m.x*p,y:d.top+h/2+m.y*p},v=xi(g,l.client,c.client);v.angle*=r,o&&(v.angle=Math.ceil(v.angle)),v.direction<0&&(v.angle=-v.angle),s.rotation=u+v.angle}function Ei(e){var t=this.configuration,n=t.roundAngles,o=t.flipHorizontal,r=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.x,d=(l.client.x-u)*r;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),o&&(d=-d),i.rotation=c+d}function Si(e){var t=this.configuration,n=t.roundAngles,o=t.flipVertical,r=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.y,d=(l.client.y-u)*r;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),o&&(d=-d),i.rotation=c+d}var Ci,Ai=function(){return Ai=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ai.apply(this,arguments)},Mi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Pi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Di=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Li=new Map,Oi={},ki={store:{},IDArr:void 0,add:function(e,t){this.store[e]||(this.store[e]=[]),this.store[e].push(Number(t))},sort:function(){for(var e in this.IDArr=[],this.store)this.IDArr.push(e),this.store[e].sort((function(e,t){return e-t}))},getFirstIndex:function(e){var t;return null===(t=this.store[e])||void 0===t?void 0:t[0]},getSeriesIDArr:function(){if(!this.IDArr)for(var e in this.IDArr=[],this.store)this.IDArr.push(e);return this.IDArr}};function Ri(e){var t={Calcification:Ci.calcification,Ground_Glass:Ci.groundGlass,Part_Solid:Ci.partSolid,Solid:Ci.solid,pleural:Ci.pleural},n=[];for(var o in e){var r={name:o,value:e[o],typeText:t[o]};n.push(r)}return n.sort((function(e,t){return t.value-e.value})),n[0].typeText}function _i(e){return e<.25?Ci.benign:e<.5?Ci.borderlineBenign:e<.75?Ci.borderlineMalignant:e<1?Ci.malignant:void 0}function Ni(e){var t=e.nodule_no,n=e.nodule_volume,o=e.nodule_maxHU,r=e.nodule_minHU,a=Pi(e.nodule_cross,1)[0],i=a.major_diameter_length_mm,s=a.minor_diameter_length_mm,l=e.noduleType,c=e.noduleBmProbCN;return["".concat(Ci.number,":N").concat(t),"".concat(Ci.longShortMeridian,": ").concat(i.toFixed(2),"*").concat(s.toFixed(2),"mm"),"".concat(Ci.volume,": ").concat(n.toFixed(2),"mm").concat(String.fromCharCode(179)),"Min: ".concat(r,"HU  Max: ").concat(o,"HU"),"".concat(Ci.type,": ").concat(l,"  ").concat(Ci.lesions,": ").concat(c)]}var Bi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ui=function(){return Ui=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ui.apply(this,arguments)},Vi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Fi=(0,Wt.importInternal)("base/BaseAnnotationTool"),ji=(0,Wt.importInternal)("drawing/getNewContext"),Hi=(0,Wt.importInternal)("drawing/draw"),zi=(0,Wt.importInternal)("drawing/drawRect"),qi=(0,Wt.importInternal)("drawing/drawLinkedTextBox"),Wi=(0,Wt.importInternal)("util/getLogger"),Gi=Wi?Wi("tools:annotation:LengthTool"):console,Yi=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"AI",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}})||this}return Bi(t,e),t.prototype.activeCallback=function(e){this.forceImageUpdate(e)},t.prototype.passiveCallback=function(e){this.forceImageUpdate(e)},t.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.forceImageUpdate=function(e){Wt.external.cornerstone.getEnabledElement(e).image&&Wt.external.cornerstone.updateImage(e)},t.prototype.createNewMeasurement=function(){},t.prototype.updateCachedStats=function(){},t.prototype.pointNearTool=function(e,t,n,o){var r=t&&t.handles&&t.handles.start&&t.handles.end;if(r||Gi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var a="mouse"===o?15:25,i=Wt.external.cornerstone.pixelToCanvas(e,t.handles.start),s=Wt.external.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x),top:Math.min(i.y,s.y),width:Math.abs(i.x-s.x),height:Math.abs(i.y-s.y)},c=Wt.external.cornerstoneMath.rect.distanceToPoint(l,n);return t.handles.disable=c<a,t.handles.disable},t.prototype.renderToolData=function(e){var t=this,n=(0,Wt.getToolState)(e.currentTarget,this.name),o=e.currentTarget.dataset,r=o.seriesId,a=o.currentImageIdIndex;if(!n){var i=Li.get("".concat(r,"?index=").concat(a));if(!i)return;n={data:i},i.forEach((function(o,r){r>=1&&Wt.external.cornerstoneMath.point.distance(o.handles.textBox,n.data[r-1].handles.textBox)<100&&(o.textBoxPointsCompute=!0),(0,Wt.addToolState)(e.currentTarget,t.name,o)}))}var s=e.detail,l=s.image,c=s.element,u=Wt.toolStyle.getToolWidth(),d=(0,Wt.getModule)("globalConfiguration").configuration.lineDash,f=this.configuration,h=f.handleRadius,p=f.drawHandlesOnHover,m=f.hideHandlesIfMoving,g=f.renderDashed,v=ji(s.canvasContext.canvas);Hi(v,(function(e){for(var t=0;t<n.data.length;t++){var o=n.data[t],r=Wt.toolColors.getColorIfActive(o),a={color:r,handleRadius:h,drawHandlesIfActive:p,hideHandlesIfMoving:m};g&&({color:r}.lineDash=d),zi(e,c,o.handles.start,o.handles.end,a,"pixel");if(o.textBoxPointsCompute){var i=Vi([200,150],2),s=i[0],f=i[1],v=l.height-f,y=l.width-s,b={x:0,y:0};switch(t){case 2:b={x:y,y:0};break;case 3:b={x:0,y:v};break;case 4:b={x:y,y:v}}o.handles.textBox=Ui(Ui({},o.handles.textBox),b),o.textBoxPointsCompute=!1}qi(e,c,o.handles.textBox,o.textBoxContent,o.handles,(function(e){return[e.start,e.end]}),r,u,20,!1)}}))},t}(Fi);const Zi=Yi;var Xi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ki=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Qi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Ji=(0,Wt.importInternal)("base/BaseTool"),$i=(0,Wt.importInternal)("drawing/getNewContext"),es=(0,Wt.importInternal)("drawing/draw"),ts=(0,Wt.importInternal)("drawing/drawTextBox");!function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"OrientationMarkers",configuration:{},mixins:["enabledOrDisabledBinaryTool"]})||this}Xi(t,e),t.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.forceImageUpdate=function(e){Wt.external.cornerstone.getEnabledElement(e).image&&Wt.external.cornerstone.updateImage(e)},t.prototype.renderToolData=function(e){var t=e.detail,n=$i(t.canvasContext.canvas),o=t.image,r=o.width,i=o.height,s=o.imageId,l=t.element,c=a.metaData.get("imageOrientationTagModule","cacheDB:"+s)||{},u=c.imageleftTag,d=c.imagetopTag,f=c.imagetightTag,h=c.imageBottomTag;es(n,(function(e){var t,n;try{for(var o=Ki([[0,i/2,u,{y:!0}],[r/2,0,d,{x:!0}],[r-30,i/2,f,{y:!0}],[r/2,i-10,h,{x:!0,y:!0}]]),s=o.next();!s.done;s=o.next()){var c=Qi(s.value,4),p=c[0],m=c[1],g=c[2],v=c[3],y=(0,a.pixelToCanvas)(l,{x:p,y:m,_pixelCoordinateBrand:""});ts(e,g,y.x,y.y,Wt.toolColors.getToolColor(),{centering:v})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}))}}(Ji);var ns=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const os=function(e){function t(t){void 0===t&&(t={});var n=this;return(n=e.call(this,t,{name:"PersistentSate",configuration:{},mixins:["enabledOrDisabledBinaryTool"]})||this).state="disabled",n}return ns(t,e),t.prototype.enabledCallback=function(){this.state="enabled"},t.prototype.disabledCallback=function(){this.state="disabled"},t}((0,Wt.importInternal)("base/BaseTool"));var rs=q.toolsOptions,as=rs.toolColor,is=rs.zoomTool,ss={configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:is.minScale,maxScale:is.maxScale}};function ls(){(0,Wt.setToolEnabled)("PersistentSate"),(0,Wt.setToolEnabled)("ScaleOverlay"),(0,Wt.setToolEnabled)("OrientationMarkers"),q.isMobile?((0,Wt.setToolActive)("ZoomTouchPinch",{}),(0,Wt.setToolActive)("PanMultiTouch",{})):((0,Wt.setToolActive)("StackScrollMouseWheel",{}),(0,Wt.setToolActive)("Wwwc",{mouseButtonMask:2}),(0,Wt.setToolActive)("Pan",{mouseButtonMask:4}))}Wt.external.cornerstoneMath=qt(),Wt.external.cornerstone=i(),Wt.external.Hammer=Ht(),(0,Wt.init)({globalToolSyncEnabled:!0,mouseEnabled:!0,showSVGCursors:!0,autoResizeViewports:!0}),(0,Wt.addTool)(Wt.WwwcTool),(0,Wt.addTool)(Ti),(0,Wt.addTool)(Wt.ReferenceLinesTool),(0,Wt.addTool)(kr,{configuration:{showMinMax:!0}}),(0,Wt.addTool)(Wt.StackScrollTool),(0,Wt.addTool)(Wt.FreehandRoiTool,{configuration:{showMinMax:!0}}),(0,Wt.addTool)(Wt.CircleRoiTool,{configuration:{showMinMax:!0}}),(0,Wt.addTool)(vi),(0,Wt.addTool)(Wt.EraserTool),(0,Wt.addTool)(Wt.PanTool),(0,Wt.addTool)(Ao,{}),(0,Wt.addTool)(na,{configuration:{showMinMax:!0}}),(0,Wt.addTool)(Ta,{}),(0,Wt.addTool)(Fa,{}),(0,Wt.addTool)(qa),(0,Wt.addTool)(si),(0,Wt.addTool)(Yo),(0,Wt.addTool)(ir),(0,Wt.addTool)(jn,{markerFlag:"L"}),(0,Wt.addTool)(jn,{markerFlag:"R"}),(0,Wt.addTool)(ro),(0,Wt.addTool)(Cn),(0,Wt.addTool)(ln),(0,Wt.addTool)($t),(0,Wt.addTool)(Zi),(0,Wt.addTool)(Wt.OrientationMarkersTool),(0,Wt.addTool)(Wt.ZoomTool,ss),(0,Wt.addTool)(os),q.isMobile?((0,Wt.addTool)(Wt.ZoomTouchPinchTool,ss),(0,Wt.addTool)(Wt.PanMultiTouchTool)):(0,Wt.addTool)(Wt.StackScrollMouseWheelTool),Wt.toolColors.setToolColor(as),Wt.store.state.clickProximity=20,Wt.store.state.touchProximity=30,Wt.store.state.handleRadius=8;var cs=(0,s.debounce)((function(){if("disabled"===(Wt.store.state.tools.find((function(e){return"PersistentSate"===e.name}))||{}).state){var e=q.webDicomView.layoutView.querySelectorForTool(".disableAllTool");ls(),console.info("ForceEnabledGlobalTools"),e.click()}}),2e3);ls();var us=n(5947);(0,us.configure)({parent:".viewerContentWrapper"});var ds;ds=function(){try{var e=navigator.userAgent.toLowerCase();if(e.indexOf("win32")>=0||e.indexOf("wow32")>=0)return 32;if(e.indexOf("win64")>=0||e.indexOf("wow64")>=0)return 64;if(new ActiveXObject("Wscript.Shell").RegRead("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\PROCESSOR_ARCHITECTURE").toLowerCase().indexOf("32")>=0)return 32}catch(e){}}(),console.info("systemInfo",{performance,navigator,screen,history,location,window,systemArchitecture:ds}),32===ds&&dt().info({title:_("toast.is32System"),timeout:0}),void 0===n.g.structuredClone&&(n.g.structuredClone=function(e){return JSON.parse(JSON.stringify(e))},dt().info({title:_("toast.kernelVersionLow"),timeout:0}));var fs=function(){return fs=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},fs.apply(this,arguments)};const hs=function(e,t){try{(0,a.getEnabledElement)(e)}catch(n){(0,a.enable)(e,fs({},t))}};var ps=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ms=function(e){var t=e.element,n=e.canvas;try{var o={element:t};(0,a.triggerEvent)(t,a.EVENTS.ELEMENT_DISABLED,o),(0,a.triggerEvent)(a.events,a.EVENTS.ELEMENT_DISABLED,o),1===t.querySelectorAll("canvas").length&&(null==t||t.removeChild(n)),e.canvas=void 0}catch(e){console.info(e)}},gs=function(){var e,t,n=(0,a.getEnabledElements)();try{for(var o=ps(n),r=o.next();!r.done;r=o.next()){var i=r.value;ms(i)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n.length=0};const vs=function e(t){if(void 0===t)throw new Error("disable: element must not be undefined");for(var n=(0,a.getEnabledElements)(),o=0;o<n.length;o++){var r=n[o];if(r.element===t){var i=t.querySelectorAll("canvas");i.length>1&&i.forEach((function(t){return setTimeout((function(){return e(t.parentElement)}))})),ms(r),n.splice(o,1)}}};const ys=new s.PromiseQueue;var bs=function(){return bs=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},bs.apply(this,arguments)},xs=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},ws=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};i().loadAndCacheImage=function(e,t){return void 0===t&&(t={}),(0,a.loadAndCacheImage)(e,bs(bs({},t),{useRGBA:!0}))};var Ts=function(e,t){return new Promise((function(n,o){return xs(void 0,void 0,void 0,(function(){var r,a,l,c,u,d;return ws(this,(function(f){switch(f.label){case 0:return f.trys.push([0,2,,4]),[4,i().loadAndCacheImage(e,t)];case 1:return r=f.sent(),n(r),[3,4];case 2:return a=f.sent(),l=_("toast"),c=l.loadAndCacheImage,u=l.indexedDBDelete,o(a),5e3,mt("loadAndCacheImage",(0,s.throttle)((function(e){var t,n=((null==e?void 0:e.error)||{}).status;t=void 0===n?c.parsingFailed:203===n?c.validationFailed:c.dataError,console.error(t,e,n),dt().error({title:t,timeout:5e3})}),5e3,{trailing:!1}),a),d=ct(e,q.imageType).indexedDBKey,[4,Dt.open()];case 3:return f.sent(),console.info(u,d),Dt.dispatch("delete",{},d),[3,4];case 4:return[2]}}))}))}))};const Is=function(e,t){return xs(void 0,void 0,void 0,(function(){var n,o,r,a,i,s,l,c;return ws(this,(function(u){switch(u.label){case 0:return o=(n=t||{}).cancel,r=void 0===o||o,a=n.forceCancelAll,i=void 0!==a&&a,s=n.countCallback,l="function"==typeof s,c=0,i?[2,ys.cancel()]:(!q.preload.fullLoad&&r&&ys.cancel(),[4,ys.init({arr:e,func:function(e){return xs(void 0,void 0,void 0,(function(){var t,n;return ws(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Ts(e)];case 1:return t=o.sent(),c+=1,1,l&&s(t,e,c),te("loadAndCacheImages",!1,400)&&0,[3,3];case 2:return n=o.sent(),console.error(n),[3,3];case 3:return[2]}}))}))},limit:6})]);case 1:return u.sent(),[2]}}))}))};const Es=function(e){var t=(0,a.getEnabledElement)(e);t.renderingTools.colormapId=void 0,t.renderingTools.colorLut=void 0;var n=t.renderingTools.renderCanvas,o=n.getContext("2d",{willReadFrequently:!0});o.fillStyle="white",o.fillRect(0,0,n.width,n.height);var r=o.getImageData(0,0,n.width,n.height);t.renderingTools.renderCanvasContext=o,t.renderingTools.renderCanvasData=r};var Ss=[{type:"CT-Air"},{type:"CT-MIP"},{type:"CT-Soft-Tissue",name:"CT-软组织"},{type:"CT-Fat",name:"CT-脂肪"},{type:"CT-Lung",name:"CT-肺"},{type:"CT-Muscle",name:"CT-肌肉"},{type:"CT-Bone",name:"CT-骨"},{type:"CT-Bones",name:"CT-骨骼"},{type:"CT-Cropped-Volume-Bone",name:"CT-截骨"},{type:"CT-Cardiac",name:"CT-心脏"},{type:"CT-Cardiac2",name:"CT-心脏2"},{type:"CT-Cardiac3",name:"CT-心脏3"},{type:"CT-Chest-Contrast-Enhanced",name:"CT-胸部增强"},{type:"CT-Liver-Vasculature",name:"CT-肝血管"},{type:"CT-Chest-Vessels",name:"CT-胸部血管"},{type:"CT-Coronary-Arteries",name:"CT-冠状动脉"},{type:"CT-Coronary-Arteries-2",name:"CT-冠状动脉2"},{type:"CT-Coronary-Arteries-3",name:"CT-冠状动脉3"},{type:"CT-Pulmonary-Arteries",name:"CT-肺动脉"},{type:"CT-AAA"},{type:"CT-AAA2"},{type:"MR-Default"},{type:"MR-MIP"},{type:"MR-Angio",name:"MR-血管"},{type:"MR-T2-Brain",name:"MR-T2-大脑"},{type:"DTI-FA-Brain",name:"DTI-FA-大脑"}];const Cs=Ss;var As=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Ms=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Ps=new s.ComputeStore,Ds=function(){var e=_("tools"),t=O().includes("zh");return{main:[{toolName:e.seriesBar,toolTag:"seriesBar",icon:"icon-dicom-side",disActive:!0,visibility:function(){return q.isMobile&&q.toolsBar.seriesBarVisibility}},{toolName:e.MPR,toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:function(){return q.toolsBar.MPRVisibility}},{toolName:e["3D"],toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:function(){return q.toolsBar.VRTVisibility}},{toolName:e.fusion,toolTag:"fusion",icon:"icon-dicom-fused",disActive:!0,visibility:function(){return q.toolsBar.MPRFusionVisibility&&-1!==q.imageType}},{toolName:e.AI,toolTag:"AI",icon:"icon-dicom-ai",isToggle:!0,visibility:function(){return q.toolsBar.AIVisibility&&!(0,s.isNull)(q.instanceOptions.AI)}},{toolName:function(){return lt()[q.imageType+1]},toolTag:"imageType",icon:function(){return["icon-dicom-mode3","icon-dicom-mode1","icon-dicom-mode2"][q.imageTypeDefault+1]},disActive:!0,select:!0,visibility:function(){return q.toolsBar.imageModeVisibility}},{toolName:e.reload,toolTag:"reload",icon:"icon-dicom-reload",disActive:!0},{toolName:e.release,toolTag:"disableAllTool",icon:"icon-dicom-release"},{toolName:e.restore,toolTag:"cancelToolAndDefaultViewport",icon:"icon-dicom-restore",disActive:!0},{toolName:e.stackScroll,toolTag:"stackScroll",icon:"icon-dicom-paging",visibility:function(){return q.isMobile}},{toolName:e.modulation,toolTag:"modulation",icon:"icon-dicom-tiaochuang",select:!0},{toolName:e.modulationPreset,toolTag:"modulationMenu",icon:"icon-dicom-tiaochuang2",select:!0},{toolName:e.pan,toolTag:"pan",icon:"icon-dicom-move",visibility:function(){return!q.isMobile}},{toolName:e.seriesLayout,toolTag:"series",icon:"icon-dicom-series",disActive:!0,select:!0},{toolName:e.imagesLayout,toolTag:"image",icon:"icon-dicom-layout",disActive:!0,select:!0},{toolName:e.magnifier,toolTag:"magnify",icon:"icon-dicom-magnifier"},{toolName:e.player,toolTag:"player",icon:"icon-dicom-play",isToggle:!0},{toolName:e.rotate,toolTag:"rotate",icon:"icon-dicom-rotate",select:!0},{toolName:e.invert,toolTag:"invert",disActive:!0,icon:"icon-dicom-negative"},{toolName:e.zoom,toolTag:"zoom",icon:"icon-dicom-scale",select:!0,visibility:function(){return!q.isMobile}},{toolName:e.measure,toolTag:"measureGroup",icon:"icon-dicom-measure"},{toolName:e.length,toolTag:"length",icon:"icon-dicom-line"},{toolName:e.freehandRoi,toolTag:"freehandRoi",icon:"icon-dicom-curve"},{toolName:e.angle,toolTag:"angle",icon:"icon-dicom-angle"},{toolName:e.cobbAngle,toolTag:"cobbAngle",icon:"icon-dicom-cobb"},{toolName:e.rectangleRoi,toolTag:"rectangleRoi",icon:"icon-dicom-rectangle"},{toolName:e.ellipticalRoi,toolTag:"ellipticalRoi",icon:"icon-dicom-round"},{toolName:e.circleRoi,toolTag:"circleRoi",icon:"icon-dicom-round",visibility:!1},{toolName:e.probeCT,toolTag:"probeCT",icon:"icon-dicom-ct"},{toolName:e.annotate,toolTag:"annotateGroup",icon:"icon-dicom-annotate"},{toolName:e.annotateText,toolTag:"annotateText",icon:"icon-dicom-text"},{toolName:e.annotateArrow,toolTag:"annotateArrow",icon:"icon-dicom-one-line-arrow"},{toolName:e.markerL,toolTag:"markerL",icon:"icon-dicom-L"},{toolName:e.markerR,toolTag:"markerR",icon:"icon-dicom-R"},{toolName:e.deleteLabel,toolTag:"eraser",icon:"icon-dicom-rubber"},{toolName:e.cancelLabels,toolTag:"cancelToolState",icon:"icon-dicom-clean",disActive:!0},{toolName:e.enhance,toolTag:"enhanceGroup",icon:"icon-dicom-enhance",visibility:function(){return q.toolsBar.enhanceVisibility},disChildrenCustom:!0,children:[{toolName:e.sharpen,toolTag:"sharpen",icon:"icon-dicom-sharpen"},{toolName:e.blur,toolTag:"blur",icon:"icon-dicom-blur"}]},{toolName:e.colorMap,toolTag:"colorMap",disActive:!0,icon:"icon-dicom-color-map",select:!0},{toolName:e.referenceLine,toolTag:"referenceLine",isToggle:!0,icon:"icon-dicom-referenceLine"},{toolName:e.CTR,toolTag:"CTR",icon:"icon-dicom-CTR"},{toolName:e.more,toolTag:"moreGroup",icon:"icon-dicom-more",isLonelyGroup:!0},{toolName:e.DICOMInfo,toolTag:"DICOMMetaInfo",disActive:!0,icon:"icon-dicom-info"},{toolName:e.aroundInfo,toolTag:"cavanAroundInfo",isToggle:!0,isActive:q.cavanAroundInfo,icon:"icon-dicom-show"},{toolName:e.disSeries,toolTag:"disSeries",icon:"icon-dicom-delete",disActive:!0},{toolName:e.saveImage,toolTag:"saveImage",icon:"icon-dicom-img-save",disActive:!0},{toolName:e.useCacheImage,toolTag:"useCacheImage",icon:"icon-dicom-save",isToggle:!0,isActive:q.DBCacheImages.enable},{toolName:e.imageCacheType,toolTag:"imageCacheType",icon:"icon-dicom-speed",isToggle:!0,isActive:1===q.imageCacheTypeDefault},{toolName:"Language",toolTag:"languageGroup",icon:"icon-dicom-language",isLonelyGroup:!0,disChildrenCustom:!0,disActive:!0,children:Ms([],As(Object.entries(n.g.webDicomViewLocal).map((function(e){var t=As(e,2),n=t[0],o=t[1],r=o.name,a=o.language;return{toolName:r,toolType:a,toolTag:"setLanguage",isActive:O()==a,visibility:"default"!==n}}))),!1),visibility:function(){return q.toolsBar.languageVisibility}},{toolName:e.aboutUs,toolTag:"aboutUs",icon:"icon-dicom-about",disActive:!0,floatRight:!0,visibility:function(){return q.toolsBar.aboutUsVisibility}}],MPR:[{toolName:e["2D"],toolTag:"MPRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:e["3D"],toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:function(){return q.toolsBar.VRTVisibility}},{toolName:e.fusion,toolTag:"MPRFusion",icon:"icon-dicom-fused",select:!0,disActive:!0},{toolName:e.stackScroll,toolTag:"MPRStackScroll",icon:"icon-dicom-paging",visibility:function(){return q.isMobile}},{toolName:e.crosshairs,toolTag:"MPRCrosshairs",icon:"icon-dicom-aim"},{toolName:e.pan,toolTag:"MPRmove",icon:"icon-dicom-move",visibility:!1},{toolName:e.modulation,toolTag:"MPRModulation",icon:"icon-dicom-tiaochuang",visibility:function(){return q.isMobile}},{toolName:e.zoom,toolTag:"MPRZoom",icon:"icon-dicom-scale",visibility:function(){return!q.isMobile}},{toolName:e.reset,toolTag:"MPRReset",icon:"icon-dicom-reload",disActive:!0},{toolName:e.blendModes,toolTag:"blendGroup",icon:"icon-dicom-projection",isLonelyGroup:!0,disChildrenCustom:!0,disActive:!0,children:[{toolName:e.blendMax,toolTag:"MPRMaxIntensity"},{toolName:e.blendMin,toolTag:"MPRMinIntensity"},{toolName:e.blendAverage,toolTag:"MPRAverageIntensity"},{toolName:e.blendComposite,toolTag:"MPRComposite"}]},{toolName:e.thickness,toolTag:"MPRThickness",icon:"icon-dicom-thickness",isLonelyGroup:!0,select:!0},{toolName:e.volume,toolTag:"MPRVolume",icon:"icon-dicom-volume",isToggle:!0},{toolName:e.viewportPresets,toolTag:"MPRViewportPresets",icon:"icon-dicom-color-map",isLonelyGroup:!0,disChildrenCustom:!0,children:Ms([{toolName:e.viewportPresetsDefault,toolType:"default",toolTag:"MPRApplyPreset"}],As(Cs.map((function(e){var n=e.type,o=e.name;return{toolName:t&&o||n,toolType:n,toolTag:"MPRApplyPreset"}}))),!1)},{toolName:e.fusionLayout,toolTag:"MPRFusionLayout",icon:"icon-dicom-layout",isLonelyGroup:!0,disChildrenCustom:!0,disActive:!0,children:[{toolName:e.fusionLayoutDefault,toolType:"ACS9",toolTag:"MPRApplyFusionLayout",isActive:!q.isMobile},{toolName:e.fusionLayoutCoronal,toolType:"coronal",toolTag:"MPRApplyFusionLayout",isActive:q.isMobile},{toolName:e.fusionLayoutSagittal,toolType:"sagittal",toolTag:"MPRApplyFusionLayout"},{toolName:e.fusionLayoutAxial,toolType:"axial",toolTag:"MPRApplyFusionLayout"}]},{toolName:e.quality,toolTag:"MPRLevel",icon:"icon-dicom-picture-quality2",disActive:!0,visibility:function(){return!1===q.instanceOptions.losslessMPR}}],VRT:[{toolName:e["2D"],toolTag:"VTRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:e.MPR,toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:function(){return q.toolsBar.MPRVisibility}},{toolName:e.rotate,toolTag:"VRTRotate",icon:"icon-dicom-rotate3d",visibility:function(){return q.isMobile}},{toolName:e.VRTModulation,toolTag:"VRTModulation",icon:"icon-dicom-tiaochuang",visibility:function(){return q.isMobile}},{toolName:e.knifeIn,toolTag:"VRTKnifeIn",icon:"icon-dicom-shoushudao1"},{toolName:e.knifeOut,toolTag:"VRTKnifeOut",icon:"icon-dicom-shoushudao"},{toolName:e.reset,toolTag:"VRTReset",icon:"icon-dicom-reload",disActive:!0}]}};const Ls=function(){return Ps.get(Ds)};var Os=function(){return Os=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Os.apply(this,arguments)},ks=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n},Rs=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},_s=new s.ComputeStore,Ns=function(){var e=_("tools");return{main:[{toolName:e.MPR},{toolName:e["3D"]},{toolName:e.fusion},{toolName:e.AI},{toolTag:"imageType"},{toolName:e.reload},{toolName:e.release},{toolName:e.restore,divider:!0},{toolName:e.modulation},{toolName:e.pan},{toolName:e.seriesLayout},{toolName:e.imagesLayout},{toolName:e.magnifier},{toolName:e.player},{toolName:e.rotate},{toolName:e.invert},{toolName:e.zoom,divider:!0},{toolName:e.measure,children:[{toolName:e.length},{toolName:e.freehandRoi,toolNameAlias:e.freehandRoi},{toolName:e.angle},{toolName:e.cobbAngle},{toolName:e.rectangleRoi},{toolName:e.ellipticalRoi},{toolName:e.probeCT}]},{toolName:e.annotate,children:[{toolName:e.annotateText},{toolName:e.annotateArrow},{toolName:e.markerL},{toolName:e.markerR}]},{toolName:e.deleteLabel},{toolName:e.cancelLabels,divider:!0},{toolName:e.enhance},{toolName:e.colorMap},{toolName:e.referenceLine},{toolName:e.CTR,divider:!0},{toolName:"Language"},{toolName:e.more,children:[{toolName:e.DICOMInfo},{toolName:e.aroundInfo},{toolName:e.disSeries},{toolName:e.saveImage},{toolName:e.useCacheImage},{toolName:e.imageCacheType}]},{toolName:e.aboutUs}],MPR:[{toolName:e["2D"]},{toolName:e["3D"]},{toolName:e.fusion},{toolName:e.stackScroll},{toolName:e.crosshairs},{toolName:e.pan},{toolName:e.modulation},{toolName:e.zoom},{toolName:e.blendModes},{toolName:e.thickness},{toolName:e.reset,divider:!0},{toolName:e.volume},{toolName:e.viewportPresets,divider:!0},{toolName:e.fusionLayout},{toolName:e.quality}],VRT:[{toolName:e["2D"]},{toolName:e.MPR},{toolName:e.rotate},{toolName:e.VRTModulation},{toolName:e.knifeIn},{toolName:e.knifeOut},{toolName:e.reset}]}},Bs=function(){var e=_("tools");return{main:[{toolName:e.seriesBar},{toolName:e.modulation,select:!1},{toolName:e.modulationPreset},{toolName:e.stackScroll},{toolName:e.MPR},{toolName:e.measure,children:[{toolName:e.length},{toolName:e.freehandRoi,toolNameAlias:e.freehandRoi},{toolName:e.angle},{toolName:e.cobbAngle},{toolName:e.rectangleRoi},{toolName:e.ellipticalRoi,divider:!0},{toolName:e.CTR},{toolName:e.referenceLine,divider:!0},{toolName:e.probeCT},{toolName:e.annotateText},{toolName:e.annotateArrow},{toolName:e.markerL},{toolName:e.markerR,divider:!0},{toolName:e.deleteLabel},{toolName:e.cancelLabels}]},{toolName:e.major,toolTag:"majorGroup",icon:"icon-dicom-box",children:[{toolName:e.reload},{toolName:e.release},{toolName:e.restore,divider:!0},{toolName:e["3D"]},{toolName:e.fusion},{toolName:e.AI,divider:!0},{toolName:e.rotate},{toolName:e.magnifier},{toolName:e.invert},{toolName:e.colorMap},{toolName:e.player,divider:!0},{toolName:e.seriesLayout},{toolName:e.imagesLayout}]},{toolName:e.enhance},{toolName:"Language"},{toolName:e.more,floatRight:!0,children:[{toolTag:"imageType"},{toolName:e.DICOMInfo},{toolName:e.aroundInfo},{toolName:e.disSeries},{toolName:e.saveImage},{toolName:e.useCacheImage},{toolName:e.imageCacheType},{toolName:e.aboutUs}]}],MPR:[{toolName:e["2D"]},{toolName:e["3D"]},{toolName:e.fusion},{toolName:e.stackScroll},{toolName:e.crosshairs},{toolName:e.pan},{toolName:e.modulation},{toolName:e.blendModes},{toolName:e.thickness},{toolName:e.reset,divider:!0},{toolName:e.volume},{toolName:e.viewportPresets},{toolName:e.fusionLayout},{toolName:e.quality}],VRT:[{toolName:e["2D"]},{toolName:e.MPR},{toolName:e.rotate},{toolName:e.VRTModulation},{toolName:e.knifeIn},{toolName:e.knifeOut},{toolName:e.reset}]}},Us=function e(t,n,o,r){var a,i;void 0===r&&(r=!1);var s=Ls()[n],l=[],c=function(t){var a=t.toolName,i=t.toolTag,c=t.children,u=ks(t,["toolName","toolTag","children"]),d=s.find((function(e){return i?e.toolTag===i:e.toolName===a}));if(i||a||console.warn('"toolTag" or "toolName" is require:',t),!d&&c&&(d=Os({},t)),d){if(r&&(c&&console.warn("Multi-layer menu is not recommended, which affects the interactive experience.",c),(d.children||d.select)&&console.warn("Nesting of menus is not recommended, which affects the interactive experience.",d)),c){var f=e((function(){return c}),n,o,!0);f&&(d.children=f)}l.push(Os(Os({},o?o(d):d),u))}};try{for(var u=Rs(t()),d=u.next();!d.done;d=u.next()){c(d.value)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(a)throw a.error}}return l},Vs=function(){return _s.get(q.isMobile?Bs:Ns)},Fs=function(e){var t,o;void 0===e&&(e=Object.keys(n.g.webDicomViewLocal).length>2&&!(!q.instanceOptions.languageDefault&&!(null===(o=null===(t=q.instanceOptions)||void 0===t?void 0:t.toolsBar)||void 0===o?void 0:o.languageVisibility)));var r=_s.get(Bs),a=_s.get(Ns);if(console.info(e?"Return to i18n menu":"Return to zh-CN menu"),!e)return{mobile:r,PC:a};var i=function(e){return function(e){for(var t,n,o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];var a={};(e=Os({},e)).disChildrenCustom&&delete e.children,e.toolTag||console.warn('"toolTag" is require:',e);try{for(var i=Rs(o),s=i.next();!s.done;s=i.next()){var l=s.value,c=e[l];c&&"function"!=typeof c&&(a[l]=e[l])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}(e,"toolName","toolTag","children")};return{mobile:{main:Us((function(){return r.main}),"main",i),MPR:Us((function(){return r.MPR}),"MPR",i),VRT:Us((function(){return r.VRT}),"VRT",i)},PC:{main:Us((function(){return a.main}),"main",i),MPR:Us((function(){return a.MPR}),"MPR",i),VRT:Us((function(){return a.VRT}),"VRT",i)}}};const js=function(){return Us((function(){return q.toolsBar.customMenu.main||Vs().main}),"main")},Hs=function(){return Us((function(){return q.toolsBar.customMenu.MPR||Vs().MPR}),"MPR")},zs=function(){return Us((function(){return q.toolsBar.customMenu.VRT||Vs().VRT}),"VRT")};var qs=function(){return qs=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},qs.apply(this,arguments)},Ws=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Gs=function(e){var t=e.btnTarget,n=e.toolData,o=e.toolDefault,r=e.classNameCopilot;new Xs(r||"moreLayout",e,(function(e){var r,i,l=function(r){var i=r.toolName,l=r.toolNameAlias,c=r.toolType,u=r.toolTag,d=void 0===u?"":u,f=r.icon,h=r.isActive,p=r.visibility,m=r.divider,g=r.select,v=r.children,y=l||("function"==typeof i?i():i),b=qs(qs({},r),{parentData:n}),x=(0,s.createElement)({tagName:"i",className:"iconfont"});f&&x.classList.add("function"==typeof f?f():f);var w=(0,s.createElement)({className:"text",tagName:"span",innerText:y}),T=(0,s.createElement)({className:"select-popup-item tool-event-link ".concat(c||d),title:y,onclick:function(e){(0,a.triggerEvent)(a.events,"tool_event",{events:e,toolData:b,btnTarget:T,btnOriginTarget:t})}});T.dataset.toolData=JSON.stringify(b),T.dataset.toolType=c||d,h&&(T.classList.add("active"),!n.disActive&&t.classList.add("active")),d===(null==o?void 0:o.toolTag)&&(T.classList.add("active"),setTimeout((function(){(0,a.triggerEvent)(a.events,"tool_event",{toolData:b,btnTarget:T,btnOriginTarget:t})}))),(!1===p||"function"==typeof p&&!p())&&T.classList.add("hidden"),m&&T.classList.add("menu-divider"),(v||g)&&T.appendChild((0,s.createElement)({tagName:"i",className:"triangle"})),T.appendChild(x),T.appendChild(w),e.appendChild(T)};try{for(var c=Ws(n.children),u=c.next();!u.done;u=c.next())l(u.value)}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}))};const Ys=Gs;var Zs=function(){function e(e,t,n,o){var r=this;this.className="select-popup-layout";var a=t.btnTarget,i=t.events,l=t.forceRender,c=t.destroy,u=this.layout=a.querySelector(".".concat(this.className,".").concat(e));if(this.layout&&(l||c)){var d=!this.layout.classList.contains("invisible");if(this.layout.remove(),this.layout=void 0,c||d)return}if(!this.layout){u=this.layout=(0,s.createElement)({className:"".concat(this.className," ").concat(e," invisible"),onclick:function(e){var t=e.target,n=t.classList.contains("tool-event-link")?t:t.parentElement,o=JSON.parse(n.dataset.toolData||"{}"),a=o.select,i=o.children,s=o.toolTag;if(e.stopPropagation(),t!==u)if(i){var l=n.classList.toggle("open-mark");new Ys({events:{},toolData:o,btnTarget:n,classNameCopilot:"menu-nest",isMenuNest:!0,destroy:!l})}else if(a){var c=q.webDicomView.layoutView.toolsContainer.querySelector(".".concat(r.className,".").concat(s,":not(.invisible)"));c&&r.setLeft({btnTarget:n,_layout:c,forceShow:!0,isMenuNest:!0})}else r.hideLayout(!0)},ontouchmove:function(e){e.stopPropagation()}});var f=(0,s.createElement)({className:"select-popup-container"});null==n||n(f),u.appendChild(f),a.appendChild(u),a.addEventListener("mouseleave",(function(){return r.mouseleaveHandle()})),a.addEventListener("mouseenter",(function(){return r.mouseenterHandle()}))}null==o||o(u),i&&this.setLeft(t)}return e.prototype.mouseleaveHandle=function(){var e=this;this.timer=setTimeout((function(){e.hideLayout()}),q.isMobile?0:300)},e.prototype.mouseenterHandle=function(){this.timer&&clearTimeout(this.timer)},e.prototype.hideLayout=function(e){this.layout.classList.add("invisible"),q.webDicomView.layoutView.removeOpenMark(),e&&q.webDicomView.layoutView.selectPopupHidden()},e.prototype.setLeft=function(e){var t=e.btnTarget,n=e.isMenuNest,o=e._layout,r=e.forceShow,a=e.direction,i=(null==t?void 0:t.getBoundingClientRect())||{},s=i.left,l=i.bottom,c=i.top,u=i.right,d=o||this.layout,f=q.webDicomView.globalContainer.clientWidth,h=d.clientWidth,p=d.clientHeight;n?(d.style.left="".concat(f-u>s?u+h>f?f-h:u:s-h>0?s-h:0,"px"),d.style.top="".concat(c,"px")):(d.style.left="".concat(s+h>f?f-h:s,"px"),d.style.top="".concat(l,"px")),"top"===a&&(d.style.top="".concat(c-p,"px")),d.classList.toggle("invisible",!r&&!d.classList.contains("invisible"))},e}();const Xs=Zs;var Ks=function(){return Ks=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ks.apply(this,arguments)},Qs=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Js=function(){function e(){var e=lt();this.data=[{title:e[0],icon:"icon-dicom-mode3",type:-1,visibility:function(){var e,t;return null!==(t=null===(e=q.toolsBar)||void 0===e?void 0:e.fastImageModeVisibility)&&void 0!==t?t:q.toolsBar.fasModeVisibility}},{title:e[1],icon:"icon-dicom-mode1",type:0,visibility:function(){return q.toolsBar.staModeVisibility}},{title:e[2],icon:"icon-dicom-mode2",type:1,visibility:function(){return q.toolsBar.majModeVisibility}}]}return e.prototype.createLayout=function(e){var t=this;new Xs("imageType",Ks(Ks({},e.detail),{forceRender:!0}),(function(n){var o,r,i=function(t){var o=t.title,r=t.icon,i=t.type,l=t.visibility;if(!1!==(null==l?void 0:l())){var c=(0,s.createElement)({tagName:"i",className:"iconfont ".concat(r)}),u=(0,s.createElement)({tagName:"span",innerText:o}),d=(0,s.createElement)({className:"select-popup-item ".concat(q.imageType===i?"active":""),title:o,onclick:function(){(0,a.triggerEvent)(a.events,"tool_imageType",Ks(Ks({},t),e.detail))}});d.appendChild(c),d.appendChild(u),n.appendChild(d)}};try{for(var l=Qs(t.data),c=l.next();!c.done;c=l.next()){i(c.value)}}catch(e){o={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}}))},e.prototype.handleLayout=function(e){var t=e.title,n=e.btnTarget,o=e.icon;if(e.custom){var r=this.data.find((function(e){return e.type===q.imageType}));t=r.title,o=r.icon,n=q.webDicomView.layoutView.querySelectorForTool(".imageType"),q.imageType}var a=n.querySelector(".toolbar-text")||n.querySelector(".text"),i=n.querySelector("i.iconfont");n.title=t,a.innerText=t,i.className="iconfont "+o},e}();const $s=Js;var el=function(){return el=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},el.apply(this,arguments)},tl=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},nl=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},ol=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},rl=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},al=function(){function e(){this.t=_("toast.prompt"),this.isZh=O().includes("zh"),this.data=[{title:"肺窗",name:"lungs",WW:1750,WC:-500},{title:"纵隔窗",name:"mediastinum",WW:300,WC:40},{title:"骨窗",name:"bone",WW:1250,WC:300},{title:"头颅",name:"skull",WW:90,WC:35},{title:"软组织窗",name:"flab",WW:400,WC:50,divider:!0},{title:"自定义窗宽/位",name:"custom"}]}return e.prototype.createLayout=function(e){var t=this,n=e.detail,o=n.isPng,r=n.modality;new Xs("modulation",el(el({},e.detail),{forceRender:!0}),(function(e){var n,i,l=function(n){var o=n.title,r=n.name,i=n.divider,l=(0,s.createElement)({className:"select-popup-item",title:o,innerText:t.isZh?o:b(r),onclick:function(){(0,a.triggerEvent)(a.events,"tool_wwwc",n)}});i&&l.classList.add("menu-divider"),e.appendChild(l)};try{for(var c=ol(o||"CT"!==r?[t.data[5]]:t.data),u=c.next();!u.done;u=c.next()){l(u.value)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}}))},e.prototype.handleLayout=function(e,t){return tl(this,void 0,void 0,(function(){var n,o,r,i,s,l,c,u,d,f,h;return nl(this,(function(p){switch(p.label){case 0:return n=this.t,o=n.enterWL,r=n.example,i=n.verificationError,s=t.name,l=t.WW,c=t.WC,u=e.querySelector(".layoutImage.active"),e=u||e,"custom"!==s?[3,2]:[4,lo("".concat(o,"：(").concat(r,"：255&emsp;128）"),/^[-+]?\d+(\.\d*)?[a-zA-Z\s;',/\\；‘，/、]+[-+]?\d+(\.\d*)?$/,i)];case 1:if(!(d=p.sent()))return[2];f=d.split(/[a-zA-Z\s;',/\\；‘，/、]+/),h=rl([parseFloat(f[0]),parseFloat(f[1])],2),l=h[0],c=h[1],p.label=2;case 2:return isNaN(l)||isNaN(c)||(0,a.setViewport)(e,{voi:{windowWidth:l,windowCenter:c}}),[2]}}))}))},e}();const il=al;var sl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ll=function(){function e(){var e=_("rotate"),t=e.restore,n=e.counterclockwise90,o=e.clockwise90,r=e.HFlip,a=e.VFlip;this.data=[{title:t,name:"default",icon:"icon-dicom-restore"},{title:n,name:"anticlockwise",icon:"icon-dicom-rotate90R"},{title:o,name:"clockwise",icon:"icon-dicom-rotate90L"},{title:r,name:"leftRight",icon:"icon-dicom-leftRight"},{title:a,name:"upDown",icon:"icon-dicom-upDown"}]}return e.prototype.createLayout=function(e){var t=this;new Xs("rotate",e.detail,(function(e){var n,o,r=function(t){var n=t.title,o=t.icon,r=(0,s.createElement)({tagName:"i",className:"iconfont "+o}),i=(0,s.createElement)({tagName:"span",innerText:n}),l=(0,s.createElement)({className:"select-popup-item",title:n,onclick:function(){(0,a.triggerEvent)(a.events,"tool_rotate",t)}});l.appendChild(r),l.appendChild(i),e.appendChild(l)};try{for(var i=sl(t.data),l=i.next();!l.done;l=i.next()){r(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}}))},e.prototype.handleLayout=function(e,t){var n=t.name,o=e.querySelector(".layoutImage.active");e=o||e;var r=(0,a.getViewport)(e);switch(n){case"default":r.rotation=0,r.hflip=!1,r.vflip=!1;break;case"anticlockwise":r.rotation-=90;break;case"clockwise":r.rotation+=90;break;case"leftRight":r.hflip=!r.hflip;break;case"upDown":r.vflip=!r.vflip}(0,a.setViewport)(e,r)},e}();const cl=ll;function ul(e,t,n){if(n!==t){var o=(0,a.getViewport)(t),r=(0,a.getViewport)(n);r.rotation===o.rotation&&r.hflip===o.hflip&&r.vflip===o.vflip||(r.rotation=o.rotation,r.hflip=o.hflip,r.vflip=o.vflip,e.setViewport(n,r))}}function dl(e,t,n){if(n!==t){var o=(0,a.getViewport)(t),r=(0,a.getViewport)(n);r.translation.x===o.translation.x&&r.translation.y===o.translation.y||(r.translation.x=o.translation.x,r.translation.y=o.translation.y,e.setViewport(n,r))}}function fl(e,t,n){if(n!==t){var o=(0,a.getViewport)(t),r=(0,a.getViewport)(n);r.voi.windowWidth===o.voi.windowWidth&&r.voi.windowCenter===o.voi.windowCenter||(r.voi.windowWidth=o.voi.windowWidth,r.voi.windowCenter=o.voi.windowCenter,e.setViewport(n,r))}}function hl(e,t,n){if(n!==t){var o=(0,a.getViewport)(t),r=(0,a.getViewport)(n);r.scale!==o.scale&&(r.scale=o.scale,e.setViewport(n,r))}}a.colors.getColormap("myCustomColorMap",{name:"myCustomColorMap",numColors:256,gamma:1,segmentedData:{red:[[0,1,0],[1,1,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}});const pl=[{id:"gray",name:"灰色",icon:n(1008)},{id:"blues",name:"蓝",icon:n(3522)},{id:"bone",name:"骨骼",icon:n(2007)},{id:"cool",name:"Cool",icon:n(6030)},{id:"coolwarm",name:"冷色",icon:n(9141)},{id:"copper",name:"铜",icon:n(642)},{id:"hot",name:"热金属",icon:n(9572)},{id:"hotIron",name:"铬铁",icon:n(8962)},{id:"hotMetalBlue",name:"热金属蓝",icon:n(2723)},{id:"hsv",name:"HSV",icon:n(6178)},{id:"jet",name:"Jet",icon:n(904)},{id:"pet",name:"PET",icon:n(6446)},{id:"pet20Step",name:"PET 20 Step",icon:n(6206)},{id:"spectral",name:"光谱",icon:n(2489)},{id:"spring",name:"春天",icon:n(9662)},{id:"summer",name:"夏天",icon:n(8774)},{id:"autumn",name:"秋天",icon:n(8011)},{id:"winter",name:"冬天",icon:n(7990)}];var ml=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},gl=function(){function e(){this.data=pl}return e.prototype.createLayout=function(e){var t=this;new Xs("colorMap",e.detail,(function(e){var n,o,r=function(t){var n=t.id,o=t.icon,r=t.name,i=(0,s.createElement)({tagName:"div",className:"select-grid-item2",title:O().includes("zh")?n==r?n:"".concat(n,",").concat(r):b(n),onclick:function(){(0,a.triggerEvent)(a.events,"tool_colorMap",t)}}),l=(0,s.createElement)({tagName:"img",width:30,height:30,src:o});i.appendChild(l),e.appendChild(i)};try{for(var i=ml(t.data),l=i.next();!l.done;l=i.next()){r(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}e.setAttribute("style","\n\t\t\t\t\tdisplay: grid;\n\t\t\t\t\tgrid-template-columns: repeat(4, 40px);\n\t\t\t\t\tpadding: 4px;\n\t\t\t \t")}))},e.prototype.handleLayout=function(e,t,n){var o=t.id,r=n.getHandler(),i=e.querySelector(".layoutImage.active");e=i||e,n.setHandler((function(e,t,n){r&&r(e,t,n),function(e,t,n){if(n!==t){var o=(0,a.getViewport)(t),r=(0,a.getViewport)(n);r.colormap!==o.colormap&&(r.colormap=o.colormap,e.setViewport(n,r))}}(e,t,n)})),(0,a.setViewport)(e,{colormap:o})},e}();const vl=gl;var yl=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},bl=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},xl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},wl=q.toolsOptions.zoomTool,Tl=wl.minScale,Il=wl.maxScale,El=function(){function e(){this.t=_("toast.prompt"),this.data=[{title:_("other").custom,name:"custom"}]}return e.prototype.createLayout=function(e){var t=this;new Xs("scale",e.detail,(function(e){var n,o,r=function(t){var n=t.title,o=(0,s.createElement)({className:"select-popup-item",title:n,innerText:n,onclick:function(){(0,a.triggerEvent)(a.events,"tool_scale",t)}});e.appendChild(o)};try{for(var i=xl(t.data),l=i.next();!l.done;l=i.next()){r(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}}))},e.prototype.handleLayout=function(e,t){return yl(this,void 0,void 0,(function(){var n,o,r,i,s,l;return bl(this,(function(c){switch(c.label){case 0:return n=this.t,o=n.enterScale,r=n.example,i=n.verificationError,s=t.name,l=null,"custom"!==s?[3,2]:[4,lo("".concat(o,"：(").concat(r,"：").concat(Tl,"~").concat(Il,"）"),(function(e){return/^\d+(\.\d*)?$/.test(e)&&e>=Tl&&e<=Il}),i)];case 1:l=c.sent(),c.label=2;case 2:return null===l||(0,a.setViewport)(e,{scale:Number(l)}),[2]}}))}))},e}();const Sl=El;function Cl(e,t){return void 0===t&&(t=O()),e&&""!=e?(e=e.replace(/^0+/,""),t.includes("zh")?(e=e.replace("Y","岁").replace("M","月").replace("M","周").replace("D","天")).includes("岁")?e:e+"岁":e):""}function Al(e,t){return void 0===t&&(t=O()),e&&""!=e?(e=e.replace(/\s/g,""),t.includes("zh")?"F"==e?"女":"M"==e?"男":e:e):""}var Ml=function(){function e(){this.DICOMTags=_("DICOMTags")}return e.prototype.createSeriesMarker=function(e){var t=e.querySelector("#ltMarker"),n=e.querySelector("#rtMarker"),o=e.querySelector("#lbMarker"),r=e.querySelector("#rbMarker"),a="\n\t\tposition: absolute;\n\t\tfont-size: 10px;\n\t\ttext-shadow: 1px 1px 1px #000;\n\t\tcursor: default;\n\t\tpointer-events: none;\n\t\t";if(!t){var i=(0,s.createElement)({id:"ltMarker"});i.style.cssText=a+"left: 3px;top: 3px;text-align: left;",e.appendChild(i)}if(!n){var l=(0,s.createElement)({id:"rtMarker"});l.style.cssText=a+"right: ".concat(q.isMobile?6:16,"px;top: 3px;text-align: right;"),e.appendChild(l)}if(!o){var c=(0,s.createElement)({id:"lbMarker"});c.style.cssText=a+"left: 3px;bottom: 3px;text-align: left;",e.appendChild(c)}if(!r){var u=(0,s.createElement)({id:"rbMarker"});u.style.cssText=a+"right: ".concat(q.isMobile?6:16,"px;bottom: 3px;text-align: right;"),e.appendChild(u)}},e.prototype.createParagraph=function(e,t,n,o,r){this.createSeriesMarker(e);var a=e.querySelector("#"+t),i=this.DICOMTags,l=i.name,c=i.modality,u=i.age,d=i.sex,f=i.date,h=i.imageNumber,p=i.KVP,m=i.thickness,g=i.scale,v=i.windowCenter,y=i.windowWidth;if(a)switch(a.innerHTML="",t){case"ltMarker":var b=(0,s.createElement)({tagName:"p",innerText:"".concat(l,"：").concat((null==r?void 0:r.name)||n.name)}),x=(0,s.createElement)({tagName:"p",innerText:"ID："+((null==r?void 0:r.patientid)||n.patid)}),w=(0,s.createElement)({tagName:"p",innerText:"".concat(c,"：").concat(n.mod)}),T=(0,s.createElement)({tagName:"p",innerText:"".concat(d,"：").concat(Al((null==r?void 0:r.sex)||n.sex))}),I=(0,s.createElement)({tagName:"p",innerText:"".concat(u,"：").concat(Cl((null==r?void 0:r.age)||n.age))});a.appendChild(b),a.appendChild(x),a.appendChild(w),a.appendChild(T),a.appendChild(I);break;case"rtMarker":var E=(0,s.createElement)({tagName:"p",innerText:"".concat(f,"：").concat(n.acqdt||(null==r?void 0:r.studydate))}),S=(0,s.createElement)({tagName:"p",id:"filmMarker",innerText:"".concat(h,"：").concat(n.stuid?((null==r?void 0:r.studyid)||n.stuid)+"-":"").concat(n.serid,"-").concat(n.imgnum)});S.id="filmMarker",a.appendChild(E),a.appendChild(S);break;case"lbMarker":var C=(0,s.createElement)({tagName:"p",innerText:"".concat(p,"：").concat(n.kv)}),A=(0,s.createElement)({tagName:"p",innerText:"".concat(m,"：").concat(n.sliceth)});a.appendChild(C),a.appendChild(A);break;case"rbMarker":var M=(0,s.createElement)({tagName:"p",id:"scaleMarker",innerText:"".concat(g,"：").concat(Number(o.scale).toFixed(2))}),P=(0,s.createElement)({tagName:"p",id:"wwWMarker",innerText:"".concat(v,"：").concat(o.voi.windowWidth)}),D=(0,s.createElement)({tagName:"p",id:"wwHMarker",innerText:"".concat(y,"：").concat(o.voi.windowCenter)}),L=(0,s.createElement)({tagName:"p",innerText:(null==r?void 0:r.orgname)||n.inst});a.appendChild(M),a.appendChild(P),a.appendChild(D),a.appendChild(L)}},e}();const Pl=Ml;function Dl(e){"Error: element not enabled"!==(null==e?void 0:e.toString())&&console.error(e)}var Ll=function(){return Ll=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ll.apply(this,arguments)},Ol=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},kl=function(){function e(){}return e.prototype.createTopTools=function(e,t,n,o,r){var i,l;void 0===o&&(o="toolsChild"),void 0===r&&(r=!1);var c=e.querySelectorAll(".toolsChild"),u=e.querySelector(".toolsChild.".concat(o));if(c.forEach((function(e){e.classList.remove("active")})),r&&(null==u||u.remove(),u=void 0),u)u.classList.add("active");else{var d=(0,s.createElement)({className:"toolsChild active ".concat(o)}),f=function(e){var t=e.toolName,o=e.toolNameAlias,r=e.toolType,i=e.toolTag,l=void 0===i?"":i,c=e.icon,u=e.iconText,f=e.iconImg,h=e.isActive,p=e.children,m=e.divider,g=e.floatRight,v=e.select,y=e.visibility,b=o||("function"==typeof t?t():t),x=(0,s.createElement)({tagName:"span",className:"tool-btn-style tool-event-link ".concat(r||l),title:b||u,onclick:function(t){var n={events:t,toolData:e,btnTarget:x};"Array"===(0,s.dataType)(p)&&new Ys(n),l&&(0,a.triggerEvent)(a.events,"tool_event",n)}}),w=(0,s.createElement)({tagName:"i",className:"iconfont"}),T=(0,s.createElement)({tagName:"span",className:"toolbar-text",innerText:b});x.dataset.toolData=JSON.stringify(e),x.dataset.toolType=r||l,f?w=(0,s.createElement)({tagName:"img",src:f,className:"iconfont-img"}):c?w.classList.add("function"==typeof c?c():c):(w.innerHTML=u,w.setAttribute("style","\n\t\t\t\t\tfont-size: 24px;\n\t\t\t\t\tpadding:0 2px\n\t\t\t\t\t"),b||(w.style.lineHeight="48px",T.style.display="none")),(!1===y||"function"==typeof y&&!y())&&x.classList.add("hidden"),l===(null==n?void 0:n.toolTag)&&(x.classList.add("active"),setTimeout((function(){(0,a.triggerEvent)(a.events,"tool_event",{toolData:e,btnTarget:x})}))),h&&x.classList.add("active"),"Array"===(0,s.dataType)(p)&&(new Ys({toolData:e,btnTarget:x,toolDefault:n}),w.appendChild((0,s.createElement)({tagName:"i",className:"triangle"}))),v&&w.appendChild((0,s.createElement)({tagName:"i",className:"triangle"})),x.appendChild(w),x.appendChild(T),g&&d.appendChild((0,s.createElement)({className:"flex-1"})),d.appendChild(x),m&&d.appendChild((0,s.createElement)({tagName:"span",className:"divider ".concat(r||l)}))};try{for(var h=Ol(t),p=h.next();!p.done;p=h.next()){f(p.value)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(l=h.return)&&l.call(h)}finally{if(i)throw i.error}}e.appendChild(d)}},e.prototype.clearTools=function(){var e,t;try{for(var n=Ol(Wt.store.state.tools),o=n.next();!o.done;o=n.next()){var r=o.value,a=r.name,i=r.mode,s=r._options.mouseButtonMask,l=void 0===s?[]:s;if("active"===i){var c=l.findIndex((function(e){return 1===e}));-1!==c&&(1===l.length?(0,Wt.setToolPassive)(a):l.splice(c,1))}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.disableAllTool=function(e){this.clearTools(),e.setHandler((function(){})),(0,Wt.setToolActive)("Pointer",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.rectangleRoiTools=function(){(0,Wt.setToolActive)("RectangleRoi",{mouseButtonMask:1})},e.prototype.ellipticalRoiTools=function(){(0,Wt.setToolActive)("EllipticalRoi",{mouseButtonMask:1})},e.prototype.circleRoiTools=function(){(0,Wt.setToolActive)("CircleRoi",{mouseButtonMask:1})},e.prototype.lengthTools=function(){(0,Wt.setToolActive)("Length",{mouseButtonMask:1})},e.prototype.eraserTools=function(){(0,Wt.setToolActive)("Eraser",{mouseButtonMask:1})},e.prototype.angleTools=function(){(0,Wt.setToolActive)("Angle",{mouseButtonMask:1})},e.prototype.cobbAngleTools=function(){(0,Wt.setToolActive)("CobbAngle",{mouseButtonMask:1})},e.prototype.rotateTool=function(e){e.setHandler(ul),(0,Wt.setToolActive)("Rotate",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.zoomTool=function(e){e.setHandler(hl),(0,Wt.setToolActive)("Zoom",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.magnifyTool=function(){(0,Wt.setToolActive)("Magnify",{mouseButtonMask:1})},e.prototype.modulationTool=function(e){e.setHandler(fl),(0,Wt.setToolActive)("Wwwc",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.stackScrollTool=function(e){e.setHandler(Wt.stackImageIndexSynchronizer),(0,Wt.setToolActive)("StackScroll",{mouseButtonMask:1})},e.prototype.sharpenTool=function(){(0,Wt.setToolActive)("Sharpen",{mouseButtonMask:1})},e.prototype.blurTool=function(){(0,Wt.setToolActive)("Blur",{mouseButtonMask:1})},e.prototype.panTool=function(e){e.setHandler(dl),(0,Wt.setToolActive)("Pan",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.freehandRoiTool=function(){(0,Wt.setToolActive)("FreehandRoi",{mouseButtonMask:1})},e.prototype.probeCTTool=function(){(0,Wt.setToolActive)("ProbeCT",{mouseButtonMask:1})},e.prototype.arrowAnnotateTool=function(){(0,Wt.setToolActive)("ArrowAnnotate",{mouseButtonMask:1})},e.prototype.annotateTool=function(){(0,Wt.setToolActive)("Annotate",{mouseButtonMask:1})},e.prototype.LRMarkerTool=function(e){"L"===e?(0,Wt.setToolActive)("AnnL",{mouseButtonMask:1}):(0,Wt.setToolActive)("AnnR",{mouseButtonMask:1})},e.prototype.heartratioTool=function(){(0,Wt.setToolActive)("Heartratio",{mouseButtonMask:1})},e.prototype.AITool=function(e){void 0===e&&(e=!1),e?(0,Wt.setToolPassive)("AI"):(0,Wt.setToolDisabled)("AI")},e.prototype.cancelTool=function(e,t){void 0===t&&(t=!0),Wt.globalImageIdSpecificToolStateManager.clear(e),t&&(0,a.updateImage)(e)},e.prototype.cancelToolAndDefaultViewportTools=function(e){var t,n;e&&0!==e.length||(e=(0,a.getEnabledElements)().map((function(e){return e.element})),Wt.globalImageIdSpecificToolStateManager.restoreToolState({}));try{for(var o=Ol(e),r=o.next();!r.done;r=o.next()){var i=r.value;try{if(!i)continue;var s=(0,a.getImage)(i),l=(0,a.getDefaultViewportForImage)(i,s);((0,a.getViewport)(i)||{}).colormap&&Es(i),this.cancelTool(i,!1),(0,a.setViewport)(i,Ll(Ll({},l),{sharpen:0,blur:0}))}catch(e){Dl(e)}}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e}();const Rl=kl;var _l=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Nl=(0,Wt.importInternal)("util/scrollToIndex"),Bl=function(){function e(){this.layoutclassName="series-slider-layout",this.EVENTSHandle=new Map}return e.prototype.changMarker=function(e,t){var n=e.querySelector("#filmMarker");n&&(n.innerText=x(n.innerText,String(t+1)))},e.prototype.createLayout=function(e,t,n){var o,r=this,i=e.querySelector(".".concat(this.layoutclassName)),l=function(){var t=e.dataset,n=t.imgRow,o=t.imgColumn;return Number(null!=n?n:1)*Number(null!=o?o:1)}(),c=Math.ceil((null===(o=null==t?void 0:t.imgs)||void 0===o?void 0:o.length)/l),u={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||i.clientHeight,this._scrollLen},set scrollLen(e){this._stepLen=0,this._scrollLen=e},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(c-1)/c,this._stepLen}},d=function(t){e.dataset.currentImageIdIndex=String(u.currentIndex),(0,a.triggerEvent)(a.events,"series_scroll",{element:e,imageIds:t,currentIndex:u.currentIndex,isSeriesImage:1!==l})};if(!i){var f=function(){var t,o=_l((null===(t=(0,Wt.getToolState)(e,"stack"))||void 0===t?void 0:t.data)||[{}],1)[0],a=o.currentImageIdIndex,s=void 0===a?n||0:a,f=o.imageIds,h=u.scrollLen;if(i.scrollTop=h*s,s&&s%100==0&&te("scroll",!1,400),1===l)r.changMarker(e,s),u.currentIndex=s;else{var p=s;if(p>=c&&(p=c,Nl(e,q.webDicomView.layoutView.iconPlayer.playerStatus?0:p-1)),u.currentIndex===p)return;u.currentIndex=p}d(f)};i=(0,s.createElement)({className:this.layoutclassName});var h=(0,s.createElement)();h.style.height="calc(100% * ".concat(c,")"),i.appendChild(h),e.appendChild(i),n&&(Nl(e,n),i.scrollTop=u.scrollLen*n,n=void 0),this.EVENTSHandle.set(e,f),e.addEventListener(a.EVENTS.NEW_IMAGE,f),i.addEventListener("scroll",(function(t){var n;if(u.scrollLen===i.clientHeight){var o=t.target,r=u.stepLen,s=u.currentIndex,f=Math.floor(o.scrollTop/r);if(!(f>=c||s==f)&&(Nl(e,f),u.currentIndex=f,(0,a.triggerEvent)(a.events,"canvas_active",{$canvas:e,type:"wheel"}),1!==l)){var h=_l((null===(n=(0,Wt.getToolState)(e,"stack"))||void 0===n?void 0:n.data)||[{}],1)[0].imageIds;d(h)}}else u.scrollLen=i.clientHeight}))}},e.prototype.removeLayout=function(e){var t=this.EVENTSHandle.get(e),n=e.querySelector(".".concat(this.layoutclassName));e.removeEventListener(a.EVENTS.NEW_IMAGE,t),this.EVENTSHandle.delete(e),null==n||n.remove()},e}();const Ul=Bl;var Vl=function(){function e(){this.className="study-slider-layout"}return e.prototype.createLayout=function(e,t,n,o){void 0===o&&(o=!1);var r,i,l=e.querySelector(".".concat(this.className)),c=(r=n.x,i=n.y,Number(null!=r?r:1)*Number(null!=i?i:1)),u=Math.ceil(t.length/c),d=this.scrollData={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||l.clientHeight,this._scrollLen},set scrollLen(e){this._stepLen=0,this._scrollLen=e},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(u-1)/u,this._stepLen}};if(o&&(this.container.remove(),this.container=l=void 0),!l){this.container=l=(0,s.createElement)({className:this.className});var f=(0,s.createElement)();q.webDicomView.layoutView.canvasContainer.style.paddingRight=u<=1||q.isMobile?"0px":"12px",l.style.display=u>1?"block":"none",f.style.height="calc(100% * ".concat(u,")"),l.appendChild(f),e.appendChild(l),l.addEventListener("scroll",(function(e){if(d.scrollLen===l.clientHeight){var t=e.target,n=d.stepLen,o=d.currentIndex,r=Math.floor(t.scrollTop/n);r>=u||o==r||(mt("triggerEvent_study_scroll",(0,s.debounce)((function(e){(0,a.triggerEvent)(a.events,"study_scroll",e)}),300),{currentIndex:r,layoutCount:c}),d.currentIndex=r)}else d.scrollLen=l.clientHeight}))}},e.prototype.visibility=function(e){this.container.style.visibility=e?"visible":"hidden"},e.prototype.setIndex=function(e){this.container.scrollTop=this.scrollData.stepLen*e+1},e}();const Fl=Vl;var jl=function(){function e(e,t){this.iconPlayer=e,this.container=t}return e.prototype.createLayout=function(e,t){var n=0===t;n&&this.createOrEditInfoBar(e,n),1===t&&this.createMenuBtn(),this.addItemMenu(e,n)},e.prototype.createOrEditInfoBar=function(e,t){var n=e.modality,o=e.name,r=e.sex,a=e.age,i=e.studydate,l="<span class='name' title='".concat(o,"'>").concat(o,"</span> / ").concat(Al(r),"  / ").concat(Cl(a),"  / ").concat(i," ");if(t){this.infoBarContainer=(0,s.createElement)({className:"info-bar"});var c=(0,s.createElement)({className:"modality",innerText:"".concat(n)}),u=(0,s.createElement)({className:"details",innerHTML:l});this.infoBarContainer.appendChild(c),this.infoBarContainer.appendChild(u),this.container.appendChild(this.infoBarContainer)}else this.infoBarContainer.querySelector(".details").innerHTML=l,this.infoBarContainer.querySelector(".modality").innerText=n},e.prototype.createMenuBtn=function(){var e=this;if(this.infoBarContainer){var t=(0,s.createElement)({className:"menu-btn",innerText:_("other.toggleStudy"),onclick:function(){e.iconPlayer.playerPause(),e.toggleMenuVisibility()}});this.infoBarContainer.appendChild(t)}},e.prototype.activeFirst=function(){var e,t=null===(e=this.menuContainer)||void 0===e?void 0:e.querySelector(".menu-item");null==t||t.click()},e.prototype.addItemMenu=function(e,t){var n=this,o=e.modality,r=e.name,a=e.sex,i=e.age,l=e.studydate,c=e.studyid;t&&(this.menuContainer=(0,s.createElement)({className:"menu hidden"}),this.container.appendChild(this.menuContainer));var u=(0,s.createElement)({className:"menu-item ".concat(t&&"active"),onclick:function(){var t=n.container.parentElement.querySelectorAll(".study-navigation-body .studyNavigationContainer"),o=n.menuContainer.querySelectorAll(".menu-item");n.toggleElsClassName(t,c,"hidden","remove"),n.toggleElsClassName(o,c,"active","add"),n.createOrEditInfoBar(e,!1),n.toggleMenuVisibility(!1)}});u.dataset.studyId=c;var d=(0,s.createElement)({className:"modality",innerText:"".concat(o)}),f=(0,s.createElement)({className:"info",innerHTML:"<span class='name' title='".concat(r,"'>").concat(r,"</span> / ").concat(Al(a),"  / ").concat(Cl(i)," ")}),h=(0,s.createElement)({className:"study-date",innerText:"".concat(l)}),p=(0,s.createElement)({className:"icon",innerHTML:'<i class="icon-dicom-arrow"</i>'});u.appendChild(d),u.appendChild(f),u.appendChild(h),u.appendChild(p),this.menuContainer.appendChild(u)},e.prototype.toggleElsClassName=function(e,t,n,o){e.forEach((function(e){var r=t===e.getAttribute("data-study-id");e.classList.toggle(n,"add"===o?r:!r)}))},e.prototype.toggleMenuVisibility=function(e){var t=this.menuContainer;if(t){var n=void 0!==e?e:t.classList.contains("hidden");t.classList.toggle("hidden",!n)}},e}();const Hl=jl;var zl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ql=function(e,t){var n=this;this.data=[{title:"10FPS/S",val:10},{title:"20FPS/S",val:20},{title:"30FPS/S",val:30},{title:"40FPS/S",val:40},{title:"50FPS/S",val:50}];var o=e.target;new Xs("fps",{btnTarget:o,events:e,direction:"top"},(function(e){var o,r,a=function(n,o){var r=(0,s.createElement)({className:"select-popup-item",title:n,innerText:n,onclick:function(){t(o)}});e.appendChild(r)};try{for(var i=zl(n.data),l=i.next();!l.done;l=i.next()){var c=l.value;a(c.title,c.val)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}}))};const Wl=ql;var Gl=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},Yl=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Zl=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Xl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Kl=(0,Wt.importInternal)("util/scrollToIndex"),Ql=function(e){var t,n=Zl((null===(t=(0,Wt.getToolState)(e,"stack"))||void 0===t?void 0:t.data)||[{}],1)[0],o=n.currentImageIdIndex,r=void 0===o?0:o,a=n.imageIds;return{imageIds:a,currentImageIdIndex:Number(r),seriesImagesLen:a.length}},Jl=function(){function e(){this.eventNamespace="player",this.enableColor="white",this.disableColor="gray",this.framesPerSecond=10,this.toggleControlStyleLazy=(0,s.throttle)(this.toggleControlStyle,1e3);var e=this.t=_("player");this.EVENTSHandle=new Map,this.playerStatus=!0,this.elementPlayClip,this.playData=[{id:"player1001",title:e.first,flag:"control",icon:"icon-dicom-first",cssText:"display: none;"},{id:"player1002",title:e.prev,flag:"control",icon:"icon-dicom-previous"},{id:"player1003",title:e.play,flag:"control",cssText:"color: ".concat(this.enableColor,";"),icon:"icon-dicom-play"},{id:"player1004",title:e.next,flag:"control",icon:"icon-dicom-next"},{id:"player1005",title:e.last,flag:"control",icon:"icon-dicom-last",cssText:"display: none;"}],this.iconControls=[]}return e.prototype.createPlayer=function(e,t,n,o){var r=this;void 0===o&&(o=10);var i=t.querySelector("div.player-bar");if(i)return this.playerStatus=!1,void t.removeChild(i);this.playerStatus=!(n.loadIds.length>1),this.elementPlayClip=e,this.framesPerSecond=Math.round(o);var l=Ql(e),c=l.seriesImagesLen,u=l.currentImageIdIndex,d=(0,s.createElement)({className:"player-bar",ondblclick:function(e){e.stopPropagation()},onmousedown:function(e){e.stopPropagation()}}),f=(0,s.createElement)({className:"slider-group"}),h=(0,s.createElement)({tagName:"input",className:"slider",type:"range",min:0,max:c-1,step:1,value:u,oninput:function(t){var n=Number(t.target.value);Kl(e,n)},onmousedown:function(){r.playerPause(e)},ontouchstart:function(){r.playerPause(e)}}),p=(0,s.createElement)({className:"slider-info",innerText:"".concat(u+1,"/").concat(c)});f.appendChild(h),f.appendChild(p),d.appendChild(f);for(var m=(0,s.createElement)({className:"body-group"}),g=(0,s.createElement)({className:"fps-option",innerHTML:"".concat(this.framesPerSecond,"FPS/S"),onclick:function(e){setTimeout((function(){new Wl(e,(function(e){r.framesPerSecond=e,g.innerHTML="".concat(r.framesPerSecond,"FPS/S"),b.value=String(r.framesPerSecond),r.playerStatus&&r.playerStart()}))}),100)}}),y=(0,s.createElement)({className:"fps-custom"}),b=(0,s.createElement)({className:"custom-input hidden",tagName:"input",type:"tel",maxLength:100,value:this.framesPerSecond,onkeyup:function(e){var t,n=e.target;if("Backspace"!==e.key){var o=null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.replace(/[^\d]/g,"");if(n.value=String(v(""===o?r.framesPerSecond:Number(o),1,50)),"Enter"===e.key){if(c<=1)return;r.playerStart(),b.classList.add("hidden")}}},onblur:function(e){var t=e.target,n=null==t?void 0:t.value;r.framesPerSecond=Number(n)||r.framesPerSecond||10,t.value=String(r.framesPerSecond),x.classList.remove("hidden"),b.classList.add("hidden"),g.innerHTML="".concat(r.framesPerSecond,"FPS/S"),r.playerStatus&&r.playerStart()}}),x=(0,s.createElement)({tagName:"span",innerText:this.t.custom,onclick:function(){x.classList.add("hidden"),b.classList.remove("hidden"),b.value="",b.focus()}}),w=(0,s.createElement)({className:"fps-play"}),T=function(t){var o=I.playData[t],i=o.flag,l=o.title,c=o.cssText,u=o.icon,d=o.id;if("control"===i){var f=(0,s.createElement)({tagName:"i",className:"control ".concat(u," ").concat(d),title:l});f.style.cssText=c,f.addEventListener(q.isMobile?"touchstart":"click",(function(o){var i={event:o,series:n,playerData:r.playData[t],playerDom:e};(0,a.triggerEvent)(a.events,"iconplayer_series",i)})),I.iconControls.push(f),w.appendChild(f)}},I=this,E=0;E<this.playData.length;E++)T(E);y.appendChild(b),y.appendChild(x),m.appendChild(g),m.appendChild(y),m.appendChild(w),d.appendChild(m),t.appendChild(d),this.toggleControlStyle(u,c);var S=function(){var t=Ql(e),n=t.seriesImagesLen,o=t.currentImageIdIndex;p.innerText="".concat(o+1,"/").concat(n),h.value=String(o)};a.events.addEventNamespaceListener("canvas_active.".concat(this.eventNamespace),(function(e){return Gl(r,void 0,void 0,(function(){var t,n;return Yl(this,(function(o){switch(o.label){case 0:return t=e.detail.$canvas,n=q.webDicomView.queryCurrentSeries(),t===this.elementPlayClip?[2,this.playerPause()]:[4,this.playerRemove()];case 1:return o.sent(),this.createPlayer(t,t.parentElement,n),[2]}}))}))})),this.EVENTSHandle.set(e,S),e.addEventListener(a.EVENTS.NEW_IMAGE,S),this.togglePalyerTool(!0)},e.prototype.playerToggle=function(e,t){if(t&&(this.elementPlayClip=t),this.elementPlayClip){var n=this.elementPlayClip.parentElement.querySelector(".player1003");this.playerToggleHandle(n,e)}},e.prototype.playerStart=function(e){this.playerToggle(!0,e)},e.prototype.playerPause=function(e){this.playerToggle(!1,e)},e.prototype.playerAllPauseAndRemove=function(){var e,t;this.playerRemove();try{for(var n=Xl((0,a.getEnabledElements)()),o=n.next();!o.done;o=n.next()){var r=o.value.element;(0,Wt.stopClip)(r)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.playerRemove=function(e,t){return void 0===t&&(t=!0),Gl(this,void 0,void 0,(function(){var n,o,r;return Yl(this,(function(i){switch(i.label){case 0:if(!(n=e||this.elementPlayClip))return[2];i.label=1;case 1:return i.trys.push([1,2,3,6]),(o=n.parentElement.querySelector("div.player-bar"))&&((0,Wt.stopClip)(n),o.remove(),t&&$("playerRemove"),this.togglePalyerTool(!1)),this.playerStatus=!1,this.iconControls=[],this.elementPlayClip=void 0,[3,6];case 2:return Dl(i.sent()),[3,6];case 3:return r=this.EVENTSHandle.get(n),[4,a.events.removeEventNamespaceListener("canvas_active.".concat(this.eventNamespace))];case 4:return i.sent(),[4,n.removeEventListener(a.EVENTS.NEW_IMAGE,r)];case 5:return i.sent(),this.EVENTSHandle.delete(n),[7];case 6:return[2]}}))}))},e.prototype.playerBarClickHandle=function(e){var t=e.playerData,n=e.playerDom;if(e.event.target.style.color!==this.disableColor){var o=e.event.target,r=Ql(n),a=r.seriesImagesLen,i=r.currentImageIdIndex,s=i;switch(t.id){case"player1001":0!==i&&(s=0);break;case"player1002":i>=1&&(s-=1);break;case"player1003":this.playerToggleHandle(o,!this.playerStatus);break;case"player1004":i<a-1&&(s+=1);break;case"player1005":i!==a-1&&(s=a-1)}Kl(n,s)}},e.prototype.playerToggleHandle=function(e,t){void 0===t&&(t=!1);var n=Ql(this.elementPlayClip),o=n.currentImageIdIndex,r=n.seriesImagesLen;$(t?"playerResume":"playerPause"),(0,Wt.stopClip)(this.elementPlayClip),this.playerStatus=t,this.toggleControlStyle(o,r),t?(e.title=this.t.pause,e.classList.remove("icon-dicom-play"),e.classList.add("icon-dicom-pause"),(0,Wt.playClip)(this.elementPlayClip,this.framesPerSecond)):(e.title=this.t.play,e.classList.remove("icon-dicom-pause"),e.classList.add("icon-dicom-play"))},e.prototype.togglePalyerTool=function(e){var t=q.webDicomView.layoutView;setTimeout((function(){return t.toggleClassName(t.querySelectorForTool(".player"),void 0,"active",e)}))},e.prototype.toggleControlStyle=function(e,t){if(this.iconControls.length){if(t<=1)return this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[2].style.color=this.disableColor,this.iconControls[3].style.color=this.disableColor,void(this.iconControls[4].style.color=this.disableColor);this.playerStatus&&(this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[3].style.color=this.disableColor,this.iconControls[4].style.color=this.disableColor),0===e&&t>0&&!this.playerStatus&&(this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[3].style.color=this.enableColor,this.iconControls[4].style.color=this.enableColor),e!==t-1||this.playerStatus||(this.iconControls[0].style.color=this.enableColor,this.iconControls[1].style.color=this.enableColor,this.iconControls[3].style.color=this.disableColor,this.iconControls[4].style.color=this.disableColor),e>0&&e<t-1&&!this.playerStatus&&(this.iconControls[0].style.color=this.enableColor,this.iconControls[1].style.color=this.enableColor,this.iconControls[3].style.color=this.enableColor,this.iconControls[4].style.color=this.enableColor)}},e}();const $l=Jl;var ec=function(){return ec=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ec.apply(this,arguments)},tc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},nc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},oc=function(){function e(e,t,n){this.seriesSlider=e,this.studySlider=t,this.iconSynchronizer=n,this.seriesLayouts=[]}return e.prototype.initSingle=function(e,t,n,o){var r,a;n=ec({imgRow:"1",imgColumn:"1"},n);var i=o||{},l=i.synchronizerStatus,c=i.scrollIndex;try{for(var u=tc(Object.entries(n||{})),d=u.next();!d.done;d=u.next()){var f=nc(d.value,2),h=f[0],p=f[1];!(0,s.isNull)(p)&&(e.dataset[h]=p)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}(0,s.isNull)(t)||(this.seriesSlider.createLayout(e,t,c),this.iconSynchronizer.createIconSynchronizer(e,l))},e.prototype.createCanvasSeries=function(e,t,n,o){var r;void 0===o&&(o=!0);var i=[],l=n.y,c=n.x,u=l*c;null===(r=e.querySelector(".container"))||void 0===r||r.remove();var d=(0,s.createElement)({className:"container"});d.setAttribute("style","\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(".concat(c,", calc(100% / ").concat(c,"));\n\t\t\t\tgrid-template-rows: repeat(").concat(l,", calc(100% / ").concat(l,"));\n\t\t\t\t"));for(var f=0;f<u;f++){var h=t[f],p=h||{},m=p.uuid,g=p.studyUID,v=p.arrImage,y=p.flatSeries,b=(0,s.createElement)({className:"layoutCellsOuter"+(1===u?" singleBoxMode":"")}),x=(0,s.createElement)({className:"layoutCellsInner"}),w=(null==v?void 0:v.length)||0;m&&(x.dataset.seriesId=m,x.dataset.studyUID=g,x.dataset.seriesIndex=String(f),x.dataset.seriesRow=String(l),x.dataset.seriesColumn=String(c),y&&(x.dataset.flatSeries=String(y))),this.initSeriesLayout(x,h),o&&w&&(this.seriesSlider.createLayout(x,h),this.iconSynchronizer.createIconSynchronizer(x)),i.push(x),b.appendChild(x),d.appendChild(b)}this.studySlider.createLayout(e,t,n),e.appendChild(d),(0,a.triggerEvent)(a.events,"first_active",{$canvas:i[0]})},e.prototype.createImagesLayout=function(e,t,n){var o=this,r=n.y,a=n.x,i=r*a;e.dataset.imgRow=String(r),e.dataset.imgColumn=String(a),this.seriesSlider.createLayout(e,t);var l=(0,s.createElement)({className:"layoutImageLayout"});l.setAttribute("style","\n\t\t\t\theight:100%;\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(".concat(a,", calc(100% / ").concat(a,"));\n\t\t\t\tgrid-template-rows: repeat(").concat(r,", calc(100% / ").concat(r,"));\n\t\t\t\t"));for(var c=function(t){var n=(0,s.createElement)({className:0===t?"layoutImage active":"layoutImage"});new(Ht())(n).on("tap press panstart",(function(n){o.toggleStyle(e,t,"layoutImage"),n.preventDefault()})),l.appendChild(n)},u=0;u<i;u++)c(u);e.appendChild(l)},e.prototype.dblclickCanvasLayout=function(e,t,n){if(!e.classList.contains("singleBoxMode")){var o=t.querySelectorAll(".layoutImage"),r=null!=n?n:e.classList.contains("signBigLayout"),i=q.webDicomView.querySeries(t.dataset.seriesId);e.classList.toggle("signBigLayout",!r),this.studySlider.visibility(r),this.seriesSlider.removeLayout(t),i&&(o.length?o.forEach((function(e){(0,a.resize)(e)})):(0,a.resize)(t),this.seriesSlider.createLayout(t,i,Number(t.dataset.currentImageIdIndex)))}},e.prototype.initSeriesLayout=function(e,t){var n=this,o=function(e,t){(0,a.triggerEvent)(a.events,"canvas_active",{$canvas:e,type:t})};e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(function(t){t.preventDefault(),o(e,"drop")})),e.addEventListener("wheel",(function(){o(e,"wheel")})),e.addEventListener("click",(function(){o(e,"click")})),e.addEventListener("touchstart",(function(t){var n=t.type;o(e,"touchstart"),(0,a.triggerEvent)(a.events,"layout_area_focus",{area:"seriesLayout",type:n})})),new(Ht())(e).on("doubletap",(function(){n.dblclickCanvasLayout(e.parentElement,e)})),e.addEventListener(a.EVENTS.IMAGE_RENDERED,(function(e){(0,a.triggerEvent)(a.events,"images_viewport",e.detail)})),this.seriesLayouts.push({seriesId:null==t?void 0:t.uuid,seriesDom:e})},e.prototype.seriesLayoutsUpdate=function(e,t){this.seriesLayouts.forEach((function(n){e===n.seriesDom&&(n.seriesId=t)}))},e.prototype.toggleSeriesStyle=function(e){var t=this,n=e.target,o=e.seriesId,r=e.seriesIndex;q.webDicomView.layoutView.canvasContainer.querySelectorAll(".layoutCellsOuter").forEach((function(e){var a=e.querySelector(".layoutCellsInner"),i=a.dataset,s=i.seriesId,l=i.seriesIndex;if(null!=n&&a===n||null!=o&&s===o||null!=r&&Number(l)===r){if(e.classList.add("active"),a.classList.add("active"),a.classList.contains("noActiveBorder")){var c=a.querySelector(".layoutImage");c?a.querySelector(".layoutImage.active")||c.click():a.classList.remove("noActiveBorder")}}else e.classList.remove("active"),a.classList.remove("active"),t.toggleStyle(e,-1,"layoutImage")}))},e.prototype.toggleStyle=function(e,t,n){for(var o=e.getElementsByClassName(n),r=o.length,a=0;a<r;a++)a===t?o[a].classList.add("active"):o[a].classList.remove("active")},e.prototype.toggleNavigatorInfo=function(e){q.webDicomView.layoutView.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper").forEach((function(t){if(t.dataset.seriesId==e){t.classList.add("active"),t.classList.add("showProgress");var n=t.parentElement.parentElement;if(n.classList.contains("active"))y(t);else n.querySelector(".panel-info").click(),y(t,750)}else t.classList.remove("active"),!q.preload.fullLoad&&t.classList.remove("showProgress")}))},e}();const rc=oc;var ac=function(){function e(e){this.id=e,this.ElementContent=void 0}return e.prototype.createLayout=function(){var e=q.webDicomView.globalContainer.querySelector("#".concat(this.id));if(e)e.style.zIndex="98";else{var t=q.webDicomView.globalContainer.querySelector(".viewerContentWrapper");this.ElementContent=e=(0,s.createElement)({id:this.id,oncontextmenu:function(e){return e.preventDefault()}}),e.setAttribute("style","\n\t\t\t    position: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\tz-index: 98;\n\t\t\t\t\tbackground: #000;\n\t\t\t\t\tborder: 2px solid #CACACA;\n\t\t\t\t\tborder-top: none;\n\t\t\t\t\t// padding: 2px;\n\t\t\t\t\t// margin: 2px;\n\t\t"),e.addEventListener("touchmove",(function(e){var t=e.type;(0,a.triggerEvent)(a.events,"layout_area_focus",{area:"seriesMPROr3DLayout",type:t}),e.preventDefault()}),{passive:!1}),t.append(e)}return e},e.prototype.hidden=function(){this.ElementContent&&(this.ElementContent.style.zIndex="-1")},e}();const ic=ac;var sc=function(){function e(){this.t=_("synchronizerSwitch")}return e.prototype.createIconSynchronizer=function(e,t){var n=this,o=e.querySelector(".seriesSynchronizerLayout");if(!o){var r='iconCheckBox"'+e.dataset.seriesIndex,a=this.t,i=a.title,l=a.on,c=a.off,u=a.onError;o=(0,s.createElement)({className:"seriesSynchronizerLayout",title:i,onclick:function(t){var o;n.triggerEventHandle(e,null===(o=t.target)||void 0===o?void 0:o.checked)},ontouchstart:function(t){var o=d,r=o.checked=!o.checked;try{n.triggerEventHandle(e,r)}catch(e){dt().info({title:u,timeout:1e4})}},ondblclick:function(e){e.stopPropagation()}});var d=(0,s.createElement)({tagName:"input",className:"checkbox-input",type:"checkbox",checked:t,id:r}),f=(0,s.createElement)({tagName:"label",className:"checkbox-label",onclick:function(e){e.stopPropagation()}});f.setAttribute("for",r),f.appendChild((0,s.createElement)({tagName:"span",className:"circle"})),f.appendChild((0,s.createElement)({tagName:"span",className:"text on",innerHTML:c})),f.appendChild((0,s.createElement)({tagName:"span",className:"text off",innerHTML:l})),o.appendChild(d),o.appendChild(f),e.appendChild(o),this.triggerEventHandle(e,t)}},e.prototype.triggerEventHandle=function(e,t){var n={element:e};switch(t){case!0:(0,a.triggerEvent)(a.events,"series_synchronizer_add",n);break;case!1:(0,a.triggerEvent)(a.events,"series_synchronizer_remove",n)}},e.prototype.removeSynchronizer=function(e){var t=e.querySelector(".seriesSynchronizerLayout");null==t||t.remove()},e}();const lc=sc;var cc=function(){function e(){}return e.prototype.createLayout=function(e,t,n){var o=function(e){return e>=0?"".concat(e||Math.max(n,.1),"mm"):""},r=_("DICOMTags.thickness");e.forceRender=!0,new Xs("thicknessLayout",e,(function(e){var n=(0,s.createElement)({tagName:"span",className:"label",innerText:"".concat(r,"：")}),i=(0,s.createElement)({tagName:"span",className:"num",innerText:o(t)}),l=(0,s.createElement)({className:"select-popup-item tool-event-link thickness"}),c=(0,s.createElement)({tagName:"input",type:"range",min:0,max:10,step:1,value:t,onclick:function(e){e.stopPropagation()},oninput:function(e){var t=Number(e.target.value);i.innerText=o(t),(0,a.triggerEvent)(a.events,"tool_event",{events:e,toolData:{toolTag:"MPRThicknessChange",disActive:!0},value:t,btnTarget:l})}});l.appendChild(n),l.appendChild(c),l.appendChild(i),e.appendChild(l)}))},e}();const uc=cc;var dc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},fc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},hc=function(){function e(){var e=this;this.confirmSeries={},this.toastDict=_("toast"),this.formData=function(){return[{label:e.toastDict.prompt.PTLabel,type:"PT",seriesArr:q.fusionData.PT},{label:e.toastDict.prompt.CTLabel,type:"CT",seriesArr:q.fusionData.CT}]}}return e.prototype.createLayout=function(e){var t=this;return new Promise((function(n){var o,r,a,i,l=q.webDicomView,c=q.fusionData,u=q.fusionData,d=u.PT,f=u.CT;if(!l.isStudiesLoaded(!0))return n(null);if(!d.length)return n(null),dt().error({title:t.toastDict.NoPTData});if(1===d.length&&1===f.length)return n({PT:d[0],CT:f[0]});var h=dc(e.imgs,1)[0].mod;t.activeSeries=(c[h]||[]).find((function(t){return t.seriesUid===e.seriesUid}))||d[0],t.activeSeries2=l.queryFusionSeriesLoad(t.activeSeries.imgs)[0];var p=q.webDicomView.layoutView,g=t.toastDict.prompt,v=g.OK,b=g.cancel,x=(0,s.createElement)({className:"fusionLayout fusion-form"}),w=function(e,n,o){var r,l,c=(0,s.createElement)({className:"form-item ".concat(n)}),u=(0,s.createElement)({className:"item-label",innerText:e}),d=(0,s.createElement)({className:"item-value"});m(d);var f=function(e){var o=e.seriesUid,r=(null===(a=t.activeSeries)||void 0===a?void 0:a.seriesUid)===o||(null===(i=t.activeSeries2)||void 0===i?void 0:i.seriesUid)===o,s=p.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(o,"']")).cloneNode(!0);s.onclick=function(o){var r,a,i;r=d.childNodes,a=s,void 0===i&&(i="active"),r.forEach((function(e){e.classList.toggle(i,e==a)})),y(s),t.confirmSeries[n]=e},r&&setTimeout((function(){s.click()})),d.appendChild(s)};try{for(var h=(r=void 0,fc(o)),g=h.next();!g.done;g=h.next()){f(g.value)}}catch(e){r={error:e}}finally{try{g&&!g.done&&(l=h.return)&&l.call(h)}finally{if(r)throw r.error}}d.querySelector(".viewer-navigator-wrapper").click(),c.appendChild(u),c.appendChild(d),x.appendChild(c)};try{for(var T=fc(t.formData()),I=T.next();!I.done;I=T.next()){var E=I.value;w(E.label,E.type,E.seriesArr)}}catch(e){o={error:e}}finally{try{I&&!I.done&&(r=T.return)&&r.call(T)}finally{if(o)throw o.error}}dt().question({class:q.isMobile?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:t.toastDict.prompt.fusionTitle,displayMode:1,position:"center",icon:"",progressBar:!1,inputs:[['<div class="fusion-temp"/>',"change",function(e,t,n,o){},!1]],buttons:[["<button class='confirm' >".concat(v,"</button>"),function(e,o,r,a,i){e.destroy(),n(t.confirmSeries)},!1],["<button class='cancel' >".concat(b,"</button>"),function(e,t,n,o){e.hide({},t,"cancel")},!1]],onOpening:function(e,t){io(t),document.querySelector(".fusion-temp").append(x)},onClosing:function(e,t,o){"confirm"!==o&&n(null)}})}))},e}();const pc=hc;var mc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},gc=function(){function e(){}return e.prototype.createLayout=function(e,t){var n=this;e.forceRender=!0,new Xs("fusionLayout2",e,(function(e){var o,r,i,l=q.webDicomView.layoutView,c=function(t){var o=t.seriesUid,r=(null===(i=n.activeSeries)||void 0===i?void 0:i.seriesUid)===o,c=(0,s.createElement)({className:"select-popup-item tool-event-link",onclick:function(e){n.activeSeries=r?void 0:t,(0,a.triggerEvent)(a.events,"tool_event",{events:e,toolData:{toolTag:"MPRFusionChange",disActive:!0},btnTarget:c,activeSeries:n.activeSeries})}}),u=l.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(o,"']")).cloneNode(!0);r&&(l.toggleClassName(c,void 0,"active",!0),l.toggleClassName(u,void 0,"active",!0)),c.appendChild(u),e.appendChild(c)};try{for(var u=mc(t),d=u.next();!d.done;d=u.next()){c(d.value)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(o)throw o.error}}}))},e}();const vc=gc;const yc=function(){var e=_("DICOMInfo"),t=_("DICOMTags");return[{title:e.patient,labels:[{title:"name",alias:t.name},{title:"sex",alias:t.sex,format:Al},{title:"age",alias:t.age,format:Cl},{title:"birth",alias:t.birthday},{title:"patid",alias:t.patientID}]},{title:e.examinations,labels:[{title:"inst",alias:t.hospitals},{title:"acqdt",alias:t.acquisitionDate},{title:"acqtm",alias:t.acquisitionTime},{title:"studt",alias:t.studyDate},{title:"stutm",alias:t.studyTime},{title:"studes",alias:t.description},{title:"accnum",alias:t.accessionNumber}]},{title:e.series,labels:[{title:"serid",alias:t.seriesID},{title:"seruid",alias:t.seriesUID},{title:"serdes",alias:t.seriesDescription}]},{title:e.series,labels:[{title:"imgnum",alias:t.imageNumber},{title:"wc",alias:t.windowCenter},{title:"ww",alias:t.windowWidth},{title:"kv",alias:t.KVP},{title:"sliceth",alias:t.thickness},{title:"row",alias:t.rows},{title:"col",alias:t.cols},{title:"pixx",alias:t.pixelSpacingX},{title:"pixy",alias:t.pixelSpacingY},{title:"bita",alias:t.bitsAllocated},{title:"bits",alias:t.bitsStored},{title:"hbit",alias:t.highBit},{title:"rescin",alias:t.rescaleIntercept},{title:"rescsl",alias:t.rescaleSlope},{title:"pixrep",alias:t.pixelRepresentation},{title:"frames",alias:"Frames"},{title:"sappix",alias:t.samplesPerPixel},{title:"phme",alias:t.photometricInterpretation},{title:"imgpos",alias:t.imagePosition},{title:"imgori",alias:t.imageOrientation},{title:"imgtype",alias:"ImgType"},{title:"orl",alias:t.orientationLeft},{title:"orr",alias:t.orientationRight},{title:"ort",alias:t.orientationTop},{title:"orb",alias:t.orientationBottom},{title:"scount",alias:"Scount"},{title:"blocks",alias:t.blocks}]},{title:e.device,labels:[{title:"mod",alias:t.modality},{title:"manu",alias:t.manufacturer}]},{title:e.UID,labels:[{title:"id",alias:"ID"},{title:"uid",alias:"UID"},{title:"uuid",alias:"UUID"},{title:"sopuid",alias:t.sopInstanceUID},{title:"stuid",alias:t.studyID},{title:"stuuid",alias:t.studyUID},{title:"syntaxuid",alias:t.transferSyntaxUID},{title:"relationid",alias:"RelationID"}]},{title:e.other,labels:[{title:"fileName",alias:t.fileName},{title:"fileLocation",alias:"FileLocation"},{title:"dcmfile",alias:"DCMFile"}]}]};function bc(){var e=q.instanceOptions.publicPath;return e||(window.location.pathname.match(/(\/[^/]*)+\//)||["/"])[0]+"dicomviewer-cornerstone/"}var xc=function(){function e(){this.toastDict=_("toast.interGPU")}return Object.defineProperty(e.prototype,"disTips",{get:function(){return JSON.parse(localStorage.getItem("disTips"))},set:function(e){localStorage.setItem("disTips",JSON.stringify(e))},enumerable:!1,configurable:!0}),e.prototype.createLayout=function(e){var t=this;return new Promise((function(n){var o,r=q.isMobile,a=q.instanceOptions.losslessMPR,i=e.force,l=e.gpuTier,c=e.seriesData||{},u=c.seriesLoad,d=c.fusionData,f=!(l||{}).gpu.includes("intel");if(!i&&((null===(o=u||(null==d?void 0:d.CT))||void 0===o?void 0:o.loadIds.length)<=200||t.disTips||!f||!1===a))return n(null);var h=t.toastDict,p=h.close,m=h.disReminders,g=h.title,v=h.tips,y=(0,s.createElement)({innerText:(f?v[0]:"")+v[1]}),b=(0,s.createElement)({tagName:"a",target:"_blank",innerText:v[2],href:"".concat(bc(),"doc/IntelGPU&BrowserCompatibilitySolutions-").concat(O().includes("zh")?"zh":"en",".pdf")});Object.assign(b.style,{color:"var(--theme-color2-dicom-viewer)"});var x=(0,s.createElement)({tagName:"span",innerText:v[3]});y.appendChild(b),y.appendChild(x),dt().question({class:r?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:g,displayMode:1,position:"center",icon:"",progressBar:!1,inputs:[['<div class="inter-GPU-temp"/>',"change",function(e,t,n,o){},!1]],buttons:[["<button class='confirm' >".concat(p,"</button>"),function(e,t,o,r,a){e.destroy(),n("ok")},!1],["<button class=' ".concat(i?"hidden":"cancel","' >").concat(m,"</button>"),function(e,t,n,o){e.hide({},t,"cancel")},!1]],onOpening:function(e,t){io(t),document.querySelector(".inter-GPU-temp").append(y)},onClosing:function(e,o,r){"confirm"!==r&&(t.disTips=!0,n(null),b.click())}})}))},e}();const wc=xc;var Tc=function(){return Tc=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Tc.apply(this,arguments)},Ic=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ec=function(){function e(){this.toolsDataMPR=Hs(),this.toolsDataVRT=zs(),this.toolsData=js(),this.rotatePop=new cl,this.imageTypeLayout=new $s,this.wwwcLayout=new il,this.scale=new Sl,this.colorMap=new vl,this.seriesMarker=new Pl,this.topTools=new Rl,this.seriesSlider=new Ul,this.studySlider=new Fl,this.iconSynchronizer=new lc,this.seriesLayout=new rc(this.seriesSlider,this.studySlider,this.iconSynchronizer),this.mprLayout=new ic("MPRContent"),this.vrtLayout=new ic("VRTContent"),this.iconPlayer=new $l,this.ThicknessLayout=new uc,this.FusionLayout=new pc,this.FusionLayout2=new vc,this.IntelGPULayout=new wc}return e.prototype.resizeLayout=function(e){void 0===e&&(e=this.canvasContainer),e.querySelectorAll(".layoutCellsInner").forEach((function(e){e.querySelectorAll(".layoutImage").forEach((function(e){try{(0,a.resize)(e)}catch(e){}}));try{(0,a.resize)(e)}catch(e){}}))},e.prototype.createImageTypeLayout=function(e){this.imageTypeLayout.createLayout(e)},e.prototype.createWWWCLayout=function(e){this.wwwcLayout.createLayout(e)},e.prototype.createRotateLayout=function(e){this.rotatePop.createLayout(e)},e.prototype.createScaleLayout=function(e){this.scale.createLayout(e)},e.prototype.createColorMapLayout=function(e){this.colorMap.createLayout(e)},e.prototype.createPopupLayout=function(e,t,n){void 0===n&&(n="");var o=q.webDicomView.globalContainer,r=o.querySelector(".popupLayout"),a=null==r?void 0:r.querySelector(".popup-info-content"),i=null==r?void 0:r.querySelector(".popup-info-title");if(r)a.innerHTML="",i.innerText=e,r.style.visibility="initial";else{r=(0,s.createElement)({className:"popupLayout"});var l=(0,s.createElement)({className:"popup-info-layout"}),c=(0,s.createElement)({className:"popup-info-title-bar"});i=(0,s.createElement)({className:"popup-info-title",innerText:e});var u=(0,s.createElement)({className:"popup-info-close",innerText:_("other.close"),onclick:function(){r.style.visibility="hidden"}});a=(0,s.createElement)({className:"popup-info-content"}),c.append(i),c.append(u),l.append(c),l.append(a),r.append(l),o.appendChild(r)}a.setAttribute("style",n),"string"==typeof t?a.innerHTML=t:a.append(t)},e.prototype.createDICOMMetaInfoLayout=function(e){var t,n,o,r,a,i="";try{for(var l=Ic(yc()),c=l.next();!c.done;c=l.next()){var u=c.value,d=u.title,f=u.labels;i+="<div class='title'>".concat(d,"</div>");try{for(var h=(o=void 0,Ic(f)),p=h.next();!p.done;p=h.next()){var m=p.value,g=m.title,v=m.alias,y=m.format,b=null!==(a=e[g])&&void 0!==a?a:"";b="function"===(0,s.dataType)(y)?y(b):b,i+="\n\t\t\t\t\t\t<div class='DICOM-meta-data-cell' title='".concat(v&&v.toLowerCase()===g.toLowerCase()?"":v+",").concat(g,"：").concat(b||"undefined","'>\n\t\t\t\t\t\t<div class='label'>").concat(v||g,"</div>\n\t\t\t\t\t\t<div class='value'>").concat(b,"</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t")}}catch(e){o={error:e}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}this.createPopupLayout(_("tools.DICOMInfo"),i)},e.prototype.createAboutUsLayout=function(e){var t=_("aboutUs"),n=e.version,o=e.copyright,r=e.description,a=e.tel,i=e.imgURl,l=(0,s.createElement)({tagName:"div",className:"about-Us-2"}),c=(0,s.createElement)({tagName:"div",className:"contains"}),u=(0,s.createElement)({tagName:"div",className:"bar"}),d=(0,s.createElement)({tagName:"div",className:"logo"}),f=r?(0,s.createElement)({tagName:"div",className:"dark description",innerHTML:"".concat("function"===(0,s.dataType)(r)?r():r)}):"",h=n?(0,s.createElement)({tagName:"div",innerHTML:'<span class="dark">'.concat(t.releaseVersion,'：</span><span class="bold">V').concat(String(n).split(".")[0],"</span>")}):"",p=n?(0,s.createElement)({tagName:"div",innerHTML:'<span class="dark">'.concat(t.fullVersion,'：</span><span class="bold">V').concat(n,"</span>")}):"",m=o?(0,s.createElement)({tagName:"div",innerHTML:'<i class="iconfont icon-dicom-contacts"></i><span class="bold">'.concat("function"===(0,s.dataType)(o)?o():o,"</span>")}):"",g=a?(0,s.createElement)({tagName:"div",innerHTML:'<i class="iconfont icon-dicom-tel"></i><span class="bold">'.concat("function"===(0,s.dataType)(a)?a():a,"</span>")}):"";u.append(m),u.append(g),i&&(d.style.backgroundImage="url(".concat(i,")")),(i||void 0===i)&&c.append(d),c.append(f),c.append(h),c.append(p),l.append(c),l.append(u),this.createPopupLayout(_("tools.aboutUs"),l,"padding:0;height:auto;")},e.prototype.createImageLayout=function(e,t){var n=(0,s.createElement)({tagName:"img",src:e,alt:t});n.setAttribute("style","\n\t\t\tmargin: auto;\n\t\t\theight: 100%;\n\t\t"),this.createPopupLayout(_("toast.saveImage"),n)},e.prototype.createSeriesMarker=function(e,t,n){var o=t.stuuid,r=q.webDicomView.queryStudy(o);this.seriesMarker.createParagraph(e,"ltMarker",t,n,r),this.seriesMarker.createParagraph(e,"rtMarker",t,n,r),this.seriesMarker.createParagraph(e,"lbMarker",t,n,r),this.seriesMarker.createParagraph(e,"rbMarker",t,n,r)},e.prototype.imageType=function(e){this.imageTypeLayout.handleLayout(e)},e.prototype.wwwcImage=function(e,t){this.wwwcLayout.handleLayout(e,t)},e.prototype.scaleImage=function(e,t){this.scale.handleLayout(e,t)},e.prototype.rotateImage=function(e,t){this.rotatePop.handleLayout(e,t)},e.prototype.colorMapImage=function(e,t,n){this.colorMap.handleLayout(e,t,n)},e.prototype.createSeriesCellLayout=function(e,t,n,o){var r=this,i=n||{},l=i.x,c=void 0===l?6:l,u=i.y,d=void 0===u?6:u;new Xs("series"===t?"series":"image",e.detail,(function(e){for(var n=function(n){for(var o=function(o){var i=(0,s.createElement)({className:"select-grid-item",onclick:function(){(0,a.triggerEvent)(a.events,"series"===t?"tool_series_layout":"tool_series_image_layout",{type:t,ptCell:{x:o,y:n}})},onmouseover:function(){r.changeCellStyle(e,{x:o,y:n})}});i.setAttribute("data-x",o+""),i.setAttribute("data-y",n+""),e.appendChild(i)},i=1;i<=c;i++)o(i)},o=1;o<=d;o++)n(o);e.setAttribute("style","\n\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\tgrid-template-columns: repeat(".concat(c,", 24px);\n\t\t\t\t\t\tgrid-template-rows: repeat(").concat(d,", 24px);\n\t\t\t\t\t\tpadding: 4px;\n\t\t\t\t\t\t"))}),(function(e){r.changeCellStyle(e,o)}))},e.prototype.initLayout=function(e){var t=(0,s.createElement)({className:"dicomViewToolbar"}),n=(0,s.createElement)({tagName:"img",src:q.logoURL,className:"logo",crossOrigin:"Anonymous"}),o=(0,s.createElement)({className:"divider"}),r=(0,s.createElement)({className:"viewerContentWrapper",id:"viewerContentWrapper"});if(this.leftSideContainer=(0,s.createElement)({className:"viewerLeftSidePanel"}),this.studyNavigationBody=(0,s.createElement)({className:"study-navigation-body"}),this.canvasContainer=(0,s.createElement)({className:"canvasbox",oncontextmenu:function(e){return e.preventDefault()}}),this.toolsContainer=(0,s.createElement)({className:"toolbar"}),m(this.toolsContainer),this.toolsContainer.addEventListener("touchmove",(function(e){var t=e.type;(0,a.triggerEvent)(a.events,"layout_area_focus",{area:"toolbarLayout",type:t})}))," "!==q.logoURL){var i=this.logoGrouper=(0,s.createElement)({className:"logoGroup"});i.appendChild(o),i.appendChild(n),t.appendChild(i)}q.isMobile&&e.classList.add("isMobile"),q.toolsBar.navigationBottomLayout&&(e.classList.add("navigationBottomLayout"),this.studyNavigationHead=(0,s.createElement)({className:"study-navigation-head"}),this.studyMenuLayout=new Hl(this.iconPlayer,this.studyNavigationHead),this.leftSideContainer.style.height="118px",this.leftSideContainer.appendChild(this.studyNavigationHead)),this.leftSideContainer.appendChild(this.studyNavigationBody),r.appendChild(this.leftSideContainer),r.appendChild(this.canvasContainer),t.appendChild(this.toolsContainer),e.classList.add("dicomView"),e.addEventListener("touchstart",(function(e){e.stopPropagation()})),e.appendChild(t),e.appendChild(r)},e.prototype.initTop2DTools=function(e,t){void 0===t&&(t=!1);var n=Ls().main.find((function(t){return t.toolTag===e}));this.topTools.createTopTools(this.toolsContainer,this.toolsData,n,"tools2d",t)},e.prototype.initTopMPRTools=function(e,t){void 0===t&&(t=!0);var n=Ls().MPR.find((function(t){return t.toolTag===e}));this.topTools.createTopTools(this.toolsContainer,this.toolsDataMPR,n,"toolsMPR",t)},e.prototype.initTopVRTTools=function(e,t){void 0===t&&(t=!0);var n=Ls().VRT.find((function(t){return t.toolTag===e}));this.topTools.createTopTools(this.toolsContainer,this.toolsDataVRT,n,"toolsVRT",t)},e.prototype.createStudyNavigationGroup=function(e,t,n){var o,r=(0,s.createElement)({className:"studyNavigationContainer"}),a=t.length;r.dataset.studyId=e.studyid,this.studyNavigationBody.appendChild(r),this.navigatorStudyToggleStyle(r,a),q.toolsBar.navigationBottomLayout?(0===n?this.seriesBarIconToggle(!0):r.classList.add("hidden"),null===(o=this.studyMenuLayout)||void 0===o||o.createLayout(e,n)):this.renderStudyInfo(r,e,a),this.renderDicomIcon(r,t,n)},e.prototype.renderDicomIcon=function(e,t,n){for(var o=(0,s.createElement)({className:"body-bar"}),r=null,i=function(e){var i=t[e],l=i.seriesDescription,c=i.icon,u=i.seriesId,d=i.images,f=i.series.flatSeries;i.seriesIndex=e;var h={iconImage:i},p=(0,s.createElement)({className:"viewer-navigator-wrapper",draggable:!0,onclick:function(e){clearTimeout(r),r=setTimeout((function(){(0,a.triggerEvent)(a.events,"navigator_active",Tc(Tc({},h),{target:e.target,type:"click",event:e})),y(p,e.isTrusted?0:500)}),200)},ondblclick:function(){clearTimeout(r),(0,a.triggerEvent)(a.events,"navigator_dbClick_drag",Tc(Tc({},h),{type:"dblclick"})),y(p)},ondragend:function(e){"none"!==e.dataTransfer.dropEffect&&(0,a.triggerEvent)(a.events,"navigator_dbClick_drag",Tc(Tc({},h),{type:"drag"}))},oncontextmenu:function(e){e.preventDefault()}});q.isMobile&&new(Ht())(p).on("press doubletap",(function(){(0,a.triggerEvent)(a.events,"navigator_dbClick_drag",Tc(Tc({},h),{type:"press doubletap"}))}));var m=(0,s.createElement)({className:"navigator-card"}),g=(0,s.createElement)({tagName:"div",className:"icon-image"}),v=(0,s.createElement)({tagName:"div",className:"navigator-text-wrapper"}),b=(0,s.createElement)({tagName:"div",className:"text",innerHTML:"<i class=icon-dicom-series-2></i> <span>".concat(e+1,"</span> ")}),x=(0,s.createElement)({tagName:"div",className:"num",innerHTML:"<i class=icon-dicom-image></i> <span>".concat(d.length,"</span>")}),w=(0,s.createElement)({tagName:"div",className:"navigator-description",title:l,innerHTML:"".concat(l||"")}),T=(0,s.createElement)({tagName:"img",src:c,crossOrigin:"Anonymous",decoding:"async",draggable:!1}),I=(0,s.createElement)({className:"AI-icon",tagName:"span"}),E=(0,s.createElement)({tagName:"div",className:"progressGroup"}),S=(0,s.createElement)({tagName:"span",className:"progressNum"}),C=(0,s.createElement)({tagName:"div",className:"progressBar"});if(0==n&&0===e&&(p.classList.add("active"),S.innerText="0%"),p.dataset.seriesId=u,p.dataset.index=String(e),f&&(p.dataset.flatSeries=String(f)),(0,s.env)().isWeChat){var A=(0,s.createElement)();A.setAttribute("style","\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t"),g.appendChild(A)}g.appendChild(T),g.appendChild(I),v.appendChild(b),v.appendChild(x),E.appendChild(S),E.appendChild(C),m.appendChild(g),m.appendChild(v),m.appendChild(w),p.appendChild(m),p.appendChild(E),o.appendChild(p)},l=0;l<t.length;l++)i(l);e.appendChild(o)},e.prototype.renderStudyInfo=function(e,t,n){var o=this,r=t.name,a=t.sex,i=t.age,l=t.modality,c=t.studydate,u=(0,s.createElement)({className:"panel-info"}),d=(0,s.createElement)({tagName:"p",innerHTML:"<span title='".concat(r,"'>").concat(r,"</span>/").concat(Al(a),"/").concat(Cl(i))}),f=(0,s.createElement)({tagName:"p",innerText:l}),h=(0,s.createElement)({tagName:"p",innerText:c});u.appendChild(f),u.appendChild(d),u.appendChild(h),e.appendChild(u),u.onclick=function(){o.navigatorStudyToggleStyle(e,n)}},e.prototype.navigatorStudyToggleStyle=function(e,t){e.classList.contains("active")?e.style.cssText=void 0:q.toolsBar.navigationBottomLayout?e.style.maxWidth=68*t+100+"px":e.style.maxHeight=120*t+100+"px",e.classList.toggle("active")},e.prototype.seriesBarToggle=function(e){var t;this.leftSideContainer.classList.toggle("show",e),null===(t=this.logoGrouper)||void 0===t||t.classList.toggle("show",e),this.seriesBarIconToggle(e)},e.prototype.seriesBarIconToggle=function(e){this.toggleClassName(this.querySelectorForTool(".seriesBar"),void 0,"active",e)},e.prototype.navigationMenuCloseHandle=function(e){var t,n=this;void 0===e&&(e=!1),q.toolsBar.navigationBottomLayout&&(null===(t=this.studyMenuLayout)||void 0===t||t.toggleMenuVisibility(!1),e&&setTimeout((function(){return n.resizeLayout()}),500))},e.prototype.selectPopupHidden=function(){var e;null===(e=this.toolsContainer.querySelector(".select-popup-layout:not(.invisible)"))||void 0===e||e.classList.add("invisible"),this.removeOpenMark()},e.prototype.removeOpenMark=function(){var e;null===(e=this.toolsContainer.querySelector(".select-popup-layout .open-mark"))||void 0===e||e.classList.remove("open-mark")},e.prototype.toggleToolStyle=function(e){var t=e||{},n=t.disActive,o=t.isToggle,r=t.btnTarget,a=t.toolType,i=t.toolTag,s=t.btnOriginTarget,l=t.parentData,c=t.children,u=l||{},d=u.isLonelyGroup,f=u.disActive;if(!(n||e.isLonelyGroup||c)){if(o&&r)return r.classList.toggle("active"),void(null==s||s.classList.toggle("active",!!r.parentElement.querySelector(".active")));var h=this.toolsContainer.querySelectorAll(".toolsChild.active .tool-event-link");d&&r&&(h=r.parentElement.querySelectorAll(".tool-event-link")),h.forEach((function(e){var t=JSON.parse(e.dataset.toolData||"{}"),n=t.disActive,o=t.isToggle,r=t.children,a=t.parentData,i=(void 0===a?{isLonelyGroup:void 0}:a).isLonelyGroup;n&&!r||o||(d===i&&e.classList.remove("active"),r&&!n&&setTimeout((function(){e.classList.toggle("active",!!e.querySelector(".active"))})))})),null==r||r.classList.add("active"),!f&&(null==s||s.classList.add("active")),this.toolsContainer.querySelectorAll(".tool-event-link.".concat(a||i,":not(.active)")).forEach((function(e){e.classList.add("active")}))}},e.prototype.changeCellStyle=function(e,t){if(t)for(var n=e.getElementsByTagName("div"),o=0;o<n.length;o++){var r=Number(n[o].getAttribute("data-x")),a=Number(n[o].getAttribute("data-y"));r<=t.x&&a<=t.y?n[o].classList.add("active"):n[o].classList.remove("active")}},e.prototype.progressCountStyle=function(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=!1);var r=this.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(e,"']"));if(r){if(o)r.classList.add("showProgress");else if(!r.classList.contains("showProgress")&&!r.classList.contains("active"))return;var a,i=r.querySelector(".progressNum"),s=r.querySelector(".progressBar");if(t>=0&&(a=(n/t*100).toFixed(0)+"%",i.innerText=a,s.style.width=a),"100%"===a)return r.classList.add("loaded"),void r.classList.remove("showProgress");void 0!==t||o||r.classList.remove("showProgress")}},e.prototype.toggleCavanAroundInfoStyle=function(e){this.canvasContainer.querySelectorAll("#ltMarker,#rtMarker,#lbMarker,#rbMarker").forEach((function(t){t.style.opacity=e?"1":"0"}))},e.prototype.toggleAIIconStyle=function(e){var t,n=this;e?e.forEach((function(e){var t;null===(t=n.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(e,"']")))||void 0===t||t.classList.add("show-AI")})):null===(t=this.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper.show-AI"))||void 0===t||t.forEach((function(e){e.classList.remove("show-AI")}))},e.prototype.toggleClassName=function(e,t,n,o){var r=this.querySelector(e,t);null==r||r.classList.toggle(n,o)},e.prototype.querySelector=function(e,t){return void 0===e&&(e=this.toolsContainer),t?e.querySelector(t):e},e.prototype.querySelectorForTool=function(e,t){return this.toolsContainer.querySelector("".concat(t||""," .tool-event-link").concat(e))},e.prototype.containsClassName=function(e,t){return null==e?void 0:e.classList.contains(t)},e.prototype.clearSeriesLayout=function(e,t,n){var o,r,a;void 0===t&&(t=!1),void 0===n&&(n=!1);var i=e.querySelector(".layoutImageLayout"),s=e.querySelectorAll(".layoutImage"),l=e.querySelectorAll("#ltMarker,#rtMarker,#lbMarker,#rbMarker");if(this.iconPlayer.playerRemove(e),t?null===(a=e.querySelector("canvas"))||void 0===a||a.remove():vs(e),s.forEach((function(e){vs(e),null==e||e.remove()})),null==i||i.remove(),l.forEach((function(e){null==e||e.remove()})),this.seriesSlider.removeLayout(e),this.iconSynchronizer.removeSynchronizer(e),!n)try{for(var c=Ic(["studyUID","seriesId","seriesColumn","seriesRow","seriesIndex","currentImageIdIndex"]),u=c.next();!u.done;u=c.next()){var d=u.value;delete e.dataset[d]}}catch(e){o={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}},e}();const Sc=Ec;var Cc=function(){return Cc=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Cc.apply(this,arguments)},Ac=function(){function e(e){this.iziToast=dt(),this.options=Cc({message:void 0,position:"center",class:q.isMobile?"custom-iziToast-mobile":"custom-iziToast",close:!1,theme:"dark",overlay:!0,image:n(1972),timeout:!1,progressBar:!1,onOpening:function(e,t){io(t)}},e),this.loading=!1}return Object.defineProperty(e.prototype,"dicomViewContainer",{get:function(){return this._dicomViewContainer=this._dicomViewContainer||q.webDicomView.globalContainer},enumerable:!1,configurable:!0}),e.prototype.show=function(e){this.loading||(this.loading=!0,dt().show(Cc(Cc({},this.options),e)))},e.prototype.progress=function(e){var t=this;return new Promise((function(n){setTimeout((function(){n(dt().progress(Cc({},e),t.$toast()))}))}))},e.prototype.hidden=function(){this.loading&&(this.loading=!1,dt().destroy())},e.prototype.$toast=function(){return document.querySelector("."+this.options.class)},e}();const Mc=Ac;var Pc=n(5373),Dc=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},Lc=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Oc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},kc=function(e,t){this.x=e,this.y=t},Rc=function(){function e(){var e=this;this.t=_("toast.3D"),this.ptLast={x:0,y:0},this.webDcmSocket=void 0,this.seruuId=void 0,this.loadingAnimation=new Mc({message:this.t.loading}),this.zoomLazy=(0,s.throttle)((function(t){e.zoom(t)}),q.isMobile?150:40),this.KnifeMoveLazy=(0,s.throttle)((function(t){e.KnifeMove(t)}),40),this.rotateLazy=(0,s.throttle)((function(t){e.rotate(t)}),100),this.windowsLevelLazy=(0,s.throttle)((function(t){e.windowsLevel(t)}),60),this.panLazy=(0,s.throttle)((function(t){e.pan(t)}),100)}return e.prototype.open=function(e,t){var n,o,r=this,a=t.seriesUid,i=t.hospId,l=t.studyUID,c=t.wadoURL,u=t.vrtWsURl,d=t.layoutView;if(!e.querySelector("#canvas-vrt")){var f=this.canvas=(0,s.createElement)({tagName:"canvas",id:"canvas-vrt",width:e.clientWidth,height:e.clientHeight});e.appendChild(f);var h=(0,s.throttle)((function(){f.width=e.clientWidth,f.height=e.clientHeight,r.resizeCanvasDrawImage()}),500);this.resizeObserver=new ResizeObserver(h),this.resizeObserver.observe(e);try{for(var p=Oc(["touchstart","mousedown","touchmove","mousemove","touchend","mouseup","mouseout","mousewheel"]),m=p.next();!m.done;m=p.next()){var g=m.value;f.addEventListener(g,(function(e){r.msgTransform(e)}))}}catch(e){n={error:e}}finally{try{m&&!m.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}var v=new(Ht().Manager)(f);v.add(new(Ht().Pinch)({threshold:.2})),v.add(new(Ht().Pan)({threshold:10,pointers:2})),v.on("pinch",(function(e){r.zoomLazy(e),e.preventDefault()})),v.on("panmove",(function(e){r.panLazy(e),e.preventDefault()}))}var y=I(a),b=c+"/GetImagesPath"+(0,Pc.stringify)({seruuid:y,seriesUID:y,hospcode:i,studyuid:l,studyUID:l},{addQueryPrefix:!0});if(!u)throw"3D service path is undefined";if(this.webDcmSocket){if(this.seruuId===a)return void this.refresh();this.webDcmSocketClose()}this.seruuId=a;var x=u+"/Wado?serurl="+encodeURIComponent(b);this.webDcmSocket=new WebSocket(x),this.loadingAnimation.show(),this.webDcmSocket.onclose=function(e){r.loadingAnimation.hidden(),"leave"!==e.reason&&(yt("webDcmSocketError",r.t.close),console.info("Connection closed",e))},this.webDcmSocket.onerror=function(e){r.loadingAnimation.hidden(),yt("webDcmSocketError",r.t.error),console.info("An error occur",e),d.initTop2DTools(),Vc()},this.webDcmSocket.onmessage=function(e){if("string"==typeof e.data)console.info(JSON.parse(e.data));else{var t=new FileReader;t.onload=function(e){e.target.readyState==FileReader.DONE&&(r.loadingAnimation.hidden(),r.webDcmSocketResult=t.result,(0,s.canvasDrawImage)(r.canvas,r.webDcmSocketResult))},t.readAsDataURL(e.data)}}},e.prototype.resizeCanvasDrawImage=function(){this.canvas&&this.webDcmSocketResult&&(0,s.canvasDrawImage)(this.canvas,this.webDcmSocketResult)},e.prototype.msgTransform=function(e){var t;if(!((null===(t=e.targetTouches)||void 0===t?void 0:t.length)>1))switch(e.type){case"touchstart":case"mousedown":var n=void 0;if("touchstart"===e.type){var o=e.targetTouches[0];n=new kc(o.pageX,o.pageY),this.which=1}else n=new kc(e.pageX,e.pageY),this.which=e.which;this.ptLast=n;break;case"touchmove":case"mousemove":this.mouseDownMove(e);break;case"touchend":case"mouseup":case"mouseout":this.mouseUp(),this.which=void 0;break;case"mousewheel":this.zoomLazy(e)}},e.prototype.mouseDownMove=function(e){if(1===this.which)switch(this.toolType){case"KnifeIn":case"KnifeOut":this.KnifeMoveLazy(e);break;case"Modulation":this.windowsLevelLazy(e);break;default:this.rotateLazy(e)}else 3===this.which?this.windowsLevelLazy(e):2===this.which&&this.panLazy(e)},e.prototype.mouseUp=function(){switch(this.toolType){case"KnifeIn":case"KnifeOut":this.knifeEnd(),this.toolType=void 0}},e.prototype.errorHandle=function(e,t){"cancel"!==t&&console.error(e,t)},e.prototype.getPosition=function(e){var t="touchmove"==e.type?e.targetTouches[0]:e,n=t.pageX,o=t.pageY,r=new kc(n,o),a=this.ptLast.x,i=this.ptLast.y,s=r.x-a,l=r.y-i;if(0===s&&0===l)return Promise.reject("cancel");var c=e.target.getBoundingClientRect(),u=Math.round(c.left+window.scrollX),d=Math.round(c.top+window.scrollY);return this.ptLast=r,Promise.resolve({LastPosition:[a-u,i-d],NowPosition:[n-u,o-d],rect:c})},e.prototype.rotate=function(e){return Dc(this,void 0,void 0,(function(){var t,n,o,r;return Lc(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=a.sent(),n=t.LastPosition,o=t.NowPosition,this.webDcmSocketSend({Cmd:1,LastPosition:n,NowPosition:o}),[3,3];case 2:return r=a.sent(),this.errorHandle("rotate",r),[3,3];case 3:return[2]}}))}))},e.prototype.pan=function(e){return Dc(this,void 0,void 0,(function(){var t,n,o,r,a,i,s;return Lc(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),"panmove"==e.type&&(t=e.center||{},n=t.x,o=t.y,e.pageX=Math.floor(n),e.pageY=Math.floor(o)),[4,this.getPosition(e)];case 1:return r=l.sent(),a=r.LastPosition,i=r.NowPosition,this.webDcmSocketSend({Cmd:2,LastPosition:a,NowPosition:i}),[3,3];case 2:return s=l.sent(),this.errorHandle("pan",s),[3,3];case 3:return[2]}}))}))},e.prototype.zoom=function(e){var t=e.type,n=e.scale,o=e.deltaY;this.webDcmSocketSend({Cmd:3,DeltaY:"pinch"===t?n>=1?1:-1:o>0?-1:1})},e.prototype.windowsLevel=function(e){return Dc(this,void 0,void 0,(function(){var t,n,o,r;return Lc(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=a.sent(),n=t.LastPosition,o=t.NowPosition,this.webDcmSocketSend({Cmd:4,LastPosition:n,NowPosition:o}),[3,3];case 2:return r=a.sent(),this.errorHandle("windowsLevel",r),[3,3];case 3:return[2]}}))}))},e.prototype.KnifeMove=function(e){return Dc(this,void 0,void 0,(function(){var t,n,o,r,a;return Lc(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=i.sent(),n=t.LastPosition,o=t.NowPosition,r=t.rect,this.webDcmSocketSend({Cmd:5,LastPosition:n,NowPosition:o,ViewWidth:Math.round(r.width),ViewHeight:Math.round(r.height)}),[3,3];case 2:return a=i.sent(),this.errorHandle("KnifeMove",a),[3,3];case 3:return[2]}}))}))},e.prototype.toolsToggle=function(e){this.toolType=e},e.prototype.knifeBegin=function(e,t){if(void 0===t&&(t=function(){}),"function"!=typeof t)throw"callback function is required";this.toolType=e,this.knifeFinishCallback=t,this.webDcmSocketSend({KnifeOut:{Cmd:6},KnifeIn:{Cmd:7}}[e])},e.prototype.knifeEnd=function(){var e=this.knifeFinishCallback;if(this.webDcmSocketSend({Cmd:8}),"function"!=typeof e)throw"callback function is required";e()},e.prototype.reset=function(){if(this.webDcmSocket.readyState>=2)return this.reconnect();this.webDcmSocketSend({Cmd:0})},e.prototype.refresh=function(){this.webDcmSocketSend({Cmd:99})},e.prototype.webDcmSocketClose=function(){this.webDcmSocket&&(this.webDcmSocket.close(1e3,"leave"),this.webDcmSocket=void 0)},e.prototype.webDcmSocketSend=function(e){this.webDcmSocket.send(JSON.stringify(e))},e.prototype.reconnect=function(){var e=this.webDcmSocket,t=e.onclose,n=e.onerror,o=e.onmessage,r=e.onopen,a=e.url;this.webDcmSocketClose(),this.webDcmSocket=new WebSocket(a),this.webDcmSocket.onclose=t,this.webDcmSocket.onmessage=o,this.webDcmSocket.onerror=n,this.webDcmSocket.onopen=r},e.prototype.destroy=function(){this.webDcmSocketClose(),this.resizeObserver.disconnect(),this.canvas.remove()},e}();const _c=Rc;var Nc,Bc,Uc=function(){var e;null===(e=Bc.toolsContainer.querySelector(".toolsChild .tool-event-link.VRTRotate"))||void 0===e||e.click()},Vc=function(){if(Nc)try{Nc.destroy()}catch(e){console.error(e)}finally{Nc=void 0,Bc.vrtLayout.hidden()}};const Fc=function(){};var jc=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Hc=function(e){function t(t){var n=e.call(this)||this;return n.id=t.id,n.num=t.num,n.imageicon=t.imageicon,n.isLoadImage=t.isLoadImage,n}return jc(t,e),t.prototype.setInfo=function(e){if(this.name=e.name.replace(/\^/g,""),this.sex=e.sex,this.age=e.age,this.birth=e.birth,this.patid=e.patid,this.mod=e.mod,this.accnum=e.accnum,this.stuid=e.stuid,this.stuuid=e.stuuid,this.studes=e.studes,this.serid=e.serid,this.seruid=e.seruid,this.serdes=e.serdes,this.imgnum=e.imgnum,this.sopuid=e.sopuid,this.uid=e.uid,this.blocks=parseInt(e.blocks),this.studt=e.studt,this.stutm=e.stutm,"string"==typeof e.stutm&&e.stutm.indexOf(":")<0||"string"==typeof e.stutm&&e.studt.indexOf("-")<0)for(var t=0;t<2;t++){var n=e.stutm.substr(2*t,2),o=e.studt.substr(2*t+4,2);0==t&&(this.stutm=n,this.studt=e.studt.substr(0,4)),this.stutm+=":"+n,this.studt+="-"+o}else this.stutm=e.stutm,this.studt=e.studt;if(this.acqdt=e.acqdt,this.acqtm=e.acqtm,this.acqtm&&(this.acqtm=parseFloat(e.acqtm).toFixed(3)),this.wc=parseFloat(e.wc),this.ww=parseFloat(e.ww),this.ma=e.ma,this.kv=e.kv,this.sliceth=e.sliceth,this.manu=e.manu,this.inst=e.inst,this.row=parseInt(e.row),this.col=parseInt(e.col),"string"==typeof e.pixx&&"string"==typeof e.pixx){if(-1!=e.pixx.indexOf(" ")){var r=e.pixx.split(" ");2==r.length&&(this.pixx=parseFloat(r[0]),this.pixy=parseFloat(r[1]))}this.pixx=parseFloat(e.pixx),this.pixy=parseFloat(e.pixy)}this.bita=parseInt(e.bita),this.bits=e.bits,this.hbit=e.hbit,this.rescin=parseInt(e.rescin),this.rescsl=parseFloat(e.rescsl),(""===e.rescin||null===e.rescin||isNaN(this.rescin))&&(this.rescin=0),(""===e.rescsl||null===e.rescsl||isNaN(this.rescsl)||this.rescsl<1)&&(this.rescsl=1),this.pixrep=parseInt(e.pixrep),this.sappix=parseInt(e.sappix),this.phme=e.phme,this.orl=e.orl,this.ort=e.ort,this.orr=e.orr,this.orb=e.orb,this.strScount=e.scount},t.prototype.setData=function(e){void 0!==e&&(this.pixsBuffer=e,this.isLoadImage=!0,this.getMaxMinGary())},t.prototype.getMaxMinGary=function(){for(var e,t=1e6,n=-1e6,o=0;o<this.pixsBuffer.length;o++)(e=this.pixsBuffer[o])>t&&(t=e),e<n&&(n=e);this.minGary=n,this.maxGary=t},t}(Fc);const zc=Hc;const qc=function(){function e(e){this.flatSeries=!1,this.desp=e.desp,this.imgs=e.imgs,this.num=e.num,this.uid=e.uid,this.uuid=e.uuid,this.studyUID=e.studyUID,this.wado=e.wado,this.icon=e.icon,this.flatSeries=e.flatSeries,this.arrImage=[],this.initSeries()}return e.prototype.initSeries=function(){var e=this;this.imgs.forEach((function(t){var n=new zc({id:t.id,num:t.num,imageicon:e.icon,isLoadImage:!1});e.arrImage.push(n)}))},e}();function Wc(e){return Wc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wc(e)}var Gc=function(){function e(e,t){this.wado=t,this.hospId=e.hospId,this.arrSeries=[],this.images=[],this.studyuid=e.studyuid,this.studyuuid=e.studyuuid,this.age=e.age,this.hasseries=parseInt(e.hasseries),this.orgname=e.orgname,this.imgcount=parseInt(e.imgcount),this.modality=e.modality,null!=this.modality&&""!=this.modality&&(this.modality=this.modality.toUpperCase()),this.name=e.name,null!=this.name&&""!=this.name&&(this.name=this.name.replace(/\^/g,"")),this.orginaltype=e.orginaltype,this.patientid=e.patientid,this.seriescount=e.seriescount,this.studydate=e.studydate,this.studydate.indexOf("-")>-1&&(this.studydate=this.studydate.replace(/-/g,"/"));var n=A(this.studydate,"yyyy-MM-dd"),o=A(this.studydate,"hh:mm:ss");this.studydate=n,this.studytime=o,this.seriesArr=e.serieses.sort((function(e,t){return Number(e.num)-Number(t.num)})),this.sex=e.sex,this.studyid=e.studyid,this.totaltype="RAW",null!=this.totaltype&&""!=this.totaltype&&(this.totaltype=this.totaltype.toUpperCase()),this.hasseries?this.setSeries():this.setImages(e.imgs)}return e.prototype.setSeries=function(e){var t=this;void 0===e&&(e=this.seriesArr),e.forEach((function(e,n){var o=e.desp,r=e.imgs,a=e.num,i=e.uid,s=e.uuid,l=e.sign,c=e.flatSeries;e.imgs.sort((function(e,t){return Number(e.num)-Number(t.num)})),t.arrSeries.push(new qc({desp:o,imgs:r,num:a,uid:i+(c?"?index="+n:""),uuid:s+(c?"?index="+n:""),flatSeries:c,studyUID:t.studyuid,wado:t.wado,icon:t.wado+"/GetImageThumb/"+r[0].id+(0,Pc.stringify)({studyuid:t.studyuid,studyUID:t.studyuid,seriesId:s,seriesID:s,hospId:t.hospId,hospID:t.hospId,sign:l},{addQueryPrefix:!0})}))}))},e.prototype.setImages=function(e){var t=this;void 0!==e&&e.forEach((function(e){var n=new zc({id:e.id,num:e.num,imageicon:t.wado+"/GetImageThumb"+e.id,isLoadImage:!1});t.images.push(n)}))},e.prototype.setSeriesDicom=function(e){var t=this;e instanceof Array&&e.forEach((function(e){t.setDicomMeta(e)}))},e.prototype.setDicomMeta=function(e){for(var t=0;t<this.arrSeries.length;t++)for(var n=this.arrSeries[t],o=0;o<n.arrImage.length;o++){n.arrImage[o].id,e.id}},e.prototype.deepCopy=function(e,t){for(var n in t=t||new qc(null),e)"object"===Wc(e[n])&&null!=e[n]?(t[n]=e[n].constructor===Array?[]:{},this.deepCopy(e[n],t[n])):t[n]=e[n];return t},e.prototype.getStudyType=function(){var e="";return"JPG"==this.totaltype?e="jpg":"RAW"==this.totaltype&&(e="series"),e},e.prototype.getSeriesLayoutCount=function(){var e=q.instanceOptions.seriesLayoutDefault||{},t=e.x,n=e.y,o={x:1,y:1};return t&&n?{x:Math.max(Math.trunc(t)||0,1),y:Math.max(Math.trunc(n)||0,1)}:q.isMobile?o:["CT","MR"].includes(this.modality)?{x:2,y:2}:o},e.prototype.getDicomByID=function(e){for(var t=null,n=null,o=0;o<this.arrSeries.length;o++){t=this.arrSeries[o];for(var r=0;r<t.arrImage.length;r++)if((n=t.arrImage[r]).id==e)return n}},e.prototype.getAllDicom=function(){var e=[];return this.arrSeries.forEach((function(t){t.arrImage.forEach((function(t){e.push(t)}))})),e},e}();const Yc=Gc;var Zc=function(){return Zc=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Zc.apply(this,arguments)},Xc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Kc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Qc=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Jc=function(){function e(e){this.states=[],this.originStates=[],this.addSeriesArr(e)}return e.prototype.addSeriesArr=function(e){var t,n;try{for(var o=Xc(e),r=o.next();!r.done;r=o.next()){var a=r.value,i=a.studyUID,s=a.uuid;this.states.push({studyUID:i,seriesId:s,series:a,scrollIndex:0,synchronizerStatus:!1})}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.getStates=function(){return this.states},e.prototype.getStatesLength=function(){return this.states.length},e.prototype.getSeries=function(e){return void 0===e&&(e="states"),("states"===e?this.states:this.originStates).map((function(e){return e.series}))},e.prototype.getSeriesActiveIndex=function(e){for(var t=void 0,n=0;n<this.states.length;n++){if(this.states[n].seriesId===e){t=n;break}}return t},e.prototype.removeSerie=function(e){this.states[e]={studyUID:void 0,seriesId:void 0,scrollIndex:void 0,synchronizerStatus:void 0,series:void 0}},e.prototype.syncState=function(e){void 0===e&&(e="states"),this[e]=Qc([],Kc("states"===e?this.originStates:this.states),!1)},e.prototype.getOriginState=function(){return this.originStates},e.prototype.setState=function(e,t){this.states[e]=Zc(Zc({},this.states[e]),t)},e.prototype.setSynchronizerStatus=function(e,t){this.states[e]=Zc(Zc({},this.states[e]),{synchronizerStatus:t})},e.prototype.getSynchronizerStatus=function(e){return this.states[e].synchronizerStatus},e.prototype.setScrollIndex=function(e,t){this.states[e]=Zc(Zc({},this.states[e]),{scrollIndex:t})},e}();const $c=Jc;function eu(e,t){return function(){return e.apply(t,arguments)}}const{toString:tu}=Object.prototype,{getPrototypeOf:nu}=Object,ou=(ru=Object.create(null),e=>{const t=tu.call(e);return ru[t]||(ru[t]=t.slice(8,-1).toLowerCase())});var ru;const au=e=>(e=e.toLowerCase(),t=>ou(t)===e),iu=e=>t=>typeof t===e,{isArray:su}=Array,lu=iu("undefined");const cu=au("ArrayBuffer");const uu=iu("string"),du=iu("function"),fu=iu("number"),hu=e=>null!==e&&"object"==typeof e,pu=e=>{if("object"!==ou(e))return!1;const t=nu(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},mu=au("Date"),gu=au("File"),vu=au("Blob"),yu=au("FileList"),bu=au("URLSearchParams"),[xu,wu,Tu,Iu]=["ReadableStream","Request","Response","Headers"].map(au);function Eu(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let o,r;if("object"!=typeof e&&(e=[e]),su(e))for(o=0,r=e.length;o<r;o++)t.call(null,e[o],o,e);else{const r=n?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let i;for(o=0;o<a;o++)i=r[o],t.call(null,e[i],i,e)}}function Su(e,t){t=t.toLowerCase();const n=Object.keys(e);let o,r=n.length;for(;r-- >0;)if(o=n[r],t===o.toLowerCase())return o;return null}const Cu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Au=e=>!lu(e)&&e!==Cu;const Mu=(Pu="undefined"!=typeof Uint8Array&&nu(Uint8Array),e=>Pu&&e instanceof Pu);var Pu;const Du=au("HTMLFormElement"),Lu=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Ou=au("RegExp"),ku=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),o={};Eu(n,((n,r)=>{let a;!1!==(a=t(n,r,e))&&(o[r]=a||n)})),Object.defineProperties(e,o)},Ru="abcdefghijklmnopqrstuvwxyz",_u="0123456789",Nu={DIGIT:_u,ALPHA:Ru,ALPHA_DIGIT:Ru+Ru.toUpperCase()+_u};const Bu=au("AsyncFunction"),Uu={isArray:su,isArrayBuffer:cu,isBuffer:function(e){return null!==e&&!lu(e)&&null!==e.constructor&&!lu(e.constructor)&&du(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||du(e.append)&&("formdata"===(t=ou(e))||"object"===t&&du(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&cu(e.buffer),t},isString:uu,isNumber:fu,isBoolean:e=>!0===e||!1===e,isObject:hu,isPlainObject:pu,isReadableStream:xu,isRequest:wu,isResponse:Tu,isHeaders:Iu,isUndefined:lu,isDate:mu,isFile:gu,isBlob:vu,isRegExp:Ou,isFunction:du,isStream:e=>hu(e)&&du(e.pipe),isURLSearchParams:bu,isTypedArray:Mu,isFileList:yu,forEach:Eu,merge:function e(){const{caseless:t}=Au(this)&&this||{},n={},o=(o,r)=>{const a=t&&Su(n,r)||r;pu(n[a])&&pu(o)?n[a]=e(n[a],o):pu(o)?n[a]=e({},o):su(o)?n[a]=o.slice():n[a]=o};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Eu(arguments[e],o);return n},extend:(e,t,n,{allOwnKeys:o}={})=>(Eu(t,((t,o)=>{n&&du(t)?e[o]=eu(t,n):e[o]=t}),{allOwnKeys:o}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,o)=>{let r,a,i;const s={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),a=r.length;a-- >0;)i=r[a],o&&!o(i,e,t)||s[i]||(t[i]=e[i],s[i]=!0);e=!1!==n&&nu(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:ou,kindOfTest:au,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const o=e.indexOf(t,n);return-1!==o&&o===n},toArray:e=>{if(!e)return null;if(su(e))return e;let t=e.length;if(!fu(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=n.next())&&!o.done;){const n=o.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const o=[];for(;null!==(n=e.exec(t));)o.push(n);return o},isHTMLForm:Du,hasOwnProperty:Lu,hasOwnProp:Lu,reduceDescriptors:ku,freezeMethods:e=>{ku(e,((t,n)=>{if(du(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const o=e[n];du(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},o=e=>{e.forEach((e=>{n[e]=!0}))};return su(e)?o(e):o(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Su,global:Cu,isContextDefined:Au,ALPHABET:Nu,generateString:(e=16,t=Nu.ALPHA_DIGIT)=>{let n="";const{length:o}=t;for(;e--;)n+=t[Math.random()*o|0];return n},isSpecCompliantForm:function(e){return!!(e&&du(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,o)=>{if(hu(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[o]=e;const r=su(e)?[]:{};return Eu(e,((e,t)=>{const a=n(e,o+1);!lu(a)&&(r[t]=a)})),t[o]=void 0,r}}return e};return n(e,0)},isAsyncFn:Bu,isThenable:e=>e&&(hu(e)||du(e))&&du(e.then)&&du(e.catch)};function Vu(e,t,n,o,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),o&&(this.request=o),r&&(this.response=r)}Uu.inherits(Vu,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Uu.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Fu=Vu.prototype,ju={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{ju[e]={value:e}})),Object.defineProperties(Vu,ju),Object.defineProperty(Fu,"isAxiosError",{value:!0}),Vu.from=(e,t,n,o,r,a)=>{const i=Object.create(Fu);return Uu.toFlatObject(e,i,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Vu.call(i,e.message,t,n,o,r),i.cause=e,i.name=e.name,a&&Object.assign(i,a),i};const Hu=Vu;function zu(e){return Uu.isPlainObject(e)||Uu.isArray(e)}function qu(e){return Uu.endsWith(e,"[]")?e.slice(0,-2):e}function Wu(e,t,n){return e?e.concat(t).map((function(e,t){return e=qu(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const Gu=Uu.toFlatObject(Uu,{},null,(function(e){return/^is[A-Z]/.test(e)}));const Yu=function(e,t,n){if(!Uu.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=Uu.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Uu.isUndefined(t[e])}));const o=n.metaTokens,r=n.visitor||c,a=n.dots,i=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&Uu.isSpecCompliantForm(t);if(!Uu.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Uu.isDate(e))return e.toISOString();if(!s&&Uu.isBlob(e))throw new Hu("Blob is not supported. Use a Buffer instead.");return Uu.isArrayBuffer(e)||Uu.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,r){let s=e;if(e&&!r&&"object"==typeof e)if(Uu.endsWith(n,"{}"))n=o?n:n.slice(0,-2),e=JSON.stringify(e);else if(Uu.isArray(e)&&function(e){return Uu.isArray(e)&&!e.some(zu)}(e)||(Uu.isFileList(e)||Uu.endsWith(n,"[]"))&&(s=Uu.toArray(e)))return n=qu(n),s.forEach((function(e,o){!Uu.isUndefined(e)&&null!==e&&t.append(!0===i?Wu([n],o,a):null===i?n:n+"[]",l(e))})),!1;return!!zu(e)||(t.append(Wu(r,n,a),l(e)),!1)}const u=[],d=Object.assign(Gu,{defaultVisitor:c,convertValue:l,isVisitable:zu});if(!Uu.isObject(e))throw new TypeError("data must be an object");return function e(n,o){if(!Uu.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+o.join("."));u.push(n),Uu.forEach(n,(function(n,a){!0===(!(Uu.isUndefined(n)||null===n)&&r.call(t,n,Uu.isString(a)?a.trim():a,o,d))&&e(n,o?o.concat(a):[a])})),u.pop()}}(e),t};function Zu(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Xu(e,t){this._pairs=[],e&&Yu(e,this,t)}const Ku=Xu.prototype;Ku.append=function(e,t){this._pairs.push([e,t])},Ku.toString=function(e){const t=e?function(t){return e.call(this,t,Zu)}:Zu;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Qu=Xu;function Ju(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $u(e,t,n){if(!t)return e;const o=n&&n.encode||Ju,r=n&&n.serialize;let a;if(a=r?r(t,n):Uu.isURLSearchParams(t)?t.toString():new Qu(t,n).toString(o),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const ed=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Uu.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},td={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},nd={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Qu,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},od="undefined"!=typeof window&&"undefined"!=typeof document,rd=(ad="undefined"!=typeof navigator&&navigator.product,od&&["ReactNative","NativeScript","NS"].indexOf(ad)<0);var ad;const id="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,sd=od&&window.location.href||"http://localhost",ld={...r,...nd};const cd=function(e){function t(e,n,o,r){let a=e[r++];if("__proto__"===a)return!0;const i=Number.isFinite(+a),s=r>=e.length;if(a=!a&&Uu.isArray(o)?o.length:a,s)return Uu.hasOwnProp(o,a)?o[a]=[o[a],n]:o[a]=n,!i;o[a]&&Uu.isObject(o[a])||(o[a]=[]);return t(e,n,o[a],r)&&Uu.isArray(o[a])&&(o[a]=function(e){const t={},n=Object.keys(e);let o;const r=n.length;let a;for(o=0;o<r;o++)a=n[o],t[a]=e[a];return t}(o[a])),!i}if(Uu.isFormData(e)&&Uu.isFunction(e.entries)){const n={};return Uu.forEachEntry(e,((e,o)=>{t(function(e){return Uu.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),o,n,0)})),n}return null};const ud={transitional:td,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",o=n.indexOf("application/json")>-1,r=Uu.isObject(e);r&&Uu.isHTMLForm(e)&&(e=new FormData(e));if(Uu.isFormData(e))return o?JSON.stringify(cd(e)):e;if(Uu.isArrayBuffer(e)||Uu.isBuffer(e)||Uu.isStream(e)||Uu.isFile(e)||Uu.isBlob(e)||Uu.isReadableStream(e))return e;if(Uu.isArrayBufferView(e))return e.buffer;if(Uu.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Yu(e,new ld.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,o){return ld.isNode&&Uu.isBuffer(e)?(this.append(t,e.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=Uu.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Yu(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||o?(t.setContentType("application/json",!1),function(e,t,n){if(Uu.isString(e))try{return(t||JSON.parse)(e),Uu.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ud.transitional,n=t&&t.forcedJSONParsing,o="json"===this.responseType;if(Uu.isResponse(e)||Uu.isReadableStream(e))return e;if(e&&Uu.isString(e)&&(n&&!this.responseType||o)){const n=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw Hu.from(e,Hu.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ld.classes.FormData,Blob:ld.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Uu.forEach(["delete","get","head","post","put","patch"],(e=>{ud.headers[e]={}}));const dd=ud,fd=Uu.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),hd=Symbol("internals");function pd(e){return e&&String(e).trim().toLowerCase()}function md(e){return!1===e||null==e?e:Uu.isArray(e)?e.map(md):String(e)}function gd(e,t,n,o,r){return Uu.isFunction(o)?o.call(this,t,n):(r&&(t=n),Uu.isString(t)?Uu.isString(o)?-1!==t.indexOf(o):Uu.isRegExp(o)?o.test(t):void 0:void 0)}class vd{constructor(e){e&&this.set(e)}set(e,t,n){const o=this;function r(e,t,n){const r=pd(t);if(!r)throw new Error("header name must be a non-empty string");const a=Uu.findKey(o,r);(!a||void 0===o[a]||!0===n||void 0===n&&!1!==o[a])&&(o[a||t]=md(e))}const a=(e,t)=>Uu.forEach(e,((e,n)=>r(e,n,t)));if(Uu.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(Uu.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let n,o,r;return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),o=e.substring(r+1).trim(),!n||t[n]&&fd[n]||("set-cookie"===n?t[n]?t[n].push(o):t[n]=[o]:t[n]=t[n]?t[n]+", "+o:o)})),t})(e),t);else if(Uu.isHeaders(e))for(const[t,o]of e.entries())r(o,t,n);else null!=e&&r(t,e,n);return this}get(e,t){if(e=pd(e)){const n=Uu.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=n.exec(e);)t[o[1]]=o[2];return t}(e);if(Uu.isFunction(t))return t.call(this,e,n);if(Uu.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=pd(e)){const n=Uu.findKey(this,e);return!(!n||void 0===this[n]||t&&!gd(0,this[n],n,t))}return!1}delete(e,t){const n=this;let o=!1;function r(e){if(e=pd(e)){const r=Uu.findKey(n,e);!r||t&&!gd(0,n[r],r,t)||(delete n[r],o=!0)}}return Uu.isArray(e)?e.forEach(r):r(e),o}clear(e){const t=Object.keys(this);let n=t.length,o=!1;for(;n--;){const r=t[n];e&&!gd(0,this[r],r,e,!0)||(delete this[r],o=!0)}return o}normalize(e){const t=this,n={};return Uu.forEach(this,((o,r)=>{const a=Uu.findKey(n,r);if(a)return t[a]=md(o),void delete t[r];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(r):String(r).trim();i!==r&&delete t[r],t[i]=md(o),n[i]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Uu.forEach(this,((n,o)=>{null!=n&&!1!==n&&(t[o]=e&&Uu.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[hd]=this[hd]={accessors:{}}).accessors,n=this.prototype;function o(e){const o=pd(e);t[o]||(!function(e,t){const n=Uu.toCamelCase(" "+t);["get","set","has"].forEach((o=>{Object.defineProperty(e,o+n,{value:function(e,n,r){return this[o].call(this,t,e,n,r)},configurable:!0})}))}(n,e),t[o]=!0)}return Uu.isArray(e)?e.forEach(o):o(e),this}}vd.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Uu.reduceDescriptors(vd.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),Uu.freezeMethods(vd);const yd=vd;function bd(e,t){const n=this||dd,o=t||n,r=yd.from(o.headers);let a=o.data;return Uu.forEach(e,(function(e){a=e.call(n,a,r.normalize(),t?t.status:void 0)})),r.normalize(),a}function xd(e){return!(!e||!e.__CANCEL__)}function wd(e,t,n){Hu.call(this,null==e?"canceled":e,Hu.ERR_CANCELED,t,n),this.name="CanceledError"}Uu.inherits(wd,Hu,{__CANCEL__:!0});const Td=wd;function Id(e,t,n){const o=n.config.validateStatus;n.status&&o&&!o(n.status)?t(new Hu("Request failed with status code "+n.status,[Hu.ERR_BAD_REQUEST,Hu.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const Ed=function(e,t){e=e||10;const n=new Array(e),o=new Array(e);let r,a=0,i=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=o[i];r||(r=l),n[a]=s,o[a]=l;let u=i,d=0;for(;u!==a;)d+=n[u++],u%=e;if(a=(a+1)%e,a===i&&(i=(i+1)%e),l-r<t)return;const f=c&&l-c;return f?Math.round(1e3*d/f):void 0}};const Sd=function(e,t){let n=0;const o=1e3/t;let r=null;return function(){const t=!0===this,a=Date.now();if(t||a-n>o)return r&&(clearTimeout(r),r=null),n=a,e.apply(null,arguments);r||(r=setTimeout((()=>(r=null,n=Date.now(),e.apply(null,arguments))),o-(a-n)))}},Cd=(e,t,n=3)=>{let o=0;const r=Ed(50,250);return Sd((n=>{const a=n.loaded,i=n.lengthComputable?n.total:void 0,s=a-o,l=r(s);o=a;const c={loaded:a,total:i,progress:i?a/i:void 0,bytes:s,rate:l||void 0,estimated:l&&i&&a<=i?(i-a)/l:void 0,event:n,lengthComputable:null!=i};c[t?"download":"upload"]=!0,e(c)}),n)},Ad=ld.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function o(n){let o=n;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=o(window.location.href),function(e){const t=Uu.isString(e)?o(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0},Md=ld.hasStandardBrowserEnv?{write(e,t,n,o,r,a){const i=[e+"="+encodeURIComponent(t)];Uu.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),Uu.isString(o)&&i.push("path="+o),Uu.isString(r)&&i.push("domain="+r),!0===a&&i.push("secure"),document.cookie=i.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Pd(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Dd=e=>e instanceof yd?{...e}:e;function Ld(e,t){t=t||{};const n={};function o(e,t,n){return Uu.isPlainObject(e)&&Uu.isPlainObject(t)?Uu.merge.call({caseless:n},e,t):Uu.isPlainObject(t)?Uu.merge({},t):Uu.isArray(t)?t.slice():t}function r(e,t,n){return Uu.isUndefined(t)?Uu.isUndefined(e)?void 0:o(void 0,e,n):o(e,t,n)}function a(e,t){if(!Uu.isUndefined(t))return o(void 0,t)}function i(e,t){return Uu.isUndefined(t)?Uu.isUndefined(e)?void 0:o(void 0,e):o(void 0,t)}function s(n,r,a){return a in t?o(n,r):a in e?o(void 0,n):void 0}const l={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(e,t)=>r(Dd(e),Dd(t),!0)};return Uu.forEach(Object.keys(Object.assign({},e,t)),(function(o){const a=l[o]||r,i=a(e[o],t[o],o);Uu.isUndefined(i)&&a!==s||(n[o]=i)})),n}const Od=e=>{const t=Ld({},e);let n,{data:o,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:i,headers:s,auth:l}=t;if(t.headers=s=yd.from(s),t.url=$u(Pd(t.baseURL,t.url),e.params,e.paramsSerializer),l&&s.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Uu.isFormData(o))if(ld.hasStandardBrowserEnv||ld.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(ld.hasStandardBrowserEnv&&(r&&Uu.isFunction(r)&&(r=r(t)),r||!1!==r&&Ad(t.url))){const e=a&&i&&Md.read(i);e&&s.set(a,e)}return t},kd="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){const o=Od(e);let r=o.data;const a=yd.from(o.headers).normalize();let i,{responseType:s}=o;function l(){o.cancelToken&&o.cancelToken.unsubscribe(i),o.signal&&o.signal.removeEventListener("abort",i)}let c=new XMLHttpRequest;function u(){if(!c)return;const o=yd.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());Id((function(e){t(e),l()}),(function(e){n(e),l()}),{data:s&&"text"!==s&&"json"!==s?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:o,config:e,request:c}),c=null}c.open(o.method.toUpperCase(),o.url,!0),c.timeout=o.timeout,"onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(u)},c.onabort=function(){c&&(n(new Hu("Request aborted",Hu.ECONNABORTED,o,c)),c=null)},c.onerror=function(){n(new Hu("Network Error",Hu.ERR_NETWORK,o,c)),c=null},c.ontimeout=function(){let e=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const t=o.transitional||td;o.timeoutErrorMessage&&(e=o.timeoutErrorMessage),n(new Hu(e,t.clarifyTimeoutError?Hu.ETIMEDOUT:Hu.ECONNABORTED,o,c)),c=null},void 0===r&&a.setContentType(null),"setRequestHeader"in c&&Uu.forEach(a.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),Uu.isUndefined(o.withCredentials)||(c.withCredentials=!!o.withCredentials),s&&"json"!==s&&(c.responseType=o.responseType),"function"==typeof o.onDownloadProgress&&c.addEventListener("progress",Cd(o.onDownloadProgress,!0)),"function"==typeof o.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",Cd(o.onUploadProgress)),(o.cancelToken||o.signal)&&(i=t=>{c&&(n(!t||t.type?new Td(null,e,c):t),c.abort(),c=null)},o.cancelToken&&o.cancelToken.subscribe(i),o.signal&&(o.signal.aborted?i():o.signal.addEventListener("abort",i)));const d=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(o.url);d&&-1===ld.protocols.indexOf(d)?n(new Hu("Unsupported protocol "+d+":",Hu.ERR_BAD_REQUEST,e)):c.send(r||null)}))},Rd=(e,t)=>{let n,o=new AbortController;const r=function(e){if(!n){n=!0,i();const t=e instanceof Error?e:this.reason;o.abort(t instanceof Hu?t:new Td(t instanceof Error?t.message:t))}};let a=t&&setTimeout((()=>{r(new Hu(`timeout ${t} of ms exceeded`,Hu.ETIMEDOUT))}),t);const i=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach((e=>{e&&(e.removeEventListener?e.removeEventListener("abort",r):e.unsubscribe(r))})),e=null)};e.forEach((e=>e&&e.addEventListener&&e.addEventListener("abort",r)));const{signal:s}=o;return s.unsubscribe=i,[s,()=>{a&&clearTimeout(a),a=null}]},_d=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let o,r=0;for(;r<n;)o=r+t,yield e.slice(r,o),r=o},Nd=(e,t,n,o,r)=>{const a=async function*(e,t,n){for await(const o of e)yield*_d(ArrayBuffer.isView(o)?o:await n(String(o)),t)}(e,t,r);let i=0;return new ReadableStream({type:"bytes",async pull(e){const{done:t,value:r}=await a.next();if(t)return e.close(),void o();let s=r.byteLength;n&&n(i+=s),e.enqueue(new Uint8Array(r))},cancel:e=>(o(e),a.return())},{highWaterMark:2})},Bd=(e,t)=>{const n=null!=e;return o=>setTimeout((()=>t({lengthComputable:n,total:e,loaded:o})))},Ud="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,Vd=Ud&&"function"==typeof ReadableStream,Fd=Ud&&("function"==typeof TextEncoder?(jd=new TextEncoder,e=>jd.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var jd;const Hd=Vd&&(()=>{let e=!1;const t=new Request(ld.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})(),zd=Vd&&!!(()=>{try{return Uu.isReadableStream(new Response("").body)}catch(e){}})(),qd={stream:zd&&(e=>e.body)};var Wd;Ud&&(Wd=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!qd[e]&&(qd[e]=Uu.isFunction(Wd[e])?t=>t[e]():(t,n)=>{throw new Hu(`Response type '${e}' is not supported`,Hu.ERR_NOT_SUPPORT,n)})})));const Gd=async(e,t)=>{const n=Uu.toFiniteNumber(e.getContentLength());return null==n?(async e=>null==e?0:Uu.isBlob(e)?e.size:Uu.isSpecCompliantForm(e)?(await new Request(e).arrayBuffer()).byteLength:Uu.isArrayBufferView(e)?e.byteLength:(Uu.isURLSearchParams(e)&&(e+=""),Uu.isString(e)?(await Fd(e)).byteLength:void 0))(t):n},Yd=Ud&&(async e=>{let{url:t,method:n,data:o,signal:r,cancelToken:a,timeout:i,onDownloadProgress:s,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:f}=Od(e);c=c?(c+"").toLowerCase():"text";let h,p,[m,g]=r||a||i?Rd([r,a],i):[];const v=()=>{!h&&setTimeout((()=>{m&&m.unsubscribe()})),h=!0};let y;try{if(l&&Hd&&"get"!==n&&"head"!==n&&0!==(y=await Gd(u,o))){let e,n=new Request(t,{method:"POST",body:o,duplex:"half"});Uu.isFormData(o)&&(e=n.headers.get("content-type"))&&u.setContentType(e),n.body&&(o=Nd(n.body,65536,Bd(y,Cd(l)),null,Fd))}Uu.isString(d)||(d=d?"cors":"omit"),p=new Request(t,{...f,signal:m,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:o,duplex:"half",withCredentials:d});let r=await fetch(p);const a=zd&&("stream"===c||"response"===c);if(zd&&(s||a)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=r[t]}));const t=Uu.toFiniteNumber(r.headers.get("content-length"));r=new Response(Nd(r.body,65536,s&&Bd(t,Cd(s,!0)),a&&v,Fd),e)}c=c||"text";let i=await qd[Uu.findKey(qd,c)||"text"](r,e);return!a&&v(),g&&g(),await new Promise(((t,n)=>{Id(t,n,{data:i,headers:yd.from(r.headers),status:r.status,statusText:r.statusText,config:e,request:p})}))}catch(t){if(v(),t&&"TypeError"===t.name&&/fetch/i.test(t.message))throw Object.assign(new Hu("Network Error",Hu.ERR_NETWORK,e,p),{cause:t.cause||t});throw Hu.from(t,t&&t.code,e,p)}}),Zd={http:null,xhr:kd,fetch:Yd};Uu.forEach(Zd,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const Xd=e=>`- ${e}`,Kd=e=>Uu.isFunction(e)||null===e||!1===e,Qd=e=>{e=Uu.isArray(e)?e:[e];const{length:t}=e;let n,o;const r={};for(let a=0;a<t;a++){let t;if(n=e[a],o=n,!Kd(n)&&(o=Zd[(t=String(n)).toLowerCase()],void 0===o))throw new Hu(`Unknown adapter '${t}'`);if(o)break;r[t||"#"+a]=o}if(!o){const e=Object.entries(r).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));let n=t?e.length>1?"since :\n"+e.map(Xd).join("\n"):" "+Xd(e[0]):"as no adapter specified";throw new Hu("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return o};function Jd(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Td(null,e)}function $d(e){Jd(e),e.headers=yd.from(e.headers),e.data=bd.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Qd(e.adapter||dd.adapter)(e).then((function(t){return Jd(e),t.data=bd.call(e,e.transformResponse,t),t.headers=yd.from(t.headers),t}),(function(t){return xd(t)||(Jd(e),t&&t.response&&(t.response.data=bd.call(e,e.transformResponse,t.response),t.response.headers=yd.from(t.response.headers))),Promise.reject(t)}))}const ef="1.7.2",tf={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{tf[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const nf={};tf.transitional=function(e,t,n){function o(e,t){return"[Axios v1.7.2] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,a)=>{if(!1===e)throw new Hu(o(r," has been removed"+(t?" in "+t:"")),Hu.ERR_DEPRECATED);return t&&!nf[r]&&(nf[r]=!0,console.warn(o(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,a)}};const of={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Hu("options must be an object",Hu.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let r=o.length;for(;r-- >0;){const a=o[r],i=t[a];if(i){const t=e[a],n=void 0===t||i(t,a,e);if(!0!==n)throw new Hu("option "+a+" must be "+n,Hu.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Hu("Unknown option "+a,Hu.ERR_BAD_OPTION)}},validators:tf},rf=of.validators;class af{constructor(e){this.defaults=e,this.interceptors={request:new ed,response:new ed}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Ld(this.defaults,t);const{transitional:n,paramsSerializer:o,headers:r}=t;void 0!==n&&of.assertOptions(n,{silentJSONParsing:rf.transitional(rf.boolean),forcedJSONParsing:rf.transitional(rf.boolean),clarifyTimeoutError:rf.transitional(rf.boolean)},!1),null!=o&&(Uu.isFunction(o)?t.paramsSerializer={serialize:o}:of.assertOptions(o,{encode:rf.function,serialize:rf.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=r&&Uu.merge(r.common,r[t.method]);r&&Uu.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete r[e]})),t.headers=yd.concat(a,r);const i=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,d=0;if(!s){const e=[$d.bind(this),void 0];for(e.unshift.apply(e,i),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=i.length;let f=t;for(d=0;d<u;){const e=i[d++],t=i[d++];try{f=e(f)}catch(e){t.call(this,e);break}}try{c=$d.call(this,f)}catch(e){return Promise.reject(e)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return $u(Pd((e=Ld(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}Uu.forEach(["delete","get","head","options"],(function(e){af.prototype[e]=function(t,n){return this.request(Ld(n||{},{method:e,url:t,data:(n||{}).data}))}})),Uu.forEach(["post","put","patch"],(function(e){function t(t){return function(n,o,r){return this.request(Ld(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:o}))}}af.prototype[e]=t(),af.prototype[e+"Form"]=t(!0)}));const sf=af;class lf{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const o=new Promise((e=>{n.subscribe(e),t=e})).then(e);return o.cancel=function(){n.unsubscribe(t)},o},e((function(e,o,r){n.reason||(n.reason=new Td(e,o,r),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;const t=new lf((function(t){e=t}));return{token:t,cancel:e}}}const cf=lf;const uf={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(uf).forEach((([e,t])=>{uf[t]=e}));const df=uf;const ff=function e(t){const n=new sf(t),o=eu(sf.prototype.request,n);return Uu.extend(o,sf.prototype,n,{allOwnKeys:!0}),Uu.extend(o,n,null,{allOwnKeys:!0}),o.create=function(n){return e(Ld(t,n))},o}(dd);ff.Axios=sf,ff.CanceledError=Td,ff.CancelToken=cf,ff.isCancel=xd,ff.VERSION=ef,ff.toFormData=Yu,ff.AxiosError=Hu,ff.Cancel=ff.CanceledError,ff.all=function(e){return Promise.all(e)},ff.spread=function(e){return function(t){return e.apply(null,t)}},ff.isAxiosError=function(e){return Uu.isObject(e)&&!0===e.isAxiosError},ff.mergeConfig=Ld,ff.AxiosHeaders=yd,ff.formToJSON=e=>cd(Uu.isHTMLForm(e)?new FormData(e):e),ff.getAdapter=Qd,ff.HttpStatusCode=df,ff.default=ff;const hf=ff;var pf=function(e){var t=_("response").unknown,n=e.message,o=void 0===n?t:n;yt(o,o)},mf=hf.create({baseURL:"",timeout:6e4});mf.interceptors.request.use((function(e){(0,us.start)();var t=O();return t&&e.headers&&(e.headers["Accept-Language"]=t),e}),(function(e){return Promise.reject(e)})),mf.interceptors.response.use((function(e){var t,n,o;try{(0,us.done)();var r=e.data,a=e.config,i=a.headers,s=a.params,l=a.data,c=null!==(o=null!==(t=null==i?void 0:i.disableToast)&&void 0!==t?t:null===(n=JSON.parse(l||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==o?o:null==s?void 0:s.disableToast,u=r||{},d=u.statusCode,f=u.msg,h=u.message,p=u.success,m=u.data,g=u.result;return!p&&void 0!==p||200!=d&&void 0!==d||null==(m||g)?(1!=c&&pf({message:f||h}),Promise.reject(e)):e}catch(e){return Promise.reject(e)}}),(function(e){var t,n,o;(0,us.done)();var r=_("response"),a=r.statusCode,i=r.fail,s=e.response,l=void 0===s?{config:{}}:s,c=l.status,u=void 0===c?void 0:c,d=l.config,f=e.config,h=e.message,p=f||d,m=p.headers,g=p.params,v=p.data;if(null!==(o=null!==(t=null==m?void 0:m.disableToast)&&void 0!==t?t:null===(n=JSON.parse(v||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==o?o:null==g?void 0:g.disableToast)return Promise.reject(e);switch(u){case 401:pf({message:a[401]});break;case 403:pf({message:a[403]});break;case 404:console.error(a[404]);break;default:pf({message:u?h:i,duration:5e3})}return Promise.reject(e)}));const gf=mf;var vf=function(){return vf=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},vf.apply(this,arguments)},yf=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},bf=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},xf=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n},wf=hf.CancelToken.source();function Tf(e,t,n,o){return yf(this,void 0,void 0,(function(){var r,a,i,s;return bf(this,(function(l){switch(l.label){case 0:r=o.token,a=xf(o,["token"]),l.label=1;case 1:return l.trys.push([1,4,,6]),[4,gf.get("".concat(e,"/").concat("GetStudyInfo"),{params:vf({hospId:t,hospID:t,studyUID:n},a),headers:r?{Authorization:"bearer "+r}:{}})];case 2:return i=l.sent(),[4,Promise.resolve(i.data)];case 3:return[2,l.sent()];case 4:return s=l.sent(),[4,Promise.reject(s)];case 5:return[2,l.sent()];case 6:return[2]}}))}))}function If(e,t){return new Promise((function(n,o){gf.get("".concat(e),{params:{studyUID:t}}).then((function(e){var r,a=(JSON.parse(null===(r=e.data)||void 0===r?void 0:r.result)||{}).data;switch(a){case void 0:case"ALGOERROR":return o({studyUID:t,mesage:_("response.AIDataError"),data:a});default:return"Array"===(0,s.dataType)(a)?n(a):o({studyUID:t,mesage:_("response.unknown"),data:a})}})).catch((function(e){return o(e)}))}))}var Ef=function(){return Ef=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ef.apply(this,arguments)};const Sf=function(e,t,n,o){var r=!1;t.includes("web:")&&(t=t.replace("web:",""),r=!0),t.includes("cacheDB:")&&(t=t.replace(/(cacheDB:)|(wadouri:)/g,"")),"cornerstone3D"===o&&t.includes("wadouri:")&&(t=t.replace("wadouri:",""));var a=n.get(t)||n.get("IM:"+t)||n.get("wadouri:"+t);if(a){if("generateGrayImageModule"===e){var i=a.transferSyntaxUID,s=a.rows,l=a.columns,c=a.rescaleIntercept,u=a.rescaleSlope,d=a.bitsAllocated,f=a.photometricInterpretation,h=a.pixelRepresentation,p=a.windowCenter,m=a.windowWidth,g=a.blocks;return Ef({windowWidth:m[0],windowCenter:p[0],rows:s,columns:l,rescaleSlope:u,rescaleIntercept:c,photometricInterpretation:f,bitsAllocated:d,pixelRepresentation:h,blocks:g,transferSyntaxUID:i},r&&{windowWidth:[256],windowCenter:[128],photometricInterpretation:"RGB",bitsAllocated:24,pixelRepresentation:0})}if("generalSeriesModule"===e)return{modality:a.modality,seriesInstanceUID:a.seriesInstanceUID,seriesNumber:a.seriesNumber,studyInstanceUID:a.studyInstanceUID,seriesDate:a.seriesDate,seriesTime:a.seriesTime,acquisitionDate:a.acquisitionDate,acquisitionTime:a.acquisitionTime};if("patientStudyModule"===e)return{patientAge:a.patientAge};if("imagePlaneModule"===e){var v=a.frameOfReferenceUID,y=(s=a.rows,l=a.columns,a.rowPixelSpacing),b=a.columnPixelSpacing,x=a.pixelSpacing,w=a.rowCosines,T=a.columnCosines;return{frameOfReferenceUID:v,rows:s,columns:l,imageOrientationPatient:a.imageOrientationPatient,rowCosines:w,columnCosines:T,imagePositionPatient:a.imagePositionPatient,sliceThickness:a.sliceThickness,sliceLocation:a.sliceLocation,pixelSpacing:x,rowPixelSpacing:y,columnPixelSpacing:b}}if("imageOrientationTagModule"===e)return{imageBottomTag:a.imageBottomTag,imageleftTag:a.imageleftTag,imagetightTag:a.imagetightTag,imagetopTag:a.imagetopTag};if("imagePixelModule"===e){s=a.rows,l=a.columns,d=a.bitsAllocated;var I=a.bitsStored,E=a.highBit,S=(f=a.photometricInterpretation,h=a.pixelRepresentation,a.samplesPerPixel);return Ef({samplesPerPixel:S,photometricInterpretation:f,rows:s,columns:l,bitsAllocated:d,bitsStored:I,highBit:E,pixelRepresentation:h},r&&{pixelRepresentation:0,bitsAllocated:24,bitsStored:24,highBit:24,photometricInterpretation:"RGB",samplesPerPixel:3})}if("voiLutModule"===e)return r?{windowWidth:[256],windowCenter:[128]}:{windowCenter:p=a.windowCenter,windowWidth:m=a.windowWidth};if("modalityLutModule"===e)return{rescaleIntercept:c=a.rescaleIntercept,rescaleSlope:u=a.rescaleSlope};if("sopCommonModule"===e)return{sopClassUID:void 0,sopInstanceUID:a.sopInstanceUID};if("transferSyntax"===e)return{transferSyntaxUID:i=a.transferSyntaxUID}}};var Cf=function(e){return e.split(/\|{1,2}/).map((function(e){return Number(e)}))};const Af=function(e){var t,n,o,r,a=e.mod,i=e.syntaxuid,s=e.seruid,l=e.stuuid,c=e.serid,u=e.stutm,d=e.studt,f=e.acqdt,h=e.acqtm,p=e.age,m=e.row,g=e.col,v=e.imgori,y=e.imgpos,b=e.orb,x=e.orl,w=e.orr,T=e.ort,I=e.pixx,E=e.pixy,S=e.sliceth,C=e.bita,A=e.bits,M=e.hbit,P=e.phme,D=e.pixrep,L=e.sappix,O=e.wc,k=e.ww,R=e.rescin,_=e.rescsl,N=e.sopuid,B=e.blocks,U=Cf(v),V=Cf(y),F=Number(_||1),j=Number(R||0),H=Number(D),z=[Number(I),Number(E)],q=Cf(String(I));return q.length>=2&&(z=q),z&&(n=z[0],t=z[1]),U&&(o=[U[0],U[1],U[2]],r=[U[3],U[4],U[5]]),{modality:a,frameOfReferenceUID:l,transferSyntaxUID:i,seriesInstanceUID:s,studyInstanceUID:l,sopInstanceUID:N,seriesNumber:Number(c),seriesTime:oe().parseTM(u||""),seriesDate:oe().parseDA(d||""),acquisitionTime:oe().parseTM(h||""),acquisitionDate:oe().parseDA(f||""),patientAge:p,rows:Number(m),columns:Number(g),rescaleIntercept:j,rescaleSlope:F,rowPixelSpacing:n,columnPixelSpacing:t,pixelSpacing:z,rowCosines:o,columnCosines:r,imageBottomTag:b,imageleftTag:x,imagetightTag:w,imagetopTag:T,imageOrientationPatient:U,imagePositionPatient:V,sliceThickness:Number(S),sliceLocation:V[2],bitsAllocated:Number(C),bitsStored:Number(A),highBit:Number(M),photometricInterpretation:P,pixelRepresentation:H,samplesPerPixel:Number(L),windowCenter:[parseFloat(String(O))],windowWidth:[parseFloat(String(k))],blocks:Number(B),origin:e}};var Mf=new Map,Pf=function(e){e.addProvider((function(e,t){return Sf(e,t,Mf,"cornerstone3D")}))},Df=function(){Mf.clear()};a.metaData.addProvider((function(e,t){return Sf(e,t,Mf)}));var Lf=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Of=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},kf=(0,Wt.importInternal)("util/triggerEvent"),Rf={x:null,y:null},_f={client:Rf,page:Rf},Nf=function(e){try{if(!e)return;var t=(0,a.getEnabledElement)(e),n=q.isMobile?[Wt.EVENTS.TOUCH_DRAG,Wt.EVENTS.TOUCH_END]:[Wt.EVENTS.MOUSE_UP],o=Wt.store.state.globalToolChangeHistory.slice(-1)[0]||{},r=o.mode,i=Lf(o.args,2),s=i[0],l=i[1];if("active"!==r||!l.mouseButtonMask.includes(1))return;switch(s){case"Wwwc":case"Rotate":break;case"FreehandRoi":(0,Wt.getToolForElement)(e,"FreehandRoi").cancelDrawing(e);break;default:n.forEach((function(n){kf(e,n,{image:t.image,element:e,startPoints:_f,lastPoints:_f,currentPoints:_f,deltaPoints:_f,type:n,isTouchEvent:!0})}))}}catch(e){Dl(e)}};const Bf=function(){var e,t;try{for(var n=Of((0,a.getEnabledElements)()),o=n.next();!o.done;o=n.next()){var r=o.value.element;Nf(r)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}setTimeout((function(){Wt.store.state.isToolLocked=!1}))};var Uf="cornerstone-canvas";function Vf(e){var t="canvas.".concat(Uf);return e.querySelector(t)||function(e){var t=document.createElement("canvas");return t.style.display="block",t.classList.add(Uf),e.appendChild(t),t}(e)}const Ff=function(e){var t=e.toastDict,o=e.store,r=!0,a=t.MPR.crossOrigin,i=o.sharedArrayBuffer,l=o.tipRecord;if(window.SharedArrayBuffer)Object.defineProperty(window,"crossOriginIsolated",{writable:!0}),window.crossOriginIsolated=!0;else if(i&&!l.sharedArrayBufferGuide){var c=navigator.userAgent.indexOf("WebKit")>-1,u=location.protocol;"http:"===u&&(0,s.env)().isWin&&c?(n.g.getSpeedMPRBat=function(){var e=URL.createObjectURL(new Blob(['@REM chcp 65001\n@REM chcp 936\n\n@echo off\nSetlocal enabledelayedexpansion\nset SCRIPT="%TEMP%\\%RANDOM%-%RANDOM%-%RANDOM%-%RANDOM%.vbs"\n\n:loop\n\n@REM utf-8\nchcp 65001\n\necho.\nset /p "lnkPath=请拖动chrome、Edge、360极速、360安全、QQ等(谷歌内核)浏览器快捷方式到本窗口并回车:"\n\n@REM GB2312 读取中文文件路径\nchcp 936\n\nif exist "%lnkPath%" ( echo. & echo 配置中... ) else (  echo. & echo 请重试  & goto loop)\n\necho Set oWS = WScript.CreateObject("WScript.Shell") >> %SCRIPT%\n\necho sLinkFile = "%lnkPath:"=%" >> %SCRIPT%\n\necho Set oLink = oWS.CreateShortcut(sLinkFile) >> %SCRIPT%\n\necho oLink.Arguments= "--enable-features=SharedArrayBuffer"  >> %SCRIPT%\n\n@REM echo oLink.WorkingDirectory = "%workingDir%" >> %SCRIPT%\n\necho oLink.Save >> %SCRIPT%\n\ncscript /nologo %SCRIPT%\n\ndel %SCRIPT%\n\n@REM utf-8\nchcp 65001\n\necho.\necho MPR特性支持配置完成，请关闭该浏览器全部窗口后再重新运行该快捷方式去使用MPR功能！\n\necho.\necho.\n\necho 如出现报错或运行本程序后还是无法使用MPR！\necho.\necho 解决方案：\necho.\necho 1.将快捷方式复制一份（解决权限问题）或把名称改为纯英文后再重新运行该程序；\necho.\necho 2.手动修改：找到浏览器快捷方式==》右键==》属性==》目标==》尾部添加--enable-features=SharedArrayBuffer，（例如："某某浏览器.exe" --enable-features=SharedArrayBuffer）\n\necho.\necho.\n\npause',{type:"application/x-msdownload"}]));C(e,"双击运行-配置MPR渲染加速特性支持.bat"),URL.revokeObjectURL(e)},console.info("强制配置MPR渲染加速特性支持,控制台执行getSpeedMPRBat()下载.bat文件")):console.error("http:"===u?"".concat(a).concat(t.MPR.sharedArrayBuffer.http):t.MPR.sharedArrayBuffer.https),l.sharedArrayBufferGuide=!0}return!0!==i&&!1!==i||(r=i,console.warn(t.MPR.sharedArrayBuffer.manual,i)),1!==o.imageType?(r=!1,console.info(t.MPR.sharedArrayBuffer.disabled)):window.crossOriginIsolated?console.info(t.MPR.sharedArrayBuffer.enabled):(r=!1,console.info(t.MPR.sharedArrayBuffer.unEnabled),console.warn("".concat(a,"Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated"))),r};function jf(){(function(){var e,t=(null===(e=window.performance)||void 0===e?void 0:e.memory)||{};return t.usedJSHeapSize/t.totalJSHeapSize})()>.99&&console.error(_("toast.memoryRatioTips"))}var Hf=function(){return Hf=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Hf.apply(this,arguments)};var zf=function(){return zf=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},zf.apply(this,arguments)},qf=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))},Wf=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Gf=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},Yf=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Zf=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Xf=(0,Wt.importInternal)("util/scrollToIndex"),Kf=q.aboutUs,Qf=q.toolsBar,Jf=q.AI,$f=q.DBCacheImages,eh=q.preload,th=q.systemInfo,nh=function(){function e(e,t,n,o,r){var i=this;this.eventNamespace="clear",this.studyScrollIndex=0,this.isDestroy=!1,this.getMenuDefault=Fs;var l=r||{},c=l.sharedArrayBuffer,u=l.GPUBenchmarksURL,d=l.imageTypeDefault,f=l.cacheImagesDefault,h=void 0===f?$f.enableDefault:f,p=l.scrollPreload,m=void 0===p?eh.scroll:p,g=l.scrollPreloadNum,v=void 0===g?eh.scrollNum:g,y=l.seriesPreFetchNum,b=void 0===y?eh.seriesFetchNum:y,x=l.fullLoad,w=void 0===x?eh.fullLoad:x,T=l.token,I=void 0===T?void 0:T,E=l.isDesensitize,S=void 0!==E&&E,C=l.departCode,A=void 0===C?void 0:C,M=l.isKeyImage,P=void 0!==M&&M,D=l.isInternal,L=void 0!==D&&D,O=l.clientType,k=void 0===O?0:O,N=l.forceIM,B=l.languageDefault,U=l.logoURL,V=l.minRenderCountMPR3D,F=l.theme,j=l.toolsBar,H=l.AI,z=l.aboutUs;if(this.wado=new URL(t,origin).href,this.hospId=n,this.studyUIDArr=Yf([],Gf(new Set(null==o?void 0:o.split(",").filter((function(e){return e})))),!1),this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.reqStudyCount=0,q.imageTypeDefault=(null!=d?d:(null==j?void 0:j.majModeVisibility)&&!q.isMobile)?1:0,this.imageType=q.imageType,this.token=I,this.departCode=A,this.GPUBenchmarksURL=u,this.isDesensitize=S?1:0,this.isKeyImage=P?1:0,this.isInternal=L?1:0,this.clientType=k,this.seriesCount={x:1,y:1},this.imageCount={x:1,y:1},$f.enableDefault=h,eh.scroll=m,eh.scrollNum=v,eh.seriesFetchNum=b,eh.fullLoad=w,q.aboutUs=zf(zf({},Kf),z),q.toolsBar=zf(zf({},Qf),j),q.toolsBar.navigationBottomLayout=q.isMobile&&q.toolsBar.navigationBottomLayout,q.AI=zf(zf({},Jf),H),q.forceIM=null!=N?N:q.forceIM,q.logoURL=q.toolsBar.navigationBottomLayout?" ":null!=U?U:q.logoURL,q.sharedArrayBuffer=null!=c?c:q.sharedArrayBuffer,q.minRenderCountMPR3D=null!=V?V:q.minRenderCountMPR3D,q.instanceOptions=zf({container:e,wado:t,hospId:n,studyUID:o},r),q.webDicomView=this,R(B),this.toastDict=_("toast"),this.globalContainer=(0,s.dataType)(e).includes("Element")?e:document.getElementById(e),!this.globalContainer)throw new Error("container is required, type is id:string or HTMLDivElement");if(this.globalContainer.childElementCount)throw new Error(this.toastDict.globalContainerExistence);for(var W in F)this.globalContainer.style.setProperty("--theme-".concat(W,"-dicom-viewer"),F[W]);this.synchronizer=new Wt.Synchronizer(a.EVENTS.IMAGE_RENDERED,(function(){})),this.synchronizerStackImageIndex=new Wt.Synchronizer("".concat(a.EVENTS.NEW_IMAGE," ").concat(Wt.EVENTS.STACK_SCROLL),Wt.stackImageIndexSynchronizer),this.layoutView=new Sc,this.bindEvents(),a.events.addEventNamespaceListener("tool_event.VRT",(function(e){var t=e.detail.toolData,n=(void 0===t?{}:t).toolTag;if(Nc)switch(void 0===n?"":n){case"VTRReload2D":Bc.initTop2DTools();case"MPR":Vc();break;case"VRTKnifeIn":Nc.knifeBegin("KnifeIn",Uc);break;case"VRTKnifeOut":Nc.knifeBegin("KnifeOut",Uc);break;case"VRTModulation":Nc.toolsToggle("Modulation");break;case"VRTRotate":Nc.toolsToggle("Rotate");break;case"VRTReset":Nc.reset()}})),this.layoutView.initLayout(this.globalContainer),this.layoutView.initTop2DTools(q.isMobile?"stackScroll":"zoom"),this.initAI(void 0,!0).finally((function(){i.getStudyInfos().then((function(){i.initAI()}))})),q.toolsBar.VRTVisibility&&this.initVRTPath(),q.toolsBar.enhanceVisibility&&Fe.webWorkerManager.loadWebWorkerTask("./opencvDecode.worker.js")}return e.prototype.getStudyInfoHandle=function(e,t){var n;return qf(this,void 0,void 0,(function(){var o,r,a,i,s,l;return Wf(this,(function(c){switch(c.label){case 0:if(c.trys.push([0,3,4,5]),t>0&&!this.studyArr[0]&&(t=0),!this.wado||!e)throw console.warn("wadoURL:",this.wado,"studyUID:",e),"wadoURL,studyUID is required";return[4,Tf(this.wado,this.hospId,e,{isDcm:this.imageType,imageType:this.imageType,token:this.token,departCode:this.departCode,hasDesensitize:this.isDesensitize,isKeyImage:this.isKeyImage,isInternal:this.isInternal,clientType:this.clientType})];case 1:return o=c.sent(),this.studyArr[t]=new Yc(zf(zf({},o.data),{hospId:this.hospId}),this.wado),0==t?(r=this.studyArr[0],a=(null===(n=r.arrSeries)||void 0===n?void 0:n[0])||{},i=a.uuid,s=a.studyUID,this.selectSeries={seriesId:i,studyUID:s,seriesIndex:0},this.studyScrollIndex=0,this.initFirstStudySeriesLayoutState(r),this.seriesCount=r.getSeriesLayoutCount(),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,r.arrSeries,this.seriesCount)):this.seriesLayoutState.addSeriesArr(this.studyArr[t].arrSeries),this.initStudyNavigation(t),[4,this.initSeries(t)];case 2:return c.sent(),this.seriesLayoutState.syncState("originStates"),t>0&&this.addSeries(this.seriesLayoutState.getSeries("originStates")),[3,5];case 3:return l=c.sent(),console.error(l),[3,5];case 4:return this.reqStudyCount+=1,this.isStudiesLoaded()&&this.setFusionData(),[7];case 5:return[2]}}))}))},e.prototype.getStudyInfos=function(){return qf(this,void 0,void 0,(function(){var e,t,n,o,r,a,i,s;return Wf(this,(function(l){switch(l.label){case 0:if(!this.studyUIDArr.length)throw"studyUID is empty";l.label=1;case 1:l.trys.push([1,6,7,8]),e=Zf(Object.entries(this.studyUIDArr)),t=e.next(),l.label=2;case 2:return t.done?[3,5]:(n=Gf(t.value,2),o=n[0],r=n[1],[4,this.getStudyInfoHandle(r,Number(o))]);case 3:l.sent(),l.label=4;case 4:return t=e.next(),[3,2];case 5:return[3,8];case 6:return a=l.sent(),i={error:a},[3,8];case 7:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},e.prototype.addStudy=function(e){return qf(this,void 0,void 0,(function(){var t,n,o=this;return Wf(this,(function(r){if("string"!=typeof e)throw"studyUID is required";return this.studyUIDArr.includes(e)?[2]:(t=this.studyUIDArr.length,this.isStudiesLoaded()?(this.studyUIDArr.push(e),n=t,this.getStudyInfoHandle(e,n),[2]):(setTimeout((function(){o.addStudy(e)}),1e3),[2]))}))}))},e.prototype.setFusionData=function(){var e=this.queryModalitySeriesLoad("PT");e.length&&(q.fusionData.PT=e,q.fusionData.CT=this.queryModalitySeriesLoad("CT"))},e.prototype.activeAI=function(e){q.AI=zf(zf(zf({},q.AI),{parseSuccess:!0,active:!0}),e),this.initAI()},e.prototype.renderLayoutImageToCanvas=function(e,t,n,o,r){hs(e);var i=(0,a.getDefaultViewportForImage)(e,t);(0,a.displayImage)(e,t,zf({},i)),n&&(this.layoutView.createSeriesMarker(e,n,i),this.layoutView.toggleCavanAroundInfoStyle(q.cavanAroundInfo)),this.initDicomTools(e,o,void 0,r)},e.prototype.initDicomTools=function(e,t,n,o){var r=t.loadIds;r&&r.length>0&&((0,Wt.addStackStateManager)(e,["stack"]),(0,Wt.addToolState)(e,"stack",{currentImageIdIndex:n||0,imageIds:r,loadObj:t}))},e.prototype.displaySeriesByImageindex=function(e,t,n){var o=this;return new Promise((function(r,a){if(!t)return a("dicomObj is not defined");var i=t.loadIds,s=t.imgs;Ts(i[n||0]).then((function(a){o.renderLayoutImageToCanvas(e,a,s[n||0],t),r(a)}),(function(e){a(e)}))}))},e.prototype.displayDcmByImages=function(e,t,n){var o=this,r=t.loadIds,i=e.querySelectorAll(".layoutImage"),s=i.length;s>0&&i.forEach((function(t,i){return qf(o,void 0,void 0,(function(){var o,l,c;return Wf(this,(function(u){switch(u.label){case 0:return(l=r[o=(n||0)*s+i])?(Vf(t).classList.remove("hidden"),hs(t),[4,Ts(l)]):[3,2];case 1:return c=u.sent(),(0,a.displayImage)(t,c),[3,3];case 2:Vf(t).classList.add("hidden"),e.querySelector("div.player-bar")&&o>r.length&&Xf(e,0),u.label=3;case 3:return[2]}}))}))}))},e.prototype.displayDcmBySlider=function(e,t,n,o){var r=n[o];r&&Ts(r).then((function(n){var r=e.seriesDom.clientWidth,i=e.seriesDom.clientHeight,s=(0,a.getDefaultViewportForImage)(e.seriesDom,n),l=i/n.height,c=r/n.width;s.scale=c<l?parseFloat(c.toFixed(2)):parseFloat(l.toFixed(2)),(0,a.displayImage)(e.seriesDom,n,s),t.currentImageIdIndex=o}),(function(e){}))},e.prototype.assambleLoadIds=function(e,t,n){for(var o=e.studyUID,r=e.imgs,a=e.flatSeries,i=e.uuid,s=n.length,l=function(e,t){return e+(e.includes("?")?"&":"?")+"v=".concat(t)},c=[],u=0;u<s;u++){var d=(r[a?0:u]||{}).url,f=n[u],h=f.url,p=f.id,m=f.acqtm,g=f.isIM,v=f.blocks,y=void 0;1===this.imageType?(y=l(y=d||h||this.wado+"/GetBlock/"+p+(0,Pc.stringify)({studyuid:o,hospitalid:this.hospId,seriesId:i,blockIndex:0,imageType:1},{addQueryPrefix:!0}),m),n[u].url=y,y="wadouri:"+y):(y=l(y=d||h||this.wado+"/GetBlock/"+p+(0,Pc.stringify)({studyuid:o,hospitalid:this.hospId,seriesId:i,blockIndex:0},{addQueryPrefix:!0}),m),n[u].url=y,(g||q.forceIM)&&Number(v||1)<=1&&(y="IM:"+y+"&isIM")),n[u].imageIdURL=y,c.push(y)}return{seriesIndex:t,seriesUid:i,studyUID:o,loadIds:a?c.filter((function(e,n){return n===t})):c,imgs:a?n.filter((function(e,n){return n===t})):n,images:[]}},e.prototype.initVRTPath=function(){return qf(this,void 0,void 0,(function(){var e,t,n,o,r=this;return Wf(this,(function(a){switch(a.label){case 0:e=function(e){var t=r.layoutView.querySelectorForTool(".VRT");q.toolsBar.VRTVisibility=e,null==t||t.classList.toggle("hidden",!e)},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(i=this.wado,l=this.token,new Promise((function(e,t){var n=function(e){if("Object"!=(0,s.dataType)(e.data))return t(_("response.VRTPathDataError"))};gf.get("".concat(i,"/").concat("getPath3d"),{data:{disableToast:!0},headers:l?{Authorization:"bearer "+l}:{}}).then((function(t){return n(t),e(t.data)})).catch((function(e){return n(e),t(e)}))})))];case 2:if(t=a.sent(),!(n=((null==t?void 0:t.data)||{}).path))throw"3D service path is undefined";return this.VRTWsURl=n,e(!0),[3,4];case 3:return o=a.sent(),e(!1),console.error(o),[3,4];case 4:return[2]}var i,l}))}))},e.prototype.initAI=function(e,t){return qf(this,void 0,void 0,(function(){var n,o,r,i,s,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I,E,S,C,A,M=this;return Wf(this,(function(P){switch(P.label){case 0:n=0,o=q.AI,r=o.resultURL,i=o.parseSuccess,s=o.getParseHandler,l=o.active,c=o.jumpFirstAI,u=this.layoutView.querySelectorForTool(".AI"),d=function(e,t){if(void 0===t&&(t=!1),!e)throw"seriesID is required";return new Promise((function(n){if(t){var o=ki.getFirstIndex(e),r=M.layoutView.canvasContainer.querySelector(".layoutCellsInner[data-series-id='".concat(e,"']"));r&&Xf(r,o),n(r)}else{var i=a.EVENTS.NEW_IMAGE,s=M.layoutView.canvasContainer.querySelectorAll(".layoutCellsInner"),l=function t(o){setTimeout((function(){var r=o.target;o.target.dataset.seriesId===e&&(s.forEach((function(e){e.removeEventListener(i,t);var n=ki.getFirstIndex(e.dataset.seriesId);n&&Xf(e,n)})),n(r))}))};s.forEach((function(e){e.addEventListener(i,l)}))}}))},P.label=1;case 1:if(P.trys.push([1,17,,18]),f=function(){if(setTimeout((function(){null==u||u.classList.remove("active")}),100),"function"!=typeof s)throw"AI configure error";s({studyArr:M.studyUIDArr,departCode:M.departCode,hospId:M.hospId}),console.info("GetParseHandler has been run")},!1===e)return this.layoutView.toggleAIIconStyle(),this.layoutView.topTools.AITool(),[2];if(!i)return e?[2,f()]:[2];if(!l&&!e)return[2];if(!r)throw"AI configure error";P.label=2;case 2:P.trys.push([2,9,10,11]),h=Zf(this.studyUIDArr.filter((function(e){return!Oi[e]}))),p=h.next(),P.label=3;case 3:if(p.done)return[3,8];m=p.value,P.label=4;case 4:return P.trys.push([4,6,,7]),[4,If(r,m)];case 5:return function(e,t){var n,o;Ci=Ci||_("AI"),Oi[t]=!0;try{for(var r=Mi(e),a=r.next();!a.done;a=r.next()){var i=a.value,s=i.nodule_bbox,l=i.seriesID,c=i.nodule_type,u=i.nodule_bm_prob;for(var d in s){var f=Number(d)-1,h=s[d],p=h.position,m=h.size,g="".concat(l,"?index=").concat(f),v=Li.get(g),y=p.x-m.w,b=p.y-m.h,x=p.x+m.w,w=p.y+m.h,T=Ai(Ai({},i),{noduleType:Ri(c),noduleBmProbCN:_i(u),instanceNumber:Number(d),visible:!0,active:!1,invalidated:!0,handles:{start:{x:y,y:b,movesIndependently:!0,hasBoundingBox:!0},end:{x,y:w,movesIndependently:!0,hasBoundingBox:!0},textBox:{x,y:w,active:!1,hasMoved:!0,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}});T.textBoxContent=Ni(T),Li.set(g,Di(Di([],Pi(v||[]),!1),[T],!1)),ki.add(l,f)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}ki.sort()}(P.sent(),m),null==u||u.classList.add("active"),[3,7];case 6:return g=P.sent(),n+=1,console.error(g),e&&n>=this.studyUIDArr.length&&f(),[3,7];case 7:return p=h.next(),[3,3];case 8:return[3,11];case 9:return v=P.sent(),C={error:v},[3,11];case 10:try{p&&!p.done&&(A=h.return)&&A.call(h)}finally{if(C)throw C.error}return[7];case 11:if(t)return[2];if(this.layoutView.toggleAIIconStyle(ki.getSeriesIDArr()),this.layoutView.topTools.AITool(!0),!c)return[3,16];for(w in y=void 0,b=ki.store,x=[],b)x.push(w);T=0,P.label=12;case 12:return T<x.length?(w=x[T])in b?[4,d(w,!0)]:[3,14]:[3,15];case 13:(I=P.sent())&&(y=I),P.label=14;case 14:return T++,[3,12];case 15:if(!y){if(!(E=this.layoutView.leftSideContainer.querySelector(".viewer-navigator-wrapper.show-AI")))return[2];E.click(),d(E.dataset.seriesId,!1)}P.label=16;case 16:return[3,18];case 17:return S=P.sent(),setTimeout((function(){null==u||u.classList.remove("active"),console.error("AI configure error"===S?M.toastDict.AIConfigError:S)})),console.error(S),[3,18];case 18:return[2]}}))}))},e.prototype.initSeries=function(e){return qf(this,void 0,void 0,(function(){var t,n,o,r,a,i,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I=this;return Wf(this,(function(E){switch(E.label){case 0:return t=this.studyArr[e],n=0,o=[],[4,(new s.PromiseQueue).init({arr:t.arrSeries,func:function(t){return qf(I,void 0,void 0,(function(){return Wf(this,(function(o){switch(o.label){case 0:return[4,this.getSeriesMeta(t,e,n++)];case 1:return o.sent(),[2]}}))}))},limit:6})];case 1:if(E.sent(),0==e)try{if(eh.fullLoad){r=function(e,t){var n=e.slice(1);n.length?Is(n,{cancel:!1,countCallback:function(e,o,r){I.layoutView.progressCountStyle(t,n.length,r,!0)}}):a.layoutView.progressCountStyle(t,1,1,!0)},a=this;try{for(i=Zf(t.arrSeries),l=i.next();!l.done;l=i.next())c=l.value.seriesLoadIds,g=c.loadIds,u=c.seriesUid,r(g,u)}catch(e){b={error:e}}finally{try{l&&!l.done&&(x=i.return)&&x.call(i)}finally{if(b)throw b.error}}}else{d=Math.max(eh.seriesFetchNum||(t.arrSeries.length<=6?7:5),0);try{for(f=Zf(t.arrSeries),h=f.next();!h.done;h=f.next())p=h.value.seriesLoadIds.loadIds,o=Yf(Yf([],Gf(o),!1),Gf(p.slice(1,d)),!1)}catch(e){w={error:e}}finally{try{h&&!h.done&&(T=f.return)&&T.call(f)}finally{if(w)throw w.error}}o.length&&Is(o,{cancel:!1}),m=t.arrSeries[0].seriesLoadIds,g=m.loadIds,v=m.seriesUid,(y=g.slice(d)).length?Is(y,{cancel:!1,countCallback:function(e,t,n){I.layoutView.progressCountStyle(v,y.length,n)}}):this.layoutView.progressCountStyle(v,1,1,!0)}}catch(e){console.error("first series load error: "+e)}return[2]}}))}))},e.prototype.addSeries=function(e){var t=this;if(null==e?void 0:e.length){var n=this.layoutView.seriesLayout.seriesLayouts,o=(0,a.getEnabledElements)().map((function(e){return e.element}));n.forEach((function(n,r){var a=n.seriesDom;return qf(t,void 0,void 0,(function(){var t;return Wf(this,(function(n){switch(n.label){case 0:return t=e[r],o.includes(a)||!t?[3,2]:[4,this.displaySeriesByImageindex(a,t.seriesLoadIds)];case 1:n.sent(),this.layoutView.seriesLayout.initSingle(a,t,{seriesId:t.uuid,studyUID:t.studyUID,seriesIndex:r}),this.layoutView.seriesLayout.seriesLayoutsUpdate(a,t.uuid),n.label=2;case 2:return[2]}}))}))})),this.layoutView.studySlider.createLayout(this.layoutView.canvasContainer,e,this.seriesCount,!0),this.layoutView.resizeLayout(),this.reloadReferenceLineTool()}},e.prototype.restoreSeries=function(e){var t=this;(null==e?void 0:e.length)&&(this.layoutView.iconPlayer.playerAllPauseAndRemove(),gs(),this.studyScrollIndex=0,this.layoutView.seriesLayout.seriesLayouts=[],S(this.layoutView.canvasContainer),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,e,this.seriesCount),this.layoutView.seriesLayout.seriesLayouts.forEach((function(n,o){var r=n.seriesDom,a=e[o];a&&t.displaySeriesByImageindex(r,a.seriesLoadIds)})),this.reloadReferenceLineTool())},e.prototype.getSeriesMeta=function(e,t,n){var o,r=this,a=e.studyUID,i=e.uuid;if(0===t){var l=function(){return null==o?void 0:o.seriesDom.querySelector("canvas")};if((o=this.layoutView.seriesLayout.seriesLayouts[n])&&!l()){hs(o.seriesDom);var c=l();(0,s.canvasDrawImage)(c,this.iconImagesArr[t][n].icon,{interceptors:function(){return Promise.resolve((0,s.isCanvasBlank)(c))}}).catch((function(){}))}}return function(e,t,n,o,r,a,i){return yf(this,void 0,void 0,(function(){var s,l;return bf(this,(function(c){switch(c.label){case 0:t=I(t),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,gf.get("".concat(e,"/").concat("GetSeriesMeta"),{params:{uuid:t,studyuid:n,studyUID:n,hospid:o,hospitalid:o,hospID:o,imageType:r,isDcm:r,hasDesensitize:a},headers:i?{Authorization:"bearer "+i}:{},cancelToken:wf.token})];case 2:return s=c.sent(),[4,Promise.resolve(s.data)];case 3:return[2,c.sent()];case 4:throw l=c.sent(),{message:_("response.metaDataError")+t,error:l};case 5:return[2]}}))}))}(this.wado,i,a,this.hospId,this.imageType,this.isDesensitize,this.token).then((function(a){var s=a.data;return qf(r,void 0,void 0,(function(){var r,a,l,c,u,d,f,h,p,m,g,v,y,b=this;return Wf(this,(function(x){switch(x.label){case 0:r=s.imgs.sort((function(e,t){return Number(e.imgnum)-Number(t.imgnum)})),a=this.assambleLoadIds(e,n,r),l=a.imgs,c=a.loadIds;try{for(u=Zf(l),d=u.next();!d.done;d=u.next())f=d.value,w=f.imageIdURL,T=f,Mf.set(w,Af(T))}catch(e){v={error:e}}finally{try{d&&!d.done&&(y=u.return)&&y.call(u)}finally{if(v)throw v.error}}return this.studyArr[t].arrSeries[n].seriesLoadIds=a,this.seriesLoadIds.push(a),0!==t?[3,4]:(h=this.seriesCount.x*this.seriesCount.y==1,p=ki.getSeriesIDArr(),m=p.length,g=function(){return Ts(c[0]).then((function(e){!o||h&&(0!==n||m)||b.renderLayoutImageToCanvas(o.seriesDom,e,s.imgs[0],a)}),(function(e){console.error("loadAndCacheImage",e)}))},p.includes(i)?[4,g()]:[3,2]);case 1:return x.sent(),[3,3];case 2:g(),x.label=3;case 3:x.label=4;case 4:return[2]}var w,T}))}))})).catch((function(e){console.error(e)}))},e.prototype.initFirstStudySeriesLayoutState=function(e){var t=e.arrSeries;this.seriesLayoutState=new $c(t)},e.prototype.initStudyNavigation=function(e){var t,n=this.studyArr[e],o=this.iconImagesArr[e]=[];n.arrSeries.forEach((function(e){o.push({icon:e.icon,images:e.arrImage,hasAi:!1,seriesId:e.uuid,seriesDescription:e.desp,series:e})})),((null===(t=this.layoutView.studyNavigationBody)||void 0===t?void 0:t.childElementCount)||0)<this.studyArr.length&&this.layoutView.createStudyNavigationGroup(n,o,e)},e.prototype.reload2d=function(){this.layoutView.topTools.cancelToolAndDefaultViewportTools(),this.layoutView.initTop2DTools();var e=this.studyArr[0];this.seriesCount=e.getSeriesLayoutCount(),this.seriesLayoutState.syncState(),this.restoreSeries(this.seriesLayoutState.getSeries()),cs()},e.prototype.initMPR=function(e){var t,o,r,a,s;return qf(this,void 0,void 0,(function(){var c,u,d,f,h,p,m,y,b,x,w,T,I,S,C,A,M,P,D,L,O,k,R,_,B,U,V,F,j,H;return Wf(this,(function(z){switch(z.label){case 0:c=new Mc({progressBar:!0}),z.label=1;case 1:return z.trys.push([1,5,6,7]),u=e.originalSeriesData,d=e.levelDefault,f=void 0===d?!1===q.instanceOptions.losslessMPR?null:10:d,h=e.modality,p=void 0===h?"all":h,m=e.isFusionMode,y=void 0!==m&&m,b=e.fusionData,x=e.seriesLoad,w=e.matchFusionSeries,I=g(T=u||{seriesLoad:x,matchFusionSeries:w,fusionData:b}),S=th.performanceLevel,[4,Ts(y?I.fusionData.PT.loadIds[0]:I.seriesLoad.loadIds[0])];case 2:if(void 0===(C=z.sent().color))throw"isReturn";if(A=10,y)try{for(M=Zf(Object.entries(I.fusionData)),P=M.next();!P.done;P=M.next())D=Gf(P.value,2),D[0],L=D[1],((O=L.loadIds).length>60*S*.6||f)&&(k=f||v(Math.round(80*S/O.length*10*.6),1,10),L.loadIds=E(O,10*k),A=Math.min(k,10)),C&&(L.loadIds=L.loadIds.map((function(e){return e.replace("IM","web")})))}catch(e){j={error:e}}finally{try{P&&!P.done&&(H=M.return)&&H.call(M)}finally{if(j)throw j.error}}else((R=I.seriesLoad.loadIds).length>60*S||f)&&(_=f||v(Math.round(80*S/R.length*10*(w?.6:1)),1,10),I.seriesLoad.loadIds=E(R,10*_),null===(t=null==I?void 0:I.matchFusionSeries)||void 0===t||t.forEach((function(e){e.loadIds=E(e.loadIds,10*_)})),A=_),C&&(I.seriesLoad.loadIds=I.seriesLoad.loadIds.map((function(e){return e.replace("IM","web")})),null===(o=null==I?void 0:I.matchFusionSeries)||void 0===o||o.forEach((function(e){e.loadIds=e.loadIds.map((function(e){return e.replace("IM","web")}))})));return B=this.layoutView.mprLayout.createLayout(),U=(null===(r=I.seriesLoad)||void 0===r?void 0:r.loadIds)||Yf(Yf([],Gf(I.fusionData.CT.loadIds),!1),Gf(I.fusionData.PT.loadIds),!1),c.show({message:this.toastDict.MPR.loading}),V=c.$toast().querySelector(".iziToast-progressbar div"),[4,Is(U,{type:"MPR",countCallback:function(e,t,n){n%5==0&&(V.style.width=n/U.length*100+"%")}})];case 3:if(z.sent(),c.hidden(),jf(),void 0===n.g.webDicomViewMPR)throw"unMPRModule";return this.layoutView.initTopMPRTools(q.isMobile?"MPRStackScroll":"MPRCrosshairs"),this.layoutView.querySelector(void 0,".toolsMPR").classList.toggle("isFusionMode",y),[4,null===(a=n.g.webDicomViewMPR)||void 0===a?void 0:a.MPRRun(B,{seriesData:I,originalSeriesData:T,isFusionMode:y,GPUBenchmarksURL:this.GPUBenchmarksURL,layoutView:this.layoutView,useSharedArrayBuffer:Ff({toastDict:this.toastDict,store:q}),recommendLevel:A,modality:p,globalVar:{cornerstone:i(),cornerstoneWADOImageLoader:je(),iziToast:dt(),simple2k13:l(),Hammer:Ht(),store:q,utils:{clearImageCache:$,customPrompt:lo,init3DProvider:Pf,registerIMImageLoader:Je,registerWebImageLoader:rt,getPublicPath:bc,i18n:N}}})];case 4:return z.sent(),[3,7];case 5:return F=z.sent(),jf(),this.layoutView.mprLayout.hidden(),this.layoutView.initTop2DTools(),"isReturn"===F?[2]:"unMPRModule"===F?(console.error(this.toastDict.MPR.unMPRModule),[2]):(console.error(F),dt().error({title:this.toastDict.MPR.renderError}),null===(s=n.g.webDicomViewMPR)||void 0===s||s.MPRDestroy(),[3,7]);case 6:return c.hidden(),[7];case 7:return[2]}}))}))},e.prototype.initVRT=function(){try{var e=this.queryCurrentContainer(),t=e.seriesDom,n=e.seriesId;if(!n)throw this.toastDict.noSerise;var o=this.querySeriesLoadIds(n),r=o.loadIds,a=o.seriesUid,i=o.studyUID,s=Gf(o.imgs,1)[0].imgpos;if(this.VRTWsURl||console.error(this.toastDict["3D"].noURL),!a||!r||!t.dataset.seriesId)throw this.toastDict.noSerise;if(!s)throw this.toastDict.noImagePosition3D;if(r.length<q.minRenderCountMPR3D)throw"".concat(this.toastDict.seriesNumLow[0]).concat(q.minRenderCountMPR3D,"，").concat(this.toastDict.seriesNumLow[1]," 3D");!function(e,t){try{var n=t.layoutView;Nc=new _c,Bc=n,Nc.open(e,t)}catch(e){throw console.error(e),e}}(this.layoutView.vrtLayout.createLayout(),{vrtWsURl:this.VRTWsURl,wadoURL:this.wado,hospId:this.hospId,studyUID:i,seriesUid:a,layoutView:this.layoutView}),this.layoutView.initTopVRTTools("VRTRotate")}catch(e){this.layoutView.vrtLayout.hidden(),this.layoutView.initTop2DTools(),console.error(e),dt().error({title:e})}},e.prototype.reloadReferenceLineTool=function(){var e=this.layoutView.containsClassName(this.layoutView.querySelectorForTool(".referenceLine"),"active");this.referenceLineTool(e)},e.prototype.cancelToolAndDefaultViewport=function(){var e=(this.queryCurrentContainer()||{}).seriesDom,t=null==e?void 0:e.querySelector(".layoutImage.active"),n=Yf(Yf([],Gf(this.synchronizer.getSourceElements()),!1),[t||e],!1);this.layoutView.topTools.cancelToolAndDefaultViewportTools(n)},e.prototype.saveImageTool=function(){var e,t,n,o=this.queryCurrentContainer()||{},r=o.seriesDom,a=o.seriesId,i=r.querySelector(".layoutImage.active"),l=null===(e=r.querySelector("#filmMarker"))||void 0===e?void 0:e.textContent.split("：")[1],c=null===(t=i||r)||void 0===t?void 0:t.querySelector("canvas");if(!c)return dt().error({title:this.toastDict.noSerise});var u=c.toDataURL("image/png",1),d=Gf((null===(n=this.querySeriesLoadIds(a))||void 0===n?void 0:n.imgs)||[{}],1)[0],f=d.name,h=d.mod,p=d.age,m=d.studt,g="".concat(f,"_").concat(p,"_").concat(h,"_").concat(m,"_").concat(l||""),v=(0,s.env)(),y=v.isWeChat,b=v.isMobile;if(y&&b)return this.layoutView.createImageLayout(u,g);C(u,g)},e.prototype.disableSeriesTool=function(){var e=(this.queryCurrentContainer()||{}).seriesDom,t=e.dataset.seriesIndex;this.seriesLayoutState.removeSerie(Number(t)),delete e.dataset.seriesId,this.layoutView.clearSeriesLayout(e,!0)},e.prototype.invertTool=function(e){var t=this.queryCurrentContainer().seriesDom,n=t.querySelector(".layoutImage.active");t=n||t;var o=((0,a.getViewport)(t)||{}).invert,r=e.getHandler();e.setHandler((function(e,t,n){r&&r(e,t,n),function(e,t,n){if(n!==t){var o=(0,a.getViewport)(t),r=(0,a.getViewport)(n);r.invert!==o.invert&&(r.invert=o.invert,e.setViewport(n,r))}}(e,t,n)})),(0,a.setViewport)(t,{invert:!o})},e.prototype.referenceLineTool=function(e){var t,n,o;if($(e?"ReferenceLinesOpen":"ReferenceLinesClose"),!e)return(0,Wt.setToolDisabled)("ReferenceLines");var r=new Wt.Synchronizer(a.EVENTS.NEW_IMAGE,Wt.updateImageSynchronizer),i=((null===(o=this.layoutView)||void 0===o?void 0:o.seriesLayout)||{}).seriesLayouts;try{for(var s=Zf(i),l=s.next();!l.done;l=s.next()){var c=l.value,u=c.seriesDom;c.seriesId&&(u.querySelector(".layoutImage")||u.dataset.seriesId&&(hs(u),r.add(u)))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}(0,Wt.setToolEnabled)("ReferenceLines",{synchronizationContext:r}),i.length<this.seriesLayoutState.getStatesLength()&&console.warn(this.toastDict.referenceLinesWarn)},e.prototype.isStudiesLoaded=function(e){void 0===e&&(e=!1);var t=this.reqStudyCount===this.studyUIDArr.length;return e&&!t&&yt("studiesLoading",this.toastDict.studiesLoading),t},e.prototype.magnifyTool=function(){this.layoutView.topTools.magnifyTool()},e.prototype.queryImage=function(){var e=this.queryCurrentContainer(),t=e.seriesDom,n=e.seriesId,o=this.querySeriesLoadIds(n),r=(0,a.getImage)(t),i=Gf(o.imgs,1)[0].mod;return zf(zf({},r),{modality:i})},e.prototype.queryStudy=function(e){return this.studyArr.find((function(t){var n=t.studyuid;return e===n}))},e.prototype.querySeries=function(e){var t,n,o,r;try{for(var a=Zf(this.studyArr),i=a.next();!i.done;i=a.next()){var s=i.value;if(r=null===(o=null==s?void 0:s.arrSeries)||void 0===o?void 0:o.find((function(t){return t.uuid===e})),r)break}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r},e.prototype.querySeriesLoadIds=function(e){return this.seriesLoadIds.find((function(t){return t.seriesUid===e}))},e.prototype.queryCurrentContainer=function(){return this.layoutView.seriesLayout.seriesLayouts.find((function(e){var t=e.seriesDom;return t.classList.contains("active")||t.parentElement.classList.contains("active")}))},e.prototype.queryCurrentSeries=function(e){void 0===e&&(e=this.queryCurrentContainer());var t=e.seriesId,n=e.seriesDom,o=this.querySeriesLoadIds(t);return zf({seriesId:t,seriesDom:n},o)},e.prototype.queryFusionSeriesLoad=function(e){var t=Gf(e,1)[0],n=t.mod,o=t.imgpos,r=e.length;return["CT","PT"].includes(n)?this.seriesLoadIds.filter((function(e){var t=e.imgs,a=Gf(e.imgs,1)[0],i=a.mod,s=a.imgpos;return t.length===r&&i===("CT"==n?"PT":"CT")&&Math.abs(Cf(o)[2]-Cf(s)[2])<=.01})).sort((function(e,t){return e.seriesIndex-t.seriesIndex})):[]},e.prototype.queryModalitySeriesLoad=function(e){return this.seriesLoadIds.filter((function(t){return Gf(t.imgs,1)[0].mod===e})).sort((function(e,t){return e.seriesIndex-t.seriesIndex}))},e.prototype.bindEvents=function(){var e,t,n=this,o=this.eventNamespace,r=(0,s.debounce)((function(){return(0,a.triggerEvent)(a.events,"window_resize")}),50);window.addEventListener("resize",(function(){r()})),window.addEventListener("keydown",(function(e){"Escape"===e.key&&Bf()}));try{for(var i=Zf(["beforeunload","unload","pagehide","visibilitychange"]),l=i.next();!l.done;l=i.next()){var u=l.value;window.addEventListener(u,(function(){var e=q.instanceOptions.closePageResetDefault,t=void 0===e?{}:e,n=t.imageType,o=t.cacheImages,r=q.DBCacheImages;n&&(q.imageType=null),o&&(r.enable=r.enableDefault)}))}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}a.events.addEventNamespaceListener("layout_area_focus.".concat(o),(function(e){var t=e.detail.area;mt("layout_area_focus",(0,s.throttle)((function(){switch(t){case"toolbarLayout":case"seriesLayout":case"seriesMPROr3DLayout":q.toolsBar.navigationBottomLayout||n.layoutView.seriesBarToggle(!1),n.layoutView.selectPopupHidden(),n.layoutView.navigationMenuCloseHandle()}}),500,{trailing:!1}))})),a.events.addEventNamespaceListener("tool_series_layout.".concat(o),(function(e){var t=e.detail.ptCell;n.seriesCount=t,n.restoreSeries(n.seriesLayoutState.getSeries())})),a.events.addEventNamespaceListener("tool_series_image_layout.".concat(o),(function(e){return qf(n,void 0,void 0,(function(){var t,n,o,r,i,l,c,u,d,f,h,p,m,g,v,y,b,x,w;return Wf(this,(function(T){switch(T.label){case 0:return t=e.detail,n=t.ptCell,o=t.ptCell,r=o.x,i=o.y,l=this.queryCurrentContainer(),c=l.seriesDom,(u=l.seriesId)?(d=this.querySeries(u),f=this.querySeriesLoadIds(u),h=r*i==1,Xf(c,0),this.layoutView.clearSeriesLayout(c,!0,!0),h?(p=c.dataset.seriesIndex,m=this.seriesLayoutState.getSynchronizerStatus(Number(p)),c.classList.remove("noActiveBorder"),vs(c),[4,this.displaySeriesByImageindex(c,f)]):[3,2]):[2];case 1:return T.sent(),this.layoutView.seriesLayout.initSingle(c,f,void 0,{synchronizerStatus:m}),[3,3];case 2:c.classList.add("noActiveBorder"),(0,a.triggerEvent)(a.events,"series_synchronizer_remove",{seriesDom:c,setSynchronizerStatus:!1}),this.layoutView.seriesLayout.createImagesLayout(c,d,n),this.displayDcmByImages(c,zf({series:d},f)),g=(0,s.env)(),v=g.isWeChat,y=g.isAndroid,v&&y&&(b=this.seriesCount,x=b.x,w=b.y,r*i+x*w>8&&console.warn(this.toastDict.imageLayoutError)),T.label=3;case 3:return(0,a.triggerEvent)(a.events,"image_active",{$canvas:c}),this.reloadReferenceLineTool(),[2]}}))}))})),a.events.addEventNamespaceListener("study_scroll.".concat(o),(function(e){return qf(n,void 0,void 0,(function(){var t,n,o,r,i,s,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I,E,S,C,A=this;return Wf(this,(function(M){switch(M.label){case 0:for(f in t=e.detail,n=t.currentIndex,o=void 0===n?0:n,r=t.layoutCount,i=void 0===r?1:r,s=this.seriesLayoutState.getStates(),l=this.layoutView.seriesLayout.seriesLayouts,c=o*i,this.studyScrollIndex=o,Bf(),d=[],u=l)d.push(f);h=0,M.label=1;case 1:if(!(h<d.length))return[3,7];if(!((f=d[h])in u))return[3,6];p=f,M.label=2;case 2:return M.trys.push([2,5,,6]),m=Number(p)+c,g=l[p],v=g.seriesDom,y=s[m]||{},b=y.seriesId,x=y.studyUID,w=y.series,T=y.synchronizerStatus,I=y.scrollIndex,E=(w||{}).seriesLoadIds,g.seriesId=b,this.layoutView.clearSeriesLayout(v),hs(v),E?[4,this.displaySeriesByImageindex(v,E)]:[3,4];case 3:M.sent(),M.label=4;case 4:return this.layoutView.seriesLayout.initSingle(v,w,{seriesId:b,studyUID:x,seriesIndex:m},{synchronizerStatus:T,scrollIndex:I}),[3,6];case 5:return S=M.sent(),console.error(S),[3,6];case 6:return h++,[3,1];case 7:return C=(this.selectSeries||{}).seriesId,(0,a.triggerEvent)(a.events,"image_active",{seriesId:C}),this.layoutView.seriesLayout.toggleSeriesStyle({seriesId:C}),setTimeout((function(){A.reloadReferenceLineTool()}),500),o%2==1&&cs(),[2]}}))}))})),a.events.addEventNamespaceListener("series_scroll.".concat(o),(function(e){var t=e.detail,o=t.element,r=t.currentIndex,a=t.isSeriesImage,i=t.imageIds;a&&n.displayDcmByImages(o,{loadIds:i},r),n.seriesLayoutState.setScrollIndex(o.dataset.seriesIndex,r),n.layoutView.iconPlayer.toggleControlStyleLazy(r,null==i?void 0:i.length);var s=n.synchronizer;s.timer&&clearTimeout(s.timer),s.enabled=!1,s.timer=setTimeout((function(){s.enabled=!0}),100)})),a.events.addEventNamespaceListener("tool_imageType.".concat(o),(function(e){return qf(n,void 0,void 0,(function(){var t,n;return Wf(this,(function(o){switch(o.label){case 0:return t=e.detail,n=t.type,t.custom||(q.imageType=n,this.imageType=n),this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.reqStudyCount=0,this.layoutView.seriesLayout.seriesLayouts=[],this.layoutView.imageType(e.detail),gs(),Df(),$("imageTypeToggle",!0),Is([],{forceCancelAll:!0}),document.querySelectorAll(".iziToast").forEach((function(e){dt().hide({},e)})),S(this.layoutView.canvasContainer),S(this.layoutView.studyNavigationBody),S(this.layoutView.studyNavigationHead),this.layoutView.toggleClassName(this.layoutView.querySelectorForTool(".fusion"),void 0,"hidden",-1===n),[4,this.getStudyInfos()];case 1:return o.sent(),this.reloadReferenceLineTool(),[2]}}))}))})),a.events.addEventNamespaceListener("tool_wwwc.".concat(o),(function(e){var t=n.queryCurrentContainer().seriesDom;n.layoutView.wwwcImage(t,e.detail)})),a.events.addEventNamespaceListener("tool_scale.".concat(o),(function(e){var t=n.queryCurrentContainer().seriesDom;n.layoutView.scaleImage(t,e.detail)})),a.events.addEventNamespaceListener("tool_rotate.".concat(o),(function(e){var t=n.queryCurrentContainer().seriesDom;n.layoutView.rotateImage(t,e.detail)})),a.events.addEventNamespaceListener("tool_colorMap.".concat(o),(function(e){var t=n.queryCurrentContainer().seriesDom;n.layoutView.colorMapImage(t,e.detail,n.synchronizer)})),a.events.addEventNamespaceListener("window_resize.".concat(o),(function(){n.layoutView.resizeLayout(),q.env!==c()&&dt().info({title:n.toastDict.deviceTypeChange})}));var d=function(e,t){$("downloadActive"),Is(e,{countCallback:function(o,r,a){n.layoutView.progressCountStyle(t,e.length,a)}})};a.events.addEventNamespaceListener("navigator_dbClick_drag.".concat(o),(function(e){var t=e.detail.iconImage.seriesId,o=n.querySeries(t),r=o.seriesLoadIds,a=o.seriesLoadIds,i=a.loadIds,s=a.studyUID,l=n.queryCurrentContainer(),c=l.seriesDom,u=c.dataset.seriesIndex;n.selectSeries={seriesId:t,studyUID:s,seriesIndex:Number(u)},n.layoutView.seriesLayout.toggleNavigatorInfo(t),d(i,t),n.layoutView.clearSeriesLayout(c),l.seriesId=t,n.seriesLayoutState.setState(Number(u),{studyUID:s,seriesId:t,series:o,scrollIndex:0,synchronizerStatus:!1}),n.layoutView.seriesLayout.initSingle(c,r,n.selectSeries),n.displaySeriesByImageindex(c,r)})),a.events.addEventNamespaceListener("first_active.".concat(o),(function(e){var t,o=e.detail.$canvas;(0,a.triggerEvent)(a.events,"canvas_active",{$canvas:o}),null===(t=n.layoutView.studyMenuLayout)||void 0===t||t.activeFirst()})),a.events.addEventNamespaceListener("navigator_active.".concat(o),(function(e){var t=e.detail,o=t.iconImage.seriesId,r=t.target,i=t.event.isTrusted,s=(n.selectSeries.seriesId,n.querySeriesLoadIds(o)),l=s.loadIds,c=s.studyUID,u=s.seriesIndex,f=n.seriesCount,h=f.x*f.y,p=n.seriesLayoutState.getSeriesActiveIndex(o);if(void 0===p){var m=n.toastDict.noRenderSerise;return dt().error({title:"".concat(m[0]).concat(q.isMobile?m[1]:m[2]).concat(m[3]),timeout:15e3})}n.selectSeries={seriesId:o,studyUID:c,seriesIndex:u},n.layoutView.seriesLayout.toggleNavigatorInfo(o),i?d(l,o):n.layoutView.progressCountStyle(o);var g=Math.floor(p/h),v=g!==n.studyScrollIndex;v?n.layoutView.studySlider.setIndex(g):(n.layoutView.iconPlayer.playerAllPauseAndRemove(),(0,a.triggerEvent)(a.events,"image_active",{seriesId:o}),n.layoutView.seriesLayout.toggleSeriesStyle({seriesId:o}));var y=n.layoutView.canvasContainer.querySelector(".signBigLayout");y&&setTimeout((function(){var e=n.layoutView.canvasContainer.querySelector(".layoutCellsOuter.active");!e||v&&e==y?null==r||r.click():(n.layoutView.seriesLayout.dblclickCanvasLayout(y,y.querySelector(".layoutCellsInner"),!0),n.layoutView.seriesLayout.dblclickCanvasLayout(e,e.querySelector(".layoutCellsInner"),!1))}),0)})),a.events.addEventNamespaceListener("canvas_active.".concat(o),(function(e){var t,o=e.detail,r=o.$canvas,i=o.type,s=r.dataset,l=s.seriesId,c=s.seriesIndex,u=s.studyUID,d=n.selectSeries.seriesId;if((0,a.triggerEvent)(a.events,"image_active",{$canvas:r}),n.selectSeries={seriesId:l,seriesIndex:c,studyUID:u},n.layoutView.seriesLayout.toggleSeriesStyle({target:r}),("wheel"===i||l!==d)&&(n.layoutView.seriesLayout.toggleNavigatorInfo(l),l))try{var f=Gf((null===(t=(0,Wt.getToolState)(r,"stack"))||void 0===t?void 0:t.data)||[{}],1)[0],h=f.imageIds,p=void 0===h?[]:h,m=f.currentImageIdIndex,g=void 0===m?0:m;eh.scroll?(Is(p.slice(g,g+Math.max(eh.scrollNum,1))),n.layoutView.progressCountStyle(l,void 0,void 0,eh.fullLoad)):Is(p,{countCallback:function(e,t,o){n.layoutView.progressCountStyle(l,p.length,o,eh.fullLoad)}})}catch(e){Dl(e)}})),a.events.addEventNamespaceListener("tool_event.".concat(o),(function(e){return qf(n,void 0,void 0,(function(){var t,n,o,r,i,s,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I,E,S,C,A,M,P,D,L,O,R,N,B,U,V,F,j,H,z,W,G,Y,Z,X,K,Q,J,ee,te,ne,oe,re,ae,ie,se,le,ce;return Wf(this,(function(ue){switch(ue.label){case 0:switch(t=e.detail,n=t.toolData,o=void 0===n?{}:n,r=t.btnTarget,i=t.btnOriginTarget,s=!(null==r?void 0:r.classList.contains("active")),l=!0,c=!0,o.btnTarget=r,o.btnOriginTarget=i,Bf(),o.toolTag){case"seriesBar":return[3,1];case"MPR":return[3,2];case"VRT":return[3,3];case"AI":return[3,4];case"fusion":return[3,5];case"imageType":return[3,9];case"reload":return[3,10];case"disableAllTool":return[3,11];case"modulation":return[3,12];case"modulationMenu":return[3,13];case"stackScroll":return[3,14];case"sharpen":return[3,15];case"blur":return[3,16];case"series":return[3,17];case"image":return[3,18];case"pan":return[3,19];case"zoom":return[3,20];case"rotate":return[3,21];case"invert":return[3,22];case"colorMap":return[3,23];case"referenceLine":return[3,24];case"DICOMMetaInfo":return[3,25];case"cavanAroundInfo":return[3,26];case"magnify":return[3,27];case"angle":return[3,28];case"cobbAngle":return[3,29];case"length":return[3,30];case"rectangleRoi":return[3,31];case"ellipticalRoi":return[3,32];case"circleRoi":return[3,33];case"freehandRoi":return[3,34];case"player":return[3,35];case"probeCT":return[3,36];case"annotateArrow":return[3,37];case"annotateText":return[3,38];case"markerL":return[3,39];case"markerR":return[3,40];case"CTR":return[3,41];case"cancelToolAndDefaultViewport":return[3,42];case"cancelToolState":return[3,43];case"eraser":return[3,44];case"saveImage":return[3,45];case"disSeries":return[3,46];case"useCacheImage":return[3,47];case"imageCacheType":return[3,52];case"setLanguage":return[3,53];case"aboutUs":return[3,54]}return[3,55];case 1:return c=!1,this.layoutView.seriesBarToggle(),this.layoutView.navigationMenuCloseHandle(!0),[3,55];case 2:try{if($("MPR"),this.layoutView.seriesBarToggle(!1),u=this.queryCurrentContainer(),N=u.seriesDom,!(R=u.seriesId))throw this.toastDict.noSerise;if(y=this.querySeriesLoadIds(R),d=y.seriesUid,f=y.loadIds,h=y.imgs,p=Gf(y.imgs,1),m=p[0],C=m.mod,g=m.imgpos,!d||!f||!N.dataset.seriesId)throw this.toastDict.noSerise;if(!g)throw this.toastDict.noImagePositionMPR;if(x=q.minRenderCountMPR3D,f.length<x)throw"".concat(this.toastDict.seriesNumLow[0]).concat(q.minRenderCountMPR3D,"，").concat(this.toastDict.seriesNumLow[1]," MPR");v=q.toolsBar.MPRFusion2Visibility?this.queryFusionSeriesLoad(h):[],this.initMPR({modality:C,isFusionMode:!1,seriesLoad:y,matchFusionSeries:v.length?v:void 0})}catch(e){console.error(e),dt().error({title:e})}return[3,55];case 3:return $("VRT"),this.layoutView.seriesBarToggle(!1),this.initVRT(),[3,55];case 4:return this.initAI(s),[3,55];case 5:return ue.trys.push([5,7,,8]),R=this.queryCurrentContainer().seriesId,y=this.querySeriesLoadIds(R),[4,this.layoutView.FusionLayout.createLayout(y)];case 6:if(!(b=ue.sent()))return[2];if(x=q.minRenderCountMPR3D,w=b.PT,T=b.CT,w.loadIds.length<x||T.loadIds.length<x)throw"".concat(this.toastDict.seriesNumLow[0]).concat(q.minRenderCountMPR3D,"，").concat(this.toastDict.seriesNumLow[1]," Fusion");return this.initMPR({isFusionMode:!0,modality:"CT",fusionData:b}),[3,8];case 7:return I=ue.sent(),console.error(I),dt().error({title:I}),[3,8];case 8:return[3,55];case 9:return this.layoutView.createImageTypeLayout(e),[3,55];case 10:return $("reload"),this.reload2d(),[3,55];case 11:return this.layoutView.topTools.disableAllTool(this.synchronizer),[3,55];case 12:this.layoutView.topTools.modulationTool(this.synchronizer),ue.label=13;case 13:try{E=this.queryImage(),S=E.color,C=E.modality,e.detail.isPng=S,e.detail.modality=C,(o.select||"modulationMenu"===o.toolTag)&&this.layoutView.createWWWCLayout(e)}catch(e){(null==e?void 0:e.message.includes("seriesDom"))&&dt().error({title:this.toastDict.noSerise}),console.error(e)}return[3,55];case 14:return this.layoutView.topTools.stackScrollTool(this.synchronizer),[3,55];case 15:return this.layoutView.topTools.sharpenTool(),[3,55];case 16:return this.layoutView.topTools.blurTool(),[3,55];case 17:return this.layoutView.createSeriesCellLayout(e,"series",{x:3,y:3},this.seriesCount),[3,55];case 18:return A=(null===(ie=this.queryCurrentContainer())||void 0===ie?void 0:ie.seriesDom.dataset)||{},M=A.imgRow,P=void 0===M?1:M,D=A.imgColumn,L=void 0===D?1:D,this.layoutView.createSeriesCellLayout(e,"image",q.isMobile?{x:3,y:3}:{x:5,y:5},{x:Number(L),y:Number(P)}),[3,55];case 19:return this.layoutView.topTools.panTool(this.synchronizer),[3,55];case 20:return this.layoutView.topTools.zoomTool(this.synchronizer),o.select&&this.layoutView.createScaleLayout(e),[3,55];case 21:return this.layoutView.topTools.rotateTool(this.synchronizer),o.select&&this.layoutView.createRotateLayout(e),[3,55];case 22:return this.invertTool(this.synchronizer),[3,55];case 23:return this.layoutView.createColorMapLayout(e),[3,55];case 24:return this.referenceLineTool(s),[3,55];case 25:return O=this.queryCurrentContainer(),R=O.seriesId,(N=O.seriesDom).querySelector("canvas")?(B=Gf((null===(se=(0,Wt.getToolState)(N,"stack"))||void 0===se?void 0:se.data)||[{}],1),U=B[0].currentImageIdIndex,V=void 0===U?0:U,F=(null===(le=this.queryCurrentSeries({seriesId:R,seriesDom:N}))||void 0===le?void 0:le.imgs[V])||{},j=this.queryStudy(F.stuuid)||{},H=j.name,z=j.patientid,W=j.age,G=j.studydate,Y=j.studyid,Z=j.orgname,this.layoutView.createDICOMMetaInfoLayout(zf(zf({},F),{name:H,patid:z,age:W,acqdt:G,stuid:Y,inst:Z})),[3,55]):[2,dt().error({title:this.toastDict.noSerise})];case 26:return q.cavanAroundInfo=!q.cavanAroundInfo,this.layoutView.toggleCavanAroundInfoStyle(s),[3,55];case 27:return this.magnifyTool(),[3,55];case 28:return this.layoutView.topTools.angleTools(),[3,55];case 29:return this.layoutView.topTools.cobbAngleTools(),[3,55];case 30:return this.layoutView.topTools.lengthTools(),[3,55];case 31:return this.layoutView.topTools.rectangleRoiTools(),[3,55];case 32:return this.layoutView.topTools.ellipticalRoiTools(),[3,55];case 33:return this.layoutView.topTools.circleRoiTools(),[3,55];case 34:return this.layoutView.topTools.freehandRoiTool(),[3,55];case 35:return X=this.queryCurrentSeries(),K=null===(ce=X.loadIds)||void 0===ce?void 0:ce.length,c=!1,K>=1?(Q=X.seriesDom,J=Q.parentElement,ee=Q.parentElement.querySelector("div.player-bar"),this.layoutView.iconPlayer.playerAllPauseAndRemove(),ee||(this.layoutView.iconPlayer.createPlayer(Q,J,X),K>1&&this.layoutView.iconPlayer.playerStart())):dt().error({title:this.toastDict.noSerise}),[3,55];case 36:return this.layoutView.topTools.probeCTTool(),[3,55];case 37:return this.layoutView.topTools.arrowAnnotateTool(),[3,55];case 38:return this.layoutView.topTools.annotateTool(),[3,55];case 39:return this.layoutView.topTools.LRMarkerTool("L"),[3,55];case 40:return this.layoutView.topTools.LRMarkerTool("R"),[3,55];case 41:return this.layoutView.topTools.heartratioTool(),[3,55];case 42:return this.cancelToolAndDefaultViewport(),[3,55];case 43:return te=(this.queryCurrentContainer()||{}).seriesDom,ne=te.querySelector(".layoutImage.active"),this.layoutView.topTools.cancelTool(te),ne&&this.layoutView.topTools.cancelTool(ne),[3,55];case 44:return this.layoutView.topTools.eraserTools(),[3,55];case 45:return this.saveImageTool(),[3,55];case 46:return this.disableSeriesTool(),[3,55];case 47:return Is([],{forceCancelAll:!0}),s?[3,51]:(oe=this.toastDict.disCacheImage.reconfirm,eh.fullLoad?(oe=this.toastDict.disCacheImage.reconfirmForAllLoad,[4,(de=oe,new Promise((function(e){var t=_("toast.prompt"),n=t.OK,o=t.cancel;dt().question(Hf({class:q.isMobile?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:de,position:"center",icon:"",progressBar:!1,buttons:[["<button class='confirm' >".concat(n,"</button>"),function(t,n,o,r,a){return e("ok")},!1],["<button class='cancel' >".concat(o,"</button>"),function(e,t,n,o){e.hide({},t,"cancel")},!1]],onOpening:function(e,t){io(t)},onClosing:function(t,n,o){"confirm"!==o&&e(null)}},fe))})))]):[3,49]);case 48:return ue.sent()?[3,50]:(l=!1,[3,55]);case 49:setTimeout((function(){dt().info({title:oe,timeout:1e4})}),0),ue.label=50;case 50:(0,a.triggerEvent)(a.events,"tool_imageType",{custom:!0}),ue.label=51;case 51:return $f.enable=s,[3,55];case 52:return s?dt().info({title:this.toastDict.speedPriority,timeout:1e4}):$f.enable||null==(re=this.layoutView.toolsContainer.querySelector(".select-popup-item.useCacheImage"))||re.click(),q.imageCacheTypeDefault=s?1:0,$("imageCacheType"),[3,55];case 53:try{if(!s)return[2];if(ae=o.toolType,!confirm(_("toast.setLanguage",ae)))return[2];k(ae),window.close(),window.history.back()}catch(e){}return[3,55];case 54:return this.layoutView.createAboutUsLayout(q.aboutUs),[3,55];case 55:return l&&this.layoutView.toggleToolStyle(o),c&&this.layoutView.iconPlayer.playerPause(),[2]}var de,fe}))}))})),a.events.addEventNamespaceListener("images_viewport.".concat(o),(function(e){var t=e.detail,n=t.element,o=t.viewport,r=o.voi,a=r.windowWidth,i=r.windowCenter,s=o.scale,l=n.querySelector("#wwWMarker"),c=n.querySelector("#wwHMarker"),u=n.querySelector("#scaleMarker");l&&(l.innerText=x(l.innerText,null==a?void 0:a.toFixed(2),"：")),c&&(c.innerText=x(c.innerText,null==i?void 0:i.toFixed(2),"：")),u&&(u.innerText=x(u.innerText,null==s?void 0:s.toFixed(2),"："))})),a.events.addEventNamespaceListener("iconplayer_series.".concat(o),(function(e){var t=e.detail;n.layoutView.iconPlayer.playerBarClickHandle(t)})),a.events.addEventNamespaceListener("series_synchronizer_add.".concat(o),(function(e){var t=e.detail.element;n.synchronizer.add(t),n.synchronizerStackImageIndex.add(t),n.seriesLayoutState.setSynchronizerStatus(t.dataset.seriesIndex,!0)})),a.events.addEventNamespaceListener("series_synchronizer_remove.".concat(o),(function(e){var t=e.detail,o=t.element,r=t.setSynchronizerStatus,a=void 0===r||r;n.synchronizer.remove(o),n.synchronizerStackImageIndex.remove(o),a&&n.seriesLayoutState.setSynchronizerStatus(o.dataset.seriesIndex,!1)})),a.events.addEventNamespaceListener("".concat(a.EVENTS.IMAGE_CACHE_FULL,".").concat(o),(function(e){console.error("Insufficient image cache",e),$(a.EVENTS.IMAGE_CACHE_FULL,!0)})),a.events.addEventNamespaceListener("".concat(a.EVENTS.WEBGL_TEXTURE_CACHE_FULL,".").concat(o),(function(e){console.error("Insufficient WEBGL cache",e),$(a.EVENTS.WEBGL_TEXTURE_CACHE_FULL,!0)}))},e.prototype.removeEventListener=function(){var e,t,n=this.eventNamespace;window.onresize=void 0;try{for(var o=Zf(["tool_series_layout","tool_series_image_layout","study_scroll","series_scroll","tool_imageType","tool_wwwc","tool_scale","tool_rotate","tool_colorMap","window_resize","navigator_dbClick_drag","first_active","image_active","navigator_active","canvas_active","canvas_active.player","tool_event","tool_event.VRT","layout_area_focus","images_viewport","iconplayer_series","series_synchronizer_add","series_synchronizer_remove"]),r=o.next();!r.done;r=o.next()){var i=r.value;i.indexOf(".")<=0&&(i+=".".concat(n)),a.events.removeEventNamespaceListener(i)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.destroy=function(){var e;if(this.isDestroy)throw new Error(this.toastDict.reDestroy);this.layoutView.iconPlayer.playerAllPauseAndRemove(),Bf(),pt.clear(),Df(),null===(e=n.g.webDicomViewMPR)||void 0===e||e.MPRDestroy(),Vc(),gs(),$("destroy",!0),Is([],{forceCancelAll:!0}),(0,us.configure)({parent:"body"}),this.layoutView.seriesLayout.seriesLayouts=[],this.studyUIDArr=[],this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.seriesLoadIds=[],this.selectSeries={},this.removeEventListener(),S(this.layoutView.canvasContainer),S(this.globalContainer),this.globalContainer.classList.remove("dicomView"),this.synchronizer=void 0,this.synchronizerStackImageIndex=void 0,this.seriesLayoutState=void 0,this.globalContainer=void 0,this.isDestroy=!0},e.i18n={getLanguage:O,translate:_},e}();const oh=nh})(),o=o.default})()));