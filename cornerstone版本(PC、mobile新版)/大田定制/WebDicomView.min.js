!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WebDicomView",[],t):"object"==typeof exports?exports.WebDicomView=t():e.WebDicomView=t()}("undefined"!=typeof self?self:this,(()=>(()=>{var e={1924:(e,t,n)=>{"use strict";var r=n(210),o=n(5559),a=o(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&a(e,".prototype.")>-1?o(n):n}},5559:(e,t,n)=>{"use strict";var r=n(8612),o=n(210),a=o("%Function.prototype.apply%"),i=o("%Function.prototype.call%"),s=o("%Reflect.apply%",!0)||r.call(i,a),l=o("%Object.getOwnPropertyDescriptor%",!0),c=o("%Object.defineProperty%",!0),u=o("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=s(r,i,arguments);if(l&&c){var n=l(t,"length");n.configurable&&c(t,"length",{value:1+u(0,e.length-(arguments.length-1))})}return t};var d=function(){return s(r,a,arguments)};c?c(e.exports,"apply",{value:d}):e.exports.apply=d},6618:e=>{
/*! cornerstone-core - 0.0.0-semantically-released - 2023-03-03 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */
window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var o={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_PROGRESS:"cornerstoneimageloadprogress",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"},a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={},this.namespaces={}}var t,n,o;return t=e,(n=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){0<e.indexOf(".")?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(0<e.indexOf("."))this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],r=0,o=n.length;r<o;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&r(t.prototype,n),o&&r(t,o),e}()),i=[];function s(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<i.length;t++)if(i[t].element===e)return i[t];throw new Error("element not enabled")}function l(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");i.push(e)}function c(e){var t=[];return i.forEach((function(n){n.image&&n.image.imageId===e&&t.push(n)})),t}function u(){return i}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var f={viewport:{}},h=function(e){f.viewport=e||{}};function p(e,t){if(null==e)throw new Error(t)}var m=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return p(e,"getImageSize: parameter image must not be undefined"),p(e.width,"getImageSize: parameter image must have width"),p(e.height,"getImageSize: parameter image must have height"),null!=(t=n)&&0!==t&&180!==t?{height:e.width,width:e.height}:{width:e.width,height:e.height}},v=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;p(e,"getImageScale: parameter windowSize must not be undefined"),p(t,"getImageScale: parameter image must not be undefined");var r=m(t,n),o=t.rowPixelSpacing||1,a=t.columnPixelSpacing||1,i=1,s=1;o<a?s=a/o:i=o/a;var l=e.height/r.height/i,c=e.width/r.width/s;return{verticalScale:l,horizontalScale:c,scaleFactor:Math.min(c,l)}},g=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?(n={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:void 0},Object.assign({},n,f.viewport)):{scale:v(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:void 0};var n},y=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(t&&t.displayedArea)return t.displayedArea;if(void 0===e)throw new Error("getDisplayedArea: parameter image must not be undefined");return{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:void 0===e.rowPixelSpacing?1:e.rowPixelSpacing,columnPixelSpacing:void 0===e.columnPixelSpacing?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}},x=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)},b=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=s(e);x(n,t)};function w(e,t){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}function T(e,t,n){w(t.element,e,{viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n})}function I(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n=e.image,r=t.image;if(n.imageId&&r.imageId){var o=y(r,t.viewport),a=y(n,e.viewport),i=o.columnPixelSpacing*r.width/(a.columnPixelSpacing*n.width),s=t.viewport.scale/e.viewport.scale*i;t.viewport.scale=e.viewport.scale*s}}function S(e,t,n){var r,a="".concat(d()+d(),"-").concat(d(),"-").concat(d(),"-").concat(d(),"-").concat(d()).concat(d()).concat(d()),i=s(e),l=i.layers;t&&(r=g(i.canvas,t),n&&n.viewport&&(r=Object.assign(r,n.viewport))),!1!==i.syncViewports&&(i.syncViewports=!0);var c={image:t,layerId:a,viewport:r,options:n||{},renderingTools:{}};return l.length&&t&&I(l[0],c),l.push(c),T(o.LAYER_ADDED,i,a),1===l.length&&t&&P(e,a),a}function E(e,t){var n=s(e),r=n.layers,a=n.layers.findIndex((function(e){return e.layerId===t}));-1!==a&&(r.splice(a,1),t===n.activeLayerId&&r.length&&P(e,r[0].layerId),T(o.LAYER_REMOVED,n,t))}function C(e,t){return s(e).layers.find((function(e){return e.layerId===t}))}function A(e){return s(e).layers}function M(e){return s(e).layers.filter((function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity}))}function P(e,t){var n=s(e);if(n.activeLayerId!==t){var r=n.layers.findIndex((function(e){return e.layerId===t}));if(-1===r)throw new Error("setActiveLayer: layer not found in layers array");var a=n.layers[r];if(!a.image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=a.image,n.viewport=a.viewport,b(e),T(o.ACTIVE_LAYER_CHANGED,n,t)}}function D(e,t,n){var r,o=s(e),a=o.layers[0];if(!(r=n?C(e,n):k(e)))throw new Error("setLayerImage: Layer not found");if(r.image=t){if(!r.viewport){var i=g(o.canvas,t);r.options&&r.options.viewport&&(r.viewport=Object.assign(i,r.options.viewport)),a.layerId!==n&&I(a,r)}}else r.viewport=void 0}function k(e){var t=s(e);return t.layers.find((function(e){return e.layerId===t.activeLayerId}))}function O(e){var t=s(e);t.layers=[],delete t.activeLayerId,delete t.lastSyncViewportsState}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){if(1<e)throw new Error("HSVToRGB expects hue < 1");var r=[];if(0===t)return r[0]=n,r[1]=n,r[2]=n,r;var o=Math.floor(6*e),a=6*e-o,i=n*(1-t),s=n*(1-t*a),l=n*(1-t*(1-a));switch(o){case 0:case 6:r[0]=n,r[1]=l,r[2]=i;break;case 1:r[0]=s,r[1]=n,r[2]=i;break;case 2:r[0]=i,r[1]=n,r[2]=l;break;case 3:r[0]=i,r[1]=s,r[2]=n;break;case 4:r[0]=l,r[1]=i,r[2]=n;break;case 5:r[0]=n,r[1]=i,r[2]=s}return r}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t,n,r;return t=e,(n=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(1<this.Table.length)||e){this.Table=[];var t,n,r,o,a=this.NumberOfColors-1;a?(t=(this.HueRange[1]-this.HueRange[0])/a,n=(this.SaturationRange[1]-this.SaturationRange[0])/a,r=(this.ValueRange[1]-this.ValueRange[0])/a,o=(this.AlphaRange[1]-this.AlphaRange[0])/a):t=n=r=o=0;for(var i=0;i<=a;i++){var s=this.HueRange[0]+i*t,l=this.SaturationRange[0]+i*n,c=this.ValueRange[0]+i*r,u=this.AlphaRange[0]+i*o,d=R(s,l,c),f=[];switch(this.Ramp){case"scurve":f[0]=Math.floor(127.5*(1+Math.cos((1-d[0])*Math.PI))),f[1]=Math.floor(127.5*(1+Math.cos((1-d[1])*Math.PI))),f[2]=Math.floor(127.5*(1+Math.cos((1-d[2])*Math.PI))),f[3]=Math.floor(255*u);break;case"linear":f[0]=Math.floor(255*d[0]+.5),f[1]=Math.floor(255*d[1]+.5),f[2]=Math.floor(255*d[2]+.5),f[3]=Math.floor(255*u+.5);break;case"sqrt":f[0]=Math.floor(255*Math.sqrt(d[0])+.5),f[1]=Math.floor(255*Math.sqrt(d[1])+.5),f[2]=Math.floor(255*Math.sqrt(d[2])+.5),f[3]=Math.floor(255*Math.sqrt(u)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(f)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+0,n=e+1,r=e+2;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[r]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};if(t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e))return-1;var n,r,o,a=(o=(n=e)<(r=t).Range[0]?r.MaxIndex+0+1.5:n>r.Range[1]?r.MaxIndex+1+1.5:(n+r.Shift)*r.Scale,Math.floor(o));return a===this.NumberOfColors+0?a=0:a===this.NumberOfColors+1&&(a=this.NumberOfColors-1),a}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&L(t.prototype,n),r&&L(t,r),e}(),N=[0,0,0,0],U={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function B(e,t){for(var n=0,r=e.length-1;n<=r;){var o=n+Math.floor((r-n)/2),a=e[o];if(a===t)return o;t<a?r=o-1:n=o+1}return n}function j(e,t,n){var r,o=[],a=[],i=[],s=[];for(n=null===n?1:n,r=0;r<t.length;r++){var l=t[r];o.push((e-1)*l[0]),a.push(l[1]),i.push(l[1])}var c=function(e,t,n){for(var r=(t-e)/((n=null===n?100:n)-1),o=[];0<n--;)o.push(e),e+=r;return o[o.length-1]=t,o}(0,1,e);for(r=0;r<e;r++)c[r]=(e-1)*Math.pow(c[r],n);var u=function(e,t){var n,r=[],o=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<o;n++)r[n]=B(e,t[n]);return r}(o,c);for(r=1;r<e-1;r++){var d=u[r],f=(c[r]-o[d-1])/(o[d]-o[d-1]),h=a[d]-i[d-1];s[r]=f*h+i[d-1]}return s[0]=i[0],s[e-1]=a[t.length-1],s}function F(e,t){var n=U[e];return n||(n=U[e]=t||{name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=function(e,t,n){var r,o=[];n=null===n?1:n;var a=j(t=null===t?256:t,e.red,n),i=j(t,e.green,n),s=j(t,e.blue,n);for(r=0;r<t;r++){var l=[Math.round(255*a[r]),Math.round(255*i[r]),Math.round(255*s[r]),255];o.push(l)}return o}(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(N);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:N},getColorRepeating:function(e){var t=n.colors.length;return e=t?e%t:0,this.getColor(e)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=n.colors.length;e.setNumberOfTableValues(t);for(var r=0;r<t;r++)e.setTableValue(r,n.colors[r])}},createLookupTable:function(){var e=new _;return this.buildLookupTable(e),e},isValidIndex:function(e){return 0<=e&&e<n.colors.length}}}var V={getColormap:F,getColormapsList:function(){var e=[];return Object.keys(U).forEach((function(t){if(U.hasOwnProperty(t)){var n=U[t];e.push({id:t,name:n.name})}})),e.sort((function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return n===r?0:n<r?-1:1})),e},LookupTable:_};function H(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,r,o=e.minPixelValue,a=0,i=0,s=e.width*e.height,l=e.origPixelData||e.getPixelData(),c=new Uint8Array(4*s);if(e.color=!0,e.falseColor=!0,e.origPixelData=l,t instanceof V.LookupTable)for(t.build();i<s;)n=l[i++],r=t.mapValue(n),c[a++]=r[0],c[a++]=r[1],c[a++]=r[2],c[a++]=r[3];else if(o<0)for(;i<s;)n=l[i++],c[a++]=t[n+-o][0],c[a++]=t[n+-o][1],c[a++]=t[n+-o][2],c[a++]=t[n+-o][3];else for(;i<s;)n=l[i++],c[a++]=t[n][0],c[a++]=t[n][1],c[a++]=t[n][2],c[a++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return c}}function z(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function q(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n;(n=t)&&"string"==typeof n&&(n=F(n));var r=(t=n).getId();if(e.colormapId===r)return!1;if(z(e),r){var o=e.minPixelValue||0,a=e.maxPixelValue||255;e.restore=function(e){if(e.restore)return e.restore;var t=e.color,n=e.rgba,r=e.cachedLut,o=e.slope,a=e.windowWidth,i=e.windowCenter,s=e.minPixelValue,l=e.maxPixelValue;return function(){if(e.color=t,e.rgba=n,e.cachedLut=r,e.slope=o,e.windowWidth=a,e.windowCenter=i,e.minPixelValue=s,e.maxPixelValue=l,e.origPixelData){var c=e.origPixelData;e.getPixelData=function(){return c}}e.origPixelData=void 0,e.colormapId=void 0,e.falseColor=void 0}}(e);var i=t.createLookupTable();i.setTableRange(o,a),H(e,i);var s=function(e){for(var t,n=Number.MAX_VALUE,r=Number.MIN_VALUE,o=e.length,a=0;a<o;a++)n=n<(t=e[a])?n:t,r=t<r?r:t;return{minPixelValue:n,maxPixelValue:r}}(e.getPixelData());e.minPixelValue=s.minPixelValue,e.maxPixelValue=s.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=r}return!0}function W(e,t){return q(s(e).image,t)}function G(e,t){var n=s(e);return!1===n.data.hasOwnProperty(t)&&(n.data[t]={}),n.data[t]}function Y(e,t){delete s(e).data[t]}var Z=1073741824,X=0,Q={},K=[];function J(){if(!(X<=Z)){for(K.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));Z<X;){var e=K[K.length-1].imageId;te(e),w(a,o.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=ne();w(a,o.IMAGE_CACHE_FULL,t)}}function $(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===Q.hasOwnProperty(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};Q[e]=n,K.push(n),t.promise.then((function(e){if(-1!==K.indexOf(n)){if(n.loaded=!0,void 0===(n.image=e).sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,X+=n.sizeInBytes;var t={action:"addImage",image:n};w(a,o.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,J()}}),(function(){var t=Q[e];K.splice(K.indexOf(t),1),delete Q[e]}))}function ee(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");var t=Q[e];if(void 0!==t)return t.timeStamp=Date.now(),t.imageLoadObject}function te(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t=Q[e];if(void 0===t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");K.splice(K.indexOf(t),1),X-=t.sizeInBytes;var n,r={action:"deleteImage",image:t};w(a,o.IMAGE_CACHE_CHANGED,r),(n=t.imageLoadObject).promise.then((function(){n.decache&&n.decache()}),(function(){n.decache&&n.decache()})),delete Q[e]}function ne(){return{maximumSizeInBytes:Z,cacheSizeInBytes:X,numberOfImagesCached:K.length}}var re,oe={imageCache:Q,cachedImages:K,setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");Z=e,w(a,o.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),J()},putImageLoadObject:$,getImageLoadObject:ee,removeImageLoadObject:te,getCacheInfo:ne,purgeCache:function(){for(;0<K.length;)te(K[0].imageId)},changeImageIdCacheSize:function(e,t){var n=Q[e];n&&n.imageLoadObject.promise.then((function(e){var r=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,X+=r;var i={action:"changeImageSize",image:e};w(a,o.IMAGE_CACHE_CHANGED,i)}))}},ae={};function ie(e,t){var n=e.indexOf(":"),r=e.substring(0,n),i=ae[r];if(null==i){if(void 0!==re)return re(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}var s=i(e,t);return s.promise.then((function(e){w(a,o.IMAGE_LOADED,{image:e})}),(function(t){var n={imageId:e,error:t};w(a,o.IMAGE_LOAD_FAILED,n)})),s}function se(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=ee(e);return void 0!==n?n.promise:ie(e,t).promise}function le(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=ee(e);return void 0!==n||$(e,n=ie(e,t)),n.promise}function ce(e,t){ae[e]=t}function ue(e){var t=re;return re=e,t}function de(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),pe(this,"requestPool",void 0),pe(this,"awake",void 0),pe(this,"numRequests",void 0),pe(this,"maxNumRequests",void 0),pe(this,"grabDelay",void 0),pe(this,"timeoutHandle",void 0),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.awake=!1,this.grabDelay=5,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"addRequest",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4],a={requestFn:e,type:t,additionalDetails:n};void 0===this.requestPool[t][r]&&(this.requestPool[t][r]=[]),o?this.requestPool[t][r].unshift(a):this.requestPool[t][r].push(a),this.awake||(this.awake=!0,this.startGrabbing())}},{key:"filterRequests",value:function(e){var t=this;Object.keys(this.requestPool).forEach((function(n){var r=t.requestPool[n];Object.keys(r).forEach((function(t){r[t]=r[t].filter((function(t){return e(t)}))}))}))}},{key:"clearRequestStack",value:function(e){if(!this.requestPool[e])throw new Error("No category for the type ".concat(e," found"));this.requestPool[e]={0:[]}}},{key:"sendRequest",value:function(e){var t=this,n=e.requestFn,r=e.type;this.numRequests[r]++,this.awake=!0,n().finally((function(){t.numRequests[r]--,t.startAgain()}))}},{key:"startGrabbing",value:function(){for(var e=this.maxNumRequests.interaction+this.maxNumRequests.thumbnail+this.maxNumRequests.prefetch-(this.numRequests.interaction+this.numRequests.thumbnail+this.numRequests.prefetch),t=0;t<e;t++){var n=this.getNextRequest();if(!1===n)break;n&&this.sendRequest(n)}}},{key:"startAgain",value:function(){var e=this;this.awake&&(this.grabDelay?this.timeoutHandle=window.setTimeout((function(){e.startGrabbing()}),this.grabDelay):this.startGrabbing())}},{key:"getSortedPriorityGroups",value:function(e){var t=this;return Object.keys(this.requestPool[e]).map(Number).filter((function(n){return t.requestPool[e][n].length})).sort()}},{key:"getNextRequest",value:function(){var e,t=this.getSortedPriorityGroups("interaction"),n=de(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(this.requestPool.interaction[r].length&&this.numRequests.interaction<this.maxNumRequests.interaction)return this.requestPool.interaction[r].shift()}}catch(e){n.e(e)}finally{n.f()}var o,a=this.getSortedPriorityGroups("thumbnail"),i=de(a);try{for(i.s();!(o=i.n()).done;){var s=o.value;if(this.requestPool.thumbnail[s].length&&this.numRequests.thumbnail<this.maxNumRequests.thumbnail)return this.requestPool.thumbnail[s].shift()}}catch(e){i.e(e)}finally{i.f()}var l,c=this.getSortedPriorityGroups("prefetch"),u=de(c);try{for(u.s();!(l=u.n()).done;){var d=l.value;if(this.requestPool.prefetch[d].length&&this.numRequests.prefetch<this.maxNumRequests.prefetch)return this.requestPool.prefetch[d].shift()}}catch(e){u.e(e)}finally{u.f()}return t.length||a.length||c.length||(this.awake=!1),!1}},{key:"getRequestPool",value:function(){return this.requestPool}}])&&he(t.prototype,n),r&&he(t,r),e}(),ve=new me;ve.maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3},ve.grabDelay=0;var ge=ve,ye=new me;ye.maxNumRequests={interaction:20,thumbnail:20,prefetch:20},ye.grabDelay=0;var xe=ye;function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var we=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset()}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],o=this.m[1]*e.m[2]+this.m[3]*e.m[3],a=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],i=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=o,this.m[4]=a,this.m[5]=i}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,o=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),i=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=o,this.m[4]=a,this.m[5]=i}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,o=this.m[1]*t+this.m[3]*n,a=this.m[0]*-n+this.m[2]*t,i=this.m[1]*-n+this.m[3]*t;this.m[0]=r,this.m[1]=o,this.m[2]=a,this.m[3]=i}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,r=t;return{x:e=n*this.m[0]+r*this.m[2]+this.m[4],y:t=n*this.m[1]+r*this.m[3]+this.m[5]}}}])&&be(t.prototype,n),r&&be(t,r),e}(),Te=function(e,t){var n=new we;n.translate(e.canvas.width/2,e.canvas.height/2);var r=e.viewport.rotation;0!==r&&n.rotate(r*Math.PI/180);var o=e.viewport.scale,a=e.viewport.scale,i=y(e.image,e.viewport),s=i.tlhc.x-1,l=i.tlhc.y-1,c=i.brhc.x-s,u=i.brhc.y-l;if("NONE"===i.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?o*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(a*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(o=i.columnPixelSpacing,a=i.rowPixelSpacing,"SCALE TO FIT"===i.presentationSizeMode){var d=e.canvas.height/(u*a),f=e.canvas.width/(c*o);o=a=Math.min(f,d),i.rowPixelSpacing<i.columnPixelSpacing?o*=i.columnPixelSpacing/i.rowPixelSpacing:i.columnPixelSpacing<i.rowPixelSpacing&&(a*=i.rowPixelSpacing/i.columnPixelSpacing)}return n.scale(o,a),0!==r&&n.rotate(-r*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==r&&n.rotate(r*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-c/2,-u/2),n.translate(-s,-l),n},Ie=function(e){return Te(e)},Se=function(e,t){var n=s(e),r=Ie(n);return r.invert(),r.transformPoint(t.x,t.y)},Ee=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=u(),n=0;n<t.length;n++)if(t[n].element===e){var r={element:e};w(e,o.ELEMENT_DISABLED,r),w(a,o.ELEMENT_DISABLED,r),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}},Ce=function(){return window.performance?performance.now():Date.now()},Ae=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var r,a=s(e),i=a.image;if(a.image=t,a.layers&&a.layers.length&&D(e,t),void 0===a.viewport&&(a.viewport=g(a.canvas,t)),n)for(var l in n)null!==n[l]&&(a.viewport[l]=n[l]);void 0!==a.lastImageTimeStamp&&(r=(1e3/(Ce()-a.lastImageTimeStamp)).toFixed()),a.lastImageTimeStamp=Ce();var c={viewport:a.viewport,element:a.element,image:a.image,oldImage:i,enabledElement:a,frameRate:r};w(a.element,o.NEW_IMAGE,c),b(e)},Me=function(e){var t=s(e);x(t)},Pe=function(){for(var e=u(),t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&x(n,!0)}},De=function(e){var t=s(e),n=t.image;t.viewport.scale=v(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,b(e)},ke=function(e,t){var n,r,a=s(e),i=a.canvas.width,l=a.canvas.height;n=e,(r=a.canvas).width!==n.clientWidth&&(r.width=n.clientWidth,r.style.width="".concat(n.clientWidth,"px")),r.height!==n.clientHeight&&(r.height=n.clientHeight,r.style.height="".concat(n.clientHeight,"px"));var c,u,d,f,h,p,v,g,y,x,T,I,S,E,C,A,M={element:e};w(e,o.ELEMENT_RESIZED,M),void 0!==a.image&&(t||(y=i,x=l,T=(g=a).viewport.scale,I=m(g.image,g.viewport.rotation),S=Math.round(I.width*T),E=Math.round(I.height*T),C=g.viewport.translation.x,A=g.viewport.translation.y,S===y&&E<=x||S<=y&&E===x&&0===C&&0===A)?De(e):(u=i,d=l,f=(c=a).viewport.scale,h=c.canvas.width/u,p=c.canvas.height/d,v=Math.sqrt(h*p),c.viewport.scale=v*f,b(e)))},Oe=function(e){var t=(e.viewport||{}).invert,n=(e.options||{}).fillStyle;return-1!==["black","white"].indexOf(n)&&t?"white":"black"},Le=function(e,t,n){var r=Ce(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Ce()-r;var a=o.length,i=e.minPixelValue,s=3,l=0;if(r=Ce(),o instanceof Int16Array)if(i<0)for(;l<a;)n[s]=t[o[l++]+-i],s+=4;else for(;l<a;)n[s]=t[o[l++]],s+=4;else if(o instanceof Uint16Array)for(;l<a;)n[s]=t[o[l++]],s+=4;else if(i<0)for(;l<a;)n[s]=t[o[l++]+-i],s+=4;else for(;l<a;)n[s]=t[o[l++]],s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=Ce()-r},Re=function(e,t,n){var r=Ce(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Ce()-r;var a,i=o.length,s=e.minPixelValue,l=0,c=0;if(r=Ce(),o instanceof Int16Array)if(s<0)for(;c<i;)a=t[o[c++]+-s],n[l++]=a,n[l++]=a,n[l++]=a,n[l++]=255;else for(;c<i;)a=t[o[c++]],n[l++]=a,n[l++]=a,n[l++]=a,n[l++]=255;else if(o instanceof Uint16Array)for(;c<i;)a=t[o[c++]],n[l++]=a,n[l++]=a,n[l++]=a,n[l++]=255;else if(s<0)for(;c<i;)a=t[o[c++]+-s],n[l++]=a,n[l++]=a,n[l++]=a,n[l++]=255;else for(;c<i;)a=t[o[c++]],n[l++]=a,n[l++]=a,n[l++]=a,n[l++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=Ce()-r},_e=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");var r=Te(e,n);t.setTransform(r.m[0],r.m[1],r.m[2],r.m[3],r.m[4],r.m[5])},Ne={},Ue={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),r=0,o=0;o<t.length;o++){var a=Math.abs(t[o]);n[r++]=255&a,n[r++]=a>>8,n[r++]=t[o]<0?0:1}return n}};Ne.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}";var Be={},je={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,o=0;o<t.length;o++)n[r++]=t[o],n[r++]=t[o]<0?0:1;return n}};Be.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}";var Fe={},Ve={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,r=0,o=e.width*e.height*4,a=e.width*e.height*3,i=e.getPixelData(),s=new Uint8Array(a);if(t<0)for(;r<o;)s[n++]=i[r++]+-t,s[n++]=i[r++]+-t,s[n++]=i[r++]+-t,r+=1;else for(;r<o;)s[n++]=i[r++],s[n++]=i[r++],s[n++]=i[r++],r+=1;return s}};Fe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}";var He={},ze={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,o=0;o<t.length;o++){var a=t[o];n[r++]=255&a,n[r++]=a>>8}return n}};He.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}";var qe={},We={storedPixelDataToImageData:function(e){return e.getPixelData()}};qe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}";var Ge={int16:Ne,int8:Be,rgb:Fe,uint16:He,uint8:qe},Ye={int16:Ue,int8:je,rgb:Ve,uint16:ze,uint8:We},Ze="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",Xe={},Qe=[],Ke=268435456,Je=0;function $e(){if(!(Je<=Ke)){for(Qe.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));Ke<Je;){var e=Qe[Qe.length-1];Je-=e.sizeInBytes,delete Xe[e.imageId],Qe.pop(),w(a,o.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:Ke,cacheSizeInBytes:Je,numberOfImagesCached:Qe.length};w(a,o.WEBGL_TEXTURE_CACHE_FULL,t)}}var et={purgeCache:function(){for(;0<Qe.length;){var e=Qe.pop();delete Xe[e.imageId]}Je=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");var t=Xe[e];if(void 0!==t)return t.timeStamp=new Date,t.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(Xe,n))throw new Error("putImageTexture: imageId already in cache");var r={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes};if(Xe[n]=r,Qe.push(r),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");Je+=r.sizeInBytes,$e()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=Xe[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return Qe.splice(Qe.indexOf(t),1),Je-=t.sizeInBytes,delete Xe[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");Ke=e,$e()}};function tt(e,t,n){var r=e.createShader(n);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)&&!e.isContextLost()){var o=e.getShaderInfoLog(r);console.error("Could not compile shader:\n".concat(o))}return r}var nt,rt,ot,at=function(e,t,n){return function(e,t,n){var r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS)&&!e.isContextLost()){var o=e.getProgramInfoLog(r);console.error("WebGL program filed to link:\n".concat(o))}return r}(e,tt(e,t,e.VERTEX_SHADER),tt(e,n,e.FRAGMENT_SHADER))},it=document.createElement("canvas"),st=!1;function lt(){!0!==st&&function(e){nt=null;try{var t={desynchronized:!0,preserveDrawingBuffer:!0};nt=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",ct,!1),e.addEventListener("webglcontextlost",ct,!1),e.removeEventListener("webglcontextrestored",ut,!1),e.addEventListener("webglcontextrestored",ut,!1)}catch(e){throw new Error("Error creating WebGL context")}return nt||(console.error("Unable to initialize WebGL. Your browser may not support it."),nt=null),nt}(it)&&(ot=nt.createBuffer(),nt.bindBuffer(nt.ARRAY_BUFFER,ot),nt.bufferData(nt.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),nt.STATIC_DRAW),rt=nt.createBuffer(),nt.bindBuffer(nt.ARRAY_BUFFER,rt),nt.bufferData(nt.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),nt.STATIC_DRAW),function(){for(var e in Ge){var t=Ge[e];t.attributes={},t.uniforms={},t.vert=Ze,t.program=at(nt,t.vert,t.frag),t.attributes.texCoordLocation=nt.getAttribLocation(t.program,"a_texCoord"),nt.enableVertexAttribArray(t.attributes.texCoordLocation),t.attributes.positionLocation=nt.getAttribLocation(t.program,"a_position"),nt.enableVertexAttribArray(t.attributes.positionLocation),t.uniforms.resolutionLocation=nt.getUniformLocation(t.program,"u_resolution")}}(),st=!0)}function ct(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function ut(e){e.preventDefault(),st=!1,et.purgeCache(),lt()}function dt(e){if(e.color)return"rgb";var t=e.getPixelData();return t instanceof Int16Array?"int16":t instanceof Uint16Array?"uint16":t instanceof Int8Array?"int8":"uint8"}function ft(e){var t=et.getImageTexture(e.imageId);return t||(t=function(e){var t={uint8:nt.LUMINANCE,int8:nt.LUMINANCE_ALPHA,uint16:nt.LUMINANCE_ALPHA,int16:nt.RGB,rgb:nt.RGB},n=dt(e),r=t[n],o=nt.createTexture();nt.bindTexture(nt.TEXTURE_2D,o),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MIN_FILTER,nt.NEAREST),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MAG_FILTER,nt.NEAREST),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_WRAP_S,nt.CLAMP_TO_EDGE),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_WRAP_T,nt.CLAMP_TO_EDGE),nt.pixelStorei(nt.UNPACK_ALIGNMENT,1);var a=Ye[n].storedPixelDataToImageData(e,e.width,e.height);return nt.texImage2D(nt.TEXTURE_2D,0,r,e.width,e.height,0,r,nt.UNSIGNED_BYTE,a),{texture:o,sizeInBytes:e.width*e.height*{int8:1,uint16:2,int16:3,rgb:3}[n]}}(e),et.putImageTexture(e,t)),t.texture}function ht(e,t,n,r,o){for(var a in nt.clearColor(1,0,0,1),nt.viewport(0,0,r,o),nt.clear(nt.COLOR_BUFFER_BIT|nt.DEPTH_BUFFER_BIT),nt.useProgram(e.program),nt.bindBuffer(nt.ARRAY_BUFFER,rt),nt.vertexAttribPointer(e.attributes.texCoordLocation,2,nt.FLOAT,!1,0,0),nt.bindBuffer(nt.ARRAY_BUFFER,ot),nt.vertexAttribPointer(e.attributes.positionLocation,2,nt.FLOAT,!1,0,0),t){var i=nt.getUniformLocation(e.program,a);if(i){var s=t[a],l=s.type,c=s.value;"i"===l?nt.uniform1i(i,c):"f"===l?nt.uniform1f(i,c):"2f"===l&&nt.uniform2f(i,c[0],c[1])}}var u,d,f;d=r,f=o,(u=nt).bufferData(u.ARRAY_BUFFER,new Float32Array([d,f,0,f,d,0,0,0]),u.STATIC_DRAW),nt.activeTexture(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_2D,n),nt.drawArrays(nt.TRIANGLE_STRIP,0,4)}var pt={createProgramFromString:at,renderer:{render:function(e){var t=e.image;it.width=t.width,it.height=t.height;var n,r=e.viewport,o=(n=dt(t),Ge.hasOwnProperty(n)?Ge[n]:Ge.rgb),a=ft(t);return ht(o,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:r.voi.windowCenter},ww:{type:"f",value:r.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:r.invert?1:0}},a,t.width,t.height),it},initRenderer:lt,getRenderCanvas:function(){return it},isWebGLAvailable:function(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}},textureCache:et};Object.defineProperty(pt,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return st}});var mt=pt;function vt(e,t){if(!((n=e).voiLUT&&n.voiLUT.lut&&0<n.voiLUT.lut.length||void 0!==n.voi.windowWidth&&void 0!==n.voi.windowCenter)){var n,r=t.maxPixelValue*t.slope+t.intercept,o=t.minPixelValue*t.slope+t.intercept,a=r-o,i=(r+o)/2;void 0===e.voi?e.voi={windowWidth:a,windowCenter:i}:(e.voi.windowWidth=a,e.voi.windowCenter=i)}}var gt=function(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id},yt=function(e,t,n){return n?(o=(r=n).lut[0],a=r.lut[r.lut.length-1],i=r.firstValueMapped+r.lut.length,function(e){return e<r.firstValueMapped?o:i<=e?a:r.lut[e]}):(s=e,l=t,function(e){return e*s+l});var r,o,a,i,s,l};function xt(e){return function(e){if(Array.isArray(e))return bt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wt=function(e,t,n,r){return n?(o=n,a=r,i=Math.max.apply(Math,xt(o.lut)).toString(2).length-8,s=o.lut[0]>>i,l=o.lut[o.lut.length-1]>>i,c=o.firstValueMapped+o.lut.length-1,function(e){return e<o.firstValueMapped?s:c<=e?l:a?o.lut[Math.round(e)-o.firstValueMapped]>>i:o.lut[e-o.firstValueMapped]>>i}):(u=e,d=t,function(e){return 255*((e-d)/u+.5)});var o,a,i,s,l,c,u,d},Tt=function(e,t,n,r,o,a){var i=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0);if(void 0===e.cachedLut){var c=i-l+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(c)}var u=e.cachedLut.lutArray,d=Boolean(e.slope%1)||Boolean(e.intercept%1),f=yt(e.slope,e.intercept,o),h=wt(t,n,a,d);if(!0===r)for(var p=s;p<=i;p++)u[p+-l]=255-h(f(p));else for(var m=s;m<=i;m++)u[m+-l]=h(f(m));return u},It=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&gt(e.cachedLut.modalityLUT,t.modalityLUT)&&gt(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(vt(t,e),Tt(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray},St=function(e,t){var n=e.renderingTools.lastRenderedImageId,r=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!r||r.windowCenter!==e.viewport.voi.windowCenter||r.windowWidth!==e.viewport.voi.windowWidth||r.invert!==e.viewport.invert||r.rotation!==e.viewport.rotation||r.hflip!==e.viewport.hflip||r.vflip!==e.viewport.vflip||r.modalityLUT!==e.viewport.modalityLUT||r.voiLUT!==e.viewport.voiLUT||r.colormap!==e.viewport.colormap},Et=function(e,t){var n=e.renderingTools.renderCanvas;n.width=t.width,n.height=t.height;var r=n.getContext("2d",{desynchronized:!0});r.fillStyle="white",r.fillRect(0,0,n.width,n.height);var o=r.getImageData(0,0,t.width,t.height);e.renderingTools.renderCanvasContext=r,e.renderingTools.renderCanvasData=o},Ct=function(e){var t=e.image.imageId,n=e.viewport,r=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=r,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools};function At(e,t,n){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],o=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&!o||(e.renderingTools.renderCanvas=document.createElement("canvas"),Et(e,t));var a=e.renderingTools.renderCanvas;if(!1===St(e,t)&&!0!==n)return a;a.width===t.width&&a.height===t.height||Et(e,t);var i=Ce(),s=It(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Ce()-i;var l=e.renderingTools.renderCanvasData,c=e.renderingTools.renderCanvasContext;return r?Le(t,s,l.data):Re(t,s,l.data),i=Ce(),c.putImageData(l,0,0),t.stats.lastPutImageDataTime=Ce()-i,a}function Mt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r,o=e.canvas.getContext("2d",{desynchronized:!0});o.setTransform(1,0,0,1,0,0),o.fillStyle=Oe(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,_e(e,o),r=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?mt.renderer.render(e):At(e,n,t);var a=y(e.image,e.viewport),i=a.tlhc.x-1,s=a.tlhc.y-1,l=a.brhc.x-i,c=a.brhc.y-s;o.drawImage(r,i,s,l,c,i,s,l,c),e.renderingTools=Ct(e)}var Pt=function(e,t,n,r,o){var a=e.maxPixelValue,i=e.minPixelValue,s=Math.min(i,0);if(void 0===e.cachedLut){var l=a-s+1;e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(l)}var c=e.cachedLut.lutArray,u=wt(t,n,o);if(!0===r)for(var d=i;d<=a;d++)c[d+-s]=255-u(d);else for(var f=i;f<=a;f++)c[f+-s]=u(f);return c},Dt=function(e,t,n){var r=Ce(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Ce()-r;var a=e.minPixelValue,i=0,s=0,l=o.length;if(r=Ce(),a<0)for(;s<l;)n[i++]=t[o[s++]+-a],n[i++]=t[o[s++]+-a],n[i]=t[o[s]+-a],s+=2,i+=2;else for(;s<l;)n[i++]=t[o[s++]],n[i++]=t[o[s++]],n[i]=t[o[s]],s+=2,i+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=Ce()-r},kt=function(e,t,n){var r=Ce(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Ce()-r;var a=e.minPixelValue,i=0,s=0,l=o.length;if(r=Ce(),a<0)for(;s<l;)n[i++]=t[o[s++]+-a],n[i++]=t[o[s++]+-a],n[i++]=t[o[s++]+-a],n[i++]=o[s++];else for(;s<l;)n[i++]=t[o[s++]],n[i++]=t[o[s++]],n[i++]=t[o[s++]],n[i++]=o[s++];e.stats.lastStoredPixelDataToCanvasImageDataTime=Ce()-r};function Ot(e,t,n){var r=!0===e.renderingTools.lastRenderedIsColor;e.renderingTools.renderCanvas&&r||(e.renderingTools.renderCanvas=document.createElement("canvas"));var o=e.renderingTools.renderCanvas;if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&!1===e.viewport.invert&&t.getCanvas&&t.getCanvas())return t.getCanvas();if(!1===St(e,t)&&!0!==n)return o;o.width===t.width&&o.height===t.height||Et(e,t);var a,i,s=Ce(),l=(a=t,i=e.viewport,void 0!==a.cachedLut&&a.cachedLut.windowCenter===i.voi.windowCenter&&a.cachedLut.windowWidth===i.voi.windowWidth&&a.cachedLut.invert===i.invert||(Pt(a,i.voi.windowWidth,i.voi.windowCenter,i.invert),a.cachedLut.windowWidth=i.voi.windowWidth,a.cachedLut.windowCenter=i.voi.windowCenter,a.cachedLut.invert=i.invert),a.cachedLut.lutArray);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Ce()-s;var c=e.renderingTools.renderCanvasData,u=e.renderingTools.renderCanvasContext;return t.rgba?kt(t,l,c.data):Dt(t,l,c.data),s=Ce(),u.putImageData(c,0,0),t.stats.lastPutImageDataTime=Ce()-s,o}function Lt(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var r,o=e.canvas.getContext("2d",{desynchronized:!0});o.setTransform(1,0,0,1,0,0),o.fillStyle=Oe(e),o.fillRect(0,0,e.canvas.width,e.canvas.height),o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,_e(e,o),r=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?mt.renderer.render(e):Ot(e,n,t);var a=y(e.image,e.viewport),i=a.tlhc.x-1,s=a.tlhc.y-1,l=a.brhc.x-i,c=a.brhc.y-s;o.drawImage(r,i,s,l,c,i,s,l,c),e.renderingTools=Ct(e)}var Rt=function(e,t,n,r){var o=Ce(),a=e.getPixelData();e.stats.lastGetPixelDataTime=Ce()-o;var i,s,l,c=a.length,u=e.minPixelValue,d=0,f=0;if(o=Ce(),l=n instanceof V.LookupTable?n.Table:n,!0===e.color||!0===e.rgba)if(u<0)for(;f<c;)i=t[a[f]+-u],f+=4,s=l[i],r[d++]=s[0],r[d++]=s[1],r[d++]=s[2],r[d++]=s[3];else for(;f<c;)i=t[a[f]],f+=4,s=l[i],r[d++]=s[0],r[d++]=s[1],r[d++]=s[2],r[d++]=s[3];else if(u<0)for(;f<c;)s=l[i=t[a[f++]+-u]],r[d++]=s[0],r[d++]=s[1],r[d++]=s[2],r[d++]=s[3];else for(;f<c;)s=l[i=t[a[f++]]],r[d++]=s[0],r[d++]=s[1],r[d++]=s[2],r[d++]=s[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Ce()-o};function _t(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r=e.renderingTools.renderCanvas,o=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),o&&"string"==typeof o&&(o=V.getColormap(o)),!o)throw new Error("renderPseudoColorImage: colormap not found.");var a=o.getId();if(!1===St(e,t)&&!0!==n&&e.renderingTools.colormapId===a)return r;r.width===t.width&&r.height===t.height||Et(e,t);var i=Ce();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===a||(o.setNumberOfColors(256),e.renderingTools.colorLut=o.createLookupTable(),e.renderingTools.colormapId=a);var s=It(t,e.viewport,n);t.stats=t.stats||{},t.stats.lastLutGenerateTime=Ce()-i;var l=e.renderingTools.colorLut,c=e.renderingTools.renderCanvasData,u=e.renderingTools.renderCanvasContext;return Rt(t,s,l,c.data),i=Ce(),u.putImageData(c,0,0),t.stats.lastPutImageDataTime=Ce()-i,r}function Nt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0});r.setTransform(1,0,0,1,0,0),r.fillStyle=Oe(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,_e(e,r);var o=_t(e,n,t),a=y(e.image,e.viewport),i=a.tlhc.x-1,s=a.tlhc.y-1,l=a.brhc.x-i,c=a.brhc.y-s;r.drawImage(o,i,s,l,c,i,s,l,c),e.renderingTools=Ct(e)}var Ut=function(e,t,n){var r=Ce(),o=e.getPixelData();e.stats.lastGetPixelDataTime=Ce()-r;var a,i,s=o.length,l=e.minPixelValue,c=0,u=0;if(r=Ce(),i=t instanceof V.LookupTable?t.Table:t,l<0)for(;u<s;)a=i[o[u++]+-l],n[c++]=a[0],n[c++]=a[1],n[c++]=a[2],n[c++]=a[3];else for(;u<s;)a=i[o[u++]],n[c++]=a[0],n[c++]=a[1],n[c++]=a[2],n[c++]=a[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Ce()-r};function Bt(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r=e.renderingTools.renderCanvas,o=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),o&&"string"==typeof o&&(o=V.getColormap(o)),!o)throw new Error("renderLabelMapImage: colormap not found.");var a=o.getId();if(!1===St(e,t)&&!0!==n&&e.renderingTools.colormapId===a)return r;r.width===t.width&&r.height===t.height||Et(e,t);var i=Ce();e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===a||(e.renderingTools.colorLut=o.createLookupTable(),e.renderingTools.colormapId=a),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Ce()-i;var s=e.renderingTools.colorLut,l=e.renderingTools.renderCanvasData,c=e.renderingTools.renderCanvasContext;return Ut(t,s,l.data),i=Ce(),c.putImageData(l,0,0),t.stats.lastPutImageDataTime=Ce()-i,r}function jt(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0});r.setTransform(1,0,0,1,0,0),r.fillStyle=Oe(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,_e(e,r);var o=Bt(e,n,t),a=y(e.image,e.viewport),i=a.tlhc.x-1,s=a.tlhc.y-1,l=a.brhc.x-i,c=a.brhc.y-s;r.drawImage(o,i,s,l,c,i,s,l,c),e.renderingTools=Ct(e)}function Ft(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}function Vt(e,t){e.forEach((function(e){if(e!==t&&e.viewport&&t.viewport){e.syncProps||Ft(e);var n,r,o=(r=e,(n=t).syncProps||Ft(n),r.syncProps||Ft(r),r.syncProps.originalScale/n.syncProps.originalScale);e.viewport.scale=t.viewport.scale*o,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/o,y:t.viewport.translation.y/o},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip}}))}function Ht(e,t,n){t.forEach((function(t,r){if(t.image){e.save(),t.canvas=e.canvas,_e(t,e);var o=t.viewport.colormap||t.options.colormap,a=t.viewport.labelmap,i=t.invalid||n;o&&""!==o&&!0===a?function(e,t){if(void 0===e)throw new Error("addLabelMapLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");e.canvas=Bt(e,n,t);var r=e.canvas.getContext("2d",{desynchronized:!0});r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Ct(e)}(t,i):o&&""!==o?function(e,t){if(void 0===e)throw new Error("addPseudoColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");e.canvas=_t(e,n,t);var r=e.canvas.getContext("2d",{desynchronized:!0});r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Ct(e)}(t,i):!0===t.image.color?function(e,t){if(void 0===e)throw new Error("addColorLayer: layer parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("addColorLayer: image must be loaded before it can be drawn");n.rgba=!0,e.canvas=Ot(e,n,t);var r=e.canvas.getContext("2d",{desynchronized:!0});r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=Ct(e)}(t,i):function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var r=e.image;if(void 0===r)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=At(e,r,t,n);var o=e.canvas.getContext("2d",{desynchronized:!0});o.imageSmoothingEnabled=!e.viewport.pixelReplication,o.mozImageSmoothingEnabled=o.imageSmoothingEnabled,e.renderingTools=Ct(e)}(t,i,0===r),t.options&&t.options.opacity?e.globalAlpha=t.options.opacity:e.globalAlpha=1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),e.imageSmoothingEnabled=!t.viewport.pixelReplication,e.mozImageSmoothingEnabled=e.imageSmoothingEnabled;var s=y(t.image,t.viewport),l=s.tlhc.x-1,c=s.tlhc.y-1,u=s.brhc.x-l,d=s.brhc.y-c;e.drawImage(t.canvas,l,c,u,d,l,c,u,d),e.restore(),t.invalid=!1}}))}var zt=function(e,t){var n=e.image,r=e.element,a=e.layers||[];if(e.canvas&&e.image){var i=Ce();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},a&&a.length)!function(e,t){var n=e.element,r=A(n),o=k(n),a=M(n),i=!e.lastSyncViewportsState&&e.syncViewports;e.lastSyncViewportsState=e.syncViewports,i&&r.forEach((function(e){e.viewport&&Ft(e)})),!0===e.syncViewports&&Vt(a,o);var s=e.canvas.getContext("2d",{desynchronized:!0});s.setTransform(1,0,0,1,0,0),s.fillStyle="black",s.fillRect(0,0,e.canvas.width,e.canvas.height),Ht(s,a,t)}(e,t);else if(n){var s=n.render;s||(s=e.viewport.colormap&&""!==e.viewport.colormap&&!0===e.image.labelmap?jt:e.viewport.colormap&&""!==e.viewport.colormap?Nt:n.color?Lt:Mt),s(e,t)}var l=Ce()-i,c={viewport:e.viewport,element:r,image:n,enabledElement:e,canvasContext:e.canvas.getContext("2d",{desynchronized:!0}),renderTimeInMs:l};n.stats.lastRenderTime=l,e.invalid=!1,e.needsRedraw=!1,w(r,o.IMAGE_RENDERED,c)}},qt=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||(t=e,void window.setTimeout(t,1e3/60));var t},Wt=function(e){return mt.renderer.isWebGLAvailable()?(mt.renderer.initRenderer(),e.renderer="webgl",e.desynchronized=!0,e.preserveDrawingBuffer=!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,delete e.preserveDrawingBuffer,!1)},Gt="cornerstone-canvas";function Yt(e){var t,n,r="canvas.".concat(Gt);return e.querySelector(r)||(t=e,(n=document.createElement("canvas")).style.display="block",n.classList.add(Gt),t.appendChild(n),n)}var Zt=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&Wt(t);var n,r={element:e,canvas:Yt(e),image:void 0,invalid:!1,needsRedraw:!0,options:Object.assign({},t),layers:[],data:{},renderingTools:{},uuid:(n=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(n+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})))};l(r),w(a,o.ELEMENT_ENABLED,r),ke(e,!0),function e(t){if(void 0!==r.canvas){var n,a={enabledElement:r,timestamp:t};w(r.element,o.PRE_RENDER,a),r.needsRedraw&&(void 0!==(n=r).image||0<n.layers.length)&&zt(r,r.invalid),qt(e)}}()},Xt=function(e,t){var n=s(e);return g(n.canvas,t)},Qt=function(e){return s(e).image},Kt=function(e,t,n,r,o){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var a=s(e),i=[],l=0,c=a.image.getPixelData(),u=0;u<o;u++)for(var d=0;d<r;d++){var f=(u+n)*a.image.columns+(d+t);i[l++]=c[f]}return i},Jt=function(e,t,n,r,o){var a=Kt(e,t,n,r,o),i=s(e),l=yt(i.image.slope,i.image.intercept,i.viewport.modalityLUT);return a.map(l)},$t=function(e){var t=s(e).viewport;if(void 0!==t)return Object.assign({},t)},en={drawImage:x,generateLut:Tt,getDefaultViewport:g,requestAnimationFrame:qt,setDefaultViewport:h,storedPixelDataToCanvasImageData:Le,storedPixelDataToCanvasImageDataRGBA:Re,storedPixelDataToCanvasImageDataColorLUT:Ut,storedPixelDataToCanvasImageDataPseudocolorLUT:Rt,storedColorPixelDataToCanvasImageData:Dt,getTransform:Ie,calculateTransform:Te,Transform:we},tn=function(e){var t=s(e);t.invalid=!0,t.needsRedraw=!0;var n={element:e};w(e,o.INVALIDATED,n)},nn=function(e){c(e).forEach((function(e){x(e,!0)}))},rn=[],on={addProvider:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;for(t=0;t<rn.length&&!(rn[t].priority<=n);t++);rn.splice(t,0,{priority:n,provider:e})},removeProvider:function(e){for(var t=0;t<rn.length;t++)if(rn[t].provider===e){rn.splice(t,1);break}},get:function(e,t){for(var n=0;n<rn.length;n++){var r=rn[n].provider(e,t);if(void 0!==r)return r}}},an=function(e,t,n){var r=s(e);if(void 0===r.image)throw new Error("image has not been loaded yet");var o=e.getBoundingClientRect(),a={x:t-o.left-window.pageXOffset,y:n-o.top-window.pageYOffset},i=Ie(r);return i.invert(),i.transformPoint(a.x,a.y)},sn=function(e,t){var n=s(e);return Ie(n).transformPoint(t.x,t.y)},ln=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");r&&r.renderer&&"webgl"===r.renderer.toLowerCase()&&Wt(r);var a=g(e,t);n&&Object.assign(a,n);var i,s={element:i=e,canvas:i,image:t,invalid:!0,needsRedraw:!0,options:r,layers:[],data:{},renderingTools:{},viewport:a},l={enabledElement:s,timestamp:Date.now()};w(s.element,o.PRE_RENDER,l),zt(s,s.invalid)};function cn(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderWebImage: image must be loaded before it can be drawn");if(e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert){var r=e.canvas.getContext("2d",{desynchronized:!0});r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,_e(e,r);var o=y(e.image,e.viewport),a=o.tlhc.x-1,i=o.tlhc.y-1,s=o.brhc.x-a,l=o.brhc.y-i;r.drawImage(n.getImage(),a,i,s,l,a,i,s,l)}else Lt(e,t)}var un={colorImage:Lt,grayscaleImage:Mt,webImage:cn,pseudoColorImage:Nt,labelMapImage:jt,toCanvas:ln},dn=function(e){var t=s(e);t.viewport=g(t.canvas,t.image),b(e)},fn=function(e,t){var n=s(e);if(void 0===n.viewport&&(n.viewport=g(n.canvas)),t)for(var r in t)null!==t[r]&&(n.viewport[r]=t[r]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(n.viewport.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(n.viewport.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&b(e)};n.d(t,"drawImage",(function(){return x})),n.d(t,"generateLut",(function(){return Tt})),n.d(t,"getDefaultViewport",(function(){return g})),n.d(t,"setDefaultViewport",(function(){return h})),n.d(t,"requestAnimationFrame",(function(){return qt})),n.d(t,"storedPixelDataToCanvasImageData",(function(){return Le})),n.d(t,"storedColorPixelDataToCanvasImageData",(function(){return Dt})),n.d(t,"storedPixelDataToCanvasImageDataColorLUT",(function(){return Ut})),n.d(t,"storedPixelDataToCanvasImageDataPseudocolorLUT",(function(){return Rt})),n.d(t,"internal",(function(){return en})),n.d(t,"renderLabelMapImage",(function(){return jt})),n.d(t,"renderPseudoColorImage",(function(){return Nt})),n.d(t,"renderColorImage",(function(){return Lt})),n.d(t,"renderGrayscaleImage",(function(){return Mt})),n.d(t,"renderWebImage",(function(){return cn})),n.d(t,"renderToCanvas",(function(){return ln})),n.d(t,"canvasToPixel",(function(){return Se})),n.d(t,"disable",(function(){return Ee})),n.d(t,"displayImage",(function(){return Ae})),n.d(t,"draw",(function(){return Me})),n.d(t,"drawInvalidated",(function(){return Pe})),n.d(t,"enable",(function(){return Zt})),n.d(t,"getElementData",(function(){return G})),n.d(t,"removeElementData",(function(){return Y})),n.d(t,"getEnabledElement",(function(){return s})),n.d(t,"addEnabledElement",(function(){return l})),n.d(t,"getEnabledElementsByImageId",(function(){return c})),n.d(t,"getEnabledElements",(function(){return u})),n.d(t,"addLayer",(function(){return S})),n.d(t,"removeLayer",(function(){return E})),n.d(t,"getLayer",(function(){return C})),n.d(t,"getLayers",(function(){return A})),n.d(t,"getVisibleLayers",(function(){return M})),n.d(t,"setActiveLayer",(function(){return P})),n.d(t,"getActiveLayer",(function(){return k})),n.d(t,"purgeLayers",(function(){return O})),n.d(t,"setLayerImage",(function(){return D})),n.d(t,"fitToWindow",(function(){return De})),n.d(t,"getDefaultViewportForImage",(function(){return Xt})),n.d(t,"getDisplayedArea",(function(){return y})),n.d(t,"getImage",(function(){return Qt})),n.d(t,"getPixels",(function(){return Jt})),n.d(t,"getStoredPixels",(function(){return Kt})),n.d(t,"getViewport",(function(){return $t})),n.d(t,"loadImage",(function(){return se})),n.d(t,"loadAndCacheImage",(function(){return le})),n.d(t,"registerImageLoader",(function(){return ce})),n.d(t,"registerUnknownImageLoader",(function(){return ue})),n.d(t,"invalidate",(function(){return tn})),n.d(t,"invalidateImageId",(function(){return nn})),n.d(t,"pageToPixel",(function(){return an})),n.d(t,"pixelToCanvas",(function(){return sn})),n.d(t,"reset",(function(){return dn})),n.d(t,"resize",(function(){return ke})),n.d(t,"setToPixelCoordinateSystem",(function(){return _e})),n.d(t,"setViewport",(function(){return fn})),n.d(t,"updateImage",(function(){return b})),n.d(t,"pixelDataToFalseColorData",(function(){return H})),n.d(t,"rendering",(function(){return un})),n.d(t,"imageCache",(function(){return oe})),n.d(t,"metaData",(function(){return on})),n.d(t,"webGL",(function(){return mt})),n.d(t,"colors",(function(){return V})),n.d(t,"convertImageToFalseColorImage",(function(){return q})),n.d(t,"convertToFalseColorImage",(function(){return W})),n.d(t,"restoreImage",(function(){return z})),n.d(t,"EVENTS",(function(){return o})),n.d(t,"events",(function(){return a})),n.d(t,"triggerEvent",(function(){return w})),n.d(t,"imageLoadPoolManager",(function(){return ge})),n.d(t,"imageRetrievalPoolManager",(function(){return xe})),n.d(t,"RequestPoolManager",(function(){return me}));var hn={drawImage:x,generateLut:Tt,getDefaultViewport:g,requestAnimationFrame:qt,storedPixelDataToCanvasImageData:Le,storedColorPixelDataToCanvasImageData:Dt,storedPixelDataToCanvasImageDataColorLUT:Ut,storedPixelDataToCanvasImageDataPseudocolorLUT:Rt,internal:en,renderLabelMapImage:jt,renderPseudoColorImage:Nt,renderColorImage:Lt,renderGrayscaleImage:Mt,renderWebImage:cn,renderToCanvas:ln,canvasToPixel:Se,disable:Ee,displayImage:Ae,draw:Me,drawInvalidated:Pe,enable:Zt,getElementData:G,removeElementData:Y,getEnabledElement:s,addEnabledElement:l,getEnabledElementsByImageId:c,getEnabledElements:u,addLayer:S,removeLayer:E,getLayer:C,getLayers:A,getVisibleLayers:M,setActiveLayer:P,getActiveLayer:k,purgeLayers:O,setLayerImage:D,fitToWindow:De,getDefaultViewportForImage:Xt,getDisplayedArea:y,setDefaultViewport:h,getImage:Qt,getPixels:Jt,getStoredPixels:Kt,getViewport:$t,loadImage:se,loadAndCacheImage:le,registerImageLoader:ce,registerUnknownImageLoader:ue,invalidate:tn,invalidateImageId:nn,pageToPixel:an,pixelToCanvas:sn,reset:dn,resize:ke,setToPixelCoordinateSystem:_e,setViewport:fn,updateImage:b,pixelDataToFalseColorData:H,rendering:un,imageCache:oe,metaData:on,webGL:mt,colors:V,convertImageToFalseColorImage:q,convertToFalseColorImage:W,restoreImage:z,EVENTS:o,events:a,triggerEvent:w,imageLoadPoolManager:ge,imageRetrievalPoolManager:xe,RequestPoolManager:me};t.default=hn}])},352:e=>{
/*! cornerstone-math - 0.1.10 - 2022-06-09 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneMath */
window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),a=n(1),i=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0}return r(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*r,this.y=o[1]*t+o[4]*n+o[7]*r,this.z=o[2]*t+o[5]*n+o[8]*r,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12],this.y=o[1]*t+o[5]*n+o[9]*r+o[13],this.z=o[2]*t+o[6]*n+o[10]*r+o[14],this}},{key:"applyProjection",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements,a=1/(o[3]*t+o[7]*n+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*r+o[12])*a,this.y=(o[1]*t+o[5]*n+o[9]*r+o[13])*a,this.z=(o[2]*t+o[6]*n+o[10]*r+o[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.x,a=e.y,i=e.z,s=e.w,l=s*t+a*r-i*n,c=s*n+i*t-o*r,u=s*r+o*n-a*t,d=-o*t-a*n-i*r;return this.x=l*s+d*-o+c*-i-u*-a,this.y=c*s+d*-a+u*-o-l*-i,this.z=u*s+d*-i+l*-a-c*-o,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r,this.y=o[1]*t+o[5]*n+o[9]*r,this.z=o[2]*t+o[6]*n+o[10]*r,this.normalize(),this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this}},{key:"max",value:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this}},{key:"clamp",value:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,o=this.z;return this.x=r*e.z-o*e.y,this.y=o*e.x-n*e.z,this.z=n*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,o=e.z,a=t.x,i=t.y,s=t.z;return this.x=r*s-o*i,this.y=o*a-n*s,this.z=n*i-r*a,this}},{key:"angleTo",value:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos((0,a.clamp)(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"setFromMatrixPosition",value:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();i.prototype.projectOnVector=function(){var e=void 0,t=void 0;return function(n){return void 0===e&&(e=new i),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),i.prototype.projectOnPlane=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),e.copy(this).projectOnVector(t),this.sub(e)}}(),i.prototype.reflect=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),i.prototype.clampScalar=function(){var e=void 0,t=void 0;return function(n,r){return void 0===e&&(e=new i,t=new i),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),i.prototype.applyAxisAngle=function(){var e=void 0;return function(t,n){return void 0===e&&(e=new o.default),this.applyQuaternion(e.setFromAxisAngle(t.normalize(),n)),this}}(),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=1e-4;t.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.degToRad=function(e){return e*(Math.PI/180)},t.approximatelyEquals=function(e,t,n){var o=n||r;return Math.abs(e-t)<=o*Math.max(1,Math.abs(e),Math.abs(t))},t.radToDeg=function(e){return e*(180/Math.PI)},t.sign=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0,this.w=void 0!==o?o:1}return r(e,[{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,r=e.y,o=e.z,a=e.w,i=t.x,s=t.y,l=t.z,c=t.w;return this.x=n*c+a*i+r*l-o*s,this.y=r*c+a*s+o*i-n*l,this.z=o*c+a*l+n*s-r*i,this.w=a*c-n*i-r*s-o*l,this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],o=t[8],a=t[1],i=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+i+u,f=void 0;return d>0?(f=.5/Math.sqrt(d+1),this.w=.25/f,this.x=(c-s)*f,this.y=(o-l)*f,this.z=(a-r)*f):n>i&&n>u?(f=2*Math.sqrt(1+n-i-u),this.w=(c-s)/f,this.x=.25*f,this.y=(r+a)/f,this.z=(o+l)/f):i>u?(f=2*Math.sqrt(1+i-n-u),this.w=(o-l)/f,this.x=(r+a)/f,this.y=.25*f,this.z=(s+c)/f):(f=2*Math.sqrt(1+u-n-i),this.w=(a-r)/f,this.x=(o+l)/f,this.y=(s+c)/f,this.z=.25*f),this}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function o(e){return e*e}function a(e,t){return o(e.x-t.x)+o(e.y-t.y)}var i={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var n=a(e.start,e.end);if(0===n)return a(t,e.start);var r=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/n;return a(t,r<0?e.start:r>1?e.end:{x:e.start.x+r*(e.end.x-e.start.x),y:e.start.y+r*(e.end.y-e.start.y)})}(e,t))},intersectLine:function(e,t){var n,o,a,i,s,l,c,u,d,f,h,p={},m=e.start.x,v=e.start.y,g=e.end.x,y=e.end.y,x=t.start.x,b=t.start.y,w=t.end.x,T=t.end.y,I=void 0;if(f=(n=y-v)*w+(a=m-g)*T+(s=g*v-m*y),(0===(d=n*x+a*b+s)||0===f||(0,r.sign)(d)!==(0,r.sign)(f))&&(u=(o=T-b)*g+(i=x-w)*y+(l=w*b-x*T),0===(c=o*m+i*v+l)||0===u||(0,r.sign)(c)!==(0,r.sign)(u))){h=n*i-o*a,I=a*l-i*s;var S=parseFloat(I/h);I=o*s-n*l;var E=parseFloat(I/h);return p.x=S,p.y=E,p}}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=t.rect=t.quaternion=t.point=t.Plane=t.Matrix4=t.sign=t.radToDeg=t.degToRad=t.clamp=t.lineSegment=t.Line3=void 0;var r=f(n(5)),o=f(n(3)),a=n(1),i=f(n(6)),s=f(n(7)),l=f(n(8)),c=f(n(2)),u=f(n(9)),d=f(n(0));function f(e){return e&&e.__esModule?e:{default:e}}var h={Line3:r.default,lineSegment:o.default,clamp:a.clamp,degToRad:a.degToRad,radToDeg:a.radToDeg,sign:a.sign,Matrix4:i.default,Plane:s.default,point:l.default,quaternion:c.default,rect:u.default,Vector3:d.default};t.Line3=r.default,t.lineSegment=o.default,t.clamp=a.clamp,t.degToRad=a.degToRad,t.radToDeg=a.radToDeg,t.sign=a.sign,t.Matrix4=i.default,t.Plane=s.default,t.point=l.default,t.quaternion=c.default,t.rect=u.default,t.Vector3=d.default,t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=n(1),i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=void 0!==t?t:new o.default,this.end=void 0!==n?n:new o.default}return r(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"center",value:function(e){return(e||new o.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return(e||new o.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){var n=t||new o.default;return this.delta(n).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){var n=new o.default,r=new o.default;n.subVectors(e,this.start),r.subVectors(this.end,this.start);var i=r.dot(r),s=r.dot(n)/i;return t&&(s=(0,a.clamp)(s,0,1)),s}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t),a=n||new o.default;return this.delta(a).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"intersectLine",value:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),r=e.start.clone().sub(this.start),o=t.clone().cross(n),i=r.clone().cross(n),s=r.dot(o)/(r.lengthSq()*o.lengthSq());if((0,a.approximatelyEquals)(s,0)){var l=i.dot(o)/o.lengthSq();if(!(l>1||isNaN(l))){var c=this.start.clone().add(t.clone().multiplyScalar(l));return c.clone().sub(e.start).lengthSq()+c.clone().sub(e.end).lengthSq()<=e.distanceSq()?c:void 0}}}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n,r,o,a,i,s,l,c,u,d,f,h,p,m,v){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Float32Array(16);var g=this.elements;g[0]=void 0!==t?t:1,g[4]=n||0,g[8]=r||0,g[12]=o||0,g[1]=a||0,g[5]=void 0!==i?i:1,g[9]=s||0,g[13]=l||0,g[2]=c||0,g[6]=u||0,g[10]=void 0!==d?d:1,g[14]=f||0,g[3]=h||0,g[7]=p||0,g[11]=m||0,g[15]=void 0!==v?v:1}return r(e,[{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,n=e.x,r=e.y,o=e.z,a=e.w,i=n+n,s=r+r,l=o+o,c=n*i,u=n*s,d=n*l,f=r*s,h=r*l,p=o*l,m=a*i,v=a*s,g=a*l;return t[0]=1-(f+p),t[4]=u-g,t[8]=d+v,t[1]=u+g,t[5]=1-(c+p),t[9]=h-m,t[2]=d-v,t[6]=h+m,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,o=this.elements,a=n[0],i=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],f=n[13],h=n[2],p=n[6],m=n[10],v=n[14],g=n[3],y=n[7],x=n[11],b=n[15],w=r[0],T=r[4],I=r[8],S=r[12],E=r[1],C=r[5],A=r[9],M=r[13],P=r[2],D=r[6],k=r[10],O=r[14],L=r[3],R=r[7],_=r[11],N=r[15];return o[0]=a*w+i*E+s*P+l*L,o[4]=a*T+i*C+s*D+l*R,o[8]=a*I+i*A+s*k+l*_,o[12]=a*S+i*M+s*O+l*N,o[1]=c*w+u*E+d*P+f*L,o[5]=c*T+u*C+d*D+f*R,o[9]=c*I+u*A+d*k+f*_,o[13]=c*S+u*M+d*O+f*N,o[2]=h*w+p*E+m*P+v*L,o[6]=h*T+p*C+m*D+v*R,o[10]=h*I+p*A+m*k+v*_,o[14]=h*S+p*M+m*O+v*N,o[3]=g*w+y*E+x*P+b*L,o[7]=g*T+y*C+x*D+b*R,o[11]=g*I+y*A+x*k+b*_,o[15]=g*S+y*M+x*O+b*N,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"getInverse",value:function(e,t){var n=this.elements,r=e.elements,o=r[0],a=r[4],i=r[8],s=r[12],l=r[1],c=r[5],u=r[9],d=r[13],f=r[2],h=r[6],p=r[10],m=r[14],v=r[3],g=r[7],y=r[11],x=r[15];n[0]=u*m*g-d*p*g+d*h*y-c*m*y-u*h*x+c*p*x,n[4]=s*p*g-i*m*g-s*h*y+a*m*y+i*h*x-a*p*x,n[8]=i*d*g-s*u*g+s*c*y-a*d*y-i*c*x+a*u*x,n[12]=s*u*h-i*d*h-s*c*p+a*d*p+i*c*m-a*u*m,n[1]=d*p*v-u*m*v-d*f*y+l*m*y+u*f*x-l*p*x,n[5]=i*m*v-s*p*v+s*f*y-o*m*y-i*f*x+o*p*x,n[9]=s*u*v-i*d*v-s*l*y+o*d*y+i*l*x-o*u*x,n[13]=i*d*f-s*u*f+s*l*p-o*d*p-i*l*m+o*u*m,n[2]=c*m*v-d*h*v+d*f*g-l*m*g-c*f*x+l*h*x,n[6]=s*h*v-a*m*v-s*f*g+o*m*g+a*f*x-o*h*x,n[10]=a*d*v-s*c*v+s*l*g-o*d*g-a*l*x+o*c*x,n[14]=s*c*f-a*d*f-s*l*h+o*d*h+a*l*m-o*c*m,n[3]=u*h*v-c*p*v-u*f*g+l*p*g+c*f*y-l*h*y,n[7]=a*p*v-i*h*v+i*f*g-o*p*g-a*f*y+o*h*y,n[11]=i*c*v-a*u*v-i*l*g+o*u*g+a*l*y-o*c*y,n[15]=a*u*f-i*c*f+i*l*h-o*u*h-a*l*p+o*c*p;var b=o*n[0]+l*n[4]+f*n[8]+v*n[12];if(0===b){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/b),this}},{key:"applyToVector3Array",value:function(){var e=new o.default;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var o=0,a=n;o<r;o+=3,a+=3)e.x=t[a],e.y=t[a+1],e.z=t[a+2],e.applyMatrix4(this),t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z;return t}}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"set",value:function(e,t,n,r,o,a,i,s,l,c,u,d,f,h,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=o,v[5]=a,v[9]=i,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=d,v[3]=f,v[7]=h,v[11]=p,v[15]=m,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=void 0!==t?t:new o.default(1,0,0),this.constant=void 0!==n?n:0}return r(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return this.orthoPoint(e,t).sub(e).negate()}},{key:"orthoPoint",value:function(e,t){var n=this.distanceToPoint(e);return(t||new o.default).copy(this.normal).multiplyScalar(n)}},{key:"isIntersectionLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectPlane",value:function(e){var t=this.normal.clone().cross(e.normal),n={origin:new o.default,direction:t};if(this.normal.clone().cross(e.normal).length<1e-10)return n.direction=new o.default,n;var r=this.constant,a=e.constant,i=this.normal.clone().dot(e.normal),s=-(r-a*i)/(1-i*i),l=-(a-r*i)/(1-i*i);return n.origin=this.normal.clone().multiplyScalar(s).add(e.normal.clone().multiplyScalar(l)),n}},{key:"coplanarPoint",value:function(e){return(e||new o.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant=this.constant-e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();a.prototype.setFromCoplanarPoints=function(){var e=new o.default,t=new o.default;return function(n,r,o){var a=e.subVectors(o,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),a.prototype.intersectLine=function(){var e=new o.default;return function(t,n){var r=n||new o.default,a=t.delta(e),i=this.normal.dot(a);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?void 0:r.copy(a).multiplyScalar(s).add(t.start)}}(),t.default=a},function(e,t,n){"use strict";function r(e,t){return{x:e.x-t.x,y:e.y-t.y}}function o(e,t){return Math.sqrt(a(e,t))}function a(e,t){var n=r(e,t);return n.x*n.x+n.y*n.y}Object.defineProperty(t,"__esModule",{value:!0});var i={subtract:r,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:o,distanceSquared:a,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)},findClosestPoint:function(e,t){var n=[],r=void 0;return e.forEach((function(e,a){var i=o(e,t);n.push(i),r=0===a?i:Math.min(i,r)})),e[n.indexOf(r)]}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function o(e){return{topLeft:{x:e.left,y:e.top},bottomRight:{x:e.left+e.width,y:e.top+e.height}}}var a={distanceToPoint:function(e,t){var n=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(e).forEach((function(e){var o=r.default.distanceToPoint(e,t);o<n&&(n=o)})),n},getIntersectionRect:function(e,t){var n={topLeft:{},bottomRight:{}};if(function(e,t){var n=void 0,r=void 0,a=o(e),i=o(t);return n=e.width>=0?t.width>=0?!(a.bottomRight.x<=i.topLeft.x||i.bottomRight.x<=a.topLeft.x):!(a.bottomRight.x<=i.bottomRight.x||i.topLeft.x<=a.topLeft.x):t.width>=0?!(a.topLeft.x<=i.topLeft.x||i.bottomRight.x<=a.bottomRight.x):!(a.topLeft.x<=i.bottomRight.x||i.topLeft.x<=a.bottomRight.x),r=e.height>=0?t.height>=0?!(a.bottomRight.y<=i.topLeft.y||i.bottomRight.y<=a.topLeft.y):!(a.bottomRight.y<=i.bottomRight.y||i.topLeft.y<=a.topLeft.y):t.height>=0?!(a.topLeft.y<=i.topLeft.y||i.bottomRight.y<=a.bottomRight.y):!(a.topLeft.y<=i.bottomRight.y||i.top<=a.bottomRight.y),n&&r}(e,t)){var r=o(e),a=o(t);return e.width>=0?t.width>=0?(n.topLeft.x=Math.max(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.bottomRight.x)):(n.topLeft.x=Math.max(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.topLeft.x)):t.width>=0?(n.topLeft.x=Math.min(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.topLeft.x)):(n.topLeft.x=Math.min(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.bottomRight.x)),e.height>=0?t.height>=0?(n.topLeft.y=Math.max(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.bottomRight.y)):(n.topLeft.y=Math.max(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.topLeft.y)):t.height>=0?(n.topLeft.y=Math.min(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.topLeft.y)):(n.topLeft.y=Math.min(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.bottomRight.y)),n}}};t.default=a}])},5720:e=>{
/*! cornerstone-tools - 6.0.9 - 2023-03-27 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=25)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(8),o=n(5);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(14);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var r=n(16),o=n(17),a=n(18);e.exports=function(e){return r(e)||o(e)||a()}},function(e,t,n){var r=n(20),o=n(21),a=n(22);e.exports=function(e,t){return r(e)||o(e,t)||a()}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";(function(e){var r=n(12),o={formatArgs:function(e){if(e[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),"+").concat(a.humanize(this.diff)),this.useColors){var t="color: ".concat(this.color);e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))})),e.splice(r,0,t)}},save:function(e){try{e?o.storage.setItem("debug",e):o.storage.removeItem("debug")}catch(e){}},load:function(){var t;try{t=o.storage.getItem("debug")}catch(e){}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},storage:function(){try{return localStorage}catch(e){}}(),colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"]};o.log=console.debug||console.log||function(){};var a=Object(r.a)(o);a.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: ".concat(e.message)}},t.a=a}).call(this,n(15))},function(e,t,n){e.exports=n(23)},function(e,t,n){"use strict";var r=n(6),o=n.n(r);t.a=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function o(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(o.enabled){var i=o,s=Number(new Date),l=s-(n||s);i.diff=l,i.prev=n,i.curr=s,n=s,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var c=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;c++;var o=r.formatters[n];if("function"==typeof o){var a=t[c];e=o.call(i,a),t.splice(c,1),c--}return e})),r.formatArgs.call(i,t),(i.log||r.log).apply(i,t)}}return o.namespace=e,o.enabled=r.enabled(e),o.useColors=r.useColors(),o.color=t(e),o.destroy=a,o.extend=i,"function"==typeof r.init&&r.init(o),r.instances.push(o),o}function a(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function i(e,t){var n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){var e=[].concat(o()(r.names.map(s)),o()(r.skips.map(s).map((function(e){return"-".concat(e)})))).join(",");return r.enable(""),e},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^".concat(e.substr(1),"$"))):r.names.push(new RegExp("^".concat(e,"$"))));for(t=0;t<r.instances.length;t++){var a=r.instances[t];a.enabled=r.enabled(a.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(19),Object.keys(e).forEach((function(t){r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t){function n(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function s(e){n(i,o,a,s,l,"next",e)}function l(e){n(i,o,a,s,l,"throw",e)}s(void 0)}))}}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){var n,r,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var l,c=[],u=!1,d=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&h())}function h(){if(!u){var e=s(f);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){var n=1e3,r=6e4,o=60*r,a=24*o;function i(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*o;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=a?i(e,t,a,"day"):t>=o?i(e,t,o,"hour"):t>=r?i(e,t,r,"minute"):t>=n?i(e,t,n,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=o?Math.round(e/o)+"h":t>=r?Math.round(e/r)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,a=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(24),o)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag",l="object"==typeof e,c=t.regeneratorRuntime;if(c)l&&(e.exports=c);else{(c=t.regeneratorRuntime=l?e.exports:{}).wrap=m;var u={},d={};d[a]=function(){return this};var f=Object.getPrototypeOf,h=f&&f(f(C([])));h&&h!==n&&r.call(h,a)&&(d=h);var p=x.prototype=g.prototype=Object.create(d);y.prototype=p.constructor=x,x.constructor=y,x[s]=y.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(p),e},c.awrap=function(e){return{__await:e}},b(w.prototype),w.prototype[i]=function(){return this},c.AsyncIterator=w,c.async=function(e,t,n,r){var o=new w(m(e,t,n,r));return c.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(p),p[s]="Generator",p[a]=function(){return this},p.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=C,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}}}function m(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),i=new E(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return A()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var s=T(i,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=v(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,i),a}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function g(){}function y(){}function x(){}function b(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(n,o){function a(){return new Promise((function(t,a){!function t(n,o,a,i){var s=v(e[n],e,o);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,a,i)}),(function(e){t("throw",e,a,i)})):Promise.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return t("throw",e,a,i)}))}i(s.arg)}(n,o,t,a)}))}return t=t?t.then(a,a):a()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=v(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"drawBrushPixels",(function(){return te})),n.d(r,"eraseIfSegmentIndex",(function(){return ee})),n.d(r,"eraseOutsideBoundingBox",(function(){return ne})),n.d(r,"eraseInsideShape",(function(){return se})),n.d(r,"eraseOutsideShape",(function(){return le})),n.d(r,"fillOutsideBoundingBox",(function(){return ce})),n.d(r,"fillInsideShape",(function(){return fe})),n.d(r,"fillOutsideShape",(function(){return he})),n.d(r,"floodFill",(function(){return pe})),n.d(r,"getBoundingBoxAroundCircle",(function(){return xe})),n.d(r,"getBoundingBoxAroundPolygon",(function(){return be})),n.d(r,"getCircle",(function(){return we})),n.d(r,"getPixelPathBetweenPixels",(function(){return Se})),n.d(r,"isSameSegment",(function(){return ae})),n.d(r,"triggerLabelmapModifiedEvent",(function(){return Oe})),n.d(r,"getDiffBetweenPixelData",(function(){return Le}));var o={};n.r(o),n.d(o,"angleCursor",(function(){return bo})),n.d(o,"arrowAnnotateCursor",(function(){return wo})),n.d(o,"bidirectionalCursor",(function(){return To})),n.d(o,"cobbAngleCursor",(function(){return Io})),n.d(o,"circleRoiCursor",(function(){return So})),n.d(o,"ellipticalRoiCursor",(function(){return Eo})),n.d(o,"freehandRoiCursor",(function(){return Co})),n.d(o,"freehandRoiSculptorCursor",(function(){return Ao})),n.d(o,"lengthCursor",(function(){return Mo})),n.d(o,"probeCursor",(function(){return Po})),n.d(o,"rectangleRoiCursor",(function(){return Do})),n.d(o,"textMarkerCursor",(function(){return ko})),n.d(o,"crosshairsCursor",(function(){return Oo})),n.d(o,"eraserCursor",(function(){return Lo})),n.d(o,"magnifyCursor",(function(){return Ro})),n.d(o,"panCursor",(function(){return _o})),n.d(o,"rotateCursor",(function(){return No})),n.d(o,"stackScrollCursor",(function(){return Uo})),n.d(o,"wwwcRegionCursor",(function(){return Bo})),n.d(o,"wwwcCursor",(function(){return jo})),n.d(o,"zoomCursor",(function(){return Fo})),n.d(o,"freehandEraseInsideCursor",(function(){return Yo})),n.d(o,"freehandFillInsideCursor",(function(){return Zo})),n.d(o,"freehandEraseOutsideCursor",(function(){return Xo})),n.d(o,"freehandFillOutsideCursor",(function(){return Qo})),n.d(o,"segRectangleEraseInsideCursor",(function(){return Ko})),n.d(o,"segRectangleFillInsideCursor",(function(){return Jo})),n.d(o,"segRectangleEraseOutsideCursor",(function(){return $o})),n.d(o,"segRectangleFillOutsideCursor",(function(){return ea})),n.d(o,"segCircleEraseInsideCursor",(function(){return ta})),n.d(o,"segCircleFillInsideCursor",(function(){return na})),n.d(o,"segCircleEraseOutsideCursor",(function(){return ra})),n.d(o,"segCircleFillOutsideCursor",(function(){return oa}));var a=n(0),i=n.n(a),s=n(1),l=n.n(s),c=n(2),u=n.n(c),d=n(3),f=n.n(d),h=n(4),p=n.n(h),m=window.cornerstone,v=window.cornerstoneMath,g=window.Hammer,y={set cornerstone(e){m=e},get cornerstone(){return m},set cornerstoneMath(e){v=e},get cornerstoneMath(){return v},set Hammer(e){g=e},get Hammer(){return g}},x=n(8),b=n.n(x),w={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"};function T(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}function I(e){return e instanceof HTMLElement?e:yt.enabledElementByUID(e)}var S={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1},E=S.UINT_16_ARRAY,C=S.FLOAT_32_ARRAY;function A(e,t,n){var r,o=bt("segmentation").configuration;switch(o.arrayType){case E:r=2;break;case C:r=4;break;default:throw new Error("Unsupported Array Type ".concat(o.arrayType))}e.labelmaps3D[t]={buffer:new ArrayBuffer(n*r),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}function M(){var e={};function t(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(r)}function n(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}}function r(t,n,r){e[t][n]=r}function o(t){!1!==e.hasOwnProperty(t)&&delete e[t]}return{get:function(e,t){var r=y.cornerstone.getEnabledElement(e);if(r.image)return n(r.image.imageId,t)},add:function(e,n,r){var o=y.cornerstone.getEnabledElement(e);o.image&&t(o.image.imageId,n,r)},set:function(e,t,n){var o=y.cornerstone.getEnabledElement(e);o.image&&r(o.image.imageId,t,n)},clear:function(e){var t=y.cornerstone.getEnabledElement(e);t.image&&o(t.image.imageId)},getImageIdToolState:n,addImageIdToolState:t,setImageIdToolState:r,clearImageIdToolState:o,saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var P=M();function D(e){var t=y.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=P),t.toolStateManager}function k(e,t,n){var r=D(e);n.uuid=n.uuid||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),r.add(e,t,n),T(e,w.MEASUREMENT_ADDED,{toolName:t,toolType:t,element:e,measurementData:n})}function O(e,t){return D(e).get(e,t)}function L(e,t,n){var r=D(e).get(e,t);if(r&&r.data&&r.data.length){for(var o=-1,a=0;a<r.data.length;a++)r.data[a]===n&&(o=a);-1!==o&&(r.data.splice(o,1),T(e,w.MEASUREMENT_REMOVED,{toolName:t,toolType:t,element:e,measurementData:n}))}}function R(e,t){var n=D(e).get(e,t);void 0!==n&&(n.data=[])}function _(e,t){y.cornerstone.getEnabledElement(e).toolStateManager=t}var N=n(10),U=Object(N.a)("cornerstoneTools"),B=function(e){var t=U.extend(e);return{log:t,warn:t,error:void 0}},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat("cornerstoneTools",":*");return N.a.enable(e)},F=function(){return N.a.disable()},V={series:{},colorLutTables:[]},H=B("store:modules:segmentationModule:metadata");function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"increase",n=bt("segmentation").configuration,r=O(e,"stack").data[0].imageIds[0],o=V.series[r];if(o){var a=o.activeLabelmapIndex,i=o.labelmaps3D[a];switch(t){case"increase":i.activeSegmentIndex++,i.activeSegmentIndex>n.segmentsPerLabelmap&&(i.activeSegmentIndex=1);break;case"decrease":i.activeSegmentIndex--,i.activeSegmentIndex<=0&&(i.activeSegmentIndex=n.segmentsPerLabelmap)}}}var q=B("store:modules:segmentationModule:segmentVisibility"),W=B("store:modules:segmentationModule:getLabelmaps3D");function G(e){var t=I(e);if(t){var n=O(t,"stack");if(n){var r,o,a=n.data[0],i=a.imageIds[0],s=V.series[i];return s&&(r=s.labelmaps3D,o=s.activeLabelmapIndex),{labelmaps3D:r,activeLabelmapIndex:o,currentImageIdIndex:a.currentImageIdIndex}}W.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function Y(e,t){var n=G(e),r=n.labelmaps3D,o=n.activeLabelmapIndex;return r[t=void 0!==t?t:o]}var Z=S.UINT_16_ARRAY,X=S.FLOAT_32_ARRAY;function Q(e,t){var n=I(e);if(n){var r=G(n).labelmaps3D;if(!r)return[];var o,a,i=bt("segmentation").configuration;switch(i.arrayType){case Z:o="Uint16Array",a="2";break;case X:o="Float32Array",a="4";break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}var s=V.colorLutTables;if(void 0!==t){var l=r[t];return l?{labelmapIndex:t,bytesPerVoxel:a,type:o,buffer:l.buffer,colorLUT:s[l.colorLUTIndex]}:void 0}for(var c=[],u=0;u<r.length;u++){var d=r[u];d&&c.push({labelmapIndex:u,bytesPerVoxel:2,buffer:d.buffer,colorLUT:s[d.colorLUTIndex]})}return c}}var K=n(6),J=n.n(K);function $(e){return J()(new Set(e))}function ee(e,t,n){t[e]===n&&(t[e]=0)}function te(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(e,t){return t*r+e};e.forEach((function(e){var r=a.apply(void 0,J()(e));o?ee(r,t,n):t[r]=n}))}function ne(e,t,n,r){for(var o=e.detail,a=t.pixelData,i=t.segmentIndex,s=o.image,l=s.width,c=s.height,u=0;u<l;u++)for(var d=0;d<n[1];d++)ee(d*l+u,a,i);for(var f=0;f<n[0];f++)for(var h=n[1];h<r[1];h++)ee(h*l+f,a,i);for(var p=r[0];p<l;p++)for(var m=n[1];m<r[1];m++)ee(m*l+p,a,i);for(var v=0;v<l;v++)for(var g=r[1];g<c;g++)ee(g*l+v,a,i)}var re=n(7),oe=n.n(re);function ae(e,t,n){return t[e]===n}function ie(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=e.detail.image.width,s=t.pixelData,l=t.segmentIndex,c=oe()(r,2),u=c[0],d=c[1],f=oe()(o,2),h=f[0],p=f[1];"outside"===a&&ne(e,t,r,o);for(var m=u;m<h;m++)for(var v=d;v<p;v++){var g=v*i+m;ae(g,s,l)&&n({x:m,y:v})&&(s[g]=0)}}function se(e,t,n,r,o){ie(e,t,n,r,o,"inside")}function le(e,t,n,r,o){ie(e,t,(function(e){return!n(e)}),r,o,"outside")}function ce(e,t,n,r){for(var o=t.pixelData,a=t.segmentIndex,i=e.detail.image,s=i.width,l=i.height,c=0;c<s;c++)for(var u=0;u<n[1];u++)o[u*s+c]=a;for(var d=0;d<n[0];d++)for(var f=n[1];f<r[1];f++)o[f*s+d]=a;for(var h=r[0];h<s;h++)for(var p=n[1];p<r[1];p++)o[p*s+h]=a;for(var m=0;m<s;m++)for(var v=r[1];v<l;v++)o[v*s+m]=a}B("util:segmentation:operations:eraseOutsideCircle");var ue=B("util:segmentation:operations:helpers:fillShape");function de(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=t.pixelData,s=t.segmentIndex;if(void 0!==i&&void 0!==s){var l=e.detail.image.width,c=oe()(r,2),u=c[0],d=c[1],f=oe()(o,2),h=f[0],p=f[1];"outside"===a&&ce(e,t,r,o);for(var m=u;m<h;m++)for(var v=d;v<p;v++){var g=v*l+m;n({x:m,y:v})&&(i[g]=s)}}else ue.error("fillInsideShape requires operationData to contain pixelData and segmentIndex")}function fe(e,t,n,r,o){de(e,t,n,r,o,"inside")}function he(e,t,n,r,o){de(e,t,(function(e){return!n(e)}),r,o,"outside")}var pe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.onFlood||function(){},o=n.onBoundary||function(){},a=n.equals||me,i=n.diagonals||!1,s=b(t),l=T(),c=[],u=[],d={},f={};for(c.push({currentArgs:t});c.length>0;)h(c.pop());return{flooded:u,boundaries:S()};function h(e){var t=e.currentArgs,n=e.previousArgs;p(t)||(m(t),v(t)?(g(t),x(t)):y(n))}function p(e){return!0===d[e]}function m(e){d[e]=!0}function v(e){var t=w(b,[e]);return w(a,[t,s])}function g(e){u.push(e),r.apply(void 0,J()(e))}function y(e){f[e]=e,o.apply(void 0,J()(e))}function x(e){for(var t=0;t<l.length;t+=1){for(var n=l[t],r=e.slice(0),o=0;o<e.length;o+=1)r[o]+=n[o];c.push({currentArgs:r,previousArgs:e})}}function b(t){return e.apply(void 0,J()(t))}function w(e,t){try{return e.apply(void 0,J()(t))}catch(e){return}}function T(){return I(t.length).filter((function(e){var t=ve(e);return 0!==t&&(1===t||i)}))}function I(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},r=0;r<Math.pow(3,e);r+=1){var o=ge(r.toString(3),"0",e);t.push(n(o))}return t}function S(){var e=[];for(var t in f)f.hasOwnProperty(t)&&e.unshift(f[t]);return e}};function me(e,t){return e===t}function ve(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function ge(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}function ye(e,t){var n=(0,y.cornerstoneMath.point.distance)(e,t);return{left:Math.floor(Math.min(e.x-n,t.x)),top:Math.floor(Math.min(e.y-n,t.y)),width:2*n,height:2*n}}function xe(e){var t=e.detail.handles,n=e.detail.image,r=n.width,o=n.height,a=ye(t.start,t.end),i=a.width+a.left,s=a.left,l=a.top+a.height,c=a.top;return s=Math.floor(s),c=Math.floor(c),i=Math.floor(i),l=Math.floor(l),i=Math.min(r,i),s=Math.max(0,s),l=Math.min(o,l),[[s,c=Math.max(0,c)],[i,l]]}function be(e,t){var n=1/0,r=0,o=1/0,a=0,i=t.width,s=t.height;return e.forEach((function(e){n=Math.min(e[0],n),r=Math.max(e[0],r),o=Math.min(e[1],o),a=Math.max(e[1],a)})),n=Math.floor(n),o=Math.floor(o),r=Math.floor(r),a=Math.floor(a),r=Math.min(i,r),n=Math.max(0,n),a=Math.min(s,a),o=Math.max(0,o),[[n,o],[r,a]]}function we(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Math.floor(r),i=Math.floor(o);if(1===e)return[[a,i]];for(var s=[],l=0,c=-e;c<=e;c++){var u=i+c;if(!(u>t||u<0))for(var d=-e;d<=e;d++){var f=a+d;f>=n||f<0||d*d+c*c<e*e&&(s[l++]=[a+d,i+c])}}return s}var Te=1/Math.sqrt(2),Ie={up:{x:0,y:1},upRight:{x:Te,y:Te},right:{x:1,y:0},downRight:{x:Te,y:-Te},down:{x:0,y:1},downLeft:{x:-Te,y:-Te},left:{x:-1,y:0},upLeft:{x:-Te,y:Te}},Se=function(e,t){for(var n={x:e.x,y:e.y},r=[];t.x!==n.x||t.y!==n.y;)t.x===n.x?t.y>n.y?n.y++:n.y--:t.y===n.y?t.x>n.x?n.x++:n.x--:t.y>n.y?t.x>n.x?Ee(n,t):Ce(n,t):t.x>n.x?Ae(n,t):Me(n,t),r.push({x:n.x,y:n.y});return r.pop(),r};function Ee(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.up),De(n,Ie.right),De(n,Ie.upRight)])){case 0:e.y++;break;case 1:e.x++;break;case 2:e.y++,e.x++}}function Ce(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.up),De(n,Ie.left),De(n,Ie.upLeft)])){case 0:e.y++;break;case 1:e.x--;break;case 2:e.y++,e.x--}}function Ae(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.down),De(n,Ie.right),De(n,Ie.downRight)])){case 0:e.y--;break;case 1:e.x++;break;case 2:e.y--,e.x++}}function Me(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.down),De(n,Ie.left),De(n,Ie.downLeft)])){case 0:e.y--;break;case 1:e.x--;break;case 2:e.y--,e.x--}}function Pe(e,t){var n=y.cornerstoneMath.point.distance(e,t);return{x:(t.x-e.x)/n,y:(t.y-e.y)/n}}function De(e,t){return e.x*t.x+e.y*t.y}function ke(e){var t=e[0]>e[1]?0:1;return e[2]>e[t]&&(t=2),t}function Oe(e,t){var n=bt("segmentation").getters;t=void 0===t?n.activeLabelmapIndex(e):t,y.cornerstone.triggerEvent(e,w.LABELMAP_MODIFIED,{labelmapIndex:t})}function Le(e,t){for(var n=[],r=0;r<e.length;r++)e[r]!==t[r]&&n.push([r,e[r],t[r]]);return n}var Re=S.UINT_16_ARRAY,_e=S.FLOAT_32_ARRAY;function Ne(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=bt("segmentation").configuration,l=V.series[e];l||(V.series[e]={activeLabelmapIndex:n,labelmaps3D:[]},l=V.series[e]),l.labelmaps3D[n]={buffer:t,labelmaps2D:[],metadata:r,activeSegmentIndex:1,colorLUTIndex:i,segmentsHidden:[],undo:[],redo:[]};for(var c=l.labelmaps3D[n].labelmaps2D,u=t.byteLength/o,d=0;d<o;d++){var f=void 0;switch(s.arrayType){case Re:f=new Uint16Array(t,u*d,u/2);break;case _e:f=new Float32Array(t,u*d,u/4);break;default:throw new Error("Unsupported Array Type ".concat(s.arrayType))}var h=a?a[d]:$(f);h&&h.some((function(e){return e}))&&(c[d]={pixelData:f,segmentsOnLabelmap:h})}}var Ue=B("store:modules:segmentationModule:getLabelmapStats");function Be(e,t,n){var r=e.length,o=t[n].imagePositionPatient;if(0===n)return je(o,t[n+1].imagePositionPatient);if(n===r-1)return je(o,t[n-1].imagePositionPatient);var a=t[n-1].imagePositionPatient,i=t[n+1].imagePositionPatient;return(je(o,a)+je(o,i))/2}function je(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}var Fe=S.UINT_16_ARRAY,Ve=S.FLOAT_32_ARRAY;function He(e,t,n,r,o){var a,i=bt("segmentation").configuration,s=r*o,l=s*n;switch(i.arrayType){case Fe:a=new Uint16Array(e.labelmaps3D[t].buffer,2*l,s);break;case Ve:a=new Float32Array(e.labelmaps3D[t].buffer,4*l,s);break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}e.labelmaps3D[t].labelmaps2D[n]={pixelData:a,segmentsOnLabelmap:[]}}var ze=S.UINT_16_ARRAY,qe=S.FLOAT_32_ARRAY,We=B("store:modules:segmentationModule:getLabelmap2D");function Ge(e,t,n){var r=e.x,o=e.y;return r<n&&r>=0&&o<t&&o>=0}var Ye=B("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent"),Ze=B("store:modules:segmentationModule:setColorLUT");function Xe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=bt("segmentation").configuration.segmentsPerLabelmap;t?(Ke(t,n),t.length<n&&(t=[].concat(J()(t),J()(Je(n-t.length))))):t=t||Je(n),t.unshift([0,0,0,0]),V.colorLutTables[e]=t}function Qe(e){return"number"==typeof e?V.colorLutTables[e]:V.colorLutTables[e.colorLUTIndex]}function Ke(e,t){e.length<t?Ze.warn("The provided colorLUT only provides ".concat(e.length," labels, whereas segmentsPerLabelmap is set to ").concat(t,". Autogenerating the rest.")):e.length>t&&Ze.warn("segmentsPerLabelmap is set to ".concat(t,", and the provided colorLUT provides ").concat(e.length,". Using the first ").concat(t," colors from the LUT."))}function Je(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,t=[],n=0;n<e;n++)t.push(rt(et(),nt()));return t}var $e=222.5;function et(){return($e+=137.5)>=360&&($e-=360),$e}var tt=.6;function nt(){return(tt+=.07)>.82&&(tt=tt-.82+.3),tt}function rt(e){var t,n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=(1-Math.abs(2*a-1))*o,l=s*(1-Math.abs(e/60%2-1)),c=a-s/2;return e<60?(t=s,n=l,r=0):e<120?(t=l,n=s,r=0):e<180?(t=0,n=s,r=l):e<240?(t=0,n=l,r=s):e<300?(t=l,n=0,r=s):e<360&&(t=s,n=0,r=l),[255*(t+c),255*(n+c),255*(r+c),i]}var ot=B("store:modules:segmentationModule:getBrushColor"),at={renderOutline:!0,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:S.UINT_16_ARRAY},it=B("util:segmentation:labelmap3DHistory");function st(e,t,n){var r=e.labelmaps2D;t.forEach((function(e){for(var t=e.imageIdIndex,o=e.diff,a=r[t].pixelData,i=0;i<o.length;i++){var s=o[i];a[s[0]]=s[n]}}))}var lt={state:V,configuration:at,onRegisterCallback:function(){Xe(0)},getters:{metadata:function(e,t,n){var r=I(e);if(r){var o=O(r,"stack").data[0].imageIds[0],a=V.series[o];if(a){if(t=void 0===t?a.activeLabelmapIndex:t,a.labelmaps3D[t]){var i=a.labelmaps3D[t];return void 0===n?i.metadata:i.metadata[n]}H.warn("No labelmap3D of labelmap index ".concat(t," on stack."))}else H.warn("brushStackState is undefined")}},labelmap3D:Y,labelmaps3D:G,activeLabelmapIndex:function(e){var t=I(e);if(t){var n=O(t,"stack").data[0].imageIds[0],r=V.series[n];if(r)return r.activeLabelmapIndex}},activeSegmentIndex:function(e,t){var n=I(e);if(n){var r=O(n,"stack").data[0].imageIds[0],o=V.series[r];if(o){t=void 0===t?o.activeLabelmapIndex:t;var a=o.labelmaps3D[t];if(a)return a.activeSegmentIndex}return 1}},isSegmentVisible:function(e,t,n){if(t){var r=I(e);if(r){var o=O(r,"stack").data[0].imageIds[0],a=V.series[o];if(a){if(n=void 0===n?a.activeLabelmapIndex:n,a.labelmaps3D[n])return!a.labelmaps3D[n].segmentsHidden[t];q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},labelmap2D:function(e){var t=I(e);if(t){var n=y.cornerstone,r=O(t,"stack");if(r){var o,a=r.data[0],i=n.getEnabledElement(t),s=a.currentImageIdIndex,l=i.image,c=l.rows,u=l.columns,d=a.imageIds.length,f=a.imageIds[0],h=V.series[f];h?(o=h.activeLabelmapIndex,h.labelmaps3D[o]||A(h,o,c*u*d),h.labelmaps3D[o].labelmaps2D[s]||He(h,o,s,c,u)):(o=0,V.series[f]={activeLabelmapIndex:o,labelmaps3D:[]},A(h=V.series[f],o,c*u*d),He(h,o,s,c,u));var p=h.labelmaps3D[o];return{labelmap2D:p.labelmaps2D[s],labelmap3D:p,currentImageIdIndex:s,activeLabelmapIndex:o}}We.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmap2DByImageIdIndex:function(e,t,n,r){if(!e.labelmaps2D[t]){var o,a=bt("segmentation").configuration,i=n*r,s=i*t;switch(a.arrayType){case ze:o=new Uint16Array(e.buffer,2*s,i);break;case qe:o=new Float32Array(e.buffer,4*s,i);break;default:throw new Error("Unsupported Array Type ".concat(a.arrayType))}e.labelmaps2D[t]={pixelData:o,segmentsOnLabelmap:$(o)}}return e.labelmaps2D[t]},labelmapStats:function(e,t,n){var r=y.cornerstone,o=I(e);if(!o)return null;var a=O(o,"stack").data[0].imageIds,i=a[0];return new Promise((function(e){var o=V.series[i];o||e(null);var s=function(e){for(var t=[],n=y.cornerstone.metaData,r=!0,o=0;o<e.length;o++){var a=n.get("imagePlaneModule",e[o]);if(!a){r=!1;break}t.push(a)}return{sufficientMetadata:r,imagePlanes:t}}(a),l=s.sufficientMetadata,c=s.imagePlanes;l||(Ue.warn("Insufficient imagePlaneModule information to calculate volume statistics."),e(null)),n=void 0===n?o.activeLabelmapIndex:n;for(var u=o.labelmaps3D[n],d=[],f=0;f<a.length;f++)d.push(r.loadAndCacheImage(a[f]));Promise.all(d).then((function(n){var r=function(e,t,n,r){for(var o=function(e,t,n,r){for(var o=t[0],a=o.rowPixelSpacing,i=o.columnPixelSpacing,s=e.labelmaps2D,l=[],c=0;c<s.length;c++){var u=s[c];if(u&&u.segmentsOnLabelmap.includes(r)){for(var d=Be(t,n,c)*a*i,f=u.pixelData,h=t[c].getPixelData(),p=[],m=0;m<f.length;m++)f[m]===r&&p.push(h[m]);l.push({voxelInMM3:d,values:p})}}return l}(e,t,n,r),a=0,i=o[0].values[0],s=i,l=0,c=0;c<o.length;c++){var u=o[c],d=u.values,f=u.voxelInMM3;l+=f*d.length;var h=0;d.forEach((function(e){e>i?i=e:e<s&&(s=e),h+=e})),a+=h*f}a/=l;for(var p=0,m=0;m<o.length;m++){var v=o[m],g=(d=v.values,f=v.voxelInMM3,0);d.forEach((function(e){g+=Math.pow(e-a,2)})),p+=g*f}return p/=l,p=Math.sqrt(p),{volume:l,mean:a,stdDev:p,max:i,min:s}}(u,n,c,t);e(r)}))}))},segmentOfActiveLabelmapAtEvent:function(e){var t=e.detail,n=t.element,r=t.image,o=t.currentPoints;if(o){var a=r.width,i=r.height;if(n){var s=O(n,"stack").data[0],l=s.currentImageIdIndex,c=s.imageIds[0],u=V.series[c],d=u.activeLabelmapIndex,f=u.labelmaps3D[d];if(f){var h=f.labelmaps2D[l];if(h){var p=h.pixelData,m=o.image,v=m.x,g=m.y;if(Ge({x:v=Math.floor(v),y:g=Math.floor(g)},i,a)){var y=p[g*a+v];if(0===y)return;return{segmentIndex:y,metadata:f.metadata[y]}}}}}}else Ye.warn("Not a cornerstone input event.")},brushColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=I(e);if(n){var r=O(n,"stack");if(r){var o,a=r.data[0].imageIds[0],i=V.series[a];if(i){var s=i.activeLabelmapIndex,l=i.labelmaps3D[s],c=l.activeSegmentIndex;o=V.colorLutTables[l.colorLUTIndex][c]}else o=V.colorLutTables[0][1];return t?"rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1.0 )"):"rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.8 )")}ot.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmapBuffers:Q,activeLabelmapBuffer:function(e){var t=I(e);if(t){var n=O(t,"stack").data[0].imageIds[0],r=V.series[n];if(r)return Q(t,r.activeLabelmapIndex)}},colorLUT:Qe,colorForSegmentIndexColorLUT:function(e,t){return Qe(e)[t]}},setters:{metadata:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=I(e);if(o){var a=y.cornerstone,i=O(o,"stack").data[0],s=i.imageIds[0],l=V.series[s];if(l||(V.series[s]={labelmapIndex:t,labelmaps3D:[]},l=V.series[s]),!l.labelmaps3D[t]){var c=a.getEnabledElement(o).image;A(l,t,c.rows*c.columns*i.imageIds.length)}l.labelmaps3D[t].metadata[n]=r}},labelmap3DForElement:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=I(e);if(i){var s=O(i,"stack"),l=s.data[0].imageIds.length;Ne(s.data[0].imageIds[0],t,n,r,l,o,a),Oe(i,n)}},labelmap3DByFirstImageId:Ne,incrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"increase")},decrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"decrease")},activeSegmentIndex:function(e,t){var n=I(e);if(n){var r=O(n,"stack").data[0].imageIds[0],o=V.series[r];if(o){var a=o.activeLabelmapIndex,i=o.labelmaps3D[a],s=bt("segmentation").configuration;t<=0?t=1:t>s.segmentsPerLabelmap&&(t=s.segmentsPerLabelmap),i.activeSegmentIndex=t}}},toggleSegmentVisibility:function(e,t,n){if(t){var r=I(e);if(r){var o=O(r,"stack").data[0].imageIds[0],a=V.series[o];if(a){if(n=void 0===n?a.activeLabelmapIndex:n,a.labelmaps3D[n]){var i=a.labelmaps3D[n].segmentsHidden;return i[t]=!i[t],!i[t]}q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},updateSegmentsOnLabelmap2D:function(e){e.segmentsOnLabelmap=$(e.pixelData)},deleteSegment:function(e,t,n){if(t){var r=I(e);if(r){var o=O(r,"stack").data[0].imageIds[0],a=V.series[o];if(a){n=void 0===n?a.activeLabelmapIndex:n;var i=a.labelmaps3D[n];if(i){delete i.metadata[t];for(var s=i.labelmaps2D,l=0;l<s.length;l++){var c=s[l];if(c&&c.segmentsOnLabelmap.includes(t)){var u=c.pixelData,d=c.segmentsOnLabelmap.indexOf(t);c.segmentsOnLabelmap.splice(d,1);for(var f=0;f<u.length;f++)u[f]===t&&(u[f]=0)}}y.cornerstone.updateImage(r)}}}}},colorLUT:Xe,colorLUTIndexForLabelmap3D:function(e,t){e.colorLUTIndex=t},colorForSegmentIndexOfColorLUT:function(e,t,n){Qe(e)[t]=n},activeLabelmapIndex:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=I(e);if(n){var r=y.cornerstone,o=O(n,"stack").data[0],a=r.getEnabledElement(n).image,i=a.rows*a.columns*o.imageIds.length,s=o.imageIds[0],l=V.series[s];l?(l.activeLabelmapIndex=t,l.labelmaps3D[t]||A(l,t,i)):(V.series[s]={activeLabelmapIndex:t,labelmaps3D:[]},A(l=V.series[s],t,i)),r.updateImage(n)}},radius:function(e){var t=bt("segmentation").configuration;t.radius=Math.min(Math.max(e,t.minRadius),t.maxRadius)},pushState:function(e,t,n){var r=Y(e,n);r.undo.push(t),r.redo=[]},undo:function(e,t){var n=Y(e,t),r=n.undo,o=n.redo;if(r.length){var a=r.pop();st(n,a,1),o.push(a),y.cornerstone.updateImage(e)}else it.warn("No undos left.")},redo:function(e,t){var n=Y(e,t),r=n.undo,o=n.redo;if(o.length){var a=o.pop();st(n,a,2),r.push(a),y.cornerstone.updateImage(e)}else it.warn("No redos left.")}}},ct={activeManipulators:{}};function ut(e){var t=y.cornerstone.getEnabledElement(e).uuid;delete ct.activeManipulators[t]}function dt(e){var t=ct.activeManipulators,n=t[e];"function"==typeof n&&n(),delete t[e]}function ft(e){ut(e.detail.element)}var ht={setters:{addActiveManipulatorForElement:function(e,t){var n=y.cornerstone.getEnabledElement(e).uuid;ct.activeManipulators[n]=t},removeActiveManipulatorForElement:ut,cancelActiveManipulatorsForElement:function(e){dt(y.cornerstone.getEnabledElement(e).uuid)},cancelActiveManipulators:function(){var e=ct.activeManipulators;Object.keys(e).forEach((function(e){return dt(e)}))}},state:ct,enabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ft),e.addEventListener(t,ft)},removeEnabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ft),ut(e)}},pt={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  '},mt={configuration:pt,getters:{defaultOptions:function(){return pt}},setters:{defaultOptions:function(e){Object.assign(pt,e)}}},vt={configuration:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]}},gt=(B("store:modules:storeLogger"),{globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,preventTextBoxOutsideDisplayedArea:!1,handleTouchOffset:{x:0,y:-57},svgCursorUrl:null}),yt={mouseTools:function(){return gt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Mouse")}))},touchTools:function(){return gt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Touch")}))},enabledElementByUID:function(e){return gt.enabledElements.find((function(t){return y.cornerstone.getEnabledElement(t).uuid===e}))}},xt={segmentation:lt,cursor:mt,globalConfiguration:vt,manipulatorState:ht};function bt(e){return xt[e]}var wt={modules:xt,state:gt,getters:yt},Tt=function(e,t){return gt.tools.find((function(n){return n.element===e&&n.name===t}))},It=xt.globalConfiguration;function St(e,t){if(It.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),r=t.mousePoint,o=window.URL.createObjectURL(n);e.style.cursor="url('".concat(o,"') ").concat(r,", auto"),gt.svgCursorUrl=o}}function Et(e){It.configuration.showSVGCursors&&Ct(e,"none")}function Ct(e,t){gt.svgCursorUrl&&window.URL.revokeObjectURL(gt.svgCursorUrl),gt.svgCursorUrl=null,e.style.cursor=t}var At=bt("globalConfiguration"),Mt=B("store:setToolMode"),Pt=function(e,t,n,r){void 0===r&&Array.isArray(n)&&(r=n,n=null);var o=Tt(e,t);o&&(function(e,t,n,r){t.supportedInteractionTypes.forEach((function(o){if(void 0===r||r.includes(o)){var a=Vt[o];a?a(t,e,n):Mt.warn("Unable to resolve input conflicts for type %s",o)}})),wt.state.tools.filter((function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0})).forEach((function(t){var n=!1;t.supportedInteractionTypes.forEach((function(e){t.options["is".concat(e,"Active")]&&(n=!0)})),n||(Mt.log("Setting tool %s's to PASSIVE",t.name),_t(e,t.name))}))}(e,o,n,r),o.supportedInteractionTypes.forEach((function(e){void 0===r||r.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),At.configuration.showSVGCursors&&o.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){("number"==typeof t?[t]:t.mouseButtonMask).includes(1)&&(n.svgCursor?St(n.element,n.svgCursor):n.hideDefaultCursor?Et(e):function(e){Ct(e,"initial")}(e))}(e,n,o)),Ut("active",null,e,t,n)},Dt=function(e,t,n){Ft("active",e,t,n),wt.state.enabledElements.forEach((function(r){Pt(r,e,t,n)}))},kt=Ut.bind(null,"disabled",null),Ot=Bt.bind(null,"disabled",null),Lt=Ut.bind(null,"enabled",null),Rt=Bt.bind(null,"enabled",null),_t=Ut.bind(null,"passive",w.TOOL_DEACTIVATED),Nt=Bt.bind(null,"passive",w.TOOL_DEACTIVATED);function Ut(e,t,n,r,o){var a,i,s=Tt(n,r);s?(o=Ht(o),Array.isArray(o.mouseButtonMask)&&0!==o.mouseButtonMask.length&&Array.isArray(s.options.mouseButtonMask)&&(o.mouseButtonMask=(a=o.mouseButtonMask,i=s.options.mouseButtonMask,a.concat(i).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]))),s.mode=e,s.mergeOptions(o),s["".concat(e,"Callback")]&&s["".concat(e,"Callback")](n,o),t&&T(n,t,{options:o,toolName:r,toolType:r,type:t})):Mt.warn('Unable to find tool "%s" for enabledElement',r)}function Bt(e,t,n,r){Ft(e,n,r),wt.state.enabledElements.forEach((function(o){Ut(e,t,o,n,r)}))}function jt(e,t,n){var r="is".concat(e,"Active"),o=wt.state.tools.find((function(e){return e.element===n&&"active"===e.mode&&!0===e.options[r]}));o&&(Mt.log("Setting tool %s's %s to false",o.name,r),o.options[r]=!1)}function Ft(e,t,n,r){if(At.configuration.globalToolSyncEnabled){var o={mode:e,args:[t,n]};r&&o.push(r),wt.state.globalToolChangeHistory.push(o),wt.state.globalToolChangeHistory.length>50&&wt.state.globalToolChangeHistory.shift();var a=wt.state.globalTools[t];if(a)if("active"===e){var i=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var r=[],o=wt.state.globalTools[e];if(o){var a=new o.tool(o.props);a.supportedInteractionTypes.forEach((function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var o=Ht(t).mouseButtonMask;Array.isArray(o)&&o.length>0?o.forEach((function(t){return r.push("".concat(e,"-").concat(t))})):Array.isArray(o)&&0===o.length&&r.push("".concat(e,"-DELETE"))}else"MultiTouch"===e?r.push("".concat(e,"-").concat(a.configuration.touchPointers)):r.push(e)}))}return r}(t,n,r);Object.keys(wt.state.globalTools).forEach((function(e){var t=wt.state.globalTools[e];t.activeBindings=t.activeBindings.filter((function(e){return!i.includes(e)}))})),i.some((function(e){return e.includes("Mouse-DELETE")}))&&(a.activeBindings=a.activeBindings.filter((function(e){return!e.includes("Mouse")})),i=i.filter((function(e){return!e.includes("Mouse")}))),a.activeBindings=a.activeBindings.concat(i)}else a.activeBindings=[];else Mt.warn("setToolMode call for tool not available globally: ".concat(t))}}var Vt={Mouse:function(e,t,n){var r=Ht(n).mouseButtonMask;if(Array.isArray(r)&&r.length>0){var o=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some((function(e){return r.includes(e)}))}));o&&(o.options.mouseButtonMask=o.options.mouseButtonMask.filter((function(e){return!r.includes(e)})),0===o.options.mouseButtonMask.length&&(o.options.isMouseActive=!1))}},MouseWheel:jt.bind(void 0,"MouseWheel"),Touch:function(e,t){var n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),r=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers}));n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1),r&&(Mt.log("Setting tool %s's isTouchActive to false",r.name),r.options.isMultiTouchActive=!1)},TouchPinch:jt.bind(void 0,"TouchPinch"),TouchRotate:jt.bind(void 0,"TouchRotate"),DoubleTap:jt.bind(void 0,"DoubleTap"),MultiTouch:function(e,t){var n,r=wt.state.tools.find((function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers}));1===e.configuration.touchPointers&&(n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}))),r&&(Mt.log("Setting tool %s's isMultiTouchActive to false",r.name),r.options.isMultiTouchActive=!1),n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1)}};function Ht(e){return Array.isArray(e)?e={mouseButtonMask:e}:e!==Object(e)&&(e={mouseButtonMask:[e]}),e.hasOwnProperty("mouseButtonMask")||(e.mouseButtonMask=[]),Array.isArray(e.mouseButtonMask)||(e.mouseButtonMask=[e.mouseButtonMask]),e.mouseButtonMask=e.mouseButtonMask.filter((function(e){return"number"==typeof e&&0!==e})),e}var zt={passiveCallback:function(e){kt(e,this.name)},enabledCallback:function(e){Pt(e,this.name)}},qt={passiveCallback:function(e){kt(e,this.name)},activeCallback:function(e){Lt(e,this.name)}},Wt=function(e,t){e.save(),t(e),e.restore()},Gt=1,Yt=2,Zt={setToolWidth:function(e){Gt=e},getToolWidth:function(){return Gt},setActiveWidth:function(e){Yt=e},getActiveWidth:function(){return Yt}},Xt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.color,o=t.lineWidth,a=t.fillStyle,i=t.lineDash,s=t.shouldDrawLines,l=void 0===s||s;e.beginPath(),e.strokeStyle=r||e.strokeStyle,e.lineWidth=o||void 0===o&&Zt.getToolWidth()||e.lineWidth,i&&e.setLineDash(i),n(e),a&&(e.fillStyle=a,e.fill()),l&&e.stroke(),i&&e.setLineDash([])};function Qt(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Xt(e,o,(function(e){"pixel"===a&&(n=y.cornerstone.pixelToCanvas(t,n),r=y.cornerstone.pixelToCanvas(t,r)),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y)}))}var Kt=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Xt(e,o,(function(e){"pixel"===a&&(n=y.cornerstone.pixelToCanvas(t,n),r=r.map((function(e){return y.cornerstone.pixelToCanvas(t,e)}))),e.moveTo(n.x,n.y),r.forEach((function(t){var n=t.x,r=t.y;e.lineTo(n,r)}))}))},Jt=function(e,t,n,r,o,a){var i=Math.atan2(n.y-t.y,n.x-t.x),s={color:r,lineWidth:o};a&&(s.lineDash=a),Qt(e,void 0,t,n,s,"canvas"),s={color:r,lineWidth:o,fillStyle:r};var l=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];Kt(e,void 0,n,l,s,"canvas")},$t=function(e,t,n,r,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n)),Xt(e,o,(function(e){e.arc(n.x,n.y,r,0,2*Math.PI)}))};function en(e){var t=y.cornerstoneMath;if(e instanceof t.Vector3)return e;var n=Object.keys(e);return n.includes("x")&&n.includes("y")&&n.includes("z")?new t.Vector3(e.x,e.y,e.z):new t.Vector3(e[0],e[1],e[2])}function tn(e,t){var n=en(t.rowCosines),r=en(t.columnCosines),o=en(t.imagePositionPatient),a=e.clone().sub(o);return{x:n.dot(a)/t.columnPixelSpacing,y:r.dot(a)/t.rowPixelSpacing}}function nn(e,t){var n=en(t.rowCosines),r=en(t.columnCosines),o=en(t.imagePositionPatient),a=n.clone().multiplyScalar(e.x);a.multiplyScalar(t.columnPixelSpacing);var i=r.clone().multiplyScalar(e.y);i.multiplyScalar(t.rowPixelSpacing);var s=a.add(i);return s.add(o),s}function rn(e,t){var n=en(e.rowCosines),r=en(e.columnCosines),o=en(e.imagePositionPatient),a=en(t.rowCosines),i=en(t.columnCosines),s=en(t.imagePositionPatient),l=n.clone().cross(r),c=new y.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,o);var u=a.clone().cross(i),d=new y.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var f=d.clone().intersectPlane(c),h=f.origin,p=f.direction,m=nn({x:t.columns,y:t.rows},t),v=s.distanceTo(m),g=new y.cornerstoneMath.Line3;g.start=h,g.end=h.clone().add(p.multiplyScalar(v));var x=function(e,t){var n=[];return Object.keys(t).forEach((function(r){var o=t[r],a=e.intersectLine(o);a&&n.push(a)})),n}(g,function(e){var t=nn({x:0,y:0},e),n=nn({x:e.columns,y:0},e),r=nn({x:0,y:e.rows},e),o=nn({x:e.columns,y:e.rows},e);return{top:new y.cornerstoneMath.Line3(t,n),left:new y.cornerstoneMath.Line3(t,r),right:new y.cornerstoneMath.Line3(n,o),bottom:new y.cornerstoneMath.Line3(r,o)}}(t));if(2===x.length)return{start:x[0],end:x[1]}}function on(e,t,n){var r=n*(Math.PI/180);return{x:Math.cos(r)*(e.x-t.x)-Math.sin(r)*(e.y-t.y)+t.x,y:Math.sin(r)*(e.x-t.x)+Math.cos(r)*(e.y-t.y)+t.y}}var an=function(e,t,n,r,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n),r=y.cornerstone.pixelToCanvas(t,r));var i=y.cornerstone.getViewport(t),s=t.clientWidth,l=t.clientHeight,c=i.scale,u=i.translation,d=i.rotation-a,f={x:s/2+u.x*c,y:l/2+u.y*c};Math.abs(d)>.05&&(n=on(n,f,-d),r=on(r,f,-d));var h=Math.abs(n.x-r.x),p=Math.abs(n.y-r.y),m=Math.min(n.x,r.x),v=Math.min(n.y,r.y),g={x:m+h/2,y:v+p/2};Math.abs(d)>.05&&(g=on(g,f,d));var x=d*Math.PI/180;Xt(e,o,(function(e){e.ellipse(g.x,g.y,h/2,p/2,x,0,2*Math.PI),e.closePath()}))},sn="white",ln="greenyellow",cn="transparent",un={setFillColor:function(e){cn=e},getFillColor:function(){return cn},setToolColor:function(e){sn=e},getToolColor:function(){return sn},setActiveColor:function(e){ln=e},getActiveColor:function(){return ln},getColorIfActive:function(e){return e.color?e.color:e.active?ln:sn}},dn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=t.element,a=un.getToolColor();e.strokeStyle=r.color||a;for(var i=Object.keys(n),s=function(t){var a=i[t],s=n[a];if(!0===s.drawnIndependently)return"continue";if(!0===r.drawHandlesIfActive&&!s.active)return"continue";if(r.hideHandlesIfMoving&&s.moving)return"continue";var l={lineWidth:s.active?Zt.getActiveWidth():Zt.getToolWidth(),fillStyle:r.fill};r.lineDash&&(l.lineDash=r.lineDash),Xt(e,l,(function(e){var t=y.cornerstone.pixelToCanvas(o,s),n=s.radius||r.handleRadius||gt.handleRadius;e.arc(t.x,t.y,n,0,2*Math.PI)}))},l=0;l<i.length;l++)s(l)},fn=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";Xt(e,r,(function(e){n.forEach((function(n){var r=n.start,a=n.end;if("pixel"===o){var i=y.cornerstone;r=i.pixelToCanvas(t,r),a=i.pixelToCanvas(t,a)}e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}))}))},hn=function(e,t,n,r,o,a){var i=e.length>0?y.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Qt(r,void 0,i,y.cornerstoneMath.point.findClosestPoint(s,i),{color:o,lineWidth:a,lineDash:[2,3]},"canvas")},pn={fontSize:15,fontFamily:"Arial",backgroundColor:"transparent"};function mn(e){if("string"!=typeof e)throw new Error("Font family must be a valid string");pn.fontFamily=e}function vn(e){if("number"!=typeof e||isNaN(e)||!isFinite(e))throw new Error("Font size must be a valid number");pn.fontSize=parseFloat(e)}var gn={setFont:function(e){var t=e.split("px ");2===t.length&&(vn(parseFloat(t[0])),mn(t[1]))},getFont:function(){return"".concat(pn.fontSize,"px ").concat(pn.fontFamily)},setFontSize:vn,getFontSize:function(){return pn.fontSize},setFontFamily:mn,getFontFamily:function(){return pn.fontFamily},setBackgroundColor:function(e){pn.backgroundColor=e},getBackgroundColor:function(){return pn.backgroundColor}},yn=function(e,t,n,r,o){var a=gn.getFontSize();e.font=gn.getFont(),e.textBaseline="top",e.fillStyle=r,n.forEach((function(n,r){e.fillText(n,t.left+o,t.top+o+r*(a+o))}))},xn=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)};function bn(e,t,n){var r=gn.getFont(),o=e.font;r&&r!==o&&(e.font=r);var a=e.measureText(t).width;return r&&r!==o&&(e.font=o),a+2*n}var wn=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=5,s=gn.getFontSize(),l=gn.getBackgroundColor(),c=0;t.forEach((function(t){var n=bn(e,t,i);c=Math.max(c,n)}));var u={width:c,height:i+t.length*(s+i)};return Wt(e,(function(e){e.strokeStyle=o,a.centering&&(!0===a.centering.x&&(n-=u.width/2),!0===a.centering.y&&(r-=u.height/2)),u.left=n,u.top=r,"function"==typeof a.displacer&&a.displacer(u),xn(e,u,l),yn(e,u,t,o,i)})),u};function Tn(e,t,n){return Math.min(Math.max(t,e),n)}function In(e,t){var n=t.left||0,r=t.top||0;e.x=Tn(e.x,n,n+t.width),e.y=Tn(e.y,r,r+t.height)}var Sn=function(e,t,n,r,o,a){a-o<r-n?(e[t]+=o-n,e[t]+=(a-o)/2,e[t]-=(r-n)/2):n<o?e[t]+=o-n:r>a&&(e[t]-=r-a)};function En(e,t){var n=y.cornerstone,r=n.pixelToCanvas,o=n.canvasToPixel,a=n.getViewport,i=n.getEnabledElement,s=n.getDisplayedArea,l=o(e,{x:t.left,y:t.top}),c=function(e,t){var n=function(t){return y.cornerstone.canvasToPixel(e,t)},r=t.top,o=t.left,a=t.width,i=t.height,s=[n({x:o,y:r}),n({x:o+a,y:r}),n({x:o,y:r+i}),n({x:o+a,y:r+i})],l=s.map((function(e){return e.x})),c=s.map((function(e){return e.y}));return{minX:Math.min.apply(Math,J()(l)),minY:Math.min.apply(Math,J()(c)),maxX:Math.max.apply(Math,J()(l)),maxY:Math.max.apply(Math,J()(c))}}(e,t),u=c.minX,d=c.minY,f=c.maxX,h=c.maxY,p=a(e),m=s(i(e).image,p),v=p.displayedArea?p.displayedArea:m,g=v.tlhc,x=v.brhc,b=g.y-1,w=g.x-1,T=x.y,I=x.x;Sn(l,"y",d,h,b,T),Sn(l,"x",u,f,w,I);var S=r(e,l);t.top=S.y,t.left=S.x}var Cn=Tn,An=function(e,t,n,r,o,a,i,s,l,c){var u=y.cornerstone.pixelToCanvas,d=u(t,n);l&&(d.x+=l);var f={centering:{x:!1,y:c}};if(gt.preventTextBoxOutsideDisplayedArea&&(f.displacer=function(e){return En(t,e)}),n.boundingBox=wn(e,r,d.x,d.y,i,f),n.hasMoved){var h=a(o).map((function(e){return u(t,e)}));hn(h,d,n.boundingBox,e,i,s)}},Mn=function(e,t,n,r,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=y.cornerstone;n=i.pixelToCanvas(t,n),r=i.pixelToCanvas(t,r)}var s=y.cornerstone.getViewport(t),l=t.clientWidth,c=t.clientHeight,u=s.scale,d=s.translation,f=s.rotation-a,h={x:l/2+d.x*u,y:c/2+d.y*u};Math.abs(f)>.05&&(n=on(n,h,-f),r=on(r,h,-f));var p=Math.abs(n.x-r.x),m=Math.abs(n.y-r.y);n={x:Math.min(n.x,r.x),y:Math.min(n.y,r.y)},r={x:n.x+p,y:n.y+m};var v={x:n.x+p,y:n.y},g={x:n.x,y:n.y+m};Math.abs(f)>.05&&(n=on(n,h,f),r=on(r,h,f),v=on(v,h,f),g=on(g,h,f)),Xt(e,o,(function(e){e.moveTo(n.x,n.y),e.lineTo(v.x,v.y),e.lineTo(r.x,r.y),e.lineTo(g.x,g.y),e.lineTo(n.x,n.y)}))},Pn=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},Dn=function(e,t){return void 0===e?t:e},kn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Dn(t.shadowColor,"#000000"),e.shadowBlur=Dn(t.shadowBlur,0),e.shadowOffsetX=Dn(t.shadowOffsetX,1),e.shadowOffsetY=Dn(t.shadowOffsetY,1))},On=function(e){return 0===Object.keys(e).length&&e.constructor===Object},Ln=bt("segmentation"),Rn=Ln.getters,_n=Ln.setters;function Nn(){this.handles={start:{},end:{}}}function Un(e){var t=e.detail.element,n=e.detail.currentPoints.image;return On(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function Bn(e){var t=e.detail,n=t.element,r=t.currentPoints.image;this.handles.end=r,y.cornerstone.updateImage(n)}function jn(e){e.detail.handles=this.handles;var t=e.detail.element,n=Rn.labelmap2D(t),r=n.labelmap2D,o=n.labelmap3D,a=n.currentImageIdIndex,i=r.pixelData,s=i.slice(),l={points:{start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},pixelData:i,segmentIndex:o.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:a,diff:Le(s,i)};_n.pushState(this.element,[c]),_n.updateSegmentsOnLabelmap2D(r),y.cornerstone.updateImage(t),this._resetHandles()}var Fn={postTouchStartCallback:Un,postMouseDownCallback:Un,mouseClickCallback:Un,touchDragCallback:Bn,mouseDragCallback:Bn,mouseMoveCallback:Bn,touchEndCallback:jn,mouseUpCallback:jn,initializeMixin:Nn,renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=Rn.brushColor(r,!0),a=Pn(n.canvasContext.canvas),i=y.cornerstoneMath.point.distance;Wt(a,(function(e){if(!t.handles)return null;var n=y.cornerstone.pixelToCanvas(r,t.handles.start),a=y.cornerstone.pixelToCanvas(r,t.handles.end),s=i(n,a);$t(e,r,t.handles.start,s,{color:o})}))},_resetHandles:Nn,_applyStrategy:jn},Vn=B("tools:ScissorsTool"),Hn=bt("segmentation"),zn=Hn.getters,qn=Hn.setters;function Wn(e){var t=e.detail.element,n=e.detail.currentPoints.image,r=this.handles.points;if(!r.length)return Vn.warn("Something went wrong, empty handles detected."),null;r.push({x:n.x,y:n.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(t)}function Gn(e){var t=e.detail,n=e.detail.element;this._addPoint(t),y.cornerstone.updateImage(n)}function Yn(e){var t=this.handles.points,n=e.detail.element,r=zn.labelmap2D(n),o=r.labelmap2D,a=r.labelmap3D,i=r.currentImageIdIndex,s=o.pixelData,l=s.slice(),c={points:t,pixelData:s,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"};this.applyActiveStrategy(e,c);var u={imageIdIndex:i,diff:Le(l,s)};qn.pushState(this.element,[u]),qn.updateSegmentsOnLabelmap2D(o),y.cornerstone.updateImage(n),this._resetHandles()}function Zn(){this.handles={points:[]},this.currentHandle=0}var Xn={postTouchStartCallback:Wn,postMouseDownCallback:Wn,mouseClickCallback:Wn,touchDragCallback:Gn,mouseDragCallback:Gn,mouseMoveCallback:Gn,touchEndCallback:Yn,mouseUpCallback:Yn,initializeMixin:Zn,renderToolData:function(e){var t=e.detail,n=t.element,r=zn.brushColor(n,!0),o=Pn(t.canvasContext.canvas),a=this.handles.points;a.length<2||Wt(o,(function(e){for(var t=0;t<a.length;t++){var o=J()(a[t].lines);t===a.length-1&&o.push(a[0]),Kt(e,n,a[t],o,{color:r})}}))},_resetHandles:Zn,_addPoint:function(e){var t=this.handles.points;t.length&&t[this.currentHandle-1].lines.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),t.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(e.element)},_applyStrategy:Yn},Qn=bt("segmentation").getters,Kn=Object.assign({},Xn,{renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=Qn.brushColor(r,!0),a=Pn(n.canvasContext.canvas),i=this.handles;Wt(a,(function(e){if(i.points.length>1)for(var n=0;n<i.points.length;n++){var a=J()(i.points[n].lines);Kt(e,r,t.handles.points[n],a,{color:o})}}))}}),Jn=bt("segmentation"),$n=Jn.getters,er=Jn.setters;function tr(e){var t=e.detail.element,n=e.detail.currentPoints.image;return On(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function nr(e){var t=e.detail,n=t.element,r=t.currentPoints.image;this.handles.end=r,y.cornerstone.updateImage(n)}function rr(e){e.detail.handles=this.handles;var t=e.detail.element,n=$n.labelmap2D(t),r=n.labelmap2D,o=n.labelmap3D,a=n.currentImageIdIndex,i=r.pixelData,s=i.slice(),l={points:[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],pixelData:i,segmentIndex:o.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:a,diff:Le(s,i)};er.pushState(this.element,[c]),er.updateSegmentsOnLabelmap2D(r),y.cornerstone.updateImage(t),this._resetHandles()}function or(){this.handles={start:{},end:{}}}var ar={activeOrDisabledBinaryTool:zt,enabledOrDisabledBinaryTool:qt,circleSegmentationMixin:Fn,polylineSegmentationMixin:Kn,freehandSegmentationMixin:Xn,rectangleSegmentationMixin:{postTouchStartCallback:tr,postMouseDownCallback:tr,mouseClickCallback:tr,touchDragCallback:nr,mouseDragCallback:nr,mouseMoveCallback:nr,touchEndCallback:rr,mouseUpCallback:rr,initializeMixin:or,renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=$n.brushColor(r,!0),a=Pn(n.canvasContext.canvas);Wt(a,(function(e){Mn(e,r,t.handles.start,t.handles.end,{color:o})}))},_resetHandles:or,_applyStrategy:rr},renderBrushMixin:{renderBrush:function(e){var t,n=y.cornerstone,r=bt("segmentation"),o=r.getters,a=r.configuration,i=e.detail,s=i.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=wt.state.mousePositionImage,t){var l=i.image,c=l.rows,u=l.columns,d=t,f=d.x,h=d.y;if(!(f<0||f>u||h<0||h>c)){var p=a.radius,m=i.canvasContext,v=i.element,g=o.brushColor(v,this._drawing);m.setTransform(1,0,0,1,0,0);var x=p*s.scale,b=n.pixelToCanvas(v,t);m.beginPath(),m.strokeStyle=g,m.ellipse(b.x,b.y,x,x,0,0,2*Math.PI),m.stroke()}}}}},ir=function(e){return e&&"object"===b()(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},sr=function(e,t){var n;return t&&!0===t.clone&&ir(e)?ur((n=e,Array.isArray(n)?[]:{}),e,t):e},lr=function(e,t,n){var r=e.slice();return t.forEach((function(t,o){void 0===r[o]?r[o]=sr(t,n):ir(t)?r[o]=ur(e[o],t,n):-1===e.indexOf(t)&&r.push(sr(t,n))})),r},cr=function(e,t,n){var r={};return ir(e)&&Object.keys(e).forEach((function(t){r[t]=sr(e[t],n)})),Object.keys(t).forEach((function(o){ir(t[o])&&e[o]?r[o]=ur(e[o],t[o],n):r[o]=sr(t[o],n)})),r},ur=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=Array.isArray(t),o=(n||{arrayMerge:lr}).arrayMerge||lr;if(r)return Array.isArray(e)?o(e,t,n):sr(t,n);var a=cr(e,t,n);return Object.getPrototypeOf(e)!==Object.prototype&&Object.setPrototypeOf(a,Object.getPrototypeOf(e)),a},dr=ur,fr=B("tools:base:BaseTool"),hr=bt("globalConfiguration"),pr=function(){function e(t,n){i()(this,e),this.initialConfiguration=dr(n,t);var r=this.initialConfiguration,o=r.name,a=r.strategies,s=r.defaultStrategy,l=r.configuration,c=r.supportedInteractionTypes,u=r.mixins,d=r.svgCursor;this.name=o,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=c||[],this.strategies=a||{},this.defaultStrategy=s||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,d&&(this.svgCursor=d),this._options={},this._configuration=Object.assign({},l),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,u&&u.length&&this._applyMixins(u),this._cursors=Object.assign({},this.initialConfiguration.cursors);var f=this.defaultStrategy&&this._cursors[this.activeStrategy];f&&(this.svgCursor=f)}return l()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=ar["".concat(e[t])];"object"===b()(n)?(Object.assign(this,n),"function"==typeof this.initializeMixin&&this.initializeMixin()):fr.warn("".concat(this.name,": mixin ").concat(ar[t]," does not exist."))}"function"===this.initializeMixin&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(e){this.activeStrategy=e,hr.configuration.showSVGCursors&&this.changeCursor(this.element,e)}},{key:"changeCursor",value:function(e,t){if(e){var n=this._cursors[t];n&&(this.svgCursor=n,"active"===this.mode&&St(e,n))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}(),mr=function(e,t){if(e.boundingBox)return y.cornerstoneMath.point.insideRect(t,e.boundingBox)},vr=function(e,t,n,r){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(mr(e,n))return!0}else{var o=y.cornerstone.pixelToCanvas(t,e);if(y.cornerstoneMath.point.distance(o,n)<=r)return!0}return!1},gr=function e(t,n,r,o){var a;if(n){if(Array.isArray(n))for(var i=Object.keys(n),s=0;s<i.length;s++){var l=n[i[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&vr(l,t,r,o)){a=l;break}}else if("object"===b()(n))for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];if(Array.isArray(n[d])){if(a=e(t,n[d],r,o))break}else{var f=n[d];if(vr(f,t,r,o)){a=f;break}}}return a}},yr=function(e,t,n,r){r||(r=6);var o=function(e){var t;return Object.keys(e).forEach((function(n){var r=e[n];!0!==r.active||(t=r)})),t}(t),a=gr(e,t,n,r);return o!==a&&(void 0!==a&&(a.active=!0),void 0!==o&&(o.active=!1),!0)},xr=n(9),br=n.n(xr),wr=function(e,t){var n=e.image,r={left:0,top:0,width:n.width,height:n.height},o=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===y.cornerstoneMath.point.insideRect(n,r)&&(o=!0)})),o},Tr=function(e,t){var n=e.currentPoints,r=e.element,o=n.page,a=gt.handleTouchOffset,i=0,s=0;return"touch"===t&&(i=a.x,s=a.y),y.cornerstone.pageToPixel(r,o.x+i,o.y+s)},Ir=function(e,t,n){return t.filter((function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])}))},Sr=n(5),Er=n.n(Sr),Cr=function(e,t){return"active"===Tt(e,t).mode},Ar=bt("segmentation"),Mr=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,t),r.configuration||(r.configuration={alwaysEraseOnClick:!1}),(n=u()(this,f()(t).call(this,e,r))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(Er()(n)),n}return p()(t,e),l()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image,this._drawing&&this._paint(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints;return this._startPainting(e),this._lastImageCoords=r.image,this._drawing=!0,this._startListeningForMouseUp(n),this._paint(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element,r=Ar.configuration,o=Ar.getters.labelmap2D(n),a=o.labelmap2D,i=o.labelmap3D,s=o.currentImageIdIndex,l=o.activeLabelmapIndex,c=this._isCtrlDown(t)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:a,labelmap3D:i,currentImageIdIndex:s,activeLabelmapIndex:l,shouldErase:c},r.storeHistory){var u=a.pixelData.slice();this.paintEventData.previousPixelData=u}}},{key:"_endPainting",value:function(e){for(var t=Ar.configuration,n=Ar.setters,r=this.paintEventData,o=r.labelmap2D,a=r.currentImageIdIndex,i=new Set(o.pixelData).values(),s=[],l=!1;!l;){var c=i.next();(l=c.done)||s.push(c.value)}if(o.segmentsOnLabelmap=s,t.storeHistory){var u={imageIdIndex:a,diff:Le(this.paintEventData.previousPixelData,o.pixelData)};n.pushState(this.element,[u])}Oe(this.element)}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image}},{key:"renderToolData",value:function(e){var t=e.detail.element;Cr(t,this.name)&&this.renderBrush(e)}},{key:"passiveCallback",value:function(e){try{y.cornerstone.updateImage(this.element)}catch(e){return}}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._endPainting(e),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"newImageCallback",value:function(e){this._drawing&&(this._endPainting(e),this._startPainting(e))}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"increaseBrushSize",value:function(){var e=Ar.configuration,t=Ar.setters,n=e.radius,r=Math.floor(1.2*n);r===n&&(r+=1),t.radius(r)}},{key:"decreaseBrushSize",value:function(){var e=Ar.configuration,t=Ar.setters,n=e.radius,r=Math.floor(.8*n);t.radius(r)}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(pr),Pr=function(e){return e.filter((function(e){return!(e.isMultiPartTool||e instanceof mo||e instanceof Mr)}))};function Dr(e,t){var n;if("touch"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")?n=(n=Ir(e,yt.touchTools())).filter((function(e){return e.options.isTouchActive})):(n=(n=Ir(e,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&t&&e.options.mouseButtonMask.includes(t)&&e.options.isMouseActive})),gt.isMultiPartToolActive&&(n=Pr(n))),0!==n.length)return n[0]}var kr=B("manipulators:moveAllHandles"),Or=bt("manipulatorState"),Lr={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},Rr={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},_r=function(e,t,n,r){var o=e.element,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:gt.deleteIfHandleOutsideImage,preventHandleOutsideImage:gt.preventHandleOutsideImage},a);var l=Nr.bind(this,t,n,a,i),c=function e(r){Br(t,n,a,i,{dragHandler:l,upOrEndHandler:e},r,s)};Or.setters.addActiveManipulatorForElement(o,Ur.bind(null,n,a,i,{dragHandler:l,upOrEndHandler:c},o,s)),n.active=!0,gt.isToolLocked=!0,Lr[i].forEach((function(e){o.addEventListener(e,l)})),Rr[i].forEach((function(e){o.addEventListener(e,c)}))};function Nr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=o.detail,i=a.element,s=a.image,l=a.buttons,c=o.detail.deltaPoints.image,u=c.x,d=c.y;t.active=!0,t.invalidated=!0;for(var f=Object.keys(t.handles),h=0;h<f.length;h++){var p=f[h],m=t.handles[p];!0!==m.movesIndependently&&m.hasOwnProperty("x")&&m.hasOwnProperty("y")&&(m.x+=u,m.y+=d,n.preventHandleOutsideImage&&In(m,s))}y.cornerstone.updateImage(i);var v=Dr(i,l,r);v instanceof mo&&v.updateCachedStats(s,i,t),T(i,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:i,measurementData:t}),o.preventDefault(),o.stopPropagation()}function Ur(e){var t=arguments.length>3?arguments[3]:void 0;jr(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,{dragHandler:t.dragHandler,upOrEndHandler:t.upOrEndHandler},arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,!1)}function Br(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=o.dragHandler,i=o.upOrEndHandler,s=arguments.length>6?arguments[6]:void 0,l=(arguments.length>5?arguments[5]:void 0).detail,c=l.element;Or.setters.removeActiveManipulatorForElement(c),n.deleteIfHandleOutsideImage&&wr(l,t.handles)&&L(c,e,t),jr(t,n,r,{dragHandler:a,upOrEndHandler:i},c,s,!0)}function jr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=r.dragHandler,a=r.upOrEndHandler,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.active=!1,e.invalidated=!0,gt.isToolLocked=!1,Lr[n].forEach((function(e){i.removeEventListener(e,o)})),Rr[n].forEach((function(e){i.removeEventListener(e,a)})),"function"==typeof t.doneMovingCallback&&(kr.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(l)),"function"==typeof s&&s(l),y.cornerstone.updateImage(i)}var Fr=B("manipulators:moveHandle"),Vr=bt("manipulatorState"),Hr={value:!1},zr={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},qr={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},Wr=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;o=Object.assign({deleteIfHandleOutsideImage:gt.deleteIfHandleOutsideImage,preventHandleOutsideImage:gt.preventHandleOutsideImage},o);var s=e.element,l=Gr.bind(this,t,n,r,o,a),c=function s(){Zr(t,e,n,r,o,a,{dragHandler:l,upOrEndHandler:s},i)};if(Vr.setters.addActiveManipulatorForElement(s,Yr.bind(null,t,e,n,r,o,a,{dragHandler:l,upOrEndHandler:c},i)),r.active=!0,r.moving=!0,n.active=!0,gt.isToolLocked=!0,zr[a].forEach((function(e){s.addEventListener(e,l)})),qr[a].forEach((function(e){s.addEventListener(e,c)})),"touch"===a){Hr.value=!0;var u=y.cornerstone.getEnabledElement(s),d=Tr(e,a);Qr(r,Hr,u,d)}};function Gr(e,t,n,r,o,a){var i=a.detail,s=i.image,l=i.element,c=i.buttons,u=Tr(a.detail,o);Hr.value=!1,n.active=!0,n.hasMoved=!0,n.x=u.x,n.y=u.y,t.invalidated=!0,r.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Dr(l,c,o);d instanceof mo&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function Yr(e,t,n,r){var o=arguments.length>6?arguments[6]:void 0;Xr(e,t,n,r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},arguments.length>5?arguments[5]:void 0,{dragHandler:o.dragHandler,upOrEndHandler:o.upOrEndHandler},arguments.length>7?arguments[7]:void 0,!1)}function Zr(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=t.element;Vr.setters.removeActiveManipulatorForElement(u),Xr(e,t,n,r,o,a,{dragHandler:s,upOrEndHandler:l},c,!0)}function Xr(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],d=t.element;r.active=!1,r.moving=!1,n.active=!1,n.invalidated=!0,Hr.value=!1,gt.isToolLocked=!1,zr[a].forEach((function(e){d.removeEventListener(e,s)})),qr[a].forEach((function(e){d.removeEventListener(e,l)})),o.deleteIfHandleOutsideImage&&wr(t,n.handles)&&L(d,e,n),"function"==typeof o.doneMovingCallback&&(Fr.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),o.doneMovingCallback(u)),"function"==typeof c&&c(u),y.cornerstone.updateImage(d)}function Qr(e,t,n,r){if(t.value){var o=Math.abs(e.y-r.y),a=o/10;if(o<1)return e.y=r.y,void(t.value=!1);e.y>r.y?e.y-=a:e.y<r.y&&(e.y+=a),y.cornerstone.updateImage(n.element),y.cornerstone.requestAnimationFrame((function(){Qr(e,t,n,r)}))}}var Kr=B("manipulators:moveNewHandle"),Jr=bt("manipulatorState"),$r={mouse:[w.MOUSE_MOVE,w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},eo={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_PINCH,w.TAP]},to=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;(o=Object.assign({deleteIfHandleOutsideImage:gt.deleteIfHandleOutsideImage,preventHandleOutsideImage:gt.preventHandleOutsideImage},o)).hasMoved=!1;var s=e.element;function l(e){no(t,n,r,o,a,e)}function c(e){oo(t,n,r,o,a,{moveHandler:l,moveEndHandler:c},e,i)}n.active=!0,r.moving=!0,r.active=!0,gt.isToolLocked=!0,$r[a].forEach((function(e){s.addEventListener(e,l)})),s.addEventListener(w.TOUCH_START,io),eo[a].forEach((function(e){s.addEventListener(e,c)})),Jr.setters.addActiveManipulatorForElement(s,ao.bind(null,n,r,o,a,{moveHandler:l,moveEndHandler:c},s,i))};function no(e,t,n,r,o,a){var i=a.detail,s=i.image,l=i.element,c=i.buttons,u=Tr(a.detail,o);r.hasMoved=!0,t.invalidated=!0,n.active=!0,n.x=u.x,n.y=u.y,r&&r.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Dr(l,c,o);d instanceof mo&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function ro(e,t,n,r,o){var a=r.moveHandler,i=r.moveEndHandler,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];$r[e].forEach((function(e){n.removeEventListener(e,a)})),eo[e].forEach((function(e){n.removeEventListener(e,i)})),n.removeEventListener(w.TOUCH_START,io),gt.isToolLocked=!1,"function"==typeof o&&o(s),"function"==typeof t.doneMovingCallback&&(Kr.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(s)),y.cornerstone.updateImage(n)}function oo(e,t,n,r,o,a,i,s){var l=a.moveHandler,c=a.moveEndHandler,u=i.detail,d=u.element,f=!0;if(!1!==r.hasMoved){var h=Tr(u,o);t.active=!1,t.invalidated=!0,n.active=!1,n.moving=!1,n.x=h.x,n.y=h.y,Jr.setters.removeActiveManipulatorForElement(d),r.preventHandleOutsideImage&&In(n,i.detail.image),r.deleteIfHandleOutsideImage&&wr(i.detail,t.handles)&&(t.cancelled=!0,f=!1,L(d,e,t)),ro(o,r,d,{moveHandler:l,moveEndHandler:c},s,f)}}function ao(e,t,n,r,o,a,i){var s=o.moveHandler,l=o.moveEndHandler;e.active=!1,e.invalidated=!0,t.active=!1,ro(r,n,a,{moveHandler:s,moveEndHandler:l},i,!1)}function io(e){return e.stopImmediatePropagation(),!1}function so(e,t){var n=gt.clickProximity,r=gt.touchProximity,o=gt.tools.find((function(e){return e.name===t}));return o&&o.configuration&&(n=o.configuration.clickProximity||n,r=o.configuration.touchProximity||r),"mouse"===e?n:r}function lo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function co(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lo(n,!0).forEach((function(t){br()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lo(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var uo=function(e,t,n,r,o){n.active=!0,gt.isToolLocked=!0,Wr(e.detail,t.name,n,r,t.options,o,(function(t){var r=e.detail.element,o=n.toolType||n.toolName,a={toolName:o,toolType:o,element:r,measurementData:co({},n,{active:!1})};T(r,w.MEASUREMENT_COMPLETED,a)})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},fo=function(e,t,n,r){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",a=0;a<t.data.length;a++){var i=t.data[a],s=gr(e,i.handles,r,so(o,n));if(s)return{handle:s,data:i}}},ho=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";n.active=!0,gt.isToolLocked=!0,_r(e.detail,t.name,n,null,t.options,r,(function(){n.active=!1,gt.isToolLocked=!1})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},po=B("baseAnnotationTool"),mo=function(e){function t(){return i()(this,t),u()(this,f()(t).apply(this,arguments))}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,r=t.currentPoints.canvas,o=O(n,this.name),a=!1,i=0;i<o.data.length;i++){var s=o.data[i];!0===yr(n,s.handles,r)&&(a=!0);var l=this.pointNearTool(n,s,r,"mouse")&&!s.active,c=!this.pointNearTool(n,s,r,"mouse")&&s.active;(l||c)&&(s.active=!s.active,a=!0)}return a}},{key:"handleSelectedCallback",value:function(e,t,n){uo(e,this,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")}},{key:"toolSelectedCallback",value:function(e,t){ho(e,this,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")}},{key:"updateCachedStats",value:function(e,t,n){po.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),t}(pr),vo=function(e,t,n,r){var o=y.cornerstone,a={start:o.pixelToCanvas(e,t),end:o.pixelToCanvas(e,n)};return y.cornerstoneMath.lineSegment.distanceToPoint(a,r)},go=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},yo=xt.cursor,xo=function(){function e(t,n){i()(this,e),this.iconGroupString=t,this.options=Object.assign({},yo.getters.defaultOptions(),n)}return l()(e,[{key:"getIconSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,r=t.iconSize,o=t.viewBox,a=r/Math.max(o.x,o.y),i=16+r,s='\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 ').concat(i," ").concat(i,'"\n      >\n        <g>\n          ').concat(n,'\n        </g>\n        <g transform="translate(16, 16) scale(').concat(a,')">\n          ').concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,r=t.viewBox,o='\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(n,'" height="').concat(n,'" viewBox="0 0\n        ').concat(r.x," ").concat(r.y,'"\n      >\n        ').concat(this.iconGroupString,"\n      </svg>");return this._injectColors(o,t)}},{key:"_injectColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||un.getActiveColor(),r=t.toolColor||un.getToolColor(),o=t.fillColor||un.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(r)).replace(/FILL_COLOR/g,"".concat(o))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}(),bo=new xo('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />',{viewBox:{x:1792,y:1792}}),wo=new xo('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',{viewBox:{x:24,y:24}}),To=new xo('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',{viewBox:{x:48,y:48}}),Io=new xo('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',{viewBox:{x:32,y:32}}),So=new xo('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),Eo=new xo('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />',{viewBox:{x:32,y:32}}),Co=new xo('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',{viewBox:{x:18,y:18}}),Ao=new xo('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>',{viewBox:{x:18,y:18}}),Mo=new xo('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',{viewBox:{x:24,y:24}}),Po=new xo('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />',{viewBox:{x:1792,y:1792}}),Do=new xo('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),ko=new xo('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />',{viewBox:{x:1792,y:1792}}),Oo=new xo('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />',{viewBox:{x:1792,y:1792}}),Lo=new xo('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />',{viewBox:{x:2048,y:1792}}),Ro=new xo('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />',{viewBox:{x:512,y:512}}),_o=new xo('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />',{viewBox:{x:1792,y:1792}}),No=new xo('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />',{viewBox:{x:1792,y:1792}}),Uo=new xo('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />',{viewBox:{x:24,y:28}}),Bo=new xo('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),jo=new xo('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />',{viewBox:{x:18,y:18}}),Fo=new xo('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />',{viewBox:{x:640,y:512}}),Vo={x:127,y:60},Ho=function(){return'<rect fill="'.concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR",'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},zo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(e,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},qo='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Wo='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Go='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Yo=new xo("".concat(qo," ").concat(Ho()),{viewBox:Vo}),Zo=new xo("".concat(qo," ").concat(zo()),{viewBox:Vo}),Xo=new xo("".concat(qo," ").concat(Ho()),{viewBox:Vo}),Qo=new xo("".concat(qo," ").concat(zo()),{viewBox:Vo}),Ko=new xo("".concat(Wo," ").concat(Ho()),{viewBox:Vo}),Jo=new xo("".concat(Wo," ").concat(zo()),{viewBox:Vo}),$o=new xo("".concat(Wo," ").concat(Ho()),{viewBox:Vo}),ea=new xo("".concat(Wo," ").concat(zo()),{viewBox:Vo}),ta=new xo("".concat(Go," ").concat(Ho()),{viewBox:Vo}),na=new xo("".concat(Go," ").concat(zo()),{viewBox:Vo}),ra=new xo("".concat(Go," ").concat(Ho()),{viewBox:Vo}),oa=new xo("".concat(Go," ").concat(zo()),{viewBox:Vo});function aa(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId);return t?{rowPixelSpacing:t.rowPixelSpacing||t.rowImagePixelSpacing,colPixelSpacing:t.columnPixelSpacing||t.colImagePixelSpacing}:{rowPixelSpacing:e.rowPixelSpacing,colPixelSpacing:e.columnPixelSpacing}}var ia=function(e){var t=b()(e);return null!==e&&("object"===t||"function"===t)},sa=function(e,t,n){var r,o,a,i,s,l,c=0,u=!1,d=!1,f=!0,h=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,a=o;return r=o=void 0,c=t,i=e.apply(a,n)}function m(e,t){return h?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){return c=e,s=m(y,t),u?p(e):i}function g(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=a}function y(){var e=Date.now();if(g(e))return x(e);s=m(y,function(e){var n=e-c,r=t-(e-l);return d?Math.min(r,a-n):r}(e))}function x(e){return s=void 0,f&&r?p(e):(r=o=void 0,i)}function b(){for(var e=Date.now(),n=g(e),a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];if(r=c,o=this,l=e,n){if(void 0===s)return v(l);if(d)return s=m(y,t),p(l)}return void 0===s&&(s=m(y,t)),i}return t=Number(t)||0,ia(n)&&(u=Boolean(n.leading),a=(d="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):a,f="trailing"in n?Boolean(n.trailing):f),b.cancel=function(){void 0!==s&&function(e){if(h)return window.cancelAnimationFrame(e);clearTimeout(e)}(s),c=0,r=l=o=s=void 0},b.flush=function(){return void 0===s?i:x(Date.now())},b.pending=function(){return void 0!==s},b},la=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ia(n)&&(r="leading"in n?Boolean(n.leading):r,o="trailing"in n?Boolean(n.trailing):o),sa(e,t,{leading:r,trailing:o,maxWait:t})},ca=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:bo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,r))).preventNewMeasurement=!1,e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(vo(e,t.handles.start,t.handles.middle,n)<25||vo(e,t.handles.middle,t.handles.end,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var r=da(e,n.handles.middle,n.handles.start),o=da(e,n.handles.end,n.handles.middle),a=da(e,n.handles.end,n.handles.start),i=ua(r),s=ua(o),l=ua(a),c=Math.acos((Math.pow(i,2)+Math.pow(s,2)-Math.pow(l,2))/(2*i*s));c*=180/Math.PI,n.rAngle=go(c,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.enabledElement,o=this.configuration,a=o.handleRadius,i=o.drawHandlesOnHover,s=o.hideHandlesIfMoving,l=o.renderDashed,c=O(e.currentTarget,this.name),u=bt("globalConfiguration").configuration.lineDash;if(c)for(var d=Pn(n.canvasContext.canvas),f=n.image,h=n.element,p=aa(f),m=p.rowPixelSpacing,v=p.colPixelSpacing,g=Zt.getToolWidth(),x=function(e){var o=c.data[e];if(!1===o.visible)return"continue";Wt(d,(function(e){kn(e,t.configuration);var c=un.getColorIfActive(o),d=y.cornerstone.pixelToCanvas(n.element,o.handles.start),p=y.cornerstone.pixelToCanvas(n.element,o.handles.middle),x={color:c};l&&(x.lineDash=u),Kt(e,n.element,o.handles.start,[o.handles.middle,o.handles.end],x);var b={color:c,handleRadius:a,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&dn(e,n,o.handles,b),!0===o.invalidated&&(o.rAngle?t.throttledUpdateCachedStats(f,h,o):t.updateCachedStats(f,h,o)),o.rAngle){var T,I=function(e,t,n){var r=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+r}(o,m,v);if(!o.handles.textBox.hasMoved){T={x:p.x,y:p.y};var S=bn(e,I,5);p.x<d.x?T.x-=15+S+10:T.x+=15;var E=y.cornerstone.internal.getTransform(r);E.invert();var C=E.transformPoint(T.x,T.y);o.handles.textBox.x=C.x,o.handles.textBox.y=C.y}An(e,n.element,o.handles.textBox,I,o.handles,w,c,g,0,!0)}}))},b=0;b<c.data.length;b++)x(b);function w(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var r=e.detail,o=this.createNewMeasurement(r),a=e.detail.element;k(a,this.name,o),y.cornerstone.updateImage(a),to(r,this.name,o,o.handles.middle,this.options,t,(function(e){if(o.active=!1,!e)return L(a,n.name,o),void(n.preventNewMeasurement=!1);o.handles.end.active=!0,y.cornerstone.updateImage(a),to(r,n.name,o,o.handles.end,n.options,t,(function(e){e?(o.active=!1,y.cornerstone.updateImage(a)):L(a,n.name,o),n.preventNewMeasurement=!1,y.cornerstone.updateImage(a);var t={toolName:n.name,toolType:n.name,element:a,measurementData:o};T(a,w.MEASUREMENT_COMPLETED,t)}))}))}}}]),t}(mo);function ua(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function da(e,t,n){var r=aa(e),o=r.rowPixelSpacing,a=r.colPixelSpacing;return{x:(t.x-n.x)*(a||1),y:(t.y-n.y)*(o||1)}}var fa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:ha,changeTextCallback:pa,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:wo};return(e=u()(this,f()(t).call(this,n,r))).preventNewMeasurement=!1,e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&vo(e,t.handles.start,t.handles.end,n)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,o=n.enabledElement,a=this.configuration,i=a.handleRadius,s=a.drawHandlesOnHover,l=a.hideHandlesIfMoving,c=a.renderDashed,u=O(r,this.name);if(u){var d,f=e.detail.canvasContext.canvas,h=Pn(f),p=Zt.getToolWidth();c&&(d=bt("globalConfiguration").configuration.lineDash);for(var m=function(n){var a=u.data[n];if(!1===a.visible)return"continue";Wt(h,(function(n){kn(n,t.configuration);var c=un.getColorIfActive(a),u=y.cornerstone.pixelToCanvas(r,a.handles.start),f=y.cornerstone.pixelToCanvas(r,a.handles.end);t.configuration.arrowFirst?Jt(n,f,u,c,p,d):Jt(n,u,f,c,p,d);var h={color:c,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&dn(n,e.detail,a.handles,h);var m=function(e){return e.text}(a);if(m&&""!==m){var v=bn(n,m,5),x=gn.getFontSize()+10,b=Math.max(v,x)/2+5;if(f.x<u.x&&(b=-b),!a.handles.textBox.hasMoved){var w;w=t.configuration.arrowFirst?{x:f.x-v/2+b,y:f.y-x/2}:{x:u.x-v/2-b,y:u.y-x/2};var T=y.cornerstone.internal.getTransform(o);T.invert();var I=T.transformPoint(w.x,w.y);a.handles.textBox.x=I.x,a.handles.textBox.y=I.y}An(n,r,a.handles.textBox,m,a.handles,g,c,p,0,!1)}}))},v=0;v<u.data.length;v++)m(v)}function g(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,r=e.detail.element,o=this.createNewMeasurement(e),a=this.configuration.allowEmptyLabel;k(r,this.name,o),y.cornerstone.updateImage(r),to(e.detail,this.name,o,o.handles.end,this.options,t,(function(t){t?void 0===o.text&&n.configuration.getTextCallback((function(e){if(e||a){o.text=e,o.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:o};y.cornerstone.updateImage(r),T(r,w.MEASUREMENT_COMPLETED,t)}else L(r,n.name,o)}),e.detail):L(r,n.name,o),y.cornerstone.updateImage(r)}))}},{key:"doubleClickCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,r=O(t,this.name);if(!r)return!1;for(var o=0;o<r.data.length;o++){var a=r.data[o];if(this.pointNearTool(t,a,n)||mr(a.handles.textBox,n))return a.active=!0,y.cornerstone.updateImage(t),this.configuration.changeTextCallback(a,e.detail,this._doneChangingTextCallback.bind(this,t,a)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,r){!0===r?L(e,this.name,t):t.text=n,t.active=!1,y.cornerstone.updateImage(e),T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}]),t}(mo);function ha(e){e(prompt("Enter your annotation:"))}function pa(e,t,n){n(prompt("Change your annotation:"))}var ma=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},r)},va=function(e){var t=e.currentPoints.image,n=t.x,r=t.y;return{toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:ma(n,r,0),end:ma(n,r,1,{active:!0}),perpendicularStart:ma(n,r,2,{locked:!0}),perpendicularEnd:ma(n,r,3),textBox:ma(n-50,r-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},ga=function(e,t,n,r){var o=y.cornerstone,a=y.cornerstoneMath,i={start:o.pixelToCanvas(e,t.perpendicularStart),end:o.pixelToCanvas(e,t.perpendicularEnd)};return a.lineSegment.distanceToPoint(i,n)<r},ya=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=y.cornerstone,a=y.cornerstoneMath,i=t.handles,s={start:o.pixelToCanvas(e,i.start),end:o.pixelToCanvas(e,i.end)},l=a.lineSegment.distanceToPoint(s,n);if(mr(i.textBox,n))return!0;var c=so(r,"Bidirectional");return!!ga(e,i,n,c)||l<c};function xa(e,t,n,r){var o=(n.x-r.x)*e,a=(n.y-r.y)*t,i=Math.sqrt(o*o+a*a);return{x:o/i,y:a/i,length:i}}function ba(e,t){if(!t.handles.perpendicularStart.locked)return!1;var n,r,o,a,i=t.handles,s=i.start,l=i.end,c=e.image,u=c.columnPixelSpacing,d=void 0===u?1:u,f=c.rowPixelSpacing,h=void 0===f?1:f;if(s.x===l.x&&s.y===l.y)n=s.x,r=s.y,o=l.x,a=l.y;else{var p={x:(s.x+l.x)/2,y:(s.y+l.y)/2},m=xa(d,h,s,l),v=m.length/2,g=v/(2*h),y=v/(2*d);n=p.x+y*m.y,r=p.y-g*m.x,o=p.x-y*m.y,a=p.y+g*m.x}return t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=r,t.handles.perpendicularEnd.x=o,t.handles.perpendicularEnd.y=a,!0}var wa,Ta=function(e){var t=this,n=e.detail,r=n.element,o=n.canvasContext,a=n.image,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=i.renderDashed,d=bt("globalConfiguration").configuration.lineDash,f=O(r,this.name);if(f){var h=aa(a),p=h.rowPixelSpacing,m=h.colPixelSpacing;if(p&&m)for(var v,g=Pn(o.canvas),y=Zt.getToolWidth(),x=function(e){var o=f.data[e];if(!1===o.visible)return"continue";v=un.getColorIfActive(o),!0===o.invalidated&&(o.longestDiameter&&o.shortestDiameter?t.throttledUpdateCachedStats(a,r,o):t.updateCachedStats(a,r,o)),Wt(g,(function(e){kn(e,t.configuration);var a=o.handles,i=a.start,f=a.end,h=a.perpendicularStart,g=a.perpendicularEnd,x=a.textBox,b={color:v},w={color:v,strokeWidth:T};u&&(b.lineDash=d,w.lineDash=d),Qt(e,r,i,f,b);var T=y;ba(n,o),Qt(e,r,h,g,w);var I={color:v,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&dn(e,n,o.handles,I);var S=Ia(o,p,m);An(e,r,x,S,o.handles,(function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]}),v,y,10,!0)}))},b=0;b<f.data.length;b++)x(b)}},Ia=function(e,t,n){var r=" mm";t&&n||(r=" pixels");var o=" L ".concat(e.longestDiameter).concat(r),a=" W ".concat(e.shortestDiameter).concat(r),i=e.labels;return i&&Array.isArray(i)?[].concat(J()(i),[o,a]):[o,a]},Sa=function(e,t){var n=this,r=e.detail,o=r.element,a=r.image,i=r.buttons,s=this.configuration;if(!Ea(a)){var l=this.createNewMeasurement(r),c=function(){l.active=!1,y.cornerstone.updateImage(o)};k(o,this.name,l),y.cornerstone.updateImage(o);var u=(new Date).getTime(),d=l.handles,f=d.end,h=d.perpendicularStart;to(r,this.name,l,f,{},t,(function(e){if(e){var d=l.handles,f=l.longestDiameter,p=l.shortestDiameter,m=wr(r,d),v=parseFloat(f)||0,g=parseFloat(p)||0,x=v<1||g<1,b=(new Date).getTime()-u<150;m||x||b?(l.cancelled=!0,L(o,n.name,l)):s.getMeasurementLocationCallback(l,r,c),ba(r,l),h.locked=!1,l.invalidated=!0,y.cornerstone.updateImage(o);var I=Dr(o,i,t);I instanceof Qa&&I.updateCachedStats(a,o,l);var S={toolName:n.name,toolType:n.name,element:o,measurementData:l};T(o,w.MEASUREMENT_MODIFIED,S),T(o,w.MEASUREMENT_COMPLETED,S)}else L(o,n.name,l)}))}},Ea=function(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,r=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,r=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!r},Ca={setCoords:function(e){wa=e.currentPoints.canvas},getCoords:function(){return wa}},Aa=function(e){var t=this,n=e.detail,r=n.element;Ca.setCoords(n);var o=O(r,this.name);if(o){for(var a=!1,i=function(e){var i=n.currentPoints.canvas,s=o.data[e],l=function(e,t,n){var r=gr(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:6),o=!1;return Object.keys(t).forEach((function(e){if("textBox"!==e){var n=t[e],a=n===r;n.active!==a&&(o=!0),n.active=a}})),o}(r,s.handles,i);Object.keys(s.handles).forEach((function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active}})),l&&(a=!0);var c=t.pointNearTool(r,s,i,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,a=!0)},s=0;s<o.data.length;s++)i(s);!0===a&&y.cornerstone.updateImage(r)}},Ma=function(e,t,n){"touch"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)};function Pa(e,t,n,r){var o=(n.x-r.x)/t,a=(n.y-r.y)/e;return Math.sqrt(o*o+a*a)}function Da(e,t){return{start:e,end:t}}function ka(e,t,n){var r=y.cornerstoneMath.lineSegment,o=e.handles,a=o.start,i=o.end,s=o.perpendicularStart,l=o.perpendicularEnd,c=t.image,u=c.columnPixelSpacing,d=void 0===u?1:u,f=c.rowPixelSpacing,h=void 0===f?1:f,p=Da(a,i),m=Da(s,l),v=r.intersectLine(p,m);return{columnPixelSpacing:d,rowPixelSpacing:h,start:a,end:i,perpendicularStart:s,perpendicularEnd:l,longLine:p,intersection:v,distanceToFixed:Pa(d,h,n,v),fixedPoint:n}}function Oa(e,t,n,r){var o=ka(t,n,r),a=o.columnPixelSpacing,i=o.rowPixelSpacing,s=o.distanceToFixed,l=Pa(a,i,r,e);if(l<=s)return!1;var c=s/l,u=function(e,t){var n=e.columnPixelSpacing,r=e.rowPixelSpacing,o=e.start,a=e.perpendicularStart,i=e.perpendicularEnd,s=e.intersection,l=e.fixedPoint,c=Pa(n,r,a,s),u=Pa(n,r,i,s),d=xa(n,r,l,t),f=l===o?1:-1,h=f*r,p=f*n;return{start:{x:t.x+d.y*c*h,y:t.y+d.x*c*p*-1},end:{x:t.x+d.y*u*h*-1,y:t.y+d.x*u*p}}}(o,{x:r.x+(e.x-r.x)*c,y:r.y+(e.y-r.y)*c});return t.handles.perpendicularStart.x=u.start.x,t.handles.perpendicularStart.y=u.start.y,t.handles.perpendicularEnd.x=u.end.x,t.handles.perpendicularEnd.y=u.end.y,!0}function La(e,t){return e===t}function Ra(e,t){return La(e,t)?-1:1}function _a(e,t,n,r){var o,a=e.columnPixelSpacing,i=e.rowPixelSpacing,s=e.fixedPoint,l=e.perpendicularStart,c=e.perpendicularEnd,u=e.distanceToFixed,d=Ra(s,c)*u,f=function(e,t,n){return La(e,n)?t:n}(s,l,c)===l,h=f?"start":"end",p=f?"end":"start";return o={},br()(o,h,{x:n.start.x,y:n.start.y}),br()(o,p,{x:t.x+r.y*i*d,y:t.y+r.x*a*d*-1}),o}function Na(e,t,n,r){var o=y.cornerstoneMath.lineSegment,a=ka(t,n,r),i=a.columnPixelSpacing,s=a.rowPixelSpacing,l=a.start,c=a.longLine,u=a.intersection;if(!function(e,t,n){return 0!==Pa(e,t,n.start,n.end)}(i,s,c))return!1;var d=xa(i,s,l,u),f=function(e,t,n){var r=e.columnPixelSpacing,o=e.rowPixelSpacing,a=e.perpendicularEnd,i=e.fixedPoint,s=Number.MAX_SAFE_INTEGER,l=Ra(i,a)*s;return{start:t,end:{x:t.x+n.y*o*l,y:t.y+n.x*r*l*-1}}}(a,e,d),h=o.intersectLine(c,f);if(!h)return!1;var p=_a(a,h,f,d);return t.handles.perpendicularStart.x=p.start.x,t.handles.perpendicularStart.y=p.start.y,t.handles.perpendicularEnd.x=p.end.x,t.handles.perpendicularEnd.y=p.end.y,!0}var Ua=function(e,t,n,r){var o,a,i,s,l={},c={},u={x:t.currentPoints.image.x+r.x,y:t.currentPoints.image.y+r.y};0===e.index?Oa(u,n,t,n.handles.end)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?Oa(u,n,t,n.handles.start)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(a=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},a=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(a,n.handles.start),s=y.cornerstoneMath.point.distance(a,n.handles.end),(!a||i<3||s<3)&&(o=!0)),o||Na(u,n,t,n.handles.perpendicularEnd)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(a=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},a=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(a,n.handles.start),s=y.cornerstoneMath.point.distance(a,n.handles.end),(!a||i<3||s<3)&&(o=!0)),o||Na(u,n,t,n.handles.perpendicularStart)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))},Ba=function(e,t,n){var r=e[n],o=t[n];e[n]=o,t[n]=r},ja=function(e,t){Ba(e,t,"x"),Ba(e,t,"y"),Ba(e,t,"moving"),Ba(e,t,"hover"),Ba(e,t,"active"),Ba(e,t,"selected")},Fa=function(e){var t,n=this,r=e.detail,o=r.element,a=so("mouse",this.name),i=function(e){t.invalidated=!0,wr(r,t.handles)&&L(o,n.name,t),e&&(e.moving=!1,e.selected=!0),St(n.element,n.svgCursor),y.cornerstone.updateImage(o),o.addEventListener(w.MOUSE_MOVE,n._moveCallback),o.addEventListener(w.TOUCH_START,n._moveCallback)},s=r.startPoints.canvas,l=O(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,a],d=gr.apply(void 0,u);if(d)return o.removeEventListener(w.MOUSE_MOVE,n._moveCallback),o.removeEventListener(w.TOUCH_START,n._moveCallback),t.active=!0,Va(t.handles),d.moving=!0,(d=function(e,t,n){var r=e.image,o=r.rowPixelSpacing,a=r.columnPixelSpacing,i=t.handles,s=i.start,l=i.end,c=i.perpendicularStart,u=i.perpendicularEnd,d=(s.x-l.x)*(a||1),f=(s.y-l.y)*(o||1),h=Math.sqrt(d*d+f*f),p=(c.x-u.x)*(a||1),m=(c.y-u.y)*(o||1);return(Math.sqrt(p*p+m*m)||0)>h?(ja(s,l),ja(s,c),ja(l,u),Object.values(i).find((function(e){return!0===e.moving}))):n}(r,t,d)).hasBoundingBox||Et(n.element),function(e,t,n,r,o,a){var i=e.element,s=e.image,l=e.buttons,c={x:r.x-e.currentPoints.image.x,y:r.y-e.currentPoints.image.y},u=function(e){var o=e.detail;r.hasMoved=!0,void 0===r.index||null===r.index?(r.x=o.currentPoints.image.x+c.x,r.y=o.currentPoints.image.y+c.y):Ua(r,o,n,c),a&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,o.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,o.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Dr(i,l,"mouse");u instanceof mo&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,w.MEASUREMENT_MODIFIED,d)};r.active=!0,r.moving=!0,gt.isToolLocked=!0,i.addEventListener(w.MOUSE_DRAG,u),i.addEventListener(w.TOUCH_DRAG,u);var d=y.cornerstone.getImage(i),f=function(){y.cornerstone.getImage(i).imageId!==d.imageId&&h()};i.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,f);var h=function e(){r.active=!1,gt.isToolLocked=!1,i.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,f),i.removeEventListener(w.MOUSE_DRAG,u),i.removeEventListener(w.MOUSE_UP,e),i.removeEventListener(w.MOUSE_CLICK,e),i.removeEventListener(w.TOUCH_DRAG,u),i.removeEventListener(w.TOUCH_DRAG_END,e),i.removeEventListener(w.TAP,e),y.cornerstone.updateImage(i),"function"==typeof o&&o()};i.addEventListener(w.MOUSE_UP,h),i.addEventListener(w.MOUSE_CLICK,h),i.addEventListener(w.TOUCH_DRAG_END,h),i.addEventListener(w.TAP,h)}(r,n.name,t,d,(function(){return i(d)})),za(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===b()(d))return d.v}var f=function(e){return function(){Ha(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"mouse")){o.removeEventListener(w.MOUSE_MOVE,this._moveCallback),o.removeEventListener(w.TOUCH_START,this._moveCallback),t.active=!0,Va(t.handles),Ha(t.handles,!0);var h=f(t.handles);return _r(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",h),za(e),!0}}},Va=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Ha=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},za=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},qa=[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP],Wa=function(e){var t,n=this,r=e.detail,o=r.element,a=gt.touchProximity,i=function(e){t.invalidated=!0,wr(r,t.handles)&&L(o,n.name,t),e&&(e.moving=!1,e.selected=!0),y.cornerstone.updateImage(o),o.addEventListener(w.TOUCH_DRAG,n._moveCallback)},s=r.startPoints.canvas,l=O(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,a],d=gr.apply(void 0,u);if(d)return o.removeEventListener(w.TOUCH_DRAG,n._moveCallback),t.active=!0,Ga(t.handles),d.moving=!0,function(e,t,n,r,o,a){var i=e.element,s=e.image,l=e.buttons,c={x:r.x-e.currentPoints.image.x,y:r.y-e.currentPoints.image.y},u=function(e){var o=e.detail;r.hasMoved=!0,void 0===r.index||null===r.index?(r.x=o.currentPoints.image.x+c.x,r.y=o.currentPoints.image.y+c.y):Ua(r,o,n,c),a&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,o.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,o.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Dr(i,l,"touch");u instanceof mo&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,w.MEASUREMENT_MODIFIED,d)};r.active=!0,gt.isToolLocked=!0,i.addEventListener(w.TOUCH_DRAG,u);var d=function e(){r.active=!1,gt.isToolLocked=!1,i.removeEventListener(w.TOUCH_DRAG,u),qa.forEach((function(t){i.removeEventListener(t,e)})),y.cornerstone.updateImage(i),"function"==typeof o&&o()};qa.forEach((function(e){i.addEventListener(e,d)}))}(r,n.name,t,d,(function(){return i(d)})),Za(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===b()(d))return d.v}var f=function(e){return function(){Ya(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"touch")){o.removeEventListener(w.TOUCH_DRAG,this._moveCallback),t.active=!0,Ga(t.handles),Ya(t.handles,!0);var h=f(t.handles);return _r(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",h),Za(e),!0}}},Ga=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Ya=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},Za=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Xa=function(e,t,n){return n()},Qa=function(e){function t(e){var n;i()(this,t);var r={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:Xa,getMeasurementLocationCallback:Xa,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:To};return(n=u()(this,f()(t).call(this,e,r))).throttledUpdateCachedStats=la(n.updateCachedStats,110),n.createNewMeasurement=va.bind(Er()(n)),n.pointNearTool=ya.bind(Er()(n)),n.renderToolData=Ta.bind(Er()(n)),n.addNewMeasurement=Sa.bind(Er()(n)),n._moveCallback=Aa.bind(Er()(n)),n.handleSelectedCallback=Ma.bind(Er()(n)),n.handleSelectedMouseCallback=Fa.bind(Er()(n)),n.handleSelectedTouchCallback=Wa.bind(Er()(n)),n}return p()(t,e),l()(t,[{key:"updateCachedStats",value:function(e,t,n){if(n.toolName===this.name){var r=function(e,t){var n=t.rowPixelSpacing,r=t.colPixelSpacing,o=e.handles,a=o.start,i=o.end,s=o.perpendicularStart,l=o.perpendicularEnd,c=(a.x-i.x)*(r||1),u=(a.y-i.y)*(n||1),d=Math.sqrt(c*c+u*u),f=(s.x-l.x)*(r||1),h=(s.y-l.y)*(n||1),p=Math.sqrt(f*f+h*h);if(p||(p=0),p>d){var m=d;d=p,p=m}return{longestDiameter:d.toFixed(1),shortestDiameter:p.toFixed(1)}}(n,aa(e)),o=r.longestDiameter,a=r.shortestDiameter;n.longestDiameter=o,n.shortestDiameter=a,n.invalidated=!1}}}]),t}(mo),Ka=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=y.cornerstone,o=r.metaData.get("patientStudyModule",e.imageId),a=r.metaData.get("generalSeriesModule",e.imageId);if(o&&a&&"PT"===a.modality){var i=n?t:t*e.slope+e.intercept,s=o.patientWeight;if(s){var l=r.metaData.get("petIsotopeModule",e.imageId);if(l){var c=l.radiopharmaceuticalInfo,u=c.radiopharmaceuticalStartTime,d=c.radionuclideTotalDose,f=c.radionuclideHalfLife,h=a.seriesTime;if(u&&d&&f&&h){var p=Ja(h.fractionalSeconds||0)+h.seconds+60*h.minutes+60*h.hours*60-(Ja(u.fractionalSeconds||0)+u.seconds+60*u.minutes+60*u.hours*60);return i*s/(d*Math.exp(-p*Math.log(2)/f))*1e3}}}}};function Ja(e){return parseFloat(".".concat(e))}var $a=function(e,t){var n=e.width/2,r=e.height/2;if(n<=0||r<=0)return!1;var o=e.left+n,a=e.top+r,i=t.x-o,s=t.y-a;return i*i/(n*n)+s*s/(r*r)<=1},ei=function(e,t){for(var n=0,r=0,o=0,a=0,i=null,s=null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)$a(t,{x:c,y:l})&&(null===i&&(i=e[a],s=e[a]),n+=e[a],r+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),o++),a++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=r/o-u*u;return{count:o,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}},ti={calculateEllipseStatistics:ei,pointInEllipse:$a};function ni(e,t){var n=function(e){var t=[e.start,e.end].sort((function(e,t){return e.x<t.x?-1:1})),n=[e.start,e.end].sort((function(e,t){return e.y<t.y?-1:1})),r=t[0],o=t[t.length-1];return{top:n[0],left:r,bottom:n[n.length-1],right:o}}(t),r=(n.left.x+n.right.x)/2,o=(n.top.y+n.bottom.y)/2,a={};return e.rotation>=0&&e.rotation<90&&(a.x=e.hflip?n.left.x:n.right.x,a.y=o),e.rotation>=90&&e.rotation<180&&(a.x=r,a.y=e.vflip?n.bottom.y:n.top.y),e.rotation>=180&&e.rotation<270&&(a.x=e.hflip?n.right.x:n.left.x,a.y=o),e.rotation>=270&&e.rotation<360&&(a.x=r,a.y=e.vflip?n.top.y:n.bottom.y),a}var ri=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},oi=B("tools:annotation:CircleRoiTool"),ai=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:So,configuration:{centerPointRadius:0,renderDashed:!1,hideHandlesIfMoving:!1}};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};oi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end,a=y.cornerstoneMath.point.distance;if(o||oi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=y.cornerstone.pixelToCanvas(e,t.handles.start),l=y.cornerstone.pixelToCanvas(e,t.handles.end),c=a(s,n),u=a(s,l);return c>u-i/2&&c<u+i/2}},{key:"updateCachedStats",value:function(e,t,n){var r=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=aa(e),a=function(e,t,n,r,o){var a,i=ye(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=ei(s,i);"PT"===r&&(a={mean:Ka(e,l.mean,!0)||0,stdDev:Ka(e,l.stdDev,!0)||0});var c=i.width*(o&&o.colPixelSpacing||1)/2,u=2*Math.PI*c;return{area:Math.PI*(i.width*(o&&o.colPixelSpacing||1)/2)*(i.height*(o&&o.rowPixelSpacing||1)/2)||0,radius:c||0,perimeter:u||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,o);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=O(e.currentTarget,this.name);if(n){var r=y.cornerstoneMath.point.distance,o=e.detail,a=o.image,i=o.element,s=o.canvasContext,l=Zt.getToolWidth(),c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,f=c.hideHandlesIfMoving,h=c.renderDashed,p=c.centerPointRadius,m=Pn(s.canvas),v=aa(a),g=v.rowPixelSpacing,x=v.colPixelSpacing,b=bt("globalConfiguration").configuration.lineDash,w=(y.cornerstone.metaData.get("generalSeriesModule",a.imageId)||{}).modality,T=g&&x;Wt(m,(function(e){for(var s=0;s<n.data.length;s++){var c=n.data[s];if(!1!==c.visible){var m=un.getColorIfActive(c),v={color:m,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:f};kn(e,t.configuration);var g=y.cornerstone.pixelToCanvas(i,c.handles.start),x=y.cornerstone.pixelToCanvas(i,c.handles.end),I=r(g,x),S={color:m};if(h&&(S.lineDash=b),$t(e,i,c.handles.start,I,S,"pixel"),p&&I>3*p&&$t(e,i,c.handles.start,p,S,"pixel"),c.handles&&(c.handles.start.drawnIndependently=!0,c.handles.end.drawnIndependently=!0),dn(e,o,c.handles,v),!0===c.invalidated&&(c.cachedStats?t.throttledUpdateCachedStats(a,i,c):t.updateCachedStats(a,i,c)),!c.handles.textBox.hasMoved){var E=ni(o.viewport,c.handles);Object.assign(c.handles.textBox,E)}var C=si(e,a.color,c.cachedStats,w,T,t.configuration);c.unit=ii(w,t.configuration.showHounsfieldUnits),An(e,i,c.handles.textBox,C,c.handles,(function(e){return n=(t=ye(e.start,e.end)).left,r=t.top,[{x:n+(o=t.width)/2,y:r},{x:n,y:r+(a=t.height)/2},{x:n+o/2,y:r+a},{x:n+o,y:r+a/2}];var t,n,r,o,a}),m,l,10,!0)}}}))}}}]),t}(mo);function ii(e,t){return"CT"===e&&!1!==t?"HU":""}function si(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,o=void 0===r?0:r,a=n.radius,i=void 0===a?0:a,s=n.perimeter,l=void 0===s?0:s,c=n.mean,u=void 0===c?0:c,d=n.stdDev,f=void 0===d?0:d,h=n.min,p=void 0===h?0:h,m=n.max,v=void 0===m?0:m,g=n.meanStdDevSUV,y=void 0===g?0:g,x=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},T=w.showMinMax||!1,I=[],S=[];if(!t){var E=y&&0!==y.mean,C=ii(x,w.showHounsfieldUnits),A="Mean: ".concat(ri(u.toFixed(2))," ").concat(C),M="Std Dev: ".concat(ri(f.toFixed(2))," ").concat(C);if(E){for(var P=" SUV: ",D="".concat(P).concat(ri(y.mean.toFixed(2))),k="".concat(P).concat(ri(y.stdDev.toFixed(2))),O=Math.floor(e.measureText("".concat(M,"     ")).width);e.measureText(A).width<O;)A+=" ";S.push("".concat(A).concat(D)),S.push("".concat(M,"     ").concat(k))}else S.push("".concat(A,"     ").concat(M));if(T){for(var L="Min: ".concat(p," ").concat(C),R="Max: ".concat(v," ").concat(C),_=E?Math.floor(e.measureText("".concat(M,"     ")).width):Math.floor(e.measureText("".concat(A,"     ")).width);e.measureText(L).width<_;)L+=" ";S.push("".concat(L).concat(R))}}return I.push(li(o,b)),i&&I.push(ci(i,"Radius",b)),l&&I.push(ci(l,"Perimeter",b)),S.forEach((function(e){return I.push(e)})),I}function li(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(ri(e.toFixed(2))).concat(n)}function ci(e,t,n){if(!e)return"";var r=n?" mm":" px";return"".concat(t,": ").concat(ri(e.toFixed(1))).concat(r)}var ui=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Io,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,r))).hasIncomplete=!1,e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(this.hasIncomplete)return!1;var r=vo(e,t.handles.start,t.handles.end,n)<25,o=vo(e,t.handles.start2,t.handles.end2,n)<25;return r||o}},{key:"updateCachedStats",value:function(e,t,n){var r=aa(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(Math.ceil(n.handles.start.x)-Math.ceil(n.handles.end.x))*(a||1),s=(Math.ceil(n.handles.start.y)-Math.ceil(n.handles.end.y))*(o||1),l=(Math.ceil(n.handles.start2.x)-Math.ceil(n.handles.end2.x))*(a||1),c=(Math.ceil(n.handles.start2.y)-Math.ceil(n.handles.end2.y))*(o||1),u=Math.acos(Math.abs((i*l+s*c)/(Math.sqrt(i*i+s*s)*Math.sqrt(l*l+c*c))));u*=180/Math.PI,n.rAngle=go(u,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,a=r.drawHandlesOnHover,i=r.hideHandlesIfMoving,s=r.renderDashed,l=O(e.currentTarget,this.name);if(l)for(var c=Pn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=bt("globalConfiguration").configuration.lineDash,f=gn.getFont(),h=e.detail.element,p=aa(y.cornerstone.getEnabledElement(h).image),m=p.rowPixelSpacing,v=p.colPixelSpacing,g=function(e){var r=l.data[e];if(!1===r.visible)return"continue";r.value||(r.value=t.textBoxText(r,m,v)),Wt(c,(function(e){kn(e,t.configuration);var l=un.getColorIfActive(r),c={color:l};s&&(c.lineDash=d),Qt(e,n.element,r.handles.start,r.handles.end,c),r.complete&&Qt(e,n.element,r.handles.start2,r.handles.end2,c);var h={color:l,handleRadius:o,drawHandlesIfActive:a,hideHandlesIfMoving:i};t.configuration.drawHandles&&dn(e,n,r.handles,h),e.fillStyle=l;var p=r.value;if(!r.handles.textBox.hasMoved){var m={x:(r.handles.start.x+r.handles.end.x)/2,y:(r.handles.start.y+r.handles.end.y)/2-10};e.font=f,r.handles.textBox.x=m.x,r.handles.textBox.y=m.y}An(e,n.element,r.handles.textBox,p,r.handles,b,l,u,0,!0)}))},x=0;x<l.data.length;x++)g(x);function b(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=O(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))}},{key:"addNewMeasurement",value:function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r,o,a=e.detail,i=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:s,measurementData:r};T(s,t,o)}else L(s,n.name,r)},s=e.detail.element,l=this.getIncomplete(s);l?((r=l).complete=!0,r.handles.start2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},r.handles.end2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},o=r.handles.end2,this.hasIncomplete=!1,i=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:s,measurementData:r};T(s,t,o)}else L(s,n.name,r)}):(r=this.createNewMeasurement(a),k(s,this.name,r),o=r.handles.end),y.cornerstone.updateImage(s),to(a,this.name,r,o,this.options,t,i)}},{key:"onMeasureModified",value:function(e){var t=e.detail.element,n=y.cornerstone.getEnabledElement(t).image,r=aa(n),o=r.rowPixelSpacing,a=r.colPixelSpacing;if(e.detail.toolName===this.name){var i=e.detail.measurementData;!0===i.invalidated&&(i.rAngle?this.throttledUpdateCachedStats(n,t,i):this.updateCachedStats(n,t,i)),i.value=this.textBoxText(i,o,a)}}},{key:"textBoxText",value:function(e,t,n){var r=e.rAngle;if(void 0===r)return"";if(Number.isNaN(r))return"";var o=t&&n?"":" (isotropic)";return"".concat(r,"°").concat(o)}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(mo),di=B("tools:annotation:EllipticalRoiTool"),fi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Eo};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};di.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||di.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;if(gr(e,t.handles,n,6))return!0;var a="mouse"===r?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x)+a/2,top:Math.min(i.y,s.y)+a/2,width:Math.abs(i.x-s.x)-a,height:Math.abs(i.y-s.y)-a},c={left:Math.min(i.x,s.x)-a/2,top:Math.min(i.y,s.y)-a/2,width:Math.abs(i.x-s.x)+a,height:Math.abs(i.y-s.y)+a},u=$a(l,n);return!(!$a(c,n)||u)}},{key:"updateCachedStats",value:function(e,t,n){var r=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=aa(e),a=function(e,t,n,r,o){var a,i=vi(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=ei(s,i);return"PT"===r&&(a={mean:Ka(e,l.mean,!0)||0,stdDev:Ka(e,l.stdDev,!0)||0}),{area:Math.PI*(i.width*(o.colPixelSpacing||1)/2)*(i.height*(o.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,o);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=O(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,a=r.element,i=Zt.getToolWidth(),s=bt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=Pn(r.canvasContext.canvas),p=aa(o),m=p.rowPixelSpacing,v=p.colPixelSpacing,g=(y.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,x=m&&v;Wt(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=un.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};kn(e,t.configuration);var v={color:p};if(f&&(v.lineDash=s),an(e,a,h.handles.start,h.handles.end,v,"pixel",h.handles.initialRotation),dn(e,r,h.handles,m),!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(o,a,h):t.updateCachedStats(o,a,h)),!h.handles.textBox.hasMoved){var y=ni(r.viewport,h.handles);Object.assign(h.handles.textBox,y)}var b=pi(e,o.color,h.cachedStats,g,x,t.configuration);h.unit=hi(g,t.configuration.showHounsfieldUnits),An(e,a,h.handles.textBox,b,h.handles,(function(e){return n=(t=vi(e.start,e.end)).left,r=t.top,[{x:n+(o=t.width)/2,y:r},{x:n,y:r+(a=t.height)/2},{x:n+o/2,y:r+a},{x:n+o,y:r+a/2}];var t,n,r,o,a}),p,i,10,!0)}}}))}}}]),t}(mo);function hi(e,t){return"CT"===e&&!1!==t?"HU":""}function pi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,o=void 0===r?0:r,a=n.mean,i=void 0===a?0:a,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,f=void 0===d?0:d,h=n.meanStdDevSUV,p=void 0===h?0:h,m=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=g.showMinMax||!1,x=[],b=[];if(!t){var w=p&&0!==p.mean,T=hi(m,g.showHounsfieldUnits),I="Mean: ".concat(ri(i.toFixed(2))," ").concat(T),S="Std Dev: ".concat(ri(l.toFixed(2))," ").concat(T);if(w){for(var E=" SUV: ",C="".concat(E).concat(ri(p.mean.toFixed(2))),A="".concat(E).concat(ri(p.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(S,"     ")).width);e.measureText(I).width<M;)I+=" ";b.push("".concat(I).concat(C)),b.push("".concat(S,"     ").concat(A))}else b.push("".concat(I)),b.push("".concat(S));if(y){for(var P="Min: ".concat(u," ").concat(T),D="Max: ".concat(f," ").concat(T),k=w?Math.floor(e.measureText("".concat(S,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(P).width<k;)P+=" ";b.push("".concat(P).concat(D))}}return x.push(mi(o,v)),b.forEach((function(e){return x.push(e)})),x}function mi(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(ri(e.toFixed(2))).concat(n)}function vi(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var gi=function(e,t){for(var n=!1,r=e.length-1,o=0;o<e.length;o++)yi(t,e[o],e[r])&&(n=!n),r=o;return n};function yi(e,t,n){return r=e.y,o=t.y,a=n.y,!(!(o<r&&r<a||a<r&&r<o)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var r=t;t=n,n=r}var o=function(e,t,n){var r=(n.y-t.y)/(n.x-t.x);return{value:t.y+r*(e.x-t.x),gradient:r}}(e,t,n);return Math.sign(o.gradient)*e.y>Math.sign(o.gradient)*o.value}(e,t,n));var r,o,a}function xi(e,t,n,r){gi(e,t)&&(n.value+=r,n.squared+=r*r,n.count++)}var bi=function e(t,n){i()(this,e),this.toolIndex=t,this.handleIndexArray=n},wi=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=r,this.lines=[]};function Ti(e,t,n,r){for(var o=e.length-1,a=0;a<e.length;a++)if(-1===r.indexOf(a)&&-1===r.indexOf(o)){if(Ii(t,n,Si(e[o]),Si(e[a])))return!0;o=a}else o=a;return!1}function Ii(e,t,n,r){var o=!1,a=[Ei(e,t,n),Ei(e,t,r),Ei(n,r,e),Ei(n,r,t)];return a[0]!==a[1]&&a[2]!==a[3]||((0===a[0]&&Ci(e,n,t)||0===a[1]&&Ci(e,r,t)||0===a[2]&&Ci(n,e,r)||0===a[3]&&Ci(n,t,r))&&(o=!0),o)}function Si(e){return{x:e.x,y:e.y}}function Ei(e,t,n){var r=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===r?0:r>0?1:2}function Ci(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}var Ai={newHandle:function(e,t){var n=t.length-1;return Ti(t,Si(t[n]),Si(e),[n])},end:function(e){var t=e.length-1;return Ti(e,Si(e[t]),Si(e[0]),[t,0])},modify:function(e,t){var n=Si(e[t]),r=t-1;0===t&&(r=e.length-1);var o=Si(e[r]);return!!Ti(e,n,o,[t,r])||Ti(e,n,o=Si(e[r=t===e.length-1?0:t+1]),[t,r])}},Mi=function(){function e(t,n){i()(this,e),this._eventData=t,this._toolName=n}return l()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=O(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var r=this._nearestHandleToPoint(n);null!==r&&r.distance<t.distance&&(t=r)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],r=n.handles.points;if(void 0===r)return null;if(!1===n.visible)return null;for(var o={toolIndex:e,handleIndex:null,distance:1/0},a=0;a<r.length;a++){var i=y.cornerstone.pixelToCanvas(t.element,r[a]),s=y.cornerstoneMath.point.distance(i,this._mousePoint);s<o.distance&&(o.handleIndex=a,o.distance=s)}return o}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,r=[],o=0;o<n.length;o++){var a=e.getNextHandleIndex(o,n.length);this._distanceOfPointfromLine(n[o],n[a])<10&&r.push([o,a])}return r}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new bi(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var r=this._eventData,o=this._toolData.data[t],a=o.handles.points;if(void 0!==o.handles.points){if(!1===o.visible)return!1;var i=a[n[0]],s=a[n[1]],l=e.getCanvasPointsFromHandles(i,s,r.element),c=e.getLineAsVector(l),u=this._getLineOriginToMouseAsVector(l),d=(u[0]*c[0]+u[1]*c[1])/c.magnitude;return d>0&&d<c.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,r=y.cornerstone.pixelToCanvas(n.element,e),o=y.cornerstone.pixelToCanvas(n.element,t),a=this._mousePoint;return Math.abs((o.y-r.y)*a.x-(o.x-r.x)*a.y+o.x*r.y-o.y*r.x)/y.cornerstoneMath.point.distance(r,o)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var r=[];return e.x<t.x?(r.push(y.cornerstone.pixelToCanvas(n,e)),r.push(y.cornerstone.pixelToCanvas(n,t))):(r.push(y.cornerstone.pixelToCanvas(n,t)),r.push(y.cornerstone.pixelToCanvas(n,e))),r}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=y.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),Pi=function(e,t){t===e.length-1?e[t].lines.push(e[0]):e[t].lines.push(e[t+1])};function Di(e,t){var n=O(e.element,this.name);if(void 0!==n){var r=t.handleIndex,o=t.toolIndex,a=n.data[o],i=a.handles.points;i.length<=3||(r===i.length-1?(i[r-1].lines.pop(),i[r-1].lines.push(i[0])):0===r?(i[i.length-1].lines.pop(),i[i.length-1].lines.push(i[r+1])):(i[r-1].lines.pop(),i[r-1].lines.push(i[r+1])),i.splice(r,1),a.invalidated=!0,a.active=!0,a.highlight=!0,y.cornerstone.updateImage(e.element))}}function ki(e,t){var n=O(e.element,this.name);if(void 0!==n){var r=n.data[t.toolIndex],o=function(e){for(var t=e.handleIndexArray,n=1/0,r=t.includes(0),o=0;o<t.length;o++){var a=t[o];0!==a&&a<n&&(n=a)}return r&&1===n&&(n=0),++n}(t);if(o!==1/0){var a=new wi(e.currentPoints.image),i=r.handles.points;i.splice(o,0,a),i[o-1].lines.pop(),i[o-1].lines.push(e.currentPoints.image),Pi(i,o),r.active=!0,r.highlight=!0,r.invalidated=!0,y.cornerstone.updateImage(e.element)}}}var Oi={calculateFreehandStatistics:function(e,t,n){var r={count:0,mean:0,variance:0,stdDev:0},o=function(e,t,n){for(var r={value:0,squared:0,count:0},o=0,a=t.top;a<t.top+t.height;a++)for(var i=t.left;i<t.left+t.width;i++)xi(n,{x:i,y:a},r,e[o]),o++;return r}(e,t,n);return 0===o.count||(r.count=o.count,r.mean=o.value/o.count,r.variance=o.squared/o.count-r.mean*r.mean,r.stdDev=Math.sqrt(r.variance)),r},ClickedLineData:bi,freehandArea:function(e,t){var n=0,r=e.length-1;t=t||1;for(var o=0;o<e.length;o++)n+=(e[r].x+e[o].x)*(e[r].y-e[o].y),r=o;return Math.abs(n*t/2)},FreehandHandleData:wi,freehandIntersect:Ai,FreehandLineFinder:Mi,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby){var r={toolIndex:t.toolIndex,handleIndex:t.handleNearby};Di.call(this,n,r)}else{var o=new Mi(n,this.name).findLine();o&&ki.call(this,n,o)}},pointInFreehand:gi,addLine:Pi},Li=B("tools:annotation:FreehandRoiTool"),Ri=Oi.insertOrDelete,_i=Oi.freehandArea,Ni=Oi.calculateFreehandStatistics,Ui=Oi.freehandIntersect,Bi=Oi.FreehandHandleData,ji=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1},svgCursor:Co};return(e=u()(this,f()(t).call(this,n,r))).isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(Er()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(Er()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(Er()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(Er()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(Er()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(Er()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(Er()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(Er()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(Er()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(Er()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(Er()(e)),e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}Li.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.points;if(!r)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!r||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var r=1/0,o=0;o<t.handles.points.length;o++){var a=y.cornerstoneMath.point.distance(t.handles.points[o],n);r=Math.min(r,a)}return r===1/0?-1:r}},{key:"distanceFromPointCanvas",value:function(e,t,n){var r=1/0;if(!t)return-1;for(var o=y.cornerstone.pixelToCanvas(e,n),a=t.handles.points,i=0;i<a.length;i++){var s=y.cornerstone.pixelToCanvas(e,a[i]),l=y.cornerstoneMath.point.distance(s,o);r=Math.min(r,l)}return r===1/0?-1:r}},{key:"updateCachedStats",value:function(e,t,n){for(var r,o,a=y.cornerstone.metaData.get("generalSeriesModule",e.imageId),i=a?a.modality:null,s=n.handles.points,l={left:s[0].x,right:s[0].x,bottom:s[0].y,top:s[0].x},c=0;c<s.length;c++)l.left=Math.min(l.left,s[c].x),l.right=Math.max(l.right,s[c].x),l.bottom=Math.min(l.bottom,s[c].y),l.top=Math.max(l.top,s[c].y);var u={left:l.left,top:l.bottom,width:Math.abs(l.right-l.left),height:Math.abs(l.top-l.bottom)};if(n.polyBoundingBox=u,!e.color){var d=y.cornerstone.getPixels(t,u.left,u.top,u.width,u.height);r=Ni.call(this,d,u,n.handles.points),"PT"===i&&(o={mean:Ka(e,(r.mean-e.intercept)/e.slope),stdDev:Ka(e,(r.stdDev-e.intercept)/e.slope)}),r&&!isNaN(r.mean)&&(n.meanStdDev=r,n.meanStdDevSUV=o)}var f=aa(e),h=(f.colPixelSpacing||1)*(f.rowPixelSpacing||1),p=_i(n.handles.points,h);isNaN(p)||(n.area=p),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=O(e.currentTarget,this.name);if(r)for(var o=n.image,a=n.element,i=this.configuration,s=y.cornerstone.metaData.get("generalSeriesModule",o.imageId),l=s?s.modality:null,c=Pn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=i.renderDashed,f=bt("globalConfiguration").configuration.lineDash,h=function(e){var s=r.data[e];if(!1===s.visible)return"continue";Wt(c,(function(e){var r,l=un.getColorIfActive(s);s.active?s.handles.invalidHandlePlacement?(l=i.invalidColor,r=i.invalidColor):(l=un.getColorIfActive(s),r=un.getFillColor()):r=un.getToolColor();var c={color:l};if(d&&(c.lineDash=f),s.handles.points.length){var h=s.handles.points;Kt(e,a,h[0],h,c),s.polyBoundingBox?Kt(e,a,h[h.length-1],[h[0]],c):Kt(e,a,h[h.length-1],[i.mouseLocation.handles.start],c)}if(c={color:l,fill:r},(i.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,s.handles.points,c)),s.canComplete){c.handleRadius=i.completeHandleRadius;var p=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[p],c)}if(s.active&&!s.polyBoundingBox){c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,i.mouseLocation.handles,c);var g=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[g],c)}if(!0!==s.invalidated||s.active||(s.meanStdDev&&s.meanStdDevSUV&&s.area?t.throttledUpdateCachedStats(o,a,s):t.updateCachedStats(o,a,s)),s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var y=m.call(t,s);An(e,a,s.handles.textBox,y,s.handles.points,v,l,u,0,!0)}}))},p=0;p<r.data.length;p++)h(p);function m(e){var t=e.meanStdDev,n=e.meanStdDevSUV,r=e.area,a=[];if(t&&void 0!==t.mean){var i="";"CT"===l&&(i="HU"),e.unit=i;var s="Mean: ".concat(ri(t.mean.toFixed(2))," ").concat(i),c="StdDev: ".concat(ri(t.stdDev.toFixed(2))," ").concat(i);n&&void 0!==n.mean&&(s+=" SUV: "+ri(n.mean.toFixed(2)),c+=" SUV: "+ri(n.stdDev.toFixed(2))),a.push(s),a.push(c)}if(r){var u=" mm".concat(String.fromCharCode(178)),d=aa(o),f=d.rowPixelSpacing,h=d.colPixelSpacing;f&&h||(u=" pixels".concat(String.fromCharCode(178)));var p="Area: ".concat(ri(r.toFixed(2))).concat(u);a.push(p)}return a}function v(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),Fi(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||Ri.call(this,e,n),Fi(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=e.detail.element,a=O(o,this.name);if(n.hasBoundingBox)uo(e,this,t,n,r);else{var i=this.configuration;i.dragOrigin={x:n.x,y:n.y};for(var s=0;s<a.data.length;s++)for(var l=a.data[s].handles.points,c=0;c<l.length;c++)l[c]===n&&(i.currentHandle=c,i.currentTool=s);this._modifying=!0,this._activateModify(o),Fi(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element,o=O(r,this.name),a=this.configuration,i=a.currentTool,s=o.data[i],l=n.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(s,t);var c=this._pointNearHandle(r,s,l),u=s.handles.points;void 0!==c&&!c.hasBoundingBox&&c<u.length-1&&(a.mouseLocation.handles.start.x=u[c].x,a.mouseLocation.handles.start.y=u[c].y),y.cornerstone.updateImage(r)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=t.element,r=O(n,this.name),o=this.configuration.currentTool,a=r.data[o];this._getMouseLocation(t),this._checkInvalidHandleLocation(a,t),this._addPointPencilMode(t,a.handles.points),this._dragging=!0,y.cornerstone.updateImage(n)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;if(this._dragging){this._dragging=!1;var n=this.configuration,r=n.currentTool,o=O(t,this.name).data[r];if(!Ui.end(o.handles.points)&&o.canComplete){var a=n.currentHandle;this._endDrawing(t,a)}Fi(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.buttons,r=t.currentPoints,o=t.element;if(this.options.mouseButtonMask.includes(n)){var a=r.canvas,i=this.configuration,s=i.currentTool,l=O(o,this.name).data[s],c=this._pointNearHandle(o,l,a);if(!Ui.end(l.handles.points)&&l.canComplete){var u=i.currentHandle;this._endDrawing(o,u)}else void 0===c&&this._addPoint(t);Fi(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element,o=n.canvas,a=this.configuration,i=a.currentTool,s=O(r,this.name).data[i],l=this._pointNearHandle(r,s,o);if(!Ui.end(s.handles.points)&&s.canComplete){var c=a.currentHandle;this._endDrawing(r,c)}else void 0===l&&this._addPoint(t);Fi(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=O(e,this.name),n=this.configuration,r=t.data[n.currentTool];if(!Ui.end(r.handles.points)&&r.handles.points.length>=2){var o=n.currentHandle;r.polyBoundingBox={},this._endDrawing(e,o)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fi(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fi(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=t.element,r=t.buttons;if(this.options.mouseButtonMask.includes(r)){var o,a=O(n,this.name),i=this.configuration,s=a.data[i.currentTool],l=i.currentHandle,c=s.handles.points;if(this._getMouseLocation(t),s.handles.invalidHandlePlacement=Ui.modify(c,l),s.active=!0,s.highlight=!0,c[l].x=i.mouseLocation.handles.start.x,c[l].y=i.mouseLocation.handles.start.y,o=this._getPrevHandleIndex(l,c),l>=0){var u=c[o].lines.length-1,d=c[o].lines[u];d.x=i.mouseLocation.handles.start.x,d.y=i.mouseLocation.handles.start.y}y.cornerstone.updateImage(n)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,r=n.element,o=O(r,this.name),a=this.configuration,i=o.data[a.currentTool],s=a.currentHandle,l=i.handles.points;if(this._getMouseLocation(n),i.handles.invalidHandlePlacement=Ui.modify(l,s),i.active=!0,i.highlight=!0,l[s].x=a.mouseLocation.handles.start.x,l[s].y=a.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(s,l),s>=0){var c=l[t].lines.length-1,u=l[t].lines[c];u.x=a.mouseLocation.handles.start.x,u.y=a.mouseLocation.handles.start.y}y.cornerstone.updateImage(r)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,r=O(n,this.name);this._deactivateModify(n),this._dropHandle(t,r),this._endDrawing(n),y.cornerstone.updateImage(n)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,r=n.currentTool,o=t.data[r].handles,a=o.points;if(o.invalidHandlePlacement){var i,s=n.currentHandle,l=a[s];i=0===s?a[a.length-1]:a[s-1],l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,i.lines[0]=l,o.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,r=this.createNewMeasurement(n),o=n.element,a=this.configuration;e.type===w.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===w.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(o,t),this._getMouseLocation(n),k(o,this.name,r);var i=O(o,this.name);a.currentTool=i.data.length-1,this._activeDrawingToolReference=i.data[a.currentTool]}},{key:"_addPoint",value:function(e){var t=e.currentPoints,n=e.element,r=O(n,this.name),o=this.configuration,a=r.data[o.currentTool];if(!a.handles.invalidHandlePlacement){var i=new Bi(t.image);a.handles.points.length&&a.handles.points[o.currentHandle-1].lines.push(t.image),a.handles.points.push(i),o.currentHandle+=1,y.cornerstone.updateImage(n),this.fireModifiedEvent(n,a)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,r=this.configuration,o=e.element,a=r.mouseLocation.handles.start;t.every((function(e){return n._isDistanceLargerThanSpacing(o,e,a)}))&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=O(e,this.name),r=this.configuration,o=n.data[r.currentTool];if(o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,void 0!==t){var a=o.handles.points;a[r.currentHandle-1].lines.push(a[0])}this._modifying&&(this._modifying=!1,o.invalidated=!0),r.currentHandle=0,r.currentTool=-1,o.canComplete=!1,this._drawing&&this._deactivateDraw(e),y.cornerstone.updateImage(e),this.fireModifiedEvent(e,o),this.fireCompletedEvent(e,o)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var r=0;r<t.handles.points.length;r++){var o=y.cornerstone.pixelToCanvas(e,t.handles.points[r]);if(y.cornerstoneMath.point.distance(o,n)<6)return r}return t.handles.textBox&&mr(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.currentPoints,n=e.element,r=t.canvas,o=O(n,this.name);if(o)for(var a,i=0;i<o.data.length;i++)if(void 0!==(a=this._pointNearHandle(n,o.data[i],r)))return{handleNearby:a,toolIndex:i}}},{key:"_getMouseLocation",value:function(e){var t=e.currentPoints,n=e.image,r=this.configuration;r.mouseLocation.handles.start.x=t.image.x,r.mouseLocation.handles.start.y=t.image.y,In(r.mouseLocation.handles.start,n)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(e.handles.points.length<2)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,r=t.element,o=n.mouseLocation.handles.start,a=e.handles.points,i=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(r,a[0],o)&&!Ui.end(a)&&a.length>2?(e.canComplete=!0,i=!1):i=Ui.newHandle(o,a),i}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,r=e.handles.points,o=Ui.newHandle(n,r);return!1===o&&(o=this._invalidHandlePencilMode(e,t)),o}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,r=t.element,o=n.mouseLocation.handles.start,a=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(r,a[0],o))return e.canComplete=!0,!1;e.canComplete=!1;for(var i=1;i<a.length-1;i++)if(this._isDistanceSmallerThanSpacing(r,a[i],o))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var r,o=y.cornerstone.pixelToCanvas(e,t),a=y.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?r=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(r=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,o,a,"<",r)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===r?y.cornerstoneMath.point.distance(t,n)>o:y.cornerstoneMath.point.distance(t,n)<o}},{key:"_activateDraw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,gt.isMultiPartToolActive=!0,Et(this.element),e.addEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(w.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(w.DOUBLE_TAP,this._drawingDoubleTapClickCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,gt.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,St(this.element,this.svgCursor),e.removeEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(w.TOUCH_END,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){gt.isToolLocked=!0,e.addEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(w.TOUCH_END,this._editMouseUpCallback),e.addEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){gt.isToolLocked=!1,e.removeEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),y.cornerstone.updateImage(e)}}},{key:"fireModifiedEvent",value:function(e,t){T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"fireCompletedEvent",value:function(e,t){T(e,w.MEASUREMENT_COMPLETED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=O(e,this.name),n=this.configuration,r=t.data[n.currentTool];r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,r.canComplete=!1,L(e,this.name,r),this._deactivateDraw(e),y.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,r=this._activeDrawingToolReference;r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1;var o=r.handles.points;o[t.currentHandle-1].lines.push(o[0]),t.currentHandle=0,t.currentTool=-1,r.canComplete=!1,this._deactivateDraw(n),y.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,y.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,y.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,y.cornerstone.updateImage(this.element)}}]),t}(mo);function Fi(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}var Vi=B("tools:annotation:LengthTool"),Hi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Mo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,r=t.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:n,y:r,highlight:!0,active:!1},end:{x:n,y:r,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}Vi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&vo(e,t.handles.start,t.handles.end,n)<25:(Vi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(e,t,n){var r=aa(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(n.handles.end.x-n.handles.start.x)*(a||1),s=(n.handles.end.y-n.handles.start.y)*(o||1),l=Math.sqrt(i*i+s*s);n.length=l,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,a=r.drawHandlesOnHover,i=r.hideHandlesIfMoving,s=r.renderDashed,l=r.digits,c=O(e.currentTarget,this.name);if(c)for(var u=Pn(n.canvasContext.canvas),d=n.image,f=n.element,h=aa(d),p=h.rowPixelSpacing,m=h.colPixelSpacing,v=Zt.getToolWidth(),g=bt("globalConfiguration").configuration.lineDash,y=function(e){var r=c.data[e];if(!1===r.visible)return"continue";Wt(u,(function(e){kn(e,t.configuration);var c=un.getColorIfActive(r),u={color:c};s&&(u.lineDash=g),Qt(e,f,r.handles.start,r.handles.end,u);var h={color:c,handleRadius:o,drawHandlesIfActive:a,hideHandlesIfMoving:i};if(t.configuration.drawHandles&&dn(e,n,r.handles,h),!r.handles.textBox.hasMoved){var y={x:Math.max(r.handles.start.x,r.handles.end.x)};y.x===r.handles.start.x?y.y=r.handles.start.y:y.y=r.handles.end.y,r.handles.textBox.x=y.x,r.handles.textBox.y=y.y}!0===r.invalidated&&(r.length?t.throttledUpdateCachedStats(d,f,r):t.updateCachedStats(d,f,r));var x=function(e,t,n){var r,o,a=(r=e.length,o=Number(r),isNaN(o)?void 0:o);if(!a)return"";var i="mm";return t&&n||(i="pixels"),e.unit=i,"".concat(a.toFixed(l)," ").concat(i)}(r,p,m);An(e,f,r.handles.textBox,x,r.handles,b,c,v,10,!0)}))},x=0;x<c.data.length;x++)y(x);function b(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}}]),t}(mo),zi=function(e,t,n,r,o){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var a,i,s,l=y.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(i=0;i<o;i++)for(s=0;s<r;s++){var f=d[a=4*((i+n)*l.image.columns+(s+t))],h=d[a+1],p=d[a+2],m=d[a+3];c[u++]=f,c[u++]=h,c[u++]=p,c[u++]=m}return c},qi=B("tools:annotation:ProbeTool"),Wi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Po,configuration:{drawHandles:!0,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};qi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.end;if(r||qi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var o=y.cornerstone.pixelToCanvas(e,t.handles.end);return y.cornerstoneMath.point.distance(o,n)<5}},{key:"updateCachedStats",value:function(e,t,n){var r=Math.round(n.handles.end.x),o=Math.round(n.handles.end.y),a={};r>=0&&o>=0&&r<e.columns&&o<e.rows&&(a.x=r,a.y=o,e.color?a.storedPixels=zi(t,r,o,1,1):(a.storedPixels=y.cornerstone.getStoredPixels(t,r,o,1,1),a.sp=a.storedPixels[0],a.mo=a.sp*e.slope+e.intercept,a.suv=Ka(e,a.sp))),n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,a=r.renderDashed,i=O(e.currentTarget,this.name);if(i)for(var s=Pn(n.canvasContext.canvas),l=n.image,c=n.element,u=gn.getFontSize(),d=bt("globalConfiguration").configuration.lineDash,f=function(e){var r=i.data[e];if(!1===r.visible)return"continue";Wt(s,(function(e){var i,s,f=un.getColorIfActive(r);if(t.configuration.drawHandles){var h={handleRadius:o,color:f};a&&(h.lineDash=d),dn(e,n,r.handles,h)}!0===r.invalidated&&(r.cachedStats?t.throttledUpdateCachedStats(l,c,r):t.updateCachedStats(l,c,r));var p=r.cachedStats,m=p.x,v=p.y,g=p.storedPixels,x=p.sp,b=p.mo,w=p.suv;if(m>=0&&v>=0&&m<l.columns&&v<l.rows){i="".concat(m,", ").concat(v),l.color?s="R: ".concat(g[0]," G: ").concat(g[1]," B: ").concat(g[2]):(s="SP: ".concat(x," MO: ").concat(parseFloat(b.toFixed(3))),w&&(s+=" SUV: ".concat(parseFloat(w.toFixed(3)))));var T={x:r.handles.end.x+3,y:r.handles.end.y-3},I=y.cornerstone.pixelToCanvas(n.element,T);wn(e,s,I.x,I.y+u+5,f),wn(e,i,I.x,I.y,f)}}))},h=0;h<i.data.length;h++)f(h)}}]),t}(mo),Gi=B("tools:annotation:RectangleRoiTool"),Yi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Do};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Gi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||Gi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var a="mouse"===r?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x),top:Math.min(i.y,s.y),width:Math.abs(i.x-s.x),height:Math.abs(i.y-s.y)};return y.cornerstoneMath.rect.distanceToPoint(l,n)<a}},{key:"updateCachedStats",value:function(e,t,n){var r=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=aa(e),a=function(e,t,n,r,o){var a,i=Zi(n.start,n.end),s=function(e,t){for(var n=0,r=0,o=0,a=0,i=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[a],r+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),o++,a++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=r/o-u*u;return{count:o,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}}(y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),i);return"PT"===r&&(a={mean:Ka(e,s.mean,!0)||0,stdDev:Ka(e,s.stdDev,!0)||0}),{area:i.width*(o.colPixelSpacing||1)*(i.height*(o.rowPixelSpacing||1))||0,perimeter:2*i.width*(o.colPixelSpacing||1)+2*i.height*(o.rowPixelSpacing||1),count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,o);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=O(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,a=r.element,i=Zt.getToolWidth(),s=bt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=Pn(r.canvasContext.canvas),p=aa(o),m=p.rowPixelSpacing,v=p.colPixelSpacing,g=(y.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,x=m&&v;Wt(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=un.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};kn(e,t.configuration);var v={color:p};if(f&&(v.lineDash=s),Mn(e,a,h.handles.start,h.handles.end,v,"pixel",h.handles.initialRotation),t.configuration.drawHandles&&dn(e,r,h.handles,m),!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(o,a,h):t.updateCachedStats(o,a,h)),!h.handles.textBox.hasMoved){var y=ni(r.viewport,h.handles);Object.assign(h.handles.textBox,y)}var b=Ki(e,o.color,h.cachedStats,g,x,t.configuration);h.unit=Qi(g,t.configuration.showHounsfieldUnits),An(e,a,h.handles.textBox,b,h.handles,(function(e){return n=(t=Zi(e.start,e.end)).left,r=t.top,[{x:n+(o=t.width)/2,y:r},{x:n,y:r+(a=t.height)/2},{x:n+o/2,y:r+a},{x:n+o,y:r+a/2}];var t,n,r,o,a}),p,i,10,!0)}}}))}}}]),t}(mo);function Zi(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function Xi(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(ri(e.toFixed(2))).concat(n)}function Qi(e,t){return"CT"===e&&!1!==t?"HU":""}function Ki(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,o=void 0===r?0:r,a=n.mean,i=void 0===a?0:a,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,f=void 0===d?0:d,h=n.meanStdDevSUV,p=void 0===h?0:h,m=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=g.showMinMax||!1,x=[],b=[];if(!t){var w=p&&0!==p.mean,T=Qi(m,g.showHounsfieldUnits),I="Mean: ".concat(ri(i.toFixed(2))," ").concat(T),S="Std Dev: ".concat(ri(l.toFixed(2))," ").concat(T);if(w){for(var E=" SUV: ",C="".concat(E).concat(ri(p.mean.toFixed(2))),A="".concat(E).concat(ri(p.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(S,"     ")).width);e.measureText(I).width<M;)I+=" ";b.push("".concat(I).concat(C)),b.push("".concat(S,"     ").concat(A))}else b.push("".concat(I)),b.push("".concat(S));if(y){for(var P="Min: ".concat(u," ").concat(T),D="Max: ".concat(f," ").concat(T),k=w?Math.floor(e.measureText("".concat(S,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(P).width<k;)P+=" ";b.push("".concat(P).concat(D))}}return x.push(Xi(o,v)),b.forEach((function(e){return x.push(e)})),x}var Ji=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:$i},svgCursor:ko};return(e=u()(this,f()(t).call(this,n,r))).touchPressCallback=e._changeText.bind(Er()(e)),e.doubleClickCallback=e._changeText.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},r={left:0,top:0,width:e.image.width,height:e.image.height};if(y.cornerstoneMath.point.insideRect(n.handles.end,r)){var o=t.markers.indexOf(t.current);return(o+=t.ascending?1:-1)>=t.markers.length?o=t.loop?0:-1:o<0&&(o=t.loop?t.markers.length:-1),t.current=t.markers[o],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var r=y.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),o=mr(t.handles.end,n);return r<10||o}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,r=O(t.element,this.name);if(r)for(var o=Pn(t.canvasContext.canvas),a=function(e){var a=r.data[e];if(!1===a.visible)return"continue";var i=un.getColorIfActive(a);Wt(o,(function(e){kn(e,n);var r=y.cornerstone.pixelToCanvas(t.element,a.handles.end);a.handles.end.boundingBox=wn(e,a.text,r.x,r.y-10,i,{centering:{x:!0,y:!0}})}))},i=0;i<r.data.length;i++)a(i)}},{key:"_changeText",value:function(e){var t,n=e.detail,r=n.element,o=n.currentPoints;function a(e,t,n){!0===n?L(r,this.name,e):e.text=t,e.active=!1,y.cornerstone.updateImage(r)}var i=this.configuration,s=o.canvas,l=O(r,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(r,t,s))return t.active=!0,y.cornerstone.updateImage(r),i.changeTextCallback(t,n,a),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(mo),$i=function(e,t,n){n(e,prompt("Change your annotation:"))},es=(B("tools:BrushTool"),bt("segmentation")),ts=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._paint.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_paint",value:function(e){var t=es.configuration,n=e.detail,r=(n.element,n.image),o=r.rows,a=r.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>a||l<0||l>o)){var c=we(t.radius,o,a,s,l),u=this.paintEventData,d=u.labelmap2D,f=u.labelmap3D,h=u.shouldErase;te(c,d.pixelData,f.activeSegmentIndex,a,h),y.cornerstone.updateImage(e.detail.element)}}}]),t}(Mr),ns=B("tools:SphericalBrushTool"),rs=bt("segmentation"),os=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._paint.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_startPainting",value:function(e){var t,n=rs.configuration,r=rs.getters,o=e.detail,a=o.element,i=o.image,s=y.cornerstone,l=n.radius,c=i.rows,u=i.columns,d=Math.max(i.rowPixelSpacing,i.columnPixelSpacing),f=O(a,"stack").data[0].imageIds,h=r.labelmap2D(a),p=h.labelmap2D,m=h.labelmap3D,v=h.currentImageIdIndex,g=h.activeLabelmapIndex,x=this._isCtrlDown(o)||this.configuration.alwaysEraseOnClick,b=s.metaData.get("imagePlaneModule",i.imageId);if(b){var w=b.imagePositionPatient;t=this._getImagesInRange(v,w,f,l,d)}else ns.warn("No imagePlane metadata found for image, defaulting to circle brush application."),t=[{imageIdIndex:v,radiusOnImage:l}];if(this.paintEventData={labelmap2D:p,labelmap3D:m,currentImageIdIndex:v,activeLabelmapIndex:g,shouldErase:x,imagesInRange:t},n.storeHistory){for(var T=[],I=0;I<t.length;I++){var S=t[I].imageIdIndex,E=r.labelmap2DByImageIdIndex(m,S,c,u).pixelData.slice();T.push(E)}this.paintEventData.previousPixeldataForImagesInRange=T}}},{key:"_paint",value:function(e){var t=rs.getters,n=e.detail,r=(n.element,n.image),o=r.rows,a=r.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>a||l<0||l>o)){for(var c=this.paintEventData,u=c.labelmap3D,d=c.imagesInRange,f=c.shouldErase,h=0;h<d.length;h++){var p=d[h],m=p.imageIdIndex;te(we(p.radiusOnImage,o,a,s,l),t.labelmap2DByImageIdIndex(u,m,o,a).pixelData,u.activeSegmentIndex,a,f)}y.cornerstone.updateImage(e.detail.element)}}},{key:"_getImagesInRange",value:function(e,t,n,r,o){for(var a=r*o,i=[{imageIdIndex:e,radiusOnImage:r}],s=e+1;s<n.length;s++){var l=this._getRadiusOnImage(n[s],t,a,o);if(!l)break;i.push({imageIdIndex:s,radiusOnImage:l})}for(var c=e-1;c>=0;c--){var u=this._getRadiusOnImage(n[c],t,a,o);if(!u)break;i.push({imageIdIndex:c,radiusOnImage:u})}return i}},{key:"_getRadiusOnImage",value:function(e,t,n,r){var o=y.cornerstone.metaData.get("imagePlaneModule",e);if(o){var a=o.imagePositionPatient,i=Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2)+Math.pow(a[2]-t[2],2));if(!(i>n))return Math.floor(Math.sqrt(Math.pow(n,2)-Math.pow(i,2))/r)}else ns.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(e,","))}},{key:"_endPainting",value:function(e){for(var t=this.paintEventData,n=t.labelmap3D,r=t.imagesInRange,o=[],a=rs.configuration,i=rs.setters,s=0;s<r.length;s++){for(var l=r[s].imageIdIndex,c=n.labelmaps2D[l],u=new Set(c.pixelData).values(),d=[],f=!1;!f;){var h=u.next();(f=h.done)||d.push(h.value)}if(c.segmentsOnLabelmap=d,a.storeHistory){var p=this.paintEventData.previousPixeldataForImagesInRange[s],m=n.labelmaps2D[l].pixelData;o.push({imageIdIndex:l,diff:Le(p,m)})}}a.storeHistory&&i.pushState(this.element,o),Oe(this.element)}}]),t}(Mr),as=B("util:segmentation:operations:correction");function is(e,t){var n=t.pixelData,r=t.segmentIndex,o=t.segmentationMixinType;if("freehandSegmentationMixin"===o){var a=function(e,t){for(var n=t.pixelData,r=t.points,o=e.detail.image,a=o.width,i=o.height,s=[],l=0;l<r.length;l++){var c=r[l],u=Math.floor(c.x),d=Math.floor(c.y);u=Cn(u,0,a-1),d=Cn(d,0,i-1);var f=s[s.length-1];f&&u===f.x&&d===f.y||s.push({x:u,y:d,segment:n[d*a+u]})}return s}(e,t),i=function(e,t){for(var n=!0,r=!0,o=0;o<e.length&&(e[o].segment===t?r=!1:n=!1,n||r);o++);return r?{isScissorOperation:!0,operation:"fillInsideFreehand"}:n?{isScissorOperation:!0,operation:"eraseInsideFreehand"}:{isScissorOperation:!1}}(a,r);if(i.isScissorOperation)"fillInsideFreehand"===i.operation?(as.warn("The line never intersects a segment."),ws(e,t)):"eraseInsideFreehand"===i.operation&&(as.warn("The line is only ever inside the segment."),hs(e,t));else{var s=new Uint8Array(n.length);(function(e,t){var n=e[0].segment===t,r=[];r.push({additive:!n,nodes:[]});for(var o=0,a=0;a<e.length;a++){var i=e[a];n?(r[o].nodes.push(i),i.segment!==t&&(o++,n=!n,r.push({additive:!0,nodes:[]}),r[o].nodes.push(e[a-1]),r[o].nodes.push(i))):(r[o].nodes.push(i),i.segment===t&&(o++,n=!n,r.push({additive:!1,nodes:[]}),r[o].nodes.push(e[a-1]),r[o].nodes.push(i)))}return r.pop(),r.shift(),r})(a,r).forEach((function(t){!function(e,t,n,r,o){var a=o.detail.image,i=a.width,s=a.height,l=e.nodes,c=e.additive,u=c?0:1,d=function(e){return e.y*i+e.x},f=function(e){return{x:e%i,y:Math.floor(e/i)}};c?as.warn("additive operation..."):as.warn("subtractive operation...");for(var h=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push(e[n]),t.push.apply(t,J()(Se(e[n],e[n+1])));t.push[e[e.length-1]];for(var r=[],o=[],a=0;a<t.length-1;a++){var i=cs(t[a],t[a+1]),s=i.left,l=i.right;r.push(s),o.push(l)}return{pixelPath:t,leftPath:r,rightPath:o}}(l),p=h.pixelPath,m=h.leftPath,v=h.rightPath,g=p[0],y={xMin:g.x,xMax:g.x,yMin:g.y,yMax:g.y},x=0;x<n.length;x++)t[x]===r?(ss(y,f(x)),n[x]=1):n[x]=0;for(var b=0;b<p.length;b++){var w=p[b];n[d(w)]=2,ss(y,w)}!function(e,t,n){e.xMax=Math.min(e.xMax+2,n),e.xMin=Math.max(e.xMin-2,0),e.yMax=Math.min(e.yMax+2,t),e.yMin=Math.max(e.yMin-2,0)}(y,s,i);var T=y.xMin,I=y.xMax,S=y.yMin,E=y.yMax;function C(e,t){if(!(e>=I||e<T||t>=E||t<S))return n[t*i+e]}for(var A=0,M=0,P=0;P<m.length;P++){var D=m[P];n[d(D)]===u&&Ge(D,s,i)&&(A+=ls(D,3,n,C,i));var k=v[P];n[d(k)]===u&&Ge(k,s,i)&&(M+=ls(k,4,n,C,i))}if(0!==A&&0!==M){for(var O=c?r:0,L=A<M?3:4,R=0;R<n.length;R++)n[R]===L&&(t[R]=O);if(O===r)for(var _=0;_<p.length;_++)t[d(p[_])]=r;else for(var N=0;N<p.length;N++){var U=d(p[N]);t[U]===r&&(t[U]=0)}}}(t,n,s,r,e)}))}}else as.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(o))}function ss(e,t){var n=t.x,r=t.y;n<e.xMin&&(e.xMin=n),n>e.xMax&&(e.xMax=n),r<e.yMin&&(e.yMin=r),r>e.yMax&&(e.yMax=r)}function ls(e,t,n,r,o){for(var a=pe(r,[e.x,e.y]).flooded,i=0;i<a.length;i++){var s=a[i];n[s[1]*o+s[0]]=t}return a.length}function cs(e,t){var n={x:t.x-e.x,y:t.y-e.y};return-1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y-1},right:{x:e.x+1,y:e.y+1}}:0===n.x&&1===n.y?{left:{x:e.x-1,y:e.y},right:{x:e.x+1,y:e.y}}:1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y+1},right:{x:e.x+1,y:e.y-1}}:1===n.x&&0===n.y?{left:{x:e.x,y:e.y+1},right:{x:e.x,y:e.y-1}}:1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y+1},right:{x:e.x-1,y:e.y-1}}:0===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y},right:{x:e.x-1,y:e.y}}:-1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y-1},right:{x:e.x-1,y:e.y+1}}:-1===n.x&&0===n.y?{left:{x:e.x,y:e.y-1},right:{x:e.x,y:e.y+1}}:void as.error("Unable to find left and right paths for flood fill ",e,t,n)}function us(e,t){for(var n=e[0],r=e[1],o=!1,a=0,i=t.length-1;a<t.length;i=a++){var s=t[a][0],l=t[a][1],c=t[i][0],u=t[i][1];l>r!=u>r&&n<(c-s)*(r-l)/(u-l)+s&&(o=!o)}return o}var ds=B("util:segmentation:operations:eraseInsideFreehand");function fs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("freehandSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=be(i,a),l=oe()(s,2),c=l[0],u=l[1];n?se(e,t,(function(e){return us([e.x,e.y],i)}),c,u):le(e,t,(function(e){return us([e.x,e.y],i)}),c,u)}else ds.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(o))}function hs(e,t){fs(e,t,!0)}function ps(e,t){fs(e,t,!1)}var ms=B("util:segmentation:operations:eraseInsideRectangle");function vs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("rectangleSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=be(i,a),l=oe()(s,2),c=l[0],u=l[1];n?se(e,t,(function(){return!0}),c,u):ne(e,t,c,u)}else ms.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(o))}function gs(e,t){vs(e,t,!0)}function ys(e,t){vs(e,t,!1)}var xs=B("util:segmentation:operations:fillInsideFreehand");function bs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("freehandSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=be(i,a),l=oe()(s,2),c=l[0],u=l[1];n?fe(e,t,(function(e){return us([e.x,e.y],i)}),c,u):he(e,t,(function(e){return us([e.x,e.y],i)}),c,u)}else xs.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(o))}function ws(e,t){bs(e,t,!0)}function Ts(e,t){bs(e,t,!1)}var Is=B("util:segmentation:operations:fillInsideRectangle");function Ss(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("rectangleSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=be(i,a),l=oe()(s,2),c=l[0],u=l[1];n?fe(e,t,(function(){return!0}),c,u):ce(e,t,c,u)}else Is.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(o))}function Es(e,t){Ss(e,t,!0)}function Cs(e,t){Ss(e,t,!1)}var As=B("util:segmentation:operations:fillCircle");function Ms(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var o=e.detail,a=xe(e),i=oe()(a,2),s=i[0],l=i[1],c=ye(o.handles.start,o.handles.end);n?fe(e,t,(function(e){return $a(c,e)}),s,l):he(e,t,(function(e){return $a(c,e)}),s,l)}else As.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function Ps(e,t){Ms(e,t,!0)}function Ds(e,t){Ms(e,t,!1)}var ks=B("util:segmentation:operations:eraseInsideCircle");function Os(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var o=e.detail,a=xe(e),i=oe()(a,2),s=i[0],l=i[1],c=ye(o.handles.start,o.handles.end);n?se(e,t,(function(e){return $a(c,e)}),s,l):le(e,t,(function(e){return $a(c,e)}),s,l)}else ks.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function Ls(e,t){Os(e,t,!0)}function Rs(e,t){Os(e,t,!1)}var _s=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"FreehandScissors",strategies:{FILL_INSIDE:ws,FILL_OUTSIDE:Ts,ERASE_OUTSIDE:ps,ERASE_INSIDE:hs},cursors:{FILL_INSIDE:Zo,FILL_OUTSIDE:Qo,ERASE_OUTSIDE:Xo,ERASE_INSIDE:Yo},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Zo,mixins:["freehandSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),Ns=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RectangleScissors",strategies:{FILL_INSIDE:Es,FILL_OUTSIDE:Cs,ERASE_OUTSIDE:ys,ERASE_INSIDE:gs},cursors:{FILL_INSIDE:Jo,FILL_OUTSIDE:ea,ERASE_OUTSIDE:$o,ERASE_INSIDE:Ko},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),Us=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CircleScissors",strategies:{FILL_INSIDE:Ps,FILL_OUTSIDE:Ds,ERASE_OUTSIDE:Rs,ERASE_INSIDE:Ls},cursors:{FILL_INSIDE:na,FILL_OUTSIDE:oa,ERASE_OUTSIDE:ra,ERASE_INSIDE:ta},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:na,mixins:["circleSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),Bs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CorrectionScissors",strategies:{CORRECTION:is},cursors:{CORRECTION:Zo},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Zo,mixins:["polylineSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),js={},Fs={},Vs={};function Hs(e){if(!e)return"DEFAULT";var t=y.cornerstone.getEnabledElement(e).uuid;if(!t)throw new Error("Something went wrong when getting uuid from element");return t}var zs={setStartLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);js[n]=e},getStartLoadHandler:function(e){var t=Hs(e);return js[t]||js.DEFAULT},setEndLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);Fs[n]=e},getEndLoadHandler:function(e){var t=Hs(e);return Fs[t]||Fs.DEFAULT},setErrorLoadingHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);Vs[n]=e},getErrorLoadingHandler:function(e){var t=Hs(e);return Vs[t]||Vs.DEFAULT},removeHandlers:function(e){var t=Hs(e);delete js[t],delete Fs[t],delete Vs[t]}},qs={};function Ws(e,t){if(!qs[e])return{};var n=qs[e].find((function(e){return e.element===t}));return n?n.options:{}}function Gs(e,t,n){if(qs[e]){var r=qs[e].findIndex((function(e){return e.element===t}));if(-1===r)qs[e].push({element:t,options:n});else{var o=qs[e][r].options||{};qs[e][r].options=Object.assign(o,n)}}else qs[e]=[{element:t,options:n}]}var Ys=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Oo};return(e=u()(this,f()(t).call(this,n,r))).preMouseDownCallback=e._chooseLocation.bind(Er()(e)),e.mouseDragCallback=e._chooseLocation.bind(Er()(e)),e.touchDragCallback=e._chooseLocation.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var r=O(n,this.name);if(r){var o=n,a=y.cornerstone.getEnabledElement(o).image.imageId,i=y.cornerstone.metaData.get("imagePlaneModule",a);if(i){var s=nn(t.currentPoints.image,i);r.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==o){var t=Number.MAX_VALUE,n=-1,r=O(e,"stack");if(void 0!==r){var a=r.data[0];if(a.imageIds.forEach((function(e,r){var o=y.cornerstone.metaData.get("imagePlaneModule",e);if(o&&o.imagePositionPatient&&o.rowCosines&&o.columnCosines){var a=en(o.imagePositionPatient),i=en(o.rowCosines),l=en(o.columnCosines).clone().cross(i.clone()),c=Math.abs(l.clone().dot(a)-l.clone().dot(s));c<t&&(t=c,n=r)}})),n!==a.currentImageIdIndex&&-1!==n&&void 0!==a.imageIds[n]){var i=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);i&&i(e),(!0===a.preventCache?y.cornerstone.loadImage(a.imageIds[n]):y.cornerstone.loadAndCacheImage(a.imageIds[n])).then((function(t){var r=y.cornerstone.getViewport(e);a.currentImageIdIndex=n,y.cornerstone.displayImage(e,t,r),l&&l(e,t)}),(function(t){var r=a.imageIds[n];c&&c(e,r,t)}))}}}}))}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,r=t.synchronizationContext;Gs(this.name,e,{mouseButtonMask:n}),R(e,this.name),k(e,this.name,{synchronizationContext:r})}}]),t}(pr),Zs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;y.cornerstone.fitToWindow(t.element)}}]),t}(pr),Xs=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"DragProbe",strategies:{default:Qs,minimal:Ks},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Po};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._movingEventCallback.bind(Er()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(Er()(e)),e.mouseDragCallback=e._movingEventCallback.bind(Er()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(Er()(e)),e.dragEventData={},e}return p()(t,e),l()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,y.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},y.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(pr);function Qs(e){var t=this.configuration,n=y.cornerstone,r=e.detail,o=r.element,a=r.image,i=r.currentPoints,s=r.canvasContext,l=Pn(s.canvas),c=un.getActiveColor(),u=gn.getFontSize(),d=Math.round(i.image.x),f=Math.round(i.image.y);d<0||f<0||d>=a.columns||f>=a.rows||Wt(l,(function(e){kn(e,t);var r,s,l="".concat(d,", ").concat(f);if(a.color)r=zi(o,d,f,1,1),s="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]," A: ").concat(r[3]);else{var h=(r=n.getStoredPixels(o,d,f,1,1))[0],p=h*a.slope+a.intercept,m=Ka(a,h);s="SP: ".concat(h," MO: ").concat(parseFloat(p.toFixed(3))),m&&(s+=" SUV: ".concat(parseFloat(m.toFixed(3))))}var v={x:i.canvas.x+5,y:i.canvas.y-5};wn(e,s,v.x,v.y+u+5,c),wn(e,l,v.x,v.y,c)}))}function Ks(e){var t=this.configuration,n=y.cornerstone,r=e.detail,o=r.element,a=r.image,i=r.currentPoints,s=r.canvasContext,l=r.isTouchEvent,c=Pn(s.canvas),u=un.getActiveColor(),d=i.page.y-gn.getFontSize()/2;l&&(d=i.page.y-4*gn.getFontSize());var f=n.pageToPixel(o,i.page.x,d);f.x<0||f.y<0||f.x>=a.columns||f.y>=a.rows||Wt(c,(function(e){kn(e,t);var r,i=n.metaData.get("generalSeriesModule",a.imageId),s=i&&i.modality,c="";if(a.color)r=zi(o,f.x,f.y,1,1),c="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]);else{var d=(r=n.getStoredPixels(o,f.x,f.y,1,1))[0],h=d*a.slope+a.intercept,p=parseFloat(h.toFixed(2));if("CT"===s)c+="HU: ".concat(p);else if("PT"===s){c+=p;var m=Ka(a,d);m&&(c+=" SUV: ".concat(parseFloat(m.toFixed(2))))}else c+=p}var v=n.pixelToCanvas(o,f),g={x:12,y:-(gn.getFontSize()+10)/2},y=bn(e,c,5);l&&(g={x:-y/2,y:-gn.getFontSize()-10-12}),$t(e,o,v,6,{color:u},"canvas"),wn(e,c,v.x+g.x,v.y+g.y,u)}))}var Js=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Lo};return(e=u()(this,f()(t).call(this,n,r))).preMouseDownCallback=e._deleteAllNearbyTools.bind(Er()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;return gt.tools.forEach((function(e){var r=O(n,e.name);r&&r.data.forEach((function(r){"function"==typeof e.pointNearTool&&e.pointNearTool(n,r,t)&&(L(n,e.name,r),y.cornerstone.updateImage(n))}))})),!0}}]),t}(pr),$s=Oi.FreehandHandleData,el=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:tl(),svgCursor:Ao};return(e=u()(this,f()(t).call(this,n,r))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.referencedToolName=e.initialConfiguration.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(Er()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(Er()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,r=this.configuration;if(!O(n,this.referencedToolName).data[r.currentTool])return!1;if(this._active){var o=t.canvasContext.canvas.getContext("2d"),a={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};dn(o,t,this.configuration.mouseLocation.handles,a)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,r=O(n.element,this.referencedToolName);if(r){var o=r.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,o),y.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,r=this.configuration;this._active=!1,gt.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),r.mouseUpRender=!0,this._deactivateSculpt(n),y.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,r=n.element,o=n.canvasContext.canvas.getContext("2d"),a=O(r,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=gt.mousePositionImage;var i=Tt(r,this.referencedToolName).distanceFromPointCanvas(r,a,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=i;i=this._limitCursorRadiusCanvas(n,i),s>this.configuration.hoverCursorFadeDistance*i&&(o.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:i};dn(o,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(o.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,r=this._getClosestFreehandToolOnElement(n,e);void 0!==r&&(t.currentTool=r,Et(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=O(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var r=0;r<n.length;r++)n[r].active=r===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,r=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,gt.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(r,n.currentTool),this._activateSculpt(r),y.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:Math.max(this._toolSizeImage,2*n.minSpacing)};var r=this._pushHandles();void 0!==r.first&&(this._insertNewHandles(r),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,r=e.toolSize,o={},a=0;a<t.length;a++){var i=y.cornerstoneMath.point.distance(t[a],n);i>r||(this._pushOneHandle(a,i),void 0===o.first?(o.first=a,o.last=a):o.last=a)}return o}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,r=n.points,o=n.mousePoint,a=n.toolSize,i=n.image,s=r[e],l=(s.x-o.x)/t,c=(s.y-o.y)/t,u={x:o.x+a*l,y:o.y+a*c};In(u,i),s.x=u.x,s.y=u.y;var d=this.constructor._getPreviousHandleIndex(e,r.length);r[d].lines.pop(),r[d].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,r=0;r<t.length;r++){var o=t[r]+1+n;this._insertHandleRadially(o),n++}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,r=t.maxSpacing,o=[],a=e.first;a<=e.last;a++)this._checkSpacing(a,n,o,r);var i=this.constructor._getNextHandleIndex(e.last,n.length);if(i!==e.first){this._checkSpacing(i,n,o,r);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==i&&this._checkSpacing(s,n,o,r)}return o}},{key:"_checkSpacing",value:function(e,t,n,r){var o=this.constructor._getNextHandleIndex(e,t.length);y.cornerstoneMath.point.distance(t[e],t[o])>r&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,r=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),o=this._getInsertPosition(e,n,r),a=new $s(o);t.splice(e,0,a),t[n].lines.pop(),t[n].lines.push(t[e]),Oi.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(this._sculptData.points.length<=3)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,r=[],o=t.length,a=0;a<o;a++){var i=this.constructor._getNextHandleIndex(a,t.length);if(y.cornerstoneMath.point.distance(t[a],t[i])<n){var s=[a,i];r.push(s),0===a&&(o-=1),a++}}return r}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0;n<e.length;n++){var r=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(r),t++}var o=this._findCloseHandlePairs();o.length&&this._mergeCloseHandles(o)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,r=t.image,o={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};In(o,r),n[e[0]].x=o.x,n[e[0]].y=o.y;var a=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[a]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,r=n.currentTool,o=e.currentPoints.image,a=O(t,this.referencedToolName).data[r],i=Tt(t,this.referencedToolName),s=i.distanceFromPoint(t,a,o),l=i.distanceFromPointCanvas(t,a,o);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,In(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;O(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=O(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var r=0;r<n.data.length;r++)n.data[r].active=!1;St(this.element,this.svgCursor),y.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.element,o=e.image,a=this.configuration,i=O(r,this.referencedToolName).data[a.currentTool],s=1;if(n){var l=y.cornerstone.pixelToCanvas(r,{x:0,y:0}),c=y.cornerstone.pixelToCanvas(r,{x:o.width,y:o.height});s=(c.x-l.x)*(c.y-l.y)/(o.width*o.height)}var u=i.area*s,d=Math.pow(u/Math.PI,.5);return Math.min(t,d)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=Tt(e,this.referencedToolName),r=O(e,this.referencedToolName);if(r){for(var o=r.data,a=t.currentPoints.image,i={distance:1/0,toolIndex:null},s=0;s<o.length;s++){var l=n.distanceFromPoint(e,o[s],a);-1!==l&&l<i.distance&&(i.distance=l,i.toolIndex=s)}return i.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var r,o=this._sculptData,a=o.points,i=o.toolSize,s=o.mousePoint,l=o.image,c={x:(a[t].x+a[n].x)/2,y:(a[t].y+a[n].y)/2},u=y.cornerstoneMath.point.distance(s,c);if(u<i){var d={x:(c.x-s.x)/u,y:(c.y-s.y)/u};r={x:s.x+i*d.x,y:s.y+i*d.y}}else r=c;return In(r,l),r}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,y.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,y.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(pr);function tl(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:un.getActiveColor(),hoverColor:un.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}var nl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:Ro};return(e=u()(this,f()(t).call(this,n,r))).zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(Er()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(Er()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(Er()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(Er()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(Er()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(Er()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(Er()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(Er()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(Er()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(Er()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(Er()(e)),e.newImageCallback=e._drawMagnificationTool.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame((function(){return t._drawMagnificationTool(e)})),Et(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;St(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var r=t.querySelector("canvas:not(.magnifyTool)"),o=Pn(n),a=y.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),i=Math.min(this.configuration.magnifySize,r.width,r.height),s=this.configuration.magnificationLevel;n.width=i,n.height=i,a.x=Math.max(a.x,.5*i/s),a.x=Math.min(a.x,r.width-.5*i/s),a.y=Math.max(a.y,.5*i/s),a.y=Math.min(a.y,r.height-.5*i/s);var l={x:a.x*s-.5*i,y:a.y*s-.5*i};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),o.drawImage(this.zoomCanvas,l.x,l.y,i,i,0,0,i,i);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(a.y-.5*i-c,0),left:Math.max(a.x-.5*i,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,r.height-d.height),u.left=Math.min(u.left,r.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=y.cornerstone.getEnabledElement(t));var r=this.configuration.magnificationLevel,o=n.canvas,a=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=o.width*r,this.zoomElement.height=o.height*r,y.cornerstone.enable(this.zoomElement,n.options));var i=y.cornerstone.getEnabledElement(this.zoomElement),s=y.cornerstone.getViewport(n.element);this.zoomCanvas=i.canvas,this.zoomCanvas.width=o.width*r,this.zoomCanvas.height=o.height*r,i.viewport=Object.assign({},s),s.scale*=r,y.cornerstone.displayImage(this.zoomElement,a),y.cornerstone.setViewport(this.zoomElement,s)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(y.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}]),t}(pr),rl=xt.globalConfiguration,ol=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},o=Object.assign(r,n);return(e=u()(this,f()(t).call(this,o))).initialConfiguration=o,e}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"setupRender",value:function(e){if(e){var t=y.cornerstone.metaData.get("overlayPlaneModule",e.imageId);if(t&&t.overlays&&t.overlays.length)return t}}},{key:"setupViewport",value:function(e){if(void 0===e.overlayColor&&(e.overlayColor=rl.configuration.overlayColor||"white"),!1!==e.overlayColor)return!0}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.enabledElement,r=t.image,o=t.viewport,a=t.canvasContext,i=this.setupRender(r);if(t&&n&&i&&this.setupViewport(o)){var s=r.columns,l=r.rows;i.overlays.forEach((function(e){if(!1!==e.visible){var t=document.createElement("canvas");t.width=s,t.height=l;var n=t.getContext("2d");n.fillStyle=e.fillStyle||o.overlayColor,"R"===e.type&&(n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation="xor");for(var r=0,i=0;i<e.rows;i++)for(var c=0;c<e.columns;c++)e.pixelData[r++]>0&&n.fillRect(c,i,1,1);var u=!isNaN(parseFloat(e.x))&&isFinite(e.x)?e.x:0,d=!isNaN(parseFloat(e.y))&&isFinite(e.y)?e.y:0;a.drawImage(t,u,d)}}))}}}]),t}(pr),al={getOrientationString:function(e){for(var t=en(e),n="",r=t.x<0?"R":"L",o=t.y<0?"A":"P",a=t.z<0?"F":"H",i=new y.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=1e-4,l=0;l<3;l++)if(i.x>s&&i.x>i.y&&i.x>i.z)n+=r,i.x=0;else if(i.y>s&&i.y>i.x&&i.y>i.z)n+=o,i.y=0;else if(i.z>s&&i.z>i.x&&i.z>i.y)n+=a,i.z=0;else if(i.x>s&&i.y>s&&i.x===i.y)n+=r+o,i.x=0,i.y=0;else if(i.x>s&&i.z>s&&i.x===i.z)n+=r+a,i.x=0,i.z=0;else{if(!(i.y>s&&i.z>s&&i.y===i.z))break;n+=o+a,i.y=0,i.z=0}return n},invertOrientationString:function(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},il=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){var t=y.cornerstone;t.getEnabledElement(e).image&&t.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Pn(t.canvasContext.canvas),r=t.element,o=cl(r);if(o){var a=ul(r,o),i=un.getToolColor(),s={top:bn(n,o.top,0),left:bn(n,o.left,0),right:bn(n,o.right,0),bottom:bn(n,o.bottom,0),height:bn(n,"M",0)};sl(n,o,a,s,i),this.configuration.drawAllMarkers&&ll(n,o,a,s,i)}}}]),t}(pr),sl=function(e,t,n,r,o){wn(e,t.top,n.top.x-r.top/2,n.top.y,o),wn(e,t.left,n.left.x-r.left/2,n.left.y,o)},ll=function(e,t,n,r,o){wn(e,t.right,n.right.x-r.right,n.right.y,o),wn(e,t.bottom,n.bottom.x-r.bottom/2,n.bottom.y-r.height,o)},cl=function(e){var t=y.cornerstone,n=t.getEnabledElement(e),r=t.metaData.get("imagePlaneModule",n.image.imageId);if(r&&r.rowCosines&&r.columnCosines){var o=al.getOrientationString(r.rowCosines),a=al.getOrientationString(r.columnCosines),i=al.invertOrientationString(o);return{top:al.invertOrientationString(a),bottom:a,left:i,right:o}}},ul=function(e){var t=y.cornerstone.getEnabledElement(e);return{top:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:5}),bottom:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:t.image.height-15}),left:y.cornerstone.pixelToCanvas(e,{x:5,y:t.image.height/2}),right:y.cornerstone.pixelToCanvas(e,{x:t.image.width-10,y:t.image.height/2})}},dl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return(e=u()(this,f()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport;if(t.numPointers===this.configuration.touchPointers){var o=this._getTranslation(t);this._applyTranslation(r,o),y.cornerstone.setViewport(n,r)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,o=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/o,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(pr),fl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_o};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._dragCallback.bind(Er()(e)),e.mouseDragCallback=e._dragCallback.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=this._getTranslation(t);this._applyTranslation(r,o),y.cornerstone.setViewport(n,r)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,o=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/o,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(pr),hl=n(11),pl=n.n(hl),ml=n(13),vl=n.n(ml),gl=function(e,t,n,r){var o=y.cornerstone,a=o.getEnabledElement(n).image,i=o.getEnabledElement(r).image;if(a&&i){var s=o.metaData.get("imagePlaneModule",a.imageId),l=o.metaData.get("imagePlaneModule",i.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=en(s.rowCosines),s.columnCosines=en(s.columnCosines),s.imagePositionPatient=en(s.imagePositionPatient),l.rowCosines=en(l.rowCosines),l.columnCosines=en(l.columnCosines),l.imagePositionPatient=en(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!((d=Math.abs(d))<.5)){var f=function(e,t){var n=rn(e,t);if(n)return{start:tn(n.start,e),end:tn(n.end,e)}}(s,l);if(f){var h=un.getActiveColor();e.setTransform(1,0,0,1,0,0),Wt(e,(function(e){Qt(e,t.element,f.start,f.end,{color:h})}))}}}}},yl=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function xl(e){try{var t=y.cornerstone.getEnabledElement(e);return t.image?t:yl(250).then((function(){return xl(e)}))}catch(e){return null}}var bl=B("tools:ReferenceLinesTool"),wl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:gl}};return(e=u()(this,f()(t).call(this,n,r))).renderer=null,e.synchronizationContext=null,e}var n;return p()(t,e),l()(t,[{key:"enabledCallback",value:(n=vl()(pl.a.mark((function e(t){var n,r,o,a=arguments;return pl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},r=n.synchronizationContext,o=this.configuration.renderer,e.next=4,xl(t);case 4:if(e.sent&&o&&r){e.next=8;break}return bl.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=o,this.synchronizationContext=r,this.forceImageUpdate(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var r=this.synchronizationContext.getSourceElements(),o=Pn(n.canvasContext.canvas);y.cornerstone.setToPixelCoordinateSystem(n.enabledElement,o),r.forEach((function(r){r!==e.currentTarget&&t.renderer(o,n,e.currentTarget,r)}))}}}]),t}(pr),Tl=function(e,t,n){var r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(r,2)+Math.pow(o,2)-Math.pow(a,2))/(2*r*o))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},Il=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Rotate",strategies:{default:Sl,horizontal:El,vertical:Cl},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:No};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(pr);function Sl(e){var t=this.configuration,n=t.roundAngles,r=t.rotateScale,o=e.detail,a=o.element,i=o.viewport,s=o.startPoints,l=o.currentPoints,c=i.initialRotation?i.initialRotation:i.rotation,u=a.getBoundingClientRect(a),d=a.clientWidth,f=a.clientHeight,h=i.scale,p=i.translation,m={x:u.left+d/2+p.x*h,y:u.top+f/2+p.y*h},v=Tl(m,s.client,l.client);v.angle*=r,n&&(v.angle=Math.ceil(v.angle)),v.direction<0&&(v.angle=-v.angle),i.rotation=c+v.angle}function El(e){var t=this.configuration,n=t.roundAngles,r=t.flipHorizontal,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.x,d=(l.client.x-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}function Cl(e){var t=this.configuration,n=t.roundAngles,r=t.flipVertical,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.y,d=(l.client.y-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}var Al=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=t.rotation;r.rotation+=o,y.cornerstone.setViewport(n,r)}}]),t}(pr),Ml=B("tools:ScaleOverlayTool"),Pl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Pn(t.canvasContext.canvas),r=t.image,o=t.viewport,a=t.element,i=r.rowPixelSpacing,s=r.columnPixelSpacing,l=y.cornerstone.metaData.get("imagePlaneModule",r.imageId);if(l&&(i=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),i&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/i*o.scale,d=10/s*o.scale,f=Dl(c,.25,.05),h=Dl(c,.05,.15);if(c.width&&c.height&&f&&h){var p=un.getToolColor(),m=Zt.getToolWidth(),v=Object.assign({},{hscaleBounds:f,vscaleBounds:h,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:h.bottomRight.x,y:h.topLeft.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},horizontalLine:{start:{x:f.topLeft.x,y:f.bottomRight.y},end:{x:f.bottomRight.x,y:f.bottomRight.y}},color:p,lineWidth:m},this.configuration);Wt(n,(function(e){kn(e,v),Qt(e,a,v.verticalLine.start,v.verticalLine.end,{color:v.color,lineWidth:v.lineWidth},"canvas"),kl(e,a,v),Qt(e,a,v.horizontalLine.start,v.horizontalLine.end,{color:v.color,lineWidth:v.lineWidth},"canvas"),Ol(e,a,v)}))}}else Ml.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(pr),Dl=function(e,t,n){var r=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),a={left:r,top:o,width:e.width-2*r,height:e.height-2*o};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},kl=function(e,t,n){for(var r=0;n.verticalLine.start.y+r*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var o=n.color,a=n.lineWidth,i={x:n.verticalLine.start.x,y:n.verticalLine.start.y+r*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+r*n.verticalMinorTick};s.x=r%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Qt(e,t,i,s,{color:o,lineWidth:a},"canvas"),r++}},Ol=function(e,t,n){for(var r=0;n.horizontalLine.start.x+r*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var o=n.color,a=n.lineWidth,i={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:0};s.y=r%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Qt(e,t,i,s,{color:o,lineWidth:a},"canvas"),r++}},Ll=function(e,t){var n=O(e,"stack");if(n&&n.data&&n.data.length){var r,o=y.cornerstone;if(n.data.length>1){var a=O(e,"stackRenderer");a&&a.data&&a.data.length&&(r=a.data[0])}var i=n.data[0];t<0&&(t+=i.imageIds.length);var s=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);if(t!==i.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-i.currentImageIdIndex};i.currentImageIdIndex=t;var d=i.imageIds[t];(Boolean(i.preventCache)?o.loadImage(d):o.loadAndCacheImage(d)).then((function(a){if(i.currentImageIdIndex===t){try{o.getEnabledElement(e)}catch(e){return}r?(r.currentImageIdIndex=t,r.render(e,n.data)):o.displayImage(e,a),l&&l(e,a)}}),(function(n){var r=i.imageIds[t];c&&c(e,r,n)})),T(e,w.STACK_SCROLL,u)}}},Rl=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=O(e,"stack");if(o&&o.data&&o.data.length){var a=o.data[0];a.pending||(a.pending=[]);var i=a.currentImageIdIndex+t;if(n?i%=a.imageIds.length:i=Cn(i,0,a.imageIds.length-1),r)Ll(e,i);else{var s={index:i};a.pending.push(s),_l(a,s,e)}}};function _l(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index)return e.pending.splice(e.pending.indexOf(t),1),void(e.pending.length>0&&_l(e,e.pending[0],n));n.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,(function r(o){e.imageIds.indexOf(o.detail.image.imageId)===t.index&&(e.pending.splice(e.pending.indexOf(t),1),n.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,r),e.pending.length>0&&_l(e,e.pending[0],n))})),Ll(n,t.index)}}var Nl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,r=t.element,o=this.configuration,a=o.loop,i=o.allowSkipping,s=o.invert;Rl(r,s?-n:n,a,i)}}]),t}(pr),Ul=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return(e=u()(this,f()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,r=t.deltaPoints,o=this.configuration,a=o.loop,i=o.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,r.page.y);if(!l)return;if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,a,i),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(pr),Bl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:Uo};return(e=u()(this,f()(t).call(this,n,r))).mouseDragCallback=e._dragCallback.bind(Er()(e)),e.touchDragCallback=e._dragCallback.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.deltaPoints,o=this.configuration,a=o.loop,i=o.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,r.page.y);if(l){if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,a,i),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(pr),jl=function(e,t,n,r,o){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var a,i,s,l=y.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(i=0;i<o;i++)for(s=0;s<r;s++){var f=d[a=4*((i+n)*l.columns+(s+t))],h=d[a+1],p=d[a+2];c[u++]=.2126*f+.7152*h+.0722*p}else for(i=0;i<o;i++)for(s=0;s<r;s++)a=(i+n)*l.columns+(s+t),c[u++]=d[a]*l.slope+l.intercept;return c},Fl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:Bo};return(e=u()(this,f()(t).call(this,n,r)))._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(Er()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(Er()(e)),e.touchEndCallback=e._applyStrategy.bind(Er()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(Er()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(Er()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(Er()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(Er()(e)),e.mouseUpCallback=e._applyStrategy.bind(Er()(e)),e}return p()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,o=un.getColorIfActive({active:!0}),a=Pn(n.canvasContext.canvas);Wt(a,(function(e){Mn(e,r,t.handles.start,t.handles.end,{color:o})}))}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Vl(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,y.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){Vl(this.handles.start)||Vl(this.handles.end)||(e.detail.handles=this.handles,Hl(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(pr),Vl=function(e){return 0===Object.keys(e).length&&e.constructor===Object},Hl=function(e,t){var n=e.detail,r=n.image,o=n.element,a=e.detail.handles,i=a.start,s=a.end,l=Math.min(i.x,s.x),c=Math.min(i.y,s.y),u=Math.abs(i.x-s.x),d=Math.abs(i.y-s.y);l=Cn(l,0,r.width),c=Cn(c,0,r.height),u=Math.floor(Math.min(u,Math.abs(r.width-l))),d=Math.floor(Math.min(d,Math.abs(r.height-c)));var f=jl(o,l,c,u,d),h=zl(f,r.minPixelValue,r.maxPixelValue),p=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),p.voi.windowWidth=Math.max(Math.abs(h.max-h.min),t.minWindowWidth),p.voi.windowCenter=h.mean,p.voiLUT=void 0,y.cornerstone.setViewport(o,p),y.cornerstone.updateImage(o)},zl=function(e,t,n){var r=e.length,o=n,a=t,i=0;if(r<2)return{min:o,max:a,mean:(t+n)/2};for(var s=0;s<r;s++){var l=e[s];o=Math.min(o,l),a=Math.max(a,l),i+=l}return{min:o,max:a,mean:i/r}},ql=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Wwwc",strategies:{basicLevelingStrategy:Wl},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:jo};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(pr);function Wl(e){var t=this.configuration.orientation,n=e.detail,r=(n.image.maxPixelValue*n.image.slope+n.image.intercept-(n.image.minPixelValue*n.image.slope+n.image.intercept))/1024,o=n.deltaPoints.page.x*r,a=n.deltaPoints.page.y*r;0===t?(n.viewport.voi.windowWidth+=o,n.viewport.voi.windowCenter+=a):(n.viewport.voi.windowWidth+=a,n.viewport.voi.windowCenter+=o),n.viewport.voiLUT=void 0}var Gl=function(e,t,n){var r=n.maxScale,o=n.minScale,a=Math.log(e.scale)/Math.log(1.7)+t,i=Math.pow(1.7,a);return e.scale=r&&i>r?r:o&&i<o?o:i,e},Yl={changeViewportScale:Gl,correctShift:function(e,t){var n=t.hflip,r=t.vflip,o=t.rotation;if(e.x*=n?-1:1,e.y*=r?-1:1,0!==o){var a=o*Math.PI/180,i=Math.cos(a),s=Math.sin(a),l=e.x*i-e.y*s,c=e.x*s+e.y*i;e.x=l,e.y=c}return e}},Zl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=t.spinY,a=this.configuration,i=a.invert,s=a.maxScale,l=a.minScale,c=Gl(r,i?o/4:-o/4,{maxScale:s,minScale:l});y.cornerstone.setViewport(n,c)}}]),t}(pr),Xl=Yl.correctShift,Ql=Yl.changeViewportScale,Kl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Zoom",strategies:{default:$l,translate:ec,zoomToCenter:tc},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:Fo};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){Jl.call(this,e)}},{key:"mouseDragCallback",value:function(e){Jl.call(this,e)}}]),t}(pr),Jl=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function $l(e){var t=this.configuration,n=t.invert,r=t.maxScale,o=t.minScale,a=e.detail.deltaPoints.page.y,i=n?-a/100:a/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],f=u[1],h=u[2],p=u[3],m=Ql(c,i,{maxScale:r,minScale:o});y.cornerstone.setViewport(l,m);var v=y.cornerstone.pageToPixel(l,d,f),g={x:h-v.x,y:p-v.y};g=Xl(g,m),c.translation.x-=g.x,c.translation.y-=g.y}function ec(e){var t=this.configuration,n=t.invert,r=t.preventZoomOutsideImage,o=t.maxScale,a=t.minScale,i=e.detail.deltaPoints.page.y,s=n?-i/100:i/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],f=u[1],h=Ql(c,s,{maxScale:o,minScale:a}),p={x:0,y:0};if(s<0)h.scale<3&&(Math.abs(h.translation.x)<.01?h.translation.x=0:p.x=h.translation.x/8,Math.abs(h.translation.y)<.01?h.translation.y=0:p.y=h.translation.y/8);else{r&&In(e.detail.startPoints.image,l);var m={x:l.width/2-d,y:l.height/2-f};m=Xl(m,h);var v={x:h.translation.x-m.x,y:h.translation.y-m.y};Math.abs(v.x)<.01?h.translation.x=m.x:p.x=v.x/8,Math.abs(v.y)<.01?h.translation.y=m.y:p.y=v.y/8}h.translation.x-=p.x,h.translation.y-=p.y}function tc(e){var t=this.configuration,n=t.invert,r=t.maxScale,o=t.minScale,a=e.detail.deltaPoints.page.y,i=n?-a/100:a/100,s=e.detail.viewport;Ql(s,i,{maxScale:r,minScale:o})}var nc=Yl.correctShift,rc=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=t.scaleChange,a=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],i=a[0],s=a[1],l=a[2],c=a[3],u=this.configuration,d=u.maxScale,f=u.minScale;r.scale+=o*r.scale,d&&r.scale>d?r.scale=d:f&&r.scale<f&&(r.scale=f),y.cornerstone.setViewport(n,r);var h=y.cornerstone.pageToPixel(n,i,s),p={x:l-h.x,y:c-h.y};p=nc(p,r),r.translation.x-=p.x,r.translation.y-=p.y,y.cornerstone.setViewport(n,r)}}]),t}(pr),oc=function(e){return{page:ac(e.page),image:ac(e.image),client:ac(e.client),canvas:ac(e.canvas)}};function ac(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{x:e.x,y:e.y}}var ic,sc=B("eventListeners:mouseEventListeners"),lc=!0,cc=new Map;function uc(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function dc(){lc=!1}function fc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var r=w.MOUSE_DOUBLE_CLICK,o={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=y.cornerstone.pixelToCanvas(t,o.image);var a=oc(o);sc.log("double-click: %o",uc(e)),T(t,r,{event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:a,currentPoints:o,deltaPoints:{x:0,y:0},type:r})}}function hc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){ic=setTimeout(dc,200),t.removeEventListener("mousemove",pc);var r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var o=oc(r),a={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:r,deltaPoints:{x:0,y:0},type:w.MOUSE_DOWN};T(a.element,w.MOUSE_DOWN,a)&&(a.type=w.MOUSE_DOWN_ACTIVATE,T(a.element,w.MOUSE_DOWN_ACTIVATE,a)),document.addEventListener("mousemove",i),document.addEventListener("mouseup",s),cc.set(i,"mousemove"),cc.set(s,"mouseup")}function i(e){var a=w.MOUSE_DRAG,i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,o.page),image:y.cornerstoneMath.point.subtract(i.image,o.image),client:y.cornerstoneMath.point.subtract(i.client,o.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,o.canvas)};sc.log("mousemove: %o",uc(e));var l={buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:i,deltaPoints:s,type:a,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};T(l.element,a,l),o=oc(i)}function s(e){clearTimeout(ic);var a=w.MOUSE_UP;lc&&(a=w.MOUSE_CLICK);var l={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=y.cornerstone.pixelToCanvas(t,l.image);var c={page:y.cornerstoneMath.point.subtract(l.page,o.page),image:y.cornerstoneMath.point.subtract(l.image,o.image),client:y.cornerstoneMath.point.subtract(l.client,o.client),canvas:y.cornerstoneMath.point.subtract(l.canvas,o.canvas)};sc.log("mouseup: %o",uc(e));var u={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:l,deltaPoints:c,type:a};T(u.element,a,u),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s),cc.delete(i),cc.delete(s),t.addEventListener("mousemove",pc),lc=!0}}function pc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var r=w.MOUSE_MOVE,o={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=y.cornerstone.pixelToCanvas(t,o.image);var a=oc(o),i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,a.page),image:y.cornerstoneMath.point.subtract(i.image,a.image),client:y.cornerstoneMath.point.subtract(i.client,a.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,a.canvas)};T(t,r,{viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:a,currentPoints:i,deltaPoints:s,type:r}),a=oc(i)}}function mc(e){e.removeEventListener("mousedown",hc),e.removeEventListener("mousemove",pc),e.removeEventListener("dblclick",fc),cc.forEach((function(e,t){document.removeEventListener(e,t)})),cc.clear()}var vc={enable:function(e){mc(e),e.addEventListener("mousedown",hc),e.addEventListener("mousemove",pc),e.addEventListener("dblclick",fc)},disable:mc};function gc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image&&!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var r=e.pageX,o=e.pageY,a=y.cornerstone.pageToPixel(t,r,o),i=function(e){var t=0,n=0,r=0,o=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),r=10*t,o=10*n,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||o)&&e.deltaMode&&(1===e.deltaMode?(r*=40,o*=40):(r*=800,o*=800)),r&&!t&&(t=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:o}}(e),s=i.spinX,l=i.spinY,c=i.pixelX,u=i.pixelY,d=l<0?-1:1,f={element:t,viewport:y.cornerstone.getViewport(t),detail:e,image:n.image,direction:d,spinX:s,spinY:l,pixelX:c,pixelY:u,pageX:r,pageY:o,imageX:a.x,imageY:a.y};T(t,w.MOUSE_WHEEL,f)}}function yc(e){e.removeEventListener("wheel",gc,{passive:!1})}var xc,bc,wc={enable:function(e){yc(e),e.addEventListener("wheel",gc,{passive:!1})},disable:yc},Tc=0,Ic=1;function Sc(e,t){var n=Date.now();if(e!==xc){if(n-bc<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;xc=e}bc=n}var Ec=Sc.bind(null,Tc),Cc=Sc.bind(null,Ic);function Ac(e,t,n){var r=n?Ec:Cc;t.forEach((function(t){e.addEventListener(t,r,{passive:!1})}))}function Mc(e,t,n){var r=n?Ec:Cc;t.forEach((function(t){e.removeEventListener(t,r)}))}var Pc=["mousedown","mouseup"],Dc=["touchstart","touchend"];function kc(e){Mc(e,Pc,Tc),Mc(e,Dc,Ic)}var Oc,Lc,Rc,_c,Nc,Uc,Bc,jc,Fc,Vc={enable:function(e){kc(e),Ac(e,Pc,Tc),Ac(e,Dc,Ic)},disable:kc},Hc=1,zc=0,qc=!1,Wc=!1;function Gc(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var r,o,a,i;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(Wc=!1,clearTimeout(Bc)),e.type){case"tap":Wc=!1,clearTimeout(Bc),(Lc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),r=w.TAP,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Lc,type:r,isTouchEvent:!0},T(t,r,Nc);break;case"doubletap":Wc=!1,clearTimeout(Bc),(Lc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),r=w.DOUBLE_TAP,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Lc,type:r,isTouchEvent:!0},T(t,r,Nc);break;case"pinchstart":Wc=!1,clearTimeout(Bc),Hc=1;break;case"pinchmove":if(Wc=!1,clearTimeout(Bc),!0===qc){Hc=e.scale,qc=!1;break}o=(e.scale-Hc)/Hc,(Oc={page:e.center,image:y.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),r=w.TOUCH_PINCH,Nc={event:e,startPoints:Oc,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:o,type:r,isTouchEvent:!0},T(t,r,Nc),Hc=e.scale;break;case"touchstart":Hc=1,clearTimeout(Bc),clearTimeout(Uc),Uc=setTimeout((function(){(Oc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),r=w.TOUCH_START,e.touches.length>1&&(r=w.MULTI_TOUCH_START),Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,currentPoints:Oc,type:r,isTouchEvent:!0},!0===T(t,r,Nc)&&(r=w.TOUCH_START_ACTIVE,e.touches.length>1&&(r=w.MULTI_TOUCH_START_ACTIVE),Nc.type=r,T(t,r,Nc)),Rc=oc(Oc)}),50),Wc=!0,jc=0,Bc=setTimeout((function(){Wc&&((Lc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),r=w.TOUCH_PRESS,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Lc,type:r,isTouchEvent:!0},T(t,r,Nc))}),700);break;case"touchend":Hc=1,Wc=!1,clearTimeout(Bc),setTimeout((function(){(Oc={page:y.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:y.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),r=w.TOUCH_END,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,currentPoints:Oc,type:r,isTouchEvent:!0},T(t,r,Nc)}),50);break;case"panmove":a={x:e.deltaX-Fc.x,y:e.deltaY-Fc.y},Fc={x:e.deltaX,y:e.deltaY},(Lc={page:{x:Rc.page.x+a.x,y:Rc.page.y+a.y},image:y.cornerstone.pageToPixel(t,Rc.page.x+a.x,Rc.page.y+a.y),client:{x:Rc.client.x+a.x,y:Rc.client.y+a.y}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),_c={page:y.cornerstoneMath.point.subtract(Lc.page,Rc.page),image:y.cornerstoneMath.point.subtract(Lc.image,Rc.image),client:y.cornerstoneMath.point.subtract(Lc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(Lc.canvas,Rc.canvas)},(jc+=Math.sqrt(_c.page.x*_c.page.x+_c.page.y*_c.page.y))>5&&(Wc=!1,clearTimeout(Bc)),r=w.TOUCH_DRAG,e.pointers.length>1&&(r=w.MULTI_TOUCH_DRAG),Nc={viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,lastPoints:Rc,currentPoints:Lc,deltaPoints:_c,numPointers:e.pointers.length,type:r,isTouchEvent:!0},T(t,r,Nc),Rc=oc(Lc);break;case"panstart":Fc={x:e.deltaX,y:e.deltaY},(Lc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),Rc=oc(Lc);break;case"panend":if(Wc=!1,clearTimeout(Bc),!Rc)return!1;(Lc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),_c={page:y.cornerstoneMath.point.subtract(Lc.page,Rc.page),image:y.cornerstoneMath.point.subtract(Lc.image,Rc.image),client:y.cornerstoneMath.point.subtract(Lc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(Lc.canvas,Rc.canvas)},r=w.TOUCH_DRAG_END,Nc={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oc,lastPoints:Rc,currentPoints:Lc,deltaPoints:_c,type:r,isTouchEvent:!0},T(t,r,Nc),2==e.pointers.length-e.changedPointers.length&&(qc=!0);break;case"rotatemove":Wc=!1,clearTimeout(Bc),i=e.rotation-zc,zc=e.rotation,r=w.TOUCH_ROTATE,Nc={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,rotation:i,type:r},T(t,r,Nc)}return!1}}function Yc(e){Vc.disable(e),["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,Gc)}));var t=Ws("touchInput",e),n=t.hammer;n&&(n.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),n.input.destroy()),t.hammer=null,function(e,t){var n=qs[e];n&&(qs[e]=n.filter((function(e){return e.element!==t})))}("touchInput",e)}var Zc={enable:function(e){Yc(e);var t=y.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},r=new t.Manager(e,n),o={pointers:0,direction:t.DIRECTION_ALL,threshold:0},a=new t.Pan(o),i=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});i.recognizeWith(a),i.recognizeWith(s),s.recognizeWith(a);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(a),r.add([l,a,s,i]),r.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),Vc.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,Gc,{passive:!1})}));var c=Ws("touchInput",e);c.hammer=r,Gs("touchInput",e,c)},disable:Yc},Xc=bt("segmentation");function Qc(e,t,n,r,o){!function(e,t,n){var r=Xc.configuration,o=e.detail,a=Pn(o.canvasContext.canvas),i=y.cornerstone.pixelToCanvas(o.element,{x:0,y:0}),s=y.cornerstone.pixelToCanvas(o.element,{x:o.image.width,y:0}),l=y.cornerstone.pixelToCanvas(o.element,{x:o.image.width,y:o.image.height}),c=y.cornerstoneMath.point.distance(i,s),u=y.cornerstoneMath.point.distance(s,l),d=o.canvasContext.canvas,f=o.viewport,h=a.imageSmoothingEnabled,p=a.globalAlpha;a.imageSmoothingEnabled=!1,a.globalAlpha=n?r.fillAlpha:r.fillAlphaInactive,function(e,t,n){if(n.hflip||n.vflip||n.rotation){var r={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(r.x,r.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-r.x,-r.y)}}(a,d,f);var m=function(e){var t=e.viewport,n=e.image,r=t.scale,o=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(o*=n.rowPixelSpacing/n.columnPixelSpacing),{x:t.translation.x*r,y:t.translation.y*o}}(o);a.drawImage(t,d.width/2-c/2+m.x,d.height/2-u/2+m.y,c,u),a.globalAlpha=p,a.imageSmoothingEnabled=h,function(e){e.setTransform(1,0,0,1,0,0)}(a)}(e,function(e,t,n){var r=Xc.state,o=e.detail.image,a=o.width,i=o.height,s=t.segmentsHidden,l=n.pixelData,c=r.colorLutTables[t.colorLUTIndex],u=document.createElement("canvas");u.width=a,u.height=i;for(var d=Pn(u),f=new ImageData(a,i),h=f.data,p=0;p<l.length;p++){var m=l[p];if(0!==m&&!s[m]){var v=c[l[p]];h[4*p]=v[0],h[4*p+1]=v[1],h[4*p+2]=v[2],h[4*p+3]=v[3]}}return d.putImageData(f,0,0),u}(e,t,n),o)}var Kc=bt("segmentation");function Jc(e,t,n,r,o){!function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Kc.configuration,a=Kc.state,i=e.detail,s=i.element,l=i.canvasContext,c=o.outlineWidth||1,u=Pn(l.canvas),d=a.colorLutTables[n],f=u.globalAlpha;u.globalAlpha=r?o.outlineAlpha:o.outlineAlphaInactive,Wt(u,(function(e){for(var n=1;n<t.length;n++)if(t[n]){var r=d[n];fn(e,s,t[n],{color:"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 1.0 )"),lineWidth:c},"canvas")}})),u.globalAlpha=f}(e,function(e,t,n,r){var o=e.detail,a=o.element,i=o.image,s=o.viewport,l=i.width,c=i.height;r=r||1;var u,d=t.segmentsHidden,f=n.pixelData,h=t.activeSegmentIndex,p=[];n.segmentsOnLabelmap.forEach((function(e){!d[e]&&(p[e]=[])})),p[h]||(p[h]=[]);for(var m=function(e,t){var n=t/2,r=e.rotation;r*=Math.PI/180;var o=Math.cos(r),a=Math.sin(r),i=[o,a],s=[-a,o],l={x:n*i[0],y:n*i[1]},c={x:n*s[0],y:n*s[1]};return e.hflip&&(l.x*=-1,l.y*=-1),e.vflip&&(c.x*=-1,c.y*=-1),{i:l,j:c}}(s,r),v=0;v<f.length;v++){var g=f[v];if(0!==g&&!d[g]){var y={x:(u=v)%l,y:Math.floor(u/l)},x=$c(y,c,l);void 0!==x.top&&f[x.top]===g||ou(p[g],a,y,m),void 0!==x.bottom&&f[x.bottom]===g||au(p[g],a,y,m),void 0!==x.left&&f[x.left]===g||iu(p[g],a,y,m),void 0!==x.right&&f[x.right]===g||su(p[g],a,y,m),void 0!==x.topLeft&&f[x.topLeft]!==g&&f[x.top]===g&&f[x.left]===g&&eu(p[g],a,y,m),void 0!==x.topRight&&f[x.topRight]!==g&&f[x.top]===g&&f[x.right]===g&&tu(p[g],a,y,m),void 0!==x.bottomLeft&&f[x.bottomLeft]!==g&&f[x.bottom]===g&&f[x.left]===g&&nu(p[g],a,y,m),void 0!==x.bottomRight&&f[x.bottomRight]!==g&&f[x.bottom]===g&&f[x.right]===g&&ru(p[g],a,y,m)}}return p}(e,t,n,Kc.configuration.outlineWidth),t.colorLUTIndex,o)}function $c(e,t,n){var r=e.y*n+e.x,o={},a=e.y-1>=0,i=e.y+1<t,s=e.x-1>=0,l=e.x+1<n;return a&&(o.top=r-n,l&&(o.topRight=o.top+1),s&&(o.topLeft=o.top-1)),i&&(o.bottom=r+n,l&&(o.bottomRight=o.bottom+1),s&&(o.bottomLeft=o.bottom-1)),s&&(o.left=r-1),l&&(o.right=r+1),o}function eu(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,n);o.x+=r.j.x,o.y+=r.j.y;var a={x:o.x,y:o.y};a.x+=2*r.i.x,a.y+=2*r.i.y,e.push({start:o,end:a})}function tu(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y});o.x+=r.j.x,o.y+=r.j.y;var a={x:o.x,y:o.y};a.x-=2*r.i.x,a.y-=2*r.i.y,e.push({start:o,end:a})}function nu(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x,y:n.y+1});o.x-=r.j.x,o.y-=r.j.y;var a={x:o.x,y:o.y};a.x+=2*r.i.x,a.y+=2*r.i.y,e.push({start:o,end:a})}function ru(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y+1});o.x-=r.j.x,o.y-=r.j.y;var a={x:o.x,y:o.y};a.x-=2*r.i.x,a.y-=2*r.i.y,e.push({start:o,end:a})}function ou(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,n),i=o(t,{x:n.x+1,y:n.y});a.x+=r.j.x,a.y+=r.j.y,i.x+=r.j.x,i.y+=r.j.y,e.push({start:a,end:i})}function au(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,{x:n.x,y:n.y+1}),i=o(t,{x:n.x+1,y:n.y+1});a.x-=r.j.x,a.y-=r.j.y,i.x-=r.j.x,i.y-=r.j.y,e.push({start:a,end:i})}function iu(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,n),i=o(t,{x:n.x,y:n.y+1});a.x+=r.i.x,a.y+=r.i.y,i.x+=r.i.x,i.y+=r.i.y,e.push({start:a,end:i})}function su(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,{x:n.x+1,y:n.y}),i=o(t,{x:n.x+1,y:n.y+1});a.x-=r.i.x,a.y-=r.i.y,i.x-=r.i.x,i.y-=r.i.y,e.push({start:a,end:i})}var lu=bt("segmentation");function cu(e,t,n,r,o){(function(e){var t=lu.configuration;return t.renderFill&&(e&&0!==t.fillAlpha||!e&&0!==t.fillAlphaInactive)})(o)&&Qc(e,t,r,0,o),function(e){var t=lu.configuration;return t.renderOutline&&(e&&0!==t.outlineAlpha||!e&&0!==t.outlineAlphaInactive)}(o)&&Jc(e,t,r,0,o)}var uu=bt("segmentation"),du=function(e){var t=e.detail.element,n=uu.configuration,r=uu.getters.labelmaps3D(t),o=r.activeLabelmapIndex,a=r.labelmaps3D,i=r.currentImageIdIndex;a&&(n.shouldRenderInactiveLabelmaps&&function(e,t,n,r){for(var o=0;o<t.length;o++){var a=t[o];if(o!==n&&a){var i=a.labelmaps2D[r];i&&cu(e,a,0,i,!1)}}}(e,a,o,i),function(e,t,n,r){var o=t[n];if(o){var a=o.labelmaps2D[r];a&&cu(e,o,0,a,!0)}}(e,a,o,i))},fu=bt("segmentation"),hu=function(e){var t=e.detail,n=t.element,r=gt.tools.filter((function(e){return e.element===n&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)})),o=O(n,"stack"),a=fu.configuration;o&&(a.renderFill||a.renderOutline)&&du(e);var i=t.canvasContext.canvas.getContext("2d");r.forEach((function(t){t.renderToolData&&(i.save(),t.renderToolData(e),i.restore())}))},pu=function(e){e.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,hu)},mu=function(e){e.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,hu)},vu=function(e,t,n){if(gt.isToolLocked)return!1;var r=n.detail.element,o=gt.tools.filter((function(t){return t.supportedInteractionTypes.includes(e)}));if(o=(o=Ir(r,o,e)).filter((function(e){return"function"==typeof e[t]})),gt.isMultiPartToolActive&&(o=Pr(o)),0===o.length)return!1;o[0][t](n)},gu=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";return t.filter((function(t){for(var o=so(r,t.name),a=O(e,t.name),i=0;i<a.data.length;i++)if(void 0!==gr(e,a.data[i].handles,n,o))return!0;return!1}))},yu=function(e,t){return t.filter((function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)}))},xu=function(e,t){return t.filter((function(t){var n=O(e,t.name);return n&&n.data.length>0}))},bu=function(e){if(!gt.isToolLocked){var t=e.detail,n=e.detail.element,r=e.detail.currentPoints.canvas,o=yu(n,yt.mouseTools()),a=o.filter((function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}));if(gt.isMultiPartToolActive&&(a=Pr(a)),a.length>0){var i=a.find((function(e){return"function"==typeof e.preMouseDownCallback}));if(i&&i.preMouseDownCallback(e))return}if(!gt.isMultiPartToolActive){var s=xu(n,o),l=gu(n,s,r,"mouse");if(l.length>0){var c=l[0],u=O(n,c.name),d=fo(n,u,c.name,r),f=d.handle,h=d.data;c.handleSelectedCallback(e,h,f,"mouse")}else{var p=o.filter((function(e){var t=O(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,r,"mouse")}))}));if(p.length>0){var m=p[0],v=O(n,m.name).data.find((function(e){return m.pointNearTool(n,e,r)}));m.toolSelectedCallback(e,v,"mouse")}else if(a.length>0){var g=a.find((function(e){return"function"==typeof e.postMouseDownCallback}));if(g&&g.postMouseDownCallback(e))return}}}}},wu=B("eventDispatchers:mouseEventHandlers"),Tu=function(e){if(!gt.isToolLocked){var t=e.detail,n=Dr(t.element,t.buttons,"mouse");if(n){if("function"==typeof n.preMouseDownActivateCallback&&n.preMouseDownActivateCallback(e))return;gt.isMultiPartToolActive||(n.addNewMeasurement?n.addNewMeasurement(e,"mouse"):n instanceof mo&&function(e,t){wu.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,r=n.element,o=t.createNewMeasurement(n);if(o){k(r,t.name,o),y.cornerstone.updateImage(r);var a=1===Object.keys(o.handles).length?Wr:to,i=(new Date).getTime();a(n,t.name,o,o.handles.end,t.options,"mouse",(function(e){if(!o.cancelled){var n=!(!t.configuration||!Object(t.configuration).hasOwnProperty("measurementCreationThreshold"))&&(new Date).getTime()-i<t.configuration.measurementCreationThreshold;if(e&&!1===n){var a=w.MEASUREMENT_COMPLETED,s={toolName:t.name,toolType:t.name,element:r,measurementData:o};T(r,a,s)}else L(r,t.name,o)}}))}}(e,n))}}},Iu=function(e){if(!gt.isToolLocked){var t,n=e.detail,r=n.element;t=(t=(t=Ir(r,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive}))).filter((function(e){return"function"==typeof e.mouseDragCallback})),gt.isMultiPartToolActive&&(t=Pr(t)),0!==t.length&&t[0].mouseDragCallback(e)}},Su=function(e){if(!gt.isToolLocked&&!gt.isMultiPartToolActive){var t,n=e.detail,r=n.element,o=n.currentPoints;gt.mousePositionImage=o.image;var a=(t=yu(r,yt.mouseTools())).filter((function(e){return"active"===e.mode&&e.options.isMouseActive})),i=!1;a.length>0&&(i=a.some((function(e){return e.updateOnMouseMove}))),t=xu(r,t);for(var s=0;s<t.length;s++){var l=t[s];"function"==typeof l.mouseMoveCallback&&(i=l.mouseMoveCallback(e)||i)}!0===i&&y.cornerstone.updateImage(r)}},Eu=vu.bind(null,"Mouse","mouseClickCallback"),Cu=vu.bind(null,"Mouse","doubleClickCallback"),Au=vu.bind(null,"Mouse","mouseUpCallback"),Mu=vu.bind(null,"MouseWheel","mouseWheelCallback"),Pu=function(e){e.addEventListener(w.MOUSE_CLICK,Eu),e.addEventListener(w.MOUSE_DOWN,bu),e.addEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.addEventListener(w.MOUSE_DOUBLE_CLICK,Cu),e.addEventListener(w.MOUSE_DRAG,Iu),e.addEventListener(w.MOUSE_MOVE,Su),e.addEventListener(w.MOUSE_UP,Au),e.addEventListener(w.MOUSE_WHEEL,Mu)},Du=function(e){e.removeEventListener(w.MOUSE_CLICK,Eu),e.removeEventListener(w.MOUSE_DOWN,bu),e.removeEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,Cu),e.removeEventListener(w.MOUSE_DRAG,Iu),e.removeEventListener(w.MOUSE_MOVE,Su),e.removeEventListener(w.MOUSE_UP,Au),e.removeEventListener(w.MOUSE_WHEEL,Mu)},ku=function(e){if(gt.isToolLocked)return!1;var t=e.detail.element,n=gt.tools.filter((function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)}));if(0===n.length)return!1;n.forEach((function(t){t.newImageCallback&&t.newImageCallback(e)}))},Ou=function(e){e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,ku)},Lu=function(e){e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,ku)},Ru=function(e){if(gt.isToolLocked)return!1;var t=e.detail,n=t.element,r=t.numPointers,o=gt.tools.filter((function(e){return e.supportedInteractionTypes.includes("MultiTouch")}));if(o=(o=Ir(n,o,"MultiTouch")).filter((function(e){return"function"==typeof e.multiTouchDragCallback&&r===e.configuration.touchPointers})),gt.isMultiPartToolActive&&(o=Pr(o)),0===o.length)return!1;o[0].multiTouchDragCallback(e)},_u=B("eventDispatchers:touchEventHandlers"),Nu=function(e){if(!gt.isToolLocked&&!gt.isMultiPartToolActive){var t=Dr(e.detail.element,null,"touch");t&&t.addNewMeasurement?t.addNewMeasurement(e,"touch"):t instanceof mo&&function(e,t){_u.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,r=n.element,o=t.createNewMeasurement(n);if(o){if(k(r,t.name,o),1===Object.keys(o.handles).length&&n.type===w.TAP)return o.active=!1,o.handles.end.active=!1,o.handles.end.highlight=!1,o.invalidated=!0,(gt.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&wr(n,o.handles)&&L(r,t.name,o),void y.cornerstone.updateImage(r);y.cornerstone.updateImage(r),to(n,t.name,o,o.handles.end,t.options,"touch",(function(){var e=w.MEASUREMENT_COMPLETED,n={toolName:t.name,toolType:t.name,element:r,measurementData:o};T(r,e,n)}))}}(e,t)}},Uu=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&Bu(n.handles)}};function Bu(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}var ju,Fu=function(e){if(!gt.isToolLocked&&!gt.isMultiPartToolActive){var t,n=e.detail.element,r=e.detail.currentPoints.canvas;t=Ir(n,yt.touchTools());var o=(t=xu(n,t)).filter((function(e){for(var t=O(n,e.name),o=0;o<t.data.length;o++)if(void 0!==gr(n,t.data[o].handles,r,28))return!0;return!1}));if(o.length>0){var a=o[0],i=O(n,a.name),s=i.data.find((function(e){return void 0!==gr(n,e.handles,r,28)}));return i.data.active=!0,s.active=!0,y.cornerstone.updateImage(n),Wr(e.detail,a.name,i.data,s,a.options,"touch",(function(){return Uu(i)})),e.stopImmediatePropagation(),void e.preventDefault()}var l=t.filter((function(e){var t=O(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,r)}))}));if(l.length>0){var c=l[0],u=O(n,c.name),d=u.data.find((function(e){return c.pointNearTool(n,e,r)}));return d.active=!0,y.cornerstone.updateImage(n),_r(e.detail,c.name,d,null,c.options,"touch",(function(){return Uu(u)})),e.stopImmediatePropagation(),void e.preventDefault()}var f=Ir(n,yt.touchTools());return f.length>0&&f[0].touchStartActiveCallback?f[0].touchStartActiveCallback(e):Nu(e),!1}},Vu=function(e){if(!gt.isToolLocked){var t=e.detail,n=t.element,r=t.startPoints.canvas,o=yu(n,yt.touchTools()),a=o.filter((function(e){return"active"===e.mode&&e.options.isTouchActive}));if(gt.isMultiPartToolActive&&(a=Pr(a)),a.length>0){var i=a.find((function(e){return"function"==typeof e.preTouchStartCallback}));if(i&&i.preTouchStartCallback(e))return}if(!gt.isMultiPartToolActive){var s=xu(n,o),l=gu(n,s,r,"touch");if(l.length>0){var c=l[0],u=O(n,c.name),d=fo(n,u,c.name,r,"touch"),f=d.handle,h=d.data;c.handleSelectedCallback(e,h,f,"touch")}else{var p=s.filter((function(e){var t=O(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,r,"touch")}))}));if(p.length>0){var m=p[0],v=O(n,m.name).data.find((function(e){return m.pointNearTool(n,e,r)}));m.toolSelectedCallback(e,v,"touch")}else if(a.length>0){var g=a.find((function(e){return"function"==typeof e.postTouchStartCallback}));if(g&&g.postTouchStartCallback(e))return}}}}},Hu=vu.bind(null,"DoubleTap","doubleTapCallback"),zu=vu.bind(null,"Touch","touchDragCallback"),qu=vu.bind(null,"Touch","touchEndCallback"),Wu=vu.bind(null,"TouchPinch","touchPinchCallback"),Gu=vu.bind(null,"Touch","touchPressCallback"),Yu=vu.bind(null,"TouchRotate","touchRotateCallback"),Zu=function(e){e.addEventListener(w.TAP,Fu),e.addEventListener(w.TOUCH_START,Vu,{passive:!1}),e.addEventListener(w.TOUCH_DRAG,zu,{passive:!1}),e.addEventListener(w.TOUCH_END,qu),e.addEventListener(w.TOUCH_START_ACTIVE,Nu),e.addEventListener(w.TOUCH_PRESS,Gu),e.addEventListener(w.DOUBLE_TAP,Hu),e.addEventListener(w.TOUCH_PINCH,Wu),e.addEventListener(w.TOUCH_ROTATE,Yu),e.addEventListener(w.MULTI_TOUCH_DRAG,Ru)},Xu=function(e){e.removeEventListener(w.TAP,Fu),e.removeEventListener(w.TOUCH_START,Vu),e.removeEventListener(w.TOUCH_DRAG,zu),e.removeEventListener(w.TOUCH_END,qu),e.removeEventListener(w.TOUCH_START_ACTIVE,Nu),e.removeEventListener(w.TOUCH_PRESS,Gu),e.removeEventListener(w.DOUBLE_TAP,Hu),e.removeEventListener(w.TOUCH_PINCH,Wu),e.removeEventListener(w.TOUCH_ROTATE,Yu),e.removeEventListener(w.MULTI_TOUCH_DRAG,Ru)},Qu=B("addTool"),Ku=function(e,t,n){var r=new t(n);Tt(e,r.name)?Qu.warn("%s has already been added to the target element",r.name):(r.element=e,wt.state.tools.push(r))},Ju=function(e,t){$u(e,t),wt.state.enabledElements.forEach((function(n){Ku(n,e,t)}))},$u=function(e,t){if(bt("globalConfiguration").configuration.globalToolSyncEnabled){var n=new e(t);void 0!==wt.state.globalTools[n.name]?Qu.warn("%s has already been added globally",n.name):wt.state.globalTools[n.name]={tool:e,props:t,activeBindings:[]}}},ed=B("internals:addEnabledElement"),td=function(e){ed.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;pu(t),Ou(t);var n=bt("globalConfiguration").configuration;n.mouseEnabled&&(vc.enable(t),wc.enable(t),Pu(t)),n.touchEnabled&&(Zc.enable(t),Zu(t)),nd(t)},nd=function(e){wt.state.enabledElements.push(e),wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)}))}(e),function(e){bt("globalConfiguration").configuration.globalToolSyncEnabled&&Object.keys(wt.state.globalTools).forEach((function(t){var n=wt.state.globalTools[t],r=n.tool,o=n.props;Ku(e,r,o)}))}(e),function(e){if(bt("globalConfiguration").configuration.globalToolSyncEnabled){var t={active:Pt,passive:_t,enabled:Lt,disabled:kt};wt.state.globalToolChangeHistory.forEach((function(n){var r=n.args.slice(0);r.unshift(e),t[n.mode].apply(null,r)}))}}(e)},rd=B("internals:removeEnabledElement"),od=function(e){rd.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element,n=bt("globalConfiguration").configuration;mu(t),Lu(t),n.mouseEnabled&&(vc.disable(t),wc.disable(t),Du(t)),n.touchEnabled&&(Zc.disable(t),Xu(t)),ad(t),id(t),sd(t)},ad=function(e){wt.state.tools.forEach((function(t){t.element===e&&kt(t.element,t.name)})),wt.state.tools=wt.state.tools.filter((function(t){return t.element!==e}))},id=function(e){wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)}))}(e);var t=wt.state.enabledElements.findIndex((function(t){return t===e}));t>-1?wt.state.enabledElements.splice(t,1):rd.warn("unable to remove element")},sd=function(e){zs.removeHandlers(e)},ld=function(){window.removeEventListener("resize",cd,!1)};function cd(){ju||(ju=setTimeout((function(){ju=null,ud()}),66))}var ud=function(){gt.enabledElements.forEach((function(e){y.cornerstone.resize(e)}))},dd=function(){ld(),window.addEventListener("resize",cd,!1)},fd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};hd(),pd();var t=bt("globalConfiguration");Array.isArray(e)?e.forEach((function(e){var t=e.moduleName,n=e.configuration,r=bt(t);r&&(r.configuration=Object.assign({},r.configuration,n))})):t.configuration=Object.assign({},t.configuration,e),t.configuration.autoResizeViewports&&dd()};function hd(){!function(){var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,td),e.events.removeEventListener(n,od)}();var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,td),e.events.addEventListener(n,od)}function pd(){var e=wt.modules;Object.keys(e).forEach((function(t){"function"==typeof e[t].onRegisterCallback&&e[t].onRegisterCallback()}))}var md,vd=B("stackTools:stackPrefetch"),gd={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function yd(e,t){e=Math.round(e)||0;var n=[],r=(t=Math.round(t)||0)-e+1;if(r<=0)return n;for(;r--;)n[r]=t--;return n}function xd(e){var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],r=O(e,"stackPrefetch");if(r){var o=r.data[0]||{};if(o.indicesToRequest&&o.indicesToRequest.length||(o.enabled=!1),!1!==o.enabled&&(r.data[0].indicesToRequest.sort((function(e,t){return e-t})),o.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&y.cornerstone.imageCache.getImageLoadObject(t)&&w(e)})),o.indicesToRequest.length)){gd.preserveExistingPool||y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch");for(var a,i,s,l,c,u,d,f=(a=o.indicesToRequest,i=n.currentImageIdIndex,s=0,l=a.length-1,a.forEach((function(e,t){e<i?s=Math.max(t,s):e>i&&(l=Math.min(t,l))})),{low:s,high:l}),h=(zs.getErrorLoadingHandler(e),f.low),p=f.high,m=[];h>=0||p<o.indicesToRequest.length;){var v=n.currentImageIdIndex,g=!(v-o.indicesToRequest[h]>gd.maxImagesToPrefetch)&&h>=0,x=!(o.indicesToRequest[p]-v>gd.maxImagesToPrefetch)&&p<o.indicesToRequest.length;if(!x&&!g)break;g&&(u=o.indicesToRequest[h--],c=n.imageIds[u],m.push(c)),x&&(u=o.indicesToRequest[p++],c=n.imageIds[u],m.push(c))}var b={addToBeginning:!0,priority:0,requestType:"prefetch"};d=function(e){return y.cornerstone.loadAndCacheImage(e,b)},m.reverse().forEach((function(e){y.cornerstone.imageLoadPoolManager.addRequest(d.bind(null,e),"prefetch",{imageId:e},0,!0)}))}}}function w(e){var t=o.indicesToRequest.indexOf(e);t>-1&&o.indicesToRequest.splice(t,1)}}function bd(e){return function(t){var n,r=t.detail;try{n=O(e,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var o=n.data[0].imageIds.indexOf(r.imageId);if(!(o<0)){var a=O(e,"stackPrefetch");a&&a.data&&a.data.length&&a.data[0].indicesToRequest.push(o)}}}}function wd(e){clearTimeout(md),md=setTimeout((function(){var t=e.target;try{xd(t)}catch(e){return}}),10)}var Td={enable:function(e){O(e,"stackPrefetch").data=[];var t=O(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var r={indicesToRequest:yd(0,n.imageIds.length-1),enabled:!0,direction:1},o=r.indicesToRequest.indexOf(n.currentImageIdIndex);r.indicesToRequest.splice(o,1),k(e,"stackPrefetch",r),xd(e),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd),e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var a=bd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,a),y.cornerstone.events.addEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,a)}else vd.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(md),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var t=bd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=O(e,"stackPrefetch");n&&n.data.length&&(n.data[0].enabled=!1,y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch"))},getConfiguration:function(){return gd},setConfiguration:function(e){gd=e}},Id=function(){function e(){i()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return l()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=O(e,"stack").data);var r=y.cornerstone,o=t[0],a=o.imageIds[this.currentImageIdIndex],i=t.slice(1,t.length);r.loadAndCacheImage(a).then((function(t){var s=n.layerIds[0];s?r.setLayerImage(e,t,s):(s=r.addLayer(e,t,o.options),n.layerIds.push(s)),r.displayImage(e,t),i.forEach((function(t,o){var i=n.findImageFn(t.imageIds,a),l=o+1,c=n.layerIds[l];c||(c=r.addLayer(e,void 0,t.options),n.layerIds.push(c)),i?r.loadAndCacheImage(i).then((function(t){r.setLayerImage(e,t,c),r.updateImage(e)})):(r.setLayerImage(e,void 0,c),r.setActiveLayer(e,s),r.updateImage(e))}))}))}}]),e}(),Sd={};Sd.FusionRenderer=Id;var Ed=Sd;function Cd(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function Ad(e,t){var n,r;if(void 0===e)throw new Error("playClip: element must not be undefined");var o=O(e,"stack");if(o&&o.data&&o.data.length){var a,i=y.cornerstone;if(o.data.length>1){var s=O(e,"stackRenderer");s&&s.data&&s.data.length&&(a=s.data[0])}var l=o.data[0],c=O(e,"playClip");c&&c.data&&c.data.length?Cd(n=c.data[0]):k(e,"playClip",n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(r=function(e,t){var n,r,o,a=0,i=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)o=Number(e[n])/t|0,s.push(o),1===n?r=o:o!==r&&(s.isTimeVarying=!0),a+=o;return s.length>0&&(o=s.isTimeVarying?a/s.length|0:s[0],s.push(o)),s}(n.frameTimeVector,n.speed));var u=function(){var t,r,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(c<0||c>=u))return Cd(n),void function(e){T(e,w.CLIP_STOPPED,{element:e})}(e);c>=u&&(c=0),c<0&&(c=u-1),c!==l.currentImageIdIndex&&(t=zs.getStartLoadHandler(e),r=zs.getEndLoadHandler(e),s=zs.getErrorLoadingHandler(e),t&&t(e),(!0===l.preventCache?i.loadImage(l.imageIds[c]):i.loadAndCacheImage(l.imageIds[c])).then((function(t){try{l.currentImageIdIndex=c,a?(a.currentImageIdIndex=c,a.render(e,o.data)):i.displayImage(e,t),r&&r(e,t)}catch(e){return}}),(function(t){var n=l.imageIds[c];s&&s(e,n,t)})))};r&&r.length>0&&r.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,r[l.currentImageIdIndex]),u()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/Math.abs(n.framesPerSecond)))}}function Md(e){var t=O(e,"playClip");t&&t.data&&t.data.length&&Cd(t.data[0])}var Pd=function(e,t){var n=wt.state.tools.findIndex((function(n){return n.element===e&&n.name===t}));n>=0&&wt.state.tools.splice(n,1)},Dd=function(e){kd(e),wt.state.enabledElements.forEach((function(t){Pd(t,e)}))},kd=function(e){bt("globalConfiguration").configuration.globalToolSyncEnabled&&wt.state.globalTools[e]&&delete wt.state.globalTools[e]},Od=function(e,t,n){var r=Tt(e,t);r&&r.mergeOptions(n)},Ld=function(e,t){gt.enabledElements.forEach((function(n){Od(n,e,t)}))};function Rd(e,t){var n={};return{get:function(r,o){return e.indexOf(o)>=0?(!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o]):t.get(r,o)},add:function(r,o,a){if(!(e.indexOf(o)>=0))return t.add(r,o,a);!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o].data.push(a)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var _d=[];function Nd(e,t){var n=D(e);n||(n=P);var r=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(r=r.concat(t));var o=Rd(r,n);_d.push(o),_(e,o)}var Ud={newStackSpecificToolStateManager:Rd,addStackStateManager:Nd};function Bd(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}},add:function(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(r)},remove:function(t,n,r){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n)){for(var a=o[n],i=-1,s=0;s<a.data.length;s++)a.data[s]===r&&(i=s);-1!==i&&a.data.splice(i,1)}}}}}var jd=Bd(),Fd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=e.querySelector("canvas");if(r.msToBlob){var o=r.msToBlob();return window.navigator.msSaveBlob(o,t)}var a=document.createElement("a");if(a.download=t,a.href=r.toDataURL(n,1),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(i)}else a.fireEvent&&a.fireEvent("onclick")},Vd=B("thirdParty:registerModule"),Hd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=zd(e);!r||n?(r&&Vd.warn("Overwriting module %s",e),xt[e]=t,"function"==typeof xt[e].onRegisterCallback&&xt[e].onRegisterCallback()):Vd.warn("A module with the name %s is already registered",e)};function zd(e){return void 0!==xt[e]}function qd(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}var Wd={"base/BaseTool":pr,"base/BaseAnnotationTool":mo,"base/BaseBrushTool":Mr,"tools/cursors/MouseCursor":xo,"tools/cursors":o,"manipulators/anyHandlesOutsideImage":wr,"manipulators/getHandleNearImagePoint":gr,"manipulators/getHandlePixelPosition":Tr,"manipulators/handleActivator":yr,"manipulators/moveAllHandles":_r,"manipulators/moveHandle":Wr,"manipulators/moveNewHandle":to,"manipulators/moveHandleNearImagePoint":uo,"manipulators/findHandleDataNearImagePoint":fo,"manipulators/moveAnnotation":ho,"mixins/activeOrDisabledBinaryTool":ar.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":ar.enabledOrDisabledBinaryTool,"drawing/getNewContext":Pn,"drawing/draw":Wt,"drawing/path":Xt,"drawing/setShadow":kn,"drawing/drawLine":Qt,"drawing/drawLines":fn,"drawing/drawJoinedLines":Kt,"drawing/drawCircle":$t,"drawing/drawEllipse":an,"drawing/drawRect":Mn,"drawing/fillOutsideRect":function(e,t,n,r,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var a=y.cornerstone;n=a.pixelToCanvas(t,n),r=a.pixelToCanvas(t,r)}var i=Math.min(n.x,r.x),s=Math.min(n.y,r.y),l=Math.abs(n.x-r.x),c=Math.abs(n.y-r.y);Xt(e,o,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(i+l,s,-l,c)}))},"drawing/drawTextBox":wn,"drawing/drawArrow":Jt,"drawing/fillBox":xn,"drawing/fillTextLines":yn,"drawing/drawLink":hn,"drawing/drawLinkedTextBox":An,"drawing/drawHandles":dn,"drawing/textBoxWidth":bn,"util/getActiveTool":Dr,"util/getLuminance":jl,"util/getROITextBoxCoords":ni,"util/copyPoints":oc,"util/calculateSUV":Ka,"util/setContextToDisplayFontSize":function(e,t,n){return y.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":Ll,"util/scroll":Rl,"util/roundToDecimal":go,"util/projectPatientPointToImagePlane":tn,"util/imagePointToPatientPoint":nn,"util/planePlaneIntersection":rn,"util/pointInsideBoundingBox":mr,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")},"util/getRGBPixels":zi,"util/getBrowserInfo":qd,"util/isMobileDevice":function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)},"util/angleBetweenPoints":Tl,"util/numbersWithCommas":ri,"util/lineSegDistance":vo,"util/triggerEvent":T,"util/convertToVector3":en,"util/clip":Tn,"util/clipToBox":In,"util/clipBoxToDisplayedArea":En,"util/debounce":sa,"util/deepmerge":dr,"util/getDefault":Dn,"util/getProximityThreshold":so,"util/getPixelSpacing":aa,"util/isEmptyObject":On,"util/isObject":ia,"util/isPointInImage":Ge,"util/isPointInPolygon":us,"util/getLogger":B,"util/throttle":la,"util/wait":yl,"util/waitForEnabledElementImageToLoad":xl,"util/getKeyPressData":function(e){var t=y.cornerstone,n=e.currentTarget,r=t.getEnabledElement(n);if(r&&r.image){var o=wt.state.mousePositionImage;return{event:window.event||e,element:n,viewport:t.getViewport(n),image:r.image,currentPoints:{image:o,canvas:t.pixelToCanvas(n,o)},keyCode:e.keyCode,which:e.which}}},"util/ellipseUtils":ti,"util/freehandUtils":Oi,"util/segmentationUtils":r,"util/zoomUtils":Yl},Gd=B("thirdParty:registerMixin"),Yd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Zd(e);!r||n?(r&&Gd.warn("Overwriting mixins/%s",e),ar[e]=t,Wd["mixins/".concat(e)]=ar[e]):Gd.warn("mixins/%s is already registered",e)};function Zd(e){return void 0!==ar[e]}var Xd=B("thirdParty:registerType"),Qd=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o="".concat(e,"/").concat(t),a=Kd(o);!a||r?(a&&Xd.warn("Overwriting %s",o),Wd[o]=n):Xd.warn("%s is already registered",o)};function Kd(e){return void 0!==Wd[e]}var Jd=B("thirdParty:register"),$d=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(ef(e,t,n))switch(e){case"module":Hd(t,n,r);break;case"mixin":Yd(t,n,r);break;default:Qd(e,t,n,r)}};function ef(e,t,n){return e?t?"object"===b()(n)||"function"==typeof n||(Jd.warn("The %s is a %s, it should be an Object or a function.",n,b()(n)),!1):(Jd.warn("The %s must have a name in order to register.",e),!1):(Jd.warn("The type must be given in order to register."),!1)}var tf=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach((function(e){var n=e.type,r=e.name,o=e.item;$d(n,r,o,t)}))},nf=function(e,t,n){if(n!==t){var r=y.cornerstone,o=r.getViewport(t),a=r.getViewport(n);a.voi.windowWidth===o.voi.windowWidth&&a.voi.windowCenter===o.voi.windowCenter&&a.invert===o.invert||(a.voi.windowWidth=o.voi.windowWidth,a.voi.windowCenter=o.voi.windowCenter,a.invert=o.invert,e.setViewport(n,a))}},rf=function(e,t,n){n!==t&&y.cornerstone.updateImage(n)};function of(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}var af=function(e,t){y.cornerstone;var n=this,r=[],o=[],a=!1,i={},s=t;function l(e){var t=e.detail.element;n.remove(t),function(e){for(var t in qs)qs[t]=qs[t].filter((function(t){return t.element!==e}))}(t)}this.enabled=!0,this.setHandler=function(e){s=e},this.getHandler=function(){return s},this.getDistances=function(){if(r.length&&o.length){var e=y.cornerstone;i.distances={},i.imageIds={sourceElements:[],targetElements:[]},r.forEach((function(t){var n=e.getEnabledElement(t);if(n&&n.image){var r=n.image.imageId,a=e.metaData.get("imagePlaneModule",r);if(a&&a.imagePositionPatient){var s=en(a.imagePositionPatient);i.hasOwnProperty(n)||(i.distances[r]={},i.imageIds.sourceElements.push(r),o.forEach((function(n){var o=e.getEnabledElement(n);if(o&&o.image){var a=o.image.imageId;if(i.imageIds.targetElements.push(a),t!==n&&r!==a&&!i.distances[r].hasOwnProperty(a)){var l=e.metaData.get("imagePlaneModule",a);if(l&&l.imagePositionPatient){var c=en(l.imagePositionPatient);i.distances[r][a]=c.clone().sub(s)}}}})),Object.keys(i.distances[r]).length||delete i.distances[r])}}}))}},this.fireEvent=function(e,t){var l=!n.enabled,c=!r.length||!o.length;l||c||(a=!0,o.forEach((function(a){var l=o.indexOf(a);if(-1!==l){var c=i.imageIds.targetElements[l],u=r.indexOf(e);if(-1!==u){var d,f=i.imageIds.sourceElements[u];f===c?d=0:void 0!==i.distances[f]&&(d=i.distances[f][c]),s(n,e,a,t,d)}}})),a=!1)},this.onEvent=function(e){var t=e.detail;!0!==a&&n.fireEvent(e.currentTarget,t)},this.addSource=function(t){-1===r.indexOf(t)&&(r.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,n.onEvent)})),n.getDistances(),n.updateDisableHandlers())},this.addTarget=function(e){-1===o.indexOf(e)&&(o.push(e),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.add=function(e){n.addSource(e),n.addTarget(e)},this.removeSource=function(t){var o=r.indexOf(t);-1!==o&&(r.splice(o,1),e.split(" ").forEach((function(e){t.removeEventListener(e,n.onEvent)})),n.getDistances(),n.fireEvent(t),n.updateDisableHandlers())},this.removeTarget=function(e){var t=o.indexOf(e);-1!==t&&(o.splice(t,1),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.remove=function(e){n.removeTarget(e),n.removeSource(e)},this.getSourceElements=function(){return r},this.getTargetElements=function(){return o},this.displayImage=function(e,t,n){a=!0,y.cornerstone.displayImage(e,t,n),a=!1},this.setViewport=function(e,t){a=!0,y.cornerstone.setViewport(e,t),a=!1},this.updateDisableHandlers=function(){of(r.concat(o)).forEach((function(e){e.removeEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l),e.addEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l)}))},this.destroy=function(){of(r.concat(o)).forEach((function(e){n.remove(e)}))}},sf=function(e,t,n,r){if(t!==n&&r&&r.direction){var o=y.cornerstone,a=O(n,"stack").data[0],i=a.currentImageIdIndex+r.direction;if(i=Cn(i,0,a.imageIds.length-1),a.currentImageIdIndex!==i){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);a.currentImageIdIndex=i;var u=a.imageIds[i];s&&s(n),(!0===a.preventCache?o.loadImage(u):o.loadAndCacheImage(u)).then((function(t){var r=o.getViewport(n);a.currentImageIdIndex===i&&(e.displayImage(n,t,r),l&&l(n,t))}),(function(e){var t=a.imageIds[i];c&&c(n,t,e)}))}}},lf=function(e,t,n){if(n!==t){var r=y.cornerstone,o=O(t,"stack").data[0],a=o.imageIds[o.currentImageIdIndex],i=r.metaData.get("imagePlaneModule",a);if(void 0!==i&&void 0!==i.imagePositionPatient){var s=en(i.imagePositionPatient),l=O(n,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(l.imageIds.forEach((function(e,t){var n=r.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var o=en(n.imagePositionPatient).distanceToSquared(s);o<c&&(c=o,u=t)}})),u!==l.currentImageIdIndex){var d=zs.getStartLoadHandler(n),f=zs.getEndLoadHandler(n),h=zs.getErrorLoadingHandler(n);l.currentImageIdIndex=u;var p=l.imageIds[u];d&&d(n),-1!==u&&(!0===l.preventCache?r.loadImage(p):r.loadAndCacheImage(p)).then((function(t){var o=r.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,o),f&&f(n,t))}),(function(e){var t=l.imageIds[u];h&&h(n,t,e)}))}}}},cf=function(e,t,n,r,o){if(n!==t){var a=y.cornerstone,i=O(t,"stack").data[0],s=i.imageIds[i.currentImageIdIndex],l=a.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=en(l.imagePositionPatient),u=O(n,"stack").data[0],d=Number.MAX_VALUE,f=-1;if(o){var h=c.clone().add(o);if(u.imageIds.forEach((function(e,t){var n=a.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=en(n.imagePositionPatient),o=h.distanceToSquared(r);o<d&&(d=o,f=t)}})),f!==u.currentImageIdIndex&&-1!==f){var p=zs.getStartLoadHandler(n),m=zs.getEndLoadHandler(n),v=zs.getErrorLoadingHandler(n);u.currentImageIdIndex=f;var g=u.imageIds[f];p&&p(n),(!0===u.preventCache?a.loadImage(g):a.loadAndCacheImage(g)).then((function(t){var r=a.getViewport(n);u.currentImageIdIndex===f&&(e.displayImage(n,t,r),m&&m(n,t))}),(function(e){var t=u.imageIds[f];v&&v(n,t,e)}))}}}}},uf=function(e,t,n){if(n!==t){var r=y.cornerstone,o=O(t,"stack").data[0],a=O(n,"stack").data[0],i=o.currentImageIdIndex;if((i=Cn(i,0,a.imageIds.length-1))!==a.currentImageIdIndex){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);s&&s(n),(!0===a.preventCache?r.loadImage(a.imageIds[i]):r.loadAndCacheImage(a.imageIds[i])).then((function(t){var o=r.getViewport(n);a.currentImageIdIndex=i,e.displayImage(n,t,o),l&&l(n,t)}),(function(e){var t=a.imageIds[i];c&&c(n,t,e)}))}}},df=function(e,t,n){if(n!==t){var r=y.cornerstone,o=r.getViewport(t),a=r.getViewport(n);a.scale===o.scale&&a.translation.x===o.translation.x&&a.translation.y===o.translation.y||(a.scale=o.scale,a.translation.x=o.translation.x,a.translation.y=o.translation.y,e.setViewport(n,a))}},ff=function(e){return Wd[e]};n.d(t,"AngleTool",(function(){return ca})),n.d(t,"ArrowAnnotateTool",(function(){return fa})),n.d(t,"BidirectionalTool",(function(){return Qa})),n.d(t,"CircleRoiTool",(function(){return ai})),n.d(t,"CobbAngleTool",(function(){return ui})),n.d(t,"EllipticalRoiTool",(function(){return fi})),n.d(t,"FreehandRoiTool",(function(){return ji})),n.d(t,"LengthTool",(function(){return Hi})),n.d(t,"ProbeTool",(function(){return Wi})),n.d(t,"RectangleRoiTool",(function(){return Yi})),n.d(t,"TextMarkerTool",(function(){return Ji})),n.d(t,"BrushTool",(function(){return ts})),n.d(t,"SphericalBrushTool",(function(){return os})),n.d(t,"RectangleScissorsTool",(function(){return Ns})),n.d(t,"FreehandScissorsTool",(function(){return _s})),n.d(t,"CircleScissorsTool",(function(){return Us})),n.d(t,"CorrectionScissorsTool",(function(){return Bs})),n.d(t,"CrosshairsTool",(function(){return Ys})),n.d(t,"DoubleTapFitToWindowTool",(function(){return Zs})),n.d(t,"DragProbeTool",(function(){return Xs})),n.d(t,"EraserTool",(function(){return Js})),n.d(t,"FreehandRoiSculptorTool",(function(){return el})),n.d(t,"MagnifyTool",(function(){return nl})),n.d(t,"OverlayTool",(function(){return ol})),n.d(t,"OrientationMarkersTool",(function(){return il})),n.d(t,"PanMultiTouchTool",(function(){return dl})),n.d(t,"PanTool",(function(){return fl})),n.d(t,"ReferenceLinesTool",(function(){return wl})),n.d(t,"RotateTool",(function(){return Il})),n.d(t,"RotateTouchTool",(function(){return Al})),n.d(t,"ScaleOverlayTool",(function(){return Pl})),n.d(t,"StackScrollMouseWheelTool",(function(){return Nl})),n.d(t,"StackScrollMultiTouchTool",(function(){return Ul})),n.d(t,"StackScrollTool",(function(){return Bl})),n.d(t,"WwwcRegionTool",(function(){return Fl})),n.d(t,"WwwcTool",(function(){return ql})),n.d(t,"ZoomMouseWheelTool",(function(){return Zl})),n.d(t,"ZoomTool",(function(){return Kl})),n.d(t,"ZoomTouchPinchTool",(function(){return rc})),n.d(t,"init",(function(){return fd})),n.d(t,"stackPrefetch",(function(){return Td})),n.d(t,"stackRenderers",(function(){return Ed})),n.d(t,"playClip",(function(){return Ad})),n.d(t,"stopClip",(function(){return Md})),n.d(t,"store",(function(){return wt})),n.d(t,"getModule",(function(){return bt})),n.d(t,"getToolForElement",(function(){return Tt})),n.d(t,"addTool",(function(){return Ju})),n.d(t,"addToolForElement",(function(){return Ku})),n.d(t,"removeTool",(function(){return Dd})),n.d(t,"removeToolForElement",(function(){return Pd})),n.d(t,"setToolOptions",(function(){return Ld})),n.d(t,"setToolOptionsForElement",(function(){return Od})),n.d(t,"isToolActiveForElement",(function(){return Cr})),n.d(t,"setToolActive",(function(){return Dt})),n.d(t,"setToolActiveForElement",(function(){return Pt})),n.d(t,"setToolEnabled",(function(){return Rt})),n.d(t,"setToolEnabledForElement",(function(){return Lt})),n.d(t,"setToolDisabled",(function(){return Ot})),n.d(t,"setToolDisabledForElement",(function(){return kt})),n.d(t,"setToolPassive",(function(){return Nt})),n.d(t,"setToolPassiveForElement",(function(){return _t})),n.d(t,"addToolState",(function(){return k})),n.d(t,"getToolState",(function(){return O})),n.d(t,"removeToolState",(function(){return L})),n.d(t,"clearToolState",(function(){return R})),n.d(t,"setElementToolStateManager",(function(){return _})),n.d(t,"getElementToolStateManager",(function(){return D})),n.d(t,"textStyle",(function(){return gn})),n.d(t,"toolStyle",(function(){return Zt})),n.d(t,"toolColors",(function(){return un})),n.d(t,"toolCoordinates",(function(){return Ca})),n.d(t,"stackSpecificStateManager",(function(){return Ud})),n.d(t,"newStackSpecificToolStateManager",(function(){return Rd})),n.d(t,"addStackStateManager",(function(){return Nd})),n.d(t,"loadHandlerManager",(function(){return zs})),n.d(t,"newImageIdSpecificToolStateManager",(function(){return M})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return P})),n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return Bd})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return jd})),n.d(t,"forceEnabledElementResize",(function(){return ud})),n.d(t,"orientation",(function(){return al})),n.d(t,"SaveAs",(function(){return Fd})),n.d(t,"enableLogger",(function(){return j})),n.d(t,"disableLogger",(function(){return F})),n.d(t,"register",(function(){return $d})),n.d(t,"registerSome",(function(){return tf})),n.d(t,"wwwcSynchronizer",(function(){return nf})),n.d(t,"updateImageSynchronizer",(function(){return rf})),n.d(t,"Synchronizer",(function(){return af})),n.d(t,"stackScrollSynchronizer",(function(){return sf})),n.d(t,"stackImagePositionSynchronizer",(function(){return lf})),n.d(t,"stackImagePositionOffsetSynchronizer",(function(){return cf})),n.d(t,"stackImageIndexSynchronizer",(function(){return uf})),n.d(t,"panZoomSynchronizer",(function(){return df})),n.d(t,"importInternal",(function(){return ff})),n.d(t,"external",(function(){return y})),n.d(t,"EVENTS",(function(){return w})),n.d(t,"version",(function(){return"6.0.9"})),n.d(t,"import",(function(){return ff}));var hf={AngleTool:ca,ArrowAnnotateTool:fa,BidirectionalTool:Qa,CircleRoiTool:ai,CobbAngleTool:ui,EllipticalRoiTool:fi,FreehandRoiTool:ji,LengthTool:Hi,ProbeTool:Wi,RectangleRoiTool:Yi,TextMarkerTool:Ji,BrushTool:ts,SphericalBrushTool:os,RectangleScissorsTool:Ns,FreehandScissorsTool:_s,CircleScissorsTool:Us,CorrectionScissorsTool:Bs,CrosshairsTool:Ys,DoubleTapFitToWindowTool:Zs,DragProbeTool:Xs,EraserTool:Js,FreehandRoiSculptorTool:el,MagnifyTool:nl,OverlayTool:ol,OrientationMarkersTool:il,PanMultiTouchTool:dl,PanTool:fl,ReferenceLinesTool:wl,RotateTool:Il,RotateTouchTool:Al,ScaleOverlayTool:Pl,StackScrollMouseWheelTool:Nl,StackScrollMultiTouchTool:Ul,StackScrollTool:Bl,WwwcRegionTool:Fl,WwwcTool:ql,ZoomMouseWheelTool:Zl,ZoomTool:Kl,ZoomTouchPinchTool:rc,init:fd,stackPrefetch:Td,stackRenderers:Ed,playClip:Ad,stopClip:Md,store:wt,getModule:bt,getToolForElement:Tt,addTool:Ju,addToolForElement:Ku,removeTool:Dd,removeToolForElement:Pd,setToolOptions:Ld,setToolOptionsForElement:Od,isToolActiveForElement:Cr,setToolActive:Dt,setToolActiveForElement:Pt,setToolEnabled:Rt,setToolEnabledForElement:Lt,setToolDisabled:Ot,setToolDisabledForElement:kt,setToolPassive:Nt,setToolPassiveForElement:_t,addToolState:k,getToolState:O,removeToolState:L,clearToolState:R,setElementToolStateManager:_,getElementToolStateManager:D,textStyle:gn,toolStyle:Zt,toolColors:un,toolCoordinates:Ca,stackSpecificStateManager:Ud,newStackSpecificToolStateManager:Rd,addStackStateManager:Nd,loadHandlerManager:zs,newImageIdSpecificToolStateManager:M,globalImageIdSpecificToolStateManager:P,newFrameOfReferenceSpecificToolStateManager:Bd,globalFrameOfReferenceSpecificToolStateManager:jd,forceEnabledElementResize:ud,orientation:al,SaveAs:Fd,enableLogger:j,disableLogger:F,importInternal:ff,import:ff,register:$d,registerSome:tf,wwwcSynchronizer:nf,updateImageSynchronizer:rf,Synchronizer:af,stackScrollSynchronizer:sf,stackImagePositionSynchronizer:lf,stackImagePositionOffsetSynchronizer:cf,stackImageIndexSynchronizer:uf,panZoomSynchronizer:df,external:y,EVENTS:w,version:"6.0.9"};t.default=hf}])},2938:function(e){e.exports=(()=>{var e={6089:(e,t,n)=>{e.exports=n(7945)},4559:(e,t,n)=>{e.exports=n(9842)},6059:(e,t,n)=>{e.exports=n(3798)},9387:(e,t,n)=>{e.exports=n(2149)},7423:(e,t,n)=>{e.exports=n(6970)},2633:(e,t,n)=>{e.exports=n(2343)},6028:(e,t,n)=>{e.exports=n(671)},187:(e,t,n)=>{e.exports=n(7283)},1655:(e,t,n)=>{e.exports=n(2882)},1246:(e,t,n)=>{e.exports=n(8730)},2165:(e,t,n)=>{e.exports=n(569)},337:(e,t,n)=>{e.exports=n(3751)},2770:(e,t,n)=>{e.exports=n(1380)},1882:(e,t,n)=>{e.exports=n(6601)},7878:(e,t,n)=>{e.exports=n(8783)},1929:(e,t,n)=>{e.exports=n(3498)},2250:(e,t,n)=>{e.exports=n(4731)},1407:(e,t,n)=>{e.exports=n(3355)},6051:(e,t,n)=>{e.exports=n(4640)},6275:(e,t,n)=>{e.exports=n(846)},7830:(e,t,n)=>{e.exports=n(7686)},3091:(e,t,n)=>{e.exports=n(5681)},8355:(e,t,n)=>{e.exports=n(9863)},1082:(e,t,n)=>{e.exports=n(5723)},2475:(e,t,n)=>{e.exports=n(8887)},9719:(e,t,n)=>{e.exports=n(9009)},5534:(e,t,n)=>{e.exports=n(5213)},4215:(e,t,n)=>{e.exports=n(156)},6496:(e,t,n)=>{e.exports=n(7754)},7458:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),i=new M(r||[]);return a._invoke=function(e,t,n){var r=d;return function(o,a){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===o)throw a;return D()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var s=E(i,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var l=u(e,t,n);if("normal"===l.type){if(r=n.done?p:f,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}(e,n,i),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d="suspendedStart",f="suspendedYield",h="executing",p="completed",m={};function v(){}function g(){}function y(){}var x={};l(x,a,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(P([])));w&&w!==n&&r.call(w,a)&&(x=w);var T=y.prototype=v.prototype=Object.create(x);function I(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,a,i,s){var l=u(e[o],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(d).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(l.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function E(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=u(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function P(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:D}}function D(){return{value:t,done:!0}}return g.prototype=y,l(T,"constructor",y),l(y,"constructor",g),g.displayName=l(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,s,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},I(S.prototype),l(S.prototype,i,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new S(c(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},I(T),l(T,s,"Generator"),l(T,a,(function(){return this})),l(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=P,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;A(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},2043:(e,t,n)=>{e.exports=n(7458)},5109:(e,t,n)=>{n(8109),n(2166);var r=n(9081);e.exports=r.Array.from},1316:(e,t,n)=>{n(9506);var r=n(9081);e.exports=r.Array.isArray},3641:(e,t,n)=>{n(3075);var r=n(2018);e.exports=r("Array").concat},646:(e,t,n)=>{n(8345);var r=n(2018);e.exports=r("Array").filter},3147:(e,t,n)=>{n(7670);var r=n(2018);e.exports=r("Array").includes},5197:(e,t,n)=>{n(194);var r=n(2018);e.exports=r("Array").indexOf},474:(e,t,n)=>{n(2478);var r=n(2018);e.exports=r("Array").map},1001:(e,t,n)=>{n(5313);var r=n(2018);e.exports=r("Array").slice},5587:(e,t,n)=>{n(4596);var r=n(2018);e.exports=r("Array").splice},3386:(e,t,n)=>{n(2228),n(8109);var r=n(5018);e.exports=r},7543:(e,t,n)=>{var r=n(3641),o=Array.prototype;e.exports=function(e){var t=e.concat;return e===o||e instanceof Array&&t===o.concat?r:t}},3918:(e,t,n)=>{var r=n(646),o=Array.prototype;e.exports=function(e){var t=e.filter;return e===o||e instanceof Array&&t===o.filter?r:t}},790:(e,t,n)=>{var r=n(6270),o=RegExp.prototype;e.exports=function(e){return(e===o||e instanceof RegExp)&&!("flags"in e)?r(e):e.flags}},9109:(e,t,n)=>{var r=n(3147),o=n(5520),a=Array.prototype,i=String.prototype;e.exports=function(e){var t=e.includes;return e===a||e instanceof Array&&t===a.includes?r:"string"==typeof e||e===i||e instanceof String&&t===i.includes?o:t}},4825:(e,t,n)=>{var r=n(5197),o=Array.prototype;e.exports=function(e){var t=e.indexOf;return e===o||e instanceof Array&&t===o.indexOf?r:t}},238:(e,t,n)=>{var r=n(474),o=Array.prototype;e.exports=function(e){var t=e.map;return e===o||e instanceof Array&&t===o.map?r:t}},1285:(e,t,n)=>{var r=n(1001),o=Array.prototype;e.exports=function(e){var t=e.slice;return e===o||e instanceof Array&&t===o.slice?r:t}},7681:(e,t,n)=>{var r=n(5587),o=Array.prototype;e.exports=function(e){var t=e.splice;return e===o||e instanceof Array&&t===o.splice?r:t}},8949:(e,t,n)=>{var r=n(9119),o=String.prototype;e.exports=function(e){var t=e.trim;return"string"==typeof e||e===o||e instanceof String&&t===o.trim?r:t}},2529:(e,t,n)=>{n(8524);var r=n(9081);e.exports=r.Object.assign},6854:(e,t,n)=>{n(6764);var r=n(9081).Object,o=e.exports=function(e,t,n){return r.defineProperty(e,t,n)};r.defineProperty.sham&&(o.sham=!0)},1553:(e,t,n)=>{n(9398);var r=n(9081);e.exports=r.Object.entries},2744:(e,t,n)=>{n(554);var r=n(9081).Object,o=e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)};r.getOwnPropertyDescriptor.sham&&(o.sham=!0)},6018:(e,t,n)=>{n(4267);var r=n(9081);e.exports=r.Object.getOwnPropertyDescriptors},5350:(e,t,n)=>{n(8318);var r=n(9081);e.exports=r.Object.getOwnPropertySymbols},8116:(e,t,n)=>{n(8390);var r=n(9081);e.exports=r.Object.keys},3140:(e,t,n)=>{n(1171);var r=n(9081);e.exports=r.Object.values},7281:(e,t,n)=>{n(6454),n(2228),n(2575),n(3658),n(4465),n(8359),n(5203),n(8109);var r=n(9081);e.exports=r.Promise},6270:(e,t,n)=>{n(8714);var r=n(4980);e.exports=function(e){return r.call(e)}},5520:(e,t,n)=>{n(688);var r=n(2018);e.exports=r("String").includes},9119:(e,t,n)=>{n(8217);var r=n(2018);e.exports=r("String").trim},1442:(e,t,n)=>{n(3075),n(2575),n(8318),n(5762),n(2181),n(8848),n(3719),n(2362),n(346),n(888),n(909),n(1992),n(8512),n(6165),n(6044),n(4676),n(263),n(3596),n(1227),n(6268);var r=n(9081);e.exports=r.Symbol},1190:(e,t,n)=>{n(2228),n(2575),n(8109),n(2362);var r=n(3379);e.exports=r.f("iterator")},4640:(e,t,n)=>{var r=n(7945);e.exports=r},846:(e,t,n)=>{var r=n(8010);e.exports=r},7686:(e,t,n)=>{var r=n(7922);e.exports=r},5681:(e,t,n)=>{var r=n(5838);e.exports=r},9863:(e,t,n)=>{var r=n(671);e.exports=r},5723:(e,t,n)=>{var r=n(8531);e.exports=r},8887:(e,t,n)=>{var r=n(6601);e.exports=r},9009:(e,t,n)=>{var r=n(8783);e.exports=r},5213:(e,t,n)=>{var r=n(4731);n(1152),n(8561),n(5543),n(8302),e.exports=r},156:(e,t,n)=>{var r=n(3355);n(8812),n(9085),n(7384),n(4719),n(2994),n(9431),n(4803),e.exports=r},7754:(e,t,n)=>{var r=n(6888);e.exports=r},9077:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},9154:(e,t,n)=>{var r=n(3359);e.exports=function(e){if(!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},7710:e=>{e.exports=function(){}},8792:e=>{e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},1912:(e,t,n)=>{var r=n(3359);e.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},4746:(e,t,n)=>{"use strict";var r=n(7673),o=n(2058),a=n(7647),i=n(6475),s=n(3746),l=n(409),c=n(5945),u=n(5018);e.exports=function(e){var t,n,d,f,h,p,m=o(e),v="function"==typeof this?this:Array,g=arguments.length,y=g>1?arguments[1]:void 0,x=void 0!==y,b=u(m),w=0;if(x&&(y=r(y,g>2?arguments[2]:void 0,2)),null==b||v==Array&&i(b))for(n=new v(t=s(m.length));t>w;w++)p=x?y(m[w],w):m[w],l(n,w,p);else for(h=(f=c(m,b)).next,n=new v;!(d=h.call(f)).done;w++)p=x?a(f,y,[d.value,w],!0):d.value,l(n,w,p);return n.length=w,n}},7075:(e,t,n)=>{var r=n(3861),o=n(3746),a=n(3055),i=function(e){return function(t,n,i){var s,l=r(t),c=o(l.length),u=a(i,c);if(e&&n!=n){for(;c>u;)if((s=l[u++])!=s)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:i(!0),indexOf:i(!1)}},4206:(e,t,n)=>{var r=n(7673),o=n(1251),a=n(2058),i=n(3746),s=n(8136),l=[].push,c=function(e){var t=1==e,n=2==e,c=3==e,u=4==e,d=6==e,f=7==e,h=5==e||d;return function(p,m,v,g){for(var y,x,b=a(p),w=o(b),T=r(m,v,3),I=i(w.length),S=0,E=g||s,C=t?E(p,I):n||f?E(p,0):void 0;I>S;S++)if((h||S in w)&&(x=T(y=w[S],S,b),e))if(t)C[S]=x;else if(x)switch(e){case 3:return!0;case 5:return y;case 6:return S;case 2:l.call(C,y)}else switch(e){case 4:return!1;case 7:l.call(C,y)}return d?-1:c||u?u:C}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterReject:c(7)}},2143:(e,t,n)=>{var r=n(6530),o=n(5712),a=n(8233),i=o("species");e.exports=function(e){return a>=51||!r((function(){var t=[];return(t.constructor={})[i]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},6628:(e,t,n)=>{"use strict";var r=n(6530);e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){throw 1},1)}))}},3400:(e,t,n)=>{var r=n(3359),o=n(1054),a=n(5712)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)?r(t)&&null===(t=t[a])&&(t=void 0):t=void 0),void 0===t?Array:t}},8136:(e,t,n)=>{var r=n(3400);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},7647:(e,t,n)=>{var r=n(1912),o=n(309);e.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){o(e,"throw",t)}}},8908:(e,t,n)=>{var r=n(5712)("iterator"),o=!1;try{var a=0,i={next:function(){return{done:!!a++}},return:function(){o=!0}};i[r]=function(){return this},Array.from(i,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var a={};a[r]=function(){return{next:function(){return{done:n=!0}}}},e(a)}catch(e){}return n}},1570:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},7499:(e,t,n)=>{var r=n(8889),o=n(1570),a=n(5712)("toStringTag"),i="Arguments"==o(function(){return arguments}());e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?n:i?o(t):"Object"==(r=o(t))&&"function"==typeof t.callee?"Arguments":r}},1722:(e,t,n)=>{var r=n(5712)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},872:(e,t,n)=>{var r=n(6530);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},8611:(e,t,n)=>{"use strict";var r=n(7300).IteratorPrototype,o=n(2491),a=n(5595),i=n(6738),s=n(9418),l=function(){return this};e.exports=function(e,t,n){var c=t+" Iterator";return e.prototype=o(r,{next:a(1,n)}),i(e,c,!1,!0),s[c]=l,e}},8518:(e,t,n)=>{var r=n(7001),o=n(7550),a=n(5595);e.exports=r?function(e,t,n){return o.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},5595:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},409:(e,t,n)=>{"use strict";var r=n(5623),o=n(7550),a=n(5595);e.exports=function(e,t,n){var i=r(t);i in e?o.f(e,i,a(0,n)):e[i]=n}},8277:(e,t,n)=>{"use strict";var r=n(390),o=n(8611),a=n(2629),i=n(5255),s=n(6738),l=n(8518),c=n(9791),u=n(5712),d=n(8367),f=n(9418),h=n(7300),p=h.IteratorPrototype,m=h.BUGGY_SAFARI_ITERATORS,v=u("iterator"),g="keys",y="values",x="entries",b=function(){return this};e.exports=function(e,t,n,u,h,w,T){o(n,t,u);var I,S,E,C=function(e){if(e===h&&k)return k;if(!m&&e in P)return P[e];switch(e){case g:case y:case x:return function(){return new n(this,e)}}return function(){return new n(this)}},A=t+" Iterator",M=!1,P=e.prototype,D=P[v]||P["@@iterator"]||h&&P[h],k=!m&&D||C(h),O="Array"==t&&P.entries||D;if(O&&(I=a(O.call(new e)),p!==Object.prototype&&I.next&&(d||a(I)===p||(i?i(I,p):"function"!=typeof I[v]&&l(I,v,b)),s(I,A,!0,!0),d&&(f[A]=b))),h==y&&D&&D.name!==y&&(M=!0,k=function(){return D.call(this)}),d&&!T||P[v]===k||l(P,v,k),f[t]=k,h)if(S={values:C(y),keys:w?k:C(g),entries:C(x)},T)for(E in S)(m||M||!(E in P))&&c(P,E,S[E]);else r({target:t,proto:!0,forced:m||M},S);return S}},1412:(e,t,n)=>{var r=n(9081),o=n(6690),a=n(3379),i=n(7550).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});o(t,e)||i(t,e,{value:a.f(e)})}},7001:(e,t,n)=>{var r=n(6530);e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},231:(e,t,n)=>{var r=n(2868),o=n(3359),a=r.document,i=o(a)&&o(a.createElement);e.exports=function(e){return i?a.createElement(e):{}}},315:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},6610:e=>{e.exports="object"==typeof window},6405:(e,t,n)=>{var r=n(6900),o=n(2868);e.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==o.Pebble},6540:(e,t,n)=>{var r=n(6900);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},6521:(e,t,n)=>{var r=n(1570),o=n(2868);e.exports="process"==r(o.process)},4010:(e,t,n)=>{var r=n(6900);e.exports=/web0s(?!.*chrome)/i.test(r)},6900:(e,t,n)=>{var r=n(8104);e.exports=r("navigator","userAgent")||""},8233:(e,t,n)=>{var r,o,a=n(2868),i=n(6900),s=a.process,l=a.Deno,c=s&&s.versions||l&&l.version,u=c&&c.v8;u?o=(r=u.split("."))[0]<4?1:r[0]+r[1]:i&&(!(r=i.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=i.match(/Chrome\/(\d+)/))&&(o=r[1]),e.exports=o&&+o},2018:(e,t,n)=>{var r=n(9081);e.exports=function(e){return r[e+"Prototype"]}},2712:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},390:(e,t,n)=>{"use strict";var r=n(2868),o=n(5904).f,a=n(1011),i=n(9081),s=n(7673),l=n(8518),c=n(6690),u=function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var n,d,f,h,p,m,v,g,y=e.target,x=e.global,b=e.stat,w=e.proto,T=x?r:b?r[y]:(r[y]||{}).prototype,I=x?i:i[y]||l(i,y,{})[y],S=I.prototype;for(f in t)n=!a(x?f:y+(b?".":"#")+f,e.forced)&&T&&c(T,f),p=I[f],n&&(m=e.noTargetGet?(g=o(T,f))&&g.value:T[f]),h=n&&m?m:t[f],n&&typeof p==typeof h||(v=e.bind&&n?s(h,r):e.wrap&&n?u(h):w&&"function"==typeof h?s(Function.call,h):h,(e.sham||h&&h.sham||p&&p.sham)&&l(v,"sham",!0),l(I,f,v),w&&(c(i,d=y+"Prototype")||l(i,d,{}),l(i[d],f,h),e.real&&S&&!S[f]&&l(S,f,h)))}},6530:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},7673:(e,t,n)=>{var r=n(9077);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},8104:(e,t,n)=>{var r=n(9081),o=n(2868),a=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?a(r[e])||a(o[e]):r[e]&&r[e][t]||o[e]&&o[e][t]}},5018:(e,t,n)=>{var r=n(7499),o=n(9418),a=n(5712)("iterator");e.exports=function(e){if(null!=e)return e[a]||e["@@iterator"]||o[r(e)]}},5945:(e,t,n)=>{var r=n(1912),o=n(5018);e.exports=function(e,t){var n=arguments.length<2?o(e):t;if("function"!=typeof n)throw TypeError(String(e)+" is not iterable");return r(n.call(e))}},2868:(e,t,n)=>{var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},6690:(e,t,n)=>{var r=n(2058),o={}.hasOwnProperty;e.exports=Object.hasOwn||function(e,t){return o.call(r(e),t)}},7048:e=>{e.exports={}},8471:(e,t,n)=>{var r=n(2868);e.exports=function(e,t){var n=r.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},5644:(e,t,n)=>{var r=n(8104);e.exports=r("document","documentElement")},640:(e,t,n)=>{var r=n(7001),o=n(6530),a=n(231);e.exports=!r&&!o((function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},1251:(e,t,n)=>{var r=n(6530),o=n(1570),a="".split;e.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?a.call(e,""):Object(e)}:Object},1494:(e,t,n)=>{var r=n(2656),o=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(e){return o.call(e)}),e.exports=r.inspectSource},5875:(e,t,n)=>{var r,o,a,i=n(2297),s=n(2868),l=n(3359),c=n(8518),u=n(6690),d=n(2656),f=n(5039),h=n(7048),p="Object already initialized",m=s.WeakMap;if(i||d.state){var v=d.state||(d.state=new m),g=v.get,y=v.has,x=v.set;r=function(e,t){if(y.call(v,e))throw new TypeError(p);return t.facade=e,x.call(v,e,t),t},o=function(e){return g.call(v,e)||{}},a=function(e){return y.call(v,e)}}else{var b=f("state");h[b]=!0,r=function(e,t){if(u(e,b))throw new TypeError(p);return t.facade=e,c(e,b,t),t},o=function(e){return u(e,b)?e[b]:{}},a=function(e){return u(e,b)}}e.exports={set:r,get:o,has:a,enforce:function(e){return a(e)?o(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},6475:(e,t,n)=>{var r=n(5712),o=n(9418),a=r("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(o.Array===e||i[a]===e)}},1054:(e,t,n)=>{var r=n(1570);e.exports=Array.isArray||function(e){return"Array"==r(e)}},1011:(e,t,n)=>{var r=n(6530),o=/#|\.prototype\./,a=function(e,t){var n=s[i(e)];return n==c||n!=l&&("function"==typeof t?r(t):!!t)},i=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},s=a.data={},l=a.NATIVE="N",c=a.POLYFILL="P";e.exports=a},3359:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},8367:e=>{e.exports=!0},6858:(e,t,n)=>{var r=n(3359),o=n(1570),a=n(5712)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==o(e))}},1149:(e,t,n)=>{var r=n(8104),o=n(6046);e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return"function"==typeof t&&Object(e)instanceof t}},3906:(e,t,n)=>{var r=n(1912),o=n(6475),a=n(3746),i=n(7673),s=n(5945),l=n(5018),c=n(309),u=function(e,t){this.stopped=e,this.result=t};e.exports=function(e,t,n){var d,f,h,p,m,v,g,y=n&&n.that,x=!(!n||!n.AS_ENTRIES),b=!(!n||!n.IS_ITERATOR),w=!(!n||!n.INTERRUPTED),T=i(t,y,1+x+w),I=function(e){return d&&c(d,"normal",e),new u(!0,e)},S=function(e){return x?(r(e),w?T(e[0],e[1],I):T(e[0],e[1])):w?T(e,I):T(e)};if(b)d=e;else{if("function"!=typeof(f=l(e)))throw TypeError("Target is not iterable");if(o(f)){for(h=0,p=a(e.length);p>h;h++)if((m=S(e[h]))&&m instanceof u)return m;return new u(!1)}d=s(e,f)}for(v=d.next;!(g=v.call(d)).done;){try{m=S(g.value)}catch(e){c(d,"throw",e)}if("object"==typeof m&&m&&m instanceof u)return m}return new u(!1)}},309:(e,t,n)=>{var r=n(1912);e.exports=function(e,t,n){var o,a;r(e);try{if(void 0===(o=e.return)){if("throw"===t)throw n;return n}o=o.call(e)}catch(e){a=!0,o=e}if("throw"===t)throw n;if(a)throw o;return r(o),n}},7300:(e,t,n)=>{"use strict";var r,o,a,i=n(6530),s=n(2629),l=n(8518),c=n(6690),u=n(5712),d=n(8367),f=u("iterator"),h=!1;[].keys&&("next"in(a=[].keys())?(o=s(s(a)))!==Object.prototype&&(r=o):h=!0);var p=null==r||i((function(){var e={};return r[f].call(e)!==e}));p&&(r={}),d&&!p||c(r,f)||l(r,f,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:h}},9418:e=>{e.exports={}},8054:(e,t,n)=>{var r,o,a,i,s,l,c,u,d=n(2868),f=n(5904).f,h=n(6569).set,p=n(6540),m=n(6405),v=n(4010),g=n(6521),y=d.MutationObserver||d.WebKitMutationObserver,x=d.document,b=d.process,w=d.Promise,T=f(d,"queueMicrotask"),I=T&&T.value;I||(r=function(){var e,t;for(g&&(e=b.domain)&&e.exit();o;){t=o.fn,o=o.next;try{t()}catch(e){throw o?i():a=void 0,e}}a=void 0,e&&e.enter()},p||g||v||!y||!x?!m&&w&&w.resolve?((c=w.resolve(void 0)).constructor=w,u=c.then,i=function(){u.call(c,r)}):i=g?function(){b.nextTick(r)}:function(){h.call(d,r)}:(s=!0,l=x.createTextNode(""),new y(r).observe(l,{characterData:!0}),i=function(){l.data=s=!s})),e.exports=I||function(e){var t={fn:e,next:void 0};a&&(a.next=t),o||(o=t,i()),a=t}},3104:(e,t,n)=>{var r=n(2868);e.exports=r.Promise},3216:(e,t,n)=>{var r=n(8233),o=n(6530);e.exports=!!Object.getOwnPropertySymbols&&!o((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},2297:(e,t,n)=>{var r=n(2868),o=n(1494),a=r.WeakMap;e.exports="function"==typeof a&&/native code/.test(o(a))},4130:(e,t,n)=>{"use strict";var r=n(9077),o=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new o(e)}},9611:(e,t,n)=>{var r=n(6858);e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},3210:(e,t,n)=>{"use strict";var r=n(7001),o=n(6530),a=n(461),i=n(3764),s=n(1156),l=n(2058),c=n(1251),u=Object.assign,d=Object.defineProperty;e.exports=!u||o((function(){if(r&&1!==u({b:1},u(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),o="abcdefghijklmnopqrst";return e[n]=7,o.split("").forEach((function(e){t[e]=e})),7!=u({},e)[n]||a(u({},t)).join("")!=o}))?function(e,t){for(var n=l(e),o=arguments.length,u=1,d=i.f,f=s.f;o>u;)for(var h,p=c(arguments[u++]),m=d?a(p).concat(d(p)):a(p),v=m.length,g=0;v>g;)h=m[g++],r&&!f.call(p,h)||(n[h]=p[h]);return n}:u},2491:(e,t,n)=>{var r,o=n(1912),a=n(4686),i=n(2712),s=n(7048),l=n(5644),c=n(231),u=n(5039)("IE_PROTO"),d=function(){},f=function(e){return"<script>"+e+"<\/script>"},h=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},p=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}var e,t;p="undefined"!=typeof document?document.domain&&r?h(r):((t=c("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F):h(r);for(var n=i.length;n--;)delete p.prototype[i[n]];return p()};s[u]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(d.prototype=o(e),n=new d,d.prototype=null,n[u]=e):n=p(),void 0===t?n:a(n,t)}},4686:(e,t,n)=>{var r=n(7001),o=n(7550),a=n(1912),i=n(461);e.exports=r?Object.defineProperties:function(e,t){a(e);for(var n,r=i(t),s=r.length,l=0;s>l;)o.f(e,n=r[l++],t[n]);return e}},7550:(e,t,n)=>{var r=n(7001),o=n(640),a=n(1912),i=n(5623),s=Object.defineProperty;t.f=r?s:function(e,t,n){if(a(e),t=i(t),a(n),o)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},5904:(e,t,n)=>{var r=n(7001),o=n(1156),a=n(5595),i=n(3861),s=n(5623),l=n(6690),c=n(640),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=i(e),t=s(t),c)try{return u(e,t)}catch(e){}if(l(e,t))return a(!o.f.call(e,t),e[t])}},6159:(e,t,n)=>{var r=n(3861),o=n(9035).f,a={}.toString,i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return i&&"[object Window]"==a.call(e)?function(e){try{return o(e)}catch(e){return i.slice()}}(e):o(r(e))}},9035:(e,t,n)=>{var r=n(1247),o=n(2712).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},3764:(e,t)=>{t.f=Object.getOwnPropertySymbols},2629:(e,t,n)=>{var r=n(6690),o=n(2058),a=n(5039),i=n(872),s=a("IE_PROTO"),l=Object.prototype;e.exports=i?Object.getPrototypeOf:function(e){return e=o(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?l:null}},1247:(e,t,n)=>{var r=n(6690),o=n(3861),a=n(7075).indexOf,i=n(7048);e.exports=function(e,t){var n,s=o(e),l=0,c=[];for(n in s)!r(i,n)&&r(s,n)&&c.push(n);for(;t.length>l;)r(s,n=t[l++])&&(~a(c,n)||c.push(n));return c}},461:(e,t,n)=>{var r=n(1247),o=n(2712);e.exports=Object.keys||function(e){return r(e,o)}},1156:(e,t)=>{"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,o=r&&!n.call({1:2},1);t.f=o?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},5255:(e,t,n)=>{var r=n(1912),o=n(9154);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,a){return r(n),o(a),t?e.call(n,a):n.__proto__=a,n}}():void 0)},3895:(e,t,n)=>{var r=n(7001),o=n(461),a=n(3861),i=n(1156).f,s=function(e){return function(t){for(var n,s=a(t),l=o(s),c=l.length,u=0,d=[];c>u;)n=l[u++],r&&!i.call(s,n)||d.push(e?[n,s[n]]:s[n]);return d}};e.exports={entries:s(!0),values:s(!1)}},2204:(e,t,n)=>{"use strict";var r=n(8889),o=n(7499);e.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},9466:(e,t,n)=>{var r=n(3359);e.exports=function(e,t){var n,o;if("string"===t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if("string"!==t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},5340:(e,t,n)=>{var r=n(8104),o=n(9035),a=n(3764),i=n(1912);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(i(e)),n=a.f;return n?t.concat(n(e)):t}},9081:e=>{e.exports={}},4618:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},4567:(e,t,n)=>{var r=n(1912),o=n(3359),a=n(4130);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},9248:(e,t,n)=>{var r=n(9791);e.exports=function(e,t,n){for(var o in t)n&&n.unsafe&&e[o]?e[o]=t[o]:r(e,o,t[o],n);return e}},9791:(e,t,n)=>{var r=n(8518);e.exports=function(e,t,n,o){o&&o.enumerable?e[t]=n:r(e,t,n)}},4980:(e,t,n)=>{"use strict";var r=n(1912);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},3604:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},2643:(e,t,n)=>{var r=n(2868);e.exports=function(e,t){try{Object.defineProperty(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},2655:(e,t,n)=>{"use strict";var r=n(8104),o=n(7550),a=n(5712),i=n(7001),s=a("species");e.exports=function(e){var t=r(e),n=o.f;i&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},6738:(e,t,n)=>{var r=n(8889),o=n(7550).f,a=n(8518),i=n(6690),s=n(2204),l=n(5712)("toStringTag");e.exports=function(e,t,n,c){if(e){var u=n?e:e.prototype;i(u,l)||o(u,l,{configurable:!0,value:t}),c&&!r&&a(u,"toString",s)}}},5039:(e,t,n)=>{var r=n(6315),o=n(9),a=r("keys");e.exports=function(e){return a[e]||(a[e]=o(e))}},2656:(e,t,n)=>{var r=n(2868),o=n(2643),a="__core-js_shared__",i=r[a]||o(a,{});e.exports=i},6315:(e,t,n)=>{var r=n(8367),o=n(2656);(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.17.2",mode:r?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},5462:(e,t,n)=>{var r=n(1912),o=n(9077),a=n(5712)("species");e.exports=function(e,t){var n,i=r(e).constructor;return void 0===i||null==(n=r(i)[a])?t:o(n)}},1420:(e,t,n)=>{var r=n(1470),o=n(5264),a=n(3604),i=function(e){return function(t,n){var i,s,l=o(a(t)),c=r(n),u=l.length;return c<0||c>=u?e?"":void 0:(i=l.charCodeAt(c))<55296||i>56319||c+1===u||(s=l.charCodeAt(c+1))<56320||s>57343?e?l.charAt(c):i:e?l.slice(c,c+2):s-56320+(i-55296<<10)+65536}};e.exports={codeAt:i(!1),charAt:i(!0)}},9787:(e,t,n)=>{var r=n(6530),o=n(3781);e.exports=function(e){return r((function(){return!!o[e]()||"​᠎"!="​᠎"[e]()||o[e].name!==e}))}},774:(e,t,n)=>{var r=n(3604),o=n(5264),a="["+n(3781)+"]",i=RegExp("^"+a+a+"*"),s=RegExp(a+a+"*$"),l=function(e){return function(t){var n=o(r(t));return 1&e&&(n=n.replace(i,"")),2&e&&(n=n.replace(s,"")),n}};e.exports={start:l(1),end:l(2),trim:l(3)}},6569:(e,t,n)=>{var r,o,a,i,s=n(2868),l=n(6530),c=n(7673),u=n(5644),d=n(231),f=n(6540),h=n(6521),p=s.setImmediate,m=s.clearImmediate,v=s.process,g=s.MessageChannel,y=s.Dispatch,x=0,b={},w="onreadystatechange";try{r=s.location}catch(e){}var T=function(e){if(b.hasOwnProperty(e)){var t=b[e];delete b[e],t()}},I=function(e){return function(){T(e)}},S=function(e){T(e.data)},E=function(e){s.postMessage(String(e),r.protocol+"//"+r.host)};p&&m||(p=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return b[++x]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},o(x),x},m=function(e){delete b[e]},h?o=function(e){v.nextTick(I(e))}:y&&y.now?o=function(e){y.now(I(e))}:g&&!f?(i=(a=new g).port2,a.port1.onmessage=S,o=c(i.postMessage,i,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts&&r&&"file:"!==r.protocol&&!l(E)?(o=E,s.addEventListener("message",S,!1)):o=w in d("script")?function(e){u.appendChild(d("script")).onreadystatechange=function(){u.removeChild(this),T(e)}}:function(e){setTimeout(I(e),0)}),e.exports={set:p,clear:m}},3055:(e,t,n)=>{var r=n(1470),o=Math.max,a=Math.min;e.exports=function(e,t){var n=r(e);return n<0?o(n+t,0):a(n,t)}},3861:(e,t,n)=>{var r=n(1251),o=n(3604);e.exports=function(e){return r(o(e))}},1470:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},3746:(e,t,n)=>{var r=n(1470),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},2058:(e,t,n)=>{var r=n(3604);e.exports=function(e){return Object(r(e))}},3957:(e,t,n)=>{var r=n(3359),o=n(1149),a=n(9466),i=n(5712)("toPrimitive");e.exports=function(e,t){if(!r(e)||o(e))return e;var n,s=e[i];if(void 0!==s){if(void 0===t&&(t="default"),n=s.call(e,t),!r(n)||o(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},5623:(e,t,n)=>{var r=n(3957),o=n(1149);e.exports=function(e){var t=r(e,"string");return o(t)?t:String(t)}},8889:(e,t,n)=>{var r={};r[n(5712)("toStringTag")]="z",e.exports="[object z]"===String(r)},5264:(e,t,n)=>{var r=n(1149);e.exports=function(e){if(r(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)}},9:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++t+n).toString(36)}},6046:(e,t,n)=>{var r=n(3216);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3379:(e,t,n)=>{var r=n(5712);t.f=r},5712:(e,t,n)=>{var r=n(2868),o=n(6315),a=n(6690),i=n(9),s=n(3216),l=n(6046),c=o("wks"),u=r.Symbol,d=l?u:u&&u.withoutSetter||i;e.exports=function(e){return a(c,e)&&(s||"string"==typeof c[e])||(s&&a(u,e)?c[e]=u[e]:c[e]=d("Symbol."+e)),c[e]}},3781:e=>{e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},6454:(e,t,n)=>{"use strict";var r=n(390),o=n(2629),a=n(5255),i=n(2491),s=n(8518),l=n(5595),c=n(3906),u=n(5264),d=function(e,t){var n=this;if(!(n instanceof d))return new d(e,t);a&&(n=a(new Error(void 0),o(n))),void 0!==t&&s(n,"message",u(t));var r=[];return c(e,r.push,{that:r}),s(n,"errors",r),n};d.prototype=i(Error.prototype,{constructor:l(5,d),message:l(5,""),name:l(5,"AggregateError")}),r({global:!0},{AggregateError:d})},3075:(e,t,n)=>{"use strict";var r=n(390),o=n(6530),a=n(1054),i=n(3359),s=n(2058),l=n(3746),c=n(409),u=n(8136),d=n(2143),f=n(5712),h=n(8233),p=f("isConcatSpreadable"),m=9007199254740991,v="Maximum allowed index exceeded",g=h>=51||!o((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),y=d("concat"),x=function(e){if(!i(e))return!1;var t=e[p];return void 0!==t?!!t:a(e)};r({target:"Array",proto:!0,forced:!g||!y},{concat:function(e){var t,n,r,o,a,i=s(this),d=u(i,0),f=0;for(t=-1,r=arguments.length;t<r;t++)if(x(a=-1===t?i:arguments[t])){if(f+(o=l(a.length))>m)throw TypeError(v);for(n=0;n<o;n++,f++)n in a&&c(d,f,a[n])}else{if(f>=m)throw TypeError(v);c(d,f++,a)}return d.length=f,d}})},8345:(e,t,n)=>{"use strict";var r=n(390),o=n(4206).filter;r({target:"Array",proto:!0,forced:!n(2143)("filter")},{filter:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},2166:(e,t,n)=>{var r=n(390),o=n(4746);r({target:"Array",stat:!0,forced:!n(8908)((function(e){Array.from(e)}))},{from:o})},7670:(e,t,n)=>{"use strict";var r=n(390),o=n(7075).includes,a=n(7710);r({target:"Array",proto:!0},{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),a("includes")},194:(e,t,n)=>{"use strict";var r=n(390),o=n(7075).indexOf,a=n(6628),i=[].indexOf,s=!!i&&1/[1].indexOf(1,-0)<0,l=a("indexOf");r({target:"Array",proto:!0,forced:s||!l},{indexOf:function(e){return s?i.apply(this,arguments)||0:o(this,e,arguments.length>1?arguments[1]:void 0)}})},9506:(e,t,n)=>{n(390)({target:"Array",stat:!0},{isArray:n(1054)})},2228:(e,t,n)=>{"use strict";var r=n(3861),o=n(7710),a=n(9418),i=n(5875),s=n(8277),l="Array Iterator",c=i.set,u=i.getterFor(l);e.exports=s(Array,"Array",(function(e,t){c(this,{type:l,target:r(e),index:0,kind:t})}),(function(){var e=u(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),a.Arguments=a.Array,o("keys"),o("values"),o("entries")},2478:(e,t,n)=>{"use strict";var r=n(390),o=n(4206).map;r({target:"Array",proto:!0,forced:!n(2143)("map")},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},5313:(e,t,n)=>{"use strict";var r=n(390),o=n(3359),a=n(1054),i=n(3055),s=n(3746),l=n(3861),c=n(409),u=n(5712),d=n(2143)("slice"),f=u("species"),h=[].slice,p=Math.max;r({target:"Array",proto:!0,forced:!d},{slice:function(e,t){var n,r,u,d=l(this),m=s(d.length),v=i(e,m),g=i(void 0===t?m:t,m);if(a(d)&&("function"!=typeof(n=d.constructor)||n!==Array&&!a(n.prototype)?o(n)&&null===(n=n[f])&&(n=void 0):n=void 0,n===Array||void 0===n))return h.call(d,v,g);for(r=new(void 0===n?Array:n)(p(g-v,0)),u=0;v<g;v++,u++)v in d&&c(r,u,d[v]);return r.length=u,r}})},4596:(e,t,n)=>{"use strict";var r=n(390),o=n(3055),a=n(1470),i=n(3746),s=n(2058),l=n(8136),c=n(409),u=n(2143)("splice"),d=Math.max,f=Math.min,h=9007199254740991,p="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!u},{splice:function(e,t){var n,r,u,m,v,g,y=s(this),x=i(y.length),b=o(e,x),w=arguments.length;if(0===w?n=r=0:1===w?(n=0,r=x-b):(n=w-2,r=f(d(a(t),0),x-b)),x+n-r>h)throw TypeError(p);for(u=l(y,r),m=0;m<r;m++)(v=b+m)in y&&c(u,m,y[v]);if(u.length=r,n<r){for(m=b;m<x-r;m++)g=m+n,(v=m+r)in y?y[g]=y[v]:delete y[g];for(m=x;m>x-r+n;m--)delete y[m-1]}else if(n>r)for(m=x-r;m>b;m--)g=m+n-1,(v=m+r-1)in y?y[g]=y[v]:delete y[g];for(m=0;m<n;m++)y[m+b]=arguments[m+2];return y.length=x-r+n,u}})},3596:(e,t,n)=>{var r=n(2868);n(6738)(r.JSON,"JSON",!0)},1227:()=>{},8524:(e,t,n)=>{var r=n(390),o=n(3210);r({target:"Object",stat:!0,forced:Object.assign!==o},{assign:o})},6764:(e,t,n)=>{var r=n(390),o=n(7001);r({target:"Object",stat:!0,forced:!o,sham:!o},{defineProperty:n(7550).f})},9398:(e,t,n)=>{var r=n(390),o=n(3895).entries;r({target:"Object",stat:!0},{entries:function(e){return o(e)}})},554:(e,t,n)=>{var r=n(390),o=n(6530),a=n(3861),i=n(5904).f,s=n(7001),l=o((function(){i(1)}));r({target:"Object",stat:!0,forced:!s||l,sham:!s},{getOwnPropertyDescriptor:function(e,t){return i(a(e),t)}})},4267:(e,t,n)=>{var r=n(390),o=n(7001),a=n(5340),i=n(3861),s=n(5904),l=n(409);r({target:"Object",stat:!0,sham:!o},{getOwnPropertyDescriptors:function(e){for(var t,n,r=i(e),o=s.f,c=a(r),u={},d=0;c.length>d;)void 0!==(n=o(r,t=c[d++]))&&l(u,t,n);return u}})},8390:(e,t,n)=>{var r=n(390),o=n(2058),a=n(461);r({target:"Object",stat:!0,forced:n(6530)((function(){a(1)}))},{keys:function(e){return a(o(e))}})},2575:()=>{},1171:(e,t,n)=>{var r=n(390),o=n(3895).values;r({target:"Object",stat:!0},{values:function(e){return o(e)}})},4465:(e,t,n)=>{"use strict";var r=n(390),o=n(9077),a=n(4130),i=n(4618),s=n(3906);r({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=a.f(t),r=n.resolve,l=n.reject,c=i((function(){var n=o(t.resolve),a=[],i=0,l=1;s(e,(function(e){var o=i++,s=!1;a.push(void 0),l++,n.call(t,e).then((function(e){s||(s=!0,a[o]={status:"fulfilled",value:e},--l||r(a))}),(function(e){s||(s=!0,a[o]={status:"rejected",reason:e},--l||r(a))}))})),--l||r(a)}));return c.error&&l(c.value),n.promise}})},8359:(e,t,n)=>{"use strict";var r=n(390),o=n(9077),a=n(8104),i=n(4130),s=n(4618),l=n(3906),c="No one promise resolved";r({target:"Promise",stat:!0},{any:function(e){var t=this,n=i.f(t),r=n.resolve,u=n.reject,d=s((function(){var n=o(t.resolve),i=[],s=0,d=1,f=!1;l(e,(function(e){var o=s++,l=!1;i.push(void 0),d++,n.call(t,e).then((function(e){l||f||(f=!0,r(e))}),(function(e){l||f||(l=!0,i[o]=e,--d||u(new(a("AggregateError"))(i,c)))}))})),--d||u(new(a("AggregateError"))(i,c))}));return d.error&&u(d.value),n.promise}})},5203:(e,t,n)=>{"use strict";var r=n(390),o=n(8367),a=n(3104),i=n(6530),s=n(8104),l=n(5462),c=n(4567),u=n(9791);if(r({target:"Promise",proto:!0,real:!0,forced:!!a&&i((function(){a.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=l(this,s("Promise")),n="function"==typeof e;return this.then(n?function(n){return c(t,e()).then((function(){return n}))}:e,n?function(n){return c(t,e()).then((function(){throw n}))}:e)}}),!o&&"function"==typeof a){var d=s("Promise").prototype.finally;a.prototype.finally!==d&&u(a.prototype,"finally",d,{unsafe:!0})}},3658:(e,t,n)=>{"use strict";var r,o,a,i,s=n(390),l=n(8367),c=n(2868),u=n(8104),d=n(3104),f=n(9791),h=n(9248),p=n(5255),m=n(6738),v=n(2655),g=n(3359),y=n(9077),x=n(8792),b=n(1494),w=n(3906),T=n(8908),I=n(5462),S=n(6569).set,E=n(8054),C=n(4567),A=n(8471),M=n(4130),P=n(4618),D=n(5875),k=n(1011),O=n(5712),L=n(6610),R=n(6521),_=n(8233),N=O("species"),U="Promise",B=D.get,j=D.set,F=D.getterFor(U),V=d&&d.prototype,H=d,z=V,q=c.TypeError,W=c.document,G=c.process,Y=M.f,Z=Y,X=!!(W&&W.createEvent&&c.dispatchEvent),Q="function"==typeof PromiseRejectionEvent,K="unhandledrejection",J=!1,$=k(U,(function(){var e=b(H),t=e!==String(H);if(!t&&66===_)return!0;if(l&&!z.finally)return!0;if(_>=51&&/native code/.test(e))return!1;var n=new H((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[N]=r,!(J=n.then((function(){}))instanceof r)||!t&&L&&!Q})),ee=$||!T((function(e){H.all(e).catch((function(){}))})),te=function(e){var t;return!(!g(e)||"function"!=typeof(t=e.then))&&t},ne=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;E((function(){for(var r=e.value,o=1==e.state,a=0;n.length>a;){var i,s,l,c=n[a++],u=o?c.ok:c.fail,d=c.resolve,f=c.reject,h=c.domain;try{u?(o||(2===e.rejection&&ie(e),e.rejection=1),!0===u?i=r:(h&&h.enter(),i=u(r),h&&(h.exit(),l=!0)),i===c.promise?f(q("Promise-chain cycle")):(s=te(i))?s.call(i,d,f):d(i)):f(r)}catch(e){h&&!l&&h.exit(),f(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&oe(e)}))}},re=function(e,t,n){var r,o;X?((r=W.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),c.dispatchEvent(r)):r={promise:t,reason:n},!Q&&(o=c["on"+e])?o(r):e===K&&A("Unhandled promise rejection",n)},oe=function(e){S.call(c,(function(){var t,n=e.facade,r=e.value;if(ae(e)&&(t=P((function(){R?G.emit("unhandledRejection",r,n):re(K,n,r)})),e.rejection=R||ae(e)?2:1,t.error))throw t.value}))},ae=function(e){return 1!==e.rejection&&!e.parent},ie=function(e){S.call(c,(function(){var t=e.facade;R?G.emit("rejectionHandled",t):re("rejectionhandled",t,e.value)}))},se=function(e,t,n){return function(r){e(t,r,n)}},le=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,ne(e,!0))},ce=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw q("Promise can't be resolved itself");var r=te(t);r?E((function(){var n={done:!1};try{r.call(t,se(ce,n,e),se(le,n,e))}catch(t){le(n,t,e)}})):(e.value=t,e.state=1,ne(e,!1))}catch(t){le({done:!1},t,e)}}};if($&&(z=(H=function(e){x(this,H,U),y(e),r.call(this);var t=B(this);try{e(se(ce,t),se(le,t))}catch(e){le(t,e)}}).prototype,(r=function(e){j(this,{type:U,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=h(z,{then:function(e,t){var n=F(this),r=Y(I(this,H));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=R?G.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&ne(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r,t=B(e);this.promise=e,this.resolve=se(ce,t),this.reject=se(le,t)},M.f=Y=function(e){return e===H||e===a?new o(e):Z(e)},!l&&"function"==typeof d&&V!==Object.prototype)){i=V.then,J||(f(V,"then",(function(e,t){var n=this;return new H((function(e,t){i.call(n,e,t)})).then(e,t)}),{unsafe:!0}),f(V,"catch",z.catch,{unsafe:!0}));try{delete V.constructor}catch(e){}p&&p(V,z)}s({global:!0,wrap:!0,forced:$},{Promise:H}),m(H,U,!1,!0),v(U),a=u(U),s({target:U,stat:!0,forced:$},{reject:function(e){var t=Y(this);return t.reject.call(void 0,e),t.promise}}),s({target:U,stat:!0,forced:l||$},{resolve:function(e){return C(l&&this===a?H:this,e)}}),s({target:U,stat:!0,forced:ee},{all:function(e){var t=this,n=Y(t),r=n.resolve,o=n.reject,a=P((function(){var n=y(t.resolve),a=[],i=0,s=1;w(e,(function(e){var l=i++,c=!1;a.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,a[l]=e,--s||r(a))}),o)})),--s||r(a)}));return a.error&&o(a.value),n.promise},race:function(e){var t=this,n=Y(t),r=n.reject,o=P((function(){var o=y(t.resolve);w(e,(function(e){o.call(t,e).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}})},6268:()=>{},8714:()=>{},688:(e,t,n)=>{"use strict";var r=n(390),o=n(9611),a=n(3604),i=n(5264);r({target:"String",proto:!0,forced:!n(1722)("includes")},{includes:function(e){return!!~i(a(this)).indexOf(i(o(e)),arguments.length>1?arguments[1]:void 0)}})},8109:(e,t,n)=>{"use strict";var r=n(1420).charAt,o=n(5264),a=n(5875),i=n(8277),s="String Iterator",l=a.set,c=a.getterFor(s);i(String,"String",(function(e){l(this,{type:s,string:o(e),index:0})}),(function(){var e,t=c(this),n=t.string,o=t.index;return o>=n.length?{value:void 0,done:!0}:(e=r(n,o),t.index+=e.length,{value:e,done:!1})}))},8217:(e,t,n)=>{"use strict";var r=n(390),o=n(774).trim;r({target:"String",proto:!0,forced:n(9787)("trim")},{trim:function(){return o(this)}})},5762:(e,t,n)=>{n(1412)("asyncIterator")},2181:()=>{},8848:(e,t,n)=>{n(1412)("hasInstance")},3719:(e,t,n)=>{n(1412)("isConcatSpreadable")},2362:(e,t,n)=>{n(1412)("iterator")},8318:(e,t,n)=>{"use strict";var r=n(390),o=n(2868),a=n(8104),i=n(8367),s=n(7001),l=n(3216),c=n(6530),u=n(6690),d=n(1054),f=n(3359),h=n(1149),p=n(1912),m=n(2058),v=n(3861),g=n(5623),y=n(5264),x=n(5595),b=n(2491),w=n(461),T=n(9035),I=n(6159),S=n(3764),E=n(5904),C=n(7550),A=n(1156),M=n(8518),P=n(9791),D=n(6315),k=n(5039),O=n(7048),L=n(9),R=n(5712),_=n(3379),N=n(1412),U=n(6738),B=n(5875),j=n(4206).forEach,F=k("hidden"),V="Symbol",H=R("toPrimitive"),z=B.set,q=B.getterFor(V),W=Object.prototype,G=o.Symbol,Y=a("JSON","stringify"),Z=E.f,X=C.f,Q=I.f,K=A.f,J=D("symbols"),$=D("op-symbols"),ee=D("string-to-symbol-registry"),te=D("symbol-to-string-registry"),ne=D("wks"),re=o.QObject,oe=!re||!re.prototype||!re.prototype.findChild,ae=s&&c((function(){return 7!=b(X({},"a",{get:function(){return X(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Z(W,t);r&&delete W[t],X(e,t,n),r&&e!==W&&X(W,t,r)}:X,ie=function(e,t){var n=J[e]=b(G.prototype);return z(n,{type:V,tag:e,description:t}),s||(n.description=t),n},se=function(e,t,n){e===W&&se($,t,n),p(e);var r=g(t);return p(n),u(J,r)?(n.enumerable?(u(e,F)&&e[F][r]&&(e[F][r]=!1),n=b(n,{enumerable:x(0,!1)})):(u(e,F)||X(e,F,x(1,{})),e[F][r]=!0),ae(e,r,n)):X(e,r,n)},le=function(e,t){p(e);var n=v(t),r=w(n).concat(fe(n));return j(r,(function(t){s&&!ce.call(n,t)||se(e,t,n[t])})),e},ce=function(e){var t=g(e),n=K.call(this,t);return!(this===W&&u(J,t)&&!u($,t))&&(!(n||!u(this,t)||!u(J,t)||u(this,F)&&this[F][t])||n)},ue=function(e,t){var n=v(e),r=g(t);if(n!==W||!u(J,r)||u($,r)){var o=Z(n,r);return!o||!u(J,r)||u(n,F)&&n[F][r]||(o.enumerable=!0),o}},de=function(e){var t=Q(v(e)),n=[];return j(t,(function(e){u(J,e)||u(O,e)||n.push(e)})),n},fe=function(e){var t=e===W,n=Q(t?$:v(e)),r=[];return j(n,(function(e){!u(J,e)||t&&!u(W,e)||r.push(J[e])})),r};l||(P((G=function(){if(this instanceof G)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?y(arguments[0]):void 0,t=L(e),n=function(e){this===W&&n.call($,e),u(this,F)&&u(this[F],t)&&(this[F][t]=!1),ae(this,t,x(1,e))};return s&&oe&&ae(W,t,{configurable:!0,set:n}),ie(t,e)}).prototype,"toString",(function(){return q(this).tag})),P(G,"withoutSetter",(function(e){return ie(L(e),e)})),A.f=ce,C.f=se,E.f=ue,T.f=I.f=de,S.f=fe,_.f=function(e){return ie(R(e),e)},s&&(X(G.prototype,"description",{configurable:!0,get:function(){return q(this).description}}),i||P(W,"propertyIsEnumerable",ce,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!l,sham:!l},{Symbol:G}),j(w(ne),(function(e){N(e)})),r({target:V,stat:!0,forced:!l},{for:function(e){var t=y(e);if(u(ee,t))return ee[t];var n=G(t);return ee[t]=n,te[n]=t,n},keyFor:function(e){if(!h(e))throw TypeError(e+" is not a symbol");if(u(te,e))return te[e]},useSetter:function(){oe=!0},useSimple:function(){oe=!1}}),r({target:"Object",stat:!0,forced:!l,sham:!s},{create:function(e,t){return void 0===t?b(e):le(b(e),t)},defineProperty:se,defineProperties:le,getOwnPropertyDescriptor:ue}),r({target:"Object",stat:!0,forced:!l},{getOwnPropertyNames:de,getOwnPropertySymbols:fe}),r({target:"Object",stat:!0,forced:c((function(){S.f(1)}))},{getOwnPropertySymbols:function(e){return S.f(m(e))}}),Y&&r({target:"JSON",stat:!0,forced:!l||c((function(){var e=G();return"[null]"!=Y([e])||"{}"!=Y({a:e})||"{}"!=Y(Object(e))}))},{stringify:function(e,t,n){for(var r,o=[e],a=1;arguments.length>a;)o.push(arguments[a++]);if(r=t,(f(t)||void 0!==e)&&!h(e))return d(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!h(t))return t}),o[1]=t,Y.apply(null,o)}}),G.prototype[H]||M(G.prototype,H,G.prototype.valueOf),U(G,V),O[F]=!0},888:(e,t,n)=>{n(1412)("matchAll")},346:(e,t,n)=>{n(1412)("match")},909:(e,t,n)=>{n(1412)("replace")},1992:(e,t,n)=>{n(1412)("search")},8512:(e,t,n)=>{n(1412)("species")},6165:(e,t,n)=>{n(1412)("split")},6044:(e,t,n)=>{n(1412)("toPrimitive")},4676:(e,t,n)=>{n(1412)("toStringTag")},263:(e,t,n)=>{n(1412)("unscopables")},1152:(e,t,n)=>{n(6454)},8561:(e,t,n)=>{n(4465)},8302:(e,t,n)=>{n(8359)},5543:(e,t,n)=>{"use strict";var r=n(390),o=n(4130),a=n(4618);r({target:"Promise",stat:!0},{try:function(e){var t=o.f(this),n=a(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}})},8812:(e,t,n)=>{n(1412)("asyncDispose")},9085:(e,t,n)=>{n(1412)("dispose")},7384:(e,t,n)=>{n(1412)("matcher")},4719:(e,t,n)=>{n(1412)("metadata")},2994:(e,t,n)=>{n(1412)("observable")},9431:(e,t,n)=>{n(1412)("patternMatch")},4803:(e,t,n)=>{n(1412)("replaceAll")},9702:(e,t,n)=>{n(2228);var r=n(315),o=n(2868),a=n(7499),i=n(8518),s=n(9418),l=n(5712)("toStringTag");for(var c in r){var u=o[c],d=u&&u.prototype;d&&a(d)!==l&&i(d,l,c),s[c]=s.Array}},7945:(e,t,n)=>{var r=n(5109);e.exports=r},8010:(e,t,n)=>{var r=n(1316);e.exports=r},7922:(e,t,n)=>{var r=n(3386);n(9702),e.exports=r},9842:(e,t,n)=>{var r=n(7543);e.exports=r},3798:(e,t,n)=>{var r=n(3918);e.exports=r},2149:(e,t,n)=>{var r=n(790);e.exports=r},6970:(e,t,n)=>{var r=n(9109);e.exports=r},5838:(e,t,n)=>{var r=n(4825);e.exports=r},2343:(e,t,n)=>{var r=n(238);e.exports=r},671:(e,t,n)=>{var r=n(1285);e.exports=r},7283:(e,t,n)=>{var r=n(7681);e.exports=r},2882:(e,t,n)=>{var r=n(8949);e.exports=r},8730:(e,t,n)=>{var r=n(2529);e.exports=r},8531:(e,t,n)=>{var r=n(6854);e.exports=r},569:(e,t,n)=>{var r=n(1553);e.exports=r},3751:(e,t,n)=>{var r=n(2744);e.exports=r},1380:(e,t,n)=>{var r=n(6018);e.exports=r},6601:(e,t,n)=>{var r=n(5350);e.exports=r},8783:(e,t,n)=>{var r=n(8116);e.exports=r},3498:(e,t,n)=>{var r=n(3140);e.exports=r},4731:(e,t,n)=>{var r=n(7281);n(9702),e.exports=r},3355:(e,t,n)=>{var r=n(1442);n(9702),e.exports=r},6888:(e,t,n)=>{var r=n(1190);n(9702),e.exports=r},5613:(e,t,n)=>{"use strict";const r=n(1863),o=n(7609),a=n(9141),i=n(5710),s=n(8894),l=n(8235),c=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:d,Z_OK:f,Z_STREAM_END:h,Z_NEED_DICT:p,Z_STREAM_ERROR:m,Z_DATA_ERROR:v,Z_MEM_ERROR:g}=n(2436);function y(e){this.options=o.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let n=r.inflateInit2(this.strm,t.windowBits);if(n!==f)throw new Error(i[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary),n!==f)))throw new Error(i[n])}function x(e,t){const n=new y(t);if(n.push(e),n.err)throw n.msg||i[n.err];return n.result}y.prototype.push=function(e,t){const n=this.strm,o=this.options.chunkSize,i=this.options.dictionary;let s,l,y;if(this.ended)return!1;for(l=t===~~t?t:!0===t?d:u,"[object ArrayBuffer]"===c.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),s=r.inflate(n,l),s===p&&i&&(s=r.inflateSetDictionary(n,i),s===f?s=r.inflate(n,l):s===v&&(s=p));n.avail_in>0&&s===h&&n.state.wrap>0&&0!==e[n.next_in];)r.inflateReset(n),s=r.inflate(n,l);switch(s){case m:case v:case p:case g:return this.onEnd(s),this.ended=!0,!1}if(y=n.avail_out,n.next_out&&(0===n.avail_out||s===h))if("string"===this.options.to){let e=a.utf8border(n.output,n.next_out),t=n.next_out-e,r=a.buf2string(n.output,e);n.next_out=t,n.avail_out=o-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==f||0!==y){if(s===h)return s=r.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Hq=function(e,t){return(t=t||{}).raw=!0,x(e,t)},n(2436)},7609:e=>{"use strict";const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);e.exports.assign=function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const r=n.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const n in r)t(r,n)&&(e[n]=r[n])}}return e},e.exports.flattenChunks=e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,o=e.length;t<o;t++){let o=e[t];n.set(o,r),r+=o.length}return n}},9141:e=>{"use strict";let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const n=new Uint8Array(256);for(let e=0;e<256;e++)n[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;n[254]=n[254]=1,e.exports.string2buf=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,o,a,i=e.length,s=0;for(o=0;o<i;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<i&&(r=e.charCodeAt(o+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,o=0;a<s;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<i&&(r=e.charCodeAt(o+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},e.exports.buf2string=(e,r)=>{const o=r||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,r));let a,i;const s=new Array(2*o);for(i=0,a=0;a<o;){let t=e[a++];if(t<128){s[i++]=t;continue}let r=n[t];if(r>4)s[i++]=65533,a+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&a<o;)t=t<<6|63&e[a++],r--;r>1?s[i++]=65533:t<65536?s[i++]=t:(t-=65536,s[i++]=55296|t>>10&1023,s[i++]=56320|1023&t)}}return((e,n)=>{if(n<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===n?e:e.subarray(0,n));let r="";for(let t=0;t<n;t++)r+=String.fromCharCode(e[t]);return r})(s,i)},e.exports.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+n[e[r]]>t?r:t}},5530:e=>{"use strict";e.exports=(e,t,n,r)=>{let o=65535&e|0,a=e>>>16&65535|0,i=0;for(;0!==n;){i=n>2e3?2e3:n,n-=i;do{o=o+t[r++]|0,a=a+o|0}while(--i);o%=65521,a%=65521}return o|a<<16|0}},2436:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},1383:e=>{"use strict";const t=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());e.exports=(e,n,r,o)=>{const a=t,i=o+r;e^=-1;for(let t=o;t<i;t++)e=e>>>8^a[255&(e^n[t])];return-1^e}},8235:e=>{"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},8121:e=>{"use strict";e.exports=function(e,t){let n,r,o,a,i,s,l,c,u,d,f,h,p,m,v,g,y,x,b,w,T,I,S,E;const C=e.state;n=e.next_in,S=e.input,r=n+(e.avail_in-5),o=e.next_out,E=e.output,a=o-(t-e.avail_out),i=o+(e.avail_out-257),s=C.dmax,l=C.wsize,c=C.whave,u=C.wnext,d=C.window,f=C.hold,h=C.bits,p=C.lencode,m=C.distcode,v=(1<<C.lenbits)-1,g=(1<<C.distbits)-1;e:do{h<15&&(f+=S[n++]<<h,h+=8,f+=S[n++]<<h,h+=8),y=p[f&v];t:for(;;){if(x=y>>>24,f>>>=x,h-=x,x=y>>>16&255,0===x)E[o++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=p[(65535&y)+(f&(1<<x)-1)];continue t}if(32&x){C.mode=12;break e}e.msg="invalid literal/length code",C.mode=30;break e}b=65535&y,x&=15,x&&(h<x&&(f+=S[n++]<<h,h+=8),b+=f&(1<<x)-1,f>>>=x,h-=x),h<15&&(f+=S[n++]<<h,h+=8,f+=S[n++]<<h,h+=8),y=m[f&g];n:for(;;){if(x=y>>>24,f>>>=x,h-=x,x=y>>>16&255,!(16&x)){if(0==(64&x)){y=m[(65535&y)+(f&(1<<x)-1)];continue n}e.msg="invalid distance code",C.mode=30;break e}if(w=65535&y,x&=15,h<x&&(f+=S[n++]<<h,h+=8,h<x&&(f+=S[n++]<<h,h+=8)),w+=f&(1<<x)-1,w>s){e.msg="invalid distance too far back",C.mode=30;break e}if(f>>>=x,h-=x,x=o-a,w>x){if(x=w-x,x>c&&C.sane){e.msg="invalid distance too far back",C.mode=30;break e}if(T=0,I=d,0===u){if(T+=l-x,x<b){b-=x;do{E[o++]=d[T++]}while(--x);T=o-w,I=E}}else if(u<x){if(T+=l+u-x,x-=u,x<b){b-=x;do{E[o++]=d[T++]}while(--x);if(T=0,u<b){x=u,b-=x;do{E[o++]=d[T++]}while(--x);T=o-w,I=E}}}else if(T+=u-x,x<b){b-=x;do{E[o++]=d[T++]}while(--x);T=o-w,I=E}for(;b>2;)E[o++]=I[T++],E[o++]=I[T++],E[o++]=I[T++],b-=3;b&&(E[o++]=I[T++],b>1&&(E[o++]=I[T++]))}else{T=o-w;do{E[o++]=E[T++],E[o++]=E[T++],E[o++]=E[T++],b-=3}while(b>2);b&&(E[o++]=E[T++],b>1&&(E[o++]=E[T++]))}break}}break}}while(n<r&&o<i);b=h>>3,n-=b,h-=b<<3,f&=(1<<h)-1,e.next_in=n,e.next_out=o,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=o<i?i-o+257:257-(o-i),C.hold=f,C.bits=h}},1863:(e,t,n)=>{"use strict";const r=n(5530),o=n(1383),a=n(8121),i=n(7371),{Z_FINISH:s,Z_BLOCK:l,Z_TREES:c,Z_OK:u,Z_STREAM_END:d,Z_NEED_DICT:f,Z_STREAM_ERROR:h,Z_DATA_ERROR:p,Z_MEM_ERROR:m,Z_BUF_ERROR:v,Z_DEFLATED:g}=n(2436),y=12,x=30,b=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const T=e=>{if(!e||!e.state)return h;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,u},I=e=>{if(!e||!e.state)return h;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,T(e)},S=(e,t)=>{let n;if(!e||!e.state)return h;const r=e.state;return t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,I(e))},E=(e,t)=>{if(!e)return h;const n=new w;e.state=n,n.window=null;const r=S(e,t);return r!==u&&(e.state=null),r};let C,A,M=!0;const P=e=>{if(M){C=new Int32Array(512),A=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(i(1,e.lens,0,288,C,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;i(2,e.lens,0,32,A,0,e.work,{bits:5}),M=!1}e.lencode=C,e.lenbits=9,e.distcode=A,e.distbits=5},D=(e,t,n,r)=>{let o;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>r&&(o=r),a.window.set(t.subarray(n-r,n-r+o),a.wnext),(r-=o)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0};e.exports.inflateReset=I,e.exports.inflateReset2=S,e.exports.inflateResetKeep=T,e.exports.inflateInit=e=>E(e,15),e.exports.inflateInit2=E,e.exports.inflate=(e,t)=>{let n,w,T,I,S,E,C,A,M,k,O,L,R,_,N,U,B,j,F,V,H,z,q=0;const W=new Uint8Array(4);let G,Y;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;n=e.state,n.mode===y&&(n.mode=13),S=e.next_out,T=e.output,C=e.avail_out,I=e.next_in,w=e.input,E=e.avail_in,A=n.hold,M=n.bits,k=E,O=C,z=u;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;M<16;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(2&n.wrap&&35615===A){n.check=0,W[0]=255&A,W[1]=A>>>8&255,n.check=o(n.check,W,2,0),A=0,M=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&A)<<8)+(A>>8))%31){e.msg="incorrect header check",n.mode=x;break}if((15&A)!==g){e.msg="unknown compression method",n.mode=x;break}if(A>>>=4,M-=4,H=8+(15&A),0===n.wbits)n.wbits=H;else if(H>n.wbits){e.msg="invalid window size",n.mode=x;break}n.dmax=1<<n.wbits,e.adler=n.check=1,n.mode=512&A?10:y,A=0,M=0;break;case 2:for(;M<16;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(n.flags=A,(255&n.flags)!==g){e.msg="unknown compression method",n.mode=x;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=x;break}n.head&&(n.head.text=A>>8&1),512&n.flags&&(W[0]=255&A,W[1]=A>>>8&255,n.check=o(n.check,W,2,0)),A=0,M=0,n.mode=3;case 3:for(;M<32;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}n.head&&(n.head.time=A),512&n.flags&&(W[0]=255&A,W[1]=A>>>8&255,W[2]=A>>>16&255,W[3]=A>>>24&255,n.check=o(n.check,W,4,0)),A=0,M=0,n.mode=4;case 4:for(;M<16;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}n.head&&(n.head.xflags=255&A,n.head.os=A>>8),512&n.flags&&(W[0]=255&A,W[1]=A>>>8&255,n.check=o(n.check,W,2,0)),A=0,M=0,n.mode=5;case 5:if(1024&n.flags){for(;M<16;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}n.length=A,n.head&&(n.head.extra_len=A),512&n.flags&&(W[0]=255&A,W[1]=A>>>8&255,n.check=o(n.check,W,2,0)),A=0,M=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(L=n.length,L>E&&(L=E),L&&(n.head&&(H=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(w.subarray(I,I+L),H)),512&n.flags&&(n.check=o(n.check,w,L,I)),E-=L,I+=L,n.length-=L),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===E)break e;L=0;do{H=w[I+L++],n.head&&H&&n.length<65536&&(n.head.name+=String.fromCharCode(H))}while(H&&L<E);if(512&n.flags&&(n.check=o(n.check,w,L,I)),E-=L,I+=L,H)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===E)break e;L=0;do{H=w[I+L++],n.head&&H&&n.length<65536&&(n.head.comment+=String.fromCharCode(H))}while(H&&L<E);if(512&n.flags&&(n.check=o(n.check,w,L,I)),E-=L,I+=L,H)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;M<16;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(A!==(65535&n.check)){e.msg="header crc mismatch",n.mode=x;break}A=0,M=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=y;break;case 10:for(;M<32;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}e.adler=n.check=b(A),A=0,M=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=S,e.avail_out=C,e.next_in=I,e.avail_in=E,n.hold=A,n.bits=M,f;e.adler=n.check=1,n.mode=y;case y:if(t===l||t===c)break e;case 13:if(n.last){A>>>=7&M,M-=7&M,n.mode=27;break}for(;M<3;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}switch(n.last=1&A,A>>>=1,M-=1,3&A){case 0:n.mode=14;break;case 1:if(P(n),n.mode=20,t===c){A>>>=2,M-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=x}A>>>=2,M-=2;break;case 14:for(A>>>=7&M,M-=7&M;M<32;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if((65535&A)!=(A>>>16^65535)){e.msg="invalid stored block lengths",n.mode=x;break}if(n.length=65535&A,A=0,M=0,n.mode=15,t===c)break e;case 15:n.mode=16;case 16:if(L=n.length,L){if(L>E&&(L=E),L>C&&(L=C),0===L)break e;T.set(w.subarray(I,I+L),S),E-=L,I+=L,C-=L,S+=L,n.length-=L;break}n.mode=y;break;case 17:for(;M<14;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(n.nlen=257+(31&A),A>>>=5,M-=5,n.ndist=1+(31&A),A>>>=5,M-=5,n.ncode=4+(15&A),A>>>=4,M-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=x;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;M<3;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}n.lens[Z[n.have++]]=7&A,A>>>=3,M-=3}for(;n.have<19;)n.lens[Z[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,G={bits:n.lenbits},z=i(0,n.lens,0,19,n.lencode,0,n.work,G),n.lenbits=G.bits,z){e.msg="invalid code lengths set",n.mode=x;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;q=n.lencode[A&(1<<n.lenbits)-1],N=q>>>24,U=q>>>16&255,B=65535&q,!(N<=M);){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(B<16)A>>>=N,M-=N,n.lens[n.have++]=B;else{if(16===B){for(Y=N+2;M<Y;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(A>>>=N,M-=N,0===n.have){e.msg="invalid bit length repeat",n.mode=x;break}H=n.lens[n.have-1],L=3+(3&A),A>>>=2,M-=2}else if(17===B){for(Y=N+3;M<Y;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}A>>>=N,M-=N,H=0,L=3+(7&A),A>>>=3,M-=3}else{for(Y=N+7;M<Y;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}A>>>=N,M-=N,H=0,L=11+(127&A),A>>>=7,M-=7}if(n.have+L>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=x;break}for(;L--;)n.lens[n.have++]=H}}if(n.mode===x)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=x;break}if(n.lenbits=9,G={bits:n.lenbits},z=i(1,n.lens,0,n.nlen,n.lencode,0,n.work,G),n.lenbits=G.bits,z){e.msg="invalid literal/lengths set",n.mode=x;break}if(n.distbits=6,n.distcode=n.distdyn,G={bits:n.distbits},z=i(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,G),n.distbits=G.bits,z){e.msg="invalid distances set",n.mode=x;break}if(n.mode=20,t===c)break e;case 20:n.mode=21;case 21:if(E>=6&&C>=258){e.next_out=S,e.avail_out=C,e.next_in=I,e.avail_in=E,n.hold=A,n.bits=M,a(e,O),S=e.next_out,T=e.output,C=e.avail_out,I=e.next_in,w=e.input,E=e.avail_in,A=n.hold,M=n.bits,n.mode===y&&(n.back=-1);break}for(n.back=0;q=n.lencode[A&(1<<n.lenbits)-1],N=q>>>24,U=q>>>16&255,B=65535&q,!(N<=M);){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(U&&0==(240&U)){for(j=N,F=U,V=B;q=n.lencode[V+((A&(1<<j+F)-1)>>j)],N=q>>>24,U=q>>>16&255,B=65535&q,!(j+N<=M);){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}A>>>=j,M-=j,n.back+=j}if(A>>>=N,M-=N,n.back+=N,n.length=B,0===U){n.mode=26;break}if(32&U){n.back=-1,n.mode=y;break}if(64&U){e.msg="invalid literal/length code",n.mode=x;break}n.extra=15&U,n.mode=22;case 22:if(n.extra){for(Y=n.extra;M<Y;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}n.length+=A&(1<<n.extra)-1,A>>>=n.extra,M-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;q=n.distcode[A&(1<<n.distbits)-1],N=q>>>24,U=q>>>16&255,B=65535&q,!(N<=M);){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(0==(240&U)){for(j=N,F=U,V=B;q=n.distcode[V+((A&(1<<j+F)-1)>>j)],N=q>>>24,U=q>>>16&255,B=65535&q,!(j+N<=M);){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}A>>>=j,M-=j,n.back+=j}if(A>>>=N,M-=N,n.back+=N,64&U){e.msg="invalid distance code",n.mode=x;break}n.offset=B,n.extra=15&U,n.mode=24;case 24:if(n.extra){for(Y=n.extra;M<Y;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}n.offset+=A&(1<<n.extra)-1,A>>>=n.extra,M-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=x;break}n.mode=25;case 25:if(0===C)break e;if(L=O-C,n.offset>L){if(L=n.offset-L,L>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=x;break}L>n.wnext?(L-=n.wnext,R=n.wsize-L):R=n.wnext-L,L>n.length&&(L=n.length),_=n.window}else _=T,R=S-n.offset,L=n.length;L>C&&(L=C),C-=L,n.length-=L;do{T[S++]=_[R++]}while(--L);0===n.length&&(n.mode=21);break;case 26:if(0===C)break e;T[S++]=n.length,C--,n.mode=21;break;case 27:if(n.wrap){for(;M<32;){if(0===E)break e;E--,A|=w[I++]<<M,M+=8}if(O-=C,e.total_out+=O,n.total+=O,O&&(e.adler=n.check=n.flags?o(n.check,T,O,S-O):r(n.check,T,O,S-O)),O=C,(n.flags?A:b(A))!==n.check){e.msg="incorrect data check",n.mode=x;break}A=0,M=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;M<32;){if(0===E)break e;E--,A+=w[I++]<<M,M+=8}if(A!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=x;break}A=0,M=0}n.mode=29;case 29:z=d;break e;case x:z=p;break e;case 31:return m;default:return h}return e.next_out=S,e.avail_out=C,e.next_in=I,e.avail_in=E,n.hold=A,n.bits=M,(n.wsize||O!==e.avail_out&&n.mode<x&&(n.mode<27||t!==s))&&D(e,e.output,e.next_out,O-e.avail_out)?(n.mode=31,m):(k-=e.avail_in,O-=e.avail_out,e.total_in+=k,e.total_out+=O,n.total+=O,n.wrap&&O&&(e.adler=n.check=n.flags?o(n.check,T,O,e.next_out-O):r(n.check,T,O,e.next_out-O)),e.data_type=n.bits+(n.last?64:0)+(n.mode===y?128:0)+(20===n.mode||15===n.mode?256:0),(0===k&&0===O||t===s)&&z===u&&(z=v),z)},e.exports.inflateEnd=e=>{if(!e||!e.state)return h;let t=e.state;return t.window&&(t.window=null),e.state=null,u},e.exports.inflateGetHeader=(e,t)=>{if(!e||!e.state)return h;const n=e.state;return 0==(2&n.wrap)?h:(n.head=t,t.done=!1,u)},e.exports.inflateSetDictionary=(e,t)=>{const n=t.length;let o,a,i;return e&&e.state?(o=e.state,0!==o.wrap&&11!==o.mode?h:11===o.mode&&(a=1,a=r(a,t,n,0),a!==o.check)?p:(i=D(e,t,n,n),i?(o.mode=31,m):(o.havedict=1,u))):h},e.exports.inflateInfo="pako inflate (from Nodeca project)"},7371:e=>{"use strict";const t=15,n=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),r=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),o=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),a=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,i,s,l,c,u,d,f)=>{const h=f.bits;let p,m,v,g,y,x,b=0,w=0,T=0,I=0,S=0,E=0,C=0,A=0,M=0,P=0,D=null,k=0;const O=new Uint16Array(16),L=new Uint16Array(16);let R,_,N,U=null,B=0;for(b=0;b<=t;b++)O[b]=0;for(w=0;w<l;w++)O[i[s+w]]++;for(S=h,I=t;I>=1&&0===O[I];I--);if(S>I&&(S=I),0===I)return c[u++]=20971520,c[u++]=20971520,f.bits=1,0;for(T=1;T<I&&0===O[T];T++);for(S<T&&(S=T),A=1,b=1;b<=t;b++)if(A<<=1,A-=O[b],A<0)return-1;if(A>0&&(0===e||1!==I))return-1;for(L[1]=0,b=1;b<t;b++)L[b+1]=L[b]+O[b];for(w=0;w<l;w++)0!==i[s+w]&&(d[L[i[s+w]]++]=w);if(0===e?(D=U=d,x=19):1===e?(D=n,k-=257,U=r,B-=257,x=256):(D=o,U=a,x=-1),P=0,w=0,b=T,y=u,E=S,C=0,v=-1,M=1<<S,g=M-1,1===e&&M>852||2===e&&M>592)return 1;for(;;){R=b-C,d[w]<x?(_=0,N=d[w]):d[w]>x?(_=U[B+d[w]],N=D[k+d[w]]):(_=96,N=0),p=1<<b-C,m=1<<E,T=m;do{m-=p,c[y+(P>>C)+m]=R<<24|_<<16|N|0}while(0!==m);for(p=1<<b-1;P&p;)p>>=1;if(0!==p?(P&=p-1,P+=p):P=0,w++,0==--O[b]){if(b===I)break;b=i[s+d[w]]}if(b>S&&(P&g)!==v){for(0===C&&(C=S),y+=T,E=b-C,A=1<<E;E+C<I&&(A-=O[E+C],!(A<=0));)E++,A<<=1;if(M+=1<<E,1===e&&M>852||2===e&&M>592)return 1;v=P&g,c[v]=S<<24|E<<16|y-u|0}}return 0!==P&&(c[y+P]=b-C<<24|64<<16|0),f.bits=S,0}},5710:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},8894:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})();var r={};return(()=>{"use strict";function e(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");var r=e.length/3,o=0,a=0;if(n)for(var i=0;i<r;i++)t[a++]=e[o++],t[a++]=e[o++],t[a++]=e[o++],t[a++]=255;else t.set(e)}function t(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");var r=e.length/3,o=0,a=0,i=r,s=2*r;if(n)for(var l=0;l<r;l++)t[o++]=e[a++],t[o++]=e[i++],t[o++]=e[s++],t[o++]=255;else t.set(e)}function o(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");var r=e.length/3,o=0,a=0;if(n)for(var i=0;i<r;i++){var s=e[o++],l=e[o++],c=e[o++];t[a++]=s+1.402*(c-128),t[a++]=s-.34414*(l-128)-.71414*(c-128),t[a++]=s+1.772*(l-128),t[a++]=255}else for(var u=0;u<r;u++){var d=e[o++],f=e[o++],h=e[o++];t[a++]=d+1.402*(h-128),t[a++]=d-.34414*(f-128)-.71414*(h-128),t[a++]=d+1.772*(f-128)}}function a(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");var r=e.length/3,o=0,a=0,i=r,s=2*r;if(n)for(var l=0;l<r;l++){var c=e[a++],u=e[i++],d=e[s++];t[o++]=c+1.402*(d-128),t[o++]=c-.34414*(u-128)-.71414*(d-128),t[o++]=c+1.772*(u-128),t[o++]=255}else for(var f=0;f<r;f++){var h=e[a++],p=e[i++],m=e[s++];t[o++]=h+1.402*(m-128),t[o++]=h-.34414*(p-128)-.71414*(m-128),t[o++]=h+1.772*(p-128)}}function i(e,t){for(var n=e.length,r=new Uint8ClampedArray(n),o=0;o<n;++o)r[o]=e[o]>>t;return r}function s(e,t,n){var r=e.columns*e.rows,o=e.pixelData,a=e.redPaletteColorLookupTableData,s=e.greenPaletteColorLookupTableData,l=e.bluePaletteColorLookupTableData,c=e.redPaletteColorLookupTableData.length,u=0,d=0,f=e.redPaletteColorLookupTableDescriptor[1],h=8===e.redPaletteColorLookupTableDescriptor[2]?0:8,p=i(a,h),m=i(s,h),v=i(l,h);if(n)for(var g=0;g<r;++g){var y=o[u++];y<f?y=0:y>f+c-1?y=c-1:y-=f,t[d++]=p[y],t[d++]=m[y],t[d++]=v[y],t[d++]=255}else for(var x=0;x<r;++x){var b=o[u++];b<f?b=0:b>f+c-1?b=c-1:b-=f,t[d++]=p[b],t[d++]=m[b],t[d++]=v[b]}}function l(e,t){if(e.elements[t]&&6===e.elements[t].length)return[e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]}function c(e,t,n){for(var r=[],o=e.elements[t],a=0;a<n[0];a++)16===n[2]?r[a]=e.uint16(t,a):r[a]=e.byteArray[a+o.dataOffset];return r}n.r(r),n.d(r,{configure:()=>An,convertColorSpace:()=>lt,convertPALETTECOLOR:()=>s,convertRGBColorByPixel:()=>e,convertRGBColorByPlane:()=>t,convertYBRFullByPixel:()=>o,convertYBRFullByPlane:()=>a,createImage:()=>bt,decodeImageFrame:()=>at,decodeJPEGBaseline8BitColor:()=>nt,default:()=>Pn,external:()=>Mt,getImageFrame:()=>Be,getMinMax:()=>et,getPixelData:()=>Pe,internal:()=>Ee,isColorImage:()=>it,isJPEGBaseline8BitColor:()=>ct,version:()=>Mn,wadors:()=>St,wadouri:()=>Cn,webWorkerManager:()=>$e});const u=function(e){var t={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return function(e,t){0===e.uint16("x00280103")?(t.smallestPixelValue=e.uint16("x00280106"),t.largestPixelValue=e.uint16("x00280107")):(t.smallestPixelValue=e.int16("x00280106"),t.largestPixelValue=e.int16("x00280107"))}(e,t),"PALETTE COLOR"===t.photometricInterpretation&&e.elements.x00281101&&function(e,t){t.redPaletteColorLookupTableDescriptor=l(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=l(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=l(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);var n=t.redPaletteColorLookupTableDescriptor[0],r=e.elements.x00281201.length===n?8:16;t.redPaletteColorLookupTableDescriptor[2]!==r&&(t.redPaletteColorLookupTableDescriptor[2]=r,t.greenPaletteColorLookupTableDescriptor[2]=r,t.bluePaletteColorLookupTableDescriptor[2]=r),t.redPaletteColorLookupTableData=c(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=c(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=c(e,"x00281203",t.bluePaletteColorLookupTableDescriptor)}(e,t),t};function d(e,t){var n=t.uint16("x00283002",0);0===n&&(n=65535);for(var r={id:"1",firstValueMapped:0===e?t.uint16("x00283002",1):t.int16("x00283002",1),numBitsPerEntry:t.uint16("x00283002",2),lut:[]},o=0;o<n;o++)r.lut[o]=0===e?t.uint16("x00283006",o):t.int16("x00283006",o);return r}const f=function(e,t){if(t&&t.items&&t.items.length){for(var n=[],r=0;r<t.items.length;r++){var o=d(e,t.items[r].dataSet);o&&n.push(o)}return n}},h=function(e){var t=e.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===t||"1.2.840.10008.5.1.4.1.1.2.1"===t)return 1;var n=e.floatString("x00281052"),r=e.floatString("x00281053");return void 0!==n&&void 0!==r?function(e){var t=e.uint16("x00280103"),n=e.uint16("x00280101");return 0===t?0:-1<<n-1}(e)*r+n<0?1:0:e.elements.x00283000&&e.elements.x00283000.length>0?0:e.uint16("x00280103")},p=function(e,t,n){var r=[],o=e.string(t);if(o){var a=o.split("\\");if(!(n&&a.length<n)){for(var i=0;i<a.length;i++)r.push(parseFloat(a[i]));return r}}};var m=n(4559),v=n.n(m),g=n(7423),y=n.n(g);const x=function(e,t,n){return t=t||0,e&&e.Value?e.Value.length<=t?n:e.Value[t]:n},b=function(e,t,n){var r=x(e,t,n);if(void 0!==r)return parseFloat(r)},w=function(e,t){var n=x(e,t);if(void 0!==n)return parseFloat(n)},T=function(e,t){if(e&&e.Value&&!(t&&e.Value.length<t)){for(var n=[],r=0;r<e.Value.length;r++)n.push(parseFloat(e.Value[r]));return n}};function I(e){var t=e.indexOf(":");return e.substring(t+1)}var S=n(6275),E=n(4215),C=n(7830),A=n.n(C),M=n(8355),P=n(6051);function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){var n;if(e){if("string"==typeof e)return D(e,t);var r=M(n=Object.prototype.toString.call(e)).call(n,8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?P(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(e,t):void 0}}function O(e,t){return function(e){if(S(e))return e}(e)||function(e,t){var n=null==e?null:void 0!==E&&C(e)||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e){return function(e){if(S(e))return D(e)}(e)||function(e){if(void 0!==E&&null!=C(e)||null!=e["@@iterator"])return P(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var R=n(2475),_=n(3091),N=n(9719);function U(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=N(e);for(r=0;r<a.length;r++)n=a[r],_(t).call(t,n)>=0||(o[n]=e[n]);return o}(e,t);if(R){var a=R(e);for(r=0;r<a.length;r++)n=a[r],_(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var B=n(6496);function j(e){return(j="function"==typeof E&&"symbol"==typeof B?function(e){return typeof e}:function(e){return e&&"function"==typeof E&&e.constructor===E&&e!==E.prototype?"symbol":typeof e})(e)}var F=n(6059),V=n.n(F),H=n(2633),z=n.n(H),q=n(1929),W=n.n(q),G=n(1246),Y=n.n(G),Z=n(2165),X=n.n(Z);function Q(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&e.Value?e.Value[0]&&t?e.Value[0]:e.Value:e}var K=["52009230","52009229","00280008"];function J(e,t,n){var r,o,a,i;return{shared:V()(r=z()(o=t?W()(t[0]):[]).call(o,(function(e){return e[0]}))).call(r,(function(e){return void 0!==e&&"object"===j(e)})),perFrame:V()(a=z()(i=e?W()(e[n-1]):[]).call(i,(function(e){return e.Value[0]}))).call(a,(function(e){return void 0!==e&&"object"===j(e)}))}}function $(e){var t=e[52009230],n=e[52009229],r=e["00280008"],o=U(e,K);return{PerFrameFunctionalGroupsSequence:t=Q(t,!1),SharedFunctionalGroupsSequence:n=Q(n,!1),NumberOfFrames:r=Q(r),rest:o}}var ee=n(6028),te=n.n(ee);function ne(e){var t=e.indexOf("/frames/")+8,n=te()(e).call(e,0,t),r=parseInt(te()(e).call(e,t),10);return{metadata:oe["".concat(n,"1")],frame:r}}const re={_retrieveMultiframeMetadata:ne,retrieveMultiframeMetadata:function(e){return ne(I(e))},isMultiframe:function(e){var t=x(e["00280008"]);return t&&t>1}};var oe=[],ae={};const ie={add:function(e,t){var n=I(e);t.isMultiframe=re.isMultiframe(t),oe[n]=t},get:function(e){var t=I(e),n=oe[t];if(n&&(null==n||!n.isMultiframe))return n;var r=ae[t];if(r)return r;var o=re._retrieveMultiframeMetadata(t);if(o&&o.metadata){var a=o.metadata,i=o.frame;if(a){var s=function(e,t){var n=$(t),r=n.PerFrameFunctionalGroupsSequence,o=n.SharedFunctionalGroupsSequence,a=n.NumberOfFrames,i=n.rest;if(r||a>1){var s,l=J(r,o,e),c=l.shared,u=l.perFrame,d=Y()(t,{frameNumber:e});return v()(s=[]).call(s,L(c),L(u)).forEach((function(e){X()(e).forEach((function(e){var t=O(e,2),n=t[0],r=t[1];d[n]=r}))})),Y()(i,{"00280008":a},d)}return t}(i,a);return ae[t]=s,s}}},remove:function(e){var t=I(e);oe[t]=void 0,ae[t]=void 0},purge:function(){oe=[],ae={}}};function se(e){return"RECON TOMO"===e||"RECON GATED TOMO"===e}function le(e){var t=x(e["00080060"]);return y()(t).call(t,"NM")}function ce(e,t){var n=Q(e["00080008"],!1);if(n)return n[t]}function ue(e){var t=T(e["00200037"],6);return!t&&le(e)&&(t=function(e){var t,n=ce(e,2);if(n&&se(n)){var r=Q(e["00540022"]);r&&(t=T(r["00200037"],6))}return t}(e)),t}function de(e){var t=T(e["00200032"],3);return!t&&le(e)&&(t=function(e){var t,n=ce(e,2);if(n&&se(n)){var r=Q(e["00540022"]);r&&(t=T(r["00200032"],3))}return t}(e)),t}const fe=function(e,t){if("multiframeModule"===e){var n=re.retrieveMultiframeMetadata(t),r=n.metadata,o=n.frame;if(!r)return;var a=$(r),i=a.PerFrameFunctionalGroupsSequence,s=a.SharedFunctionalGroupsSequence,l=a.NumberOfFrames;if(i||l>1){var c=J(i,s,o),u=c.shared;return{NumberOfFrames:l,PerFrameFunctionalInformation:c.perFrame,SharedFunctionalInformation:u}}return{NumberOfFrames:l}}var d=Mt.dicomParser,f=ie.get(t);if(f){if("generalSeriesModule"===e)return{modality:x(f["00080060"]),seriesInstanceUID:x(f["0020000E"]),seriesNumber:w(f["00200011"]),studyInstanceUID:x(f["0020000D"]),seriesDate:d.parseDA(x(f["00080021"])),seriesTime:d.parseTM(x(f["00080031"],0,"")),acquisitionDate:d.parseDA(x(f["00080022"]),""),acquisitionTime:d.parseTM(x(f["00080032"],0,""))};if("patientStudyModule"===e)return{patientAge:w(f["00101010"]),patientSize:w(f["00101020"]),patientSex:x(f["00100040"]),patientWeight:w(f["00101030"])};if("nmMultiframeGeometryModule"===e){var h=x(f["00080060"]),p=ce(f,2);return{modality:h,imageType:x(f["00080008"]),imageSubType:p,imageOrientationPatient:ue(f),imagePositionPatient:de(f),sliceThickness:w(f["00180050"]),pixelSpacing:T(f["00280030"],2),numberOfFrames:w(f["00280008"]),isNMReconstructable:se(p)&&y()(h).call(h,"NM")}}if("imagePlaneModule"===e){var m=ue(f),v=de(f),g=T(f["00280030"],2),b=null,I=null;g&&(I=g[0],b=g[1]);var S=null,E=null;return m&&(S=[parseFloat(m[0]),parseFloat(m[1]),parseFloat(m[2])],E=[parseFloat(m[3]),parseFloat(m[4]),parseFloat(m[5])]),{frameOfReferenceUID:x(f["00200052"]),rows:w(f["00280010"]),columns:w(f["00280011"]),imageOrientationPatient:m,rowCosines:S,columnCosines:E,imagePositionPatient:v,sliceThickness:w(f["00180050"]),sliceLocation:w(f["00201041"]),pixelSpacing:g,rowPixelSpacing:I,columnPixelSpacing:b}}if("imagePixelModule"===e)return{samplesPerPixel:w(f["00280002"]),photometricInterpretation:x(f["00280004"]),rows:w(f["00280010"]),columns:w(f["00280011"]),bitsAllocated:w(f["00280100"]),bitsStored:w(f["00280101"]),highBit:x(f["00280102"]),pixelRepresentation:w(f["00280103"]),planarConfiguration:w(f["00280006"]),pixelAspectRatio:x(f["00280034"]),smallestPixelValue:w(f["00280106"]),largestPixelValue:w(f["00280107"]),redPaletteColorLookupTableDescriptor:T(f["00281101"]),greenPaletteColorLookupTableDescriptor:T(f["00281102"]),bluePaletteColorLookupTableDescriptor:T(f["00281103"]),redPaletteColorLookupTableData:T(f["00281201"]),greenPaletteColorLookupTableData:T(f["00281202"]),bluePaletteColorLookupTableData:T(f["00281203"])};if("voiLutModule"===e)return{windowCenter:T(f["00281050"],1),windowWidth:T(f["00281051"],1)};if("modalityLutModule"===e)return{rescaleIntercept:w(f["00281052"]),rescaleSlope:w(f["00281053"]),rescaleType:x(f["00281054"])};if("sopCommonModule"===e)return{sopClassUID:x(f["00080016"]),sopInstanceUID:x(f["00080018"])};if("petIsotopeModule"===e){var C=x(f["00540016"]);if(void 0===C)return;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:d.parseTM(x(C["00181072"],0,"")),radiopharmaceuticalStartDateTime:x(C["00181078"],0,""),radionuclideTotalDose:w(C["00181074"]),radionuclideHalfLife:w(C["00181075"])}}}return"overlayPlaneModule"===e?function(e){for(var t=[],n=0;n<=30;n+=2){var r="x60".concat(n.toString(16));4===r.length&&(r="x600".concat(n.toString(16)));var o=x(e["".concat(r,"3000")]);if(o){for(var a=[],i=0;i<o.length;i++)for(var s=0;s<8;s++){var l=e.Value[o.dataOffset+i];a[8*i+s]=l>>s&1}t.push({rows:w(e["".concat(r,"0010")]),columns:w(e["".concat(r,"0011")]),type:x(e["".concat(r,"0040")]),x:w(e["".concat(r,"0050")],1)-1,y:w(e["".concat(r,"0050")],0)-1,pixelData:a,description:x(e["".concat(r,"0022")]),label:x(e["".concat(r,"1500")]),roiArea:x(e["".concat(r,"1301")]),roiMean:x(e["".concat(r,"1302")]),roiStandardDeviation:x(e["".concat(r,"1303")])})}}return{overlays:t}}(f):"transferSyntax"===e?{transferSyntaxUID:x(f["00020010"])}:"petSeriesModule"===e?{correctedImage:x(f["00280051"]),units:x(f["00541001"]),decayCorrection:x(f["00541102"])}:"petImageModule"===e?{frameReferenceTime:w(f["00541300"]),actualFrameDuration:w(f["00181242"])}:void 0}};function he(e,t,n){if(n+e.length>t.length)return!1;for(var r=n,o=0;o<e.length;o++)if(e[o]!==t[r++])return!1;return!0}const pe=function(e,t,n){n=n||0;for(var r=function(e){for(var t=new Uint8Array(e.length),n=0,r=e.length;n<r;n++)t[n]=e.charCodeAt(n);return t}(t),o=n;o<e.length;o++)if(r[0]===e[o]&&he(r,e,o))return o;return-1};var me=n(1655),ve=n.n(me),ge=n(2250),ye=n.n(ge),xe=n(7878),be=n.n(xe),we={open:function(e,t){e.open("get",t,!0)},beforeSend:function(){},beforeProcessing:function(e){return ye().resolve(e.response)},imageCreated:function(){},strict:!1,decodeConfig:{convertFloatPixelDataToInt:!0,use16BitDataType:!1}};function Te(e){we=Y()(we,e)}function Ie(){return we}const Se=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=Mt.cornerstone,a=Ie(),i=function(e){if("function"==typeof a.errorInterceptor){var t=new Error("request failed");t.request=e,t.response=e.response,t.status=e.status,a.errorInterceptor(t)}},s=new XMLHttpRequest,l=new(ye())((function(l,c){a.open(s,e,n,r);var u=a.beforeSend(s,t,n,r);s.responseType="arraybuffer";var d=Y()({},n,u);be()(d).forEach((function(t){null!==d[t]&&("Accept"===t&&-1!==e.indexOf("accept=")||s.setRequestHeader(t,d[t]))})),r.deferred={resolve:l,reject:c},r.url=e,r.imageId=t,s.onloadstart=function(n){a.onloadstart&&a.onloadstart(n,r);var i={url:e,imageId:t};o.triggerEvent(o.events,"cornerstoneimageloadstart",i)},s.onloadend=function(n){a.onloadend&&a.onloadend(n,r);var i={url:e,imageId:t};o.triggerEvent(o.events,"cornerstoneimageloadend",i)},s.onreadystatechange=function(e){a.onreadystatechange?a.onreadystatechange(e,r):4===s.readyState&&(200===s.status?a.beforeProcessing(s).then(l).catch((function(){i(s),c(s)})):(i(s),c(s)))},s.onprogress=function(n){var i,s,l=n.loaded;n.lengthComputable&&(i=n.total,s=Math.round(l/i*100)),a.onprogress&&a.onprogress(n,r);var c={url:e,imageId:t,loaded:l,total:i,percentComplete:s};o.triggerEvent(o.events,o.EVENTS.IMAGE_LOAD_PROGRESS,c)},s.onerror=function(){i(s),c(s)},s.onabort=function(){i(s),c(s)},s.send()}));return l.xhr=s,l};var Ee={xhrRequest:Se,setOptions:Te,getOptions:Ie};function Ce(e){for(var t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}function Ae(e){for(var t=0;t<e.length;t++){var n;if("Content-Type:"===e[t].substr(0,13))return ve()(n=e[t].substr(13)).call(n)}}function Me(e,t,n){t=t||0,n=n||e.length-t;for(var r="",o=t;o<t+n;o++)r+=String.fromCharCode(e[o]);return r}const Pe=function(e,t){var n={Accept:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream"};return new(ye())((function(r,o){var a=Se(e,t,n),i=a.xhr;a.then((function(e){var t=new Uint8Array(e),n=i.getResponseHeader("Content-Type")||"application/octet-stream";if(-1!==n.indexOf("multipart")){var a=pe(t,"\r\n\r\n");-1===a&&o(new Error("invalid response - no multipart mime header"));var s=Me(t,0,a).split("\r\n"),l=Ce(s);l||o(new Error("invalid response - no boundary marker"));var c=a+4,u=pe(t,l,c);-1===u&&o(new Error("invalid response - terminating boundary not found"));var d=u-c-2;r({contentType:Ae(s),imageFrame:{pixelData:new Uint8Array(e,c,d)}})}else r({contentType:n,imageFrame:{pixelData:t}})}),o)}))};var De=n(1882),ke=n.n(De),Oe=n(337),Le=n.n(Oe),Re=n(2770),_e=n.n(Re),Ne=n(1082);function Ue(e,t,n){return t in e?Ne(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Be=function(e){var t=Mt.cornerstone.metaData.get("imagePixelModule",e);return{samplesPerPixel:t.samplesPerPixel,photometricInterpretation:t.photometricInterpretation,planarConfiguration:t.planarConfiguration,rows:t.rows,columns:t.columns,bitsAllocated:t.bitsAllocated,bitsStored:t.bitsStored,pixelRepresentation:t.pixelRepresentation,smallestPixelValue:t.smallestPixelValue,largestPixelValue:t.largestPixelValue,redPaletteColorLookupTableDescriptor:t.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:t.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:t.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:t.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:t.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:t.bluePaletteColorLookupTableData,pixelData:void 0}};var je=n(187),Fe=n.n(je);function Ve(){return new Worker(n.p+"index.worker.min.worker.js")}var He,ze=0,qe=[],We=[],Ge=Ie(),Ye={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!1,strict:Ge.strict}}},Ze={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};function Xe(){if(qe.length){for(var e=0;e<We.length;e++)if("ready"===We[e].status){We[e].status="busy";var t=qe.shift();t.start=(new Date).getTime();var n=(new Date).getTime();return Ze.totalTimeDelayedInMS+=n-t.added,We[e].task=t,We[e].worker.postMessage({taskType:t.taskType,workerIndex:e,data:t.data},t.transferList),void Ze.numTasksExecuting++}We.length<He.maxWebWorkers&&Ke()}}function Qe(e){if("initialize"===e.data.taskType)We[e.data.workerIndex].status="ready",Xe();else{var t=We[e.data.workerIndex].task.start,n="success"===e.data.status?"resolve":"reject";try{We[e.data.workerIndex].task.deferred[n](e.data.result)}catch(e){console.warn("Caught error delivering response",e)}We[e.data.workerIndex].task=void 0,Ze.numTasksExecuting--,We[e.data.workerIndex].status="ready",Ze.numTasksCompleted++;var r=(new Date).getTime();Ze.totalTaskTimeInMS+=r-t,Xe()}}function Ke(){if(!(We.length>=He.maxWebWorkers)){var e=new Ve;We.push({worker:e,status:"initializing"}),e.addEventListener("message",Qe),e.postMessage({taskType:"initialize",workerIndex:We.length-1,config:He})}}function Je(e){if((He=e=e||Ye).maxWebWorkers=He.maxWebWorkers||navigator.hardwareConcurrency||1,!He.startWebWorkersOnDemand)for(var t=0;t<He.maxWebWorkers;t++)Ke()}const $e={initialize:Je,loadWebWorkerTask:function(e,t){He.webWorkerTaskPaths.push(e),t&&(He.taskConfiguration=Y()(He.taskConfiguration,t));for(var n=0;n<We.length;n++)We[n].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:We.length-1,sourcePath:e,config:He})},addTask:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;He||Je();var o,a={},i=new(ye())((function(e,t){a={resolve:e,reject:t}}));for(o=0;o<qe.length&&!(qe[o].priority<n);o++);var s=ze++;return Fe()(qe).call(qe,o,0,{taskId:s,taskType:e,status:"ready",added:(new Date).getTime(),data:t,deferred:a,priority:n,transferList:r}),Xe(),{taskId:s,promise:i}},getStatistics:function(){return Ze.maxWebWorkers=He.maxWebWorkers,Ze.numWebWorkers=We.length,Ze.numTasksQueued=qe.length,Ze},setTaskPriority:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<qe.length;n++)if(qe[n].taskId===e){var r=Fe()(qe).call(qe,n,1)[0];for(r.priority=t,n=0;n<qe.length&&!(qe[n].priority<t);n++);return Fe()(qe).call(qe,n,0,r),!0}return!1},cancelTask:function(e,t){for(var n=0;n<qe.length;n++)if(qe[n].taskId===e)return Fe()(qe).call(qe,n,1).deferred.reject(t),!0;return!1},webWorkers:We,terminate:function(){for(var e=0;e<We.length;e++)We[e].worker.terminate();We.length=0,He=void 0}},et=function(e){for(var t,n=e[0],r=e[0],o=e.length,a=1;a<o;a++)t=e[a],n=Math.min(n,t),r=Math.max(r,t);return{min:n,max:r}};function tt(e){return function(e){var t;try{return decodeURIComponent(escape(e))}catch(n){if((t=n)instanceof URIError)return e;throw t}}(String.fromCharCode.apply(null,te()(Array.prototype).apply(new Uint8Array(e))))}const nt=function(e,t,n){var r=(new Date).getTime(),o=new Blob([t],{type:"image/jpeg"});return new(ye())((function(t,a){var i=new FileReader;void 0===i.readAsBinaryString?i.readAsArrayBuffer(o):i.readAsBinaryString(o),i.onload=function(){var o=new Image;o.onload=function(){n.height=o.height,n.width=o.width,e.rows=o.height,e.columns=o.width;var a=n.getContext("2d");a.drawImage(this,0,0);var i=a.getImageData(0,0,o.width,o.height),s=(new Date).getTime();e.pixelData=i.data,e.imageData=i,e.decodeTimeInMS=s-r;var l=et(e.pixelData);e.smallestPixelValue=l.min,e.largestPixelValue=l.max,t(e)},o.onerror=function(e){a(e)},void 0===i.readAsBinaryString?o.src="data:image/jpeg;base64,".concat(window.btoa(tt(i.result))):o.src="data:image/jpeg;base64,".concat(window.btoa(i.result))},i.onerror=function(e){a(e)}}))};var rt=n(5613);function ot(e,t,n,r,o){var a=r.priority||void 0,i=r.transferPixelData?[n.buffer]:void 0;return $e.addTask("decodeTask",{imageFrame:e,transferSyntax:t,pixelData:n,options:r,decodeConfig:o},a,i).promise}window.pako={inflateRaw:rt.Hq};const at=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0;switch(t){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":case"1.2.840.10008.1.2.2":case"1.2.840.10008.1.2.1.99":case"1.2.840.10008.1.2.5":case"1.2.840.10008.1.2.4.51":case"1.2.840.10008.1.2.4.57":case"1.2.840.10008.1.2.4.70":case"1.2.840.10008.1.2.4.80":case"1.2.840.10008.1.2.4.81":case"1.2.840.10008.1.2.4.90":case"1.2.840.10008.1.2.4.91":case"3.2.840.10008.1.2.4.96":return ot(e,t,n,o,a);case"1.2.840.10008.1.2.4.50":return 8!==e.bitsAllocated||3!==e.samplesPerPixel&&4!==e.samplesPerPixel?ot(e,t,n,o,a):nt(e,n,r)}return ye().reject(new Error("No decoder for transfer syntax ".concat(t)))};function it(e){return"RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e}function st(n,r,o){0===n.planarConfiguration?e(n.pixelData,r,o):t(n.pixelData,r,o)}function lt(e,t,n){if("RGB"===e.photometricInterpretation)st(e,t,n);else if("YBR_RCT"===e.photometricInterpretation)st(e,t,n);else if("YBR_ICT"===e.photometricInterpretation)st(e,t,n);else if("PALETTE COLOR"===e.photometricInterpretation)s(e,t,n);else if("YBR_FULL_422"===e.photometricInterpretation)!function(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%2!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");var r=e.length/2,o=0,a=0;if(n)for(var i=0;i<r;i+=2){var s=e[o++],l=e[o++],c=e[o++],u=e[o++];t[a++]=s+1.402*(u-128),t[a++]=s-.34414*(c-128)-.71414*(u-128),t[a++]=s+1.772*(c-128),t[a++]=255,t[a++]=l+1.402*(u-128),t[a++]=l-.34414*(c-128)-.71414*(u-128),t[a++]=l+1.772*(c-128),t[a++]=255}else for(var d=0;d<r;d+=2){var f=e[o++],h=e[o++],p=e[o++],m=e[o++];t[a++]=f+1.402*(m-128),t[a++]=f-.34414*(p-128)-.71414*(m-128),t[a++]=f+1.772*(p-128),t[a++]=h+1.402*(m-128),t[a++]=h-.34414*(p-128)-.71414*(m-128),t[a++]=h+1.772*(p-128)}}(e.pixelData,t,n);else{if("YBR_FULL"!==e.photometricInterpretation)throw new Error("No color space conversion for photometric interpretation ".concat(e.photometricInterpretation));!function(e,t,n){0===e.planarConfiguration?o(e.pixelData,t,n):a(e.pixelData,t,n)}(e,t,n)}}const ct=function(e,t){if(t=t||e.transferSyntax,8===e.bitsAllocated&&"1.2.840.10008.1.2.4.50"===t&&(3===e.samplesPerPixel||4===e.samplesPerPixel))return!0};function ut(e,t){var n=be()(e);if(ke()){var r=ke()(e);t&&(r=V()(r).call(r,(function(t){return Le()(e,t).enumerable}))),n.push.apply(n,r)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ut(Object(n),!0).forEach((function(t){Ue(e,t,n[t])})):_e()?Object.defineProperties(e,_e()(n)):ut(Object(n)).forEach((function(t){Object.defineProperty(e,t,Le()(n,t))}))}return e}function ft(e,t){var n=e.get("modalityLutModule",t)||{},r=(e.get("generalSeriesModule",t)||{}).modality,o={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:r},a=e.get("scalingModule",t)||{};return dt(dt({},o),"PT"===r&&{suvbw:a.suvbw})}function ht(e,t){var n=be()(e);if(ke()){var r=ke()(e);t&&(r=V()(r).call(r,(function(t){return Le()(e,t).enumerable}))),n.push.apply(n,r)}return n}function pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(n),!0).forEach((function(t){Ue(e,t,n[t])})):_e()?Object.defineProperties(e,_e()(n)):ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Le()(n,t))}))}return e}var mt="";function vt(e){return"1.2.840.10008.5.1.4.1.1.12.1"!==e&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==e}function gt(e){for(var t=et(e),n=Math.abs(t.max-t.min)/65535,r=t.min,o=e.length,a=new Uint16Array(o),i=65535,s=0,l=0;l<o;l++){var c=Math.floor((e[l]-r)/n);a[l]=c,i=Math.min(i,c),s=Math.max(s,c)}return{min:i,max:s,intPixelData:a,slope:n,intercept:r}}function yt(e,t){var n=null==t?void 0:t.scaled,r=null==t?void 0:t.scalingParameters,o=!1;if(n&&r){var a=(null==r?void 0:r.rescaleSlope)||1,i=(null==r?void 0:r.rescaleIntercep)||0;o=((null==r?void 0:r.suvbw)||1)*(e.smallestPixelValue*a+i)<0}32===e.bitsAllocated?e.pixelData=new Float32Array(e.pixelData):16===e.bitsAllocated?0!==e.pixelRepresentation||o?e.pixelData=new Int16Array(e.pixelData):e.pixelData=new Uint16Array(e.pixelData):e.pixelData=new Uint8Array(e.pixelData)}function xt(e,t){for(var n=e.length/4,r=0,o=0,a=0;a<n;a++)t[o++]=e[r++],t[o++]=e[r++],t[o++]=e[r++],r++;return t}const bt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=!0;if(void 0!==r.useRGBA&&(o=r.useRGBA),r.preScale={enabled:!(!r.preScale||void 0===r.preScale.enabled)&&r.preScale.enabled},!t||!t.length)return ye().reject(new Error("The file does not contain image data."));var a=Mt.cornerstone,i=document.createElement("canvas"),s=Be(e);if(r.preScale.enabled){var l=ft(a.metaData,e);l&&(r.preScale=pt(pt({},r.preScale),{},{scalingParameters:l}))}var c=Ie().decodeConfig,u=at(s,n,t,i,r,c),d=c.convertFloatPixelDataToInt,f=c.use16BitDataType;return new(ye())((function(t,s){u.then((function(s){if(r.skipCreateImage)return t(s);var l=!1;if(r.targetBuffer){var c,u,h=r.targetBuffer;c=h.offset,u=h.length;var p,m,v=r.targetBuffer,g=v.arrayBuffer,y=v.type;switch(null==u&&(u=s.pixelDataLength),null==c&&(c=0),y){case"Uint8Array":p=Uint8Array;break;case f&&"Uint16Array":p=Uint16Array;break;case f&&"Int16Array":p=Int16Array;break;case"Float32Array":p=Float32Array;break;default:throw new Error("target array for image does not have a valid type.")}if(u!==s.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");m=g?new p(g,c,u):new p(s.pixelData),s.pixelData=m,l=!0}l||yt(s,s.preScale);var x=a.metaData.get("imagePlaneModule",e)||{},b=a.metaData.get("voiLutModule",e)||{},w=a.metaData.get("modalityLutModule",e)||{},T=a.metaData.get("sopCommonModule",e)||{},I=it(s.photometricInterpretation);if(I){if(o){if(!ct(s,n)){i.height=s.rows,i.width=s.columns;var S=i.getContext("2d").createImageData(s.columns,s.rows);lt(s,S.data,o),s.imageData=S,s.pixelData=S.data}}else if(ct(s,n)){var E=new Uint8ClampedArray(s.pixelData.length/4*3);s.pixelData=xt(s.pixelData,E)}else if("PALETTE COLOR"===s.photometricInterpretation){i.height=s.rows,i.width=s.columns;var C=i.getContext("2d").createImageData(s.columns,s.rows);lt(s,C.data,!0);var A=new C.data.constructor(C.data.length/4*3);s.pixelData=xt(C.data,A)}var M=et(s.pixelData);s.smallestPixelValue=M.min,s.largestPixelValue=M.max}var P={imageId:e,color:I,columnPixelSpacing:x.columnPixelSpacing,columns:s.columns,height:s.rows,preScale:s.preScale,intercept:w.rescaleIntercept?w.rescaleIntercept:0,slope:w.rescaleSlope?w.rescaleSlope:1,invert:"MONOCHROME1"===s.photometricInterpretation,minPixelValue:s.smallestPixelValue,maxPixelValue:s.largestPixelValue,rowPixelSpacing:x.rowPixelSpacing,rows:s.rows,sizeInBytes:s.pixelData.byteLength,width:s.columns,windowCenter:b.windowCenter?b.windowCenter[0]:void 0,windowWidth:b.windowWidth?b.windowWidth[0]:void 0,voiLUTFunction:b.voiLUTFunction?b.voiLUTFunction:void 0,decodeTimeInMS:s.decodeTimeInMS,floatPixelData:void 0,imageFrame:s,rgba:I&&o};if(s.pixelData instanceof Float32Array&&d){var D=s.pixelData,k=gt(D);P.minPixelValue=k.min,P.maxPixelValue=k.max,P.slope=k.slope,P.intercept=k.intercept,P.floatPixelData=D,P.getPixelData=function(){return k.intPixelData}}else P.getPixelData=function(){return s.pixelData};if(P.color&&(P.getCanvas=function(){return mt===e||(i.height=P.rows,i.width=P.columns,i.getContext("2d").putImageData(s.imageData,0,0),mt=e),i}),w.modalityLUTSequence&&w.modalityLUTSequence.length>0&&vt(T.sopClassUID)&&(P.modalityLUT=w.modalityLUTSequence[0]),b.voiLUTSequence&&b.voiLUTSequence.length>0&&(P.voiLUT=b.voiLUTSequence[0]),P.color&&(P.windowWidth=255,P.windowCenter=127),void 0===P.windowCenter||void 0===P.windowWidth){var O=P.maxPixelValue*P.slope+P.intercept,L=P.minPixelValue*P.slope+P.intercept;P.windowWidth=O-L,P.windowCenter=(O+L)/2}t(P)}),s)}))};function wt(e){var t="1.2.840.10008.1.2";if(!e)return t;var n=e.split(";"),r={};n.forEach((function(e){var t,n,o=e.split("=");if(2===o.length){var a=ve()(t=o[1]).call(t).replace(/"/g,"");r[ve()(n=o[0]).call(n)]=a}}));var o={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return r["transfer-syntax"]?r["transfer-syntax"]:e&&!be()(r).length&&o[e]?o[e]:r.type&&o[r.type]?o[r.type]:o[e]?o[e]:t}function Tt(){return Mt.cornerstone.imageRetrievalPoolManager}const It=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Tt(),o=(new Date).getTime(),a=new(ye())((function(a,i){var s=n.requestType||"interaction",l=n.additionalDetails||{imageId:e},c=void 0===n.priority?5:n.priority,u=n.addToBeginning||!1,d=e.substring(7);r.addRequest(function(e,t,r){return Pe(e,t,r).then((function(e){var r=wt(e.contentType),s=e.imageFrame.pixelData;bt(t,s,r,n).then((function(e){var t=(new Date).getTime();e.loadTimeInMS=t-o,a(e)}),i)}),i).catch((function(e){i(e)}))}.bind(t,d,e,"multipart/related; type=application/octet-stream; transfer-syntax=*"),s,l,c,u)}));return{promise:a,cancelFn:void 0}},St={metaData:{getNumberString:b,getNumberValue:w,getNumberValues:T,getValue:x,metaDataProvider:fe},findIndexOfString:pe,getPixelData:Pe,loadImage:It,metaDataManager:ie,register:function(e){e.registerImageLoader("wadors",It),e.metaData.addProvider(fe)}},Et=function(e){St.register(e),Cn.register(e)};var Ct,At;const Mt={set cornerstone(e){Et(Ct=e)},get cornerstone(){if(!Ct){if(!window||!window.cornerstone)throw new Error("cornerstoneWADOImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneWADOImageLoader.external.cornerstone = cornerstone; to your application.");Ct=window.cornerstone,Et(Ct)}return Ct},set dicomParser(e){At=e},get dicomParser(){if(!At){if(!window||!window.dicomParser)throw new Error("cornerstoneWADOImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneWADOImageLoader.external.dicomParser = dicomParser; to your application.");At=window.dicomParser}return At}},Pt=function(e){var t,n=e.indexOf(":"),r=e.substring(n+1),o=r.indexOf("frame=");if(-1!==o){var a=r.substr(o+6);t=parseInt(a,10),r=r.substr(0,o-1)}return{scheme:e.substr(0,n),url:r,frame:t}};var Dt=n(5534);function kt(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Dt.resolve(l).then(r,o)}function Ot(e){return function(){var t=this,n=arguments;return new Dt((function(r,o){var a=e.apply(t,n);function i(e){kt(a,r,o,i,s,"next",e)}function s(e){kt(a,r,o,i,s,"throw",e)}i(void 0)}))}}var Lt=n(2043),Rt=n.n(Lt),_t=n(9387),Nt=n.n(_t),Ut=["elements"],Bt=["x52009230","x52009229"];function jt(e,t){var n=be()(e);if(ke()){var r=ke()(e);t&&(r=V()(r).call(r,(function(t){return Le()(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(n),!0).forEach((function(t){Ue(e,t,n[t])})):_e()?Object.defineProperties(e,_e()(n)):jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Le()(n,t))}))}return e}function Vt(e,t,n){var r,o,a={};z()(r=t?W()(t.items[0].dataSet.elements):[]).call(r,(function(e){return a[e.tag]=e}));var i={};return z()(o=e?W()(e.items[n-1].dataSet.elements):[]).call(o,(function(e){return i[e.tag]=e})),{shared:a,perFrame:i}}function Ht(e){if(e){var t=e.elements,n=U(e,Ut),r=t.x52009230,o=t.x52009229,a=U(t,Bt);return{NumberOfFrames:e.intString("x00280008"),PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:o,otherElements:a,otherAttributtes:n}}}function zt(e){if(nn[e])return nn[e]}function qt(e){if(!e)return!1;var t=e.intString("x00280008");return t&&t>1}const Wt={_get:zt,generateMultiframeWADOURIs:function(e){var t=[],n=zt(e);if(qt(n))for(var r=n.intString("x00280008"),o=1;o<=r;o++){var a;t.push(v()(a="".concat(e,"&frame=")).call(a,o))}else t.push(e);return t},retrieveMultiframeDataset:function(e){var t=function(e){return e.indexOf("&frame=")}(e),n=-1===t?e:te()(e).call(e,0,t),r=parseInt(te()(e).call(e,t+7),10)||1;return{dataSet:nn[n]?nn[n].dataSet:void 0,frame:r}},isMultiframeDataset:function(e){return qt(zt(e))}};var Gt=n(6089),Yt=n.n(Gt),Zt=n(1407),Xt=n.n(Zt);function Qt(e,t){var n=void 0!==Xt()&&A()(e)||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){var n;if(e){if("string"==typeof e)return Kt(e,t);var r=te()(n=Object.prototype.toString.call(e)).call(n,8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Yt()(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Kt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function Kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Jt(e){var t,n=Mt.dicomParser,r=n.parseDicom(e,{untilTag:"x7fe00010"});r.elements.x7fe00010||console.warn("Pixel data not found!");try{t=n.parseDicom(e)}catch(e){console.error(e),console.log("pixel data dataset:",e.dataSet),t=e.dataSet}return r.elements.x7fe00010=t.elements.x7fe00010,function(e){var t,n=e.elements.x7fe00010.fragments,r=e.byteArray.length,o=Qt(n);try{for(o.s();!(t=o.n()).done;){var a,i=t.value,s=i.position;i.length>r-s&&(console.log(v()(a="Truncated fragment, changing fragment length from ".concat(i.length," to ")).call(a,r-s)),i.length=r-s)}}catch(e){o.e(e)}finally{o.f()}return e}(r)}function $t(e,t,n){return en.apply(this,arguments)}function en(){return(en=Ot(Rt().mark((function e(t,n,r){var o,a,i,s;return Rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Jt(t),a=r.uri,i=r.imageId,s=r.fileTotalLength,o.fetchMore=function(){var e=Ot(Rt().mark((function e(l){var c,u,d,f,h,p,m,g;return Rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=Y()({uri:a,imageId:i,fetchedLength:t.length,lengthToFetch:s-t.length},l),d=u.fetchedLength,f=u.lengthToFetch,e.next=4,n(a,i,{byteRange:v()(c="".concat(d,"-")).call(c,d+f)});case 4:return h=e.sent,p=h.arrayBuffer,m=new Uint8Array(p),(g=new Uint8Array(o.byteArray.length+m.length)).set(o.byteArray),g.set(m,o.byteArray.length),e.abrupt("return",$t(g,n,r));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tn=0,nn={},rn={};function on(){return{cacheSizeInBytes:tn,numberOfDataSetsCached:be()(nn).length}}const an={isLoaded:function(e){return void 0!==nn[e]},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Se,n=arguments.length>2?arguments[2]:void 0,r=Mt.cornerstone,o=Mt.dicomParser;if(nn[e])return new(ye())((function(t){nn[e].cacheCount++,t(nn[e].dataSet)}));if(rn[e])return rn[e].cacheCount++,rn[e];var a=t(e,n),i=new(ye())((function(s,l){a.then(function(){var a=Ot(Rt().mark((function a(c){var u,d,f;return Rt().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(u={isPartialContent:!1,fileTotalLength:null},c instanceof ArrayBuffer){a.next=7;break}if(c.arrayBuffer){a.next=4;break}return a.abrupt("return",l(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter")));case 4:u.isPartialContent=Nt()(c).isPartialContent,u.fileTotalLength=Nt()(c).fileTotalLength,c=c.arrayBuffer;case 7:if(d=new Uint8Array(c),a.prev=8,!u.isPartialContent){a.next=15;break}return a.next=12,$t(d,t,{uri:e,imageId:n,fileTotalLength:u.fileTotalLength});case 12:f=a.sent,a.next=16;break;case 15:f=o.parseDicom(d);case 16:a.next=21;break;case 18:return a.prev=18,a.t0=a.catch(8),a.abrupt("return",l(a.t0));case 21:nn[e]={dataSet:f,cacheCount:i.cacheCount},tn+=f.byteArray.length,s(f),r.triggerEvent(r.events,"datasetscachechanged",{uri:e,action:"loaded",cacheInfo:on()});case 25:case"end":return a.stop()}}),a,null,[[8,18]])})));return function(e){return a.apply(this,arguments)}}(),l).then((function(){delete rn[e]}),(function(){delete rn[e]}))}));return i.cacheCount=1,rn[e]=i,i},unload:function(e){var t=Mt.cornerstone;nn[e]&&(nn[e].cacheCount--,0===nn[e].cacheCount&&(tn-=nn[e].dataSet.byteArray.length,delete nn[e],t.triggerEvent(t.events,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:on()})))},getInfo:on,purge:function(){nn={},rn={},tn=0},get:function(e){var t;if(y()(e).call(e,"&frame=")){var n=Wt.retrieveMultiframeDataset(e);t=function(e,t){if(t){var n=Ht(t),r=n.NumberOfFrames,o=n.PerFrameFunctionalGroupsSequence,a=n.SharedFunctionalGroupsSequence,i=n.otherElements;if(o||r>1){var s=Vt(o,a,e),l=s.shared,c=s.perFrame,u={elements:Ft(Ft(Ft({},i),l),c)},d=Object.create(t);return Y()(d,u)}return t}}(n.frame,n.dataSet)}else nn[e]&&(t=nn[e].dataSet);return t},update:function(e,t){var n=nn[e];n?(tn-=n.dataSet.byteArray.length,n.dataSet=t,tn+=t.byteArray.length,Mt.cornerstone.triggerEvent(Mt.cornerstone.events,"datasetscachechanged",{uri:e,action:"updated",cacheInfo:on()})):console.error("No loaded dataSet for uri ".concat(e))}};function sn(e,t){var n=e.string("x00080008");if(n){var r=n.split("\\");if(r.length>t)return r[t]}}function ln(e){var t=p(e,"x00200037",6);return!t&&e.elements.x00209116&&(t=p(e.elements.x00209116.items[0].dataSet,"x00200037",6)),t||(t=function(e){var t,n=e.string("x00080060");if(y()(n).call(n,"NM")){var r=sn(e,2);r&&se(r)&&e.elements.x00540022&&(t=p(e.elements.x00540022.items[0].dataSet,"x00200037",6))}return t}(e)),t}function cn(e){var t=p(e,"x00200032",3);return!t&&e.elements.x00209113&&(t=p(e.elements.x00209113.items[0].dataSet,"x00200032",3)),t||(t=function(e){var t,n=e.string("x00080060");if(y()(n).call(n,"NM")){var r=sn(e,2);r&&se(r)&&e.elements.x00540022&&(t=p(e.elements.x00540022.items[0].dataSet,"x00200032",3))}return t}(e)),t}function un(e){var t=p(e,"x00280030",2);return!t&&e.elements.x00289110&&(t=p(e.elements.x00289110.items[0].dataSet,"x00280030",2)),t}function dn(e){var t;return e.elements.x00180050?t=e.floatString("x00180050"):e.elements.x00289110&&e.elements.x00289110.items.length&&e.elements.x00289110.items[0].dataSet.elements.x00180050&&(t=e.elements.x00289110.items[0].dataSet.floatString("x00180050")),t}const fn=function(e,t){var n=Pt(t);if("multiframeModule"===e){var r=Wt.retrieveMultiframeDataset(n.url);if(!r.dataSet)return;return function(e,t){if(e){var n=Ht(e),r=n.NumberOfFrames,o=n.PerFrameFunctionalGroupsSequence,a=n.SharedFunctionalGroupsSequence;if(o||r>1){var i=Vt(o,a,t),s=i.shared;return{NumberOfFrames:r,PerFrameFunctionalInformation:i.perFrame,SharedFunctionalInformation:s}}return{NumberOfFrames:r}}}(r.dataSet,r.frame)}var o,a=Mt.dicomParser,i=n.url;n.frame&&(i=v()(o="".concat(i,"&frame=")).call(o,n.frame));var s=an.get(i);if(s){if("generalSeriesModule"===e)return{modality:s.string("x00080060"),seriesInstanceUID:s.string("x0020000e"),seriesNumber:s.intString("x00200011"),studyInstanceUID:s.string("x0020000d"),seriesDate:a.parseDA(s.string("x00080021")),seriesTime:a.parseTM(s.string("x00080031")||""),acquisitionDate:a.parseDA(s.string("x00080022")||""),acquisitionTime:a.parseTM(s.string("x00080032")||"")};if("patientStudyModule"===e)return{patientAge:s.intString("x00101010"),patientSize:s.floatString("x00101020"),patientWeight:s.floatString("x00101030")};if("imagePlaneModule"===e){var l,c=ln(s),d=cn(s),m=un(s);s.elements.x00200052&&(l=s.string("x00200052"));var g,x=dn(s);s.elements.x00201041&&(g=s.floatString("x00201041"));var b=null,w=null;m&&(w=m[0],b=m[1]);var T=null,I=null;return c&&(T=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])],I=[parseFloat(c[3]),parseFloat(c[4]),parseFloat(c[5])]),{frameOfReferenceUID:l,rows:s.uint16("x00280010"),columns:s.uint16("x00280011"),imageOrientationPatient:c,rowCosines:T,columnCosines:I,imagePositionPatient:d,sliceThickness:x,sliceLocation:g,pixelSpacing:m,rowPixelSpacing:w,columnPixelSpacing:b}}if("nmMultiframeGeometryModule"===e){var S=s.string("x00080060"),E=sn(s,2);return{modality:S,imageType:s.string("x00080008"),imageSubType:E,imageOrientationPatient:ln(s),imagePositionPatient:cn(s),sliceThickness:dn(s),pixelSpacing:un(s),numberOfFrames:s.uint16("x00280008"),isNMReconstructable:se(E)&&y()(S).call(S,"NM")}}if("imagePixelModule"===e)return u(s);if("modalityLutModule"===e)return{rescaleIntercept:s.floatString("x00281052"),rescaleSlope:s.floatString("x00281053"),rescaleType:s.string("x00281054"),modalityLUTSequence:f(s.uint16("x00280103"),s.elements.x00283000)};if("voiLutModule"===e){var C=h(s);return{windowCenter:p(s,"x00281050",1),windowWidth:p(s,"x00281051",1),voiLUTSequence:f(C,s.elements.x00283010)}}if("sopCommonModule"===e)return{sopClassUID:s.string("x00080016"),sopInstanceUID:s.string("x00080018")};if("petIsotopeModule"===e){var A=s.elements.x00540016;if(void 0===A)return;var M=A.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:a.parseTM(M.string("x00181072")||""),radionuclideTotalDose:M.floatString("x00181074"),radionuclideHalfLife:M.floatString("x00181075")}}}return"overlayPlaneModule"===e?function(e){for(var t=[],n=0;n<=30;n+=2){var r="x60".concat(n.toString(16));4===r.length&&(r="x600".concat(n.toString(16)));var o=e.elements["".concat(r,"3000")];if(o){for(var a=[],i=0;i<o.length;i++)for(var s=0;s<8;s++){var l=e.byteArray[o.dataOffset+i];a[8*i+s]=l>>s&1}t.push({rows:e.uint16("".concat(r,"0010")),columns:e.uint16("".concat(r,"0011")),type:e.string("".concat(r,"0040")),x:e.int16("".concat(r,"0050"),1)-1,y:e.int16("".concat(r,"0050"),0)-1,pixelData:a,description:e.string("".concat(r,"0022")),label:e.string("".concat(r,"1500")),roiArea:e.string("".concat(r,"1301")),roiMean:e.string("".concat(r,"1302")),roiStandardDeviation:e.string("".concat(r,"1303"))})}}return{overlays:t}}(s):"transferSyntax"===e?{transferSyntaxUID:s.string("x00020010")}:"petSeriesModule"===e?{correctedImage:s.string("x00280051"),units:s.string("x00541001"),decayCorrection:s.string("x00541102")}:"petImageModule"===e?{frameReferenceTime:a.floatString(s.string("x00541300")||""),actualFrameDuration:a.intString(s.string("x00181242"))}:void 0}};var hn=[];const pn={add:function(e){var t=hn.push(e);return"dicomfile:".concat(t-1)},get:function(e){return hn[e]},remove:function(e){hn[e]=void 0},purge:function(){hn=[]}};function mn(e,t){var n=Mt.dicomParser;if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t);if(function(e){return e.intString("x00280008")!==e.elements.x7fe00010.fragments.length}(e)){var r=n.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t,r)}return n.readEncapsulatedPixelDataFromFragments(e,e.elements.x7fe00010,t)}function vn(e,t){return e&1<<t}const gn=function(e,t,n){for(var r=new Uint8Array(n),o=0;o<n;o++){var a=e[Math.floor(o/8)+t],i=o%8;r[o]=vn(a,i)?1:0}return r},yn=function(e,t){var n=e.elements.x7fe00010||e.elements.x7fe00008,r=e.uint16("x00280100"),o=e.uint16("x00280010"),a=e.uint16("x00280011"),i=e.uint16("x00280002");"YBR_FULL_422"===e.string("x00280004")&&(i=2,console.warn("Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.\n      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information."));var s,l=n.dataOffset,c=o*a*i;if(8===r){var u;if((s=l+t*c)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(te()(u=e.byteArray.buffer).call(u,s,s+c))}if(16===r){var d;if((s=l+t*c*2)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(te()(d=e.byteArray.buffer).call(d,s,s+2*c))}if(1===r){if((s=l+t*c*.125)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return gn(e.byteArray,s,c)}if(32===r){var f;if((s=l+t*c*4)>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(te()(f=e.byteArray.buffer).call(f,s,s+4*c))}throw new Error("unsupported pixel format")},xn=function(e){var t=Pt(e),n=parseInt(t.url,10),r=pn.get(n);return new(ye())((function(e,t){var n=new FileReader;n.onload=function(t){var n=t.target.result;e(n)},n.onerror=t,n.readAsArrayBuffer(r)}))},bn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.elements.x7fe00010||e.elements.x7fe00008;return n?n.encapsulatedPixelData?mn(e,t):yn(e,t):null};function wn(e,t){e.decache=function(){var e=Pt(t);an.unload(e.url)}}function Tn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,i=(new Date).getTime(),s={cancelFn:void 0};return s.promise=new(ye())((function(l,c){e.then((function(e){var u=bn(e,n),d=e.string("x00020010"),f=(new Date).getTime(),h=bt(t,u,d,o);wn(s,t),h.then((function(t){t.data=e,t.sharedCacheKey=r;var n=(new Date).getTime();t.loadTimeInMS=f-i,t.totalTimeInMS=n-i,void 0!==a&&void 0!==a.imageDoneCallback&&a.imageDoneCallback(t),l(t)}),(function(t){c({error:t,dataSet:e})}))}),(function(e){c({error:e})}))})),s}function In(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=(new Date).getTime(),i=new(ye())((function(i,s){var l,c=(new Date).getTime();try{var u=bn(e,n),d=e.string("x00020010");l=bt(t,u,d,o)}catch(t){return void s({error:t,dataSet:e})}l.then((function(t){t.data=e,t.sharedCacheKey=r;var n=(new Date).getTime();t.loadTimeInMS=c-a,t.totalTimeInMS=n-a,i(t)}),s)}));return{promise:i,cancelFn:void 0}}function Sn(e){return"dicomweb"===e||"wadouri"===e?Se:"dicomfile"===e?xn:void 0}function En(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Pt(e),r=(t=Y()({},t)).loader;return void 0===r?r=Sn(n.scheme):delete t.loader,an.isLoaded(n.url)?In(an.get(n.url,r,e),e,n.frame,n.url,t):Tn(an.load(n.url,r,e),e,n.frame,n.url,t)}const Cn={metaData:{getImagePixelModule:u,getLUTs:f,getModalityLUTOutputPixelRepresentation:h,getNumberValues:p,metaDataProvider:fn},dataSetCacheManager:an,fileManager:pn,getEncapsulatedImageFrame:mn,getUncompressedImageFrame:yn,loadFileRequest:xn,loadImageFromPromise:Tn,getLoaderForScheme:Sn,loadImage:En,parseImageId:Pt,unpackBinaryFrame:gn,register:function(e){e.registerImageLoader("dicomweb",En),e.registerImageLoader("wadouri",En),e.registerImageLoader("dicomfile",En),e.metaData.addProvider(fn)}},An=function(e){Te(e)},Mn="4.13.2",Pn={convertRGBColorByPixel:e,convertRGBColorByPlane:t,convertYBRFullByPixel:o,convertYBRFullByPlane:a,convertPALETTECOLOR:s,wadouri:Cn,wadors:St,configure:An,convertColorSpace:lt,createImage:bt,decodeImageFrame:at,decodeJPEGBaseline8BitColor:nt,getImageFrame:Be,getPixelData:Pe,getMinMax:et,isColorImage:it,isJPEGBaseline8BitColor:ct,webWorkerManager:$e,version:Mn,internal:Ee,external:Mt}})(),r})()},5205:e=>{
/*! cornerstone-web-image-loader - 2.1.1 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWebImageLoader */
window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var r,o=(r=n(4))&&r.__esModule?r:{default:r},a=void 0,i={set cornerstone(e){a=e,(0,o.default)(a)},get cornerstone(){return a}};t.external=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=function(e){var t=r.external.cornerstone,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",s.beforeSend(n),n.onprogress=function(n){if(n.lengthComputable){var r=n.loaded,o=n.total,a=Math.round(r/o*100),i={imageId:e,loaded:r,total:o,percentComplete:a};t.triggerEvent(t.events,"cornerstoneimageloadprogress",i)}},{promise:new Promise((function(t,r){n.onload=function(){(0,o.default)(this.response).then((function(n){var r=(0,a.default)(n,e);t(r)}),r)},n.send()})),cancelFn:function(){n.abort()}}},t.configure=function(e){s=e};var r=n(0),o=i(n(3)),a=i(n(2));function i(e){return e&&e.__esModule?e:{default:e}}var s={beforeSend:function(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.naturalHeight,i=e.naturalWidth;return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,render:r.external.cornerstone.renderWebImage,getPixelData:function(){return(n=void 0,a===t?n=o.getContext("2d"):(o.height=e.naturalHeight,o.width=e.naturalWidth,(n=o.getContext("2d")).drawImage(e,0,0),a=t),n.getImageData(0,0,e.naturalWidth,e.naturalHeight)).data;var n},getCanvas:function(){return a===t||(o.height=e.naturalHeight,o.width=e.naturalWidth,o.getContext("2d").drawImage(e,0,0),a=t),o},getImage:function(){return e},rows:n,columns:i,height:n,width:i,color:!0,rgba:!1,columnPixelSpacing:void 0,rowPixelSpacing:void 0,invert:!1,sizeInBytes:n*i*4}};var r=n(0),o=document.createElement("canvas"),a=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((function(t,n){var r=new Image,o=new Uint8Array(e),a=new Blob([o]),i=window.URL||window.webkitURL,s=i.createObjectURL(a);r.src=s,r.onload=function(){t(r),i.revokeObjectURL(s)},r.onerror=function(e){i.revokeObjectURL(s),n(e)}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.registerImageLoader("http",r.loadImage),e.registerImageLoader("https",r.loadImage)};var r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.configure=t.loadImage=t.createImage=t.arrayBufferToImage=void 0;var r=s(n(3)),o=s(n(2)),a=n(1),i=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var l={arrayBufferToImage:r.default,createImage:o.default,loadImage:a.loadImage,configure:a.configure,external:i.external};t.arrayBufferToImage=r.default,t.createImage=o.default,t.loadImage=a.loadImage,t.configure=a.configure,t.external=i.external,t.default=l}])},4705:function(e,t,n){
/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */
e.exports=function(e){return n=[function(t,n){t.exports=e},function(e,t,n){"use strict";n.r(t),n.d(t,"isStringVr",(function(){return o})),n.d(t,"isPrivateTag",(function(){return a})),n.d(t,"parsePN",(function(){return i})),n.d(t,"parseTM",(function(){return s})),n.d(t,"parseDA",(function(){return c})),n.d(t,"explicitElementToString",(function(){return u})),n.d(t,"explicitDataSetToJS",(function(){return d})),n.d(t,"createJPEGBasicOffsetTable",(function(){return p})),n.d(t,"parseDicomDataSetExplicit",(function(){return O})),n.d(t,"parseDicomDataSetImplicit",(function(){return L})),n.d(t,"readFixedString",(function(){return y})),n.d(t,"alloc",(function(){return R})),n.d(t,"version",(function(){return _})),n.d(t,"bigEndianByteArrayParser",(function(){return N})),n.d(t,"ByteStream",(function(){return j})),n.d(t,"sharedCopy",(function(){return U})),n.d(t,"DataSet",(function(){return w})),n.d(t,"findAndSetUNElementLength",(function(){return g})),n.d(t,"findEndOfEncapsulatedElement",(function(){return v})),n.d(t,"findItemDelimitationItemAndSetElementLength",(function(){return T})),n.d(t,"littleEndianByteArrayParser",(function(){return F})),n.d(t,"parseDicom",(function(){return z})),n.d(t,"readDicomElementExplicit",(function(){return k})),n.d(t,"readDicomElementImplicit",(function(){return S})),n.d(t,"readEncapsulatedImageFrame",(function(){return Z})),n.d(t,"readEncapsulatedPixelData",(function(){return Q})),n.d(t,"readEncapsulatedPixelDataFromFragments",(function(){return W})),n.d(t,"readPart10Header",(function(){return V})),n.d(t,"readSequenceItemsExplicit",(function(){return P})),n.d(t,"readSequenceItemsImplicit",(function(){return A})),n.d(t,"readSequenceItem",(function(){return E})),n.d(t,"readTag",(function(){return m}));var r={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},o=function(e){return r[e]},a=function(e){if(e=parseInt(e[4],16),isNaN(e))throw"dicomParser.isPrivateTag: cannot parse last character of group";return e%2==1},i=function(e){if(void 0!==e)return{familyName:(e=e.split("^"))[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}};function s(e,t){if(2<=e.length){var n=parseInt(e.substring(0,2),10),r=4<=e.length?parseInt(e.substring(2,4),10):void 0,o=6<=e.length?parseInt(e.substring(4,6),10):void 0,a=(a=8<=e.length?e.substring(7,13):void 0)?parseInt(a,10)*Math.pow(10,6-a.length):void 0;if(t&&(isNaN(n)||void 0!==r&&isNaN(r)||void 0!==o&&isNaN(o)||void 0!==a&&isNaN(a)||n<0||23<n||r&&(r<0||59<r)||o&&(o<0||59<o)||a&&(a<0||999999<a)))throw"invalid TM '".concat(e,"'");return{hours:n,minutes:r,seconds:o,fractionalSeconds:a}}if(t)throw"invalid TM '".concat(e,"'")}function l(e,t,n){return!isNaN(n)&&0<t&&t<=12&&0<e&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}function c(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),r=parseInt(e.substring(4,6),10),o=parseInt(e.substring(6,8),10);if(t&&!0!==l(o,r,n))throw"invalid DA '".concat(e,"'");return{year:n,month:r,day:o}}if(t)throw"invalid DA '".concat(e,"'")}function u(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,r=t.vr,a=t.tag;function i(t,n){for(var r="",o=0;o<t;o++)0!==o&&(r+="/"),r+=n.call(e,a,o).toString();return r}if(!0===o(r))n=e.string(a);else{if("AT"===r){var s=e.uint32(a);return void 0===s?void 0:"x".concat((s=s<0?4294967295+s+1:s).toString(16).toUpperCase())}"US"===r?n=i(t.length/2,e.uint16):"SS"===r?n=i(t.length/2,e.int16):"UL"===r?n=i(t.length/4,e.uint32):"SL"===r?n=i(t.length/4,e.int32):"FD"===r?n=i(t.length/8,e.double):"FL"===r&&(n=i(t.length/4,e.float))}return n}function d(e,t){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";t=t||{omitPrivateAttibutes:!0,maxElementLength:128};var n,r={};for(n in e.elements){var o=e.elements[n];if(!0!==t.omitPrivateAttibutes||!a(n))if(o.items){for(var i=[],s=0;s<o.items.length;s++)i.push(d(o.items[s].dataSet,t));r[n]=i}else{var l=void 0;o.length<t.maxElementLength&&(l=u(e,o)),r[n]=void 0!==l?l:{dataOffset:o.dataOffset,length:o.length}}}return r}function f(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function h(e,t,n){for(var r,o,a=n;a<t.fragments.length;a++)if(o=a,f(r=e,(o=t.fragments[o]).position+o.length-2)||f(r,o.position+o.length-3))return a}function p(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var r=[],o=0;;){r.push(t.fragments[o].offset);var a=h(e,t,o);if(void 0===a||a===t.fragments.length-1)return r;o=a+1}}function m(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256;return e=e.readUint16(),"x".concat("00000000".concat((t+e).toString(16)).substr(-8))}function v(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==m(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=e.readUint32()/4,o=0;o<r;o++){var a=e.readUint32();t.basicOffsetTable.push(a)}for(var i=e.position;e.position<e.byteArray.length;){var s=m(e),l=e.readUint32();if("xfffee0dd"===s)return e.seek(l),void(t.length=e.position-t.dataOffset);if("xfffee000"!==s)return n&&n.push("unexpected tag ".concat(s," while searching for end of pixel data element with undefined length")),l>e.byteArray.length-e.position&&(l=e.byteArray.length-e.position),t.fragments.push({offset:e.position-i-8,position:e.position,length:l}),e.seek(l),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-i-8,position:e.position,length:l}),e.seek(l)}n&&n.push("pixel data element ".concat(t.tag," missing sequence delimiter tag xfffee0dd"))}function g(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}function y(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r,o="",a=0;a<n;a++){if(0===(r=e[t+a]))return t+=n,o;o+=String.fromCharCode(r)}return o}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return void 0!==e.parser?e.parser:t}var w=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=r}var t,n,r;return t=e,(n=[{key:"uint16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return b(e,this.byteArrayParser).readUint16(this.byteArray,e.dataOffset+2*t)}},{key:"int16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return b(e,this.byteArrayParser).readInt16(this.byteArray,e.dataOffset+2*t)}},{key:"uint32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return b(e,this.byteArrayParser).readUint32(this.byteArray,e.dataOffset+4*t)}},{key:"int32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return b(e,this.byteArrayParser).readInt32(this.byteArray,e.dataOffset+4*t)}},{key:"float",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return b(e,this.byteArrayParser).readFloat(this.byteArray,e.dataOffset+4*t)}},{key:"double",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return b(e,this.byteArrayParser).readDouble(this.byteArray,e.dataOffset+8*t)}},{key:"numStringValues",value:function(e){if((e=this.elements[e])&&0<e.length)return null===(e=y(this.byteArray,e.dataOffset,e.length).match(/\\/g))?1:e.length+1}},{key:"string",value:function(e,t){return(e=this.elements[e])&&e.Value?e.Value:e&&0<e.length?(e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].trim():e.trim()):void 0}},{key:"text",value:function(e,t){if((e=this.elements[e])&&0<e.length)return e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].replace(/ +$/,""):e.replace(/ +$/,"")}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseFloat(t)}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseInt(t)}},{key:"attributeTag",value:function(e){if((n=this.elements[e])&&4===n.length){var t=b(n,this.byteArrayParser).readUint16,n=(e=this.byteArray,n.dataOffset);return"x".concat("00000000".concat((256*t(e,n)*256+t(e,n+2)).toString(16)).substr(-8))}}}])&&x(t.prototype,n),r&&x(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function T(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}var I=function(e,t){return void 0!==e.vr?"SQ"===e.vr:t.position+4<=t.byteArray.length?(e=m(t),t.seek(-4),"xfffee000"===e||"xfffee0dd"===e):(t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function S(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var r;return 4294967295===(r={tag:r=m(e),vr:void 0!==n?n(r):void 0,length:e.readUint32(),dataOffset:e.position}).length&&(r.hadUndefinedLength=!0),r.tag===t||(!I(r,e)||a(r.tag)&&!r.hadUndefinedLength?r.hadUndefinedLength?T(e,r):e.seek(r.length):(A(e,r,n),a(r.tag)&&(r.items=void 0))),r}function E(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:m(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(e.position);return t}function C(e,t){var n=E(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var r=S(e,void 0,t);if("xfffee00d"===(n[r.tag]=r).tag)return new w(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),L(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}function A(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=m(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8);r=C(e,n),t.items.push(r)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}:function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var o=C(e,n);t.items.push(o)}})(e,t,n)}function M(e,t){var n=E(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var r=k(e,t);if("xfffee00d"===(n[r.tag]=r).tag)return new w(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),O(n.dataSet,e,e.position+n.length)),n}function P(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=m(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8);r=M(e,n),t.items.push(r)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}:function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var o=M(e,n);t.items.push(o)}})(e,t,n)}var D=function(e){return"OB"===e||"OD"===e||"OL"===e||"OW"===e||"SQ"===e||"OF"===e||"UC"===e||"UR"===e||"UT"===e||"UN"===e?4:2};function k(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var r={tag:m(e),vr:e.readFixedString(2)};return 2===D(r.vr)?r.length=e.readUint16():(e.seek(2),r.length=e.readUint32()),r.dataOffset=e.position,4294967295===r.length&&(r.hadUndefinedLength=!0),r.tag===n||("SQ"===r.vr?P(e,r,t):4294967295===r.length?"x7fe00010"===r.tag?v(e,r,t):("UN"===r.vr?A:T)(e,r):e.seek(r.length)),r}function O(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?t.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var o=e.elements;t.position<n;){var a=k(t,e.warnings,r.untilTag);if((o[a.tag]=a).tag===r.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function L(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?e.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var o=e.elements;t.position<n;){var a=S(t,r.untilTag,r.vrCallback);if((o[a.tag]=a).tag===r.untilTag)return}}function R(e,t){if("undefined"!=typeof Buffer&&e instanceof Buffer)return Buffer.alloc(t);if(e instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"}var _="1.8.12",N={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=(e[t]<<8)+e[t+1])?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}};function U(e,t,n){if("undefined"!=typeof Buffer&&e instanceof Buffer)return e.slice(t,t+n);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+t,n);throw"dicomParser.from: unknown type for byteArray"}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(t,n,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==0&&("undefined"==typeof Buffer||n instanceof Buffer==0))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(r<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(r>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=t,this.byteArray=n,this.position=r||0,this.warnings=[]}var t,n,r;return t=e,(n=[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=U(this.byteArray,this.position,t);return this.position+=t,new e(this.byteArrayParser,n)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=y(this.byteArray,this.position,e);return this.position+=e,t}}])&&B(t.prototype,n),r&&B(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),F={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=e[t]+(e[t+1]<<8))?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}};function V(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=t.TransferSyntaxUID,r=new j(F,e);return function(){var e=function(){if(r.getSize()<=132&&n)return!1;if(r.seek(128),"DICM"===r.readFixedString(4))return!0;if(!(t||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return r.seek(0),!1}(),o=[],a={};if(!e)return r.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:n}},warnings:o};for(;r.position<r.byteArray.length;){var i=r.position,s=k(r,o);if("x0002ffff"<s.tag){r.position=i;break}s.parser=F,a[s.tag]=s}return(e=new w(r.byteArrayParser,r.byteArray,a)).warnings=r.warnings,e.position=r.position,e}()}var H="1.2.840.10008.1.2.2";function z(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var r,o=function(t){if(void 0===t.elements.x00020010)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return(t=t.elements.x00020010)&&t.Value||y(e,t.dataOffset,t.length)};function a(r){var a="1.2.840.10008.1.2"!==(i=o(r)),i=function(r,o){var a="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);if("1.2.840.10008.1.2.1.99"!==r)return new j(r===H?N:F,e,o);if(t&&t.inflater)return r=t.inflater(e,o),new j(F,r,0);if(1==a){var i=n(0),s=U(e,o,e.length-o);return i=i.inflateRawSync(s),s=R(e,i.length+o),e.copy(s,0,0,o),i.copy(s,o),new j(F,s,0)}if("undefined"==typeof pako)throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return i=e.slice(o),s=pako.inflateRaw(i),(i=R(e,s.length+o)).set(e.slice(0,o),0),i.set(s,o),new j(F,i,0)}(i,r.position);(r=new w(i.byteArrayParser,i.byteArray,{})).warnings=i.warnings;try{(a?O:L)(r,i,i.byteArray.length,t)}catch(i){throw{exception:i,dataSet:r}}return r}return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(r=V(e,t),a(r))}var q=function(e,t,n){for(var r=0,o=t;o<t+n;o++)r+=e[o].length;return r};function W(e,t,n,r,o){if(o=o||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(r=r||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(r<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+r>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var a=new j(e.byteArrayParser,e.byteArray,t.dataOffset);if("xfffee000"!==(t=E(a)).tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";a.seek(t.length);var i=a.position;if(1===r)return U(a.byteArray,i+o[n].offset+8,o[n].length);t=q(o,n,r);for(var s=R(a.byteArray,t),l=0,c=n;c<n+r;c++)for(var u=i+o[c].offset+8,d=0;d<o[c].length;d++)s[l++]=a.byteArray[u++];return s}var G=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},Y=function(e,t,n,r){if(e===t.length-1)return n.length-r;for(var o=t[e+1],a=r+1;a<n.length;a++)if(n[a].offset===o)return a-r;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function Z(e,t,n,r,o){if(r=r||t.basicOffsetTable,o=o||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===r.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=r.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var a=r[n];if(void 0===(a=G(o,a)))throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return W(e,t,a,Y(n,r,o,a),o)}var X=!1;function Q(e,t,n){if(X||(X=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?Z(e,t,n):W(e,t,0,t.fragments.length)}t.default={isStringVr:o,isPrivateTag:a,parsePN:i,parseTM:s,parseDA:c,explicitElementToString:u,explicitDataSetToJS:d,createJPEGBasicOffsetTable:p,parseDicomDataSetExplicit:O,parseDicomDataSetImplicit:L,readFixedString:y,alloc:R,version:_,bigEndianByteArrayParser:N,ByteStream:j,sharedCopy:U,DataSet:w,findAndSetUNElementLength:g,findEndOfEncapsulatedElement:v,findItemDelimitationItemAndSetElementLength:T,littleEndianByteArrayParser:F,parseDicom:z,readDicomElementExplicit:k,readDicomElementImplicit:S,readEncapsulatedImageFrame:Z,readEncapsulatedPixelData:Q,readEncapsulatedPixelDataFromFragments:W,readPart10Header:V,readSequenceItemsExplicit:P,readSequenceItemsImplicit:A,readSequenceItem:E,readTag:m,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],r={},t.m=n,t.c=r,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(t){return e[t]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1);function t(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return n[e].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n,r}(n(3848))},7648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,r=Object.prototype.toString,o="[object Function]";e.exports=function(e){var a=this;if("function"!=typeof a||r.call(a)!==o)throw new TypeError(t+a);for(var i,s=n.call(arguments,1),l=function(){if(this instanceof i){var t=a.apply(this,s.concat(n.call(arguments)));return Object(t)===t?t:this}return a.apply(e,s.concat(n.call(arguments)))},c=Math.max(0,a.length-s.length),u=[],d=0;d<c;d++)u.push("$"+d);if(i=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(l),a.prototype){var f=function(){};f.prototype=a.prototype,i.prototype=new f,f.prototype=null}return i}},8612:(e,t,n)=>{"use strict";var r=n(7648);e.exports=Function.prototype.bind||r},210:(e,t,n)=>{"use strict";var r,o=SyntaxError,a=Function,i=TypeError,s=function(e){try{return a('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new i},u=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,d=n(1405)(),f=Object.getPrototypeOf||function(e){return e.__proto__},h={},p="undefined"==typeof Uint8Array?r:f(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":d?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":h,"%AsyncGenerator%":h,"%AsyncGeneratorFunction%":h,"%AsyncIteratorPrototype%":h,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":a,"%GeneratorFunction%":h,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?f(f([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?f(""[Symbol.iterator]()):r,"%Symbol%":d?Symbol:r,"%SyntaxError%":o,"%ThrowTypeError%":u,"%TypedArray%":p,"%TypeError%":i,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},v=function e(t){var n;if("%AsyncFunction%"===t)n=s("async function () {}");else if("%GeneratorFunction%"===t)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=s("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&(n=f(o.prototype))}return m[t]=n,n},g={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=n(8612),x=n(7642),b=y.call(Function.call,Array.prototype.concat),w=y.call(Function.apply,Array.prototype.splice),T=y.call(Function.call,String.prototype.replace),I=y.call(Function.call,String.prototype.slice),S=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,E=/\\(\\)?/g,C=function(e){var t=I(e,0,1),n=I(e,-1);if("%"===t&&"%"!==n)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new o("invalid intrinsic syntax, expected opening `%`");var r=[];return T(e,S,(function(e,t,n,o){r[r.length]=n?T(o,E,"$1"):t||e})),r},A=function(e,t){var n,r=e;if(x(g,r)&&(r="%"+(n=g[r])[0]+"%"),x(m,r)){var a=m[r];if(a===h&&(a=v(r)),void 0===a&&!t)throw new i("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:a}}throw new o("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new i("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new i('"allowMissing" argument must be a boolean');var n=C(e),r=n.length>0?n[0]:"",a=A("%"+r+"%",t),s=a.name,c=a.value,u=!1,d=a.alias;d&&(r=d[0],w(n,b([0,1],d)));for(var f=1,h=!0;f<n.length;f+=1){var p=n[f],v=I(p,0,1),g=I(p,-1);if(('"'===v||"'"===v||"`"===v||'"'===g||"'"===g||"`"===g)&&v!==g)throw new o("property names with quotes must have matching quotes");if("constructor"!==p&&h||(u=!0),x(m,s="%"+(r+="."+p)+"%"))c=m[s];else if(null!=c){if(!(p in c)){if(!t)throw new i("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&f+1>=n.length){var y=l(c,p);c=(h=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[p]}else h=x(c,p),c=c[p];h&&!u&&(m[s]=c)}}return c}},3605:(e,t,n)=>{var r;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(o,a,i,s){"use strict";function l(e,t,n){return setTimeout(h(e,n),t)}function c(e,t,n){return!!Array.isArray(e)&&(u(e,n[t],n),!0)}function u(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function d(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=o.console&&(o.console.warn||o.console.log);return a&&a.call(o.console,r,n),e.apply(this,arguments)}}function f(e,t,n){var r,o=t.prototype;(r=e.prototype=Object.create(o)).constructor=e,r._super=o,n&&se(r,n)}function h(e,t){return function(){return e.apply(t,arguments)}}function p(e,t){return typeof e==ue?e.apply(t&&t[0]||s,t):e}function m(e,t){return e===s?t:e}function v(e,t,n){u(b(t),(function(t){e.addEventListener(t,n,!1)}))}function g(e,t,n){u(b(t),(function(t){e.removeEventListener(t,n,!1)}))}function y(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function x(e,t){return e.indexOf(t)>-1}function b(e){return e.trim().split(/\s+/g)}function w(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function T(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var r=[],o=[],a=0;a<e.length;){var i=t?e[a][t]:e[a];w(o,i)<0&&r.push(e[a]),o[a]=i,a++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function S(e,t){for(var n,r,o=t[0].toUpperCase()+t.slice(1),a=0;a<le.length;){if((r=(n=le[a])?n+o:t)in e)return r;a++}return s}function E(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}function C(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){p(e.options.enable,[e])&&n.handler(t)},this.init()}function A(e,t,n){var r=n.pointers.length,o=n.changedPointers.length,a=t&Ie&&r-o==0,i=t&(Ee|Ce)&&r-o==0;n.isFirst=!!a,n.isFinal=!!i,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,o=r.length;n.firstInput||(n.firstInput=P(t)),o>1&&!n.firstMultiple?n.firstMultiple=P(t):1===o&&(n.firstMultiple=!1);var a=n.firstInput,i=n.firstMultiple,s=i?i.center:a.center,l=t.center=D(r);t.timeStamp=he(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=R(s,l),t.distance=L(s,l),function(e,t){var n=t.center,r=e.offsetDelta||{},o=e.prevDelta||{},a=e.prevInput||{};t.eventType!==Ie&&a.eventType!==Ee||(o=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=o.x+(n.x-r.x),t.deltaY=o.y+(n.y-r.y)}(n,t),t.offsetDirection=O(t.deltaX,t.deltaY);var c=k(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=fe(c.x)>fe(c.y)?c.x:c.y,t.scale=i?function(e,t){return L(t[0],t[1],Ne)/L(e[0],e[1],Ne)}(i.pointers,r):1,t.rotation=i?function(e,t){return R(t[1],t[0],Ne)+R(e[1],e[0],Ne)}(i.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,M(n,t);var u=e.element;y(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function M(e,t){var n,r,o,a,i=e.lastInterval||t,l=t.timeStamp-i.timeStamp;if(t.eventType!=Ce&&(l>Te||i.velocity===s)){var c=t.deltaX-i.deltaX,u=t.deltaY-i.deltaY,d=k(l,c,u);r=d.x,o=d.y,n=fe(d.x)>fe(d.y)?d.x:d.y,a=O(c,u),e.lastInterval=t}else n=i.velocity,r=i.velocityX,o=i.velocityY,a=i.direction;t.velocity=n,t.velocityX=r,t.velocityY=o,t.direction=a}function P(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:de(e.pointers[n].clientX),clientY:de(e.pointers[n].clientY)},n++;return{timeStamp:he(),pointers:t,center:D(t),deltaX:e.deltaX,deltaY:e.deltaY}}function D(e){var t=e.length;if(1===t)return{x:de(e[0].clientX),y:de(e[0].clientY)};for(var n=0,r=0,o=0;t>o;)n+=e[o].clientX,r+=e[o].clientY,o++;return{x:de(n/t),y:de(r/t)}}function k(e,t,n){return{x:t/e||0,y:n/e||0}}function O(e,t){return e===t?Ae:fe(e)>=fe(t)?0>e?Me:Pe:0>t?De:ke}function L(e,t,n){n||(n=_e);var r=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return Math.sqrt(r*r+o*o)}function R(e,t,n){n||(n=_e);var r=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return 180*Math.atan2(o,r)/Math.PI}function _(){this.evEl=Be,this.evWin=je,this.pressed=!1,C.apply(this,arguments)}function N(){this.evEl=He,this.evWin=ze,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function U(){this.evTarget=We,this.evWin=Ge,this.started=!1,C.apply(this,arguments)}function B(e,t){var n=T(e.touches),r=T(e.changedTouches);return t&(Ee|Ce)&&(n=I(n.concat(r),"identifier",!0)),[n,r]}function j(){this.evTarget=Ze,this.targetIds={},C.apply(this,arguments)}function F(e,t){var n=T(e.touches),r=this.targetIds;if(t&(Ie|Se)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var o,a,i=T(e.changedTouches),s=[],l=this.target;if(a=n.filter((function(e){return y(e.target,l)})),t===Ie)for(o=0;o<a.length;)r[a[o].identifier]=!0,o++;for(o=0;o<i.length;)r[i[o].identifier]&&s.push(i[o]),t&(Ee|Ce)&&delete r[i[o].identifier],o++;return s.length?[I(a.concat(s),"identifier",!0),s]:void 0}function V(){C.apply(this,arguments);var e=h(this.handler,this);this.touch=new j(this.manager,e),this.mouse=new _(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function H(e,t){e&Ie?(this.primaryTouch=t.changedPointers[0].identifier,z.call(this,t)):e&(Ee|Ce)&&z.call(this,t)}function z(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),Xe)}}function q(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var o=this.lastTouches[r],a=Math.abs(t-o.x),i=Math.abs(n-o.y);if(Qe>=a&&Qe>=i)return!0}return!1}function W(e,t){this.manager=e,this.set(t)}function G(e){this.options=se({},this.defaults,e||{}),this.id=ve++,this.manager=null,this.options.enable=m(this.options.enable,!0),this.state=it,this.simultaneous={},this.requireFail=[]}function Y(e){return e&dt?"cancel":e&ct?"end":e&lt?"move":e&st?"start":""}function Z(e){return e==ke?"down":e==De?"up":e==Me?"left":e==Pe?"right":""}function X(e,t){var n=t.manager;return n?n.get(e):e}function Q(){G.apply(this,arguments)}function K(){Q.apply(this,arguments),this.pX=null,this.pY=null}function J(){Q.apply(this,arguments)}function $(){G.apply(this,arguments),this._timer=null,this._input=null}function ee(){Q.apply(this,arguments)}function te(){Q.apply(this,arguments)}function ne(){G.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function re(e,t){return(t=t||{}).recognizers=m(t.recognizers,re.defaults.preset),new oe(e,t)}function oe(e,t){this.options=se({},re.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){return new(e.options.inputClass||(ye?N:xe?j:ge?V:_))(e,A)}(this),this.touchAction=new W(this,this.options.touchAction),ae(this,!0),u(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function ae(e,t){var n,r=e.element;r.style&&(u(e.options.cssProps,(function(o,a){n=S(r.style,a),t?(e.oldCssProps[n]=r.style[n],r.style[n]=o):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}function ie(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}var se,le=["","webkit","Moz","MS","ms","o"],ce=a.createElement("div"),ue="function",de=Math.round,fe=Math.abs,he=Date.now;se="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t}:Object.assign;var pe=d((function(e,t,n){for(var r=Object.keys(t),o=0;o<r.length;)(!n||n&&e[r[o]]===s)&&(e[r[o]]=t[r[o]]),o++;return e}),"extend","Use `assign`."),me=d((function(e,t){return pe(e,t,!0)}),"merge","Use `assign`."),ve=1,ge="ontouchstart"in o,ye=S(o,"PointerEvent")!==s,xe=ge&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),be="touch",we="mouse",Te=25,Ie=1,Se=2,Ee=4,Ce=8,Ae=1,Me=2,Pe=4,De=8,ke=16,Oe=Me|Pe,Le=De|ke,Re=Oe|Le,_e=["x","y"],Ne=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(E(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(E(this.element),this.evWin,this.domHandler)}};var Ue={mousedown:Ie,mousemove:Se,mouseup:Ee},Be="mousedown",je="mousemove mouseup";f(_,C,{handler:function(e){var t=Ue[e.type];t&Ie&&0===e.button&&(this.pressed=!0),t&Se&&1!==e.which&&(t=Ee),this.pressed&&(t&Ee&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:we,srcEvent:e}))}});var Fe={pointerdown:Ie,pointermove:Se,pointerup:Ee,pointercancel:Ce,pointerout:Ce},Ve={2:be,3:"pen",4:we,5:"kinect"},He="pointerdown",ze="pointermove pointerup pointercancel";o.MSPointerEvent&&!o.PointerEvent&&(He="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel"),f(N,C,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),o=Fe[r],a=Ve[e.pointerType]||e.pointerType,i=a==be,s=w(t,e.pointerId,"pointerId");o&Ie&&(0===e.button||i)?0>s&&(t.push(e),s=t.length-1):o&(Ee|Ce)&&(n=!0),0>s||(t[s]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var qe={touchstart:Ie,touchmove:Se,touchend:Ee,touchcancel:Ce},We="touchstart",Ge="touchstart touchmove touchend touchcancel";f(U,C,{handler:function(e){var t=qe[e.type];if(t===Ie&&(this.started=!0),this.started){var n=B.call(this,e,t);t&(Ee|Ce)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:be,srcEvent:e})}}});var Ye={touchstart:Ie,touchmove:Se,touchend:Ee,touchcancel:Ce},Ze="touchstart touchmove touchend touchcancel";f(j,C,{handler:function(e){var t=Ye[e.type],n=F.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:be,srcEvent:e})}});var Xe=2500,Qe=25;f(V,C,{handler:function(e,t,n){var r=n.pointerType==be,o=n.pointerType==we;if(!(o&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)H.call(this,t,n);else if(o&&q.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ke=S(ce.style,"touchAction"),Je=Ke!==s,$e="compute",et="auto",tt="manipulation",nt="none",rt="pan-x",ot="pan-y",at=function(){if(!Je)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||o.CSS.supports("touch-action",n)})),e}();W.prototype={set:function(e){e==$e&&(e=this.compute()),Je&&this.manager.element.style&&at[e]&&(this.manager.element.style[Ke]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return u(this.manager.recognizers,(function(t){p(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(x(e,nt))return nt;var t=x(e,rt),n=x(e,ot);return t&&n?nt:t||n?t?rt:ot:x(e,tt)?tt:et}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(!this.manager.session.prevented){var r=this.actions,o=x(r,nt)&&!at[nt],a=x(r,ot)&&!at[ot],i=x(r,rt)&&!at[rt];if(o){var s=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(s&&l&&c)return}return i&&a?void 0:o||a&&n&Oe||i&&n&Le?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var it=1,st=2,lt=4,ct=8,ut=ct,dt=16,ft=32;G.prototype={defaults:{},set:function(e){return se(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(c(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=X(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return c(e,"dropRecognizeWith",this)||(e=X(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(c(e,"requireFailure",this))return this;var t=this.requireFail;return-1===w(t,e=X(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(c(e,"dropRequireFailure",this))return this;e=X(e,this);var t=w(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,r=this.state;ct>r&&t(n.options.event+Y(r)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),r>=ct&&t(n.options.event+Y(r))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=ft)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ft|it)))return!1;e++}return!0},recognize:function(e){var t=se({},e);return p(this.options.enable,[this,t])?(this.state&(ut|dt|ft)&&(this.state=it),this.state=this.process(t),void(this.state&(st|lt|ct|dt)&&this.tryEmit(t))):(this.reset(),void(this.state=ft))},process:function(e){},getTouchAction:function(){},reset:function(){}},f(Q,G,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=t&(st|lt),o=this.attrTest(e);return r&&(n&Ce||!o)?t|dt:r||o?n&Ee?t|ct:t&st?t|lt:st:ft}}),f(K,Q,{defaults:{event:"pan",threshold:10,pointers:1,direction:Re},getTouchAction:function(){var e=this.options.direction,t=[];return e&Oe&&t.push(ot),e&Le&&t.push(rt),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,o=e.direction,a=e.deltaX,i=e.deltaY;return o&t.direction||(t.direction&Oe?(o=0===a?Ae:0>a?Me:Pe,n=a!=this.pX,r=Math.abs(e.deltaX)):(o=0===i?Ae:0>i?De:ke,n=i!=this.pY,r=Math.abs(e.deltaY))),e.direction=o,n&&r>t.threshold&&o&t.direction},attrTest:function(e){return Q.prototype.attrTest.call(this,e)&&(this.state&st||!(this.state&st)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Z(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),f(J,Q,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&st)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),f($,G,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[et]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,o=e.deltaTime>t.time;if(this._input=e,!r||!n||e.eventType&(Ee|Ce)&&!o)this.reset();else if(e.eventType&Ie)this.reset(),this._timer=l((function(){this.state=ut,this.tryEmit()}),t.time,this);else if(e.eventType&Ee)return ut;return ft},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ut&&(e&&e.eventType&Ee?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=he(),this.manager.emit(this.options.event,this._input)))}}),f(ee,Q,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&st)}}),f(te,Q,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Oe|Le,pointers:1},getTouchAction:function(){return K.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Oe|Le)?t=e.overallVelocity:n&Oe?t=e.overallVelocityX:n&Le&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&fe(t)>this.options.velocity&&e.eventType&Ee},emit:function(e){var t=Z(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),f(ne,G,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[tt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&Ie&&0===this.count)return this.failTimeout();if(r&&o&&n){if(e.eventType!=Ee)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||L(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,i&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=l((function(){this.state=ut,this.tryEmit()}),t.interval,this),st):ut}return ft},failTimeout:function(){return this._timer=l((function(){this.state=ft}),this.options.interval,this),ft},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),re.VERSION="2.0.7",re.defaults={domEvents:!1,touchAction:$e,enable:!0,inputTarget:null,inputClass:null,preset:[[ee,{enable:!1}],[J,{enable:!1},["rotate"]],[te,{direction:Oe}],[K,{direction:Oe},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[$]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};oe.prototype={set:function(e){return se(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,r=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&ut)&&(o=t.curRecognizer=null);for(var a=0;a<r.length;)n=r[a],2===t.stopped||o&&n!=o&&!n.canRecognizeWith(o)?n.reset():n.recognize(e),!o&&n.state&(st|lt|ct)&&(o=t.curRecognizer=n),a++}},get:function(e){if(e instanceof G)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(c(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(c(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=w(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return u(b(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==s){var n=this.handlers;return u(b(e),(function(e){t?n[e]&&n[e].splice(w(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&ie(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&ae(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},se(re,{INPUT_START:Ie,INPUT_MOVE:Se,INPUT_END:Ee,INPUT_CANCEL:Ce,STATE_POSSIBLE:it,STATE_BEGAN:st,STATE_CHANGED:lt,STATE_ENDED:ct,STATE_RECOGNIZED:ut,STATE_CANCELLED:dt,STATE_FAILED:ft,DIRECTION_NONE:Ae,DIRECTION_LEFT:Me,DIRECTION_RIGHT:Pe,DIRECTION_UP:De,DIRECTION_DOWN:ke,DIRECTION_HORIZONTAL:Oe,DIRECTION_VERTICAL:Le,DIRECTION_ALL:Re,Manager:oe,Input:C,TouchAction:W,TouchInput:j,MouseInput:_,PointerEventInput:N,TouchMouseInput:V,SingleTouchInput:U,Recognizer:G,AttrRecognizer:Q,Tap:ne,Pan:K,Swipe:te,Pinch:J,Rotate:ee,Press:$,on:v,off:g,each:u,merge:me,extend:pe,assign:se,inherit:f,bindFn:h,prefixed:S}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=re,void 0===(r=function(){return re}.call(t,n,t,e))||(e.exports=r)}(window,document)},1405:(e,t,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,o=n(5419);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&o())))}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},7642:(e,t,n)=>{"use strict";var r=n(8612);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},1077:function(e,t,n){var r,o,a;void 0!==n.g?n.g:window||this.window||this.global,o=[],r=function(e){"use strict";var t={},n="iziToast",r=(document.querySelector("body"),!!/Mobi/.test(navigator.userAgent)),o=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),a="undefined"!=typeof InstallTrigger,i="ontouchstart"in document.documentElement,s=["bottomRight","bottomLeft","bottomCenter","topRight","topLeft","topCenter","center"],l={info:{color:"blue",icon:"ico-info"},success:{color:"green",icon:"ico-success"},warning:{color:"orange",icon:"ico-warning"},error:{color:"red",icon:"ico-error"},question:{color:"yellow",icon:"ico-question"}},c=568,u={};t.children={};var d={id:null,class:"",title:"",titleColor:"",titleSize:"",titleLineHeight:"",message:"",messageColor:"",messageSize:"",messageLineHeight:"",backgroundColor:"",theme:"light",color:"",icon:"",iconText:"",iconColor:"",iconUrl:null,image:"",imageWidth:50,maxWidth:null,zindex:null,layout:1,balloon:!1,close:!0,closeOnEscape:!1,closeOnClick:!1,displayMode:0,position:"bottomRight",target:"",targetFirst:!0,timeout:5e3,rtl:!1,animateInside:!0,drag:!0,pauseOnHover:!0,resetOnHover:!1,progressBar:!0,progressBarColor:"",progressBarEasing:"linear",overlay:!1,overlayClose:!1,overlayColor:"rgba(0, 0, 0, 0.6)",transitionIn:"fadeInUp",transitionOut:"fadeOut",transitionInMobile:"fadeInUp",transitionOutMobile:"fadeOutDown",buttons:{},inputs:{},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){}};if("remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),"function"!=typeof window.CustomEvent){var f=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};f.prototype=window.Event.prototype,window.CustomEvent=f}var h=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(n,e[r],r,e);else if(e)for(var o=0,a=e.length;a>o;o++)t.call(n,e[o],o,e)},p=function(e,t){var n={};return h(e,(function(t,r){n[r]=e[r]})),h(t,(function(e,r){n[r]=t[r]})),n},m=function(e){var t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.firstChild);return t},v=function(e){return btoa(encodeURIComponent(e)).replace(/=/g,"")},g=function(e){return"#"==e.substring(0,1)||"rgb"==e.substring(0,3)||"hsl"==e.substring(0,3)},y=function(e){try{return btoa(atob(e))==e}catch(e){return!1}},x={move:function(e,t,r,i){var s,l=.3,c=180;0!==i&&(e.classList.add(n+"-dragged"),e.style.transform="translateX("+i+"px)",i>0?l>(s=(c-i)/c)&&t.hide(p(r,{transitionOut:"fadeOutRight",transitionOutMobile:"fadeOutRight"}),e,"drag"):l>(s=(c+i)/c)&&t.hide(p(r,{transitionOut:"fadeOutLeft",transitionOutMobile:"fadeOutLeft"}),e,"drag"),e.style.opacity=s,l>s&&((o||a)&&(e.style.left=i+"px"),e.parentNode.style.opacity=l,this.stopMoving(e,null)))},startMoving:function(e,t,n,r){r=r||window.event;var o=i?r.touches[0].clientX:r.clientX,a=e.style.transform.replace("px)",""),s=o-(a=a.replace("translateX(",""));n.transitionIn&&e.classList.remove(n.transitionIn),n.transitionInMobile&&e.classList.remove(n.transitionInMobile),e.style.transition="",i?document.ontouchmove=function(r){r.preventDefault();var o=(r=r||window.event).touches[0].clientX-s;x.move(e,t,n,o)}:document.onmousemove=function(r){r.preventDefault();var o=(r=r||window.event).clientX-s;x.move(e,t,n,o)}},stopMoving:function(e,t){i?document.ontouchmove=function(){}:document.onmousemove=function(){},e.style.opacity="",e.style.transform="",e.classList.contains(n+"-dragged")&&(e.classList.remove(n+"-dragged"),e.style.transition="transform 0.4s ease, opacity 0.4s ease",setTimeout((function(){e.style.transition=""}),400))}};return t.setSetting=function(e,n,r){t.children[e][n]=r},t.getSetting=function(e,n){return t.children[e][n]},t.destroy=function(){h(document.querySelectorAll("."+n+"-overlay"),(function(e,t){e.remove()})),h(document.querySelectorAll("."+n+"-wrapper"),(function(e,t){e.remove()})),h(document.querySelectorAll("."+n),(function(e,t){e.remove()})),this.children={},document.removeEventListener(n+"-opened",{},!1),document.removeEventListener(n+"-opening",{},!1),document.removeEventListener(n+"-closing",{},!1),document.removeEventListener(n+"-closed",{},!1),document.removeEventListener("keyup",{},!1),u={}},t.settings=function(e){t.destroy(),u=e,d=p(d,e||{})},h(l,(function(e,n){t[n]=function(t){var n=p(u,t||{});n=p(e,n||{}),this.show(n)}})),t.progress=function(e,t,r){var o=this,a=t.getAttribute("data-iziToast-ref"),i=p(this.children[a],e||{}),s=t.querySelector("."+n+"-progressbar div");return{start:function(){void 0===i.time.REMAINING&&(t.classList.remove(n+"-reseted"),null!==s&&(s.style.transition="width "+i.timeout+"ms "+i.progressBarEasing,s.style.width="0%"),i.time.START=(new Date).getTime(),i.time.END=i.time.START+i.timeout,i.time.TIMER=setTimeout((function(){clearTimeout(i.time.TIMER),t.classList.contains(n+"-closing")||(o.hide(i,t,"timeout"),"function"==typeof r&&r.apply(o))}),i.timeout),o.setSetting(a,"time",i.time))},pause:function(){if(void 0!==i.time.START&&!t.classList.contains(n+"-paused")&&!t.classList.contains(n+"-reseted")){if(t.classList.add(n+"-paused"),i.time.REMAINING=i.time.END-(new Date).getTime(),clearTimeout(i.time.TIMER),o.setSetting(a,"time",i.time),null!==s){var e=window.getComputedStyle(s).getPropertyValue("width");s.style.transition="none",s.style.width=e}"function"==typeof r&&setTimeout((function(){r.apply(o)}),10)}},resume:function(){void 0!==i.time.REMAINING?(t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="width "+i.time.REMAINING+"ms "+i.progressBarEasing,s.style.width="0%"),i.time.END=(new Date).getTime()+i.time.REMAINING,i.time.TIMER=setTimeout((function(){clearTimeout(i.time.TIMER),t.classList.contains(n+"-closing")||(o.hide(i,t,"timeout"),"function"==typeof r&&r.apply(o))}),i.time.REMAINING),o.setSetting(a,"time",i.time)):this.start()},reset:function(){clearTimeout(i.time.TIMER),delete i.time.REMAINING,o.setSetting(a,"time",i.time),t.classList.add(n+"-reseted"),t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="none",s.style.width="100%"),"function"==typeof r&&setTimeout((function(){r.apply(o)}),10)}}},t.hide=function(e,t,o){"object"!=typeof t&&(t=document.querySelector(t));var a=this,i=p(this.children[t.getAttribute("data-iziToast-ref")],e||{});i.closedBy=o||null,delete i.time.REMAINING,t.classList.add(n+"-closing"),function(){var e=document.querySelector("."+n+"-overlay");if(null!==e){var t=e.getAttribute("data-iziToast-ref"),r=(t=t.split(",")).indexOf(String(i.ref));-1!==r&&t.splice(r,1),e.setAttribute("data-iziToast-ref",t.join()),0===t.length&&(e.classList.remove("fadeIn"),e.classList.add("fadeOut"),setTimeout((function(){e.remove()}),700))}}(),i.transitionIn&&t.classList.remove(i.transitionIn),i.transitionInMobile&&t.classList.remove(i.transitionInMobile),r||window.innerWidth<=c?i.transitionOutMobile&&t.classList.add(i.transitionOutMobile):i.transitionOut&&t.classList.add(i.transitionOut);var s=t.parentNode.offsetHeight;t.parentNode.style.height=s+"px",t.style.pointerEvents="none",(!r||window.innerWidth>c)&&(t.parentNode.style.transitionDelay="0.2s");try{var l=new CustomEvent(n+"-closing",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(l)}catch(e){console.warn(e)}setTimeout((function(){t.parentNode.style.height="0px",t.parentNode.style.overflow="",setTimeout((function(){delete a.children[i.ref],t.parentNode.remove();try{var e=new CustomEvent(n+"-closed",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}void 0!==i.onClosed&&i.onClosed.apply(null,[i,t,o])}),1e3)}),200),void 0!==i.onClosing&&i.onClosing.apply(null,[i,t,o])},t.show=function(e){var o=this,a=p(u,e||{});if((a=p(d,a)).time={},null===a.id&&(a.id=v(a.title+a.message+a.color)),1===a.displayMode||"once"==a.displayMode)try{if(document.querySelectorAll("."+n+"#"+a.id).length>0)return!1}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+a.id+". Try to set an valid id.")}if(2===a.displayMode||"replace"==a.displayMode)try{h(document.querySelectorAll("."+n+"#"+a.id),(function(e,t){o.hide(a,e,"replaced")}))}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+a.id+". Try to set an valid id.")}a.ref=(new Date).getTime()+Math.floor(1e7*Math.random()+1),t.children[a.ref]=a;var l,f={body:document.querySelector("body"),overlay:document.createElement("div"),toast:document.createElement("div"),toastBody:document.createElement("div"),toastTexts:document.createElement("div"),toastCapsule:document.createElement("div"),cover:document.createElement("div"),buttons:document.createElement("div"),inputs:document.createElement("div"),icon:a.iconUrl?document.createElement("img"):document.createElement("i"),wrapper:null};f.toast.setAttribute("data-iziToast-ref",a.ref),f.toast.appendChild(f.toastBody),f.toastCapsule.appendChild(f.toast),function(){if(f.toast.classList.add(n),f.toast.classList.add(n+"-opening"),f.toastCapsule.classList.add(n+"-capsule"),f.toastBody.classList.add(n+"-body"),f.toastTexts.classList.add(n+"-texts"),r||window.innerWidth<=c?a.transitionInMobile&&f.toast.classList.add(a.transitionInMobile):a.transitionIn&&f.toast.classList.add(a.transitionIn),a.class){var e=a.class.split(" ");h(e,(function(e,t){f.toast.classList.add(e)}))}a.id&&(f.toast.id=a.id),a.rtl&&(f.toast.classList.add(n+"-rtl"),f.toast.setAttribute("dir","rtl")),a.layout>1&&f.toast.classList.add(n+"-layout"+a.layout),a.balloon&&f.toast.classList.add(n+"-balloon"),a.maxWidth&&(isNaN(a.maxWidth)?f.toast.style.maxWidth=a.maxWidth:f.toast.style.maxWidth=a.maxWidth+"px"),""===a.theme&&"light"===a.theme||f.toast.classList.add(n+"-theme-"+a.theme),a.color&&(g(a.color)?f.toast.style.background=a.color:f.toast.classList.add(n+"-color-"+a.color)),a.backgroundColor&&(f.toast.style.background=a.backgroundColor,a.balloon&&(f.toast.style.borderColor=a.backgroundColor))}(),a.image&&(f.cover.classList.add(n+"-cover"),f.cover.style.width=a.imageWidth+"px",y(a.image.replace(/ /g,""))?f.cover.style.backgroundImage="url(data:image/png;base64,"+a.image.replace(/ /g,"")+")":f.cover.style.backgroundImage="url("+a.image+")",a.rtl?f.toastBody.style.marginRight=a.imageWidth+10+"px":f.toastBody.style.marginLeft=a.imageWidth+10+"px",f.toast.appendChild(f.cover)),a.close?(f.buttonClose=document.createElement("button"),f.buttonClose.type="button",f.buttonClose.classList.add(n+"-close"),f.buttonClose.addEventListener("click",(function(e){e.target,o.hide(a,f.toast,"button")})),f.toast.appendChild(f.buttonClose)):a.rtl?f.toast.style.paddingLeft="18px":f.toast.style.paddingRight="18px",a.progressBar&&(f.progressBar=document.createElement("div"),f.progressBarDiv=document.createElement("div"),f.progressBar.classList.add(n+"-progressbar"),f.progressBarDiv.style.background=a.progressBarColor,f.progressBar.appendChild(f.progressBarDiv),f.toast.appendChild(f.progressBar)),a.timeout&&(a.pauseOnHover&&!a.resetOnHover&&(f.toast.addEventListener("mouseenter",(function(e){o.progress(a,f.toast).pause()})),f.toast.addEventListener("mouseleave",(function(e){o.progress(a,f.toast).resume()}))),a.resetOnHover&&(f.toast.addEventListener("mouseenter",(function(e){o.progress(a,f.toast).reset()})),f.toast.addEventListener("mouseleave",(function(e){o.progress(a,f.toast).start()})))),a.iconUrl?(f.icon.setAttribute("class",n+"-icon"),f.icon.setAttribute("src",a.iconUrl)):a.icon&&(f.icon.setAttribute("class",n+"-icon "+a.icon),a.iconText&&f.icon.appendChild(document.createTextNode(a.iconText)),a.iconColor&&(f.icon.style.color=a.iconColor)),(a.icon||a.iconUrl)&&(a.rtl?f.toastBody.style.paddingRight="33px":f.toastBody.style.paddingLeft="33px",f.toastBody.appendChild(f.icon)),a.title.length>0&&(f.strong=document.createElement("strong"),f.strong.classList.add(n+"-title"),f.strong.appendChild(m(a.title)),f.toastTexts.appendChild(f.strong),a.titleColor&&(f.strong.style.color=a.titleColor),a.titleSize&&(isNaN(a.titleSize)?f.strong.style.fontSize=a.titleSize:f.strong.style.fontSize=a.titleSize+"px"),a.titleLineHeight&&(isNaN(a.titleSize)?f.strong.style.lineHeight=a.titleLineHeight:f.strong.style.lineHeight=a.titleLineHeight+"px")),a.message.length>0&&(f.p=document.createElement("p"),f.p.classList.add(n+"-message"),f.p.appendChild(m(a.message)),f.toastTexts.appendChild(f.p),a.messageColor&&(f.p.style.color=a.messageColor),a.messageSize&&(isNaN(a.titleSize)?f.p.style.fontSize=a.messageSize:f.p.style.fontSize=a.messageSize+"px"),a.messageLineHeight&&(isNaN(a.titleSize)?f.p.style.lineHeight=a.messageLineHeight:f.p.style.lineHeight=a.messageLineHeight+"px")),a.title.length>0&&a.message.length>0&&(a.rtl?f.strong.style.marginLeft="10px":2===a.layout||a.rtl||(f.strong.style.marginRight="10px")),f.toastBody.appendChild(f.toastTexts),a.inputs.length>0&&(f.inputs.classList.add(n+"-inputs"),h(a.inputs,(function(e,t){f.inputs.appendChild(m(e[0])),(l=f.inputs.childNodes)[t].classList.add(n+"-inputs-child"),e[3]&&setTimeout((function(){l[t].focus()}),300),l[t].addEventListener(e[1],(function(t){return(0,e[2])(o,f.toast,this,t)}))})),f.toastBody.appendChild(f.inputs)),a.buttons.length>0&&(f.buttons.classList.add(n+"-buttons"),h(a.buttons,(function(e,t){f.buttons.appendChild(m(e[0]));var r=f.buttons.childNodes;r[t].classList.add(n+"-buttons-child"),e[2]&&setTimeout((function(){r[t].focus()}),300),r[t].addEventListener("click",(function(t){return t.preventDefault(),(0,e[1])(o,f.toast,this,t,l)}))}))),f.toastBody.appendChild(f.buttons),a.message.length>0&&(a.inputs.length>0||a.buttons.length>0)&&(f.p.style.marginBottom="0"),(a.inputs.length>0||a.buttons.length>0)&&(a.rtl?f.toastTexts.style.marginLeft="10px":f.toastTexts.style.marginRight="10px",a.inputs.length>0&&a.buttons.length>0&&(a.rtl?f.inputs.style.marginLeft="8px":f.inputs.style.marginRight="8px")),f.toastCapsule.style.visibility="hidden",setTimeout((function(){var e=f.toast.offsetHeight,t=f.toast.currentStyle||window.getComputedStyle(f.toast),n=t.marginTop;n=n.split("px"),n=parseInt(n[0]);var r=t.marginBottom;r=r.split("px"),r=parseInt(r[0]),f.toastCapsule.style.visibility="",f.toastCapsule.style.height=e+r+n+"px",setTimeout((function(){f.toastCapsule.style.height="auto",a.target&&(f.toastCapsule.style.overflow="visible")}),500),a.timeout&&o.progress(a,f.toast).start()}),100),function(){var e=a.position;if(a.target)f.wrapper=document.querySelector(a.target),f.wrapper.classList.add(n+"-target"),a.targetFirst?f.wrapper.insertBefore(f.toastCapsule,f.wrapper.firstChild):f.wrapper.appendChild(f.toastCapsule);else{if(-1==s.indexOf(a.position))return void console.warn("["+n+"] Incorrect position.\nIt can be › "+s);e=r||window.innerWidth<=c?"bottomLeft"==a.position||"bottomRight"==a.position||"bottomCenter"==a.position?n+"-wrapper-bottomCenter":"topLeft"==a.position||"topRight"==a.position||"topCenter"==a.position?n+"-wrapper-topCenter":n+"-wrapper-center":n+"-wrapper-"+e,f.wrapper=document.querySelector("."+n+"-wrapper."+e),f.wrapper||(f.wrapper=document.createElement("div"),f.wrapper.classList.add(n+"-wrapper"),f.wrapper.classList.add(e),document.body.appendChild(f.wrapper)),"topLeft"==a.position||"topCenter"==a.position||"topRight"==a.position?f.wrapper.insertBefore(f.toastCapsule,f.wrapper.firstChild):f.wrapper.appendChild(f.toastCapsule)}isNaN(a.zindex)?console.warn("["+n+"] Invalid zIndex."):f.wrapper.style.zIndex=a.zindex}(),a.overlay&&(null!==document.querySelector("."+n+"-overlay.fadeIn")?(f.overlay=document.querySelector("."+n+"-overlay"),f.overlay.setAttribute("data-iziToast-ref",f.overlay.getAttribute("data-iziToast-ref")+","+a.ref),isNaN(a.zindex)||null===a.zindex||(f.overlay.style.zIndex=a.zindex-1)):(f.overlay.classList.add(n+"-overlay"),f.overlay.classList.add("fadeIn"),f.overlay.style.background=a.overlayColor,f.overlay.setAttribute("data-iziToast-ref",a.ref),isNaN(a.zindex)||null===a.zindex||(f.overlay.style.zIndex=a.zindex-1),document.querySelector("body").appendChild(f.overlay)),a.overlayClose?(f.overlay.removeEventListener("click",{}),f.overlay.addEventListener("click",(function(e){o.hide(a,f.toast,"overlay")}))):f.overlay.removeEventListener("click",{})),function(){if(a.animateInside){f.toast.classList.add(n+"-animateInside");var e=[200,100,300];"bounceInLeft"!=a.transitionIn&&"bounceInRight"!=a.transitionIn||(e=[400,200,400]),a.title.length>0&&setTimeout((function(){f.strong.classList.add("slideIn")}),e[0]),a.message.length>0&&setTimeout((function(){f.p.classList.add("slideIn")}),e[1]),(a.icon||a.iconUrl)&&setTimeout((function(){f.icon.classList.add("revealIn")}),e[2]);var t=150;a.buttons.length>0&&f.buttons&&setTimeout((function(){h(f.buttons.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150}))}),a.inputs.length>0?150:0),a.inputs.length>0&&f.inputs&&(t=150,h(f.inputs.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150})))}}(),a.onOpening.apply(null,[a,f.toast]);try{var b=new CustomEvent(n+"-opening",{detail:a,bubbles:!0,cancelable:!0});document.dispatchEvent(b)}catch(e){console.warn(e)}setTimeout((function(){f.toast.classList.remove(n+"-opening"),f.toast.classList.add(n+"-opened");try{var e=new CustomEvent(n+"-opened",{detail:a,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}a.onOpened.apply(null,[a,f.toast])}),1e3),a.drag&&(i?(f.toast.addEventListener("touchstart",(function(e){x.startMoving(this,o,a,e)}),!1),f.toast.addEventListener("touchend",(function(e){x.stopMoving(this,e)}),!1)):(f.toast.addEventListener("mousedown",(function(e){e.preventDefault(),x.startMoving(this,o,a,e)}),!1),f.toast.addEventListener("mouseup",(function(e){e.preventDefault(),x.stopMoving(this,e)}),!1))),a.closeOnEscape&&document.addEventListener("keyup",(function(e){27==(e=e||window.event).keyCode&&o.hide(a,f.toast,"esc")})),a.closeOnClick&&f.toast.addEventListener("click",(function(e){o.hide(a,f.toast,"toast")})),o.toast=f.toast},t}(),void 0===(a="function"==typeof r?r.apply(t,o):r)||(e.exports=a)},4865:function(e,t,n){var r,o;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */r=function(){var e,t,n={version:"0.2.0"},r=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function o(e,t,n){return e<t?t:e>n?n:e}function a(e){return 100*(-1+e)}function i(e,t,n){var o;return(o="translate3d"===r.positionUsing?{transform:"translate3d("+a(e)+"%,0,0)"}:"translate"===r.positionUsing?{transform:"translate("+a(e)+"%,0)"}:{"margin-left":a(e)+"%"}).transition="all "+t+"ms "+n,o}n.configure=function(e){var t,n;for(t in e)void 0!==(n=e[t])&&e.hasOwnProperty(t)&&(r[t]=n);return this},n.status=null,n.set=function(e){var t=n.isStarted();e=o(e,r.minimum,1),n.status=1===e?null:e;var a=n.render(!t),c=a.querySelector(r.barSelector),u=r.speed,d=r.easing;return a.offsetWidth,s((function(t){""===r.positionUsing&&(r.positionUsing=n.getPositioningCSS()),l(c,i(e,u,d)),1===e?(l(a,{transition:"none",opacity:1}),a.offsetWidth,setTimeout((function(){l(a,{transition:"all "+u+"ms linear",opacity:0}),setTimeout((function(){n.remove(),t()}),u)}),u)):setTimeout(t,u)})),this},n.isStarted=function(){return"number"==typeof n.status},n.start=function(){n.status||n.set(0);var e=function(){setTimeout((function(){n.status&&(n.trickle(),e())}),r.trickleSpeed)};return r.trickle&&e(),this},n.done=function(e){return e||n.status?n.inc(.3+.5*Math.random()).set(1):this},n.inc=function(e){var t=n.status;return t?("number"!=typeof e&&(e=(1-t)*o(Math.random()*t,.1,.95)),t=o(t+e,0,.994),n.set(t)):n.start()},n.trickle=function(){return n.inc(Math.random()*r.trickleRate)},e=0,t=0,n.promise=function(r){return r&&"resolved"!==r.state()?(0===t&&n.start(),e++,t++,r.always((function(){0==--t?(e=0,n.done()):n.set((e-t)/e)})),this):this},n.render=function(e){if(n.isRendered())return document.getElementById("nprogress");u(document.documentElement,"nprogress-busy");var t=document.createElement("div");t.id="nprogress",t.innerHTML=r.template;var o,i=t.querySelector(r.barSelector),s=e?"-100":a(n.status||0),c=document.querySelector(r.parent);return l(i,{transition:"all 0 linear",transform:"translate3d("+s+"%,0,0)"}),r.showSpinner||(o=t.querySelector(r.spinnerSelector))&&h(o),c!=document.body&&u(c,"nprogress-custom-parent"),c.appendChild(t),t},n.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(r.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&h(e)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"};var s=function(){var e=[];function t(){var n=e.shift();n&&n(t)}return function(n){e.push(n),1==e.length&&t()}}(),l=function(){var e=["Webkit","O","Moz","ms"],t={};function n(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()}))}function r(t){var n=document.body.style;if(t in n)return t;for(var r,o=e.length,a=t.charAt(0).toUpperCase()+t.slice(1);o--;)if((r=e[o]+a)in n)return r;return t}function o(e){return e=n(e),t[e]||(t[e]=r(e))}function a(e,t,n){t=o(t),e.style[t]=n}return function(e,t){var n,r,o=arguments;if(2==o.length)for(n in t)void 0!==(r=t[n])&&t.hasOwnProperty(n)&&a(e,n,r);else a(e,o[1],o[2])}}();function c(e,t){return("string"==typeof e?e:f(e)).indexOf(" "+t+" ")>=0}function u(e,t){var n=f(e),r=n+t;c(n,t)||(e.className=r.substring(1))}function d(e,t){var n,r=f(e);c(e,t)&&(n=r.replace(" "+t+" "," "),e.className=n.substring(1,n.length-1))}function f(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function h(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return n},void 0===(o="function"==typeof r?r.call(t,n,t,e):r)||(e.exports=o)},631:(e,t,n)=>{var r="function"==typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,a=r&&o&&"function"==typeof o.get?o.get:null,i=r&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&l&&"function"==typeof l.get?l.get:null,u=s&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,f="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,h="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,v=Function.prototype.toString,g=String.prototype.match,y=String.prototype.slice,x=String.prototype.replace,b=String.prototype.toUpperCase,w=String.prototype.toLowerCase,T=RegExp.prototype.test,I=Array.prototype.concat,S=Array.prototype.join,E=Array.prototype.slice,C=Math.floor,A="function"==typeof BigInt?BigInt.prototype.valueOf:null,M=Object.getOwnPropertySymbols,P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,D="function"==typeof Symbol&&"object"==typeof Symbol.iterator,k="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===D||"symbol")?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,L=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||T.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-C(-e):C(e);if(r!==e){var o=String(r),a=y.call(t,o.length+1);return x.call(o,n,"$&_")+"."+x.call(x.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return x.call(t,n,"$&_")}var _=n(4654).custom,N=_&&F(_)?_:null;function U(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function B(e){return x.call(String(e),/"/g,"&quot;")}function j(e){return!("[object Array]"!==z(e)||k&&"object"==typeof e&&k in e)}function F(e){if(D)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!P)return!1;try{return P.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,r,o){var s=n||{};if(H(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(H(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!H(s,"customInspect")||s.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(H(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(H(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var m=s.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return W(t,s);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var b=String(t);return m?R(t,b):b}if("bigint"==typeof t){var T=String(t)+"n";return m?R(t,T):T}var C=void 0===s.depth?5:s.depth;if(void 0===r&&(r=0),r>=C&&C>0&&"object"==typeof t)return j(t)?"[Array]":"[Object]";var M=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=S.call(Array(e.indent+1)," ")}return{base:n,prev:S.call(Array(t+1),n)}}(s,r);if(void 0===o)o=[];else if(q(o,t)>=0)return"[Circular]";function _(t,n,a){if(n&&(o=E.call(o)).push(n),a){var i={depth:s.depth};return H(s,"quoteStyle")&&(i.quoteStyle=s.quoteStyle),e(t,i,r+1,o)}return e(t,s,r+1,o)}if("function"==typeof t){var V=function(e){if(e.name)return e.name;var t=g.call(v.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),G=K(t,_);return"[Function"+(V?": "+V:" (anonymous)")+"]"+(G.length>0?" { "+S.call(G,", ")+" }":"")}if(F(t)){var J=D?x.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):P.call(t);return"object"!=typeof t||D?J:Y(J)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var $="<"+w.call(String(t.nodeName)),ee=t.attributes||[],te=0;te<ee.length;te++)$+=" "+ee[te].name+"="+U(B(ee[te].value),"double",s);return $+=">",t.childNodes&&t.childNodes.length&&($+="..."),$+="</"+w.call(String(t.nodeName))+">"}if(j(t)){if(0===t.length)return"[]";var ne=K(t,_);return M&&!function(e){for(var t=0;t<e.length;t++)if(q(e[t],"\n")>=0)return!1;return!0}(ne)?"["+Q(ne,M)+"]":"[ "+S.call(ne,", ")+" ]"}if(function(e){return!("[object Error]"!==z(e)||k&&"object"==typeof e&&k in e)}(t)){var re=K(t,_);return"cause"in t&&!O.call(t,"cause")?"{ ["+String(t)+"] "+S.call(I.call("[cause]: "+_(t.cause),re),", ")+" }":0===re.length?"["+String(t)+"]":"{ ["+String(t)+"] "+S.call(re,", ")+" }"}if("object"==typeof t&&l){if(N&&"function"==typeof t[N])return t[N]();if("symbol"!==l&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!a||!e||"object"!=typeof e)return!1;try{a.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var oe=[];return i.call(t,(function(e,n){oe.push(_(n,t,!0)+" => "+_(e,t))})),X("Map",a.call(t),oe,M)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{a.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ae=[];return u.call(t,(function(e){ae.push(_(e,t))})),X("Set",c.call(t),ae,M)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{f.call(e,f)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return Z("WeakMap");if(function(e){if(!f||!e||"object"!=typeof e)return!1;try{f.call(e,f);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return Z("WeakSet");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{return h.call(e),!0}catch(e){}return!1}(t))return Z("WeakRef");if(function(e){return!("[object Number]"!==z(e)||k&&"object"==typeof e&&k in e)}(t))return Y(_(Number(t)));if(function(e){if(!e||"object"!=typeof e||!A)return!1;try{return A.call(e),!0}catch(e){}return!1}(t))return Y(_(A.call(t)));if(function(e){return!("[object Boolean]"!==z(e)||k&&"object"==typeof e&&k in e)}(t))return Y(p.call(t));if(function(e){return!("[object String]"!==z(e)||k&&"object"==typeof e&&k in e)}(t))return Y(_(String(t)));if(!function(e){return!("[object Date]"!==z(e)||k&&"object"==typeof e&&k in e)}(t)&&!function(e){return!("[object RegExp]"!==z(e)||k&&"object"==typeof e&&k in e)}(t)){var ie=K(t,_),se=L?L(t)===Object.prototype:t instanceof Object||t.constructor===Object,le=t instanceof Object?"":"null prototype",ce=!se&&k&&Object(t)===t&&k in t?y.call(z(t),8,-1):le?"Object":"",ue=(se||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(ce||le?"["+S.call(I.call([],ce||[],le||[]),": ")+"] ":"");return 0===ie.length?ue+"{}":M?ue+"{"+Q(ie,M)+"}":ue+"{ "+S.call(ie,", ")+" }"}return String(t)};var V=Object.prototype.hasOwnProperty||function(e){return e in this};function H(e,t){return V.call(e,t)}function z(e){return m.call(e)}function q(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function W(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return W(y.call(e,0,t.maxStringLength),t)+r}return U(x.call(x.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,G),"single",t)}function G(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+b.call(t.toString(16))}function Y(e){return"Object("+e+")"}function Z(e){return e+" { ? }"}function X(e,t,n,r){return e+" ("+t+") {"+(r?Q(n,r):S.call(n,", "))+"}"}function Q(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+S.call(e,","+n)+"\n"+t.prev}function K(e,t){var n=j(e),r=[];if(n){r.length=e.length;for(var o=0;o<e.length;o++)r[o]=H(e,o)?t(e[o],e):""}var a,i="function"==typeof M?M(e):[];if(D){a={};for(var s=0;s<i.length;s++)a["$"+i[s]]=i[s]}for(var l in e)H(e,l)&&(n&&String(Number(l))===l&&l<e.length||D&&a["$"+l]instanceof Symbol||(T.call(/[^\w$]/,l)?r.push(t(l,e)+": "+t(e[l],e)):r.push(l+": "+t(e[l],e))));if("function"==typeof M)for(var c=0;c<i.length;c++)O.call(e,i[c])&&r.push("["+t(i[c])+"]: "+t(e[i[c]],e));return r}},5798:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,r="RFC1738",o="RFC3986";e.exports={default:o,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:r,RFC3986:o}},129:(e,t,n)=>{"use strict";var r=n(8261),o=n(5235),a=n(5798);e.exports={formats:a,parse:o,stringify:r}},5235:(e,t,n)=>{"use strict";var r=n(2769),o=Object.prototype.hasOwnProperty,a=Array.isArray,i={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,r){if(e){var a=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(a),c=s?a.slice(0,s.index):a,u=[];if(c){if(!n.plainObjects&&o.call(Object.prototype,c)&&!n.allowPrototypes)return;u.push(c)}for(var d=0;n.depth>0&&null!==(s=i.exec(a))&&d<n.depth;){if(d+=1,!n.plainObjects&&o.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+a.slice(s.index)+"]"),function(e,t,n,r){for(var o=r?t:l(t,n),a=e.length-1;a>=0;--a){var i,s=e[a];if("[]"===s&&n.parseArrays)i=[].concat(o);else{i=n.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=parseInt(c,10);n.parseArrays||""!==c?!isNaN(u)&&s!==c&&String(u)===c&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(i=[])[u]=o:"__proto__"!==c&&(i[c]=o):i={0:o}}o=i}return o}(u,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return i;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?i.charset:e.charset;return{allowDots:void 0===e.allowDots?i.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:i.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:i.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:i.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:i.comma,decoder:"function"==typeof e.decoder?e.decoder:i.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:i.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:i.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:i.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:i.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var n,c={},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,f=u.split(t.delimiter,d),h=-1,p=t.charset;if(t.charsetSentinel)for(n=0;n<f.length;++n)0===f[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[n]?p="utf-8":"utf8=%26%2310003%3B"===f[n]&&(p="iso-8859-1"),h=n,n=f.length);for(n=0;n<f.length;++n)if(n!==h){var m,v,g=f[n],y=g.indexOf("]="),x=-1===y?g.indexOf("="):y+1;-1===x?(m=t.decoder(g,i.decoder,p,"key"),v=t.strictNullHandling?null:""):(m=t.decoder(g.slice(0,x),i.decoder,p,"key"),v=r.maybeMap(l(g.slice(x+1),t),(function(e){return t.decoder(e,i.decoder,p,"value")}))),v&&t.interpretNumericEntities&&"iso-8859-1"===p&&(v=s(v)),g.indexOf("[]=")>-1&&(v=a(v)?[v]:v),o.call(c,m)?c[m]=r.combine(c[m],v):c[m]=v}return c}(e,n):e,d=n.plainObjects?Object.create(null):{},f=Object.keys(u),h=0;h<f.length;++h){var p=f[h],m=c(p,u[p],n,"string"==typeof e);d=r.merge(d,m,n)}return!0===n.allowSparse?d:r.compact(d)}},8261:(e,t,n)=>{"use strict";var r=n(7478),o=n(2769),a=n(5798),i=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=String.prototype.split,u=Array.prototype.push,d=function(e,t){u.apply(e,l(t)?t:[t])},f=Date.prototype.toISOString,h=a.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:h,formatter:a.formatters[h],indices:!1,serializeDate:function(e){return f.call(e)},skipNulls:!1,strictNullHandling:!1},m={},v=function e(t,n,a,i,s,u,f,h,v,g,y,x,b,w,T,I){for(var S,E=t,C=I,A=0,M=!1;void 0!==(C=C.get(m))&&!M;){var P=C.get(t);if(A+=1,void 0!==P){if(P===A)throw new RangeError("Cyclic object value");M=!0}void 0===C.get(m)&&(A=0)}if("function"==typeof h?E=h(n,E):E instanceof Date?E=y(E):"comma"===a&&l(E)&&(E=o.maybeMap(E,(function(e){return e instanceof Date?y(e):e}))),null===E){if(s)return f&&!w?f(n,p.encoder,T,"key",x):n;E=""}if("string"==typeof(S=E)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||o.isBuffer(E)){if(f){var D=w?n:f(n,p.encoder,T,"key",x);if("comma"===a&&w){for(var k=c.call(String(E),","),O="",L=0;L<k.length;++L)O+=(0===L?"":",")+b(f(k[L],p.encoder,T,"value",x));return[b(D)+(i&&l(E)&&1===k.length?"[]":"")+"="+O]}return[b(D)+"="+b(f(E,p.encoder,T,"value",x))]}return[b(n)+"="+b(String(E))]}var R,_=[];if(void 0===E)return _;if("comma"===a&&l(E))R=[{value:E.length>0?E.join(",")||null:void 0}];else if(l(h))R=h;else{var N=Object.keys(E);R=v?N.sort(v):N}for(var U=i&&l(E)&&1===E.length?n+"[]":n,B=0;B<R.length;++B){var j=R[B],F="object"==typeof j&&void 0!==j.value?j.value:E[j];if(!u||null!==F){var V=l(E)?"function"==typeof a?a(U,j):U:U+(g?"."+j:"["+j+"]");I.set(t,A);var H=r();H.set(m,I),d(_,e(F,V,a,i,s,u,f,h,v,g,y,x,b,w,T,H))}}return _};e.exports=function(e,t){var n,o=e,c=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=a.default;if(void 0!==e.format){if(!i.call(a.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=a.formatters[n],o=p.filter;return("function"==typeof e.filter||l(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:o,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof c.filter?o=(0,c.filter)("",o):l(c.filter)&&(n=c.filter);var u,f=[];if("object"!=typeof o||null===o)return"";u=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var h=s[u];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===h&&t&&t.commaRoundTrip;n||(n=Object.keys(o)),c.sort&&n.sort(c.sort);for(var g=r(),y=0;y<n.length;++y){var x=n[y];c.skipNulls&&null===o[x]||d(f,v(o[x],x,h,m,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,g))}var b=f.join(c.delimiter),w=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),b.length>0?w+b:""}},2769:(e,t,n)=>{"use strict";var r=n(5798),o=Object.prototype.hasOwnProperty,a=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],i=o.obj[o.prop],s=Object.keys(i),l=0;l<s.length;++l){var c=s[l],u=i[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:i,prop:c}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(a(n)){for(var r=[],o=0;o<n.length;++o)void 0!==n[o]&&r.push(n[o]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n,o,a){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<s.length;++c){var u=s.charCodeAt(c);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||a===r.RFC1738&&(40===u||41===u)?l+=s.charAt(c):u<128?l+=i[u]:u<2048?l+=i[192|u>>6]+i[128|63&u]:u<55296||u>=57344?l+=i[224|u>>12]+i[128|u>>6&63]+i[128|63&u]:(c+=1,u=65536+((1023&u)<<10|1023&s.charCodeAt(c)),l+=i[240|u>>18]+i[128|u>>12&63]+i[128|u>>6&63]+i[128|63&u])}return l},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(a(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(a(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!o.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var i=t;return a(t)&&!a(n)&&(i=s(t,r)),a(t)&&a(n)?(n.forEach((function(n,a){if(o.call(t,a)){var i=t[a];i&&"object"==typeof i&&n&&"object"==typeof n?t[a]=e(i,n,r):t.push(n)}else t[a]=n})),t):Object.keys(n).reduce((function(t,a){var i=n[a];return o.call(t,a)?t[a]=e(t[a],i,r):t[a]=i,t}),i)}}},7478:(e,t,n)=>{"use strict";var r=n(210),o=n(1924),a=n(631),i=r("%TypeError%"),s=r("%WeakMap%",!0),l=r("%Map%",!0),c=o("WeakMap.prototype.get",!0),u=o("WeakMap.prototype.set",!0),d=o("WeakMap.prototype.has",!0),f=o("Map.prototype.get",!0),h=o("Map.prototype.set",!0),p=o("Map.prototype.has",!0),m=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new i("Side channel does not contain "+a(e))},get:function(r){if(s&&r&&("object"==typeof r||"function"==typeof r)){if(e)return c(e,r)}else if(l){if(t)return f(t,r)}else if(n)return function(e,t){var n=m(e,t);return n&&n.value}(n,r)},has:function(r){if(s&&r&&("object"==typeof r||"function"==typeof r)){if(e)return d(e,r)}else if(l){if(t)return p(t,r)}else if(n)return function(e,t){return!!m(e,t)}(n,r);return!1},set:function(r,o){s&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new s),u(e,r,o)):l?(t||(t=new l),h(t,r,o)):(n||(n={key:{},next:null}),function(e,t,n){var r=m(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,o))}};return r}},1063:e=>{var t;self,t=()=>(()=>{"use strict";var e={362:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=(...e)=>{const t=[],n=e.length;for(let o=0;o<n;o++){const a=e[o];"Array"===(0,r.dataType)(a)&&a.forEach(((e,r)=>{t[o+r*n]=e}))}return t.filter((e=>null!=e))}},114:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.arraysLaminated=void 0;var o=n(362);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return r(o).default}})},537:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t=!1)=>{try{if(TextDecoder){const t=new TextDecoder("utf-8");return JSON.parse(t.decode(new Uint8Array(e)))}const t=new Uint8Array(e),n=String.fromCharCode.apply(null,t);return JSON.parse(n)}catch(e){return void(t&&console.log(e))}}},415:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isDICM=t.arrayBufferToJson=void 0;var o=n(537);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return r(o).default}});var a=n(754);Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return r(a).default}})},754:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{if(!e||!e.byteLength||e.byteLength<=132)return!1;let t="";const n=new Uint8Array(e,128,4);for(let e=0;e<n.length;e++)t+=String.fromCharCode(n[e]);return"DICM"===t}},80:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.store=new Map}get(e,...t){const n=JSON.stringify(t);if(!this.store.has(e)){const r=e(...t),o=new Map;return o.set(n,r),this.store.set(e,o),r}const r=this.store.get(e);if(!(null==r?void 0:r.has(n))){const o=e(...t);return null==r||r.set(n,o),o}return r.get(n)}}},983:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,n=1){this.db=void 0,this.dbName=e,this.storeName=t,this.version=n}open(){return new Promise(((e,t)=>{const n=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB;if(!n){const e=new Error("IndexedDB is not supported");return console.warn(e),t(e)}const r=n.open(this.dbName,this.version);r.onsuccess=t=>{var n;this.db=null===(n=t.target)||void 0===n?void 0:n.result,e(t)},r.onerror=function(e){t(e),console.log("数据库打开失败...")},r.onupgradeneeded=e=>{var t;const n=this.storeName,r=null===(t=e.target)||void 0===t?void 0:t.result;r.objectStoreNames.contains(n)||r.createObjectStore(n)}}))}dispatch(e,t={},...n){const{mode:r="readwrite",more:o=!1}=t;return new Promise(((t,a)=>{const i=this.getObjectStore(r),s=i[e];if(!(e in i))return a(`${e} is undefined, reference resources:https://developer.mozilla.org/zh-CN/docs/Web/API/IDBObjectStore`);if("function"==typeof s){const r=i[e](...n);r.onsuccess=e=>{var n;const a=null===(n=e.target)||void 0===n?void 0:n.result;t(o?{res:r,event:e,result:a,objectStore:i,bd:this.db}:a)},r.onerror=a}else t(s)}))}getObjectStore(e="readwrite"){if(!this.db)throw new Error("No database connection available , please use IndexedDB=>open to connect");return this.db.transaction([this.storeName],e).objectStore(this.storeName)}}},497:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.func=e,this.result}run(...e){return void 0!==this.result||(this.result=this.func(...e)),this.result}}},137:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.taskId=0,this.count=0,this.arr=[],this.limit=0,this.pendingTask=[],this.func=()=>({}),this.finishSResolve=()=>({})}init(e){const{arr:t=[],func:n,limit:r=6}=e||{};return t.length&&n?(this.arr.length&&this.pendingTask.push({arr:[...this.arr],func:this.func,limit:this.limit}),this.count=0,this.arr=[...t],this.limit=Math.min(r,t.length),this.func=n,this.loop(this.taskId),new Promise((e=>{this.finishSResolve=e}))):Promise.reject("arr and func is required")}loop(e){return n(this,void 0,void 0,(function*(){if(e===this.taskId)if(0!==this.arr.length)this.count+=1,this.count<this.limit&&this.loop(this.taskId),yield this.func(this.arr.shift()),e===this.taskId&&(this.count>=this.limit&&this.loop(this.taskId),this.count-=1);else if(this.count<=0){this.finishSResolve("finish");const{arr:e,func:t,limit:n}=this.pendingTask.shift()||{};(null==e?void 0:e.length)&&t&&(this.taskId+=1,this.init({arr:e,func:t,limit:n}))}else setTimeout((()=>this.loop(this.taskId)),100)}))}cancel(){return this.taskId+=1,this.arr.length=0,this.pendingTask.length=0,Promise.resolve("cancel")}}},182:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=e||{},{tagName:r="div"}=t,o=n(t,["tagName"]),a=document.createElement(r);for(const[e,t]of Object.entries(o))a[e]=t;return a}},368:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t=0)=>{let n;return(...r)=>{n&&clearTimeout(n),n=setTimeout((()=>{e(...r)}),t)}}},456:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createElement=t.throttle=t.debounce=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=void 0;var o=n(137);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return r(o).default}});var a=n(80);Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return r(a).default}});var i=n(497);Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return r(i).default}});var s=n(983);Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return r(s).default}});var l=n(935);Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return r(l).default}});var c=n(378);Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return r(c).default}});var u=n(368);Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return r(u).default}});var d=n(539);Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return r(d).default}});var f=n(182);Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return r(f).default}})},935:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=function e(t,n){if("Object"!==(0,r.dataType)(t))return"";const o=Object.keys(t);return o.reduce(((a,i,s)=>{const l=t[i];return 0!==s||n||(a+="?"),"Object"===(0,r.dataType)(l)?a+=e(l,n?`${n}[${i}]`:i):a+=n?`${n}[${i}]=${l}`:`${i}=${l}`,s!==o.length-1&&(a+="&"),a}),"")}},378:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e=e||location.search;const t={};if("function"==typeof URLSearchParams){const n=new URLSearchParams(e);for(const[e,r]of n)t[e]=r}else{const n=e.replace("?","").split("&");for(const e of n){const[n,r]=e.split("=");t[n]=r}}return t}},539:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t=0)=>{let n=!0;return(...r)=>{n&&(n=!1,e(...r),setTimeout((()=>{n=!0}),t))}}},337:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=void 0;const r=(e,t="image/png")=>{const n=document.createElement("canvas"),r=n.getContext("2d");return n.height=e.height,n.width=e.width,null==r||r.putImageData(e,0,0),n.toDataURL(t)};t.ImageDataToDataURL=r;const o=(e,t)=>new Promise(((n,o)=>{const a=r(e,t),i=new Image;i.src=a,i.onload=()=>{n(i)},i.onerror=e=>{o(e)}}));t.ImageDataToImage=o;const a=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const n=r(e,t),o=yield fetch(n);return Promise.resolve(o.arrayBuffer())}catch(e){return Promise.reject(e)}}));t.ImageDataToArraybuffer=a,t.default={ImageDataToDataURL:r,ImageDataToImage:o,ImageDataToArraybuffer:a}},37:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=(e,t,n={})=>{const{interceptors:o,crossOrigin:a="Anonymous",zoom:i=1,debug:s=!1}=n;return new Promise(((n,l)=>{try{const c=null==e?void 0:e.getContext("2d"),u=e.width,d=e.height;let f=1;const h=new Image;h.crossOrigin=a,h.src=t,h.onload=()=>{let e=h.width,t=h.height;f=u/d>e/t?d/t:u/e,e=e*f*i,t=t*f*i,s&&console.log({cW:u,cH:d,scale:f,zoom:i,originIW:h.width,originIH:h.height,iW:e,iH:t});const[a,p,m,v]=[(u-e)/2,(d-t)/2,e,t];if("function"!=typeof o)null==c||c.drawImage(h,a,p,m,v),n("success");else{const e=o();if("Promise"!==(0,r.dataType)(e))throw l(new Error("interceptors must be Promise"));e.then((e=>{e?(null==c||c.drawImage(h,a,p,m,v),n("success")):l("cancel")}),(()=>{l("cancel")}))}},h.onerror=e=>{l(e)}}catch(e){l(e)}}))}},176:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=void 0;var o=n(37);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return r(o).default}});var a=n(337);Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return a.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return a.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return a.ImageDataToArraybuffer}})},814:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,n={})=>{var r;if(t&&(t=`script${t}`,document.querySelector(`#${t}`)))return;const o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),t&&o.setAttribute("id",t);for(const[e,t]of Object.entries(n))o.setAttribute(e,t);null===(r=document.querySelector("head"))||void 0===r||r.appendChild(o)}},826:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.importScript=void 0;var o=n(814);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return r(o).default}})},607:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=t.httpRequest=t.importScript=t.isDICM=t.arrayBufferToJson=t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=t.dataType=t.env=t.isCanvasBlank=t.isNull=t.createElement=t.throttle=t.debounce=t.arraysLaminated=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=t.version=void 0;const r=n(456);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return r.PromiseQueue}}),Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return r.ComputeStore}}),Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return r.Once}}),Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return r.IndexedDB}}),Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return r.objectToQuery}}),Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return r.queryToObject}}),Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return r.debounce}}),Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return r.throttle}}),Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return r.createElement}});const o=n(114);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return o.arraysLaminated}});const a=n(693);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return a.isNull}}),Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return a.isCanvasBlank}}),Object.defineProperty(t,"env",{enumerable:!0,get:function(){return a.env}}),Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return a.dataType}});const i=n(176);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return i.canvasDrawImage}}),Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return i.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return i.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return i.ImageDataToArraybuffer}});const s=n(415);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return s.arrayBufferToJson}}),Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return s.isDICM}});const l=n(826);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return l.importScript}});const c=n(855);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return c.httpRequest}});const u=n(895);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return u.copyText}});const d=n(147);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return d.version}}),t.default={version:d.version,PromiseQueue:r.PromiseQueue,ComputeStore:r.ComputeStore,Once:r.Once,IndexedDB:r.IndexedDB,objectToQuery:r.objectToQuery,queryToObject:r.queryToObject,arraysLaminated:o.arraysLaminated,debounce:r.debounce,throttle:r.throttle,createElement:r.createElement,isNull:a.isNull,isCanvasBlank:a.isCanvasBlank,env:a.env,dataType:a.dataType,canvasDrawImage:i.canvasDrawImage,ImageDataToDataURL:i.ImageDataToDataURL,ImageDataToImage:i.ImageDataToImage,ImageDataToArraybuffer:i.ImageDataToArraybuffer,arrayBufferToJson:s.arrayBufferToJson,isDICM:s.isDICM,importScript:l.importScript,httpRequest:c.httpRequest,copyText:u.copyText}},363:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t={},r)=>new Promise(((o,a)=>{const i=new XMLHttpRequest;"function"==typeof r&&r(i),i.onreadystatechange=()=>{const{status:e,readyState:t}=i;if(0!==t&&1!==t)return 200!==e?a(i):4===t?o(i):void 0},i.onerror=()=>{a(i)};const{method:s="GET",async:l=!0,username:c,password:u,send:d,open:f}=t,h=n(t,["method","async","username","password","send","open"]);f&&console.log(new Error("don't config open ,please configure async、username、password")),i.open(s,e,l,c,u);for(const[e,t]of Object.entries(h)){if(!(e in i))return a(`${e} is undefined, reference resources: https://www.w3school.com.cn/xmldom/dom_http.asp`);if("function"==typeof i[e]){const{args:n}=t;n&&n.constructor===Array?i[e](...t):i[e](t)}else i[e]=t}i.send(d)}))},855:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.httpRequest=void 0;var o=n(363);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return r(o).default}})},185:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const n=typeof e,{lowercase:r=!1}=t||{};if("object"===n){const t=Object.prototype.toString.call(e).slice(8,-1);return r?t.toLowerCase():t}return n}},865:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const{userAgent:n,platform:r}=navigator;return e=e||n,{isWin:(t=t||r).includes("Win"),isMac:t.includes("Mac"),isLinux:!!t.match(/Linux|X11/i),isIpad:!!e.match(/iPad/i),isMobile:!!e.match(/mobile|phone/i),isAndroid:!!e.match(/android/i),IsIphone:!!e.match(/iphone/i),isWM:!!e.match(/windows mobile/i),isWeChat:!!e.match(/MicroMessenger/i)}}},693:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dataType=t.env=t.isCanvasBlank=t.isNull=void 0;var o=n(123);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return r(o).default}});var a=n(41);Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return r(a).default}});var i=n(865);Object.defineProperty(t,"env",{enumerable:!0,get:function(){return r(i).default}});var s=n(185);Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return r(s).default}})},41:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()}},123:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>[void 0,'""','" "',"null","[]","{}"].includes(JSON.stringify(e))},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>new Promise(((t,n)=>{const r=navigator.clipboard;if(!r){if(document.execCommand){const r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",e),r.select();try{return document.execCommand("Copy"),r.remove(),t("success")}catch(e){return r.remove(),n(e)}}return n("该浏览器不支持自动复制")}r.writeText(e).then((()=>{t("success")}),(e=>{n(e)}))}))},895:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=void 0;var o=n(874);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return r(o).default}})},147:e=>{e.exports=JSON.parse('{"name":"simple2k13","version":"0.0.13","description":"some simple functions","main":"dist/simple.min.js","types":"dist/index.d.ts","scripts":{"test":"jest","test:watch":"jest --watch","test:staged":"jest --bail --findRelatedTests","start":"webpack --env development --node-env development","build":"webpack --env production --node-env production --progress && tsc","prepare":"is-ci || husky install","lint":"eslint ./src --ext .js,.tsx,.ts","lint:fix":"eslint ./src --ext .js,.tsx,.ts --fix","lint:staged":"lint-staged","publish:patch":"npm run lint:staged && npm version patch && npm run build && npm publish","publish:prerelease":"npm run lint:staged && npm version prerelease && npm run build && npm publish"},"lint-staged":{"src/**/*.{js,ts,tsx}":["eslint","jest --bail --findRelatedTests"]},"repository":{"type":"git","url":"https://github.com/npm-for-cw/simple2k13"},"keywords":["functions","simple","simple2k13","js","cw"],"author":"cw<cw2k13as@gmail.com>","license":"LGPL-3.0","homepage":"https://github.com/npm-for-cw/simple2k13","devDependencies":{"@babel/core":"^7.18.10","@babel/preset-env":"^7.18.10","@babel/preset-typescript":"^7.18.6","@commitlint/cli":"^17.1.1","@commitlint/config-conventional":"^17.1.0","@types/jest":"^28.1.6","@types/node":"^18.7.2","@types/webpack":"^5.28.0","@typescript-eslint/eslint-plugin":"^5.37.0","@typescript-eslint/parser":"^5.36.2","babel-jest":"^28.1.3","eslint":"^8.0.1","eslint-plugin-import":"^2.25.2","eslint-plugin-n":"^15.0.0","eslint-plugin-promise":"^6.0.0","fake-indexeddb":"^4.0.0","husky":"^8.0.0","is-ci":"^3.0.1","jest":"^28.1.3","jest-canvas-mock":"^2.4.0","jest-environment-jsdom":"^28.1.3","jest-fetch-mock":"^3.0.3","lint-staged":"^13.0.3","pinst":"^3.0.0","text-encoding":"^0.7.0","ts-jest":"^28.0.7","ts-loader":"^9.3.1","ts-node":"^10.9.1","tslint":"^6.1.3","typescript":"^4.7.4","webpack":"^5.74.0","webpack-cli":"^4.10.0"},"dependencies":{}}')}},t={};return function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}(607)})(),e.exports=t()},436:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAV1BMVEX2AgD2EAD4eAD3QgD4bgD2HgD3TgD3ZQD3VgD2FgD2NwD3XAD2JwD2LgD99hf6owP6mQT4iAD5hAD7uwv6rQb5jwH81w/85hT83xL8zw/7xgv+/hv97BZTj7ayAAAB6klEQVQ4y9VRCY4cIRAD6qSAvnvn/P87456NEq3yglh9CGwZl0n/GXLOVbqI9DEk53/4Wms4RY/moY26/JRkqbmO3gqTrSbaIv9Q5BBi07atPdWy2rYWkvijECHyc12XeS5Y6jyf67m5yGXSc8Z5xOu6rctxXIJ2zOtWCmsVzWnkoUJwsG3blvkUGXxuYEePyBSpZu1BmLBzKWUrhu9ZfGCn5lQd8SmrY0ptqlzMCsCCkeqVMZAQHvEx8LCyLcdSOETcCRboC+MiaLRmFtHKPr2mrwJSVfG9Cvz0gRJQ4Ij2nm7vaY8QUtRZUYV08MMUa7iU6cJOCp7IRSO5okc1cOdzt+V1f35NN2M2CEgQfy8JLtSO+35f9vvbzObXfT+Px4xZSdO0wQHgx9fX8ZwmJt9ft+eOlfQ8It0MITFM9WVelvlxOx7vHbfyLIFb6JTmSEClUG+N1I9pWpprKd54ZImk/TIINncya9oesyEjOyrVnCWRpDyqlut6HAnpNKB5Q+OURVJ0ESIIjISaOjGpsw9i1h4owcxV3dlGHd4uKQVWgq5JcUyCE06EdUVmgDR6xBjaEAVkYi74IyP1WuUDSHOND/3tAB5wufYrWLwAEjGQwF58wzSY9y8ShH0QJQbMQz6b36X+fr71vwDwJBeEP0nA0AAAAABJRU5ErkJggg=="},4842:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABEVBMVEX3+//i7fja6fbo8vrU5fTl7/nv9v19tdne6/fO4vKky+TB2u2gyOOBt9rG3e+u0OfX5/WnzOWSwd+Ku9yPvt55sti92OyrzeaYw+Dr8/u41eq21Om71uubxuJrqNSz0+mx0eiGudsUNnJnpdHy+P7K4PCdxeGEuNvD3O6+2ex0r9ZjotBJjcWVwt8oVpIlS4WZv91WlslghK5Teqo3ZJsfQnsVO3gRMGuiw9+dvNhyrdV5rdRcnM2DqMtjjLhJcKE0XZMWP39wptF+rdCPrMt2nsRplcBAhL9Pib1nk7xcj7xGgrhQhLVAeLA4cqxAbKFHZ5g2Wo4aR4ksUIeHsdWWttRlnMg6fLtYiLc2bKcxaqcwQHXtAAACnElEQVQ4y9WRVY5cMRBFTc/c9mOmZu4enuDMhJk5+19I3FF+oqwgV7LLch3XLbnAfyZKC44IQj4RU7+g/+QhQkpWhqhGKzsrif83Qn2E0FQ0q2EfjWORzRQk+E/hCQATqvxsGPd5OxYAPhzH7fhOTxbYZQAuigL5ZZmvx+vjzeaue3Nrs1mv1612DXkFIB6sBKmj8bodHz/79tABR8824zZJBhIhy4HxlCRp2eu4bdvjzT0fLQb32mRuzXSpvL4ECEqRWgz5NEqSVXsnThJ2L9ELiDkvKNLA81OYNQXmQRNk8zthuFolyVx4yCCPUloC7DoJFEQiYlptWfvy9OWjKCVEByXisOCAI4gFXDTNNlcLzd6NLkef7ssO2c7qklMKuO8q4S4KtTRTc/v84uOD0XulUNpXuuMKA58UlJrYWjub5fn90cUDB9RZ2lWqln6WAmkphV0+2z76evYmPrncn30Y7b9En4+yOq1IIMGbu5MJJ8vZ693b/dW7/fnt/Ojk8tP101dnrwPhVRaMntAJxth7fLPbvfp5MXqcBteXH3+83e1OfYLFApzfpoBiWvBbV8+Pr05u9qcfzq+fvHh+dr8WHIslOFEOoLBUNsubtAtORxcvtLQDJnVsMFEgE86iUFEsgzQPdXbr5nsYxoNYxiwJOPRBTTCeooCxKJvKcJvXT4/CMJxJzVZJx30CjCBumJKxPCWVtoGaV72OpOiGkRVGZyDMgz7I5DA23OimrrO7lZHzkCBb1TZmDDA2GAzjcFtzCIkgogqMMEsj+iYPh8kqAQMnx4SyEuggHyHuWLQMGUvYocLA7QdEEg/C30m3nEjZRMP58GDhPKKm8w//6TnoIO9wQsSkJYjmUZQHS8Kx565x4cJvErpwwH4BGi5IMMkKl1sAAAAASUVORK5CYII="},3701:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABBVBMVEUAAAAZGSQdHSkVFR4SERkjIzFmboZka4NOUGs9PVVSVnAHBgtJSmZgZX8oKDhpcohCQ1sPDhVueI1ZXXhWWnMzNUcuL0ErKzwLCxF2gpU7O1L2+fpdYnxbYHpPVGkgIC5KTWM3OEsyMkR6h5lsdYtAQlcEBAZMT2hESFw4OE+Rmaecoq+Qo62Cj59dZHZaXXFERV/+/v7v9PXa4OPP19zKz9XBydCdr7iImaZ8i5tHSWE9QFHq7/Di6Oq2xsu7vcSlrLaVprFye49ydYro6+7g4+bT29+2vsauvMSzt8GftLuqsbqMkZ9+hZNgaXtqbXrX2d+Zm6VygItvfYZpdoFSXGVJUlt63FDBAAACl0lEQVQ4y9WRRZIcMRBFJZVUwlIxczVzD4+HwTxkvv9RXD0bh8Mn8F+kIuM9ZS4S/GeRMjEQqRHRcYwS+Q+HEM3YKNStqGZnAdfob0UiBFGkhfd8vk7XeipCSJJXksjxjodk+rx2RDogAH8bFOnAc0jnAjAGbuJKVPPz6s3gzent8kdv/1ou+yatEIHYBRob5zHhVjpIB6cnn7/3ws+T5SD1PNogNIUgMrqGZOejapOm6elyhWBMV6lHnSgOQzxqAYKNbqfYQLE1HHrpXWkP7dWQdRAj5CaoArjO4LRKMGrEpKF3pe953pBqA0U1llK2wCUIN+FugFnNfDOd38zvrYwQxjiCRgIBrA1XG50QfhCGwv6Q7+Vf7pkDp1vFOJQSoNpIpDuySsHCKNy8zS8v8utwVmfKYSMYuoDoRCZRcaZU0Oc+37/Yz6+5yrbbjLNataCaSgmdQPje6vhh/XXv4Pgwf7e26Kbh3CGKgY/eeAxJJk7eXx3MPxy83fj+Yu/g0+rkeKFiPFIgf5Jj13Xxy9Hh4eer/fyFV9d7l1cf3x/eIO1GM3C5kWCMZQKr+e3pfHH07uHo4tPT4+3xXRZDrDOwaMdAjg0+U5Mg4NvJTb4/F0yZNhNFh8kMqFj2F+1owRj3S6HE0aIoLNNihT1sICSAE9eN4JlpWipipe/zx6AsC8GE7Q0dSAgINSEZn9h2kBFHqElGR46wWOxQ6yzumAJ+MHGUYrSIYMQCzpU36hj1Ndo6XBWmCWzTNKlV+hz2CzWJeRPqro0iRwQlHXoeMKm5U0rmxKgPqWvUqwZqfdPuP9tgV2zaKxOCIdzBHTegQbiwKKW9QE1KLeEQjLGxy45jo2+QjjIOLGpZvmoJfKU46Z/e/FN/A92MRrSJbLGPAAAAAElFTkSuQmCC"},2778:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAA9lBMVEVP//9M4/97h/5kqP92jP5M5/9M7P9N3P9no/9qnv9O/f9Q1v9Q0f9cuv9wlv9O2f9btv9M8f9esf9N4P9TzP9VyP/vBPxZvP9yk/5N9f9+hP6Jdf5ZwP+Bf/5opf5N+P9tmf+gWv5U2/9zkP5+gv5Q3P9Ww/9gtf9Q5P+tS/5lrf9rm/5zmP6Gef6aY/7dGf3kDvxR8f9U0P9cxP9frf9hq/9un/6FgP6lVP6+PP1U6P9jsf94kv58iv6Ncv6OcP6Sa/6oWf24P/3CNf3NK/3RI/3WH/z3APxgvf6XZ/6zSv3HLv1bzP6MfP5e1f52qv56oP6Ljf7KZtzfAAACoElEQVQ4y9WPh47dIBREwWDAz4B7736997a9b3r5/58Jm40UKX+QkS7o6gwzAvxf6lTJ+qI1277J/S/tuur8y0eURswd8PxQ5rvpcNMmf8C7M2lpvx/4h+JqeJXJzcTIobn+jZxEWTrV1rq8ku5hnn3rXHy9iedZcWkG645ixCFOawlxuLm5+XhqjurN96a5zW7nZd/0LgjgOhS+aXczpcV4/FXF/Tg12bzX01C/nXgggFtkCjEsZ9k8WzR37ejL9V1WYDfw81wffgAWRJv8kkDq415azAuZpuldrxxAQilx+iXQrQhOSodQZKAJLqQsil56vYH9wNKryvkACLd0tB1ZPtbKXGpZM256seBmiUTfg84IQAuSzWhrGPU0z430HL6GL0fm0ksXMUGTBFALOokzxNJgg2AwW4WrVXjOI0vsXDb0Bmtgccdxgni3R4ZKOYZvehRIuG5klyaKQDlJkpFbG7K4e/w0u39dfn4Ol1fd6xkSts0RAw/HqqI8OoxfzsvFebma1fL+9eXh4/jzCfm6vQPhbdIhhFz8fHp+Hj+G4bVdnl9Xjw8vz59aTvwcLGdJpyKJ4xlNs2jun5afnlYPt4vT5+MHnxIuwH1UdZxqJKI9mk7Fjo3DcGGwvZYyIw50HgHEVYWzxTFjopYMGU+nOO6qNdZ6yIMWsE1CfDrRtC4KWCxr+2MtZWwwIy16Q880wcA3ubCRltbCtI09irDtsi7zXYz3/oAhIKfIRYjhOKABm9o2KuwAYckt17VRrGlAU8JdKW0KPc65b6OcD6IgcI06xqoGaPi3RTLXp9SyTMuingchjaSmpYqA9P3GGJk69KingtQomcLoYozfK3DXGKrf6PCvdB1aPIhsgBWtUWR6+hsmjq4Y0dWi5u38BZRBTiq+AwTyAAAAAElFTkSuQmCC"},5263:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACVVBMVEU/S7/W3OfU2uhVa9pfeORngeleduKctvvK1u5cc+BZcN/G1fPa2+C0yfpyjO3R2uu5zPVjfOarxPxOYdJLXM6wx/qguvqetvd/mvPD0fF4kvGKnutIVsaWsvytw/m8z/eku/eTrPaasfS+zvO6yfBvi+5sh+xpf+PY1dzi1tJEUsWzDSemwP2Ur/e1yfayxfWtvvGouvGEnvF/l+2otupwiepqhOqksuluhuhjeuJSZtfm1s1JWcuyID25HTC2y/qMqPnB0vWCnfV6lvKXrPDG0+90j++ywO17lO2NouzFz+qsuerO1+l9lOlqguZlfuaFleJZbttiddlMXtBRX8ro1MjuwKmuAR+vw/WLpvWgtfKSqfKIofLN2O6Qpe6Dmuu4w+p5kOqVpud0ieSyu+Ntg+PQ0eKxt9+ys97Nyt1ofNxfdNzIxttqfdvf2dhVaNXYz9RqedTk1M1TXsWymsPrxrXBlam3W3e6RV3NVVe1ESiowPeGove+yeydr+qKnOXU1eKRn+HEx+C+wuCboNvCwdpvgdrU0NnFudPk2NGhl89hbc3i0czqz8HKrrebhbTNnqnxvaS+iKGye5/Kjpq5fZrxspfZl5PPhozaioLbf3TBXm+mO2XGSFG+OEi5MUbGPUK/JzKcq+jKz+SfquKpq95/idOYkNDczc64q86/ts2eisRsbsLAqb/Wtrrfvri2k7bhubGugabhrqTbpqGMWpbnp5SxbJHxqo2/dIutYYeiVoTHcH2nUHviiHixTnDNaW6/VWnFWWLFUFytN1uzME3DMjdGkMgXAAADLElEQVQ4y9WQ05IkYRBG/6rqUpfbtm3MdPfYxs6szbG1tm3bto3n2pq929gn2C8vMjLPiciIBP9ZDLnO/cO7VjUna+Otw52Gf3i7O2Vl1PMq6pbWBNeb1bW7/lYMq1Lu5ljtSs/OHfdGdi5LL9VnV3T+IfIO3yzfnLnRt33+Gu/IAzB66MC2A8VDm5KtowD4AFKE5PpdlZVr5hTPGT969JBoH+7qEgdvjXtF+yACKkhseROLbxsp3rt3/NSbiVnhVFfxgMezuqGnP50FG7DWBBusvNaw3TvgHe96PLz/Vt9BL91oicX1eunyrSCFJZrq0ogEbbpO07R3qH63Z8tBT40+24aigx09KwGZXJBNr5QjaJSPRFcPaLU07dm9bgXmXpKR5gyKrQDRuXojejITJ+Aaq3bLnSNnjuypX1CdDDM2dwsmbweCU4Is69U7zGX2xQv5dR/83f6fY2F1TzQgC9maFQqAOkm5omhTI2UumRcrvZ0vXPnlvxAPZmyyAD8/W9cJWF1Rh3xJvUymNDscG8dmClevzlxYbDIGAkY8vMq0HESicgWmKjNv3PPo/Jm177svf53y5/fV312bsOGqamUJOPvQ52vWGdecvvjp0snzl/I3HUtfd1+enDj97URE06aSgZlnOZ/47tGX36enX50r+O/j6c/dV86dvTg92V87WG4E+X0KkEMU8vYdx188PXZyKv/xR2HyybHnX8Zam1qQuBG8qzOADl+vzSqb67Djgchbf2EixMhWr2N4Qi9dZgVRjQIg8s0cUcLgZVSJsmHqRBVFwARDQHQDKrAAZxFE405AMGHawFBUGX58LUVRfIiHaHp+i7MalGpYXRCfC0H2YLXKLFMa+9QWfhFTbmkk1mvmhUxAa1dalEqGq4qhS0J2XGUaUpcyjVpdxqLCTVUwBCAIgjmConBUQHUVFeXqRKlm4eJYuYW3V3HiGQDDkFgwFVZpXC6Xk3U6XWiLIEkt0MKQGBiIWGwwzIWTUkFIoaggoKhEDFvpIDiOAyKdvcGrWUQqJTFM8icYJiUlqG6h1QYWcYsI7VwrK0hJcY8UiVIbgrSJTfRJjPwNFme7zxtIt3oAAAAASUVORK5CYII="},8495:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAwFBMVEUAAAAcEQkqGQ+QXTgTCwYhFAxoQiiJVzVWNiF/UjE6JRYKBgJ3TC5ySSwwHhJsRSqNWzdFKxo0IRMmFw6VYDtjPiZRMx9JLxxbOiNvRitePCT4wHmhaEB6UDCma0I/KBiEVTROMR6ZYjyCUzP7xn3osG+pbkTnqWvKhlTDfk7bpGeqd0q4d0nuuHT3t3PUn2TYmF/ElF7EjVi6iFa7gFCwgE+wekywcUbem2HNll3WklvUiVXBhFKjdkqaa0LdqmwjTj//AAACZElEQVQ4y9WNZ3LbMBBG0RtRBBAk2CmqWJJ7d5qd+98qsJ0fyeQEeYMZLPZ7iwX/GUVBILII2TArRIp/clqixTVJJdMulRYK/a0UKDMrs1kLOUlVmUQD+Ug+/yq87bhszDBZADfTdpg2jfXkQyAkT9fCnE1nl8cTzq3qdMqPoUWhJAQoCGtlxXqahuny+/eYhfZ4moYYV6xEHQUeemZr0bhxGIbL0wsqFX8ZIu+8SgmKBSDKVOogRTPHcTNsJMb4JTpPIUKEIAegrWnVElIywyq+kTJuYuQBohnBoihqQAKCzEOkOHbLiIfnH894WwfrnEAlJRRQBImCXutRp2Tw137X/1y5ruw61gpUFABZSArScGlcmpO56q+vd3dpQXXVmab0BNhACPGyYkwbrVd9ZncnWM5r4RBLwFWkoJ02Yzy7PcrX3f7mvN+Pa66ZEE1gLfgW85pQm/vD7f7i6/5Ka/m029+fHc8fmYJNBXZvBSCZ8fxwOH7peync3e769tvh8IAUUQnsdQEKWBDqLh4vn5/O9w83V/dvFz++xFqVUNXgackCoKKumNaicg99f2FchbEzWw/DAph6X5G4bJ3QsmXm5nEr16t1K3FkJbVABEJmlCfWzLdSjuJVy+1WtwZvYlPaAJKyoRYMY12HxjBW86YzvJ0bzqvZtwyMmnWMtVz6cm61ECw23vExoKoR1RZjgFerFd9KKRAtgwpKsKR88nNntOQ4xixgnCXpGoUy1lqESkrRMuYg81vIOAtzv8xhWeYKWqHXnHPwnnK+No2FH9B3PisUfC0Az+nIFpub+RDyfv3JL+wXNhoUBI2IAAAAAElFTkSuQmCC"},5990:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAnFBMVEUAAAAXFxd0dHQdHR0jIyMQEBBWVlZoaGhfX18JCQkwMDApKSlubm5bW1tJSUlGRkY5OTlRUVF4eHhkZGR7e3s9PT1BQUF+fn5NTU01NTWFhYX4+PiMjIyIiIitra2jo6NDQ0O+vr7y8vKdnZ3Pz8+SkpL+/v7s7OzV1dWmpqaZmZnn5+fi4uLf39/a2trExMS5ubmxsbGXl5fJycmVOdM0AAACQklEQVQ4y9VRR5IbMQxkBHOanEc5bV7//2+mtPLB5Re4D0CRaDaAJvrPoJTC7A6tNePqnzqmrAYfdS1dk6TX7G+KYpSyXsvWBjELnWSkhj+FHzEyb0Unh9kg3s5imFvP4oPBOVeMbYKc5un7uhb5Kq37aZoGyQzlHGmMN9oEO0/DfFu+2kxwyzoNVUWA0o6iHkcwm+BdOQzDbT0yqslxqGzX67rmvkYMg647jqm2RdEOrSiq4li5iDmlXFGHMGtocoqzJCGRVoiqzeoGs57hPHyDuMkaETNtCdQlmffLvrKNMQ4CpVhhRBnmGkcpy7KuZbEdT+N7BZ52CVygSt0JSvFsgnSxr8vz+HIet7Fhm9Q5T7MVxnClepESyKzSjrvdbtwGCKlrPDCoEXRK0a7MtenjS+xPr78uu1drSQkheAMOfVYIUdO45X37dtu+nUUp1tPb53E5XEFzn9A4K8Qz7OFyWT52Iwlue3r52L5fFqZ5X6OXUiGUx8Byv37vr4fXr8P5c/pef7WNplxv0LVBKO8S6vuUIcEy7m53ywonRcSmQaBVFohWOAhlDvKwCmGJddnzRKlBwXDe00SIheiEKP2xFCKbIou28pQZFLXJnwlFUW6MlwAN8Z2zrvfWJh0dIFFCBwBERNo7GTxUPuaTYckHEISggmRYIQLNDbXRHmod677vZClsboPIDwR4zZ7IVMwaQYr7Y0RyfqgAw/QPMKbYbKR9EB6w0udt8A/oMzMdm4DyyraExvzcZs+f4Z5wzr8B8scsKGLwyjkAAAAASUVORK5CYII="},3737:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACZFBMVEUKAABHAABsAABcAABNAAA0AABYAgD3PAD3QQD3NwBBAAAqAAAeAADaAwD0GgDTBQB0AABmAABgAABRAABKAAAUAAD2agDGBADBAQCMAAA9AAC8AgCCAQAkAACNCwHvKwD1JwDfCQDkBgC4AQCzAQBjAACrDwHzUQD3TQD2MgDNIQDuIACRAgCtAQCiAQA6AAD//emUEQLvEgH3dgD2cgDDLADmJwDoHADjFgDiEQDuBQCbAgBxAgDgAQCGAAB6AABTAAD///3yPwXpFQTPEwT4fQD3VAD3RwDSRADDGgDUEgD1DwDaDgC5DgDpDQC2BwCpAwCWAwB+AwD+9+/96db5xaX6sgbaHQX5nQOkCQLnPwHyNQDyLwD2LgDBIwC2IQCuHQDnBQCEAAD+/tT34NP+/8v44bb89qb955j6u4zwpIz944f0t3jih3T1l2D81lHohFH3sUf7y0bigUT1d0LdSTL4qyfCOSfUKhH70Qv6uAbmSQH4iwD3ZAD2WwDwVwDaTgDbPwDBNwDQKwC7JADfIgClHQCSGgCaFACCEgDCDQCbDQAuCwB3CABSBwD+8+n+/93+89v43sj3ysL93L/+/7zuv7L+/6rftqP82aHgrqD215H60IfimYPtrID7y3fOiHPXqm7yg2LWfk31j0qVaEjzlkf820H3gT/Kej7oXTnCRjX5nC/hfy/iUCy5NSj6vSXwPiD3cRzXTBb2kRTuThPBKBP83xLUaw3BlAmSZwn6vgfOOgbylASEWQTOhAPISAOXJwPFVgLFfAGmKQHqYwDmVwDvOwBPHwBxGwBHDQDOAACwWnJmAAADLElEQVQ4y9WS07IkYRCE/3ZPu6dnWmObO/baR2vbtm3btm3bL7VzNvZun2Dzoioq8suomwT/mRiGpnBR9MEdmhWnmX98FDHG3APj1u2bwm18Wp1o/IuY/8ZFI45oHdl1fT58zPTZM25TSqrQfxza1okwdvHz+j4DN8pdvoPd77pskDNfxsN2ujOfwDAbAvv9G3t26Tn81cpPTfrtyqHNQw4b4b0JDFghaHsH3Loh00XODF/x7EUTeLliaGZNYN2qsTgyXgJl047NQsy/NdtHXiMPH/pm788fq1bLwW87o9ZUitq6DfhMm/ekxuuoccfIYO9e8trc1wC5OhCOSjpixGx4FlBwmzQuSyeQvoVw35FrI1ygVzCwvgIhmkgxZts2kBBEqIcdEieOJsJt+W7y9bmLHzhGCHA/d6sRR2kUNGAUs5rah7X0T+8qF7rNTnYddGjJABVX+Krba7QxAIEh2ob5R3GlCfFo/N7g/ceOJE/aY7CH/TXBgpcxANcxmrbneLZa6l7YsiQ5acqU5HE/6+F5jzpAZOMg3JdmJCXdknvycMaC9+e7Hp4xZN/kZY5Hr/t6LYpQLYGFz81mpO7NLph+beqi2dMGL093n9N16tk7S09f7adRCguSNxgzhmG7r5yaNf3+vEmDbll6zOw6bd7CE7Mu4FZMi4HJyxjA6Axtejr/9uP5F4ccPHN08Mybi5aeu5uyIrrVA+aMMAObGfXEWHZLdwvfb+6gA4tbXHy3bu6iw04JXtCjZjNjtH10ZILbkuZK1WFDLnOc0+BwcWRwLC7BQBUwTEPGEYSTbXf3799fvbQ8wkVaikWyV3AgDgsgXqsIXksPksx7BaXEVr0jLUrR6dLUUaN5reziQS7vUlysO+SIIlqxu0dlAwPLrlGRuk9RVN5BEIAkDIYxTo7zIA28PrFeax0br7XvikZ3FvKRMb17BYHBQBBNhhug1nw+UYRh2IfgDck3IkeQvUmCBGTnNjQ1AKakRrPaUgNBTKiEVvzDHKFQqPMFYQg5C5aKrlMQBKF/BJkoCDV2tMdawZiQ05nv1ybgFGRCTQmsaegJXYdMEEVBzfkbXuqtTGcwvUsAAAAASUVORK5CYII="},2198:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAA9AACkAAAyAABCAADgAAAsAAAjAADIAACXAABOAAARAADjAACwAACrAACJAABgAAA2AAAXAAByAADnAQDMAAB+AABUAAAvAAAeAABsAAAIAAD1BABGAQDrAAC7AABJAAA5AAAoAABoAQG1AgCfAQCNAAB6AABaAADXAADUAACQAADvAQC4AACFAAC+BADbAADQAADBAACtAACTAAD1DgDwCwDdAACoAABdAAD//v3+8OWbBQHDAQCEAACCAAD98u/96dr53dX948rikXzYDgT2PAD0LQB1AAD+8uvy2NPzx8DzyLT8z6b2tKTUqaPrrqLxn4r6q4TLeXLccWPGX0n0cUjgYkbPXUD4gz3lSjzLSjO/NS6ZKybwTyTPIhmnGxG7JQyvEwh6CAfDKwaoDQbKDgH2VwD2QQD1HQDhCwDdBwDy0sn82rrit7H1x6D6t5fbmpD6sI7xqY7LkYjrl4bzg3e8fXf1lHPLhm7qalbMZlT5glOIVUfWUUTuYT/zeDi4UzigPTi2PDTtXy+gLif3WB7iMhqVHhTrOA6eEQ25EAxyDgvTFQjrFwd+JQX3YgK1PgH3RgDoLgCGLABPErVgAAAC7ElEQVQ4y9WS1a4bQQxAZ2ZnmZmShWQpfAMNlJmZmZmZmZk/uNuqb/2C+sGSdY5tyTL4z4LnNQdzVcwVioJd/h+uQmwNW3qRJ6K1MMyK6l/F/9uOIcT1Ymgw3d54YLOJrnLuH6Lx/m+uRxnTa0ntcRXQJ+ctMipkFnnu737adXkcLelO51Xmrfl+9lhpfzm7uizaIuZi2gUF5SyZcV1mXKlU1pz5+q0Ufp5ZXakIxgRByMbAc7yUW9KVUaddGqt/4Fg5fW4cNNi6slan5BxgAs3yEU1ApR8Ewfg8QwoXzgmSrtIQuhqWAFW1VFbSaIhClDYDhgna5y/0bQfXqzXf5y1A25hCulNVGqSULyI/77+//0jfsrmhJOOY0AigRgRdEHoYMr21erLq9rr5SzcclEaQZZEoQ40HMKI03s0aZkfU6/qh5cs2XVq3pZ5XF6ds0op1F0S2q2memSIUJkn4YsGyFSsWbDmBuixrZWKEcoBYjVfZQdg78ubW7uN35m/YtnnB+lfMsaMLF8steyqCpyd9H9rWqSdX923ctfLK8qO9Dzvmb1x54OW2PUihWilY8Iz3aZrWHt3Yfv31vhVLn3ffX5u/6eHuzdvvwcJVcrD+EA/8Gq8Rbx8cfrd359aLNy8vX3lg7+G7Bz8qkC4Wgx0nfKD5hJwjlIQym+5cuuyxKKWrPg07fY+yLbBwxgNa0xtmeZlFTIJObd3DmH2yL5pCgGI1AjJH03W4UBCayBNNZiDvOs6Y5VE6RjsYxREHdIXjlsiSYQwW260OkqzTLTZpisqo0UwVT0SAGUxZaSrOmR6siz05Q6syT5pj7Co7ypApCMAgSXKuaTIyVKE9s5UsXTvz8nqd7QyYRtBuA3IikAJJmsORgnH581EVw1glsMWQRiD8mWAYv6dMJI5SYwyhqkLoqATBdcPm3NwECMKfHWGLo2s1ynEIgigpRVAUgQvPkkFj0mgumlpcTFElpN2aQ9R+q4RTJsqhfgHJO3I6nMyA7AAAAABJRU5ErkJggg=="},1289:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACf1BMVEUAAAABAEACAEYAACUAADgAADEAACsAAC9SAJYAAAwGAFgdAKpaAYUAADUAACAAABMDAE8JAHEFAGADAFQBABgCABBOAJ0MAIwCAEw6AK0XAKQVAF0KADNDAKAPAJxWAJEYAI4TAIgKAIUMAHtsDWULAEgDADz98+0pALI+AKUlAaQrAKEfAKESAIQTBHgfAXYtAW00BmsGAGoHAGUMAGP//v40ALcuBKgzAKAbAJ4pAJ05AJscApglAJhEAJUSAJEkAo1YAIwZAIoKAIATAH4rBHsWAHNmB24SA2odAVyEHDeOIisAABz38fTr3uX95tYyAK0kAKxJAKRKAJnus5IbAJFMAZBVAotJBYdeB31iBXc+CW0fBWtYCWoTAGVAB2EsBl5WE1UVAlJxE1BWEEwNAECXJx+5PhrwZgvOTAr+7+bi2OT66eDjz9nIssvjy8mqlsW4qcT507mPdLjuw7C4jqs2CanZrKWldKNYO6BYHZyKU5uYZZoXAJotA5g+ApUlE5QyAZFCAo03Ao2GXIo8LYo4EolZEYk8B4ZRA4WGVHY2B3HXgGBnFF83CF9qEFoqBFJgEUyDHktKDkt7FUmBGUU0CUUkBkWNIjOLHzCIIS2SIyOmMB9sLBmqPxiXNhHXUgsSBwrSxeLDt9fNtdL84MzFoMChkrqLe7reuLjJnrKPeabCmqKMZp1rR503HZdeNJXVmpGxjI9POYswHIpJMIeSZoamaISUU4RlKIK/eXlAH3kyBHaLN3VdLHVXF3G8bWncimfqk2G/a2FvWGByHVvli1exWVd5G1F+M01tEkq8WEOpRT9lFjwlBDZ6HDVrGi7WZisSASQrCxLeVQOSa1CeAAADLklEQVQ4y9WN05ocURRGzzmlLnS53T1tG2Obse1kJrZt27Zt29YDpSbJXZ4g6+a/WGt/G/xn0AaVtPsRMjOybUyb4R+vh9DLxiWmedAG76KQiRnzN6H/jAHBAMwyw0Zt2/1172j/8EEjcVH9bVSB7sxsaPen0ckdLXt/gGNHWkfsb/0y3DzS0HmP8bwAUcPgHQdax477efSIVh862jG2dWxLGvrtGA9kkmpmxLoR+w+07BvX3n64M2jv2Ldzy6ghaXsgZQcZYs9msS45fPPolp27xnUctn//vOng9sZ1NTmm2UZu3QMQkfY3pzACjhwycKBv19vl77cMOOirH4pjEPKCfRggUQJPDVMxWL+sPjVk1JLZPp9v07YxBByKSJoWtgJMQWSVjUK5XtxD74oB2+/OXTC/f4PiX8y6IU6pFMDNBM9QTStCBYVDm8rXzArmdzl+tdyF98mz9nBDVQDQTKkGfvA6S4iVMtKqruOnnwpOa6pFnry8HjUBSQVmpU0QbP3LrNZQ4eK184ITu3UbPy1RrPlaU9QfawAbkoIBd3UvXHvv0fn7Iy7kTzp9ssuEW/0fP6hPeCoVlgUb39E0VDyDXsx8PeX2xZldrxTOnpE/Zdb6p3PuVMlYpRUE1xtojMeOvZzTu/e359263PAsnZo//dnGc72v2xk+6wUTVgmAxgSVunnpzceFMyZPOnOi69TLKz9cmzeYCWCMB5xN0ECgCbfXWra6yJRXNTc4cUEktmjNfDbqsJFKLSiTtRdtNmOYZU3dLT2sSycvtFgc/SrYMNeYxnEzMIk8n4WpaqcjlmELCgpMK1eXhsORkijna0ziogIkWVTi7iqOK42LlSErW/vE3SfaM5J19e3bR5YiZaC0KOaKFbPGilwgV9LdbSp+VSdF+pYyyFVpKq7o1w9wTp2uZ9hiiUMcMrKSrUtLstSUy9SUFC3pNaBxINBpaI2l3CUjDbMZIYjjetSwnOO4amc14HTVHKfTGXUliNTjCA/ocQgpvV4vJpdV9DIagdOpWaMjWiNiGEVRhF6DICiCpAjIZLxx4DD2dBSVJ0ScJAmC4Ns0gWloQ2oQ1C83prpOjqKhXgAAAABJRU5ErkJggg=="},3972:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACxFBMVEX2AABM/7v4jQBe/z9M/8JM/6z4nQJL/7RQ/2FR/1H3qQP4hABM/5Fh/VZ4/CzdFCPzSwL4lgH3cQD2FgBL/ONM/89M/51L/n9N/nhS/UZ9+UK7vSS05B/kqgz5sgP2NQA9vvVD0OpL/shM/6Zl16FM/25b/Gll/kmK/SqW9Cp//Smv1SXd2RLUwBDXlg/11gznGgf5vwXzewP4ogH1JAH2ZQD1WwD3QAA4tfw+yftL7dxL/NZU/JZN/4R98nSK32esSV6S0FCN+UZR/z5+3jl7+zeO+jWftTRb/yya7Suq/CapxSTPQiC1yRzC6xvEehnH4BjM0hbCkRXVsRPhJRLYcQ3ptgnfMAnsjwXxigXwYwPxMgMrT/5D3vc/wehM39uBRLdN1Zha+I571oaEeYRW/oGmGoCTL35/4HWyL2eB+mZd/WB36F/tAFxT8Vhl8Fd+6U2cfkhc50fANENa9EDPHz6F8Dyf5Dmq1zla/zZv5ja2xi7HYCuD6iij5ii9WyX0ACSw8yPOxB7OsBrP7hnoBxbchhLYzBDy3Q/j0A7fsQzjnAztCAr1zAn0vAfvbQMnPf4wcv0nHf0yDf0ylPc2buVK5M5Cws14K8dWV8RDz7tP87dg17d1WrdenrZJu61W7KZsjZN3y4Rz7n9o/Xxj8nzgA3uJhndX/3JU6nHHEnCUeG2F12h3tWGVz15w+1yPv1unfVt21Fier1idaU7zAEKX5UGsyEFx+z622j67Pj2RwjiKuTdk/zC1qzCpuCjPNyiX4iS2eSDTfRnk6hbFpBXLbxTZuQ/Zpg7kvw3gSg3mkgnqYQfpeQZI8PFRRORVW9VIedN3FsxX9cpgc8VlIbNhvbFF47BN54lxpolwuohSu4Vh2HByvXCiZm6Vn2Z5k2atcU+AnU6aqjyI4Tpm8TST1jOiiyefrx/EwxbsPAX4eAAG0MznAAADV0lEQVQ4y9WM03pjYRiF/2QnaezGbOxJGtS2bWtqT227Y9u2bdu25yZmt0/P5gpmHX3P975rgf8s8zJTo7ovJyT083/+6E6d9w+/bpy6xA3ojT+1xUdzEtsWHTunMObqCSnjQkF8Ye7zD+sl8j7fbafuXEudJVQHY4Z/Sdy/Vl67WSppAJRVEnmOu3R/YmjSTJ9ut2XG3jrevNlN4rZs8cJVsD1/YZabu5t0izHh+m0biEOm+/OHQ+Q5kmz3RUuWPJsRFme5Zy/3eFJ6JXbvEBDQzpeOavz9S+XS+9mLspZ1RH3asDSHieAJ+CdOEA4eAWPpvn0tvtO0FP5GT08P6YqCXI8XS5f76NLoQiHVMVQIkIldab6FVLqwfGd5+ZpctsKDuXr12n6a8cJNi9UqPgLo+lv3KkPvjfFlCJ/w4jUrNhW9euvVrO+vCQwyjqdRk4FoBJNxPjlyK1aBbdFhN74fBBMXD5J4sW3nWklfb2aKgXkESRXb/dFsHLdLEBFJOba9qud2nCaxM+wcLmgoNBWMXrU7qO1eUCuEq67ednbwWFVVT1QXpA0LU5NrrjWeBZW1DvGdkwrsrjfr/fJed4AFfqcHk8683He4NoRM7msMBCs3MRjCX53v1u1+vGCP325KUHV9HWztWFdWVBNpIbeCnkNWRobdlnSxrKTkwUrKxAVtWzfYnpdXVtJwJfquTg2SzmQC67T4d/L3uqeP9tQ1UDqiKEc/73g4f187f5werQWXL1mBg5EcFA417lKqw+qPTlA+cnFQfj5XSWwnGDTgW5wYZFBDZd6BXK2Cw4XqTxdx2EQEC8d2YfqIXEcBedhmizbuRSGIUC+Oo8CSDx329vbGVmBdmJ4Boht6EBFn0GtCDjg7F3cOB+OgQHV+MK+CSIppQrNUMb0kFSjYqeJBEA7tpRNGVijVWtWGgAgSujh+jBdMVnmhUMAFgUDIiGxOyBRepB+4OhBQGREjaNHF8JQcosyTyQQIJ9hwQrNJwQOTJpNpxGSaNIvwrinNBShnZ5fZBfhwgkO6QcDjJ6fMeJHZjHHFYwzHt7JkaDRAoZzgAZayyUD/Q0DSaBgYumKQGAISkxIvCG8CLDSLyDkQbsDDHxqNbrekp1mmM+5a0pEEAhLOX/KQAIVSSOoqAAAAAElFTkSuQmCC"},7136:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACtVBMVEUHAH8VBPMUAup4/5dx/6Cn/WATAeMWAvsdMPN0/5wRAtVm+LRu/6V//o5+BgIXDPsVAu8PA8le+sNg9L8JA5chSPsYFPpJ5OgXHNpU6tVU29ERBc8NAbZs/qqI84eH/4We/WscLvsgPPo7vfgylfgoYvhAy/I1l/IZHvEnW+syd+oYG+pFz+c6oeQdLeJL3uBP3NhY+MxW5ssYK8Jm6rIMA68NEowbJ/kqcPgfOfExgO88rOwbKew6lug/qOUlN+VI1ONGx+M0a+EtX+ETBN5LztoaKdofRco4bcgQC8VVo8Fe378OAr1ctKwLAah16KAKA59nnp0IAY19fnDm6yKAHhUznfwkVvo1ovktf/kwh/cmWvNC0/I5q/Izh+8/v+4zj+0iSOw+supK3uQlWOMXEOMoUOAZGeBLvd4UDN5Q8d1Cl9sfQNpEq9dHutZM0tQxctQTEdJBhdEcLMtJkchUuMVc7cRLnsNIgMJPqsBavb4eRLoPDbpFe7Vo/7Bt8qgOEKR31J0eR514+poSIJF82omO+X5zaHKc9W2GuGldN2aRklay/lXJ8TyyoDqDSDKcUCLTkBWwXA+HEgOjBwCSBAAvjvwaHPspavhG2+06pew5huQ1Wd8pVts1gNowaNhQtM9OoMs7kctW0sVc1sIQEMAxd7sXKrpg6rlv+KZrzqRutKJwxZsTFZYhQpGN6XmV/XaFo3RuY1++/UlqI0etv0SHXD+TXTRzMTTMwy2pgCzb6SrFkByDLBz01Q+vKwetEQBDw+lV+tNLoc84Wcw9gMNdrrQcObQlWa8THK9HZK5Zlq1jo6t24JpJipo0ZZV565N8xo84RH0eIHxfTHOX0G6Jjm56cVyAfll5b1Wlv1JwSFC51kmBPEi/30aNezySNht2EhqVIhmuRg72xgmVGQHHHABfgbLgAAADTklEQVQ4y9XL03pcYQCF4X9rOnvUsW17Gtt2bce2k8ZGbdu2bdu4ju706VmvoOv0/Rb4zzaFe7Ct7U5cXMHikl1tK6b847tjjfMXhaxRR9ZVzpgnClpc/zfJ/HuP4y+zzAq41dnxqAc7EFZRt2FJwYo/kizlTvgue83TA/kpSuwZeH4S29eNHa4gxxMFF1BYkpZ64/pNDzCsfyA7+x1Rv84+34/1K+vK427fZQF1dO7NpeT5rRimxAYu/RgkgreXzmNH5PIntZ76aiHQwTcS/eaWlSXu7z6iHMj+dOjQ447jSkVz6KyNJZspNY0geEliWGSFBOYvTaPTFcpO72E5cpxeGbWMYrE0SMtTACk4cEl1ipRiKRRvuf6wk+NSKOTyjjCSfbOdkp7uawSUAGNpUXxp8GJqe2VgUnt3T1/PPq9ZFVa81hYrFPo8AOLDrI2eku0ilyjS7Ez7PMZgnMmIWecp0sx22OypqWDSalKyL3lbMztP4D/NPz5n/NeVlScWzLAb9BpHYeymFuCnYkmlUd55+tl5TvGO+2Pj40Rgtmo1mlXTiwus28CWQmmqMMglSmp9efrc/l7GxVNDjK+N3ozE/LlT5wQsEoCRo9xM4QJtyuD3kS9Zpy/nbBWJjzG+nXo1ONy33CQJ0oOVXdzMnQ0JB3uHR0fPjvxk3NOGvmdcvnBhePRjualh1gyQU5MO0hNSW3aXdZ38kJU1dLH3TM6xjKyz5zI2LF0mWbAKvDBzgY/rsQXqI3a4tZrlbxhjRx3h89LSBGJOFClgJljI82UmJMfLOAKBtootmL18qI/DpqJUBxuhV0OQH5hKlrBMsbU4TrXqHGzXtaldtRwORxTjRBT0fIjsB/x5ZNVMQxGCJM0nz8nTr53Zagh1NoVPC93bvJCnc0aAPe7wIKt1EW2PyRJV7DZMj5CHrAnfW6U2Lpwz/aoXxwGCo6iMynYZJkOQSq3ihWz15+kiTdNsYneVjK6gA5SGojhKY8es400mtprPnzxpEsTkm5PaEQTBEYCgCB1BURotJpgEMQmcGESMvH47VSajARwnVEYV28iUaBLMhCeMCcNMEgwZ1bq5IaCJ1kR1RwSSIUKZMIUVnSuUsBJ2lubCJBIMw9G/AXbV85RKPEmDAAAAAElFTkSuQmCC"},7573:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACmlBMVEUAAAAINTUMP0FvA+9mDOcGLCtNLscEIiIBCQwIMTFqCepDO7w9QbU7Rq8BEhIFJycBGBhiE+FVJNIQTU9aHdZTJ84QLkI2T6cmVoYmT4MHLy8HEBpdGdwtU5UaWWoTN00QQkwOREYONkF3APKSEck3SacyU6UtWZ4rQoO+QnQbOF8VUFwTS1YUP1MUJUULPTwJOjkLMDgOJTj//v358/V6C9yIDtORDNFNLb9FMrE/O7BDJKI8YpszRpsyQpYvTpUoYJEmZo0qVo0kZIcpO3wfUXQlQHQcS2oXVGEaQWETVFgOSkn88ezt4+tqD992DtZYHM795MqMGceXFMWCGcKhksFINL9ORLRgKLJJRLFQH6v2zag8QKc9NqYwT5s4MpdRc5SuMZEtPo46NIwqMnkeZXfaf3UrJnUkOHMpLm4YXWQWS1wRRk8ZFUV/Aezk4up4COX+8OTj1OSHBOONBtr969fNwNRpHM/hw865vch2IsPAqr/XsL6qdb5sL75ENblNN7ZqF7aGd7XotLSXlbLkrbChIbB0KK5dJK5HJK1sdKxHL6i/caWWhKSVip7Se5lIapdGSJZSMZZSYJMwSpAuN4o9LYU0JYQoXoAjXHkeQWwiNmwZMFLTV0gfDDYNFSsOChf15enXzunSueHBid7Iz9ltJNWyqtTJptSZWdRrRcxjHcvk0se8wcKos8FsGsCWqb9eMb+aYb1qW7z827nUmrZRJrTGpK2RRq2rfKlmOamxVahySKivnZ1ghZxuFZxINppRJZmmRJg/J5ivVpVqX5Q6Q5SQcZFgO5E8WY6+aoyAe4aiOYNBGYPHWYIgb34iTXiDTXQtVHFxaW2FLG2SMGwkYGrDSWolImgsDmCWRTzdZDRvNTFgLTDQUIJRAAADMklEQVQ4y9WQ07IdURRFd+/2aZ8+tu1r27HNa8S2bdu2bdvGv6STt1S+ILNqrVW1xnia4D8LxZt3d8R0rvZwzZcOM/UPT7mgkbVWtJVfyjF4iaJw7G+FskMdrKoZkDH35W3PkujIOZVJu/kPEUXqN2+xb5rbb8O6TM8usOejp1+vrF4joy17FABIkjTHHIHA3Z4ez/DPwQ+K/TMY7JnVM3O5bkdqNwmqTfTmUHtpvx5ZEyYM3/n9myL82BnMGt81o8vSVOy+DtiQljzZsHHknSWZo8YPD77o2PV18aIebqmgKlRfj29qAs5kXqh8qIDA0HEUHZPZq1vXjMmLui6tTOIQkmJsAMAdgWTeAFGAg/sMGjw5gyDGuKdNO72D1m234xTFbwZCrRMf3GRy1Fi65BiJLj3OzTx6TBOI2HO4EToXIqZAXEbIUKo5myCI8krm0IFOaen7zucW6Ib69bNHQJ4HUKZFnhwqqRn2ja1hWOeJAy90mvppi9Pg8zOFrmYzkGtJUdzezafXM/37Zy/rNLF797Ent3jL/P6y4hz7oHqw9pHII0MIpu+NK9NXPFmQNu7I/vTRw84+XP/UUGKN5LKg8S1FwYhh3Yr5jVNWXR7YeU3fvr3TTkx//GzG1UFVeJEPjH3OU4JS9/sZC+e/auyefqskf2rawNWrpyy8qQuTttdg9DAeUAJvptcsuH5vZe9J404d7Hx43soHF5e9q3EJbWXgzFYK8FRyhNGn7z/H4M/vnb53Hsf5Zs1i+2ia8agB5FfzgBSbJDXHlRBaRp8/aaZWrcE0rFrlXg4RGZTIJFnlykNRjdfGqrVE8ar1WrVSCoOOQgvjDhk0VLfXGktzUZQwRqyMniu7Zh3CWFhboWTRt1YwHNAS3BCOYzFNJdw2mygt9i62NrCSNgILrMVeDaYCqEqlwjRqbSlMwHC4trVo7dbWivJttoI+hFZC3W6AYSpMUdRsUbXTWVcny3V1MI4gMNANQ1FUhQJllIthWK4DTySccZhIQIgoiW7MtkgYBlAUU2LJLnQIOE7TNPInNIKbENhWYdwAJEyyEJwxGlc+NCKQuMIEATfRNI6blP0L9GTBDZUfhasAAAAASUVORK5CYII="},4321:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACoFBMVEUAAABDFU9MDU88iDVgXqZAH1QeAx0KBg8/kDhra7pVVJI8JlkxKVM3IU5DPXZIJ2E6gTRRUoU9NmxHMGg2MF9AEkk9ezsTEhj59O5ob6ZYaYlJQX1OWXxIRXlUf3JNdWhAMWdKbGRIblxGelZHF1U6IFJcwFEsIUETBxdoca1gaJ1idJlaYpdaaY9Yb4ZMSoRXd31OZXZEN29LOWdUlGIzLFlGZ1ZQp0dJB0ZEjEVGnT8zFD86Cz8vDjYfESv++/nj4NpydKBdXqBVWYxRTYxxjYFYaIFPaXNReHFMYW5IUWxJQ2ZDO2Y+L2BCRF1GI1xKg1lSmFdTq1JKh1FcxU9Yy01ABz8qIDooEjUpBSju7OL039He2tHDw8aqprNna67MyaZjaaVbWZ7srJpcaJXZx5JecI5XX41vcYdSWoZhdYBSYoBehH1MT3lSbnhMO3RFQ3FPcHBITWZOfGRNZ2OTvV9FU11HXlpFcVVASFFLGVHNxE9Rkk9Ef01DdE1GEE1Z00xZuEs3F0dAgEQpKkFAlTkzBzQ4ejMhIy8zAS0PAA7S0cnGvsFubr+Qkq51c67Eu6Cyrp+YnJmtnInhs4iMsYaekIONg31PS3RLVXN1pGpPW2ZUg2Jfh15bol1YfFtMRVvEr1pSi1rG0FlXsldEM1c8QFa/1FRmtlSr1VCiylCFzk9rxU5OoEpNl0gyHUZhXy8ZDCIkOSEZIx/m5+Z4eNB6fLv1xLq1sLjYwK/vuK2op6h/hqDY1J+ux5TNt5KDgpFpZ5GdsYfBv4Xlm4KUmH2epHp3dXWRkGyhsWa2umXNuWOtmWB6Z2Cmoluex1qAglmCklhrrldHgFbaeVY4LlWptVS7oVOQyVKOpUxnzktBXUuApUU3X0E4TkCVkj8EsvciAAADTklEQVQ4y9WMU58bYRhH35nMTDixbTtpsuHa9m5ta217a9u2bdv2V+m0v/aqn6D/m+finPOA/2xkskg03M9g8LkK/rCI/A83Geg0yxyXN6dOxbEvTGH2/1H+Hga9tXBxXt3e9m/Hjf68emWtPl/0m4yMjP7iLaxAsX/eVuPR00D09ajfWLZ3C2s/YYyCwcEErD9/U86O7vLuF3sOfCLskwcOfS7vNrrxd8PxCsAUwI378uf4y8uNZR/b2n78EtoOl/WUlBQHKk1NrcAF79SqObVbVLvLeoyHDzWcOXO69MjBcEiu8O3MjTS1ABas2d/YVKGn+/zhcLDndV0w2H7kmDYXqkAL41hlJ4BZC6BAZ3WCPtOdqSkume8uCW7fvH2foNXHipLJ2HcQ9dKjngJBoa+jvWaBsvjgutvr0pULuPRsCwfFe09FgIEPVfAqc7WZmpm1i2y7r4sTE5PSPXLTLOoyaQ7djAEGXzCCVTeWNkskabK05LGX394dN0FBYyHLqI5NeJ4ZqLmD1VjuVuskqm2mTblcPG3atAsTaFSESp2KZOPWAjA3A8NMdqdzfvqrlU+3XUkcP3mJOGn2/AezM1IRhEc9Bz68JAOGd2r9oxm7xq9ZuTYpOfn8RPGlVQ+f37g/U1GFUMG4DWZyVTwuejZ5xrU9T8aJryIrJiSu3fV48ow1Jm9cRgNnk83AXIWdqry1uqFh/cQlSRfHj126fP37Ozc35qGxRVPBRJoZYKMmWtoUyVx3ClWySjx2tcQ2ZdsOq0dXIODRwCQmBmLVLcJmiyWlRmuZtGLpPXdAFyrKyDoe1uJ6NUDUsZgM/UIh6aa4HIEaJ7JhtjJLZXM6KcFj2QaWGrhkPC6Hk02haGnqFKlVQktPnbewU8qUlxZJmQqPAzRrrPbp06V9usWoL6M+FXFsnpUm7cvysux2ZPqbUAhQSCSSUKfSpNJRlMvkMuVzXbLFBYtk8oVZytKB8ABgs9kkEntI5ZjFHEOMz+ePYeAoRN+oC1EGiJj4QKFQhthsoScfQvV0A8NgYDAgYrwcTVGfcAgQOYkt7Micw0uAYZgAKI7jJ3pPdMH6Qq6CIwcdQmGRah6Hhwq6IKg3Gk2AoUisKhKBYCLoggU/Aep54rZnCVVxAAAAAElFTkSuQmCC"},5945:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACqVBMVEUAAAAqpB4sqh1iAphdApsmeMorlrA1E69zAJMupVguqkhEBaVVAZ0voZwskJstpjIjYq8lAq81AqZpAJcunJIup2Irpj0pBz0rqBooWbg7JbFHHqZNAqFOEKBYApVsApMwpI9lAYxAYXlgAHkso3NWAW46zCAxuBsFDBMsL74mObkrWK08PKUya5g9QZVfEY9NBIw9F4k5SIhpAIUupIMrlX9LBHoskHY1dGk2hWcvm0490DAtrCkroygJGBojZ9DLyMYqjcQylb/JxL4jJL4neLcxb7O+wbEnP6kxoacocqcohqZMH5sxVZopb5UseY0qiYsrgXqqsHkzBm4mL2wqHGssnGorn0Z30TUOAyk92yNE1CNA4SIvshwRAhsdRckjPckaEMAsFrmqurYwm7QyRrKAma61u6gpMag6I6YnaKJVGaIofKFcnpertJU4SZQqkJDIlIwxWYsuLIMvdX97lnhBBXEtqW49Hm5MrWosgmXTbmEsn2BLAV4oB1dDAFYwA0inuzY1sDU2wTIhAywytyV56SE81yGj8h+P8B8NKhwnbLzJw7WZm7FEirA5HJ3OrpxChZo4O5p1o5ZGNpaRppNCI5KhspBSI45BOIsrl4h4r4RdfXzSh3swZHpDS3QqjmeCt2WwtWTPlGQ7VWR2k2IpmGBjvF85Yl41lluHo1oYMFcbJVJErk00fk1Dwkw5pkQ8vT6PtzwRMTA0uSs1xCpV5yJedhoXPhrc7RgjWcUkar9JdrtCZ7qWrbR/gJ9DbpsZIpUlEZQdVI5HQ4xJlIUjZ4F1aXxWP3qdhHhIHHjCx3EsVHG8xWu/q2efn2dIlGZhYWYjU2A3clsbVFYrGlBkoU0WOUm9yD4gazuRmTjZTzi5mTWZ3itduiYfACVwuB/I8RyPrxtXnw92AAADUUlEQVQ4y9WN45IcYRSGv+me6Z7uYcY2MrZnbVvZ7Mb22nZs27Zt28aVpDeVf7mCPFXnVJ163rcO+M8YWxE7cvp9ce3NmbffnI4d+48/4uKweWyzZEFLgThLl5V++G+k+m+9WO6Qz5wV6mV9jKkMZ9f57HBt7B+jbe8j9NhX2ZoTB2eHDJUXQOyPSiwy2KuRPiES34Ha4xEeRnNqQuPHjR8YGvpGdM4PDRNHJOAqPvLWA0ywcs9GlI2NG2cYHLh48ddo4OfwoKH3DCtYUhx0gInwgyBq0WgKDkYMhoHh8pGRCz3nKo2sXOsat9up2QOkyuA69zY1WbYGr6oyGiJl/f0nz51pscNqGq2h/dExwJXmKA4c01Pldb68e/jZxsazxpPH8Q0Kx51sp1DYeQCoJ6OOuu0OuVXQU2DR9UT279zfjOWg60IM2waXs6MJ0MfQPfYmd4uvUbdgAe/EziXx8VPu5s8uyUtANtmWC7sAbQys1es1OKZiTDNPuJq29XPriqXJl2alJibw8lw1QoBO8uj19jAydaqKxyudt6R1a+uipWKEkpAQRwnUMreB/Fx9uytF5/U2v3v+6cX1+Bnr5ydNucHfsnKumJIiYWaAL3v7qm/NXBw69ax7fn3h7hnLVIzpSYvW7j1VeIiZXpSKgEVbKqqLOoqELwufPv76YUXSlbjEa/G7u7sLdz1sMndMiwNpyyqAsKirqyR1dXl5/er5M6ZPSVs7r7581zzrKrnfSgHTxRWgs6/EJkYQlfdy4tTNSWmbGQzk6NGMQNlGpVQMEk2d1X7tdlYZg0HRtTGQjPWH+BgexVX8qDEoI6OAItE2pGe/hiCcOZHH5+so91fyMcy7yQsZ+3Nl0slggkky2cIugKB9qWiKCsmIa86c7RMsNGWy8LnJZh8ThPcxM5lMXkzZKrk9ULqYknWcPXEhq00yZ24KJSscjQIIIpFiBFgbm0aXocmTJrHzJpjS3VZzbqCUL6gyVgHCi4jBFmYmczhjRuHQZHSYlhOOQpBIJALEhkQkgvzlSrKMQ6PR6RwOFybDc2p24KwYEiDk6I8dtllqqpJLGDKZTnYqFFQqd45kmsUGBCSWoDTfIqWrqTCs0GqVZLLf729wKrhUAi78Gx5i6x+jvtqtAAAAAElFTkSuQmCC"},2425:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAxlBMVEX3APz4cYj4V6D3A+T5dYT3BuH3Bej4XZv3Ra/4U6P3D9v4T6f4ZJT3GtP3OLv3AO73A/P3QbX3Kcj4a433C973FNn3JMv4fH33McL4YZf4Z5H5h3P3S6v4eYD3H9D3M7/3P7T9+B73Pbf5g3f6olv3Et/3Gtz3Hdj3Ftb3LMT5kGz84C/6m2T6rVX80Dz98yH3Cu33Hc/5i3D6mGj7sk77uk37xkH82DT97CX6plv7vkb+/hz3D+f3I9X3L8n5bJL6omL85yoC7QzSAAACeUlEQVQ4y9WSVY4cMRRFbZfLDMWMzdzT3AOh/W8qnslXlBXkyHpXeud+WJbBf0YQvMwX35ZL3UXfly/BP34uhEGs6HqKTEPDbPl3JVgKkUYdyuOwqtWpoUXSvXwZa798sWKxYmhafwMfeV1N65zp4qtBrLXL1WTCz+fz5XWG3UrOZuf6PEVpt/iwIPP8SaaHqnbsrtfcFdB+VudtC/liwQRY+2upJ5OBl9NpvZttlovvcDNtIYuyvvcGA1JfZj0jvojits2nucIt3mBeJEQIYlMOvJVJGmQ9ISmXMK9UnrcYnjyxTr0gsAaQLvVk4aVRDLkpcb3b73BstEYoTIVP5iBZ+SSbF5Sqsi8QfhvfxwfmbMEa6So2cAXPWjLEFUV91NPn+HyOt8LoQTLERE+A7qy166qRklJa4nE8HsfbIIemMSHS0gDe2GDOSqrazf2qLu/b++G4VTEs5RCyE0fghoNg0Rm6375tL2/bZ1mqn+/b62Z/eOURCSUYpwEghHz8ODwe1/vx+CNEt/df97fH4zXNSGTALxqAgLivgHazy+71sN0fnrd6M7vnJhMkm4CfJgAWzAcjOaVhw/fj8YKQhBjRKvK0ATKzgNgCVu5lSoUkOswqd8cYVbiVia9BqAmJ0gbjmK+RUmW4oapSFFGctyzRGvSZ7kzIMS4nmlHJDWQMxShiMG6iAnGgKGecI1itRYRoGPKcFQiqTjQslBWEAEMMYaxUKPzklHXRIPus6KOI0VLBNm8B/IPiLEsderUSSeL7wiiIPwH4M6EDac9PnHRDeL7v6wmN3Rr8sTFlmhDP4X/iwh1xWpsBfNqSG518OWJdEIdrONz8DcHFP4n/xvdzAAAAAElFTkSuQmCC"},898:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAb1BMVEUigWcvjmdrsmhkr2hfrGhTpWg7lmc0kmdDm2d8u2lKn2gqiWeAvmksi2c4k2dZqGhxtWgmhmeNxWl1uGh5umhPomiFwWio02mZy2iy2Gj3/Gni8WnR6Gmhz2jy+Wnr9mnZ7GnI42nC4Gm83Wn+/2rMqbF9AAACIUlEQVQ4y9VRC67cIAwEG4MhBEiA/Pa/2/ufsc4+qVLVE3QUJbZnYsNY/WeYpkEna+VhTsP0D6+dC0jBBsCQgTj9LZmSc44tLpXKDDZD0Hb4Mj+9ppByLYTzbJVe5rLMS7Zh+AqGYUqpn9y8rWuUEq43SRZM1o2DsloTW6pSmbd9X0QA6zovMXrjUnaKdTC2EyGI4rZuyXHb5tgycwgjdeW04ZBH7bjGKKNLjHGLGLSUhsGhGlPXGSU0YExdCkRBszpxGsUaUqOVHkHy2jCAn2/7LdZuLRpKWg9a/NGD1QEEIaB/H7+OZzTkcjZIbpq+gmmgWhADB3gcj8fxDiFRziIQK5IVnks2BgTLcb/fjzeZnnMnTKYrzNOk88ltr72svy6v6/1SqgdDRNag+og1znbYn+/L7X15AJyqz7ZfV8MjGXXM02n36K/X5/66H63j59fj9Xk+d5nOQV1gUtMoY1BsvK3Xy359fGQrr6WzG7mrtSsld6FwnrJnsx/3DY3xHrHIyrsyfI4I5zUJChq4rqWUVlE8N1on1e0wsJM/qmEsALQBFFGjX2LWyarAyXYyMUK3JL17o4wVOdeamdEoACMmYSvsGIHILMSmgXVZ4uK98t63WgqQ09oKyATLgTkjQJXFKt+8oAESO0FKyWmBC+Bj9N8OP0HDNEpd2PMlsAS1taaE8q1VIDuMovgDSZzlTqq2WkHman3Sw6kaBZL+fH4Dv4kk7qhIC7sAAAAASUVORK5CYII="},1217:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAe1BMVEUYAP4YEPMYGe8idcUeXdAcU9UYBPkbRdsYI+sfZM0YKucaOeAgacocTNcYCvYYH+wke8IdWNImiLwZM+QiccchbcgaPd4aQdwlf8Awpa4yr6o2vaMojblI+Ycun7E7zptG9Iork7csmrM+2JdA4JNC5ZFE7Y1K/4U4xJ9hpzG+AAACLUlEQVQ4y9WSR7LcMAwFGQAxZ+UwOfj+JzTm12xsn8C9UYlsvYIAsP+MrosiaZ20bS3x7p97IcRYlLMOYESjrP5T6TQJzcI8KF+9RXBcx2/wx+xcUoMPUKtlfK6+1jkkxxkRydBJTbDX/bYsko5wOe37XiFpQaVYzier1VD3Wm/rOpMA66nOOUsUKXDmuEM9KVVMnettuSbR+mvNfWjWOa5GJjhaFzgXdsh5rrOnT6+5OB6FiJ0ojOtJhBKjQEDsZ+9nSu81F9QLKm9kUVOG48n2soxG1tN6ysOodSkqCYphPPFouQMwZnQgt+N93HMJIgQEJagH4pMUVe+huObM6/J8HZsb04SBBBeZttQJ5xERKCUfx+VybAqnECZVNI6shK4TwdDd/ms1p/fjfL88/SANKhU0AtsyCXaC9bE9btvjZYxZ3o/tup4XbFwhO2rX8Rj5cL7f11+XS69gez9/bfSWbGwje5qOdZxWAU7L7bScn+v5te3X5TyPVnA7sWUkgQk1YjFGYVmPyw0AZQbwjeuRoe1oou7zm8p4QDgvnmocipcZhdBM6cibQCkHbOAp5GqM9wAg5xyE1sxZTcMkwUxaAeIkVYABWugHtA6QGVNCQZDeiQagFGblSm9sCkGhl5JJoh+8UbST1tqm0NEitBbA+D7PmYQffAlWpPRZ+0QqFzRZmeVPwpeiaWu+cEJPMPR9/xUGUJra+YUCfh7WTYr1VIHBSdMRETv+F78BzJImqyQDEWEAAAAASUVORK5CYII="},5187:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM1IiBoZWlnaHQ9IjE0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBmaWxsPSIjZmZmIj48cmVjdCB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTIwOzExMDsxMDA7OTA7ODA7NzA7NjA7NTA7NDA7MTQwOzEyMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ5IiBiZWdpbj0iMC41cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSIzMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMjA7MTEwOzEwMDs5MDs4MDs3MDs2MDs1MDs0MDsxNDA7MTIwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InkiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSI2MCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjE0MCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjkwIiB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjEyMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTA7MTU7MjA7MjU7MzA7MzU7NDA7NDU7NTA7MDsxMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48L3JlY3Q+PC9zdmc+"},6331:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAAAqCAMAAACN4OndAAAAqFBMVEUAAADKysrLy8vT09PKysrKysrKysrPz8/KysrKysrMzMzLy8vLy8vKysrKysrJycnJycnKysrKysrLy8vKysrLy8vIyMjMzMzKysrMzMzLy8vMzMzLy8vLy8vKysrLy8vKysrHx8fLy8vKysrLy8vLy8vKysrJycnKysrKysrKysrLy8vKysrLy8vKysrKysrNzc3Pz8/R0dHU1NTW1tbT09PS0tLY2NiaiJAkAAAAL3RSTlMA9aMJ8eTaFuvfNxPGaYYiHfpCW/wnEHIwm0ltj3l+isMF1c2plrJGuDxPvVRfK+IvMiAAAATbSURBVFjDtdiLkpowFAbgg4iCgOIN76ugonhLUNT3f7NycmpbQrDu0P6zM0g2JB8hYBAwO41lsZrwYfTm59Ehl4ND0eFtZFWnVZ4X29XMT6O5kMuGY65r+JYqWGr1snRfPYzS5NOko1xP9pphbqdvquaclWSQzIDSWrY/zbKX66lVp7bgeyqIZ3LcDcNc57MxVI2bYFM8nL5LR1Kp49Ko96B6jpyGXXubE/i+rx9INcTPn6kCWwodp8vFgXTzPphItyQDhuFrcLKEYq+7dpz18iNVcxI28jnucMyPUmk4yY//klTrfkn2pNoDxzDa4zyJ8BY7rl6J+iqVv+eiPoU+D2KwWaGYHf0/VRp1tAB1/JBh0h1g3zRWmrNaOXOA6MapaewhcRWqoUmnXKN0hWUCdPt2IypdMYx2gd85E6oLJTmk1C6dSSzu1wbtTG/iyEbDojYChUrUNztAmV9RVYMaqpIaUDyDYcbwK8FRlDzmZaoVjW87dw96gFlQ274diDpPr0xlvFRfOdUEKLYlq1o/L6AO6sRXhqmPAdx9NI9J5R+j/eGnCme9UKXlKu+tym/Iqjk9rLa/Wkkx919ImlU8wqq3xGmRSn/iF8TnqlY/y8mWVFvvnBXviiqPiWivdjp0iQcvVb9LqiadwC/VnV2/obIO9ewRY4xllcu7XbYvqqKE7spArfJX1M0CKqrwsHqvoLpne0XVmBOiB2rV6SGeo45eUTVVqw63bM+RVcGKYx41KFHt+iJjqKhq4UabyqoeqkJZFZt1jKYrVFIqqYwLbronWTVOsz1TUkn5j6oObgZnSTXppDiESlV/JjJUqVxaNnlVVb6JG1dW+U+srVQNmEisUq05o2n6L1R8VFDhJlWpmoziqVSbROydK6vw9PhXQaXhYbZCNWbkAJWqja1gcxVVdoSqrazSTax9Uaj6ooQ7StXhRkuPoKpqwlFTUIW4MDjpRdVSlCQbpWrIheqoV1Q1vxJ8igeSKsAL+zgrVHtqqK9UeSajc62qOj/weuiyas+xgaCg8ull8NlUqmz6L29WVR3uuFiUVbDhuFtUXWg0NFCqgs3PbiqqvDFO0K4vq+aocqCg6g1o5siq3Ky7LquqmilWKKi+cGsWVbNETPb22/UVNyqqOnDDCmNZNcJtvVlQbbhQnUpUnTr1o5er2h+pTJ6VHxaS6jxA1bCgMl/LcrUKaD/pK1R0ptxyXcFjT/uNaoXPgIWkopcTbSerLjdREDbLVDSWfKNSeQMa6ITW/g0oV4nvrmttJKlaYoVzllVf9OIcQZnqRBUMlQpO1j19JQmH71Qzq9GwCipvhS/zrqwyuCgYlaogoUscA0wStsqrwPZ+x4d3Kt3OUnhegY/F8mzvEIoPy1V7qrLABQSPJJWUctW33gcXhAqhXHW608QKUFX7i2pWSZX/Erwv3qg84WCmDSvOt/F71eQvqrZS1bRyqgsZHr8NrYGs0iPqaQoOT9rlqloYhhZd7fSiVPmjL40WRjnVYRHlf5OZGlYWYyOOn2yzmNSuKVSUmfWzksUf51jjWSz9xu+SyrklScIx1wiUqo72EKikl1NNbvT1svKhmOnzkYUznv09JgEUYxlmL24YWRzdNEwXctmuHcp+pCtVr2XRugV5Ff2WtbVBkdg0XmlQu1J+ABT1EjoBoYiGAAAAAElFTkSuQmCC"},3848:()=>{},4654:()=>{}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.d(r,{default:()=>iu});var e={};n.r(e),n.d(e,{hasBrowserEnv:()=>jl,hasStandardBrowserEnv:()=>Fl,hasStandardBrowserWebWorkerEnv:()=>Hl});var t=n(6618),o=n.n(t),a=n(5720),i=n.n(a),s=n(1063),l=n.n(s);function c(){return(0,s.env)().isMobile||(0,s.env)().isIpad||(0,s.env)().isAndroid?"mobile":"PC"}var u=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},d=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},f=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function h(e){return e.split("?")[0]}function p(e,t){var n=e.includes("isMprDcm=1")?"speM:":["fasM:","staM:","speM:"][t+1],r=e.replace(/((|http|https):\/\/[^\/]*)|([&?](sign|Signature|Token|Authorization|AccessKeySecret|X-Subject-Token|X-Date|Date|Expires|t|X-Expires-At|isDcm|dicomInfo|isMprDcm|x-oss-process|imageMogr2\/format\/jpeg)[^&^?]*)/gi,"");return{imageTypeEN:n,indexedDBKeyPeel:r,indexedDBKey:n+r}}function m(e){var t,n;try{for(var r=f(d([],u(null==e?void 0:e.childNodes),!1)),o=r.next();!o.done;o=r.next()){var a=o.value;null==a||a.remove()}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}function v(e,t){var n=document.createElement("a");n.style.display="none",n.setAttribute("target","_blank"),t&&n.setAttribute("download",t),n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function g(e,t){var n=new Date(e),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[o]:("00"+r[o]).substr((""+r[o]).length)));return t}function y(e){if(e&&""!=e){var t=void 0;return e.indexOf("Y")>-1?t=e.replace("Y","岁"):e.indexOf("M")>-1?t=e.replace("M","月"):e.indexOf("W")>-1?t=e.replace("M","周"):e.indexOf("D")>-1&&(t=e.replace("D","天")),t||(t=e+"岁"),t.replace(/^0*/,"")}return""}function x(e){return e&&""!=e?"F"==(e=e.replace(/\s/g,""))?"女":"M"==e?"男":e:""}const b=JSON.parse('{"i8":"1.2.4_20240126"}');var w,T,I=c(),S=((null===(T=null===(w=window.performance)||void 0===w?void 0:w.memory)||void 0===T?void 0:T.jsHeapSizeLimit)||0)/1024/1024/1024,E=b.i8,C={instanceOptions:{},env:I,webDicomView:"",sharedArrayBuffer:!0,imageTypeDefault:"mobile"===I?0:1,_imageType:JSON.parse(localStorage.getItem("imageType")),get imageType(){var e;return null!==(e=this._imageType)&&void 0!==e?e:this.imageTypeDefault},set imageType(e){this._imageType=e,localStorage.setItem("imageType",String(e))},imageCacheTypeDefault:0,logoURL:n(6331),cavanAroundInfo:!0,minRenderCountMPR3D:10,preload:{scroll:!0,fullLoad:!1},AI:{resultURL:void 0,parseSuccess:!1,active:!1,jumpFirstAI:!1,getParseHandler:void 0},toolsBar:{VRTVisibility:!0,MPRVisibility:!0,AIVisibility:!0,enhanceVisibility:!1,aboutUsVisibility:!0,fastImageModeVisibility:!0},toolsOptions:{toolColor:"#FF7F0E",zoomTool:{minScale:.1,maxScale:100}},systemInfo:{jsHeapSizeLimit:S,performanceLevel:function(e){return e>=3.99?2:e>=2.5?1.5:e?1:.6}(S)},DBCacheImages:{dbName:"ClearDicomView",version:Number(null==E?void 0:E.replace(/[^\d]/g,"").slice(-6)),storeName:"cornerstoneStore",enableDefault:!0,_enable:JSON.parse(localStorage.getItem("enableDBCacheImages")),get enable(){var e;return null!==(e=this._enable)&&void 0!==e?e:this.enableDefault},set enable(e){var t=!!e;this._enable=t,localStorage.setItem("enableDBCacheImages",String(t))}},aboutUs:{imgURl:void 0,description:"给医生用户提供常用2D及MPR影像处理功能，支持多种影像加载模式。",originVersion:E,version:null==E?void 0:E.replace("_","."),copyright:"深圳市巨鼎医疗股份有限公司",tel:"400 800 5557"},tipRecord:{GPUBenchmarksSuccess:!1,sharedArrayBufferGuide:!1}},A=C.preload,M=C.toolsBar,P=C.AI,D=C.toolsOptions,k=C.systemInfo,O=C.DBCacheImages,L=C.aboutUs;const R=C;var _,N,U=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},B=(0,a.importInternal)("util/debounce"),j=t.imageCache.cachedImages,F=t.imageCache.setMaximumSizeBytes,V=(t.imageCache.getCacheInfo,t.imageCache.removeImageLoadObject),H=function(e){e!==t.EVENTS.IMAGE_CACHE_FULL&&(_=e)},z=function(e,n){var r,o;try{if("MPR"===_)return H(e);if(H(e),n||0===R.imageCacheTypeDefault&&R.DBCacheImages.enable&&j.length>10){0;var a=(0,t.getEnabledElements)().map((function(e){var t=e.image;return null==t?void 0:t.imageId})),i=j.map((function(e){return e.imageId}));try{for(var s=U(i),l=s.next();!l.done;l=s.next()){var c=l.value;a.includes(c)||V(c)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}0}}catch(e){console.log(e)}};N=function(e){var t=1073741824;return e>=2?t:e>=1.5?858993459.2:e>=1?644245094.4:e<1?429496729.6:void 0}(k.performanceLevel)*(O.enable?.8:1),F(N);var q=B(z,300,{leading:!1,trailing:!0}),W=n(4705),G=n.n(W),Y=n(5205),Z=n(2938),X=n.n(Z),Q=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},K=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},J=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},$=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},ee=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},te=O.dbName,ne=O.storeName,re=O.version,oe=new s.IndexedDB(te,ne,re),ae=new s.Once((function(e){var t=[],n=function(e,t){var n,r;try{for(var o=J(e.slice(0,t)),a=o.next();!a.done;a=o.next()){var i=a.value;oe.dispatch("delete",{},i)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}};oe.dispatch("count",{mode:"readonly"}).then((function(r){if(r>5e3){var o=Math.ceil(r*String.prototype.slice.call(r,0,1)*.1);oe.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.upperBound("".concat(e,"_0"))).then((function(r){t=r,r.length>=o?n(t,o):oe.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.lowerBound("".concat(e,"_z"))).then((function(e){t=ee(ee([],$(t),!1),$(e),!1),n(t,o)}))}))}r>15e3&&(console.log("数据量超过15000 执行清除!!!!"),oe.dispatch("clear"))}))})),ie=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB,se=function(){oe.open().then((function(){ae.run("com")}))};try{ie.databases().then((function(e){return Q(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,s;return K(this,(function(l){try{for(t=J(e),n=t.next();!n.done;n=t.next())if(r=n.value,o=r.name,a=r.version,o===te&&a!==re){ie.deleteDatabase(o),console.info("indexedDB is upgraded to version "+re);break}}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return se(),[2]}))}))}))}catch(e){se(),console.error(e)}const le=oe;var ce=n(1077),ue=n.n(ce),de=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},fe=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},he=new Map;const pe=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=he.get(e);if(o)return o.apply(void 0,fe([],de(n),!1));he.set(e,t),t.apply(void 0,fe([],de(n),!1))};var me=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},ve=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const ge=function(e,t,n,r,o){var a;void 0===n&&(n="error"),void 0===r&&(r=[void 0,void 0]);for(var i=[],l=5;l<arguments.length;l++)i[l-5]=arguments[l];var c=500*t.length+2e3;pe(e,(0,s.throttle)((function(){var e;null==o||o.apply(void 0,ve([],me(i),!1)),ue()[n]({title:t,timeout:null!==(e=r[1])&&void 0!==e?e:c})}),null!==(a=r[0])&&void 0!==a?a:c))};var ye=function(){return ye=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ye.apply(this,arguments)},xe=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},be=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};o()._renderWebImage=Y.renderWebImage,o().renderWebImage=void 0;var we=XMLHttpRequest.prototype,Te=we.open;we.open=function(e,t){this._url=t,Te.apply(this,arguments)};var Ie=function(){var e=!0;try{new OffscreenCanvas(0,0)}catch(t){e=!1}return e}(),Se=.5*(navigator.hardwareConcurrency||1)-(k.performanceLevel<=1.5?1:0),Ee=function(e){return xe(void 0,void 0,void 0,(function(){var t,n,r,o,a;return be(this,(function(i){switch(i.label){case 0:return t=-1===R.imageType,n=p(e,R.imageType),r=n.indexedDBKey,o=n.indexedDBKeyPeel,O.enable?(a=void 0,t?[4,le.dispatch("get",{mode:"readonly"},"staM:"+o)]:[3,2]):[3,5];case 1:a=i.sent(),i.label=2;case 2:return a?[3,4]:[4,le.dispatch("get",{mode:"readonly"},r)];case 3:a=i.sent(),i.label=4;case 4:return a?[2,Promise.resolve(a)]:[2,Promise.reject({indexedDBKey:r})];case 5:return[2,Promise.reject({indexedDBKey:r})]}}))}))},Ce=function(e){e.addEventListener("error",(function(e){ge("xhrError",navigator.onLine?"影像请求失败，请稍后再试":"检测到您的网络已断开，请打开网络开关！"),console.error(e)})),e.addEventListener("timeout",(function(){ge("xhrTimeout","影像请求超时，请稍后再试")}))};Y.external.cornerstone=o(),Z.external.cornerstone=o(),Z.external.dicomParser=G(),(0,Y.configure)({beforeSend:function(e){return xe(void 0,void 0,void 0,(function(){var t,n;return be(this,(function(r){switch(r.label){case 0:e._send=e.send,e.send=function(){},e.timeout=3e4,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Ee(e._url)];case 2:return t=r.sent(),Object.defineProperty(e,"response",{writable:!0}),e.response=t,e.onload(e),e=void 0,[3,4];case 3:return n=r.sent(),e._onload=e.onload,e.onload=function(){},Ce(e),e.addEventListener("load",(function(){return xe(void 0,void 0,void 0,(function(){var t,r,a,i,s,l,c,u,d;return be(this,(function(f){switch(f.label){case 0:return t=!0,!1,(a=o().metaData.get("generateGrayImageModule",e._url))?(i=a.photometricInterpretation,s=a.transferSyntaxUID,l=a.bitsAllocated,c=a.blocks,(r=c>1)&&(t=!1,ge("multiImage","暂不支持分片处理，请切换到专业模式")),r||(p=l,(h=i)?["RGB","YBR_FULL","YBR_FULL_422","YBR_RCT","YBR_ICT"].includes(h):p<=8)||"1.2.840.10008.1.2.2"===s?[3,3]:Ie?[4,Z.webWorkerManager.addTask("encryptionPngDecode",{buffer:e.response,info:ye({},a)},0).promise]:[3,2]):[3,3];case 1:return u=f.sent(),Object.defineProperty(e,"response",{writable:!0}),e.response=u,[3,3];case 2:t=!1,ge("isOffscreenCanvasSupported","浏览器版本过低，未支持离屏渲染，可能导致渲染异常，请切换到专业模式！"),f.label=3;case 3:return e._onload(e),d=n.indexedDBKey,t&&d&&le.dispatch("put",{},e.response,d),e=void 0,[2]}var h,p}))}))})),e._send(),[3,4];case 4:return[2]}}))}))}}),(0,Z.configure)({useWebWorkers:!0,strict:!0,decodeConfig:{convertFloatPixelDataToInt:!0,use16BitDataType:!1},beforeSend:function(e,t,n,r){return xe(void 0,void 0,void 0,(function(){var t,n;return be(this,(function(o){switch(o.label){case 0:e._send=e.send,e.send=function(){},e.timeout=3e4,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Ee(e._url)];case 2:return t=o.sent(),r.deferred.resolve(t),e=void 0,[3,4];case 3:return n=o.sent(),Ce(e),e.addEventListener("load",(function(){var t=n.indexedDBKey;t&&le.dispatch("put",{},e.response,t),e=void 0})),e._send(),[3,4];case 4:return[2]}}))}))}}),Z.webWorkerManager.initialize({maxWebWorkers:Math.max(Math.floor(Se),1),startWebWorkersOnDemand:!0,taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!0,strict:!0,loadCodecsOnStartup:!0},decodingoldPlatformImages:{}},webWorkerTaskPaths:["./encryptionPngDecode.worker.js","./610.min.worker.js","./888.min.worker.js"]});var Ae,Me=n(3605),Pe=n.n(Me),De=n(352),ke=n.n(De),Oe=(Ae=function(e,t){return Ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ae(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ae(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Le=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Re=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},_e=(0,a.importInternal)("base/BaseTool"),Ne=(0,a.importInternal)("util/debounce"),Ue=(0,a.importInternal)("tools/cursors").panCursor,Be=function(e){function n(n){void 0===n&&(n={});var r=this,o={name:"Blur",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ue};return(r=e.call(this,n,o)||this).touchDragCallback=r._dragCallback.bind(r),r.mouseDragCallback=r._dragCallback.bind(r),r.lazy=!1,r.updateViewport=Ne((function(e){var n=e.detail,o=n.element,i=n.deltaPoints.page.y,s=(0,t.getViewport)(o);if(s.blur||(s.blur=0),r.lazy=!1,i<0)s.blur+=1,s.blur>9&&(s.blur=9);else{if(!(i>0))return;s.blur-=1,s.blur<0&&(s.blur=0)}a.external.cornerstone.setViewport(o,s)}),300),r.updateCavansLazy=Ne((function(e){r.updateCavans(e)}),300),r}return Oe(n,e),n.prototype.updateCavans=function(e){return Le(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,l,c;return Re(this,(function(u){switch(u.label){case 0:return t=e.detail,n=t.enabledElement,r=t.viewport,o=t.canvasContext,a=r.blur,t&&n&&a?(i=o.canvas.width,s=o.canvas.height,l=o.getImageData(0,0,i,s),[4,Z.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"blur",sigma:a}}).promise]):[2];case 1:return c=u.sent(),o.putImageData(c,0,0),[2]}}))}))},n.prototype.renderToolData=function(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)},n.prototype._dragCallback=function(e){this.updateViewport(e)},n}(_e);const je=Be;var Fe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ve=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},He=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ze=(0,a.importInternal)("base/BaseTool"),qe=(0,a.importInternal)("util/debounce"),We=(0,a.importInternal)("tools/cursors").panCursor,Ge=function(e){function n(n){void 0===n&&(n={});var r=this,o={name:"Sharpen",supportedInteractionTypes:["Mouse","Touch"],svgCursor:We};return(r=e.call(this,n,o)||this).touchDragCallback=r._dragCallback.bind(r),r.mouseDragCallback=r._dragCallback.bind(r),r.lazy=!1,r.updateViewport=qe((function(e){var n=e.detail,o=n.element,i=n.deltaPoints.page.y,s=(0,t.getViewport)(o);if(s.sharpen||(s.sharpen=0),r.lazy=!1,i<0)s.sharpen+=1,s.sharpen>11&&(s.sharpen=11);else{if(!(i>0))return;s.sharpen-=1,s.sharpen<0&&(s.sharpen=0)}a.external.cornerstone.setViewport(o,s)}),300),r.updateCavansLazy=qe((function(e){r.updateCavans(e)}),300),r}return Fe(n,e),n.prototype.updateCavans=function(e){return Ve(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,l,c;return He(this,(function(u){switch(u.label){case 0:return t=e.detail,n=t.enabledElement,r=t.viewport,o=t.canvasContext,a=r.sharpen,t&&n&&a?(i=o.canvas.width,s=o.canvas.height,l=o.getImageData(0,0,i,s),[4,Z.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"sharpen",sigma:a}}).promise]):[2];case 1:return c=u.sent(),o.putImageData(c,0,0),[2]}}))}))},n.prototype.renderToolData=function(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)},n.prototype._dragCallback=function(e){this.updateViewport(e)},n}(ze);const Ye=Ge;var Ze=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Qe=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Ke=(0,a.importInternal)("base/BaseAnnotationTool"),Je=(0,a.importInternal)("manipulators/moveNewHandle"),$e=(0,a.importInternal)("drawing/getNewContext"),et=(0,a.importInternal)("drawing/draw"),tt=(0,a.importInternal)("drawing/drawHandles"),nt=(0,a.importInternal)("drawing/drawLinkedTextBox"),rt=(0,a.importInternal)("util/triggerEvent"),ot=(0,a.importInternal)("util/getRGBPixels"),at=(0,a.importInternal)("util/calculateSUV"),it=(0,a.importInternal)("util/getLogger"),st=(0,a.importInternal)("util/throttle"),lt=(0,a.importInternal)("tools/cursors").probeCursor,ct=it("tools:annotation:ProbeTool"),ut=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"ProbeCT",supportedInteractionTypes:["Mouse","Touch"],svgCursor:lt,configuration:{drawHandles:!0,renderDashed:!1}};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=st(n.updateCachedStats,110),n}return Ze(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:t.x,y:t.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}ct.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.end;if(o||ct.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.end);return a.external.cornerstoneMath.point.distance(s,n)<i},t.prototype.updateCachedStats=function(e,t,n){var r=Math.round(n.handles.end.x),o=Math.round(n.handles.end.y),i={};r>=0&&o>=0&&r<e.columns&&o<e.rows&&(i.x=r,i.y=o,e.color?i.storedPixels=ot(t,r,o,1,1):(i.storedPixels=a.external.cornerstone.getStoredPixels(t,r,o,1,1),i.sp=i.storedPixels[0],i.mo=i.sp*e.slope+e.intercept,i.suv=at(e,i.sp))),n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.renderDashed,s=(0,a.getToolState)(e.currentTarget,this.name);if(s)for(var l=$e(n.canvasContext.canvas),c=n.image,u=n.element,d=(0,a.getModule)("globalConfiguration").configuration.lineDash,f=function(e){var r=s.data[e];if(!1===r.visible)return"continue";et(l,(function(e){var s=a.toolColors.getColorIfActive(r);if(t.configuration.drawHandles){var l={handleRadius:o,color:s};i&&(l.lineDash=d),tt(e,n,r.handles,l)}!0===r.invalidated&&(r.cachedStats?t.throttledUpdateCachedStats(c,u,r):t.updateCachedStats(c,u,r));var f,h=[],p=r.cachedStats,m=p.x,v=p.y,g=p.storedPixels,y=p.sp,x=p.mo,b=p.suv;if(m>=0&&v>=0&&m<c.columns&&v<c.rows){if(f="X: ".concat(m,", Y: ").concat(v),c.color?h.push("R: ".concat(g[0]," G: ").concat(g[1]," B: ").concat(g[2])):(h.push("SP: ".concat(y," HU")),h.push("MO: ".concat(parseFloat(x.toFixed(3))," HU")),b&&h.push(" SUV: ".concat(parseFloat(b.toFixed(3))," HU"))),!r.handles.textBox.hasMoved){var w={x:r.handles.end.x,y:r.handles.end.y};r.handles.textBox.x=w.x,r.handles.textBox.y=w.y}var T=a.toolStyle.getToolWidth();nt(e,u,r.handles.textBox,Qe([f],Xe(h),!1),r.handles,(function(){return[{x:r.handles.end.x,y:r.handles.end.y}]}),s,T,10,!0)}}))},h=0;h<s.data.length;h++)f(h)},t.prototype.addNewMeasurement=function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r=e.detail,o=r.element,i=this.createNewMeasurement(r);i&&((0,a.addToolState)(o,this.name,i),a.external.cornerstone.updateImage(o),Je(r,this.name,i,i.handles.end,this.options,t,(function(e){if(e){var t=a.EVENTS.MEASUREMENT_COMPLETED,r={toolName:n.name,toolType:n.name,element:o,measurementData:i};rt(o,t,r)}else(0,a.removeToolState)(o,n.name,i)})))},t}(Ke);const dt=ut;var ft=(0,a.importInternal)("drawing/path");function ht(e,n,r,o,a,i,s){void 0===i&&(i="pixel"),"pixel"===i&&(r=(0,t.pixelToCanvas)(n,r)),ft(e,a,(function(e){e.arc(r.x,r.y,o,0,2*Math.PI)})),s&&ft(e,a,(function(e){e.font="".concat(o,"px lighter"),e.fillStyle="#ceff82";var t=e.measureText(s).width>>1;e.fillText(s,r.x-t,r.y+t)}))}var pt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mt=(0,a.importInternal)("base/BaseAnnotationTool"),vt=(0,a.importInternal)("tools/cursors").circleRoiCursor,gt=(0,a.importInternal)("drawing/getNewContext"),yt=(0,a.importInternal)("drawing/draw"),xt=(0,a.importInternal)("drawing/setShadow"),bt=(0,a.importInternal)("util/calculateSUV"),wt=(0,a.importInternal)("util/ellipseUtils").calculateEllipseStatistics,Tt=(0,a.importInternal)("util/getROITextBoxCoords"),It=(0,a.importInternal)("util/throttle"),St=(0,a.importInternal)("util/getPixelSpacing"),Et=function(e){function t(t){void 0===t&&(t={});var n=this,r=t.markerFlag,o=void 0===r?"L":r,a={name:"Ann"+o,supportedInteractionTypes:["Mouse","Touch"],svgCursor:vt,configuration:{renderDashed:!1,hideHandlesIfMoving:!0,type:o}};return(n=e.call(this,t,a)||this).markerFlag=o,n.throttledUpdateCachedStats=It(n.updateCachedStats,0),n}return pt(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end,i=a.external.cornerstoneMath.point.distance;if(o||console.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var s="mouse"===r?15:25,l=a.external.cornerstone.pixelToCanvas(e,t.handles.start),c=a.external.cornerstone.pixelToCanvas(e,t.handles.end),u=i(l,n),d=i(l,c);return u>d-s/2&&u<d+s/2},t.prototype.updateCachedStats=function(e,t,n){var r=(a.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=St(e),i=function(e,t,n,r,o){var i,s=(u=n.start,d=n.end,f=(0,ke().point.distance)(u,d),{left:Math.floor(Math.min(u.x-f,d.x)),top:Math.floor(Math.min(u.y-f,d.y)),width:2*f,height:2*f}),l=a.external.cornerstone.getPixels(t,s.left,s.top,s.width,s.height),c=wt(l,s);var u,d,f;"PT"===r&&(i={mean:bt(e,c.mean,!0)||0,stdDev:bt(e,c.stdDev,!0)||0});return{area:Math.PI*(s.width*(o.colPixelSpacing||1)/2)*(s.height*(o.rowPixelSpacing||1)/2)||0,count:c.count||0,mean:c.mean||0,variance:c.variance||0,stdDev:c.stdDev||0,min:c.min||0,max:c.max||0,meanStdDevSUV:i}}(e,t,n.handles,r,o);n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name);if(n){var r=a.external.cornerstoneMath.point.distance,o=e.detail,i=o.image,s=o.element,l=o.canvasContext,c=this.configuration.renderDashed,u=gt(l.canvas),d=(0,a.getModule)("globalConfiguration").configuration.lineDash;yt(u,(function(e){for(var l=0;l<n.data.length;l++){var u=n.data[l];if(!1!==u.visible){var f=a.toolColors.getColorIfActive(u)||"#ff8000";xt(e,t.configuration);var h=a.external.cornerstone.pixelToCanvas(s,u.handles.start),p=a.external.cornerstone.pixelToCanvas(s,u.handles.end),m=r(h,p),v={color:f,lineDash:void 0};if(c&&(v.lineDash=d),ht(e,s,u.handles.start,m,v,"pixel",t.markerFlag),!0===u.invalidated&&(u.cachedStats?t.throttledUpdateCachedStats(i,s,u):t.updateCachedStats(i,s,u)),!u.handles.textBox.hasMoved){var g=Tt(o.viewport,u.handles);Object.assign(u.handles.textBox,g)}}}}))}},t}(mt);const Ct=Et;var At=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Mt=function(){return Mt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mt.apply(this,arguments)},Pt=(0,a.importInternal)("base/BaseAnnotationTool"),Dt=(0,a.importInternal)("drawing/getNewContext"),kt=(0,a.importInternal)("drawing/draw"),Ot=(0,a.importInternal)("drawing/setShadow"),Lt=(0,a.importInternal)("drawing/drawLine"),Rt=(0,a.importInternal)("drawing/drawLinkedTextBox"),_t=(0,a.importInternal)("drawing/drawHandles"),Nt=(0,a.importInternal)("util/lineSegDistance"),Ut=(0,a.importInternal)("util/getLogger"),Bt=(0,a.importInternal)("util/throttle"),jt=(0,a.importInternal)("util/getPixelSpacing"),Ft=Ut?Ut("tools:annotation:LengthTool"):console,Vt=(0,a.importInternal)("tools/cursors").bidirectionalCursor,Ht=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Heartratio",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Vt,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=Bt(n.updateCachedStats,110),n}return At(t,e),t.prototype.createNewMeasurement=function(e){var t=e||{currentPoints:{}},n=t.currentPoints.image,r=t.image;if(n){var o=n.x,a=n.y,i=r||{},s=i.columns,l=i.rows;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:o,y:a,highlight:!0,active:!1},end:{x:o,y:a,highlight:!0,active:!0},start2:{x:.6*o,y:Math.min(1.35*a,.9*l),highlight:!0,active:!1},end2:{x:Math.min(1.75*o,s),y:Math.min(1.35*a,.9*l),highlight:!0,active:!0},start3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},end3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}Ft.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){if(!((null==t?void 0:t.handles.start)&&(null==t?void 0:t.handles.end)))return Ft.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1;if(!1===t.visible)return!1;var o="mouse"===r?15:25;return Nt(e,t.handles.start,t.handles.end,n)<o||Nt(e,t.handles.start2,t.handles.end2,n)<o||Nt(e,t.handles.start3,t.handles.end3,n)<o},t.prototype.updateCachedStats=function(e,t,n){var r=jt(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=n.handles,s=i.start,l=i.end,c=i.start2,u=i.end2,d=Math.abs(l.x-s.x)*(a||1),f=Math.abs(u.x-c.x)*(o||1),h=d>f?f/d:d/f;n.ratio=h,n.handles.start3.x=(s.x+l.x)/2,n.handles.start3.y=(s.y+l.y)/2,n.handles.end3.x=(c.x+u.x)/2,n.handles.end3.y=(c.y+u.y)/2,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=(0,a.getToolState)(e.currentTarget,this.name);if(c)for(var u=Dt(n.canvasContext.canvas),d=n.image,f=n.element,h=a.toolStyle.getToolWidth(),p=(0,a.getModule)("globalConfiguration").configuration.lineDash,m=function(e){var r=c.data[e],m=r.handles,v=m.start,y=m.end,x=m.start2,b=m.end2,w=m.start3,T=m.end3;if(!1===r.visible)return"continue";kt(u,(function(e){Ot(e,t.configuration);var c=a.toolColors.getColorIfActive(r),u={color:c,lineDash:void 0};l&&(u.lineDash=p),Lt(e,f,v,y,u),Lt(e,f,x,b,u),Lt(e,f,w,T,Mt(Mt({},u),{lineDash:p}));var m={color:c,handleRadius:o,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&r.active&&_t(e,n,r.handles,m),!r.handles.textBox.hasMoved){var I={x:(w.x+T.x)/2,y:(w.y+T.y)/2};r.handles.textBox.x=I.x,r.handles.textBox.y=I.y}!0===r.invalidated&&(r.ratio?t.throttledUpdateCachedStats(d,f,r):t.updateCachedStats(d,f,r)),Rt(e,f,r.handles.textBox,"ratio:".concat(r.ratio.toFixed(3)),r.handles,g,c,h,5,!0)}))},v=0;v<c.data.length;v++)m(v);function g(e){var t=e.start,n=e.end,r=e.start2,o=e.end2,a=e.start3,i=e.end3;return[{x:(a.x+i.x)/2,y:(a.y+i.y)/2},t,n,r,o]}},t}(Pt);const zt=Ht;function qt(e,t,n,r){var o=(0,s.env)(),a=o.isWeChat,i=o.isAndroid;a&&i&&alert(e+"\n安卓版微信,请点击下方确定后，再输入!");var l=window.prompt(e,r),c=(0,s.dataType)(t),u=!0;if(null!==l){switch(""===l&&r&&a&&(l=r),c){case"RegExp":u=t.test(l);break;case"function":u=t(l);break;default:console.error("interceptor required for RegExp or Function")}if(!u)return qt(e.includes(n)?e:e+"\n"+n,t,n,r)}return l}var Wt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gt=(0,a.importInternal)("base/BaseAnnotationTool"),Yt=(0,a.importInternal)("manipulators/moveNewHandle"),Zt=(0,a.importInternal)("util/pointInsideBoundingBox"),Xt=(0,a.importInternal)("util/lineSegDistance"),Qt=(0,a.importInternal)("util/triggerEvent"),Kt=(0,a.importInternal)("drawing/drawLinkedTextBox"),Jt=(0,a.importInternal)("drawing/getNewContext"),$t=(0,a.importInternal)("drawing/draw"),en=(0,a.importInternal)("drawing/setShadow"),tn=(0,a.importInternal)("drawing/drawArrow"),nn=(0,a.importInternal)("drawing/drawHandles"),rn=(0,a.importInternal)("drawing/textBoxWidth"),on=(0,a.importInternal)("tools/cursors").arrowAnnotateCursor,an=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:ln,changeTextCallback:cn,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:on};return(n=e.call(this,t,r)||this).preventNewMeasurement=!1,n}return Wt(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){if(!1===t.visible)return!1;var o="mouse"===r?15:25;return Xt(e,t.handles.start,t.handles.end,n)<o},t.prototype.updateCachedStats=function(){},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=n.element,o=n.enabledElement,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=i.renderDashed,d=(0,a.getToolState)(r,this.name);if(d){var f,h=e.detail.canvasContext.canvas,p=Jt(h),m=a.toolStyle.getToolWidth();u&&(f=(0,a.getModule)("globalConfiguration").configuration.lineDash);for(var v=function(n){var i=d.data[n];if(!1===i.visible)return"continue";$t(p,(function(n){en(n,t.configuration);var u=a.toolColors.getColorIfActive(i),d=a.external.cornerstone.pixelToCanvas(r,i.handles.start),h=a.external.cornerstone.pixelToCanvas(r,i.handles.end);t.configuration.arrowFirst?tn(n,h,d,u,m,f):tn(n,d,h,u,m,f);var p={color:u,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&i.active&&nn(n,e.detail,i.handles,p);var v=function(e){return e.text}(i);if(v&&""!==v){var g=rn(n,v,5),x=a.textStyle.getFontSize()+10,b=Math.max(g,x)/2+5;if(h.x<d.x&&(b=-b),!i.handles.textBox.hasMoved){var w=void 0;w=t.configuration.arrowFirst?{x:h.x-g/2+b,y:h.y-x/2}:{x:d.x-g/2-b,y:d.y-x/2};var T=a.external.cornerstone.internal.getTransform(o);T.invert();var I=T.transformPoint(w.x,w.y);i.handles.textBox.x=I.x,i.handles.textBox.y=I.y}Kt(n,r,i.handles.textBox,v,i.handles,y,u,m,0,!1)}}))},g=0;g<d.data.length;g++)v(g)}function y(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this,r=e.detail.element,o=this.createNewMeasurement(e),i=this.configuration.allowEmptyLabel;(0,a.addToolState)(r,this.name,o),a.external.cornerstone.updateImage(r),Yt(e.detail,this.name,o,o.handles.end,this.options,t,(function(t){t?void 0===o.text&&n.configuration.getTextCallback((function(e){if(e||i){o.text=e,o.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:o};a.external.cornerstone.updateImage(r),Qt(r,a.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,a.removeToolState)(r,n.name,o)}),e.detail):(0,a.removeToolState)(r,n.name,o),a.external.cornerstone.updateImage(r)}))},t.prototype.doubleClickCallback=function(e){return this._updateTextForNearbyAnnotation(e,"mouse")},t.prototype.touchPressCallback=function(e){return this._updateTextForNearbyAnnotation(e,"touch")},t.prototype._updateTextForNearbyAnnotation=function(e,t){var n=e.detail.element,r=e.detail.currentPoints.canvas,o=(0,a.getToolState)(n,this.name);if(!o)return!1;for(var i=0;i<o.data.length;i++){var s=o.data[i];if(this.pointNearTool(n,s,r,t)||Zt(s.handles.textBox,r))return s.active=!0,a.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(s,e.detail,this._doneChangingTextCallback.bind(this,n,s)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}},t.prototype._doneChangingTextCallback=function(e,t,n,r){!0===r?(0,a.removeToolState)(e,this.name,t):t.text=n,t.active=!1,a.external.cornerstone.updateImage(e),Qt(e,a.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})},t}(Gt);const sn=an;function ln(e){e(qt("输入注释"))}function cn(e,t,n){n(qt("更改注释"))}var un=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),dn=(0,a.importInternal)("base/BaseAnnotationTool"),fn=(0,a.importInternal)("manipulators/moveNewHandle"),hn=(0,a.importInternal)("util/pointInsideBoundingBox"),pn=(0,a.importInternal)("util/triggerEvent"),mn=(0,a.importInternal)("util/getLogger"),vn=(0,a.importInternal)("drawing/drawLinkedTextBox"),gn=(0,a.importInternal)("drawing/getNewContext"),yn=(0,a.importInternal)("drawing/draw"),xn=(0,a.importInternal)("drawing/setShadow"),bn=(0,a.importInternal)("drawing/drawHandles"),wn=(0,a.importInternal)("drawing/textBoxWidth"),Tn=(0,a.importInternal)("tools/cursors").textMarkerCursor,In=mn("tools:annotation:ProbeTool"),Sn=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Annotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Cn,changeTextCallback:An,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,allowEmptyLabel:!1},svgCursor:Tn};return(n=e.call(this,t,r)||this).preventNewMeasurement=!1,n}return un(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.end;if(o||In.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i=a.external.cornerstone.pixelToCanvas(e,t.handles.end),s="mouse"===r?15:25;return a.external.cornerstoneMath.point.distance(i,n)<s},t.prototype.updateCachedStats=function(){},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=n.element,o=n.enabledElement,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=(0,a.getToolState)(r,this.name);if(u)for(var d=e.detail.canvasContext.canvas,f=gn(d),h=a.toolStyle.getToolWidth(),p=function(n){var i=u.data[n];if(!1===i.visible)return"continue";yn(f,(function(n){xn(n,t.configuration);var u=a.toolColors.getColorIfActive(i),d=a.external.cornerstone.pixelToCanvas(r,i.handles.end),f={color:u,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&bn(n,e.detail,i.handles,f);var p=function(e){return e.text}(i);if(p&&""!==p){var m=wn(n,p,5),g=a.textStyle.getFontSize()+10,y=Math.max(m,g)/2+5;if(!i.handles.textBox.hasMoved){var x={x:d.x-m/2+y,y:d.y-g/2},b=a.external.cornerstone.internal.getTransform(o);b.invert();var w=b.transformPoint(x.x,x.y);i.handles.textBox.x=w.x,i.handles.textBox.y=w.y}vn(n,r,i.handles.textBox,p,i.handles,v,u,h,0,!1)}}))},m=0;m<u.data.length;m++)p(m);function v(e){return[e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this,r=e.detail.element,o=this.createNewMeasurement(e),i=this.configuration.allowEmptyLabel;(0,a.addToolState)(r,this.name,o),a.external.cornerstone.updateImage(r),fn(e.detail,this.name,o,o.handles.end,this.options,t,(function(t){t?void 0===o.text&&n.configuration.getTextCallback((function(e){if(e||i){o.text=e,o.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:o};a.external.cornerstone.updateImage(r),pn(r,a.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,a.removeToolState)(r,n.name,o)}),e.detail):(0,a.removeToolState)(r,n.name,o),a.external.cornerstone.updateImage(r)}))},t.prototype.doubleClickCallback=function(e){return this._updateTextForNearbyAnnotation(e,"mouse")},t.prototype.touchPressCallback=function(e){return this._updateTextForNearbyAnnotation(e,"touch")},t.prototype._updateTextForNearbyAnnotation=function(e,t){var n=e.detail.element,r=e.detail.currentPoints.canvas,o=(0,a.getToolState)(n,this.name);if(!o)return!1;for(var i=0;i<o.data.length;i++){var s=o.data[i];if(this.pointNearTool(n,s,r,t)||hn(s.handles.textBox,r))return s.active=!0,a.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(s,e.detail,this._doneChangingTextCallback.bind(this,n,s)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}},t.prototype._doneChangingTextCallback=function(e,t,n,r){!0===r?(0,a.removeToolState)(e,this.name,t):t.text=n,t.active=!1,a.external.cornerstone.updateImage(e),pn(e,a.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})},t}(dn);const En=Sn;function Cn(e){e(qt("输入文本"))}function An(e,t,n){n(qt("更改文本"))}var Mn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pn=(0,a.importInternal)("base/BaseTool"),Dn=(0,a.importInternal)("util/getPixelSpacing"),kn=(0,a.importInternal)("drawing/getNewContext"),On=(0,a.importInternal)("drawing/draw"),Ln=(0,a.importInternal)("drawing/setShadow"),Rn=(0,a.importInternal)("drawing/drawLine"),_n=(0,a.importInternal)("drawing/drawTextBox"),Nn=(0,a.importInternal)("util/getLogger")("tools:ScaleOverlayTool"),Un=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"ScaleOverlay",configuration:{minorTickLength:14,majorTickLength:24},mixins:["enabledOrDisabledBinaryTool"]})||this}return Mn(t,e),t.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.forceImageUpdate=function(e){a.external.cornerstone.getEnabledElement(e).image&&a.external.cornerstone.updateImage(e)},t.prototype.renderToolData=function(e){var t=e.detail,n=kn(t.canvasContext.canvas),r=t.image,o=t.viewport,i=t.element;if(!(o.scale<.3)){var s=Dn(r),l=s.rowPixelSpacing,c=s.colPixelSpacing;if(l&&c){var u={width:n.canvas.width,height:n.canvas.height},d=10/l*o.scale,f=10/c*o.scale,h=jn(u,.25,.05),p=jn(u,.05,.2);if(u.width&&u.height&&h&&p){var m=a.toolColors.getToolColor(),v=a.toolStyle.getToolWidth(),g=Object.assign({},{hscaleBounds:h,vscaleBounds:p,verticalMinorTick:d,horizontalMinorTick:f,verticalLine:{start:{x:p.bottomRight.x,y:p.topLeft.y},end:{x:p.bottomRight.x,y:p.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:m,lineWidth:v},this.configuration);On(n,(function(e){Ln(e,g),Rn(e,i,g.verticalLine.start,g.verticalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),Fn(e,i,g),Rn(e,i,g.horizontalLine.start,g.horizontalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),Vn(e,i,g)}))}}else Nn.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}},t}(Pn);const Bn=Un;var jn=function(e,t,n){var r=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),a={left:r,top:o,width:e.width-2*r,height:e.height-2*o};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},Fn=function(e,t,n){for(var r=0,o=n.color,i=n.lineWidth;n.verticalLine.start.y+r*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var s={x:n.verticalLine.start.x,y:n.verticalLine.start.y+r*n.verticalMinorTick},l={x:0,y:n.verticalLine.start.y+r*n.verticalMinorTick};l.x=r%10==0?n.verticalLine.start.x-n.majorTickLength:r%5==0?n.verticalLine.start.x-n.minorTickLength:n.verticalLine.start.x-n.minorTickLength/2,Rn(e,t,s,l,{color:o,lineWidth:i},"canvas"),r++}var c=10*(r-1)+"mm";_n(e,c,n.verticalLine.end.x-e.measureText(c).width-10,n.verticalLine.end.y,a.toolColors.getToolColor())},Vn=function(e,t,n){var r=0,o=n.color,i=n.lineWidth;for(n.horizontalMinorTick!==n.verticalMinorTick&&(n.horizontalMinorTick=n.verticalMinorTick);n.horizontalLine.start.x+r*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var s={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:n.horizontalLine.start.y},l={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:0};l.y=r%10==0?n.horizontalLine.start.y-n.majorTickLength:r%5==0?n.horizontalLine.start.y-n.minorTickLength:n.horizontalLine.start.y-n.minorTickLength/2,Rn(e,t,s,l,{color:o,lineWidth:i},"canvas"),r++}_n(e,10*(r-1)+"mm",n.horizontalLine.end.x,n.horizontalLine.end.y-a.textStyle.getFontSize(),a.toolColors.getToolColor())},Hn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zn=function(){return zn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},zn.apply(this,arguments)},qn=(0,a.importInternal)("base/BaseAnnotationTool"),Wn=(0,a.importInternal)("manipulators/getHandleNearImagePoint"),Gn=(0,a.importInternal)("drawing/getNewContext"),Yn=(0,a.importInternal)("drawing/draw"),Zn=(0,a.importInternal)("drawing/setShadow"),Xn=(0,a.importInternal)("drawing/drawEllipse"),Qn=(0,a.importInternal)("drawing/drawLinkedTextBox"),Kn=(0,a.importInternal)("drawing/drawLine"),Jn=(0,a.importInternal)("drawing/drawHandles"),$n=(0,a.importInternal)("util/getROITextBoxCoords"),er=(0,a.importInternal)("util/numbersWithCommas"),tr=(0,a.importInternal)("util/calculateSUV"),nr=(0,a.importInternal)("util/ellipseUtils"),rr=nr.calculateEllipseStatistics,or=nr.pointInEllipse,ar=(0,a.importInternal)("util/getLogger"),ir=(0,a.importInternal)("util/throttle"),sr=(0,a.importInternal)("util/getPixelSpacing"),lr=ar?ar("tools:annotation:LengthTool"):console,cr=(0,a.importInternal)("tools/cursors").ellipticalRoiCursor,ur=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:cr};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=ir(n.updateCachedStats,110),n.throttledHandlesMove=ir(fr,0),n}return Hn(t,e),t.prototype.createNewMeasurement=function(e){var t=e||{currentPoints:{}},n=t.currentPoints.image;t.image;if(n)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};lr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||lr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;if(Wn(e,t.handles,n,6))return!0;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.start),l=a.external.cornerstone.pixelToCanvas(e,t.handles.end),c={left:Math.min(s.x,l.x)+i/2,top:Math.min(s.y,l.y)+i/2,width:Math.abs(s.x-l.x)-i,height:Math.abs(s.y-l.y)-i},u={left:Math.min(s.x,l.x)-i/2,top:Math.min(s.y,l.y)-i/2,width:Math.abs(s.x-l.x)+i,height:Math.abs(s.y-l.y)+i},d=or(c,n);return!(!or(u,n)||d)},t.prototype.updateCachedStats=function(e,t,n){var r=(a.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=sr(e),i=function(e,t,n,r,o){var i,s=vr(n.start,n.end),l=a.external.cornerstone.getPixels(t,s.left,s.top,s.width,s.height),c=rr(l,s);"PT"===r&&(i={mean:tr(e,c.mean,!0)||0,stdDev:tr(e,c.stdDev,!0)||0});return{area:Math.PI*(s.width*(o.colPixelSpacing||1)/2)*(s.height*(o.rowPixelSpacing||1)/2)||0,count:c.count||0,mean:c.mean||0,variance:c.variance||0,stdDev:c.stdDev||0,min:c.min||0,max:c.max||0,meanStdDevSUV:i,handles:JSON.parse(JSON.stringify(n))}}(e,t,n.handles,r,o);n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,i=r.element,s=a.toolStyle.getToolWidth(),l=(0,a.getModule)("globalConfiguration").configuration.lineDash,c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,f=c.hideHandlesIfMoving,h=c.renderDashed,p=Gn(r.canvasContext.canvas),m=sr(o),v=m.rowPixelSpacing,g=m.colPixelSpacing,y=(a.external.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,x=v&&g;Yn(p,(function(e){for(var c=0;c<n.data.length;c++){var p=n.data[c];if(!1!==p.visible){var m=a.toolColors.getColorIfActive(p),v={color:m,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:f};Zn(e,t.configuration);var g={color:m};if(h&&(g.lineDash=l),Xn(e,i,p.handles.start,p.handles.end,g,"pixel",p.handles.initialRotation),t.configuration.drawHandles&&p.active){Jn(e,r,zn(zn({},p.handles),{top:{drawnIndependently:!0},left:{drawnIndependently:!0},bottom:{drawnIndependently:!0},right:{drawnIndependently:!0}}),v);var b={color:m,lineWidth:s,lineDash:[2,3]};Kn(e,i,p.handles.start,p.handles.end,b)}if(!0===p.invalidated&&(p.cachedStats?t.throttledUpdateCachedStats(o,i,p):t.updateCachedStats(o,i,p)),!p.handles.textBox.hasMoved){var w=$n(r.viewport,p.handles);Object.assign(p.handles.textBox,w)}var T=mr(e,o.color,p.cachedStats,y,x,t.configuration);p.unit=pr(y,t.configuration.showHounsfieldUnits),Qn(e,i,p.handles.textBox,T,p.handles,(function(e){return hr(e.start,e.end)}),m,s,10,!0)}}}))}},t}(qn);const dr=ur;function fr(e,t){var n=e.top,r=e.left,o=e.bottom,a=e.right,i=t.top,s=t.left,l=t.bottom,c=t.right;n.active?(e.start.y+=n.y-i.y,e.top.x=o.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):r.active?(e.start.x+=r.x-s.x,e.left.y=a.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2):o.active?(e.end.y+=o.y-l.y,e.bottom.x=n.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):a.active&&(e.end.x+=a.x-c.x,e.right.y=r.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2)}function hr(e,t){var n=vr(e,t),r=n.left,o=n.top,a=n.width,i=n.height;return[{x:r+a/2,y:o},{x:r,y:o+i/2},{x:r+a/2,y:o+i},{x:r+a,y:o+i/2}]}function pr(e,t){return"CT"===e&&!1!==t?"HU":""}function mr(e,t,n,r,o,a){var i=void 0===n?{}:n,s=i.area,l=i.mean,c=i.stdDev,u=i.min,d=i.max,f=i.meanStdDevSUV;void 0===a&&(a={});var h=a.showMinMax||!1,p=[],m=[];if(!t){var v=f&&0!==f.mean,g=pr(r,a.showHounsfieldUnits),y="Mean: ".concat(er(l.toFixed(2))," ").concat(g),x="Std Dev: ".concat(er(c.toFixed(2))," ").concat(g);if(v){for(var b=" SUV: ",w="".concat(b).concat(er(f.mean.toFixed(2))),T="".concat(b).concat(er(f.stdDev.toFixed(2))),I=Math.floor(e.measureText("".concat(x,"     ")).width);e.measureText(y).width<I;)y+=" ";m.push("".concat(y).concat(w)),m.push("".concat(x,"     ").concat(T))}else m.push("".concat(y)),m.push("".concat(x));if(h){var S="Min: ".concat(u," ").concat(g),E="Max: ".concat(d," ").concat(g);for(I=v?Math.floor(e.measureText("".concat(x,"     ")).width):Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(S).width<I;)S+=" ";m.push("".concat(S).concat(E))}}return p.push(function(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(er(e.toFixed(2))).concat(n)}(s,o)),m.forEach((function(e){return p.push(e)})),p}function vr(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var gr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yr=(0,a.importInternal)("base/BaseAnnotationTool"),xr=(0,a.importInternal)("drawing/getNewContext"),br=(0,a.importInternal)("drawing/draw"),wr=(0,a.importInternal)("drawing/setShadow"),Tr=(0,a.importInternal)("drawing/drawRect"),Ir=(0,a.importInternal)("drawing/drawLinkedTextBox"),Sr=(0,a.importInternal)("drawing/drawHandles"),Er=(0,a.importInternal)("util/getLogger"),Cr=(0,a.importInternal)("util/throttle"),Ar=(0,a.importInternal)("util/getPixelSpacing"),Mr=(0,a.importInternal)("util/calculateSUV"),Pr=(0,a.importInternal)("util/getROITextBoxCoords"),Dr=(0,a.importInternal)("util/numbersWithCommas"),kr=Er?Er("tools:annotation:LengthTool"):console,Or=(0,a.importInternal)("tools/cursors").rectangleRoiCursor,Lr=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Or};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=Cr(n.updateCachedStats,110),n}return gr(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};kr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||kr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.start),l=a.external.cornerstone.pixelToCanvas(e,t.handles.end),c={left:Math.min(s.x,l.x),top:Math.min(s.y,l.y),width:Math.abs(s.x-l.x),height:Math.abs(s.y-l.y)};return a.external.cornerstoneMath.rect.distanceToPoint(c,n)<i},t.prototype.updateCachedStats=function(e,t,n){var r=(a.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=Ar(e),i=function(e,t,n,r,o){var i,s=_r(n.start,n.end),l=function(e,t){for(var n=0,r=0,o=0,a=0,i=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[a],r+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),o++,a++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=r/o-u*u;return{count:o,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}}(a.external.cornerstone.getPixels(t,s.left,s.top,s.width,s.height),s);"PT"===r&&(i={mean:Mr(e,l.mean,!0)||0,stdDev:Mr(e,l.stdDev,!0)||0});var c=s.width*(o.colPixelSpacing||1)*(s.height*(o.rowPixelSpacing||1)),u=2*s.width*(o.colPixelSpacing||1)+2*s.height*(o.rowPixelSpacing||1);return{area:c||0,perimeter:u,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:i}}(e,t,n.handles,r,o);n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,i=r.element,s=a.toolStyle.getToolWidth(),l=(0,a.getModule)("globalConfiguration").configuration.lineDash,c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,f=c.hideHandlesIfMoving,h=c.renderDashed,p=xr(r.canvasContext.canvas),m=Ar(o),v=m.rowPixelSpacing,g=m.colPixelSpacing,y=(a.external.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,x=v&&g;br(p,(function(e){for(var c=0;c<n.data.length;c++){var p=n.data[c];if(!1!==p.visible){var m=a.toolColors.getColorIfActive(p),v={color:m,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:f};wr(e,t.configuration);var g={color:m};if(h&&(g.lineDash=l),Tr(e,i,p.handles.start,p.handles.end,g,"pixel",p.handles.initialRotation),t.configuration.drawHandles&&p.active&&Sr(e,r,p.handles,v),!0===p.invalidated&&(p.cachedStats?t.throttledUpdateCachedStats(o,i,p):t.updateCachedStats(o,i,p)),!p.handles.textBox.hasMoved){var b=Pr(r.viewport,p.handles);Object.assign(p.handles.textBox,b)}var w=Br(e,o.color,p.cachedStats,y,x,t.configuration);p.unit=Ur(y,t.configuration.showHounsfieldUnits),Ir(e,i,p.handles.textBox,w,p.handles,(function(e){return Nr(e.start,e.end)}),m,s,10,!0)}}}))}},t}(yr);const Rr=Lr;function _r(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function Nr(e,t){var n=_r(e,t),r=n.left,o=n.top,a=n.width,i=n.height;return[{x:r+a/2,y:o},{x:r,y:o+i/2},{x:r+a/2,y:o+i},{x:r+a,y:o+i/2}]}function Ur(e,t){return"CT"===e&&!1!==t?"HU":""}function Br(e,t,n,r,o,a){var i=n.area,s=n.mean,l=n.stdDev,c=n.min,u=n.max,d=n.meanStdDevSUV;void 0===a&&(a={});var f=a.showMinMax||!1,h=[],p=[];if(!t){var m=d&&0!==d.mean,v=Ur(r,a.showHounsfieldUnits),g="Mean: ".concat(Dr(s.toFixed(2))," ").concat(v),y="Std Dev: ".concat(Dr(l.toFixed(2))," ").concat(v);if(m){for(var x=" SUV: ",b="".concat(x).concat(Dr(d.mean.toFixed(2))),w="".concat(x).concat(Dr(d.stdDev.toFixed(2))),T=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(g).width<T;)g+=" ";p.push("".concat(g).concat(b)),p.push("".concat(y,"     ").concat(w))}else p.push("".concat(g)),p.push("".concat(y));if(f){var I="Min: ".concat(c," ").concat(v),S="Max: ".concat(u," ").concat(v);for(T=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(g,"     ")).width);e.measureText(I).width<T;)I+=" ";p.push("".concat(I).concat(S))}}return h.push(function(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Dr(e.toFixed(2))).concat(n)}(i,o)),p.forEach((function(e){return h.push(e)})),h}var jr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fr=(0,a.importInternal)("base/BaseAnnotationTool"),Vr=(0,a.importInternal)("drawing/getNewContext"),Hr=(0,a.importInternal)("drawing/draw"),zr=(0,a.importInternal)("drawing/setShadow"),qr=(0,a.importInternal)("drawing/drawLinkedTextBox"),Wr=(0,a.importInternal)("drawing/drawLine"),Gr=(0,a.importInternal)("drawing/drawHandles"),Yr=(0,a.importInternal)("util/getLogger"),Zr=(0,a.importInternal)("util/throttle"),Xr=(0,a.importInternal)("util/getPixelSpacing"),Qr=(0,a.importInternal)("util/lineSegDistance"),Kr=Yr?Yr("tools:annotation:LengthTool"):console,Jr=(0,a.importInternal)("tools/cursors").lengthCursor,$r=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Jr,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=Zr(n.updateCachedStats,110),n}return jr(t,e),t.prototype.createNewMeasurement=function(e){var t,n=null===(t=null==e?void 0:e.currentPoints)||void 0===t?void 0:t.image;if(n){var r=n.x,o=n.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:r,y:o,highlight:!0,active:!1},end:{x:r,y:o,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}Kr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){if(!(t&&t.handles&&t.handles.start&&t.handles.end))return Kr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1;if(!1===t.visible)return!1;var o="mouse"===r?15:25;return Qr(e,t.handles.start,t.handles.end,n)<o},t.prototype.updateCachedStats=function(e,t,n){var r=Xr(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(n.handles.end.x-n.handles.start.x)*(a||1),s=(n.handles.end.y-n.handles.start.y)*(o||1),l=Math.sqrt(i*i+s*s);n.length=l,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=r.digits,u=(0,a.getToolState)(e.currentTarget,this.name);if(u)for(var d=Vr(n.canvasContext.canvas),f=n.image,h=n.element,p=Xr(f),m=p.rowPixelSpacing,v=p.colPixelSpacing,g=a.toolStyle.getToolWidth(),y=(0,a.getModule)("globalConfiguration").configuration.lineDash,x=function(e){var r=u.data[e];if(!1===r.visible)return"continue";Hr(d,(function(e){zr(e,t.configuration);var u=a.toolColors.getColorIfActive(r),d={color:u};l&&(d.lineDash=y),Wr(e,h,r.handles.start,r.handles.end,d);var p={color:u,handleRadius:o,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&r.active&&Gr(e,n,r.handles,p),!r.handles.textBox.hasMoved){var x={x:Math.max(r.handles.start.x,r.handles.end.x)};x.x===r.handles.start.x?x.y=r.handles.start.y:x.y=r.handles.end.y,r.handles.textBox.x=x.x,r.handles.textBox.y=x.y}!0===r.invalidated&&(r.length?t.throttledUpdateCachedStats(f,h,r):t.updateCachedStats(f,h,r));var b=function(e,t,n){var r=(o=e.length,a=Number(o),isNaN(a)?void 0:a);var o,a;if(!r)return"";var i="mm";t&&n||(i="pixels");return e.unit=i,"".concat(r.toFixed(c)," ").concat(i)}(r,m,v);qr(e,h,r.handles.textBox,b,r.handles,w,u,g,10,!0)}))},b=0;b<u.data.length;b++)x(b);function w(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}},t}(Fr);const eo=$r;var to=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),no=(0,a.importInternal)("base/BaseAnnotationTool"),ro=(0,a.importInternal)("manipulators/moveNewHandle"),oo=(0,a.importInternal)("drawing/getNewContext"),ao=(0,a.importInternal)("drawing/draw"),io=(0,a.importInternal)("drawing/setShadow"),so=(0,a.importInternal)("drawing/drawJoinedLines"),lo=(0,a.importInternal)("drawing/drawLinkedTextBox"),co=(0,a.importInternal)("drawing/drawHandles"),uo=(0,a.importInternal)("util/triggerEvent"),fo=(0,a.importInternal)("util/lineSegDistance"),ho=(0,a.importInternal)("util/roundToDecimal"),po=(0,a.importInternal)("util/throttle"),mo=(0,a.importInternal)("util/getPixelSpacing"),vo=(0,a.importInternal)("drawing/textBoxWidth"),go=(0,a.importInternal)("tools/cursors").angleCursor,yo=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:go,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,r)||this).preventNewMeasurement=!1,n.throttledUpdateCachedStats=po(n.updateCachedStats,110),n}return to(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){if(!1===t.visible)return!1;var o="mouse"===r?15:25;return fo(e,t.handles.start,t.handles.middle,n)<o||fo(e,t.handles.middle,t.handles.end,n)<o},t.prototype.updateCachedStats=function(e,t,n){if(n.handles.middle){var r=wo(e,n.handles.middle,n.handles.start),o=wo(e,n.handles.end,n.handles.middle),a=wo(e,n.handles.end,n.handles.start),i=bo(r),s=bo(o),l=bo(a),c=Math.acos((Math.pow(i,2)+Math.pow(s,2)-Math.pow(l,2))/(2*i*s));c*=180/Math.PI,n.rAngle=ho(c,2),n.invalidated=!1}},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=n.enabledElement,o=this.configuration,i=o.handleRadius,s=o.drawHandlesOnHover,l=o.hideHandlesIfMoving,c=o.renderDashed,u=(0,a.getToolState)(e.currentTarget,this.name),d=(0,a.getModule)("globalConfiguration").configuration.lineDash;if(u)for(var f=oo(n.canvasContext.canvas),h=n.image,p=n.element,m=mo(h),v=m.rowPixelSpacing,g=m.colPixelSpacing,y=a.toolStyle.getToolWidth(),x=function(e){var o=u.data[e];if(!1===o.visible)return"continue";ao(f,(function(e){io(e,t.configuration);var u=a.toolColors.getColorIfActive(o),f=a.external.cornerstone.pixelToCanvas(n.element,o.handles.start),m=a.external.cornerstone.pixelToCanvas(n.element,o.handles.middle),x={color:u};c&&(x.lineDash=d),so(e,n.element,o.handles.start,[o.handles.middle,o.handles.end],x);var b={color:u,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};if(t.configuration.drawHandles&&o.active&&co(e,n,o.handles,b),!0===o.invalidated&&(o.rAngle?t.throttledUpdateCachedStats(h,p,o):t.updateCachedStats(h,p,o)),o.rAngle){var T=function(e,t,n){var r=t&&n?"":" (isotropic)",o="00B0";return e.rAngle.toString()+String.fromCharCode(parseInt(o,16))+r}(o,v,g),I=void 0;if(!o.handles.textBox.hasMoved){I={x:m.x,y:m.y};var S=vo(e,T,5);m.x<f.x?I.x-=15+S+10:I.x+=15;var E=a.external.cornerstone.internal.getTransform(r);E.invert();var C=E.transformPoint(I.x,I.y);o.handles.textBox.x=C.x,o.handles.textBox.y=C.y}lo(e,n.element,o.handles.textBox,T,o.handles,w,u,y,0,!0)}}))},b=0;b<u.data.length;b++)x(b);function w(e){return[e.start,e.middle,e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var r=e.detail,o=this.createNewMeasurement(r),i=e.detail.element;(0,a.addToolState)(i,this.name,o),a.external.cornerstone.updateImage(i),ro(r,this.name,o,o.handles.middle,this.options,t,(function(e){if(o.active=!1,!e)return(0,a.removeToolState)(i,n.name,o),void(n.preventNewMeasurement=!1);o.handles.end.active=!0,a.external.cornerstone.updateImage(i),ro(r,n.name,o,o.handles.end,n.options,t,(function(e){e?(o.active=!1,a.external.cornerstone.updateImage(i)):(0,a.removeToolState)(i,n.name,o),n.preventNewMeasurement=!1,a.external.cornerstone.updateImage(i);var t={toolName:n.name,toolType:n.name,element:i,measurementData:o};uo(i,a.EVENTS.MEASUREMENT_COMPLETED,t)}))}))}},t}(no);const xo=yo;function bo(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function wo(e,t,n){var r=mo(e),o=r.rowPixelSpacing,a=r.colPixelSpacing;return{x:(t.x-n.x)*(a||1),y:(t.y-n.y)*(o||1)}}var To=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Io=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"Pointer",supportedInteractionTypes:["Mouse","Touch"]})||this}return To(t,e),t}((0,a.importInternal)("base/BaseTool"));var So=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Eo=(0,a.importInternal)("base/BaseAnnotationTool"),Co=(0,a.importInternal)("manipulators/moveNewHandle"),Ao=(0,a.importInternal)("drawing/getNewContext"),Mo=(0,a.importInternal)("drawing/draw"),Po=(0,a.importInternal)("drawing/setShadow"),Do=(0,a.importInternal)("drawing/drawLine"),ko=(0,a.importInternal)("drawing/drawLinkedTextBox"),Oo=(0,a.importInternal)("drawing/drawHandles"),Lo=(0,a.importInternal)("util/triggerEvent"),Ro=(0,a.importInternal)("util/lineSegDistance"),_o=(0,a.importInternal)("util/roundToDecimal"),No=(0,a.importInternal)("util/throttle"),Uo=(0,a.importInternal)("util/getPixelSpacing"),Bo=(0,a.importInternal)("tools/cursors").cobbAngleCursor,jo=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Bo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,r)||this).hasIncomplete=!1,n.throttledUpdateCachedStats=No(n.updateCachedStats,110),n}return So(t,e),t.prototype.createNewMeasurement=function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){if(!1===t.visible)return!1;var o="mouse"===r?15:25,a=Ro(e,t.handles.start,t.handles.end,n)<o,i=Ro(e,t.handles.start2,t.handles.end2,n)<o;return a||i},t.prototype.updateCachedStats=function(e,t,n){var r=Uo(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(n.handles.start.x-n.handles.end.x)*(a||1),s=(n.handles.start.y-n.handles.end.y)*(o||1),l=(n.handles.start2.x-n.handles.end2.x)*(a||1),c=(n.handles.start2.y-n.handles.end2.y)*(o||1),u=Math.acos((i*l+s*c)/(Math.sqrt(i*i+s*s)*Math.sqrt(l*l+c*c)));u*=180/Math.PI,n.rAngle=_o(u,2),n.lAngle2=_o(360-u,2),n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=(0,a.getToolState)(e.currentTarget,this.name);if(c)for(var u=Ao(n.canvasContext.canvas),d=a.toolStyle.getToolWidth(),f=(0,a.getModule)("globalConfiguration").configuration.lineDash,h=a.textStyle.getFont(),p=e.detail.element,m=a.external.cornerstone.getEnabledElement(p).image,v=Uo(m),g=v.rowPixelSpacing,y=v.colPixelSpacing,x=function(e){var r=c.data[e],m=r.handles,v=m.start,x=m.end,w=m.start2,I=m.end2;if(!1===r.visible)return"continue";r.value||(r.value=b.textBoxText(r,g,y)),Mo(u,(function(e){Po(e,t.configuration);var c=a.toolColors.getColorIfActive(r),u={color:c};l&&(u.lineDash=f),Do(e,n.element,v,x,u);var m={color:c,lineWidth:d,lineDash:[2,3]};if(r.active||!r.complete){var g=Vo(n,v,x),y=g.start,b=g.end;Do(e,p,y,b,m)}if(r.complete&&(Do(e,n.element,w,I,u),r.active)){var S=Vo(n,w,I),E=S.start,C=S.end;Do(e,p,E,C,m)}var A={color:c,handleRadius:o,drawHandlesIfActive:i,hideHandlesIfMoving:s};t.configuration.drawHandles&&r.active&&Oo(e,n,r.handles,A),e.fillStyle=c;var M=r.value;if(!r.handles.textBox.hasMoved){var P={x:(v.x+x.x)/2,y:(v.y+x.y)/2+10};e.font=h,r.handles.textBox.x=P.x,r.handles.textBox.y=P.y}r.complete&&ko(e,n.element,r.handles.textBox,M,r.handles,T,c,d,0,!0)}))},b=this,w=0;w<c.data.length;w++)x(w);function T(e){return[e.start,e.start2,e.end,e.end2]}},t.prototype.getIncomplete=function(e){var t=(0,a.getToolState)(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))},t.prototype.addNewMeasurement=function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r,o,i=e.detail,s=function(e){if(e){var t=a.EVENTS.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:l,measurementData:r};Lo(l,t,o)}else(0,a.removeToolState)(l,n.name,r)},l=e.detail.element,c=this.getIncomplete(l);c?((r=c).complete=!0,r.handles.start2={x:i.currentPoints.image.x,y:i.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},r.handles.end2={x:i.currentPoints.image.x,y:i.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},o=r.handles.end2,this.hasIncomplete=!1,s=function(e){if(e){var t=a.EVENTS.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:l,measurementData:r};Lo(l,t,o)}else(0,a.removeToolState)(l,n.name,r)}):(r=this.createNewMeasurement(i),(0,a.addToolState)(l,this.name,r),o=r.handles.end),a.external.cornerstone.updateImage(l),Co(i,this.name,r,o,this.options,t,s)},t.prototype.onMeasureModified=function(e){var t=e.detail.element,n=a.external.cornerstone.getEnabledElement(t).image,r=Uo(n),o=r.rowPixelSpacing,i=r.colPixelSpacing;if(e.detail.toolName===this.name){var s=e.detail.measurementData;!0===s.invalidated&&(s.rAngle?this.throttledUpdateCachedStats(n,t,s):this.updateCachedStats(n,t,s)),s.value=this.textBoxText(s,o,i)}},t.prototype.textBoxText=function(e,t,n){var r=e.rAngle,o=e.lAngle2;if(void 0===r)return"";if(Number.isNaN(r))return"";var a=t&&n?"":" (isotropic)";return"".concat(r,"°").concat(a," (").concat(o,"°").concat(a,")")},t.prototype.activeCallback=function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.passiveCallback=function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.enabledCallback=function(e){e.removeEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.disabledCallback=function(e){e.removeEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t}(Eo);const Fo=jo;function Vo(e,t,n){var r,o,a,i,s=e.image,l=s.columnPixelSpacing,c=void 0===l?1:l,u=s.rowPixelSpacing,d=void 0===u?1:u,f={x:(t.x+n.x)/2,y:(t.y+n.y)/2};if(t.x===n.x&&t.y===n.y)r=t.x,o=t.y,a=n.x,i=n.y;else{var h=function(e,t,n,r){var o=(n.x-r.x)*e,a=(n.y-r.y)*t,i=Math.sqrt(o*o+a*a);return{x:o/i,y:a/i,length:i}}(c,d,t,n),p=10*h.length,m=p/(2*d),v=p/(2*c);r=f.x+v*h.y,o=f.y-m*h.x,a=f.x-v*h.y,i=f.y+m*h.x}return{start:{x:r,y:o},mid:f,end:{x:a,y:i}}}var Ho=a.store.state,zo=a.store.modules.globalConfiguration;function qo(e,t){Ho.svgCursorUrl&&window.URL.revokeObjectURL(Ho.svgCursorUrl),Ho.svgCursorUrl=null,e.style.cursor=t}var Wo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Go=(0,a.importInternal)("base/BaseTool"),Yo=(0,a.importInternal)("drawing/getNewContext"),Zo=(0,a.importInternal)("tools/cursors").magnifyCursor;const Xo=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:Zo};return(n=e.call(this,t,r)||this).zoomCanvas=void 0,n.zoomElement=void 0,n.activeCallback=n._createMagnificationCanvas.bind(n),n.enabledCallback=n._createMagnificationCanvas.bind(n),n.disabledCallback=n._destroyMagnificationCanvas.bind(n),n.postTouchStartCallback=n._addMagnifyingGlass.bind(n),n.touchDragCallback=n._updateMagnifyingGlass.bind(n),n.touchEndCallback=n._removeMagnifyingGlass.bind(n),n.touchDragEndCallback=n._removeMagnifyingGlass.bind(n),n.postMouseDownCallback=n._addMagnifyingGlass.bind(n),n.mouseDragCallback=n._updateMagnifyingGlass.bind(n),n.mouseUpCallback=n._removeMagnifyingGlass.bind(n),n.mouseClickCallback=n._removeMagnifyingGlass.bind(n),n.newImageCallback=n._drawMagnificationTool.bind(n),n}return Wo(t,e),t.prototype._addMagnifyingGlass=function(e){var t,n=this;(this._removeZoomElement(),e.detail.element.querySelector(".active"))||(this._drawZoomedElement(e),window.requestAnimationFrame((function(){return n._drawMagnificationTool(e)})),t=e.detail.element,zo.configuration.showSVGCursors&&qo(t,"none"),e.preventDefault(),e.stopPropagation())},t.prototype._updateMagnifyingGlass=function(e){e.detail.element.querySelector(".active")||(this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation())},t.prototype._removeMagnifyingGlass=function(e){var t=e.detail.element;!function(e,t){if(zo.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),r=t.mousePoint,o=window.URL.createObjectURL(n);e.style.cursor="url('".concat(o,"') ").concat(r,", auto"),Ho.svgCursorUrl=o}}(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()},t.prototype._drawMagnificationTool=function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(void 0!==this.zoomCanvas){var r=t.querySelector("canvas:not(.magnifyTool)"),o=Yo(n),i=a.external.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),s=Math.min(this.configuration.magnifySize,r.width,r.height),l=this.configuration.magnificationLevel;n.width=s,n.height=s,i.x=Math.max(i.x,.5*s/l),i.x=Math.min(i.x,r.width-.5*s/l),i.y=Math.max(i.y,.5*s/l),i.y=Math.min(i.y,r.height-.5*s/l);var c={x:i.x*l-.5*s,y:i.y*l-.5*s};c.x=Math.max(c.x,0),c.y=Math.max(c.y,0),o.drawImage(this.zoomCanvas,c.x,c.y,s,s,0,0,s,s);var u=e.detail.isTouchEvent?120:0,d={top:Math.max(i.y-.5*s-u,0),left:Math.max(i.x-.5*s,0)},f=n.getBoundingClientRect();d.top=Math.min(d.top,r.height-f.height),d.left=Math.min(d.left,r.width-f.width),n.style.top="".concat(d.top,"px"),n.style.left="".concat(d.left,"px"),n.style.display="block"}},t.prototype._drawZoomedElement=function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=a.external.cornerstone.getEnabledElement(t));var r=this.configuration.magnificationLevel,o=n.canvas,i=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=o.width*r,this.zoomElement.height=o.height*r,a.external.cornerstone.enable(this.zoomElement,n.options));var s=a.external.cornerstone.getEnabledElement(this.zoomElement),l=a.external.cornerstone.getViewport(n.element);this.zoomCanvas=s.canvas,this.zoomCanvas.width=o.width*r,this.zoomCanvas.height=o.height*r,s.viewport=Object.assign({},l),l.scale*=r,a.external.cornerstone.displayImage(this.zoomElement,i),a.external.cornerstone.setViewport(this.zoomElement,l)},t.prototype._removeZoomElement=function(){void 0!==this.zoomElement&&(a.external.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)},t.prototype._createMagnificationCanvas=function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}},t.prototype._destroyMagnificationCanvas=function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)},t}(Go);var Qo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ko=(0,a.importInternal)("base/BaseTool"),Jo=(0,a.importInternal)("util/angleBetweenPoints"),$o=(0,a.importInternal)("tools/cursors").rotateCursor;const ea=function(e){function t(t){void 0===t&&(t={});var n={name:"Rotate",strategies:{default:ta,horizontal:na,vertical:ra},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:$o};return e.call(this,t,n)||this}return Qo(t,e),t.prototype.touchDragCallback=function(e){this.dragCallback(e)},t.prototype.mouseDragCallback=function(e){this.dragCallback(e)},t.prototype.postTouchStartCallback=function(e){this.initialRotation=e.detail.viewport.rotation},t.prototype.postMouseDownCallback=function(e){this.initialRotation=e.detail.viewport.rotation},t.prototype.dragCallback=function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),a.external.cornerstone.setViewport(e.detail.element,e.detail.viewport)},t}(Ko);function ta(e){var t=this.configuration,n=t.roundAngles,r=t.rotateScale,o=e.detail,a=o.element,i=o.viewport,s=o.startPoints,l=o.currentPoints,c=i.initialRotation?i.initialRotation:i.rotation,u=a.getBoundingClientRect(a),d=a.clientWidth,f=a.clientHeight,h=i.scale,p=i.translation,m={x:u.left+d/2+p.x*h,y:u.top+f/2+p.y*h},v=Jo(m,s.client,l.client);v.angle*=r,n&&(v.angle=Math.ceil(v.angle)),v.direction<0&&(v.angle=-v.angle),i.rotation=c+v.angle}function na(e){var t=this.configuration,n=t.roundAngles,r=t.flipHorizontal,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.x,d=(l.client.x-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}function ra(e){var t=this.configuration,n=t.roundAngles,r=t.flipVertical,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.y,d=(l.client.y-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}var oa=function(){return oa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},oa.apply(this,arguments)},aa=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ia=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},sa=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},la=new Map,ca={},ua={store:{},IDArr:void 0,add:function(e,t){this.store[e]||(this.store[e]=[]),this.store[e].push(Number(t))},sort:function(){for(var e in this.IDArr=[],this.store)this.IDArr.push(e),this.store[e].sort((function(e,t){return e-t}))},getFirstIndex:function(e){var t;return null===(t=this.store[e])||void 0===t?void 0:t[0]},getSeriesIDArr:function(){if(!this.IDArr)for(var e in this.IDArr=[],this.store)this.IDArr.push(e);return this.IDArr}};function da(e){var t={Calcification:"钙化",Ground_Glass:"磨玻璃",Part_Solid:"部分实性",Solid:"实性",pleural:"胸膜结节"},n=[];for(var r in e){var o={name:r,value:e[r],typeText:t[r]};n.push(o)}return n.sort((function(e,t){return t.value-e.value})),n[0].typeText}function fa(e){return e<.25?"良性":e<.5?"偏良性":e<.75?"偏恶性":e<1?"恶性":void 0}function ha(e){var t=e.nodule_no,n=(e.instanceNumber,e.nodule_volume),r=e.nodule_maxHU,o=e.nodule_minHU,a=ia(e.nodule_cross,1)[0],i=a.major_diameter_length_mm,s=a.minor_diameter_length_mm,l=e.noduleType,c=e.noduleBmProbCN;return["编号:N".concat(t),"长短经: ".concat(i.toFixed(2),"*").concat(s.toFixed(2),"mm"),"体积: ".concat(n.toFixed(2),"mm").concat(String.fromCharCode(179)),"Min: ".concat(o,"HU  Max: ").concat(r,"HU"),"类型: ".concat(l,"  良恶性: ").concat(c)]}var pa=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ma=function(){return ma=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ma.apply(this,arguments)},va=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},ga=(0,a.importInternal)("base/BaseAnnotationTool"),ya=(0,a.importInternal)("drawing/getNewContext"),xa=(0,a.importInternal)("drawing/draw"),ba=(0,a.importInternal)("drawing/drawRect"),wa=(0,a.importInternal)("drawing/drawLinkedTextBox"),Ta=(0,a.importInternal)("util/getLogger"),Ia=Ta?Ta("tools:annotation:LengthTool"):console,Sa=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"AI",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}})||this}return pa(t,e),t.prototype.activeCallback=function(e){this.forceImageUpdate(e)},t.prototype.passiveCallback=function(e){this.forceImageUpdate(e)},t.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.forceImageUpdate=function(e){a.external.cornerstone.getEnabledElement(e).image&&a.external.cornerstone.updateImage(e)},t.prototype.createNewMeasurement=function(){},t.prototype.updateCachedStats=function(){},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||Ia.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.start),l=a.external.cornerstone.pixelToCanvas(e,t.handles.end),c={left:Math.min(s.x,l.x),top:Math.min(s.y,l.y),width:Math.abs(s.x-l.x),height:Math.abs(s.y-l.y)},u=a.external.cornerstoneMath.rect.distanceToPoint(c,n);return t.handles.disable=u<i,t.handles.disable},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name),r=e.currentTarget.dataset,o=r.seriesId,i=r.currentImageIdIndex;if(!n){var s=la.get("".concat(o,"?index=").concat(i));if(!s)return;n={data:s},s.forEach((function(r,o){o>=1&&a.external.cornerstoneMath.point.distance(r.handles.textBox,n.data[o-1].handles.textBox)<100&&(r.textBoxPointsCompute=!0),(0,a.addToolState)(e.currentTarget,t.name,r)}))}var l=e.detail,c=l.image,u=l.element,d=a.toolStyle.getToolWidth(),f=(0,a.getModule)("globalConfiguration").configuration.lineDash,h=this.configuration,p=h.handleRadius,m=h.drawHandlesOnHover,v=h.hideHandlesIfMoving,g=h.renderDashed,y=ya(l.canvasContext.canvas);xa(y,(function(e){for(var t=0;t<n.data.length;t++){var r=n.data[t],o=a.toolColors.getColorIfActive(r),i={color:o,handleRadius:p,drawHandlesIfActive:m,hideHandlesIfMoving:v};g&&({color:o}.lineDash=f),ba(e,u,r.handles.start,r.handles.end,i,"pixel");if(r.textBoxPointsCompute){var s=va([200,150],2),l=s[0],h=s[1],y=c.height-h,x=c.width-l,b={x:0,y:0};switch(t){case 2:b={x,y:0};break;case 3:b={x:0,y};break;case 4:b={x,y}}r.handles.textBox=ma(ma({},r.handles.textBox),b),r.textBoxPointsCompute=!1}wa(e,u,r.handles.textBox,r.textBoxContent,r.handles,(function(e){return[e.start,e.end]}),o,d,20,!1)}}))},t}(ga);const Ea=Sa;var Ca=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Aa=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ma=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Pa=(0,a.importInternal)("base/BaseTool"),Da=(0,a.importInternal)("drawing/getNewContext"),ka=(0,a.importInternal)("drawing/draw"),Oa=(0,a.importInternal)("drawing/drawTextBox"),La=function(e){function n(t){void 0===t&&(t={});return e.call(this,t,{name:"Orientation",configuration:{},mixins:["enabledOrDisabledBinaryTool"]})||this}return Ca(n,e),n.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},n.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},n.prototype.forceImageUpdate=function(e){a.external.cornerstone.getEnabledElement(e).image&&a.external.cornerstone.updateImage(e)},n.prototype.renderToolData=function(e){var n=e.detail,r=Da(n.canvasContext.canvas),o=n.image,i=n.image,s=i.width,l=i.height,c=n.element,u=t.metaData.get("imageOrientationTagModule","cacheDB:"+o.imageId),d=u.imageleftTag,f=u.imagetopTag,h=u.imagetightTag,p=u.imageBottomTag;ka(r,(function(e){var n,r;try{for(var o=Aa([[0,l/2,d,{y:!0}],[s/2,0,f,{x:!0}],[s-30,l/2,h,{y:!0}],[s/2,l-10,p,{x:!0,y:!0}]]),i=o.next();!i.done;i=o.next()){var u=Ma(i.value,4),m=u[0],v=u[1],g=u[2],y=u[3],x=(0,t.pixelToCanvas)(c,{x:m,y:v,_pixelCoordinateBrand:""});Oa(e,g,x.x,x.y,a.toolColors.getToolColor(),{centering:y})}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}))},n}(Pa);const Ra=La;var _a=D.toolColor,Na=D.zoomTool,Ua={configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:Na.minScale,maxScale:Na.maxScale}};a.external.cornerstoneMath=ke(),a.external.cornerstone=o(),a.external.Hammer=Pe(),(0,a.init)({globalToolSyncEnabled:!0,mouseEnabled:!0,showSVGCursors:!0,autoResizeViewports:!0}),(0,a.addTool)(a.WwwcTool),(0,a.addTool)(ea),(0,a.addTool)(a.StackScrollMouseWheelTool),(0,a.addTool)(a.ReferenceLinesTool),(0,a.addTool)(dr,{configuration:{showMinMax:!0}}),(0,a.addTool)(a.StackScrollTool),(0,a.addTool)(a.FreehandRoiTool,{configuration:{showMinMax:!0}}),(0,a.addTool)(a.CircleRoiTool,{configuration:{showMinMax:!0}}),(0,a.addTool)(Xo),(0,a.addTool)(a.EraserTool),(0,a.addTool)(a.PanTool),(0,a.addTool)(sn,{}),(0,a.addTool)(Rr,{configuration:{showMinMax:!0}}),(0,a.addTool)(eo,{}),(0,a.addTool)(xo,{}),(0,a.addTool)(Io),(0,a.addTool)(Fo),(0,a.addTool)(En),(0,a.addTool)(Bn),(0,a.addTool)(Ct,{markerFlag:"L"}),(0,a.addTool)(Ct,{markerFlag:"R"}),(0,a.addTool)(zt),(0,a.addTool)(dt),(0,a.addTool)(Ye),(0,a.addTool)(je),(0,a.addTool)(Ea),(0,a.addTool)(Ra),(0,a.addTool)(a.ZoomTool,Ua),"mobile"===R.env&&((0,a.addTool)(a.ZoomTouchPinchTool,Ua),(0,a.addTool)(a.PanMultiTouchTool)),a.toolColors.setToolColor(_a),a.store.state.clickProximity=20,a.store.state.touchProximity=30,a.store.state.handleRadius=8;var Ba=n(4865);(0,Ba.configure)({parent:".viewerContentWrapper"});ue().settings({timeout:5e3});var ja;ja=function(){try{var e=navigator.userAgent.toLowerCase();if(e.indexOf("win32")>=0||e.indexOf("wow32")>=0)return 32;if(e.indexOf("win64")>=0||e.indexOf("wow64")>=0)return 64;if(new ActiveXObject("Wscript.Shell").RegRead("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\PROCESSOR_ARCHITECTURE").toLowerCase().indexOf("32")>=0)return 32}catch(e){}}(),console.log("systemInfo",{performance,navigator,screen,history,location,window,systemArchitecture:ja}),32===ja&&ue().info({title:"检测到浏览器为32位，可能导致软件异常，请使用64浏览器！！"});const Fa=function(e){try{(0,t.getEnabledElement)(e)}catch(n){(0,t.enable)(e)}};var Va=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ha=function(e){var n=e.element,r=e.canvas;try{var o={element:n};(0,t.triggerEvent)(n,t.EVENTS.ELEMENT_DISABLED,o),(0,t.triggerEvent)(t.events,t.EVENTS.ELEMENT_DISABLED,o),1===n.querySelectorAll("canvas").length&&(null==n||n.removeChild(r)),e.canvas=void 0}catch(e){console.log(e)}},za=function(){var e,n,r=(0,t.getEnabledElements)();try{for(var o=Va(r),a=o.next();!a.done;a=o.next()){var i=a.value;Ha(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}r.length=0};const qa=function e(n){if(void 0===n)throw new Error("disable: element must not be undefined");for(var r=(0,t.getEnabledElements)(),o=0;o<r.length;o++){var a=r[o];if(a.element===n){var i=n.querySelectorAll("canvas");i.length>1&&i.forEach((function(t){return setTimeout((function(){return e(t.parentElement)}))})),Ha(a),r.splice(o,1)}}};const Wa=new s.PromiseQueue;var Ga=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Ya=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Za=0,Xa=function(e,n){return new Promise((function(r,o){return Ga(void 0,void 0,void 0,(function(){var a,i,l;return Ya(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,(0,t.loadAndCacheImage)(e,n)];case 1:return a=c.sent(),r(a),[3,3];case 2:return i=c.sent(),o(i),pe("loadAndCacheImage",(0,s.throttle)((function(e){var t,n=((null==e?void 0:e.error)||{}).status,r=1e4;void 0===n?(t="图像解析失败：1.图像数据有误，请稍后重试；2.授权验证失效，请退出重试；"+(0!==R.imageType?"3.".concat(["极速","标准","专业"][R.imageType+1]," 模式未支持, 请切换到其他模式！"):""),r=4e4):t=203===n?"图像解析失败：授权验证失效，请退出重试！":"图像解析失败：图像数据有误，请稍后重试！",console.error(t,"错误信息：",e,n),ue().error({title:t,timeout:r})}),5e3),i),l=p(e,R.imageType).indexedDBKey,console.info("即将执行数据清除:",l),le.dispatch("delete",{},l),[3,3];case 3:return[2]}}))}))}))};const Qa=function(e,t){return Ga(void 0,void 0,void 0,(function(){var n,r,o,a,i,s,l,c,u;return Ya(this,(function(d){switch(d.label){case 0:return r=(n=t||{}).cancel,o=void 0===r||r,a=n.forceCancelAll,i=void 0!==a&&a,s=n.type,l=n.countCallback,c="function"==typeof l,u=0,i?[2,Wa.cancel()]:(!A.fullLoad&&o&&Wa.cancel(),[4,Wa.init({arr:e,func:function(e){return Ga(void 0,void 0,void 0,(function(){var t;return Ya(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Xa(e)];case 1:return t=n.sent(),u+=1,Za+=1,c&&l(t,e,u),"MPR"!==s&&Za%50==0&&(Za=0,q("loadAndCacheImages")),[3,3];case 2:return n.sent(),[3,3];case 3:return[2]}}))}))},limit:6})]);case 1:return d.sent(),[2]}}))}))};const Ka=function(e){var n=(0,t.getEnabledElement)(e);n.renderingTools.colormapId=void 0,n.renderingTools.colorLut=void 0;var r=n.renderingTools.renderCanvas,o=r.getContext("2d");o.fillStyle="white",o.fillRect(0,0,r.width,r.height);var a=o.getImageData(0,0,r.width,r.height);n.renderingTools.renderCanvasContext=o,n.renderingTools.renderCanvasData=a};const Ja=function(e,t,n,r){if(t.includes("cacheDB:")&&(t=t.replace(/(cacheDB:)|(wadouri:)/g,"")),"cornerstone3D"===r&&t.includes("wadouri:")&&(t=t.replace("wadouri:","")),!t.includes("wadouri:")){var o=n.get(t)||n.get("wadouri:"+t);if(o){var a=o.mod,i=o.syntaxuid,s=o.seruid,l=o.stuuid,c=o.serid,u=o.stutm,d=o.studt,f=o.age,h=o.row,p=o.col,m=o.imgori,v=o.imgpos,g=o.orb,y=o.orl,x=o.orr,b=o.ort,w=o.pixx,T=o.pixy,I=o.sliceth,S=o.bita,E=o.bits,C=o.hbit,A=o.phme,M=o.pixrep,P=o.sappix,D=o.wc,k=o.ww,O=o.rescin,L=o.rescsl,R=o.sopuid,_=o.blocks;if("generateGrayImageModule"===e)return{windowWidth:parseInt(k),windowCenter:parseInt(D),rows:Number(h),columns:Number(p),rescaleSlope:isNaN(O)||O<1?1:Number(L),rescaleIntercept:Number(O),photometricInterpretation:A,bitsAllocated:Number(S),pixelRepresentation:Number(M),blocks:Number(_),transferSyntaxUID:i};if("generalSeriesModule"===e)return{modality:a,seriesInstanceUID:s,seriesNumber:Number(c),studyInstanceUID:l,seriesDate:G().parseDA(d),seriesTime:G().parseTM(u)};if("patientStudyModule"===e)return{patientAge:f,patientSize:void 0,patientWeight:void 0};if("imagePlaneModule"===e){var N=function(e){return e.split("|").map((function(e){return parseInt(e)}))},U=N(m),B=N(v),j=[Number(w),Number(T)],F=null,V=null;j&&(V=j[0],F=j[1]);var H=null,z=null;return U&&(H=[parseFloat(U[0]),parseFloat(U[1]),parseFloat(U[2])],z=[parseFloat(U[3]),parseFloat(U[4]),parseFloat(U[5])]),{rows:Number(h),columns:Number(p),imageOrientationPatient:U,rowCosines:H,columnCosines:z,imagePositionPatient:B,sliceThickness:Number(I),sliceLocation:B[2],pixelSpacing:j,rowPixelSpacing:V,columnPixelSpacing:F}}return"imageOrientationTagModule"===e?{imageBottomTag:g,imageleftTag:y,imagetightTag:x,imagetopTag:b}:"imagePixelModule"===e?{samplesPerPixel:Number(P),photometricInterpretation:A,rows:Number(h),columns:Number(p),bitsAllocated:Number(S),bitsStored:Number(E),highBit:Number(C),pixelRepresentation:Number(M),planarConfiguration:void 0,pixelAspectRatio:void 0,smallestPixelValue:void 0,largestPixelValue:void 0,redPaletteColorLookupTableDescriptor:void 0,greenPaletteColorLookupTableDescriptor:void 0,bluePaletteColorLookupTableDescriptor:void 0,redPaletteColorLookupTableData:void 0,greenPaletteColorLookupTableData:void 0,bluePaletteColorLookupTableData:void 0}:"voiLutModule"===e?{voiLUTSequence:void 0,windowCenter:[Number(D)],windowWidth:[Number(k)]}:"modalityLutModule"===e?{modalityLUTSequence:void 0,rescaleIntercept:Number(O),rescaleSlope:Number(L),rescaleType:void 0}:"sopCommonModule"===e?{sopClassUID:void 0,sopInstanceUID:R}:"transferSyntax"===e?{transferSyntaxUID:i}:void 0}}};var $a=new Map;t.metaData.addProvider((function(e,t){return Ja(e,t,$a)}));const ei=$a;var ti=function(){function e(e,t,n,r,o){var a,i=this;this.className="select-popup-layout";var l=t.btnTarget,c=t.events,u=null==l?void 0:l.getBoundingClientRect(),d=u.left,f=u.bottom,h=this.layout=l.querySelector(".".concat(this.className,".").concat(e));o&&(null===(a=this.layout)||void 0===a||a.remove(),this.layout=void 0),this.layout||(h=this.layout=(0,s.createElement)({className:"select-popup-layout ".concat(e," invisible"),onclick:function(e){e.stopPropagation(),i.hideLayout()},ontouchmove:function(e){e.stopPropagation()}}),null==n||n(h),l.appendChild(h),l.addEventListener("mouseleave",(function(){return i.mouseleaveHandle()})),l.addEventListener("mouseenter",(function(){return i.mouseenterHandle()}))),null==r||r(h),c&&this.setLeft(d,f)}return e.prototype.mouseleaveHandle=function(){var e=this;this.timer=setTimeout((function(){e.hideLayout()}),"mobile"===R.env?0:300)},e.prototype.mouseenterHandle=function(){this.timer&&clearTimeout(this.timer)},e.prototype.hideLayout=function(){this.layout.classList.add("invisible")},e.prototype.setLeft=function(e,t){var n=this.layout,r=R.webDicomView.globalContainer.clientWidth,o=n.clientWidth;n.style.left="".concat(o+e>r?r-o:e,"px"),n.style.top="".concat(t,"px"),n.classList.toggle("invisible",!n.classList.contains("invisible"))},e}();const ni=ti;var ri=function(){return ri=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ri.apply(this,arguments)},oi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ai=function(){function e(){this.data=[{title:"极速模式",icon:"icon-dicom-mode3",type:-1,visibility:function(){return R.toolsBar.fastImageModeVisibility}},{title:"标准模式",icon:"icon-dicom-mode1",type:0},{title:"专业模式",icon:"icon-dicom-mode2",type:1}]}return e.prototype.createLayout=function(e){var n=this;new ni("imageType",e.detail,(function(r){var o,a,i=function(n){var o=n.title,a=n.icon,i=n.visibility;if(!1!==(null==i?void 0:i())){var l=(0,s.createElement)({tagName:"i",className:"iconfont "+a}),c=(0,s.createElement)({tagName:"span",innerText:o}),u=(0,s.createElement)({className:"select-popup-item",title:o,onclick:function(){(0,t.triggerEvent)(t.events,"tool_imageType",ri(ri({},n),e.detail))}});u.appendChild(l),u.appendChild(c),r.appendChild(u)}};try{for(var l=oi(n.data),c=l.next();!c.done;c=l.next()){i(c.value)}}catch(e){o={error:e}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}}))},e.prototype.handleLayout=function(e){var t=e.title,n=e.btnTarget,r=e.icon;if(e.custom){var o=this.data.find((function(e){return e.type===R.imageType}));t=o.title,r=o.icon,n=R.webDicomView.layoutView.toolsContainer.querySelector(".tools2d .tool-btn-style.imageType"),R.imageType}var a=n.querySelector(".toolbar-text"),i=n.querySelector("i.iconfont");n.title=t,a.innerText=t,i.className="iconfont "+r},e}();const ii=ai;var si=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},li=function(){function e(){this.data=[{title:"自定义窗宽/位",name:"custom"},{title:"肺窗",name:"lungs",WW:1750,WC:-500},{title:"纵隔窗",name:"mediastinum",WW:300,WC:40},{title:"骨窗",name:"bone",WW:1250,WC:300},{title:"头颅",name:"skull",WW:90,WC:35},{title:"软组织窗",name:"flab",WW:400,WC:50}]}return e.prototype.createLayout=function(e){var n=this,r="wwwc",o=R.imageType,a=e.detail.btnTarget.querySelector(".select-popup-layout.".concat(r)),i=((null==a?void 0:a.dataset)||{}).imageType;new ni(r,e.detail,(function(e){var r,a,i=function(n){var r=n.title,a=(0,s.createElement)({className:"select-popup-item",title:r,innerText:r,onclick:function(){(0,t.triggerEvent)(t.events,"tool_wwwc",n)}});e.appendChild(a),e.dataset.imageType=o};try{for(var l=si(1===o?n.data:[n.data[0]]),c=l.next();!c.done;c=l.next()){i(c.value)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(r)throw r.error}}}),void 0,i&&Number(i)!==o)},e.prototype.handleLayout=function(e,n){var r=n.name,o=n.WW,a=n.WC,i=e.querySelector(".layoutImage.active");if(e=i||e,"custom"===r){if(null===(o=qt("请输入窗宽：(例：255）",/^[-+]?\d+(\.\d*)?$/,"数据有误，请重新输入！！！")))return;a=qt("请输入窗位：(例：128）",/^[-+]?\d+(\.\d*)?$/,"数据有误，请重新输入！！！")}null!==o&&null!=a&&(0,t.setViewport)(e,{voi:{windowWidth:Number(o),windowCenter:Number(a)}})},e}();const ci=li;var ui=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},di=function(){function e(){this.data=[{title:"恢复默认",name:"default",icon:"icon-dicom-restore"},{title:"逆时针90°",name:"anticlockwise",icon:"icon-dicom-rotate90R"},{title:"顺时针90°",name:"clockwise",icon:"icon-dicom-rotate90L"},{title:"垂直翻转",name:"leftRight",icon:"icon-dicom-leftRight"},{title:"水平翻转",name:"upDown",icon:"icon-dicom-upDown"}]}return e.prototype.createLayout=function(e){var n=this;new ni("rotate",e.detail,(function(e){var r,o,a=function(n){var r=n.title,o=n.icon,a=(0,s.createElement)({tagName:"i",className:"iconfont "+o}),i=(0,s.createElement)({tagName:"span",innerText:r}),l=(0,s.createElement)({className:"select-popup-item",title:r,onclick:function(){(0,t.triggerEvent)(t.events,"tool_rotate",n)}});l.appendChild(a),l.appendChild(i),e.appendChild(l)};try{for(var i=ui(n.data),l=i.next();!l.done;l=i.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}))},e.prototype.handleLayout=function(e,n){var r=n.name,o=e.querySelector(".layoutImage.active");e=o||e;var a=(0,t.getViewport)(e);switch(r){case"default":a.rotation=0,a.hflip=!1,a.vflip=!1;break;case"anticlockwise":a.rotation-=90;break;case"clockwise":a.rotation+=90;break;case"leftRight":a.hflip=!a.hflip;break;case"upDown":a.vflip=!a.vflip}(0,t.setViewport)(e,a)},e}();const fi=di;function hi(e,t,n){if(n!==t){var r=a.external.cornerstone,o=r.getViewport(t),i=r.getViewport(n);i.rotation===o.rotation&&i.hflip===o.hflip&&i.vflip===o.vflip||(i.rotation=o.rotation,i.hflip=o.hflip,i.vflip=o.vflip,e.setViewport(n,i))}}t.colors.getColormap("myCustomColorMap",{name:"myCustomColorMap",numColors:256,gamma:1,segmentedData:{red:[[0,1,0],[1,1,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}});const pi=[{id:"gray",name:"灰色",icon:n(5990)},{id:"blues",name:"蓝",icon:n(4842)},{id:"bone",name:"骨骼",icon:n(3701)},{id:"cool",name:"cool",icon:n(2778)},{id:"coolwarm",name:"冷色",icon:n(5263)},{id:"copper",name:"铜",icon:n(8495)},{id:"hot",name:"热金属",icon:n(3737)},{id:"hotIron",name:"铬铁",icon:n(2198)},{id:"hotMetalBlue",name:"热金属蓝",icon:n(1289)},{id:"hsv",name:"HSV",icon:n(3972)},{id:"jet",name:"Jet",icon:n(7136)},{id:"pet",name:"PET",icon:n(7573)},{id:"pet20Step",name:"PET 20 Step",icon:n(4321)},{id:"spectral",name:"光谱",icon:n(5945)},{id:"spring",name:"春天",icon:n(2425)},{id:"summer",name:"夏天",icon:n(898)},{id:"autumn",name:"秋天",icon:n(436)},{id:"winter",name:"冬天",icon:n(1217)}];var mi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},vi=function(){function e(){this.data=pi}return e.prototype.createLayout=function(e){var n=this;new ni("colorsMap",e.detail,(function(e){var r,o,a=function(n){var r=n.id,o=n.icon,a=n.name,i=(0,s.createElement)({tagName:"div",className:"select-grid-item2",title:r==a?r:"".concat(r,",").concat(a),onclick:function(){(0,t.triggerEvent)(t.events,"tool_colorMap",n)}}),l=(0,s.createElement)({tagName:"img",width:30,height:30,src:o});i.appendChild(l),e.appendChild(i)};try{for(var i=mi(n.data),l=i.next();!l.done;l=i.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}e.setAttribute("style","\n\t\t\t\t\tdisplay: grid;\n\t\t\t\t\tgrid-template-columns: repeat(4, 40px);\n\t\t\t\t\tpadding: 4px;\n\t\t\t \t")}))},e.prototype.handleLayout=function(e,n,r){var o=n.id,i=r.getHandler(),s=e.querySelector(".layoutImage.active");e=s||e,r.setHandler((function(e,t,n){i&&i(e,t,n),function(e,t,n){if(n!==t){var r=a.external.cornerstone,o=r.getViewport(t),i=r.getViewport(n);i.colormap!==o.colormap&&(i.colormap=o.colormap,e.setViewport(n,i))}}(e,t,n)})),(0,t.setViewport)(e,{colormap:o})},e}();const gi=vi;var yi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},xi=D.zoomTool,bi=xi.minScale,wi=xi.maxScale,Ti=function(){function e(){this.data=[{title:"自定义缩放",name:"custom"}]}return e.prototype.createLayout=function(e){var n=this;new ni("scale",e.detail,(function(e){var r,o,a=function(n){var r=n.title,o=(0,s.createElement)({className:"select-popup-item",title:r,innerText:r,onclick:function(){(0,t.triggerEvent)(t.events,"tool_scale",n)}});e.appendChild(o)};try{for(var i=yi(n.data),l=i.next();!l.done;l=i.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}))},e.prototype.handleLayout=function(e,n){var r=n.name,o=n.scale;"custom"===r&&(o=qt("请输入缩放比例：(例：".concat(bi,"~").concat(wi,"）"),(function(e){return/^\d+(\.\d*)?$/.test(e)&&e>=bi&&e<=wi}),"数据有误，请重新输入！！！")),null!==o&&(0,t.setViewport)(e,{scale:Number(o)})},e}();const Ii=Ti;const Si=function(){function e(){}return e.prototype.createSeriesMarker=function(e){var t=e.querySelector("#ltMarker"),n=e.querySelector("#rtMarker"),r=e.querySelector("#lbMarker"),o=e.querySelector("#rbMarker"),a="\n\t\tposition: absolute;\n\t\tfont-size: 10px;\n\t\ttext-shadow: 1px 1px 1px #000;\n\t\tcursor: default;\n\t\tpointer-events: none;\n\t\t";if(!t){var i=(0,s.createElement)({id:"ltMarker"});i.style.cssText=a+"left: 3px;top: 3px;text-align: left;",e.appendChild(i)}if(!n){var l=(0,s.createElement)({id:"rtMarker"});l.style.cssText=a+"right: 10px;top: 3px;text-align: right;",e.appendChild(l)}if(!r){var c=(0,s.createElement)({id:"lbMarker"});c.style.cssText=a+"left: 3px;bottom: 3px;text-align: left;",e.appendChild(c)}if(!o){var u=(0,s.createElement)({id:"rbMarker"});u.style.cssText=a+"right: 10px;bottom: 3px;text-align: right;",e.appendChild(u)}},e.prototype.createParagraph=function(e,t,n,r,o){this.createSeriesMarker(e);var a=e.querySelector("#"+t);if(a)switch(a.innerHTML="",t){case"ltMarker":var i=(0,s.createElement)({tagName:"p",innerHTML:"姓名："+((null==o?void 0:o.name)||n.name)}),l=(0,s.createElement)({tagName:"p",innerHTML:"ID："+((null==o?void 0:o.patientid)||n.patid)}),c=(0,s.createElement)({tagName:"p",innerHTML:"设备："+n.mod}),u=(0,s.createElement)({tagName:"p",innerHTML:"性别："+x((null==o?void 0:o.sex)||n.sex)}),d=(0,s.createElement)({tagName:"p",innerHTML:"年龄："+y((null==o?void 0:o.age)||n.age)});a.appendChild(i),a.appendChild(l),a.appendChild(c),a.appendChild(u),a.appendChild(d);break;case"rtMarker":var f=(0,s.createElement)({tagName:"p",innerHTML:"日期："+(n.acqdt||(null==o?void 0:o.studydate))}),h=(0,s.createElement)({tagName:"p",id:"filmMarker",innerHTML:"影像号： ".concat(n.stuid?((null==o?void 0:o.studyid)||n.stuid)+"-":"").concat(n.serid,"-").concat(n.imgnum)});h.id="filmMarker",a.appendChild(f),a.appendChild(h);break;case"lbMarker":var p=(0,s.createElement)({tagName:"p",innerHTML:"电压："+n.kv}),m=(0,s.createElement)({tagName:"p",innerHTML:"层厚："+n.sliceth});a.appendChild(p),a.appendChild(m);break;case"rbMarker":var v=(0,s.createElement)({tagName:"p",id:"scaleMarker",innerHTML:"倍数："+Number(r.scale).toFixed(2)}),g=(0,s.createElement)({tagName:"p",id:"wwWMarker",innerHTML:"窗位："+r.voi.windowWidth}),b=(0,s.createElement)({tagName:"p",id:"wwHMarker",innerHTML:"窗宽："+r.voi.windowCenter}),w=(0,s.createElement)({tagName:"p",innerHTML:(null==o?void 0:o.orgname)||n.inst});a.appendChild(v),a.appendChild(g),a.appendChild(b),a.appendChild(w)}},e}();function Ei(e){"Error: element not enabled"!==(null==e?void 0:e.toString())&&console.error(e)}var Ci=function(){return Ci=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ci.apply(this,arguments)},Ai=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Mi=function(e){var n=this;this.data=[];var r=e.btnTarget,o=e.toolData,a=e.toolData.children;this.data=a,new ni("moreLayout",e,(function(e){var a,i,l=function(n){var a=n.toolName,i=n.toolTag,l=n.icon,c=n.isActive,u=Ci(Ci({},n),{parentData:o}),d=(0,s.createElement)({tagName:"i",className:"iconfont "+l}),f=(0,s.createElement)({tagName:"span",innerText:a}),h=(0,s.createElement)({className:"select-popup-item tool-event-link ".concat(i),title:a,onclick:function(e){(0,t.triggerEvent)(t.events,"tool_event",{toolData:u,events:e,btnTarget:h,btnOriginTarget:r})}});h.dataset.toolData=JSON.stringify(u),c&&(h.classList.add("active"),r.classList.add("active")),h.appendChild(d),h.appendChild(f),e.appendChild(h)};try{for(var c=Ai(n.data),u=c.next();!u.done;u=c.next())l(u.value)}catch(e){a={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}}))};const Pi=Mi;var Di=function(){return Di=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Di.apply(this,arguments)},ki=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Oi=function(){function e(){}return e.prototype.createTopTools=function(e,n,r,o,a){var i,l;void 0===o&&(o="toolsChild"),void 0===a&&(a=!1);var c=e.querySelectorAll(".toolsChild"),u=e.querySelector(".".concat(o));if(c.forEach((function(e){e.classList.remove("active")})),a&&(null==u||u.remove(),u=void 0),u)u.classList.add("active");else{var d=(0,s.createElement)({className:"toolsChild active ".concat(o)}),f=function(e){var n=e.toolName,o=e.toolTag,a=e.icon,i=e.iconText,l=e.isActive,c=e.children,u=e.divider,f=e.floatRight,h=e.select,p=e.visibility,m="function"==typeof n?n():n,v=(0,s.createElement)({tagName:"span",className:"tool-btn-style tool-event-link ".concat(o),title:m||i,onclick:function(n){var r={toolData:e,events:n,btnTarget:v};"Array"!==(0,s.dataType)(c)?(0,t.triggerEvent)(t.events,"tool_event",r):new Pi(r)}}),g=(0,s.createElement)({tagName:"i",className:"iconfont"}),y=(0,s.createElement)({tagName:"span",className:"toolbar-text",innerText:m});a?g.classList.add("function"==typeof a?a():a):(g.innerHTML=i,g.setAttribute("style","\n\t\t\t\t\tfont-size: 24px;\n\t\t\t\t\tpadding:0 2px\n\t\t\t\t\t"),m||(g.style.lineHeight="48px",y.style.display="none")),o===(null==r?void 0:r.toolTag)&&(v.classList.add("active"),setTimeout((function(){(0,t.triggerEvent)(t.events,"tool_event",{toolData:e,btnTarget:v})}))),v.dataset.toolData=JSON.stringify(e),l&&v.classList.add("active"),"Array"===(0,s.dataType)(c)&&(new Pi({toolData:e,btnTarget:v}),g.appendChild((0,s.createElement)({tagName:"i",className:"triangle"}))),h&&g.appendChild((0,s.createElement)({tagName:"i",className:"triangle"})),v.appendChild(g),v.appendChild(y),f&&d.appendChild((0,s.createElement)({className:"flex-1"})),d.appendChild(v),u&&d.appendChild((0,s.createElement)({tagName:"span",className:"divider"})),p&&!p()&&v.classList.add("hidden")};try{for(var h=ki(n),p=h.next();!p.done;p=h.next()){f(p.value)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(l=h.return)&&l.call(h)}finally{if(i)throw i.error}}e.appendChild(d)}},e.prototype.clearTools=function(){console.log(a.store.state.tools.filter((function(e){return"passive"!==e.mode})),a.store.state)},e.prototype.disableAllTool=function(){(0,a.setToolActive)("Pointer",{mouseButtonMask:1})},e.prototype.rectangleRoiTools=function(){(0,a.setToolActive)("RectangleRoi",{mouseButtonMask:1})},e.prototype.ellipticalRoiTools=function(){(0,a.setToolActive)("EllipticalRoi",{mouseButtonMask:1})},e.prototype.circleRoiTools=function(){(0,a.setToolActive)("CircleRoi",{mouseButtonMask:1})},e.prototype.straightlineTools=function(){(0,a.setToolActive)("Length",{mouseButtonMask:1})},e.prototype.EraserTools=function(){(0,a.setToolActive)("Eraser",{mouseButtonMask:1})},e.prototype.angleTools=function(){(0,a.setToolActive)("Angle",{mouseButtonMask:1})},e.prototype.cobbAngleTools=function(){(0,a.setToolActive)("CobbAngle",{mouseButtonMask:1})},e.prototype.rotateTool=function(e){e.setHandler(hi),(0,a.setToolActive)("Rotate",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.scaleTool=function(e){e.setHandler(a.panZoomSynchronizer),(0,a.setToolActive)("Zoom",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.magnifyTool=function(){(0,a.setToolActive)("Magnify",{mouseButtonMask:1})},e.prototype.modulationTool=function(e){e.setHandler(a.wwwcSynchronizer),(0,a.setToolActive)("Wwwc",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.stackScrollTool=function(e){e.setHandler(a.stackImageIndexSynchronizer),(0,a.setToolActive)("StackScroll",{mouseButtonMask:1})},e.prototype.sharpenTool=function(){(0,a.setToolActive)("Sharpen",{mouseButtonMask:1})},e.prototype.blurTool=function(){(0,a.setToolActive)("Blur",{mouseButtonMask:1})},e.prototype.moveTool=function(e){e.setHandler(a.panZoomSynchronizer),(0,a.setToolActive)("Pan",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.FreehandRoiTool=function(){(0,a.setToolActive)("FreehandRoi",{mouseButtonMask:1})},e.prototype.ProbeCTTool=function(){(0,a.setToolActive)("ProbeCT",{mouseButtonMask:1})},e.prototype.ArrowAnnotateTool=function(){(0,a.setToolActive)("ArrowAnnotate",{mouseButtonMask:1})},e.prototype.AnnotateTool=function(){(0,a.setToolActive)("Annotate",{mouseButtonMask:1})},e.prototype.lrMarkerTool=function(e){"L"===e?(0,a.setToolActive)("AnnL",{mouseButtonMask:1}):(0,a.setToolActive)("AnnR",{mouseButtonMask:1})},e.prototype.heartratioTool=function(){(0,a.setToolActive)("Heartratio",{mouseButtonMask:1})},e.prototype.AITool=function(e){void 0===e&&(e=!1),e?(0,a.setToolPassive)("AI"):(0,a.setToolDisabled)("AI")},e.prototype.cancelTool=function(e,n){void 0===n&&(n=!0),a.globalImageIdSpecificToolStateManager.clear(e),n&&(0,t.updateImage)(e)},e.prototype.cancelToolAndDefaultViewportTools=function(e){var n,r;e&&0!==e.length||(e=(0,t.getEnabledElements)().map((function(e){return e.element})),a.globalImageIdSpecificToolStateManager.restoreToolState({}));try{for(var o=ki(e),i=o.next();!i.done;i=o.next()){var s=i.value;try{if(!s)continue;var l=(0,t.getImage)(s),c=(0,t.getDefaultViewportForImage)(s,l);((0,t.getViewport)(s)||{}).colormap&&Ka(s),this.cancelTool(s,!1),(0,t.setViewport)(s,Di(Di({},c),{sharpen:0,blur:0}))}catch(e){Ei(e)}}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e}();const Li=Oi;var Ri=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},_i=(0,a.importInternal)("util/scrollToIndex"),Ni=function(){function e(){this.layoutclassName="series-slider-layout",this.EVENTSHandle=new Map}return e.prototype.changMarker=function(e,t){var n=e.querySelector("#filmMarker");if(n){var r=n.innerHTML.split("-")[0]+"-"+n.innerHTML.split("-")[1]+"-"+(t+1);n.innerHTML=r}},e.prototype.createLayout=function(e,n,r){var o,i=this,l=e.querySelector(".".concat(this.layoutclassName)),c=function(){var t=e.dataset,n=t.imgRow,r=t.imgColumn;return Number(null!=n?n:1)*Number(null!=r?r:1)}(),u=Math.ceil((null===(o=null==n?void 0:n.imgs)||void 0===o?void 0:o.length)/c),d={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||l.clientHeight,this._scrollLen},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(u-1)/u,this._stepLen}},f=function(n){e.dataset.currentImageIdIndex=String(d.currentIndex),(0,t.triggerEvent)(t.events,"series_scroll",{element:e,imageIds:n,currentIndex:d.currentIndex,isSeriesImage:1!==c})};if(!l){var h=function(){var t,n=Ri((null===(t=(0,a.getToolState)(e,"stack"))||void 0===t?void 0:t.data)||[{}],1)[0],o=n.currentImageIdIndex,s=void 0===o?r||0:o,h=n.imageIds,p=d.scrollLen;if(l.scrollTop=p*s,s&&s%50==0&&q("scroll"),1===c)i.changMarker(e,s),d.currentIndex=s;else{var m=s;if(m>=u&&(m=u,_i(e,R.webDicomView.layoutView.iconPlayer.playerStatus?0:m-1)),d.currentIndex===m)return;d.currentIndex=m}f(h)};l=(0,s.createElement)({className:this.layoutclassName});var p=(0,s.createElement)();p.style.height="calc(100% * ".concat(u,")"),l.appendChild(p),e.appendChild(l),r&&(_i(e,r),l.scrollTop=d.scrollLen*r,r=void 0),this.EVENTSHandle.set(e,h),e.addEventListener(t.EVENTS.NEW_IMAGE,h),l.addEventListener("scroll",(function(t){var n,r=t.target,o=d.stepLen,i=d.currentIndex,s=Math.floor(r.scrollTop/o);if(!(s>=u||i==s)&&(_i(e,s),d.currentIndex=s,1!==c)){var l=Ri((null===(n=(0,a.getToolState)(e,"stack"))||void 0===n?void 0:n.data)||[{}],1)[0].imageIds;f(l)}}))}},e.prototype.removeLayout=function(e){var n=this.EVENTSHandle.get(e),r=e.querySelector(".".concat(this.layoutclassName));e.removeEventListener(t.EVENTS.NEW_IMAGE,n),null==r||r.remove()},e}();const Ui=Ni;const Bi=function(){function e(){this.className="study-slider-layout"}return e.prototype.createLayout=function(e,n,r){var o,a,i=e.querySelector(".".concat(this.className)),l=(o=r.x,a=r.y,Number(null!=o?o:1)*Number(null!=a?a:1)),c=Math.ceil(n.length/l),u=this.scrollData={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||i.clientHeight,this._scrollLen},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(c-1)/c,this._stepLen}};if(!i){this.container=i=(0,s.createElement)({className:this.className});var d=(0,s.createElement)();R.webDicomView.layoutView.canvasContainer.style.paddingRight=c<=1||"mobile"===R.env?"0px":"6px",i.style.display=c>1?"block":"none",d.style.height="calc(100% * ".concat(c,")"),i.appendChild(d),e.appendChild(i),i.addEventListener("scroll",(function(e){var n=e.target,r=u.stepLen,o=u.currentIndex,a=Math.floor(n.scrollTop/r);a>=c||o==a||((0,t.triggerEvent)(t.events,"study_scroll",{currentIndex:a,layoutCount:l}),u.currentIndex=a)}))}},e.prototype.visibility=function(e){this.container.style.visibility=e?"visible":"hidden"},e.prototype.setIndex=function(e){this.container.scrollTop=this.scrollData.stepLen*e+1},e}();var ji=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Fi=10,Vi=i().import("util/scrollToIndex"),Hi=function(e){var t=(0,a.getToolState)(e,"stack").data,n=ji(void 0===t?[]:t,1)[0],r=n.currentImageIdIndex,o=void 0===r?0:r,i=n.imageIds;return{imageIds:i,currentImageIdIndex:o,seriesImagesLen:i.length}},zi=function(){function e(){this.eventNamespace="player",this.elementPlayClip,this.playerStatus=!0,this.playData=[{id:"player1001",title:"第一张",flag:"control",icon:"icon-dicom-first"},{id:"player1002",title:"上一张",flag:"control",icon:"icon-dicom-previous"},{id:"player1003",title:"播放",flag:"control",cssText:"color: rgb(51, 255, 255);",icon:"icon-dicom-play"},{id:"player1004",title:"下一张",flag:"control",icon:"icon-dicom-Next"},{id:"player1005",title:"最后一张",flag:"control",icon:"icon-dicom-last"},{id:"player1006",title:"FPS",flag:"text"},{id:"player1007",title:"播放速度",flag:"input"}],this.iconControls=[]}return e.prototype.createPlayer=function(e,n,r){var o=this,a=n.querySelector("div.player-bar");if(a)return this.playerStatus=!1,void n.removeChild(a);this.elementPlayClip=e;for(var i=Hi(e),l=i.seriesImagesLen,c=i.currentImageIdIndex,u=(0,s.createElement)({className:"player-bar",ondblclick:function(e){e.stopPropagation()},onmousedown:function(e){e.stopPropagation()}}),d=function(n){var a=f.playData[n],i=a.flag,l=a.title,c=a.cssText,d=a.icon,h=a.id,p=(0,s.createElement)({tagName:"span"});switch(i){case"text":var m=(0,s.createElement)({tagName:"span",className:h,innerText:l});p.appendChild(m);break;case"input":var v=(0,s.createElement)({tagName:"input",className:h,type:"tel",value:Fi,onkeyup:function(e){var t,n=e.target,r=null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.replace(/[^\d]/g,""),o=Number(r);if(n.value=o>50?"50":o<1&&""!==r?"1":r,"Enter"===e.key){var a=R.webDicomView.layoutView.canvasContainer.querySelector('.control.icon-dicom-play[title="播放"]');null==a||a.click()}},onchange:function(e){var t=e.target,n=null==t?void 0:t.value;Fi=Number(n)||10,n||(t.value=String(Fi)),o.playerStatus&&o.playerStart()}});p.appendChild(v);break;case"control":var g=(0,s.createElement)({tagName:"i",className:"control ".concat(d," ").concat(h),title:l});g.style.cssText=c,g.addEventListener("mobile"===R.env?"touchstart":"click",(function(a){var i={event:a,series:r,playerData:o.playData[n],playerDom:e};(0,t.triggerEvent)(t.events,"iconplayer_series",i)})),f.iconControls.push(g),p.appendChild(g)}u.appendChild(p)},f=this,h=0;h<this.playData.length;h++)d(h);n.appendChild(u),this.toggleControlStyle(c,l),t.events.addEventNamespaceListener("canvas_active.".concat(this.eventNamespace),(function(e){var t=e.detail.$canvas,n=R.webDicomView.queryCurrentSeries();o.playerRemove(void 0,t!==o.elementPlayClip),o.createPlayer(t,t.parentElement,n)}))},e.prototype.playerToggle=function(e,t){t&&(this.elementPlayClip=t);var n=this.elementPlayClip.parentElement.querySelector(".player1003");this.playerStatus=e,this.playerToggleHandle(n,e)},e.prototype.playerStart=function(e){this.playerToggle(!0,e)},e.prototype.playerPause=function(e){this.playerToggle(!1,e)},e.prototype.playerRemove=function(e,n){void 0===n&&(n=!0);try{var r=e||this.elementPlayClip;if(r){var o=r.parentElement.querySelector("div.player-bar");o&&((0,a.stopClip)(r),o.remove(),n&&z("playerRemove")),this.playerStatus=!1,this.iconControls=[],this.elementPlayClip=void 0}}catch(e){Ei(e)}finally{t.events.removeEventNamespaceListener("canvas_active.".concat(this.eventNamespace))}},e.prototype.playerBarClickHandle=function(e){var t=e.playerData,n=e.playerDom;if("gray"!==e.event.target.style.color){var r=e.event.target,o=Hi(n),a=o.seriesImagesLen,i=o.currentImageIdIndex,s=i;switch(t.id){case"player1001":0!==i&&(s=0);break;case"player1002":i>=1&&(s-=1);break;case"player1003":this.playerToggleHandle(r,!this.playerStatus);break;case"player1004":i<a-1&&(s+=1);break;case"player1005":i!==a-1&&(s=a-1)}this.toggleControlStyle(s,a),Vi(n,s)}},e.prototype.playerToggleHandle=function(e,t){void 0===t&&(t=!1),z(t?"playerResume":"playerPause"),(0,a.stopClip)(this.elementPlayClip),this.playerStatus=t,t?(e.title="暂停",e.classList.remove("icon-dicom-play"),e.classList.add("icon-dicom-pause"),(0,a.playClip)(this.elementPlayClip,Fi)):(e.title="播放",e.classList.remove("icon-dicom-pause"),e.classList.add("icon-dicom-play"))},e.prototype.toggleControlStyle=function(e,t){this.iconControls.length&&(this.playerStatus&&(this.iconControls[0].style.color="gray",this.iconControls[1].style.color="gray",this.iconControls[3].style.color="gray",this.iconControls[4].style.color="gray"),0===e&&t>0&&!this.playerStatus&&(this.iconControls[0].style.color="gray",this.iconControls[1].style.color="gray",this.iconControls[3].style.color="rgb(51, 255, 255)",this.iconControls[4].style.color="rgb(51, 255, 255)"),e!==t-1||this.playerStatus||(this.iconControls[0].style.color="rgb(51, 255, 255)",this.iconControls[1].style.color="rgb(51, 255, 255)",this.iconControls[3].style.color="gray",this.iconControls[4].style.color="gray"),e>0&&e<t-1&&!this.playerStatus&&(this.iconControls[0].style.color="rgb(51, 255, 255)",this.iconControls[1].style.color="rgb(51, 255, 255)",this.iconControls[3].style.color="rgb(51, 255, 255)",this.iconControls[4].style.color="rgb(51, 255, 255)"))},e}();const qi=zi;var Wi=function(){return Wi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Wi.apply(this,arguments)},Gi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Yi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Zi=function(){function e(e,t,n){this.seriesSlider=e,this.studySlider=t,this.iconSynchronizer=n,this.seriesLayouts=[]}return e.prototype.initSingle=function(e,t,n,r){var o,a;n=Wi({imgRow:"1",imgColumn:"1"},n);var i=r||{},l=i.synchronizerStatus,c=i.scrollIndex;try{for(var u=Gi(Object.entries(n||{})),d=u.next();!d.done;d=u.next()){var f=Yi(d.value,2),h=f[0],p=f[1];!(0,s.isNull)(p)&&(e.dataset[h]=p)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}(0,s.isNull)(t)||(this.seriesSlider.createLayout(e,t,c),this.iconSynchronizer.createIconSynchronizer(e,l))},e.prototype.createCanvasSeries=function(e,n,r,o){var a;void 0===o&&(o=!0);var i=[],l=r.y,c=r.x,u=l*c;null===(a=e.querySelector(".container"))||void 0===a||a.remove();var d=(0,s.createElement)({className:"container"});d.setAttribute("style","\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(".concat(c,", calc(100% / ").concat(c,"));\n\t\t\t\tgrid-template-rows: repeat(").concat(l,", calc(100% / ").concat(l,"));\n\t\t\t\t"));for(var f=0;f<u;f++){var h=n[f],p=h||{},m=p.uuid,v=p.studyUID,g=p.arrImage,y=p.flatSeries,x=(0,s.createElement)({className:"layoutCellsOuter"+(1===u?" singleBoxMode":"")}),b=(0,s.createElement)({className:"layoutCellsInner"}),w=(null==g?void 0:g.length)||0;m&&(b.dataset.seriesId=m,b.dataset.studyUID=v,b.dataset.seriesIndex=String(f),b.dataset.seriesRow=String(l),b.dataset.seriesColumn=String(c),y&&(b.dataset.flatSeries=String(y))),this.initSeriesLayout(b,h),o&&w&&(this.seriesSlider.createLayout(b,h),this.iconSynchronizer.createIconSynchronizer(b)),i.push(b),x.appendChild(b),d.appendChild(x)}this.studySlider.createLayout(e,n,r),e.appendChild(d),(0,t.triggerEvent)(t.events,"canvas_active",{$canvas:i[0]})},e.prototype.createImagesLayout=function(e,t,n){var r=this,o=t,a=n.y,i=n.x,l=a*i;e.dataset.imgRow=String(a),e.dataset.imgColumn=String(i),e.dataset.seriesId=o.uuid,this.seriesSlider.createLayout(e,o);var c=(0,s.createElement)({className:"layoutImageLayout"});c.setAttribute("style","\n\t\t\t\theight:100%;\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(".concat(i,", calc(100% / ").concat(i,"));\n\t\t\t\tgrid-template-rows: repeat(").concat(a,", calc(100% / ").concat(a,"));\n\t\t\t\t"));for(var u=function(t){var n=(0,s.createElement)({className:0===t?"layoutImage active":"layoutImage"});new(Pe())(n).on("tap press panstart",(function(n){r.toggleStyle(e,t,"layoutImage"),n.preventDefault()})),c.appendChild(n)},d=0;d<l;d++)u(d);e.appendChild(c)},e.prototype.dblclickCanvasLayout=function(e,n,r){if(!e.classList.contains("singleBoxMode")){var o=n.querySelectorAll(".layoutImage"),a=null!=r?r:e.classList.contains("signBigLayout"),i=R.webDicomView.querySeries(n.dataset.seriesId);e.classList[a?"remove":"add"]("signBigLayout"),this.studySlider.visibility(a),this.seriesSlider.removeLayout(n),i&&(o.length?o.forEach((function(e){(0,t.resize)(e)})):(0,t.resize)(n),this.seriesSlider.createLayout(n,i,Number(n.dataset.currentImageIdIndex)))}},e.prototype.initSeriesLayout=function(e,n){var r=this,o=function(e,n){(0,t.triggerEvent)(t.events,"canvas_active",{$canvas:e,type:n})};if(e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(function(t){t.preventDefault(),o(e,"drop")})),e.addEventListener("wheel",(function(){o(e,"wheel")})),e.addEventListener("click",(function(){o(e,"click")})),e.addEventListener("touchstart",(function(n){var r=n.type;o(e,"touchstart"),(0,t.triggerEvent)(t.events,"layout_area_focus",{area:"seriesLayout",type:r})})),new(Pe())(e).on("doubletap",(function(){r.dblclickCanvasLayout(e.parentElement,e)})),e.addEventListener(t.EVENTS.IMAGE_RENDERED,(function(e){(0,t.triggerEvent)(t.events,"images_viewport",e.detail)})),n&&""!==n.uuid){var a={seriesId:n.uuid,seriesDom:e};this.seriesLayouts.push(a)}else{a={seriesId:void 0,seriesDom:e};this.seriesLayouts.push(a)}},e.prototype.toggleSeriesStyle=function(e){var t=this,n=e.target,r=e.seriesId,o=e.seriesIndex;R.webDicomView.layoutView.canvasContainer.querySelectorAll(".layoutCellsOuter").forEach((function(e){var a=e.querySelector(".layoutCellsInner"),i=a.dataset,s=i.seriesId,l=i.seriesIndex;if(null!=n&&a===n||null!=r&&s===r||null!=o&&Number(l)===o){if(e.classList.add("active"),a.classList.add("active"),a.classList.contains("noActiveBorder")){var c=a.querySelector(".layoutImage");c?a.querySelector(".layoutImage.active")||c.click():a.classList.remove("noActiveBorder")}}else e.classList.remove("active"),a.classList.remove("active"),t.toggleStyle(e,-1,"layoutImage")}))},e.prototype.toggleStyle=function(e,t,n){for(var r=e.getElementsByClassName(n),o=r.length,a=0;a<o;a++)a===t?r[a].classList.add("active"):r[a].classList.remove("active")},e.prototype.scrollIntoView=function(e,t){void 0===t&&(t=0),setTimeout((function(){"scrollIntoViewIfNeeded"in e?e.scrollIntoViewIfNeeded():e.scrollIntoView()}),t)},e.prototype.toggleNavigatorInfo=function(e){R.webDicomView.layoutView.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper").forEach((function(t){t.dataset.seriesId==e?(t.classList.add("active"),t.classList.add("showProgress")):(t.classList.remove("active"),!A.fullLoad&&t.classList.remove("showProgress"))}))},e}();const Xi=Zi;const Qi=function(){function e(e){this.id=e,this.ElementContent=void 0}return e.prototype.createLayout=function(){var e=R.webDicomView.globalContainer.querySelector("#".concat(this.id));if(e)e.style.zIndex="98";else{var n=R.webDicomView.globalContainer.querySelector(".viewerContentWrapper");this.ElementContent=e=(0,s.createElement)({id:this.id,oncontextmenu:function(e){return e.preventDefault()}}),e.setAttribute("style","\n\t\t\t    position: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\tz-index: 98;\n\t\t\t\t\tbackground: #000;\n\t\t\t\t\tborder: 2px solid #CACACA;\n\t\t\t\t\tborder-top: none;\n\t\t\t\t\t// padding: 2px;\n\t\t\t\t\t// margin: 2px;\n\t\t"),e.addEventListener("touchmove",(function(e){var n=e.type;(0,t.triggerEvent)(t.events,"layout_area_focus",{area:"seriesMPROr3DLayout",type:n}),e.preventDefault()}),{passive:!1}),n.append(e)}return e},e.prototype.hidden=function(){this.ElementContent&&(this.ElementContent.style.zIndex="-1")},e}();var Ki=function(){function e(){}return e.prototype.createIconSynchronizer=function(e,t){var n=this,r=e.querySelector(".seriesSynchronizerLayout");if(!r){var o="iconCheckBox"+e.dataset.seriesIndex;r=(0,s.createElement)({className:"seriesSynchronizerLayout",title:"序列同步器",onclick:function(t){var r;n.triggerEventHandle(e,null===(r=t.target)||void 0===r?void 0:r.checked)},ontouchstart:function(t){var r=a,o=r.checked=!r.checked;try{n.triggerEventHandle(e,o)}catch(e){ue().info({title:"序列同步器已打开，请重新选择需要同步的功能",timeout:1e4})}},ondblclick:function(e){e.stopPropagation()}});var a=(0,s.createElement)({tagName:"input",className:"checkbox-input",type:"checkbox",checked:t,id:o}),i=(0,s.createElement)({tagName:"label",className:"checkbox-label",onclick:function(e){e.stopPropagation()}});i.setAttribute("for",o),i.appendChild((0,s.createElement)({tagName:"span",className:"circle"})),i.appendChild((0,s.createElement)({tagName:"span",className:"text on",innerText:"关闭"})),i.appendChild((0,s.createElement)({tagName:"span",className:"text off",innerText:"联动"})),r.appendChild(a),r.appendChild(i),e.appendChild(r),this.triggerEventHandle(e,t)}},e.prototype.triggerEventHandle=function(e,n){var r={element:e};switch(n){case!0:(0,t.triggerEvent)(t.events,"series_synchronizer_add",r);break;case!1:(0,t.triggerEvent)(t.events,"series_synchronizer_remove",r)}},e.prototype.removeSynchronizer=function(e){var t=e.querySelector(".seriesSynchronizerLayout");null==t||t.remove()},e}();const Ji=Ki,$i=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}];var es=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},ts=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const ns={main:[{toolName:"序列栏",toolTag:"seriesBar",icon:"icon-dicom-side",disActive:!0,visibility:function(){return"mobile"===R.env}},{toolName:"MPR",toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:function(){return R.toolsBar.MPRVisibility}},{toolName:"3D",toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:function(){return R.toolsBar.VRTVisibility}},{toolName:"AI",toolTag:"AI",icon:"icon-dicom-ai",isToggle:!0,visibility:function(){return R.toolsBar.AIVisibility}},{toolName:function(){return["极速模式","标准模式","专业模式"][R.imageType+1]},toolTag:"imageType",icon:function(){return["icon-dicom-mode3","icon-dicom-mode1","icon-dicom-mode2"][R.imageTypeDefault+1]},disActive:!0,select:!0},{toolName:"重载",toolTag:"reload",icon:"icon-dicom-reload",disActive:!0},{toolName:"释放",toolTag:"disableAllTool",icon:"icon-dicom-release"},{toolName:"恢复",toolTag:"cancelToolAndDefaultViewport",icon:"icon-dicom-restore",disActive:!0,divider:!0},{toolName:"翻页",toolTag:"stackScroll",icon:"icon-dicom-paging",visibility:function(){return"mobile"===R.env}},{toolName:"调窗",toolTag:"modulation",icon:"icon-dicom-tiaochuang",select:!0},{toolName:"移动",toolTag:"move",icon:"icon-dicom-move",visibility:function(){return"mobile"!==R.env}},{toolName:"序列",toolTag:"series",icon:"icon-dicom-series",disActive:!0,select:!0},{toolName:"图像",toolTag:"image",icon:"icon-dicom-layout",disActive:!0,select:!0},{toolName:"放大镜",toolTag:"magnify",icon:"icon-dicom-magnifier"},{toolName:"播放",toolTag:"timeplay",icon:"icon-dicom-player",disActive:!0},{toolName:"旋转",toolTag:"rotate",icon:"icon-dicom-rotate",select:!0},{toolName:"负像",toolTag:"invert",disActive:!0,icon:"icon-dicom-negative"},{toolName:"缩放",toolTag:"scale",icon:"icon-dicom-scale",divider:!0,select:!0,visibility:function(){return"mobile"!==R.env}},{toolName:"测量",icon:"icon-dicom-measure",children:[{toolName:"直线",toolTag:"straightline",icon:"icon-dicom-line"},{toolName:"曲面测量",toolTag:"freehandRoi",icon:"icon-dicom-curve"},{toolName:"角度",toolTag:"angle",icon:"icon-dicom-angle"},{toolName:"cobb角",toolTag:"cobbAngle",icon:"icon-dicom-cobb"},{toolName:"矩形",toolTag:"rect",icon:"icon-dicom-rectangle"},{toolName:"椭圆",toolTag:"elliptical",icon:"icon-dicom-round"}]},{toolName:"批注",icon:"icon-dicom-annotate",children:[{toolName:"文本批注",toolTag:"annotate",icon:"icon-dicom-text"},{toolName:"箭头批注",toolTag:"arrowAnnotate",icon:"icon-dicom-one-line-arrow"},{toolName:"左标记",toolTag:"lMarker",icon:"icon-dicom-L"},{toolName:"右标记",toolTag:"rMarker",icon:"icon-dicom-R"}]},{toolName:"删除标注",toolTag:"eraser",icon:"icon-dicom-rubber"},{toolName:"全部撤销",toolTag:"cancelToolState",icon:"icon-dicom-clean",disActive:!0,divider:!0},{toolName:"增强",icon:"icon-dicom-enhance",visibility:function(){return R.toolsBar.enhanceVisibility},children:[{toolName:"锐化",toolTag:"sharpen",icon:"icon-dicom-sharpen"},{toolName:"平滑",toolTag:"blur",icon:"icon-dicom-blur"}]},{toolName:"伪彩",toolTag:"colorMap",disActive:!0,icon:"icon-dicom-color-map",select:!0},{toolName:"定位线",toolTag:"referenceLine",isToggle:!0,icon:"icon-dicom-referenceLine"},{toolName:"心胸比",toolTag:"ctr",icon:"icon-dicom-CTR",divider:!0},{toolName:"更多",icon:"icon-dicom-more",children:[{toolName:"DICOM信息",toolTag:"DICOMMetaDataInfo",disActive:!0,icon:"icon-dicom-info"},{toolName:"四角信息",toolTag:"visibilityCavanAroundInfo",isToggle:!0,isActive:R.cavanAroundInfo,icon:"icon-dicom-show"},{toolName:"删除图像",toolTag:"disableSeries",icon:"icon-dicom-delete",disActive:!0},{toolName:"保存图片",toolTag:"saveImage",icon:"icon-dicom-img-save",disActive:!0},{toolName:"使用缓存",toolTag:"useCacheImage",icon:"icon-dicom-save",isToggle:!0,isActive:O.enable},{toolName:"高性能模式",toolTag:"imageCacheType",icon:"icon-dicom-speed",isToggle:!0,isActive:1===R.imageCacheTypeDefault}]},{toolName:"关于我们",toolTag:"aboutUs",icon:"icon-dicom-about",disActive:!0,floatRight:!0,visibility:function(){return R.toolsBar.aboutUsVisibility}}],MPR:[{toolName:"2D",toolTag:"MPRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:"3D",toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:function(){return R.toolsBar.VRTVisibility}},{toolName:"翻页",toolTag:"MPRstackScroll",icon:"icon-dicom-paging",visibility:function(){return"mobile"===R.env}},{toolName:"十字准星",toolTag:"MPRCrosshairs",icon:"icon-dicom-aim"},{toolName:"调窗",toolTag:"MPRmodulation",icon:"icon-dicom-tiaochuang",visibility:function(){return"mobile"===R.env}},{toolName:"缩放",toolTag:"MPRZoom",icon:"icon-dicom-scale",visibility:function(){return"mobile"!==R.env}},{toolName:"重置视图",toolTag:"MPRReset",icon:"icon-dicom-reload",disActive:!0,divider:!0},{toolName:"CT预设",icon:"icon-dicom-color-map",isLonelyGroup:!0,children:ts([],es($i.map((function(e){return{toolName:e.name,toolTag:"MPRCTPreset"}}))),!1)}],VRT:[{toolName:"2D",toolTag:"VTRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:"MPR",toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:function(){return R.toolsBar.MPRVisibility}},{toolName:"旋转",toolTag:"VRTRotate",icon:"icon-dicom-rotate3d",visibility:function(){return"mobile"===R.env}},{toolName:"骨窗调节",toolTag:"VRTModulation",icon:"icon-dicom-tiaochuang",visibility:function(){return"mobile"===R.env}},{toolName:"手术刀内",toolTag:"VRTKnifeIn",icon:"icon-dicom-shoushudao1"},{toolName:"手术刀外",toolTag:"VRTKnifeOut",icon:"icon-dicom-shoushudao"},{toolName:"重置视图",toolTag:"VRTReset",icon:"icon-dicom-reload",disActive:!0}]};const rs=[{title:"患者信息",labels:[{title:"name",alias:"姓名"},{title:"sex",alias:"性别",format:x},{title:"age",alias:"年龄",format:y},{title:"birth",alias:"生日"},{title:"patid",alias:"患者ID"}]},{title:"检查信息",labels:[{title:"inst",alias:"机构医院"},{title:"acqdt",alias:"图像获取日期"},{title:"acqtm",alias:"图像获取时间"},{title:"studt",alias:"检查日期"},{title:"stutm",alias:"检查时间"},{title:"studes",alias:"检查描述"},{title:"accnum",alias:"检查流水号"}]},{title:"序列信息",labels:[{title:"serid",alias:"序列ID"},{title:"seruid",alias:"序列UID"},{title:"serdes",alias:"序列描述"}]},{title:"图像信息",labels:[{title:"imgnum",alias:"影像号"},{title:"wc",alias:"默认窗位"},{title:"ww",alias:"默认窗宽"},{title:"ma",alias:"电流"},{title:"kv",alias:"电压"},{title:"sliceth",alias:"层厚"},{title:"row",alias:"像素行数"},{title:"col",alias:"像素列数"},{title:"pixx",alias:"像素间X高距离"},{title:"pixy",alias:"像素间Y高距离"},{title:"bita",alias:"图像分配位数"},{title:"bits",alias:"实际占用位数"},{title:"hbit",alias:"高位"},{title:"rescin",alias:"偏移量"},{title:"rescsl",alias:"调整斜率"},{title:"pixrep",alias:"符号标识"},{title:"frames",alias:void 0},{title:"sappix",alias:"像象素所点位"},{title:"phme",alias:"图像光度"},{title:"imgpos",alias:"图像位置"},{title:"imgori",alias:"图像方位"},{title:"imgtype",alias:void 0},{title:"orl",alias:"图像方位左"},{title:"orr",alias:"图像方位右"},{title:"ort",alias:"图像方位上"},{title:"orb",alias:"图像方位下"},{title:"scount",alias:void 0},{title:"blocks",alias:"分片"}]},{title:"设备信息",labels:[{title:"mod",alias:"设备型号"},{title:"manu",alias:"设备厂商"}]},{title:"UID信息",labels:[{title:"id",alias:void 0},{title:"sopuid",alias:"图像唯一号"},{title:"uid",alias:void 0},{title:"uuid",alias:void 0},{title:"stuid",alias:"检查UID"},{title:"stuuid",alias:void 0},{title:"syntaxuid",alias:void 0}]},{title:"其他信息",labels:[{title:"fileName",alias:"文件名"},{title:"relationid",alias:void 0},{title:"fileLocation",alias:void 0},{title:"dcmfile",alias:void 0}]}];var os=function(){return os=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},os.apply(this,arguments)},as=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},is=ns.MPR,ss=ns.VRT,ls=ns.main,cs=function(){function e(){this.toolsDataMPR=is,this.toolsDataVRT=ss,this.toolsData=ls,this.rotatePop=new fi,this.imageTypeLayout=new ii,this.wwwcLayout=new ci,this.scale=new Ii,this.colorMap=new gi,this.seriesMarker=new Si,this.topTools=new Li,this.seriesSlider=new Ui,this.studySlider=new Bi,this.iconSynchronizer=new Ji,this.seriesLayout=new Xi(this.seriesSlider,this.studySlider,this.iconSynchronizer),this.mprLayout=new Qi("MPRContent"),this.vrtLayout=new Qi("VRTContent"),this.iconPlayer=new qi,this.seriesLayouts=[],this.imagesLayouts=[]}return e.prototype.resizeLayout=function(e){e.querySelectorAll(".layoutCellsInner").forEach((function(e){e.querySelectorAll(".layoutImage").forEach((function(e){try{(0,t.resize)(e)}catch(e){}}));try{(0,t.resize)(e)}catch(e){}}))},e.prototype.createImageTypeLayout=function(e){this.imageTypeLayout.createLayout(e)},e.prototype.createWWWCLayout=function(e){this.wwwcLayout.createLayout(e)},e.prototype.createRotateLayout=function(e){this.rotatePop.createLayout(e)},e.prototype.createScaleLayout=function(e){this.scale.createLayout(e)},e.prototype.createColorMapLayout=function(e){this.colorMap.createLayout(e)},e.prototype.createPopupLayout=function(e,t,n){void 0===e&&(e="提示"),void 0===n&&(n="");var r=R.webDicomView.globalContainer,o=r.querySelector(".popupLayout"),a=null==o?void 0:o.querySelector(".popup-info-content"),i=null==o?void 0:o.querySelector(".popup-info-title");if(o)a.innerHTML="",i.innerText=e,o.style.visibility="initial";else{o=(0,s.createElement)({className:"popupLayout"});var l=(0,s.createElement)({className:"popup-info-layout"}),c=(0,s.createElement)({className:"popup-info-title-bar"});i=(0,s.createElement)({className:"popup-info-title",innerText:e});var u=(0,s.createElement)({className:"popup-info-close",innerText:"关闭",onclick:function(){o.style.visibility="hidden"}});a=(0,s.createElement)({className:"popup-info-content"}),c.append(i),c.append(u),l.append(c),l.append(a),o.append(l),r.appendChild(o)}a.setAttribute("style",n),"string"==typeof t?a.innerHTML=t:a.append(t)},e.prototype.createDICOMMetaDataInfoLayout=function(e){var t,n,r,o,a,i="";try{for(var l=as(rs),c=l.next();!c.done;c=l.next()){var u=c.value,d=u.title,f=u.labels;i+="<div class='title'>".concat(d,"</div>");try{for(var h=(r=void 0,as(f)),p=h.next();!p.done;p=h.next()){var m=p.value,v=m.title,g=m.alias,y=m.format,x=null!==(a=e[v])&&void 0!==a?a:"";x="function"===(0,s.dataType)(y)?y(x):x,i+="\n\t\t\t\t\t\t<div class='DICOM-meta-data-cell' title='".concat(g?g+",":"").concat(v,"：").concat(x||"undefined","'>\n\t\t\t\t\t\t<div class='label'>").concat(g||v,"</div>\n\t\t\t\t\t\t<div class='value'>").concat(x,"</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t")}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}this.createPopupLayout("DICOM信息",i)},e.prototype.createAboutUsLayout=function(e){var t=e.version,n=e.copyright,r=e.description,o=e.tel,a=e.imgURl,i=(0,s.createElement)({tagName:"div",className:"about-Us-2"}),l=(0,s.createElement)({tagName:"div",className:"contains"}),c=(0,s.createElement)({tagName:"div",className:"bar"}),u=(0,s.createElement)({tagName:"div",className:"logo"}),d=r?(0,s.createElement)({tagName:"div",className:"dark description",innerHTML:"".concat(r)}):"",f=t?(0,s.createElement)({tagName:"div",innerHTML:'<span class="dark">软件发布版本号：</span><span class="bold">V'.concat(String(t).split(".")[0],"</span>")}):"",h=t?(0,s.createElement)({tagName:"div",innerHTML:'<span class="dark">软件完整版本号：</span><span class="bold">V'.concat(t,"</span>")}):"",p=n?(0,s.createElement)({tagName:"div",innerHTML:'<i class="iconfont icon-contacts"></i><span class="bold">'.concat(n,"</span>")}):"",m=o?(0,s.createElement)({tagName:"div",innerHTML:'<i class="iconfont icon-tel"></i><span class="bold">'.concat(o,"</span>")}):"";c.append(p),c.append(m),a&&(u.style.backgroundImage="url(".concat(a,")")),(a||void 0===a)&&l.append(u),l.append(d),l.append(f),l.append(h),i.append(l),i.append(c),this.createPopupLayout("关于我们",i,"padding:0;height:auto;")},e.prototype.createImageLayout=function(e,t){var n=(0,s.createElement)({tagName:"img",src:e,alt:t});n.setAttribute("style","\n\t\t\tmargin: auto;\n\t\t\theight: 100%;\n\t\t"),this.createPopupLayout("长按保存图像",n)},e.prototype.createSeriesMarker=function(e,t,n){var r=t.stuuid,o=R.webDicomView.queryStudy(r);this.seriesMarker.createParagraph(e,"ltMarker",t,n,o),this.seriesMarker.createParagraph(e,"rtMarker",t,n,o),this.seriesMarker.createParagraph(e,"lbMarker",t,n,o),this.seriesMarker.createParagraph(e,"rbMarker",t,n,o)},e.prototype.imageType=function(e){this.imageTypeLayout.handleLayout(e)},e.prototype.wwwcImage=function(e,t){this.wwwcLayout.handleLayout(e,t)},e.prototype.scaleImage=function(e,t){this.scale.handleLayout(e,t)},e.prototype.rotateImage=function(e,t){this.rotatePop.handleLayout(e,t)},e.prototype.colorMapImage=function(e,t,n){this.colorMap.handleLayout(e,t,n)},e.prototype.createSeriesCellLayout=function(e,n,r,o){var a=this,i=r||{},l=i.x,c=void 0===l?6:l,u=i.y,d=void 0===u?6:u;new ni("series"===n?"select-layout":"select-image-layout",e.detail,(function(e){for(var r=function(r){for(var o=function(o){var i=(0,s.createElement)({className:"select-grid-item",onclick:function(){(0,t.triggerEvent)(t.events,"series"===n?"tool_series_layout":"tool_series_image_layout",{type:n,ptCell:{x:o,y:r}})},onmouseover:function(){a.changeCellStyle(e,{x:o,y:r})}});i.setAttribute("data-x",o+""),i.setAttribute("data-y",r+""),e.appendChild(i)},i=1;i<=c;i++)o(i)},o=1;o<=d;o++)r(o);e.setAttribute("style","\n\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\tgrid-template-columns: repeat(".concat(c,", 24px);\n\t\t\t\t\t\tgrid-template-rows: repeat(").concat(d,", 24px);\n\t\t\t\t\t\tpadding: 4px;\n\t\t\t\t\t\t"))}),(function(e){a.changeCellStyle(e,o)}))},e.prototype.initLayout=function(e){var n=this,r=(0,s.createElement)({className:"dicomViewToolbar"}),o=(0,s.createElement)({tagName:"img",src:R.logoURL,className:"logo",crossOrigin:"Anonymous"}),a=(0,s.createElement)({className:"divider"}),i=(0,s.createElement)({className:"viewerContentWrapper",id:"viewerContentWrapper"});if(this.leftSideContainer=(0,s.createElement)({className:"viewerLeftSidePanel"}),this.canvasContainer=(0,s.createElement)({className:"canvasbox",oncontextmenu:function(e){return e.preventDefault()}}),this.toolsContainer=(0,s.createElement)({className:"toolbar",onmousewheel:function(e){"mobile"!==R.env&&(n.toolsContainer.scrollLeft+=150*(e.deltaY>0?1:-1))}}),this.toolsContainer.addEventListener("touchmove",(function(e){var n=e.type;(0,t.triggerEvent)(t.events,"layout_area_focus",{area:"toolbarLayout",type:n})}))," "!==R.logoURL){var l=this.logoGrouper=(0,s.createElement)({className:"logoGroup"});l.appendChild(a),l.appendChild(o),r.appendChild(l)}i.appendChild(this.leftSideContainer),i.appendChild(this.canvasContainer),r.appendChild(this.toolsContainer),"mobile"===R.env&&e.classList.add("isMobile"),e.classList.add("dicomView"),e.addEventListener("touchstart",(function(e){e.stopPropagation()})),e.appendChild(r),e.appendChild(i)},e.prototype.initTop2DTools=function(e,t){void 0===t&&(t=!1);var n=this.toolsData,r=n.find((function(t){return t.toolName===e}));this.topTools.createTopTools(this.toolsContainer,n,r,"tools2d",t)},e.prototype.initTopMPRTools=function(e,t){void 0===t&&(t=!0);var n=this.toolsDataMPR,r=n.find((function(t){return t.toolName===e}));this.topTools.createTopTools(this.toolsContainer,n,r,"toolsMPR",t)},e.prototype.initTopVRTTools=function(e,t){void 0===t&&(t=!0);var n=this.toolsDataVRT,r=n.find((function(t){return t.toolName===e}));this.topTools.createTopTools(this.toolsContainer,n,r,"toolsVRT",t)},e.prototype.createStudyNavigationGroup=function(e,t,n){var r=(0,s.createElement)({className:"studyNavigationContainer"}),o=t.length;this.leftSideContainer.appendChild(r),this.navigatorStudyToggleStyle(r,o),this.renderStudyInfo(r,e,o),this.renderDicomIcon(r,t,n)},e.prototype.renderDicomIcon=function(e,n,r){for(var o=(0,s.createElement)(),a=null,i=function(e,t){void 0===t&&(t=0),setTimeout((function(){e.scrollIntoView({behavior:"smooth",block:"center"})}),t)},l=function(e){var l=n[e],c=l.seriesDescription,u=l.icon,d=l.seriesId,f=l.images,h=l.series.flatSeries;l.seriesIndex=e;var p={iconImage:l},m=(0,s.createElement)({className:"viewer-navigator-wrapper",draggable:!0,onclick:function(e){clearTimeout(a),a=setTimeout((function(){(0,t.triggerEvent)(t.events,"navigator_active",os(os({},p),{target:e.target,type:"click",event:e})),i(m,e.isTrusted?0:500)}),200)},ondblclick:function(){clearTimeout(a),(0,t.triggerEvent)(t.events,"navigator_dbClick_drag",os(os({},p),{type:"dblclick"})),i(m)},ondragend:function(e){"none"!==e.dataTransfer.dropEffect&&(0,t.triggerEvent)(t.events,"navigator_dbClick_drag",os(os({},p),{type:"drag"}))},oncontextmenu:function(e){e.preventDefault()}});"mobile"===R.env&&new(Pe())(m).on("press doubletap",(function(){(0,t.triggerEvent)(t.events,"navigator_dbClick_drag",os(os({},p),{type:"press doubletap"}))}));var v=(0,s.createElement)({className:"navigator-card"}),g=(0,s.createElement)({tagName:"span",className:"icon-image"}),y=(0,s.createElement)({tagName:"span",className:"navigator-text-wrapper"}),x="序列".concat(e+1," "),b=(0,s.createElement)({tagName:"span",className:"text",innerHTML:x}),w="共".concat(f.length,"图"),T=(0,s.createElement)({tagName:"span",className:"num",innerHTML:w}),I=(0,s.createElement)({tagName:"span",className:"navigator-description",title:c,innerText:"".concat(c||"")}),S=(0,s.createElement)({tagName:"img",src:u,crossOrigin:"Anonymous",decoding:"async",loading:"lazy",draggable:!1}),E=(0,s.createElement)({className:"AI-icon",tagName:"span"}),C=(0,s.createElement)({tagName:"div",className:"progressGroup"}),A=(0,s.createElement)({tagName:"span",className:"progressNum"}),M=(0,s.createElement)({tagName:"div",className:"progressBar"});if(0==r&&0===e&&(m.classList.add("active"),A.innerText="0%"),m.dataset.seriesId=d,m.dataset.index=String(e),h&&(m.dataset.flatSeries=String(h)),(0,s.env)().isWeChat){var P=(0,s.createElement)();P.setAttribute("style","\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t"),g.appendChild(P)}g.appendChild(S),g.appendChild(E),y.appendChild(b),y.appendChild(T),y.appendChild(I),C.appendChild(A),C.appendChild(M),v.appendChild(g),v.appendChild(y),m.appendChild(v),m.appendChild(C),o.appendChild(m)},c=0;c<n.length;c++)l(c);e.appendChild(o)},e.prototype.renderStudyInfo=function(e,t,n){var r=this,o=t.name,a=t.sex,i=t.age,l=t.modality,c=t.studydate,u=(0,s.createElement)({className:"panel-info"}),d=(0,s.createElement)({tagName:"p",innerHTML:"<span title='".concat(o,"'>").concat(o,"</span>/").concat(x(a),"/").concat(y(i))}),f=(0,s.createElement)({tagName:"p",innerText:l}),h=(0,s.createElement)({tagName:"p",innerText:c});u.appendChild(f),u.appendChild(d),u.appendChild(h),e.appendChild(u),u.onclick=function(){r.navigatorStudyToggleStyle(e,n)}},e.prototype.navigatorStudyToggleStyle=function(e,t){e.classList.contains("active")?e.style.cssText=void 0:e.style.maxHeight=120*t+100+"px",e.classList.toggle("active")},e.prototype.seriesBarToggle=function(e){var t,n=this.toolsContainer.querySelector(".tools2d .tool-btn-style.seriesBar");this.leftSideContainer.classList.toggle("show",e),null===(t=this.logoGrouper)||void 0===t||t.classList.toggle("show",e),n.classList.toggle("active",e)},e.prototype.selectPopupHidden=function(){var e;null===(e=this.toolsContainer.querySelector(".select-popup-layout:not(.invisible)"))||void 0===e||e.classList.add("invisible")},e.prototype.toggleToolStyle=function(e){var t,n,r=e||{},o=r.disActive,a=r.isToggle,i=r.btnTarget,s=r.btnOriginTarget,l=r.parentData,c=(void 0===l?{isLonelyGroup:void 0}:l).isLonelyGroup;if(!o){if(a&&i)return i.classList.toggle("active"),void(null==s||s.classList[i.parentElement.querySelector(".active")?"add":"remove"]("active"));var u=this.toolsContainer.querySelectorAll(".toolsChild.active .tool-event-link"),d=function(e){var t=JSON.parse(e.dataset.toolData||"{}"),n=t.disActive,r=t.isToggle,o=t.children,a=t.parentData,i=(void 0===a?{isLonelyGroup:void 0}:a).isLonelyGroup;if(n||r)return"continue";c===i&&e.classList.remove("active"),o&&setTimeout((function(){e.classList[e.querySelector(".active")?"add":"remove"]("active")}))};try{for(var f=as(u),h=f.next();!h.done;h=f.next()){d(h.value)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}null==i||i.classList.add("active"),null==s||s.classList.add("active")}},e.prototype.changeCellStyle=function(e,t){if(t)for(var n=e.getElementsByTagName("div"),r=0;r<n.length;r++){var o=Number(n[r].getAttribute("data-x")),a=Number(n[r].getAttribute("data-y"));o<=t.x&&a<=t.y?n[r].classList.add("active"):n[r].classList.remove("active")}},e.prototype.progressCountStyle=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=!1);var o=this.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(e,"']"));if(r)o.classList.add("showProgress");else if(!o.classList.contains("showProgress")&&!o.classList.contains("active"))return;var a,i=o.querySelector(".progressNum"),s=o.querySelector(".progressBar");if(t>=0&&(a=(n/t*100).toFixed(0)+"%",i.innerText=a,s.style.width=a),"100%"===a)return o.classList.add("loaded"),void o.classList.remove("showProgress");void 0!==t||r||o.classList.remove("showProgress")},e.prototype.toggleCavanAroundInfoStyle=function(e){this.canvasContainer.querySelectorAll("#ltMarker,#rtMarker,#lbMarker,#rbMarker").forEach((function(t){t.style.opacity=e?"1":"0"}))},e.prototype.toggleAIIconStyle=function(e){var t,n=this;e?e.forEach((function(e){var t;null===(t=n.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(e,"']")))||void 0===t||t.classList.add("show-AI")})):null===(t=this.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper.show-AI"))||void 0===t||t.forEach((function(e){e.classList.remove("show-AI")}))},e.prototype.clearSeriesLayout=function(e,t){var n,r,o;void 0===t&&(t=!1);var a=e.querySelector(".layoutImageLayout"),i=e.querySelectorAll(".layoutImage"),s=e.querySelectorAll("#ltMarker,#rtMarker,#lbMarker,#rbMarker");t?null===(o=e.querySelector("canvas"))||void 0===o||o.remove():qa(e),i.forEach((function(e){qa(e),null==e||e.remove()})),null==a||a.remove(),s.forEach((function(e){null==e||e.remove()})),this.seriesSlider.removeLayout(e),this.iconSynchronizer.removeSynchronizer(e);try{for(var l=as(["seriesId","studyUID","column","row"]),c=l.next();!c.done;c=l.next()){var u=c.value;delete e.dataset[u]}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}this.iconPlayer.playerRemove(e)},e}();const us=cs;var ds=function(){return ds=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ds.apply(this,arguments)},fs=function(){function e(e){var t=this;this.options=ds({message:void 0,position:"center",class:"mobile"===R.env?"custom-iziToast-mobile":"custom-iziToast",close:!1,theme:"dark",overlay:!0,image:n(5187),timeout:!1,onOpening:function(){try{var e=t.dicomViewContainer,n=document.querySelector(".iziToast-overlay"),r=null==e?void 0:e.getBoundingClientRect(),o=r.top,a=r.left,i=r.bottom,s=r.right,l=r.width,c=r.height;n&&(n.style.top="".concat(o,"px"),n.style.left="".concat(a,"px"),n.style.bottom="".concat(i-c,"px"),n.style.right="".concat(s-l,"px"),n.style.width="".concat(l,"px"),n.style.height="".concat(c,"px"))}catch(e){console.error(e)}}},e),this.loading=!1}return Object.defineProperty(e.prototype,"dicomViewContainer",{get:function(){return this._dicomViewContainer=this._dicomViewContainer||R.webDicomView.globalContainer},enumerable:!1,configurable:!0}),e.prototype.show=function(e){this.loading||(this.loading=!0,ue().show(ds(ds({},this.options),e)))},e.prototype.progress=function(e){return ue().progress(ds({},e),document.querySelector("."+this.options.class))},e.prototype.hidden=function(){this.loading&&(this.loading=!1,ue().hide({},".".concat(this.options.class)))},e}();const hs=fs;var ps=n(129),ms=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},vs=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},gs=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ys=(0,a.importInternal)("util/throttle"),xs=function(e,t){this.x=e,this.y=t},bs=function(){function e(){var e=this;this.ptLast={x:0,y:0},this.webDcmSocket=void 0,this.seruuId=void 0,this.loadingAnimation=new hs({message:"3D生成中,请耐心等待"}),this.zoomLazy=ys((function(t){e.zoom(t)}),"mobile"===R.env?150:40),this.KnifeMoveLazy=ys((function(t){e.KnifeMove(t)}),40),this.rotateLazy=ys((function(t){e.rotate(t)}),100),this.windowsLevelLazy=ys((function(t){e.windowsLevel(t)}),60),this.panLazy=ys((function(t){e.pan(t)}),100)}return e.prototype.open=function(e,t){var n,r,o=this,a=t.seriesUid,i=t.hospId,l=t.studyUID,c=t.wadoURL,u=t.vrtWsURl;if(!e.querySelector("#canvas-vrt")){var d=this.canvas=(0,s.createElement)({tagName:"canvas",id:"canvas-vrt",width:e.clientWidth,height:e.clientHeight});e.appendChild(d);var f=ys((function(){d.width=e.clientWidth,d.height=e.clientHeight,o.resizeCanvasDrawImage()}),500);this.resizeObserver=new ResizeObserver(f),this.resizeObserver.observe(e);try{for(var p=gs(["touchstart","mousedown","touchmove","mousemove","touchend","mouseup","mouseout","mousewheel"]),m=p.next();!m.done;m=p.next()){var v=m.value;d.addEventListener(v,(function(e){o.msgTransform(e)}))}}catch(e){n={error:e}}finally{try{m&&!m.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}var g=new(Pe().Manager)(d);g.add(new(Pe().Pinch)({threshold:.2})),g.add(new(Pe().Pan)({threshold:10,pointers:2})),g.on("pinch",(function(e){o.zoomLazy(e),e.preventDefault()})),g.on("panmove",(function(e){o.panLazy(e),e.preventDefault()}))}var y=h(a),x=c+"/GetImagesPath"+(0,ps.stringify)({seruuid:y,seriesUID:y,hospcode:i,studyuid:l,studyUID:l},{addQueryPrefix:!0});if(u||alert("vrtWsURl is undefined"),this.webDcmSocket){if(this.seruuId===a)return void this.refresh();this.webDcmSocketClose()}this.seruuId=a;var b=u+"/Wado?serurl="+encodeURIComponent(x);this.webDcmSocket=new WebSocket(b),this.loadingAnimation.show(),this.webDcmSocket.onclose=function(e){o.loadingAnimation.hidden(),"leave"!==e.reason&&(ue().error({title:"连接已关闭,请稍后重试"}),console.log("Connection closed"))},this.webDcmSocket.onerror=function(e){o.loadingAnimation.hidden(),ue().error({title:"连接失败,请稍后重试"}),console.log("An error occur",e)},this.webDcmSocket.onmessage=function(e){if("string"==typeof e.data)console.log(JSON.parse(e.data));else{var t=new FileReader;t.onload=function(e){e.target.readyState==FileReader.DONE&&(o.loadingAnimation.hidden(),o.webDcmSocketResult=t.result,(0,s.canvasDrawImage)(o.canvas,o.webDcmSocketResult))},t.readAsDataURL(e.data)}}},e.prototype.resizeCanvasDrawImage=function(){this.canvas&&this.webDcmSocketResult&&(0,s.canvasDrawImage)(this.canvas,this.webDcmSocketResult)},e.prototype.msgTransform=function(e){var t;if(!((null===(t=e.targetTouches)||void 0===t?void 0:t.length)>1))switch(e.type){case"touchstart":case"mousedown":var n=void 0;if("touchstart"===e.type){var r=e.targetTouches[0];n=new xs(r.pageX,r.pageY),this.which=1}else n=new xs(e.pageX,e.pageY),this.which=e.which;this.ptLast=n;break;case"touchmove":case"mousemove":this.mouseDownMove(e);break;case"touchend":case"mouseup":case"mouseout":this.mouseUp(),this.which=void 0;break;case"mousewheel":this.zoomLazy(e)}},e.prototype.mouseDownMove=function(e){if(1===this.which)switch(this.toolType){case"KnifeIn":case"KnifeOut":this.KnifeMoveLazy(e);break;case"Modulation":this.windowsLevelLazy(e);break;default:this.rotateLazy(e)}else 3===this.which?this.windowsLevelLazy(e):2===this.which&&this.panLazy(e)},e.prototype.mouseUp=function(){switch(this.toolType){case"KnifeIn":case"KnifeOut":this.knifeEnd(),this.toolType=void 0}},e.prototype.errorHandle=function(e,t){"cancel"!==t&&console.error(e,t)},e.prototype.getPosition=function(e){var t="touchmove"==e.type?e.targetTouches[0]:e,n=t.pageX,r=t.pageY,o=new xs(n,r),a=this.ptLast.x,i=this.ptLast.y,s=o.x-a,l=o.y-i;if(0===s&&0===l)return Promise.reject("cancel");var c=e.target.getBoundingClientRect(),u=Math.round(c.left+window.pageXOffset),d=Math.round(c.top+window.pageYOffset);return this.ptLast=o,Promise.resolve({LastPosition:[a-u,i-d],NowPosition:[n-u,r-d],rect:c})},e.prototype.rotate=function(e){return ms(this,void 0,void 0,(function(){var t,n,r,o;return vs(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=a.sent(),n=t.LastPosition,r=t.NowPosition,this.webDcmSocketSend({Cmd:1,LastPosition:n,NowPosition:r}),[3,3];case 2:return o=a.sent(),this.errorHandle("rotate",o),[3,3];case 3:return[2]}}))}))},e.prototype.pan=function(e){return ms(this,void 0,void 0,(function(){var t,n,r,o,a,i,s;return vs(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),"panmove"==e.type&&(t=e.center||{},n=t.x,r=t.y,e.pageX=Math.floor(n),e.pageY=Math.floor(r)),[4,this.getPosition(e)];case 1:return o=l.sent(),a=o.LastPosition,i=o.NowPosition,this.webDcmSocketSend({Cmd:2,LastPosition:a,NowPosition:i}),[3,3];case 2:return s=l.sent(),this.errorHandle("pan",s),[3,3];case 3:return[2]}}))}))},e.prototype.zoom=function(e){var t=e.type,n=e.scale,r=e.deltaY;this.webDcmSocketSend({Cmd:3,DeltaY:"pinch"===t?n>=1?1:-1:r>0?-1:1})},e.prototype.windowsLevel=function(e){return ms(this,void 0,void 0,(function(){var t,n,r,o;return vs(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=a.sent(),n=t.LastPosition,r=t.NowPosition,this.webDcmSocketSend({Cmd:4,LastPosition:n,NowPosition:r}),[3,3];case 2:return o=a.sent(),this.errorHandle("windowsLevel",o),[3,3];case 3:return[2]}}))}))},e.prototype.KnifeMove=function(e){return ms(this,void 0,void 0,(function(){var t,n,r,o,a;return vs(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=i.sent(),n=t.LastPosition,r=t.NowPosition,o=t.rect,this.webDcmSocketSend({Cmd:5,LastPosition:n,NowPosition:r,ViewWidth:Math.round(o.width),ViewHeight:Math.round(o.height)}),[3,3];case 2:return a=i.sent(),this.errorHandle("KnifeMove",a),[3,3];case 3:return[2]}}))}))},e.prototype.toolsToggle=function(e){this.toolType=e},e.prototype.knifeBegin=function(e,t){if(void 0===t&&(t=function(){}),"function"!=typeof t)throw"callback function is required";this.toolType=e,this.knifeFinishCallback=t,this.webDcmSocketSend({KnifeOut:{Cmd:6},KnifeIn:{Cmd:7}}[e])},e.prototype.knifeEnd=function(){var e=this.knifeFinishCallback;if(this.webDcmSocketSend({Cmd:8}),"function"!=typeof e)throw"callback function is required";e()},e.prototype.reset=function(){if(this.webDcmSocket.readyState>=2)return this.reconnect();this.webDcmSocketSend({Cmd:0})},e.prototype.refresh=function(){this.webDcmSocketSend({Cmd:99})},e.prototype.webDcmSocketClose=function(){this.webDcmSocket&&(this.webDcmSocket.close(1e3,"leave"),this.webDcmSocket=void 0)},e.prototype.webDcmSocketSend=function(e){this.webDcmSocket.send(JSON.stringify(e))},e.prototype.reconnect=function(){var e=this.webDcmSocket,t=e.onclose,n=e.onerror,r=e.onmessage,o=e.onopen,a=e.url;this.webDcmSocketClose(),this.webDcmSocket=new WebSocket(a),this.webDcmSocket.onclose=t,this.webDcmSocket.onmessage=r,this.webDcmSocket.onerror=n,this.webDcmSocket.onopen=o},e.prototype.destroy=function(){this.webDcmSocketClose(),this.resizeObserver.disconnect(),this.canvas.remove()},e}();const ws=bs;var Ts,Is,Ss=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Es=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Cs=function(){null==Is||Is.toggleToolStyle(ns.VRT.find((function(e){return"旋转"===e.toolName})))},As=function(){if(Ts)try{Ts.destroy()}catch(e){console.log(e)}finally{Ts=void 0,Is.vrtLayout.hidden()}};const Ms=function(){};var Ps=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Ds=function(e){function t(t){var n=e.call(this)||this;return n.id=t.id,n.num=t.num,n.imageicon=t.imageicon,n.isLoadImage=t.isLoadImage,n}return Ps(t,e),t.prototype.setInfo=function(e){if(this.name=e.name.replace(/\^/g,""),this.sex=e.sex,this.age=e.age,this.birth=e.birth,this.patid=e.patid,this.mod=e.mod,this.accnum=e.accnum,this.stuid=e.stuid,this.stuuid=e.stuuid,this.studes=e.studes,this.serid=e.serid,this.seruid=e.seruid,this.serdes=e.serdes,this.imgnum=e.imgnum,this.sopuid=e.sopuid,this.uid=e.uid,this.blocks=parseInt(e.blocks),this.studt=e.studt,this.stutm=e.stutm,"string"==typeof e.stutm&&e.stutm.indexOf(":")<0||"string"==typeof e.stutm&&e.studt.indexOf("-")<0)for(var t=0;t<2;t++){var n=e.stutm.substr(2*t,2),r=e.studt.substr(2*t+4,2);0==t&&(this.stutm=n,this.studt=e.studt.substr(0,4)),this.stutm+=":"+n,this.studt+="-"+r}else this.stutm=e.stutm,this.studt=e.studt;if(this.acqdt=e.acqdt,this.acqtm=e.acqtm,this.acqtm&&(this.acqtm=parseFloat(e.acqtm).toFixed(3)),this.wc=parseInt(e.wc),this.ww=parseInt(e.ww),this.ma=e.ma,this.kv=e.kv,this.sliceth=e.sliceth,this.manu=e.manu,this.inst=e.inst,this.row=parseInt(e.row),this.col=parseInt(e.col),"string"==typeof e.pixx&&"string"==typeof e.pixx){if(-1!=e.pixx.indexOf(" ")){var o=e.pixx.split(" ");2==o.length&&(this.pixx=parseFloat(o[0]),this.pixy=parseFloat(o[1]))}this.pixx=parseFloat(e.pixx),this.pixy=parseFloat(e.pixy)}this.bita=parseInt(e.bita),this.bits=e.bits,this.hbit=e.hbit,this.rescin=parseInt(e.rescin),this.rescsl=parseFloat(e.rescsl),(""===e.rescin||null===e.rescin||isNaN(this.rescin))&&(this.rescin=0),(""===e.rescsl||null===e.rescsl||isNaN(this.rescsl)||this.rescsl<1)&&(this.rescsl=1),this.pixrep=parseInt(e.pixrep),this.sappix=parseInt(e.sappix),this.phme=e.phme,this.orl=e.orl,this.ort=e.ort,this.orr=e.orr,this.orb=e.orb,this.strScount=e.scount},t.prototype.setData=function(e){void 0!==e&&(this.pixsBuffer=e,this.isLoadImage=!0,this.getMaxMinGary())},t.prototype.getMaxMinGary=function(){for(var e,t=1e6,n=-1e6,r=0;r<this.pixsBuffer.length;r++)(e=this.pixsBuffer[r])>t&&(t=e),e<n&&(n=e);this.minGary=n,this.maxGary=t},t}(Ms);const ks=function(){function e(e){this.flatSeries=!1,this.desp=e.desp,this.imgs=e.imgs,this.num=e.num,this.uid=e.uid,this.uuid=e.uuid,this.studyUID=e.studyUID,this.wado=e.wado,this.icon=e.icon,this.flatSeries=e.flatSeries,this.arrImage=[],this.initSeries()}return e.prototype.initSeries=function(){var e=this;this.imgs.forEach((function(t){var n=new Ds({id:t.id,num:t.num,imageicon:e.icon,isLoadImage:!1});e.arrImage.push(n)}))},e}();function Os(e){return Os="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Os(e)}const Ls=function(){function e(e,t){this.wado=t,this.hospId=e.hospId,this.arrSeries=[],this.images=[],this.studyuid=e.studyuid,this.studyuuid=e.studyuuid,this.age=e.age,this.hasseries=parseInt(e.hasseries),this.orgname=e.orgname,this.imgcount=parseInt(e.imgcount),this.modality=e.modality,null!=this.modality&&""!=this.modality&&(this.modality=this.modality.toUpperCase()),this.name=e.name,null!=this.name&&""!=this.name&&(this.name=this.name.replace(/\^/g,"")),this.orginaltype=e.orginaltype,this.patientid=e.patientid,this.seriescount=e.seriescount,this.studydate=e.studydate,this.studydate.indexOf("-")>-1&&(this.studydate=this.studydate.replace(/-/g,"/"));var n=g(this.studydate,"yyyy-MM-dd"),r=g(this.studydate,"hh:mm:ss");this.studydate=n,this.studytime=r,this.seriesArr=e.serieses.sort((function(e,t){return Number(e.num)-Number(t.num)})),this.sex=e.sex,this.studyid=e.studyid,this.totaltype="RAW",null!=this.totaltype&&""!=this.totaltype&&(this.totaltype=this.totaltype.toUpperCase()),this.hasseries?this.setSeries():this.setImages(e.imgs)}return e.prototype.setSeries=function(e){var t=this;void 0===e&&(e=this.seriesArr),e.forEach((function(e,n){var r=e.desp,o=e.imgs,a=e.num,i=e.uid,s=e.uuid,l=e.sign,c=e.flatSeries;e.imgs.sort((function(e,t){return Number(e.num)-Number(t.num)})),t.arrSeries.push(new ks({desp:r,imgs:o,num:a,uid:i+(c?"?index="+n:""),uuid:s+(c?"?index="+n:""),flatSeries:c,studyUID:t.studyuid,wado:t.wado,icon:t.wado+"/GetImageThumb/"+o[0].id+(0,ps.stringify)({studyuid:t.studyuid,studyUID:t.studyuid,seriesId:s,seriesID:s,hospId:t.hospId,hospID:t.hospId,sign:l},{addQueryPrefix:!0})}))}))},e.prototype.setImages=function(e){var t=this;void 0!==e&&e.forEach((function(e){var n=new Ds({id:e.id,num:e.num,imageicon:t.wado+"/GetImageThumb"+e.id,isLoadImage:!1});t.images.push(n)}))},e.prototype.setSeriesDicom=function(e){var t=this;e instanceof Array&&e.forEach((function(e){t.setDicomMeta(e)}))},e.prototype.setDicomMeta=function(e){for(var t=0;t<this.arrSeries.length;t++)for(var n=this.arrSeries[t],r=0;r<n.arrImage.length;r++){n.arrImage[r].id,e.id}},e.prototype.deepCopy=function(e,t){t=t||new ks(null);for(var n in e)"object"===Os(e[n])&&null!=e[n]?(t[n]=e[n].constructor===Array?[]:{},this.deepCopy(e[n],t[n])):t[n]=e[n];return t},e.prototype.getStudyType=function(){var e="";return"JPG"==this.totaltype?e="jpg":"RAW"==this.totaltype&&(e="series"),e},e.prototype.getSeriesLayoutCount=function(){var e={x:1,y:1};return"mobile"===R.env?e:["CT","MR"].includes(this.modality)?{x:2,y:2}:e},e.prototype.getDicomByID=function(e){for(var t=null,n=null,r=0;r<this.arrSeries.length;r++){t=this.arrSeries[r];for(var o=0;o<t.arrImage.length;o++)if((n=t.arrImage[o]).id==e)return n}},e.prototype.getAllDicom=function(){var e=[];return this.arrSeries.forEach((function(t){t.arrImage.forEach((function(t){e.push(t)}))})),e},e}();var Rs=function(){return Rs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Rs.apply(this,arguments)},_s=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ns=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Us=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Bs=function(){function e(e){this.states=[],this.originStates=[],this.addSeriesArr(e)}return e.prototype.addSeriesArr=function(e){var t,n;try{for(var r=_s(e),o=r.next();!o.done;o=r.next()){var a=o.value,i=a.studyUID,s=a.uuid;this.states.push({studyUID:i,seriesId:s,series:a,scrollIndex:0,synchronizerStatus:!1})}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getStates=function(){return this.states},e.prototype.getStatesLength=function(){return this.states.length},e.prototype.getSeries=function(e){return void 0===e&&(e="states"),("states"===e?this.states:this.originStates).map((function(e){return e.series}))},e.prototype.getSeriesActiveIndex=function(e){for(var t=void 0,n=0;n<this.states.length;n++){if(this.states[n].seriesId===e){t=n;break}}return t},e.prototype.removeSerie=function(e){this.states[e]={studyUID:void 0,seriesId:void 0,scrollIndex:void 0,synchronizerStatus:void 0,series:void 0}},e.prototype.syncState=function(e){void 0===e&&(e="states"),this[e]=Us([],Ns("states"===e?this.originStates:this.states),!1)},e.prototype.getOriginState=function(){return this.originStates},e.prototype.setState=function(e,t){this.states[e]=Rs(Rs({},this.states[e]),t)},e.prototype.setSynchronizerStatus=function(e,t){this.states[e]=Rs(Rs({},this.states[e]),{synchronizerStatus:t})},e.prototype.getSynchronizerStatus=function(e){return this.states[e].synchronizerStatus},e.prototype.setScrollIndex=function(e,t){this.states[e]=Rs(Rs({},this.states[e]),{scrollIndex:t})},e}();const js=Bs;function Fs(e,t){return function(){return e.apply(t,arguments)}}const{toString:Vs}=Object.prototype,{getPrototypeOf:Hs}=Object,zs=(qs=Object.create(null),e=>{const t=Vs.call(e);return qs[t]||(qs[t]=t.slice(8,-1).toLowerCase())});var qs;const Ws=e=>(e=e.toLowerCase(),t=>zs(t)===e),Gs=e=>t=>typeof t===e,{isArray:Ys}=Array,Zs=Gs("undefined");const Xs=Ws("ArrayBuffer");const Qs=Gs("string"),Ks=Gs("function"),Js=Gs("number"),$s=e=>null!==e&&"object"==typeof e,el=e=>{if("object"!==zs(e))return!1;const t=Hs(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},tl=Ws("Date"),nl=Ws("File"),rl=Ws("Blob"),ol=Ws("FileList"),al=Ws("URLSearchParams");function il(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,o;if("object"!=typeof e&&(e=[e]),Ys(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{const o=n?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length;let i;for(r=0;r<a;r++)i=o[r],t.call(null,e[i],i,e)}}function sl(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}const ll="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,cl=e=>!Zs(e)&&e!==ll;const ul=(dl="undefined"!=typeof Uint8Array&&Hs(Uint8Array),e=>dl&&e instanceof dl);var dl;const fl=Ws("HTMLFormElement"),hl=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),pl=Ws("RegExp"),ml=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};il(n,((n,o)=>{let a;!1!==(a=t(n,o,e))&&(r[o]=a||n)})),Object.defineProperties(e,r)},vl="abcdefghijklmnopqrstuvwxyz",gl="0123456789",yl={DIGIT:gl,ALPHA:vl,ALPHA_DIGIT:vl+vl.toUpperCase()+gl};const xl=Ws("AsyncFunction"),bl={isArray:Ys,isArrayBuffer:Xs,isBuffer:function(e){return null!==e&&!Zs(e)&&null!==e.constructor&&!Zs(e.constructor)&&Ks(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||Ks(e.append)&&("formdata"===(t=zs(e))||"object"===t&&Ks(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Xs(e.buffer),t},isString:Qs,isNumber:Js,isBoolean:e=>!0===e||!1===e,isObject:$s,isPlainObject:el,isUndefined:Zs,isDate:tl,isFile:nl,isBlob:rl,isRegExp:pl,isFunction:Ks,isStream:e=>$s(e)&&Ks(e.pipe),isURLSearchParams:al,isTypedArray:ul,isFileList:ol,forEach:il,merge:function e(){const{caseless:t}=cl(this)&&this||{},n={},r=(r,o)=>{const a=t&&sl(n,o)||o;el(n[a])&&el(r)?n[a]=e(n[a],r):el(r)?n[a]=e({},r):Ys(r)?n[a]=r.slice():n[a]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&il(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:r}={})=>(il(t,((t,r)=>{n&&Ks(t)?e[r]=Fs(t,n):e[r]=t}),{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let o,a,i;const s={};if(t=t||{},null==e)return t;do{for(o=Object.getOwnPropertyNames(e),a=o.length;a-- >0;)i=o[a],r&&!r(i,e,t)||s[i]||(t[i]=e[i],s[i]=!0);e=!1!==n&&Hs(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:zs,kindOfTest:Ws,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Ys(e))return e;let t=e.length;if(!Js(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:fl,hasOwnProperty:hl,hasOwnProp:hl,reduceDescriptors:ml,freezeMethods:e=>{ml(e,((t,n)=>{if(Ks(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Ks(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return Ys(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:sl,global:ll,isContextDefined:cl,ALPHABET:yl,generateString:(e=16,t=yl.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&Ks(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if($s(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const o=Ys(e)?[]:{};return il(e,((e,t)=>{const a=n(e,r+1);!Zs(a)&&(o[t]=a)})),t[r]=void 0,o}}return e};return n(e,0)},isAsyncFn:xl,isThenable:e=>e&&($s(e)||Ks(e))&&Ks(e.then)&&Ks(e.catch)};function wl(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o)}bl.inherits(wl,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:bl.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Tl=wl.prototype,Il={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Il[e]={value:e}})),Object.defineProperties(wl,Il),Object.defineProperty(Tl,"isAxiosError",{value:!0}),wl.from=(e,t,n,r,o,a)=>{const i=Object.create(Tl);return bl.toFlatObject(e,i,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),wl.call(i,e.message,t,n,r,o),i.cause=e,i.name=e.name,a&&Object.assign(i,a),i};const Sl=wl;function El(e){return bl.isPlainObject(e)||bl.isArray(e)}function Cl(e){return bl.endsWith(e,"[]")?e.slice(0,-2):e}function Al(e,t,n){return e?e.concat(t).map((function(e,t){return e=Cl(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const Ml=bl.toFlatObject(bl,{},null,(function(e){return/^is[A-Z]/.test(e)}));const Pl=function(e,t,n){if(!bl.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=bl.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!bl.isUndefined(t[e])}));const r=n.metaTokens,o=n.visitor||c,a=n.dots,i=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&bl.isSpecCompliantForm(t);if(!bl.isFunction(o))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(bl.isDate(e))return e.toISOString();if(!s&&bl.isBlob(e))throw new Sl("Blob is not supported. Use a Buffer instead.");return bl.isArrayBuffer(e)||bl.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,o){let s=e;if(e&&!o&&"object"==typeof e)if(bl.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(bl.isArray(e)&&function(e){return bl.isArray(e)&&!e.some(El)}(e)||(bl.isFileList(e)||bl.endsWith(n,"[]"))&&(s=bl.toArray(e)))return n=Cl(n),s.forEach((function(e,r){!bl.isUndefined(e)&&null!==e&&t.append(!0===i?Al([n],r,a):null===i?n:n+"[]",l(e))})),!1;return!!El(e)||(t.append(Al(o,n,a),l(e)),!1)}const u=[],d=Object.assign(Ml,{defaultVisitor:c,convertValue:l,isVisitable:El});if(!bl.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!bl.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),bl.forEach(n,(function(n,a){!0===(!(bl.isUndefined(n)||null===n)&&o.call(t,n,bl.isString(a)?a.trim():a,r,d))&&e(n,r?r.concat(a):[a])})),u.pop()}}(e),t};function Dl(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function kl(e,t){this._pairs=[],e&&Pl(e,this,t)}const Ol=kl.prototype;Ol.append=function(e,t){this._pairs.push([e,t])},Ol.toString=function(e){const t=e?function(t){return e.call(this,t,Dl)}:Dl;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Ll=kl;function Rl(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _l(e,t,n){if(!t)return e;const r=n&&n.encode||Rl,o=n&&n.serialize;let a;if(a=o?o(t,n):bl.isURLSearchParams(t)?t.toString():new Ll(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const Nl=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){bl.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Ul={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Bl={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Ll,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},jl="undefined"!=typeof window&&"undefined"!=typeof document,Fl=(Vl="undefined"!=typeof navigator&&navigator.product,jl&&["ReactNative","NativeScript","NS"].indexOf(Vl)<0);var Vl;const Hl="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,zl={...e,...Bl};const ql=function(e){function t(e,n,r,o){let a=e[o++];if("__proto__"===a)return!0;const i=Number.isFinite(+a),s=o>=e.length;if(a=!a&&bl.isArray(r)?r.length:a,s)return bl.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!i;r[a]&&bl.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],o)&&bl.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const o=n.length;let a;for(r=0;r<o;r++)a=n[r],t[a]=e[a];return t}(r[a])),!i}if(bl.isFormData(e)&&bl.isFunction(e.entries)){const n={};return bl.forEachEntry(e,((e,r)=>{t(function(e){return bl.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const Wl={transitional:Ul,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=bl.isObject(e);o&&bl.isHTMLForm(e)&&(e=new FormData(e));if(bl.isFormData(e))return r&&r?JSON.stringify(ql(e)):e;if(bl.isArrayBuffer(e)||bl.isBuffer(e)||bl.isStream(e)||bl.isFile(e)||bl.isBlob(e))return e;if(bl.isArrayBufferView(e))return e.buffer;if(bl.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Pl(e,new zl.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return zl.isNode&&bl.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=bl.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Pl(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),function(e,t,n){if(bl.isString(e))try{return(t||JSON.parse)(e),bl.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Wl.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&bl.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw Sl.from(e,Sl.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:zl.classes.FormData,Blob:zl.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};bl.forEach(["delete","get","head","post","put","patch"],(e=>{Wl.headers[e]={}}));const Gl=Wl,Yl=bl.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Zl=Symbol("internals");function Xl(e){return e&&String(e).trim().toLowerCase()}function Ql(e){return!1===e||null==e?e:bl.isArray(e)?e.map(Ql):String(e)}function Kl(e,t,n,r,o){return bl.isFunction(r)?r.call(this,t,n):(o&&(t=n),bl.isString(t)?bl.isString(r)?-1!==t.indexOf(r):bl.isRegExp(r)?r.test(t):void 0:void 0)}class Jl{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function o(e,t,n){const o=Xl(t);if(!o)throw new Error("header name must be a non-empty string");const a=bl.findKey(r,o);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=Ql(e))}const a=(e,t)=>bl.forEach(e,((e,n)=>o(e,n,t)));return bl.isPlainObject(e)||e instanceof this.constructor?a(e,t):bl.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?a((e=>{const t={};let n,r,o;return e&&e.split("\n").forEach((function(e){o=e.indexOf(":"),n=e.substring(0,o).trim().toLowerCase(),r=e.substring(o+1).trim(),!n||t[n]&&Yl[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&o(t,e,n),this}get(e,t){if(e=Xl(e)){const n=bl.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(bl.isFunction(t))return t.call(this,e,n);if(bl.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Xl(e)){const n=bl.findKey(this,e);return!(!n||void 0===this[n]||t&&!Kl(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function o(e){if(e=Xl(e)){const o=bl.findKey(n,e);!o||t&&!Kl(0,n[o],o,t)||(delete n[o],r=!0)}}return bl.isArray(e)?e.forEach(o):o(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const o=t[n];e&&!Kl(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const t=this,n={};return bl.forEach(this,((r,o)=>{const a=bl.findKey(n,o);if(a)return t[a]=Ql(r),void delete t[o];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(o):String(o).trim();i!==o&&delete t[o],t[i]=Ql(r),n[i]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return bl.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&bl.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[Zl]=this[Zl]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Xl(e);t[r]||(!function(e,t){const n=bl.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,o){return this[r].call(this,t,e,n,o)},configurable:!0})}))}(n,e),t[r]=!0)}return bl.isArray(e)?e.forEach(r):r(e),this}}Jl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),bl.reduceDescriptors(Jl.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),bl.freezeMethods(Jl);const $l=Jl;function ec(e,t){const n=this||Gl,r=t||n,o=$l.from(r.headers);let a=r.data;return bl.forEach(e,(function(e){a=e.call(n,a,o.normalize(),t?t.status:void 0)})),o.normalize(),a}function tc(e){return!(!e||!e.__CANCEL__)}function nc(e,t,n){Sl.call(this,null==e?"canceled":e,Sl.ERR_CANCELED,t,n),this.name="CanceledError"}bl.inherits(nc,Sl,{__CANCEL__:!0});const rc=nc;const oc=zl.hasStandardBrowserEnv?{write(e,t,n,r,o,a){const i=[e+"="+encodeURIComponent(t)];bl.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),bl.isString(r)&&i.push("path="+r),bl.isString(o)&&i.push("domain="+o),!0===a&&i.push("secure"),document.cookie=i.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function ac(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const ic=zl.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=bl.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};const sc=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let o,a=0,i=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=r[i];o||(o=l),n[a]=s,r[a]=l;let u=i,d=0;for(;u!==a;)d+=n[u++],u%=e;if(a=(a+1)%e,a===i&&(i=(i+1)%e),l-o<t)return;const f=c&&l-c;return f?Math.round(1e3*d/f):void 0}};function lc(e,t){let n=0;const r=sc(50,250);return o=>{const a=o.loaded,i=o.lengthComputable?o.total:void 0,s=a-n,l=r(s);n=a;const c={loaded:a,total:i,progress:i?a/i:void 0,bytes:s,rate:l||void 0,estimated:l&&i&&a<=i?(i-a)/l:void 0,event:o};c[t?"download":"upload"]=!0,e(c)}}const cc={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const o=$l.from(e.headers).normalize();let a,i,{responseType:s,withXSRFToken:l}=e;function c(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}if(bl.isFormData(r))if(zl.hasStandardBrowserEnv||zl.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if(!1!==(i=o.getContentType())){const[e,...t]=i?i.split(";").map((e=>e.trim())).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.set("Authorization","Basic "+btoa(t+":"+n))}const d=ac(e.baseURL,e.url);function f(){if(!u)return;const r=$l.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Sl("Request failed with status code "+n.status,[Sl.ERR_BAD_REQUEST,Sl.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),c()}),(function(e){n(e),c()}),{data:s&&"text"!==s&&"json"!==s?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),_l(d,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(f)},u.onabort=function(){u&&(n(new Sl("Request aborted",Sl.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new Sl("Network Error",Sl.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||Ul;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new Sl(t,r.clarifyTimeoutError?Sl.ETIMEDOUT:Sl.ECONNABORTED,e,u)),u=null},zl.hasStandardBrowserEnv&&(l&&bl.isFunction(l)&&(l=l(e)),l||!1!==l&&ic(d))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&oc.read(e.xsrfCookieName);t&&o.set(e.xsrfHeaderName,t)}void 0===r&&o.setContentType(null),"setRequestHeader"in u&&bl.forEach(o.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),bl.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),s&&"json"!==s&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",lc(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",lc(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{u&&(n(!t||t.type?new rc(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const h=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(d);h&&-1===zl.protocols.indexOf(h)?n(new Sl("Unsupported protocol "+h+":",Sl.ERR_BAD_REQUEST,e)):u.send(r||null)}))}};bl.forEach(cc,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const uc=e=>`- ${e}`,dc=e=>bl.isFunction(e)||null===e||!1===e,fc=e=>{e=bl.isArray(e)?e:[e];const{length:t}=e;let n,r;const o={};for(let a=0;a<t;a++){let t;if(n=e[a],r=n,!dc(n)&&(r=cc[(t=String(n)).toLowerCase()],void 0===r))throw new Sl(`Unknown adapter '${t}'`);if(r)break;o[t||"#"+a]=r}if(!r){const e=Object.entries(o).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));let n=t?e.length>1?"since :\n"+e.map(uc).join("\n"):" "+uc(e[0]):"as no adapter specified";throw new Sl("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function hc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new rc(null,e)}function pc(e){hc(e),e.headers=$l.from(e.headers),e.data=ec.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return fc(e.adapter||Gl.adapter)(e).then((function(t){return hc(e),t.data=ec.call(e,e.transformResponse,t),t.headers=$l.from(t.headers),t}),(function(t){return tc(t)||(hc(e),t&&t.response&&(t.response.data=ec.call(e,e.transformResponse,t.response),t.response.headers=$l.from(t.response.headers))),Promise.reject(t)}))}const mc=e=>e instanceof $l?e.toJSON():e;function vc(e,t){t=t||{};const n={};function r(e,t,n){return bl.isPlainObject(e)&&bl.isPlainObject(t)?bl.merge.call({caseless:n},e,t):bl.isPlainObject(t)?bl.merge({},t):bl.isArray(t)?t.slice():t}function o(e,t,n){return bl.isUndefined(t)?bl.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function a(e,t){if(!bl.isUndefined(t))return r(void 0,t)}function i(e,t){return bl.isUndefined(t)?bl.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,o,a){return a in t?r(n,o):a in e?r(void 0,n):void 0}const l={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(e,t)=>o(mc(e),mc(t),!0)};return bl.forEach(Object.keys(Object.assign({},e,t)),(function(r){const a=l[r]||o,i=a(e[r],t[r],r);bl.isUndefined(i)&&a!==s||(n[r]=i)})),n}const gc="1.6.5",yc={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{yc[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const xc={};yc.transitional=function(e,t,n){function r(e,t){return"[Axios v1.6.5] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,o,a)=>{if(!1===e)throw new Sl(r(o," has been removed"+(t?" in "+t:"")),Sl.ERR_DEPRECATED);return t&&!xc[o]&&(xc[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}};const bc={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Sl("options must be an object",Sl.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const a=r[o],i=t[a];if(i){const t=e[a],n=void 0===t||i(t,a,e);if(!0!==n)throw new Sl("option "+a+" must be "+n,Sl.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Sl("Unknown option "+a,Sl.ERR_BAD_OPTION)}},validators:yc},wc=bc.validators;class Tc{constructor(e){this.defaults=e,this.interceptors={request:new Nl,response:new Nl}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=vc(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;void 0!==n&&bc.assertOptions(n,{silentJSONParsing:wc.transitional(wc.boolean),forcedJSONParsing:wc.transitional(wc.boolean),clarifyTimeoutError:wc.transitional(wc.boolean)},!1),null!=r&&(bl.isFunction(r)?t.paramsSerializer={serialize:r}:bc.assertOptions(r,{encode:wc.function,serialize:wc.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&bl.merge(o.common,o[t.method]);o&&bl.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete o[e]})),t.headers=$l.concat(a,o);const i=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,d=0;if(!s){const e=[pc.bind(this),void 0];for(e.unshift.apply(e,i),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=i.length;let f=t;for(d=0;d<u;){const e=i[d++],t=i[d++];try{f=e(f)}catch(e){t.call(this,e);break}}try{c=pc.call(this,f)}catch(e){return Promise.reject(e)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return _l(ac((e=vc(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}bl.forEach(["delete","get","head","options"],(function(e){Tc.prototype[e]=function(t,n){return this.request(vc(n||{},{method:e,url:t,data:(n||{}).data}))}})),bl.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,o){return this.request(vc(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Tc.prototype[e]=t(),Tc.prototype[e+"Form"]=t(!0)}));const Ic=Tc;class Sc{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,o){n.reason||(n.reason=new rc(e,r,o),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new Sc((function(t){e=t})),cancel:e}}}const Ec=Sc;const Cc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Cc).forEach((([e,t])=>{Cc[t]=e}));const Ac=Cc;const Mc=function e(t){const n=new Ic(t),r=Fs(Ic.prototype.request,n);return bl.extend(r,Ic.prototype,n,{allOwnKeys:!0}),bl.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(vc(t,n))},r}(Gl);Mc.Axios=Ic,Mc.CanceledError=rc,Mc.CancelToken=Ec,Mc.isCancel=tc,Mc.VERSION=gc,Mc.toFormData=Pl,Mc.AxiosError=Sl,Mc.Cancel=Mc.CanceledError,Mc.all=function(e){return Promise.all(e)},Mc.spread=function(e){return function(t){return e.apply(null,t)}},Mc.isAxiosError=function(e){return bl.isObject(e)&&!0===e.isAxiosError},Mc.mergeConfig=vc,Mc.AxiosHeaders=$l,Mc.formToJSON=e=>ql(bl.isHTMLForm(e)?new FormData(e):e),Mc.getAdapter=fc,Mc.HttpStatusCode=Ac,Mc.default=Mc;const Pc=Mc;var Dc=function(e){var t=e.message,n=void 0===t?"未知错误":t;ue().error({title:String(n)})},kc=Pc.create({baseURL:"",timeout:6e4});kc.interceptors.request.use((function(e){return(0,Ba.start)(),e}),(function(e){return Promise.reject(e)})),kc.interceptors.response.use((function(e){var t,n,r;try{(0,Ba.done)();var o=e.data,a=e.config,i=a.headers,s=a.params,l=a.data,c=null!==(r=null!==(t=null==i?void 0:i.disableToast)&&void 0!==t?t:null===(n=JSON.parse(l||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==r?r:null==s?void 0:s.disableToast,u=o||{},d=u.statusCode,f=u.msg,h=u.message,p=u.success,m=u.data,v=u.result;return!p&&void 0!==p||200!=d&&void 0!==d||null==(m||v)?(1!=c&&Dc({message:f||h}),Promise.reject(e)):e}catch(e){return Promise.reject(e)}}),(function(e){var t,n,r;(0,Ba.done)();var o=e.response,a=void 0===o?{config:{}}:o,i=a.status,s=void 0===i?void 0:i,l=a.config,c=e.config,u=e.message,d=c||l,f=d.headers,h=d.params,p=d.data;if(null!==(r=null!==(t=null==f?void 0:f.disableToast)&&void 0!==t?t:null===(n=JSON.parse(p||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==r?r:null==h?void 0:h.disableToast)return Promise.reject(e);switch(s){case 401:Dc({message:"授权信息已失效！"});break;case 403:Dc({message:"访问权限受限！"});break;case 404:Dc({message:"请求接口地址不存在，请检查！"});break;default:Dc({message:s?u:"获取数据异常，请稍后重试!",duration:5e3})}return Promise.reject(e)}));const Oc=kc;var Lc=function(){return Lc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Lc.apply(this,arguments)},Rc=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},_c=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Nc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},Uc=Pc.CancelToken.source();function Bc(e,t,n,r){return Rc(this,void 0,void 0,(function(){var o,a,i,s;return _c(this,(function(l){switch(l.label){case 0:o=r.token,a=Nc(r,["token"]),l.label=1;case 1:return l.trys.push([1,4,,6]),[4,Oc.get("".concat(e,"/").concat("GetStudyInfo"),{params:Lc({hospId:t,hospID:t,studyUID:n},a),headers:o?{Authorization:"bearer "+o}:{}})];case 2:return i=l.sent(),[4,Promise.resolve(i.data)];case 3:return[2,l.sent()];case 4:return s=l.sent(),[4,Promise.reject(s)];case 5:return[2,l.sent()];case 6:return[2]}}))}))}function jc(e,t,n,r,o){return new Promise((function(a,i){var l=function(e){if("Object"!=(0,s.dataType)(e.data))return i("未获得dcm数据或该医院接口未支持，请切换到专业模式")};Oc.get("".concat(e,"/").concat("GetImagesPath"),{params:{seruuid:r,hospcode:t,hospID:t,studyuid:n,studyUID:n},data:{disableToast:!0},headers:o?{Authorization:"bearer "+o}:{}}).then((function(e){return l(e),a(e.data)})).catch((function(e){return l(e),i(e)}))}))}function Fc(e,t){return new Promise((function(n,r){Oc.get("".concat(e),{params:{studyUID:t}}).then((function(e){var o,a=(JSON.parse(null===(o=e.data)||void 0===o?void 0:o.result)||{}).data;switch(a){case void 0:case"ALGOERROR":return r({studyUID:t,mesage:"未获取到AI结果",data:a});default:return"Array"===(0,s.dataType)(a)?n(a):r({studyUID:t,mesage:"未知错误",data:a})}})).catch((function(e){return r(e)}))}))}var Vc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Hc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},zc=(0,a.importInternal)("util/triggerEvent"),qc={x:null,y:null},Wc={client:qc,page:qc},Gc=function(e){try{if(!e)return;var n=(0,t.getEnabledElement)(e),r="mobile"==R.env?[a.EVENTS.TOUCH_DRAG,a.EVENTS.TOUCH_END]:[a.EVENTS.MOUSE_UP],o=a.store.state.globalToolChangeHistory.slice(-1)[0]||{},i=o.mode,s=Vc(o.args,2),l=s[0],c=s[1];if("active"!==i||!c.mouseButtonMask.includes(1))return;switch(l){case"Wwwc":case"Rotate":break;case"FreehandRoi":(0,a.getToolForElement)(e,"FreehandRoi").cancelDrawing(e);break;default:r.forEach((function(t){zc(e,t,{image:n.image,element:e,startPoints:Wc,lastPoints:Wc,currentPoints:Wc,deltaPoints:Wc,type:t,isTouchEvent:!0})}))}}catch(e){Ei(e)}};const Yc=function(){var e,n;try{for(var r=Hc((0,t.getEnabledElements)()),o=r.next();!o.done;o=r.next()){var i=o.value.element;Gc(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}setTimeout((function(){a.store.state.isToolLocked=!1}))};var Zc="cornerstone-canvas";function Xc(e){var t="canvas.".concat(Zc);return e.querySelector(t)||function(e){var t=document.createElement("canvas");return t.style.display="block",t.classList.add(Zc),e.appendChild(t),t}(e)}function Qc(){(function(){var e,t=(null===(e=window.performance)||void 0===e?void 0:e.memory)||{};return t.usedJSHeapSize/t.totalJSHeapSize})()>.99&&ue().error({title:"如遇渲染缓慢、失败或崩溃，可调整画质级别",timeout:1e4})}var Kc=function(){return Kc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Kc.apply(this,arguments)},Jc=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},$c=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},eu=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},tu=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},nu=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ru=new hs,ou=(0,a.importInternal)("util/scrollToIndex"),au=function(){function e(e,n,r,o,i){var l=this;this.eventNamespace="clear",this.studyScrollIndex=0,this.isDestroy=!1;var c=i||{},u=c.sharedArrayBuffer,d=c.GPUBenchmarksURL,f=c.imageTypeDefault,h=void 0===f?R.imageTypeDefault:f,p=c.cacheImagesDefault,m=void 0===p?O.enableDefault:p,v=c.scrollPreload,g=void 0===v?A.scroll:v,y=c.fullLoad,x=void 0===y?A.fullLoad:y,b=c.token,w=void 0===b?void 0:b,T=c.isDesensitize,I=void 0!==T&&T,S=c.departCode,E=void 0===S?void 0:S,C=c.isKeyImage,D=void 0!==C&&C,k=c.isInternal,_=void 0!==k&&k,N=c.clientType,U=void 0===N?0:N,B=c.minRenderCountMPR3D,j=c.theme,F=c.toolsBar,V=c.AI,H=c.logoURL,z=c.aboutUs;if(this.globalContainer=(0,s.dataType)(e).includes("Element")?e:document.getElementById(e),!this.globalContainer)throw new Error("container is required, type is id:string or HTMLDivElement");if(this.globalContainer.childElementCount)throw new Error("该容器已实例化或内有其他元素，请调用destroy方法或清除内部无关元素再试！");for(var q in j)this.globalContainer.style.setProperty("--theme-".concat(q,"-dicom-viewer"),j[q]);this.wado=n,this.hospId=r,this.studyUIDArr=tu([],eu(new Set(null==o?void 0:o.split(",").filter((function(e){return e})))),!1),this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.getStudyInfoCount=0,this.token=w,this.departCode=E,this.GPUBenchmarksURL=d,this.isDesensitize=I?1:0,this.isKeyImage=D?1:0,this.isInternal=_?1:0,this.clientType=U,R.imageTypeDefault=h,this.imageType=R.imageType,this.seriesCount={x:1,y:1},this.imageCount={x:1,y:1},O.enableDefault=m,A.scroll=g,A.fullLoad=x,R.aboutUs=Kc(Kc({},L),z),R.toolsBar=Kc(Kc({},M),F),R.AI=Kc(Kc({},P),V),R.logoURL=null!=H?H:R.logoURL,R.sharedArrayBuffer=null!=u?u:R.sharedArrayBuffer,R.minRenderCountMPR3D=null!=B?B:R.minRenderCountMPR3D,R.instanceOptions=Kc({container:e,wado:n,hospId:r,studyUID:o},i),R.webDicomView=this,this.synchronizer=new a.Synchronizer(t.EVENTS.IMAGE_RENDERED,(function(){})),this.synchronizerStackImageIndex=new a.Synchronizer("".concat(t.EVENTS.NEW_IMAGE," ").concat(a.EVENTS.STACK_SCROLL),a.stackImageIndexSynchronizer),this.layoutView=new us,this.bindEvents(),t.events.addEventNamespaceListener("tool_event.VRT",(function(e){var t=e.detail.toolData.toolTag;if(Ts)switch(t){case"VTRReload2D":Is.initTop2DTools();case"MPR":As();break;case"VRTKnifeIn":Ts.knifeBegin("KnifeIn",Cs);break;case"VRTKnifeOut":Ts.knifeBegin("KnifeOut",Cs);break;case"VRTModulation":Ts.toolsToggle("Modulation");break;case"VRTRotate":Ts.toolsToggle("Rotate");break;case"VRTReset":Ts.reset()}})),this.layoutView.initLayout(this.globalContainer),this.layoutView.initTop2DTools("mobile"===R.env?"翻页":"缩放"),this.initAI(void 0,!0).finally((function(){l.getStudyInfos().then((function(){l.initAI()}))})),R.toolsBar.VRTVisibility&&this.initVRTPath(),(0,a.setToolActive)("ScaleOverlay"),(0,a.setToolActive)("Orientation"),"mobile"===R.env?((0,a.setToolActive)("ZoomTouchPinch",{}),(0,a.setToolActive)("PanMultiTouch",{})):((0,a.setToolActive)("StackScrollMouseWheel",{}),(0,a.setToolActive)("Wwwc",{mouseButtonMask:2}),(0,a.setToolActive)("Pan",{mouseButtonMask:4})),R.toolsBar.enhanceVisibility&&Z.webWorkerManager.loadWebWorkerTask("./opencvDecode.worker.js")}return e.prototype.getStudyInfoHandle=function(e,t){var n;return Jc(this,void 0,void 0,(function(){var r,o,a,i,s,l,c;return $c(this,(function(u){switch(u.label){case 0:t>0&&!this.studyArr[0]&&(t=0),u.label=1;case 1:if(u.trys.push([1,4,,5]),!this.wado||!e)throw console.log("wadoURL:",this.wado,"studyUID:",e),"wadoURL,studyUID is required";return r=this.studyUIDArr.length,[4,Bc(this.wado,this.hospId,e,{isDcm:this.imageType,imageType:this.imageType,token:this.token,departCode:this.departCode,hasDesensitize:this.isDesensitize,isKeyImage:this.isKeyImage,isInternal:this.isInternal,clientType:this.clientType})];case 2:return o=u.sent(),this.studyArr[t]=new Ls(Kc(Kc({},o.data),{hospId:this.hospId}),this.wado),0==t?(a=this.studyArr[0],i=(null===(n=a.arrSeries)||void 0===n?void 0:n[0])||{},s=i.uuid,l=i.studyUID,this.selectSeries={seriesId:s,studyUID:l,seriesIndex:0},this.studyScrollIndex=0,this.initFirstStudySeriesLayoutState(a),this.seriesCount=a.getSeriesLayoutCount(),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,a.arrSeries,this.seriesCount)):this.seriesLayoutState.addSeriesArr(this.studyArr[t].arrSeries),this.initStudyNavigation(t),[4,this.initSeries(t)];case 3:return u.sent(),t===r-1&&(this.seriesLayoutState.syncState("originStates"),r>1&&this.restoreSeries(this.seriesLayoutState.getSeries("originStates"))),[3,5];case 4:return c=u.sent(),console.error(c),[3,5];case 5:return this.getStudyInfoCount+=1,[2]}}))}))},e.prototype.getStudyInfos=function(){return Jc(this,void 0,void 0,(function(){var e,t,n,r,o,a,i,s;return $c(this,(function(l){switch(l.label){case 0:if(!this.studyUIDArr.length)throw"studyUID is empty";l.label=1;case 1:l.trys.push([1,6,7,8]),e=nu(Object.entries(this.studyUIDArr)),t=e.next(),l.label=2;case 2:return t.done?[3,5]:(n=eu(t.value,2),r=n[0],o=n[1],[4,this.getStudyInfoHandle(o,Number(r))]);case 3:l.sent(),l.label=4;case 4:return t=e.next(),[3,2];case 5:return[3,8];case 6:return a=l.sent(),i={error:a},[3,8];case 7:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},e.prototype.addStudy=function(e){return Jc(this,void 0,void 0,(function(){var t,n,r=this;return $c(this,(function(o){if("string"!=typeof e)throw"studyUID is required";return this.studyUIDArr.includes(e)?[2]:(t=this.studyUIDArr.length,this.getStudyInfoCount!==t?(setTimeout((function(){r.addStudy(e)}),1e3),[2]):(this.studyUIDArr.push(e),n=t,this.getStudyInfoHandle(e,n),[2]))}))}))},e.prototype.activeAI=function(e){R.AI=Kc(Kc(Kc({},R.AI),{parseSuccess:!0,active:!0}),e),this.initAI()},e.prototype.renderLayoutImageToCanvas=function(e,n,r,o,a){Fa(e);var i=(0,t.getDefaultViewportForImage)(e,n);(0,t.displayImage)(e,n,i),r&&(this.layoutView.createSeriesMarker(e,r,i),this.layoutView.toggleCavanAroundInfoStyle(R.cavanAroundInfo)),this.initDicomTools(e,o,void 0,a)},e.prototype.initDicomTools=function(e,t,n,r){var o=t.loadIds;o&&o.length>0&&((0,a.addStackStateManager)(e,["stack"]),(0,a.addToolState)(e,"stack",{currentImageIdIndex:n||0,imageIds:o,loadObj:t}),r&&(0,a.setToolActive)("StackScrollMouseWheel",{}))},e.prototype.displaySeriesByImageindex=function(e,t,n){var r=this;return new Promise((function(o,a){if(!t)return a("dicomObj is not defined");var i=t.loadIds,s=t.imgs;Xa(i[n||0]).then((function(a){r.renderLayoutImageToCanvas(e,a,s[n||0],t,"mobile"!==R.env),o(a)}),(function(e){a(e)}))}))},e.prototype.displayDcmByImages=function(e,n,r){var o=this,a=n.loadIds,i=e.querySelectorAll(".layoutImage"),s=i.length;s>0&&i.forEach((function(n,i){return Jc(o,void 0,void 0,(function(){var o,l,c;return $c(this,(function(u){switch(u.label){case 0:return(l=a[o=(r||0)*s+i])?(Xc(n).classList.remove("hidden"),Fa(n),[4,Xa(l)]):[3,2];case 1:return c=u.sent(),(0,t.displayImage)(n,c),[3,3];case 2:Xc(n).classList.add("hidden"),e.querySelector("div.player-bar")&&o>a.length&&ou(e,0),u.label=3;case 3:return[2]}}))}))}))},e.prototype.displayDcmBySlider=function(e,n,r,o){var a=r[o];a&&Xa(a).then((function(r){var a=e.seriesDom.clientWidth,i=e.seriesDom.clientHeight,s=(0,t.getDefaultViewportForImage)(e.seriesDom,r),l=i/r.height,c=a/r.width;s.scale=c<l?parseFloat(c.toFixed(2)):parseFloat(l.toFixed(2)),(0,t.displayImage)(e.seriesDom,r,s),n.currentImageIdIndex=o}),(function(e){}))},e.prototype.assambleLoadIds=function(e,t,n,r){for(var o=e.studyUID,a=e.imgs,i=e.flatSeries,s=e.uuid,l=[],c=0;c<n;c++){var u=(a[i?0:c]||{}).url,d=r[c],f=d.url,h=d.id,p=d.acqtm,m=void 0;1===this.imageType?(m=u||f||this.wado+"/GetBlock/"+h+(0,ps.stringify)({studyuid:o,hospitalid:this.hospId,seriesId:s,blockIndex:0,imageType:1},{addQueryPrefix:!0}),m+=(m.includes("?")?"&":"?")+"v=".concat(p),r[c].url=m,m="wadouri:"+m):(m=u||f||this.wado+"/GetBlock/"+h+(0,ps.stringify)({studyuid:o,hospitalid:this.hospId,seriesId:s,blockIndex:0},{addQueryPrefix:!0}),m+=(m.includes("?")?"&":"?")+"v=".concat(p),r[c].url=m),r[c].imageIdURL=m,l.push(m)}return{seriesIndex:t,seriesUid:s,studyUID:o,loadIds:i?l.filter((function(e,n){return n===t})):l,imgs:i?r.filter((function(e,n){return n===t})):r,images:[]}},e.prototype.initVRTPath=function(){return Jc(this,void 0,void 0,(function(){var e,t,n,r;return $c(this,(function(o){switch(o.label){case 0:e=this.layoutView.toolsContainer.querySelector(".tools2d .tool-btn-style.VRT"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(a=this.wado,i=this.token,new Promise((function(e,t){var n=function(e){if("Object"!=(0,s.dataType)(e.data))return t("未获得3D数据或该医院接口未支持，请联系管理员")};Oc.get("".concat(a,"/").concat("getPath3d"),{data:{disableToast:!0},headers:i?{Authorization:"bearer "+i}:{}}).then((function(t){return n(t),e(t.data)})).catch((function(e){return n(e),t(e)}))})))];case 2:return t=o.sent(),(n=(null==t?void 0:t.data).path)&&(this.VRTWsURl=n,R.toolsBar.VRTVisibility=!0,null==e||e.classList.remove("hidden")),[3,4];case 3:return r=o.sent(),R.toolsBar.VRTVisibility=!1,null==e||e.classList.add("hidden"),console.error(r),[3,4];case 4:return[2]}var a,i}))}))},e.prototype.initAI=function(e,n){return Jc(this,void 0,void 0,(function(){var r,o,a,i,s,l,c,u,d,f,h,p,m,v,g,y,x,b,w,T,I,S,E,C,A,M=this;return $c(this,(function(P){switch(P.label){case 0:r=0,o=R.AI,a=o.resultURL,i=o.parseSuccess,s=o.getParseHandler,l=o.active,c=o.jumpFirstAI,u=this.layoutView.toolsContainer.querySelector(".tools2d .tool-btn-style.AI"),d=function(e,n){if(void 0===n&&(n=!1),!e)throw"seriesID is required";return new Promise((function(r){if(n){var o=ua.getFirstIndex(e),a=M.layoutView.canvasContainer.querySelector(".layoutCellsInner[data-series-id='".concat(e,"']"));a&&ou(a,o),r(a)}else{var i=t.EVENTS.NEW_IMAGE,s=M.layoutView.canvasContainer.querySelectorAll(".layoutCellsInner"),l=function t(n){setTimeout((function(){var o=n.target;n.target.dataset.seriesId===e&&(s.forEach((function(e){e.removeEventListener(i,t);var n=ua.getFirstIndex(e.dataset.seriesId);n&&ou(e,n)})),r(o))}))};s.forEach((function(e){e.addEventListener(i,l)}))}}))},P.label=1;case 1:if(P.trys.push([1,17,,18]),f=function(){if(setTimeout((function(){null==u||u.classList.remove("active")}),100),"function"!=typeof s)throw"AI configure error";s({studyArr:M.studyUIDArr,departCode:M.departCode,hospId:M.hospId}),console.info("getParseHandler事件已执行")},!1===e)return this.layoutView.toggleAIIconStyle(),this.layoutView.topTools.AITool(),[2];if(!i)return e?[2,f()]:[2];if(!l&&!e)return[2];if(!a)throw"AI configure error";P.label=2;case 2:P.trys.push([2,9,10,11]),h=nu(this.studyUIDArr.filter((function(e){return!ca[e]}))),p=h.next(),P.label=3;case 3:if(p.done)return[3,8];m=p.value,P.label=4;case 4:return P.trys.push([4,6,,7]),[4,Fc(a,m)];case 5:return function(e,t){var n,r;ca[t]=!0;try{for(var o=aa(e),a=o.next();!a.done;a=o.next()){var i=a.value,s=i.nodule_bbox,l=i.seriesID,c=i.nodule_type,u=i.nodule_bm_prob;for(var d in s){var f=Number(d)-1,h=s[d],p=h.position,m=h.size,v="".concat(l,"?index=").concat(f),g=la.get(v),y=p.x-m.w,x=p.y-m.h,b=p.x+m.w,w=p.y+m.h,T=oa(oa({},i),{noduleType:da(c),noduleBmProbCN:fa(u),instanceNumber:Number(d),visible:!0,active:!1,invalidated:!0,handles:{start:{x:y,y:x,movesIndependently:!0,hasBoundingBox:!0},end:{x:b,y:w,movesIndependently:!0,hasBoundingBox:!0},textBox:{x:b,y:w,active:!1,hasMoved:!0,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}});T.textBoxContent=ha(T),la.set(v,sa(sa([],ia(g||[]),!1),[T],!1)),ua.add(l,f)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}ua.sort()}(P.sent(),m),null==u||u.classList.add("active"),[3,7];case 6:return v=P.sent(),r+=1,console.error(v),e&&r>=this.studyUIDArr.length&&f(),[3,7];case 7:return p=h.next(),[3,3];case 8:return[3,11];case 9:return g=P.sent(),C={error:g},[3,11];case 10:try{p&&!p.done&&(A=h.return)&&A.call(h)}finally{if(C)throw C.error}return[7];case 11:if(n)return[2];if(this.layoutView.toggleAIIconStyle(ua.getSeriesIDArr()),this.layoutView.topTools.AITool(!0),!c)return[3,16];for(b in y=void 0,x=[],ua.store)x.push(b);w=0,P.label=12;case 12:return w<x.length?(T=x[w],[4,d(T,!0)]):[3,15];case 13:(I=P.sent())&&(y=I),P.label=14;case 14:return w++,[3,12];case 15:if(!y){if(!(S=this.layoutView.leftSideContainer.querySelector(".viewer-navigator-wrapper.show-AI")))return[2];S.click(),d(S.dataset.seriesId,!1)}P.label=16;case 16:return[3,18];case 17:return E=P.sent(),setTimeout((function(){null==u||u.classList.remove("active"),ue().error({title:"AI configure error"===E?"该医院未正确配置或接入AI分析":E})})),console.error(E),[3,18];case 18:return[2]}}))}))},e.prototype.initSeries=function(e){return Jc(this,void 0,void 0,(function(){var t,n,r,o,a,i,l,c,u,d,f,h,p,m,v,g,y,x,b,w,T,I=this;return $c(this,(function(S){switch(S.label){case 0:return t=this.studyArr[e],n=0,r=[],[4,(new s.PromiseQueue).init({arr:t.arrSeries,func:function(t){return Jc(I,void 0,void 0,(function(){return $c(this,(function(r){switch(r.label){case 0:return[4,this.getSeriesMeta(t,e,n++)];case 1:return r.sent(),[2]}}))}))},limit:6})];case 1:if(S.sent(),0==e)try{if(A.fullLoad){o=function(e,t){var n=e.slice(1);n.length?Qa(n,{cancel:!1,countCallback:function(e,r,o){I.layoutView.progressCountStyle(t,n.length,o,!0)}}):a.layoutView.progressCountStyle(t,1,1,!0)},a=this;try{for(i=nu(t.arrSeries),l=i.next();!l.done;l=i.next())c=l.value.seriesLoadIds,v=c.loadIds,u=c.seriesUid,o(v,u)}catch(e){x={error:e}}finally{try{l&&!l.done&&(b=i.return)&&b.call(i)}finally{if(x)throw x.error}}}else{d=t.arrSeries.length<=6?5:3;try{for(f=nu(t.arrSeries),h=f.next();!h.done;h=f.next())p=h.value.seriesLoadIds.loadIds,r=tu(tu([],eu(r),!1),eu(p.slice(1,d)),!1)}catch(e){w={error:e}}finally{try{h&&!h.done&&(T=f.return)&&T.call(f)}finally{if(w)throw w.error}}r.length&&Qa(r,{cancel:!1}),m=t.arrSeries[0].seriesLoadIds,v=m.loadIds,g=m.seriesUid,(y=v.slice(d)).length?Qa(y,{cancel:!1,countCallback:function(e,t,n){I.layoutView.progressCountStyle(g,y.length,n)}}):this.layoutView.progressCountStyle(g,1,1,!0)}}catch(e){console.error("first series load error: "+e)}return[2]}}))}))},e.prototype.restoreSeries=function(e){var t=this;e.length<=0||!e||(za(),this.studyScrollIndex=0,this.layoutView.seriesLayout.seriesLayouts=[],m(this.layoutView.canvasContainer),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,e,this.seriesCount),this.layoutView.seriesLayout.seriesLayouts.forEach((function(n,r){var o=n.seriesDom,a=e[r];a&&t.displaySeriesByImageindex(o,null==a?void 0:a.seriesLoadIds)})),this.reloadReferenceLineTool())},e.prototype.getSeriesMeta=function(e,t,n){var r,o=this,a=e.studyUID,i=e.uuid;if(0===t){var l=function(){return null==r?void 0:r.seriesDom.querySelector("canvas")};if((r=this.layoutView.seriesLayout.seriesLayouts[n])&&!l()){Fa(r.seriesDom);var c=l();(0,s.canvasDrawImage)(c,this.iconImagesArr[t][n].icon,{interceptors:function(){return Promise.resolve((0,s.isCanvasBlank)(c))}}).catch((function(e){}))}}return function(e,t,n,r,o,a,i){return Rc(this,void 0,void 0,(function(){var s;return _c(this,(function(l){switch(l.label){case 0:t=h(t),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,Oc.get("".concat(e,"/").concat("GetSeriesMeta"),{params:{uuid:t,studyuid:n,studyUID:n,hospid:r,hospitalid:r,hospID:r,imageType:o,isDcm:o,hasDesensitize:a},headers:i?{Authorization:"bearer "+i}:{},cancelToken:Uc.token})];case 2:return s=l.sent(),[4,Promise.resolve(s.data)];case 3:return[2,l.sent()];case 4:throw l.sent(),"无法请求到uuid为"+t+"的SeriesMeta数据";case 5:return[2]}}))}))}(this.wado,i,a,this.hospId,this.imageType,this.isDesensitize,this.token).then((function(a){return Jc(o,void 0,void 0,(function(){var o,s,l,c,u,d,f,h,p,m,v,g,y,x,b,w=this;return $c(this,(function(T){switch(T.label){case 0:if(o=a.data,s=o.imgs.sort((function(e,t){return e.imgnum-t.imgnum})),l=s.length,c=this.assambleLoadIds(e,n,l,s),u=c.imgs,d=c.loadIds,!ei)throw"metaDataMap is required";try{for(f=nu(u),h=f.next();!h.done;h=f.next())p=h.value,ei.set(p.imageIdURL,p)}catch(e){x={error:e}}finally{try{h&&!h.done&&(b=f.return)&&b.call(f)}finally{if(x)throw x.error}}return this.studyArr[t].arrSeries[n].seriesLoadIds=c,this.seriesLoadIds.push(c),0!==t?[3,4]:(m=this.seriesCount.x*this.seriesCount.y==1,v=ua.getSeriesIDArr(),g=v.length,y=function(){return Xa(d[0]).then((function(e){!r||m&&(0!==n||g)||w.renderLayoutImageToCanvas(r.seriesDom,e,o.imgs[0],c)}),(function(e){console.log("loadAndCacheImage",e)}))},v.includes(i)?[4,y()]:[3,2]);case 1:return T.sent(),[3,3];case 2:y(),T.label=3;case 3:T.label=4;case 4:return[2]}}))}))})).catch((function(e){console.log(e)}))},e.prototype.initFirstStudySeriesLayoutState=function(e){var t=e.arrSeries;this.seriesLayoutState=new js(t)},e.prototype.initStudyNavigation=function(e){var t,n=this.studyArr[e],r=this.iconImagesArr[e]=[];n.arrSeries.forEach((function(e){r.push({icon:e.icon,images:e.arrImage,hasAi:!1,seriesId:e.uuid,seriesDescription:e.desp,series:e})})),((null===(t=this.layoutView.leftSideContainer)||void 0===t?void 0:t.childElementCount)||0)<this.studyArr.length&&this.layoutView.createStudyNavigationGroup(n,r,e)},e.prototype.reload2d=function(){this.layoutView.iconPlayer.playerRemove(),this.layoutView.topTools.cancelToolAndDefaultViewportTools(),this.layoutView.initTop2DTools();var e=this.studyArr[0];this.seriesCount=e.getSeriesLayoutCount(),this.seriesLayoutState.syncState(),this.restoreSeries(this.seriesLayoutState.getSeries("originStates"))},e.prototype.initMPR=function(){var e;return Jc(this,void 0,void 0,(function(){var r,a,i,c,u,d,f,h,p,m,g,y,x,b,w,T,I,S,E,C,A,M,P=this;return $c(this,(function(D){switch(D.label){case 0:if(D.trys.push([0,5,,6]),r='"MPR渲染加速"必须使用https安全协议，未部署https安全协议？',a=k.performanceLevel,!(i=this.selectSeries.seriesId))return[2];if(c=this.querySeriesLoadIds(i),u=c.seriesUid,d=c.studyUID,f=tu([],eu(c.loadIds),!1),h=!0,!u||!f)return[2,ue().error({title:"请选择一个序列"})];if(f.length<R.minRenderCountMPR3D)return[2,ue().error({title:"图像数量小于".concat(R.minRenderCountMPR3D,"张，无法构建MPR")})];if(window.SharedArrayBuffer)Object.defineProperty(window,"crossOriginIsolated",{writable:!0}),window.crossOriginIsolated=!0;else if(R.sharedArrayBuffer&&!R.tipRecord.sharedArrayBufferGuide){if(p=navigator.userAgent.indexOf("WebKit")>-1,"http:"===(m=location.protocol)&&(0,s.env)().isWin&&p){if(confirm("".concat(r,"\n\n确定：强制启用加速!  \n取消：放弃加速！")))throw v(g=URL.createObjectURL(new Blob(['@REM chcp 65001\n@REM chcp 936\n\n@echo off\nSetlocal enabledelayedexpansion\nset SCRIPT="%TEMP%\\%RANDOM%-%RANDOM%-%RANDOM%-%RANDOM%.vbs"\n\n:loop\n\n@REM utf-8\nchcp 65001\n\necho.\nset /p "lnkPath=请拖动chrome、Edge、360极速、360安全、QQ等(谷歌内核)浏览器快捷方式到本窗口并回车:"\n\n@REM GB2312 读取中文文件路径\nchcp 936\n\nif exist "%lnkPath%" ( echo. & echo 配置中... ) else (  echo. & echo 请重试  & goto loop)\n\necho Set oWS = WScript.CreateObject("WScript.Shell") >> %SCRIPT%\n\necho sLinkFile = "%lnkPath:"=%" >> %SCRIPT%\n\necho Set oLink = oWS.CreateShortcut(sLinkFile) >> %SCRIPT%\n\necho oLink.Arguments= "--enable-features=SharedArrayBuffer"  >> %SCRIPT%\n\n@REM echo oLink.WorkingDirectory = "%workingDir%" >> %SCRIPT%\n\necho oLink.Save >> %SCRIPT%\n\ncscript /nologo %SCRIPT%\n\ndel %SCRIPT%\n\n@REM utf-8\nchcp 65001\n\necho.\necho MPR特性支持配置完成，请关闭该浏览器全部窗口后再重新运行该快捷方式去使用MPR功能！\n\necho.\necho.\n\necho 如出现报错或运行本程序后还是无法使用MPR！\necho.\necho 解决方案：\necho.\necho 1.将快捷方式复制一份（解决权限问题）或把名称改为纯英文后再重新运行该程序；\necho.\necho 2.手动修改：找到浏览器快捷方式==》右键==》属性==》目标==》尾部添加--enable-features=SharedArrayBuffer，（例如："某某浏览器.exe" --enable-features=SharedArrayBuffer）\n\necho.\necho.\n\npause',{type:"application/x-msdownload"}])),"双击运行-配置MPR渲染加速特性支持.bat"),URL.revokeObjectURL(g),"isReturn"}else ue().info({title:"http:"===m?"".concat(r,"将关闭MPR渲染加速!"):'"MPR渲染加速"需配置crossOriginIsolated，请联系管理员',timeout:1e4});R.tipRecord.sharedArrayBufferGuide=!0}return window.crossOriginIsolated?console.log("MPR渲染加速已开启"):(h=!1,console.log("MPR渲染加速未开启"),console.error("".concat(r,"Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated"))),1===this.imageType?[3,2]:[4,jc(this.wado,this.hospId,d,u,this.token)];case 1:y=D.sent().data.fileList,f=y.map((function(e){return"wadouri:"+e+(e.includes("?")?"&":"?")+"isMprDcm=1"})),D.label=2;case 2:if(f.length>60*a){if(1,10,x=Math.min(10,Math.max(1,Math.floor(80*a/f.length*10))),null===(b=qt("请输入画质级别：例：(".concat(1,"~").concat(10,")\n画质过高可能导致渲染缓慢、失败或崩溃"),(function(e){return/^\d+(\.\d*)?$/.test(e)&&e>=1&&e<=10}),"数据有误，请重新输入！！！",String(x))))throw"isReturn";f=function(e,t){if(t<=0||t>100)throw new Error("Percentage must be between 0 and 100.");for(var n=e.length,r=Math.floor(n*(t/100)),o=[],a=0;a<r;a++){var i=Math.floor(a*(n/r));o.push(e[i])}return o}(f,10*Number(b))}return w=this.layoutView.mprLayout.createLayout(),ru.show({message:"MPR资源加载中,请耐心等待"}),this.layoutView.seriesLayout.toggleNavigatorInfo(u),[4,Qa(f,{countCallback:function(e,t,n){P.layoutView.progressCountStyle(u,f.length,n)},type:"MPR"})];case 3:if(D.sent(),1!==this.imageType){T=[];try{for(I=nu(f),S=I.next();!S.done;S=I.next()){E=S.value;try{T.push({id:t.metaData.get("sopCommonModule",E).sopInstanceUID.slice(-4),imageId:E})}catch(e){ge("sopInstanceUIDUndefined","温馨提示：MPR生成检测到异常，可切换到专业模式或稍后重试","error",void 0,(function(e,t){console.log("sort error",e,t)}),e,E)}}}catch(e){A={error:e}}finally{try{S&&!S.done&&(M=I.return)&&M.call(I)}finally{if(A)throw A.error}}T.sort((function(e,t){return e.id-t.id})),f=T.map((function(e){return e.imageId}))}if(ru.hidden(),Qc(),void 0===n.g.webDicomViewMPR)throw"MPR模块未加载，请稍后重试或联系管理员检查配置";return this.layoutView.initTopMPRTools("mobile"===R.env?"翻页":"十字准星"),[4,null===(e=n.g.webDicomViewMPR)||void 0===e?void 0:e.MPRRun(w,{seriesUid:u,loadIds:f,GPUBenchmarksURL:this.GPUBenchmarksURL,layoutView:this.layoutView,useSharedArrayBuffer:h,globalVar:{cornerstone:o(),cornerstoneWADOImageLoader:X(),iziToast:ue(),simple2k13:l(),store:R,utils:{clearImageCache:z}}})];case 4:return D.sent(),[3,6];case 5:return C=D.sent(),Qc(),ru.hidden(),this.layoutView.mprLayout.hidden(),this.layoutView.initTop2DTools(),"isReturn"===C?[2]:(console.error(C),ue().error({title:"MPR生成失败，请稍后重试"}),ue().error({title:String(C),timeout:1e4}),[3,6]);case 6:return[2]}}))}))},e.prototype.initVRT=function(){this.layoutView.initTop2DTools();var e=this.selectSeries.seriesId;if(e){var t,n,r=this.querySeriesLoadIds(e),o=r.loadIds,a=r.seriesUid,i=r.studyUID;if(!this.VRTWsURl)return ue().error({title:"该医院未接入3D"});if(!a||!o)return ue().error({title:"请选择一个序列"});if(o.length<R.minRenderCountMPR3D)return ue().error({title:"图像数量小于".concat(R.minRenderCountMPR3D,"张，无法构建3D")});t=this.layoutView.vrtLayout.createLayout(),n={vrtWsURl:this.VRTWsURl,wadoURL:this.wado,hospId:this.hospId,studyUID:i,seriesUid:a,layoutView:this.layoutView},Ss(void 0,void 0,void 0,(function(){var e;return Es(this,(function(r){return e=n.layoutView,Ts=new ws,Is=e,Ts.open(t,n),[2]}))})),this.layoutView.initTopVRTTools("旋转")}},e.prototype.reloadReferenceLineTool=function(){var e;(null===(e=this.layoutView.toolsContainer.querySelector(".tools2d .tool-btn-style.referenceLine"))||void 0===e?void 0:e.classList.contains("active"))&&this.referenceLineTool(!0)},e.prototype.cancelToolAndDefaultViewport=function(){var e=(this.queryCurrentContainer()||{}).seriesDom,t=null==e?void 0:e.querySelector(".layoutImage.active"),n=tu(tu([],eu(this.synchronizer.getSourceElements()),!1),[t||e],!1);this.layoutView.topTools.cancelToolAndDefaultViewportTools(n)},e.prototype.saveImageTool=function(){var e,t,n,r,o=this.queryCurrentContainer()||{},a=o.seriesDom,i=o.seriesId,l=a.querySelector(".layoutImage.active"),c=null===(t=null===(e=a.querySelector("#filmMarker"))||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.replace("影像号：","_"),u=null===(n=l||a)||void 0===n?void 0:n.querySelector("canvas");if(!u)return ue().error({title:"请选择一个序列"});var d=u.toDataURL("image/png",1),f=eu((null===(r=this.querySeriesLoadIds(i))||void 0===r?void 0:r.imgs)||[{}],1)[0],h=f.name,p=f.mod,m=f.age,g=f.studt,y="".concat(h,"_").concat(m,"_").concat(p,"_").concat(g).concat(c||""),x=(0,s.env)(),b=x.isWeChat,w=x.isMobile;if(b&&w)return this.layoutView.createImageLayout(d,y);v(d,y)},e.prototype.disableSeriesTool=function(){var e=(this.queryCurrentContainer()||{}).seriesDom,t=e.dataset.seriesIndex;this.seriesLayoutState.removeSerie(Number(t)),delete e.dataset.seriesId,this.layoutView.clearSeriesLayout(e,!0)},e.prototype.invertTool=function(e){var n=this.queryCurrentContainer().seriesDom,r=n.querySelector(".layoutImage.active");n=r||n;var o=((0,t.getViewport)(n)||{}).invert,i=e.getHandler();e.setHandler((function(e,t,n){i&&i(e,t,n),function(e,t,n){if(n!==t){var r=a.external.cornerstone,o=r.getViewport(t),i=r.getViewport(n);i.invert!==o.invert&&(i.invert=o.invert,e.setViewport(n,i))}}(e,t,n)})),(0,t.setViewport)(n,{invert:!o})},e.prototype.referenceLineTool=function(e){var n,r,o;if(z(e?"ReferenceLinesOpen":"ReferenceLinesClose"),!e)return(0,a.setToolDisabled)("ReferenceLines");var i=new a.Synchronizer(t.EVENTS.NEW_IMAGE,a.updateImageSynchronizer),s=(null===(o=this.layoutView)||void 0===o?void 0:o.seriesLayout).seriesLayouts;try{for(var l=nu(s),c=l.next();!c.done;c=l.next()){var u=c.value,d=u.seriesDom;u.seriesId&&(d.querySelector(".layoutImage")||(Fa(d),i.add(d)))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}(0,a.setToolEnabled)("ReferenceLines",{synchronizationContext:i}),s.length<this.seriesLayoutState.getStatesLength()&&ge("ReferenceLinesTips","温馨提示：可视序列窗口数量少于序列总量，可能导致定位线不工作。1.将相关序列置于可视序列窗口中；2.可设置序列窗口数量大于等于序列总量","info")},e.prototype.magnifyTool=function(){this.layoutView.topTools.magnifyTool()},e.prototype.queryStudy=function(e){return this.studyArr.find((function(t){return e===(null==t?void 0:t.studyuid)}))},e.prototype.querySeries=function(e){var t,n,r,o;try{for(var a=nu(this.studyArr),i=a.next();!i.done;i=a.next()){var s=i.value;if(o=null===(r=null==s?void 0:s.arrSeries)||void 0===r?void 0:r.find((function(t){return t.uuid===e})),o)break}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o},e.prototype.querySeriesLoadIds=function(e){return this.seriesLoadIds.find((function(t){return t.seriesUid===e}))},e.prototype.queryCurrentContainer=function(){return this.layoutView.seriesLayout.seriesLayouts.find((function(e){var t=e.seriesDom;return t.classList.contains("active")||t.parentNode.classList.contains("active")}))},e.prototype.queryCurrentSeries=function(e){void 0===e&&(e=this.queryCurrentContainer());var t=e.seriesId,n=e.seriesDom,r=this.querySeriesLoadIds(t)||{};return Kc({seriesId:t,seriesDom:n},r)},e.prototype.bindEvents=function(){var e,n,r=this,o=this.eventNamespace,i=(0,s.debounce)((function(){return(0,t.triggerEvent)(t.events,"window_resize",{canvasBox:r.layoutView.canvasContainer})}),50);window.addEventListener("resize",(function(){i()})),window.addEventListener("keydown",(function(e){"Escape"===e.key&&Yc()}));try{for(var l=nu(["beforeunload","unload","pagehide","visibilitychange"]),u=l.next();!u.done;u=l.next()){var d=u.value;window.addEventListener(d,(function(){var e=R.instanceOptions.closePageResetDefault,t=void 0===e?{}:e,n=t.imageType,r=t.cacheImages,o=R.DBCacheImages;n&&(R.imageType=null),r&&(o.enable=o.enableDefault)}))}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}t.events.addEventNamespaceListener("layout_area_focus.".concat(o),(function(e){var t=e.detail.area;pe("multiImage",(0,s.throttle)((function(){switch(t){case"toolbarLayout":case"seriesLayout":case"seriesMPROr3DLayout":r.layoutView.seriesBarToggle(!1),r.layoutView.selectPopupHidden()}}),500))})),t.events.addEventNamespaceListener("tool_series_layout.".concat(o),(function(e){var t=e.detail.ptCell;r.seriesCount=t,r.restoreSeries(r.seriesLayoutState.getSeries())})),t.events.addEventNamespaceListener("tool_series_image_layout.".concat(o),(function(e){return Jc(r,void 0,void 0,(function(){var n,r,o,a,i,l,c,u,d,f,h,p,m,v,g,y,x,b,w;return $c(this,(function(T){switch(T.label){case 0:return n=e.detail,r=n.ptCell,o=n.ptCell,a=o.x,i=o.y,l=this.queryCurrentContainer(),c=l.seriesDom,(u=l.seriesId)?(d=this.querySeries(u),f=this.querySeriesLoadIds(u),h=a*i==1,ou(c,0),this.layoutView.clearSeriesLayout(c,!0),h?(p=c.dataset.seriesIndex,m=this.seriesLayoutState.getSynchronizerStatus(Number(p)),c.classList.remove("noActiveBorder"),qa(c),[4,this.displaySeriesByImageindex(c,f)]):[3,2]):[2];case 1:return T.sent(),this.layoutView.seriesLayout.initSingle(c,f,void 0,{synchronizerStatus:m}),[3,3];case 2:c.classList.add("noActiveBorder"),(0,t.triggerEvent)(t.events,"series_synchronizer_remove",{seriesDom:c,setSynchronizerStatus:!1}),this.layoutView.seriesLayout.createImagesLayout(c,d,r),this.displayDcmByImages(c,Kc({series:d},f)),v=(0,s.env)(),g=v.isWeChat,y=v.isAndroid,g&&y&&(x=this.seriesCount,b=x.x,w=x.y,a*i+b*w>8&&ue().info({title:"安卓版微信渲染序列图像过多可能导致失败!",timeout:1e4})),T.label=3;case 3:return this.reloadReferenceLineTool(),[2]}}))}))})),t.events.addEventNamespaceListener("study_scroll.".concat(o),(function(e){return Jc(r,void 0,void 0,(function(){var t,n,r,o,a,i,s,l,c,u,d,f,h,p,m,v,g,y,x,b,w,T,I,S=this;return $c(this,(function(E){switch(E.label){case 0:for(u in t=e.detail,n=t.currentIndex,r=void 0===n?0:n,o=t.layoutCount,a=void 0===o?1:o,i=this.seriesLayoutState.getStates(),s=this.layoutView.seriesLayout.seriesLayouts,l=r*a,this.studyScrollIndex=r,this.layoutView.iconPlayer.playerRemove(),Yc(),c=[],s)c.push(u);d=0,E.label=1;case 1:return d<c.length?(f=c[d],h=Number(f)+l,p=s[f],m=p.seriesDom,v=i[h]||{},g=v.seriesId,y=v.studyUID,x=v.series,b=v.synchronizerStatus,w=v.scrollIndex,T=(x||{}).seriesLoadIds,p.seriesId=g,this.layoutView.clearSeriesLayout(m),Fa(m),T?[4,this.displaySeriesByImageindex(m,T)]:[3,3]):[3,5];case 2:E.sent(),E.label=3;case 3:this.layoutView.seriesLayout.initSingle(m,x,{seriesId:g,studyUID:y,seriesIndex:h},{synchronizerStatus:b,scrollIndex:w}),E.label=4;case 4:return d++,[3,1];case 5:return I=(this.selectSeries||{}).seriesId,this.layoutView.seriesLayout.toggleSeriesStyle({seriesId:I}),setTimeout((function(){S.reloadReferenceLineTool()}),500),[2]}}))}))})),t.events.addEventNamespaceListener("series_scroll.".concat(o),(function(e){var t=e.detail,n=t.element,o=t.currentIndex,a=t.isSeriesImage,i=t.imageIds;a&&r.displayDcmByImages(n,{loadIds:i},o),r.seriesLayoutState.setScrollIndex(n.dataset.seriesIndex,o),r.layoutView.iconPlayer.toggleControlStyle(o,null==i?void 0:i.length);var s=r.synchronizer;s.timer&&clearTimeout(s.timer),s.enabled=!1,s.timer=setTimeout((function(){s.enabled=!0}),100)})),t.events.addEventNamespaceListener("tool_imageType.".concat(o),(function(e){return Jc(r,void 0,void 0,(function(){var t,n;return $c(this,(function(r){switch(r.label){case 0:return t=e.detail,n=t.type,t.custom||(R.imageType=n,this.imageType=n),this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.getStudyInfoCount=0,this.layoutView.seriesLayout.seriesLayouts=[],this.layoutView.imageType(e.detail),za(),ei.clear(),z("imageTypeToggle",!0),Qa([],{forceCancelAll:!0}),document.querySelectorAll(".iziToast").forEach((function(e){ue().hide({},e)})),m(this.layoutView.canvasContainer),m(this.layoutView.leftSideContainer),[4,this.getStudyInfos()];case 1:return r.sent(),this.reloadReferenceLineTool(),[2]}}))}))})),t.events.addEventNamespaceListener("tool_wwwc.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.wwwcImage(t,e.detail)})),t.events.addEventNamespaceListener("tool_scale.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.scaleImage(t,e.detail)})),t.events.addEventNamespaceListener("tool_rotate.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.rotateImage(t,e.detail)})),t.events.addEventNamespaceListener("tool_colorMap.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.colorMapImage(t,e.detail,r.synchronizer)})),t.events.addEventNamespaceListener("window_resize.".concat(o),(function(e){var t=e.detail.canvasBox;r.layoutView.resizeLayout(t),R.env!==c()&&ue().info({title:"为了更好的体验，请刷新或重新进入"})}));var f=function(e,t){z("downloadActive"),Qa(e,{countCallback:function(n,o,a){r.layoutView.progressCountStyle(t,e.length,a)}})};t.events.addEventNamespaceListener("navigator_dbClick_drag.".concat(o),(function(e){var t=e.detail.iconImage.seriesId,n=r.querySeries(t),o=n.seriesLoadIds,a=n.seriesLoadIds,i=a.loadIds,s=a.studyUID,l=r.queryCurrentContainer(),c=l.seriesDom,u=c.dataset.seriesIndex;r.selectSeries={seriesId:t,seriesIndex:Number(u),studyUID:s},r.layoutView.iconPlayer.playerRemove(),r.layoutView.seriesLayout.toggleNavigatorInfo(t),f(i,t),r.layoutView.clearSeriesLayout(c),l.seriesId=t,r.seriesLayoutState.setState(Number(u),{studyUID:s,seriesId:t,series:n,scrollIndex:0,synchronizerStatus:!1}),r.layoutView.seriesLayout.initSingle(c,o,{seriesId:t,studyUID:s}),r.displaySeriesByImageindex(c,o)})),t.events.addEventNamespaceListener("navigator_active.".concat(o),(function(e){var t=e.detail,n=t.iconImage.seriesId,o=t.target,a=t.event.isTrusted,i=(r.selectSeries.seriesId,r.querySeriesLoadIds(n)),s=i.loadIds,l=i.studyUID,c=i.seriesIndex,u=r.seriesCount,d=u.x*u.y,h=r.seriesLayoutState.getSeriesActiveIndex(n);if(void 0===h)return ue().error({title:"该序列不在序列窗口中，图像未渲染，请".concat("mobile"===R.env?"长按添加":"拖拽","或双击添加到序列窗口"),timeout:1e4});r.selectSeries={seriesId:n,studyUID:l,seriesIndex:c},r.layoutView.iconPlayer.playerRemove(),r.layoutView.seriesLayout.toggleNavigatorInfo(n),a?f(s,n):r.layoutView.progressCountStyle(n);var p=Math.floor(h/d),m=p!==r.studyScrollIndex;m?r.layoutView.studySlider.setIndex(p):r.layoutView.seriesLayout.toggleSeriesStyle({seriesId:n});var v=r.layoutView.canvasContainer.querySelector(".signBigLayout");v&&setTimeout((function(){var e=r.layoutView.canvasContainer.querySelector(".layoutCellsOuter.active");!e||m&&e==v?null==o||o.click():(r.layoutView.seriesLayout.dblclickCanvasLayout(v,v.querySelector(".layoutCellsInner"),!0),r.layoutView.seriesLayout.dblclickCanvasLayout(e,e.querySelector(".layoutCellsInner"),!1))}),0)})),t.events.addEventNamespaceListener("canvas_active.".concat(o),(function(e){var t,n=e.detail,o=n.$canvas,i=n.type,s=o.dataset,l=s.seriesId,c=s.seriesIndex,u=s.studyUID,d=r.selectSeries.seriesId;if(r.selectSeries={seriesId:l,seriesIndex:c,studyUID:u},r.layoutView.seriesLayout.toggleSeriesStyle({target:o}),("wheel"===i||l!==d)&&(r.layoutView.seriesLayout.toggleNavigatorInfo(l),l))try{var f=eu((null===(t=(0,a.getToolState)(o,"stack"))||void 0===t?void 0:t.data)||[{}],1)[0],h=f.imageIds,p=void 0===h?[]:h,m=f.currentImageIdIndex,v=void 0===m?0:m;A.scroll?(Qa(p.slice(v,v+6)),r.layoutView.progressCountStyle(l,void 0,void 0,A.fullLoad)):Qa(p,{countCallback:function(e,t,n){r.layoutView.progressCountStyle(l,p.length,n,A.fullLoad)}})}catch(e){Ei(e)}})),t.events.addEventNamespaceListener("tool_event.".concat(o),(function(e){var n,o,i,s,l=e.detail,c=l.toolData,u=l.btnTarget,d=l.btnOriginTarget,f=!(null==u?void 0:u.classList.contains("active")),h=!0,p=!0;switch(c.btnTarget=u,c.btnOriginTarget=d,Yc(),c.toolTag){case"seriesBar":r.layoutView.seriesBarToggle();break;case"MPR":z("MPR"),r.initMPR(),r.layoutView.seriesBarToggle(!1);break;case"VRT":z("VRT"),r.initVRT(),r.layoutView.seriesBarToggle(!1);break;case"AI":r.initAI(f);break;case"imageType":r.layoutView.createImageTypeLayout(e);break;case"reload":z("reload"),r.reload2d();break;case"disableAllTool":r.layoutView.topTools.disableAllTool();break;case"modulation":r.layoutView.topTools.modulationTool(r.synchronizer),r.layoutView.createWWWCLayout(e);break;case"stackScroll":r.layoutView.topTools.stackScrollTool(r.synchronizer);break;case"sharpen":r.layoutView.topTools.sharpenTool();break;case"blur":r.layoutView.topTools.blurTool();break;case"series":r.layoutView.createSeriesCellLayout(e,"series",{x:3,y:3},r.seriesCount);break;case"image":var m=(null===(n=r.queryCurrentContainer())||void 0===n?void 0:n.seriesDom.dataset)||{},v=m.imgRow,g=void 0===v?1:v,y=m.imgColumn,x=void 0===y?1:y;r.layoutView.createSeriesCellLayout(e,"image","mobile"===R.env?{x:3,y:3}:{x:5,y:5},{x:Number(x),y:Number(g)});break;case"move":r.layoutView.topTools.moveTool(r.synchronizer);break;case"scale":r.layoutView.topTools.scaleTool(r.synchronizer),r.layoutView.createScaleLayout(e);break;case"rotate":r.layoutView.topTools.rotateTool(r.synchronizer),r.layoutView.createRotateLayout(e);break;case"invert":r.invertTool(r.synchronizer);break;case"colorMap":r.layoutView.createColorMapLayout(e);break;case"referenceLine":r.referenceLineTool(f);break;case"DICOMMetaDataInfo":var b=r.queryCurrentContainer(),w=b.seriesId,T=b.seriesDom;if(!T.querySelector("canvas"))return ue().error({title:"请选择一个序列"});var I=eu((null===(o=(0,a.getToolState)(T,"stack"))||void 0===o?void 0:o.data)||[{}],1)[0].currentImageIdIndex,S=void 0===I?0:I,E=(null===(i=r.queryCurrentSeries({seriesId:w,seriesDom:T}))||void 0===i?void 0:i.imgs[S])||{},C=r.queryStudy(E.stuuid)||{},M=C.name,P=C.patientid,D=C.age,k=C.studydate,L=C.studyid,_=C.orgname;r.layoutView.createDICOMMetaDataInfoLayout(Kc(Kc({},E),{name:M,patid:P,age:D,acqdt:k,stuid:L,inst:_}));break;case"visibilityCavanAroundInfo":R.cavanAroundInfo=!R.cavanAroundInfo,r.layoutView.toggleCavanAroundInfoStyle(f);break;case"magnify":r.magnifyTool();break;case"angle":r.layoutView.topTools.angleTools();break;case"cobbAngle":r.layoutView.topTools.cobbAngleTools();break;case"straightline":r.layoutView.topTools.straightlineTools();break;case"rect":r.layoutView.topTools.rectangleRoiTools();break;case"elliptical":r.layoutView.topTools.ellipticalRoiTools();break;case"circle":r.layoutView.topTools.circleRoiTools();break;case"freehandRoi":r.layoutView.topTools.FreehandRoiTool();break;case"timeplay":var N=r.queryCurrentSeries();if(p=!1,(null===(s=N.loadIds)||void 0===s?void 0:s.length)>1){var U=N.seriesDom,B=U.parentElement,j=U.parentElement.querySelector("div.player-bar");r.layoutView.iconPlayer.playerRemove(),j||(r.layoutView.iconPlayer.createPlayer(U,B,N),r.layoutView.iconPlayer.playerStart())}else ue().error({title:N.loadIds?"当前序列只有一张图":"请选择一个序列"});break;case"probeCT":r.layoutView.topTools.ProbeCTTool();break;case"arrowAnnotate":r.layoutView.topTools.ArrowAnnotateTool();break;case"annotate":r.layoutView.topTools.AnnotateTool();break;case"lMarker":r.layoutView.topTools.lrMarkerTool("L");break;case"rMarker":r.layoutView.topTools.lrMarkerTool("R");break;case"ctr":r.layoutView.topTools.heartratioTool();break;case"cancelToolAndDefaultViewport":r.cancelToolAndDefaultViewport();break;case"cancelToolState":var F=(r.queryCurrentContainer()||{}).seriesDom,V=F.querySelector(".layoutImage.active");r.layoutView.topTools.cancelTool(F),V&&r.layoutView.topTools.cancelTool(V);break;case"eraser":r.layoutView.topTools.EraserTools();break;case"saveImage":r.saveImageTool();break;case"disableSeries":r.disableSeriesTool();break;case"useCacheImage":if(Qa([],{forceCancelAll:!0}),!f){var H="缓存功能即将关闭，低内存手机建议打开!";if(A.fullLoad&&(H="全量下载模式下请保持缓存功能打开，否则可能影响下载效果！是否关闭？"),!confirm(H)){h=!1;break}(0,t.triggerEvent)(t.events,"tool_imageType",{custom:!0})}O.enable=f;break;case"imageCacheType":if(f){if(!confirm("高性能模式即将打开，建议高性能设备使用，如遇问题请关闭或刷新即会自动关闭!")){h=!1;break}}else if(!O.enable){var q=r.layoutView.toolsContainer.querySelector(".select-popup-item.useCacheImage");null==q||q.click()}R.imageCacheTypeDefault=f?1:0,z("imageCacheType");break;case"aboutUs":r.layoutView.createAboutUsLayout(R.aboutUs)}h&&r.layoutView.toggleToolStyle(c),p&&r.layoutView.iconPlayer.playerRemove()})),t.events.addEventNamespaceListener("images_viewport.".concat(o),(function(e){var t=e.detail,n=t.element,r=t.viewport,o=r.voi,a=o.windowWidth,i=o.windowCenter,s=r.scale,l=n.querySelector("#wwWMarker"),c=n.querySelector("#wwHMarker"),u=n.querySelector("#scaleMarker");l&&(l.innerHTML="窗宽："+(null==a?void 0:a.toFixed(2))),c&&(c.innerHTML="窗位："+(null==i?void 0:i.toFixed(2))),u&&(u.innerHTML="倍数："+(null==s?void 0:s.toFixed(2)))})),t.events.addEventNamespaceListener("iconplayer_series.".concat(o),(function(e){var t=e.detail;r.layoutView.iconPlayer.playerBarClickHandle(t)})),t.events.addEventNamespaceListener("series_synchronizer_add.".concat(o),(function(e){var t=e.detail.element;r.synchronizer.add(t),r.synchronizerStackImageIndex.add(t),r.seriesLayoutState.setSynchronizerStatus(t.dataset.seriesIndex,!0)})),t.events.addEventNamespaceListener("series_synchronizer_remove.".concat(o),(function(e){var t=e.detail,n=t.element,o=t.setSynchronizerStatus,a=void 0===o||o;r.synchronizer.remove(n),r.synchronizerStackImageIndex.remove(n),a&&r.seriesLayoutState.setSynchronizerStatus(n.dataset.seriesIndex,!1)})),t.events.addEventNamespaceListener("".concat(t.EVENTS.IMAGE_CACHE_FULL,".").concat(o),(function(){z(t.EVENTS.IMAGE_CACHE_FULL)})),t.events.addEventNamespaceListener("".concat(t.EVENTS.WEBGL_TEXTURE_CACHE_FULL,".").concat(o),(function(){}))},e.prototype.removeEventListener=function(){var e,n,r=this.eventNamespace;window.onresize=void 0;try{for(var o=nu(["tool_series_layout","tool_series_image_layout","study_scroll","series_scroll","tool_imageType","tool_wwwc","tool_scale","tool_rotate","tool_colorMap","window_resize","navigator_dbClick_drag","navigator_active","canvas_active","canvas_active.player","tool_event","tool_event.VRT","layout_area_focus","images_viewport","iconplayer_series","series_synchronizer_add","series_synchronizer_remove"]),a=o.next();!a.done;a=o.next()){var i=a.value;i.indexOf(".")<=0&&(i+=".".concat(r)),t.events.removeEventNamespaceListener(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},e.prototype.destroy=function(){var e;if(this.isDestroy)throw new Error("实例已销毁，请勿重复调用,请将实例赋值为null或undefined");this.layoutView.iconPlayer.playerRemove(),Yc(),he.clear(),ei.clear(),null===(e=n.g.webDicomViewMPR)||void 0===e||e.MPRDestroy(),As(),za(),z("destroy",!0),Qa([],{forceCancelAll:!0}),(0,Ba.configure)({parent:"body"}),this.layoutView.seriesLayout.seriesLayouts=[],this.studyUIDArr=[],this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.seriesLoadIds=[],this.selectSeries={},this.removeEventListener(),m(this.layoutView.canvasContainer),m(this.globalContainer),this.globalContainer.classList.remove("dicomView"),this.synchronizer=void 0,this.synchronizerStackImageIndex=void 0,this.seriesLayoutState=void 0,this.globalContainer=void 0,this.isDestroy=!0},e}();const iu=au})(),r=r.default})()));