!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WebDicomView",[],t):"object"==typeof exports?exports.WebDicomView=t():e.WebDicomView=t()}("undefined"!=typeof self?self:this,(()=>(()=>{var e={2695:function(e){var t;t=()=>(()=>{"use strict";var e={578:(e,t,n)=>{const r=n(823),o=n(187),a=n(592),i=n(604),s=n(249),l=n(968),c=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:d,Z_OK:f,Z_STREAM_END:h,Z_NEED_DICT:p,Z_STREAM_ERROR:m,Z_DATA_ERROR:g,Z_MEM_ERROR:v}=n(684);function y(e){this.options=o.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let n=r.inflateInit2(this.strm,t.windowBits);if(n!==f)throw new Error(i[n]);if(this.header=new l,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary),n!==f)))throw new Error(i[n])}y.prototype.push=function(e,t){const n=this.strm,o=this.options.chunkSize,i=this.options.dictionary;let s,l,y;if(this.ended)return!1;for(l=t===~~t?t:!0===t?d:u,"[object ArrayBuffer]"===c.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),s=r.inflate(n,l),s===p&&i&&(s=r.inflateSetDictionary(n,i),s===f?s=r.inflate(n,l):s===g&&(s=p));n.avail_in>0&&s===h&&n.state.wrap>0&&0!==e[n.next_in];)r.inflateReset(n),s=r.inflate(n,l);switch(s){case m:case g:case p:case v:return this.onEnd(s),this.ended=!0,!1}if(y=n.avail_out,n.next_out&&(0===n.avail_out||s===h))if("string"===this.options.to){let e=a.utf8border(n.output,n.next_out),t=n.next_out-e,r=a.buf2string(n.output,e);n.next_out=t,n.avail_out=o-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==f||0!==y){if(s===h)return s=r.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Hq=function(e,t){return(t=t||{}).raw=!0,function(e,t){const n=new y(t);if(n.push(e),n.err)throw n.msg||i[n.err];return n.result}(e,t)},n(684)},187:e=>{const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);e.exports.assign=function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const r=n.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const n in r)t(r,n)&&(e[n]=r[n])}}return e},e.exports.flattenChunks=e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,o=e.length;t<o;t++){let o=e[t];n.set(o,r),r+=o.length}return n}},592:e=>{let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const n=new Uint8Array(256);for(let e=0;e<256;e++)n[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;n[254]=n[254]=1,e.exports.string2buf=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,o,a,i=e.length,s=0;for(o=0;o<i;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<i&&(r=e.charCodeAt(o+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,o=0;a<s;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<i&&(r=e.charCodeAt(o+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),o++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},e.exports.buf2string=(e,r)=>{const o=r||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,r));let a,i;const s=new Array(2*o);for(i=0,a=0;a<o;){let t=e[a++];if(t<128){s[i++]=t;continue}let r=n[t];if(r>4)s[i++]=65533,a+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&a<o;)t=t<<6|63&e[a++],r--;r>1?s[i++]=65533:t<65536?s[i++]=t:(t-=65536,s[i++]=55296|t>>10&1023,s[i++]=56320|1023&t)}}return((e,n)=>{if(n<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===n?e:e.subarray(0,n));let r="";for(let t=0;t<n;t++)r+=String.fromCharCode(e[t]);return r})(s,i)},e.exports.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+n[e[r]]>t?r:t}},693:e=>{e.exports=(e,t,n,r)=>{let o=65535&e|0,a=e>>>16&65535|0,i=0;for(;0!==n;){i=n>2e3?2e3:n,n-=i;do{o=o+t[r++]|0,a=a+o|0}while(--i);o%=65521,a%=65521}return o|a<<16|0}},684:e=>{e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},464:e=>{const t=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());e.exports=(e,n,r,o)=>{const a=t,i=o+r;e^=-1;for(let t=o;t<i;t++)e=e>>>8^a[255&(e^n[t])];return-1^e}},968:e=>{e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},365:e=>{const t=16209;e.exports=function(e,n){let r,o,a,i,s,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I,S,C,E;const A=e.state;r=e.next_in,C=e.input,o=r+(e.avail_in-5),a=e.next_out,E=e.output,i=a-(n-e.avail_out),s=a+(e.avail_out-257),l=A.dmax,c=A.wsize,u=A.whave,d=A.wnext,f=A.window,h=A.hold,p=A.bits,m=A.lencode,g=A.distcode,v=(1<<A.lenbits)-1,y=(1<<A.distbits)-1;e:do{p<15&&(h+=C[r++]<<p,p+=8,h+=C[r++]<<p,p+=8),b=m[h&v];t:for(;;){if(x=b>>>24,h>>>=x,p-=x,x=b>>>16&255,0===x)E[a++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=m[(65535&b)+(h&(1<<x)-1)];continue t}if(32&x){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=t;break e}w=65535&b,x&=15,x&&(p<x&&(h+=C[r++]<<p,p+=8),w+=h&(1<<x)-1,h>>>=x,p-=x),p<15&&(h+=C[r++]<<p,p+=8,h+=C[r++]<<p,p+=8),b=g[h&y];n:for(;;){if(x=b>>>24,h>>>=x,p-=x,x=b>>>16&255,!(16&x)){if(0==(64&x)){b=g[(65535&b)+(h&(1<<x)-1)];continue n}e.msg="invalid distance code",A.mode=t;break e}if(T=65535&b,x&=15,p<x&&(h+=C[r++]<<p,p+=8,p<x&&(h+=C[r++]<<p,p+=8)),T+=h&(1<<x)-1,T>l){e.msg="invalid distance too far back",A.mode=t;break e}if(h>>>=x,p-=x,x=a-i,T>x){if(x=T-x,x>u&&A.sane){e.msg="invalid distance too far back",A.mode=t;break e}if(I=0,S=f,0===d){if(I+=c-x,x<w){w-=x;do{E[a++]=f[I++]}while(--x);I=a-T,S=E}}else if(d<x){if(I+=c+d-x,x-=d,x<w){w-=x;do{E[a++]=f[I++]}while(--x);if(I=0,d<w){x=d,w-=x;do{E[a++]=f[I++]}while(--x);I=a-T,S=E}}}else if(I+=d-x,x<w){w-=x;do{E[a++]=f[I++]}while(--x);I=a-T,S=E}for(;w>2;)E[a++]=S[I++],E[a++]=S[I++],E[a++]=S[I++],w-=3;w&&(E[a++]=S[I++],w>1&&(E[a++]=S[I++]))}else{I=a-T;do{E[a++]=E[I++],E[a++]=E[I++],E[a++]=E[I++],w-=3}while(w>2);w&&(E[a++]=E[I++],w>1&&(E[a++]=E[I++]))}break}}break}}while(r<o&&a<s);w=p>>3,r-=w,p-=w<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=a,e.avail_in=r<o?o-r+5:5-(r-o),e.avail_out=a<s?s-a+257:257-(a-s),A.hold=h,A.bits=p}},823:(e,t,n)=>{const r=n(693),o=n(464),a=n(365),i=n(446),{Z_FINISH:s,Z_BLOCK:l,Z_TREES:c,Z_OK:u,Z_STREAM_END:d,Z_NEED_DICT:f,Z_STREAM_ERROR:h,Z_DATA_ERROR:p,Z_MEM_ERROR:m,Z_BUF_ERROR:g,Z_DEFLATED:v}=n(684),y=16180,b=16190,x=16191,w=16192,T=16194,I=16199,S=16200,C=16206,E=16209,A=16210,M=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function P(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const D=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<y||t.mode>16211?1:0},k=e=>{if(D(e))return h;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=y,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,u},L=e=>{if(D(e))return h;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,k(e)},O=(e,t)=>{let n;if(D(e))return h;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,L(e))},R=(e,t)=>{if(!e)return h;const n=new P;e.state=n,n.strm=e,n.window=null,n.mode=y;const r=O(e,t);return r!==u&&(e.state=null),r};let _,N,B=!0;const U=e=>{if(B){_=new Int32Array(512),N=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(i(1,e.lens,0,288,_,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;i(2,e.lens,0,32,N,0,e.work,{bits:5}),B=!1}e.lencode=_,e.lenbits=9,e.distcode=N,e.distbits=5},V=(e,t,n,r)=>{let o;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>r&&(o=r),a.window.set(t.subarray(n-r,n-r+o),a.wnext),(r-=o)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0};e.exports.inflateReset=L,e.exports.inflateReset2=O,e.exports.inflateResetKeep=k,e.exports.inflateInit=e=>R(e,15),e.exports.inflateInit2=R,e.exports.inflate=(e,t)=>{let n,P,k,L,O,R,_,N,B,F,j,H,z,q,W,G,Y,Z,X,Q,K,J,$=0;const ee=new Uint8Array(4);let te,ne;const re=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(D(e)||!e.output||!e.input&&0!==e.avail_in)return h;n=e.state,n.mode===x&&(n.mode=w),O=e.next_out,k=e.output,_=e.avail_out,L=e.next_in,P=e.input,R=e.avail_in,N=n.hold,B=n.bits,F=R,j=_,J=u;e:for(;;)switch(n.mode){case y:if(0===n.wrap){n.mode=w;break}for(;B<16;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(2&n.wrap&&35615===N){0===n.wbits&&(n.wbits=15),n.check=0,ee[0]=255&N,ee[1]=N>>>8&255,n.check=o(n.check,ee,2,0),N=0,B=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&N)<<8)+(N>>8))%31){e.msg="incorrect header check",n.mode=E;break}if((15&N)!==v){e.msg="unknown compression method",n.mode=E;break}if(N>>>=4,B-=4,K=8+(15&N),0===n.wbits&&(n.wbits=K),K>15||K>n.wbits){e.msg="invalid window size",n.mode=E;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&N?16189:x,N=0,B=0;break;case 16181:for(;B<16;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(n.flags=N,(255&n.flags)!==v){e.msg="unknown compression method",n.mode=E;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=E;break}n.head&&(n.head.text=N>>8&1),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,n.check=o(n.check,ee,2,0)),N=0,B=0,n.mode=16182;case 16182:for(;B<32;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}n.head&&(n.head.time=N),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,ee[2]=N>>>16&255,ee[3]=N>>>24&255,n.check=o(n.check,ee,4,0)),N=0,B=0,n.mode=16183;case 16183:for(;B<16;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}n.head&&(n.head.xflags=255&N,n.head.os=N>>8),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,n.check=o(n.check,ee,2,0)),N=0,B=0,n.mode=16184;case 16184:if(1024&n.flags){for(;B<16;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}n.length=N,n.head&&(n.head.extra_len=N),512&n.flags&&4&n.wrap&&(ee[0]=255&N,ee[1]=N>>>8&255,n.check=o(n.check,ee,2,0)),N=0,B=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(H=n.length,H>R&&(H=R),H&&(n.head&&(K=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(P.subarray(L,L+H),K)),512&n.flags&&4&n.wrap&&(n.check=o(n.check,P,H,L)),R-=H,L+=H,n.length-=H),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===R)break e;H=0;do{K=P[L+H++],n.head&&K&&n.length<65536&&(n.head.name+=String.fromCharCode(K))}while(K&&H<R);if(512&n.flags&&4&n.wrap&&(n.check=o(n.check,P,H,L)),R-=H,L+=H,K)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===R)break e;H=0;do{K=P[L+H++],n.head&&K&&n.length<65536&&(n.head.comment+=String.fromCharCode(K))}while(K&&H<R);if(512&n.flags&&4&n.wrap&&(n.check=o(n.check,P,H,L)),R-=H,L+=H,K)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;B<16;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(4&n.wrap&&N!==(65535&n.check)){e.msg="header crc mismatch",n.mode=E;break}N=0,B=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=x;break;case 16189:for(;B<32;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}e.adler=n.check=M(N),N=0,B=0,n.mode=b;case b:if(0===n.havedict)return e.next_out=O,e.avail_out=_,e.next_in=L,e.avail_in=R,n.hold=N,n.bits=B,f;e.adler=n.check=1,n.mode=x;case x:if(t===l||t===c)break e;case w:if(n.last){N>>>=7&B,B-=7&B,n.mode=C;break}for(;B<3;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}switch(n.last=1&N,N>>>=1,B-=1,3&N){case 0:n.mode=16193;break;case 1:if(U(n),n.mode=I,t===c){N>>>=2,B-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=E}N>>>=2,B-=2;break;case 16193:for(N>>>=7&B,B-=7&B;B<32;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if((65535&N)!=(N>>>16^65535)){e.msg="invalid stored block lengths",n.mode=E;break}if(n.length=65535&N,N=0,B=0,n.mode=T,t===c)break e;case T:n.mode=16195;case 16195:if(H=n.length,H){if(H>R&&(H=R),H>_&&(H=_),0===H)break e;k.set(P.subarray(L,L+H),O),R-=H,L+=H,_-=H,O+=H,n.length-=H;break}n.mode=x;break;case 16196:for(;B<14;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(n.nlen=257+(31&N),N>>>=5,B-=5,n.ndist=1+(31&N),N>>>=5,B-=5,n.ncode=4+(15&N),N>>>=4,B-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=E;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;B<3;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}n.lens[re[n.have++]]=7&N,N>>>=3,B-=3}for(;n.have<19;)n.lens[re[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,te={bits:n.lenbits},J=i(0,n.lens,0,19,n.lencode,0,n.work,te),n.lenbits=te.bits,J){e.msg="invalid code lengths set",n.mode=E;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;$=n.lencode[N&(1<<n.lenbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=B);){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(Y<16)N>>>=W,B-=W,n.lens[n.have++]=Y;else{if(16===Y){for(ne=W+2;B<ne;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(N>>>=W,B-=W,0===n.have){e.msg="invalid bit length repeat",n.mode=E;break}K=n.lens[n.have-1],H=3+(3&N),N>>>=2,B-=2}else if(17===Y){for(ne=W+3;B<ne;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}N>>>=W,B-=W,K=0,H=3+(7&N),N>>>=3,B-=3}else{for(ne=W+7;B<ne;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}N>>>=W,B-=W,K=0,H=11+(127&N),N>>>=7,B-=7}if(n.have+H>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=E;break}for(;H--;)n.lens[n.have++]=K}}if(n.mode===E)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=E;break}if(n.lenbits=9,te={bits:n.lenbits},J=i(1,n.lens,0,n.nlen,n.lencode,0,n.work,te),n.lenbits=te.bits,J){e.msg="invalid literal/lengths set",n.mode=E;break}if(n.distbits=6,n.distcode=n.distdyn,te={bits:n.distbits},J=i(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,te),n.distbits=te.bits,J){e.msg="invalid distances set",n.mode=E;break}if(n.mode=I,t===c)break e;case I:n.mode=S;case S:if(R>=6&&_>=258){e.next_out=O,e.avail_out=_,e.next_in=L,e.avail_in=R,n.hold=N,n.bits=B,a(e,j),O=e.next_out,k=e.output,_=e.avail_out,L=e.next_in,P=e.input,R=e.avail_in,N=n.hold,B=n.bits,n.mode===x&&(n.back=-1);break}for(n.back=0;$=n.lencode[N&(1<<n.lenbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=B);){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(G&&0==(240&G)){for(Z=W,X=G,Q=Y;$=n.lencode[Q+((N&(1<<Z+X)-1)>>Z)],W=$>>>24,G=$>>>16&255,Y=65535&$,!(Z+W<=B);){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}N>>>=Z,B-=Z,n.back+=Z}if(N>>>=W,B-=W,n.back+=W,n.length=Y,0===G){n.mode=16205;break}if(32&G){n.back=-1,n.mode=x;break}if(64&G){e.msg="invalid literal/length code",n.mode=E;break}n.extra=15&G,n.mode=16201;case 16201:if(n.extra){for(ne=n.extra;B<ne;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}n.length+=N&(1<<n.extra)-1,N>>>=n.extra,B-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;$=n.distcode[N&(1<<n.distbits)-1],W=$>>>24,G=$>>>16&255,Y=65535&$,!(W<=B);){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(0==(240&G)){for(Z=W,X=G,Q=Y;$=n.distcode[Q+((N&(1<<Z+X)-1)>>Z)],W=$>>>24,G=$>>>16&255,Y=65535&$,!(Z+W<=B);){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}N>>>=Z,B-=Z,n.back+=Z}if(N>>>=W,B-=W,n.back+=W,64&G){e.msg="invalid distance code",n.mode=E;break}n.offset=Y,n.extra=15&G,n.mode=16203;case 16203:if(n.extra){for(ne=n.extra;B<ne;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}n.offset+=N&(1<<n.extra)-1,N>>>=n.extra,B-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=E;break}n.mode=16204;case 16204:if(0===_)break e;if(H=j-_,n.offset>H){if(H=n.offset-H,H>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=E;break}H>n.wnext?(H-=n.wnext,z=n.wsize-H):z=n.wnext-H,H>n.length&&(H=n.length),q=n.window}else q=k,z=O-n.offset,H=n.length;H>_&&(H=_),_-=H,n.length-=H;do{k[O++]=q[z++]}while(--H);0===n.length&&(n.mode=S);break;case 16205:if(0===_)break e;k[O++]=n.length,_--,n.mode=S;break;case C:if(n.wrap){for(;B<32;){if(0===R)break e;R--,N|=P[L++]<<B,B+=8}if(j-=_,e.total_out+=j,n.total+=j,4&n.wrap&&j&&(e.adler=n.check=n.flags?o(n.check,k,j,O-j):r(n.check,k,j,O-j)),j=_,4&n.wrap&&(n.flags?N:M(N))!==n.check){e.msg="incorrect data check",n.mode=E;break}N=0,B=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;B<32;){if(0===R)break e;R--,N+=P[L++]<<B,B+=8}if(4&n.wrap&&N!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=E;break}N=0,B=0}n.mode=16208;case 16208:J=d;break e;case E:J=p;break e;case A:return m;default:return h}return e.next_out=O,e.avail_out=_,e.next_in=L,e.avail_in=R,n.hold=N,n.bits=B,(n.wsize||j!==e.avail_out&&n.mode<E&&(n.mode<C||t!==s))&&V(e,e.output,e.next_out,j-e.avail_out)?(n.mode=A,m):(F-=e.avail_in,j-=e.avail_out,e.total_in+=F,e.total_out+=j,n.total+=j,4&n.wrap&&j&&(e.adler=n.check=n.flags?o(n.check,k,j,e.next_out-j):r(n.check,k,j,e.next_out-j)),e.data_type=n.bits+(n.last?64:0)+(n.mode===x?128:0)+(n.mode===I||n.mode===T?256:0),(0===F&&0===j||t===s)&&J===u&&(J=g),J)},e.exports.inflateEnd=e=>{if(D(e))return h;let t=e.state;return t.window&&(t.window=null),e.state=null,u},e.exports.inflateGetHeader=(e,t)=>{if(D(e))return h;const n=e.state;return 0==(2&n.wrap)?h:(n.head=t,t.done=!1,u)},e.exports.inflateSetDictionary=(e,t)=>{const n=t.length;let o,a,i;return D(e)?h:(o=e.state,0!==o.wrap&&o.mode!==b?h:o.mode===b&&(a=1,a=r(a,t,n,0),a!==o.check)?p:(i=V(e,t,n,n),i?(o.mode=A,m):(o.havedict=1,u)))},e.exports.inflateInfo="pako inflate (from Nodeca project)"},446:e=>{const t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),r=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),o=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,a,i,s,l,c,u,d)=>{const f=d.bits;let h,p,m,g,v,y,b=0,x=0,w=0,T=0,I=0,S=0,C=0,E=0,A=0,M=0,P=null;const D=new Uint16Array(16),k=new Uint16Array(16);let L,O,R,_=null;for(b=0;b<=15;b++)D[b]=0;for(x=0;x<s;x++)D[a[i+x]]++;for(I=f,T=15;T>=1&&0===D[T];T--);if(I>T&&(I=T),0===T)return l[c++]=20971520,l[c++]=20971520,d.bits=1,0;for(w=1;w<T&&0===D[w];w++);for(I<w&&(I=w),E=1,b=1;b<=15;b++)if(E<<=1,E-=D[b],E<0)return-1;if(E>0&&(0===e||1!==T))return-1;for(k[1]=0,b=1;b<15;b++)k[b+1]=k[b]+D[b];for(x=0;x<s;x++)0!==a[i+x]&&(u[k[a[i+x]]++]=x);if(0===e?(P=_=u,y=20):1===e?(P=t,_=n,y=257):(P=r,_=o,y=0),M=0,x=0,b=w,v=c,S=I,C=0,m=-1,A=1<<I,g=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){L=b-C,u[x]+1<y?(O=0,R=u[x]):u[x]>=y?(O=_[u[x]-y],R=P[u[x]-y]):(O=96,R=0),h=1<<b-C,p=1<<S,w=p;do{p-=h,l[v+(M>>C)+p]=L<<24|O<<16|R|0}while(0!==p);for(h=1<<b-1;M&h;)h>>=1;if(0!==h?(M&=h-1,M+=h):M=0,x++,0==--D[b]){if(b===T)break;b=a[i+u[x]]}if(b>I&&(M&g)!==m){for(0===C&&(C=I),v+=w,S=b-C,E=1<<S;S+C<T&&(E-=D[S+C],!(E<=0));)S++,E<<=1;if(A+=1<<S,1===e&&A>852||2===e&&A>592)return 1;m=M&g,l[m]=I<<24|S<<16|v-c|0}}return 0!==M&&(l[v+M]=b-C<<24|64<<16|0),d.bits=I,0}},604:e=>{e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},249:e=>{e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&!e;)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})();var r={};return(()=>{function e(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");const r=e.length/3;let o=0,a=0;if(n)for(let n=0;n<r;n++)t[a++]=e[o++],t[a++]=e[o++],t[a++]=e[o++],t[a++]=255;else t.set(e)}function t(e,t,n){if(void 0===e)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");const r=e.length/3;let o=0,a=0,i=r,s=2*r;if(n)for(let n=0;n<r;n++)t[o++]=e[a++],t[o++]=e[i++],t[o++]=e[s++],t[o++]=255;else for(let n=0;n<r;n++)t[o++]=e[a++],t[o++]=e[i++],t[o++]=e[s++]}function o(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const r=e.length/3;let o=0,a=0;if(n)for(let n=0;n<r;n++){const n=e[o++],r=e[o++],i=e[o++];t[a++]=n+1.402*(i-128),t[a++]=n-.34414*(r-128)-.71414*(i-128),t[a++]=n+1.772*(r-128),t[a++]=255}else for(let n=0;n<r;n++){const n=e[o++],r=e[o++],i=e[o++];t[a++]=n+1.402*(i-128),t[a++]=n-.34414*(r-128)-.71414*(i-128),t[a++]=n+1.772*(r-128)}}function a(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const r=e.length/3;let o=0,a=0,i=r,s=2*r;if(n)for(let n=0;n<r;n++){const n=e[a++],r=e[i++],l=e[s++];t[o++]=n+1.402*(l-128),t[o++]=n-.34414*(r-128)-.71414*(l-128),t[o++]=n+1.772*(r-128),t[o++]=255}else for(let n=0;n<r;n++){const n=e[a++],r=e[i++],l=e[s++];t[o++]=n+1.402*(l-128),t[o++]=n-.34414*(r-128)-.71414*(l-128),t[o++]=n+1.772*(r-128)}}n.r(r),n.d(r,{configure:()=>Je,convertColorSpace:()=>U,convertPALETTECOLOR:()=>Ke,convertRGBColorByPixel:()=>e,convertRGBColorByPlane:()=>t,convertYBRFullByPixel:()=>o,convertYBRFullByPlane:()=>a,createImage:()=>se,decodeImageFrame:()=>te,decodeJPEGBaseline8BitColor:()=>V,default:()=>et,external:()=>Xe,getImageFrame:()=>ne,getMinMax:()=>N,getPixelData:()=>_,internal:()=>O,isColorImage:()=>re,isJPEGBaseline8BitColor:()=>$e,wadors:()=>ce,wadouri:()=>qe,webWorkerManager:()=>J});const i=function(e,t,n){return t=t||0,e&&e.Value?e.Value.length<=t?n:e.Value[t]:n},s=function(e,t){const n=i(e,t);if(void 0!==n)return parseFloat(n)},l=function(e,t){if(!e)return;if(!e.Value)return;if(!Array.isArray(e.Value))return;if(t&&e.Value.length<t)return;const n=[];for(let t=0;t<e.Value.length;t++)n.push(parseFloat(e.Value[t]));return n};function c(e){const t=e.indexOf(":");return e.substring(t+1)}function u(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&e.Value?e.Value[0]&&t?e.Value[0]:e.Value:e}function d(e,t,n){return{shared:(t?Object.values(t[0]):[]).map((e=>e[0])).filter((e=>void 0!==e&&"object"==typeof e)),perFrame:(e?Object.values(e[n-1]):[]).map((e=>e.Value[0])).filter((e=>void 0!==e&&"object"==typeof e))}}function f(e){let{52009230:t,52009229:n,"00280008":r,...o}=e;return t=u(t,!1),n=u(n,!1),r=u(r),{PerFrameFunctionalGroupsSequence:t,SharedFunctionalGroupsSequence:n,NumberOfFrames:r,rest:o}}function h(e){const t=e.indexOf("/frames/")+8,n=e.slice(0,t),r=parseInt(e.slice(t),10);return{metadata:m[`${n}1`],frame:r}}const p={_retrieveMultiframeMetadata:h,retrieveMultiframeMetadata:function(e){return h(c(e))},isMultiframe:function(e){const t=i(e["00280008"]);return t&&t>1}};let m=[],g={};const v={add:function(e,t){const n=c(e);t.isMultiframe=p.isMultiframe(t),m[n]=t},get:function(e){const t=c(e),n=m[t];if(n&&!n?.isMultiframe)return n;const r=g[t];if(r)return r;const o=p._retrieveMultiframeMetadata(t);if(!o||!o.metadata)return;const{metadata:a,frame:i}=o;if(a){const e=function(e,t){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:r,NumberOfFrames:o,rest:a}=f(t);if(n||o>1){const{shared:i,perFrame:s}=d(n,r,e),l=Object.assign(t,{frameNumber:e});return[...i,...s].forEach((e=>{Object.entries(e).forEach((e=>{let[t,n]=e;l[t]=n}))})),Object.assign(a,{"00280008":o},l)}return t}(i,a);return g[t]=e,e}},remove:function(e){const t=c(e);m[t]=void 0,g[t]=void 0},purge:function(){m=[],g={}}};function y(e){return"RECON TOMO"===e||"RECON GATED TOMO"===e}function b(e){return i(e["00080060"]).includes("NM")}function x(e,t){const n=u(e["00080008"],!1);if(n)return n[t]}function w(e){let t=l(e["00200037"],6);return!t&&b(e)&&(t=function(e){let t;const n=x(e,2);if(n&&y(n)){const n=u(e["00540022"]);n&&(t=l(n["00200037"],6))}return t}(e)),t}function T(e){let t=l(e["00200032"],3);return!t&&b(e)&&(t=function(e){let t;const n=x(e,2);if(n&&y(n)){const n=u(e["00540022"]);n&&(t=l(n["00200032"],3))}return t}(e)),t}function I(e,t,n){const r={};for(const o of n)try{const n=t(o,e);if(n){const e={};for(const t in n)t in n&&(e[S(t)]=n[t]);Object.assign(r,e)}}catch(e){console.error(`Error retrieving ${o} data:`,e)}return r}const S=e=>e.charAt(0).toUpperCase()+e.slice(1),C=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"],E=function e(t,n){if("multiframeModule"===t){const{metadata:e,frame:t}=p.retrieveMultiframeMetadata(n);if(!e)return;const{PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:o,NumberOfFrames:a}=f(e);if(r||a>1){const{shared:e,perFrame:n}=d(r,o,t);return{NumberOfFrames:a,PerFrameFunctionalInformation:n,SharedFunctionalInformation:e}}return{NumberOfFrames:a}}const{dicomParser:r}=Xe,o=v.get(n);if(o){if("generalSeriesModule"===t)return{modality:i(o["00080060"]),seriesInstanceUID:i(o["0020000E"]),seriesNumber:s(o["00200011"]),studyInstanceUID:i(o["0020000D"]),seriesDate:r.parseDA(i(o["00080021"])),seriesTime:r.parseTM(i(o["00080031"],0,"")),acquisitionDate:r.parseDA(i(o["00080022"]),""),acquisitionTime:r.parseTM(i(o["00080032"],0,""))};if("patientStudyModule"===t)return{patientAge:s(o["00101010"]),patientSize:s(o["00101020"]),patientSex:i(o["00100040"]),patientWeight:s(o["00101030"])};if("nmMultiframeGeometryModule"===t){const e=i(o["00080060"]),t=x(o,2);return{modality:e,imageType:i(o["00080008"]),imageSubType:t,imageOrientationPatient:w(o),imagePositionPatient:T(o),sliceThickness:s(o["00180050"]),pixelSpacing:l(o["00280030"],2),numberOfFrames:s(o["00280008"]),isNMReconstructable:y(t)&&e.includes("NM")}}if("imagePlaneModule"===t){const e=w(o),t=T(o),n=l(o["00280030"],2);let r=null,a=null;n&&(a=n[0],r=n[1]);let c=null,u=null;return e&&(c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])],u=[parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[5])]),{frameOfReferenceUID:i(o["00200052"]),rows:s(o["00280010"]),columns:s(o["00280011"]),imageOrientationPatient:e,rowCosines:c,columnCosines:u,imagePositionPatient:t,sliceThickness:s(o["00180050"]),sliceLocation:s(o["00201041"]),pixelSpacing:n,rowPixelSpacing:a,columnPixelSpacing:r}}if("imagePixelModule"===t)return{samplesPerPixel:s(o["00280002"]),photometricInterpretation:i(o["00280004"]),rows:s(o["00280010"]),columns:s(o["00280011"]),bitsAllocated:s(o["00280100"]),bitsStored:s(o["00280101"]),highBit:i(o["00280102"]),pixelRepresentation:s(o["00280103"]),planarConfiguration:s(o["00280006"]),pixelAspectRatio:i(o["00280034"]),smallestPixelValue:s(o["00280106"]),largestPixelValue:s(o["00280107"]),redPaletteColorLookupTableDescriptor:l(o["00281101"]),greenPaletteColorLookupTableDescriptor:l(o["00281102"]),bluePaletteColorLookupTableDescriptor:l(o["00281103"]),redPaletteColorLookupTableData:l(o["00281201"]),greenPaletteColorLookupTableData:l(o["00281202"]),bluePaletteColorLookupTableData:l(o["00281203"])};if("voiLutModule"===t)return{windowCenter:l(o["00281050"],1),windowWidth:l(o["00281051"],1)};if("modalityLutModule"===t)return{rescaleIntercept:s(o["00281052"]),rescaleSlope:s(o["00281053"]),rescaleType:i(o["00281054"])};if("sopCommonModule"===t)return{sopClassUID:i(o["00080016"]),sopInstanceUID:i(o["00080018"])};if("petIsotopeModule"===t){const e=i(o["00540016"]);if(void 0===e)return;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:r.parseTM(i(e["00181072"],0,"")),radiopharmaceuticalStartDateTime:i(e["00181078"],0,""),radionuclideTotalDose:s(e["00181074"]),radionuclideHalfLife:s(e["00181075"])}}}return"overlayPlaneModule"===t?function(e){const t=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;4===r.length&&(r=`x600${n.toString(16)}`);const o=i(e[`${r}3000`]);if(!o)continue;const a=[];for(let t=0;t<o.length;t++)for(let n=0;n<8;n++){const r=e.Value[o.dataOffset+t];a[8*t+n]=r>>n&1}t.push({rows:s(e[`${r}0010`]),columns:s(e[`${r}0011`]),type:i(e[`${r}0040`]),x:s(e[`${r}0050`],1)-1,y:s(e[`${r}0050`],0)-1,pixelData:a,description:i(e[`${r}0022`]),label:i(e[`${r}1500`]),roiArea:i(e[`${r}1301`]),roiMean:i(e[`${r}1302`]),roiStandardDeviation:i(e[`${r}1303`])})}return{overlays:t}}(o):"transferSyntax"===t?{transferSyntaxUID:i(o["00020010"])}:"petSeriesModule"===t?{correctedImage:i(o["00280051"]),units:i(o["00541001"]),decayCorrection:i(o["00541102"])}:"petImageModule"===t?{frameReferenceTime:s(o["00541300"]),actualFrameDuration:s(o["00181242"])}:"instance"===t?I(n,e,C):void 0}};function A(e,t,n){if(n+e.length>t.length)return!1;let r=n;for(let n=0;n<e.length;n++)if(e[n]!==t[r++])return!1;return!0}const M=function(e,t,n){n=n||0;const r=function(e){const t=new Uint8Array(e.length);for(let n=0,r=e.length;n<r;n++)t[n]=e.charCodeAt(n);return t}(t);for(let t=n;t<e.length;t++)if(r[0]===e[t]&&A(r,e,t))return t;return-1};let P={open(e,t){e.open("get",t,!0)},beforeSend(){},beforeProcessing:e=>Promise.resolve(e.response),imageCreated(){},strict:!1,decodeConfig:{convertFloatPixelDataToInt:!0,use16BitDataType:!1}};function D(e){P=Object.assign(P,e)}function k(){return P}const L=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{cornerstone:o}=Xe,a=k(),i=e=>{if("function"==typeof a.errorInterceptor){const t=new Error("request failed");t.request=e,t.response=e.response,t.status=e.status,a.errorInterceptor(t)}},s=new XMLHttpRequest,l=new Promise(((l,c)=>{a.open(s,e,n,r);const u=a.beforeSend(s,t,n,r);s.responseType="arraybuffer";const d=Object.assign({},n,u);Object.keys(d).forEach((function(t){null!==d[t]&&("Accept"===t&&-1!==e.indexOf("accept=")||s.setRequestHeader(t,d[t]))})),r.deferred={resolve:l,reject:c},r.url=e,r.imageId=t,s.onloadstart=function(n){a.onloadstart&&a.onloadstart(n,r);const i={url:e,imageId:t};o.triggerEvent(o.events,"cornerstoneimageloadstart",i)},s.onloadend=function(n){a.onloadend&&a.onloadend(n,r);const i={url:e,imageId:t};o.triggerEvent(o.events,"cornerstoneimageloadend",i)},s.onreadystatechange=function(e){a.onreadystatechange?a.onreadystatechange(e,r):4===s.readyState&&(200===s.status?a.beforeProcessing(s).then(l).catch((()=>{i(s),c(s)})):(i(s),c(s)))},s.onprogress=function(n){const i=n.loaded;let s,l;n.lengthComputable&&(s=n.total,l=Math.round(i/s*100)),a.onprogress&&a.onprogress(n,r);const c={url:e,imageId:t,loaded:i,total:s,percentComplete:l};o.triggerEvent(o.events,o.EVENTS.IMAGE_LOAD_PROGRESS,c)},s.onerror=function(){i(s),c(s)},s.onabort=function(){i(s),c(s)},s.send()}));return l.xhr=s,l},O={xhrRequest:L,setOptions:D,getOptions:k};function R(e){for(let t=0;t<e.length;t++)if("Content-Type:"===e[t].substr(0,13))return e[t].substr(13).trim()}const _=function(e,t){const n={Accept:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/octet-stream"};return new Promise(((r,o)=>{const a=L(e,t,n),{xhr:i}=a;a.then((function(e){const t=new Uint8Array(e),n=i.getResponseHeader("Content-Type")||"application/octet-stream";if(-1===n.indexOf("multipart"))return void r({contentType:n,imageFrame:{pixelData:t}});const a=M(t,"\r\n\r\n");-1===a&&o(new Error("invalid response - no multipart mime header"));const s=function(e,t,n){t=t||0,n=n||e.length-t;let r="";for(let o=t;o<t+n;o++)r+=String.fromCharCode(e[o]);return r}(t,0,a),l=s.split("\r\n"),c=function(e){for(let t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}(l);c||o(new Error("invalid response - no boundary marker"));const u=a+4,d=M(t,c,u);-1===d&&o(new Error("invalid response - terminating boundary not found"));const f=d-u-2;r({contentType:R(l),imageFrame:{pixelData:new Uint8Array(e,u,f)}})}),o)}))},N=function(e){let t,n=e[0],r=e[0];const o=e.length;for(let a=1;a<o;a++)t=e[a],n=Math.min(n,t),r=Math.max(r,t);return{min:n,max:r}};function B(n,r,o){0===n.planarConfiguration?e(n.pixelData,r,o):t(n.pixelData,r,o)}function U(e,t,n){if("RGB"===e.photometricInterpretation)B(e,t,n);else if("YBR_RCT"===e.photometricInterpretation)B(e,t,n);else if("YBR_ICT"===e.photometricInterpretation)B(e,t,n);else if("PALETTE COLOR"===e.photometricInterpretation)Ke(e,t,n);else if("YBR_FULL_422"===e.photometricInterpretation)!function(e,t,n){if(void 0===e)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(e.length%2!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");const r=e.length/2;let o=0,a=0;if(n)for(let n=0;n<r;n+=2){const n=e[o++],r=e[o++],i=e[o++],s=e[o++];t[a++]=n+1.402*(s-128),t[a++]=n-.34414*(i-128)-.71414*(s-128),t[a++]=n+1.772*(i-128),t[a++]=255,t[a++]=r+1.402*(s-128),t[a++]=r-.34414*(i-128)-.71414*(s-128),t[a++]=r+1.772*(i-128),t[a++]=255}else for(let n=0;n<r;n+=2){const n=e[o++],r=e[o++],i=e[o++],s=e[o++];t[a++]=n+1.402*(s-128),t[a++]=n-.34414*(i-128)-.71414*(s-128),t[a++]=n+1.772*(i-128),t[a++]=r+1.402*(s-128),t[a++]=r-.34414*(i-128)-.71414*(s-128),t[a++]=r+1.772*(i-128)}}(e.pixelData,t,n);else{if("YBR_FULL"!==e.photometricInterpretation)throw new Error(`No color space conversion for photometric interpretation ${e.photometricInterpretation}`);!function(e,t,n){0===e.planarConfiguration?o(e.pixelData,t,n):a(e.pixelData,t,n)}(e,t,n)}}const V=function(e,t,n){const r=(new Date).getTime(),o=new Blob([t],{type:"image/jpeg"});return new Promise(((t,a)=>{const i=new FileReader;void 0===i.readAsBinaryString?i.readAsArrayBuffer(o):i.readAsBinaryString(o),i.onload=function(){const o=new Image;o.onload=function(){n.height=o.height,n.width=o.width,e.rows=o.height,e.columns=o.width;const a=n.getContext("2d");a.drawImage(this,0,0);const i=a.getImageData(0,0,o.width,o.height),s=(new Date).getTime();e.pixelData=new Uint8Array(i.data.buffer),e.imageData=i,e.decodeTimeInMS=s-r;const l=N(e.pixelData);e.smallestPixelValue=l.min,e.largestPixelValue=l.max,e.pixelDataLength=e.pixelData.length,t(e)},o.onerror=function(e){a(e)},void 0===i.readAsBinaryString?o.src=`data:image/jpeg;base64,${window.btoa(function(e){return function(e){let t;try{return decodeURIComponent(escape(e))}catch(n){if(t=n,t instanceof URIError)return e;throw t}}(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}(i.result))}`:o.src=`data:image/jpeg;base64,${window.btoa(i.result)}`},i.onerror=e=>{a(e)}}))};function F(){return new Worker(n.p+"index.worker.e62ecca63f1a2e124230.worker.js")}let j=0;const H=[],z=[],q=k(),W={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!1,strict:q.strict}}};let G;const Y={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};function Z(){if(H.length){for(let e=0;e<z.length;e++)if("ready"===z[e].status){z[e].status="busy";const t=H.shift();t.start=(new Date).getTime();const n=(new Date).getTime();return Y.totalTimeDelayedInMS+=n-t.added,z[e].task=t,z[e].worker.postMessage({taskType:t.taskType,workerIndex:e,data:t.data},t.transferList),void Y.numTasksExecuting++}z.length<G.maxWebWorkers&&Q()}}function X(e){if("initialize"===e.data.taskType)z[e.data.workerIndex].status="ready",Z();else{const t=z[e.data.workerIndex].task.start,n="success"===e.data.status?"resolve":"reject";try{z[e.data.workerIndex].task.deferred[n](e.data.result)}catch(e){console.warn("Caught error delivering response",e)}z[e.data.workerIndex].task=void 0,Y.numTasksExecuting--,z[e.data.workerIndex].status="ready",Y.numTasksCompleted++;const r=(new Date).getTime();Y.totalTaskTimeInMS+=r-t,Z()}}function Q(){if(z.length>=G.maxWebWorkers)return;const e=new F;z.push({worker:e,status:"initializing"}),e.addEventListener("message",X),e.postMessage({taskType:"initialize",workerIndex:z.length-1,config:G})}function K(e){if(G=e=e||W,G.maxWebWorkers=G.maxWebWorkers||navigator.hardwareConcurrency||1,!G.startWebWorkersOnDemand)for(let e=0;e<G.maxWebWorkers;e++)Q()}const J={initialize:K,loadWebWorkerTask:function(e,t){G.webWorkerTaskPaths.push(e),t&&(G.taskConfiguration=Object.assign(G.taskConfiguration,t));for(let t=0;t<z.length;t++)z[t].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:z.length-1,sourcePath:e,config:G})},addTask:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;G||K();let o={resolve:void 0,reject:void 0};const a=new Promise(((e,t)=>{o={resolve:e,reject:t}}));let i;for(i=0;i<H.length&&!(H[i].priority<n);i++);const s=j++;return H.splice(i,0,{taskId:s,taskType:e,status:"ready",added:(new Date).getTime(),data:t,deferred:o,priority:n,transferList:r}),Z(),{taskId:s,promise:a}},getStatistics:function(){return Y.maxWebWorkers=G.maxWebWorkers,Y.numWebWorkers=z.length,Y.numTasksQueued=H.length,Y},setTaskPriority:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<H.length;n++)if(H[n].taskId===e){const e=H.splice(n,1)[0];for(e.priority=t,n=0;n<H.length&&!(H[n].priority<t);n++);return H.splice(n,0,e),!0}return!1},cancelTask:function(e,t){for(let n=0;n<H.length;n++)if(H[n].taskId===e)return H.splice(n,1).deferred.reject(t),!0;return!1},webWorkers:z,terminate:function(){for(let e=0;e<z.length;e++)z[e].worker.terminate();z.length=0,G=void 0}};var $=n(578);function ee(e,t,n,r,o){const a=r.priority||void 0,i=r.transferPixelData?[n.buffer]:void 0;return J.addTask("decodeTask",{imageFrame:e,transferSyntax:t,pixelData:n,options:r,decodeConfig:o},a,i).promise}window.pako={inflateRaw:$.Hq};const te=function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0;switch(t){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":case"1.2.840.10008.1.2.2":case"1.2.840.10008.1.2.1.99":case"1.2.840.10008.1.2.5":case"1.2.840.10008.1.2.4.51":case"1.2.840.10008.1.2.4.57":case"1.2.840.10008.1.2.4.70":case"1.2.840.10008.1.2.4.80":case"1.2.840.10008.1.2.4.81":case"1.2.840.10008.1.2.4.90":case"1.2.840.10008.1.2.4.91":case"3.2.840.10008.1.2.4.96":return ee(e,t,n,o,a);case"1.2.840.10008.1.2.4.50":return 8!==e.bitsAllocated||3!==e.samplesPerPixel&&4!==e.samplesPerPixel?ee(e,t,n,o,a):V(e,n,r)}return Promise.reject(new Error(`No decoder for transfer syntax ${t}`))},ne=function(e){const{cornerstone:t}=Xe,n=t.metaData.get("imagePixelModule",e);return{samplesPerPixel:n.samplesPerPixel,photometricInterpretation:n.photometricInterpretation,planarConfiguration:n.planarConfiguration,rows:n.rows,columns:n.columns,bitsAllocated:n.bitsAllocated,bitsStored:n.bitsStored,pixelRepresentation:n.pixelRepresentation,smallestPixelValue:n.smallestPixelValue,largestPixelValue:n.largestPixelValue,redPaletteColorLookupTableDescriptor:n.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:n.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:n.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:n.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:n.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:n.bluePaletteColorLookupTableData,pixelData:void 0,imageId:e}};function re(e){return"RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e}const oe={"1.2.840.10008.1.2.1":"application/octet-stream","1.2.840.10008.1.2":"application/octet-stream","1.2.840.10008.1.2.2":"application/octet-stream","1.2.840.10008.1.2.5":"image/dicom-rle"};let ae="";function ie(e){const t=function(e,t){let n;return Number.isInteger(e)&&Number.isInteger(t)?e>=0?t<=255?n=Uint8Array:t<=65535&&(n=Uint16Array):e>=-128&&t<=127?n=Int8Array:e>=-32768&&t<=32767&&(n=Int16Array):n=Float32Array,n}(e.smallestPixelValue,e.largestPixelValue);if(!t)throw new Error("Could not apply a typed array to the pixel data");{const n=new t(e.pixelData);e.pixelData=n}}const se=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=r.useRGBA;if(r.preScale={enabled:!(!r.preScale||void 0===r.preScale.enabled)&&r.preScale.enabled},!t||!t.length)return Promise.reject(new Error("The file does not contain image data."));const{cornerstone:a}=Xe,i=document.createElement("canvas"),s=ne(e);if(r.preScale.enabled){const t=function(e,t){const n=e.get("modalityLutModule",t)||{},r=e.get("generalSeriesModule",t)||{},{modality:o}=r,a={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:o},i=e.get("scalingModule",t)||{};return{...a,..."PT"===o&&{suvbw:i.suvbw}}}(a.metaData,e);t&&(r.preScale={...r.preScale,scalingParameters:t})}r.isSharedArrayBuffer=r.targetBuffer?.arrayBuffer&&r.targetBuffer.arrayBuffer instanceof SharedArrayBuffer;const{decodeConfig:l}=k(),c=te(s,n,t,i,r,l),{use16BitDataType:u}=l,d=re(s.photometricInterpretation);return new Promise(((t,s)=>{c.then((function(s){if(r.skipCreateImage)return t(s);let l=!1;if(r.targetBuffer&&r.targetBuffer.type&&!d){const{arrayBuffer:e,type:t,offset:n=0,length:o}=r.targetBuffer,a=s.pixelDataLength,i=n,c=null!=o?o:a-i,d={Uint8Array,Uint16Array:u?Uint16Array:void 0,Int16Array:u?Int16Array:void 0,Float32Array};if(c!==s.pixelDataLength)throw new Error(`target array for image does not have the same length (${c}) as the decoded image length (${s.pixelDataLength}).`);const f=d[t],h=e?new f(e,i,c):new f(s.pixelData);if(c!==s.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");s.pixelData=h,l=!0}l||ie(s);const c=a.metaData.get("imagePlaneModule",e)||{},f=a.metaData.get("voiLutModule",e)||{},h=a.metaData.get("modalityLutModule",e)||{},p=a.metaData.get("sopCommonModule",e)||{};if(d){const{rows:e,columns:t}=s;if(oe[n]){i.height=s.rows,i.width=s.columns;const e=i.getContext("2d").createImageData(s.columns,s.rows);U(s,e.data,o),s.imageData=e,s.pixelData=e.data,s.pixelDataLength=e.data.length}else if(!o&&s.pixelDataLength===4*e*t){const e=new Uint8Array(s.pixelData.length/4*3);s.pixelData=function(e,t){const n=e.length/4;let r=0,o=0;for(let a=0;a<n;a++)t[o++]=e[r++],t[o++]=e[r++],t[o++]=e[r++],r++;return t}(s.pixelData,e),s.pixelDataLength=s.pixelData.length}const r=N(s.pixelData);s.smallestPixelValue=r.min,s.largestPixelValue=r.max}const m={imageId:e,color:d,columnPixelSpacing:c.columnPixelSpacing,columns:s.columns,height:s.rows,preScale:s.preScale,intercept:h.rescaleIntercept?h.rescaleIntercept:0,slope:h.rescaleSlope?h.rescaleSlope:1,invert:"MONOCHROME1"===s.photometricInterpretation,minPixelValue:s.smallestPixelValue,maxPixelValue:s.largestPixelValue,rowPixelSpacing:c.rowPixelSpacing,rows:s.rows,sizeInBytes:s.pixelData.byteLength,width:s.columns,windowCenter:f.windowCenter?f.windowCenter[0]:void 0,windowWidth:f.windowWidth?f.windowWidth[0]:void 0,voiLUTFunction:f.voiLUTFunction?f.voiLUTFunction:void 0,decodeTimeInMS:s.decodeTimeInMS,floatPixelData:void 0,imageFrame:s,rgba:d&&o,getPixelData:()=>s.pixelData,getCanvas:void 0,numComps:void 0};var g;if(window.image=m,m.color&&(m.getCanvas=function(){if(ae===e)return i;const t=m.columns,n=m.rows;i.height=n,i.width=t;const r=i.getContext("2d"),o=r.createImageData(t,n),a=s.pixelData;if(a.length===t*n*4)for(let e=0;e<a.length;e++)o.data[e]=a[e];else if(a.length===t*n*3){let e=0;for(let t=0;t<a.length;t+=3)o.data[e++]=a[t],o.data[e++]=a[t+1],o.data[e++]=a[t+2],o.data[e++]=255}return s.pixelData=o.data,s.pixelDataLength=o.data.length,s.imageData=o,r.putImageData(s.imageData,0,0),ae=e,i}),h.modalityLUTSequence&&h.modalityLUTSequence.length>0&&"1.2.840.10008.5.1.4.1.1.12.1"!==(g=p.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==g&&(m.modalityLUT=h.modalityLUTSequence[0]),f.voiLUTSequence&&f.voiLUTSequence.length>0&&(m.voiLUT=f.voiLUTSequence[0]),m.color&&(m.windowWidth=256,m.windowCenter=128),void 0===m.windowCenter||void 0===m.windowWidth){const e=m.imageFrame.minAfterScale,t=m.imageFrame.maxAfterScale;m.windowWidth=t-e,m.windowCenter=(t+e)/2}t(m)}),s)}))},le=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Xe.cornerstone.imageRetrievalPoolManager,r=(new Date).getTime();return{promise:new Promise(((o,a)=>{const i=t.requestType||"interaction",s=t.additionalDetails||{imageId:e},l=void 0===t.priority?5:t.priority,c=t.addToBeginning||!1,u=e.substring(7);n.addRequest(function(e,n,i){return _(e,n,i).then((e=>{const i=function(e){const t="1.2.840.10008.1.2";if(!e)return t;const n=e.split(";"),r={};n.forEach((e=>{const t=e.split("=");if(2!==t.length)return;const n=t[1].trim().replace(/"/g,"");r[t[0].trim()]=n}));const o={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return r["transfer-syntax"]?r["transfer-syntax"]:e&&!Object.keys(r).length&&o[e]?o[e]:r.type&&o[r.type]?o[r.type]:o[e]?o[e]:t}(e.contentType),s=e.imageFrame.pixelData;se(n,s,i,t).then((e=>{const t=(new Date).getTime();e.loadTimeInMS=t-r,o(e)}),a)}),a).catch((e=>{a(e)}))}.bind(this,u,e,"multipart/related; type=application/octet-stream; transfer-syntax=*"),i,s,l,c)})),cancelFn:void 0}},ce={metaData:{getNumberString:function(e,t,n){const r=i(e,t,n);if(void 0!==r)return parseFloat(r)},getNumberValue:s,getNumberValues:l,getValue:i,metaDataProvider:E},findIndexOfString:M,getPixelData:_,loadImage:le,metaDataManager:v,register:function(e){e.registerImageLoader("wadors",le),e.metaData.addProvider(E)}};function ue(e,t){if(e.elements[t]&&6===e.elements[t].length)return[e.uint16(t,0),e.uint16(t,1),e.uint16(t,2)]}function de(e,t,n){const r=[],o=e.elements[t];for(let a=0;a<n[0];a++)16===n[2]?r[a]=e.uint16(t,a):r[a]=e.byteArray[a+o.dataOffset];return r}const fe=function(e){const t={samplesPerPixel:e.uint16("x00280002"),photometricInterpretation:e.string("x00280004"),rows:e.uint16("x00280010"),columns:e.uint16("x00280011"),bitsAllocated:e.uint16("x00280100"),bitsStored:e.uint16("x00280101"),highBit:e.uint16("x00280102"),pixelRepresentation:e.uint16("x00280103"),planarConfiguration:e.uint16("x00280006"),pixelAspectRatio:e.string("x00280034")};return function(e,t){0===e.uint16("x00280103")?(t.smallestPixelValue=e.uint16("x00280106"),t.largestPixelValue=e.uint16("x00280107")):(t.smallestPixelValue=e.int16("x00280106"),t.largestPixelValue=e.int16("x00280107"))}(e,t),"PALETTE COLOR"===t.photometricInterpretation&&e.elements.x00281101&&function(e,t){t.redPaletteColorLookupTableDescriptor=ue(e,"x00281101"),t.greenPaletteColorLookupTableDescriptor=ue(e,"x00281102"),t.bluePaletteColorLookupTableDescriptor=ue(e,"x00281103"),0===t.redPaletteColorLookupTableDescriptor[0]&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);const n=t.redPaletteColorLookupTableDescriptor[0],r=e.elements.x00281201.length===n?8:16;t.redPaletteColorLookupTableDescriptor[2]!==r&&(t.redPaletteColorLookupTableDescriptor[2]=r,t.greenPaletteColorLookupTableDescriptor[2]=r,t.bluePaletteColorLookupTableDescriptor[2]=r),t.redPaletteColorLookupTableData=de(e,"x00281201",t.redPaletteColorLookupTableDescriptor),t.greenPaletteColorLookupTableData=de(e,"x00281202",t.greenPaletteColorLookupTableDescriptor),t.bluePaletteColorLookupTableData=de(e,"x00281203",t.bluePaletteColorLookupTableDescriptor)}(e,t),t};function he(e,t){let n=t.uint16("x00283002",0);0===n&&(n=65535);let r=0;r=0===e?t.uint16("x00283002",1):t.int16("x00283002",1);const o={id:"1",firstValueMapped:r,numBitsPerEntry:t.uint16("x00283002",2),lut:[]};for(let r=0;r<n;r++)o.lut[r]=0===e?t.uint16("x00283006",r):t.int16("x00283006",r);return o}const pe=function(e,t){if(!t||!t.items||!t.items.length)return;const n=[];for(let r=0;r<t.items.length;r++){const o=he(e,t.items[r].dataSet);o&&n.push(o)}return n},me=function(e){const t=e.string("x00080016");if("1.2.840.10008.5.1.4.1.1.2"===t||"1.2.840.10008.5.1.4.1.1.2.1"===t)return 1;const n=e.floatString("x00281052"),r=e.floatString("x00281053");if(void 0!==n&&void 0!==r){const t=function(e){const t=e.uint16("x00280103"),n=e.uint16("x00280101");return 0===t?0:-1<<n-1}(e);return t*r+n<0?1:0}return e.elements.x00283000&&e.elements.x00283000.length>0?0:e.uint16("x00280103")},ge=function(e,t,n){const r=[],o=e.string(t);if(!o)return;const a=o.split("\\");if(!(n&&a.length<n)){for(let e=0;e<a.length;e++)r.push(parseFloat(a[e]));return r}},ve=function(e){const t=e.indexOf(":");let n=e.substring(t+1);const r=n.indexOf("frame=");let o;if(-1!==r){const e=n.substring(r+6);o=parseInt(e,10),n=n.substring(0,r-1)}return{scheme:e.substring(0,t),url:n,frame:o,pixelDataFrame:void 0!==o?o-1:void 0}};async function ye(e,t,n){const r=function(e){const{dicomParser:t}=Xe;let n,r=t.parseDicom(e,{untilTag:"x7fe00010"});r.elements.x7fe00010||console.warn("Pixel data not found!");try{n=t.parseDicom(e)}catch(e){console.error(e),console.log("pixel data dataset:",e.dataSet),n=e.dataSet}return r.elements.x7fe00010=n.elements.x7fe00010,r=function(e){const t=e.elements.x7fe00010.fragments,n=e.byteArray.length;for(const e of t){const{position:t,length:r}=e;r>n-t&&(console.log(`Truncated fragment, changing fragment length from ${e.length} to ${n-t}`),e.length=n-t)}return e}(r),r}(e),{uri:o,imageId:a,fileTotalLength:i}=n;return r.fetchMore=async function(s){const l=Object.assign({uri:o,imageId:a,fetchedLength:e.length,lengthToFetch:i-e.length},s),{fetchedLength:c,lengthToFetch:u}=l,{arrayBuffer:d}=await t(o,a,{byteRange:`${c}-${c+u}`}),f=new Uint8Array(d),h=new Uint8Array(r.byteArray.length+f.length);return h.set(r.byteArray),h.set(f,r.byteArray.length),ye(h,t,n)},r}function be(e,t,n){const r={};(t?Object.values(t.items[0].dataSet.elements):[]).map((e=>r[e.tag]=e));const o={};return(e?Object.values(e.items[n-1].dataSet.elements):[]).map((e=>o[e.tag]=e)),{shared:r,perFrame:o}}function xe(e){if(!e)return;const{elements:t,...n}=e,{x52009230:r,x52009229:o,...a}=t;return{NumberOfFrames:e.intString("x00280008"),PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:o,otherElements:a,otherAttributtes:n}}const we=function(e){const t=function(e){return e.indexOf("&frame=")}(e),n=-1===t?e:e.slice(0,t),r=parseInt(e.slice(t+7),10)||1;let o;return o=Ie[n]?Ie[n].dataSet:void 0,{dataSet:o,frame:r}};let Te=0,Ie={},Se={};function Ce(){return{cacheSizeInBytes:Te,numberOfDataSetsCached:Object.keys(Ie).length}}const Ee={isLoaded:function(e){return void 0!==Ie[e]},load:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L,n=arguments.length>2?arguments[2]:void 0;const{cornerstone:r,dicomParser:o}=Xe;if(Ie[e])return new Promise((t=>{Ie[e].cacheCount++,t(Ie[e].dataSet)}));if(Se[e])return Se[e].cacheCount++,Se[e];const a=t(e,n),i=new Promise(((s,l)=>{a.then((async function(a){const c={isPartialContent:!1,fileTotalLength:null};if(!(a instanceof ArrayBuffer)){if(!a.arrayBuffer)return l(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=a.flags.isPartialContent,c.fileTotalLength=a.flags.fileTotalLength,a=a.arrayBuffer}const u=new Uint8Array(a);let d;try{d=c.isPartialContent?await ye(u,t,{uri:e,imageId:n,fileTotalLength:c.fileTotalLength}):o.parseDicom(u)}catch(e){return l(e)}Ie[e]={dataSet:d,cacheCount:i.cacheCount},Te+=d.byteArray.length,s(d),r.triggerEvent(r.events,"datasetscachechanged",{uri:e,action:"loaded",cacheInfo:Ce()})}),l).then((()=>{delete Se[e]}),(()=>{delete Se[e]}))}));return i.cacheCount=1,Se[e]=i,i},unload:function(e){const{cornerstone:t}=Xe;Ie[e]&&(Ie[e].cacheCount--,0===Ie[e].cacheCount&&(Te-=Ie[e].dataSet.byteArray.length,delete Ie[e],t.triggerEvent(t.events,"datasetscachechanged",{uri:e,action:"unloaded",cacheInfo:Ce()})))},getInfo:Ce,purge:function(){Ie={},Se={},Te=0},get:function(e){let t;if(e.includes("&frame=")){const{frame:n,dataSet:r}=we(e);t=function(e,t){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:o,otherElements:a}=xe(t);if(r||n>1){const{shared:n,perFrame:i}=be(r,o,e),s={elements:{...a,...n,...i}},l=Object.create(t);return Object.assign(l,s)}return t}(n,r)}else Ie[e]&&(t=Ie[e].dataSet);return t},update:function(e,t){const n=Ie[e];n?(Te-=n.dataSet.byteArray.length,n.dataSet=t,Te+=t.byteArray.length,Xe.cornerstone.triggerEvent(Xe.cornerstone.events,"datasetscachechanged",{uri:e,action:"updated",cacheInfo:Ce()})):console.error(`No loaded dataSet for uri ${e}`)}};function Ae(e,t){const n=e.string("x00080008");if(n){const e=n.split("\\");if(e.length>t)return e[t]}}function Me(e){let t=ge(e,"x00200037",6);return!t&&e.elements.x00209116&&(t=ge(e.elements.x00209116.items[0].dataSet,"x00200037",6)),t||(t=function(e){let t;if(e.string("x00080060").includes("NM")){const n=Ae(e,2);n&&y(n)&&e.elements.x00540022&&(t=ge(e.elements.x00540022.items[0].dataSet,"x00200037",6))}return t}(e)),t}function Pe(e){let t=ge(e,"x00200032",3);return!t&&e.elements.x00209113&&(t=ge(e.elements.x00209113.items[0].dataSet,"x00200032",3)),t||(t=function(e){let t;if(e.string("x00080060").includes("NM")){const n=Ae(e,2);n&&y(n)&&e.elements.x00540022&&(t=ge(e.elements.x00540022.items[0].dataSet,"x00200032",3))}return t}(e)),t}function De(e){let t=ge(e,"x00280030",2);return!t&&e.elements.x00289110&&(t=ge(e.elements.x00289110.items[0].dataSet,"x00280030",2)),t}function ke(e){let t;return e.elements.x00180050?t=e.floatString("x00180050"):e.elements.x00289110&&e.elements.x00289110.items.length&&e.elements.x00289110.items[0].dataSet.elements.x00180050&&(t=e.elements.x00289110.items[0].dataSet.floatString("x00180050")),t}const Le=function e(t,n){const{dicomParser:r}=Xe,o=ve(n);if("multiframeModule"===t){const e=we(o.url);if(!e.dataSet)return;const t=function(e,t){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:o}=xe(e);if(r||n>1){const{shared:e,perFrame:a}=be(r,o,t);return{NumberOfFrames:n,PerFrameFunctionalInformation:a,SharedFunctionalInformation:e}}return{NumberOfFrames:n}}(e.dataSet,e.frame);return t}let a=o.url;o.frame&&(a=`${a}&frame=${o.frame}`);const i=Ee.get(a);if(i){if("generalSeriesModule"===t)return{modality:i.string("x00080060"),seriesInstanceUID:i.string("x0020000e"),seriesNumber:i.intString("x00200011"),studyInstanceUID:i.string("x0020000d"),seriesDate:r.parseDA(i.string("x00080021")),seriesTime:r.parseTM(i.string("x00080031")||""),acquisitionDate:r.parseDA(i.string("x00080022")||""),acquisitionTime:r.parseTM(i.string("x00080032")||"")};if("patientStudyModule"===t)return{patientAge:i.intString("x00101010"),patientSize:i.floatString("x00101020"),patientWeight:i.floatString("x00101030")};if("imagePlaneModule"===t){const e=Me(i),t=Pe(i),n=De(i);let r;i.elements.x00200052&&(r=i.string("x00200052"));const o=ke(i);let a;i.elements.x00201041&&(a=i.floatString("x00201041"));let s=null,l=null;n&&(l=n[0],s=n[1]);let c=null,u=null;return e&&(c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])],u=[parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[5])]),{frameOfReferenceUID:r,rows:i.uint16("x00280010"),columns:i.uint16("x00280011"),imageOrientationPatient:e,rowCosines:c,columnCosines:u,imagePositionPatient:t,sliceThickness:o,sliceLocation:a,pixelSpacing:n,rowPixelSpacing:l,columnPixelSpacing:s}}if("nmMultiframeGeometryModule"===t){const e=i.string("x00080060"),t=Ae(i,2);return{modality:e,imageType:i.string("x00080008"),imageSubType:t,imageOrientationPatient:Me(i),imagePositionPatient:Pe(i),sliceThickness:ke(i),pixelSpacing:De(i),numberOfFrames:i.uint16("x00280008"),isNMReconstructable:y(t)&&e.includes("NM")}}if("imagePixelModule"===t)return fe(i);if("modalityLutModule"===t)return{rescaleIntercept:i.floatString("x00281052"),rescaleSlope:i.floatString("x00281053"),rescaleType:i.string("x00281054"),modalityLUTSequence:pe(i.uint16("x00280103"),i.elements.x00283000)};if("voiLutModule"===t){const e=me(i);return{windowCenter:ge(i,"x00281050",1),windowWidth:ge(i,"x00281051",1),voiLUTSequence:pe(e,i.elements.x00283010)}}if("sopCommonModule"===t)return{sopClassUID:i.string("x00080016"),sopInstanceUID:i.string("x00080018")};if("petIsotopeModule"===t){const e=i.elements.x00540016;if(void 0===e)return;const t=e.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:r.parseTM(t.string("x00181072")||""),radionuclideTotalDose:t.floatString("x00181074"),radionuclideHalfLife:t.floatString("x00181075")}}}return"overlayPlaneModule"===t?function(e){const t=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;4===r.length&&(r=`x600${n.toString(16)}`);const o=e.elements[`${r}3000`];if(!o)continue;const a=[];for(let t=0;t<o.length;t++)for(let n=0;n<8;n++){const r=e.byteArray[o.dataOffset+t];a[8*t+n]=r>>n&1}t.push({rows:e.uint16(`${r}0010`),columns:e.uint16(`${r}0011`),type:e.string(`${r}0040`),x:e.int16(`${r}0050`,1)-1,y:e.int16(`${r}0050`,0)-1,pixelData:a,description:e.string(`${r}0022`),label:e.string(`${r}1500`),roiArea:e.string(`${r}1301`),roiMean:e.string(`${r}1302`),roiStandardDeviation:e.string(`${r}1303`)})}return{overlays:t}}(i):"transferSyntax"===t?{transferSyntaxUID:i.string("x00020010")}:"petSeriesModule"===t?{correctedImage:i.string("x00280051"),units:i.string("x00541001"),decayCorrection:i.string("x00541102")}:"petImageModule"===t?{frameReferenceTime:i.floatString(i.string("x00541300")||""),actualFrameDuration:i.intString(i.string("x00181242"))}:"instance"===t?I(n,e,C):void 0}};let Oe=[];const Re={add:function(e){return"dicomfile:"+(Oe.push(e)-1)},get:function(e){return Oe[e]},remove:function(e){Oe[e]=void 0},purge:function(){Oe=[]}};function _e(e,t){const{dicomParser:n}=Xe;if(e.elements.x7fe00010&&e.elements.x7fe00010.basicOffsetTable.length)return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t);if(function(e){return e.intString("x00280008")!==e.elements.x7fe00010.fragments.length}(e)){const r=n.createJPEGBasicOffsetTable(e,e.elements.x7fe00010);return n.readEncapsulatedImageFrame(e,e.elements.x7fe00010,t,r)}return n.readEncapsulatedPixelDataFromFragments(e,e.elements.x7fe00010,t)}function Ne(e,t){return e&1<<t}const Be=function(e,t,n){const r=new Uint8Array(n);for(let o=0;o<n;o++){const n=e[Math.floor(o/8)+t],a=o%8;r[o]=Ne(n,a)?1:0}return r},Ue=function(e,t){const n=e.elements.x7fe00010||e.elements.x7fe00008,r=e.uint16("x00280100"),o=e.uint16("x00280010"),a=e.uint16("x00280011");let i=e.uint16("x00280002");"YBR_FULL_422"===e.string("x00280004")&&(i=2,console.warn("Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.\n      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information."));const s=n.dataOffset,l=o*a*i;let c;if(8===r){if(c=s+t*l,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+l))}if(16===r){if(c=s+t*l*2,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+2*l))}if(1===r){if(c=s+t*l*.125,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return Be(e.byteArray,c,l)}if(32===r){if(c=s+t*l*4,c>=e.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(e.byteArray.buffer.slice(c,c+4*l))}throw new Error("unsupported pixel format")},Ve=function(e){const t=ve(e),n=parseInt(t.url,10),r=Re.get(n);return new Promise(((e,t)=>{const n=new FileReader;n.onload=t=>{const n=t.target.result;e(n)},n.onerror=t,n.readAsArrayBuffer(r)}))},Fe=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=e.elements.x7fe00010||e.elements.x7fe00008;return n?n.encapsulatedPixelData?_e(e,t):Ue(e,t):null};function je(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;const i=(new Date).getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise(((l,c)=>{e.then((e=>{const u=Fe(e,n),d=e.string("x00020010"),f=(new Date).getTime(),h=se(t,u,d,o);!function(e,t){e.decache=function(){const e=ve(t);Ee.unload(e.url)}}(s,t),h.then((t=>{t.data=e,t.sharedCacheKey=r;const n=(new Date).getTime();t.loadTimeInMS=f-i,t.totalTimeInMS=n-i,void 0!==a&&void 0!==a.imageDoneCallback&&a.imageDoneCallback(t),l(t)}),(function(t){c({error:t,dataSet:e})}))}),(function(e){c({error:e})}))})),s}function He(e){return"dicomweb"===e||"wadouri"===e?L:"dicomfile"===e?Ve:void 0}function ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=ve(e);t=Object.assign({},t);let r=t.loader;return void 0===r?r=He(n.scheme):delete t.loader,Ee.isLoaded(n.url)?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;const a=(new Date).getTime();return{promise:new Promise(((i,s)=>{const l=(new Date).getTime();let c;try{const r=Fe(e,n),a=e.string("x00020010");c=se(t,r,a,o)}catch(t){return void s({error:t,dataSet:e})}c.then((t=>{t.data=e,t.sharedCacheKey=r;const n=(new Date).getTime();t.loadTimeInMS=l-a,t.totalTimeInMS=n-a,i(t)}),s)})),cancelFn:void 0}}(Ee.get(n.url,r,e),e,n.pixelDataFrame,n.url,t):je(Ee.load(n.url,r,e),e,n.frame,n.url,t)}const qe={metaData:{getImagePixelModule:fe,getLUTs:pe,getModalityLUTOutputPixelRepresentation:me,getNumberValues:ge,metaDataProvider:Le},dataSetCacheManager:Ee,fileManager:Re,getEncapsulatedImageFrame:_e,getUncompressedImageFrame:Ue,loadFileRequest:Ve,loadImageFromPromise:je,getLoaderForScheme:He,loadImage:ze,parseImageId:ve,unpackBinaryFrame:Be,register:function(e){e.registerImageLoader("dicomweb",ze),e.registerImageLoader("wadouri",ze),e.registerImageLoader("dicomfile",ze),e.metaData.addProvider(Le)}},We=function(e){ce.register(e),qe.register(e)};let Ge,Ye;const Ze={set cornerstone(e){Ge=e,We(Ge)},get cornerstone(){if(!Ge){if(Ge=window&&window.cornerstone,!Ge)throw new Error("cornerstoneDICOMImageLoader requires a copy of Cornerstone to work properly. Please add cornerstoneDICOMImageLoader.external.cornerstone = cornerstone; to your application.");We(Ge)}return Ge},set dicomParser(e){Ye=e},get dicomParser(){if(!Ye){if(!window||!window.dicomParser)throw new Error("cornerstoneDICOMImageLoader requires a copy of dicomParser to work properly. Please add cornerstoneDICOMImageLoader.external.dicomParser = dicomParser; to your application.");Ye=window.dicomParser}return Ye}},Xe=Ze;function Qe(e,t){const n=e.length,r=new Uint8ClampedArray(n);for(let o=0;o<n;++o)r[o]=e[o]>>t;return r}function Ke(e,t,n){const r=e.columns*e.rows,o=e.pixelData;let a=e.redPaletteColorLookupTableData;a||(a=Xe.cornerstone.metaData.get("imagePixelModule",e.imageId)?.redPaletteColorLookupTableData);let i=e.greenPaletteColorLookupTableData;i||(i=Xe.cornerstone.metaData.get("imagePixelModule",e.imageId)?.greenPaletteColorLookupTableData);let s=e.bluePaletteColorLookupTableData;if(s||(s=Xe.cornerstone.metaData.get("imagePixelModule",e.imageId)?.bluePaletteColorLookupTableData),!a||!i||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const l=e.redPaletteColorLookupTableData.length;let c=0,u=0;const d=e.redPaletteColorLookupTableDescriptor[1],f=8===e.redPaletteColorLookupTableDescriptor[2]?0:8,h=Qe(a,f),p=Qe(i,f),m=Qe(s,f);if(n)for(let e=0;e<r;++e){let e=o[c++];e<d?e=0:e>d+l-1?e=l-1:e-=d,t[u++]=h[e],t[u++]=p[e],t[u++]=m[e],t[u++]=255}else for(let e=0;e<r;++e){let e=o[c++];e<d?e=0:e>d+l-1?e=l-1:e-=d,t[u++]=h[e],t[u++]=p[e],t[u++]=m[e]}}const Je=function(e){D(e)},$e=function(e,t){if(t=t||e.transferSyntax,8===e.bitsAllocated&&"1.2.840.10008.1.2.4.50"===t&&(3===e.samplesPerPixel||4===e.samplesPerPixel))return!0},et={convertRGBColorByPixel:e,convertRGBColorByPlane:t,convertYBRFullByPixel:o,convertYBRFullByPlane:a,convertPALETTECOLOR:Ke,wadouri:qe,wadors:ce,configure:Je,convertColorSpace:U,createImage:se,decodeImageFrame:te,decodeJPEGBaseline8BitColor:V,getImageFrame:ne,getPixelData:_,getMinMax:N,isColorImage:re,isJPEGBaseline8BitColor:$e,webWorkerManager:J,internal:O,external:Ze}})(),r})(),e.exports=t()},6618:e=>{
/*! cornerstone-core - 0.0.0-semantically-released - 2024-01-19 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */
window,e.exports=function(){return t=[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=r(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==r(e)?e:String(e)}(o.key),o)}}n.r(t),n.d(t,"drawImage",(function(){return w})),n.d(t,"generateLut",(function(){return It})),n.d(t,"getDefaultViewport",(function(){return b})),n.d(t,"setDefaultViewport",(function(){return m})),n.d(t,"requestAnimationFrame",(function(){return Qt})),n.d(t,"storedPixelDataToCanvasImageData",(function(){return Ne})),n.d(t,"storedColorPixelDataToCanvasImageData",(function(){return kt})),n.d(t,"storedPixelDataToCanvasImageDataColorLUT",(function(){return Ut})),n.d(t,"storedPixelDataToCanvasImageDataPseudocolorLUT",(function(){return _t})),n.d(t,"internal",(function(){return an})),n.d(t,"renderLabelMapImage",(function(){return Ft})),n.d(t,"renderPseudoColorImage",(function(){return Bt})),n.d(t,"renderColorImage",(function(){return Rt})),n.d(t,"renderGrayscaleImage",(function(){return Pt})),n.d(t,"renderWebImage",(function(){return pn})),n.d(t,"renderToCanvas",(function(){return hn})),n.d(t,"canvasToPixel",(function(){return Ae})),n.d(t,"disable",(function(){return Me})),n.d(t,"displayImage",(function(){return De})),n.d(t,"draw",(function(){return ke})),n.d(t,"drawInvalidated",(function(){return Le})),n.d(t,"enable",(function(){return $t})),n.d(t,"getElementData",(function(){return Z})),n.d(t,"removeElementData",(function(){return X})),n.d(t,"getEnabledElement",(function(){return l})),n.d(t,"addEnabledElement",(function(){return c})),n.d(t,"getEnabledElementsByImageId",(function(){return u})),n.d(t,"getEnabledElements",(function(){return d})),n.d(t,"addLayer",(function(){return E})),n.d(t,"removeLayer",(function(){return A})),n.d(t,"getLayer",(function(){return M})),n.d(t,"getLayers",(function(){return P})),n.d(t,"getVisibleLayers",(function(){return D})),n.d(t,"setActiveLayer",(function(){return k})),n.d(t,"getActiveLayer",(function(){return O})),n.d(t,"purgeLayers",(function(){return R})),n.d(t,"setLayerImage",(function(){return L})),n.d(t,"fitToWindow",(function(){return Oe})),n.d(t,"getDefaultViewportForImage",(function(){return en})),n.d(t,"getDisplayedArea",(function(){return x})),n.d(t,"getImage",(function(){return tn})),n.d(t,"getPixels",(function(){return rn})),n.d(t,"getStoredPixels",(function(){return nn})),n.d(t,"getViewport",(function(){return on})),n.d(t,"loadImage",(function(){return ce})),n.d(t,"loadAndCacheImage",(function(){return ue})),n.d(t,"registerImageLoader",(function(){return de})),n.d(t,"registerUnknownImageLoader",(function(){return fe})),n.d(t,"invalidate",(function(){return sn})),n.d(t,"invalidateImageId",(function(){return ln})),n.d(t,"pageToPixel",(function(){return dn})),n.d(t,"pixelToCanvas",(function(){return fn})),n.d(t,"reset",(function(){return gn})),n.d(t,"resize",(function(){return Re})),n.d(t,"setToPixelCoordinateSystem",(function(){return Ue})),n.d(t,"setViewport",(function(){return vn})),n.d(t,"updateImage",(function(){return T})),n.d(t,"pixelDataToFalseColorData",(function(){return q})),n.d(t,"rendering",(function(){return mn})),n.d(t,"imageCache",(function(){return ie})),n.d(t,"metaData",(function(){return un})),n.d(t,"webGL",(function(){return gt})),n.d(t,"colors",(function(){return z})),n.d(t,"convertImageToFalseColorImage",(function(){return G})),n.d(t,"convertToFalseColorImage",(function(){return Y})),n.d(t,"restoreImage",(function(){return W})),n.d(t,"EVENTS",(function(){return a})),n.d(t,"events",(function(){return i})),n.d(t,"triggerEvent",(function(){return I})),n.d(t,"imageLoadPoolManager",(function(){return xe})),n.d(t,"imageRetrievalPoolManager",(function(){return we})),n.d(t,"RequestPoolManager",(function(){return be}));var a={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_PROGRESS:"cornerstoneimageloadprogress",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"},i=new(function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.listeners={},this.namespaces={}}var t,n,r;return t=e,(n=[{key:"addEventNamespaceListener",value:function(e,t){e.indexOf(".")<=0||(this.namespaces[e]=t,this.addEventListener(e.split(".")[0],t))}},{key:"removeEventNamespaceListener",value:function(e){e.indexOf(".")<=0||!this.namespaces[e]||(this.removeEventListener(e.split(".")[0],this.namespaces[e]),delete this.namespaces[e])}},{key:"addEventListener",value:function(e,t){0<e.indexOf(".")?this.addEventNamespaceListener(e,t):(e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t))}},{key:"removeEventListener",value:function(e,t){if(0<e.indexOf("."))this.removeEventNamespaceListener(e);else if(e in this.listeners)for(var n=this.listeners[e],r=0,o=n.length;r<o;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()),s=[];function l(e){if(void 0===e)throw new Error("getEnabledElement: parameter element must not be undefined");for(var t=0;t<s.length;t++)if(s[t].element===e)return s[t];throw new Error("element not enabled")}function c(e){if(void 0===e)throw new Error("getEnabledElement: enabledElement element must not be undefined");s.push(e)}function u(e){var t=[];return s.forEach((function(n){n.image&&n.image.imageId===e&&t.push(n)})),t}function d(){return s}function f(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var h=function(){return"".concat(f()+f(),"-").concat(f(),"-").concat(f(),"-").concat(f(),"-").concat(f()).concat(f()).concat(f())},p={viewport:{}},m=function(e){p.viewport=e||{}};function g(e,t){if(null==e)throw new Error(t)}function v(e,t){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=(g(e,"getImageScale: parameter windowSize must not be undefined"),g(t,"getImageScale: parameter image must not be undefined"),r=y(t,r),1),a=1;return{verticalScale:((n=t.rowPixelSpacing||1)<(t=t.columnPixelSpacing||1)?a=t/n:o=n/t,n=e.height/r.height/o),horizontalScale:t=e.width/r.width/a,scaleFactor:Math.min(t,n)}}var y=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return g(e,"getImageSize: parameter image must not be undefined"),g(e.width,"getImageSize: parameter image must have width"),g(e.height,"getImageSize: parameter image must have height"),null!=(t=t)&&0!==t&&180!==t?{height:e.width,width:e.height}:{width:e.width,height:e.height}},b=function(e,t){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");return void 0===t?Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:void 0},p.viewport):{scale:v(e,t,0).scaleFactor,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,voiLUT:t.voiLUT,colormap:t.colormap,labelmap:Boolean(t.labelmap),displayedArea:void 0}},x=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(t&&t.displayedArea)return t.displayedArea;if(void 0===e)throw new Error("getDisplayedArea: parameter image must not be undefined");return{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:void 0===e.rowPixelSpacing?1:e.rowPixelSpacing,columnPixelSpacing:void 0===e.columnPixelSpacing?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}},w=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.needsRedraw=!0,t&&(e.invalid=!0)},T=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e=l(e),w(e,t)};function I(e,t){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}function S(e,t,n){I(t.element,e,{viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,layerId:n})}function C(e,t){if(e.layerId===t.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var n,r,o=e.image,a=t.image;o.imageId&&a.imageId&&(r=x(a,t.viewport),n=x(o,e.viewport),r=r.columnPixelSpacing*a.width/(n.columnPixelSpacing*o.width),a=t.viewport.scale/e.viewport.scale*r,t.viewport.scale=e.viewport.scale*a)}function E(e,t,n){var r=h(),o=l(e),i=o.layers,s=(t&&(s=b(o.canvas,t),n)&&n.viewport&&(s=Object.assign(s,n.viewport)),!1!==o.syncViewports&&(o.syncViewports=!0),{image:t,layerId:r,viewport:s,options:n||{},renderingTools:{}});return i.length&&t&&C(i[0],s),i.push(s),S(a.LAYER_ADDED,o,r),1===i.length&&t&&k(e,r),r}function A(e,t){var n=l(e),r=n.layers,o=n.layers.findIndex((function(e){return e.layerId===t}));-1!==o&&(r.splice(o,1),t===n.activeLayerId&&r.length&&k(e,r[0].layerId),S(a.LAYER_REMOVED,n,t))}function M(e,t){return l(e).layers.find((function(e){return e.layerId===t}))}function P(e){return l(e).layers}function D(e){return l(e).layers.filter((function(e){return e.options&&!1!==e.options.visible&&0!==e.options.opacity}))}function k(e,t){var n=l(e);if(n.activeLayerId!==t){var r=n.layers.findIndex((function(e){return e.layerId===t}));if(-1===r)throw new Error("setActiveLayer: layer not found in layers array");if(!(r=n.layers[r]).image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");n.activeLayerId=t,n.image=r.image,n.viewport=r.viewport,T(e),S(a.ACTIVE_LAYER_CHANGED,n,t)}}function L(e,t,n){var r=l(e),o=r.layers[0];if(!(e=n?M(e,n):O(e)))throw new Error("setLayerImage: Layer not found");(e.image=t)?e.viewport||(r=b(r.canvas,t),e.options&&e.options.viewport&&(e.viewport=Object.assign(r,e.options.viewport)),o.layerId!==n&&C(o,e)):e.viewport=void 0}function O(e){var t=l(e);return t.layers.find((function(e){return e.layerId===t.activeLayerId}))}function R(e){(e=l(e)).layers=[],delete e.activeLayerId,delete e.lastSyncViewportsState}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=_(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=_(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==_(e)?e:String(e)}(r.key),r)}}var B=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}var t,n,r;return t=e,(n=[{key:"setNumberOfTableValues",value:function(e){this.NumberOfColors=e}},{key:"setRamp",value:function(e){this.Ramp=e}},{key:"setTableRange",value:function(e,t){this.TableRange[0]=e,this.TableRange[1]=t}},{key:"setHueRange",value:function(e,t){this.HueRange[0]=e,this.HueRange[1]=t}},{key:"setSaturationRange",value:function(e,t){this.SaturationRange[0]=e,this.SaturationRange[1]=t}},{key:"setValueRange",value:function(e,t){this.ValueRange[0]=e,this.ValueRange[1]=t}},{key:"setRange",value:function(e,t){this.InputRange[0]=e,this.InputRange[1]=t}},{key:"setAlphaRange",value:function(e,t){this.AlphaRange[0]=e,this.AlphaRange[1]=t}},{key:"getColor",value:function(e){return this.mapValue(e)}},{key:"build",value:function(e){if(!(1<this.Table.length)||e){this.Table=[];var t,n,r,o,a=this.NumberOfColors-1;a?(t=(this.HueRange[1]-this.HueRange[0])/a,n=(this.SaturationRange[1]-this.SaturationRange[0])/a,r=(this.ValueRange[1]-this.ValueRange[0])/a,o=(this.AlphaRange[1]-this.AlphaRange[0])/a):t=n=r=o=0;for(var i=0;i<=a;i++){var s=this.HueRange[0]+i*t,l=this.SaturationRange[0]+i*n,c=this.ValueRange[0]+i*r,u=this.AlphaRange[0]+i*o,d=function(e,t,n){if(1<e)throw new Error("HSVToRGB expects hue < 1");var r=[];if(0===t)r[0]=n,r[1]=n,r[2]=n;else{var o=Math.floor(6*e),a=n*(1-t),i=n*(1-t*(e=6*e-o)),s=n*(1-t*(1-e));switch(o){case 0:case 6:r[0]=n,r[1]=s,r[2]=a;break;case 1:r[0]=i,r[1]=n,r[2]=a;break;case 2:r[0]=a,r[1]=n,r[2]=s;break;case 3:r[0]=a,r[1]=i,r[2]=n;break;case 4:r[0]=s,r[1]=a,r[2]=n;break;case 5:r[0]=n,r[1]=a,r[2]=i}}return r}(s,l,c),f=[];switch(this.Ramp){case"scurve":f[0]=Math.floor(127.5*(1+Math.cos((1-d[0])*Math.PI))),f[1]=Math.floor(127.5*(1+Math.cos((1-d[1])*Math.PI))),f[2]=Math.floor(127.5*(1+Math.cos((1-d[2])*Math.PI))),f[3]=Math.floor(255*u);break;case"linear":f[0]=Math.floor(255*d[0]+.5),f[1]=Math.floor(255*d[1]+.5),f[2]=Math.floor(255*d[2]+.5),f[3]=Math.floor(255*u+.5);break;case"sqrt":f[0]=Math.floor(255*Math.sqrt(d[0])+.5),f[1]=Math.floor(255*Math.sqrt(d[1])+.5),f[2]=Math.floor(255*Math.sqrt(d[2])+.5),f[3]=Math.floor(255*Math.sqrt(u)+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(f)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var e=this.NumberOfColors,t=e+0,n=e+1,r=e+2;this.UseBelowRangeColor||0===e?this.Table[t]=this.BelowRangeColor:this.Table[t]=this.Table[0],this.UseAboveRangeColor||0===e?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[r]=this.NaNColor}},{key:"mapValue",value:function(e){var t=this.getIndex(e);if(t<0)return this.NaNColor;if(0===t){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(t===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[t]}},{key:"getIndex",value:function(e){var t={Range:[]};return t.MaxIndex=this.NumberOfColors-1,t.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?t.Scale=Number.MAX_VALUE:t.Scale=t.MaxIndex/(this.TableRange[1]-this.TableRange[0]),t.Range[0]=this.TableRange[0],t.Range[1]=this.TableRange[1],isNaN(e)?-1:(e=(e=e)<(t=t).Range[0]?t.MaxIndex+0+1.5:e>t.Range[1]?t.MaxIndex+1+1.5:(e+t.Shift)*t.Scale,(t=Math.floor(e))===this.NumberOfColors+0?t=0:t===this.NumberOfColors+1&&(t=this.NumberOfColors-1),t)}},{key:"setTableValue",value:function(e,t){if(5===arguments.length&&(t=Array.prototype.slice.call(arguments,1)),e<0)throw new Error("Can't set the table value for negative index (".concat(e,")"));e>=this.NumberOfColors&&new Error("Index ".concat(e," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[e]=t,0!==e&&e!==this.NumberOfColors-1||this.buildSpecialColors()}}])&&N(t.prototype,n),r&&N(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),U=[0,0,0,0],V={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function F(e,t){var n,r=[],o=t.length;for(e.sort((function(e,t){return e-t})),n=0;n<o;n++)r[n]=function(e,t){for(var n=0,r=e.length-1;n<=r;){var o=n+Math.floor((r-n)/2),a=e[o];if(a===t)return o;t<a?r=o-1:n=o+1}return n}(e,t[n]);return r}function j(e,t,n){var r=[],o=[],a=[],i=[];for(n=null===n?1:n,c=0;c<t.length;c++){var s=t[c];r.push((e-1)*s[0]),o.push(s[1]),a.push(s[1])}for(var l=function(e,t,n){for(var r=(t-e)/((n=null===n?100:n)-1),o=[];0<n--;)o.push(e),e+=r;return o[o.length-1]=t,o}(0,1,e),c=0;c<e;c++)l[c]=(e-1)*Math.pow(l[c],n);var u=F(r,l);for(c=1;c<e-1;c++){var d=u[c],f=(l[c]-r[d-1])/(r[d]-r[d-1]);i[c]=f*(o[d]-a[d-1])+a[d-1]}return i[0]=a[0],i[e-1]=o[t.length-1],i}function H(e,t){var n=V[e];return!(n=n||(V[e]=t||{name:"",colors:[]})).colors&&n.segmentedData&&(n.colors=function(e,t,n){for(var r=[],o=j(t=null===t?256:t,e.red,n=null===n?1:n),a=j(t,e.green,n),i=j(t,e.blue,n),s=0;s<t;s++){var l=Math.round(255*o[s]),c=Math.round(255*a[s]),u=Math.round(255*i[s]);r.push([l,c,u,255])}return r}(n.segmentedData,n.numColors,n.gamma)),{getId:function(){return e},getColorSchemeName:function(){return n.name},setColorSchemeName:function(e){n.name=e},getNumberOfColors:function(){return n.colors.length},setNumberOfColors:function(e){for(;n.colors.length<e;)n.colors.push(U);n.colors.length=e},getColor:function(e){return this.isValidIndex(e)?n.colors[e]:U},getColorRepeating:function(e){var t=n.colors.length;return this.getColor(e=t?e%t:0)},setColor:function(e,t){this.isValidIndex(e)&&(n.colors[e]=t)},addColor:function(e){n.colors.push(e)},insertColor:function(e,t){this.isValidIndex(e)&&n.colors.splice(e,1,t)},removeColor:function(e){this.isValidIndex(e)&&n.colors.splice(e,1)},clearColors:function(){n.colors=[]},buildLookupTable:function(e){if(e){var t=n.colors.length;e.setNumberOfTableValues(t);for(var r=0;r<t;r++)e.setTableValue(r,n.colors[r])}},createLookupTable:function(){var e=new B;return this.buildLookupTable(e),e},isValidIndex:function(e){return 0<=e&&e<n.colors.length}}}var z={getColormap:H,getColormapsList:function(){var e=[];return Object.keys(V).forEach((function(t){var n;V.hasOwnProperty(t)&&(n=V[t],e.push({id:t,name:n.name}))})),e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),e},LookupTable:B};function q(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,r,o=e.minPixelValue,a=0,i=0,s=e.width*e.height,l=e.origPixelData||e.getPixelData(),c=new Uint8Array(4*s);if(e.color=!0,e.falseColor=!0,e.origPixelData=l,t instanceof z.LookupTable)for(t.build();i<s;)n=l[i++],r=t.mapValue(n),c[a++]=r[0],c[a++]=r[1],c[a++]=r[2],c[a++]=r[3];else if(o<0)for(;i<s;)n=l[i++],c[a++]=t[n+-o][0],c[a++]=t[n+-o][1],c[a++]=t[n+-o][2],c[a++]=t[n+-o][3];else for(;i<s;)n=l[i++],c[a++]=t[n][0],c[a++]=t[n][1],c[a++]=t[n][2],c[a++]=t[n][3];e.rgba=!0,e.cachedLut=void 0,e.render=void 0,e.slope=1,e.intercept=0,e.minPixelValue=0,e.maxPixelValue=255,e.windowWidth=255,e.windowCenter=128,e.getPixelData=function(){return c}}function W(e){return!(!e.restore||"function"!=typeof e.restore||(e.restore(),0))}function G(e,t){if(e.color&&!e.falseColor)throw new Error("Color transforms are not implemented yet");var n,r,o,a,i,s,l,c,u,d,f,h=(t=h=(h=t)&&"string"==typeof h?H(h):h).getId();return e.colormapId!==h&&(W(e),h&&(r=e.minPixelValue||0,n=e.maxPixelValue||255,e.restore=(o=e).restore||(a=o.color,i=o.rgba,s=o.cachedLut,l=o.slope,c=o.windowWidth,u=o.windowCenter,d=o.minPixelValue,f=o.maxPixelValue,function(){var e;o.color=a,o.rgba=i,o.cachedLut=s,o.slope=l,o.windowWidth=c,o.windowCenter=u,o.minPixelValue=d,o.maxPixelValue=f,o.origPixelData&&(e=o.origPixelData,o.getPixelData=function(){return e}),o.origPixelData=void 0,o.colormapId=void 0,o.falseColor=void 0}),(t=t.createLookupTable()).setTableRange(r,n),q(e,t),r=function(e){for(var t,n=Number.MAX_VALUE,r=Number.MIN_VALUE,o=e.length,a=0;a<o;a++)n=n<(t=e[a])?n:t,r=t<r?r:t;return{minPixelValue:n,maxPixelValue:r}}(e.getPixelData()),e.minPixelValue=r.minPixelValue,e.maxPixelValue=r.maxPixelValue,e.windowWidth=255,e.windowCenter=128,e.colormapId=h),!0)}function Y(e,t){return G(l(e).image,t)}function Z(e,t){return!1===(e=l(e)).data.hasOwnProperty(t)&&(e.data[t]={}),e.data[t]}function X(e,t){delete l(e).data[t]}var Q=1073741824,K=0,J={},$=[];function ee(){if(!(K<=Q)){for($.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));Q<K;){var e=$[$.length-1].imageId;re(e),I(i,a.IMAGE_CACHE_PROMISE_REMOVED,{imageId:e})}var t=oe();I(i,a.IMAGE_CACHE_FULL,t)}}function te(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(!0===J.hasOwnProperty(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};J[e]=n,$.push(n),t.promise.then((function(e){if(-1!==$.indexOf(n)){if(n.loaded=!0,void 0===(n.image=e).sizeInBytes)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===e.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");n.sizeInBytes=e.sizeInBytes,K+=n.sizeInBytes;var t={action:"addImage",image:n};I(i,a.IMAGE_CACHE_CHANGED,t),n.sharedCacheKey=e.sharedCacheKey,ee()}}),(function(){var t=J[e];$.splice($.indexOf(t),1),delete J[e]}))}function ne(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");if(void 0!==(e=J[e]))return e.timeStamp=Date.now(),e.imageLoadObject}function re(e){if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");var t,n=J[e];if(void 0===n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");$.splice($.indexOf(n),1),K-=n.sizeInBytes,I(i,a.IMAGE_CACHE_CHANGED,{action:"deleteImage",image:n}),(t=n.imageLoadObject).promise.then((function(){t.decache&&t.decache()}),(function(){t.decache&&t.decache()})),delete J[e]}function oe(){return{maximumSizeInBytes:Q,cacheSizeInBytes:K,numberOfImagesCached:$.length}}var ae,ie={imageCache:J,cachedImages:$,setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");Q=e,I(i,a.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),ee()},putImageLoadObject:te,getImageLoadObject:ne,removeImageLoadObject:re,getCacheInfo:oe,purgeCache:function(){for(;0<$.length;)re($[0].imageId)},changeImageIdCacheSize:function(e,t){var n=J[e];n&&n.imageLoadObject.promise.then((function(e){var r=t-e.sizeInBytes;e.sizeInBytes=t,n.sizeInBytes=t,K+=r,r={action:"changeImageSize",image:e},I(i,a.IMAGE_CACHE_CHANGED,r)}))}},se={};function le(e,t){var n=e.indexOf(":");if(n=e.substring(0,n),null==(n=se[n])){if(void 0!==ae)return ae(e);throw new Error("loadImageFromImageLoader: no image loader for imageId")}return(n=n(e,t)).promise.then((function(e){I(i,a.IMAGE_LOADED,{image:e})}),(function(t){I(i,a.IMAGE_LOAD_FAILED,{imageId:e,error:t})})),n}function ce(e,t){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");var n=ne(e);return(void 0!==n?n:le(e,t)).promise}function ue(e,t){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var n=ne(e);return void 0===n&&te(e,n=le(e,t)),n.promise}function de(e,t){se[e]=t}function fe(e){var t=ae;return ae=e,t}function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){var n,r,o,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return r=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){r=!0,o=e},f:function(){try{n||null==i.return||i.return()}finally{if(r)throw o}}};if(Array.isArray(e)||(i=function(e,t){var n;if(e)return"string"==typeof e?me(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ye(r.key),r)}}function ve(e,t,n){(t=ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function ye(e){return e=function(e,t){if("object"!=he(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=he(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==he(e)?e:String(e)}var be=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");ve(this,"requestPool",void 0),ve(this,"awake",void 0),ve(this,"numRequests",void 0),ve(this,"maxNumRequests",void 0),ve(this,"grabDelay",void 0),ve(this,"timeoutHandle",void 0),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.awake=!1,this.grabDelay=5,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"addRequest",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];e={requestFn:e,type:t,additionalDetails:n},void 0===this.requestPool[t][r]&&(this.requestPool[t][r]=[]),o?this.requestPool[t][r].unshift(e):this.requestPool[t][r].push(e),this.awake||(this.awake=!0,this.startGrabbing())}},{key:"filterRequests",value:function(e){var t=this;Object.keys(this.requestPool).forEach((function(n){var r=t.requestPool[n];Object.keys(r).forEach((function(t){r[t]=r[t].filter((function(t){return e(t)}))}))}))}},{key:"clearRequestStack",value:function(e){if(!this.requestPool[e])throw new Error("No category for the type ".concat(e," found"));this.requestPool[e]={0:[]}}},{key:"sendRequest",value:function(e){var t=this,n=e.requestFn,r=e.type;this.numRequests[r]++,this.awake=!0,n().finally((function(){t.numRequests[r]--,t.startAgain()}))}},{key:"startGrabbing",value:function(){for(var e=this.maxNumRequests.interaction+this.maxNumRequests.thumbnail+this.maxNumRequests.prefetch-(this.numRequests.interaction+this.numRequests.thumbnail+this.numRequests.prefetch),t=0;t<e;t++){var n=this.getNextRequest();if(!1===n)break;n&&this.sendRequest(n)}}},{key:"startAgain",value:function(){var e=this;this.awake&&(this.grabDelay?this.timeoutHandle=window.setTimeout((function(){e.startGrabbing()}),this.grabDelay):this.startGrabbing())}},{key:"getSortedPriorityGroups",value:function(e){var t=this;return Object.keys(this.requestPool[e]).map(Number).filter((function(n){return t.requestPool[e][n].length})).sort()}},{key:"getNextRequest",value:function(){var e,t=this.getSortedPriorityGroups("interaction"),n=pe(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(this.requestPool.interaction[r].length&&this.numRequests.interaction<this.maxNumRequests.interaction)return this.requestPool.interaction[r].shift()}}catch(e){n.e(e)}finally{n.f()}var o,a=this.getSortedPriorityGroups("thumbnail"),i=pe(a);try{for(i.s();!(o=i.n()).done;){var s=o.value;if(this.requestPool.thumbnail[s].length&&this.numRequests.thumbnail<this.maxNumRequests.thumbnail)return this.requestPool.thumbnail[s].shift()}}catch(e){i.e(e)}finally{i.f()}var l,c=this.getSortedPriorityGroups("prefetch"),u=pe(c);try{for(u.s();!(l=u.n()).done;){var d=l.value;if(this.requestPool.prefetch[d].length&&this.numRequests.prefetch<this.maxNumRequests.prefetch)return this.requestPool.prefetch[d].shift()}}catch(e){u.e(e)}finally{u.f()}return t.length||a.length||c.length||(this.awake=!1),!1}},{key:"getRequestPool",value:function(){return this.requestPool}}])&&ge(t.prototype,n),r&&ge(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),xe=((n=new be).maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3},n.grabDelay=0,n),we=((n=new be).maxNumRequests={interaction:20,thumbnail:20,prefetch:20},n.grabDelay=0,n);function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){return e=function(e,t){if("object"!=Te(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if("object"!=Te(n=n.call(e,t||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),"symbol"==Te(e)?e:String(e)}(r.key),r)}}function Se(e){return Ee(e)}var Ce=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.reset()}var t,n,r;return t=e,(n=[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],o=this.m[1]*e.m[2]+this.m[3]*e.m[3],a=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4];e=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5],this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=o,this.m[4]=a,this.m[5]=e}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,o=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);e*=this.m[1]*this.m[4]-this.m[0]*this.m[5],this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=o,this.m[4]=a,this.m[5]=e}},{key:"rotate",value:function(e){var t=Math.cos(e),n=(e=Math.sin(e),this.m[0]*t+this.m[2]*e),r=this.m[1]*t+this.m[3]*e,o=this.m[0]*-e+this.m[2]*t;e=this.m[1]*-e+this.m[3]*t,this.m[0]=n,this.m[1]=r,this.m[2]=o,this.m[3]=e}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,r=t;return{x:e=n*this.m[0]+r*this.m[2]+this.m[4],y:t=n*this.m[1]+r*this.m[3]+this.m[5]}}}])&&Ie(t.prototype,n),r&&Ie(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Ee=function(e,t){var n,r,o=new Ce,a=(o.translate(e.canvas.width/2,e.canvas.height/2),e.viewport.rotation),i=(0!==a&&o.rotate(a*Math.PI/180),e.viewport.scale),s=e.viewport.scale,l=x(e.image,e.viewport),c=l.tlhc.x-1,u=l.tlhc.y-1,d=l.brhc.x-c,f=l.brhc.y-u;return"NONE"===l.presentationSizeMode?e.image.rowPixelSpacing<e.image.columnPixelSpacing?i*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(s*=e.image.rowPixelSpacing/e.image.columnPixelSpacing):(i=l.columnPixelSpacing,s=l.rowPixelSpacing,"SCALE TO FIT"===l.presentationSizeMode&&(n=e.canvas.height/(f*s),r=e.canvas.width/(d*i),i=s=Math.min(r,n),l.rowPixelSpacing<l.columnPixelSpacing?i*=l.columnPixelSpacing/l.rowPixelSpacing:l.columnPixelSpacing<l.rowPixelSpacing&&(s*=l.rowPixelSpacing/l.columnPixelSpacing))),o.scale(i,s),0!==a&&o.rotate(-a*Math.PI/180),o.translate(e.viewport.translation.x,e.viewport.translation.y),0!==a&&o.rotate(a*Math.PI/180),void 0!==t&&o.scale(t,t),e.viewport.hflip&&o.scale(-1,1),e.viewport.vflip&&o.scale(1,-1),o.translate(-d/2,-f/2),o.translate(-c,-u),o},Ae=function(e,t){return(e=Se(e=l(e))).invert(),e.transformPoint(t.x,t.y)},Me=function(e){if(void 0===e)throw new Error("disable: element must not be undefined");for(var t=s,n=0;n<t.length;n++)if(t[n].element===e){var r={element:e};I(e,a.ELEMENT_DISABLED,r),I(i,a.ELEMENT_DISABLED,r),t[n].element.removeChild(t[n].canvas),t[n].canvas=void 0,t.splice(n,1);break}},Pe=function(){return(window.performance?performance:Date).now()},De=function(e,t,n){if(void 0===e)throw new Error("displayImage: parameter element must not be undefined");if(void 0===t)throw new Error("displayImage: parameter image must not be undefined");var r,o=l(e),i=o.image;if(o.image=t,o.layers&&o.layers.length&&L(e,t),void 0===o.viewport&&(o.viewport=b(o.canvas,t)),n)for(var s in n)null!==n[s]&&(o.viewport[s]=n[s]);void 0!==o.lastImageTimeStamp&&(r=(1e3/(Pe()-o.lastImageTimeStamp)).toFixed()),o.lastImageTimeStamp=Pe(),t={viewport:o.viewport,element:o.element,image:o.image,oldImage:i,enabledElement:o,frameRate:r},I(o.element,a.NEW_IMAGE,t),T(e)},ke=function(e){e=l(e),w(e)},Le=function(){for(var e=s,t=0;t<e.length;t++){var n=e[t];!0===n.invalid&&w(n,!0)}},Oe=function(e){var t=l(e),n=t.image;t.viewport.scale=v(t.canvas,n,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0,T(e)},Re=function(e,t){var n,r,o,i,s,c=l(e),u=c.canvas.width,d=c.canvas.height;r=e,(n=c.canvas).width!==r.clientWidth&&(n.width=r.clientWidth,n.style.width="".concat(r.clientWidth,"px")),n.height!==r.clientHeight&&(n.height=r.clientHeight,n.style.height="".concat(r.clientHeight,"px")),I(e,a.ELEMENT_RESIZED,{element:e}),void 0!==c.image&&(t||(n=u,r=d,o=(t=c).viewport.scale,i=y(t.image,t.viewport.rotation),s=Math.round(i.width*o),i=Math.round(i.height*o),o=t.viewport.translation.x,t=t.viewport.translation.y,s===n&&i<=r)||s<=n&&i===r&&0===o&&0===t?Oe:(n=(s=c).viewport.scale,i=s.canvas.width,r=s.canvas.height,i=Math.sqrt(i/u*(r/d)),s.viewport.scale=i*n,T))(e)},_e=function(e){var t=(e.viewport||{}).invert;return e=(e.options||{}).fillStyle,-1!==["black","white"].indexOf(e)&&t?"white":"black"},Ne=function(e,t,n){var r=Pe(),o=e.getPixelData(),a=(e.stats.lastGetPixelDataTime=Pe()-r,o.length),i=e.minPixelValue,s=3,l=0;if(r=Pe(),o instanceof Int16Array)if(i<0)for(;l<a;)n[s]=t[o[l++]+-i],s+=4;else for(;l<a;)n[s]=t[o[l++]],s+=4;else if(o instanceof Uint16Array)for(;l<a;)n[s]=t[o[l++]],s+=4;else if(i<0)for(;l<a;)n[s]=t[o[l++]+-i],s+=4;else for(;l<a;)n[s]=t[o[l++]],s+=4;e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-r},Be=function(e,t,n){var r,o=Pe(),a=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=Pe()-o,a.length),s=e.minPixelValue,l=0,c=0;if(o=Pe(),a instanceof Int16Array)if(s<0)for(;c<i;)r=t[a[c++]+-s],n[l++]=r,n[l++]=r,n[l++]=r,n[l++]=255;else for(;c<i;)r=t[a[c++]],n[l++]=r,n[l++]=r,n[l++]=r,n[l++]=255;else if(a instanceof Uint16Array)for(;c<i;)r=t[a[c++]],n[l++]=r,n[l++]=r,n[l++]=r,n[l++]=255;else if(s<0)for(;c<i;)r=t[a[c++]+-s],n[l++]=r,n[l++]=r,n[l++]=r,n[l++]=255;else for(;c<i;)r=t[a[c++]],n[l++]=r,n[l++]=r,n[l++]=r,n[l++]=255;e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-o},Ue=function(e,t,n){if(void 0===e)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(void 0===t)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");e=Ee(e,n),t.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5])},Ve={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*3),r=0,o=0;o<t.length;o++){var a=Math.abs(t[o]);n[r++]=255&a,n[r++]=a>>8,n[r++]=t[o]<0?0:1}return n}},Fe=((n={}).frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),je={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,o=0;o<t.length;o++)n[r++]=t[o],n[r++]=t[o]<0?0:1;return n}},He=(Fe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),ze={storedPixelDataToImageData:function(e){var t=e.minPixelValue,n=0,r=0,o=e.width*e.height*4,a=e.width*e.height*3,i=e.getPixelData(),s=new Uint8Array(a);if(t<0)for(;r<o;)s[n++]=i[r++]+-t,s[n++]=i[r++]+-t,s[n++]=i[r++]+-t,r+=1;else for(;r<o;)s[n++]=i[r++],s[n++]=i[r++],s[n++]=i[r++],r+=1;return s}},qe=(He.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}",{}),We={storedPixelDataToImageData:function(e){for(var t=e.getPixelData(),n=new Uint8Array(e.width*e.height*2),r=0,o=0;o<t.length;o++){var a=t[o];n[r++]=255&a,n[r++]=a>>8}return n}},Ge=(qe.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{}),Ye={storedPixelDataToImageData:function(e){return e.getPixelData()}},Ze=(Ge.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",{int16:n,int8:Fe,rgb:He,uint16:qe,uint8:Ge}),Xe={int16:Ve,int8:je,rgb:ze,uint16:We,uint8:Ye},Qe="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",Ke={},Je=[],$e=268435456,et=0;function tt(){if(!(et<=$e)){for(Je.sort((function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0}));$e<et;){var e=Je[Je.length-1];et-=e.sizeInBytes,delete Ke[e.imageId],Je.pop(),I(i,a.WEBGL_TEXTURE_REMOVED,{imageId:e.imageId})}var t={maximumSizeInBytes:$e,cacheSizeInBytes:et,numberOfImagesCached:Je.length};I(i,a.WEBGL_TEXTURE_CACHE_FULL,t)}}var nt={purgeCache:function(){for(;0<Je.length;){var e=Je.pop();delete Ke[e.imageId]}et=0},getImageTexture:function(e){if(void 0===e)throw new Error("getImageTexture: imageId must not be undefined");if(void 0!==(e=Ke[e]))return e.timeStamp=new Date,e.imageTexture},putImageTexture:function(e,t){var n=e.imageId;if(void 0===e)throw new Error("putImageTexture: image must not be undefined");if(void 0===n)throw new Error("putImageTexture: imageId must not be undefined");if(void 0===t)throw new Error("putImageTexture: imageTexture must not be undefined");if(!0===Object.prototype.hasOwnProperty.call(Ke,n))throw new Error("putImageTexture: imageId already in cache");if(e={imageId:n,imageTexture:t,timeStamp:new Date,sizeInBytes:t.sizeInBytes},Ke[n]=e,Je.push(e),void 0===t.sizeInBytes)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");et+=e.sizeInBytes,tt()},removeImageTexture:function(e){if(void 0===e)throw new Error("removeImageTexture: imageId must not be undefined");var t=Ke[e];if(void 0===t)throw new Error("removeImageTexture: imageId must not be undefined");return Je.splice(Je.indexOf(t),1),et-=t.sizeInBytes,delete Ke[e],t.imageTexture},setMaximumSizeBytes:function(e){if(void 0===e)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(void 0===e.toFixed)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");$e=e,tt()}};function rt(e,t,n){return n=e.createShader(n),e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||e.isContextLost()||(t=e.getShaderInfoLog(n),console.error("Could not compile shader:\n".concat(t))),n}var ot,at,it,st=function(e,t,n){var r;return t=t=rt(e,t,e.VERTEX_SHADER),n=n=rt(e,n,e.FRAGMENT_SHADER),r=(e=e).createProgram(),e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||e.isContextLost()||(t=e.getProgramInfoLog(r),console.error("WebGL program filed to link:\n".concat(t))),r},lt=document.createElement("canvas"),ct=!1;function ut(){if(!0!==ct&&function(e){ot=null;try{var t={desynchronized:!0,preserveDrawingBuffer:!0};ot=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),e.removeEventListener("webglcontextlost",dt,!1),e.addEventListener("webglcontextlost",dt,!1),e.removeEventListener("webglcontextrestored",ft,!1),e.addEventListener("webglcontextrestored",ft,!1)}catch(e){throw new Error("Error creating WebGL context")}return ot||(console.error("Unable to initialize WebGL. Your browser may not support it."),ot=null),ot}(lt)){for(var e in it=ot.createBuffer(),ot.bindBuffer(ot.ARRAY_BUFFER,it),ot.bufferData(ot.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),ot.STATIC_DRAW),at=ot.createBuffer(),ot.bindBuffer(ot.ARRAY_BUFFER,at),ot.bufferData(ot.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),ot.STATIC_DRAW),Ze)(e=Ze[e]).attributes={},e.uniforms={},e.vert=Qe,e.program=st(ot,e.vert,e.frag),e.attributes.texCoordLocation=ot.getAttribLocation(e.program,"a_texCoord"),ot.enableVertexAttribArray(e.attributes.texCoordLocation),e.attributes.positionLocation=ot.getAttribLocation(e.program,"a_position"),ot.enableVertexAttribArray(e.attributes.positionLocation),e.uniforms.resolutionLocation=ot.getUniformLocation(e.program,"u_resolution");ct=!0}}function dt(e){e.preventDefault(),console.warn("WebGL Context Lost!")}function ft(e){e.preventDefault(),ct=!1,nt.purgeCache(),ut()}function ht(e){return e.color?"rgb":(e=e.getPixelData())instanceof Int16Array?"int16":e instanceof Uint16Array?"uint16":e instanceof Int8Array?"int8":"uint8"}function pt(e){var t,n,r,o,a,i=nt.getImageTexture(e.imageId);return i||(t=e,n=(n={uint8:ot.LUMINANCE,int8:ot.LUMINANCE_ALPHA,uint16:ot.LUMINANCE_ALPHA,int16:ot.RGB,rgb:ot.RGB})[r=ht(t)],o=ot.createTexture(),ot.bindTexture(ot.TEXTURE_2D,o),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MIN_FILTER,ot.NEAREST),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MAG_FILTER,ot.NEAREST),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_S,ot.CLAMP_TO_EDGE),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_T,ot.CLAMP_TO_EDGE),ot.pixelStorei(ot.UNPACK_ALIGNMENT,1),a=Xe[r].storedPixelDataToImageData(t,t.width,t.height),ot.texImage2D(ot.TEXTURE_2D,0,n,t.width,t.height,0,n,ot.UNSIGNED_BYTE,a),i={texture:o,sizeInBytes:t.width*t.height*{int8:1,uint16:2,int16:3,rgb:3}[r]},nt.putImageTexture(e,i)),i.texture}function mt(e,t,n,r,o){for(var a in ot.clearColor(1,0,0,1),ot.viewport(0,0,r,o),ot.clear(ot.COLOR_BUFFER_BIT|ot.DEPTH_BUFFER_BIT),ot.useProgram(e.program),ot.bindBuffer(ot.ARRAY_BUFFER,at),ot.vertexAttribPointer(e.attributes.texCoordLocation,2,ot.FLOAT,!1,0,0),ot.bindBuffer(ot.ARRAY_BUFFER,it),ot.vertexAttribPointer(e.attributes.positionLocation,2,ot.FLOAT,!1,0,0),t){var i,s=ot.getUniformLocation(e.program,a);s&&(i=(a=t[a]).type,a=a.value,"i"===i?ot.uniform1i(s,a):"f"===i?ot.uniform1f(s,a):"2f"===i&&ot.uniform2f(s,a[0],a[1]))}var l;(l=ot).bufferData(l.ARRAY_BUFFER,new Float32Array([r,o,0,o,r,0,0,0]),l.STATIC_DRAW),ot.activeTexture(ot.TEXTURE0),ot.bindTexture(ot.TEXTURE_2D,n),ot.drawArrays(ot.TRIANGLE_STRIP,0,4)}n={createProgramFromString:st,renderer:{render:function(e){var t=e.image,n=(lt.width=t.width,lt.height=t.height,e=e.viewport,n=ht(n=t),Ze.hasOwnProperty(n)?Ze[n]:Ze.rgb),r=pt(t);return mt(n,{u_resolution:{type:"2f",value:[t.width,t.height]},wc:{type:"f",value:e.voi.windowCenter},ww:{type:"f",value:e.voi.windowWidth},slope:{type:"f",value:t.slope},intercept:{type:"f",value:t.intercept},minPixelValue:{type:"f",value:t.minPixelValue},invert:{type:"i",value:e.invert?1:0}},r,t.width,t.height),lt},initRenderer:ut,getRenderCanvas:function(){return lt},isWebGLAvailable:function(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return Boolean(window.WebGLRenderingContext)&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}},textureCache:nt};var gt=(Object.defineProperty(n,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return ct}}),n);function vt(e,t){var n,r;(r=e).voiLUT&&r.voiLUT.lut&&0<r.voiLUT.lut.length||void 0!==r.voi.windowWidth&&void 0!==r.voi.windowCenter||(n=(r=t.maxPixelValue*t.slope+t.intercept)-(t=t.minPixelValue*t.slope+t.intercept),r=(r+t)/2,void 0===e.voi?e.voi={windowWidth:n,windowCenter:r}:(e.voi.windowWidth=n,e.voi.windowCenter=r))}function yt(e,t){return!e&&!t||!(!e||!t)&&e.id===t.id}function bt(e,t,n){var r,o,a,i,s,l;return n?(o=(r=n).lut[0],a=r.lut[r.lut.length-1],i=r.firstValueMapped+r.lut.length,function(e){return e<r.firstValueMapped?o:i<=e?a:r.lut[e]}):(s=e,l=t,function(e){return e*s+l})}function xt(e){return function(e){if(Array.isArray(e))return wt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?wt(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wt(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Tt=function(e,t,n,r){var o,a,i,s,l,c,u,d;return n?(o=n,a=r,i=Math.max.apply(Math,xt(o.lut)).toString(2).length-8,s=o.lut[0]>>i,l=o.lut[o.lut.length-1]>>i,c=o.firstValueMapped+o.lut.length-1,function(e){return e<o.firstValueMapped?s:c<=e?l:a?o.lut[Math.round(e)-o.firstValueMapped]>>i:o.lut[e-o.firstValueMapped]>>i}):(u=e,d=t,function(e){return 255*((e-d)/u+.5)})},It=function(e,t,n,r,o,a){var i=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0),c=(void 0===e.cachedLut&&(u=i-l+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(u)),e.cachedLut.lutArray),u=Boolean(e.slope%1)||Boolean(e.intercept%1),d=bt(e.slope,e.intercept,o),f=Tt(t,n,a,u);if(!0===r)for(var h=s;h<=i;h++)c[h+-l]=255-f(d(h));else for(var p=s;p<=i;p++)c[p+-l]=f(d(p));return c},St=function(e,t,n){return void 0!==e.cachedLut&&e.cachedLut.windowCenter===t.voi.windowCenter&&e.cachedLut.windowWidth===t.voi.windowWidth&&yt(e.cachedLut.modalityLUT,t.modalityLUT)&&yt(e.cachedLut.voiLUT,t.voiLUT)&&e.cachedLut.invert===t.invert&&!0!==n||(vt(t,e),It(e,t.voi.windowWidth,t.voi.windowCenter,t.invert,t.modalityLUT,t.voiLUT),e.cachedLut.windowWidth=t.voi.windowWidth,e.cachedLut.windowCenter=t.voi.windowCenter,e.cachedLut.invert=t.invert,e.cachedLut.voiLUT=t.voiLUT,e.cachedLut.modalityLUT=t.modalityLUT),e.cachedLut.lutArray},Ct=function(e,t){var n=e.renderingTools.lastRenderedImageId,r=e.renderingTools.lastRenderedViewport;return t.imageId!==n||!r||r.windowCenter!==e.viewport.voi.windowCenter||r.windowWidth!==e.viewport.voi.windowWidth||r.invert!==e.viewport.invert||r.rotation!==e.viewport.rotation||r.hflip!==e.viewport.hflip||r.vflip!==e.viewport.vflip||r.modalityLUT!==e.viewport.modalityLUT||r.voiLUT!==e.viewport.voiLUT||r.colormap!==e.viewport.colormap},Et=function(e,t){var n=((r=e.renderingTools.renderCanvas).width=t.width,r.height=t.height,r.getContext("2d",{desynchronized:!0})),r=(n.fillStyle="white",n.fillRect(0,0,r.width,r.height),n.getImageData(0,0,t.width,t.height));e.renderingTools.renderCanvasContext=n,e.renderingTools.renderCanvasData=r},At=function(e){var t=e.image.imageId,n=e.viewport,r=e.image.color;return e.renderingTools.lastRenderedImageId=t,e.renderingTools.lastRenderedIsColor=r,e.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},e.renderingTools};function Mt(e,t,n,r){r=!(3<arguments.length&&void 0!==r)||r;var o,a,i=!0===e.renderingTools.lastRenderedIsColor;return e.renderingTools.renderCanvas&&!i||(e.renderingTools.renderCanvas=document.createElement("canvas"),Et(e,t)),i=e.renderingTools.renderCanvas,!1===Ct(e,t)&&!0!==n||(i.width===t.width&&i.height===t.height||Et(e,t),o=Pe(),n=St(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-o,a=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(r?Ne:Be)(t,n,a.data),o=Pe(),e.putImageData(a,0,0),t.stats.lastPutImageDataTime=Pe()-o),i}function Pt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("drawImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0}),o=(r.setTransform(1,0,0,1,0,0),r.fillStyle=_e(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,Ue(e,r),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?gt.renderer.render(e):Mt(e,n,t),t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-o;t=t.brhc.y-a,r.drawImage(n,o,a,i,t,o,a,i,t),e.renderingTools=At(e)}function Dt(e,t,n,r,o){var a,i=e.maxPixelValue,s=e.minPixelValue,l=Math.min(s,0),c=(void 0===e.cachedLut&&(a=i-l+1,e.cachedLut={},e.cachedLut.lutArray=new Uint8ClampedArray(a)),e.cachedLut.lutArray),u=Tt(t,n,o);if(!0===r)for(var d=s;d<=i;d++)c[d+-l]=255-u(d);else for(var f=s;f<=i;f++)c[f+-l]=u(f)}var kt=function(e,t,n){var r=Pe(),o=e.getPixelData(),a=(e.stats.lastGetPixelDataTime=Pe()-r,e.minPixelValue),i=0,s=0,l=o.length;if(r=Pe(),a<0)for(;s<l;)n[i++]=t[o[s++]+-a],n[i++]=t[o[s++]+-a],n[i]=t[o[s]+-a],s+=2,i+=2;else for(;s<l;)n[i++]=t[o[s++]],n[i++]=t[o[s++]],n[i]=t[o[s]],s+=2,i+=2;e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-r},Lt=function(e,t,n){var r=Pe(),o=e.getPixelData(),a=(e.stats.lastGetPixelDataTime=Pe()-r,e.minPixelValue),i=0,s=0,l=o.length;if(r=Pe(),a<0)for(;s<l;)n[i++]=t[o[s++]+-a],n[i++]=t[o[s++]+-a],n[i++]=t[o[s++]+-a],n[i++]=o[s++];else for(;s<l;)n[i++]=t[o[s++]],n[i++]=t[o[s++]],n[i++]=t[o[s++]],n[i++]=o[s++];e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-r};function Ot(e,t,n){var r,o,a=!0===e.renderingTools.lastRenderedIsColor;return e.renderingTools.renderCanvas&&a||(e.renderingTools.renderCanvas=document.createElement("canvas")),a=e.renderingTools.renderCanvas,255!==e.viewport.voi.windowWidth&&256!==e.viewport.voi.windowWidth||127!==e.viewport.voi.windowCenter&&128!==e.viewport.voi.windowCenter||!1!==e.viewport.invert||!t.getCanvas||!t.getCanvas()?(!1===Ct(e,t)&&!0!==n||(a.width===t.width&&a.height===t.height||Et(e,t),n=Pe(),o=t,r=e.viewport,void 0!==o.cachedLut&&o.cachedLut.windowCenter===r.voi.windowCenter&&o.cachedLut.windowWidth===r.voi.windowWidth&&o.cachedLut.invert===r.invert||(Dt(o,r.voi.windowWidth,r.voi.windowCenter,r.invert),o.cachedLut.windowWidth=r.voi.windowWidth,o.cachedLut.windowCenter=r.voi.windowCenter,o.cachedLut.invert=r.invert),r=o.cachedLut.lutArray,t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-n,o=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,(t.rgba?Lt:kt)(t,r,o.data),n=Pe(),e.putImageData(o,0,0),t.stats.lastPutImageDataTime=Pe()-n),a):t.getCanvas()}function Rt(e,t){if(void 0===e)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var n=e.image;if(void 0===n)throw new Error("renderColorImage: image must be loaded before it can be drawn");var r=e.canvas.getContext("2d",{desynchronized:!0}),o=(r.setTransform(1,0,0,1,0,0),r.fillStyle=_e(e),r.fillRect(0,0,e.canvas.width,e.canvas.height),r.imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,Ue(e,r),n=e.options&&e.options.renderer&&"webgl"===e.options.renderer.toLowerCase()?gt.renderer.render(e):Ot(e,n,t),t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-o;t=t.brhc.y-a,r.drawImage(n,o,a,i,t,o,a,i,t),e.renderingTools=At(e)}var _t=function(e,t,n,r){var o,a,i=Pe(),s=e.getPixelData(),l=(e.stats.lastGetPixelDataTime=Pe()-i,s.length),c=e.minPixelValue,u=0,d=0,f=(i=Pe(),n instanceof z.LookupTable?n.Table:n);if(!0===e.color||!0===e.rgba)if(c<0)for(;d<l;)o=t[s[d]+-c],d+=4,a=f[o],r[u++]=a[0],r[u++]=a[1],r[u++]=a[2],r[u++]=a[3];else for(;d<l;)o=t[s[d]],d+=4,a=f[o],r[u++]=a[0],r[u++]=a[1],r[u++]=a[2],r[u++]=a[3];else if(c<0)for(;d<l;)a=f[o=t[s[d++]+-c]],r[u++]=a[0],r[u++]=a[1],r[u++]=a[2],r[u++]=a[3];else for(;d<l;)a=f[o=t[s[d++]]],r[u++]=a[0],r[u++]=a[1],r[u++]=a[2],r[u++]=a[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-i};function Nt(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r,o,a=e.renderingTools.renderCanvas,i=e.viewport.colormap||e.options.colormap;if(e.options&&e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i=i&&"string"==typeof i?z.getColormap(i):i)return o=i.getId(),!1===Ct(e,t)&&!0!==n&&e.renderingTools.colormapId===o||(a.width===t.width&&a.height===t.height||Et(e,t),r=Pe(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===o||(i.setNumberOfColors(256),e.renderingTools.colorLut=i.createLookupTable(),e.renderingTools.colormapId=o),i=St(t,e.viewport,n),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-r,o=e.renderingTools.colorLut,n=e.renderingTools.renderCanvasData,e=e.renderingTools.renderCanvasContext,_t(t,i,o,n.data),r=Pe(),e.putImageData(n,0,0),t.stats.lastPutImageDataTime=Pe()-r),a;throw new Error("renderPseudoColorImage: colormap not found.")}function Bt(e,t){if(void 0===e)throw new Error("drawImage: enabledElement parameter must not be undefined");if(void 0===(r=e.image))throw new Error("drawImage: image must be loaded before it can be drawn");var n=e.canvas.getContext("2d",{desynchronized:!0}),r=(n.setTransform(1,0,0,1,0,0),n.fillStyle=_e(e),n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Ue(e,n),Nt(e,r,t)),o=(t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-o;t=t.brhc.y-a,n.drawImage(r,o,a,i,t,o,a,i,t),e.renderingTools=At(e)}var Ut=function(e,t,n){var r,o=Pe(),a=e.getPixelData(),i=(e.stats.lastGetPixelDataTime=Pe()-o,a.length),s=e.minPixelValue,l=0,c=0,u=(o=Pe(),t instanceof z.LookupTable?t.Table:t);if(s<0)for(;c<i;)r=u[a[c++]+-s],n[l++]=r[0],n[l++]=r[1],n[l++]=r[2],n[l++]=r[3];else for(;c<i;)r=u[a[c++]],n[l++]=r[0],n[l++]=r[1],n[l++]=r[2],n[l++]=r[3];e.stats.lastStoredPixelDataToCanvasImageDataTime=Pe()-o};function Vt(e,t,n){e.renderingTools.renderCanvas||(e.renderingTools.renderCanvas=document.createElement("canvas"));var r,o,a=e.renderingTools.renderCanvas,i=e.viewport.colormap||e.options.colormap;if(e.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i=i&&"string"==typeof i?z.getColormap(i):i)return o=i.getId(),!1===Ct(e,t)&&!0!==n&&e.renderingTools.colormapId===o||(a.width===t.width&&a.height===t.height||Et(e,t),r=Pe(),e.renderingTools.colorLut&&!n&&e.renderingTools.colormapId===o||(e.renderingTools.colorLut=i.createLookupTable(),e.renderingTools.colormapId=o),t.stats=t.stats||{},t.stats.lastLutGenerateTime=Pe()-r,n=e.renderingTools.colorLut,i=e.renderingTools.renderCanvasData,o=e.renderingTools.renderCanvasContext,Ut(t,n,i.data),r=Pe(),o.putImageData(i,0,0),t.stats.lastPutImageDataTime=Pe()-r),a;throw new Error("renderLabelMapImage: colormap not found.")}function Ft(e,t){if(void 0===e)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");if(void 0===(r=e.image))throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var n=e.canvas.getContext("2d",{desynchronized:!0}),r=(n.setTransform(1,0,0,1,0,0),n.fillStyle=_e(e),n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Ue(e,n),Vt(e,r,t)),o=(t=x(e.image,e.viewport)).tlhc.x-1,a=t.tlhc.y-1,i=t.brhc.x-o;t=t.brhc.y-a,n.drawImage(r,o,a,i,t,o,a,i,t),e.renderingTools=At(e)}function jt(e){var t=e.syncProps||{};t.originalScale=e.viewport.scale,e.syncProps=t}function Ht(e,t){e.forEach((function(e){var n,r;e!==t&&e.viewport&&t.viewport&&(e.syncProps||jt(e),r=e,(n=t).syncProps||jt(n),r.syncProps||jt(r),r=r.syncProps.originalScale/n.syncProps.originalScale,e.viewport.scale=t.viewport.scale*r,e.viewport.rotation=t.viewport.rotation,e.viewport.translation={x:t.viewport.translation.x/r,y:t.viewport.translation.y/r},e.viewport.hflip=t.viewport.hflip,e.viewport.vflip=t.viewport.vflip)}))}function zt(e,t,n){t.forEach((function(t,r){if(t.image){e.save(),t.canvas=e.canvas,Ue(t,e);var o=t.viewport.colormap||t.options.colormap,a=t.viewport.labelmap,i=t.invalid||n;if(o&&""!==o&&!0===a){var s=i;if(void 0===(a=t))throw new Error("addLabelMapLayer: layer parameter must not be undefined");var l=a.image;if(void 0===l)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");a.canvas=Vt(a,l,s),(l=a.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!a.viewport.pixelReplication,l.mozImageSmoothingEnabled=l.imageSmoothingEnabled,a.renderingTools=At(a)}else if(o&&""!==o){if(l=i,void 0===(s=t))throw new Error("addPseudoColorLayer: layer parameter must not be undefined");if(void 0===(a=s.image))throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");s.canvas=Nt(s,a,l),(a=s.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!s.viewport.pixelReplication,a.mozImageSmoothingEnabled=a.imageSmoothingEnabled,s.renderingTools=At(s)}else if(!0===t.image.color){if(a=i,void 0===(o=t))throw new Error("addColorLayer: layer parameter must not be undefined");var c=o.image;if(void 0===c)throw new Error("addColorLayer: image must be loaded before it can be drawn");c.rgba=!0,o.canvas=Ot(o,c,a),(c=o.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!o.viewport.pixelReplication,c.mozImageSmoothingEnabled=c.imageSmoothingEnabled,o.renderingTools=At(o)}else!function(e,t,n){if(n=2<arguments.length&&void 0!==n&&n,void 0===e)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var r=e.image;if(void 0===r)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");e.canvas=Mt(e,r,t,n),(r=e.canvas.getContext("2d",{desynchronized:!0})).imageSmoothingEnabled=!e.viewport.pixelReplication,r.mozImageSmoothingEnabled=r.imageSmoothingEnabled,e.renderingTools=At(e)}(t,i,0===r);t.options&&t.options.opacity?e.globalAlpha=t.options.opacity:e.globalAlpha=1,t.options&&t.options.fillStyle&&(e.fillStyle=t.options.fillStyle),e.imageSmoothingEnabled=!t.viewport.pixelReplication,e.mozImageSmoothingEnabled=e.imageSmoothingEnabled,c=(a=x(t.image,t.viewport)).tlhc.x-1,o=a.tlhc.y-1,i=a.brhc.x-c,r=a.brhc.y-o,e.drawImage(t.canvas,c,o,i,r,c,o,i,r),e.restore(),t.invalid=!1}}))}function qt(e){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Wt=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a=(b="function"==typeof Symbol?Symbol:{}).iterator||"@@iterator",i=b.asyncIterator||"@@asyncIterator",s=b.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(t,n,r,a){var i,s,l,c;return n=n&&n.prototype instanceof g?n:g,n=Object.create(n.prototype),a=new E(a||[]),o(n,"_invoke",{value:(i=t,s=r,l=a,c=d,function(t,n){if(c===h)throw new Error("Generator is already running");if(c===p){if("throw"===t)throw n;return{value:e,done:!0}}for(l.method=t,l.arg=n;;){var r=l.delegate;if(r&&(r=function t(n,r){var o=r.method,a=n.iterator[o];return a===e?(r.delegate=null,"throw"===o&&n.iterator.return&&(r.method="return",r.arg=e,t(n,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),m):"throw"===(o=u(a,n.iterator,r.arg)).type?(r.method="throw",r.arg=o.arg,r.delegate=null,m):(a=o.arg)?a.done?(r[n.resultName]=a.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}(r,l),r)){if(r===m)continue;return r}if("next"===l.method)l.sent=l._sent=l.arg;else if("throw"===l.method){if(c===d)throw c=p,l.arg;l.dispatchException(l.arg)}else"return"===l.method&&l.abrupt("return",l.arg);if(c=h,"normal"===(r=u(i,s,l)).type){if(c=l.done?p:f,r.arg===m)continue;return{value:r.arg,done:l.done}}"throw"===r.type&&(c=p,l.method="throw",l.arg=r.arg)}})}),n}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var d="suspendedStart",f="suspendedYield",h="executing",p="completed",m={};function g(){}function v(){}function y(){}var b,x,w=(l(b={},a,(function(){return this})),(x=(x=Object.getPrototypeOf)&&x(x(A([]))))&&x!==n&&r.call(x,a)&&(b=x),y.prototype=g.prototype=Object.create(b));function T(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){var n;o(this,"_invoke",{value:function(o,a){function i(){return new t((function(n,i){!function n(o,a,i,s){var l;if("throw"!==(o=u(e[o],e,a)).type)return(a=(l=o.arg).value)&&"object"==qt(a)&&r.call(a,"__await")?t.resolve(a.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(a).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,s)}));s(o.arg)}(o,a,n,i)}))}return n=n?n.then(i,i):i()}})}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(t){if(t||""===t){var n,o=t[a];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(o=function o(){for(;++n<t.length;)if(r.call(t,n))return o.value=t[n],o.done=!1,o;return o.value=e,o.done=!0,o}).next=o}throw new TypeError(qt(t)+" is not iterable")}return o(w,"constructor",{value:v.prototype=y,configurable:!0}),o(y,"constructor",{value:v,configurable:!0}),v.displayName=l(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},T(I.prototype),l(I.prototype,i,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new I(c(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},T(w),l(w,s,"Generator"),l(w,a,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},t.values=A,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;0<=a;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}var i=(a=a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc?null:a)?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,o=this.tryEntries[t];if(o.tryLoc===e)return"throw"===(n=o.completion).type&&(r=n.arg,C(o)),r}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Gt(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function Yt(e,t){return Zt.apply(this,arguments)}function Zt(){var e;return e=Wt().mark((function e(t,n){var r,o,i,s,l,c;return Wt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.image,i=t.element,s=t.layers||[],t.canvas&&t.image){e.next=5;break}return e.abrupt("return");case 5:return c=Pe(),o.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},s&&s.length?(d=n,m=f=p=h=f=void 0,h=P(f=(u=t).element),p=O(f),f=D(f),m=!u.lastSyncViewportsState&&u.syncViewports,u.lastSyncViewportsState=u.syncViewports,m&&h.forEach((function(e){e.viewport&&jt(e)})),!0===u.syncViewports&&Ht(f,p),(m=u.canvas.getContext("2d",{desynchronized:!0})).setTransform(1,0,0,1,0,0),m.fillStyle="black",m.fillRect(0,0,u.canvas.width,u.canvas.height),zt(m,f,d)):o&&((l=o.render)||(l=t.viewport.colormap&&""!==t.viewport.colormap&&!0===t.image.labelmap?Ft:t.viewport.colormap&&""!==t.viewport.colormap?Bt:o.color?Rt:Pt,o._render=l),l(t,n)),l=Pe()-c,c={viewport:t.viewport,element:i,image:o,enabledElement:t,canvasContext:t.canvas.getContext("2d",{desynchronized:!0}),renderTimeInMs:l},o.stats.lastRenderTime=l,t.invalid=!1,t.needsRedraw=!1,e.next=15,null==(r=globalThis.drawImageSyncHandler)?void 0:r.call(globalThis,c);case 15:I(i,a.IMAGE_RENDERED,c);case 16:case"end":return e.stop()}var u,d,f,h,p,m}),e)})),(Zt=function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Gt(a,r,o,i,s,"next",e)}function s(e){Gt(a,r,o,i,s,"throw",e)}i(void 0)}))}).apply(this,arguments)}function Xt(e){gt.renderer.isWebGLAvailable()?(gt.renderer.initRenderer(),e.renderer="webgl",e.desynchronized=!0,e.preserveDrawingBuffer=!0):(console.error("WebGL not available, falling back to Canvas renderer"),delete e.renderer,delete e.preserveDrawingBuffer)}var Qt=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||void window.setTimeout(e,1e3/60)},Kt="cornerstone-canvas";function Jt(e){var t="canvas.".concat(Kt);return e.querySelector(t)||(t=e,(e=document.createElement("canvas")).style.display="block",e.classList.add(Kt),t.appendChild(e),e)}var $t=function(e,t){if(void 0===e)throw new Error("enable: parameter element cannot be undefined");t&&t.renderer&&"webgl"===t.renderer.toLowerCase()&&Xt(t);var n,r={element:e,canvas:Jt(e),image:void 0,invalid:!1,needsRedraw:!0,options:Object.assign({},t),layers:[],data:{},renderingTools:{},uuid:(n=(new Date).getTime(),"undefined"!=typeof performance&&"function"==typeof performance.now&&(n+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})))};c(r),I(i,a.ELEMENT_ENABLED,r),Re(e,!0),function e(t){void 0!==r.canvas&&(I(r.element,a.PRE_RENDER,{enabledElement:r,timestamp:t}),r.needsRedraw&&(void 0!==(t=r).image||0<t.layers.length)&&Yt(r,r.invalid),Qt(e))}()},en=function(e,t){return e=l(e),b(e.canvas,t)},tn=function(e){return l(e).image},nn=function(e,t,n,r,o){if(void 0===e)throw new Error("getStoredPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);for(var a=l(e),i=[],s=0,c=a.image.getPixelData(),u=0;u<o;u++)for(var d=0;d<r;d++){var f=(u+n)*a.image.columns+(d+t);i[s++]=c[f]}return i},rn=function(e,t,n,r,o){return t=nn(e,t,n,r,o),r=bt((n=l(e)).image.slope,n.image.intercept,n.viewport.modalityLUT),t.map(r)},on=function(e){if(void 0!==(e=l(e).viewport))return Object.assign({},e)},an={drawImage:w,generateLut:It,getDefaultViewport:b,requestAnimationFrame:Qt,setDefaultViewport:m,storedPixelDataToCanvasImageData:Ne,storedPixelDataToCanvasImageDataRGBA:Be,storedPixelDataToCanvasImageDataColorLUT:Ut,storedPixelDataToCanvasImageDataPseudocolorLUT:_t,storedColorPixelDataToCanvasImageData:kt,getTransform:Se,calculateTransform:Ee,Transform:Ce},sn=function(e){var t=l(e);t.invalid=!0,t.needsRedraw=!0,I(e,a.INVALIDATED,{element:e})},ln=function(e){u(e).forEach((function(e){w(e,!0)}))},cn=[],un={addProvider:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0;n<cn.length&&!(cn[n].priority<=t);n++);cn.splice(n,0,{priority:t,provider:e})},removeProvider:function(e){for(var t=0;t<cn.length;t++)if(cn[t].provider===e){cn.splice(t,1);break}},get:function(e,t){for(var n=0;n<cn.length;n++){var r=cn[n].provider(e,t);if(void 0!==r)return r}}},dn=function(e,t,n){var r=l(e);if(void 0===r.image)throw new Error("image has not been loaded yet");return t={x:t-(e=e.getBoundingClientRect()).left-window.pageXOffset,y:n-e.top-window.pageYOffset},(n=Se(r)).invert(),n.transformPoint(t.x,t.y)},fn=function(e,t){return Se(e=l(e)).transformPoint(t.x,t.y)},hn=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)throw new Error("renderToCanvas: parameter canvas cannot be undefined");r&&r.renderer&&"webgl"===r.renderer.toLowerCase()&&Xt(r);var o=b(e,t);n={enabledElement:(n&&Object.assign(o,n),e={element:n=e,canvas:n,image:t,invalid:!0,needsRedraw:!0,options:r,layers:[],data:{},renderingTools:{},viewport:o}),timestamp:Date.now()},I(e.element,a.PRE_RENDER,n),Yt(e,e.invalid)};function pn(e,t){if(void 0===e)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var n,r,o,a,i,s=e.image;if(void 0===s)throw new Error("renderWebImage: image must be loaded before it can be drawn");e.viewport.voi.windowWidth===e.image.windowWidth&&e.viewport.voi.windowCenter===e.image.windowCenter&&!1===e.viewport.invert?((n=e.canvas.getContext("2d",{desynchronized:!0})).setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,e.canvas.width,e.canvas.height),n.imageSmoothingEnabled=!e.viewport.pixelReplication,n.mozImageSmoothingEnabled=n.imageSmoothingEnabled,Ue(e,n),r=(i=x(e.image,e.viewport)).tlhc.x-1,o=i.tlhc.y-1,a=i.brhc.x-r,i=i.brhc.y-o,n.drawImage(s.getImage(),r,o,a,i,r,o,a,i)):Rt(e,t)}var mn={colorImage:Rt,grayscaleImage:Pt,webImage:pn,pseudoColorImage:Bt,labelMapImage:Ft,toCanvas:hn},gn=function(e){var t=l(e);t.viewport=b(t.canvas,t.image),T(e)},vn=function(e,t){var n=l(e);if(void 0===n.viewport&&(n.viewport=b(n.canvas)),t)for(var r in t)null!==t[r]&&(n.viewport[r]=t[r]);n.viewport.voi.windowWidth&&(n.viewport.voi.windowWidth=Math.max(n.viewport.voi.windowWidth,1e-6)),n.viewport.scale&&(n.viewport.scale=Math.max(n.viewport.scale,1e-4)),n.viewport.rotation%=360,n.viewport.rotation<0&&(n.viewport.rotation+=360),n.image&&T(e)};t.default={drawImage:w,generateLut:It,getDefaultViewport:b,requestAnimationFrame:Qt,storedPixelDataToCanvasImageData:Ne,storedColorPixelDataToCanvasImageData:kt,storedPixelDataToCanvasImageDataColorLUT:Ut,storedPixelDataToCanvasImageDataPseudocolorLUT:_t,internal:an,renderLabelMapImage:Ft,renderPseudoColorImage:Bt,renderColorImage:Rt,renderGrayscaleImage:Pt,renderWebImage:pn,renderToCanvas:hn,canvasToPixel:Ae,disable:Me,displayImage:De,draw:ke,drawInvalidated:Le,enable:$t,getElementData:Z,removeElementData:X,getEnabledElement:l,addEnabledElement:c,getEnabledElementsByImageId:u,getEnabledElements:d,addLayer:E,removeLayer:A,getLayer:M,getLayers:P,getVisibleLayers:D,setActiveLayer:k,getActiveLayer:O,purgeLayers:R,setLayerImage:L,fitToWindow:Oe,getDefaultViewportForImage:en,getDisplayedArea:x,setDefaultViewport:m,getImage:tn,getPixels:rn,getStoredPixels:nn,getViewport:on,loadImage:ce,loadAndCacheImage:ue,registerImageLoader:de,registerUnknownImageLoader:fe,invalidate:sn,invalidateImageId:ln,pageToPixel:dn,pixelToCanvas:fn,reset:gn,resize:Re,setToPixelCoordinateSystem:Ue,setViewport:vn,updateImage:T,pixelDataToFalseColorData:q,rendering:mn,imageCache:ie,metaData:un,webGL:gt,colors:z,convertImageToFalseColorImage:G,convertToFalseColorImage:Y,restoreImage:W,EVENTS:a,events:i,triggerEvent:I,imageLoadPoolManager:xe,imageRetrievalPoolManager:we,RequestPoolManager:be}}],n={},e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(e){return t[e]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=0);function e(r){var o;return(n[r]||(o=n[r]={i:r,l:!1,exports:{}},t[r].call(o.exports,o,o.exports,e),o.l=!0,o)).exports}var t,n}()},352:e=>{
/*! cornerstone-math - 0.1.10 - 2022-06-09 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneMath */
window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),a=n(1),i=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0}return r(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*r,this.y=o[1]*t+o[4]*n+o[7]*r,this.z=o[2]*t+o[5]*n+o[8]*r,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12],this.y=o[1]*t+o[5]*n+o[9]*r+o[13],this.z=o[2]*t+o[6]*n+o[10]*r+o[14],this}},{key:"applyProjection",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements,a=1/(o[3]*t+o[7]*n+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*r+o[12])*a,this.y=(o[1]*t+o[5]*n+o[9]*r+o[13])*a,this.z=(o[2]*t+o[6]*n+o[10]*r+o[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.x,a=e.y,i=e.z,s=e.w,l=s*t+a*r-i*n,c=s*n+i*t-o*r,u=s*r+o*n-a*t,d=-o*t-a*n-i*r;return this.x=l*s+d*-o+c*-i-u*-a,this.y=c*s+d*-a+u*-o-l*-i,this.z=u*s+d*-i+l*-a-c*-o,this}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r,this.y=o[1]*t+o[5]*n+o[9]*r,this.z=o[2]*t+o[6]*n+o[10]*r,this.normalize(),this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this}},{key:"max",value:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this}},{key:"clamp",value:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"cross",value:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,o=this.z;return this.x=r*e.z-o*e.y,this.y=o*e.x-n*e.z,this.z=n*e.y-r*e.x,this}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,o=e.z,a=t.x,i=t.y,s=t.z;return this.x=r*s-o*i,this.y=o*a-n*s,this.z=n*i-r*a,this}},{key:"angleTo",value:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos((0,a.clamp)(t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"setFromMatrixPosition",value:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();i.prototype.projectOnVector=function(){var e=void 0,t=void 0;return function(n){return void 0===e&&(e=new i),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),i.prototype.projectOnPlane=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),e.copy(this).projectOnVector(t),this.sub(e)}}(),i.prototype.reflect=function(){var e=void 0;return function(t){return void 0===e&&(e=new i),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),i.prototype.clampScalar=function(){var e=void 0,t=void 0;return function(n,r){return void 0===e&&(e=new i,t=new i),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),i.prototype.applyAxisAngle=function(){var e=void 0;return function(t,n){return void 0===e&&(e=new o.default),this.applyQuaternion(e.setFromAxisAngle(t.normalize(),n)),this}}(),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=1e-4;t.clamp=function(e,t,n){return e<t?t:e>n?n:e},t.degToRad=function(e){return e*(Math.PI/180)},t.approximatelyEquals=function(e,t,n){var o=n||r;return Math.abs(e-t)<=o*Math.max(1,Math.abs(e),Math.abs(t))},t.radToDeg=function(e){return e*(180/Math.PI)},t.sign=function(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t||0,this.y=n||0,this.z=r||0,this.w=void 0!==o?o:1}return r(e,[{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,r=e.y,o=e.z,a=e.w,i=t.x,s=t.y,l=t.z,c=t.w;return this.x=n*c+a*i+r*l-o*s,this.y=r*c+a*s+o*i-n*l,this.z=o*c+a*l+n*s-r*i,this.w=a*c-n*i-r*s-o*l,this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],o=t[8],a=t[1],i=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+i+u,f=void 0;return d>0?(f=.5/Math.sqrt(d+1),this.w=.25/f,this.x=(c-s)*f,this.y=(o-l)*f,this.z=(a-r)*f):n>i&&n>u?(f=2*Math.sqrt(1+n-i-u),this.w=(c-s)/f,this.x=.25*f,this.y=(r+a)/f,this.z=(o+l)/f):i>u?(f=2*Math.sqrt(1+i-n-u),this.w=(o-l)/f,this.x=(r+a)/f,this.y=.25*f,this.z=(s+c)/f):(f=2*Math.sqrt(1+u-n-i),this.w=(a-r)/f,this.x=(o+l)/f,this.y=(s+c)/f,this.z=.25*f),this}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function o(e){return e*e}function a(e,t){return o(e.x-t.x)+o(e.y-t.y)}var i={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var n=a(e.start,e.end);if(0===n)return a(t,e.start);var r=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/n;return a(t,r<0?e.start:r>1?e.end:{x:e.start.x+r*(e.end.x-e.start.x),y:e.start.y+r*(e.end.y-e.start.y)})}(e,t))},intersectLine:function(e,t){var n,o,a,i,s,l,c,u,d,f,h,p={},m=e.start.x,g=e.start.y,v=e.end.x,y=e.end.y,b=t.start.x,x=t.start.y,w=t.end.x,T=t.end.y,I=void 0;if(f=(n=y-g)*w+(a=m-v)*T+(s=v*g-m*y),(0===(d=n*b+a*x+s)||0===f||(0,r.sign)(d)!==(0,r.sign)(f))&&(u=(o=T-x)*v+(i=b-w)*y+(l=w*x-b*T),0===(c=o*m+i*g+l)||0===u||(0,r.sign)(c)!==(0,r.sign)(u))){h=n*i-o*a,I=a*l-i*s;var S=parseFloat(I/h);I=o*s-n*l;var C=parseFloat(I/h);return p.x=S,p.y=C,p}}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=t.rect=t.quaternion=t.point=t.Plane=t.Matrix4=t.sign=t.radToDeg=t.degToRad=t.clamp=t.lineSegment=t.Line3=void 0;var r=f(n(5)),o=f(n(3)),a=n(1),i=f(n(6)),s=f(n(7)),l=f(n(8)),c=f(n(2)),u=f(n(9)),d=f(n(0));function f(e){return e&&e.__esModule?e:{default:e}}var h={Line3:r.default,lineSegment:o.default,clamp:a.clamp,degToRad:a.degToRad,radToDeg:a.radToDeg,sign:a.sign,Matrix4:i.default,Plane:s.default,point:l.default,quaternion:c.default,rect:u.default,Vector3:d.default};t.Line3=r.default,t.lineSegment=o.default,t.clamp=a.clamp,t.degToRad=a.degToRad,t.radToDeg=a.radToDeg,t.sign=a.sign,t.Matrix4=i.default,t.Plane=s.default,t.point=l.default,t.quaternion=c.default,t.rect=u.default,t.Vector3=d.default,t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=n(1),i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=void 0!==t?t:new o.default,this.end=void 0!==n?n:new o.default}return r(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"center",value:function(e){return(e||new o.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return(e||new o.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){var n=t||new o.default;return this.delta(n).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){var n=new o.default,r=new o.default;n.subVectors(e,this.start),r.subVectors(this.end,this.start);var i=r.dot(r),s=r.dot(n)/i;return t&&(s=(0,a.clamp)(s,0,1)),s}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t),a=n||new o.default;return this.delta(a).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"intersectLine",value:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),r=e.start.clone().sub(this.start),o=t.clone().cross(n),i=r.clone().cross(n),s=r.dot(o)/(r.lengthSq()*o.lengthSq());if((0,a.approximatelyEquals)(s,0)){var l=i.dot(o)/o.lengthSq();if(!(l>1||isNaN(l))){var c=this.start.clone().add(t.clone().multiplyScalar(l));return c.clone().sub(e.start).lengthSq()+c.clone().sub(e.end).lengthSq()<=e.distanceSq()?c:void 0}}}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n,r,o,a,i,s,l,c,u,d,f,h,p,m,g){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements=new Float32Array(16);var v=this.elements;v[0]=void 0!==t?t:1,v[4]=n||0,v[8]=r||0,v[12]=o||0,v[1]=a||0,v[5]=void 0!==i?i:1,v[9]=s||0,v[13]=l||0,v[2]=c||0,v[6]=u||0,v[10]=void 0!==d?d:1,v[14]=f||0,v[3]=h||0,v[7]=p||0,v[11]=m||0,v[15]=void 0!==g?g:1}return r(e,[{key:"makeRotationFromQuaternion",value:function(e){var t=this.elements,n=e.x,r=e.y,o=e.z,a=e.w,i=n+n,s=r+r,l=o+o,c=n*i,u=n*s,d=n*l,f=r*s,h=r*l,p=o*l,m=a*i,g=a*s,v=a*l;return t[0]=1-(f+p),t[4]=u-v,t[8]=d+g,t[1]=u+v,t[5]=1-(c+p),t[9]=h-m,t[2]=d-g,t[6]=h+m,t[10]=1-(c+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,o=this.elements,a=n[0],i=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],f=n[13],h=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],w=r[0],T=r[4],I=r[8],S=r[12],C=r[1],E=r[5],A=r[9],M=r[13],P=r[2],D=r[6],k=r[10],L=r[14],O=r[3],R=r[7],_=r[11],N=r[15];return o[0]=a*w+i*C+s*P+l*O,o[4]=a*T+i*E+s*D+l*R,o[8]=a*I+i*A+s*k+l*_,o[12]=a*S+i*M+s*L+l*N,o[1]=c*w+u*C+d*P+f*O,o[5]=c*T+u*E+d*D+f*R,o[9]=c*I+u*A+d*k+f*_,o[13]=c*S+u*M+d*L+f*N,o[2]=h*w+p*C+m*P+g*O,o[6]=h*T+p*E+m*D+g*R,o[10]=h*I+p*A+m*k+g*_,o[14]=h*S+p*M+m*L+g*N,o[3]=v*w+y*C+b*P+x*O,o[7]=v*T+y*E+b*D+x*R,o[11]=v*I+y*A+b*k+x*_,o[15]=v*S+y*M+b*L+x*N,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"getInverse",value:function(e,t){var n=this.elements,r=e.elements,o=r[0],a=r[4],i=r[8],s=r[12],l=r[1],c=r[5],u=r[9],d=r[13],f=r[2],h=r[6],p=r[10],m=r[14],g=r[3],v=r[7],y=r[11],b=r[15];n[0]=u*m*v-d*p*v+d*h*y-c*m*y-u*h*b+c*p*b,n[4]=s*p*v-i*m*v-s*h*y+a*m*y+i*h*b-a*p*b,n[8]=i*d*v-s*u*v+s*c*y-a*d*y-i*c*b+a*u*b,n[12]=s*u*h-i*d*h-s*c*p+a*d*p+i*c*m-a*u*m,n[1]=d*p*g-u*m*g-d*f*y+l*m*y+u*f*b-l*p*b,n[5]=i*m*g-s*p*g+s*f*y-o*m*y-i*f*b+o*p*b,n[9]=s*u*g-i*d*g-s*l*y+o*d*y+i*l*b-o*u*b,n[13]=i*d*f-s*u*f+s*l*p-o*d*p-i*l*m+o*u*m,n[2]=c*m*g-d*h*g+d*f*v-l*m*v-c*f*b+l*h*b,n[6]=s*h*g-a*m*g-s*f*v+o*m*v+a*f*b-o*h*b,n[10]=a*d*g-s*c*g+s*l*v-o*d*v-a*l*b+o*c*b,n[14]=s*c*f-a*d*f-s*l*h+o*d*h+a*l*m-o*c*m,n[3]=u*h*g-c*p*g-u*f*v+l*p*v+c*f*y-l*h*y,n[7]=a*p*g-i*h*g+i*f*v-o*p*v-a*f*y+o*h*y,n[11]=i*c*g-a*u*g-i*l*v+o*u*v+a*l*y-o*c*y,n[15]=a*u*f-i*c*f+i*l*h-o*u*h-a*l*p+o*c*p;var x=o*n[0]+l*n[4]+f*n[8]+g*n[12];if(0===x){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/x),this}},{key:"applyToVector3Array",value:function(){var e=new o.default;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var o=0,a=n;o<r;o+=3,a+=3)e.x=t[a],e.y=t[a+1],e.z=t[a+2],e.applyMatrix4(this),t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z;return t}}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"set",value:function(e,t,n,r,o,a,i,s,l,c,u,d,f,h,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=o,g[5]=a,g[9]=i,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=f,g[7]=h,g[11]=p,g[15]=m,this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.normal=void 0!==t?t:new o.default(1,0,0),this.constant=void 0!==n?n:0}return r(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return this.orthoPoint(e,t).sub(e).negate()}},{key:"orthoPoint",value:function(e,t){var n=this.distanceToPoint(e);return(t||new o.default).copy(this.normal).multiplyScalar(n)}},{key:"isIntersectionLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectPlane",value:function(e){var t=this.normal.clone().cross(e.normal),n={origin:new o.default,direction:t};if(this.normal.clone().cross(e.normal).length<1e-10)return n.direction=new o.default,n;var r=this.constant,a=e.constant,i=this.normal.clone().dot(e.normal),s=-(r-a*i)/(1-i*i),l=-(a-r*i)/(1-i*i);return n.origin=this.normal.clone().multiplyScalar(s).add(e.normal.clone().multiplyScalar(l)),n}},{key:"coplanarPoint",value:function(e){return(e||new o.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant=this.constant-e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();a.prototype.setFromCoplanarPoints=function(){var e=new o.default,t=new o.default;return function(n,r,o){var a=e.subVectors(o,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),a.prototype.intersectLine=function(){var e=new o.default;return function(t,n){var r=n||new o.default,a=t.delta(e),i=this.normal.dot(a);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?void 0:r.copy(a).multiplyScalar(s).add(t.start)}}(),t.default=a},function(e,t,n){"use strict";function r(e,t){return{x:e.x-t.x,y:e.y-t.y}}function o(e,t){return Math.sqrt(a(e,t))}function a(e,t){var n=r(e,t);return n.x*n.x+n.y*n.y}Object.defineProperty(t,"__esModule",{value:!0});var i={subtract:r,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:o,distanceSquared:a,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)},findClosestPoint:function(e,t){var n=[],r=void 0;return e.forEach((function(e,a){var i=o(e,t);n.push(i),r=0===a?i:Math.min(i,r)})),e[n.indexOf(r)]}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(3));function o(e){return{topLeft:{x:e.left,y:e.top},bottomRight:{x:e.left+e.width,y:e.top+e.height}}}var a={distanceToPoint:function(e,t){var n=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(e).forEach((function(e){var o=r.default.distanceToPoint(e,t);o<n&&(n=o)})),n},getIntersectionRect:function(e,t){var n={topLeft:{},bottomRight:{}};if(function(e,t){var n=void 0,r=void 0,a=o(e),i=o(t);return n=e.width>=0?t.width>=0?!(a.bottomRight.x<=i.topLeft.x||i.bottomRight.x<=a.topLeft.x):!(a.bottomRight.x<=i.bottomRight.x||i.topLeft.x<=a.topLeft.x):t.width>=0?!(a.topLeft.x<=i.topLeft.x||i.bottomRight.x<=a.bottomRight.x):!(a.topLeft.x<=i.bottomRight.x||i.topLeft.x<=a.bottomRight.x),r=e.height>=0?t.height>=0?!(a.bottomRight.y<=i.topLeft.y||i.bottomRight.y<=a.topLeft.y):!(a.bottomRight.y<=i.bottomRight.y||i.topLeft.y<=a.topLeft.y):t.height>=0?!(a.topLeft.y<=i.topLeft.y||i.bottomRight.y<=a.bottomRight.y):!(a.topLeft.y<=i.bottomRight.y||i.top<=a.bottomRight.y),n&&r}(e,t)){var r=o(e),a=o(t);return e.width>=0?t.width>=0?(n.topLeft.x=Math.max(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.bottomRight.x)):(n.topLeft.x=Math.max(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.min(r.bottomRight.x,a.topLeft.x)):t.width>=0?(n.topLeft.x=Math.min(r.topLeft.x,a.bottomRight.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.topLeft.x)):(n.topLeft.x=Math.min(r.topLeft.x,a.topLeft.x),n.bottomRight.x=Math.max(r.bottomRight.x,a.bottomRight.x)),e.height>=0?t.height>=0?(n.topLeft.y=Math.max(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.bottomRight.y)):(n.topLeft.y=Math.max(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.min(r.bottomRight.y,a.topLeft.y)):t.height>=0?(n.topLeft.y=Math.min(r.topLeft.y,a.bottomRight.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.topLeft.y)):(n.topLeft.y=Math.min(r.topLeft.y,a.topLeft.y),n.bottomRight.y=Math.max(r.bottomRight.y,a.bottomRight.y)),n}}};t.default=a}])},5720:e=>{
/*! cornerstone-tools - 6.0.9 - 2023-03-27 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=25)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(8),o=n(5);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(14);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var r=n(16),o=n(17),a=n(18);e.exports=function(e){return r(e)||o(e)||a()}},function(e,t,n){var r=n(20),o=n(21),a=n(22);e.exports=function(e,t){return r(e)||o(e,t)||a()}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";(function(e){var r=n(12),o={formatArgs:function(e){if(e[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),"+").concat(a.humanize(this.diff)),this.useColors){var t="color: ".concat(this.color);e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))})),e.splice(r,0,t)}},save:function(e){try{e?o.storage.setItem("debug",e):o.storage.removeItem("debug")}catch(e){}},load:function(){var t;try{t=o.storage.getItem("debug")}catch(e){}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},storage:function(){try{return localStorage}catch(e){}}(),colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"]};o.log=console.debug||console.log||function(){};var a=Object(r.a)(o);a.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: ".concat(e.message)}},t.a=a}).call(this,n(15))},function(e,t,n){e.exports=n(23)},function(e,t,n){"use strict";var r=n(6),o=n.n(r);t.a=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function o(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(o.enabled){var i=o,s=Number(new Date),l=s-(n||s);i.diff=l,i.prev=n,i.curr=s,n=s,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var c=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;c++;var o=r.formatters[n];if("function"==typeof o){var a=t[c];e=o.call(i,a),t.splice(c,1),c--}return e})),r.formatArgs.call(i,t),(i.log||r.log).apply(i,t)}}return o.namespace=e,o.enabled=r.enabled(e),o.useColors=r.useColors(),o.color=t(e),o.destroy=a,o.extend=i,"function"==typeof r.init&&r.init(o),r.instances.push(o),o}function a(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function i(e,t){var n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){var e=[].concat(o()(r.names.map(s)),o()(r.skips.map(s).map((function(e){return"-".concat(e)})))).join(",");return r.enable(""),e},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^".concat(e.substr(1),"$"))):r.names.push(new RegExp("^".concat(e,"$"))));for(t=0;t<r.instances.length;t++){var a=r.instances[t];a.enabled=r.enabled(a.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(19),Object.keys(e).forEach((function(t){r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t){function n(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function s(e){n(i,o,a,s,l,"next",e)}function l(e){n(i,o,a,s,l,"throw",e)}s(void 0)}))}}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){var n,r,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var l,c=[],u=!1,d=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&h())}function h(){if(!u){var e=s(f);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||s(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){var n=1e3,r=6e4,o=60*r,a=24*o;function i(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*o;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=a?i(e,t,a,"day"):t>=o?i(e,t,o,"hour"):t>=r?i(e,t,r,"minute"):t>=n?i(e,t,n,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=a?Math.round(e/a)+"d":t>=o?Math.round(e/o)+"h":t>=r?Math.round(e/r)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,a=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(24),o)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag",l="object"==typeof e,c=t.regeneratorRuntime;if(c)l&&(e.exports=c);else{(c=t.regeneratorRuntime=l?e.exports:{}).wrap=m;var u={},d={};d[a]=function(){return this};var f=Object.getPrototypeOf,h=f&&f(f(E([])));h&&h!==n&&r.call(h,a)&&(d=h);var p=b.prototype=v.prototype=Object.create(d);y.prototype=p.constructor=b,b.constructor=y,b[s]=y.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(p),e},c.awrap=function(e){return{__await:e}},x(w.prototype),w.prototype[i]=function(){return this},c.AsyncIterator=w,c.async=function(e,t,n,r){var o=new w(m(e,t,n,r));return c.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},x(p),p[s]="Generator",p[a]=function(){return this},p.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=E,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}}}function m(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),i=new C(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(o,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw a;return A()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var s=T(i,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=g(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,i),a}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function v(){}function y(){}function b(){}function x(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(n,o){function a(){return new Promise((function(t,a){!function t(n,o,a,i){var s=g(e[n],e,o);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,a,i)}),(function(e){t("throw",e,a,i)})):Promise.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return t("throw",e,a,i)}))}i(s.arg)}(n,o,t,a)}))}return t=t?t.then(a,a):a()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=g(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:A}}function A(){return{value:void 0,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"drawBrushPixels",(function(){return te})),n.d(r,"eraseIfSegmentIndex",(function(){return ee})),n.d(r,"eraseOutsideBoundingBox",(function(){return ne})),n.d(r,"eraseInsideShape",(function(){return se})),n.d(r,"eraseOutsideShape",(function(){return le})),n.d(r,"fillOutsideBoundingBox",(function(){return ce})),n.d(r,"fillInsideShape",(function(){return fe})),n.d(r,"fillOutsideShape",(function(){return he})),n.d(r,"floodFill",(function(){return pe})),n.d(r,"getBoundingBoxAroundCircle",(function(){return be})),n.d(r,"getBoundingBoxAroundPolygon",(function(){return xe})),n.d(r,"getCircle",(function(){return we})),n.d(r,"getPixelPathBetweenPixels",(function(){return Se})),n.d(r,"isSameSegment",(function(){return ae})),n.d(r,"triggerLabelmapModifiedEvent",(function(){return Le})),n.d(r,"getDiffBetweenPixelData",(function(){return Oe}));var o={};n.r(o),n.d(o,"angleCursor",(function(){return xo})),n.d(o,"arrowAnnotateCursor",(function(){return wo})),n.d(o,"bidirectionalCursor",(function(){return To})),n.d(o,"cobbAngleCursor",(function(){return Io})),n.d(o,"circleRoiCursor",(function(){return So})),n.d(o,"ellipticalRoiCursor",(function(){return Co})),n.d(o,"freehandRoiCursor",(function(){return Eo})),n.d(o,"freehandRoiSculptorCursor",(function(){return Ao})),n.d(o,"lengthCursor",(function(){return Mo})),n.d(o,"probeCursor",(function(){return Po})),n.d(o,"rectangleRoiCursor",(function(){return Do})),n.d(o,"textMarkerCursor",(function(){return ko})),n.d(o,"crosshairsCursor",(function(){return Lo})),n.d(o,"eraserCursor",(function(){return Oo})),n.d(o,"magnifyCursor",(function(){return Ro})),n.d(o,"panCursor",(function(){return _o})),n.d(o,"rotateCursor",(function(){return No})),n.d(o,"stackScrollCursor",(function(){return Bo})),n.d(o,"wwwcRegionCursor",(function(){return Uo})),n.d(o,"wwwcCursor",(function(){return Vo})),n.d(o,"zoomCursor",(function(){return Fo})),n.d(o,"freehandEraseInsideCursor",(function(){return Yo})),n.d(o,"freehandFillInsideCursor",(function(){return Zo})),n.d(o,"freehandEraseOutsideCursor",(function(){return Xo})),n.d(o,"freehandFillOutsideCursor",(function(){return Qo})),n.d(o,"segRectangleEraseInsideCursor",(function(){return Ko})),n.d(o,"segRectangleFillInsideCursor",(function(){return Jo})),n.d(o,"segRectangleEraseOutsideCursor",(function(){return $o})),n.d(o,"segRectangleFillOutsideCursor",(function(){return ea})),n.d(o,"segCircleEraseInsideCursor",(function(){return ta})),n.d(o,"segCircleFillInsideCursor",(function(){return na})),n.d(o,"segCircleEraseOutsideCursor",(function(){return ra})),n.d(o,"segCircleFillOutsideCursor",(function(){return oa}));var a=n(0),i=n.n(a),s=n(1),l=n.n(s),c=n(2),u=n.n(c),d=n(3),f=n.n(d),h=n(4),p=n.n(h),m=window.cornerstone,g=window.cornerstoneMath,v=window.Hammer,y={set cornerstone(e){m=e},get cornerstone(){return m},set cornerstoneMath(e){g=e},get cornerstoneMath(){return g},set Hammer(e){v=e},get Hammer(){return v}},b=n(8),x=n.n(b),w={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"};function T(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:r,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),e.dispatchEvent(n)}function I(e){return e instanceof HTMLElement?e:yt.enabledElementByUID(e)}var S={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1},C=S.UINT_16_ARRAY,E=S.FLOAT_32_ARRAY;function A(e,t,n){var r,o=xt("segmentation").configuration;switch(o.arrayType){case C:r=2;break;case E:r=4;break;default:throw new Error("Unsupported Array Type ".concat(o.arrayType))}e.labelmaps3D[t]={buffer:new ArrayBuffer(n*r),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}function M(){var e={};function t(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(r)}function n(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}}function r(t,n,r){e[t][n]=r}function o(t){!1!==e.hasOwnProperty(t)&&delete e[t]}return{get:function(e,t){var r=y.cornerstone.getEnabledElement(e);if(r.image)return n(r.image.imageId,t)},add:function(e,n,r){var o=y.cornerstone.getEnabledElement(e);o.image&&t(o.image.imageId,n,r)},set:function(e,t,n){var o=y.cornerstone.getEnabledElement(e);o.image&&r(o.image.imageId,t,n)},clear:function(e){var t=y.cornerstone.getEnabledElement(e);t.image&&o(t.image.imageId)},getImageIdToolState:n,addImageIdToolState:t,setImageIdToolState:r,clearImageIdToolState:o,saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var P=M();function D(e){var t=y.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=P),t.toolStateManager}function k(e,t,n){var r=D(e);n.uuid=n.uuid||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),r.add(e,t,n),T(e,w.MEASUREMENT_ADDED,{toolName:t,toolType:t,element:e,measurementData:n})}function L(e,t){return D(e).get(e,t)}function O(e,t,n){var r=D(e).get(e,t);if(r&&r.data&&r.data.length){for(var o=-1,a=0;a<r.data.length;a++)r.data[a]===n&&(o=a);-1!==o&&(r.data.splice(o,1),T(e,w.MEASUREMENT_REMOVED,{toolName:t,toolType:t,element:e,measurementData:n}))}}function R(e,t){var n=D(e).get(e,t);void 0!==n&&(n.data=[])}function _(e,t){y.cornerstone.getEnabledElement(e).toolStateManager=t}var N=n(10),B=Object(N.a)("cornerstoneTools"),U=function(e){var t=B.extend(e);return{log:t,warn:t,error:void 0}},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat("cornerstoneTools",":*");return N.a.enable(e)},F=function(){return N.a.disable()},j={series:{},colorLutTables:[]},H=U("store:modules:segmentationModule:metadata");function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"increase",n=xt("segmentation").configuration,r=L(e,"stack").data[0].imageIds[0],o=j.series[r];if(o){var a=o.activeLabelmapIndex,i=o.labelmaps3D[a];switch(t){case"increase":i.activeSegmentIndex++,i.activeSegmentIndex>n.segmentsPerLabelmap&&(i.activeSegmentIndex=1);break;case"decrease":i.activeSegmentIndex--,i.activeSegmentIndex<=0&&(i.activeSegmentIndex=n.segmentsPerLabelmap)}}}var q=U("store:modules:segmentationModule:segmentVisibility"),W=U("store:modules:segmentationModule:getLabelmaps3D");function G(e){var t=I(e);if(t){var n=L(t,"stack");if(n){var r,o,a=n.data[0],i=a.imageIds[0],s=j.series[i];return s&&(r=s.labelmaps3D,o=s.activeLabelmapIndex),{labelmaps3D:r,activeLabelmapIndex:o,currentImageIdIndex:a.currentImageIdIndex}}W.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}}function Y(e,t){var n=G(e),r=n.labelmaps3D,o=n.activeLabelmapIndex;return r[t=void 0!==t?t:o]}var Z=S.UINT_16_ARRAY,X=S.FLOAT_32_ARRAY;function Q(e,t){var n=I(e);if(n){var r=G(n).labelmaps3D;if(!r)return[];var o,a,i=xt("segmentation").configuration;switch(i.arrayType){case Z:o="Uint16Array",a="2";break;case X:o="Float32Array",a="4";break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}var s=j.colorLutTables;if(void 0!==t){var l=r[t];return l?{labelmapIndex:t,bytesPerVoxel:a,type:o,buffer:l.buffer,colorLUT:s[l.colorLUTIndex]}:void 0}for(var c=[],u=0;u<r.length;u++){var d=r[u];d&&c.push({labelmapIndex:u,bytesPerVoxel:2,buffer:d.buffer,colorLUT:s[d.colorLUTIndex]})}return c}}var K=n(6),J=n.n(K);function $(e){return J()(new Set(e))}function ee(e,t,n){t[e]===n&&(t[e]=0)}function te(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(e,t){return t*r+e};e.forEach((function(e){var r=a.apply(void 0,J()(e));o?ee(r,t,n):t[r]=n}))}function ne(e,t,n,r){for(var o=e.detail,a=t.pixelData,i=t.segmentIndex,s=o.image,l=s.width,c=s.height,u=0;u<l;u++)for(var d=0;d<n[1];d++)ee(d*l+u,a,i);for(var f=0;f<n[0];f++)for(var h=n[1];h<r[1];h++)ee(h*l+f,a,i);for(var p=r[0];p<l;p++)for(var m=n[1];m<r[1];m++)ee(m*l+p,a,i);for(var g=0;g<l;g++)for(var v=r[1];v<c;v++)ee(v*l+g,a,i)}var re=n(7),oe=n.n(re);function ae(e,t,n){return t[e]===n}function ie(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=e.detail.image.width,s=t.pixelData,l=t.segmentIndex,c=oe()(r,2),u=c[0],d=c[1],f=oe()(o,2),h=f[0],p=f[1];"outside"===a&&ne(e,t,r,o);for(var m=u;m<h;m++)for(var g=d;g<p;g++){var v=g*i+m;ae(v,s,l)&&n({x:m,y:g})&&(s[v]=0)}}function se(e,t,n,r,o){ie(e,t,n,r,o,"inside")}function le(e,t,n,r,o){ie(e,t,(function(e){return!n(e)}),r,o,"outside")}function ce(e,t,n,r){for(var o=t.pixelData,a=t.segmentIndex,i=e.detail.image,s=i.width,l=i.height,c=0;c<s;c++)for(var u=0;u<n[1];u++)o[u*s+c]=a;for(var d=0;d<n[0];d++)for(var f=n[1];f<r[1];f++)o[f*s+d]=a;for(var h=r[0];h<s;h++)for(var p=n[1];p<r[1];p++)o[p*s+h]=a;for(var m=0;m<s;m++)for(var g=r[1];g<l;g++)o[g*s+m]=a}U("util:segmentation:operations:eraseOutsideCircle");var ue=U("util:segmentation:operations:helpers:fillShape");function de(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"inside",i=t.pixelData,s=t.segmentIndex;if(void 0!==i&&void 0!==s){var l=e.detail.image.width,c=oe()(r,2),u=c[0],d=c[1],f=oe()(o,2),h=f[0],p=f[1];"outside"===a&&ce(e,t,r,o);for(var m=u;m<h;m++)for(var g=d;g<p;g++){var v=g*l+m;n({x:m,y:g})&&(i[v]=s)}}else ue.error("fillInsideShape requires operationData to contain pixelData and segmentIndex")}function fe(e,t,n,r,o){de(e,t,n,r,o,"inside")}function he(e,t,n,r,o){de(e,t,(function(e){return!n(e)}),r,o,"outside")}var pe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.onFlood||function(){},o=n.onBoundary||function(){},a=n.equals||me,i=n.diagonals||!1,s=x(t),l=T(),c=[],u=[],d={},f={};for(c.push({currentArgs:t});c.length>0;)h(c.pop());return{flooded:u,boundaries:S()};function h(e){var t=e.currentArgs,n=e.previousArgs;p(t)||(m(t),g(t)?(v(t),b(t)):y(n))}function p(e){return!0===d[e]}function m(e){d[e]=!0}function g(e){var t=w(x,[e]);return w(a,[t,s])}function v(e){u.push(e),r.apply(void 0,J()(e))}function y(e){f[e]=e,o.apply(void 0,J()(e))}function b(e){for(var t=0;t<l.length;t+=1){for(var n=l[t],r=e.slice(0),o=0;o<e.length;o+=1)r[o]+=n[o];c.push({currentArgs:r,previousArgs:e})}}function x(t){return e.apply(void 0,J()(t))}function w(e,t){try{return e.apply(void 0,J()(t))}catch(e){return}}function T(){return I(t.length).filter((function(e){var t=ge(e);return 0!==t&&(1===t||i)}))}function I(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},r=0;r<Math.pow(3,e);r+=1){var o=ve(r.toString(3),"0",e);t.push(n(o))}return t}function S(){var e=[];for(var t in f)f.hasOwnProperty(t)&&e.unshift(f[t]);return e}};function me(e,t){return e===t}function ge(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function ve(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}function ye(e,t){var n=(0,y.cornerstoneMath.point.distance)(e,t);return{left:Math.floor(Math.min(e.x-n,t.x)),top:Math.floor(Math.min(e.y-n,t.y)),width:2*n,height:2*n}}function be(e){var t=e.detail.handles,n=e.detail.image,r=n.width,o=n.height,a=ye(t.start,t.end),i=a.width+a.left,s=a.left,l=a.top+a.height,c=a.top;return s=Math.floor(s),c=Math.floor(c),i=Math.floor(i),l=Math.floor(l),i=Math.min(r,i),s=Math.max(0,s),l=Math.min(o,l),[[s,c=Math.max(0,c)],[i,l]]}function xe(e,t){var n=1/0,r=0,o=1/0,a=0,i=t.width,s=t.height;return e.forEach((function(e){n=Math.min(e[0],n),r=Math.max(e[0],r),o=Math.min(e[1],o),a=Math.max(e[1],a)})),n=Math.floor(n),o=Math.floor(o),r=Math.floor(r),a=Math.floor(a),r=Math.min(i,r),n=Math.max(0,n),a=Math.min(s,a),o=Math.max(0,o),[[n,o],[r,a]]}function we(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Math.floor(r),i=Math.floor(o);if(1===e)return[[a,i]];for(var s=[],l=0,c=-e;c<=e;c++){var u=i+c;if(!(u>t||u<0))for(var d=-e;d<=e;d++){var f=a+d;f>=n||f<0||d*d+c*c<e*e&&(s[l++]=[a+d,i+c])}}return s}var Te=1/Math.sqrt(2),Ie={up:{x:0,y:1},upRight:{x:Te,y:Te},right:{x:1,y:0},downRight:{x:Te,y:-Te},down:{x:0,y:1},downLeft:{x:-Te,y:-Te},left:{x:-1,y:0},upLeft:{x:-Te,y:Te}},Se=function(e,t){for(var n={x:e.x,y:e.y},r=[];t.x!==n.x||t.y!==n.y;)t.x===n.x?t.y>n.y?n.y++:n.y--:t.y===n.y?t.x>n.x?n.x++:n.x--:t.y>n.y?t.x>n.x?Ce(n,t):Ee(n,t):t.x>n.x?Ae(n,t):Me(n,t),r.push({x:n.x,y:n.y});return r.pop(),r};function Ce(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.up),De(n,Ie.right),De(n,Ie.upRight)])){case 0:e.y++;break;case 1:e.x++;break;case 2:e.y++,e.x++}}function Ee(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.up),De(n,Ie.left),De(n,Ie.upLeft)])){case 0:e.y++;break;case 1:e.x--;break;case 2:e.y++,e.x--}}function Ae(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.down),De(n,Ie.right),De(n,Ie.downRight)])){case 0:e.y--;break;case 1:e.x++;break;case 2:e.y--,e.x++}}function Me(e,t){var n=Pe(e,t);switch(ke([De(n,Ie.down),De(n,Ie.left),De(n,Ie.downLeft)])){case 0:e.y--;break;case 1:e.x--;break;case 2:e.y--,e.x--}}function Pe(e,t){var n=y.cornerstoneMath.point.distance(e,t);return{x:(t.x-e.x)/n,y:(t.y-e.y)/n}}function De(e,t){return e.x*t.x+e.y*t.y}function ke(e){var t=e[0]>e[1]?0:1;return e[2]>e[t]&&(t=2),t}function Le(e,t){var n=xt("segmentation").getters;t=void 0===t?n.activeLabelmapIndex(e):t,y.cornerstone.triggerEvent(e,w.LABELMAP_MODIFIED,{labelmapIndex:t})}function Oe(e,t){for(var n=[],r=0;r<e.length;r++)e[r]!==t[r]&&n.push([r,e[r],t[r]]);return n}var Re=S.UINT_16_ARRAY,_e=S.FLOAT_32_ARRAY;function Ne(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=xt("segmentation").configuration,l=j.series[e];l||(j.series[e]={activeLabelmapIndex:n,labelmaps3D:[]},l=j.series[e]),l.labelmaps3D[n]={buffer:t,labelmaps2D:[],metadata:r,activeSegmentIndex:1,colorLUTIndex:i,segmentsHidden:[],undo:[],redo:[]};for(var c=l.labelmaps3D[n].labelmaps2D,u=t.byteLength/o,d=0;d<o;d++){var f=void 0;switch(s.arrayType){case Re:f=new Uint16Array(t,u*d,u/2);break;case _e:f=new Float32Array(t,u*d,u/4);break;default:throw new Error("Unsupported Array Type ".concat(s.arrayType))}var h=a?a[d]:$(f);h&&h.some((function(e){return e}))&&(c[d]={pixelData:f,segmentsOnLabelmap:h})}}var Be=U("store:modules:segmentationModule:getLabelmapStats");function Ue(e,t,n){var r=e.length,o=t[n].imagePositionPatient;if(0===n)return Ve(o,t[n+1].imagePositionPatient);if(n===r-1)return Ve(o,t[n-1].imagePositionPatient);var a=t[n-1].imagePositionPatient,i=t[n+1].imagePositionPatient;return(Ve(o,a)+Ve(o,i))/2}function Ve(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}var Fe=S.UINT_16_ARRAY,je=S.FLOAT_32_ARRAY;function He(e,t,n,r,o){var a,i=xt("segmentation").configuration,s=r*o,l=s*n;switch(i.arrayType){case Fe:a=new Uint16Array(e.labelmaps3D[t].buffer,2*l,s);break;case je:a=new Float32Array(e.labelmaps3D[t].buffer,4*l,s);break;default:throw new Error("Unsupported Array Type ".concat(i.arrayType))}e.labelmaps3D[t].labelmaps2D[n]={pixelData:a,segmentsOnLabelmap:[]}}var ze=S.UINT_16_ARRAY,qe=S.FLOAT_32_ARRAY,We=U("store:modules:segmentationModule:getLabelmap2D");function Ge(e,t,n){var r=e.x,o=e.y;return r<n&&r>=0&&o<t&&o>=0}var Ye=U("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent"),Ze=U("store:modules:segmentationModule:setColorLUT");function Xe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=xt("segmentation").configuration.segmentsPerLabelmap;t?(Ke(t,n),t.length<n&&(t=[].concat(J()(t),J()(Je(n-t.length))))):t=t||Je(n),t.unshift([0,0,0,0]),j.colorLutTables[e]=t}function Qe(e){return"number"==typeof e?j.colorLutTables[e]:j.colorLutTables[e.colorLUTIndex]}function Ke(e,t){e.length<t?Ze.warn("The provided colorLUT only provides ".concat(e.length," labels, whereas segmentsPerLabelmap is set to ").concat(t,". Autogenerating the rest.")):e.length>t&&Ze.warn("segmentsPerLabelmap is set to ".concat(t,", and the provided colorLUT provides ").concat(e.length,". Using the first ").concat(t," colors from the LUT."))}function Je(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,t=[],n=0;n<e;n++)t.push(rt(et(),nt()));return t}var $e=222.5;function et(){return($e+=137.5)>=360&&($e-=360),$e}var tt=.6;function nt(){return(tt+=.07)>.82&&(tt=tt-.82+.3),tt}function rt(e){var t,n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.6,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=(1-Math.abs(2*a-1))*o,l=s*(1-Math.abs(e/60%2-1)),c=a-s/2;return e<60?(t=s,n=l,r=0):e<120?(t=l,n=s,r=0):e<180?(t=0,n=s,r=l):e<240?(t=0,n=l,r=s):e<300?(t=l,n=0,r=s):e<360&&(t=s,n=0,r=l),[255*(t+c),255*(n+c),255*(r+c),i]}var ot=U("store:modules:segmentationModule:getBrushColor"),at={renderOutline:!0,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:S.UINT_16_ARRAY},it=U("util:segmentation:labelmap3DHistory");function st(e,t,n){var r=e.labelmaps2D;t.forEach((function(e){for(var t=e.imageIdIndex,o=e.diff,a=r[t].pixelData,i=0;i<o.length;i++){var s=o[i];a[s[0]]=s[n]}}))}var lt={state:j,configuration:at,onRegisterCallback:function(){Xe(0)},getters:{metadata:function(e,t,n){var r=I(e);if(r){var o=L(r,"stack").data[0].imageIds[0],a=j.series[o];if(a){if(t=void 0===t?a.activeLabelmapIndex:t,a.labelmaps3D[t]){var i=a.labelmaps3D[t];return void 0===n?i.metadata:i.metadata[n]}H.warn("No labelmap3D of labelmap index ".concat(t," on stack."))}else H.warn("brushStackState is undefined")}},labelmap3D:Y,labelmaps3D:G,activeLabelmapIndex:function(e){var t=I(e);if(t){var n=L(t,"stack").data[0].imageIds[0],r=j.series[n];if(r)return r.activeLabelmapIndex}},activeSegmentIndex:function(e,t){var n=I(e);if(n){var r=L(n,"stack").data[0].imageIds[0],o=j.series[r];if(o){t=void 0===t?o.activeLabelmapIndex:t;var a=o.labelmaps3D[t];if(a)return a.activeSegmentIndex}return 1}},isSegmentVisible:function(e,t,n){if(t){var r=I(e);if(r){var o=L(r,"stack").data[0].imageIds[0],a=j.series[o];if(a){if(n=void 0===n?a.activeLabelmapIndex:n,a.labelmaps3D[n])return!a.labelmaps3D[n].segmentsHidden[t];q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},labelmap2D:function(e){var t=I(e);if(t){var n=y.cornerstone,r=L(t,"stack");if(r){var o,a=r.data[0],i=n.getEnabledElement(t),s=a.currentImageIdIndex,l=i.image,c=l.rows,u=l.columns,d=a.imageIds.length,f=a.imageIds[0],h=j.series[f];h?(o=h.activeLabelmapIndex,h.labelmaps3D[o]||A(h,o,c*u*d),h.labelmaps3D[o].labelmaps2D[s]||He(h,o,s,c,u)):(o=0,j.series[f]={activeLabelmapIndex:o,labelmaps3D:[]},A(h=j.series[f],o,c*u*d),He(h,o,s,c,u));var p=h.labelmaps3D[o];return{labelmap2D:p.labelmaps2D[s],labelmap3D:p,currentImageIdIndex:s,activeLabelmapIndex:o}}We.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmap2DByImageIdIndex:function(e,t,n,r){if(!e.labelmaps2D[t]){var o,a=xt("segmentation").configuration,i=n*r,s=i*t;switch(a.arrayType){case ze:o=new Uint16Array(e.buffer,2*s,i);break;case qe:o=new Float32Array(e.buffer,4*s,i);break;default:throw new Error("Unsupported Array Type ".concat(a.arrayType))}e.labelmaps2D[t]={pixelData:o,segmentsOnLabelmap:$(o)}}return e.labelmaps2D[t]},labelmapStats:function(e,t,n){var r=y.cornerstone,o=I(e);if(!o)return null;var a=L(o,"stack").data[0].imageIds,i=a[0];return new Promise((function(e){var o=j.series[i];o||e(null);var s=function(e){for(var t=[],n=y.cornerstone.metaData,r=!0,o=0;o<e.length;o++){var a=n.get("imagePlaneModule",e[o]);if(!a){r=!1;break}t.push(a)}return{sufficientMetadata:r,imagePlanes:t}}(a),l=s.sufficientMetadata,c=s.imagePlanes;l||(Be.warn("Insufficient imagePlaneModule information to calculate volume statistics."),e(null)),n=void 0===n?o.activeLabelmapIndex:n;for(var u=o.labelmaps3D[n],d=[],f=0;f<a.length;f++)d.push(r.loadAndCacheImage(a[f]));Promise.all(d).then((function(n){var r=function(e,t,n,r){for(var o=function(e,t,n,r){for(var o=t[0],a=o.rowPixelSpacing,i=o.columnPixelSpacing,s=e.labelmaps2D,l=[],c=0;c<s.length;c++){var u=s[c];if(u&&u.segmentsOnLabelmap.includes(r)){for(var d=Ue(t,n,c)*a*i,f=u.pixelData,h=t[c].getPixelData(),p=[],m=0;m<f.length;m++)f[m]===r&&p.push(h[m]);l.push({voxelInMM3:d,values:p})}}return l}(e,t,n,r),a=0,i=o[0].values[0],s=i,l=0,c=0;c<o.length;c++){var u=o[c],d=u.values,f=u.voxelInMM3;l+=f*d.length;var h=0;d.forEach((function(e){e>i?i=e:e<s&&(s=e),h+=e})),a+=h*f}a/=l;for(var p=0,m=0;m<o.length;m++){var g=o[m],v=(d=g.values,f=g.voxelInMM3,0);d.forEach((function(e){v+=Math.pow(e-a,2)})),p+=v*f}return p/=l,p=Math.sqrt(p),{volume:l,mean:a,stdDev:p,max:i,min:s}}(u,n,c,t);e(r)}))}))},segmentOfActiveLabelmapAtEvent:function(e){var t=e.detail,n=t.element,r=t.image,o=t.currentPoints;if(o){var a=r.width,i=r.height;if(n){var s=L(n,"stack").data[0],l=s.currentImageIdIndex,c=s.imageIds[0],u=j.series[c],d=u.activeLabelmapIndex,f=u.labelmaps3D[d];if(f){var h=f.labelmaps2D[l];if(h){var p=h.pixelData,m=o.image,g=m.x,v=m.y;if(Ge({x:g=Math.floor(g),y:v=Math.floor(v)},i,a)){var y=p[v*a+g];if(0===y)return;return{segmentIndex:y,metadata:f.metadata[y]}}}}}}else Ye.warn("Not a cornerstone input event.")},brushColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=I(e);if(n){var r=L(n,"stack");if(r){var o,a=r.data[0].imageIds[0],i=j.series[a];if(i){var s=i.activeLabelmapIndex,l=i.labelmaps3D[s],c=l.activeSegmentIndex;o=j.colorLutTables[l.colorLUTIndex][c]}else o=j.colorLutTables[0][1];return t?"rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 1.0 )"):"rgba(".concat(o[0],", ").concat(o[1],", ").concat(o[2],", 0.8 )")}ot.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.")}},labelmapBuffers:Q,activeLabelmapBuffer:function(e){var t=I(e);if(t){var n=L(t,"stack").data[0].imageIds[0],r=j.series[n];if(r)return Q(t,r.activeLabelmapIndex)}},colorLUT:Qe,colorForSegmentIndexColorLUT:function(e,t){return Qe(e)[t]}},setters:{metadata:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=I(e);if(o){var a=y.cornerstone,i=L(o,"stack").data[0],s=i.imageIds[0],l=j.series[s];if(l||(j.series[s]={labelmapIndex:t,labelmaps3D:[]},l=j.series[s]),!l.labelmaps3D[t]){var c=a.getEnabledElement(o).image;A(l,t,c.rows*c.columns*i.imageIds.length)}l.labelmaps3D[t].metadata[n]=r}},labelmap3DForElement:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=I(e);if(i){var s=L(i,"stack"),l=s.data[0].imageIds.length;Ne(s.data[0].imageIds[0],t,n,r,l,o,a),Le(i,n)}},labelmap3DByFirstImageId:Ne,incrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"increase")},decrementActiveSegmentIndex:function(e){var t=I(e);t&&z(t,"decrease")},activeSegmentIndex:function(e,t){var n=I(e);if(n){var r=L(n,"stack").data[0].imageIds[0],o=j.series[r];if(o){var a=o.activeLabelmapIndex,i=o.labelmaps3D[a],s=xt("segmentation").configuration;t<=0?t=1:t>s.segmentsPerLabelmap&&(t=s.segmentsPerLabelmap),i.activeSegmentIndex=t}}},toggleSegmentVisibility:function(e,t,n){if(t){var r=I(e);if(r){var o=L(r,"stack").data[0].imageIds[0],a=j.series[o];if(a){if(n=void 0===n?a.activeLabelmapIndex:n,a.labelmaps3D[n]){var i=a.labelmaps3D[n].segmentsHidden;return i[t]=!i[t],!i[t]}q.warn("No labelmap3D of labelmap index ".concat(n," on stack."))}else q.warn("brushStackState is undefined")}}},updateSegmentsOnLabelmap2D:function(e){e.segmentsOnLabelmap=$(e.pixelData)},deleteSegment:function(e,t,n){if(t){var r=I(e);if(r){var o=L(r,"stack").data[0].imageIds[0],a=j.series[o];if(a){n=void 0===n?a.activeLabelmapIndex:n;var i=a.labelmaps3D[n];if(i){delete i.metadata[t];for(var s=i.labelmaps2D,l=0;l<s.length;l++){var c=s[l];if(c&&c.segmentsOnLabelmap.includes(t)){var u=c.pixelData,d=c.segmentsOnLabelmap.indexOf(t);c.segmentsOnLabelmap.splice(d,1);for(var f=0;f<u.length;f++)u[f]===t&&(u[f]=0)}}y.cornerstone.updateImage(r)}}}}},colorLUT:Xe,colorLUTIndexForLabelmap3D:function(e,t){e.colorLUTIndex=t},colorForSegmentIndexOfColorLUT:function(e,t,n){Qe(e)[t]=n},activeLabelmapIndex:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=I(e);if(n){var r=y.cornerstone,o=L(n,"stack").data[0],a=r.getEnabledElement(n).image,i=a.rows*a.columns*o.imageIds.length,s=o.imageIds[0],l=j.series[s];l?(l.activeLabelmapIndex=t,l.labelmaps3D[t]||A(l,t,i)):(j.series[s]={activeLabelmapIndex:t,labelmaps3D:[]},A(l=j.series[s],t,i)),r.updateImage(n)}},radius:function(e){var t=xt("segmentation").configuration;t.radius=Math.min(Math.max(e,t.minRadius),t.maxRadius)},pushState:function(e,t,n){var r=Y(e,n);r.undo.push(t),r.redo=[]},undo:function(e,t){var n=Y(e,t),r=n.undo,o=n.redo;if(r.length){var a=r.pop();st(n,a,1),o.push(a),y.cornerstone.updateImage(e)}else it.warn("No undos left.")},redo:function(e,t){var n=Y(e,t),r=n.undo,o=n.redo;if(o.length){var a=o.pop();st(n,a,2),r.push(a),y.cornerstone.updateImage(e)}else it.warn("No redos left.")}}},ct={activeManipulators:{}};function ut(e){var t=y.cornerstone.getEnabledElement(e).uuid;delete ct.activeManipulators[t]}function dt(e){var t=ct.activeManipulators,n=t[e];"function"==typeof n&&n(),delete t[e]}function ft(e){ut(e.detail.element)}var ht={setters:{addActiveManipulatorForElement:function(e,t){var n=y.cornerstone.getEnabledElement(e).uuid;ct.activeManipulators[n]=t},removeActiveManipulatorForElement:ut,cancelActiveManipulatorsForElement:function(e){dt(y.cornerstone.getEnabledElement(e).uuid)},cancelActiveManipulators:function(){var e=ct.activeManipulators;Object.keys(e).forEach((function(e){return dt(e)}))}},state:ct,enabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ft),e.addEventListener(t,ft)},removeEnabledElementCallback:function(e){var t=y.cornerstone.EVENTS.NEW_IMAGE;e.removeEventListener(t,ft),ut(e)}},pt={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>\n    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>\n  '},mt={configuration:pt,getters:{defaultOptions:function(){return pt}},setters:{defaultOptions:function(e){Object.assign(pt,e)}}},gt={configuration:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]}},vt=(U("store:modules:storeLogger"),{globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,preventTextBoxOutsideDisplayedArea:!1,handleTouchOffset:{x:0,y:-57},svgCursorUrl:null}),yt={mouseTools:function(){return vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Mouse")}))},touchTools:function(){return vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("Touch")}))},enabledElementByUID:function(e){return vt.enabledElements.find((function(t){return y.cornerstone.getEnabledElement(t).uuid===e}))}},bt={segmentation:lt,cursor:mt,globalConfiguration:gt,manipulatorState:ht};function xt(e){return bt[e]}var wt={modules:bt,state:vt,getters:yt},Tt=function(e,t){return vt.tools.find((function(n){return n.element===e&&n.name===t}))},It=bt.globalConfiguration;function St(e,t){if(It.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),r=t.mousePoint,o=window.URL.createObjectURL(n);e.style.cursor="url('".concat(o,"') ").concat(r,", auto"),vt.svgCursorUrl=o}}function Ct(e){It.configuration.showSVGCursors&&Et(e,"none")}function Et(e,t){vt.svgCursorUrl&&window.URL.revokeObjectURL(vt.svgCursorUrl),vt.svgCursorUrl=null,e.style.cursor=t}var At=xt("globalConfiguration"),Mt=U("store:setToolMode"),Pt=function(e,t,n,r){void 0===r&&Array.isArray(n)&&(r=n,n=null);var o=Tt(e,t);o&&(function(e,t,n,r){t.supportedInteractionTypes.forEach((function(o){if(void 0===r||r.includes(o)){var a=jt[o];a?a(t,e,n):Mt.warn("Unable to resolve input conflicts for type %s",o)}})),wt.state.tools.filter((function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0})).forEach((function(t){var n=!1;t.supportedInteractionTypes.forEach((function(e){t.options["is".concat(e,"Active")]&&(n=!0)})),n||(Mt.log("Setting tool %s's to PASSIVE",t.name),_t(e,t.name))}))}(e,o,n,r),o.supportedInteractionTypes.forEach((function(e){void 0===r||r.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),At.configuration.showSVGCursors&&o.supportedInteractionTypes.includes("Mouse")&&function(e,t,n){("number"==typeof t?[t]:t.mouseButtonMask).includes(1)&&(n.svgCursor?St(n.element,n.svgCursor):n.hideDefaultCursor?Ct(e):function(e){Et(e,"initial")}(e))}(e,n,o)),Bt("active",null,e,t,n)},Dt=function(e,t,n){Ft("active",e,t,n),wt.state.enabledElements.forEach((function(r){Pt(r,e,t,n)}))},kt=Bt.bind(null,"disabled",null),Lt=Ut.bind(null,"disabled",null),Ot=Bt.bind(null,"enabled",null),Rt=Ut.bind(null,"enabled",null),_t=Bt.bind(null,"passive",w.TOOL_DEACTIVATED),Nt=Ut.bind(null,"passive",w.TOOL_DEACTIVATED);function Bt(e,t,n,r,o){var a,i,s=Tt(n,r);s?(o=Ht(o),Array.isArray(o.mouseButtonMask)&&0!==o.mouseButtonMask.length&&Array.isArray(s.options.mouseButtonMask)&&(o.mouseButtonMask=(a=o.mouseButtonMask,i=s.options.mouseButtonMask,a.concat(i).reduce((function(e,t){return-1===e.indexOf(t)&&e.push(t),e}),[]))),s.mode=e,s.mergeOptions(o),s["".concat(e,"Callback")]&&s["".concat(e,"Callback")](n,o),t&&T(n,t,{options:o,toolName:r,toolType:r,type:t})):Mt.warn('Unable to find tool "%s" for enabledElement',r)}function Ut(e,t,n,r){Ft(e,n,r),wt.state.enabledElements.forEach((function(o){Bt(e,t,o,n,r)}))}function Vt(e,t,n){var r="is".concat(e,"Active"),o=wt.state.tools.find((function(e){return e.element===n&&"active"===e.mode&&!0===e.options[r]}));o&&(Mt.log("Setting tool %s's %s to false",o.name,r),o.options[r]=!1)}function Ft(e,t,n,r){if(At.configuration.globalToolSyncEnabled){var o={mode:e,args:[t,n]};r&&o.push(r),wt.state.globalToolChangeHistory.push(o),wt.state.globalToolChangeHistory.length>50&&wt.state.globalToolChangeHistory.shift();var a=wt.state.globalTools[t];if(a)if("active"===e){var i=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var r=[],o=wt.state.globalTools[e];if(o){var a=new o.tool(o.props);a.supportedInteractionTypes.forEach((function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var o=Ht(t).mouseButtonMask;Array.isArray(o)&&o.length>0?o.forEach((function(t){return r.push("".concat(e,"-").concat(t))})):Array.isArray(o)&&0===o.length&&r.push("".concat(e,"-DELETE"))}else"MultiTouch"===e?r.push("".concat(e,"-").concat(a.configuration.touchPointers)):r.push(e)}))}return r}(t,n,r);Object.keys(wt.state.globalTools).forEach((function(e){var t=wt.state.globalTools[e];t.activeBindings=t.activeBindings.filter((function(e){return!i.includes(e)}))})),i.some((function(e){return e.includes("Mouse-DELETE")}))&&(a.activeBindings=a.activeBindings.filter((function(e){return!e.includes("Mouse")})),i=i.filter((function(e){return!e.includes("Mouse")}))),a.activeBindings=a.activeBindings.concat(i)}else a.activeBindings=[];else Mt.warn("setToolMode call for tool not available globally: ".concat(t))}}var jt={Mouse:function(e,t,n){var r=Ht(n).mouseButtonMask;if(Array.isArray(r)&&r.length>0){var o=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some((function(e){return r.includes(e)}))}));o&&(o.options.mouseButtonMask=o.options.mouseButtonMask.filter((function(e){return!r.includes(e)})),0===o.options.mouseButtonMask.length&&(o.options.isMouseActive=!1))}},MouseWheel:Vt.bind(void 0,"MouseWheel"),Touch:function(e,t){var n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),r=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers}));n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1),r&&(Mt.log("Setting tool %s's isTouchActive to false",r.name),r.options.isMultiTouchActive=!1)},TouchPinch:Vt.bind(void 0,"TouchPinch"),TouchRotate:Vt.bind(void 0,"TouchRotate"),DoubleTap:Vt.bind(void 0,"DoubleTap"),MultiTouch:function(e,t){var n,r=wt.state.tools.find((function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers}));1===e.configuration.touchPointers&&(n=wt.state.tools.find((function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}))),r&&(Mt.log("Setting tool %s's isMultiTouchActive to false",r.name),r.options.isMultiTouchActive=!1),n&&(Mt.log("Setting tool %s's isTouchActive to false",n.name),n.options.isTouchActive=!1)}};function Ht(e){return Array.isArray(e)?e={mouseButtonMask:e}:e!==Object(e)&&(e={mouseButtonMask:[e]}),e.hasOwnProperty("mouseButtonMask")||(e.mouseButtonMask=[]),Array.isArray(e.mouseButtonMask)||(e.mouseButtonMask=[e.mouseButtonMask]),e.mouseButtonMask=e.mouseButtonMask.filter((function(e){return"number"==typeof e&&0!==e})),e}var zt={passiveCallback:function(e){kt(e,this.name)},enabledCallback:function(e){Pt(e,this.name)}},qt={passiveCallback:function(e){kt(e,this.name)},activeCallback:function(e){Ot(e,this.name)}},Wt=function(e,t){e.save(),t(e),e.restore()},Gt=1,Yt=2,Zt={setToolWidth:function(e){Gt=e},getToolWidth:function(){return Gt},setActiveWidth:function(e){Yt=e},getActiveWidth:function(){return Yt}},Xt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.color,o=t.lineWidth,a=t.fillStyle,i=t.lineDash,s=t.shouldDrawLines,l=void 0===s||s;e.beginPath(),e.strokeStyle=r||e.strokeStyle,e.lineWidth=o||void 0===o&&Zt.getToolWidth()||e.lineWidth,i&&e.setLineDash(i),n(e),a&&(e.fillStyle=a,e.fill()),l&&e.stroke(),i&&e.setLineDash([])};function Qt(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Xt(e,o,(function(e){"pixel"===a&&(n=y.cornerstone.pixelToCanvas(t,n),r=y.cornerstone.pixelToCanvas(t,r)),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y)}))}var Kt=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";Xt(e,o,(function(e){"pixel"===a&&(n=y.cornerstone.pixelToCanvas(t,n),r=r.map((function(e){return y.cornerstone.pixelToCanvas(t,e)}))),e.moveTo(n.x,n.y),r.forEach((function(t){var n=t.x,r=t.y;e.lineTo(n,r)}))}))},Jt=function(e,t,n,r,o,a){var i=Math.atan2(n.y-t.y,n.x-t.x),s={color:r,lineWidth:o};a&&(s.lineDash=a),Qt(e,void 0,t,n,s,"canvas"),s={color:r,lineWidth:o,fillStyle:r};var l=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];Kt(e,void 0,n,l,s,"canvas")},$t=function(e,t,n,r,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n)),Xt(e,o,(function(e){e.arc(n.x,n.y,r,0,2*Math.PI)}))};function en(e){var t=y.cornerstoneMath;if(e instanceof t.Vector3)return e;var n=Object.keys(e);return n.includes("x")&&n.includes("y")&&n.includes("z")?new t.Vector3(e.x,e.y,e.z):new t.Vector3(e[0],e[1],e[2])}function tn(e,t){var n=en(t.rowCosines),r=en(t.columnCosines),o=en(t.imagePositionPatient),a=e.clone().sub(o);return{x:n.dot(a)/t.columnPixelSpacing,y:r.dot(a)/t.rowPixelSpacing}}function nn(e,t){var n=en(t.rowCosines),r=en(t.columnCosines),o=en(t.imagePositionPatient),a=n.clone().multiplyScalar(e.x);a.multiplyScalar(t.columnPixelSpacing);var i=r.clone().multiplyScalar(e.y);i.multiplyScalar(t.rowPixelSpacing);var s=a.add(i);return s.add(o),s}function rn(e,t){var n=en(e.rowCosines),r=en(e.columnCosines),o=en(e.imagePositionPatient),a=en(t.rowCosines),i=en(t.columnCosines),s=en(t.imagePositionPatient),l=n.clone().cross(r),c=new y.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,o);var u=a.clone().cross(i),d=new y.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var f=d.clone().intersectPlane(c),h=f.origin,p=f.direction,m=nn({x:t.columns,y:t.rows},t),g=s.distanceTo(m),v=new y.cornerstoneMath.Line3;v.start=h,v.end=h.clone().add(p.multiplyScalar(g));var b=function(e,t){var n=[];return Object.keys(t).forEach((function(r){var o=t[r],a=e.intersectLine(o);a&&n.push(a)})),n}(v,function(e){var t=nn({x:0,y:0},e),n=nn({x:e.columns,y:0},e),r=nn({x:0,y:e.rows},e),o=nn({x:e.columns,y:e.rows},e);return{top:new y.cornerstoneMath.Line3(t,n),left:new y.cornerstoneMath.Line3(t,r),right:new y.cornerstoneMath.Line3(n,o),bottom:new y.cornerstoneMath.Line3(r,o)}}(t));if(2===b.length)return{start:b[0],end:b[1]}}function on(e,t,n){var r=n*(Math.PI/180);return{x:Math.cos(r)*(e.x-t.x)-Math.sin(r)*(e.y-t.y)+t.x,y:Math.sin(r)*(e.x-t.x)+Math.cos(r)*(e.y-t.y)+t.y}}var an=function(e,t,n,r,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=y.cornerstone.pixelToCanvas(t,n),r=y.cornerstone.pixelToCanvas(t,r));var i=y.cornerstone.getViewport(t),s=t.clientWidth,l=t.clientHeight,c=i.scale,u=i.translation,d=i.rotation-a,f={x:s/2+u.x*c,y:l/2+u.y*c};Math.abs(d)>.05&&(n=on(n,f,-d),r=on(r,f,-d));var h=Math.abs(n.x-r.x),p=Math.abs(n.y-r.y),m=Math.min(n.x,r.x),g=Math.min(n.y,r.y),v={x:m+h/2,y:g+p/2};Math.abs(d)>.05&&(v=on(v,f,d));var b=d*Math.PI/180;Xt(e,o,(function(e){e.ellipse(v.x,v.y,h/2,p/2,b,0,2*Math.PI),e.closePath()}))},sn="white",ln="greenyellow",cn="transparent",un={setFillColor:function(e){cn=e},getFillColor:function(){return cn},setToolColor:function(e){sn=e},getToolColor:function(){return sn},setActiveColor:function(e){ln=e},getActiveColor:function(){return ln},getColorIfActive:function(e){return e.color?e.color:e.active?ln:sn}},dn=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=t.element,a=un.getToolColor();e.strokeStyle=r.color||a;for(var i=Object.keys(n),s=function(t){var a=i[t],s=n[a];if(!0===s.drawnIndependently)return"continue";if(!0===r.drawHandlesIfActive&&!s.active)return"continue";if(r.hideHandlesIfMoving&&s.moving)return"continue";var l={lineWidth:s.active?Zt.getActiveWidth():Zt.getToolWidth(),fillStyle:r.fill};r.lineDash&&(l.lineDash=r.lineDash),Xt(e,l,(function(e){var t=y.cornerstone.pixelToCanvas(o,s),n=s.radius||r.handleRadius||vt.handleRadius;e.arc(t.x,t.y,n,0,2*Math.PI)}))},l=0;l<i.length;l++)s(l)},fn=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";Xt(e,r,(function(e){n.forEach((function(n){var r=n.start,a=n.end;if("pixel"===o){var i=y.cornerstone;r=i.pixelToCanvas(t,r),a=i.pixelToCanvas(t,a)}e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}))}))},hn=function(e,t,n,r,o,a){var i=e.length>0?y.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Qt(r,void 0,i,y.cornerstoneMath.point.findClosestPoint(s,i),{color:o,lineWidth:a,lineDash:[2,3]},"canvas")},pn={fontSize:15,fontFamily:"Arial",backgroundColor:"transparent"};function mn(e){if("string"!=typeof e)throw new Error("Font family must be a valid string");pn.fontFamily=e}function gn(e){if("number"!=typeof e||isNaN(e)||!isFinite(e))throw new Error("Font size must be a valid number");pn.fontSize=parseFloat(e)}var vn={setFont:function(e){var t=e.split("px ");2===t.length&&(gn(parseFloat(t[0])),mn(t[1]))},getFont:function(){return"".concat(pn.fontSize,"px ").concat(pn.fontFamily)},setFontSize:gn,getFontSize:function(){return pn.fontSize},setFontFamily:mn,getFontFamily:function(){return pn.fontFamily},setBackgroundColor:function(e){pn.backgroundColor=e},getBackgroundColor:function(){return pn.backgroundColor}},yn=function(e,t,n,r,o){var a=vn.getFontSize();e.font=vn.getFont(),e.textBaseline="top",e.fillStyle=r,n.forEach((function(n,r){e.fillText(n,t.left+o,t.top+o+r*(a+o))}))},bn=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)};function xn(e,t,n){var r=vn.getFont(),o=e.font;r&&r!==o&&(e.font=r);var a=e.measureText(t).width;return r&&r!==o&&(e.font=o),a+2*n}var wn=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=5,s=vn.getFontSize(),l=vn.getBackgroundColor(),c=0;t.forEach((function(t){var n=xn(e,t,i);c=Math.max(c,n)}));var u={width:c,height:i+t.length*(s+i)};return Wt(e,(function(e){e.strokeStyle=o,a.centering&&(!0===a.centering.x&&(n-=u.width/2),!0===a.centering.y&&(r-=u.height/2)),u.left=n,u.top=r,"function"==typeof a.displacer&&a.displacer(u),bn(e,u,l),yn(e,u,t,o,i)})),u};function Tn(e,t,n){return Math.min(Math.max(t,e),n)}function In(e,t){var n=t.left||0,r=t.top||0;e.x=Tn(e.x,n,n+t.width),e.y=Tn(e.y,r,r+t.height)}var Sn=function(e,t,n,r,o,a){a-o<r-n?(e[t]+=o-n,e[t]+=(a-o)/2,e[t]-=(r-n)/2):n<o?e[t]+=o-n:r>a&&(e[t]-=r-a)};function Cn(e,t){var n=y.cornerstone,r=n.pixelToCanvas,o=n.canvasToPixel,a=n.getViewport,i=n.getEnabledElement,s=n.getDisplayedArea,l=o(e,{x:t.left,y:t.top}),c=function(e,t){var n=function(t){return y.cornerstone.canvasToPixel(e,t)},r=t.top,o=t.left,a=t.width,i=t.height,s=[n({x:o,y:r}),n({x:o+a,y:r}),n({x:o,y:r+i}),n({x:o+a,y:r+i})],l=s.map((function(e){return e.x})),c=s.map((function(e){return e.y}));return{minX:Math.min.apply(Math,J()(l)),minY:Math.min.apply(Math,J()(c)),maxX:Math.max.apply(Math,J()(l)),maxY:Math.max.apply(Math,J()(c))}}(e,t),u=c.minX,d=c.minY,f=c.maxX,h=c.maxY,p=a(e),m=s(i(e).image,p),g=p.displayedArea?p.displayedArea:m,v=g.tlhc,b=g.brhc,x=v.y-1,w=v.x-1,T=b.y,I=b.x;Sn(l,"y",d,h,x,T),Sn(l,"x",u,f,w,I);var S=r(e,l);t.top=S.y,t.left=S.x}var En=Tn,An=function(e,t,n,r,o,a,i,s,l,c){var u=y.cornerstone.pixelToCanvas,d=u(t,n);l&&(d.x+=l);var f={centering:{x:!1,y:c}};if(vt.preventTextBoxOutsideDisplayedArea&&(f.displacer=function(e){return Cn(t,e)}),n.boundingBox=wn(e,r,d.x,d.y,i,f),n.hasMoved){var h=a(o).map((function(e){return u(t,e)}));hn(h,d,n.boundingBox,e,i,s)}},Mn=function(e,t,n,r,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=y.cornerstone;n=i.pixelToCanvas(t,n),r=i.pixelToCanvas(t,r)}var s=y.cornerstone.getViewport(t),l=t.clientWidth,c=t.clientHeight,u=s.scale,d=s.translation,f=s.rotation-a,h={x:l/2+d.x*u,y:c/2+d.y*u};Math.abs(f)>.05&&(n=on(n,h,-f),r=on(r,h,-f));var p=Math.abs(n.x-r.x),m=Math.abs(n.y-r.y);n={x:Math.min(n.x,r.x),y:Math.min(n.y,r.y)},r={x:n.x+p,y:n.y+m};var g={x:n.x+p,y:n.y},v={x:n.x,y:n.y+m};Math.abs(f)>.05&&(n=on(n,h,f),r=on(r,h,f),g=on(g,h,f),v=on(v,h,f)),Xt(e,o,(function(e){e.moveTo(n.x,n.y),e.lineTo(g.x,g.y),e.lineTo(r.x,r.y),e.lineTo(v.x,v.y),e.lineTo(n.x,n.y)}))},Pn=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},Dn=function(e,t){return void 0===e?t:e},kn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Dn(t.shadowColor,"#000000"),e.shadowBlur=Dn(t.shadowBlur,0),e.shadowOffsetX=Dn(t.shadowOffsetX,1),e.shadowOffsetY=Dn(t.shadowOffsetY,1))},Ln=function(e){return 0===Object.keys(e).length&&e.constructor===Object},On=xt("segmentation"),Rn=On.getters,_n=On.setters;function Nn(){this.handles={start:{},end:{}}}function Bn(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Ln(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function Un(e){var t=e.detail,n=t.element,r=t.currentPoints.image;this.handles.end=r,y.cornerstone.updateImage(n)}function Vn(e){e.detail.handles=this.handles;var t=e.detail.element,n=Rn.labelmap2D(t),r=n.labelmap2D,o=n.labelmap3D,a=n.currentImageIdIndex,i=r.pixelData,s=i.slice(),l={points:{start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},pixelData:i,segmentIndex:o.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:a,diff:Oe(s,i)};_n.pushState(this.element,[c]),_n.updateSegmentsOnLabelmap2D(r),y.cornerstone.updateImage(t),this._resetHandles()}var Fn={postTouchStartCallback:Bn,postMouseDownCallback:Bn,mouseClickCallback:Bn,touchDragCallback:Un,mouseDragCallback:Un,mouseMoveCallback:Un,touchEndCallback:Vn,mouseUpCallback:Vn,initializeMixin:Nn,renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=Rn.brushColor(r,!0),a=Pn(n.canvasContext.canvas),i=y.cornerstoneMath.point.distance;Wt(a,(function(e){if(!t.handles)return null;var n=y.cornerstone.pixelToCanvas(r,t.handles.start),a=y.cornerstone.pixelToCanvas(r,t.handles.end),s=i(n,a);$t(e,r,t.handles.start,s,{color:o})}))},_resetHandles:Nn,_applyStrategy:Vn},jn=U("tools:ScissorsTool"),Hn=xt("segmentation"),zn=Hn.getters,qn=Hn.setters;function Wn(e){var t=e.detail.element,n=e.detail.currentPoints.image,r=this.handles.points;if(!r.length)return jn.warn("Something went wrong, empty handles detected."),null;r.push({x:n.x,y:n.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(t)}function Gn(e){var t=e.detail,n=e.detail.element;this._addPoint(t),y.cornerstone.updateImage(n)}function Yn(e){var t=this.handles.points,n=e.detail.element,r=zn.labelmap2D(n),o=r.labelmap2D,a=r.labelmap3D,i=r.currentImageIdIndex,s=o.pixelData,l=s.slice(),c={points:t,pixelData:s,segmentIndex:a.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"};this.applyActiveStrategy(e,c);var u={imageIdIndex:i,diff:Oe(l,s)};qn.pushState(this.element,[u]),qn.updateSegmentsOnLabelmap2D(o),y.cornerstone.updateImage(n),this._resetHandles()}function Zn(){this.handles={points:[]},this.currentHandle=0}var Xn={postTouchStartCallback:Wn,postMouseDownCallback:Wn,mouseClickCallback:Wn,touchDragCallback:Gn,mouseDragCallback:Gn,mouseMoveCallback:Gn,touchEndCallback:Yn,mouseUpCallback:Yn,initializeMixin:Zn,renderToolData:function(e){var t=e.detail,n=t.element,r=zn.brushColor(n,!0),o=Pn(t.canvasContext.canvas),a=this.handles.points;a.length<2||Wt(o,(function(e){for(var t=0;t<a.length;t++){var o=J()(a[t].lines);t===a.length-1&&o.push(a[0]),Kt(e,n,a[t],o,{color:r})}}))},_resetHandles:Zn,_addPoint:function(e){var t=this.handles.points;t.length&&t[this.currentHandle-1].lines.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),t.push({x:e.currentPoints.image.x,y:e.currentPoints.image.y,lines:[]}),this.currentHandle+=1,y.cornerstone.updateImage(e.element)},_applyStrategy:Yn},Qn=xt("segmentation").getters,Kn=Object.assign({},Xn,{renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=Qn.brushColor(r,!0),a=Pn(n.canvasContext.canvas),i=this.handles;Wt(a,(function(e){if(i.points.length>1)for(var n=0;n<i.points.length;n++){var a=J()(i.points[n].lines);Kt(e,r,t.handles.points[n],a,{color:o})}}))}}),Jn=xt("segmentation"),$n=Jn.getters,er=Jn.setters;function tr(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Ln(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}function nr(e){var t=e.detail,n=t.element,r=t.currentPoints.image;this.handles.end=r,y.cornerstone.updateImage(n)}function rr(e){e.detail.handles=this.handles;var t=e.detail.element,n=$n.labelmap2D(t),r=n.labelmap2D,o=n.labelmap3D,a=n.currentImageIdIndex,i=r.pixelData,s=i.slice(),l={points:[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],pixelData:i,segmentIndex:o.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"};this.applyActiveStrategy(e,l);var c={imageIdIndex:a,diff:Oe(s,i)};er.pushState(this.element,[c]),er.updateSegmentsOnLabelmap2D(r),y.cornerstone.updateImage(t),this._resetHandles()}function or(){this.handles={start:{},end:{}}}var ar={activeOrDisabledBinaryTool:zt,enabledOrDisabledBinaryTool:qt,circleSegmentationMixin:Fn,polylineSegmentationMixin:Kn,freehandSegmentationMixin:Xn,rectangleSegmentationMixin:{postTouchStartCallback:tr,postMouseDownCallback:tr,mouseClickCallback:tr,touchDragCallback:nr,mouseDragCallback:nr,mouseMoveCallback:nr,touchEndCallback:rr,mouseUpCallback:rr,initializeMixin:or,renderToolData:function(e){var t=this,n=e.detail,r=n.element,o=$n.brushColor(r,!0),a=Pn(n.canvasContext.canvas);Wt(a,(function(e){Mn(e,r,t.handles.start,t.handles.end,{color:o})}))},_resetHandles:or,_applyStrategy:rr},renderBrushMixin:{renderBrush:function(e){var t,n=y.cornerstone,r=xt("segmentation"),o=r.getters,a=r.configuration,i=e.detail,s=i.viewport;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=wt.state.mousePositionImage,t){var l=i.image,c=l.rows,u=l.columns,d=t,f=d.x,h=d.y;if(!(f<0||f>u||h<0||h>c)){var p=a.radius,m=i.canvasContext,g=i.element,v=o.brushColor(g,this._drawing);m.setTransform(1,0,0,1,0,0);var b=p*s.scale,x=n.pixelToCanvas(g,t);m.beginPath(),m.strokeStyle=v,m.ellipse(x.x,x.y,b,b,0,0,2*Math.PI),m.stroke()}}}}},ir=function(e){return e&&"object"===x()(e)&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)},sr=function(e,t){var n;return t&&!0===t.clone&&ir(e)?ur((n=e,Array.isArray(n)?[]:{}),e,t):e},lr=function(e,t,n){var r=e.slice();return t.forEach((function(t,o){void 0===r[o]?r[o]=sr(t,n):ir(t)?r[o]=ur(e[o],t,n):-1===e.indexOf(t)&&r.push(sr(t,n))})),r},cr=function(e,t,n){var r={};return ir(e)&&Object.keys(e).forEach((function(t){r[t]=sr(e[t],n)})),Object.keys(t).forEach((function(o){ir(t[o])&&e[o]?r[o]=ur(e[o],t[o],n):r[o]=sr(t[o],n)})),r},ur=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=Array.isArray(t),o=(n||{arrayMerge:lr}).arrayMerge||lr;if(r)return Array.isArray(e)?o(e,t,n):sr(t,n);var a=cr(e,t,n);return Object.getPrototypeOf(e)!==Object.prototype&&Object.setPrototypeOf(a,Object.getPrototypeOf(e)),a},dr=ur,fr=U("tools:base:BaseTool"),hr=xt("globalConfiguration"),pr=function(){function e(t,n){i()(this,e),this.initialConfiguration=dr(n,t);var r=this.initialConfiguration,o=r.name,a=r.strategies,s=r.defaultStrategy,l=r.configuration,c=r.supportedInteractionTypes,u=r.mixins,d=r.svgCursor;this.name=o,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=c||[],this.strategies=a||{},this.defaultStrategy=s||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,d&&(this.svgCursor=d),this._options={},this._configuration=Object.assign({},l),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,u&&u.length&&this._applyMixins(u),this._cursors=Object.assign({},this.initialConfiguration.cursors);var f=this.defaultStrategy&&this._cursors[this.activeStrategy];f&&(this.svgCursor=f)}return l()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e,t){return this.strategies[this.activeStrategy].call(this,e,t)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=ar["".concat(e[t])];"object"===x()(n)?(Object.assign(this,n),"function"==typeof this.initializeMixin&&this.initializeMixin()):fr.warn("".concat(this.name,": mixin ").concat(ar[t]," does not exist."))}"function"===this.initializeMixin&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(e){this.activeStrategy=e,hr.configuration.showSVGCursors&&this.changeCursor(this.element,e)}},{key:"changeCursor",value:function(e,t){if(e){var n=this._cursors[t];n&&(this.svgCursor=n,"active"===this.mode&&St(e,n))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}(),mr=function(e,t){if(e.boundingBox)return y.cornerstoneMath.point.insideRect(t,e.boundingBox)},gr=function(e,t,n,r){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(mr(e,n))return!0}else{var o=y.cornerstone.pixelToCanvas(t,e);if(y.cornerstoneMath.point.distance(o,n)<=r)return!0}return!1},vr=function e(t,n,r,o){var a;if(n){if(Array.isArray(n))for(var i=Object.keys(n),s=0;s<i.length;s++){var l=n[i[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&gr(l,t,r,o)){a=l;break}}else if("object"===x()(n))for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];if(Array.isArray(n[d])){if(a=e(t,n[d],r,o))break}else{var f=n[d];if(gr(f,t,r,o)){a=f;break}}}return a}},yr=function(e,t,n,r){r||(r=6);var o=function(e){var t;return Object.keys(e).forEach((function(n){var r=e[n];!0!==r.active||(t=r)})),t}(t),a=vr(e,t,n,r);return o!==a&&(void 0!==a&&(a.active=!0),void 0!==o&&(o.active=!1),!0)},br=n(9),xr=n.n(br),wr=function(e,t){var n=e.image,r={left:0,top:0,width:n.width,height:n.height},o=!1;return Object.keys(t).forEach((function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===y.cornerstoneMath.point.insideRect(n,r)&&(o=!0)})),o},Tr=function(e,t){var n=e.currentPoints,r=e.element,o=n.page,a=vt.handleTouchOffset,i=0,s=0;return"touch"===t&&(i=a.x,s=a.y),y.cornerstone.pageToPixel(r,o.x+i,o.y+s)},Ir=function(e,t,n){return t.filter((function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])}))},Sr=n(5),Cr=n.n(Sr),Er=function(e,t){return"active"===Tt(e,t).mode},Ar=xt("segmentation"),Mr=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,t),r.configuration||(r.configuration={alwaysEraseOnClick:!1}),(n=u()(this,f()(t).call(this,e,r))).updateOnMouseMove=!0,n.hideDefaultCursor=!0,n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(Cr()(n)),n}return p()(t,e),l()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image,this._drawing&&this._paint(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints;return this._startPainting(e),this._lastImageCoords=r.image,this._drawing=!0,this._startListeningForMouseUp(n),this._paint(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element,r=Ar.configuration,o=Ar.getters.labelmap2D(n),a=o.labelmap2D,i=o.labelmap3D,s=o.currentImageIdIndex,l=o.activeLabelmapIndex,c=this._isCtrlDown(t)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:a,labelmap3D:i,currentImageIdIndex:s,activeLabelmapIndex:l,shouldErase:c},r.storeHistory){var u=a.pixelData.slice();this.paintEventData.previousPixelData=u}}},{key:"_endPainting",value:function(e){for(var t=Ar.configuration,n=Ar.setters,r=this.paintEventData,o=r.labelmap2D,a=r.currentImageIdIndex,i=new Set(o.pixelData).values(),s=[],l=!1;!l;){var c=i.next();(l=c.done)||s.push(c.value)}if(o.segmentsOnLabelmap=s,t.storeHistory){var u={imageIdIndex:a,diff:Oe(this.paintEventData.previousPixelData,o.pixelData)};n.pushState(this.element,[u])}Le(this.element)}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image}},{key:"renderToolData",value:function(e){var t=e.detail.element;Er(t,this.name)&&this.renderBrush(e)}},{key:"passiveCallback",value:function(e){try{y.cornerstone.updateImage(this.element)}catch(e){return}}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._endPainting(e),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"newImageCallback",value:function(e){this._drawing&&(this._endPainting(e),this._startPainting(e))}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"increaseBrushSize",value:function(){var e=Ar.configuration,t=Ar.setters,n=e.radius,r=Math.floor(1.2*n);r===n&&(r+=1),t.radius(r)}},{key:"decreaseBrushSize",value:function(){var e=Ar.configuration,t=Ar.setters,n=e.radius,r=Math.floor(.8*n);t.radius(r)}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(pr),Pr=function(e){return e.filter((function(e){return!(e.isMultiPartTool||e instanceof mo||e instanceof Mr)}))};function Dr(e,t){var n;if("touch"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")?n=(n=Ir(e,yt.touchTools())).filter((function(e){return e.options.isTouchActive})):(n=(n=Ir(e,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&t&&e.options.mouseButtonMask.includes(t)&&e.options.isMouseActive})),vt.isMultiPartToolActive&&(n=Pr(n))),0!==n.length)return n[0]}var kr=U("manipulators:moveAllHandles"),Lr=xt("manipulatorState"),Or={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},Rr={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},_r=function(e,t,n,r){var o=e.element,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",s=arguments.length>6?arguments[6]:void 0;a=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},a);var l=Nr.bind(this,t,n,a,i),c=function e(r){Ur(t,n,a,i,{dragHandler:l,upOrEndHandler:e},r,s)};Lr.setters.addActiveManipulatorForElement(o,Br.bind(null,n,a,i,{dragHandler:l,upOrEndHandler:c},o,s)),n.active=!0,vt.isToolLocked=!0,Or[i].forEach((function(e){o.addEventListener(e,l)})),Rr[i].forEach((function(e){o.addEventListener(e,c)}))};function Nr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=o.detail,i=a.element,s=a.image,l=a.buttons,c=o.detail.deltaPoints.image,u=c.x,d=c.y;t.active=!0,t.invalidated=!0;for(var f=Object.keys(t.handles),h=0;h<f.length;h++){var p=f[h],m=t.handles[p];!0!==m.movesIndependently&&m.hasOwnProperty("x")&&m.hasOwnProperty("y")&&(m.x+=u,m.y+=d,n.preventHandleOutsideImage&&In(m,s))}y.cornerstone.updateImage(i);var g=Dr(i,l,r);g instanceof mo&&g.updateCachedStats(s,i,t),T(i,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:i,measurementData:t}),o.preventDefault(),o.stopPropagation()}function Br(e){var t=arguments.length>3?arguments[3]:void 0;Vr(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,{dragHandler:t.dragHandler,upOrEndHandler:t.upOrEndHandler},arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,!1)}function Ur(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=o.dragHandler,i=o.upOrEndHandler,s=arguments.length>6?arguments[6]:void 0,l=(arguments.length>5?arguments[5]:void 0).detail,c=l.element;Lr.setters.removeActiveManipulatorForElement(c),n.deleteIfHandleOutsideImage&&wr(l,t.handles)&&O(c,e,t),Vr(t,n,r,{dragHandler:a,upOrEndHandler:i},c,s,!0)}function Vr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=r.dragHandler,a=r.upOrEndHandler,i=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.active=!1,e.invalidated=!0,vt.isToolLocked=!1,Or[n].forEach((function(e){i.removeEventListener(e,o)})),Rr[n].forEach((function(e){i.removeEventListener(e,a)})),"function"==typeof t.doneMovingCallback&&(kr.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(l)),"function"==typeof s&&s(l),y.cornerstone.updateImage(i)}var Fr=U("manipulators:moveHandle"),jr=xt("manipulatorState"),Hr={value:!1},zr={mouse:[w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},qr={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP]},Wr=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;o=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},o);var s=e.element,l=Gr.bind(this,t,n,r,o,a),c=function s(){Zr(t,e,n,r,o,a,{dragHandler:l,upOrEndHandler:s},i)};if(jr.setters.addActiveManipulatorForElement(s,Yr.bind(null,t,e,n,r,o,a,{dragHandler:l,upOrEndHandler:c},i)),r.active=!0,r.moving=!0,n.active=!0,vt.isToolLocked=!0,zr[a].forEach((function(e){s.addEventListener(e,l)})),qr[a].forEach((function(e){s.addEventListener(e,c)})),"touch"===a){Hr.value=!0;var u=y.cornerstone.getEnabledElement(s),d=Tr(e,a);Qr(r,Hr,u,d)}};function Gr(e,t,n,r,o,a){var i=a.detail,s=i.image,l=i.element,c=i.buttons,u=Tr(a.detail,o);Hr.value=!1,n.active=!0,n.hasMoved=!0,n.x=u.x,n.y=u.y,t.invalidated=!0,r.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Dr(l,c,o);d instanceof mo&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function Yr(e,t,n,r){var o=arguments.length>6?arguments[6]:void 0;Xr(e,t,n,r,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},arguments.length>5?arguments[5]:void 0,{dragHandler:o.dragHandler,upOrEndHandler:o.upOrEndHandler},arguments.length>7?arguments[7]:void 0,!1)}function Zr(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=t.element;jr.setters.removeActiveManipulatorForElement(u),Xr(e,t,n,r,o,a,{dragHandler:s,upOrEndHandler:l},c,!0)}function Xr(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,s=i.dragHandler,l=i.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],d=t.element;r.active=!1,r.moving=!1,n.active=!1,n.invalidated=!0,Hr.value=!1,vt.isToolLocked=!1,zr[a].forEach((function(e){d.removeEventListener(e,s)})),qr[a].forEach((function(e){d.removeEventListener(e,l)})),o.deleteIfHandleOutsideImage&&wr(t,n.handles)&&O(d,e,n),"function"==typeof o.doneMovingCallback&&(Fr.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),o.doneMovingCallback(u)),"function"==typeof c&&c(u),y.cornerstone.updateImage(d)}function Qr(e,t,n,r){if(t.value){var o=Math.abs(e.y-r.y),a=o/10;if(o<1)return e.y=r.y,void(t.value=!1);e.y>r.y?e.y-=a:e.y<r.y&&(e.y+=a),y.cornerstone.updateImage(n.element),y.cornerstone.requestAnimationFrame((function(){Qr(e,t,n,r)}))}}var Kr=U("manipulators:moveNewHandle"),Jr=xt("manipulatorState"),$r={mouse:[w.MOUSE_MOVE,w.MOUSE_DRAG],touch:[w.TOUCH_DRAG]},eo={mouse:[w.MOUSE_UP,w.MOUSE_CLICK],touch:[w.TOUCH_END,w.TOUCH_PINCH,w.TAP]},to=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse",i=arguments.length>6?arguments[6]:void 0;(o=Object.assign({deleteIfHandleOutsideImage:vt.deleteIfHandleOutsideImage,preventHandleOutsideImage:vt.preventHandleOutsideImage},o)).hasMoved=!1;var s=e.element;function l(e){no(t,n,r,o,a,e)}function c(e){oo(t,n,r,o,a,{moveHandler:l,moveEndHandler:c},e,i)}n.active=!0,r.moving=!0,r.active=!0,vt.isToolLocked=!0,$r[a].forEach((function(e){s.addEventListener(e,l)})),s.addEventListener(w.TOUCH_START,io),eo[a].forEach((function(e){s.addEventListener(e,c)})),Jr.setters.addActiveManipulatorForElement(s,ao.bind(null,n,r,o,a,{moveHandler:l,moveEndHandler:c},s,i))};function no(e,t,n,r,o,a){var i=a.detail,s=i.image,l=i.element,c=i.buttons,u=Tr(a.detail,o);r.hasMoved=!0,t.invalidated=!0,n.active=!0,n.x=u.x,n.y=u.y,r&&r.preventHandleOutsideImage&&In(n,s),y.cornerstone.updateImage(l);var d=Dr(l,c,o);d instanceof mo&&d.updateCachedStats(s,l,t),T(l,w.MEASUREMENT_MODIFIED,{toolName:e,toolType:e,element:l,measurementData:t})}function ro(e,t,n,r,o){var a=r.moveHandler,i=r.moveEndHandler,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];$r[e].forEach((function(e){n.removeEventListener(e,a)})),eo[e].forEach((function(e){n.removeEventListener(e,i)})),n.removeEventListener(w.TOUCH_START,io),vt.isToolLocked=!1,"function"==typeof o&&o(s),"function"==typeof t.doneMovingCallback&&(Kr.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),t.doneMovingCallback(s)),y.cornerstone.updateImage(n)}function oo(e,t,n,r,o,a,i,s){var l=a.moveHandler,c=a.moveEndHandler,u=i.detail,d=u.element,f=!0;if(!1!==r.hasMoved){var h=Tr(u,o);t.active=!1,t.invalidated=!0,n.active=!1,n.moving=!1,n.x=h.x,n.y=h.y,Jr.setters.removeActiveManipulatorForElement(d),r.preventHandleOutsideImage&&In(n,i.detail.image),r.deleteIfHandleOutsideImage&&wr(i.detail,t.handles)&&(t.cancelled=!0,f=!1,O(d,e,t)),ro(o,r,d,{moveHandler:l,moveEndHandler:c},s,f)}}function ao(e,t,n,r,o,a,i){var s=o.moveHandler,l=o.moveEndHandler;e.active=!1,e.invalidated=!0,t.active=!1,ro(r,n,a,{moveHandler:s,moveEndHandler:l},i,!1)}function io(e){return e.stopImmediatePropagation(),!1}function so(e,t){var n=vt.clickProximity,r=vt.touchProximity,o=vt.tools.find((function(e){return e.name===t}));return o&&o.configuration&&(n=o.configuration.clickProximity||n,r=o.configuration.touchProximity||r),"mouse"===e?n:r}function lo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function co(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lo(n,!0).forEach((function(t){xr()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lo(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var uo=function(e,t,n,r,o){n.active=!0,vt.isToolLocked=!0,Wr(e.detail,t.name,n,r,t.options,o,(function(t){var r=e.detail.element,o=n.toolType||n.toolName,a={toolName:o,toolType:o,element:r,measurementData:co({},n,{active:!1})};T(r,w.MEASUREMENT_COMPLETED,a)})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},fo=function(e,t,n,r){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",a=0;a<t.data.length;a++){var i=t.data[a],s=vr(e,i.handles,r,so(o,n));if(s)return{handle:s,data:i}}},ho=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";n.active=!0,vt.isToolLocked=!0,_r(e.detail,t.name,n,null,t.options,r,(function(){n.active=!1,vt.isToolLocked=!1})),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},po=U("baseAnnotationTool"),mo=function(e){function t(){return i()(this,t),u()(this,f()(t).apply(this,arguments))}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,r=t.currentPoints.canvas,o=L(n,this.name),a=!1,i=0;i<o.data.length;i++){var s=o.data[i];!0===yr(n,s.handles,r)&&(a=!0);var l=this.pointNearTool(n,s,r,"mouse")&&!s.active,c=!this.pointNearTool(n,s,r,"mouse")&&s.active;(l||c)&&(s.active=!s.active,a=!0)}return a}},{key:"handleSelectedCallback",value:function(e,t,n){uo(e,this,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")}},{key:"toolSelectedCallback",value:function(e,t){ho(e,this,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse")}},{key:"updateCachedStats",value:function(e,t,n){po.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),t}(pr),go=function(e,t,n,r){var o=y.cornerstone,a={start:o.pixelToCanvas(e,t),end:o.pixelToCanvas(e,n)};return y.cornerstoneMath.lineSegment.distanceToPoint(a,r)},vo=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},yo=bt.cursor,bo=function(){function e(t,n){i()(this,e),this.iconGroupString=t,this.options=Object.assign({},yo.getters.defaultOptions(),n)}return l()(e,[{key:"getIconSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconSVGString(e)}},{key:"getIconWithPointerSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._generateIconWithPointerSVGString(e);return new Blob([t],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._generateIconWithPointerSVGString(e)}},{key:"_generateIconWithPointerSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.mousePointerGroupString,r=t.iconSize,o=t.viewBox,a=r/Math.max(o.x,o.y),i=16+r,s='\n        <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 ').concat(i," ").concat(i,'"\n      >\n        <g>\n          ').concat(n,'\n        </g>\n        <g transform="translate(16, 16) scale(').concat(a,')">\n          ').concat(this.iconGroupString,"\n        </g>\n      </svg>");return this._injectColors(s,t)}},{key:"_generateIconSVGString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},this.options,e),n=t.iconSize,r=t.viewBox,o='\n      <svg\n        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n        width="'.concat(n,'" height="').concat(n,'" viewBox="0 0\n        ').concat(r.x," ").concat(r.y,'"\n      >\n        ').concat(this.iconGroupString,"\n      </svg>");return this._injectColors(o,t)}},{key:"_injectColors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.activeColor||un.getActiveColor(),r=t.toolColor||un.getToolColor(),o=t.fillColor||un.getFillColor();return e.replace(/ACTIVE_COLOR/g,"".concat(n)).replace(/TOOL_COLOR/g,"".concat(r)).replace(/FILL_COLOR/g,"".concat(o))}},{key:"mousePoint",get:function(){var e=this.options.mousePoint;return"".concat(e.x," ").concat(e.y)}}]),e}(),xo=new bo('<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n        10l50 50q10 10 10 23z"\n      />',{viewBox:{x:1792,y:1792}}),wo=new bo('<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',{viewBox:{x:24,y:24}}),To=new bo('<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',{viewBox:{x:48,y:48}}),Io=new bo('<g stroke="ACTIVE_COLOR" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',{viewBox:{x:32,y:32}}),So=new bo('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),Co=new bo('<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z"\n    />',{viewBox:{x:32,y:32}}),Eo=new bo('\n  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',{viewBox:{x:18,y:18}}),Ao=new bo('<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n    </g>',{viewBox:{x:18,y:18}}),Mo=new bo('<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',{viewBox:{x:24,y:24}}),Po=new bo('<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z"\n  />',{viewBox:{x:1792,y:1792}}),Do=new bo('<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),ko=new bo('<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"\n  />',{viewBox:{x:1792,y:1792}}),Lo=new bo('<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"\n  />',{viewBox:{x:1792,y:1792}}),Oo=new bo('<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n      0 69.5 20.5t47.5 54.5z"\n    />',{viewBox:{x:2048,y:1792}}),Ro=new bo('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />',{viewBox:{x:512,y:512}}),_o=new bo('<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"\n    />',{viewBox:{x:1792,y:1792}}),No=new bo('<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n      39 17 39 59z"\n    />',{viewBox:{x:1792,y:1792}}),Bo=new bo('<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"\n      />',{viewBox:{x:24,y:28}}),Uo=new bo('<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z"\n  />',{viewBox:{x:1792,y:1792}}),Vo=new bo('<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />',{viewBox:{x:18,y:18}}),Fo=new bo('<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n      32s176 78.7 176 176-78.7 176-176 176z"\n    />\n    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"\n    />',{viewBox:{x:640,y:512}}),jo={x:127,y:60},Ho=function(){return'<rect fill="'.concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR",'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},zo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(e,'" x="80.19" y="25.03" width="47.14" height="15.85"/>\n      <rect fill="').concat(e,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},qo='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',Wo='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Go='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Yo=new bo("".concat(qo," ").concat(Ho()),{viewBox:jo}),Zo=new bo("".concat(qo," ").concat(zo()),{viewBox:jo}),Xo=new bo("".concat(qo," ").concat(Ho()),{viewBox:jo}),Qo=new bo("".concat(qo," ").concat(zo()),{viewBox:jo}),Ko=new bo("".concat(Wo," ").concat(Ho()),{viewBox:jo}),Jo=new bo("".concat(Wo," ").concat(zo()),{viewBox:jo}),$o=new bo("".concat(Wo," ").concat(Ho()),{viewBox:jo}),ea=new bo("".concat(Wo," ").concat(zo()),{viewBox:jo}),ta=new bo("".concat(Go," ").concat(Ho()),{viewBox:jo}),na=new bo("".concat(Go," ").concat(zo()),{viewBox:jo}),ra=new bo("".concat(Go," ").concat(Ho()),{viewBox:jo}),oa=new bo("".concat(Go," ").concat(zo()),{viewBox:jo});function aa(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId);return t?{rowPixelSpacing:t.rowPixelSpacing||t.rowImagePixelSpacing,colPixelSpacing:t.columnPixelSpacing||t.colImagePixelSpacing}:{rowPixelSpacing:e.rowPixelSpacing,colPixelSpacing:e.columnPixelSpacing}}var ia=function(e){var t=x()(e);return null!==e&&("object"===t||"function"===t)},sa=function(e,t,n){var r,o,a,i,s,l,c=0,u=!1,d=!1,f=!0,h=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,a=o;return r=o=void 0,c=t,i=e.apply(a,n)}function m(e,t){return h?window.requestAnimationFrame(e):setTimeout(e,t)}function g(e){return c=e,s=m(y,t),u?p(e):i}function v(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=a}function y(){var e=Date.now();if(v(e))return b(e);s=m(y,function(e){var n=e-c,r=t-(e-l);return d?Math.min(r,a-n):r}(e))}function b(e){return s=void 0,f&&r?p(e):(r=o=void 0,i)}function x(){for(var e=Date.now(),n=v(e),a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];if(r=c,o=this,l=e,n){if(void 0===s)return g(l);if(d)return s=m(y,t),p(l)}return void 0===s&&(s=m(y,t)),i}return t=Number(t)||0,ia(n)&&(u=Boolean(n.leading),a=(d="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):a,f="trailing"in n?Boolean(n.trailing):f),x.cancel=function(){void 0!==s&&function(e){if(h)return window.cancelAnimationFrame(e);clearTimeout(e)}(s),c=0,r=l=o=s=void 0},x.flush=function(){return void 0===s?i:b(Date.now())},x.pending=function(){return void 0!==s},x},la=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ia(n)&&(r="leading"in n?Boolean(n.leading):r,o="trailing"in n?Boolean(n.trailing):o),sa(e,t,{leading:r,trailing:o,maxWait:t})},ca=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:xo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,r))).preventNewMeasurement=!1,e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(go(e,t.handles.start,t.handles.middle,n)<25||go(e,t.handles.middle,t.handles.end,n)<25)}},{key:"updateCachedStats",value:function(e,t,n){var r=da(e,n.handles.middle,n.handles.start),o=da(e,n.handles.end,n.handles.middle),a=da(e,n.handles.end,n.handles.start),i=ua(r),s=ua(o),l=ua(a),c=Math.acos((Math.pow(i,2)+Math.pow(s,2)-Math.pow(l,2))/(2*i*s));c*=180/Math.PI,n.rAngle=vo(c,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.enabledElement,o=this.configuration,a=o.handleRadius,i=o.drawHandlesOnHover,s=o.hideHandlesIfMoving,l=o.renderDashed,c=L(e.currentTarget,this.name),u=xt("globalConfiguration").configuration.lineDash;if(c)for(var d=Pn(n.canvasContext.canvas),f=n.image,h=n.element,p=aa(f),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=Zt.getToolWidth(),b=function(e){var o=c.data[e];if(!1===o.visible)return"continue";Wt(d,(function(e){kn(e,t.configuration);var c=un.getColorIfActive(o),d=y.cornerstone.pixelToCanvas(n.element,o.handles.start),p=y.cornerstone.pixelToCanvas(n.element,o.handles.middle),b={color:c};l&&(b.lineDash=u),Kt(e,n.element,o.handles.start,[o.handles.middle,o.handles.end],b);var x={color:c,handleRadius:a,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&dn(e,n,o.handles,x),!0===o.invalidated&&(o.rAngle?t.throttledUpdateCachedStats(f,h,o):t.updateCachedStats(f,h,o)),o.rAngle){var T,I=function(e,t,n){var r=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+r}(o,m,g);if(!o.handles.textBox.hasMoved){T={x:p.x,y:p.y};var S=xn(e,I,5);p.x<d.x?T.x-=15+S+10:T.x+=15;var C=y.cornerstone.internal.getTransform(r);C.invert();var E=C.transformPoint(T.x,T.y);o.handles.textBox.x=E.x,o.handles.textBox.y=E.y}An(e,n.element,o.handles.textBox,I,o.handles,w,c,v,0,!0)}}))},x=0;x<c.data.length;x++)b(x);function w(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var r=e.detail,o=this.createNewMeasurement(r),a=e.detail.element;k(a,this.name,o),y.cornerstone.updateImage(a),to(r,this.name,o,o.handles.middle,this.options,t,(function(e){if(o.active=!1,!e)return O(a,n.name,o),void(n.preventNewMeasurement=!1);o.handles.end.active=!0,y.cornerstone.updateImage(a),to(r,n.name,o,o.handles.end,n.options,t,(function(e){e?(o.active=!1,y.cornerstone.updateImage(a)):O(a,n.name,o),n.preventNewMeasurement=!1,y.cornerstone.updateImage(a);var t={toolName:n.name,toolType:n.name,element:a,measurementData:o};T(a,w.MEASUREMENT_COMPLETED,t)}))}))}}}]),t}(mo);function ua(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function da(e,t,n){var r=aa(e),o=r.rowPixelSpacing,a=r.colPixelSpacing;return{x:(t.x-n.x)*(a||1),y:(t.y-n.y)*(o||1)}}var fa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:ha,changeTextCallback:pa,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:wo};return(e=u()(this,f()(t).call(this,n,r))).preventNewMeasurement=!1,e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&go(e,t.handles.start,t.handles.end,n)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,o=n.enabledElement,a=this.configuration,i=a.handleRadius,s=a.drawHandlesOnHover,l=a.hideHandlesIfMoving,c=a.renderDashed,u=L(r,this.name);if(u){var d,f=e.detail.canvasContext.canvas,h=Pn(f),p=Zt.getToolWidth();c&&(d=xt("globalConfiguration").configuration.lineDash);for(var m=function(n){var a=u.data[n];if(!1===a.visible)return"continue";Wt(h,(function(n){kn(n,t.configuration);var c=un.getColorIfActive(a),u=y.cornerstone.pixelToCanvas(r,a.handles.start),f=y.cornerstone.pixelToCanvas(r,a.handles.end);t.configuration.arrowFirst?Jt(n,f,u,c,p,d):Jt(n,u,f,c,p,d);var h={color:c,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};t.configuration.drawHandles&&dn(n,e.detail,a.handles,h);var m=function(e){return e.text}(a);if(m&&""!==m){var g=xn(n,m,5),b=vn.getFontSize()+10,x=Math.max(g,b)/2+5;if(f.x<u.x&&(x=-x),!a.handles.textBox.hasMoved){var w;w=t.configuration.arrowFirst?{x:f.x-g/2+x,y:f.y-b/2}:{x:u.x-g/2-x,y:u.y-b/2};var T=y.cornerstone.internal.getTransform(o);T.invert();var I=T.transformPoint(w.x,w.y);a.handles.textBox.x=I.x,a.handles.textBox.y=I.y}An(n,r,a.handles.textBox,m,a.handles,v,c,p,0,!1)}}))},g=0;g<u.data.length;g++)m(g)}function v(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,r=e.detail.element,o=this.createNewMeasurement(e),a=this.configuration.allowEmptyLabel;k(r,this.name,o),y.cornerstone.updateImage(r),to(e.detail,this.name,o,o.handles.end,this.options,t,(function(t){t?void 0===o.text&&n.configuration.getTextCallback((function(e){if(e||a){o.text=e,o.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:o};y.cornerstone.updateImage(r),T(r,w.MEASUREMENT_COMPLETED,t)}else O(r,n.name,o)}),e.detail):O(r,n.name,o),y.cornerstone.updateImage(r)}))}},{key:"doubleClickCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,r=L(t,this.name);if(!r)return!1;for(var o=0;o<r.data.length;o++){var a=r.data[o];if(this.pointNearTool(t,a,n)||mr(a.handles.textBox,n))return a.active=!0,y.cornerstone.updateImage(t),this.configuration.changeTextCallback(a,e.detail,this._doneChangingTextCallback.bind(this,t,a)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,r){!0===r?O(e,this.name,t):t.text=n,t.active=!1,y.cornerstone.updateImage(e),T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}}]),t}(mo);function ha(e){e(prompt("Enter your annotation:"))}function pa(e,t,n){n(prompt("Change your annotation:"))}var ma=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},r)},ga=function(e){var t=e.currentPoints.image,n=t.x,r=t.y;return{toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:ma(n,r,0),end:ma(n,r,1,{active:!0}),perpendicularStart:ma(n,r,2,{locked:!0}),perpendicularEnd:ma(n,r,3),textBox:ma(n-50,r-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},va=function(e,t,n,r){var o=y.cornerstone,a=y.cornerstoneMath,i={start:o.pixelToCanvas(e,t.perpendicularStart),end:o.pixelToCanvas(e,t.perpendicularEnd)};return a.lineSegment.distanceToPoint(i,n)<r},ya=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=y.cornerstone,a=y.cornerstoneMath,i=t.handles,s={start:o.pixelToCanvas(e,i.start),end:o.pixelToCanvas(e,i.end)},l=a.lineSegment.distanceToPoint(s,n);if(mr(i.textBox,n))return!0;var c=so(r,"Bidirectional");return!!va(e,i,n,c)||l<c};function ba(e,t,n,r){var o=(n.x-r.x)*e,a=(n.y-r.y)*t,i=Math.sqrt(o*o+a*a);return{x:o/i,y:a/i,length:i}}function xa(e,t){if(!t.handles.perpendicularStart.locked)return!1;var n,r,o,a,i=t.handles,s=i.start,l=i.end,c=e.image,u=c.columnPixelSpacing,d=void 0===u?1:u,f=c.rowPixelSpacing,h=void 0===f?1:f;if(s.x===l.x&&s.y===l.y)n=s.x,r=s.y,o=l.x,a=l.y;else{var p={x:(s.x+l.x)/2,y:(s.y+l.y)/2},m=ba(d,h,s,l),g=m.length/2,v=g/(2*h),y=g/(2*d);n=p.x+y*m.y,r=p.y-v*m.x,o=p.x-y*m.y,a=p.y+v*m.x}return t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=r,t.handles.perpendicularEnd.x=o,t.handles.perpendicularEnd.y=a,!0}var wa,Ta=function(e){var t=this,n=e.detail,r=n.element,o=n.canvasContext,a=n.image,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=i.renderDashed,d=xt("globalConfiguration").configuration.lineDash,f=L(r,this.name);if(f){var h=aa(a),p=h.rowPixelSpacing,m=h.colPixelSpacing;if(p&&m)for(var g,v=Pn(o.canvas),y=Zt.getToolWidth(),b=function(e){var o=f.data[e];if(!1===o.visible)return"continue";g=un.getColorIfActive(o),!0===o.invalidated&&(o.longestDiameter&&o.shortestDiameter?t.throttledUpdateCachedStats(a,r,o):t.updateCachedStats(a,r,o)),Wt(v,(function(e){kn(e,t.configuration);var a=o.handles,i=a.start,f=a.end,h=a.perpendicularStart,v=a.perpendicularEnd,b=a.textBox,x={color:g},w={color:g,strokeWidth:T};u&&(x.lineDash=d,w.lineDash=d),Qt(e,r,i,f,x);var T=y;xa(n,o),Qt(e,r,h,v,w);var I={color:g,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&dn(e,n,o.handles,I);var S=Ia(o,p,m);An(e,r,b,S,o.handles,(function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]}),g,y,10,!0)}))},x=0;x<f.data.length;x++)b(x)}},Ia=function(e,t,n){var r=" mm";t&&n||(r=" pixels");var o=" L ".concat(e.longestDiameter).concat(r),a=" W ".concat(e.shortestDiameter).concat(r),i=e.labels;return i&&Array.isArray(i)?[].concat(J()(i),[o,a]):[o,a]},Sa=function(e,t){var n=this,r=e.detail,o=r.element,a=r.image,i=r.buttons,s=this.configuration;if(!Ca(a)){var l=this.createNewMeasurement(r),c=function(){l.active=!1,y.cornerstone.updateImage(o)};k(o,this.name,l),y.cornerstone.updateImage(o);var u=(new Date).getTime(),d=l.handles,f=d.end,h=d.perpendicularStart;to(r,this.name,l,f,{},t,(function(e){if(e){var d=l.handles,f=l.longestDiameter,p=l.shortestDiameter,m=wr(r,d),g=parseFloat(f)||0,v=parseFloat(p)||0,b=g<1||v<1,x=(new Date).getTime()-u<150;m||b||x?(l.cancelled=!0,O(o,n.name,l)):s.getMeasurementLocationCallback(l,r,c),xa(r,l),h.locked=!1,l.invalidated=!0,y.cornerstone.updateImage(o);var I=Dr(o,i,t);I instanceof Qa&&I.updateCachedStats(a,o,l);var S={toolName:n.name,toolType:n.name,element:o,measurementData:l};T(o,w.MEASUREMENT_MODIFIED,S),T(o,w.MEASUREMENT_COMPLETED,S)}else O(o,n.name,l)}))}},Ca=function(e){var t=y.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,r=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,r=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!r},Ea={setCoords:function(e){wa=e.currentPoints.canvas},getCoords:function(){return wa}},Aa=function(e){var t=this,n=e.detail,r=n.element;Ea.setCoords(n);var o=L(r,this.name);if(o){for(var a=!1,i=function(e){var i=n.currentPoints.canvas,s=o.data[e],l=function(e,t,n){var r=vr(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:6),o=!1;return Object.keys(t).forEach((function(e){if("textBox"!==e){var n=t[e],a=n===r;n.active!==a&&(o=!0),n.active=a}})),o}(r,s.handles,i);Object.keys(s.handles).forEach((function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active}})),l&&(a=!0);var c=t.pointNearTool(r,s,i,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,a=!0)},s=0;s<o.data.length;s++)i(s);!0===a&&y.cornerstone.updateImage(r)}},Ma=function(e,t,n){"touch"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")?this.handleSelectedTouchCallback(e):this.handleSelectedMouseCallback(e)};function Pa(e,t,n,r){var o=(n.x-r.x)/t,a=(n.y-r.y)/e;return Math.sqrt(o*o+a*a)}function Da(e,t){return{start:e,end:t}}function ka(e,t,n){var r=y.cornerstoneMath.lineSegment,o=e.handles,a=o.start,i=o.end,s=o.perpendicularStart,l=o.perpendicularEnd,c=t.image,u=c.columnPixelSpacing,d=void 0===u?1:u,f=c.rowPixelSpacing,h=void 0===f?1:f,p=Da(a,i),m=Da(s,l),g=r.intersectLine(p,m);return{columnPixelSpacing:d,rowPixelSpacing:h,start:a,end:i,perpendicularStart:s,perpendicularEnd:l,longLine:p,intersection:g,distanceToFixed:Pa(d,h,n,g),fixedPoint:n}}function La(e,t,n,r){var o=ka(t,n,r),a=o.columnPixelSpacing,i=o.rowPixelSpacing,s=o.distanceToFixed,l=Pa(a,i,r,e);if(l<=s)return!1;var c=s/l,u=function(e,t){var n=e.columnPixelSpacing,r=e.rowPixelSpacing,o=e.start,a=e.perpendicularStart,i=e.perpendicularEnd,s=e.intersection,l=e.fixedPoint,c=Pa(n,r,a,s),u=Pa(n,r,i,s),d=ba(n,r,l,t),f=l===o?1:-1,h=f*r,p=f*n;return{start:{x:t.x+d.y*c*h,y:t.y+d.x*c*p*-1},end:{x:t.x+d.y*u*h*-1,y:t.y+d.x*u*p}}}(o,{x:r.x+(e.x-r.x)*c,y:r.y+(e.y-r.y)*c});return t.handles.perpendicularStart.x=u.start.x,t.handles.perpendicularStart.y=u.start.y,t.handles.perpendicularEnd.x=u.end.x,t.handles.perpendicularEnd.y=u.end.y,!0}function Oa(e,t){return e===t}function Ra(e,t){return Oa(e,t)?-1:1}function _a(e,t,n,r){var o,a=e.columnPixelSpacing,i=e.rowPixelSpacing,s=e.fixedPoint,l=e.perpendicularStart,c=e.perpendicularEnd,u=e.distanceToFixed,d=Ra(s,c)*u,f=function(e,t,n){return Oa(e,n)?t:n}(s,l,c)===l,h=f?"start":"end",p=f?"end":"start";return o={},xr()(o,h,{x:n.start.x,y:n.start.y}),xr()(o,p,{x:t.x+r.y*i*d,y:t.y+r.x*a*d*-1}),o}function Na(e,t,n,r){var o=y.cornerstoneMath.lineSegment,a=ka(t,n,r),i=a.columnPixelSpacing,s=a.rowPixelSpacing,l=a.start,c=a.longLine,u=a.intersection;if(!function(e,t,n){return 0!==Pa(e,t,n.start,n.end)}(i,s,c))return!1;var d=ba(i,s,l,u),f=function(e,t,n){var r=e.columnPixelSpacing,o=e.rowPixelSpacing,a=e.perpendicularEnd,i=e.fixedPoint,s=Number.MAX_SAFE_INTEGER,l=Ra(i,a)*s;return{start:t,end:{x:t.x+n.y*o*l,y:t.y+n.x*r*l*-1}}}(a,e,d),h=o.intersectLine(c,f);if(!h)return!1;var p=_a(a,h,f,d);return t.handles.perpendicularStart.x=p.start.x,t.handles.perpendicularStart.y=p.start.y,t.handles.perpendicularEnd.x=p.end.x,t.handles.perpendicularEnd.y=p.end.y,!0}var Ba=function(e,t,n,r){var o,a,i,s,l={},c={},u={x:t.currentPoints.image.x+r.x,y:t.currentPoints.image.y+r.y};0===e.index?La(u,n,t,n.handles.end)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?La(u,n,t,n.handles.start)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(a=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},a=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(a,n.handles.start),s=y.cornerstoneMath.point.distance(a,n.handles.end),(!a||i<3||s<3)&&(o=!0)),o||Na(u,n,t,n.handles.perpendicularEnd)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(a=y.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},a=y.cornerstoneMath.lineSegment.intersectLine(l,c),i=y.cornerstoneMath.point.distance(a,n.handles.start),s=y.cornerstoneMath.point.distance(a,n.handles.end),(!a||i<3||s<3)&&(o=!0)),o||Na(u,n,t,n.handles.perpendicularStart)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))},Ua=function(e,t,n){var r=e[n],o=t[n];e[n]=o,t[n]=r},Va=function(e,t){Ua(e,t,"x"),Ua(e,t,"y"),Ua(e,t,"moving"),Ua(e,t,"hover"),Ua(e,t,"active"),Ua(e,t,"selected")},Fa=function(e){var t,n=this,r=e.detail,o=r.element,a=so("mouse",this.name),i=function(e){t.invalidated=!0,wr(r,t.handles)&&O(o,n.name,t),e&&(e.moving=!1,e.selected=!0),St(n.element,n.svgCursor),y.cornerstone.updateImage(o),o.addEventListener(w.MOUSE_MOVE,n._moveCallback),o.addEventListener(w.TOUCH_START,n._moveCallback)},s=r.startPoints.canvas,l=L(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,a],d=vr.apply(void 0,u);if(d)return o.removeEventListener(w.MOUSE_MOVE,n._moveCallback),o.removeEventListener(w.TOUCH_START,n._moveCallback),t.active=!0,ja(t.handles),d.moving=!0,(d=function(e,t,n){var r=e.image,o=r.rowPixelSpacing,a=r.columnPixelSpacing,i=t.handles,s=i.start,l=i.end,c=i.perpendicularStart,u=i.perpendicularEnd,d=(s.x-l.x)*(a||1),f=(s.y-l.y)*(o||1),h=Math.sqrt(d*d+f*f),p=(c.x-u.x)*(a||1),m=(c.y-u.y)*(o||1);return(Math.sqrt(p*p+m*m)||0)>h?(Va(s,l),Va(s,c),Va(l,u),Object.values(i).find((function(e){return!0===e.moving}))):n}(r,t,d)).hasBoundingBox||Ct(n.element),function(e,t,n,r,o,a){var i=e.element,s=e.image,l=e.buttons,c={x:r.x-e.currentPoints.image.x,y:r.y-e.currentPoints.image.y},u=function(e){var o=e.detail;r.hasMoved=!0,void 0===r.index||null===r.index?(r.x=o.currentPoints.image.x+c.x,r.y=o.currentPoints.image.y+c.y):Ba(r,o,n,c),a&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,o.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,o.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Dr(i,l,"mouse");u instanceof mo&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,w.MEASUREMENT_MODIFIED,d)};r.active=!0,r.moving=!0,vt.isToolLocked=!0,i.addEventListener(w.MOUSE_DRAG,u),i.addEventListener(w.TOUCH_DRAG,u);var d=y.cornerstone.getImage(i),f=function(){y.cornerstone.getImage(i).imageId!==d.imageId&&h()};i.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,f);var h=function e(){r.active=!1,vt.isToolLocked=!1,i.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,f),i.removeEventListener(w.MOUSE_DRAG,u),i.removeEventListener(w.MOUSE_UP,e),i.removeEventListener(w.MOUSE_CLICK,e),i.removeEventListener(w.TOUCH_DRAG,u),i.removeEventListener(w.TOUCH_DRAG_END,e),i.removeEventListener(w.TAP,e),y.cornerstone.updateImage(i),"function"==typeof o&&o()};i.addEventListener(w.MOUSE_UP,h),i.addEventListener(w.MOUSE_CLICK,h),i.addEventListener(w.TOUCH_DRAG_END,h),i.addEventListener(w.TAP,h)}(r,n.name,t,d,(function(){return i(d)})),za(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===x()(d))return d.v}var f=function(e){return function(){Ha(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"mouse")){o.removeEventListener(w.MOUSE_MOVE,this._moveCallback),o.removeEventListener(w.TOUCH_START,this._moveCallback),t.active=!0,ja(t.handles),Ha(t.handles,!0);var h=f(t.handles);return _r(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",h),za(e),!0}}},ja=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Ha=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},za=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},qa=[w.TOUCH_END,w.TOUCH_DRAG_END,w.TOUCH_PINCH,w.TOUCH_PRESS,w.TAP],Wa=function(e){var t,n=this,r=e.detail,o=r.element,a=vt.touchProximity,i=function(e){t.invalidated=!0,wr(r,t.handles)&&O(o,n.name,t),e&&(e.moving=!1,e.selected=!0),y.cornerstone.updateImage(o),o.addEventListener(w.TOUCH_DRAG,n._moveCallback)},s=r.startPoints.canvas,l=L(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,a],d=vr.apply(void 0,u);if(d)return o.removeEventListener(w.TOUCH_DRAG,n._moveCallback),t.active=!0,Ga(t.handles),d.moving=!0,function(e,t,n,r,o,a){var i=e.element,s=e.image,l=e.buttons,c={x:r.x-e.currentPoints.image.x,y:r.y-e.currentPoints.image.y},u=function(e){var o=e.detail;r.hasMoved=!0,void 0===r.index||null===r.index?(r.x=o.currentPoints.image.x+c.x,r.y=o.currentPoints.image.y+c.y):Ba(r,o,n,c),a&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,o.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,o.image.height)),n.invalidated=!0,y.cornerstone.updateImage(i);var u=Dr(i,l,"touch");u instanceof mo&&u.updateCachedStats(s,i,n);var d={toolName:t,toolType:t,element:i,measurementData:n};y.cornerstone.triggerEvent(i,w.MEASUREMENT_MODIFIED,d)};r.active=!0,vt.isToolLocked=!0,i.addEventListener(w.TOUCH_DRAG,u);var d=function e(){r.active=!1,vt.isToolLocked=!1,i.removeEventListener(w.TOUCH_DRAG,u),qa.forEach((function(t){i.removeEventListener(t,e)})),y.cornerstone.updateImage(i),"function"==typeof o&&o()};qa.forEach((function(e){i.addEventListener(e,d)}))}(r,n.name,t,d,(function(){return i(d)})),Za(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===x()(d))return d.v}var f=function(e){return function(){Ya(e,!1),i()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"touch")){o.removeEventListener(w.TOUCH_DRAG,this._moveCallback),t.active=!0,Ga(t.handles),Ya(t.handles,!0);var h=f(t.handles);return _r(r,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",h),Za(e),!0}}},Ga=function(e){var t=!1;return Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)})),t},Ya=function(e,t){Object.keys(e).forEach((function(n){"textBox"!==n&&(e[n].moving=t)}))},Za=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Xa=function(e,t,n){return n()},Qa=function(e){function t(e){var n;i()(this,t);var r={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:Xa,getMeasurementLocationCallback:Xa,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:To};return(n=u()(this,f()(t).call(this,e,r))).throttledUpdateCachedStats=la(n.updateCachedStats,110),n.createNewMeasurement=ga.bind(Cr()(n)),n.pointNearTool=ya.bind(Cr()(n)),n.renderToolData=Ta.bind(Cr()(n)),n.addNewMeasurement=Sa.bind(Cr()(n)),n._moveCallback=Aa.bind(Cr()(n)),n.handleSelectedCallback=Ma.bind(Cr()(n)),n.handleSelectedMouseCallback=Fa.bind(Cr()(n)),n.handleSelectedTouchCallback=Wa.bind(Cr()(n)),n}return p()(t,e),l()(t,[{key:"updateCachedStats",value:function(e,t,n){if(n.toolName===this.name){var r=function(e,t){var n=t.rowPixelSpacing,r=t.colPixelSpacing,o=e.handles,a=o.start,i=o.end,s=o.perpendicularStart,l=o.perpendicularEnd,c=(a.x-i.x)*(r||1),u=(a.y-i.y)*(n||1),d=Math.sqrt(c*c+u*u),f=(s.x-l.x)*(r||1),h=(s.y-l.y)*(n||1),p=Math.sqrt(f*f+h*h);if(p||(p=0),p>d){var m=d;d=p,p=m}return{longestDiameter:d.toFixed(1),shortestDiameter:p.toFixed(1)}}(n,aa(e)),o=r.longestDiameter,a=r.shortestDiameter;n.longestDiameter=o,n.shortestDiameter=a,n.invalidated=!1}}}]),t}(mo),Ka=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=y.cornerstone,o=r.metaData.get("patientStudyModule",e.imageId),a=r.metaData.get("generalSeriesModule",e.imageId);if(o&&a&&"PT"===a.modality){var i=n?t:t*e.slope+e.intercept,s=o.patientWeight;if(s){var l=r.metaData.get("petIsotopeModule",e.imageId);if(l){var c=l.radiopharmaceuticalInfo,u=c.radiopharmaceuticalStartTime,d=c.radionuclideTotalDose,f=c.radionuclideHalfLife,h=a.seriesTime;if(u&&d&&f&&h){var p=Ja(h.fractionalSeconds||0)+h.seconds+60*h.minutes+60*h.hours*60-(Ja(u.fractionalSeconds||0)+u.seconds+60*u.minutes+60*u.hours*60);return i*s/(d*Math.exp(-p*Math.log(2)/f))*1e3}}}}};function Ja(e){return parseFloat(".".concat(e))}var $a=function(e,t){var n=e.width/2,r=e.height/2;if(n<=0||r<=0)return!1;var o=e.left+n,a=e.top+r,i=t.x-o,s=t.y-a;return i*i/(n*n)+s*s/(r*r)<=1},ei=function(e,t){for(var n=0,r=0,o=0,a=0,i=null,s=null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)$a(t,{x:c,y:l})&&(null===i&&(i=e[a],s=e[a]),n+=e[a],r+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),o++),a++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=r/o-u*u;return{count:o,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}},ti={calculateEllipseStatistics:ei,pointInEllipse:$a};function ni(e,t){var n=function(e){var t=[e.start,e.end].sort((function(e,t){return e.x<t.x?-1:1})),n=[e.start,e.end].sort((function(e,t){return e.y<t.y?-1:1})),r=t[0],o=t[t.length-1];return{top:n[0],left:r,bottom:n[n.length-1],right:o}}(t),r=(n.left.x+n.right.x)/2,o=(n.top.y+n.bottom.y)/2,a={};return e.rotation>=0&&e.rotation<90&&(a.x=e.hflip?n.left.x:n.right.x,a.y=o),e.rotation>=90&&e.rotation<180&&(a.x=r,a.y=e.vflip?n.bottom.y:n.top.y),e.rotation>=180&&e.rotation<270&&(a.x=e.hflip?n.right.x:n.left.x,a.y=o),e.rotation>=270&&e.rotation<360&&(a.x=r,a.y=e.vflip?n.top.y:n.bottom.y),a}var ri=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},oi=U("tools:annotation:CircleRoiTool"),ai=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:So,configuration:{centerPointRadius:0,renderDashed:!1,hideHandlesIfMoving:!1}};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};oi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end,a=y.cornerstoneMath.point.distance;if(o||oi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=y.cornerstone.pixelToCanvas(e,t.handles.start),l=y.cornerstone.pixelToCanvas(e,t.handles.end),c=a(s,n),u=a(s,l);return c>u-i/2&&c<u+i/2}},{key:"updateCachedStats",value:function(e,t,n){var r=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=aa(e),a=function(e,t,n,r,o){var a,i=ye(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=ei(s,i);"PT"===r&&(a={mean:Ka(e,l.mean,!0)||0,stdDev:Ka(e,l.stdDev,!0)||0});var c=i.width*(o&&o.colPixelSpacing||1)/2,u=2*Math.PI*c;return{area:Math.PI*(i.width*(o&&o.colPixelSpacing||1)/2)*(i.height*(o&&o.rowPixelSpacing||1)/2)||0,radius:c||0,perimeter:u||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,o);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=L(e.currentTarget,this.name);if(n){var r=y.cornerstoneMath.point.distance,o=e.detail,a=o.image,i=o.element,s=o.canvasContext,l=Zt.getToolWidth(),c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,f=c.hideHandlesIfMoving,h=c.renderDashed,p=c.centerPointRadius,m=Pn(s.canvas),g=aa(a),v=g.rowPixelSpacing,b=g.colPixelSpacing,x=xt("globalConfiguration").configuration.lineDash,w=(y.cornerstone.metaData.get("generalSeriesModule",a.imageId)||{}).modality,T=v&&b;Wt(m,(function(e){for(var s=0;s<n.data.length;s++){var c=n.data[s];if(!1!==c.visible){var m=un.getColorIfActive(c),g={color:m,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:f};kn(e,t.configuration);var v=y.cornerstone.pixelToCanvas(i,c.handles.start),b=y.cornerstone.pixelToCanvas(i,c.handles.end),I=r(v,b),S={color:m};if(h&&(S.lineDash=x),$t(e,i,c.handles.start,I,S,"pixel"),p&&I>3*p&&$t(e,i,c.handles.start,p,S,"pixel"),c.handles&&(c.handles.start.drawnIndependently=!0,c.handles.end.drawnIndependently=!0),dn(e,o,c.handles,g),!0===c.invalidated&&(c.cachedStats?t.throttledUpdateCachedStats(a,i,c):t.updateCachedStats(a,i,c)),!c.handles.textBox.hasMoved){var C=ni(o.viewport,c.handles);Object.assign(c.handles.textBox,C)}var E=si(e,a.color,c.cachedStats,w,T,t.configuration);c.unit=ii(w,t.configuration.showHounsfieldUnits),An(e,i,c.handles.textBox,E,c.handles,(function(e){return n=(t=ye(e.start,e.end)).left,r=t.top,[{x:n+(o=t.width)/2,y:r},{x:n,y:r+(a=t.height)/2},{x:n+o/2,y:r+a},{x:n+o,y:r+a/2}];var t,n,r,o,a}),m,l,10,!0)}}}))}}}]),t}(mo);function ii(e,t){return"CT"===e&&!1!==t?"HU":""}function si(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,o=void 0===r?0:r,a=n.radius,i=void 0===a?0:a,s=n.perimeter,l=void 0===s?0:s,c=n.mean,u=void 0===c?0:c,d=n.stdDev,f=void 0===d?0:d,h=n.min,p=void 0===h?0:h,m=n.max,g=void 0===m?0:m,v=n.meanStdDevSUV,y=void 0===v?0:v,b=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},T=w.showMinMax||!1,I=[],S=[];if(!t){var C=y&&0!==y.mean,E=ii(b,w.showHounsfieldUnits),A="Mean: ".concat(ri(u.toFixed(2))," ").concat(E),M="Std Dev: ".concat(ri(f.toFixed(2))," ").concat(E);if(C){for(var P=" SUV: ",D="".concat(P).concat(ri(y.mean.toFixed(2))),k="".concat(P).concat(ri(y.stdDev.toFixed(2))),L=Math.floor(e.measureText("".concat(M,"     ")).width);e.measureText(A).width<L;)A+=" ";S.push("".concat(A).concat(D)),S.push("".concat(M,"     ").concat(k))}else S.push("".concat(A,"     ").concat(M));if(T){for(var O="Min: ".concat(p," ").concat(E),R="Max: ".concat(g," ").concat(E),_=C?Math.floor(e.measureText("".concat(M,"     ")).width):Math.floor(e.measureText("".concat(A,"     ")).width);e.measureText(O).width<_;)O+=" ";S.push("".concat(O).concat(R))}}return I.push(li(o,x)),i&&I.push(ci(i,"Radius",x)),l&&I.push(ci(l,"Perimeter",x)),S.forEach((function(e){return I.push(e)})),I}function li(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(ri(e.toFixed(2))).concat(n)}function ci(e,t,n){if(!e)return"";var r=n?" mm":" px";return"".concat(t,": ").concat(ri(e.toFixed(1))).concat(r)}var ui=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Io,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,r))).hasIncomplete=!1,e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(this.hasIncomplete)return!1;var r=go(e,t.handles.start,t.handles.end,n)<25,o=go(e,t.handles.start2,t.handles.end2,n)<25;return r||o}},{key:"updateCachedStats",value:function(e,t,n){var r=aa(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(Math.ceil(n.handles.start.x)-Math.ceil(n.handles.end.x))*(a||1),s=(Math.ceil(n.handles.start.y)-Math.ceil(n.handles.end.y))*(o||1),l=(Math.ceil(n.handles.start2.x)-Math.ceil(n.handles.end2.x))*(a||1),c=(Math.ceil(n.handles.start2.y)-Math.ceil(n.handles.end2.y))*(o||1),u=Math.acos(Math.abs((i*l+s*c)/(Math.sqrt(i*i+s*s)*Math.sqrt(l*l+c*c))));u*=180/Math.PI,n.rAngle=vo(u,2),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,a=r.drawHandlesOnHover,i=r.hideHandlesIfMoving,s=r.renderDashed,l=L(e.currentTarget,this.name);if(l)for(var c=Pn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=xt("globalConfiguration").configuration.lineDash,f=vn.getFont(),h=e.detail.element,p=aa(y.cornerstone.getEnabledElement(h).image),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=function(e){var r=l.data[e];if(!1===r.visible)return"continue";r.value||(r.value=t.textBoxText(r,m,g)),Wt(c,(function(e){kn(e,t.configuration);var l=un.getColorIfActive(r),c={color:l};s&&(c.lineDash=d),Qt(e,n.element,r.handles.start,r.handles.end,c),r.complete&&Qt(e,n.element,r.handles.start2,r.handles.end2,c);var h={color:l,handleRadius:o,drawHandlesIfActive:a,hideHandlesIfMoving:i};t.configuration.drawHandles&&dn(e,n,r.handles,h),e.fillStyle=l;var p=r.value;if(!r.handles.textBox.hasMoved){var m={x:(r.handles.start.x+r.handles.end.x)/2,y:(r.handles.start.y+r.handles.end.y)/2-10};e.font=f,r.handles.textBox.x=m.x,r.handles.textBox.y=m.y}An(e,n.element,r.handles.textBox,p,r.handles,x,l,u,0,!0)}))},b=0;b<l.data.length;b++)v(b);function x(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=L(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))}},{key:"addNewMeasurement",value:function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r,o,a=e.detail,i=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:s,measurementData:r};T(s,t,o)}else O(s,n.name,r)},s=e.detail.element,l=this.getIncomplete(s);l?((r=l).complete=!0,r.handles.start2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},r.handles.end2={x:a.currentPoints.image.x,y:a.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},o=r.handles.end2,this.hasIncomplete=!1,i=function(e){if(e){var t=w.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:s,measurementData:r};T(s,t,o)}else O(s,n.name,r)}):(r=this.createNewMeasurement(a),k(s,this.name,r),o=r.handles.end),y.cornerstone.updateImage(s),to(a,this.name,r,o,this.options,t,i)}},{key:"onMeasureModified",value:function(e){var t=e.detail.element,n=y.cornerstone.getEnabledElement(t).image,r=aa(n),o=r.rowPixelSpacing,a=r.colPixelSpacing;if(e.detail.toolName===this.name){var i=e.detail.measurementData;!0===i.invalidated&&(i.rAngle?this.throttledUpdateCachedStats(n,t,i):this.updateCachedStats(n,t,i)),i.value=this.textBoxText(i,o,a)}}},{key:"textBoxText",value:function(e,t,n){var r=e.rAngle;if(void 0===r)return"";if(Number.isNaN(r))return"";var o=t&&n?"":" (isotropic)";return"".concat(r,"°").concat(o)}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(w.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(mo),di=U("tools:annotation:EllipticalRoiTool"),fi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Co};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};di.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||di.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;if(vr(e,t.handles,n,6))return!0;var a="mouse"===r?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x)+a/2,top:Math.min(i.y,s.y)+a/2,width:Math.abs(i.x-s.x)-a,height:Math.abs(i.y-s.y)-a},c={left:Math.min(i.x,s.x)-a/2,top:Math.min(i.y,s.y)-a/2,width:Math.abs(i.x-s.x)+a,height:Math.abs(i.y-s.y)+a},u=$a(l,n);return!(!$a(c,n)||u)}},{key:"updateCachedStats",value:function(e,t,n){var r=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=aa(e),a=function(e,t,n,r,o){var a,i=gi(n.start,n.end),s=y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),l=ei(s,i);return"PT"===r&&(a={mean:Ka(e,l.mean,!0)||0,stdDev:Ka(e,l.stdDev,!0)||0}),{area:Math.PI*(i.width*(o.colPixelSpacing||1)/2)*(i.height*(o.rowPixelSpacing||1)/2)||0,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,o);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=L(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,a=r.element,i=Zt.getToolWidth(),s=xt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=Pn(r.canvasContext.canvas),p=aa(o),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=(y.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,b=m&&g;Wt(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=un.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};kn(e,t.configuration);var g={color:p};if(f&&(g.lineDash=s),an(e,a,h.handles.start,h.handles.end,g,"pixel",h.handles.initialRotation),dn(e,r,h.handles,m),!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(o,a,h):t.updateCachedStats(o,a,h)),!h.handles.textBox.hasMoved){var y=ni(r.viewport,h.handles);Object.assign(h.handles.textBox,y)}var x=pi(e,o.color,h.cachedStats,v,b,t.configuration);h.unit=hi(v,t.configuration.showHounsfieldUnits),An(e,a,h.handles.textBox,x,h.handles,(function(e){return n=(t=gi(e.start,e.end)).left,r=t.top,[{x:n+(o=t.width)/2,y:r},{x:n,y:r+(a=t.height)/2},{x:n+o/2,y:r+a},{x:n+o,y:r+a/2}];var t,n,r,o,a}),p,i,10,!0)}}}))}}}]),t}(mo);function hi(e,t){return"CT"===e&&!1!==t?"HU":""}function pi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,o=void 0===r?0:r,a=n.mean,i=void 0===a?0:a,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,f=void 0===d?0:d,h=n.meanStdDevSUV,p=void 0===h?0:h,m=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=v.showMinMax||!1,b=[],x=[];if(!t){var w=p&&0!==p.mean,T=hi(m,v.showHounsfieldUnits),I="Mean: ".concat(ri(i.toFixed(2))," ").concat(T),S="Std Dev: ".concat(ri(l.toFixed(2))," ").concat(T);if(w){for(var C=" SUV: ",E="".concat(C).concat(ri(p.mean.toFixed(2))),A="".concat(C).concat(ri(p.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(S,"     ")).width);e.measureText(I).width<M;)I+=" ";x.push("".concat(I).concat(E)),x.push("".concat(S,"     ").concat(A))}else x.push("".concat(I)),x.push("".concat(S));if(y){for(var P="Min: ".concat(u," ").concat(T),D="Max: ".concat(f," ").concat(T),k=w?Math.floor(e.measureText("".concat(S,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(P).width<k;)P+=" ";x.push("".concat(P).concat(D))}}return b.push(mi(o,g)),x.forEach((function(e){return b.push(e)})),b}function mi(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(ri(e.toFixed(2))).concat(n)}function gi(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var vi=function(e,t){for(var n=!1,r=e.length-1,o=0;o<e.length;o++)yi(t,e[o],e[r])&&(n=!n),r=o;return n};function yi(e,t,n){return r=e.y,o=t.y,a=n.y,!(!(o<r&&r<a||a<r&&r<o)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var r=t;t=n,n=r}var o=function(e,t,n){var r=(n.y-t.y)/(n.x-t.x);return{value:t.y+r*(e.x-t.x),gradient:r}}(e,t,n);return Math.sign(o.gradient)*e.y>Math.sign(o.gradient)*o.value}(e,t,n));var r,o,a}function bi(e,t,n,r){vi(e,t)&&(n.value+=r,n.squared+=r*r,n.count++)}var xi=function e(t,n){i()(this,e),this.toolIndex=t,this.handleIndexArray=n},wi=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=r,this.lines=[]};function Ti(e,t,n,r){for(var o=e.length-1,a=0;a<e.length;a++)if(-1===r.indexOf(a)&&-1===r.indexOf(o)){if(Ii(t,n,Si(e[o]),Si(e[a])))return!0;o=a}else o=a;return!1}function Ii(e,t,n,r){var o=!1,a=[Ci(e,t,n),Ci(e,t,r),Ci(n,r,e),Ci(n,r,t)];return a[0]!==a[1]&&a[2]!==a[3]||((0===a[0]&&Ei(e,n,t)||0===a[1]&&Ei(e,r,t)||0===a[2]&&Ei(n,e,r)||0===a[3]&&Ei(n,t,r))&&(o=!0),o)}function Si(e){return{x:e.x,y:e.y}}function Ci(e,t,n){var r=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===r?0:r>0?1:2}function Ei(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}var Ai={newHandle:function(e,t){var n=t.length-1;return Ti(t,Si(t[n]),Si(e),[n])},end:function(e){var t=e.length-1;return Ti(e,Si(e[t]),Si(e[0]),[t,0])},modify:function(e,t){var n=Si(e[t]),r=t-1;0===t&&(r=e.length-1);var o=Si(e[r]);return!!Ti(e,n,o,[t,r])||Ti(e,n,o=Si(e[r=t===e.length-1?0:t+1]),[t,r])}},Mi=function(){function e(t,n){i()(this,e),this._eventData=t,this._toolName=n}return l()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=L(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var r=this._nearestHandleToPoint(n);null!==r&&r.distance<t.distance&&(t=r)}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e],r=n.handles.points;if(void 0===r)return null;if(!1===n.visible)return null;for(var o={toolIndex:e,handleIndex:null,distance:1/0},a=0;a<r.length;a++){var i=y.cornerstone.pixelToCanvas(t.element,r[a]),s=y.cornerstoneMath.point.distance(i,this._mousePoint);s<o.distance&&(o.handleIndex=a,o.distance=s)}return o}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles.points,r=[],o=0;o<n.length;o++){var a=e.getNextHandleIndex(o,n.length);this._distanceOfPointfromLine(n[o],n[a])<10&&r.push([o,a])}return r}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new xi(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var r=this._eventData,o=this._toolData.data[t],a=o.handles.points;if(void 0!==o.handles.points){if(!1===o.visible)return!1;var i=a[n[0]],s=a[n[1]],l=e.getCanvasPointsFromHandles(i,s,r.element),c=e.getLineAsVector(l),u=this._getLineOriginToMouseAsVector(l),d=(u[0]*c[0]+u[1]*c[1])/c.magnitude;return d>0&&d<c.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,r=y.cornerstone.pixelToCanvas(n.element,e),o=y.cornerstone.pixelToCanvas(n.element,t),a=this._mousePoint;return Math.abs((o.y-r.y)*a.x-(o.x-r.x)*a.y+o.x*r.y-o.y*r.x)/y.cornerstoneMath.point.distance(r,o)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var r=[];return e.x<t.x?(r.push(y.cornerstone.pixelToCanvas(n,e)),r.push(y.cornerstone.pixelToCanvas(n,t))):(r.push(y.cornerstone.pixelToCanvas(n,t)),r.push(y.cornerstone.pixelToCanvas(n,e))),r}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=y.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),Pi=function(e,t){t===e.length-1?e[t].lines.push(e[0]):e[t].lines.push(e[t+1])};function Di(e,t){var n=L(e.element,this.name);if(void 0!==n){var r=t.handleIndex,o=t.toolIndex,a=n.data[o],i=a.handles.points;i.length<=3||(r===i.length-1?(i[r-1].lines.pop(),i[r-1].lines.push(i[0])):0===r?(i[i.length-1].lines.pop(),i[i.length-1].lines.push(i[r+1])):(i[r-1].lines.pop(),i[r-1].lines.push(i[r+1])),i.splice(r,1),a.invalidated=!0,a.active=!0,a.highlight=!0,y.cornerstone.updateImage(e.element))}}function ki(e,t){var n=L(e.element,this.name);if(void 0!==n){var r=n.data[t.toolIndex],o=function(e){for(var t=e.handleIndexArray,n=1/0,r=t.includes(0),o=0;o<t.length;o++){var a=t[o];0!==a&&a<n&&(n=a)}return r&&1===n&&(n=0),++n}(t);if(o!==1/0){var a=new wi(e.currentPoints.image),i=r.handles.points;i.splice(o,0,a),i[o-1].lines.pop(),i[o-1].lines.push(e.currentPoints.image),Pi(i,o),r.active=!0,r.highlight=!0,r.invalidated=!0,y.cornerstone.updateImage(e.element)}}}var Li={calculateFreehandStatistics:function(e,t,n){var r={count:0,mean:0,variance:0,stdDev:0},o=function(e,t,n){for(var r={value:0,squared:0,count:0},o=0,a=t.top;a<t.top+t.height;a++)for(var i=t.left;i<t.left+t.width;i++)bi(n,{x:i,y:a},r,e[o]),o++;return r}(e,t,n);return 0===o.count||(r.count=o.count,r.mean=o.value/o.count,r.variance=o.squared/o.count-r.mean*r.mean,r.stdDev=Math.sqrt(r.variance)),r},ClickedLineData:xi,freehandArea:function(e,t){var n=0,r=e.length-1;t=t||1;for(var o=0;o<e.length;o++)n+=(e[r].x+e[o].x)*(e[r].y-e[o].y),r=o;return Math.abs(n*t/2)},FreehandHandleData:wi,freehandIntersect:Ai,FreehandLineFinder:Mi,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby){var r={toolIndex:t.toolIndex,handleIndex:t.handleNearby};Di.call(this,n,r)}else{var o=new Mi(n,this.name).findLine();o&&ki.call(this,n,o)}},pointInFreehand:vi,addLine:Pi},Oi=U("tools:annotation:FreehandRoiTool"),Ri=Li.insertOrDelete,_i=Li.freehandArea,Ni=Li.calculateFreehandStatistics,Bi=Li.freehandIntersect,Ui=Li.FreehandHandleData,Vi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1},svgCursor:Eo};return(e=u()(this,f()(t).call(this,n,r))).isMultiPartTool=!0,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(Cr()(e)),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(Cr()(e)),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(Cr()(e)),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(Cr()(e)),e._drawingMouseDoubleClickCallback=e._drawingMouseDoubleClickCallback.bind(Cr()(e)),e._editMouseUpCallback=e._editMouseUpCallback.bind(Cr()(e)),e._editMouseDragCallback=e._editMouseDragCallback.bind(Cr()(e)),e._drawingTouchStartCallback=e._drawingTouchStartCallback.bind(Cr()(e)),e._drawingTouchDragCallback=e._drawingTouchDragCallback.bind(Cr()(e)),e._drawingDoubleTapClickCallback=e._drawingDoubleTapClickCallback.bind(Cr()(e)),e._editTouchDragCallback=e._editTouchDragCallback.bind(Cr()(e)),e.throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}Oi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.points;if(!r)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!r||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var r=1/0,o=0;o<t.handles.points.length;o++){var a=y.cornerstoneMath.point.distance(t.handles.points[o],n);r=Math.min(r,a)}return r===1/0?-1:r}},{key:"distanceFromPointCanvas",value:function(e,t,n){var r=1/0;if(!t)return-1;for(var o=y.cornerstone.pixelToCanvas(e,n),a=t.handles.points,i=0;i<a.length;i++){var s=y.cornerstone.pixelToCanvas(e,a[i]),l=y.cornerstoneMath.point.distance(s,o);r=Math.min(r,l)}return r===1/0?-1:r}},{key:"updateCachedStats",value:function(e,t,n){for(var r,o,a=y.cornerstone.metaData.get("generalSeriesModule",e.imageId),i=a?a.modality:null,s=n.handles.points,l={left:s[0].x,right:s[0].x,bottom:s[0].y,top:s[0].x},c=0;c<s.length;c++)l.left=Math.min(l.left,s[c].x),l.right=Math.max(l.right,s[c].x),l.bottom=Math.min(l.bottom,s[c].y),l.top=Math.max(l.top,s[c].y);var u={left:l.left,top:l.bottom,width:Math.abs(l.right-l.left),height:Math.abs(l.top-l.bottom)};if(n.polyBoundingBox=u,!e.color){var d=y.cornerstone.getPixels(t,u.left,u.top,u.width,u.height);r=Ni.call(this,d,u,n.handles.points),"PT"===i&&(o={mean:Ka(e,(r.mean-e.intercept)/e.slope),stdDev:Ka(e,(r.stdDev-e.intercept)/e.slope)}),r&&!isNaN(r.mean)&&(n.meanStdDev=r,n.meanStdDevSUV=o)}var f=aa(e),h=(f.colPixelSpacing||1)*(f.rowPixelSpacing||1),p=_i(n.handles.points,h);isNaN(p)||(n.area=p),n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=L(e.currentTarget,this.name);if(r)for(var o=n.image,a=n.element,i=this.configuration,s=y.cornerstone.metaData.get("generalSeriesModule",o.imageId),l=s?s.modality:null,c=Pn(n.canvasContext.canvas),u=Zt.getToolWidth(),d=i.renderDashed,f=xt("globalConfiguration").configuration.lineDash,h=function(e){var s=r.data[e];if(!1===s.visible)return"continue";Wt(c,(function(e){var r,l=un.getColorIfActive(s);s.active?s.handles.invalidHandlePlacement?(l=i.invalidColor,r=i.invalidColor):(l=un.getColorIfActive(s),r=un.getFillColor()):r=un.getToolColor();var c={color:l};if(d&&(c.lineDash=f),s.handles.points.length){var h=s.handles.points;Kt(e,a,h[0],h,c),s.polyBoundingBox?Kt(e,a,h[h.length-1],[h[0]],c):Kt(e,a,h[h.length-1],[i.mouseLocation.handles.start],c)}if(c={color:l,fill:r},(i.alwaysShowHandles||s.active&&s.polyBoundingBox)&&(c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,s.handles.points,c)),s.canComplete){c.handleRadius=i.completeHandleRadius;var p=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[p],c)}if(s.active&&!s.polyBoundingBox){c.handleRadius=i.activeHandleRadius,t.configuration.drawHandles&&dn(e,n,i.mouseLocation.handles,c);var v=s.handles.points[0];t.configuration.drawHandles&&dn(e,n,[v],c)}if(!0!==s.invalidated||s.active||(s.meanStdDev&&s.meanStdDevSUV&&s.area?t.throttledUpdateCachedStats(o,a,s):t.updateCachedStats(o,a,s)),s.polyBoundingBox&&!s.handles.textBox.freehand){s.handles.textBox.hasMoved||(s.handles.textBox.x=s.polyBoundingBox.left+s.polyBoundingBox.width,s.handles.textBox.y=s.polyBoundingBox.top+s.polyBoundingBox.height/2);var y=m.call(t,s);An(e,a,s.handles.textBox,y,s.handles.points,g,l,u,0,!0)}}))},p=0;p<r.data.length;p++)h(p);function m(e){var t=e.meanStdDev,n=e.meanStdDevSUV,r=e.area,a=[];if(t&&void 0!==t.mean){var i="";"CT"===l&&(i="HU"),e.unit=i;var s="Mean: ".concat(ri(t.mean.toFixed(2))," ").concat(i),c="StdDev: ".concat(ri(t.stdDev.toFixed(2))," ").concat(i);n&&void 0!==n.mean&&(s+=" SUV: "+ri(n.mean.toFixed(2)),c+=" SUV: "+ri(n.stdDev.toFixed(2))),a.push(s),a.push(c)}if(r){var u=" mm".concat(String.fromCharCode(178)),d=aa(o),f=d.rowPixelSpacing,h=d.colPixelSpacing;f&&h||(u=" pixels".concat(String.fromCharCode(178)));var p="Area: ".concat(ri(r.toFixed(2))).concat(u);a.push(p)}return a}function g(e){return e}}},{key:"addNewMeasurement",value:function(e){var t=e.detail;this._startDrawing(e),this._addPoint(t),Fi(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||Ri.call(this,e,n),Fi(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=e.detail.element,a=L(o,this.name);if(n.hasBoundingBox)uo(e,this,t,n,r);else{var i=this.configuration;i.dragOrigin={x:n.x,y:n.y};for(var s=0;s<a.data.length;s++)for(var l=a.data[s].handles.points,c=0;c<l.length;c++)l[c]===n&&(i.currentHandle=c,i.currentTool=s);this._modifying=!0,this._activateModify(o),Fi(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element,o=L(r,this.name),a=this.configuration,i=a.currentTool,s=o.data[i],l=n.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(s,t);var c=this._pointNearHandle(r,s,l),u=s.handles.points;void 0!==c&&!c.hasBoundingBox&&c<u.length-1&&(a.mouseLocation.handles.start.x=u[c].x,a.mouseLocation.handles.start.y=u[c].y),y.cornerstone.updateImage(r)}},{key:"_drawingMouseDragCallback",value:function(e){this.options.mouseButtonMask.includes(e.detail.buttons)&&this._drawingDrag(e)}},{key:"_drawingTouchDragCallback",value:function(e){this._drawingDrag(e)}},{key:"_drawingDrag",value:function(e){var t=e.detail,n=t.element,r=L(n,this.name),o=this.configuration.currentTool,a=r.data[o];this._getMouseLocation(t),this._checkInvalidHandleLocation(a,t),this._addPointPencilMode(t,a.handles.points),this._dragging=!0,y.cornerstone.updateImage(n)}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;if(this._dragging){this._dragging=!1;var n=this.configuration,r=n.currentTool,o=L(t,this.name).data[r];if(!Bi.end(o.handles.points)&&o.canComplete){var a=n.currentHandle;this._endDrawing(t,a)}Fi(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.buttons,r=t.currentPoints,o=t.element;if(this.options.mouseButtonMask.includes(n)){var a=r.canvas,i=this.configuration,s=i.currentTool,l=L(o,this.name).data[s],c=this._pointNearHandle(o,l,a);if(!Bi.end(l.handles.points)&&l.canComplete){var u=i.currentHandle;this._endDrawing(o,u)}else void 0===c&&this._addPoint(t);Fi(e)}}},{key:"_drawingTouchStartCallback",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element,o=n.canvas,a=this.configuration,i=a.currentTool,s=L(r,this.name).data[i],l=this._pointNearHandle(r,s,o);if(!Bi.end(s.handles.points)&&s.canComplete){var c=a.currentHandle;this._endDrawing(r,c)}else void 0===l&&this._addPoint(t);Fi(e)}},{key:"completeDrawing",value:function(e){if(this._drawing){var t=L(e,this.name),n=this.configuration,r=t.data[n.currentTool];if(!Bi.end(r.handles.points)&&r.handles.points.length>=2){var o=n.currentHandle;r.polyBoundingBox={},this._endDrawing(e,o)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fi(e)}},{key:"_drawingDoubleTapClickCallback",value:function(e){var t=e.detail.element;this.completeDrawing(t),Fi(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=t.element,r=t.buttons;if(this.options.mouseButtonMask.includes(r)){var o,a=L(n,this.name),i=this.configuration,s=a.data[i.currentTool],l=i.currentHandle,c=s.handles.points;if(this._getMouseLocation(t),s.handles.invalidHandlePlacement=Bi.modify(c,l),s.active=!0,s.highlight=!0,c[l].x=i.mouseLocation.handles.start.x,c[l].y=i.mouseLocation.handles.start.y,o=this._getPrevHandleIndex(l,c),l>=0){var u=c[o].lines.length-1,d=c[o].lines[u];d.x=i.mouseLocation.handles.start.x,d.y=i.mouseLocation.handles.start.y}y.cornerstone.updateImage(n)}}},{key:"_editTouchDragCallback",value:function(e){var t,n=e.detail,r=n.element,o=L(r,this.name),a=this.configuration,i=o.data[a.currentTool],s=a.currentHandle,l=i.handles.points;if(this._getMouseLocation(n),i.handles.invalidHandlePlacement=Bi.modify(l,s),i.active=!0,i.highlight=!0,l[s].x=a.mouseLocation.handles.start.x,l[s].y=a.mouseLocation.handles.start.y,t=this._getPrevHandleIndex(s,l),s>=0){var c=l[t].lines.length-1,u=l[t].lines[c];u.x=a.mouseLocation.handles.start.x,u.y=a.mouseLocation.handles.start.y}y.cornerstone.updateImage(r)}},{key:"_getPrevHandleIndex",value:function(e,t){return 0===e?t.length-1:e-1}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,r=L(n,this.name);this._deactivateModify(n),this._dropHandle(t,r),this._endDrawing(n),y.cornerstone.updateImage(n)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,r=n.currentTool,o=t.data[r].handles,a=o.points;if(o.invalidHandlePlacement){var i,s=n.currentHandle,l=a[s];i=0===s?a[a.length-1]:a[s-1],l.x=n.dragOrigin.x,l.y=n.dragOrigin.y,i.lines[0]=l,o.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t,n=e.detail,r=this.createNewMeasurement(n),o=n.element,a=this.configuration;e.type===w.MOUSE_DOWN_ACTIVATE?t="Mouse":e.type===w.TOUCH_START_ACTIVE&&(t="Touch"),this._activateDraw(o,t),this._getMouseLocation(n),k(o,this.name,r);var i=L(o,this.name);a.currentTool=i.data.length-1,this._activeDrawingToolReference=i.data[a.currentTool]}},{key:"_addPoint",value:function(e){var t=e.currentPoints,n=e.element,r=L(n,this.name),o=this.configuration,a=r.data[o.currentTool];if(!a.handles.invalidHandlePlacement){var i=new Ui(t.image);a.handles.points.length&&a.handles.points[o.currentHandle-1].lines.push(t.image),a.handles.points.push(i),o.currentHandle+=1,y.cornerstone.updateImage(n),this.fireModifiedEvent(n,a)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,r=this.configuration,o=e.element,a=r.mouseLocation.handles.start;t.every((function(e){return n._isDistanceLargerThanSpacing(o,e,a)}))&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=L(e,this.name),r=this.configuration,o=n.data[r.currentTool];if(o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,void 0!==t){var a=o.handles.points;a[r.currentHandle-1].lines.push(a[0])}this._modifying&&(this._modifying=!1,o.invalidated=!0),r.currentHandle=0,r.currentTool=-1,o.canComplete=!1,this._drawing&&this._deactivateDraw(e),y.cornerstone.updateImage(e),this.fireModifiedEvent(e,o),this.fireCompletedEvent(e,o)}},{key:"_pointNearHandle",value:function(e,t,n){if(void 0!==t.handles&&void 0!==t.handles.points&&!1!==t.visible){for(var r=0;r<t.handles.points.length;r++){var o=y.cornerstone.pixelToCanvas(e,t.handles.points[r]);if(y.cornerstoneMath.point.distance(o,n)<6)return r}return t.handles.textBox&&mr(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.currentPoints,n=e.element,r=t.canvas,o=L(n,this.name);if(o)for(var a,i=0;i<o.data.length;i++)if(void 0!==(a=this._pointNearHandle(n,o.data[i],r)))return{handleNearby:a,toolIndex:i}}},{key:"_getMouseLocation",value:function(e){var t=e.currentPoints,n=e.image,r=this.configuration;r.mouseLocation.handles.start.x=t.image.x,r.mouseLocation.handles.start.y=t.image.y,In(r.mouseLocation.handles.start,n)}},{key:"_checkInvalidHandleLocation",value:function(e,t){if(e.handles.points.length<2)return!0;var n;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,r=t.element,o=n.mouseLocation.handles.start,a=e.handles.points,i=!1;return e.canComplete=!1,this._isDistanceSmallerThanCompleteSpacingCanvas(r,a[0],o)&&!Bi.end(a)&&a.length>2?(e.canComplete=!0,i=!1):i=Bi.newHandle(o,a),i}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,r=e.handles.points,o=Bi.newHandle(n,r);return!1===o&&(o=this._invalidHandlePencilMode(e,t)),o}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,r=t.element,o=n.mouseLocation.handles.start,a=e.handles.points;if(this._isDistanceSmallerThanCompleteSpacingCanvas(r,a[0],o))return e.canComplete=!0,!1;e.canComplete=!1;for(var i=1;i<a.length-1;i++)if(this._isDistanceSmallerThanSpacing(r,a[i],o))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(e,t,n){var r,o=y.cornerstone.pixelToCanvas(e,t),a=y.cornerstone.pixelToCanvas(e,n);return"Mouse"===this._drawingInteractionType?r=this.configuration.completeHandleRadius:"Touch"===this._drawingInteractionType&&(r=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(e,o,a,"<",r)}},{key:"_isDistanceSmallerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(e,t,n){return this._compareDistanceToSpacing(e,t,n,">")}},{key:"_compareDistanceToSpacing",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.configuration.spacing;return">"===r?y.cornerstoneMath.point.distance(t,n)>o:y.cornerstoneMath.point.distance(t,n)<o}},{key:"_activateDraw",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=t,vt.isMultiPartToolActive=!0,Ct(this.element),e.addEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.addEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.addEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.addEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.addEventListener(w.TOUCH_END,this._drawingMouseUpCallback),e.addEventListener(w.DOUBLE_TAP,this._drawingDoubleTapClickCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){this._drawing=!1,vt.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,St(this.element,this.svgCursor),e.removeEventListener(w.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(w.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),e.removeEventListener(w.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(w.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(w.TOUCH_START,this._drawingTouchStartCallback),e.removeEventListener(w.TOUCH_DRAG,this._drawingTouchDragCallback),e.removeEventListener(w.TOUCH_START,this._drawingMouseMoveCallback),e.removeEventListener(w.TOUCH_END,this._drawingMouseUpCallback),y.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){vt.isToolLocked=!0,e.addEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.addEventListener(w.TOUCH_END,this._editMouseUpCallback),e.addEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){vt.isToolLocked=!1,e.removeEventListener(w.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(w.MOUSE_CLICK,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_END,this._editMouseUpCallback),e.removeEventListener(w.TOUCH_DRAG,this._editTouchDragCallback),y.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),y.cornerstone.updateImage(e)}}},{key:"fireModifiedEvent",value:function(e,t){T(e,w.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"fireCompletedEvent",value:function(e,t){T(e,w.MEASUREMENT_COMPLETED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})}},{key:"cancelDrawing",value:function(e){if(this._drawing){var t=L(e,this.name),n=this.configuration,r=t.data[n.currentTool];r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1,n.currentHandle=0,n.currentTool=-1,r.canComplete=!1,O(e,this.name,r),this._deactivateDraw(e),y.cornerstone.updateImage(e)}}},{key:"newImageCallback",value:function(e){var t=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var n=e.detail.element,r=this._activeDrawingToolReference;r.active=!1,r.highlight=!1,r.handles.invalidHandlePlacement=!1;var o=r.handles.points;o[t.currentHandle-1].lines.push(o[0]),t.currentHandle=0,t.currentTool=-1,r.canComplete=!1,this._deactivateDraw(n),y.cornerstone.updateImage(n)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,y.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,y.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,y.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,y.cornerstone.updateImage(this.element)}}]),t}(mo);function Fi(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}var ji=U("tools:annotation:LengthTool"),Hi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Mo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,r=t.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:n,y:r,highlight:!0,active:!1},end:{x:n,y:r,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}ji.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){return t&&t.handles&&t.handles.start&&t.handles.end?!1!==t.visible&&go(e,t.handles.start,t.handles.end,n)<25:(ji.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(e,t,n){var r=aa(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(n.handles.end.x-n.handles.start.x)*(a||1),s=(n.handles.end.y-n.handles.start.y)*(o||1),l=Math.sqrt(i*i+s*s);n.length=l,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,a=r.drawHandlesOnHover,i=r.hideHandlesIfMoving,s=r.renderDashed,l=r.digits,c=L(e.currentTarget,this.name);if(c)for(var u=Pn(n.canvasContext.canvas),d=n.image,f=n.element,h=aa(d),p=h.rowPixelSpacing,m=h.colPixelSpacing,g=Zt.getToolWidth(),v=xt("globalConfiguration").configuration.lineDash,y=function(e){var r=c.data[e];if(!1===r.visible)return"continue";Wt(u,(function(e){kn(e,t.configuration);var c=un.getColorIfActive(r),u={color:c};s&&(u.lineDash=v),Qt(e,f,r.handles.start,r.handles.end,u);var h={color:c,handleRadius:o,drawHandlesIfActive:a,hideHandlesIfMoving:i};if(t.configuration.drawHandles&&dn(e,n,r.handles,h),!r.handles.textBox.hasMoved){var y={x:Math.max(r.handles.start.x,r.handles.end.x)};y.x===r.handles.start.x?y.y=r.handles.start.y:y.y=r.handles.end.y,r.handles.textBox.x=y.x,r.handles.textBox.y=y.y}!0===r.invalidated&&(r.length?t.throttledUpdateCachedStats(d,f,r):t.updateCachedStats(d,f,r));var b=function(e,t,n){var r,o,a=(r=e.length,o=Number(r),isNaN(o)?void 0:o);if(!a)return"";var i="mm";return t&&n||(i="pixels"),e.unit=i,"".concat(a.toFixed(l)," ").concat(i)}(r,p,m);An(e,f,r.handles.textBox,b,r.handles,x,c,g,10,!0)}))},b=0;b<c.data.length;b++)y(b);function x(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}}]),t}(mo),zi=function(e,t,n,r,o){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var a,i,s,l=y.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(i=0;i<o;i++)for(s=0;s<r;s++){var f=d[a=4*((i+n)*l.image.columns+(s+t))],h=d[a+1],p=d[a+2],m=d[a+3];c[u++]=f,c[u++]=h,c[u++]=p,c[u++]=m}return c},qi=U("tools:annotation:ProbeTool"),Wi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Po,configuration:{drawHandles:!0,renderDashed:!1}};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};qi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var r=t&&t.handles&&t.handles.end;if(r||qi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!r||!1===t.visible)return!1;var o=y.cornerstone.pixelToCanvas(e,t.handles.end);return y.cornerstoneMath.point.distance(o,n)<5}},{key:"updateCachedStats",value:function(e,t,n){var r=Math.round(n.handles.end.x),o=Math.round(n.handles.end.y),a={};r>=0&&o>=0&&r<e.columns&&o<e.rows&&(a.x=r,a.y=o,e.color?a.storedPixels=zi(t,r,o,1,1):(a.storedPixels=y.cornerstone.getStoredPixels(t,r,o,1,1),a.sp=a.storedPixels[0],a.mo=a.sp*e.slope+e.intercept,a.suv=Ka(e,a.sp))),n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,a=r.renderDashed,i=L(e.currentTarget,this.name);if(i)for(var s=Pn(n.canvasContext.canvas),l=n.image,c=n.element,u=vn.getFontSize(),d=xt("globalConfiguration").configuration.lineDash,f=function(e){var r=i.data[e];if(!1===r.visible)return"continue";Wt(s,(function(e){var i,s,f=un.getColorIfActive(r);if(t.configuration.drawHandles){var h={handleRadius:o,color:f};a&&(h.lineDash=d),dn(e,n,r.handles,h)}!0===r.invalidated&&(r.cachedStats?t.throttledUpdateCachedStats(l,c,r):t.updateCachedStats(l,c,r));var p=r.cachedStats,m=p.x,g=p.y,v=p.storedPixels,b=p.sp,x=p.mo,w=p.suv;if(m>=0&&g>=0&&m<l.columns&&g<l.rows){i="".concat(m,", ").concat(g),l.color?s="R: ".concat(v[0]," G: ").concat(v[1]," B: ").concat(v[2]):(s="SP: ".concat(b," MO: ").concat(parseFloat(x.toFixed(3))),w&&(s+=" SUV: ".concat(parseFloat(w.toFixed(3)))));var T={x:r.handles.end.x+3,y:r.handles.end.y-3},I=y.cornerstone.pixelToCanvas(n.element,T);wn(e,s,I.x,I.y+u+5,f),wn(e,i,I.x,I.y,f)}}))},h=0;h<i.data.length;h++)f(h)}}]),t}(mo),Gi=U("tools:annotation:RectangleRoiTool"),Yi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Do};return(e=u()(this,f()(t).call(this,n,r))).throttledUpdateCachedStats=la(e.updateCachedStats,110),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Gi.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||Gi.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var a="mouse"===r?15:25,i=y.cornerstone.pixelToCanvas(e,t.handles.start),s=y.cornerstone.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x),top:Math.min(i.y,s.y),width:Math.abs(i.x-s.x),height:Math.abs(i.y-s.y)};return y.cornerstoneMath.rect.distanceToPoint(l,n)<a}},{key:"updateCachedStats",value:function(e,t,n){var r=(y.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=aa(e),a=function(e,t,n,r,o){var a,i=Zi(n.start,n.end),s=function(e,t){for(var n=0,r=0,o=0,a=0,i=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[a],r+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),o++,a++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=r/o-u*u;return{count:o,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}}(y.cornerstone.getPixels(t,i.left,i.top,i.width,i.height),i);return"PT"===r&&(a={mean:Ka(e,s.mean,!0)||0,stdDev:Ka(e,s.stdDev,!0)||0}),{area:i.width*(o.colPixelSpacing||1)*(i.height*(o.rowPixelSpacing||1))||0,perimeter:2*i.width*(o.colPixelSpacing||1)+2*i.height*(o.rowPixelSpacing||1),count:s.count||0,mean:s.mean||0,variance:s.variance||0,stdDev:s.stdDev||0,min:s.min||0,max:s.max||0,meanStdDevSUV:a}}(e,t,n.handles,r,o);n.cachedStats=a,n.invalidated=!1}},{key:"renderToolData",value:function(e){var t=this,n=L(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,a=r.element,i=Zt.getToolWidth(),s=xt("globalConfiguration").configuration.lineDash,l=this.configuration,c=l.handleRadius,u=l.drawHandlesOnHover,d=l.hideHandlesIfMoving,f=l.renderDashed,h=Pn(r.canvasContext.canvas),p=aa(o),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=(y.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,b=m&&g;Wt(h,(function(e){for(var l=0;l<n.data.length;l++){var h=n.data[l];if(!1!==h.visible){var p=un.getColorIfActive(h),m={color:p,handleRadius:c,drawHandlesIfActive:u,hideHandlesIfMoving:d};kn(e,t.configuration);var g={color:p};if(f&&(g.lineDash=s),Mn(e,a,h.handles.start,h.handles.end,g,"pixel",h.handles.initialRotation),t.configuration.drawHandles&&dn(e,r,h.handles,m),!0===h.invalidated&&(h.cachedStats?t.throttledUpdateCachedStats(o,a,h):t.updateCachedStats(o,a,h)),!h.handles.textBox.hasMoved){var y=ni(r.viewport,h.handles);Object.assign(h.handles.textBox,y)}var x=Ki(e,o.color,h.cachedStats,v,b,t.configuration);h.unit=Qi(v,t.configuration.showHounsfieldUnits),An(e,a,h.handles.textBox,x,h.handles,(function(e){return n=(t=Zi(e.start,e.end)).left,r=t.top,[{x:n+(o=t.width)/2,y:r},{x:n,y:r+(a=t.height)/2},{x:n+o/2,y:r+a},{x:n+o,y:r+a/2}];var t,n,r,o,a}),p,i,10,!0)}}}))}}}]),t}(mo);function Zi(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function Xi(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(ri(e.toFixed(2))).concat(n)}function Qi(e,t){return"CT"===e&&!1!==t?"HU":""}function Ki(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.area,o=void 0===r?0:r,a=n.mean,i=void 0===a?0:a,s=n.stdDev,l=void 0===s?0:s,c=n.min,u=void 0===c?0:c,d=n.max,f=void 0===d?0:d,h=n.meanStdDevSUV,p=void 0===h?0:h,m=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},y=v.showMinMax||!1,b=[],x=[];if(!t){var w=p&&0!==p.mean,T=Qi(m,v.showHounsfieldUnits),I="Mean: ".concat(ri(i.toFixed(2))," ").concat(T),S="Std Dev: ".concat(ri(l.toFixed(2))," ").concat(T);if(w){for(var C=" SUV: ",E="".concat(C).concat(ri(p.mean.toFixed(2))),A="".concat(C).concat(ri(p.stdDev.toFixed(2))),M=Math.floor(e.measureText("".concat(S,"     ")).width);e.measureText(I).width<M;)I+=" ";x.push("".concat(I).concat(E)),x.push("".concat(S,"     ").concat(A))}else x.push("".concat(I)),x.push("".concat(S));if(y){for(var P="Min: ".concat(u," ").concat(T),D="Max: ".concat(f," ").concat(T),k=w?Math.floor(e.measureText("".concat(S,"     ")).width):Math.floor(e.measureText("".concat(I,"     ")).width);e.measureText(P).width<k;)P+=" ";x.push("".concat(P).concat(D))}}return b.push(Xi(o,g)),x.forEach((function(e){return b.push(e)})),b}var Ji=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:$i},svgCursor:ko};return(e=u()(this,f()(t).call(this,n,r))).touchPressCallback=e._changeText.bind(Cr()(e)),e.doubleClickCallback=e._changeText.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},r={left:0,top:0,width:e.image.width,height:e.image.height};if(y.cornerstoneMath.point.insideRect(n.handles.end,r)){var o=t.markers.indexOf(t.current);return(o+=t.ascending?1:-1)>=t.markers.length?o=t.loop?0:-1:o<0&&(o=t.loop?t.markers.length:-1),t.current=t.markers[o],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var r=y.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),o=mr(t.handles.end,n);return r<10||o}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,r=L(t.element,this.name);if(r)for(var o=Pn(t.canvasContext.canvas),a=function(e){var a=r.data[e];if(!1===a.visible)return"continue";var i=un.getColorIfActive(a);Wt(o,(function(e){kn(e,n);var r=y.cornerstone.pixelToCanvas(t.element,a.handles.end);a.handles.end.boundingBox=wn(e,a.text,r.x,r.y-10,i,{centering:{x:!0,y:!0}})}))},i=0;i<r.data.length;i++)a(i)}},{key:"_changeText",value:function(e){var t,n=e.detail,r=n.element,o=n.currentPoints;function a(e,t,n){!0===n?O(r,this.name,e):e.text=t,e.active=!1,y.cornerstone.updateImage(r)}var i=this.configuration,s=o.canvas,l=L(r,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(r,t,s))return t.active=!0,y.cornerstone.updateImage(r),i.changeTextCallback(t,n,a),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(mo),$i=function(e,t,n){n(e,prompt("Change your annotation:"))},es=(U("tools:BrushTool"),xt("segmentation")),ts=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._paint.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_paint",value:function(e){var t=es.configuration,n=e.detail,r=(n.element,n.image),o=r.rows,a=r.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>a||l<0||l>o)){var c=we(t.radius,o,a,s,l),u=this.paintEventData,d=u.labelmap2D,f=u.labelmap3D,h=u.shouldErase;te(c,d.pixelData,f.activeSegmentIndex,a,h),y.cornerstone.updateImage(e.detail.element)}}}]),t}(Mr),ns=U("tools:SphericalBrushTool"),rs=xt("segmentation"),os=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._paint.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_startPainting",value:function(e){var t,n=rs.configuration,r=rs.getters,o=e.detail,a=o.element,i=o.image,s=y.cornerstone,l=n.radius,c=i.rows,u=i.columns,d=Math.max(i.rowPixelSpacing,i.columnPixelSpacing),f=L(a,"stack").data[0].imageIds,h=r.labelmap2D(a),p=h.labelmap2D,m=h.labelmap3D,g=h.currentImageIdIndex,v=h.activeLabelmapIndex,b=this._isCtrlDown(o)||this.configuration.alwaysEraseOnClick,x=s.metaData.get("imagePlaneModule",i.imageId);if(x){var w=x.imagePositionPatient;t=this._getImagesInRange(g,w,f,l,d)}else ns.warn("No imagePlane metadata found for image, defaulting to circle brush application."),t=[{imageIdIndex:g,radiusOnImage:l}];if(this.paintEventData={labelmap2D:p,labelmap3D:m,currentImageIdIndex:g,activeLabelmapIndex:v,shouldErase:b,imagesInRange:t},n.storeHistory){for(var T=[],I=0;I<t.length;I++){var S=t[I].imageIdIndex,C=r.labelmap2DByImageIdIndex(m,S,c,u).pixelData.slice();T.push(C)}this.paintEventData.previousPixeldataForImagesInRange=T}}},{key:"_paint",value:function(e){var t=rs.getters,n=e.detail,r=(n.element,n.image),o=r.rows,a=r.columns,i=n.currentPoints.image,s=i.x,l=i.y;if(!(s<0||s>a||l<0||l>o)){for(var c=this.paintEventData,u=c.labelmap3D,d=c.imagesInRange,f=c.shouldErase,h=0;h<d.length;h++){var p=d[h],m=p.imageIdIndex;te(we(p.radiusOnImage,o,a,s,l),t.labelmap2DByImageIdIndex(u,m,o,a).pixelData,u.activeSegmentIndex,a,f)}y.cornerstone.updateImage(e.detail.element)}}},{key:"_getImagesInRange",value:function(e,t,n,r,o){for(var a=r*o,i=[{imageIdIndex:e,radiusOnImage:r}],s=e+1;s<n.length;s++){var l=this._getRadiusOnImage(n[s],t,a,o);if(!l)break;i.push({imageIdIndex:s,radiusOnImage:l})}for(var c=e-1;c>=0;c--){var u=this._getRadiusOnImage(n[c],t,a,o);if(!u)break;i.push({imageIdIndex:c,radiusOnImage:u})}return i}},{key:"_getRadiusOnImage",value:function(e,t,n,r){var o=y.cornerstone.metaData.get("imagePlaneModule",e);if(o){var a=o.imagePositionPatient,i=Math.sqrt(Math.pow(a[0]-t[0],2)+Math.pow(a[1]-t[1],2)+Math.pow(a[2]-t[2],2));if(!(i>n))return Math.floor(Math.sqrt(Math.pow(n,2)-Math.pow(i,2))/r)}else ns.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(e,","))}},{key:"_endPainting",value:function(e){for(var t=this.paintEventData,n=t.labelmap3D,r=t.imagesInRange,o=[],a=rs.configuration,i=rs.setters,s=0;s<r.length;s++){for(var l=r[s].imageIdIndex,c=n.labelmaps2D[l],u=new Set(c.pixelData).values(),d=[],f=!1;!f;){var h=u.next();(f=h.done)||d.push(h.value)}if(c.segmentsOnLabelmap=d,a.storeHistory){var p=this.paintEventData.previousPixeldataForImagesInRange[s],m=n.labelmaps2D[l].pixelData;o.push({imageIdIndex:l,diff:Oe(p,m)})}}a.storeHistory&&i.pushState(this.element,o),Le(this.element)}}]),t}(Mr),as=U("util:segmentation:operations:correction");function is(e,t){var n=t.pixelData,r=t.segmentIndex,o=t.segmentationMixinType;if("freehandSegmentationMixin"===o){var a=function(e,t){for(var n=t.pixelData,r=t.points,o=e.detail.image,a=o.width,i=o.height,s=[],l=0;l<r.length;l++){var c=r[l],u=Math.floor(c.x),d=Math.floor(c.y);u=En(u,0,a-1),d=En(d,0,i-1);var f=s[s.length-1];f&&u===f.x&&d===f.y||s.push({x:u,y:d,segment:n[d*a+u]})}return s}(e,t),i=function(e,t){for(var n=!0,r=!0,o=0;o<e.length&&(e[o].segment===t?r=!1:n=!1,n||r);o++);return r?{isScissorOperation:!0,operation:"fillInsideFreehand"}:n?{isScissorOperation:!0,operation:"eraseInsideFreehand"}:{isScissorOperation:!1}}(a,r);if(i.isScissorOperation)"fillInsideFreehand"===i.operation?(as.warn("The line never intersects a segment."),ws(e,t)):"eraseInsideFreehand"===i.operation&&(as.warn("The line is only ever inside the segment."),hs(e,t));else{var s=new Uint8Array(n.length);(function(e,t){var n=e[0].segment===t,r=[];r.push({additive:!n,nodes:[]});for(var o=0,a=0;a<e.length;a++){var i=e[a];n?(r[o].nodes.push(i),i.segment!==t&&(o++,n=!n,r.push({additive:!0,nodes:[]}),r[o].nodes.push(e[a-1]),r[o].nodes.push(i))):(r[o].nodes.push(i),i.segment===t&&(o++,n=!n,r.push({additive:!1,nodes:[]}),r[o].nodes.push(e[a-1]),r[o].nodes.push(i)))}return r.pop(),r.shift(),r})(a,r).forEach((function(t){!function(e,t,n,r,o){var a=o.detail.image,i=a.width,s=a.height,l=e.nodes,c=e.additive,u=c?0:1,d=function(e){return e.y*i+e.x},f=function(e){return{x:e%i,y:Math.floor(e/i)}};c?as.warn("additive operation..."):as.warn("subtractive operation...");for(var h=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push(e[n]),t.push.apply(t,J()(Se(e[n],e[n+1])));t.push[e[e.length-1]];for(var r=[],o=[],a=0;a<t.length-1;a++){var i=cs(t[a],t[a+1]),s=i.left,l=i.right;r.push(s),o.push(l)}return{pixelPath:t,leftPath:r,rightPath:o}}(l),p=h.pixelPath,m=h.leftPath,g=h.rightPath,v=p[0],y={xMin:v.x,xMax:v.x,yMin:v.y,yMax:v.y},b=0;b<n.length;b++)t[b]===r?(ss(y,f(b)),n[b]=1):n[b]=0;for(var x=0;x<p.length;x++){var w=p[x];n[d(w)]=2,ss(y,w)}!function(e,t,n){e.xMax=Math.min(e.xMax+2,n),e.xMin=Math.max(e.xMin-2,0),e.yMax=Math.min(e.yMax+2,t),e.yMin=Math.max(e.yMin-2,0)}(y,s,i);var T=y.xMin,I=y.xMax,S=y.yMin,C=y.yMax;function E(e,t){if(!(e>=I||e<T||t>=C||t<S))return n[t*i+e]}for(var A=0,M=0,P=0;P<m.length;P++){var D=m[P];n[d(D)]===u&&Ge(D,s,i)&&(A+=ls(D,3,n,E,i));var k=g[P];n[d(k)]===u&&Ge(k,s,i)&&(M+=ls(k,4,n,E,i))}if(0!==A&&0!==M){for(var L=c?r:0,O=A<M?3:4,R=0;R<n.length;R++)n[R]===O&&(t[R]=L);if(L===r)for(var _=0;_<p.length;_++)t[d(p[_])]=r;else for(var N=0;N<p.length;N++){var B=d(p[N]);t[B]===r&&(t[B]=0)}}}(t,n,s,r,e)}))}}else as.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(o))}function ss(e,t){var n=t.x,r=t.y;n<e.xMin&&(e.xMin=n),n>e.xMax&&(e.xMax=n),r<e.yMin&&(e.yMin=r),r>e.yMax&&(e.yMax=r)}function ls(e,t,n,r,o){for(var a=pe(r,[e.x,e.y]).flooded,i=0;i<a.length;i++){var s=a[i];n[s[1]*o+s[0]]=t}return a.length}function cs(e,t){var n={x:t.x-e.x,y:t.y-e.y};return-1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y-1},right:{x:e.x+1,y:e.y+1}}:0===n.x&&1===n.y?{left:{x:e.x-1,y:e.y},right:{x:e.x+1,y:e.y}}:1===n.x&&1===n.y?{left:{x:e.x-1,y:e.y+1},right:{x:e.x+1,y:e.y-1}}:1===n.x&&0===n.y?{left:{x:e.x,y:e.y+1},right:{x:e.x,y:e.y-1}}:1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y+1},right:{x:e.x-1,y:e.y-1}}:0===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y},right:{x:e.x-1,y:e.y}}:-1===n.x&&-1===n.y?{left:{x:e.x+1,y:e.y-1},right:{x:e.x-1,y:e.y+1}}:-1===n.x&&0===n.y?{left:{x:e.x,y:e.y-1},right:{x:e.x,y:e.y+1}}:void as.error("Unable to find left and right paths for flood fill ",e,t,n)}function us(e,t){for(var n=e[0],r=e[1],o=!1,a=0,i=t.length-1;a<t.length;i=a++){var s=t[a][0],l=t[a][1],c=t[i][0],u=t[i][1];l>r!=u>r&&n<(c-s)*(r-l)/(u-l)+s&&(o=!o)}return o}var ds=U("util:segmentation:operations:eraseInsideFreehand");function fs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("freehandSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=oe()(s,2),c=l[0],u=l[1];n?se(e,t,(function(e){return us([e.x,e.y],i)}),c,u):le(e,t,(function(e){return us([e.x,e.y],i)}),c,u)}else ds.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(o))}function hs(e,t){fs(e,t,!0)}function ps(e,t){fs(e,t,!1)}var ms=U("util:segmentation:operations:eraseInsideRectangle");function gs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("rectangleSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=oe()(s,2),c=l[0],u=l[1];n?se(e,t,(function(){return!0}),c,u):ne(e,t,c,u)}else ms.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(o))}function vs(e,t){gs(e,t,!0)}function ys(e,t){gs(e,t,!1)}var bs=U("util:segmentation:operations:fillInsideFreehand");function xs(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("freehandSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=oe()(s,2),c=l[0],u=l[1];n?fe(e,t,(function(e){return us([e.x,e.y],i)}),c,u):he(e,t,(function(e){return us([e.x,e.y],i)}),c,u)}else bs.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(o))}function ws(e,t){xs(e,t,!0)}function Ts(e,t){xs(e,t,!1)}var Is=U("util:segmentation:operations:fillInsideRectangle");function Ss(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.points,o=t.segmentationMixinType;if("rectangleSegmentationMixin"===o){var a=e.detail.image,i=r.map((function(e){return[e.x,e.y]})),s=xe(i,a),l=oe()(s,2),c=l[0],u=l[1];n?fe(e,t,(function(){return!0}),c,u):ce(e,t,c,u)}else Is.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(o))}function Cs(e,t){Ss(e,t,!0)}function Es(e,t){Ss(e,t,!1)}var As=U("util:segmentation:operations:fillCircle");function Ms(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var o=e.detail,a=be(e),i=oe()(a,2),s=i[0],l=i[1],c=ye(o.handles.start,o.handles.end);n?fe(e,t,(function(e){return $a(c,e)}),s,l):he(e,t,(function(e){return $a(c,e)}),s,l)}else As.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function Ps(e,t){Ms(e,t,!0)}function Ds(e,t){Ms(e,t,!1)}var ks=U("util:segmentation:operations:eraseInsideCircle");function Ls(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.segmentationMixinType;if("circleSegmentationMixin"===r){var o=e.detail,a=be(e),i=oe()(a,2),s=i[0],l=i[1],c=ye(o.handles.start,o.handles.end);n?se(e,t,(function(e){return $a(c,e)}),s,l):le(e,t,(function(e){return $a(c,e)}),s,l)}else ks.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(r))}function Os(e,t){Ls(e,t,!0)}function Rs(e,t){Ls(e,t,!1)}var _s=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"FreehandScissors",strategies:{FILL_INSIDE:ws,FILL_OUTSIDE:Ts,ERASE_OUTSIDE:ps,ERASE_INSIDE:hs},cursors:{FILL_INSIDE:Zo,FILL_OUTSIDE:Qo,ERASE_OUTSIDE:Xo,ERASE_INSIDE:Yo},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Zo,mixins:["freehandSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),Ns=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RectangleScissors",strategies:{FILL_INSIDE:Cs,FILL_OUTSIDE:Es,ERASE_OUTSIDE:ys,ERASE_INSIDE:vs},cursors:{FILL_INSIDE:Jo,FILL_OUTSIDE:ea,ERASE_OUTSIDE:$o,ERASE_INSIDE:Ko},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),Bs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CircleScissors",strategies:{FILL_INSIDE:Ps,FILL_OUTSIDE:Ds,ERASE_OUTSIDE:Rs,ERASE_INSIDE:Os},cursors:{FILL_INSIDE:na,FILL_OUTSIDE:oa,ERASE_OUTSIDE:ra,ERASE_INSIDE:ta},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:na,mixins:["circleSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),Us=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"CorrectionScissors",strategies:{CORRECTION:is},cursors:{CORRECTION:Zo},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Zo,mixins:["polylineSegmentationMixin"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),t}(pr),Vs={},Fs={},js={};function Hs(e){if(!e)return"DEFAULT";var t=y.cornerstone.getEnabledElement(e).uuid;if(!t)throw new Error("Something went wrong when getting uuid from element");return t}var zs={setStartLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);Vs[n]=e},getStartLoadHandler:function(e){var t=Hs(e);return Vs[t]||Vs.DEFAULT},setEndLoadHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);Fs[n]=e},getEndLoadHandler:function(e){var t=Hs(e);return Fs[t]||Fs.DEFAULT},setErrorLoadingHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!e)throw new Error("The Handler function must be defined");var n=Hs(t);js[n]=e},getErrorLoadingHandler:function(e){var t=Hs(e);return js[t]||js.DEFAULT},removeHandlers:function(e){var t=Hs(e);delete Vs[t],delete Fs[t],delete js[t]}},qs={};function Ws(e,t){if(!qs[e])return{};var n=qs[e].find((function(e){return e.element===t}));return n?n.options:{}}function Gs(e,t,n){if(qs[e]){var r=qs[e].findIndex((function(e){return e.element===t}));if(-1===r)qs[e].push({element:t,options:n});else{var o=qs[e][r].options||{};qs[e][r].options=Object.assign(o,n)}}else qs[e]=[{element:t,options:n}]}var Ys=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Lo};return(e=u()(this,f()(t).call(this,n,r))).preMouseDownCallback=e._chooseLocation.bind(Cr()(e)),e.mouseDragCallback=e._chooseLocation.bind(Cr()(e)),e.touchDragCallback=e._chooseLocation.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var r=L(n,this.name);if(r){var o=n,a=y.cornerstone.getEnabledElement(o).image.imageId,i=y.cornerstone.metaData.get("imagePlaneModule",a);if(i){var s=nn(t.currentPoints.image,i);r.data[0].synchronizationContext.getSourceElements().forEach((function(e){if(e!==o){var t=Number.MAX_VALUE,n=-1,r=L(e,"stack");if(void 0!==r){var a=r.data[0];if(a.imageIds.forEach((function(e,r){var o=y.cornerstone.metaData.get("imagePlaneModule",e);if(o&&o.imagePositionPatient&&o.rowCosines&&o.columnCosines){var a=en(o.imagePositionPatient),i=en(o.rowCosines),l=en(o.columnCosines).clone().cross(i.clone()),c=Math.abs(l.clone().dot(a)-l.clone().dot(s));c<t&&(t=c,n=r)}})),n!==a.currentImageIdIndex&&-1!==n&&void 0!==a.imageIds[n]){var i=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);i&&i(e),(!0===a.preventCache?y.cornerstone.loadImage(a.imageIds[n]):y.cornerstone.loadAndCacheImage(a.imageIds[n])).then((function(t){var r=y.cornerstone.getViewport(e);a.currentImageIdIndex=n,y.cornerstone.displayImage(e,t,r),l&&l(e,t)}),(function(t){var r=a.imageIds[n];c&&c(e,r,t)}))}}}}))}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,r=t.synchronizationContext;Gs(this.name,e,{mouseButtonMask:n}),R(e,this.name),k(e,this.name,{synchronizationContext:r})}}]),t}(pr),Zs=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;y.cornerstone.fitToWindow(t.element)}}]),t}(pr),Xs=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"DragProbe",strategies:{default:Qs,minimal:Ks},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Po};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._movingEventCallback.bind(Cr()(e)),e.touchEndCallback=e._endMovingEventCallback.bind(Cr()(e)),e.mouseDragCallback=e._movingEventCallback.bind(Cr()(e)),e.mouseUpCallback=e._endMovingEventCallback.bind(Cr()(e)),e.dragEventData={},e}return p()(t,e),l()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,y.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},y.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(pr);function Qs(e){var t=this.configuration,n=y.cornerstone,r=e.detail,o=r.element,a=r.image,i=r.currentPoints,s=r.canvasContext,l=Pn(s.canvas),c=un.getActiveColor(),u=vn.getFontSize(),d=Math.round(i.image.x),f=Math.round(i.image.y);d<0||f<0||d>=a.columns||f>=a.rows||Wt(l,(function(e){kn(e,t);var r,s,l="".concat(d,", ").concat(f);if(a.color)r=zi(o,d,f,1,1),s="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]," A: ").concat(r[3]);else{var h=(r=n.getStoredPixels(o,d,f,1,1))[0],p=h*a.slope+a.intercept,m=Ka(a,h);s="SP: ".concat(h," MO: ").concat(parseFloat(p.toFixed(3))),m&&(s+=" SUV: ".concat(parseFloat(m.toFixed(3))))}var g={x:i.canvas.x+5,y:i.canvas.y-5};wn(e,s,g.x,g.y+u+5,c),wn(e,l,g.x,g.y,c)}))}function Ks(e){var t=this.configuration,n=y.cornerstone,r=e.detail,o=r.element,a=r.image,i=r.currentPoints,s=r.canvasContext,l=r.isTouchEvent,c=Pn(s.canvas),u=un.getActiveColor(),d=i.page.y-vn.getFontSize()/2;l&&(d=i.page.y-4*vn.getFontSize());var f=n.pageToPixel(o,i.page.x,d);f.x<0||f.y<0||f.x>=a.columns||f.y>=a.rows||Wt(c,(function(e){kn(e,t);var r,i=n.metaData.get("generalSeriesModule",a.imageId),s=i&&i.modality,c="";if(a.color)r=zi(o,f.x,f.y,1,1),c="R: ".concat(r[0]," G: ").concat(r[1]," B: ").concat(r[2]);else{var d=(r=n.getStoredPixels(o,f.x,f.y,1,1))[0],h=d*a.slope+a.intercept,p=parseFloat(h.toFixed(2));if("CT"===s)c+="HU: ".concat(p);else if("PT"===s){c+=p;var m=Ka(a,d);m&&(c+=" SUV: ".concat(parseFloat(m.toFixed(2))))}else c+=p}var g=n.pixelToCanvas(o,f),v={x:12,y:-(vn.getFontSize()+10)/2},y=xn(e,c,5);l&&(v={x:-y/2,y:-vn.getFontSize()-10-12}),$t(e,o,g,6,{color:u},"canvas"),wn(e,c,g.x+v.x,g.y+v.y,u)}))}var Js=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Oo};return(e=u()(this,f()(t).call(this,n,r))).preMouseDownCallback=e._deleteAllNearbyTools.bind(Cr()(e)),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;return vt.tools.forEach((function(e){var r=L(n,e.name);r&&r.data.forEach((function(r){"function"==typeof e.pointNearTool&&e.pointNearTool(n,r,t)&&(O(n,e.name,r),y.cornerstone.updateImage(n))}))})),!0}}]),t}(pr),$s=Li.FreehandHandleData,el=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:tl(),svgCursor:Ao};return(e=u()(this,f()(t).call(this,n,r))).updateOnMouseMove=!0,e.isMultiPartTool=!0,e.referencedToolName=e.initialConfiguration.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(Cr()(e)),e.activeTouchEndCallback=e.activeTouchEndCallback.bind(Cr()(e)),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=e.detail;if(null===this.configuration.currentTool)return!1;var n=t.element,r=this.configuration;if(!L(n,this.referencedToolName).data[r.currentTool])return!1;if(this._active){var o=t.canvasContext.canvas.getContext("2d"),a={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};dn(o,t,this.configuration.mouseLocation.handles,a)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"doubleTapCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),y.cornerstone.updateImage(t.element)}},{key:"preTouchStartCallback",value:function(e){return this._initialiseSculpting(e),!0}},{key:"preMouseDownCallback",value:function(e){if(this.options.mouseButtonMask.includes(e.detail.buttons))return this._initialiseSculpting(e),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,r=L(n.element,this.referencedToolName);if(r){var o=r.data[t.currentTool].handles.points;this._getMouseLocation(n),this._sculpt(n,o),y.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){this._activeEnd(e)}},{key:"activeTouchEndCallback",value:function(e){this._activeEnd(e),this._deselectAllTools(e),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(e){var t=e.detail,n=t.element,r=this.configuration;this._active=!1,vt.isMultiPartToolActive=!1,this._getMouseLocation(t),this._invalidateToolData(t),r.mouseUpRender=!0,this._deactivateSculpt(n),y.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,r=n.element,o=n.canvasContext.canvas.getContext("2d"),a=L(r,this.referencedToolName).data[this.configuration.currentTool];this._recentTouchEnd=!1,this.configuration.mouseUpRender?(t=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):t=vt.mousePositionImage;var i=Tt(r,this.referencedToolName).distanceFromPointCanvas(r,a,t);if(this.configuration.mouseLocation.handles.start.x=t.x,this.configuration.mouseLocation.handles.start.y=t.y,this.configuration.limitRadiusOutsideRegion){var s=i;i=this._limitCursorRadiusCanvas(n,i),s>this.configuration.hoverCursorFadeDistance*i&&(o.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var l={fill:null,color:this.configuration.hoverColor,handleRadius:i};dn(o,n,this.configuration.mouseLocation.handles,l),this.configuration.limitRadiusOutsideRegion&&(o.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,r=this._getClosestFreehandToolOnElement(n,e);void 0!==r&&(t.currentTool=r,Ct(n))}},{key:"_activateFreehandTool",value:function(e,t){var n=L(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var r=0;r<n.length;r++)n[r].active=r===t}},{key:"_initialiseSculpting",value:function(e){var t=e.detail,n=this.configuration,r=t.element;null===n.currentTool&&(this._selectFreehandTool(t),null===n.currentTool)||(this._active=!0,vt.isMultiPartToolActive=!0,this._configureToolSize(t),this._getMouseLocation(t),this._activateFreehandTool(r,n.currentTool),this._activateSculpt(r),y.cornerstone.updateImage(t.element))}},{key:"_sculpt",value:function(e,t){var n=this.configuration;this._sculptData={element:e.element,image:e.image,mousePoint:e.currentPoints.image,points:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:Math.max(this._toolSizeImage,2*n.minSpacing)};var r=this._pushHandles();void 0!==r.first&&(this._insertNewHandles(r),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var e=this._sculptData,t=e.points,n=e.mousePoint,r=e.toolSize,o={},a=0;a<t.length;a++){var i=y.cornerstoneMath.point.distance(t[a],n);i>r||(this._pushOneHandle(a,i),void 0===o.first?(o.first=a,o.last=a):o.last=a)}return o}},{key:"_pushOneHandle",value:function(e,t){var n=this._sculptData,r=n.points,o=n.mousePoint,a=n.toolSize,i=n.image,s=r[e],l=(s.x-o.x)/t,c=(s.y-o.y)/t,u={x:o.x+a*l,y:o.y+a*c};In(u,i),s.x=u.x,s.y=u.y;var d=this.constructor._getPreviousHandleIndex(e,r.length);r[d].lines.pop(),r[d].lines.push(s)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,r=0;r<t.length;r++){var o=t[r]+1+n;this._insertHandleRadially(o),n++}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=this._sculptData,n=t.points,r=t.maxSpacing,o=[],a=e.first;a<=e.last;a++)this._checkSpacing(a,n,o,r);var i=this.constructor._getNextHandleIndex(e.last,n.length);if(i!==e.first){this._checkSpacing(i,n,o,r);var s=this.constructor._getPreviousHandleIndex(e.first,n.length);s!==i&&this._checkSpacing(s,n,o,r)}return o}},{key:"_checkSpacing",value:function(e,t,n,r){var o=this.constructor._getNextHandleIndex(e,t.length);y.cornerstoneMath.point.distance(t[e],t[o])>r&&n.push(e)}},{key:"_insertHandleRadially",value:function(e){var t=this._sculptData.points,n=e-1,r=this.constructor._getNextHandleIndexBeforeInsert(e,t.length),o=this._getInsertPosition(e,n,r),a=new $s(o);t.splice(e,0,a),t[n].lines.pop(),t[n].lines.push(t[e]),Li.addLine(t,e)}},{key:"_consolidateHandles",value:function(){if(!(this._sculptData.points.length<=3)){var e=this._findCloseHandlePairs();this._mergeCloseHandles(e)}}},{key:"_findCloseHandlePairs",value:function(){for(var e=this._sculptData,t=e.points,n=e.minSpacing,r=[],o=t.length,a=0;a<o;a++){var i=this.constructor._getNextHandleIndex(a,t.length);if(y.cornerstoneMath.point.distance(t[a],t[i])<n){var s=[a,i];r.push(s),0===a&&(o-=1),a++}}return r}},{key:"_mergeCloseHandles",value:function(e){for(var t=0,n=0;n<e.length;n++){var r=this.constructor._getCorrectedPair(e[n],t);this._combineHandles(r),t++}var o=this._findCloseHandlePairs();o.length&&this._mergeCloseHandles(o)}},{key:"_combineHandles",value:function(e){var t=this._sculptData,n=t.points,r=t.image,o={x:(n[e[0]].x+n[e[1]].x)/2,y:(n[e[0]].y+n[e[1]].y)/2};In(o,r),n[e[0]].x=o.x,n[e[0]].y=o.y;var a=this.constructor._getNextHandleIndex(e[1],n.length);n[e[0]].lines.pop(),n[e[0]].lines.push(n[a]),n.splice(e[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,r=n.currentTool,o=e.currentPoints.image,a=L(t,this.referencedToolName).data[r],i=Tt(t,this.referencedToolName),s=i.distanceFromPoint(t,a,o),l=i.distanceFromPointCanvas(t,a,o);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,In(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.addEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.addEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(w.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(w.MOUSE_DRAG,this.activeMouseDragCallback),e.removeEventListener(w.TOUCH_END,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_TAP,this.activeTouchEndCallback),e.removeEventListener(w.TOUCH_DRAG,this.activeMouseDragCallback),y.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;L(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=L(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var r=0;r<n.data.length;r++)n.data[r].active=!1;St(this.element,this.svgCursor),y.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.element,o=e.image,a=this.configuration,i=L(r,this.referencedToolName).data[a.currentTool],s=1;if(n){var l=y.cornerstone.pixelToCanvas(r,{x:0,y:0}),c=y.cornerstone.pixelToCanvas(r,{x:o.width,y:o.height});s=(c.x-l.x)*(c.y-l.y)/(o.width*o.height)}var u=i.area*s,d=Math.pow(u/Math.PI,.5);return Math.min(t,d)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=Tt(e,this.referencedToolName),r=L(e,this.referencedToolName);if(r){for(var o=r.data,a=t.currentPoints.image,i={distance:1/0,toolIndex:null},s=0;s<o.length;s++){var l=n.distanceFromPoint(e,o[s],a);-1!==l&&l<i.distance&&(i.distance=l,i.toolIndex=s)}return i.toolIndex}}},{key:"_getInsertPosition",value:function(e,t,n){var r,o=this._sculptData,a=o.points,i=o.toolSize,s=o.mousePoint,l=o.image,c={x:(a[t].x+a[n].x)/2,y:(a[t].y+a[n].y)/2},u=y.cornerstoneMath.point.distance(s,c);if(u<i){var d={x:(c.x-s.x)/u,y:(c.y-s.y)/u};r={x:s.x+i*d.x,y:s.y+i*d.y}}else r=c;return In(r,l),r}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,y.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,y.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,y.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}}]),t}(pr);function tl(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:un.getActiveColor(),hoverColor:un.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}var nl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:Ro};return(e=u()(this,f()(t).call(this,n,r))).zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(Cr()(e)),e.enabledCallback=e._createMagnificationCanvas.bind(Cr()(e)),e.disabledCallback=e._destroyMagnificationCanvas.bind(Cr()(e)),e.postTouchStartCallback=e._addMagnifyingGlass.bind(Cr()(e)),e.touchDragCallback=e._updateMagnifyingGlass.bind(Cr()(e)),e.touchEndCallback=e._removeMagnifyingGlass.bind(Cr()(e)),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(Cr()(e)),e.postMouseDownCallback=e._addMagnifyingGlass.bind(Cr()(e)),e.mouseDragCallback=e._updateMagnifyingGlass.bind(Cr()(e)),e.mouseUpCallback=e._removeMagnifyingGlass.bind(Cr()(e)),e.mouseClickCallback=e._removeMagnifyingGlass.bind(Cr()(e)),e.newImageCallback=e._drawMagnificationTool.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame((function(){return t._drawMagnificationTool(e)})),Ct(e.detail.element),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){var t=e.detail.element;St(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var r=t.querySelector("canvas:not(.magnifyTool)"),o=Pn(n),a=y.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),i=Math.min(this.configuration.magnifySize,r.width,r.height),s=this.configuration.magnificationLevel;n.width=i,n.height=i,a.x=Math.max(a.x,.5*i/s),a.x=Math.min(a.x,r.width-.5*i/s),a.y=Math.max(a.y,.5*i/s),a.y=Math.min(a.y,r.height-.5*i/s);var l={x:a.x*s-.5*i,y:a.y*s-.5*i};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),o.drawImage(this.zoomCanvas,l.x,l.y,i,i,0,0,i,i);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(a.y-.5*i-c,0),left:Math.max(a.x-.5*i,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,r.height-d.height),u.left=Math.min(u.left,r.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=y.cornerstone.getEnabledElement(t));var r=this.configuration.magnificationLevel,o=n.canvas,a=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=o.width*r,this.zoomElement.height=o.height*r,y.cornerstone.enable(this.zoomElement,n.options));var i=y.cornerstone.getEnabledElement(this.zoomElement),s=y.cornerstone.getViewport(n.element);this.zoomCanvas=i.canvas,this.zoomCanvas.width=o.width*r,this.zoomCanvas.height=o.height*r,i.viewport=Object.assign({},s),s.scale*=r,y.cornerstone.displayImage(this.zoomElement,a),y.cornerstone.setViewport(this.zoomElement,s)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(y.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)}}]),t}(pr),rl=bt.globalConfiguration,ol=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},o=Object.assign(r,n);return(e=u()(this,f()(t).call(this,o))).initialConfiguration=o,e}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"setupRender",value:function(e){if(e){var t=y.cornerstone.metaData.get("overlayPlaneModule",e.imageId);if(t&&t.overlays&&t.overlays.length)return t}}},{key:"setupViewport",value:function(e){if(void 0===e.overlayColor&&(e.overlayColor=rl.configuration.overlayColor||"white"),!1!==e.overlayColor)return!0}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.enabledElement,r=t.image,o=t.viewport,a=t.canvasContext,i=this.setupRender(r);if(t&&n&&i&&this.setupViewport(o)){var s=r.columns,l=r.rows;i.overlays.forEach((function(e){if(!1!==e.visible){var t=document.createElement("canvas");t.width=s,t.height=l;var n=t.getContext("2d");n.fillStyle=e.fillStyle||o.overlayColor,"R"===e.type&&(n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation="xor");for(var r=0,i=0;i<e.rows;i++)for(var c=0;c<e.columns;c++)e.pixelData[r++]>0&&n.fillRect(c,i,1,1);var u=!isNaN(parseFloat(e.x))&&isFinite(e.x)?e.x:0,d=!isNaN(parseFloat(e.y))&&isFinite(e.y)?e.y:0;a.drawImage(t,u,d)}}))}}}]),t}(pr),al={getOrientationString:function(e){for(var t=en(e),n="",r=t.x<0?"R":"L",o=t.y<0?"A":"P",a=t.z<0?"F":"H",i=new y.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=1e-4,l=0;l<3;l++)if(i.x>s&&i.x>i.y&&i.x>i.z)n+=r,i.x=0;else if(i.y>s&&i.y>i.x&&i.y>i.z)n+=o,i.y=0;else if(i.z>s&&i.z>i.x&&i.z>i.y)n+=a,i.z=0;else if(i.x>s&&i.y>s&&i.x===i.y)n+=r+o,i.x=0,i.y=0;else if(i.x>s&&i.z>s&&i.x===i.z)n+=r+a,i.x=0,i.z=0;else{if(!(i.y>s&&i.z>s&&i.y===i.z))break;n+=o+a,i.y=0,i.z=0}return n},invertOrientationString:function(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},il=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){var t=y.cornerstone;t.getEnabledElement(e).image&&t.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Pn(t.canvasContext.canvas),r=t.element,o=cl(r);if(o){var a=ul(r,o),i=un.getToolColor(),s={top:xn(n,o.top,0),left:xn(n,o.left,0),right:xn(n,o.right,0),bottom:xn(n,o.bottom,0),height:xn(n,"M",0)};sl(n,o,a,s,i),this.configuration.drawAllMarkers&&ll(n,o,a,s,i)}}}]),t}(pr),sl=function(e,t,n,r,o){wn(e,t.top,n.top.x-r.top/2,n.top.y,o),wn(e,t.left,n.left.x-r.left/2,n.left.y,o)},ll=function(e,t,n,r,o){wn(e,t.right,n.right.x-r.right,n.right.y,o),wn(e,t.bottom,n.bottom.x-r.bottom/2,n.bottom.y-r.height,o)},cl=function(e){var t=y.cornerstone,n=t.getEnabledElement(e),r=t.metaData.get("imagePlaneModule",n.image.imageId);if(r&&r.rowCosines&&r.columnCosines){var o=al.getOrientationString(r.rowCosines),a=al.getOrientationString(r.columnCosines),i=al.invertOrientationString(o);return{top:al.invertOrientationString(a),bottom:a,left:i,right:o}}},ul=function(e){var t=y.cornerstone.getEnabledElement(e);return{top:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:5}),bottom:y.cornerstone.pixelToCanvas(e,{x:t.image.width/2,y:t.image.height-15}),left:y.cornerstone.pixelToCanvas(e,{x:5,y:t.image.height/2}),right:y.cornerstone.pixelToCanvas(e,{x:t.image.width-10,y:t.image.height/2})}},dl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return(e=u()(this,f()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport;if(t.numPointers===this.configuration.touchPointers){var o=this._getTranslation(t);this._applyTranslation(r,o),y.cornerstone.setViewport(n,r)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,o=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/o,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(pr),fl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:_o};return(e=u()(this,f()(t).call(this,n,r))).touchDragCallback=e._dragCallback.bind(Cr()(e)),e.mouseDragCallback=e._dragCallback.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=this._getTranslation(t);this._applyTranslation(r,o),y.cornerstone.setViewport(n,r)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,r=e.deltaPoints,o=t.scale,a=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(a*=n.rowPixelSpacing/n.columnPixelSpacing),{x:r.page.x/o,y:r.page.y/a}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(pr),hl=n(11),pl=n.n(hl),ml=n(13),gl=n.n(ml),vl=function(e,t,n,r){var o=y.cornerstone,a=o.getEnabledElement(n).image,i=o.getEnabledElement(r).image;if(a&&i){var s=o.metaData.get("imagePlaneModule",a.imageId),l=o.metaData.get("imagePlaneModule",i.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=en(s.rowCosines),s.columnCosines=en(s.columnCosines),s.imagePositionPatient=en(s.imagePositionPatient),l.rowCosines=en(l.rowCosines),l.columnCosines=en(l.columnCosines),l.imagePositionPatient=en(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!((d=Math.abs(d))<.5)){var f=function(e,t){var n=rn(e,t);if(n)return{start:tn(n.start,e),end:tn(n.end,e)}}(s,l);if(f){var h=un.getActiveColor();e.setTransform(1,0,0,1,0,0),Wt(e,(function(e){Qt(e,t.element,f.start,f.end,{color:h})}))}}}}},yl=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function bl(e){try{var t=y.cornerstone.getEnabledElement(e);return t.image?t:yl(250).then((function(){return bl(e)}))}catch(e){return null}}var xl=U("tools:ReferenceLinesTool"),wl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:vl}};return(e=u()(this,f()(t).call(this,n,r))).renderer=null,e.synchronizationContext=null,e}var n;return p()(t,e),l()(t,[{key:"enabledCallback",value:(n=gl()(pl.a.mark((function e(t){var n,r,o,a=arguments;return pl.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},r=n.synchronizationContext,o=this.configuration.renderer,e.next=4,bl(t);case 4:if(e.sent&&o&&r){e.next=8;break}return xl.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=o,this.synchronizationContext=r,this.forceImageUpdate(t);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var r=this.synchronizationContext.getSourceElements(),o=Pn(n.canvasContext.canvas);y.cornerstone.setToPixelCoordinateSystem(n.enabledElement,o),r.forEach((function(r){r!==e.currentTarget&&t.renderer(o,n,e.currentTarget,r)}))}}}]),t}(pr),Tl=function(e,t,n){var r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),a=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(r,2)+Math.pow(o,2)-Math.pow(a,2))/(2*r*o))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},Il=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Rotate",strategies:{default:Sl,horizontal:Cl,vertical:El},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:No};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(pr);function Sl(e){var t=this.configuration,n=t.roundAngles,r=t.rotateScale,o=e.detail,a=o.element,i=o.viewport,s=o.startPoints,l=o.currentPoints,c=i.initialRotation?i.initialRotation:i.rotation,u=a.getBoundingClientRect(a),d=a.clientWidth,f=a.clientHeight,h=i.scale,p=i.translation,m={x:u.left+d/2+p.x*h,y:u.top+f/2+p.y*h},g=Tl(m,s.client,l.client);g.angle*=r,n&&(g.angle=Math.ceil(g.angle)),g.direction<0&&(g.angle=-g.angle),i.rotation=c+g.angle}function Cl(e){var t=this.configuration,n=t.roundAngles,r=t.flipHorizontal,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.x,d=(l.client.x-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}function El(e){var t=this.configuration,n=t.roundAngles,r=t.flipVertical,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.y,d=(l.client.y-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}var Al=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=t.rotation;r.rotation+=o,y.cornerstone.setViewport(n,r)}}]),t}(pr),Ml=U("tools:ScaleOverlayTool"),Pl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){y.cornerstone.getEnabledElement(e).image&&y.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Pn(t.canvasContext.canvas),r=t.image,o=t.viewport,a=t.element,i=r.rowPixelSpacing,s=r.columnPixelSpacing,l=y.cornerstone.metaData.get("imagePlaneModule",r.imageId);if(l&&(i=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),i&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/i*o.scale,d=10/s*o.scale,f=Dl(c,.25,.05),h=Dl(c,.05,.15);if(c.width&&c.height&&f&&h){var p=un.getToolColor(),m=Zt.getToolWidth(),g=Object.assign({},{hscaleBounds:f,vscaleBounds:h,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:h.bottomRight.x,y:h.topLeft.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},horizontalLine:{start:{x:f.topLeft.x,y:f.bottomRight.y},end:{x:f.bottomRight.x,y:f.bottomRight.y}},color:p,lineWidth:m},this.configuration);Wt(n,(function(e){kn(e,g),Qt(e,a,g.verticalLine.start,g.verticalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),kl(e,a,g),Qt(e,a,g.horizontalLine.start,g.horizontalLine.end,{color:g.color,lineWidth:g.lineWidth},"canvas"),Ll(e,a,g)}))}}else Ml.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(pr),Dl=function(e,t,n){var r=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),a={left:r,top:o,width:e.width-2*r,height:e.height-2*o};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},kl=function(e,t,n){for(var r=0;n.verticalLine.start.y+r*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var o=n.color,a=n.lineWidth,i={x:n.verticalLine.start.x,y:n.verticalLine.start.y+r*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+r*n.verticalMinorTick};s.x=r%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Qt(e,t,i,s,{color:o,lineWidth:a},"canvas"),r++}},Ll=function(e,t,n){for(var r=0;n.horizontalLine.start.x+r*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var o=n.color,a=n.lineWidth,i={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:0};s.y=r%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Qt(e,t,i,s,{color:o,lineWidth:a},"canvas"),r++}},Ol=function(e,t){var n=L(e,"stack");if(n&&n.data&&n.data.length){var r,o=y.cornerstone;if(n.data.length>1){var a=L(e,"stackRenderer");a&&a.data&&a.data.length&&(r=a.data[0])}var i=n.data[0];t<0&&(t+=i.imageIds.length);var s=zs.getStartLoadHandler(e),l=zs.getEndLoadHandler(e),c=zs.getErrorLoadingHandler(e);if(t!==i.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-i.currentImageIdIndex};i.currentImageIdIndex=t;var d=i.imageIds[t];(Boolean(i.preventCache)?o.loadImage(d):o.loadAndCacheImage(d)).then((function(a){if(i.currentImageIdIndex===t){try{o.getEnabledElement(e)}catch(e){return}r?(r.currentImageIdIndex=t,r.render(e,n.data)):o.displayImage(e,a),l&&l(e,a)}}),(function(n){var r=i.imageIds[t];c&&c(e,r,n)})),T(e,w.STACK_SCROLL,u)}}},Rl=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=L(e,"stack");if(o&&o.data&&o.data.length){var a=o.data[0];a.pending||(a.pending=[]);var i=a.currentImageIdIndex+t;if(n?i%=a.imageIds.length:i=En(i,0,a.imageIds.length-1),r)Ol(e,i);else{var s={index:i};a.pending.push(s),_l(a,s,e)}}};function _l(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index)return e.pending.splice(e.pending.indexOf(t),1),void(e.pending.length>0&&_l(e,e.pending[0],n));n.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,(function r(o){e.imageIds.indexOf(o.detail.image.imageId)===t.index&&(e.pending.splice(e.pending.indexOf(t),1),n.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,r),e.pending.length>0&&_l(e,e.pending[0],n))})),Ol(n,t.index)}}var Nl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,r=t.element,o=this.configuration,a=o.loop,i=o.allowSkipping,s=o.invert;Rl(r,s?-n:n,a,i)}}]),t}(pr),Bl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return(e=u()(this,f()(t).call(this,n,r))).multiTouchDragCallback=e._dragCallback.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,r=t.deltaPoints,o=this.configuration,a=o.loop,i=o.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,r.page.y);if(!l)return;if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,a,i),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=L(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(pr),Ul=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:Bo};return(e=u()(this,f()(t).call(this,n,r))).mouseDragCallback=e._dragCallback.bind(Cr()(e)),e.touchDragCallback=e._dragCallback.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.deltaPoints,o=this.configuration,a=o.loop,i=o.allowSkipping,s=Ws(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,r.page.y);if(l){if(Math.abs(c)>=l){var u=Math.round(c/l);Rl(n,u,a,i),s.deltaY=c%l}else s.deltaY=c;Gs(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Ws(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=L(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(pr),Vl=function(e,t,n,r,o){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var a,i,s,l=y.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(i=0;i<o;i++)for(s=0;s<r;s++){var f=d[a=4*((i+n)*l.columns+(s+t))],h=d[a+1],p=d[a+2];c[u++]=.2126*f+.7152*h+.0722*p}else for(i=0;i<o;i++)for(s=0;s<r;s++)a=(i+n)*l.columns+(s+t),c[u++]=d[a]*l.slope+l.intercept;return c},Fl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:Uo};return(e=u()(this,f()(t).call(this,n,r)))._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(Cr()(e)),e.touchDragCallback=e._setHandlesAndUpdate.bind(Cr()(e)),e.touchEndCallback=e._applyStrategy.bind(Cr()(e)),e.postMouseDownCallback=e._startOutliningRegion.bind(Cr()(e)),e.mouseClickCallback=e._startOutliningRegion.bind(Cr()(e)),e.mouseDragCallback=e._setHandlesAndUpdate.bind(Cr()(e)),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(Cr()(e)),e.mouseUpCallback=e._applyStrategy.bind(Cr()(e)),e}return p()(t,e),l()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,r=n.element,o=un.getColorIfActive({active:!0}),a=Pn(n.canvasContext.canvas);Wt(a,(function(e){Mn(e,r,t.handles.start,t.handles.end,{color:o})}))}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return jl(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),y.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,y.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){jl(this.handles.start)||jl(this.handles.end)||(e.detail.handles=this.handles,Hl(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(pr),jl=function(e){return 0===Object.keys(e).length&&e.constructor===Object},Hl=function(e,t){var n=e.detail,r=n.image,o=n.element,a=e.detail.handles,i=a.start,s=a.end,l=Math.min(i.x,s.x),c=Math.min(i.y,s.y),u=Math.abs(i.x-s.x),d=Math.abs(i.y-s.y);l=En(l,0,r.width),c=En(c,0,r.height),u=Math.floor(Math.min(u,Math.abs(r.width-l))),d=Math.floor(Math.min(d,Math.abs(r.height-c)));var f=Vl(o,l,c,u,d),h=zl(f,r.minPixelValue,r.maxPixelValue),p=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),p.voi.windowWidth=Math.max(Math.abs(h.max-h.min),t.minWindowWidth),p.voi.windowCenter=h.mean,p.voiLUT=void 0,y.cornerstone.setViewport(o,p),y.cornerstone.updateImage(o)},zl=function(e,t,n){var r=e.length,o=n,a=t,i=0;if(r<2)return{min:o,max:a,mean:(t+n)/2};for(var s=0;s<r;s++){var l=e[s];o=Math.min(o,l),a=Math.max(a,l),i+=l}return{min:o,max:a,mean:i/r}},ql=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Wwwc",strategies:{basicLevelingStrategy:Wl},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:Vo};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(pr);function Wl(e){var t=this.configuration.orientation,n=e.detail,r=(n.image.maxPixelValue*n.image.slope+n.image.intercept-(n.image.minPixelValue*n.image.slope+n.image.intercept))/1024,o=n.deltaPoints.page.x*r,a=n.deltaPoints.page.y*r;0===t?(n.viewport.voi.windowWidth+=o,n.viewport.voi.windowCenter+=a):(n.viewport.voi.windowWidth+=a,n.viewport.voi.windowCenter+=o),n.viewport.voiLUT=void 0}var Gl=function(e,t,n){var r=n.maxScale,o=n.minScale,a=Math.log(e.scale)/Math.log(1.7)+t,i=Math.pow(1.7,a);return e.scale=r&&i>r?r:o&&i<o?o:i,e},Yl={changeViewportScale:Gl,correctShift:function(e,t){var n=t.hflip,r=t.vflip,o=t.rotation;if(e.x*=n?-1:1,e.y*=r?-1:1,0!==o){var a=o*Math.PI/180,i=Math.cos(a),s=Math.sin(a),l=e.x*i-e.y*s,c=e.x*s+e.y*i;e.x=l,e.y=c}return e}},Zl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=t.spinY,a=this.configuration,i=a.invert,s=a.maxScale,l=a.minScale,c=Gl(r,i?o/4:-o/4,{maxScale:s,minScale:l});y.cornerstone.setViewport(n,c)}}]),t}(pr),Xl=Yl.correctShift,Ql=Yl.changeViewportScale,Kl=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"Zoom",strategies:{default:$l,translate:ec,zoomToCenter:tc},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:Fo};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchDragCallback",value:function(e){Jl.call(this,e)}},{key:"mouseDragCallback",value:function(e){Jl.call(this,e)}}]),t}(pr),Jl=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),y.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function $l(e){var t=this.configuration,n=t.invert,r=t.maxScale,o=t.minScale,a=e.detail.deltaPoints.page.y,i=n?-a/100:a/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],f=u[1],h=u[2],p=u[3],m=Ql(c,i,{maxScale:r,minScale:o});y.cornerstone.setViewport(l,m);var g=y.cornerstone.pageToPixel(l,d,f),v={x:h-g.x,y:p-g.y};v=Xl(v,m),c.translation.x-=v.x,c.translation.y-=v.y}function ec(e){var t=this.configuration,n=t.invert,r=t.preventZoomOutsideImage,o=t.maxScale,a=t.minScale,i=e.detail.deltaPoints.page.y,s=n?-i/100:i/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],f=u[1],h=Ql(c,s,{maxScale:o,minScale:a}),p={x:0,y:0};if(s<0)h.scale<3&&(Math.abs(h.translation.x)<.01?h.translation.x=0:p.x=h.translation.x/8,Math.abs(h.translation.y)<.01?h.translation.y=0:p.y=h.translation.y/8);else{r&&In(e.detail.startPoints.image,l);var m={x:l.width/2-d,y:l.height/2-f};m=Xl(m,h);var g={x:h.translation.x-m.x,y:h.translation.y-m.y};Math.abs(g.x)<.01?h.translation.x=m.x:p.x=g.x/8,Math.abs(g.y)<.01?h.translation.y=m.y:p.y=g.y/8}h.translation.x-=p.x,h.translation.y-=p.y}function tc(e){var t=this.configuration,n=t.invert,r=t.maxScale,o=t.minScale,a=e.detail.deltaPoints.page.y,i=n?-a/100:a/100,s=e.detail.viewport;Ql(s,i,{maxScale:r,minScale:o})}var nc=Yl.correctShift,rc=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var n={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return u()(this,f()(t).call(this,e,n))}return p()(t,e),l()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,r=t.viewport,o=t.scaleChange,a=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],i=a[0],s=a[1],l=a[2],c=a[3],u=this.configuration,d=u.maxScale,f=u.minScale;r.scale+=o*r.scale,d&&r.scale>d?r.scale=d:f&&r.scale<f&&(r.scale=f),y.cornerstone.setViewport(n,r);var h=y.cornerstone.pageToPixel(n,i,s),p={x:l-h.x,y:c-h.y};p=nc(p,r),r.translation.x-=p.x,r.translation.y-=p.y,y.cornerstone.setViewport(n,r)}}]),t}(pr),oc=function(e){return{page:ac(e.page),image:ac(e.image),client:ac(e.client),canvas:ac(e.canvas)}};function ac(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{x:e.x,y:e.y}}var ic,sc=U("eventListeners:mouseEventListeners"),lc=!0,cc=new Map;function uc(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function dc(){lc=!1}function fc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var r=w.MOUSE_DOUBLE_CLICK,o={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=y.cornerstone.pixelToCanvas(t,o.image);var a=oc(o);sc.log("double-click: %o",uc(e)),T(t,r,{event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:a,currentPoints:o,deltaPoints:{x:0,y:0},type:r})}}function hc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){ic=setTimeout(dc,200),t.removeEventListener("mousemove",pc);var r={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=y.cornerstone.pixelToCanvas(t,r.image);var o=oc(r),a={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:r,deltaPoints:{x:0,y:0},type:w.MOUSE_DOWN};T(a.element,w.MOUSE_DOWN,a)&&(a.type=w.MOUSE_DOWN_ACTIVATE,T(a.element,w.MOUSE_DOWN_ACTIVATE,a)),document.addEventListener("mousemove",i),document.addEventListener("mouseup",s),cc.set(i,"mousemove"),cc.set(s,"mouseup")}function i(e){var a=w.MOUSE_DRAG,i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,o.page),image:y.cornerstoneMath.point.subtract(i.image,o.image),client:y.cornerstoneMath.point.subtract(i.client,o.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,o.canvas)};sc.log("mousemove: %o",uc(e));var l={buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:i,deltaPoints:s,type:a,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};T(l.element,a,l),o=oc(i)}function s(e){clearTimeout(ic);var a=w.MOUSE_UP;lc&&(a=w.MOUSE_CLICK);var l={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=y.cornerstone.pixelToCanvas(t,l.image);var c={page:y.cornerstoneMath.point.subtract(l.page,o.page),image:y.cornerstoneMath.point.subtract(l.image,o.image),client:y.cornerstoneMath.point.subtract(l.client,o.client),canvas:y.cornerstoneMath.point.subtract(l.canvas,o.canvas)};sc.log("mouseup: %o",uc(e));var u={event:e,buttons:uc(e),viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:r,lastPoints:o,currentPoints:l,deltaPoints:c,type:a};T(u.element,a,u),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s),cc.delete(i),cc.delete(s),t.addEventListener("mousemove",pc),lc=!0}}function pc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var r=w.MOUSE_MOVE,o={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=y.cornerstone.pixelToCanvas(t,o.image);var a=oc(o),i={page:y.cornerstoneMath.point.pageToPoint(e),image:y.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=y.cornerstone.pixelToCanvas(t,i.image);var s={page:y.cornerstoneMath.point.subtract(i.page,a.page),image:y.cornerstoneMath.point.subtract(i.image,a.image),client:y.cornerstoneMath.point.subtract(i.client,a.client),canvas:y.cornerstoneMath.point.subtract(i.canvas,a.canvas)};T(t,r,{viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:a,currentPoints:i,deltaPoints:s,type:r}),a=oc(i)}}function mc(e){e.removeEventListener("mousedown",hc),e.removeEventListener("mousemove",pc),e.removeEventListener("dblclick",fc),cc.forEach((function(e,t){document.removeEventListener(e,t)})),cc.clear()}var gc={enable:function(e){mc(e),e.addEventListener("mousedown",hc),e.addEventListener("mousemove",pc),e.addEventListener("dblclick",fc)},disable:mc};function vc(e){var t=e.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image&&!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var r=e.pageX,o=e.pageY,a=y.cornerstone.pageToPixel(t,r,o),i=function(e){var t=0,n=0,r=0,o=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),r=10*t,o=10*n,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||o)&&e.deltaMode&&(1===e.deltaMode?(r*=40,o*=40):(r*=800,o*=800)),r&&!t&&(t=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:o}}(e),s=i.spinX,l=i.spinY,c=i.pixelX,u=i.pixelY,d=l<0?-1:1,f={element:t,viewport:y.cornerstone.getViewport(t),detail:e,image:n.image,direction:d,spinX:s,spinY:l,pixelX:c,pixelY:u,pageX:r,pageY:o,imageX:a.x,imageY:a.y};T(t,w.MOUSE_WHEEL,f)}}function yc(e){e.removeEventListener("wheel",vc,{passive:!1})}var bc,xc,wc={enable:function(e){yc(e),e.addEventListener("wheel",vc,{passive:!1})},disable:yc},Tc=0,Ic=1;function Sc(e,t){var n=Date.now();if(e!==bc){if(n-xc<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;bc=e}xc=n}var Cc=Sc.bind(null,Tc),Ec=Sc.bind(null,Ic);function Ac(e,t,n){var r=n?Cc:Ec;t.forEach((function(t){e.addEventListener(t,r,{passive:!1})}))}function Mc(e,t,n){var r=n?Cc:Ec;t.forEach((function(t){e.removeEventListener(t,r)}))}var Pc=["mousedown","mouseup"],Dc=["touchstart","touchend"];function kc(e){Mc(e,Pc,Tc),Mc(e,Dc,Ic)}var Lc,Oc,Rc,_c,Nc,Bc,Uc,Vc,Fc,jc={enable:function(e){kc(e),Ac(e,Pc,Tc),Ac(e,Dc,Ic)},disable:kc},Hc=1,zc=0,qc=!1,Wc=!1;function Gc(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=y.cornerstone.getEnabledElement(t);if(n.image){var r,o,a,i;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(Wc=!1,clearTimeout(Uc)),e.type){case"tap":Wc=!1,clearTimeout(Uc),(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),r=w.TAP,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Oc,type:r,isTouchEvent:!0},T(t,r,Nc);break;case"doubletap":Wc=!1,clearTimeout(Uc),(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),r=w.DOUBLE_TAP,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Oc,type:r,isTouchEvent:!0},T(t,r,Nc);break;case"pinchstart":Wc=!1,clearTimeout(Uc),Hc=1;break;case"pinchmove":if(Wc=!1,clearTimeout(Uc),!0===qc){Hc=e.scale,qc=!1;break}o=(e.scale-Hc)/Hc,(Lc={page:e.center,image:y.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),r=w.TOUCH_PINCH,Nc={event:e,startPoints:Lc,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:o,type:r,isTouchEvent:!0},T(t,r,Nc),Hc=e.scale;break;case"touchstart":Hc=1,clearTimeout(Uc),clearTimeout(Bc),Bc=setTimeout((function(){(Lc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),r=w.TOUCH_START,e.touches.length>1&&(r=w.MULTI_TOUCH_START),Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Lc,currentPoints:Lc,type:r,isTouchEvent:!0},!0===T(t,r,Nc)&&(r=w.TOUCH_START_ACTIVE,e.touches.length>1&&(r=w.MULTI_TOUCH_START_ACTIVE),Nc.type=r,T(t,r,Nc)),Rc=oc(Lc)}),50),Wc=!0,Vc=0,Uc=setTimeout((function(){Wc&&((Oc={page:y.cornerstoneMath.point.pageToPoint(e.touches[0]),image:y.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),r=w.TOUCH_PRESS,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Oc,type:r,isTouchEvent:!0},T(t,r,Nc))}),700);break;case"touchend":Hc=1,Wc=!1,clearTimeout(Uc),setTimeout((function(){(Lc={page:y.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:y.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Lc.image),r=w.TOUCH_END,Nc={event:e,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Lc,currentPoints:Lc,type:r,isTouchEvent:!0},T(t,r,Nc)}),50);break;case"panmove":a={x:e.deltaX-Fc.x,y:e.deltaY-Fc.y},Fc={x:e.deltaX,y:e.deltaY},(Oc={page:{x:Rc.page.x+a.x,y:Rc.page.y+a.y},image:y.cornerstone.pageToPixel(t,Rc.page.x+a.x,Rc.page.y+a.y),client:{x:Rc.client.x+a.x,y:Rc.client.y+a.y}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),_c={page:y.cornerstoneMath.point.subtract(Oc.page,Rc.page),image:y.cornerstoneMath.point.subtract(Oc.image,Rc.image),client:y.cornerstoneMath.point.subtract(Oc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(Oc.canvas,Rc.canvas)},(Vc+=Math.sqrt(_c.page.x*_c.page.x+_c.page.y*_c.page.y))>5&&(Wc=!1,clearTimeout(Uc)),r=w.TOUCH_DRAG,e.pointers.length>1&&(r=w.MULTI_TOUCH_DRAG),Nc={viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Lc,lastPoints:Rc,currentPoints:Oc,deltaPoints:_c,numPointers:e.pointers.length,type:r,isTouchEvent:!0},T(t,r,Nc),Rc=oc(Oc);break;case"panstart":Fc={x:e.deltaX,y:e.deltaY},(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),Rc=oc(Oc);break;case"panend":if(Wc=!1,clearTimeout(Uc),!Rc)return!1;(Oc={page:y.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:y.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=y.cornerstone.pixelToCanvas(t,Oc.image),_c={page:y.cornerstoneMath.point.subtract(Oc.page,Rc.page),image:y.cornerstoneMath.point.subtract(Oc.image,Rc.image),client:y.cornerstoneMath.point.subtract(Oc.client,Rc.client),canvas:y.cornerstoneMath.point.subtract(Oc.canvas,Rc.canvas)},r=w.TOUCH_DRAG_END,Nc={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Lc,lastPoints:Rc,currentPoints:Oc,deltaPoints:_c,type:r,isTouchEvent:!0},T(t,r,Nc),2==e.pointers.length-e.changedPointers.length&&(qc=!0);break;case"rotatemove":Wc=!1,clearTimeout(Uc),i=e.rotation-zc,zc=e.rotation,r=w.TOUCH_ROTATE,Nc={event:e.srcEvent,viewport:y.cornerstone.getViewport(t),image:n.image,element:t,rotation:i,type:r},T(t,r,Nc)}return!1}}function Yc(e){jc.disable(e),["touchstart","touchend"].forEach((function(t){e.removeEventListener(t,Gc)}));var t=Ws("touchInput",e),n=t.hammer;n&&(n.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),n.input.destroy()),t.hammer=null,function(e,t){var n=qs[e];n&&(qs[e]=n.filter((function(e){return e.element!==t})))}("touchInput",e)}var Zc={enable:function(e){Yc(e);var t=y.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},r=new t.Manager(e,n),o={pointers:0,direction:t.DIRECTION_ALL,threshold:0},a=new t.Pan(o),i=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});i.recognizeWith(a),i.recognizeWith(s),s.recognizeWith(a);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(a),r.add([l,a,s,i]),r.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Gc),jc.enable(e),["touchstart","touchend"].forEach((function(t){e.addEventListener(t,Gc,{passive:!1})}));var c=Ws("touchInput",e);c.hammer=r,Gs("touchInput",e,c)},disable:Yc},Xc=xt("segmentation");function Qc(e,t,n,r,o){!function(e,t,n){var r=Xc.configuration,o=e.detail,a=Pn(o.canvasContext.canvas),i=y.cornerstone.pixelToCanvas(o.element,{x:0,y:0}),s=y.cornerstone.pixelToCanvas(o.element,{x:o.image.width,y:0}),l=y.cornerstone.pixelToCanvas(o.element,{x:o.image.width,y:o.image.height}),c=y.cornerstoneMath.point.distance(i,s),u=y.cornerstoneMath.point.distance(s,l),d=o.canvasContext.canvas,f=o.viewport,h=a.imageSmoothingEnabled,p=a.globalAlpha;a.imageSmoothingEnabled=!1,a.globalAlpha=n?r.fillAlpha:r.fillAlphaInactive,function(e,t,n){if(n.hflip||n.vflip||n.rotation){var r={x:t.width/2+n.translation.x*n.scale,y:t.height/2+n.translation.y*n.scale};e.translate(r.x,r.y),n.rotation&&e.rotate(n.rotation*Math.PI/180),n.vflip&&e.scale(1,-1),n.hflip&&e.scale(-1,1),e.translate(-r.x,-r.y)}}(a,d,f);var m=function(e){var t=e.viewport,n=e.image,r=t.scale,o=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?r*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(o*=n.rowPixelSpacing/n.columnPixelSpacing),{x:t.translation.x*r,y:t.translation.y*o}}(o);a.drawImage(t,d.width/2-c/2+m.x,d.height/2-u/2+m.y,c,u),a.globalAlpha=p,a.imageSmoothingEnabled=h,function(e){e.setTransform(1,0,0,1,0,0)}(a)}(e,function(e,t,n){var r=Xc.state,o=e.detail.image,a=o.width,i=o.height,s=t.segmentsHidden,l=n.pixelData,c=r.colorLutTables[t.colorLUTIndex],u=document.createElement("canvas");u.width=a,u.height=i;for(var d=Pn(u),f=new ImageData(a,i),h=f.data,p=0;p<l.length;p++){var m=l[p];if(0!==m&&!s[m]){var g=c[l[p]];h[4*p]=g[0],h[4*p+1]=g[1],h[4*p+2]=g[2],h[4*p+3]=g[3]}}return d.putImageData(f,0,0),u}(e,t,n),o)}var Kc=xt("segmentation");function Jc(e,t,n,r,o){!function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Kc.configuration,a=Kc.state,i=e.detail,s=i.element,l=i.canvasContext,c=o.outlineWidth||1,u=Pn(l.canvas),d=a.colorLutTables[n],f=u.globalAlpha;u.globalAlpha=r?o.outlineAlpha:o.outlineAlphaInactive,Wt(u,(function(e){for(var n=1;n<t.length;n++)if(t[n]){var r=d[n];fn(e,s,t[n],{color:"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", 1.0 )"),lineWidth:c},"canvas")}})),u.globalAlpha=f}(e,function(e,t,n,r){var o=e.detail,a=o.element,i=o.image,s=o.viewport,l=i.width,c=i.height;r=r||1;var u,d=t.segmentsHidden,f=n.pixelData,h=t.activeSegmentIndex,p=[];n.segmentsOnLabelmap.forEach((function(e){!d[e]&&(p[e]=[])})),p[h]||(p[h]=[]);for(var m=function(e,t){var n=t/2,r=e.rotation;r*=Math.PI/180;var o=Math.cos(r),a=Math.sin(r),i=[o,a],s=[-a,o],l={x:n*i[0],y:n*i[1]},c={x:n*s[0],y:n*s[1]};return e.hflip&&(l.x*=-1,l.y*=-1),e.vflip&&(c.x*=-1,c.y*=-1),{i:l,j:c}}(s,r),g=0;g<f.length;g++){var v=f[g];if(0!==v&&!d[v]){var y={x:(u=g)%l,y:Math.floor(u/l)},b=$c(y,c,l);void 0!==b.top&&f[b.top]===v||ou(p[v],a,y,m),void 0!==b.bottom&&f[b.bottom]===v||au(p[v],a,y,m),void 0!==b.left&&f[b.left]===v||iu(p[v],a,y,m),void 0!==b.right&&f[b.right]===v||su(p[v],a,y,m),void 0!==b.topLeft&&f[b.topLeft]!==v&&f[b.top]===v&&f[b.left]===v&&eu(p[v],a,y,m),void 0!==b.topRight&&f[b.topRight]!==v&&f[b.top]===v&&f[b.right]===v&&tu(p[v],a,y,m),void 0!==b.bottomLeft&&f[b.bottomLeft]!==v&&f[b.bottom]===v&&f[b.left]===v&&nu(p[v],a,y,m),void 0!==b.bottomRight&&f[b.bottomRight]!==v&&f[b.bottom]===v&&f[b.right]===v&&ru(p[v],a,y,m)}}return p}(e,t,n,Kc.configuration.outlineWidth),t.colorLUTIndex,o)}function $c(e,t,n){var r=e.y*n+e.x,o={},a=e.y-1>=0,i=e.y+1<t,s=e.x-1>=0,l=e.x+1<n;return a&&(o.top=r-n,l&&(o.topRight=o.top+1),s&&(o.topLeft=o.top-1)),i&&(o.bottom=r+n,l&&(o.bottomRight=o.bottom+1),s&&(o.bottomLeft=o.bottom-1)),s&&(o.left=r-1),l&&(o.right=r+1),o}function eu(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,n);o.x+=r.j.x,o.y+=r.j.y;var a={x:o.x,y:o.y};a.x+=2*r.i.x,a.y+=2*r.i.y,e.push({start:o,end:a})}function tu(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y});o.x+=r.j.x,o.y+=r.j.y;var a={x:o.x,y:o.y};a.x-=2*r.i.x,a.y-=2*r.i.y,e.push({start:o,end:a})}function nu(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x,y:n.y+1});o.x-=r.j.x,o.y-=r.j.y;var a={x:o.x,y:o.y};a.x+=2*r.i.x,a.y+=2*r.i.y,e.push({start:o,end:a})}function ru(e,t,n,r){var o=(0,y.cornerstone.pixelToCanvas)(t,{x:n.x+1,y:n.y+1});o.x-=r.j.x,o.y-=r.j.y;var a={x:o.x,y:o.y};a.x-=2*r.i.x,a.y-=2*r.i.y,e.push({start:o,end:a})}function ou(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,n),i=o(t,{x:n.x+1,y:n.y});a.x+=r.j.x,a.y+=r.j.y,i.x+=r.j.x,i.y+=r.j.y,e.push({start:a,end:i})}function au(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,{x:n.x,y:n.y+1}),i=o(t,{x:n.x+1,y:n.y+1});a.x-=r.j.x,a.y-=r.j.y,i.x-=r.j.x,i.y-=r.j.y,e.push({start:a,end:i})}function iu(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,n),i=o(t,{x:n.x,y:n.y+1});a.x+=r.i.x,a.y+=r.i.y,i.x+=r.i.x,i.y+=r.i.y,e.push({start:a,end:i})}function su(e,t,n,r){var o=y.cornerstone.pixelToCanvas,a=o(t,{x:n.x+1,y:n.y}),i=o(t,{x:n.x+1,y:n.y+1});a.x-=r.i.x,a.y-=r.i.y,i.x-=r.i.x,i.y-=r.i.y,e.push({start:a,end:i})}var lu=xt("segmentation");function cu(e,t,n,r,o){(function(e){var t=lu.configuration;return t.renderFill&&(e&&0!==t.fillAlpha||!e&&0!==t.fillAlphaInactive)})(o)&&Qc(e,t,r,0,o),function(e){var t=lu.configuration;return t.renderOutline&&(e&&0!==t.outlineAlpha||!e&&0!==t.outlineAlphaInactive)}(o)&&Jc(e,t,r,0,o)}var uu=xt("segmentation"),du=function(e){var t=e.detail.element,n=uu.configuration,r=uu.getters.labelmaps3D(t),o=r.activeLabelmapIndex,a=r.labelmaps3D,i=r.currentImageIdIndex;a&&(n.shouldRenderInactiveLabelmaps&&function(e,t,n,r){for(var o=0;o<t.length;o++){var a=t[o];if(o!==n&&a){var i=a.labelmaps2D[r];i&&cu(e,a,0,i,!1)}}}(e,a,o,i),function(e,t,n,r){var o=t[n];if(o){var a=o.labelmaps2D[r];a&&cu(e,o,0,a,!0)}}(e,a,o,i))},fu=xt("segmentation"),hu=function(e){var t=e.detail,n=t.element,r=vt.tools.filter((function(e){return e.element===n&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)})),o=L(n,"stack"),a=fu.configuration;o&&(a.renderFill||a.renderOutline)&&du(e);var i=t.canvasContext.canvas.getContext("2d");r.forEach((function(t){t.renderToolData&&(i.save(),t.renderToolData(e),i.restore())}))},pu=function(e){e.addEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,hu)},mu=function(e){e.removeEventListener(y.cornerstone.EVENTS.IMAGE_RENDERED,hu)},gu=function(e,t,n){if(vt.isToolLocked)return!1;var r=n.detail.element,o=vt.tools.filter((function(t){return t.supportedInteractionTypes.includes(e)}));if(o=(o=Ir(r,o,e)).filter((function(e){return"function"==typeof e[t]})),vt.isMultiPartToolActive&&(o=Pr(o)),0===o.length)return!1;o[0][t](n)},vu=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";return t.filter((function(t){for(var o=so(r,t.name),a=L(e,t.name),i=0;i<a.data.length;i++)if(void 0!==vr(e,a.data[i].handles,n,o))return!0;return!1}))},yu=function(e,t){return t.filter((function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)}))},bu=function(e,t){return t.filter((function(t){var n=L(e,t.name);return n&&n.data.length>0}))},xu=function(e){if(!vt.isToolLocked){var t=e.detail,n=e.detail.element,r=e.detail.currentPoints.canvas,o=yu(n,yt.mouseTools()),a=o.filter((function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive}));if(vt.isMultiPartToolActive&&(a=Pr(a)),a.length>0){var i=a.find((function(e){return"function"==typeof e.preMouseDownCallback}));if(i&&i.preMouseDownCallback(e))return}if(!vt.isMultiPartToolActive){var s=bu(n,o),l=vu(n,s,r,"mouse");if(l.length>0){var c=l[0],u=L(n,c.name),d=fo(n,u,c.name,r),f=d.handle,h=d.data;c.handleSelectedCallback(e,h,f,"mouse")}else{var p=o.filter((function(e){var t=L(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,r,"mouse")}))}));if(p.length>0){var m=p[0],g=L(n,m.name).data.find((function(e){return m.pointNearTool(n,e,r)}));m.toolSelectedCallback(e,g,"mouse")}else if(a.length>0){var v=a.find((function(e){return"function"==typeof e.postMouseDownCallback}));if(v&&v.postMouseDownCallback(e))return}}}}},wu=U("eventDispatchers:mouseEventHandlers"),Tu=function(e){if(!vt.isToolLocked){var t=e.detail,n=Dr(t.element,t.buttons,"mouse");if(n){if("function"==typeof n.preMouseDownActivateCallback&&n.preMouseDownActivateCallback(e))return;vt.isMultiPartToolActive||(n.addNewMeasurement?n.addNewMeasurement(e,"mouse"):n instanceof mo&&function(e,t){wu.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,r=n.element,o=t.createNewMeasurement(n);if(o){k(r,t.name,o),y.cornerstone.updateImage(r);var a=1===Object.keys(o.handles).length?Wr:to,i=(new Date).getTime();a(n,t.name,o,o.handles.end,t.options,"mouse",(function(e){if(!o.cancelled){var n=!(!t.configuration||!Object(t.configuration).hasOwnProperty("measurementCreationThreshold"))&&(new Date).getTime()-i<t.configuration.measurementCreationThreshold;if(e&&!1===n){var a=w.MEASUREMENT_COMPLETED,s={toolName:t.name,toolType:t.name,element:r,measurementData:o};T(r,a,s)}else O(r,t.name,o)}}))}}(e,n))}}},Iu=function(e){if(!vt.isToolLocked){var t,n=e.detail,r=n.element;t=(t=(t=Ir(r,yt.mouseTools())).filter((function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive}))).filter((function(e){return"function"==typeof e.mouseDragCallback})),vt.isMultiPartToolActive&&(t=Pr(t)),0!==t.length&&t[0].mouseDragCallback(e)}},Su=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t,n=e.detail,r=n.element,o=n.currentPoints;vt.mousePositionImage=o.image;var a=(t=yu(r,yt.mouseTools())).filter((function(e){return"active"===e.mode&&e.options.isMouseActive})),i=!1;a.length>0&&(i=a.some((function(e){return e.updateOnMouseMove}))),t=bu(r,t);for(var s=0;s<t.length;s++){var l=t[s];"function"==typeof l.mouseMoveCallback&&(i=l.mouseMoveCallback(e)||i)}!0===i&&y.cornerstone.updateImage(r)}},Cu=gu.bind(null,"Mouse","mouseClickCallback"),Eu=gu.bind(null,"Mouse","doubleClickCallback"),Au=gu.bind(null,"Mouse","mouseUpCallback"),Mu=gu.bind(null,"MouseWheel","mouseWheelCallback"),Pu=function(e){e.addEventListener(w.MOUSE_CLICK,Cu),e.addEventListener(w.MOUSE_DOWN,xu),e.addEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.addEventListener(w.MOUSE_DOUBLE_CLICK,Eu),e.addEventListener(w.MOUSE_DRAG,Iu),e.addEventListener(w.MOUSE_MOVE,Su),e.addEventListener(w.MOUSE_UP,Au),e.addEventListener(w.MOUSE_WHEEL,Mu)},Du=function(e){e.removeEventListener(w.MOUSE_CLICK,Cu),e.removeEventListener(w.MOUSE_DOWN,xu),e.removeEventListener(w.MOUSE_DOWN_ACTIVATE,Tu),e.removeEventListener(w.MOUSE_DOUBLE_CLICK,Eu),e.removeEventListener(w.MOUSE_DRAG,Iu),e.removeEventListener(w.MOUSE_MOVE,Su),e.removeEventListener(w.MOUSE_UP,Au),e.removeEventListener(w.MOUSE_WHEEL,Mu)},ku=function(e){if(vt.isToolLocked)return!1;var t=e.detail.element,n=vt.tools.filter((function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)}));if(0===n.length)return!1;n.forEach((function(t){t.newImageCallback&&t.newImageCallback(e)}))},Lu=function(e){e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,ku)},Ou=function(e){e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,ku)},Ru=function(e){if(vt.isToolLocked)return!1;var t=e.detail,n=t.element,r=t.numPointers,o=vt.tools.filter((function(e){return e.supportedInteractionTypes.includes("MultiTouch")}));if(o=(o=Ir(n,o,"MultiTouch")).filter((function(e){return"function"==typeof e.multiTouchDragCallback&&r===e.configuration.touchPointers})),vt.isMultiPartToolActive&&(o=Pr(o)),0===o.length)return!1;o[0].multiTouchDragCallback(e)},_u=U("eventDispatchers:touchEventHandlers"),Nu=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t=Dr(e.detail.element,null,"touch");t&&t.addNewMeasurement?t.addNewMeasurement(e,"touch"):t instanceof mo&&function(e,t){_u.log("addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,r=n.element,o=t.createNewMeasurement(n);if(o){if(k(r,t.name,o),1===Object.keys(o.handles).length&&n.type===w.TAP)return o.active=!1,o.handles.end.active=!1,o.handles.end.highlight=!1,o.invalidated=!0,(vt.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&wr(n,o.handles)&&O(r,t.name,o),void y.cornerstone.updateImage(r);y.cornerstone.updateImage(r),to(n,t.name,o,o.handles.end,t.options,"touch",(function(){var e=w.MEASUREMENT_COMPLETED,n={toolName:t.name,toolType:t.name,element:r,measurementData:o};T(r,e,n)}))}}(e,t)}},Bu=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&Uu(n.handles)}};function Uu(e){Object.keys(e).forEach((function(t){e[t].active=!1}))}var Vu,Fu=function(e){if(!vt.isToolLocked&&!vt.isMultiPartToolActive){var t,n=e.detail.element,r=e.detail.currentPoints.canvas;t=Ir(n,yt.touchTools());var o=(t=bu(n,t)).filter((function(e){for(var t=L(n,e.name),o=0;o<t.data.length;o++)if(void 0!==vr(n,t.data[o].handles,r,28))return!0;return!1}));if(o.length>0){var a=o[0],i=L(n,a.name),s=i.data.find((function(e){return void 0!==vr(n,e.handles,r,28)}));return i.data.active=!0,s.active=!0,y.cornerstone.updateImage(n),Wr(e.detail,a.name,i.data,s,a.options,"touch",(function(){return Bu(i)})),e.stopImmediatePropagation(),void e.preventDefault()}var l=t.filter((function(e){var t=L(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,r)}))}));if(l.length>0){var c=l[0],u=L(n,c.name),d=u.data.find((function(e){return c.pointNearTool(n,e,r)}));return d.active=!0,y.cornerstone.updateImage(n),_r(e.detail,c.name,d,null,c.options,"touch",(function(){return Bu(u)})),e.stopImmediatePropagation(),void e.preventDefault()}var f=Ir(n,yt.touchTools());return f.length>0&&f[0].touchStartActiveCallback?f[0].touchStartActiveCallback(e):Nu(e),!1}},ju=function(e){if(!vt.isToolLocked){var t=e.detail,n=t.element,r=t.startPoints.canvas,o=yu(n,yt.touchTools()),a=o.filter((function(e){return"active"===e.mode&&e.options.isTouchActive}));if(vt.isMultiPartToolActive&&(a=Pr(a)),a.length>0){var i=a.find((function(e){return"function"==typeof e.preTouchStartCallback}));if(i&&i.preTouchStartCallback(e))return}if(!vt.isMultiPartToolActive){var s=bu(n,o),l=vu(n,s,r,"touch");if(l.length>0){var c=l[0],u=L(n,c.name),d=fo(n,u,c.name,r,"touch"),f=d.handle,h=d.data;c.handleSelectedCallback(e,h,f,"touch")}else{var p=s.filter((function(e){var t=L(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some((function(t){return e.pointNearTool(n,t,r,"touch")}))}));if(p.length>0){var m=p[0],g=L(n,m.name).data.find((function(e){return m.pointNearTool(n,e,r)}));m.toolSelectedCallback(e,g,"touch")}else if(a.length>0){var v=a.find((function(e){return"function"==typeof e.postTouchStartCallback}));if(v&&v.postTouchStartCallback(e))return}}}}},Hu=gu.bind(null,"DoubleTap","doubleTapCallback"),zu=gu.bind(null,"Touch","touchDragCallback"),qu=gu.bind(null,"Touch","touchEndCallback"),Wu=gu.bind(null,"TouchPinch","touchPinchCallback"),Gu=gu.bind(null,"Touch","touchPressCallback"),Yu=gu.bind(null,"TouchRotate","touchRotateCallback"),Zu=function(e){e.addEventListener(w.TAP,Fu),e.addEventListener(w.TOUCH_START,ju,{passive:!1}),e.addEventListener(w.TOUCH_DRAG,zu,{passive:!1}),e.addEventListener(w.TOUCH_END,qu),e.addEventListener(w.TOUCH_START_ACTIVE,Nu),e.addEventListener(w.TOUCH_PRESS,Gu),e.addEventListener(w.DOUBLE_TAP,Hu),e.addEventListener(w.TOUCH_PINCH,Wu),e.addEventListener(w.TOUCH_ROTATE,Yu),e.addEventListener(w.MULTI_TOUCH_DRAG,Ru)},Xu=function(e){e.removeEventListener(w.TAP,Fu),e.removeEventListener(w.TOUCH_START,ju),e.removeEventListener(w.TOUCH_DRAG,zu),e.removeEventListener(w.TOUCH_END,qu),e.removeEventListener(w.TOUCH_START_ACTIVE,Nu),e.removeEventListener(w.TOUCH_PRESS,Gu),e.removeEventListener(w.DOUBLE_TAP,Hu),e.removeEventListener(w.TOUCH_PINCH,Wu),e.removeEventListener(w.TOUCH_ROTATE,Yu),e.removeEventListener(w.MULTI_TOUCH_DRAG,Ru)},Qu=U("addTool"),Ku=function(e,t,n){var r=new t(n);Tt(e,r.name)?Qu.warn("%s has already been added to the target element",r.name):(r.element=e,wt.state.tools.push(r))},Ju=function(e,t){$u(e,t),wt.state.enabledElements.forEach((function(n){Ku(n,e,t)}))},$u=function(e,t){if(xt("globalConfiguration").configuration.globalToolSyncEnabled){var n=new e(t);void 0!==wt.state.globalTools[n.name]?Qu.warn("%s has already been added globally",n.name):wt.state.globalTools[n.name]={tool:e,props:t,activeBindings:[]}}},ed=U("internals:addEnabledElement"),td=function(e){ed.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;pu(t),Lu(t);var n=xt("globalConfiguration").configuration;n.mouseEnabled&&(gc.enable(t),wc.enable(t),Pu(t)),n.touchEnabled&&(Zc.enable(t),Zu(t)),nd(t)},nd=function(e){wt.state.enabledElements.push(e),wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)}))}(e),function(e){xt("globalConfiguration").configuration.globalToolSyncEnabled&&Object.keys(wt.state.globalTools).forEach((function(t){var n=wt.state.globalTools[t],r=n.tool,o=n.props;Ku(e,r,o)}))}(e),function(e){if(xt("globalConfiguration").configuration.globalToolSyncEnabled){var t={active:Pt,passive:_t,enabled:Ot,disabled:kt};wt.state.globalToolChangeHistory.forEach((function(n){var r=n.args.slice(0);r.unshift(e),t[n.mode].apply(null,r)}))}}(e)},rd=U("internals:removeEnabledElement"),od=function(e){rd.log("EVENT:ELEMENT_DISABLED");var t=e.detail.element,n=xt("globalConfiguration").configuration;mu(t),Ou(t),n.mouseEnabled&&(gc.disable(t),wc.disable(t),Du(t)),n.touchEnabled&&(Zc.disable(t),Xu(t)),ad(t),id(t),sd(t)},ad=function(e){wt.state.tools.forEach((function(t){t.element===e&&kt(t.element,t.name)})),wt.state.tools=wt.state.tools.filter((function(t){return t.element!==e}))},id=function(e){wt.modules&&function(e){var t=wt.modules;Object.keys(t).forEach((function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)}))}(e);var t=wt.state.enabledElements.findIndex((function(t){return t===e}));t>-1?wt.state.enabledElements.splice(t,1):rd.warn("unable to remove element")},sd=function(e){zs.removeHandlers(e)},ld=function(){window.removeEventListener("resize",cd,!1)};function cd(){Vu||(Vu=setTimeout((function(){Vu=null,ud()}),66))}var ud=function(){vt.enabledElements.forEach((function(e){y.cornerstone.resize(e)}))},dd=function(){ld(),window.addEventListener("resize",cd,!1)},fd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};hd(),pd();var t=xt("globalConfiguration");Array.isArray(e)?e.forEach((function(e){var t=e.moduleName,n=e.configuration,r=xt(t);r&&(r.configuration=Object.assign({},r.configuration,n))})):t.configuration=Object.assign({},t.configuration,e),t.configuration.autoResizeViewports&&dd()};function hd(){!function(){var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,td),e.events.removeEventListener(n,od)}();var e=y.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,td),e.events.addEventListener(n,od)}function pd(){var e=wt.modules;Object.keys(e).forEach((function(t){"function"==typeof e[t].onRegisterCallback&&e[t].onRegisterCallback()}))}var md,gd=U("stackTools:stackPrefetch"),vd={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function yd(e,t){e=Math.round(e)||0;var n=[],r=(t=Math.round(t)||0)-e+1;if(r<=0)return n;for(;r--;)n[r]=t--;return n}function bd(e){var t=L(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],r=L(e,"stackPrefetch");if(r){var o=r.data[0]||{};if(o.indicesToRequest&&o.indicesToRequest.length||(o.enabled=!1),!1!==o.enabled&&(r.data[0].indicesToRequest.sort((function(e,t){return e-t})),o.indicesToRequest.slice().forEach((function(e){var t=n.imageIds[e];t&&y.cornerstone.imageCache.getImageLoadObject(t)&&w(e)})),o.indicesToRequest.length)){vd.preserveExistingPool||y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch");for(var a,i,s,l,c,u,d,f=(a=o.indicesToRequest,i=n.currentImageIdIndex,s=0,l=a.length-1,a.forEach((function(e,t){e<i?s=Math.max(t,s):e>i&&(l=Math.min(t,l))})),{low:s,high:l}),h=(zs.getErrorLoadingHandler(e),f.low),p=f.high,m=[];h>=0||p<o.indicesToRequest.length;){var g=n.currentImageIdIndex,v=!(g-o.indicesToRequest[h]>vd.maxImagesToPrefetch)&&h>=0,b=!(o.indicesToRequest[p]-g>vd.maxImagesToPrefetch)&&p<o.indicesToRequest.length;if(!b&&!v)break;v&&(u=o.indicesToRequest[h--],c=n.imageIds[u],m.push(c)),b&&(u=o.indicesToRequest[p++],c=n.imageIds[u],m.push(c))}var x={addToBeginning:!0,priority:0,requestType:"prefetch"};d=function(e){return y.cornerstone.loadAndCacheImage(e,x)},m.reverse().forEach((function(e){y.cornerstone.imageLoadPoolManager.addRequest(d.bind(null,e),"prefetch",{imageId:e},0,!0)}))}}}function w(e){var t=o.indicesToRequest.indexOf(e);t>-1&&o.indicesToRequest.splice(t,1)}}function xd(e){return function(t){var n,r=t.detail;try{n=L(e,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var o=n.data[0].imageIds.indexOf(r.imageId);if(!(o<0)){var a=L(e,"stackPrefetch");a&&a.data&&a.data.length&&a.data[0].indicesToRequest.push(o)}}}}function wd(e){clearTimeout(md),md=setTimeout((function(){var t=e.target;try{bd(t)}catch(e){return}}),10)}var Td={enable:function(e){L(e,"stackPrefetch").data=[];var t=L(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var r={indicesToRequest:yd(0,n.imageIds.length-1),enabled:!0,direction:1},o=r.indicesToRequest.indexOf(n.currentImageIdIndex);r.indicesToRequest.splice(o,1),k(e,"stackPrefetch",r),bd(e),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd),e.addEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var a=xd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,a),y.cornerstone.events.addEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,a)}else gd.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout(md),e.removeEventListener(y.cornerstone.EVENTS.NEW_IMAGE,wd);var t=xd(e);y.cornerstone.events.removeEventListener(y.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=L(e,"stackPrefetch");n&&n.data.length&&(n.data[0].enabled=!1,y.cornerstone.imageLoadPoolManager.clearRequestStack("prefetch"))},getConfiguration:function(){return vd},setConfiguration:function(e){vd=e}},Id=function(){function e(){i()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return l()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=L(e,"stack").data);var r=y.cornerstone,o=t[0],a=o.imageIds[this.currentImageIdIndex],i=t.slice(1,t.length);r.loadAndCacheImage(a).then((function(t){var s=n.layerIds[0];s?r.setLayerImage(e,t,s):(s=r.addLayer(e,t,o.options),n.layerIds.push(s)),r.displayImage(e,t),i.forEach((function(t,o){var i=n.findImageFn(t.imageIds,a),l=o+1,c=n.layerIds[l];c||(c=r.addLayer(e,void 0,t.options),n.layerIds.push(c)),i?r.loadAndCacheImage(i).then((function(t){r.setLayerImage(e,t,c),r.updateImage(e)})):(r.setLayerImage(e,void 0,c),r.setActiveLayer(e,s),r.updateImage(e))}))}))}}]),e}(),Sd={};Sd.FusionRenderer=Id;var Cd=Sd;function Ed(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function Ad(e,t){var n,r;if(void 0===e)throw new Error("playClip: element must not be undefined");var o=L(e,"stack");if(o&&o.data&&o.data.length){var a,i=y.cornerstone;if(o.data.length>1){var s=L(e,"stackRenderer");s&&s.data&&s.data.length&&(a=s.data[0])}var l=o.data[0],c=L(e,"playClip");c&&c.data&&c.data.length?Ed(n=c.data[0]):k(e,"playClip",n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(r=function(e,t){var n,r,o,a=0,i=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)o=Number(e[n])/t|0,s.push(o),1===n?r=o:o!==r&&(s.isTimeVarying=!0),a+=o;return s.length>0&&(o=s.isTimeVarying?a/s.length|0:s[0],s.push(o)),s}(n.frameTimeVector,n.speed));var u=function(){var t,r,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(c<0||c>=u))return Ed(n),void function(e){T(e,w.CLIP_STOPPED,{element:e})}(e);c>=u&&(c=0),c<0&&(c=u-1),c!==l.currentImageIdIndex&&(t=zs.getStartLoadHandler(e),r=zs.getEndLoadHandler(e),s=zs.getErrorLoadingHandler(e),t&&t(e),(!0===l.preventCache?i.loadImage(l.imageIds[c]):i.loadAndCacheImage(l.imageIds[c])).then((function(t){try{l.currentImageIdIndex=c,a?(a.currentImageIdIndex=c,a.render(e,o.data)):i.displayImage(e,t),r&&r(e,t)}catch(e){return}}),(function(t){var n=l.imageIds[c];s&&s(e,n,t)})))};r&&r.length>0&&r.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout((function e(){n.intervalId=setTimeout(e,r[l.currentImageIdIndex]),u()}),0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/Math.abs(n.framesPerSecond)))}}function Md(e){var t=L(e,"playClip");t&&t.data&&t.data.length&&Ed(t.data[0])}var Pd=function(e,t){var n=wt.state.tools.findIndex((function(n){return n.element===e&&n.name===t}));n>=0&&wt.state.tools.splice(n,1)},Dd=function(e){kd(e),wt.state.enabledElements.forEach((function(t){Pd(t,e)}))},kd=function(e){xt("globalConfiguration").configuration.globalToolSyncEnabled&&wt.state.globalTools[e]&&delete wt.state.globalTools[e]},Ld=function(e,t,n){var r=Tt(e,t);r&&r.mergeOptions(n)},Od=function(e,t){vt.enabledElements.forEach((function(n){Ld(n,e,t)}))};function Rd(e,t){var n={};return{get:function(r,o){return e.indexOf(o)>=0?(!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o]):t.get(r,o)},add:function(r,o,a){if(!(e.indexOf(o)>=0))return t.add(r,o,a);!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o].data.push(a)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var _d=[];function Nd(e,t){var n=D(e);n||(n=P);var r=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(r=r.concat(t));var o=Rd(r,n);_d.push(o),_(e,o)}var Bd={newStackSpecificToolStateManager:Rd,addStackStateManager:Nd};function Ud(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n))return r[n]}},add:function(t,n,r){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(r)},remove:function(t,n,r){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n)){for(var a=o[n],i=-1,s=0;s<a.data.length;s++)a.data[s]===r&&(i=s);-1!==i&&a.data.splice(i,1)}}}}}var Vd=Ud(),Fd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",r=e.querySelector("canvas");if(r.msToBlob){var o=r.msToBlob();return window.navigator.msSaveBlob(o,t)}var a=document.createElement("a");if(a.download=t,a.href=r.toDataURL(n,1),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(i)}else a.fireEvent&&a.fireEvent("onclick")},jd=U("thirdParty:registerModule"),Hd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=zd(e);!r||n?(r&&jd.warn("Overwriting module %s",e),bt[e]=t,"function"==typeof bt[e].onRegisterCallback&&bt[e].onRegisterCallback()):jd.warn("A module with the name %s is already registered",e)};function zd(e){return void 0!==bt[e]}function qd(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}var Wd={"base/BaseTool":pr,"base/BaseAnnotationTool":mo,"base/BaseBrushTool":Mr,"tools/cursors/MouseCursor":bo,"tools/cursors":o,"manipulators/anyHandlesOutsideImage":wr,"manipulators/getHandleNearImagePoint":vr,"manipulators/getHandlePixelPosition":Tr,"manipulators/handleActivator":yr,"manipulators/moveAllHandles":_r,"manipulators/moveHandle":Wr,"manipulators/moveNewHandle":to,"manipulators/moveHandleNearImagePoint":uo,"manipulators/findHandleDataNearImagePoint":fo,"manipulators/moveAnnotation":ho,"mixins/activeOrDisabledBinaryTool":ar.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":ar.enabledOrDisabledBinaryTool,"drawing/getNewContext":Pn,"drawing/draw":Wt,"drawing/path":Xt,"drawing/setShadow":kn,"drawing/drawLine":Qt,"drawing/drawLines":fn,"drawing/drawJoinedLines":Kt,"drawing/drawCircle":$t,"drawing/drawEllipse":an,"drawing/drawRect":Mn,"drawing/fillOutsideRect":function(e,t,n,r,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var a=y.cornerstone;n=a.pixelToCanvas(t,n),r=a.pixelToCanvas(t,r)}var i=Math.min(n.x,r.x),s=Math.min(n.y,r.y),l=Math.abs(n.x-r.x),c=Math.abs(n.y-r.y);Xt(e,o,(function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(i+l,s,-l,c)}))},"drawing/drawTextBox":wn,"drawing/drawArrow":Jt,"drawing/fillBox":bn,"drawing/fillTextLines":yn,"drawing/drawLink":hn,"drawing/drawLinkedTextBox":An,"drawing/drawHandles":dn,"drawing/textBoxWidth":xn,"util/getActiveTool":Dr,"util/getLuminance":Vl,"util/getROITextBoxCoords":ni,"util/copyPoints":oc,"util/calculateSUV":Ka,"util/setContextToDisplayFontSize":function(e,t,n){return y.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":Ol,"util/scroll":Rl,"util/roundToDecimal":vo,"util/projectPatientPointToImagePlane":tn,"util/imagePointToPatientPoint":nn,"util/planePlaneIntersection":rn,"util/pointInsideBoundingBox":mr,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")},"util/getRGBPixels":zi,"util/getBrowserInfo":qd,"util/isMobileDevice":function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)},"util/angleBetweenPoints":Tl,"util/numbersWithCommas":ri,"util/lineSegDistance":go,"util/triggerEvent":T,"util/convertToVector3":en,"util/clip":Tn,"util/clipToBox":In,"util/clipBoxToDisplayedArea":Cn,"util/debounce":sa,"util/deepmerge":dr,"util/getDefault":Dn,"util/getProximityThreshold":so,"util/getPixelSpacing":aa,"util/isEmptyObject":Ln,"util/isObject":ia,"util/isPointInImage":Ge,"util/isPointInPolygon":us,"util/getLogger":U,"util/throttle":la,"util/wait":yl,"util/waitForEnabledElementImageToLoad":bl,"util/getKeyPressData":function(e){var t=y.cornerstone,n=e.currentTarget,r=t.getEnabledElement(n);if(r&&r.image){var o=wt.state.mousePositionImage;return{event:window.event||e,element:n,viewport:t.getViewport(n),image:r.image,currentPoints:{image:o,canvas:t.pixelToCanvas(n,o)},keyCode:e.keyCode,which:e.which}}},"util/ellipseUtils":ti,"util/freehandUtils":Li,"util/segmentationUtils":r,"util/zoomUtils":Yl},Gd=U("thirdParty:registerMixin"),Yd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Zd(e);!r||n?(r&&Gd.warn("Overwriting mixins/%s",e),ar[e]=t,Wd["mixins/".concat(e)]=ar[e]):Gd.warn("mixins/%s is already registered",e)};function Zd(e){return void 0!==ar[e]}var Xd=U("thirdParty:registerType"),Qd=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o="".concat(e,"/").concat(t),a=Kd(o);!a||r?(a&&Xd.warn("Overwriting %s",o),Wd[o]=n):Xd.warn("%s is already registered",o)};function Kd(e){return void 0!==Wd[e]}var Jd=U("thirdParty:register"),$d=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(ef(e,t,n))switch(e){case"module":Hd(t,n,r);break;case"mixin":Yd(t,n,r);break;default:Qd(e,t,n,r)}};function ef(e,t,n){return e?t?"object"===x()(n)||"function"==typeof n||(Jd.warn("The %s is a %s, it should be an Object or a function.",n,x()(n)),!1):(Jd.warn("The %s must have a name in order to register.",e),!1):(Jd.warn("The type must be given in order to register."),!1)}var tf=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.forEach((function(e){var n=e.type,r=e.name,o=e.item;$d(n,r,o,t)}))},nf=function(e,t,n){if(n!==t){var r=y.cornerstone,o=r.getViewport(t),a=r.getViewport(n);a.voi.windowWidth===o.voi.windowWidth&&a.voi.windowCenter===o.voi.windowCenter&&a.invert===o.invert||(a.voi.windowWidth=o.voi.windowWidth,a.voi.windowCenter=o.voi.windowCenter,a.invert=o.invert,e.setViewport(n,a))}},rf=function(e,t,n){n!==t&&y.cornerstone.updateImage(n)};function of(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))}var af=function(e,t){y.cornerstone;var n=this,r=[],o=[],a=!1,i={},s=t;function l(e){var t=e.detail.element;n.remove(t),function(e){for(var t in qs)qs[t]=qs[t].filter((function(t){return t.element!==e}))}(t)}this.enabled=!0,this.setHandler=function(e){s=e},this.getHandler=function(){return s},this.getDistances=function(){if(r.length&&o.length){var e=y.cornerstone;i.distances={},i.imageIds={sourceElements:[],targetElements:[]},r.forEach((function(t){var n=e.getEnabledElement(t);if(n&&n.image){var r=n.image.imageId,a=e.metaData.get("imagePlaneModule",r);if(a&&a.imagePositionPatient){var s=en(a.imagePositionPatient);i.hasOwnProperty(n)||(i.distances[r]={},i.imageIds.sourceElements.push(r),o.forEach((function(n){var o=e.getEnabledElement(n);if(o&&o.image){var a=o.image.imageId;if(i.imageIds.targetElements.push(a),t!==n&&r!==a&&!i.distances[r].hasOwnProperty(a)){var l=e.metaData.get("imagePlaneModule",a);if(l&&l.imagePositionPatient){var c=en(l.imagePositionPatient);i.distances[r][a]=c.clone().sub(s)}}}})),Object.keys(i.distances[r]).length||delete i.distances[r])}}}))}},this.fireEvent=function(e,t){var l=!n.enabled,c=!r.length||!o.length;l||c||(a=!0,o.forEach((function(a){var l=o.indexOf(a);if(-1!==l){var c=i.imageIds.targetElements[l],u=r.indexOf(e);if(-1!==u){var d,f=i.imageIds.sourceElements[u];f===c?d=0:void 0!==i.distances[f]&&(d=i.distances[f][c]),s(n,e,a,t,d)}}})),a=!1)},this.onEvent=function(e){var t=e.detail;!0!==a&&n.fireEvent(e.currentTarget,t)},this.addSource=function(t){-1===r.indexOf(t)&&(r.push(t),e.split(" ").forEach((function(e){t.addEventListener(e,n.onEvent)})),n.getDistances(),n.updateDisableHandlers())},this.addTarget=function(e){-1===o.indexOf(e)&&(o.push(e),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.add=function(e){n.addSource(e),n.addTarget(e)},this.removeSource=function(t){var o=r.indexOf(t);-1!==o&&(r.splice(o,1),e.split(" ").forEach((function(e){t.removeEventListener(e,n.onEvent)})),n.getDistances(),n.fireEvent(t),n.updateDisableHandlers())},this.removeTarget=function(e){var t=o.indexOf(e);-1!==t&&(o.splice(t,1),n.getDistances(),s(n,e,e,0),n.updateDisableHandlers())},this.remove=function(e){n.removeTarget(e),n.removeSource(e)},this.getSourceElements=function(){return r},this.getTargetElements=function(){return o},this.displayImage=function(e,t,n){a=!0,y.cornerstone.displayImage(e,t,n),a=!1},this.setViewport=function(e,t){a=!0,y.cornerstone.setViewport(e,t),a=!1},this.updateDisableHandlers=function(){of(r.concat(o)).forEach((function(e){e.removeEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l),e.addEventListener(y.cornerstone.EVENTS.ELEMENT_DISABLED,l)}))},this.destroy=function(){of(r.concat(o)).forEach((function(e){n.remove(e)}))}},sf=function(e,t,n,r){if(t!==n&&r&&r.direction){var o=y.cornerstone,a=L(n,"stack").data[0],i=a.currentImageIdIndex+r.direction;if(i=En(i,0,a.imageIds.length-1),a.currentImageIdIndex!==i){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);a.currentImageIdIndex=i;var u=a.imageIds[i];s&&s(n),(!0===a.preventCache?o.loadImage(u):o.loadAndCacheImage(u)).then((function(t){var r=o.getViewport(n);a.currentImageIdIndex===i&&(e.displayImage(n,t,r),l&&l(n,t))}),(function(e){var t=a.imageIds[i];c&&c(n,t,e)}))}}},lf=function(e,t,n){if(n!==t){var r=y.cornerstone,o=L(t,"stack").data[0],a=o.imageIds[o.currentImageIdIndex],i=r.metaData.get("imagePlaneModule",a);if(void 0!==i&&void 0!==i.imagePositionPatient){var s=en(i.imagePositionPatient),l=L(n,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(l.imageIds.forEach((function(e,t){var n=r.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var o=en(n.imagePositionPatient).distanceToSquared(s);o<c&&(c=o,u=t)}})),u!==l.currentImageIdIndex){var d=zs.getStartLoadHandler(n),f=zs.getEndLoadHandler(n),h=zs.getErrorLoadingHandler(n);l.currentImageIdIndex=u;var p=l.imageIds[u];d&&d(n),-1!==u&&(!0===l.preventCache?r.loadImage(p):r.loadAndCacheImage(p)).then((function(t){var o=r.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,o),f&&f(n,t))}),(function(e){var t=l.imageIds[u];h&&h(n,t,e)}))}}}},cf=function(e,t,n,r,o){if(n!==t){var a=y.cornerstone,i=L(t,"stack").data[0],s=i.imageIds[i.currentImageIdIndex],l=a.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=en(l.imagePositionPatient),u=L(n,"stack").data[0],d=Number.MAX_VALUE,f=-1;if(o){var h=c.clone().add(o);if(u.imageIds.forEach((function(e,t){var n=a.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var r=en(n.imagePositionPatient),o=h.distanceToSquared(r);o<d&&(d=o,f=t)}})),f!==u.currentImageIdIndex&&-1!==f){var p=zs.getStartLoadHandler(n),m=zs.getEndLoadHandler(n),g=zs.getErrorLoadingHandler(n);u.currentImageIdIndex=f;var v=u.imageIds[f];p&&p(n),(!0===u.preventCache?a.loadImage(v):a.loadAndCacheImage(v)).then((function(t){var r=a.getViewport(n);u.currentImageIdIndex===f&&(e.displayImage(n,t,r),m&&m(n,t))}),(function(e){var t=u.imageIds[f];g&&g(n,t,e)}))}}}}},uf=function(e,t,n){if(n!==t){var r=y.cornerstone,o=L(t,"stack").data[0],a=L(n,"stack").data[0],i=o.currentImageIdIndex;if((i=En(i,0,a.imageIds.length-1))!==a.currentImageIdIndex){var s=zs.getStartLoadHandler(n),l=zs.getEndLoadHandler(n),c=zs.getErrorLoadingHandler(n);s&&s(n),(!0===a.preventCache?r.loadImage(a.imageIds[i]):r.loadAndCacheImage(a.imageIds[i])).then((function(t){var o=r.getViewport(n);a.currentImageIdIndex=i,e.displayImage(n,t,o),l&&l(n,t)}),(function(e){var t=a.imageIds[i];c&&c(n,t,e)}))}}},df=function(e,t,n){if(n!==t){var r=y.cornerstone,o=r.getViewport(t),a=r.getViewport(n);a.scale===o.scale&&a.translation.x===o.translation.x&&a.translation.y===o.translation.y||(a.scale=o.scale,a.translation.x=o.translation.x,a.translation.y=o.translation.y,e.setViewport(n,a))}},ff=function(e){return Wd[e]};n.d(t,"AngleTool",(function(){return ca})),n.d(t,"ArrowAnnotateTool",(function(){return fa})),n.d(t,"BidirectionalTool",(function(){return Qa})),n.d(t,"CircleRoiTool",(function(){return ai})),n.d(t,"CobbAngleTool",(function(){return ui})),n.d(t,"EllipticalRoiTool",(function(){return fi})),n.d(t,"FreehandRoiTool",(function(){return Vi})),n.d(t,"LengthTool",(function(){return Hi})),n.d(t,"ProbeTool",(function(){return Wi})),n.d(t,"RectangleRoiTool",(function(){return Yi})),n.d(t,"TextMarkerTool",(function(){return Ji})),n.d(t,"BrushTool",(function(){return ts})),n.d(t,"SphericalBrushTool",(function(){return os})),n.d(t,"RectangleScissorsTool",(function(){return Ns})),n.d(t,"FreehandScissorsTool",(function(){return _s})),n.d(t,"CircleScissorsTool",(function(){return Bs})),n.d(t,"CorrectionScissorsTool",(function(){return Us})),n.d(t,"CrosshairsTool",(function(){return Ys})),n.d(t,"DoubleTapFitToWindowTool",(function(){return Zs})),n.d(t,"DragProbeTool",(function(){return Xs})),n.d(t,"EraserTool",(function(){return Js})),n.d(t,"FreehandRoiSculptorTool",(function(){return el})),n.d(t,"MagnifyTool",(function(){return nl})),n.d(t,"OverlayTool",(function(){return ol})),n.d(t,"OrientationMarkersTool",(function(){return il})),n.d(t,"PanMultiTouchTool",(function(){return dl})),n.d(t,"PanTool",(function(){return fl})),n.d(t,"ReferenceLinesTool",(function(){return wl})),n.d(t,"RotateTool",(function(){return Il})),n.d(t,"RotateTouchTool",(function(){return Al})),n.d(t,"ScaleOverlayTool",(function(){return Pl})),n.d(t,"StackScrollMouseWheelTool",(function(){return Nl})),n.d(t,"StackScrollMultiTouchTool",(function(){return Bl})),n.d(t,"StackScrollTool",(function(){return Ul})),n.d(t,"WwwcRegionTool",(function(){return Fl})),n.d(t,"WwwcTool",(function(){return ql})),n.d(t,"ZoomMouseWheelTool",(function(){return Zl})),n.d(t,"ZoomTool",(function(){return Kl})),n.d(t,"ZoomTouchPinchTool",(function(){return rc})),n.d(t,"init",(function(){return fd})),n.d(t,"stackPrefetch",(function(){return Td})),n.d(t,"stackRenderers",(function(){return Cd})),n.d(t,"playClip",(function(){return Ad})),n.d(t,"stopClip",(function(){return Md})),n.d(t,"store",(function(){return wt})),n.d(t,"getModule",(function(){return xt})),n.d(t,"getToolForElement",(function(){return Tt})),n.d(t,"addTool",(function(){return Ju})),n.d(t,"addToolForElement",(function(){return Ku})),n.d(t,"removeTool",(function(){return Dd})),n.d(t,"removeToolForElement",(function(){return Pd})),n.d(t,"setToolOptions",(function(){return Od})),n.d(t,"setToolOptionsForElement",(function(){return Ld})),n.d(t,"isToolActiveForElement",(function(){return Er})),n.d(t,"setToolActive",(function(){return Dt})),n.d(t,"setToolActiveForElement",(function(){return Pt})),n.d(t,"setToolEnabled",(function(){return Rt})),n.d(t,"setToolEnabledForElement",(function(){return Ot})),n.d(t,"setToolDisabled",(function(){return Lt})),n.d(t,"setToolDisabledForElement",(function(){return kt})),n.d(t,"setToolPassive",(function(){return Nt})),n.d(t,"setToolPassiveForElement",(function(){return _t})),n.d(t,"addToolState",(function(){return k})),n.d(t,"getToolState",(function(){return L})),n.d(t,"removeToolState",(function(){return O})),n.d(t,"clearToolState",(function(){return R})),n.d(t,"setElementToolStateManager",(function(){return _})),n.d(t,"getElementToolStateManager",(function(){return D})),n.d(t,"textStyle",(function(){return vn})),n.d(t,"toolStyle",(function(){return Zt})),n.d(t,"toolColors",(function(){return un})),n.d(t,"toolCoordinates",(function(){return Ea})),n.d(t,"stackSpecificStateManager",(function(){return Bd})),n.d(t,"newStackSpecificToolStateManager",(function(){return Rd})),n.d(t,"addStackStateManager",(function(){return Nd})),n.d(t,"loadHandlerManager",(function(){return zs})),n.d(t,"newImageIdSpecificToolStateManager",(function(){return M})),n.d(t,"globalImageIdSpecificToolStateManager",(function(){return P})),n.d(t,"newFrameOfReferenceSpecificToolStateManager",(function(){return Ud})),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",(function(){return Vd})),n.d(t,"forceEnabledElementResize",(function(){return ud})),n.d(t,"orientation",(function(){return al})),n.d(t,"SaveAs",(function(){return Fd})),n.d(t,"enableLogger",(function(){return V})),n.d(t,"disableLogger",(function(){return F})),n.d(t,"register",(function(){return $d})),n.d(t,"registerSome",(function(){return tf})),n.d(t,"wwwcSynchronizer",(function(){return nf})),n.d(t,"updateImageSynchronizer",(function(){return rf})),n.d(t,"Synchronizer",(function(){return af})),n.d(t,"stackScrollSynchronizer",(function(){return sf})),n.d(t,"stackImagePositionSynchronizer",(function(){return lf})),n.d(t,"stackImagePositionOffsetSynchronizer",(function(){return cf})),n.d(t,"stackImageIndexSynchronizer",(function(){return uf})),n.d(t,"panZoomSynchronizer",(function(){return df})),n.d(t,"importInternal",(function(){return ff})),n.d(t,"external",(function(){return y})),n.d(t,"EVENTS",(function(){return w})),n.d(t,"version",(function(){return"6.0.9"})),n.d(t,"import",(function(){return ff}));var hf={AngleTool:ca,ArrowAnnotateTool:fa,BidirectionalTool:Qa,CircleRoiTool:ai,CobbAngleTool:ui,EllipticalRoiTool:fi,FreehandRoiTool:Vi,LengthTool:Hi,ProbeTool:Wi,RectangleRoiTool:Yi,TextMarkerTool:Ji,BrushTool:ts,SphericalBrushTool:os,RectangleScissorsTool:Ns,FreehandScissorsTool:_s,CircleScissorsTool:Bs,CorrectionScissorsTool:Us,CrosshairsTool:Ys,DoubleTapFitToWindowTool:Zs,DragProbeTool:Xs,EraserTool:Js,FreehandRoiSculptorTool:el,MagnifyTool:nl,OverlayTool:ol,OrientationMarkersTool:il,PanMultiTouchTool:dl,PanTool:fl,ReferenceLinesTool:wl,RotateTool:Il,RotateTouchTool:Al,ScaleOverlayTool:Pl,StackScrollMouseWheelTool:Nl,StackScrollMultiTouchTool:Bl,StackScrollTool:Ul,WwwcRegionTool:Fl,WwwcTool:ql,ZoomMouseWheelTool:Zl,ZoomTool:Kl,ZoomTouchPinchTool:rc,init:fd,stackPrefetch:Td,stackRenderers:Cd,playClip:Ad,stopClip:Md,store:wt,getModule:xt,getToolForElement:Tt,addTool:Ju,addToolForElement:Ku,removeTool:Dd,removeToolForElement:Pd,setToolOptions:Od,setToolOptionsForElement:Ld,isToolActiveForElement:Er,setToolActive:Dt,setToolActiveForElement:Pt,setToolEnabled:Rt,setToolEnabledForElement:Ot,setToolDisabled:Lt,setToolDisabledForElement:kt,setToolPassive:Nt,setToolPassiveForElement:_t,addToolState:k,getToolState:L,removeToolState:O,clearToolState:R,setElementToolStateManager:_,getElementToolStateManager:D,textStyle:vn,toolStyle:Zt,toolColors:un,toolCoordinates:Ea,stackSpecificStateManager:Bd,newStackSpecificToolStateManager:Rd,addStackStateManager:Nd,loadHandlerManager:zs,newImageIdSpecificToolStateManager:M,globalImageIdSpecificToolStateManager:P,newFrameOfReferenceSpecificToolStateManager:Ud,globalFrameOfReferenceSpecificToolStateManager:Vd,forceEnabledElementResize:ud,orientation:al,SaveAs:Fd,enableLogger:V,disableLogger:F,importInternal:ff,import:ff,register:$d,registerSome:tf,wwwcSynchronizer:nf,updateImageSynchronizer:rf,Synchronizer:af,stackScrollSynchronizer:sf,stackImagePositionSynchronizer:lf,stackImagePositionOffsetSynchronizer:cf,stackImageIndexSynchronizer:uf,panZoomSynchronizer:df,external:y,EVENTS:w,version:"6.0.9"};t.default=hf}])},5205:e=>{
/*! cornerstone-web-image-loader - 2.1.1 - 2018-12-05 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWebImageLoader */
window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=void 0;var r,o=(r=n(4))&&r.__esModule?r:{default:r},a=void 0,i={set cornerstone(e){a=e,(0,o.default)(a)},get cornerstone(){return a}};t.external=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImage=function(e){var t=r.external.cornerstone,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",s.beforeSend(n),n.onprogress=function(n){if(n.lengthComputable){var r=n.loaded,o=n.total,a=Math.round(r/o*100),i={imageId:e,loaded:r,total:o,percentComplete:a};t.triggerEvent(t.events,"cornerstoneimageloadprogress",i)}},{promise:new Promise((function(t,r){n.onload=function(){(0,o.default)(this.response).then((function(n){var r=(0,a.default)(n,e);t(r)}),r)},n.send()})),cancelFn:function(){n.abort()}}},t.configure=function(e){s=e};var r=n(0),o=i(n(3)),a=i(n(2));function i(e){return e&&e.__esModule?e:{default:e}}var s={beforeSend:function(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.naturalHeight,i=e.naturalWidth;return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,render:r.external.cornerstone.renderWebImage,getPixelData:function(){return(n=void 0,a===t?n=o.getContext("2d"):(o.height=e.naturalHeight,o.width=e.naturalWidth,(n=o.getContext("2d")).drawImage(e,0,0),a=t),n.getImageData(0,0,e.naturalWidth,e.naturalHeight)).data;var n},getCanvas:function(){return a===t||(o.height=e.naturalHeight,o.width=e.naturalWidth,o.getContext("2d").drawImage(e,0,0),a=t),o},getImage:function(){return e},rows:n,columns:i,height:n,width:i,color:!0,rgba:!1,columnPixelSpacing:void 0,rowPixelSpacing:void 0,invert:!1,sizeInBytes:n*i*4}};var r=n(0),o=document.createElement("canvas"),a=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise((function(t,n){var r=new Image,o=new Uint8Array(e),a=new Blob([o]),i=window.URL||window.webkitURL,s=i.createObjectURL(a);r.src=s,r.onload=function(){t(r),i.revokeObjectURL(s)},r.onerror=function(e){i.revokeObjectURL(s),n(e)}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.registerImageLoader("http",r.loadImage),e.registerImageLoader("https",r.loadImage)};var r=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.configure=t.loadImage=t.createImage=t.arrayBufferToImage=void 0;var r=s(n(3)),o=s(n(2)),a=n(1),i=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var l={arrayBufferToImage:r.default,createImage:o.default,loadImage:a.loadImage,configure:a.configure,external:i.external};t.arrayBufferToImage=r.default,t.createImage=o.default,t.loadImage=a.loadImage,t.configure=a.configure,t.external=i.external,t.default=l}])},4705:function(e,t,n){
/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */
e.exports=function(e){return n=[function(t,n){t.exports=e},function(e,t,n){"use strict";n.r(t),n.d(t,"isStringVr",(function(){return o})),n.d(t,"isPrivateTag",(function(){return a})),n.d(t,"parsePN",(function(){return i})),n.d(t,"parseTM",(function(){return s})),n.d(t,"parseDA",(function(){return c})),n.d(t,"explicitElementToString",(function(){return u})),n.d(t,"explicitDataSetToJS",(function(){return d})),n.d(t,"createJPEGBasicOffsetTable",(function(){return p})),n.d(t,"parseDicomDataSetExplicit",(function(){return L})),n.d(t,"parseDicomDataSetImplicit",(function(){return O})),n.d(t,"readFixedString",(function(){return y})),n.d(t,"alloc",(function(){return R})),n.d(t,"version",(function(){return _})),n.d(t,"bigEndianByteArrayParser",(function(){return N})),n.d(t,"ByteStream",(function(){return V})),n.d(t,"sharedCopy",(function(){return B})),n.d(t,"DataSet",(function(){return w})),n.d(t,"findAndSetUNElementLength",(function(){return v})),n.d(t,"findEndOfEncapsulatedElement",(function(){return g})),n.d(t,"findItemDelimitationItemAndSetElementLength",(function(){return T})),n.d(t,"littleEndianByteArrayParser",(function(){return F})),n.d(t,"parseDicom",(function(){return z})),n.d(t,"readDicomElementExplicit",(function(){return k})),n.d(t,"readDicomElementImplicit",(function(){return S})),n.d(t,"readEncapsulatedImageFrame",(function(){return Z})),n.d(t,"readEncapsulatedPixelData",(function(){return Q})),n.d(t,"readEncapsulatedPixelDataFromFragments",(function(){return W})),n.d(t,"readPart10Header",(function(){return j})),n.d(t,"readSequenceItemsExplicit",(function(){return P})),n.d(t,"readSequenceItemsImplicit",(function(){return A})),n.d(t,"readSequenceItem",(function(){return C})),n.d(t,"readTag",(function(){return m}));var r={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},o=function(e){return r[e]},a=function(e){if(e=parseInt(e[4],16),isNaN(e))throw"dicomParser.isPrivateTag: cannot parse last character of group";return e%2==1},i=function(e){if(void 0!==e)return{familyName:(e=e.split("^"))[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}};function s(e,t){if(2<=e.length){var n=parseInt(e.substring(0,2),10),r=4<=e.length?parseInt(e.substring(2,4),10):void 0,o=6<=e.length?parseInt(e.substring(4,6),10):void 0,a=(a=8<=e.length?e.substring(7,13):void 0)?parseInt(a,10)*Math.pow(10,6-a.length):void 0;if(t&&(isNaN(n)||void 0!==r&&isNaN(r)||void 0!==o&&isNaN(o)||void 0!==a&&isNaN(a)||n<0||23<n||r&&(r<0||59<r)||o&&(o<0||59<o)||a&&(a<0||999999<a)))throw"invalid TM '".concat(e,"'");return{hours:n,minutes:r,seconds:o,fractionalSeconds:a}}if(t)throw"invalid TM '".concat(e,"'")}function l(e,t,n){return!isNaN(n)&&0<t&&t<=12&&0<e&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}function c(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),r=parseInt(e.substring(4,6),10),o=parseInt(e.substring(6,8),10);if(t&&!0!==l(o,r,n))throw"invalid DA '".concat(e,"'");return{year:n,month:r,day:o}}if(t)throw"invalid DA '".concat(e,"'")}function u(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,r=t.vr,a=t.tag;function i(t,n){for(var r="",o=0;o<t;o++)0!==o&&(r+="/"),r+=n.call(e,a,o).toString();return r}if(!0===o(r))n=e.string(a);else{if("AT"===r){var s=e.uint32(a);return void 0===s?void 0:"x".concat((s=s<0?4294967295+s+1:s).toString(16).toUpperCase())}"US"===r?n=i(t.length/2,e.uint16):"SS"===r?n=i(t.length/2,e.int16):"UL"===r?n=i(t.length/4,e.uint32):"SL"===r?n=i(t.length/4,e.int32):"FD"===r?n=i(t.length/8,e.double):"FL"===r&&(n=i(t.length/4,e.float))}return n}function d(e,t){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";t=t||{omitPrivateAttibutes:!0,maxElementLength:128};var n,r={};for(n in e.elements){var o=e.elements[n];if(!0!==t.omitPrivateAttibutes||!a(n))if(o.items){for(var i=[],s=0;s<o.items.length;s++)i.push(d(o.items[s].dataSet,t));r[n]=i}else{var l=void 0;o.length<t.maxElementLength&&(l=u(e,o)),r[n]=void 0!==l?l:{dataOffset:o.dataOffset,length:o.length}}}return r}function f(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function h(e,t,n){for(var r,o,a=n;a<t.fragments.length;a++)if(o=a,f(r=e,(o=t.fragments[o]).position+o.length-2)||f(r,o.position+o.length-3))return a}function p(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var r=[],o=0;;){r.push(t.fragments[o].offset);var a=h(e,t,o);if(void 0===a||a===t.fragments.length-1)return r;o=a+1}}function m(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256;return e=e.readUint16(),"x".concat("00000000".concat((t+e).toString(16)).substr(-8))}function g(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==m(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=e.readUint32()/4,o=0;o<r;o++){var a=e.readUint32();t.basicOffsetTable.push(a)}for(var i=e.position;e.position<e.byteArray.length;){var s=m(e),l=e.readUint32();if("xfffee0dd"===s)return e.seek(l),void(t.length=e.position-t.dataOffset);if("xfffee000"!==s)return n&&n.push("unexpected tag ".concat(s," while searching for end of pixel data element with undefined length")),l>e.byteArray.length-e.position&&(l=e.byteArray.length-e.position),t.fragments.push({offset:e.position-i-8,position:e.position,length:l}),e.seek(l),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-i-8,position:e.position,length:l}),e.seek(l)}n&&n.push("pixel data element ".concat(t.tag," missing sequence delimiter tag xfffee0dd"))}function v(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}function y(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r,o="",a=0;a<n;a++){if(0===(r=e[t+a]))return t+=n,o;o+=String.fromCharCode(r)}return o}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return void 0!==e.parser?e.parser:t}var w=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=r}var t,n,r;return t=e,(n=[{key:"uint16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readUint16(this.byteArray,e.dataOffset+2*t)}},{key:"int16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readInt16(this.byteArray,e.dataOffset+2*t)}},{key:"uint32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readUint32(this.byteArray,e.dataOffset+4*t)}},{key:"int32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readInt32(this.byteArray,e.dataOffset+4*t)}},{key:"float",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readFloat(this.byteArray,e.dataOffset+4*t)}},{key:"double",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return x(e,this.byteArrayParser).readDouble(this.byteArray,e.dataOffset+8*t)}},{key:"numStringValues",value:function(e){if((e=this.elements[e])&&0<e.length)return null===(e=y(this.byteArray,e.dataOffset,e.length).match(/\\/g))?1:e.length+1}},{key:"string",value:function(e,t){return(e=this.elements[e])&&e.Value?e.Value:e&&0<e.length?(e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].trim():e.trim()):void 0}},{key:"text",value:function(e,t){if((e=this.elements[e])&&0<e.length)return e=y(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].replace(/ +$/,""):e.replace(/ +$/,"")}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseFloat(t)}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&0<n.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseInt(t)}},{key:"attributeTag",value:function(e){if((n=this.elements[e])&&4===n.length){var t=x(n,this.byteArrayParser).readUint16,n=(e=this.byteArray,n.dataOffset);return"x".concat("00000000".concat((256*t(e,n)*256+t(e,n+2)).toString(16)).substr(-8))}}}])&&b(t.prototype,n),r&&b(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function T(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}var I=function(e,t){return void 0!==e.vr?"SQ"===e.vr:t.position+4<=t.byteArray.length?(e=m(t),t.seek(-4),"xfffee000"===e||"xfffee0dd"===e):(t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function S(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var r;return 4294967295===(r={tag:r=m(e),vr:void 0!==n?n(r):void 0,length:e.readUint32(),dataOffset:e.position}).length&&(r.hadUndefinedLength=!0),r.tag===t||(!I(r,e)||a(r.tag)&&!r.hadUndefinedLength?r.hadUndefinedLength?T(e,r):e.seek(r.length):(A(e,r,n),a(r.tag)&&(r.items=void 0))),r}function C(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:m(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(e.position);return t}function E(e,t){var n=C(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var r=S(e,void 0,t);if("xfffee00d"===(n[r.tag]=r).tag)return new w(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),O(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}function A(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=m(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8);r=E(e,n),t.items.push(r)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}:function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var o=E(e,n);t.items.push(o)}})(e,t,n)}function M(e,t){var n=C(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var r=k(e,t);if("xfffee00d"===(n[r.tag]=r).tag)return new w(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new w(e.byteArrayParser,e.byteArray,{}),L(n.dataSet,e,e.position+n.length)),n}function P(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=m(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8);r=M(e,n),t.items.push(r)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}:function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var o=M(e,n);t.items.push(o)}})(e,t,n)}var D=function(e){return"OB"===e||"OD"===e||"OL"===e||"OW"===e||"SQ"===e||"OF"===e||"UC"===e||"UR"===e||"UT"===e||"UN"===e?4:2};function k(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var r={tag:m(e),vr:e.readFixedString(2)};return 2===D(r.vr)?r.length=e.readUint16():(e.seek(2),r.length=e.readUint32()),r.dataOffset=e.position,4294967295===r.length&&(r.hadUndefinedLength=!0),r.tag===n||("SQ"===r.vr?P(e,r,t):4294967295===r.length?"x7fe00010"===r.tag?g(e,r,t):("UN"===r.vr?A:T)(e,r):e.seek(r.length)),r}function L(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?t.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var o=e.elements;t.position<n;){var a=k(t,e.warnings,r.untilTag);if((o[a.tag]=a).tag===r.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function O(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?e.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var o=e.elements;t.position<n;){var a=S(t,r.untilTag,r.vrCallback);if((o[a.tag]=a).tag===r.untilTag)return}}function R(e,t){if("undefined"!=typeof Buffer&&e instanceof Buffer)return Buffer.alloc(t);if(e instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"}var _="1.8.12",N={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=(e[t]<<8)+e[t+1])?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}};function B(e,t,n){if("undefined"!=typeof Buffer&&e instanceof Buffer)return e.slice(t,t+n);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+t,n);throw"dicomParser.from: unknown type for byteArray"}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var V=function(){function e(t,n,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==0&&("undefined"==typeof Buffer||n instanceof Buffer==0))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(r<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(r>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=t,this.byteArray=n,this.position=r||0,this.warnings=[]}var t,n,r;return t=e,(n=[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=B(this.byteArray,this.position,t);return this.position+=t,new e(this.byteArrayParser,n)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=y(this.byteArray,this.position,e);return this.position+=e,t}}])&&U(t.prototype,n),r&&U(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),F={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return 32768&(t=e[t]+(e[t+1]<<8))?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}};function j(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=t.TransferSyntaxUID,r=new V(F,e);return function(){var e=function(){if(r.getSize()<=132&&n)return!1;if(r.seek(128),"DICM"===r.readFixedString(4))return!0;if(!(t||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return r.seek(0),!1}(),o=[],a={};if(!e)return r.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:n}},warnings:o};for(;r.position<r.byteArray.length;){var i=r.position,s=k(r,o);if("x0002ffff"<s.tag){r.position=i;break}s.parser=F,a[s.tag]=s}return(e=new w(r.byteArrayParser,r.byteArray,a)).warnings=r.warnings,e.position=r.position,e}()}var H="1.2.840.10008.1.2.2";function z(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var r,o=function(t){if(void 0===t.elements.x00020010)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return(t=t.elements.x00020010)&&t.Value||y(e,t.dataOffset,t.length)};function a(r){var a="1.2.840.10008.1.2"!==(i=o(r)),i=function(r,o){var a="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);if("1.2.840.10008.1.2.1.99"!==r)return new V(r===H?N:F,e,o);if(t&&t.inflater)return r=t.inflater(e,o),new V(F,r,0);if(1==a){var i=n(0),s=B(e,o,e.length-o);return i=i.inflateRawSync(s),s=R(e,i.length+o),e.copy(s,0,0,o),i.copy(s,o),new V(F,s,0)}if("undefined"==typeof pako)throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return i=e.slice(o),s=pako.inflateRaw(i),(i=R(e,s.length+o)).set(e.slice(0,o),0),i.set(s,o),new V(F,i,0)}(i,r.position);(r=new w(i.byteArrayParser,i.byteArray,{})).warnings=i.warnings;try{(a?L:O)(r,i,i.byteArray.length,t)}catch(i){throw{exception:i,dataSet:r}}return r}return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(r=j(e,t),a(r))}var q=function(e,t,n){for(var r=0,o=t;o<t+n;o++)r+=e[o].length;return r};function W(e,t,n,r,o){if(o=o||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(r=r||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(r<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+r>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var a=new V(e.byteArrayParser,e.byteArray,t.dataOffset);if("xfffee000"!==(t=C(a)).tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";a.seek(t.length);var i=a.position;if(1===r)return B(a.byteArray,i+o[n].offset+8,o[n].length);t=q(o,n,r);for(var s=R(a.byteArray,t),l=0,c=n;c<n+r;c++)for(var u=i+o[c].offset+8,d=0;d<o[c].length;d++)s[l++]=a.byteArray[u++];return s}var G=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},Y=function(e,t,n,r){if(e===t.length-1)return n.length-r;for(var o=t[e+1],a=r+1;a<n.length;a++)if(n[a].offset===o)return a-r;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function Z(e,t,n,r,o){if(r=r||t.basicOffsetTable,o=o||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===r.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=r.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var a=r[n];if(void 0===(a=G(o,a)))throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return W(e,t,a,Y(n,r,o,a),o)}var X=!1;function Q(e,t,n){if(X||(X=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?Z(e,t,n):W(e,t,0,t.fragments.length)}t.default={isStringVr:o,isPrivateTag:a,parsePN:i,parseTM:s,parseDA:c,explicitElementToString:u,explicitDataSetToJS:d,createJPEGBasicOffsetTable:p,parseDicomDataSetExplicit:L,parseDicomDataSetImplicit:O,readFixedString:y,alloc:R,version:_,bigEndianByteArrayParser:N,ByteStream:V,sharedCopy:B,DataSet:w,findAndSetUNElementLength:v,findEndOfEncapsulatedElement:g,findItemDelimitationItemAndSetElementLength:T,littleEndianByteArrayParser:F,parseDicom:z,readDicomElementExplicit:k,readDicomElementImplicit:S,readEncapsulatedImageFrame:Z,readEncapsulatedPixelData:Q,readEncapsulatedPixelDataFromFragments:W,readPart10Header:j,readSequenceItemsExplicit:P,readSequenceItemsImplicit:A,readSequenceItem:C,readTag:m,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],r={},t.m=n,t.c=r,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(t){return e[t]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1);function t(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return n[e].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n,r}(n(3848))},7648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,r=Object.prototype.toString,o="[object Function]";e.exports=function(e){var a=this;if("function"!=typeof a||r.call(a)!==o)throw new TypeError(t+a);for(var i,s=n.call(arguments,1),l=function(){if(this instanceof i){var t=a.apply(this,s.concat(n.call(arguments)));return Object(t)===t?t:this}return a.apply(e,s.concat(n.call(arguments)))},c=Math.max(0,a.length-s.length),u=[],d=0;d<c;d++)u.push("$"+d);if(i=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(l),a.prototype){var f=function(){};f.prototype=a.prototype,i.prototype=new f,f.prototype=null}return i}},8612:(e,t,n)=>{"use strict";var r=n(7648);e.exports=Function.prototype.bind||r},3605:(e,t,n)=>{var r;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(o,a,i,s){"use strict";function l(e,t,n){return setTimeout(h(e,n),t)}function c(e,t,n){return!!Array.isArray(e)&&(u(e,n[t],n),!0)}function u(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function d(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=o.console&&(o.console.warn||o.console.log);return a&&a.call(o.console,r,n),e.apply(this,arguments)}}function f(e,t,n){var r,o=t.prototype;(r=e.prototype=Object.create(o)).constructor=e,r._super=o,n&&se(r,n)}function h(e,t){return function(){return e.apply(t,arguments)}}function p(e,t){return typeof e==ue?e.apply(t&&t[0]||s,t):e}function m(e,t){return e===s?t:e}function g(e,t,n){u(x(t),(function(t){e.addEventListener(t,n,!1)}))}function v(e,t,n){u(x(t),(function(t){e.removeEventListener(t,n,!1)}))}function y(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function b(e,t){return e.indexOf(t)>-1}function x(e){return e.trim().split(/\s+/g)}function w(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function T(e){return Array.prototype.slice.call(e,0)}function I(e,t,n){for(var r=[],o=[],a=0;a<e.length;){var i=t?e[a][t]:e[a];w(o,i)<0&&r.push(e[a]),o[a]=i,a++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function S(e,t){for(var n,r,o=t[0].toUpperCase()+t.slice(1),a=0;a<le.length;){if((r=(n=le[a])?n+o:t)in e)return r;a++}return s}function C(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}function E(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){p(e.options.enable,[e])&&n.handler(t)},this.init()}function A(e,t,n){var r=n.pointers.length,o=n.changedPointers.length,a=t&Ie&&r-o==0,i=t&(Ce|Ee)&&r-o==0;n.isFirst=!!a,n.isFinal=!!i,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,o=r.length;n.firstInput||(n.firstInput=P(t)),o>1&&!n.firstMultiple?n.firstMultiple=P(t):1===o&&(n.firstMultiple=!1);var a=n.firstInput,i=n.firstMultiple,s=i?i.center:a.center,l=t.center=D(r);t.timeStamp=he(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=R(s,l),t.distance=O(s,l),function(e,t){var n=t.center,r=e.offsetDelta||{},o=e.prevDelta||{},a=e.prevInput||{};t.eventType!==Ie&&a.eventType!==Ce||(o=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=o.x+(n.x-r.x),t.deltaY=o.y+(n.y-r.y)}(n,t),t.offsetDirection=L(t.deltaX,t.deltaY);var c=k(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=fe(c.x)>fe(c.y)?c.x:c.y,t.scale=i?function(e,t){return O(t[0],t[1],Ne)/O(e[0],e[1],Ne)}(i.pointers,r):1,t.rotation=i?function(e,t){return R(t[1],t[0],Ne)+R(e[1],e[0],Ne)}(i.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,M(n,t);var u=e.element;y(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function M(e,t){var n,r,o,a,i=e.lastInterval||t,l=t.timeStamp-i.timeStamp;if(t.eventType!=Ee&&(l>Te||i.velocity===s)){var c=t.deltaX-i.deltaX,u=t.deltaY-i.deltaY,d=k(l,c,u);r=d.x,o=d.y,n=fe(d.x)>fe(d.y)?d.x:d.y,a=L(c,u),e.lastInterval=t}else n=i.velocity,r=i.velocityX,o=i.velocityY,a=i.direction;t.velocity=n,t.velocityX=r,t.velocityY=o,t.direction=a}function P(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:de(e.pointers[n].clientX),clientY:de(e.pointers[n].clientY)},n++;return{timeStamp:he(),pointers:t,center:D(t),deltaX:e.deltaX,deltaY:e.deltaY}}function D(e){var t=e.length;if(1===t)return{x:de(e[0].clientX),y:de(e[0].clientY)};for(var n=0,r=0,o=0;t>o;)n+=e[o].clientX,r+=e[o].clientY,o++;return{x:de(n/t),y:de(r/t)}}function k(e,t,n){return{x:t/e||0,y:n/e||0}}function L(e,t){return e===t?Ae:fe(e)>=fe(t)?0>e?Me:Pe:0>t?De:ke}function O(e,t,n){n||(n=_e);var r=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return Math.sqrt(r*r+o*o)}function R(e,t,n){n||(n=_e);var r=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return 180*Math.atan2(o,r)/Math.PI}function _(){this.evEl=Ue,this.evWin=Ve,this.pressed=!1,E.apply(this,arguments)}function N(){this.evEl=He,this.evWin=ze,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function B(){this.evTarget=We,this.evWin=Ge,this.started=!1,E.apply(this,arguments)}function U(e,t){var n=T(e.touches),r=T(e.changedTouches);return t&(Ce|Ee)&&(n=I(n.concat(r),"identifier",!0)),[n,r]}function V(){this.evTarget=Ze,this.targetIds={},E.apply(this,arguments)}function F(e,t){var n=T(e.touches),r=this.targetIds;if(t&(Ie|Se)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var o,a,i=T(e.changedTouches),s=[],l=this.target;if(a=n.filter((function(e){return y(e.target,l)})),t===Ie)for(o=0;o<a.length;)r[a[o].identifier]=!0,o++;for(o=0;o<i.length;)r[i[o].identifier]&&s.push(i[o]),t&(Ce|Ee)&&delete r[i[o].identifier],o++;return s.length?[I(a.concat(s),"identifier",!0),s]:void 0}function j(){E.apply(this,arguments);var e=h(this.handler,this);this.touch=new V(this.manager,e),this.mouse=new _(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function H(e,t){e&Ie?(this.primaryTouch=t.changedPointers[0].identifier,z.call(this,t)):e&(Ce|Ee)&&z.call(this,t)}function z(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),Xe)}}function q(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var o=this.lastTouches[r],a=Math.abs(t-o.x),i=Math.abs(n-o.y);if(Qe>=a&&Qe>=i)return!0}return!1}function W(e,t){this.manager=e,this.set(t)}function G(e){this.options=se({},this.defaults,e||{}),this.id=ge++,this.manager=null,this.options.enable=m(this.options.enable,!0),this.state=it,this.simultaneous={},this.requireFail=[]}function Y(e){return e&dt?"cancel":e&ct?"end":e&lt?"move":e&st?"start":""}function Z(e){return e==ke?"down":e==De?"up":e==Me?"left":e==Pe?"right":""}function X(e,t){var n=t.manager;return n?n.get(e):e}function Q(){G.apply(this,arguments)}function K(){Q.apply(this,arguments),this.pX=null,this.pY=null}function J(){Q.apply(this,arguments)}function $(){G.apply(this,arguments),this._timer=null,this._input=null}function ee(){Q.apply(this,arguments)}function te(){Q.apply(this,arguments)}function ne(){G.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function re(e,t){return(t=t||{}).recognizers=m(t.recognizers,re.defaults.preset),new oe(e,t)}function oe(e,t){this.options=se({},re.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){return new(e.options.inputClass||(ye?N:be?V:ve?j:_))(e,A)}(this),this.touchAction=new W(this,this.options.touchAction),ae(this,!0),u(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function ae(e,t){var n,r=e.element;r.style&&(u(e.options.cssProps,(function(o,a){n=S(r.style,a),t?(e.oldCssProps[n]=r.style[n],r.style[n]=o):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}function ie(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}var se,le=["","webkit","Moz","MS","ms","o"],ce=a.createElement("div"),ue="function",de=Math.round,fe=Math.abs,he=Date.now;se="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t}:Object.assign;var pe=d((function(e,t,n){for(var r=Object.keys(t),o=0;o<r.length;)(!n||n&&e[r[o]]===s)&&(e[r[o]]=t[r[o]]),o++;return e}),"extend","Use `assign`."),me=d((function(e,t){return pe(e,t,!0)}),"merge","Use `assign`."),ge=1,ve="ontouchstart"in o,ye=S(o,"PointerEvent")!==s,be=ve&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),xe="touch",we="mouse",Te=25,Ie=1,Se=2,Ce=4,Ee=8,Ae=1,Me=2,Pe=4,De=8,ke=16,Le=Me|Pe,Oe=De|ke,Re=Le|Oe,_e=["x","y"],Ne=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(C(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(C(this.element),this.evWin,this.domHandler)}};var Be={mousedown:Ie,mousemove:Se,mouseup:Ce},Ue="mousedown",Ve="mousemove mouseup";f(_,E,{handler:function(e){var t=Be[e.type];t&Ie&&0===e.button&&(this.pressed=!0),t&Se&&1!==e.which&&(t=Ce),this.pressed&&(t&Ce&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:we,srcEvent:e}))}});var Fe={pointerdown:Ie,pointermove:Se,pointerup:Ce,pointercancel:Ee,pointerout:Ee},je={2:xe,3:"pen",4:we,5:"kinect"},He="pointerdown",ze="pointermove pointerup pointercancel";o.MSPointerEvent&&!o.PointerEvent&&(He="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel"),f(N,E,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),o=Fe[r],a=je[e.pointerType]||e.pointerType,i=a==xe,s=w(t,e.pointerId,"pointerId");o&Ie&&(0===e.button||i)?0>s&&(t.push(e),s=t.length-1):o&(Ce|Ee)&&(n=!0),0>s||(t[s]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var qe={touchstart:Ie,touchmove:Se,touchend:Ce,touchcancel:Ee},We="touchstart",Ge="touchstart touchmove touchend touchcancel";f(B,E,{handler:function(e){var t=qe[e.type];if(t===Ie&&(this.started=!0),this.started){var n=U.call(this,e,t);t&(Ce|Ee)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:xe,srcEvent:e})}}});var Ye={touchstart:Ie,touchmove:Se,touchend:Ce,touchcancel:Ee},Ze="touchstart touchmove touchend touchcancel";f(V,E,{handler:function(e){var t=Ye[e.type],n=F.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:xe,srcEvent:e})}});var Xe=2500,Qe=25;f(j,E,{handler:function(e,t,n){var r=n.pointerType==xe,o=n.pointerType==we;if(!(o&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)H.call(this,t,n);else if(o&&q.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ke=S(ce.style,"touchAction"),Je=Ke!==s,$e="compute",et="auto",tt="manipulation",nt="none",rt="pan-x",ot="pan-y",at=function(){if(!Je)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||o.CSS.supports("touch-action",n)})),e}();W.prototype={set:function(e){e==$e&&(e=this.compute()),Je&&this.manager.element.style&&at[e]&&(this.manager.element.style[Ke]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return u(this.manager.recognizers,(function(t){p(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(b(e,nt))return nt;var t=b(e,rt),n=b(e,ot);return t&&n?nt:t||n?t?rt:ot:b(e,tt)?tt:et}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(!this.manager.session.prevented){var r=this.actions,o=b(r,nt)&&!at[nt],a=b(r,ot)&&!at[ot],i=b(r,rt)&&!at[rt];if(o){var s=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(s&&l&&c)return}return i&&a?void 0:o||a&&n&Le||i&&n&Oe?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var it=1,st=2,lt=4,ct=8,ut=ct,dt=16,ft=32;G.prototype={defaults:{},set:function(e){return se(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(c(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=X(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return c(e,"dropRecognizeWith",this)||(e=X(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(c(e,"requireFailure",this))return this;var t=this.requireFail;return-1===w(t,e=X(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(c(e,"dropRequireFailure",this))return this;e=X(e,this);var t=w(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,r=this.state;ct>r&&t(n.options.event+Y(r)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),r>=ct&&t(n.options.event+Y(r))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=ft)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ft|it)))return!1;e++}return!0},recognize:function(e){var t=se({},e);return p(this.options.enable,[this,t])?(this.state&(ut|dt|ft)&&(this.state=it),this.state=this.process(t),void(this.state&(st|lt|ct|dt)&&this.tryEmit(t))):(this.reset(),void(this.state=ft))},process:function(e){},getTouchAction:function(){},reset:function(){}},f(Q,G,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=t&(st|lt),o=this.attrTest(e);return r&&(n&Ee||!o)?t|dt:r||o?n&Ce?t|ct:t&st?t|lt:st:ft}}),f(K,Q,{defaults:{event:"pan",threshold:10,pointers:1,direction:Re},getTouchAction:function(){var e=this.options.direction,t=[];return e&Le&&t.push(ot),e&Oe&&t.push(rt),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,o=e.direction,a=e.deltaX,i=e.deltaY;return o&t.direction||(t.direction&Le?(o=0===a?Ae:0>a?Me:Pe,n=a!=this.pX,r=Math.abs(e.deltaX)):(o=0===i?Ae:0>i?De:ke,n=i!=this.pY,r=Math.abs(e.deltaY))),e.direction=o,n&&r>t.threshold&&o&t.direction},attrTest:function(e){return Q.prototype.attrTest.call(this,e)&&(this.state&st||!(this.state&st)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Z(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),f(J,Q,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&st)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),f($,G,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[et]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,o=e.deltaTime>t.time;if(this._input=e,!r||!n||e.eventType&(Ce|Ee)&&!o)this.reset();else if(e.eventType&Ie)this.reset(),this._timer=l((function(){this.state=ut,this.tryEmit()}),t.time,this);else if(e.eventType&Ce)return ut;return ft},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ut&&(e&&e.eventType&Ce?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=he(),this.manager.emit(this.options.event,this._input)))}}),f(ee,Q,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&st)}}),f(te,Q,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Le|Oe,pointers:1},getTouchAction:function(){return K.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Le|Oe)?t=e.overallVelocity:n&Le?t=e.overallVelocityX:n&Oe&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&fe(t)>this.options.velocity&&e.eventType&Ce},emit:function(e){var t=Z(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),f(ne,G,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[tt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&Ie&&0===this.count)return this.failTimeout();if(r&&o&&n){if(e.eventType!=Ce)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||O(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,i&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=l((function(){this.state=ut,this.tryEmit()}),t.interval,this),st):ut}return ft},failTimeout:function(){return this._timer=l((function(){this.state=ft}),this.options.interval,this),ft},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),re.VERSION="2.0.7",re.defaults={domEvents:!1,touchAction:$e,enable:!0,inputTarget:null,inputClass:null,preset:[[ee,{enable:!1}],[J,{enable:!1},["rotate"]],[te,{direction:Le}],[K,{direction:Le},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[$]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};oe.prototype={set:function(e){return se(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,r=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&ut)&&(o=t.curRecognizer=null);for(var a=0;a<r.length;)n=r[a],2===t.stopped||o&&n!=o&&!n.canRecognizeWith(o)?n.reset():n.recognize(e),!o&&n.state&(st|lt|ct)&&(o=t.curRecognizer=n),a++}},get:function(e){if(e instanceof G)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(c(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(c(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=w(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return u(x(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==s){var n=this.handlers;return u(x(e),(function(e){t?n[e]&&n[e].splice(w(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&ie(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&ae(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},se(re,{INPUT_START:Ie,INPUT_MOVE:Se,INPUT_END:Ce,INPUT_CANCEL:Ee,STATE_POSSIBLE:it,STATE_BEGAN:st,STATE_CHANGED:lt,STATE_ENDED:ct,STATE_RECOGNIZED:ut,STATE_CANCELLED:dt,STATE_FAILED:ft,DIRECTION_NONE:Ae,DIRECTION_LEFT:Me,DIRECTION_RIGHT:Pe,DIRECTION_UP:De,DIRECTION_DOWN:ke,DIRECTION_HORIZONTAL:Le,DIRECTION_VERTICAL:Oe,DIRECTION_ALL:Re,Manager:oe,Input:E,TouchAction:W,TouchInput:V,MouseInput:_,PointerEventInput:N,TouchMouseInput:j,SingleTouchInput:B,Recognizer:G,AttrRecognizer:Q,Tap:ne,Pan:K,Swipe:te,Pinch:J,Rotate:ee,Press:$,on:g,off:v,each:u,merge:me,extend:pe,assign:se,inherit:f,bindFn:h,prefixed:S}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=re,void 0===(r=function(){return re}.call(t,n,t,e))||(e.exports=r)}(window,document)},1405:(e,t,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,o=n(5419);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&o())))}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},7642:(e,t,n)=>{"use strict";var r=n(8612);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},1077:function(e,t,n){var r,o,a;void 0!==n.g?n.g:window||this.window||this.global,o=[],r=function(e){"use strict";var t={},n="iziToast",r=(document.querySelector("body"),!!/Mobi/.test(navigator.userAgent)),o=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),a="undefined"!=typeof InstallTrigger,i="ontouchstart"in document.documentElement,s=["bottomRight","bottomLeft","bottomCenter","topRight","topLeft","topCenter","center"],l={info:{color:"blue",icon:"ico-info"},success:{color:"green",icon:"ico-success"},warning:{color:"orange",icon:"ico-warning"},error:{color:"red",icon:"ico-error"},question:{color:"yellow",icon:"ico-question"}},c=568,u={};t.children={};var d={id:null,class:"",title:"",titleColor:"",titleSize:"",titleLineHeight:"",message:"",messageColor:"",messageSize:"",messageLineHeight:"",backgroundColor:"",theme:"light",color:"",icon:"",iconText:"",iconColor:"",iconUrl:null,image:"",imageWidth:50,maxWidth:null,zindex:null,layout:1,balloon:!1,close:!0,closeOnEscape:!1,closeOnClick:!1,displayMode:0,position:"bottomRight",target:"",targetFirst:!0,timeout:5e3,rtl:!1,animateInside:!0,drag:!0,pauseOnHover:!0,resetOnHover:!1,progressBar:!0,progressBarColor:"",progressBarEasing:"linear",overlay:!1,overlayClose:!1,overlayColor:"rgba(0, 0, 0, 0.6)",transitionIn:"fadeInUp",transitionOut:"fadeOut",transitionInMobile:"fadeInUp",transitionOutMobile:"fadeOutDown",buttons:{},inputs:{},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){}};if("remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),"function"!=typeof window.CustomEvent){var f=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};f.prototype=window.Event.prototype,window.CustomEvent=f}var h=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(n,e[r],r,e);else if(e)for(var o=0,a=e.length;a>o;o++)t.call(n,e[o],o,e)},p=function(e,t){var n={};return h(e,(function(t,r){n[r]=e[r]})),h(t,(function(e,r){n[r]=t[r]})),n},m=function(e){var t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.firstChild);return t},g=function(e){return btoa(encodeURIComponent(e)).replace(/=/g,"")},v=function(e){return"#"==e.substring(0,1)||"rgb"==e.substring(0,3)||"hsl"==e.substring(0,3)},y=function(e){try{return btoa(atob(e))==e}catch(e){return!1}},b={move:function(e,t,r,i){var s,l=.3,c=180;0!==i&&(e.classList.add(n+"-dragged"),e.style.transform="translateX("+i+"px)",i>0?l>(s=(c-i)/c)&&t.hide(p(r,{transitionOut:"fadeOutRight",transitionOutMobile:"fadeOutRight"}),e,"drag"):l>(s=(c+i)/c)&&t.hide(p(r,{transitionOut:"fadeOutLeft",transitionOutMobile:"fadeOutLeft"}),e,"drag"),e.style.opacity=s,l>s&&((o||a)&&(e.style.left=i+"px"),e.parentNode.style.opacity=l,this.stopMoving(e,null)))},startMoving:function(e,t,n,r){r=r||window.event;var o=i?r.touches[0].clientX:r.clientX,a=e.style.transform.replace("px)",""),s=o-(a=a.replace("translateX(",""));n.transitionIn&&e.classList.remove(n.transitionIn),n.transitionInMobile&&e.classList.remove(n.transitionInMobile),e.style.transition="",i?document.ontouchmove=function(r){r.preventDefault();var o=(r=r||window.event).touches[0].clientX-s;b.move(e,t,n,o)}:document.onmousemove=function(r){r.preventDefault();var o=(r=r||window.event).clientX-s;b.move(e,t,n,o)}},stopMoving:function(e,t){i?document.ontouchmove=function(){}:document.onmousemove=function(){},e.style.opacity="",e.style.transform="",e.classList.contains(n+"-dragged")&&(e.classList.remove(n+"-dragged"),e.style.transition="transform 0.4s ease, opacity 0.4s ease",setTimeout((function(){e.style.transition=""}),400))}};return t.setSetting=function(e,n,r){t.children[e][n]=r},t.getSetting=function(e,n){return t.children[e][n]},t.destroy=function(){h(document.querySelectorAll("."+n+"-overlay"),(function(e,t){e.remove()})),h(document.querySelectorAll("."+n+"-wrapper"),(function(e,t){e.remove()})),h(document.querySelectorAll("."+n),(function(e,t){e.remove()})),this.children={},document.removeEventListener(n+"-opened",{},!1),document.removeEventListener(n+"-opening",{},!1),document.removeEventListener(n+"-closing",{},!1),document.removeEventListener(n+"-closed",{},!1),document.removeEventListener("keyup",{},!1),u={}},t.settings=function(e){t.destroy(),u=e,d=p(d,e||{})},h(l,(function(e,n){t[n]=function(t){var n=p(u,t||{});n=p(e,n||{}),this.show(n)}})),t.progress=function(e,t,r){var o=this,a=t.getAttribute("data-iziToast-ref"),i=p(this.children[a],e||{}),s=t.querySelector("."+n+"-progressbar div");return{start:function(){void 0===i.time.REMAINING&&(t.classList.remove(n+"-reseted"),null!==s&&(s.style.transition="width "+i.timeout+"ms "+i.progressBarEasing,s.style.width="0%"),i.time.START=(new Date).getTime(),i.time.END=i.time.START+i.timeout,i.time.TIMER=setTimeout((function(){clearTimeout(i.time.TIMER),t.classList.contains(n+"-closing")||(o.hide(i,t,"timeout"),"function"==typeof r&&r.apply(o))}),i.timeout),o.setSetting(a,"time",i.time))},pause:function(){if(void 0!==i.time.START&&!t.classList.contains(n+"-paused")&&!t.classList.contains(n+"-reseted")){if(t.classList.add(n+"-paused"),i.time.REMAINING=i.time.END-(new Date).getTime(),clearTimeout(i.time.TIMER),o.setSetting(a,"time",i.time),null!==s){var e=window.getComputedStyle(s).getPropertyValue("width");s.style.transition="none",s.style.width=e}"function"==typeof r&&setTimeout((function(){r.apply(o)}),10)}},resume:function(){void 0!==i.time.REMAINING?(t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="width "+i.time.REMAINING+"ms "+i.progressBarEasing,s.style.width="0%"),i.time.END=(new Date).getTime()+i.time.REMAINING,i.time.TIMER=setTimeout((function(){clearTimeout(i.time.TIMER),t.classList.contains(n+"-closing")||(o.hide(i,t,"timeout"),"function"==typeof r&&r.apply(o))}),i.time.REMAINING),o.setSetting(a,"time",i.time)):this.start()},reset:function(){clearTimeout(i.time.TIMER),delete i.time.REMAINING,o.setSetting(a,"time",i.time),t.classList.add(n+"-reseted"),t.classList.remove(n+"-paused"),null!==s&&(s.style.transition="none",s.style.width="100%"),"function"==typeof r&&setTimeout((function(){r.apply(o)}),10)}}},t.hide=function(e,t,o){"object"!=typeof t&&(t=document.querySelector(t));var a=this,i=p(this.children[t.getAttribute("data-iziToast-ref")],e||{});i.closedBy=o||null,delete i.time.REMAINING,t.classList.add(n+"-closing"),function(){var e=document.querySelector("."+n+"-overlay");if(null!==e){var t=e.getAttribute("data-iziToast-ref"),r=(t=t.split(",")).indexOf(String(i.ref));-1!==r&&t.splice(r,1),e.setAttribute("data-iziToast-ref",t.join()),0===t.length&&(e.classList.remove("fadeIn"),e.classList.add("fadeOut"),setTimeout((function(){e.remove()}),700))}}(),i.transitionIn&&t.classList.remove(i.transitionIn),i.transitionInMobile&&t.classList.remove(i.transitionInMobile),r||window.innerWidth<=c?i.transitionOutMobile&&t.classList.add(i.transitionOutMobile):i.transitionOut&&t.classList.add(i.transitionOut);var s=t.parentNode.offsetHeight;t.parentNode.style.height=s+"px",t.style.pointerEvents="none",(!r||window.innerWidth>c)&&(t.parentNode.style.transitionDelay="0.2s");try{var l=new CustomEvent(n+"-closing",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(l)}catch(e){console.warn(e)}setTimeout((function(){t.parentNode.style.height="0px",t.parentNode.style.overflow="",setTimeout((function(){delete a.children[i.ref],t.parentNode.remove();try{var e=new CustomEvent(n+"-closed",{detail:i,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}void 0!==i.onClosed&&i.onClosed.apply(null,[i,t,o])}),1e3)}),200),void 0!==i.onClosing&&i.onClosing.apply(null,[i,t,o])},t.show=function(e){var o=this,a=p(u,e||{});if((a=p(d,a)).time={},null===a.id&&(a.id=g(a.title+a.message+a.color)),1===a.displayMode||"once"==a.displayMode)try{if(document.querySelectorAll("."+n+"#"+a.id).length>0)return!1}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+a.id+". Try to set an valid id.")}if(2===a.displayMode||"replace"==a.displayMode)try{h(document.querySelectorAll("."+n+"#"+a.id),(function(e,t){o.hide(a,e,"replaced")}))}catch(e){console.warn("["+n+"] Could not find an element with this selector: #"+a.id+". Try to set an valid id.")}a.ref=(new Date).getTime()+Math.floor(1e7*Math.random()+1),t.children[a.ref]=a;var l,f={body:document.querySelector("body"),overlay:document.createElement("div"),toast:document.createElement("div"),toastBody:document.createElement("div"),toastTexts:document.createElement("div"),toastCapsule:document.createElement("div"),cover:document.createElement("div"),buttons:document.createElement("div"),inputs:document.createElement("div"),icon:a.iconUrl?document.createElement("img"):document.createElement("i"),wrapper:null};f.toast.setAttribute("data-iziToast-ref",a.ref),f.toast.appendChild(f.toastBody),f.toastCapsule.appendChild(f.toast),function(){if(f.toast.classList.add(n),f.toast.classList.add(n+"-opening"),f.toastCapsule.classList.add(n+"-capsule"),f.toastBody.classList.add(n+"-body"),f.toastTexts.classList.add(n+"-texts"),r||window.innerWidth<=c?a.transitionInMobile&&f.toast.classList.add(a.transitionInMobile):a.transitionIn&&f.toast.classList.add(a.transitionIn),a.class){var e=a.class.split(" ");h(e,(function(e,t){f.toast.classList.add(e)}))}a.id&&(f.toast.id=a.id),a.rtl&&(f.toast.classList.add(n+"-rtl"),f.toast.setAttribute("dir","rtl")),a.layout>1&&f.toast.classList.add(n+"-layout"+a.layout),a.balloon&&f.toast.classList.add(n+"-balloon"),a.maxWidth&&(isNaN(a.maxWidth)?f.toast.style.maxWidth=a.maxWidth:f.toast.style.maxWidth=a.maxWidth+"px"),""===a.theme&&"light"===a.theme||f.toast.classList.add(n+"-theme-"+a.theme),a.color&&(v(a.color)?f.toast.style.background=a.color:f.toast.classList.add(n+"-color-"+a.color)),a.backgroundColor&&(f.toast.style.background=a.backgroundColor,a.balloon&&(f.toast.style.borderColor=a.backgroundColor))}(),a.image&&(f.cover.classList.add(n+"-cover"),f.cover.style.width=a.imageWidth+"px",y(a.image.replace(/ /g,""))?f.cover.style.backgroundImage="url(data:image/png;base64,"+a.image.replace(/ /g,"")+")":f.cover.style.backgroundImage="url("+a.image+")",a.rtl?f.toastBody.style.marginRight=a.imageWidth+10+"px":f.toastBody.style.marginLeft=a.imageWidth+10+"px",f.toast.appendChild(f.cover)),a.close?(f.buttonClose=document.createElement("button"),f.buttonClose.type="button",f.buttonClose.classList.add(n+"-close"),f.buttonClose.addEventListener("click",(function(e){e.target,o.hide(a,f.toast,"button")})),f.toast.appendChild(f.buttonClose)):a.rtl?f.toast.style.paddingLeft="18px":f.toast.style.paddingRight="18px",a.progressBar&&(f.progressBar=document.createElement("div"),f.progressBarDiv=document.createElement("div"),f.progressBar.classList.add(n+"-progressbar"),f.progressBarDiv.style.background=a.progressBarColor,f.progressBar.appendChild(f.progressBarDiv),f.toast.appendChild(f.progressBar)),a.timeout&&(a.pauseOnHover&&!a.resetOnHover&&(f.toast.addEventListener("mouseenter",(function(e){o.progress(a,f.toast).pause()})),f.toast.addEventListener("mouseleave",(function(e){o.progress(a,f.toast).resume()}))),a.resetOnHover&&(f.toast.addEventListener("mouseenter",(function(e){o.progress(a,f.toast).reset()})),f.toast.addEventListener("mouseleave",(function(e){o.progress(a,f.toast).start()})))),a.iconUrl?(f.icon.setAttribute("class",n+"-icon"),f.icon.setAttribute("src",a.iconUrl)):a.icon&&(f.icon.setAttribute("class",n+"-icon "+a.icon),a.iconText&&f.icon.appendChild(document.createTextNode(a.iconText)),a.iconColor&&(f.icon.style.color=a.iconColor)),(a.icon||a.iconUrl)&&(a.rtl?f.toastBody.style.paddingRight="33px":f.toastBody.style.paddingLeft="33px",f.toastBody.appendChild(f.icon)),a.title.length>0&&(f.strong=document.createElement("strong"),f.strong.classList.add(n+"-title"),f.strong.appendChild(m(a.title)),f.toastTexts.appendChild(f.strong),a.titleColor&&(f.strong.style.color=a.titleColor),a.titleSize&&(isNaN(a.titleSize)?f.strong.style.fontSize=a.titleSize:f.strong.style.fontSize=a.titleSize+"px"),a.titleLineHeight&&(isNaN(a.titleSize)?f.strong.style.lineHeight=a.titleLineHeight:f.strong.style.lineHeight=a.titleLineHeight+"px")),a.message.length>0&&(f.p=document.createElement("p"),f.p.classList.add(n+"-message"),f.p.appendChild(m(a.message)),f.toastTexts.appendChild(f.p),a.messageColor&&(f.p.style.color=a.messageColor),a.messageSize&&(isNaN(a.titleSize)?f.p.style.fontSize=a.messageSize:f.p.style.fontSize=a.messageSize+"px"),a.messageLineHeight&&(isNaN(a.titleSize)?f.p.style.lineHeight=a.messageLineHeight:f.p.style.lineHeight=a.messageLineHeight+"px")),a.title.length>0&&a.message.length>0&&(a.rtl?f.strong.style.marginLeft="10px":2===a.layout||a.rtl||(f.strong.style.marginRight="10px")),f.toastBody.appendChild(f.toastTexts),a.inputs.length>0&&(f.inputs.classList.add(n+"-inputs"),h(a.inputs,(function(e,t){f.inputs.appendChild(m(e[0])),(l=f.inputs.childNodes)[t].classList.add(n+"-inputs-child"),e[3]&&setTimeout((function(){l[t].focus()}),300),l[t].addEventListener(e[1],(function(t){return(0,e[2])(o,f.toast,this,t)}))})),f.toastBody.appendChild(f.inputs)),a.buttons.length>0&&(f.buttons.classList.add(n+"-buttons"),h(a.buttons,(function(e,t){f.buttons.appendChild(m(e[0]));var r=f.buttons.childNodes;r[t].classList.add(n+"-buttons-child"),e[2]&&setTimeout((function(){r[t].focus()}),300),r[t].addEventListener("click",(function(t){return t.preventDefault(),(0,e[1])(o,f.toast,this,t,l)}))}))),f.toastBody.appendChild(f.buttons),a.message.length>0&&(a.inputs.length>0||a.buttons.length>0)&&(f.p.style.marginBottom="0"),(a.inputs.length>0||a.buttons.length>0)&&(a.rtl?f.toastTexts.style.marginLeft="10px":f.toastTexts.style.marginRight="10px",a.inputs.length>0&&a.buttons.length>0&&(a.rtl?f.inputs.style.marginLeft="8px":f.inputs.style.marginRight="8px")),f.toastCapsule.style.visibility="hidden",setTimeout((function(){var e=f.toast.offsetHeight,t=f.toast.currentStyle||window.getComputedStyle(f.toast),n=t.marginTop;n=n.split("px"),n=parseInt(n[0]);var r=t.marginBottom;r=r.split("px"),r=parseInt(r[0]),f.toastCapsule.style.visibility="",f.toastCapsule.style.height=e+r+n+"px",setTimeout((function(){f.toastCapsule.style.height="auto",a.target&&(f.toastCapsule.style.overflow="visible")}),500),a.timeout&&o.progress(a,f.toast).start()}),100),function(){var e=a.position;if(a.target)f.wrapper=document.querySelector(a.target),f.wrapper.classList.add(n+"-target"),a.targetFirst?f.wrapper.insertBefore(f.toastCapsule,f.wrapper.firstChild):f.wrapper.appendChild(f.toastCapsule);else{if(-1==s.indexOf(a.position))return void console.warn("["+n+"] Incorrect position.\nIt can be › "+s);e=r||window.innerWidth<=c?"bottomLeft"==a.position||"bottomRight"==a.position||"bottomCenter"==a.position?n+"-wrapper-bottomCenter":"topLeft"==a.position||"topRight"==a.position||"topCenter"==a.position?n+"-wrapper-topCenter":n+"-wrapper-center":n+"-wrapper-"+e,f.wrapper=document.querySelector("."+n+"-wrapper."+e),f.wrapper||(f.wrapper=document.createElement("div"),f.wrapper.classList.add(n+"-wrapper"),f.wrapper.classList.add(e),document.body.appendChild(f.wrapper)),"topLeft"==a.position||"topCenter"==a.position||"topRight"==a.position?f.wrapper.insertBefore(f.toastCapsule,f.wrapper.firstChild):f.wrapper.appendChild(f.toastCapsule)}isNaN(a.zindex)?console.warn("["+n+"] Invalid zIndex."):f.wrapper.style.zIndex=a.zindex}(),a.overlay&&(null!==document.querySelector("."+n+"-overlay.fadeIn")?(f.overlay=document.querySelector("."+n+"-overlay"),f.overlay.setAttribute("data-iziToast-ref",f.overlay.getAttribute("data-iziToast-ref")+","+a.ref),isNaN(a.zindex)||null===a.zindex||(f.overlay.style.zIndex=a.zindex-1)):(f.overlay.classList.add(n+"-overlay"),f.overlay.classList.add("fadeIn"),f.overlay.style.background=a.overlayColor,f.overlay.setAttribute("data-iziToast-ref",a.ref),isNaN(a.zindex)||null===a.zindex||(f.overlay.style.zIndex=a.zindex-1),document.querySelector("body").appendChild(f.overlay)),a.overlayClose?(f.overlay.removeEventListener("click",{}),f.overlay.addEventListener("click",(function(e){o.hide(a,f.toast,"overlay")}))):f.overlay.removeEventListener("click",{})),function(){if(a.animateInside){f.toast.classList.add(n+"-animateInside");var e=[200,100,300];"bounceInLeft"!=a.transitionIn&&"bounceInRight"!=a.transitionIn||(e=[400,200,400]),a.title.length>0&&setTimeout((function(){f.strong.classList.add("slideIn")}),e[0]),a.message.length>0&&setTimeout((function(){f.p.classList.add("slideIn")}),e[1]),(a.icon||a.iconUrl)&&setTimeout((function(){f.icon.classList.add("revealIn")}),e[2]);var t=150;a.buttons.length>0&&f.buttons&&setTimeout((function(){h(f.buttons.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150}))}),a.inputs.length>0?150:0),a.inputs.length>0&&f.inputs&&(t=150,h(f.inputs.childNodes,(function(e,n){setTimeout((function(){e.classList.add("revealIn")}),t),t+=150})))}}(),a.onOpening.apply(null,[a,f.toast]);try{var x=new CustomEvent(n+"-opening",{detail:a,bubbles:!0,cancelable:!0});document.dispatchEvent(x)}catch(e){console.warn(e)}setTimeout((function(){f.toast.classList.remove(n+"-opening"),f.toast.classList.add(n+"-opened");try{var e=new CustomEvent(n+"-opened",{detail:a,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}catch(e){console.warn(e)}a.onOpened.apply(null,[a,f.toast])}),1e3),a.drag&&(i?(f.toast.addEventListener("touchstart",(function(e){b.startMoving(this,o,a,e)}),!1),f.toast.addEventListener("touchend",(function(e){b.stopMoving(this,e)}),!1)):(f.toast.addEventListener("mousedown",(function(e){e.preventDefault(),b.startMoving(this,o,a,e)}),!1),f.toast.addEventListener("mouseup",(function(e){e.preventDefault(),b.stopMoving(this,e)}),!1))),a.closeOnEscape&&document.addEventListener("keyup",(function(e){27==(e=e||window.event).keyCode&&o.hide(a,f.toast,"esc")})),a.closeOnClick&&f.toast.addEventListener("click",(function(e){o.hide(a,f.toast,"toast")})),o.toast=f.toast},t}(),void 0===(a="function"==typeof r?r.apply(t,o):r)||(e.exports=a)},4865:function(e,t,n){var r,o;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */r=function(){var e,t,n={version:"0.2.0"},r=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function o(e,t,n){return e<t?t:e>n?n:e}function a(e){return 100*(-1+e)}function i(e,t,n){var o;return(o="translate3d"===r.positionUsing?{transform:"translate3d("+a(e)+"%,0,0)"}:"translate"===r.positionUsing?{transform:"translate("+a(e)+"%,0)"}:{"margin-left":a(e)+"%"}).transition="all "+t+"ms "+n,o}n.configure=function(e){var t,n;for(t in e)void 0!==(n=e[t])&&e.hasOwnProperty(t)&&(r[t]=n);return this},n.status=null,n.set=function(e){var t=n.isStarted();e=o(e,r.minimum,1),n.status=1===e?null:e;var a=n.render(!t),c=a.querySelector(r.barSelector),u=r.speed,d=r.easing;return a.offsetWidth,s((function(t){""===r.positionUsing&&(r.positionUsing=n.getPositioningCSS()),l(c,i(e,u,d)),1===e?(l(a,{transition:"none",opacity:1}),a.offsetWidth,setTimeout((function(){l(a,{transition:"all "+u+"ms linear",opacity:0}),setTimeout((function(){n.remove(),t()}),u)}),u)):setTimeout(t,u)})),this},n.isStarted=function(){return"number"==typeof n.status},n.start=function(){n.status||n.set(0);var e=function(){setTimeout((function(){n.status&&(n.trickle(),e())}),r.trickleSpeed)};return r.trickle&&e(),this},n.done=function(e){return e||n.status?n.inc(.3+.5*Math.random()).set(1):this},n.inc=function(e){var t=n.status;return t?("number"!=typeof e&&(e=(1-t)*o(Math.random()*t,.1,.95)),t=o(t+e,0,.994),n.set(t)):n.start()},n.trickle=function(){return n.inc(Math.random()*r.trickleRate)},e=0,t=0,n.promise=function(r){return r&&"resolved"!==r.state()?(0===t&&n.start(),e++,t++,r.always((function(){0==--t?(e=0,n.done()):n.set((e-t)/e)})),this):this},n.render=function(e){if(n.isRendered())return document.getElementById("nprogress");u(document.documentElement,"nprogress-busy");var t=document.createElement("div");t.id="nprogress",t.innerHTML=r.template;var o,i=t.querySelector(r.barSelector),s=e?"-100":a(n.status||0),c=document.querySelector(r.parent);return l(i,{transition:"all 0 linear",transform:"translate3d("+s+"%,0,0)"}),r.showSpinner||(o=t.querySelector(r.spinnerSelector))&&h(o),c!=document.body&&u(c,"nprogress-custom-parent"),c.appendChild(t),t},n.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(r.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&h(e)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"};var s=function(){var e=[];function t(){var n=e.shift();n&&n(t)}return function(n){e.push(n),1==e.length&&t()}}(),l=function(){var e=["Webkit","O","Moz","ms"],t={};function n(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()}))}function r(t){var n=document.body.style;if(t in n)return t;for(var r,o=e.length,a=t.charAt(0).toUpperCase()+t.slice(1);o--;)if((r=e[o]+a)in n)return r;return t}function o(e){return e=n(e),t[e]||(t[e]=r(e))}function a(e,t,n){t=o(t),e.style[t]=n}return function(e,t){var n,r,o=arguments;if(2==o.length)for(n in t)void 0!==(r=t[n])&&t.hasOwnProperty(n)&&a(e,n,r);else a(e,o[1],o[2])}}();function c(e,t){return("string"==typeof e?e:f(e)).indexOf(" "+t+" ")>=0}function u(e,t){var n=f(e),r=n+t;c(n,t)||(e.className=r.substring(1))}function d(e,t){var n,r=f(e);c(e,t)&&(n=r.replace(" "+t+" "," "),e.className=n.substring(1,n.length-1))}function f(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function h(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return n},void 0===(o="function"==typeof r?r.call(t,n,t,e):r)||(e.exports=o)},631:(e,t,n)=>{var r="function"==typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,a=r&&o&&"function"==typeof o.get?o.get:null,i=r&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&l&&"function"==typeof l.get?l.get:null,u=s&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,f="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,h="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,v=String.prototype.match,y=String.prototype.slice,b=String.prototype.replace,x=String.prototype.toUpperCase,w=String.prototype.toLowerCase,T=RegExp.prototype.test,I=Array.prototype.concat,S=Array.prototype.join,C=Array.prototype.slice,E=Math.floor,A="function"==typeof BigInt?BigInt.prototype.valueOf:null,M=Object.getOwnPropertySymbols,P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,D="function"==typeof Symbol&&"object"==typeof Symbol.iterator,k="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===D||"symbol")?Symbol.toStringTag:null,L=Object.prototype.propertyIsEnumerable,O=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||T.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-E(-e):E(e);if(r!==e){var o=String(r),a=y.call(t,o.length+1);return b.call(o,n,"$&_")+"."+b.call(b.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var _=n(4654).custom,N=_&&F(_)?_:null;function B(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function U(e){return b.call(String(e),/"/g,"&quot;")}function V(e){return!("[object Array]"!==z(e)||k&&"object"==typeof e&&k in e)}function F(e){if(D)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!P)return!1;try{return P.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,r,o){var s=n||{};if(H(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(H(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!H(s,"customInspect")||s.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(H(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(H(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var m=s.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return W(t,s);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var x=String(t);return m?R(t,x):x}if("bigint"==typeof t){var T=String(t)+"n";return m?R(t,T):T}var E=void 0===s.depth?5:s.depth;if(void 0===r&&(r=0),r>=E&&E>0&&"object"==typeof t)return V(t)?"[Array]":"[Object]";var M=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=S.call(Array(e.indent+1)," ")}return{base:n,prev:S.call(Array(t+1),n)}}(s,r);if(void 0===o)o=[];else if(q(o,t)>=0)return"[Circular]";function _(t,n,a){if(n&&(o=C.call(o)).push(n),a){var i={depth:s.depth};return H(s,"quoteStyle")&&(i.quoteStyle=s.quoteStyle),e(t,i,r+1,o)}return e(t,s,r+1,o)}if("function"==typeof t){var j=function(e){if(e.name)return e.name;var t=v.call(g.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),G=K(t,_);return"[Function"+(j?": "+j:" (anonymous)")+"]"+(G.length>0?" { "+S.call(G,", ")+" }":"")}if(F(t)){var J=D?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):P.call(t);return"object"!=typeof t||D?J:Y(J)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var $="<"+w.call(String(t.nodeName)),ee=t.attributes||[],te=0;te<ee.length;te++)$+=" "+ee[te].name+"="+B(U(ee[te].value),"double",s);return $+=">",t.childNodes&&t.childNodes.length&&($+="..."),$+="</"+w.call(String(t.nodeName))+">"}if(V(t)){if(0===t.length)return"[]";var ne=K(t,_);return M&&!function(e){for(var t=0;t<e.length;t++)if(q(e[t],"\n")>=0)return!1;return!0}(ne)?"["+Q(ne,M)+"]":"[ "+S.call(ne,", ")+" ]"}if(function(e){return!("[object Error]"!==z(e)||k&&"object"==typeof e&&k in e)}(t)){var re=K(t,_);return"cause"in t&&!L.call(t,"cause")?"{ ["+String(t)+"] "+S.call(I.call("[cause]: "+_(t.cause),re),", ")+" }":0===re.length?"["+String(t)+"]":"{ ["+String(t)+"] "+S.call(re,", ")+" }"}if("object"==typeof t&&l){if(N&&"function"==typeof t[N])return t[N]();if("symbol"!==l&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!a||!e||"object"!=typeof e)return!1;try{a.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var oe=[];return i.call(t,(function(e,n){oe.push(_(n,t,!0)+" => "+_(e,t))})),X("Map",a.call(t),oe,M)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{a.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ae=[];return u.call(t,(function(e){ae.push(_(e,t))})),X("Set",c.call(t),ae,M)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{f.call(e,f)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return Z("WeakMap");if(function(e){if(!f||!e||"object"!=typeof e)return!1;try{f.call(e,f);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return Z("WeakSet");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{return h.call(e),!0}catch(e){}return!1}(t))return Z("WeakRef");if(function(e){return!("[object Number]"!==z(e)||k&&"object"==typeof e&&k in e)}(t))return Y(_(Number(t)));if(function(e){if(!e||"object"!=typeof e||!A)return!1;try{return A.call(e),!0}catch(e){}return!1}(t))return Y(_(A.call(t)));if(function(e){return!("[object Boolean]"!==z(e)||k&&"object"==typeof e&&k in e)}(t))return Y(p.call(t));if(function(e){return!("[object String]"!==z(e)||k&&"object"==typeof e&&k in e)}(t))return Y(_(String(t)));if(!function(e){return!("[object Date]"!==z(e)||k&&"object"==typeof e&&k in e)}(t)&&!function(e){return!("[object RegExp]"!==z(e)||k&&"object"==typeof e&&k in e)}(t)){var ie=K(t,_),se=O?O(t)===Object.prototype:t instanceof Object||t.constructor===Object,le=t instanceof Object?"":"null prototype",ce=!se&&k&&Object(t)===t&&k in t?y.call(z(t),8,-1):le?"Object":"",ue=(se||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(ce||le?"["+S.call(I.call([],ce||[],le||[]),": ")+"] ":"");return 0===ie.length?ue+"{}":M?ue+"{"+Q(ie,M)+"}":ue+"{ "+S.call(ie,", ")+" }"}return String(t)};var j=Object.prototype.hasOwnProperty||function(e){return e in this};function H(e,t){return j.call(e,t)}function z(e){return m.call(e)}function q(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function W(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return W(y.call(e,0,t.maxStringLength),t)+r}return B(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,G),"single",t)}function G(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+x.call(t.toString(16))}function Y(e){return"Object("+e+")"}function Z(e){return e+" { ? }"}function X(e,t,n,r){return e+" ("+t+") {"+(r?Q(n,r):S.call(n,", "))+"}"}function Q(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+S.call(e,","+n)+"\n"+t.prev}function K(e,t){var n=V(e),r=[];if(n){r.length=e.length;for(var o=0;o<e.length;o++)r[o]=H(e,o)?t(e[o],e):""}var a,i="function"==typeof M?M(e):[];if(D){a={};for(var s=0;s<i.length;s++)a["$"+i[s]]=i[s]}for(var l in e)H(e,l)&&(n&&String(Number(l))===l&&l<e.length||D&&a["$"+l]instanceof Symbol||(T.call(/[^\w$]/,l)?r.push(t(l,e)+": "+t(e[l],e)):r.push(l+": "+t(e[l],e))));if("function"==typeof M)for(var c=0;c<i.length;c++)L.call(e,i[c])&&r.push("["+t(i[c])+"]: "+t(e[i[c]],e));return r}},5798:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,r="RFC1738",o="RFC3986";e.exports={default:o,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:r,RFC3986:o}},129:(e,t,n)=>{"use strict";var r=n(8261),o=n(5235),a=n(5798);e.exports={formats:a,parse:o,stringify:r}},5235:(e,t,n)=>{"use strict";var r=n(2769),o=Object.prototype.hasOwnProperty,a=Array.isArray,i={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,r){if(e){var a=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(a),c=s?a.slice(0,s.index):a,u=[];if(c){if(!n.plainObjects&&o.call(Object.prototype,c)&&!n.allowPrototypes)return;u.push(c)}for(var d=0;n.depth>0&&null!==(s=i.exec(a))&&d<n.depth;){if(d+=1,!n.plainObjects&&o.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+a.slice(s.index)+"]"),function(e,t,n,r){for(var o=r?t:l(t,n),a=e.length-1;a>=0;--a){var i,s=e[a];if("[]"===s&&n.parseArrays)i=[].concat(o);else{i=n.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=parseInt(c,10);n.parseArrays||""!==c?!isNaN(u)&&s!==c&&String(u)===c&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(i=[])[u]=o:"__proto__"!==c&&(i[c]=o):i={0:o}}o=i}return o}(u,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return i;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?i.charset:e.charset;return{allowDots:void 0===e.allowDots?i.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:i.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:i.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:i.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:i.comma,decoder:"function"==typeof e.decoder?e.decoder:i.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:i.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:i.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:i.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:i.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var n,c={},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,f=u.split(t.delimiter,d),h=-1,p=t.charset;if(t.charsetSentinel)for(n=0;n<f.length;++n)0===f[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[n]?p="utf-8":"utf8=%26%2310003%3B"===f[n]&&(p="iso-8859-1"),h=n,n=f.length);for(n=0;n<f.length;++n)if(n!==h){var m,g,v=f[n],y=v.indexOf("]="),b=-1===y?v.indexOf("="):y+1;-1===b?(m=t.decoder(v,i.decoder,p,"key"),g=t.strictNullHandling?null:""):(m=t.decoder(v.slice(0,b),i.decoder,p,"key"),g=r.maybeMap(l(v.slice(b+1),t),(function(e){return t.decoder(e,i.decoder,p,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===p&&(g=s(g)),v.indexOf("[]=")>-1&&(g=a(g)?[g]:g),o.call(c,m)?c[m]=r.combine(c[m],g):c[m]=g}return c}(e,n):e,d=n.plainObjects?Object.create(null):{},f=Object.keys(u),h=0;h<f.length;++h){var p=f[h],m=c(p,u[p],n,"string"==typeof e);d=r.merge(d,m,n)}return!0===n.allowSparse?d:r.compact(d)}},8261:(e,t,n)=>{"use strict";var r=n(7478),o=n(2769),a=n(5798),i=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=String.prototype.split,u=Array.prototype.push,d=function(e,t){u.apply(e,l(t)?t:[t])},f=Date.prototype.toISOString,h=a.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:h,formatter:a.formatters[h],indices:!1,serializeDate:function(e){return f.call(e)},skipNulls:!1,strictNullHandling:!1},m={},g=function e(t,n,a,i,s,u,f,h,g,v,y,b,x,w,T,I){for(var S,C=t,E=I,A=0,M=!1;void 0!==(E=E.get(m))&&!M;){var P=E.get(t);if(A+=1,void 0!==P){if(P===A)throw new RangeError("Cyclic object value");M=!0}void 0===E.get(m)&&(A=0)}if("function"==typeof h?C=h(n,C):C instanceof Date?C=y(C):"comma"===a&&l(C)&&(C=o.maybeMap(C,(function(e){return e instanceof Date?y(e):e}))),null===C){if(s)return f&&!w?f(n,p.encoder,T,"key",b):n;C=""}if("string"==typeof(S=C)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||o.isBuffer(C)){if(f){var D=w?n:f(n,p.encoder,T,"key",b);if("comma"===a&&w){for(var k=c.call(String(C),","),L="",O=0;O<k.length;++O)L+=(0===O?"":",")+x(f(k[O],p.encoder,T,"value",b));return[x(D)+(i&&l(C)&&1===k.length?"[]":"")+"="+L]}return[x(D)+"="+x(f(C,p.encoder,T,"value",b))]}return[x(n)+"="+x(String(C))]}var R,_=[];if(void 0===C)return _;if("comma"===a&&l(C))R=[{value:C.length>0?C.join(",")||null:void 0}];else if(l(h))R=h;else{var N=Object.keys(C);R=g?N.sort(g):N}for(var B=i&&l(C)&&1===C.length?n+"[]":n,U=0;U<R.length;++U){var V=R[U],F="object"==typeof V&&void 0!==V.value?V.value:C[V];if(!u||null!==F){var j=l(C)?"function"==typeof a?a(B,V):B:B+(v?"."+V:"["+V+"]");I.set(t,A);var H=r();H.set(m,I),d(_,e(F,j,a,i,s,u,f,h,g,v,y,b,x,w,T,H))}}return _};e.exports=function(e,t){var n,o=e,c=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=a.default;if(void 0!==e.format){if(!i.call(a.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=a.formatters[n],o=p.filter;return("function"==typeof e.filter||l(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:o,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof c.filter?o=(0,c.filter)("",o):l(c.filter)&&(n=c.filter);var u,f=[];if("object"!=typeof o||null===o)return"";u=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var h=s[u];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===h&&t&&t.commaRoundTrip;n||(n=Object.keys(o)),c.sort&&n.sort(c.sort);for(var v=r(),y=0;y<n.length;++y){var b=n[y];c.skipNulls&&null===o[b]||d(f,g(o[b],b,h,m,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,v))}var x=f.join(c.delimiter),w=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),x.length>0?w+x:""}},2769:(e,t,n)=>{"use strict";var r=n(5798),o=Object.prototype.hasOwnProperty,a=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],i=o.obj[o.prop],s=Object.keys(i),l=0;l<s.length;++l){var c=s[l],u=i[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:i,prop:c}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(a(n)){for(var r=[],o=0;o<n.length;++o)void 0!==n[o]&&r.push(n[o]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n,o,a){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<s.length;++c){var u=s.charCodeAt(c);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||a===r.RFC1738&&(40===u||41===u)?l+=s.charAt(c):u<128?l+=i[u]:u<2048?l+=i[192|u>>6]+i[128|63&u]:u<55296||u>=57344?l+=i[224|u>>12]+i[128|u>>6&63]+i[128|63&u]:(c+=1,u=65536+((1023&u)<<10|1023&s.charCodeAt(c)),l+=i[240|u>>18]+i[128|u>>12&63]+i[128|u>>6&63]+i[128|63&u])}return l},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(a(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(a(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!o.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var i=t;return a(t)&&!a(n)&&(i=s(t,r)),a(t)&&a(n)?(n.forEach((function(n,a){if(o.call(t,a)){var i=t[a];i&&"object"==typeof i&&n&&"object"==typeof n?t[a]=e(i,n,r):t.push(n)}else t[a]=n})),t):Object.keys(n).reduce((function(t,a){var i=n[a];return o.call(t,a)?t[a]=e(t[a],i,r):t[a]=i,t}),i)}}},7478:(e,t,n)=>{"use strict";var r=n(5388),o=n(382),a=n(631),i=r("%TypeError%"),s=r("%WeakMap%",!0),l=r("%Map%",!0),c=o("WeakMap.prototype.get",!0),u=o("WeakMap.prototype.set",!0),d=o("WeakMap.prototype.has",!0),f=o("Map.prototype.get",!0),h=o("Map.prototype.set",!0),p=o("Map.prototype.has",!0),m=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new i("Side channel does not contain "+a(e))},get:function(r){if(s&&r&&("object"==typeof r||"function"==typeof r)){if(e)return c(e,r)}else if(l){if(t)return f(t,r)}else if(n)return function(e,t){var n=m(e,t);return n&&n.value}(n,r)},has:function(r){if(s&&r&&("object"==typeof r||"function"==typeof r)){if(e)return d(e,r)}else if(l){if(t)return p(t,r)}else if(n)return function(e,t){return!!m(e,t)}(n,r);return!1},set:function(r,o){s&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new s),u(e,r,o)):l?(t||(t=new l),h(t,r,o)):(n||(n={key:{},next:null}),function(e,t,n){var r=m(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,o))}};return r}},382:(e,t,n)=>{"use strict";var r=n(5388),o=n(5725),a=o(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&a(e,".prototype.")>-1?o(n):n}},5725:(e,t,n)=>{"use strict";var r=n(8612),o=n(5388),a=o("%Function.prototype.apply%"),i=o("%Function.prototype.call%"),s=o("%Reflect.apply%",!0)||r.call(i,a),l=o("%Object.getOwnPropertyDescriptor%",!0),c=o("%Object.defineProperty%",!0),u=o("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=s(r,i,arguments);if(l&&c){var n=l(t,"length");n.configurable&&c(t,"length",{value:1+u(0,e.length-(arguments.length-1))})}return t};var d=function(){return s(r,a,arguments)};c?c(e.exports,"apply",{value:d}):e.exports.apply=d},5388:(e,t,n)=>{"use strict";var r,o=SyntaxError,a=Function,i=TypeError,s=function(e){try{return a('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new i},u=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,d=n(1405)(),f=Object.getPrototypeOf||function(e){return e.__proto__},h={},p="undefined"==typeof Uint8Array?r:f(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":d?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":h,"%AsyncGenerator%":h,"%AsyncGeneratorFunction%":h,"%AsyncIteratorPrototype%":h,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":a,"%GeneratorFunction%":h,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?f(f([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?f(""[Symbol.iterator]()):r,"%Symbol%":d?Symbol:r,"%SyntaxError%":o,"%ThrowTypeError%":u,"%TypedArray%":p,"%TypeError%":i,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},g=function e(t){var n;if("%AsyncFunction%"===t)n=s("async function () {}");else if("%GeneratorFunction%"===t)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=s("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&(n=f(o.prototype))}return m[t]=n,n},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=n(8612),b=n(7642),x=y.call(Function.call,Array.prototype.concat),w=y.call(Function.apply,Array.prototype.splice),T=y.call(Function.call,String.prototype.replace),I=y.call(Function.call,String.prototype.slice),S=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,C=/\\(\\)?/g,E=function(e){var t=I(e,0,1),n=I(e,-1);if("%"===t&&"%"!==n)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new o("invalid intrinsic syntax, expected opening `%`");var r=[];return T(e,S,(function(e,t,n,o){r[r.length]=n?T(o,C,"$1"):t||e})),r},A=function(e,t){var n,r=e;if(b(v,r)&&(r="%"+(n=v[r])[0]+"%"),b(m,r)){var a=m[r];if(a===h&&(a=g(r)),void 0===a&&!t)throw new i("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:a}}throw new o("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new i("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new i('"allowMissing" argument must be a boolean');var n=E(e),r=n.length>0?n[0]:"",a=A("%"+r+"%",t),s=a.name,c=a.value,u=!1,d=a.alias;d&&(r=d[0],w(n,x([0,1],d)));for(var f=1,h=!0;f<n.length;f+=1){var p=n[f],g=I(p,0,1),v=I(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===v||"'"===v||"`"===v)&&g!==v)throw new o("property names with quotes must have matching quotes");if("constructor"!==p&&h||(u=!0),b(m,s="%"+(r+="."+p)+"%"))c=m[s];else if(null!=c){if(!(p in c)){if(!t)throw new i("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&f+1>=n.length){var y=l(c,p);c=(h=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[p]}else h=b(c,p),c=c[p];h&&!u&&(m[s]=c)}}return c}},1063:e=>{
/*! For license information please see simple.min.js.LICENSE.txt */
self,e.exports=function(){"use strict";var e={362:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=(...e)=>{const t=[],n=e.length;for(let o=0;o<n;o++){const a=e[o];"Array"===(0,r.dataType)(a)&&a.forEach(((e,r)=>{t[o+r*n]=e}))}return t.filter((e=>null!=e))}},114:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.arraysLaminated=void 0;var o=n(362);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return r(o).default}})},537:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t=!1)=>{try{if(TextDecoder){const t=new TextDecoder("utf-8");return JSON.parse(t.decode(new Uint8Array(e)))}const t=new Uint8Array(e),n=String.fromCharCode.apply(null,t);return JSON.parse(n)}catch(e){return void(t&&console.log(e))}}},415:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isDICM=t.arrayBufferToJson=void 0;var o=n(537);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return r(o).default}});var a=n(754);Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return r(a).default}})},754:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{if(!e||!e.byteLength||e.byteLength<=132)return!1;let t="";const n=new Uint8Array(e,128,4);for(let e=0;e<n.length;e++)t+=String.fromCharCode(n[e]);return"DICM"===t}},80:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.store=new Map}get(e,...t){const n=JSON.stringify(t);if(!this.store.has(e)){const r=e(...t),o=new Map;return o.set(n,r),this.store.set(e,o),r}const r=this.store.get(e);if(!(null==r?void 0:r.has(n))){const o=e(...t);return null==r||r.set(n,o),o}return r.get(n)}}},983:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,n=1){this.db=void 0,this.dbName=e,this.storeName=t,this.version=n}open(){return new Promise(((e,t)=>{const n=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB;if(!n){const e=new Error("IndexedDB is not supported");return console.warn(e),t(e)}const r=n.open(this.dbName,this.version);r.onsuccess=t=>{var n;this.db=null===(n=t.target)||void 0===n?void 0:n.result,e(t)},r.onerror=function(e){t(e),console.log("数据库打开失败...")},r.onupgradeneeded=e=>{var t;const n=this.storeName,r=null===(t=e.target)||void 0===t?void 0:t.result;r.objectStoreNames.contains(n)||r.createObjectStore(n)}}))}dispatch(e,t={},...n){const{mode:r="readwrite",more:o=!1}=t;return new Promise(((a,i)=>{try{const t=this.getObjectStore(r),s=t[e];if(!(e in t))return i(`${e} is undefined, reference resources:https://developer.mozilla.org/zh-CN/docs/Web/API/IDBObjectStore`);if("function"==typeof s){const r=t[e](...n);r.onsuccess=e=>{var n;const i=null===(n=e.target)||void 0===n?void 0:n.result;a(o?{res:r,event:e,result:i,objectStore:t,bd:this.db}:i)},r.onerror=i}else a(s)}catch(r){i({message:r,arguments:{func:e,options:t,args:n}})}}))}getObjectStore(e="readwrite"){if(!this.db)throw new Error("No database connection available , please use IndexedDB=>open to connect");return this.db.transaction([this.storeName],e).objectStore(this.storeName)}}},497:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.func=e,this.result}run(...e){return void 0!==this.result||(this.result=this.func(...e)),this.result}}},137:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.taskId=0,this.count=0,this.arr=[],this.limit=0,this.pendingTask=[],this.func=()=>({}),this.finishSResolve=()=>({})}init(e){const{arr:t=[],func:n,limit:r=6}=e||{};return t.length&&n?(this.arr.length&&this.pendingTask.push({arr:[...this.arr],func:this.func,limit:this.limit}),this.count=0,this.arr=[...t],this.limit=Math.min(r,t.length),this.func=n,this.loop(this.taskId),new Promise((e=>{this.finishSResolve=e}))):Promise.reject("arr and func is required")}loop(e){return n(this,void 0,void 0,(function*(){if(e===this.taskId)if(0!==this.arr.length)this.count+=1,this.count<this.limit&&this.loop(this.taskId),yield this.func(this.arr.shift()),e===this.taskId&&(this.count>=this.limit&&this.loop(this.taskId),this.count-=1);else if(this.count<=0){this.finishSResolve("finish");const{arr:e,func:t,limit:n}=this.pendingTask.shift()||{};(null==e?void 0:e.length)&&t&&(this.taskId+=1,this.init({arr:e,func:t,limit:n}))}else setTimeout((()=>this.loop(this.taskId)),100)}))}cancel(){return this.taskId+=1,this.arr.length=0,this.pendingTask.length=0,Promise.resolve("cancel")}}},182:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=e||{},{tagName:r="div"}=t,o=n(t,["tagName"]),a=document.createElement(r);for(const[e,t]of Object.entries(o))a[e]=t;return a}},368:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=function(e,t,n){let o,a,i,s,l,c,u=0,d=!1,f=!1,h=!0;const p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){const n=o,r=a;return o=a=void 0,u=t,i=e.apply(r,n),i}function g(e,t=0){return p?window.requestAnimationFrame(e):setTimeout(e,t)}function v(e){const n=e-(c||0);return void 0===c||n>=(t||0)||n<0||f&&e-u>=(s||0)}function y(){const e=Date.now();if(v(e))return b(e);l=g(y,function(e){const n=e-u,r=(t||0)-(e-(c||0));return f?Math.min(r,(s||0)-n):r}(e))}function b(e){return l=void 0,h&&o?m(e):(o=a=void 0,i)}function x(...e){const n=Date.now(),r=v(n);if(o=e,a=this,c=n,r){if(void 0===l)return function(e){return u=e,l=g(y,t),d?m(e):i}(c);if(f)return l=g(y,t),m(c)}return void 0===l&&(l=g(y,t)),i}return t=Number(t)||0,n&&"Object"===(0,r.dataType)(n)&&(d=Boolean(n.leading),f="maxWait"in n,s=f?Math.max(Number(n.maxWait)||0,t):s,h="trailing"in n?Boolean(n.trailing):h),x.cancel=function(){void 0!==l&&function(e){if(p)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),u=0,o=c=a=l=void 0},x.flush=function(){return void 0===l?i:b(Date.now())},x.pending=function(){return void 0!==l},x}},456:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createElement=t.throttle=t.debounce=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=void 0;var o=n(137);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return r(o).default}});var a=n(80);Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return r(a).default}});var i=n(497);Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return r(i).default}});var s=n(983);Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return r(s).default}});var l=n(935);Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return r(l).default}});var c=n(378);Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return r(c).default}});var u=n(368);Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return r(u).default}});var d=n(539);Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return r(d).default}});var f=n(182);Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return r(f).default}})},935:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=function e(t,n){if("Object"!==(0,r.dataType)(t))return"";const o=Object.keys(t);return o.reduce(((a,i,s)=>{const l=t[i];return 0!==s||n||(a+="?"),"Object"===(0,r.dataType)(l)?a+=e(l,n?`${n}[${i}]`:i):a+=n?`${n}[${i}]=${l}`:`${i}=${l}`,s!==o.length-1&&(a+="&"),a}),"")}},378:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e=e||location.search;const t={};if("function"==typeof URLSearchParams){const n=new URLSearchParams(e);for(const[e,r]of n)t[e]=r}else{const n=e.replace("?","").split("&");for(const e of n){const[n,r]=e.split("=");t[n]=r}}return t}},539:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=function(e,t=0,n){let o=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return n&&"Object"===(0,r.dataType)(n)&&(o="leading"in n?Boolean(n.leading):o,a="trailing"in n?Boolean(n.trailing):a),(0,r.debounce)(e,t,{leading:o,trailing:a,maxWait:t})}},337:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=void 0;const r=(e,t="image/png")=>{const n=document.createElement("canvas"),r=n.getContext("2d");return n.height=e.height,n.width=e.width,null==r||r.putImageData(e,0,0),n.toDataURL(t)};t.ImageDataToDataURL=r;const o=(e,t)=>new Promise(((n,o)=>{const a=r(e,t),i=new Image;i.src=a,i.onload=()=>{n(i)},i.onerror=e=>{o(e)}}));t.ImageDataToImage=o;const a=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const n=r(e,t),o=yield fetch(n);return Promise.resolve(o.arrayBuffer())}catch(e){return Promise.reject(e)}}));t.ImageDataToArraybuffer=a,t.default={ImageDataToDataURL:r,ImageDataToImage:o,ImageDataToArraybuffer:a}},37:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});const r=n(607);t.default=(e,t,n={})=>{const{interceptors:o,crossOrigin:a="Anonymous",zoom:i=1,debug:s=!1}=n;return new Promise(((n,l)=>{try{const c=null==e?void 0:e.getContext("2d"),u=e.width,d=e.height;let f=1;const h=new Image;h.crossOrigin=a,h.src=t,h.onload=()=>{let e=h.width,t=h.height;f=u/d>e/t?d/t:u/e,e=e*f*i,t=t*f*i,s&&console.log({cW:u,cH:d,scale:f,zoom:i,originIW:h.width,originIH:h.height,iW:e,iH:t});const[a,p,m,g]=[(u-e)/2,(d-t)/2,e,t];if("function"!=typeof o)null==c||c.drawImage(h,a,p,m,g),n("success");else{const e=o();if("Promise"!==(0,r.dataType)(e))throw l(new Error("interceptors must be Promise"));e.then((e=>{e?(null==c||c.drawImage(h,a,p,m,g),n("success")):l("cancel")}),(()=>{l("cancel")}))}},h.onerror=e=>{l(e)}}catch(e){l(e)}}))}},176:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=void 0;var o=n(37);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return r(o).default}});var a=n(337);Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return a.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return a.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return a.ImageDataToArraybuffer}})},814:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,n={})=>{var r;if(t&&(t=`script${t}`,document.querySelector(`#${t}`)))return;const o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),t&&o.setAttribute("id",t);for(const[e,t]of Object.entries(n))o.setAttribute(e,t);null===(r=document.querySelector("head"))||void 0===r||r.appendChild(o)}},826:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.importScript=void 0;var o=n(814);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return r(o).default}})},607:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=t.httpRequest=t.importScript=t.isDICM=t.arrayBufferToJson=t.ImageDataToArraybuffer=t.ImageDataToImage=t.ImageDataToDataURL=t.canvasDrawImage=t.dataType=t.env=t.isCanvasBlank=t.isNull=t.createElement=t.throttle=t.debounce=t.arraysLaminated=t.queryToObject=t.objectToQuery=t.IndexedDB=t.Once=t.ComputeStore=t.PromiseQueue=t.version=void 0;const o=n(456);Object.defineProperty(t,"PromiseQueue",{enumerable:!0,get:function(){return o.PromiseQueue}}),Object.defineProperty(t,"ComputeStore",{enumerable:!0,get:function(){return o.ComputeStore}}),Object.defineProperty(t,"Once",{enumerable:!0,get:function(){return o.Once}}),Object.defineProperty(t,"IndexedDB",{enumerable:!0,get:function(){return o.IndexedDB}}),Object.defineProperty(t,"objectToQuery",{enumerable:!0,get:function(){return o.objectToQuery}}),Object.defineProperty(t,"queryToObject",{enumerable:!0,get:function(){return o.queryToObject}}),Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return o.debounce}}),Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return o.throttle}}),Object.defineProperty(t,"createElement",{enumerable:!0,get:function(){return o.createElement}});const a=n(114);Object.defineProperty(t,"arraysLaminated",{enumerable:!0,get:function(){return a.arraysLaminated}});const i=n(693);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return i.isNull}}),Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return i.isCanvasBlank}}),Object.defineProperty(t,"env",{enumerable:!0,get:function(){return i.env}}),Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return i.dataType}});const s=n(176);Object.defineProperty(t,"canvasDrawImage",{enumerable:!0,get:function(){return s.canvasDrawImage}}),Object.defineProperty(t,"ImageDataToDataURL",{enumerable:!0,get:function(){return s.ImageDataToDataURL}}),Object.defineProperty(t,"ImageDataToImage",{enumerable:!0,get:function(){return s.ImageDataToImage}}),Object.defineProperty(t,"ImageDataToArraybuffer",{enumerable:!0,get:function(){return s.ImageDataToArraybuffer}});const l=n(415);Object.defineProperty(t,"arrayBufferToJson",{enumerable:!0,get:function(){return l.arrayBufferToJson}}),Object.defineProperty(t,"isDICM",{enumerable:!0,get:function(){return l.isDICM}});const c=n(826);Object.defineProperty(t,"importScript",{enumerable:!0,get:function(){return c.importScript}});const u=n(855);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return u.httpRequest}});const d=n(895);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return d.copyText}});const f=r(n(147)),{version:h}=f.default;t.version=h,t.default={version:h,PromiseQueue:o.PromiseQueue,ComputeStore:o.ComputeStore,Once:o.Once,IndexedDB:o.IndexedDB,objectToQuery:o.objectToQuery,queryToObject:o.queryToObject,arraysLaminated:a.arraysLaminated,debounce:o.debounce,throttle:o.throttle,createElement:o.createElement,isNull:i.isNull,isCanvasBlank:i.isCanvasBlank,env:i.env,dataType:i.dataType,canvasDrawImage:s.canvasDrawImage,ImageDataToDataURL:s.ImageDataToDataURL,ImageDataToImage:s.ImageDataToImage,ImageDataToArraybuffer:s.ImageDataToArraybuffer,arrayBufferToJson:l.arrayBufferToJson,isDICM:l.isDICM,importScript:c.importScript,httpRequest:u.httpRequest,copyText:d.copyText}},363:function(e,t){var n=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t={},r)=>new Promise(((o,a)=>{const i=new XMLHttpRequest;"function"==typeof r&&r(i),i.onreadystatechange=()=>{const{status:e,readyState:t}=i;if(0!==t&&1!==t)return 200!==e?a(i):4===t?o(i):void 0},i.onerror=()=>{a(i)};const{method:s="GET",async:l=!0,username:c,password:u,send:d,open:f}=t,h=n(t,["method","async","username","password","send","open"]);f&&console.log(new Error("don't config open ,please configure async、username、password")),i.open(s,e,l,c,u);for(const[e,t]of Object.entries(h)){if(!(e in i))return a(`${e} is undefined, reference resources: https://www.w3school.com.cn/xmldom/dom_http.asp`);if("function"==typeof i[e]){const{args:n}=t;n&&n.constructor===Array?i[e](...t):i[e](t)}else i[e]=t}i.send(d)}))},855:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.httpRequest=void 0;var o=n(363);Object.defineProperty(t,"httpRequest",{enumerable:!0,get:function(){return r(o).default}})},185:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const n=typeof e,{lowercase:r=!1}=t||{};if("object"===n){const t=Object.prototype.toString.call(e).slice(8,-1);return r?t.toLowerCase():t}return n}},865:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const{userAgent:n,platform:r}=navigator;return e=e||n,{isWin:(t=t||r).includes("Win"),isMac:t.includes("Mac"),isLinux:!!t.match(/Linux|X11/i),isIpad:!!e.match(/iPad/i),isMobile:!!e.match(/mobile|phone/i),isAndroid:!!e.match(/android/i),IsIphone:!!e.match(/iphone/i),isWM:!!e.match(/windows mobile/i),isWeChat:!!e.match(/MicroMessenger/i)}}},693:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dataType=t.env=t.isCanvasBlank=t.isNull=void 0;var o=n(123);Object.defineProperty(t,"isNull",{enumerable:!0,get:function(){return r(o).default}});var a=n(41);Object.defineProperty(t,"isCanvasBlank",{enumerable:!0,get:function(){return r(a).default}});var i=n(865);Object.defineProperty(t,"env",{enumerable:!0,get:function(){return r(i).default}});var s=n(185);Object.defineProperty(t,"dataType",{enumerable:!0,get:function(){return r(s).default}})},41:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()}},123:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>[void 0,'""','" "',"null","[]","{}"].includes(JSON.stringify(e))},874:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>new Promise(((t,n)=>{const r=navigator.clipboard;if(!r){if(document.execCommand){const r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",e),r.select();try{return document.execCommand("Copy"),r.remove(),t("success")}catch(e){return r.remove(),n(e)}}return n("该浏览器不支持自动复制")}r.writeText(e).then((()=>{t("success")}),(e=>{n(e)}))}))},895:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.copyText=void 0;var o=n(874);Object.defineProperty(t,"copyText",{enumerable:!0,get:function(){return r(o).default}})},147:function(e){e.exports=JSON.parse('{"name":"simple2k13","version":"1.1.0","description":"some simple functions","main":"dist/simple.min.js","types":"dist/index.d.ts","scripts":{"test":"jest","test:watch":"jest --watch","test:staged":"jest --bail --findRelatedTests","start":"webpack-dev-server --env development --node-env development","build":"webpack --env production --node-env production --progress && tsc","prepare":"is-ci || husky install","lint":"eslint ./src --ext .js,.tsx,.ts","lint:fix":"eslint ./src --ext .js,.tsx,.ts --fix","lint:staged":"lint-staged","publish:major":"npm run lint:staged && npm version major && npm run build && npm publish","publish:minor":"npm run lint:staged && npm version minor && npm run build && npm publish","publish:patch":"npm run lint:staged && npm version patch && npm run build && npm publish","publish:prerelease":"npm run lint:staged && npm version prerelease && npm run build && npm publish"},"lint-staged":{"src/**/*.{js,ts,tsx}":["eslint","jest --bail --findRelatedTests"]},"repository":{"type":"git","url":"https://github.com/npm-for-cw/simple2k13"},"keywords":["functions","simple","simple2k13","js","cw"],"author":"cw<cw2k13as@gmail.com>","license":"LGPL-3.0","homepage":"https://github.com/npm-for-cw/simple2k13","files":["/dist","example"],"devDependencies":{"@babel/core":"^7.18.10","@babel/preset-env":"^7.18.10","@babel/preset-typescript":"^7.18.6","@commitlint/cli":"^17.1.1","@commitlint/config-conventional":"^17.1.0","@types/jest":"^28.1.3","@types/node":"^18.7.2","@types/webpack":"^5.28.0","@typescript-eslint/eslint-plugin":"^5.37.0","@typescript-eslint/parser":"^5.36.2","babel-jest":"^28.1.3","eslint":"^8.0.1","eslint-plugin-import":"^2.25.2","eslint-plugin-n":"^15.0.0","eslint-plugin-promise":"^6.0.0","fake-indexeddb":"^4.0.0","html-webpack-plugin":"^5.5.3","husky":"^8.0.0","is-ci":"^3.0.1","jest":"^28.1.3","jest-canvas-mock":"^2.4.0","jest-environment-jsdom":"^28.1.3","jest-fetch-mock":"^3.0.3","lint-staged":"^13.0.3","pinst":"^3.0.0","text-encoding":"^0.7.0","ts-jest":"^28.0.7","ts-loader":"^9.3.1","ts-node":"^10.9.1","tslint":"^6.1.3","typescript":"^4.7.4","webpack":"^5.74.0","webpack-cli":"^4.10.0","webpack-dev-server":"^4.15.1"},"dependencies":{}}')}},t={};return function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}(607).default}()},436:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAV1BMVEX2AgD2EAD4eAD3QgD4bgD2HgD3TgD3ZQD3VgD2FgD2NwD3XAD2JwD2LgD99hf6owP6mQT4iAD5hAD7uwv6rQb5jwH81w/85hT83xL8zw/7xgv+/hv97BZTj7ayAAAB6klEQVQ4y9VRCY4cIRAD6qSAvnvn/P87456NEq3yglh9CGwZl0n/GXLOVbqI9DEk53/4Wms4RY/moY26/JRkqbmO3gqTrSbaIv9Q5BBi07atPdWy2rYWkvijECHyc12XeS5Y6jyf67m5yGXSc8Z5xOu6rctxXIJ2zOtWCmsVzWnkoUJwsG3blvkUGXxuYEePyBSpZu1BmLBzKWUrhu9ZfGCn5lQd8SmrY0ptqlzMCsCCkeqVMZAQHvEx8LCyLcdSOETcCRboC+MiaLRmFtHKPr2mrwJSVfG9Cvz0gRJQ4Ij2nm7vaY8QUtRZUYV08MMUa7iU6cJOCp7IRSO5okc1cOdzt+V1f35NN2M2CEgQfy8JLtSO+35f9vvbzObXfT+Px4xZSdO0wQHgx9fX8ZwmJt9ft+eOlfQ8It0MITFM9WVelvlxOx7vHbfyLIFb6JTmSEClUG+N1I9pWpprKd54ZImk/TIINncya9oesyEjOyrVnCWRpDyqlut6HAnpNKB5Q+OURVJ0ESIIjISaOjGpsw9i1h4owcxV3dlGHd4uKQVWgq5JcUyCE06EdUVmgDR6xBjaEAVkYi74IyP1WuUDSHOND/3tAB5wufYrWLwAEjGQwF58wzSY9y8ShH0QJQbMQz6b36X+fr71vwDwJBeEP0nA0AAAAABJRU5ErkJggg=="},4842:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABEVBMVEX3+//i7fja6fbo8vrU5fTl7/nv9v19tdne6/fO4vKky+TB2u2gyOOBt9rG3e+u0OfX5/WnzOWSwd+Ku9yPvt55sti92OyrzeaYw+Dr8/u41eq21Om71uubxuJrqNSz0+mx0eiGudsUNnJnpdHy+P7K4PCdxeGEuNvD3O6+2ex0r9ZjotBJjcWVwt8oVpIlS4WZv91WlslghK5Teqo3ZJsfQnsVO3gRMGuiw9+dvNhyrdV5rdRcnM2DqMtjjLhJcKE0XZMWP39wptF+rdCPrMt2nsRplcBAhL9Pib1nk7xcj7xGgrhQhLVAeLA4cqxAbKFHZ5g2Wo4aR4ksUIeHsdWWttRlnMg6fLtYiLc2bKcxaqcwQHXtAAACnElEQVQ4y9WRVY5cMRBFTc/c9mOmZu4enuDMhJk5+19I3FF+oqwgV7LLch3XLbnAfyZKC44IQj4RU7+g/+QhQkpWhqhGKzsrif83Qn2E0FQ0q2EfjWORzRQk+E/hCQATqvxsGPd5OxYAPhzH7fhOTxbYZQAuigL5ZZmvx+vjzeaue3Nrs1mv1612DXkFIB6sBKmj8bodHz/79tABR8824zZJBhIhy4HxlCRp2eu4bdvjzT0fLQb32mRuzXSpvL4ECEqRWgz5NEqSVXsnThJ2L9ELiDkvKNLA81OYNQXmQRNk8zthuFolyVx4yCCPUloC7DoJFEQiYlptWfvy9OWjKCVEByXisOCAI4gFXDTNNlcLzd6NLkef7ssO2c7qklMKuO8q4S4KtTRTc/v84uOD0XulUNpXuuMKA58UlJrYWjub5fn90cUDB9RZ2lWqln6WAmkphV0+2z76evYmPrncn30Y7b9En4+yOq1IIMGbu5MJJ8vZ693b/dW7/fnt/Ojk8tP101dnrwPhVRaMntAJxth7fLPbvfp5MXqcBteXH3+83e1OfYLFApzfpoBiWvBbV8+Pr05u9qcfzq+fvHh+dr8WHIslOFEOoLBUNsubtAtORxcvtLQDJnVsMFEgE86iUFEsgzQPdXbr5nsYxoNYxiwJOPRBTTCeooCxKJvKcJvXT4/CMJxJzVZJx30CjCBumJKxPCWVtoGaV72OpOiGkRVGZyDMgz7I5DA23OimrrO7lZHzkCBb1TZmDDA2GAzjcFtzCIkgogqMMEsj+iYPh8kqAQMnx4SyEuggHyHuWLQMGUvYocLA7QdEEg/C30m3nEjZRMP58GDhPKKm8w//6TnoIO9wQsSkJYjmUZQHS8Kx565x4cJvErpwwH4BGi5IMMkKl1sAAAAASUVORK5CYII="},3701:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABBVBMVEUAAAAZGSQdHSkVFR4SERkjIzFmboZka4NOUGs9PVVSVnAHBgtJSmZgZX8oKDhpcohCQ1sPDhVueI1ZXXhWWnMzNUcuL0ErKzwLCxF2gpU7O1L2+fpdYnxbYHpPVGkgIC5KTWM3OEsyMkR6h5lsdYtAQlcEBAZMT2hESFw4OE+Rmaecoq+Qo62Cj59dZHZaXXFERV/+/v7v9PXa4OPP19zKz9XBydCdr7iImaZ8i5tHSWE9QFHq7/Di6Oq2xsu7vcSlrLaVprFye49ydYro6+7g4+bT29+2vsauvMSzt8GftLuqsbqMkZ9+hZNgaXtqbXrX2d+Zm6VygItvfYZpdoFSXGVJUlt63FDBAAACl0lEQVQ4y9WRRZIcMRBFJZVUwlIxczVzD4+HwTxkvv9RXD0bh8Mn8F+kIuM9ZS4S/GeRMjEQqRHRcYwS+Q+HEM3YKNStqGZnAdfob0UiBFGkhfd8vk7XeipCSJJXksjxjodk+rx2RDogAH8bFOnAc0jnAjAGbuJKVPPz6s3gzent8kdv/1ou+yatEIHYBRob5zHhVjpIB6cnn7/3ws+T5SD1PNogNIUgMrqGZOejapOm6elyhWBMV6lHnSgOQzxqAYKNbqfYQLE1HHrpXWkP7dWQdRAj5CaoArjO4LRKMGrEpKF3pe953pBqA0U1llK2wCUIN+FugFnNfDOd38zvrYwQxjiCRgIBrA1XG50QfhCGwv6Q7+Vf7pkDp1vFOJQSoNpIpDuySsHCKNy8zS8v8utwVmfKYSMYuoDoRCZRcaZU0Oc+37/Yz6+5yrbbjLNataCaSgmdQPje6vhh/XXv4Pgwf7e26Kbh3CGKgY/eeAxJJk7eXx3MPxy83fj+Yu/g0+rkeKFiPFIgf5Jj13Xxy9Hh4eer/fyFV9d7l1cf3x/eIO1GM3C5kWCMZQKr+e3pfHH07uHo4tPT4+3xXRZDrDOwaMdAjg0+U5Mg4NvJTb4/F0yZNhNFh8kMqFj2F+1owRj3S6HE0aIoLNNihT1sICSAE9eN4JlpWipipe/zx6AsC8GE7Q0dSAgINSEZn9h2kBFHqElGR46wWOxQ6yzumAJ+MHGUYrSIYMQCzpU36hj1Ndo6XBWmCWzTNKlV+hz2CzWJeRPqro0iRwQlHXoeMKm5U0rmxKgPqWvUqwZqfdPuP9tgV2zaKxOCIdzBHTegQbiwKKW9QE1KLeEQjLGxy45jo2+QjjIOLGpZvmoJfKU46Z/e/FN/A92MRrSJbLGPAAAAAElFTkSuQmCC"},2778:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAA9lBMVEVP//9M4/97h/5kqP92jP5M5/9M7P9N3P9no/9qnv9O/f9Q1v9Q0f9cuv9wlv9O2f9btv9M8f9esf9N4P9TzP9VyP/vBPxZvP9yk/5N9f9+hP6Jdf5ZwP+Bf/5opf5N+P9tmf+gWv5U2/9zkP5+gv5Q3P9Ww/9gtf9Q5P+tS/5lrf9rm/5zmP6Gef6aY/7dGf3kDvxR8f9U0P9cxP9frf9hq/9un/6FgP6lVP6+PP1U6P9jsf94kv58iv6Ncv6OcP6Sa/6oWf24P/3CNf3NK/3RI/3WH/z3APxgvf6XZ/6zSv3HLv1bzP6MfP5e1f52qv56oP6Ljf7KZtzfAAACoElEQVQ4y9WPh47dIBREwWDAz4B7736997a9b3r5/58Jm40UKX+QkS7o6gwzAvxf6lTJ+qI1277J/S/tuur8y0eURswd8PxQ5rvpcNMmf8C7M2lpvx/4h+JqeJXJzcTIobn+jZxEWTrV1rq8ku5hnn3rXHy9iedZcWkG645ixCFOawlxuLm5+XhqjurN96a5zW7nZd/0LgjgOhS+aXczpcV4/FXF/Tg12bzX01C/nXgggFtkCjEsZ9k8WzR37ejL9V1WYDfw81wffgAWRJv8kkDq415azAuZpuldrxxAQilx+iXQrQhOSodQZKAJLqQsil56vYH9wNKryvkACLd0tB1ZPtbKXGpZM256seBmiUTfg84IQAuSzWhrGPU0z430HL6GL0fm0ksXMUGTBFALOokzxNJgg2AwW4WrVXjOI0vsXDb0Bmtgccdxgni3R4ZKOYZvehRIuG5klyaKQDlJkpFbG7K4e/w0u39dfn4Ol1fd6xkSts0RAw/HqqI8OoxfzsvFebma1fL+9eXh4/jzCfm6vQPhbdIhhFz8fHp+Hj+G4bVdnl9Xjw8vz59aTvwcLGdJpyKJ4xlNs2jun5afnlYPt4vT5+MHnxIuwH1UdZxqJKI9mk7Fjo3DcGGwvZYyIw50HgHEVYWzxTFjopYMGU+nOO6qNdZ6yIMWsE1CfDrRtC4KWCxr+2MtZWwwIy16Q880wcA3ubCRltbCtI09irDtsi7zXYz3/oAhIKfIRYjhOKABm9o2KuwAYckt17VRrGlAU8JdKW0KPc65b6OcD6IgcI06xqoGaPi3RTLXp9SyTMuingchjaSmpYqA9P3GGJk69KingtQomcLoYozfK3DXGKrf6PCvdB1aPIhsgBWtUWR6+hsmjq4Y0dWi5u38BZRBTiq+AwTyAAAAAElFTkSuQmCC"},5263:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACVVBMVEU/S7/W3OfU2uhVa9pfeORngeleduKctvvK1u5cc+BZcN/G1fPa2+C0yfpyjO3R2uu5zPVjfOarxPxOYdJLXM6wx/qguvqetvd/mvPD0fF4kvGKnutIVsaWsvytw/m8z/eku/eTrPaasfS+zvO6yfBvi+5sh+xpf+PY1dzi1tJEUsWzDSemwP2Ur/e1yfayxfWtvvGouvGEnvF/l+2otupwiepqhOqksuluhuhjeuJSZtfm1s1JWcuyID25HTC2y/qMqPnB0vWCnfV6lvKXrPDG0+90j++ywO17lO2NouzFz+qsuerO1+l9lOlqguZlfuaFleJZbttiddlMXtBRX8ro1MjuwKmuAR+vw/WLpvWgtfKSqfKIofLN2O6Qpe6Dmuu4w+p5kOqVpud0ieSyu+Ntg+PQ0eKxt9+ys97Nyt1ofNxfdNzIxttqfdvf2dhVaNXYz9RqedTk1M1TXsWymsPrxrXBlam3W3e6RV3NVVe1ESiowPeGove+yeydr+qKnOXU1eKRn+HEx+C+wuCboNvCwdpvgdrU0NnFudPk2NGhl89hbc3i0czqz8HKrrebhbTNnqnxvaS+iKGye5/Kjpq5fZrxspfZl5PPhozaioLbf3TBXm+mO2XGSFG+OEi5MUbGPUK/JzKcq+jKz+SfquKpq95/idOYkNDczc64q86/ts2eisRsbsLAqb/Wtrrfvri2k7bhubGugabhrqTbpqGMWpbnp5SxbJHxqo2/dIutYYeiVoTHcH2nUHviiHixTnDNaW6/VWnFWWLFUFytN1uzME3DMjdGkMgXAAADLElEQVQ4y9WQ05IkYRBG/6rqUpfbtm3MdPfYxs6szbG1tm3bto3n2pq929gn2C8vMjLPiciIBP9ZDLnO/cO7VjUna+Otw52Gf3i7O2Vl1PMq6pbWBNeb1bW7/lYMq1Lu5ljtSs/OHfdGdi5LL9VnV3T+IfIO3yzfnLnRt33+Gu/IAzB66MC2A8VDm5KtowD4AFKE5PpdlZVr5hTPGT969JBoH+7qEgdvjXtF+yACKkhseROLbxsp3rt3/NSbiVnhVFfxgMezuqGnP50FG7DWBBusvNaw3TvgHe96PLz/Vt9BL91oicX1eunyrSCFJZrq0ogEbbpO07R3qH63Z8tBT40+24aigx09KwGZXJBNr5QjaJSPRFcPaLU07dm9bgXmXpKR5gyKrQDRuXojejITJ+Aaq3bLnSNnjuypX1CdDDM2dwsmbweCU4Is69U7zGX2xQv5dR/83f6fY2F1TzQgC9maFQqAOkm5omhTI2UumRcrvZ0vXPnlvxAPZmyyAD8/W9cJWF1Rh3xJvUymNDscG8dmClevzlxYbDIGAkY8vMq0HESicgWmKjNv3PPo/Jm177svf53y5/fV312bsOGqamUJOPvQ52vWGdecvvjp0snzl/I3HUtfd1+enDj97URE06aSgZlnOZ/47tGX36enX50r+O/j6c/dV86dvTg92V87WG4E+X0KkEMU8vYdx188PXZyKv/xR2HyybHnX8Zam1qQuBG8qzOADl+vzSqb67Djgchbf2EixMhWr2N4Qi9dZgVRjQIg8s0cUcLgZVSJsmHqRBVFwARDQHQDKrAAZxFE405AMGHawFBUGX58LUVRfIiHaHp+i7MalGpYXRCfC0H2YLXKLFMa+9QWfhFTbmkk1mvmhUxAa1dalEqGq4qhS0J2XGUaUpcyjVpdxqLCTVUwBCAIgjmConBUQHUVFeXqRKlm4eJYuYW3V3HiGQDDkFgwFVZpXC6Xk3U6XWiLIEkt0MKQGBiIWGwwzIWTUkFIoaggoKhEDFvpIDiOAyKdvcGrWUQqJTFM8icYJiUlqG6h1QYWcYsI7VwrK0hJcY8UiVIbgrSJTfRJjPwNFme7zxtIt3oAAAAASUVORK5CYII="},8495:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAwFBMVEUAAAAcEQkqGQ+QXTgTCwYhFAxoQiiJVzVWNiF/UjE6JRYKBgJ3TC5ySSwwHhJsRSqNWzdFKxo0IRMmFw6VYDtjPiZRMx9JLxxbOiNvRitePCT4wHmhaEB6UDCma0I/KBiEVTROMR6ZYjyCUzP7xn3osG+pbkTnqWvKhlTDfk7bpGeqd0q4d0nuuHT3t3PUn2TYmF/ElF7EjVi6iFa7gFCwgE+wekywcUbem2HNll3WklvUiVXBhFKjdkqaa0LdqmwjTj//AAACZElEQVQ4y9WNZ3LbMBBG0RtRBBAk2CmqWJJ7d5qd+98qsJ0fyeQEeYMZLPZ7iwX/GUVBILII2TArRIp/clqixTVJJdMulRYK/a0UKDMrs1kLOUlVmUQD+Ug+/yq87bhszDBZADfTdpg2jfXkQyAkT9fCnE1nl8cTzq3qdMqPoUWhJAQoCGtlxXqahuny+/eYhfZ4moYYV6xEHQUeemZr0bhxGIbL0wsqFX8ZIu+8SgmKBSDKVOogRTPHcTNsJMb4JTpPIUKEIAegrWnVElIywyq+kTJuYuQBohnBoihqQAKCzEOkOHbLiIfnH894WwfrnEAlJRRQBImCXutRp2Tw137X/1y5ruw61gpUFABZSArScGlcmpO56q+vd3dpQXXVmab0BNhACPGyYkwbrVd9ZncnWM5r4RBLwFWkoJ02Yzy7PcrX3f7mvN+Pa66ZEE1gLfgW85pQm/vD7f7i6/5Ka/m029+fHc8fmYJNBXZvBSCZ8fxwOH7peync3e769tvh8IAUUQnsdQEKWBDqLh4vn5/O9w83V/dvFz++xFqVUNXgackCoKKumNaicg99f2FchbEzWw/DAph6X5G4bJ3QsmXm5nEr16t1K3FkJbVABEJmlCfWzLdSjuJVy+1WtwZvYlPaAJKyoRYMY12HxjBW86YzvJ0bzqvZtwyMmnWMtVz6cm61ECw23vExoKoR1RZjgFerFd9KKRAtgwpKsKR88nNntOQ4xixgnCXpGoUy1lqESkrRMuYg81vIOAtzv8xhWeYKWqHXnHPwnnK+No2FH9B3PisUfC0Az+nIFpub+RDyfv3JL+wXNhoUBI2IAAAAAElFTkSuQmCC"},5990:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAnFBMVEUAAAAXFxd0dHQdHR0jIyMQEBBWVlZoaGhfX18JCQkwMDApKSlubm5bW1tJSUlGRkY5OTlRUVF4eHhkZGR7e3s9PT1BQUF+fn5NTU01NTWFhYX4+PiMjIyIiIitra2jo6NDQ0O+vr7y8vKdnZ3Pz8+SkpL+/v7s7OzV1dWmpqaZmZnn5+fi4uLf39/a2trExMS5ubmxsbGXl5fJycmVOdM0AAACQklEQVQ4y9VRR5IbMQxkBHOanEc5bV7//2+mtPLB5Re4D0CRaDaAJvrPoJTC7A6tNePqnzqmrAYfdS1dk6TX7G+KYpSyXsvWBjELnWSkhj+FHzEyb0Unh9kg3s5imFvP4oPBOVeMbYKc5un7uhb5Kq37aZoGyQzlHGmMN9oEO0/DfFu+2kxwyzoNVUWA0o6iHkcwm+BdOQzDbT0yqslxqGzX67rmvkYMg647jqm2RdEOrSiq4li5iDmlXFGHMGtocoqzJCGRVoiqzeoGs57hPHyDuMkaETNtCdQlmffLvrKNMQ4CpVhhRBnmGkcpy7KuZbEdT+N7BZ52CVygSt0JSvFsgnSxr8vz+HIet7Fhm9Q5T7MVxnClepESyKzSjrvdbtwGCKlrPDCoEXRK0a7MtenjS+xPr78uu1drSQkheAMOfVYIUdO45X37dtu+nUUp1tPb53E5XEFzn9A4K8Qz7OFyWT52Iwlue3r52L5fFqZ5X6OXUiGUx8Byv37vr4fXr8P5c/pef7WNplxv0LVBKO8S6vuUIcEy7m53ywonRcSmQaBVFohWOAhlDvKwCmGJddnzRKlBwXDe00SIheiEKP2xFCKbIou28pQZFLXJnwlFUW6MlwAN8Z2zrvfWJh0dIFFCBwBERNo7GTxUPuaTYckHEISggmRYIQLNDbXRHmod677vZClsboPIDwR4zZ7IVMwaQYr7Y0RyfqgAw/QPMKbYbKR9EB6w0udt8A/oMzMdm4DyyraExvzcZs+f4Z5wzr8B8scsKGLwyjkAAAAASUVORK5CYII="},3737:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACZFBMVEUKAABHAABsAABcAABNAAA0AABYAgD3PAD3QQD3NwBBAAAqAAAeAADaAwD0GgDTBQB0AABmAABgAABRAABKAAAUAAD2agDGBADBAQCMAAA9AAC8AgCCAQAkAACNCwHvKwD1JwDfCQDkBgC4AQCzAQBjAACrDwHzUQD3TQD2MgDNIQDuIACRAgCtAQCiAQA6AAD//emUEQLvEgH3dgD2cgDDLADmJwDoHADjFgDiEQDuBQCbAgBxAgDgAQCGAAB6AABTAAD///3yPwXpFQTPEwT4fQD3VAD3RwDSRADDGgDUEgD1DwDaDgC5DgDpDQC2BwCpAwCWAwB+AwD+9+/96db5xaX6sgbaHQX5nQOkCQLnPwHyNQDyLwD2LgDBIwC2IQCuHQDnBQCEAAD+/tT34NP+/8v44bb89qb955j6u4zwpIz944f0t3jih3T1l2D81lHohFH3sUf7y0bigUT1d0LdSTL4qyfCOSfUKhH70Qv6uAbmSQH4iwD3ZAD2WwDwVwDaTgDbPwDBNwDQKwC7JADfIgClHQCSGgCaFACCEgDCDQCbDQAuCwB3CABSBwD+8+n+/93+89v43sj3ysL93L/+/7zuv7L+/6rftqP82aHgrqD215H60IfimYPtrID7y3fOiHPXqm7yg2LWfk31j0qVaEjzlkf820H3gT/Kej7oXTnCRjX5nC/hfy/iUCy5NSj6vSXwPiD3cRzXTBb2kRTuThPBKBP83xLUaw3BlAmSZwn6vgfOOgbylASEWQTOhAPISAOXJwPFVgLFfAGmKQHqYwDmVwDvOwBPHwBxGwBHDQDOAACwWnJmAAADLElEQVQ4y9WS07IkYRCE/3ZPu6dnWmObO/baR2vbtm3btm3bL7VzNvZun2Dzoioq8suomwT/mRiGpnBR9MEdmhWnmX98FDHG3APj1u2bwm18Wp1o/IuY/8ZFI45oHdl1fT58zPTZM25TSqrQfxza1okwdvHz+j4DN8pdvoPd77pskDNfxsN2ujOfwDAbAvv9G3t26Tn81cpPTfrtyqHNQw4b4b0JDFghaHsH3Loh00XODF/x7EUTeLliaGZNYN2qsTgyXgJl047NQsy/NdtHXiMPH/pm788fq1bLwW87o9ZUitq6DfhMm/ekxuuoccfIYO9e8trc1wC5OhCOSjpixGx4FlBwmzQuSyeQvoVw35FrI1ygVzCwvgIhmkgxZts2kBBEqIcdEieOJsJt+W7y9bmLHzhGCHA/d6sRR2kUNGAUs5rah7X0T+8qF7rNTnYddGjJABVX+Krba7QxAIEh2ob5R3GlCfFo/N7g/ceOJE/aY7CH/TXBgpcxANcxmrbneLZa6l7YsiQ5acqU5HE/6+F5jzpAZOMg3JdmJCXdknvycMaC9+e7Hp4xZN/kZY5Hr/t6LYpQLYGFz81mpO7NLph+beqi2dMGL093n9N16tk7S09f7adRCguSNxgzhmG7r5yaNf3+vEmDbll6zOw6bd7CE7Mu4FZMi4HJyxjA6Axtejr/9uP5F4ccPHN08Mybi5aeu5uyIrrVA+aMMAObGfXEWHZLdwvfb+6gA4tbXHy3bu6iw04JXtCjZjNjtH10ZILbkuZK1WFDLnOc0+BwcWRwLC7BQBUwTEPGEYSTbXf3799fvbQ8wkVaikWyV3AgDgsgXqsIXksPksx7BaXEVr0jLUrR6dLUUaN5reziQS7vUlysO+SIIlqxu0dlAwPLrlGRuk9RVN5BEIAkDIYxTo7zIA28PrFeax0br7XvikZ3FvKRMb17BYHBQBBNhhug1nw+UYRh2IfgDck3IkeQvUmCBGTnNjQ1AKakRrPaUgNBTKiEVvzDHKFQqPMFYQg5C5aKrlMQBKF/BJkoCDV2tMdawZiQ05nv1ybgFGRCTQmsaegJXYdMEEVBzfkbXuqtTGcwvUsAAAAASUVORK5CYII="},2198:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAA9AACkAAAyAABCAADgAAAsAAAjAADIAACXAABOAAARAADjAACwAACrAACJAABgAAA2AAAXAAByAADnAQDMAAB+AABUAAAvAAAeAABsAAAIAAD1BABGAQDrAAC7AABJAAA5AAAoAABoAQG1AgCfAQCNAAB6AABaAADXAADUAACQAADvAQC4AACFAAC+BADbAADQAADBAACtAACTAAD1DgDwCwDdAACoAABdAAD//v3+8OWbBQHDAQCEAACCAAD98u/96dr53dX948rikXzYDgT2PAD0LQB1AAD+8uvy2NPzx8DzyLT8z6b2tKTUqaPrrqLxn4r6q4TLeXLccWPGX0n0cUjgYkbPXUD4gz3lSjzLSjO/NS6ZKybwTyTPIhmnGxG7JQyvEwh6CAfDKwaoDQbKDgH2VwD2QQD1HQDhCwDdBwDy0sn82rrit7H1x6D6t5fbmpD6sI7xqY7LkYjrl4bzg3e8fXf1lHPLhm7qalbMZlT5glOIVUfWUUTuYT/zeDi4UzigPTi2PDTtXy+gLif3WB7iMhqVHhTrOA6eEQ25EAxyDgvTFQjrFwd+JQX3YgK1PgH3RgDoLgCGLABPErVgAAAC7ElEQVQ4y9WS1a4bQQxAZ2ZnmZmShWQpfAMNlJmZmZmZmZk/uNuqb/2C+sGSdY5tyTL4z4LnNQdzVcwVioJd/h+uQmwNW3qRJ6K1MMyK6l/F/9uOIcT1Ymgw3d54YLOJrnLuH6Lx/m+uRxnTa0ntcRXQJ+ctMipkFnnu737adXkcLelO51Xmrfl+9lhpfzm7uizaIuZi2gUF5SyZcV1mXKlU1pz5+q0Ufp5ZXakIxgRByMbAc7yUW9KVUaddGqt/4Fg5fW4cNNi6slan5BxgAs3yEU1ApR8Ewfg8QwoXzgmSrtIQuhqWAFW1VFbSaIhClDYDhgna5y/0bQfXqzXf5y1A25hCulNVGqSULyI/77+//0jfsrmhJOOY0AigRgRdEHoYMr21erLq9rr5SzcclEaQZZEoQ40HMKI03s0aZkfU6/qh5cs2XVq3pZ5XF6ds0op1F0S2q2memSIUJkn4YsGyFSsWbDmBuixrZWKEcoBYjVfZQdg78ubW7uN35m/YtnnB+lfMsaMLF8steyqCpyd9H9rWqSdX923ctfLK8qO9Dzvmb1x54OW2PUihWilY8Iz3aZrWHt3Yfv31vhVLn3ffX5u/6eHuzdvvwcJVcrD+EA/8Gq8Rbx8cfrd359aLNy8vX3lg7+G7Bz8qkC4Wgx0nfKD5hJwjlIQym+5cuuyxKKWrPg07fY+yLbBwxgNa0xtmeZlFTIJObd3DmH2yL5pCgGI1AjJH03W4UBCayBNNZiDvOs6Y5VE6RjsYxREHdIXjlsiSYQwW260OkqzTLTZpisqo0UwVT0SAGUxZaSrOmR6siz05Q6syT5pj7Co7ypApCMAgSXKuaTIyVKE9s5UsXTvz8nqd7QyYRtBuA3IikAJJmsORgnH581EVw1glsMWQRiD8mWAYv6dMJI5SYwyhqkLoqATBdcPm3NwECMKfHWGLo2s1ynEIgigpRVAUgQvPkkFj0mgumlpcTFElpN2aQ9R+q4RTJsqhfgHJO3I6nMyA7AAAAABJRU5ErkJggg=="},1289:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACf1BMVEUAAAABAEACAEYAACUAADgAADEAACsAAC9SAJYAAAwGAFgdAKpaAYUAADUAACAAABMDAE8JAHEFAGADAFQBABgCABBOAJ0MAIwCAEw6AK0XAKQVAF0KADNDAKAPAJxWAJEYAI4TAIgKAIUMAHtsDWULAEgDADz98+0pALI+AKUlAaQrAKEfAKESAIQTBHgfAXYtAW00BmsGAGoHAGUMAGP//v40ALcuBKgzAKAbAJ4pAJ05AJscApglAJhEAJUSAJEkAo1YAIwZAIoKAIATAH4rBHsWAHNmB24SA2odAVyEHDeOIisAABz38fTr3uX95tYyAK0kAKxJAKRKAJnus5IbAJFMAZBVAotJBYdeB31iBXc+CW0fBWtYCWoTAGVAB2EsBl5WE1UVAlJxE1BWEEwNAECXJx+5PhrwZgvOTAr+7+bi2OT66eDjz9nIssvjy8mqlsW4qcT507mPdLjuw7C4jqs2CanZrKWldKNYO6BYHZyKU5uYZZoXAJotA5g+ApUlE5QyAZFCAo03Ao2GXIo8LYo4EolZEYk8B4ZRA4WGVHY2B3HXgGBnFF83CF9qEFoqBFJgEUyDHktKDkt7FUmBGUU0CUUkBkWNIjOLHzCIIS2SIyOmMB9sLBmqPxiXNhHXUgsSBwrSxeLDt9fNtdL84MzFoMChkrqLe7reuLjJnrKPeabCmqKMZp1rR503HZdeNJXVmpGxjI9POYswHIpJMIeSZoamaISUU4RlKIK/eXlAH3kyBHaLN3VdLHVXF3G8bWncimfqk2G/a2FvWGByHVvli1exWVd5G1F+M01tEkq8WEOpRT9lFjwlBDZ6HDVrGi7WZisSASQrCxLeVQOSa1CeAAADLklEQVQ4y9WN05ocURRGzzmlLnS53T1tG2Obse1kJrZt27Zt29YDpSbJXZ4g6+a/WGt/G/xn0AaVtPsRMjOybUyb4R+vh9DLxiWmedAG76KQiRnzN6H/jAHBAMwyw0Zt2/1172j/8EEjcVH9bVSB7sxsaPen0ckdLXt/gGNHWkfsb/0y3DzS0HmP8bwAUcPgHQdax477efSIVh862jG2dWxLGvrtGA9kkmpmxLoR+w+07BvX3n64M2jv2Ldzy6ghaXsgZQcZYs9msS45fPPolp27xnUctn//vOng9sZ1NTmm2UZu3QMQkfY3pzACjhwycKBv19vl77cMOOirH4pjEPKCfRggUQJPDVMxWL+sPjVk1JLZPp9v07YxBByKSJoWtgJMQWSVjUK5XtxD74oB2+/OXTC/f4PiX8y6IU6pFMDNBM9QTStCBYVDm8rXzArmdzl+tdyF98mz9nBDVQDQTKkGfvA6S4iVMtKqruOnnwpOa6pFnry8HjUBSQVmpU0QbP3LrNZQ4eK184ITu3UbPy1RrPlaU9QfawAbkoIBd3UvXHvv0fn7Iy7kTzp9ssuEW/0fP6hPeCoVlgUb39E0VDyDXsx8PeX2xZldrxTOnpE/Zdb6p3PuVMlYpRUE1xtojMeOvZzTu/e359263PAsnZo//dnGc72v2xk+6wUTVgmAxgSVunnpzceFMyZPOnOi69TLKz9cmzeYCWCMB5xN0ECgCbfXWra6yJRXNTc4cUEktmjNfDbqsJFKLSiTtRdtNmOYZU3dLT2sSycvtFgc/SrYMNeYxnEzMIk8n4WpaqcjlmELCgpMK1eXhsORkijna0ziogIkWVTi7iqOK42LlSErW/vE3SfaM5J19e3bR5YiZaC0KOaKFbPGilwgV9LdbSp+VSdF+pYyyFVpKq7o1w9wTp2uZ9hiiUMcMrKSrUtLstSUy9SUFC3pNaBxINBpaI2l3CUjDbMZIYjjetSwnOO4amc14HTVHKfTGXUliNTjCA/ocQgpvV4vJpdV9DIagdOpWaMjWiNiGEVRhF6DICiCpAjIZLxx4DD2dBSVJ0ScJAmC4Ns0gWloQ2oQ1C83prpOjqKhXgAAAABJRU5ErkJggg=="},3972:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACxFBMVEX2AABM/7v4jQBe/z9M/8JM/6z4nQJL/7RQ/2FR/1H3qQP4hABM/5Fh/VZ4/CzdFCPzSwL4lgH3cQD2FgBL/ONM/89M/51L/n9N/nhS/UZ9+UK7vSS05B/kqgz5sgP2NQA9vvVD0OpL/shM/6Zl16FM/25b/Gll/kmK/SqW9Cp//Smv1SXd2RLUwBDXlg/11gznGgf5vwXzewP4ogH1JAH2ZQD1WwD3QAA4tfw+yftL7dxL/NZU/JZN/4R98nSK32esSV6S0FCN+UZR/z5+3jl7+zeO+jWftTRb/yya7Suq/CapxSTPQiC1yRzC6xvEehnH4BjM0hbCkRXVsRPhJRLYcQ3ptgnfMAnsjwXxigXwYwPxMgMrT/5D3vc/wehM39uBRLdN1Zha+I571oaEeYRW/oGmGoCTL35/4HWyL2eB+mZd/WB36F/tAFxT8Vhl8Fd+6U2cfkhc50fANENa9EDPHz6F8Dyf5Dmq1zla/zZv5ja2xi7HYCuD6iij5ii9WyX0ACSw8yPOxB7OsBrP7hnoBxbchhLYzBDy3Q/j0A7fsQzjnAztCAr1zAn0vAfvbQMnPf4wcv0nHf0yDf0ylPc2buVK5M5Cws14K8dWV8RDz7tP87dg17d1WrdenrZJu61W7KZsjZN3y4Rz7n9o/Xxj8nzgA3uJhndX/3JU6nHHEnCUeG2F12h3tWGVz15w+1yPv1unfVt21Fier1idaU7zAEKX5UGsyEFx+z622j67Pj2RwjiKuTdk/zC1qzCpuCjPNyiX4iS2eSDTfRnk6hbFpBXLbxTZuQ/Zpg7kvw3gSg3mkgnqYQfpeQZI8PFRRORVW9VIedN3FsxX9cpgc8VlIbNhvbFF47BN54lxpolwuohSu4Vh2HByvXCiZm6Vn2Z5k2atcU+AnU6aqjyI4Tpm8TST1jOiiyefrx/EwxbsPAX4eAAG0MznAAADV0lEQVQ4y9WM03pjYRiF/2QnaezGbOxJGtS2bWtqT227Y9u2bdu25yZmt0/P5gpmHX3P975rgf8s8zJTo7ovJyT083/+6E6d9w+/bpy6xA3ojT+1xUdzEtsWHTunMObqCSnjQkF8Ye7zD+sl8j7fbafuXEudJVQHY4Z/Sdy/Vl67WSppAJRVEnmOu3R/YmjSTJ9ut2XG3jrevNlN4rZs8cJVsD1/YZabu5t0izHh+m0biEOm+/OHQ+Q5kmz3RUuWPJsRFme5Zy/3eFJ6JXbvEBDQzpeOavz9S+XS+9mLspZ1RH3asDSHieAJ+CdOEA4eAWPpvn0tvtO0FP5GT08P6YqCXI8XS5f76NLoQiHVMVQIkIldab6FVLqwfGd5+ZpctsKDuXr12n6a8cJNi9UqPgLo+lv3KkPvjfFlCJ/w4jUrNhW9euvVrO+vCQwyjqdRk4FoBJNxPjlyK1aBbdFhN74fBBMXD5J4sW3nWklfb2aKgXkESRXb/dFsHLdLEBFJOba9qud2nCaxM+wcLmgoNBWMXrU7qO1eUCuEq67ednbwWFVVT1QXpA0LU5NrrjWeBZW1DvGdkwrsrjfr/fJed4AFfqcHk8683He4NoRM7msMBCs3MRjCX53v1u1+vGCP325KUHV9HWztWFdWVBNpIbeCnkNWRobdlnSxrKTkwUrKxAVtWzfYnpdXVtJwJfquTg2SzmQC67T4d/L3uqeP9tQ1UDqiKEc/73g4f187f5werQWXL1mBg5EcFA417lKqw+qPTlA+cnFQfj5XSWwnGDTgW5wYZFBDZd6BXK2Cw4XqTxdx2EQEC8d2YfqIXEcBedhmizbuRSGIUC+Oo8CSDx329vbGVmBdmJ4Boht6EBFn0GtCDjg7F3cOB+OgQHV+MK+CSIppQrNUMb0kFSjYqeJBEA7tpRNGVijVWtWGgAgSujh+jBdMVnmhUMAFgUDIiGxOyBRepB+4OhBQGREjaNHF8JQcosyTyQQIJ9hwQrNJwQOTJpNpxGSaNIvwrinNBShnZ5fZBfhwgkO6QcDjJ6fMeJHZjHHFYwzHt7JkaDRAoZzgAZayyUD/Q0DSaBgYumKQGAISkxIvCG8CLDSLyDkQbsDDHxqNbrekp1mmM+5a0pEEAhLOX/KQAIVSSOoqAAAAAElFTkSuQmCC"},7136:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACtVBMVEUHAH8VBPMUAup4/5dx/6Cn/WATAeMWAvsdMPN0/5wRAtVm+LRu/6V//o5+BgIXDPsVAu8PA8le+sNg9L8JA5chSPsYFPpJ5OgXHNpU6tVU29ERBc8NAbZs/qqI84eH/4We/WscLvsgPPo7vfgylfgoYvhAy/I1l/IZHvEnW+syd+oYG+pFz+c6oeQdLeJL3uBP3NhY+MxW5ssYK8Jm6rIMA68NEowbJ/kqcPgfOfExgO88rOwbKew6lug/qOUlN+VI1ONGx+M0a+EtX+ETBN5LztoaKdofRco4bcgQC8VVo8Fe378OAr1ctKwLAah16KAKA59nnp0IAY19fnDm6yKAHhUznfwkVvo1ovktf/kwh/cmWvNC0/I5q/Izh+8/v+4zj+0iSOw+supK3uQlWOMXEOMoUOAZGeBLvd4UDN5Q8d1Cl9sfQNpEq9dHutZM0tQxctQTEdJBhdEcLMtJkchUuMVc7cRLnsNIgMJPqsBavb4eRLoPDbpFe7Vo/7Bt8qgOEKR31J0eR514+poSIJF82omO+X5zaHKc9W2GuGldN2aRklay/lXJ8TyyoDqDSDKcUCLTkBWwXA+HEgOjBwCSBAAvjvwaHPspavhG2+06pew5huQ1Wd8pVts1gNowaNhQtM9OoMs7kctW0sVc1sIQEMAxd7sXKrpg6rlv+KZrzqRutKJwxZsTFZYhQpGN6XmV/XaFo3RuY1++/UlqI0etv0SHXD+TXTRzMTTMwy2pgCzb6SrFkByDLBz01Q+vKwetEQBDw+lV+tNLoc84Wcw9gMNdrrQcObQlWa8THK9HZK5Zlq1jo6t24JpJipo0ZZV565N8xo84RH0eIHxfTHOX0G6Jjm56cVyAfll5b1Wlv1JwSFC51kmBPEi/30aNezySNht2EhqVIhmuRg72xgmVGQHHHABfgbLgAAADTklEQVQ4y9XL03pcYQCF4X9rOnvUsW17Gtt2bce2k8ZGbdu2bdu4ju706VmvoOv0/Rb4zzaFe7Ct7U5cXMHikl1tK6b847tjjfMXhaxRR9ZVzpgnClpc/zfJ/HuP4y+zzAq41dnxqAc7EFZRt2FJwYo/kizlTvgue83TA/kpSuwZeH4S29eNHa4gxxMFF1BYkpZ64/pNDzCsfyA7+x1Rv84+34/1K+vK427fZQF1dO7NpeT5rRimxAYu/RgkgreXzmNH5PIntZ76aiHQwTcS/eaWlSXu7z6iHMj+dOjQ447jSkVz6KyNJZspNY0geEliWGSFBOYvTaPTFcpO72E5cpxeGbWMYrE0SMtTACk4cEl1ipRiKRRvuf6wk+NSKOTyjjCSfbOdkp7uawSUAGNpUXxp8GJqe2VgUnt3T1/PPq9ZFVa81hYrFPo8AOLDrI2eku0ilyjS7Ez7PMZgnMmIWecp0sx22OypqWDSalKyL3lbMztP4D/NPz5n/NeVlScWzLAb9BpHYeymFuCnYkmlUd55+tl5TvGO+2Pj40Rgtmo1mlXTiwus28CWQmmqMMglSmp9efrc/l7GxVNDjK+N3ozE/LlT5wQsEoCRo9xM4QJtyuD3kS9Zpy/nbBWJjzG+nXo1ONy33CQJ0oOVXdzMnQ0JB3uHR0fPjvxk3NOGvmdcvnBhePRjualh1gyQU5MO0hNSW3aXdZ38kJU1dLH3TM6xjKyz5zI2LF0mWbAKvDBzgY/rsQXqI3a4tZrlbxhjRx3h89LSBGJOFClgJljI82UmJMfLOAKBtootmL18qI/DpqJUBxuhV0OQH5hKlrBMsbU4TrXqHGzXtaldtRwORxTjRBT0fIjsB/x5ZNVMQxGCJM0nz8nTr53Zagh1NoVPC93bvJCnc0aAPe7wIKt1EW2PyRJV7DZMj5CHrAnfW6U2Lpwz/aoXxwGCo6iMynYZJkOQSq3ihWz15+kiTdNsYneVjK6gA5SGojhKY8es400mtprPnzxpEsTkm5PaEQTBEYCgCB1BURotJpgEMQmcGESMvH47VSajARwnVEYV28iUaBLMhCeMCcNMEgwZ1bq5IaCJ1kR1RwSSIUKZMIUVnSuUsBJ2lubCJBIMw9G/AXbV85RKPEmDAAAAAElFTkSuQmCC"},7573:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACmlBMVEUAAAAINTUMP0FvA+9mDOcGLCtNLscEIiIBCQwIMTFqCepDO7w9QbU7Rq8BEhIFJycBGBhiE+FVJNIQTU9aHdZTJ84QLkI2T6cmVoYmT4MHLy8HEBpdGdwtU5UaWWoTN00QQkwOREYONkF3APKSEck3SacyU6UtWZ4rQoO+QnQbOF8VUFwTS1YUP1MUJUULPTwJOjkLMDgOJTj//v358/V6C9yIDtORDNFNLb9FMrE/O7BDJKI8YpszRpsyQpYvTpUoYJEmZo0qVo0kZIcpO3wfUXQlQHQcS2oXVGEaQWETVFgOSkn88ezt4+tqD992DtZYHM795MqMGceXFMWCGcKhksFINL9ORLRgKLJJRLFQH6v2zag8QKc9NqYwT5s4MpdRc5SuMZEtPo46NIwqMnkeZXfaf3UrJnUkOHMpLm4YXWQWS1wRRk8ZFUV/Aezk4up4COX+8OTj1OSHBOONBtr969fNwNRpHM/hw865vch2IsPAqr/XsL6qdb5sL75ENblNN7ZqF7aGd7XotLSXlbLkrbChIbB0KK5dJK5HJK1sdKxHL6i/caWWhKSVip7Se5lIapdGSJZSMZZSYJMwSpAuN4o9LYU0JYQoXoAjXHkeQWwiNmwZMFLTV0gfDDYNFSsOChf15enXzunSueHBid7Iz9ltJNWyqtTJptSZWdRrRcxjHcvk0se8wcKos8FsGsCWqb9eMb+aYb1qW7z827nUmrZRJrTGpK2RRq2rfKlmOamxVahySKivnZ1ghZxuFZxINppRJZmmRJg/J5ivVpVqX5Q6Q5SQcZFgO5E8WY6+aoyAe4aiOYNBGYPHWYIgb34iTXiDTXQtVHFxaW2FLG2SMGwkYGrDSWolImgsDmCWRTzdZDRvNTFgLTDQUIJRAAADMklEQVQ4y9WQ07IdURRFd+/2aZ8+tu1r27HNa8S2bdu2bdvGv6STt1S+ILNqrVW1xnia4D8LxZt3d8R0rvZwzZcOM/UPT7mgkbVWtJVfyjF4iaJw7G+FskMdrKoZkDH35W3PkujIOZVJu/kPEUXqN2+xb5rbb8O6TM8usOejp1+vrF4joy17FABIkjTHHIHA3Z4ez/DPwQ+K/TMY7JnVM3O5bkdqNwmqTfTmUHtpvx5ZEyYM3/n9myL82BnMGt81o8vSVOy+DtiQljzZsHHknSWZo8YPD77o2PV18aIebqmgKlRfj29qAs5kXqh8qIDA0HEUHZPZq1vXjMmLui6tTOIQkmJsAMAdgWTeAFGAg/sMGjw5gyDGuKdNO72D1m234xTFbwZCrRMf3GRy1Fi65BiJLj3OzTx6TBOI2HO4EToXIqZAXEbIUKo5myCI8krm0IFOaen7zucW6Ib69bNHQJ4HUKZFnhwqqRn2ja1hWOeJAy90mvppi9Pg8zOFrmYzkGtJUdzezafXM/37Zy/rNLF797Ent3jL/P6y4hz7oHqw9pHII0MIpu+NK9NXPFmQNu7I/vTRw84+XP/UUGKN5LKg8S1FwYhh3Yr5jVNWXR7YeU3fvr3TTkx//GzG1UFVeJEPjH3OU4JS9/sZC+e/auyefqskf2rawNWrpyy8qQuTttdg9DAeUAJvptcsuH5vZe9J404d7Hx43soHF5e9q3EJbWXgzFYK8FRyhNGn7z/H4M/vnb53Hsf5Zs1i+2ia8agB5FfzgBSbJDXHlRBaRp8/aaZWrcE0rFrlXg4RGZTIJFnlykNRjdfGqrVE8ar1WrVSCoOOQgvjDhk0VLfXGktzUZQwRqyMniu7Zh3CWFhboWTRt1YwHNAS3BCOYzFNJdw2mygt9i62NrCSNgILrMVeDaYCqEqlwjRqbSlMwHC4trVo7dbWivJttoI+hFZC3W6AYSpMUdRsUbXTWVcny3V1MI4gMNANQ1FUhQJllIthWK4DTySccZhIQIgoiW7MtkgYBlAUU2LJLnQIOE7TNPInNIKbENhWYdwAJEyyEJwxGlc+NCKQuMIEATfRNI6blP0L9GTBDZUfhasAAAAASUVORK5CYII="},4321:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACoFBMVEUAAABDFU9MDU88iDVgXqZAH1QeAx0KBg8/kDhra7pVVJI8JlkxKVM3IU5DPXZIJ2E6gTRRUoU9NmxHMGg2MF9AEkk9ezsTEhj59O5ob6ZYaYlJQX1OWXxIRXlUf3JNdWhAMWdKbGRIblxGelZHF1U6IFJcwFEsIUETBxdoca1gaJ1idJlaYpdaaY9Yb4ZMSoRXd31OZXZEN29LOWdUlGIzLFlGZ1ZQp0dJB0ZEjEVGnT8zFD86Cz8vDjYfESv++/nj4NpydKBdXqBVWYxRTYxxjYFYaIFPaXNReHFMYW5IUWxJQ2ZDO2Y+L2BCRF1GI1xKg1lSmFdTq1JKh1FcxU9Yy01ABz8qIDooEjUpBSju7OL039He2tHDw8aqprNna67MyaZjaaVbWZ7srJpcaJXZx5JecI5XX41vcYdSWoZhdYBSYoBehH1MT3lSbnhMO3RFQ3FPcHBITWZOfGRNZ2OTvV9FU11HXlpFcVVASFFLGVHNxE9Rkk9Ef01DdE1GEE1Z00xZuEs3F0dAgEQpKkFAlTkzBzQ4ejMhIy8zAS0PAA7S0cnGvsFubr+Qkq51c67Eu6Cyrp+YnJmtnInhs4iMsYaekIONg31PS3RLVXN1pGpPW2ZUg2Jfh15bol1YfFtMRVvEr1pSi1rG0FlXsldEM1c8QFa/1FRmtlSr1VCiylCFzk9rxU5OoEpNl0gyHUZhXy8ZDCIkOSEZIx/m5+Z4eNB6fLv1xLq1sLjYwK/vuK2op6h/hqDY1J+ux5TNt5KDgpFpZ5GdsYfBv4Xlm4KUmH2epHp3dXWRkGyhsWa2umXNuWOtmWB6Z2Cmoluex1qAglmCklhrrldHgFbaeVY4LlWptVS7oVOQyVKOpUxnzktBXUuApUU3X0E4TkCVkj8EsvciAAADTklEQVQ4y9WMU58bYRhH35nMTDixbTtpsuHa9m5ta217a9u2bdv2V+m0v/aqn6D/m+finPOA/2xkskg03M9g8LkK/rCI/A83Geg0yxyXN6dOxbEvTGH2/1H+Hga9tXBxXt3e9m/Hjf68emWtPl/0m4yMjP7iLaxAsX/eVuPR00D09ajfWLZ3C2s/YYyCwcEErD9/U86O7vLuF3sOfCLskwcOfS7vNrrxd8PxCsAUwI378uf4y8uNZR/b2n78EtoOl/WUlBQHKk1NrcAF79SqObVbVLvLeoyHDzWcOXO69MjBcEiu8O3MjTS1ABas2d/YVKGn+/zhcLDndV0w2H7kmDYXqkAL41hlJ4BZC6BAZ3WCPtOdqSkume8uCW7fvH2foNXHipLJ2HcQ9dKjngJBoa+jvWaBsvjgutvr0pULuPRsCwfFe09FgIEPVfAqc7WZmpm1i2y7r4sTE5PSPXLTLOoyaQ7djAEGXzCCVTeWNkskabK05LGX394dN0FBYyHLqI5NeJ4ZqLmD1VjuVuskqm2mTblcPG3atAsTaFSESp2KZOPWAjA3A8NMdqdzfvqrlU+3XUkcP3mJOGn2/AezM1IRhEc9Bz68JAOGd2r9oxm7xq9ZuTYpOfn8RPGlVQ+f37g/U1GFUMG4DWZyVTwuejZ5xrU9T8aJryIrJiSu3fV48ow1Jm9cRgNnk83AXIWdqry1uqFh/cQlSRfHj126fP37Ozc35qGxRVPBRJoZYKMmWtoUyVx3ClWySjx2tcQ2ZdsOq0dXIODRwCQmBmLVLcJmiyWlRmuZtGLpPXdAFyrKyDoe1uJ6NUDUsZgM/UIh6aa4HIEaJ7JhtjJLZXM6KcFj2QaWGrhkPC6Hk02haGnqFKlVQktPnbewU8qUlxZJmQqPAzRrrPbp06V9usWoL6M+FXFsnpUm7cvysux2ZPqbUAhQSCSSUKfSpNJRlMvkMuVzXbLFBYtk8oVZytKB8ABgs9kkEntI5ZjFHEOMz+ePYeAoRN+oC1EGiJj4QKFQhthsoScfQvV0A8NgYDAgYrwcTVGfcAgQOYkt7Micw0uAYZgAKI7jJ3pPdMH6Qq6CIwcdQmGRah6Hhwq6IKg3Gk2AoUisKhKBYCLoggU/Aep54rZnCVVxAAAAAElFTkSuQmCC"},5945:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAACqVBMVEUAAAAqpB4sqh1iAphdApsmeMorlrA1E69zAJMupVguqkhEBaVVAZ0voZwskJstpjIjYq8lAq81AqZpAJcunJIup2Irpj0pBz0rqBooWbg7JbFHHqZNAqFOEKBYApVsApMwpI9lAYxAYXlgAHkso3NWAW46zCAxuBsFDBMsL74mObkrWK08PKUya5g9QZVfEY9NBIw9F4k5SIhpAIUupIMrlX9LBHoskHY1dGk2hWcvm0490DAtrCkroygJGBojZ9DLyMYqjcQylb/JxL4jJL4neLcxb7O+wbEnP6kxoacocqcohqZMH5sxVZopb5UseY0qiYsrgXqqsHkzBm4mL2wqHGssnGorn0Z30TUOAyk92yNE1CNA4SIvshwRAhsdRckjPckaEMAsFrmqurYwm7QyRrKAma61u6gpMag6I6YnaKJVGaIofKFcnpertJU4SZQqkJDIlIwxWYsuLIMvdX97lnhBBXEtqW49Hm5MrWosgmXTbmEsn2BLAV4oB1dDAFYwA0inuzY1sDU2wTIhAywytyV56SE81yGj8h+P8B8NKhwnbLzJw7WZm7FEirA5HJ3OrpxChZo4O5p1o5ZGNpaRppNCI5KhspBSI45BOIsrl4h4r4RdfXzSh3swZHpDS3QqjmeCt2WwtWTPlGQ7VWR2k2IpmGBjvF85Yl41lluHo1oYMFcbJVJErk00fk1Dwkw5pkQ8vT6PtzwRMTA0uSs1xCpV5yJedhoXPhrc7RgjWcUkar9JdrtCZ7qWrbR/gJ9DbpsZIpUlEZQdVI5HQ4xJlIUjZ4F1aXxWP3qdhHhIHHjCx3EsVHG8xWu/q2efn2dIlGZhYWYjU2A3clsbVFYrGlBkoU0WOUm9yD4gazuRmTjZTzi5mTWZ3itduiYfACVwuB/I8RyPrxtXnw92AAADUUlEQVQ4y9WN45IcYRSGv+me6Z7uYcY2MrZnbVvZ7Mb22nZs27Zt28aVpDeVf7mCPFXnVJ163rcO+M8YWxE7cvp9ce3NmbffnI4d+48/4uKweWyzZEFLgThLl5V++G+k+m+9WO6Qz5wV6mV9jKkMZ9f57HBt7B+jbe8j9NhX2ZoTB2eHDJUXQOyPSiwy2KuRPiES34Ha4xEeRnNqQuPHjR8YGvpGdM4PDRNHJOAqPvLWA0ywcs9GlI2NG2cYHLh48ddo4OfwoKH3DCtYUhx0gInwgyBq0WgKDkYMhoHh8pGRCz3nKo2sXOsat9up2QOkyuA69zY1WbYGr6oyGiJl/f0nz51pscNqGq2h/dExwJXmKA4c01Pldb68e/jZxsazxpPH8Q0Kx51sp1DYeQCoJ6OOuu0OuVXQU2DR9UT279zfjOWg60IM2waXs6MJ0MfQPfYmd4uvUbdgAe/EziXx8VPu5s8uyUtANtmWC7sAbQys1es1OKZiTDNPuJq29XPriqXJl2alJibw8lw1QoBO8uj19jAydaqKxyudt6R1a+uipWKEkpAQRwnUMreB/Fx9uytF5/U2v3v+6cX1+Bnr5ydNucHfsnKumJIiYWaAL3v7qm/NXBw69ax7fn3h7hnLVIzpSYvW7j1VeIiZXpSKgEVbKqqLOoqELwufPv76YUXSlbjEa/G7u7sLdz1sMndMiwNpyyqAsKirqyR1dXl5/er5M6ZPSVs7r7581zzrKrnfSgHTxRWgs6/EJkYQlfdy4tTNSWmbGQzk6NGMQNlGpVQMEk2d1X7tdlYZg0HRtTGQjPWH+BgexVX8qDEoI6OAItE2pGe/hiCcOZHH5+so91fyMcy7yQsZ+3Nl0slggkky2cIugKB9qWiKCsmIa86c7RMsNGWy8LnJZh8ThPcxM5lMXkzZKrk9ULqYknWcPXEhq00yZ24KJSscjQIIIpFiBFgbm0aXocmTJrHzJpjS3VZzbqCUL6gyVgHCi4jBFmYmczhjRuHQZHSYlhOOQpBIJALEhkQkgvzlSrKMQ6PR6RwOFybDc2p24KwYEiDk6I8dtllqqpJLGDKZTnYqFFQqd45kmsUGBCSWoDTfIqWrqTCs0GqVZLLf729wKrhUAi78Gx5i6x+jvtqtAAAAAElFTkSuQmCC"},2425:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAxlBMVEX3APz4cYj4V6D3A+T5dYT3BuH3Bej4XZv3Ra/4U6P3D9v4T6f4ZJT3GtP3OLv3AO73A/P3QbX3Kcj4a433C973FNn3JMv4fH33McL4YZf4Z5H5h3P3S6v4eYD3H9D3M7/3P7T9+B73Pbf5g3f6olv3Et/3Gtz3Hdj3Ftb3LMT5kGz84C/6m2T6rVX80Dz98yH3Cu33Hc/5i3D6mGj7sk77uk37xkH82DT97CX6plv7vkb+/hz3D+f3I9X3L8n5bJL6omL85yoC7QzSAAACeUlEQVQ4y9WSVY4cMRRFbZfLDMWMzdzT3AOh/W8qnslXlBXkyHpXeud+WJbBf0YQvMwX35ZL3UXfly/BP34uhEGs6HqKTEPDbPl3JVgKkUYdyuOwqtWpoUXSvXwZa798sWKxYmhafwMfeV1N65zp4qtBrLXL1WTCz+fz5XWG3UrOZuf6PEVpt/iwIPP8SaaHqnbsrtfcFdB+VudtC/liwQRY+2upJ5OBl9NpvZttlovvcDNtIYuyvvcGA1JfZj0jvojits2nucIt3mBeJEQIYlMOvJVJGmQ9ISmXMK9UnrcYnjyxTr0gsAaQLvVk4aVRDLkpcb3b73BstEYoTIVP5iBZ+SSbF5Sqsi8QfhvfxwfmbMEa6So2cAXPWjLEFUV91NPn+HyOt8LoQTLERE+A7qy166qRklJa4nE8HsfbIIemMSHS0gDe2GDOSqrazf2qLu/b++G4VTEs5RCyE0fghoNg0Rm6375tL2/bZ1mqn+/b62Z/eOURCSUYpwEghHz8ODwe1/vx+CNEt/df97fH4zXNSGTALxqAgLivgHazy+71sN0fnrd6M7vnJhMkm4CfJgAWzAcjOaVhw/fj8YKQhBjRKvK0ATKzgNgCVu5lSoUkOswqd8cYVbiVia9BqAmJ0gbjmK+RUmW4oapSFFGctyzRGvSZ7kzIMS4nmlHJDWQMxShiMG6iAnGgKGecI1itRYRoGPKcFQiqTjQslBWEAEMMYaxUKPzklHXRIPus6KOI0VLBNm8B/IPiLEsderUSSeL7wiiIPwH4M6EDac9PnHRDeL7v6wmN3Rr8sTFlmhDP4X/iwh1xWpsBfNqSG518OWJdEIdrONz8DcHFP4n/xvdzAAAAAElFTkSuQmCC"},898:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAb1BMVEUigWcvjmdrsmhkr2hfrGhTpWg7lmc0kmdDm2d8u2lKn2gqiWeAvmksi2c4k2dZqGhxtWgmhmeNxWl1uGh5umhPomiFwWio02mZy2iy2Gj3/Gni8WnR6Gmhz2jy+Wnr9mnZ7GnI42nC4Gm83Wn+/2rMqbF9AAACIUlEQVQ4y9VRC67cIAwEG4MhBEiA/Pa/2/ufsc4+qVLVE3QUJbZnYsNY/WeYpkEna+VhTsP0D6+dC0jBBsCQgTj9LZmSc44tLpXKDDZD0Hb4Mj+9ppByLYTzbJVe5rLMS7Zh+AqGYUqpn9y8rWuUEq43SRZM1o2DsloTW6pSmbd9X0QA6zovMXrjUnaKdTC2EyGI4rZuyXHb5tgycwgjdeW04ZBH7bjGKKNLjHGLGLSUhsGhGlPXGSU0YExdCkRBszpxGsUaUqOVHkHy2jCAn2/7LdZuLRpKWg9a/NGD1QEEIaB/H7+OZzTkcjZIbpq+gmmgWhADB3gcj8fxDiFRziIQK5IVnks2BgTLcb/fjzeZnnMnTKYrzNOk88ltr72svy6v6/1SqgdDRNag+og1znbYn+/L7X15AJyqz7ZfV8MjGXXM02n36K/X5/66H63j59fj9Xk+d5nOQV1gUtMoY1BsvK3Xy359fGQrr6WzG7mrtSsld6FwnrJnsx/3DY3xHrHIyrsyfI4I5zUJChq4rqWUVlE8N1on1e0wsJM/qmEsALQBFFGjX2LWyarAyXYyMUK3JL17o4wVOdeamdEoACMmYSvsGIHILMSmgXVZ4uK98t63WgqQ09oKyATLgTkjQJXFKt+8oAESO0FKyWmBC+Bj9N8OP0HDNEpd2PMlsAS1taaE8q1VIDuMovgDSZzlTqq2WkHman3Sw6kaBZL+fH4Dv4kk7qhIC7sAAAAASUVORK5CYII="},1217:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAe1BMVEUYAP4YEPMYGe8idcUeXdAcU9UYBPkbRdsYI+sfZM0YKucaOeAgacocTNcYCvYYH+wke8IdWNImiLwZM+QiccchbcgaPd4aQdwlf8Awpa4yr6o2vaMojblI+Ycun7E7zptG9Iork7csmrM+2JdA4JNC5ZFE7Y1K/4U4xJ9hpzG+AAACLUlEQVQ4y9WSR7LcMAwFGQAxZ+UwOfj+JzTm12xsn8C9UYlsvYIAsP+MrosiaZ20bS3x7p97IcRYlLMOYESjrP5T6TQJzcI8KF+9RXBcx2/wx+xcUoMPUKtlfK6+1jkkxxkRydBJTbDX/bYsko5wOe37XiFpQaVYzier1VD3Wm/rOpMA66nOOUsUKXDmuEM9KVVMnettuSbR+mvNfWjWOa5GJjhaFzgXdsh5rrOnT6+5OB6FiJ0ojOtJhBKjQEDsZ+9nSu81F9QLKm9kUVOG48n2soxG1tN6ysOodSkqCYphPPFouQMwZnQgt+N93HMJIgQEJagH4pMUVe+huObM6/J8HZsb04SBBBeZttQJ5xERKCUfx+VybAqnECZVNI6shK4TwdDd/ms1p/fjfL88/SANKhU0AtsyCXaC9bE9btvjZYxZ3o/tup4XbFwhO2rX8Rj5cL7f11+XS69gez9/bfSWbGwje5qOdZxWAU7L7bScn+v5te3X5TyPVnA7sWUkgQk1YjFGYVmPyw0AZQbwjeuRoe1oou7zm8p4QDgvnmocipcZhdBM6cibQCkHbOAp5GqM9wAg5xyE1sxZTcMkwUxaAeIkVYABWugHtA6QGVNCQZDeiQagFGblSm9sCkGhl5JJoh+8UbST1tqm0NEitBbA+D7PmYQffAlWpPRZ+0QqFzRZmeVPwpeiaWu+cEJPMPR9/xUGUJra+YUCfh7WTYr1VIHBSdMRETv+F78BzJImqyQDEWEAAAAASUVORK5CYII="},5187:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTM1IiBoZWlnaHQ9IjE0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBmaWxsPSIjZmZmIj48cmVjdCB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTIwOzExMDsxMDA7OTA7ODA7NzA7NjA7NTA7NDA7MTQwOzEyMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJ5IiBiZWdpbj0iMC41cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSIzMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMjA7MTEwOzEwMDs5MDs4MDs3MDs2MDs1MDs0MDsxNDA7MTIwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InkiIGJlZ2luPSIwLjI1cyIgZHVyPSIxcyIgdmFsdWVzPSIxMDsxNTsyMDsyNTszMDszNTs0MDs0NTs1MDswOzEwIiBjYWxjTW9kZT0ibGluZWFyIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIvPjwvcmVjdD48cmVjdCB4PSI2MCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjE0MCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjBzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjkwIiB5PSIxMCIgd2lkdGg9IjE1IiBoZWlnaHQ9IjEyMCIgcng9IjYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImhlaWdodCIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEwOzE1OzIwOzI1OzMwOzM1OzQwOzQ1OzUwOzA7MTAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PC9yZWN0PjxyZWN0IHg9IjEyMCIgeT0iMTAiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMjAiIHJ4PSI2Ij48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJoZWlnaHQiIGJlZ2luPSIwLjVzIiBkdXI9IjFzIiB2YWx1ZXM9IjEyMDsxMTA7MTAwOzkwOzgwOzcwOzYwOzUwOzQwOzE0MDsxMjAiIGNhbGNNb2RlPSJsaW5lYXIiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ieSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHZhbHVlcz0iMTA7MTU7MjA7MjU7MzA7MzU7NDA7NDU7NTA7MDsxMCIgY2FsY01vZGU9ImxpbmVhciIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48L3JlY3Q+PC9zdmc+"},6331:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAAAqCAMAAACN4OndAAAAqFBMVEUAAADKysrLy8vT09PKysrKysrKysrPz8/KysrKysrMzMzLy8vLy8vKysrKysrJycnJycnKysrKysrLy8vKysrLy8vIyMjMzMzKysrMzMzLy8vMzMzLy8vLy8vKysrLy8vKysrHx8fLy8vKysrLy8vLy8vKysrJycnKysrKysrKysrLy8vKysrLy8vKysrKysrNzc3Pz8/R0dHU1NTW1tbT09PS0tLY2NiaiJAkAAAAL3RSTlMA9aMJ8eTaFuvfNxPGaYYiHfpCW/wnEHIwm0ltj3l+isMF1c2plrJGuDxPvVRfK+IvMiAAAATbSURBVFjDtdiLkpowFAbgg4iCgOIN76ugonhLUNT3f7NycmpbQrDu0P6zM0g2JB8hYBAwO41lsZrwYfTm59Ehl4ND0eFtZFWnVZ4X29XMT6O5kMuGY65r+JYqWGr1snRfPYzS5NOko1xP9pphbqdvquaclWSQzIDSWrY/zbKX66lVp7bgeyqIZ3LcDcNc57MxVI2bYFM8nL5LR1Kp49Ko96B6jpyGXXubE/i+rx9INcTPn6kCWwodp8vFgXTzPphItyQDhuFrcLKEYq+7dpz18iNVcxI28jnucMyPUmk4yY//klTrfkn2pNoDxzDa4zyJ8BY7rl6J+iqVv+eiPoU+D2KwWaGYHf0/VRp1tAB1/JBh0h1g3zRWmrNaOXOA6MapaewhcRWqoUmnXKN0hWUCdPt2IypdMYx2gd85E6oLJTmk1C6dSSzu1wbtTG/iyEbDojYChUrUNztAmV9RVYMaqpIaUDyDYcbwK8FRlDzmZaoVjW87dw96gFlQ274diDpPr0xlvFRfOdUEKLYlq1o/L6AO6sRXhqmPAdx9NI9J5R+j/eGnCme9UKXlKu+tym/Iqjk9rLa/Wkkx919ImlU8wqq3xGmRSn/iF8TnqlY/y8mWVFvvnBXviiqPiWivdjp0iQcvVb9LqiadwC/VnV2/obIO9ewRY4xllcu7XbYvqqKE7spArfJX1M0CKqrwsHqvoLpne0XVmBOiB2rV6SGeo45eUTVVqw63bM+RVcGKYx41KFHt+iJjqKhq4UabyqoeqkJZFZt1jKYrVFIqqYwLbronWTVOsz1TUkn5j6oObgZnSTXppDiESlV/JjJUqVxaNnlVVb6JG1dW+U+srVQNmEisUq05o2n6L1R8VFDhJlWpmoziqVSbROydK6vw9PhXQaXhYbZCNWbkAJWqja1gcxVVdoSqrazSTax9Uaj6ooQ7StXhRkuPoKpqwlFTUIW4MDjpRdVSlCQbpWrIheqoV1Q1vxJ8igeSKsAL+zgrVHtqqK9UeSajc62qOj/weuiyas+xgaCg8ull8NlUqmz6L29WVR3uuFiUVbDhuFtUXWg0NFCqgs3PbiqqvDFO0K4vq+aocqCg6g1o5siq3Ky7LquqmilWKKi+cGsWVbNETPb22/UVNyqqOnDDCmNZNcJtvVlQbbhQnUpUnTr1o5er2h+pTJ6VHxaS6jxA1bCgMl/LcrUKaD/pK1R0ptxyXcFjT/uNaoXPgIWkopcTbSerLjdREDbLVDSWfKNSeQMa6ITW/g0oV4nvrmttJKlaYoVzllVf9OIcQZnqRBUMlQpO1j19JQmH71Qzq9GwCipvhS/zrqwyuCgYlaogoUscA0wStsqrwPZ+x4d3Kt3OUnhegY/F8mzvEIoPy1V7qrLABQSPJJWUctW33gcXhAqhXHW608QKUFX7i2pWSZX/Erwv3qg84WCmDSvOt/F71eQvqrZS1bRyqgsZHr8NrYGs0iPqaQoOT9rlqloYhhZd7fSiVPmjL40WRjnVYRHlf5OZGlYWYyOOn2yzmNSuKVSUmfWzksUf51jjWSz9xu+SyrklScIx1wiUqo72EKikl1NNbvT1svKhmOnzkYUznv09JgEUYxlmL24YWRzdNEwXctmuHcp+pCtVr2XRugV5Ff2WtbVBkdg0XmlQu1J+ABT1EjoBoYiGAAAAAElFTkSuQmCC"},3848:()=>{},4654:()=>{}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.d(r,{default:()=>cd});var e={};n.r(e),n.d(e,{hasBrowserEnv:()=>Dc,hasStandardBrowserEnv:()=>kc,hasStandardBrowserWebWorkerEnv:()=>Oc});var t=n(6618),o=n.n(t),a=n(5720),i=n.n(a),s=n(1063),l=n.n(s);function c(){return(0,s.env)().isMobile||(0,s.env)().isIpad||(0,s.env)().isAndroid?"mobile":"PC"}var u=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},f=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},h=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},p=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function m(e){for(var t=e.split(",")[1],n=atob(t),r=n.length,o=new ArrayBuffer(r),a=new Uint8Array(o),i=0;i<r;i++)a[i]=n.charCodeAt(i);return o}var g=function(e,t){return u(void 0,void 0,void 0,(function(){var n;return d(this,(function(r){try{return n=e.getContext("2d",{willReadFrequently:!0}),e.height=t.height,e.width=t.width,null==n||n.putImageData(t,0,0),[2,Promise.resolve(m(e.toDataURL()))]}catch(e){return[2,Promise.reject(e)]}return[2]}))}))};function v(e){return e.split("?")[0]}function y(e,t){var n=e.includes("isMprDcm=1")?"speM:":["fasM:","staM:","speM:"][t+1],r=e.replace(/((http|https):\/\/[^/]*)|(wadouri:|IM:)|([&?](sign|Signature|Token|Authorization|AccessKeySecret|X-Subject-Token|X-Date|Date|Expires|t|X-Expires-At|isDcm|dicomInfo|isMprDcm|x-oss-process|imageMogr2\/format\/jpeg)[^&^?]*)/gi,"");return{imageTypeEN:n,indexedDBKeyPeel:r,indexedDBKey:n+r}}function b(e,t){var n,r;void 0===t&&(t=1),t-=1;try{for(var o=p(h([],f(Array.from((null==e?void 0:e.childNodes)||[])),!1)),a=o.next();!a.done;a=o.next()){var i=a.value;t&&(null==i?void 0:i.childNodes)&&b(i,t),null==i||i.remove(),i=void 0}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}function x(e,t){var n=document.createElement("a");n.style.display="none",n.setAttribute("target","_blank"),t&&n.setAttribute("download",t),n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function w(e,t){var n=new Date(e),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[o]:("00"+r[o]).substr((""+r[o]).length)));return t}function T(e){if(e&&""!=e){var t=void 0;return e.indexOf("Y")>-1?t=e.replace("Y","岁"):e.indexOf("M")>-1?t=e.replace("M","月"):e.indexOf("W")>-1?t=e.replace("M","周"):e.indexOf("D")>-1&&(t=e.replace("D","天")),t||(t=e+"岁"),t.replace(/^0*/,"")}return""}function I(e){return e&&""!=e?"F"==(e=e.replace(/\s/g,""))?"女":"M"==e?"男":e:""}const S=JSON.parse('{"i8":"1.3.0_20240515"}');var C,E,A=c(),M=((null===(E=null===(C=window.performance)||void 0===C?void 0:C.memory)||void 0===E?void 0:E.jsHeapSizeLimit)||0)/1024/1024/1024,P=S.i8,D={instanceOptions:{},env:A,webDicomView:"",sharedArrayBuffer:void 0,forceIM:!0,imageTypeDefault:"mobile"===A?0:1,_imageType:JSON.parse(localStorage.getItem("imageType")),get imageType(){var e;return null!==(e=this._imageType)&&void 0!==e?e:this.imageTypeDefault},set imageType(e){this._imageType=e,localStorage.setItem("imageType",JSON.stringify(e))},_imageCacheTypeDefault:JSON.parse(localStorage.getItem("imageCacheTypeDefault"))||0,get imageCacheTypeDefault(){return this._imageCacheTypeDefault},set imageCacheTypeDefault(e){this._imageCacheTypeDefault=e,localStorage.setItem("imageCacheTypeDefault",JSON.stringify(e))},logoURL:n(6331),cavanAroundInfo:!0,minRenderCountMPR3D:10,preload:{scroll:!0,scrollNum:9,seriesFetchNum:0,fullLoad:!1},AI:{resultURL:void 0,parseSuccess:!1,active:!1,jumpFirstAI:!1,getParseHandler:void 0},toolsBar:{navigationBottomLayout:!0,seriesBarVisibility:!0,VRTVisibility:!0,MPRVisibility:!0,AIVisibility:!0,enhanceVisibility:!1,aboutUsVisibility:!0,fastImageModeVisibility:void 0,fasModeVisibility:!0,staModeVisibility:!0,majModeVisibility:!0,imageModeVisibility:!0,customMenu:{main:void 0,MPR:void 0,VRT:void 0}},toolsOptions:{toolColor:"#FF7F0E",zoomTool:{minScale:.1,maxScale:100}},systemInfo:{jsHeapSizeLimit:M,performanceLevel:function(e){return e>=3.99?2:e>=2.5?1.5:e?1:.6}(M)},DBCacheImages:{dbName:"ClearDicomView",version:Number(null==P?void 0:P.replace(/[^\d]/g,"").slice(-6)),storeName:"cornerstoneStore",enableDefault:!0,_enable:JSON.parse(localStorage.getItem("enableDBCacheImages")),get enable(){var e;return null!==(e=this._enable)&&void 0!==e?e:this.enableDefault},set enable(e){var t=!!e;this._enable=t,localStorage.setItem("enableDBCacheImages",JSON.stringify(t))}},aboutUs:{imgURl:void 0,description:"给医生用户提供常用2D及MPR影像处理功能，支持多种影像加载模式。",originVersion:P,version:null==P?void 0:P.replace("_","."),copyright:"深圳市巨鼎医疗股份有限公司",tel:"400 800 5557"},toolsData:{main:void 0,MPR:void 0,VRT:void 0},tipRecord:{GPUBenchmarksSuccess:!1,sharedArrayBufferGuide:!1}},k=D.preload,L=D.toolsBar,O=D.AI,R=D.toolsOptions,_=D.systemInfo,N=D.DBCacheImages,B=D.aboutUs;const U=D;var V,F,j=(0,a.importInternal)("util/debounce"),H=t.imageCache.cachedImages,z=t.imageCache.setMaximumSizeBytes,q=(t.imageCache.getCacheInfo,t.imageCache.removeImageLoadObject),W=function(e){e!==t.EVENTS.IMAGE_CACHE_FULL&&(V=e)},G=function(e,n,r){void 0===r&&(r=300);try{if("MPR"===V)return W(e),!1;if(W(e),n||0===U.imageCacheTypeDefault&&U.DBCacheImages.enable&&H.length>r){0;var o=(0,t.getEnabledElements)().map((function(e){var t=e.image;return null==t?void 0:t.imageId})),a=H.map((function(e){return e.imageId})),i=a.length,s=.15*i,l=i-s;return a.forEach((function(e,t){t<=s||t>=l||o.includes(e)||q(e)})),!0}return!1}catch(e){return console.error(e),!1}};F=function(e){var t=1073741824;return e>=2?t:e>=1.5?858993459.2:e>=1?644245094.4:e<1?429496729.6:void 0}(_.performanceLevel)*(N.enable?.8:1),z(F);var Y=j(G,300,{leading:!1,trailing:!0}),Z=n(4705),X=n.n(Z),Q=n(5205),K=n(2695),J=n.n(K),$=function(){return $=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},$.apply(this,arguments)};var ee=function(){return ee=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ee.apply(this,arguments)},te=K.internal.getOptions,ne="";function re(e){var t,n,r,o=e.smallestPixelValue,a=e.largestPixelValue,i=(t=o,n=a,Number.isInteger(t)&&Number.isInteger(n)&&(t>=0?n<=255?r=Uint8Array:n<=65535&&(r=Uint16Array):t>=-128&&n<=127?r=Int8Array:t>=-32768&&n<=32767&&(r=Int16Array)),r||Float32Array);if(!i)throw new Error("Could not apply a typed array to the pixel data");var s=new i(e.pixelData);e.pixelData=s}const oe=function(e,n,r){void 0===r&&(r={});var o=!0;if(void 0!==r.useRGBA&&(o=r.useRGBA),r.preScale={enabled:!(!r.preScale||void 0===r.preScale.enabled)&&r.preScale.enabled},!n)return Promise.reject(new Error("The file does not contain image data."));var a=document.createElement("canvas");if(r.preScale.enabled){var i=function(e,t){var n=e.get("modalityLutModule",t)||{},r=(e.get("generalSeriesModule",t)||{}).modality,o={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:r},a=e.get("scalingModule",t)||{};return $($({},o),"PT"===r&&{suvbw:a.suvbw})}(t.metaData,e);i&&(r.preScale=ee(ee({},r.preScale),{scalingParameters:i}))}var s=te().decodeConfig,l=t.metaData.get("generateGrayImageModule",e),c=(new Date).getTime(),u=K.webWorkerManager.addTask("encryptionPngDecode",{buffer:n,info:ee(ee({},l),{isIM:!0})}).promise,d=s.use16BitDataType;return new Promise((function(i,s){u.then((function(l){var u=l.data,f=l.isPng,h=l.width,p=l.height,m=(new Date).getTime(),g=(0,K.getImageFrame)(e),v=(0,K.isColorImage)(g.photometricInterpretation),y=!1;if(f||(g.pixelData=u,g.pixelDataLength=u.length),g.decodeTimeInMS=m-c,v||f){(0,Q.arrayBufferToImage)(n).then((function(t){i((0,Q.createImage)(t,e,r))}),s)}else{var b=t.metaData.get("imagePlaneModule",e)||{},x=t.metaData.get("voiLutModule",e)||{},w=t.metaData.get("modalityLutModule",e)||{},T=t.metaData.get("sopCommonModule",e)||{};if(r.targetBuffer){var I=void 0,S=void 0,C=r.targetBuffer,E=C.offset,A=void 0===E?0:E,M=C.length,P=r.targetBuffer,D=P.arrayBuffer,k=P.type,L=g.imageFrameLength,O=w.rescaleIntercept;switch(M=null!=M?M:L-A,k){case"Uint8Array":I=Uint8Array;break;case d&&"Uint16Array":I=Uint16Array;break;case d&&"Int16Array":I=Int16Array;break;case"Float32Array":I=Float32Array;break;default:throw new Error("target array for image does not have a valid type.")}if(M!==g.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");if(S=D?new I(D,A,M):new I(g.pixelData),M!==g.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");if(O)for(var R=0;R<S.length;R++)S[R]=S[R]+O;g.pixelData=S,y=!0}var _=(0,K.getMinMax)(g.pixelData);g.smallestPixelValue=_.min,g.largestPixelValue=_.max,y||re(g);var N=g.columns,B=g.rows;h===N&&p===B||(g.columns=h,g.rows=p,console.warn("Image row col is inconsistent",{columns:N,rows:B,width:h,height:p}));var U,V={imageId:e,color:v,columnPixelSpacing:b.columnPixelSpacing,columns:g.columns,height:g.rows,preScale:g.preScale,intercept:w.rescaleIntercept?w.rescaleIntercept:0,slope:w.rescaleSlope?w.rescaleSlope:1,invert:"MONOCHROME1"===g.photometricInterpretation,minPixelValue:g.smallestPixelValue,maxPixelValue:g.largestPixelValue,rowPixelSpacing:b.rowPixelSpacing,rows:g.rows,sizeInBytes:g.pixelData.byteLength,width:g.columns,windowCenter:x.windowCenter?x.windowCenter[0]:void 0,windowWidth:x.windowWidth?x.windowWidth[0]:void 0,voiLUTFunction:x.voiLUTFunction?x.voiLUTFunction:void 0,decodeTimeInMS:g.decodeTimeInMS,floatPixelData:void 0,imageFrame:g,rgba:v&&o,getPixelData:function(){return g.pixelData},getCanvas:void 0,numComps:void 0};if(V.color&&(V.getCanvas=function(){return ne===e||(a.height=V.rows,a.width=V.columns,a.getContext("2d",{willReadFrequently:!0}).putImageData(g.imageData,0,0),ne=e),a}),w.modalityLUTSequence&&w.modalityLUTSequence.length>0&&("1.2.840.10008.5.1.4.1.1.12.1"!==(U=T.sopClassUID)&&"1.2.840.10008.5.1.4.1.1.12.2.1"!==U)&&(V.modalityLUT=w.modalityLUTSequence[0]),x.voiLUTSequence&&x.voiLUTSequence.length>0&&(V.voiLUT=x.voiLUTSequence[0]),V.color&&(V.windowWidth=255,V.windowCenter=127),void 0===V.windowCenter||void 0===V.windowWidth){var F=V.maxPixelValue*V.slope+V.intercept,j=V.minPixelValue*V.slope+V.intercept;V.windowWidth=F-j,V.windowCenter=(F+j)/2}i(V)}}),s)}))};var ae=K.internal.getOptions;const ie=function(e,n,r,o){void 0===r&&(r={}),void 0===o&&(o={});var a=new XMLHttpRequest,i=ae(),s=function(e){if("function"==typeof i.errorInterceptor){var t=new Error("request failed");t.request=e,t.response=e.response,t.status=e.status,i.errorInterceptor(t)}},l=new Promise((function(l,c){i.open(a,e,r,o),a.responseType="arraybuffer";var u=i.beforeSend(a,n,r,o),d=Object.assign({},r,u);Object.keys(d).forEach((function(t){null!==d[t]&&("Accept"===t&&-1!==e.indexOf("accept=")||a.setRequestHeader(t,d[t]))})),o.deferred={resolve:l,reject:c},o.url=e,o.imageId=n,a.onloadstart=function(r){i.onloadstart&&i.onloadstart(r,o);var a={url:e,imageId:n};(0,t.triggerEvent)(t.events,"cornerstoneimageloadstart",a)},a.onloadend=function(r){i.onloadend&&i.onloadend(r,o);var a={url:e,imageId:n};(0,t.triggerEvent)(t.events,"cornerstoneimageloadend",a)},a.onreadystatechange=function(e){i.onreadystatechange?i.onreadystatechange(e,o):4===a.readyState&&(200===a.status?i.beforeProcessing(a).then(l).catch((function(){s(a),c(a)})):(s(a),c(a)))},a.onprogress=function(r){var a,s,l=r.loaded;r.lengthComputable&&(a=r.total,s=Math.round(l/a*100)),i.onprogress&&i.onprogress(r,o);var c={url:e,imageId:n,loaded:l,total:a,percentComplete:s};(0,t.triggerEvent)(t.events,t.EVENTS.IMAGE_LOAD_PROGRESS,c)},a.onerror=function(){s(a),c(a)},a.onabort=function(){s(a),c(a)},a.send()}));return l.xhr=a,l};var se=K.wadouri.parseImageId;const le=function(e,t){void 0===t&&(t={});var n=se(e),r=ie(n.url,e),o=(new Date).getTime();return{promise:new Promise((function(n,a){r.then((function(r){try{var i=(new Date).getTime();oe(e,r,t).then((function(t){var r=(new Date).getTime();t.sharedCacheKey=e,t.loadTimeInMS=i-o,t.totalTimeInMS=r-o,n(t)}),a)}catch(e){a({error:e,buffer:r})}}),a)})),cancelFn:function(){r.xhr.abort()}}};const ce=function(e){e.registerImageLoader("IM",le)};var ue=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},de=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},fe=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},he=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},pe=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},me=N.dbName,ge=N.storeName,ve=N.version,ye=new s.IndexedDB(me,ge,ve),be=new s.Once((function(e){var t=[],n=function(e,t){var n,r;try{for(var o=fe(e.slice(0,t)),a=o.next();!a.done;a=o.next()){var i=a.value;ye.dispatch("delete",{},i)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}};ye.dispatch("count",{mode:"readonly"}).then((function(r){if(r>5e3){var o=Math.ceil(r*String.prototype.slice.call(r,0,1)*.1);ye.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.upperBound("".concat(e,"_0"))).then((function(r){t=r,r.length>=o?n(t,o):ye.dispatch("getAllKeys",{mode:"readonly"},IDBKeyRange.lowerBound("".concat(e,"_z"))).then((function(e){t=pe(pe([],he(t),!1),he(e),!1),n(t,o)}))}))}r>15e3&&(console.info("IndexedDB数据量超过15000，执行清理中"),ye.dispatch("clear"))}))})),xe=indexedDB||webkitIndexedDB||mozIndexedDB||msIndexedDB,we=function(){return ue(void 0,void 0,void 0,(function(){return de(this,(function(e){switch(e.label){case 0:return[4,ye.open()];case 1:return e.sent(),be.run("com"),[2]}}))}))};try{xe.databases().then((function(e){return ue(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,s;return de(this,(function(l){try{for(t=fe(e),n=t.next();!n.done;n=t.next())if(r=n.value,o=r.name,a=r.version,o===me&&a!==ve){xe.deleteDatabase(o),console.info("indexedDB is upgraded to version "+ve);break}}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return we(),[2]}))}))}))}catch(e){we(),console.error(e)}const Te=ye;var Ie=n(1077),Se=n.n(Ie),Ce=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Ee=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Ae=new Map;const Me=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Ae.get(e);return o?o.apply(void 0,Ee([],Ce(n),!1)):(Ae.set(e,t),t.apply(void 0,Ee([],Ce(n),!1)))};var Pe=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},De=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};const ke=function(e,t,n,r,o){var a;void 0===n&&(n="error"),void 0===r&&(r=[void 0,void 0]);for(var i=[],l=5;l<arguments.length;l++)i[l-5]=arguments[l];var c=500*t.length+2e3;Me(e,(0,s.throttle)((function(){var e;null==o||o.apply(void 0,De([],Pe(i),!1)),Se()[n]({title:t,timeout:null!==(e=r[1])&&void 0!==e?e:c})}),null!==(a=r[0])&&void 0!==a?a:c,{trailing:!1}))};var Le=function(){return Le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Le.apply(this,arguments)},Oe=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Re=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};o()._renderWebImage=t.renderWebImage,o().renderWebImage=void 0;var _e=XMLHttpRequest.prototype,Ne=_e.open;_e.open=function(e,t,n,r,o){this._url=t,Ne.apply(this,[e,t,n,r,o])};var Be=function(){var e=!0;try{new OffscreenCanvas(0,0)}catch(t){e=!1}return e}(),Ue=.5*(navigator.hardwareConcurrency||1)-(_.performanceLevel<=1.5?1:0),Ve=function(e){return Oe(void 0,void 0,void 0,(function(){var t,n,r,o,a;return Re(this,(function(i){switch(i.label){case 0:return t=-1===U.imageType,n=y(e,U.imageType),r=n.indexedDBKey,o=n.indexedDBKeyPeel,N.enable?(a=void 0,[4,Te.open()]):[3,6];case 1:return i.sent(),t?[4,Te.dispatch("get",{mode:"readonly"},"staM:"+o)]:[3,3];case 2:a=i.sent(),i.label=3;case 3:return a?[3,5]:[4,Te.dispatch("get",{mode:"readonly"},r)];case 4:a=i.sent(),i.label=5;case 5:return a?[2,Promise.resolve(a)]:[2,Promise.reject({indexedDBKey:r})];case 6:return[2,Promise.reject({indexedDBKey:r})]}}))}))},Fe=function(e){e.addEventListener("error",(function(e){ke("xhrError",navigator.onLine?"影像获取失败，请稍后再试":"网络连接失败"),console.error(e)})),e.addEventListener("timeout",(function(){ke("xhrTimeout","影像获取失败，请稍后再试")}))};Q.external.cornerstone=o(),K.external.cornerstone=o(),K.external.dicomParser=X(),ce(o()),(0,Q.configure)({beforeSend:function(e){return Oe(void 0,void 0,void 0,(function(){var t,n;return Re(this,(function(r){switch(r.label){case 0:e._send=e.send,e.send=function(){},e.timeout=3e4,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Ve(e._url)];case 2:return t=r.sent(),Object.defineProperty(e,"response",{writable:!0}),e.response=t,e.onload(e),e=void 0,[3,4];case 3:return n=r.sent(),e._onload=e.onload,e.onload=function(){},Fe(e),e.addEventListener("load",(function(){return Oe(void 0,void 0,void 0,(function(){var t,r,a,i,s,l,c,u,d,f;return Re(this,(function(h){switch(h.label){case 0:return t=!0,!1,(a=o().metaData.get("generateGrayImageModule",e._url))?(i=a.photometricInterpretation,s=a.bitsAllocated,l=a.blocks,(r=l>1)&&(t=!1,ke("multiImage","暂不支持分片处理，请切换到专业模式")),r||(m=s,(p=i)?(0,K.isColorImage)(p):m<=8)?[3,4]:(Be||ke("isOffscreenCanvasSupported","当前浏览器版本过低，请升级浏览器版本或者切换至专业模式！"),[4,K.webWorkerManager.addTask("encryptionPngDecode",{buffer:e.response,info:Le({},a)}).promise])):[3,4];case 1:return c=h.sent(),u=c.data,d=c.isImageData,Object.defineProperty(e,"response",{writable:!0}),d?[4,g(document.createElement("canvas"),u)]:[3,3];case 2:u=h.sent(),h.label=3;case 3:e.response=u,h.label=4;case 4:return e._onload(e),f=n.indexedDBKey,t&&f&&e.response.byteLength&&Te.dispatch("put",{},e.response,f),e=void 0,[2]}var p,m}))}))})),e._send(),[3,4];case 4:return[2]}}))}))}}),(0,K.configure)({useWebWorkers:!0,strict:!0,decodeConfig:{convertFloatPixelDataToInt:!0,use16BitDataType:!1},beforeSend:function(e,t,n,r){return Oe(void 0,void 0,void 0,(function(){var t,n;return Re(this,(function(o){switch(o.label){case 0:e._send=e.send,e.send=function(){},e.timeout=3e4,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Ve(e._url)];case 2:return t=o.sent(),r.deferred.resolve(t),e=void 0,[3,4];case 3:return n=o.sent(),Fe(e),e.addEventListener("load",(function(){var t=n.indexedDBKey;t&&e.response.byteLength&&Te.dispatch("put",{},e.response,t),e=void 0})),e._send(),[3,4];case 4:return[2]}}))}))}}),K.webWorkerManager.initialize({maxWebWorkers:Math.max(Math.floor(Ue),1),startWebWorkersOnDemand:!0,taskConfiguration:{decodeTask:{initializeCodecsOnStartup:!0,strict:!0,loadCodecsOnStartup:!0},decodingoldPlatformImages:{}},webWorkerTaskPaths:["./encryptionPngDecode.worker.js"]});var je,He=n(3605),ze=n.n(He),qe=n(352),We=n.n(qe),Ge=(je=function(e,t){return je=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},je(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}je(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ye=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Ze=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Xe=(0,a.importInternal)("base/BaseTool"),Qe=(0,a.importInternal)("util/debounce"),Ke=(0,a.importInternal)("tools/cursors").panCursor,Je=function(e){function n(n){void 0===n&&(n={});var r=this,o={name:"Blur",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Ke};return(r=e.call(this,n,o)||this).touchDragCallback=r._dragCallback.bind(r),r.mouseDragCallback=r._dragCallback.bind(r),r.lazy=!1,r.updateViewport=Qe((function(e){var n=e.detail,o=n.element,i=n.deltaPoints.page.y,s=(0,t.getViewport)(o);if(s.blur||(s.blur=0),r.lazy=!1,i<0)s.blur+=1,s.blur>9&&(s.blur=9);else{if(!(i>0))return;s.blur-=1,s.blur<0&&(s.blur=0)}a.external.cornerstone.setViewport(o,s)}),300),r.updateCavansLazy=Qe((function(e){r.updateCavans(e)}),300),r}return Ge(n,e),n.prototype.updateCavans=function(e){return Ye(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,l,c;return Ze(this,(function(u){switch(u.label){case 0:return t=e.detail,n=t.enabledElement,r=t.viewport,o=t.canvasContext,a=r.blur,t&&n&&a?(i=o.canvas.width,s=o.canvas.height,l=o.getImageData(0,0,i,s),[4,K.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"blur",sigma:a}}).promise]):[2];case 1:return c=u.sent(),o.putImageData(c,0,0),[2]}}))}))},n.prototype.renderToolData=function(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)},n.prototype._dragCallback=function(e){this.updateViewport(e)},n}(Xe);const $e=Je;var et=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),tt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},nt=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},rt=(0,a.importInternal)("base/BaseTool"),ot=(0,a.importInternal)("util/debounce"),at=(0,a.importInternal)("tools/cursors").panCursor,it=function(e){function n(n){void 0===n&&(n={});var r=this,o={name:"Sharpen",supportedInteractionTypes:["Mouse","Touch"],svgCursor:at};return(r=e.call(this,n,o)||this).touchDragCallback=r._dragCallback.bind(r),r.mouseDragCallback=r._dragCallback.bind(r),r.lazy=!1,r.updateViewport=ot((function(e){var n=e.detail,o=n.element,i=n.deltaPoints.page.y,s=(0,t.getViewport)(o);if(s.sharpen||(s.sharpen=0),r.lazy=!1,i<0)s.sharpen+=1,s.sharpen>11&&(s.sharpen=11);else{if(!(i>0))return;s.sharpen-=1,s.sharpen<0&&(s.sharpen=0)}a.external.cornerstone.setViewport(o,s)}),300),r.updateCavansLazy=ot((function(e){r.updateCavans(e)}),300),r}return et(n,e),n.prototype.updateCavans=function(e){return tt(this,void 0,void 0,(function(){var t,n,r,o,a,i,s,l,c;return nt(this,(function(u){switch(u.label){case 0:return t=e.detail,n=t.enabledElement,r=t.viewport,o=t.canvasContext,a=r.sharpen,t&&n&&a?(i=o.canvas.width,s=o.canvas.height,l=o.getImageData(0,0,i,s),[4,K.webWorkerManager.addTask("opencvDecode",{imageData:l,info:{kernelType:"sharpen",sigma:a}}).promise]):[2];case 1:return c=u.sent(),o.putImageData(c,0,0),[2]}}))}))},n.prototype.renderToolData=function(e){if(this.lazy)return this.updateCavansLazy(e);this.lazy=!0,this.updateCavans(e)},n.prototype._dragCallback=function(e){this.updateViewport(e)},n}(rt);const st=it;var lt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ct=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},ut=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},dt=(0,a.importInternal)("base/BaseAnnotationTool"),ft=(0,a.importInternal)("manipulators/moveHandle"),ht=(0,a.importInternal)("drawing/getNewContext"),pt=(0,a.importInternal)("drawing/draw"),mt=(0,a.importInternal)("drawing/drawHandles"),gt=(0,a.importInternal)("drawing/drawLinkedTextBox"),vt=(0,a.importInternal)("util/triggerEvent"),yt=(0,a.importInternal)("util/getRGBPixels"),bt=(0,a.importInternal)("util/calculateSUV"),xt=(0,a.importInternal)("util/getLogger"),wt=(0,a.importInternal)("util/throttle"),Tt=(0,a.importInternal)("tools/cursors").probeCursor,It=xt("tools:annotation:ProbeTool"),St=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"ProbeCT",supportedInteractionTypes:["Mouse","Touch"],svgCursor:Tt,configuration:{drawHandles:!0,renderDashed:!1}};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=wt(n.updateCachedStats,110),n}return lt(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:t.x,y:t.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}It.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.end;if(o||It.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.end);return a.external.cornerstoneMath.point.distance(s,n)<i},t.prototype.updateCachedStats=function(e,t,n){var r=Math.round(n.handles.end.x),o=Math.round(n.handles.end.y),i={};r>=0&&o>=0&&r<e.columns&&o<e.rows&&(i.x=r,i.y=o,e.color?i.storedPixels=yt(t,r,o,1,1):(i.storedPixels=a.external.cornerstone.getStoredPixels(t,r,o,1,1),i.sp=i.storedPixels[0],i.mo=i.sp*e.slope+e.intercept,i.suv=bt(e,i.sp))),n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.renderDashed,s=(0,a.getToolState)(e.currentTarget,this.name);if(s)for(var l=ht(n.canvasContext.canvas),c=n.image,u=n.element,d=(0,a.getModule)("globalConfiguration").configuration.lineDash,f=function(e){var r=s.data[e];if(!1===r.visible)return"continue";pt(l,(function(e){var s=a.toolColors.getColorIfActive(r);if(t.configuration.drawHandles){var l={handleRadius:o,color:s};i&&(l.lineDash=d),mt(e,n,r.handles,l)}!0===r.invalidated&&(r.cachedStats?t.throttledUpdateCachedStats(c,u,r):t.updateCachedStats(c,u,r));var f,h=[],p=r.cachedStats,m=p.x,g=p.y,v=p.storedPixels,y=p.sp,b=p.mo,x=p.suv;if(m>=0&&g>=0&&m<c.columns&&g<c.rows){if(f="X: ".concat(m,", Y: ").concat(g),c.color?h.push("R: ".concat(v[0]," G: ").concat(v[1]," B: ").concat(v[2])):(h.push("SP: ".concat(y," HU")),h.push("MO: ".concat(parseFloat(b.toFixed(3))," HU")),x&&h.push(" SUV: ".concat(parseFloat(x.toFixed(3))," HU"))),!r.handles.textBox.hasMoved){var w={x:r.handles.end.x,y:r.handles.end.y};r.handles.textBox.x=w.x,r.handles.textBox.y=w.y}var T=a.toolStyle.getToolWidth();gt(e,u,r.handles.textBox,ut([f],ct(h),!1),r.handles,(function(){return[{x:r.handles.end.x,y:r.handles.end.y}]}),s,T,10,!0)}}))},h=0;h<s.data.length;h++)f(h)},t.prototype.addNewMeasurement=function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r=e.detail,o=r.element,i=this.createNewMeasurement(r);i&&((0,a.addToolState)(o,this.name,i),a.external.cornerstone.updateImage(o),ft(r,this.name,i,i.handles.end,this.options,t,(function(e){if(e){var t=a.EVENTS.MEASUREMENT_COMPLETED,r={toolName:n.name,toolType:n.name,element:o,measurementData:i};vt(o,t,r)}else(0,a.removeToolState)(o,n.name,i)})))},t}(dt);const Ct=St;var Et=(0,a.importInternal)("drawing/path");function At(e,n,r,o,a,i,s){void 0===i&&(i="pixel"),"pixel"===i&&(r=(0,t.pixelToCanvas)(n,r)),Et(e,a,(function(e){e.arc(r.x,r.y,o,0,2*Math.PI)})),s&&Et(e,a,(function(e){e.font="".concat(o,"px lighter"),e.fillStyle="#ceff82";var t=e.measureText(s).width>>1;e.fillText(s,r.x-t,r.y+t)}))}var Mt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pt=(0,a.importInternal)("base/BaseAnnotationTool"),Dt=(0,a.importInternal)("tools/cursors").circleRoiCursor,kt=(0,a.importInternal)("drawing/getNewContext"),Lt=(0,a.importInternal)("drawing/draw"),Ot=(0,a.importInternal)("drawing/setShadow"),Rt=(0,a.importInternal)("util/calculateSUV"),_t=(0,a.importInternal)("util/ellipseUtils").calculateEllipseStatistics,Nt=(0,a.importInternal)("util/getROITextBoxCoords"),Bt=(0,a.importInternal)("util/throttle"),Ut=(0,a.importInternal)("util/getPixelSpacing"),Vt=function(e){function t(t){void 0===t&&(t={});var n=this,r=t.markerFlag,o=void 0===r?"L":r,a={name:"Ann"+o,supportedInteractionTypes:["Mouse","Touch"],svgCursor:Dt,configuration:{renderDashed:!1,hideHandlesIfMoving:!0,type:o}};return(n=e.call(this,t,a)||this).markerFlag=o,n.throttledUpdateCachedStats=Bt(n.updateCachedStats,0),n}return Mt(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end,i=a.external.cornerstoneMath.point.distance;if(o||console.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var s="mouse"===r?15:25,l=a.external.cornerstone.pixelToCanvas(e,t.handles.start),c=a.external.cornerstone.pixelToCanvas(e,t.handles.end),u=i(l,n),d=i(l,c);return u>d-s/2&&u<d+s/2},t.prototype.updateCachedStats=function(e,t,n){var r=(a.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=Ut(e),i=function(e,t,n,r,o){var i,s=(u=n.start,d=n.end,f=(0,We().point.distance)(u,d),{left:Math.floor(Math.min(u.x-f,d.x)),top:Math.floor(Math.min(u.y-f,d.y)),width:2*f,height:2*f}),l=a.external.cornerstone.getPixels(t,s.left,s.top,s.width,s.height),c=_t(l,s);var u,d,f;"PT"===r&&(i={mean:Rt(e,c.mean,!0)||0,stdDev:Rt(e,c.stdDev,!0)||0});return{area:Math.PI*(s.width*(o.colPixelSpacing||1)/2)*(s.height*(o.rowPixelSpacing||1)/2)||0,count:c.count||0,mean:c.mean||0,variance:c.variance||0,stdDev:c.stdDev||0,min:c.min||0,max:c.max||0,meanStdDevSUV:i}}(e,t,n.handles,r,o);n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name);if(n){var r=a.external.cornerstoneMath.point.distance,o=e.detail,i=o.image,s=o.element,l=o.canvasContext,c=this.configuration.renderDashed,u=kt(l.canvas),d=(0,a.getModule)("globalConfiguration").configuration.lineDash;Lt(u,(function(e){for(var l=0;l<n.data.length;l++){var u=n.data[l];if(!1!==u.visible){var f=a.toolColors.getColorIfActive(u)||"#ff8000";Ot(e,t.configuration);var h=a.external.cornerstone.pixelToCanvas(s,u.handles.start),p=a.external.cornerstone.pixelToCanvas(s,u.handles.end),m=r(h,p),g={color:f,lineDash:void 0};if(c&&(g.lineDash=d),At(e,s,u.handles.start,m,g,"pixel",t.markerFlag),!0===u.invalidated&&(u.cachedStats?t.throttledUpdateCachedStats(i,s,u):t.updateCachedStats(i,s,u)),!u.handles.textBox.hasMoved){var v=Nt(o.viewport,u.handles);Object.assign(u.handles.textBox,v)}}}}))}},t}(Pt);const Ft=Vt;var jt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ht=function(){return Ht=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ht.apply(this,arguments)},zt=(0,a.importInternal)("base/BaseAnnotationTool"),qt=(0,a.importInternal)("drawing/getNewContext"),Wt=(0,a.importInternal)("drawing/draw"),Gt=(0,a.importInternal)("drawing/setShadow"),Yt=(0,a.importInternal)("drawing/drawLine"),Zt=(0,a.importInternal)("drawing/drawLinkedTextBox"),Xt=(0,a.importInternal)("drawing/drawHandles"),Qt=(0,a.importInternal)("util/lineSegDistance"),Kt=(0,a.importInternal)("util/getLogger"),Jt=(0,a.importInternal)("util/throttle"),$t=(0,a.importInternal)("util/getPixelSpacing"),en=Kt?Kt("tools:annotation:LengthTool"):console,tn=(0,a.importInternal)("tools/cursors").bidirectionalCursor,nn=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Heartratio",supportedInteractionTypes:["Mouse","Touch"],svgCursor:tn,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=Jt(n.updateCachedStats,110),n}return jt(t,e),t.prototype.createNewMeasurement=function(e){var t=e||{currentPoints:{}},n=t.currentPoints.image,r=t.image;if(n){var o=n.x,a=n.y,i=r||{},s=i.columns,l=i.rows;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:o,y:a,highlight:!0,active:!1},end:{x:o,y:a,highlight:!0,active:!0},start2:{x:.6*o,y:Math.min(1.35*a,.9*l),highlight:!0,active:!1},end2:{x:Math.min(1.75*o,s),y:Math.min(1.35*a,.9*l),highlight:!0,active:!0},start3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},end3:{x:0,y:0,drawnIndependently:!0,highlight:!1,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}en.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){if(!((null==t?void 0:t.handles.start)&&(null==t?void 0:t.handles.end)))return en.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1;if(!1===t.visible)return!1;var o="mouse"===r?15:25;return Qt(e,t.handles.start,t.handles.end,n)<o||Qt(e,t.handles.start2,t.handles.end2,n)<o||Qt(e,t.handles.start3,t.handles.end3,n)<o},t.prototype.updateCachedStats=function(e,t,n){var r=$t(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=n.handles,s=i.start,l=i.end,c=i.start2,u=i.end2,d=Math.abs(l.x-s.x)*(a||1),f=Math.abs(u.x-c.x)*(o||1),h=d>f?f/d:d/f;n.ratio=h,n.handles.start3.x=(s.x+l.x)/2,n.handles.start3.y=(s.y+l.y)/2,n.handles.end3.x=(c.x+u.x)/2,n.handles.end3.y=(c.y+u.y)/2,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=(0,a.getToolState)(e.currentTarget,this.name);if(c)for(var u=qt(n.canvasContext.canvas),d=n.image,f=n.element,h=a.toolStyle.getToolWidth(),p=(0,a.getModule)("globalConfiguration").configuration.lineDash,m=function(e){var r=c.data[e],m=r.handles,g=m.start,y=m.end,b=m.start2,x=m.end2,w=m.start3,T=m.end3;if(!1===r.visible)return"continue";Wt(u,(function(e){Gt(e,t.configuration);var c=a.toolColors.getColorIfActive(r),u={color:c,lineDash:void 0};l&&(u.lineDash=p),Yt(e,f,g,y,u),Yt(e,f,b,x,u),Yt(e,f,w,T,Ht(Ht({},u),{lineDash:p}));var m={color:c,handleRadius:o,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&r.active&&Xt(e,n,r.handles,m),!r.handles.textBox.hasMoved){var I={x:(w.x+T.x)/2,y:(w.y+T.y)/2};r.handles.textBox.x=I.x,r.handles.textBox.y=I.y}!0===r.invalidated&&(r.ratio?t.throttledUpdateCachedStats(d,f,r):t.updateCachedStats(d,f,r)),Zt(e,f,r.handles.textBox,"ratio:".concat(r.ratio.toFixed(3)),r.handles,v,c,h,5,!0)}))},g=0;g<c.data.length;g++)m(g);function v(e){var t=e.start,n=e.end,r=e.start2,o=e.end2,a=e.start3,i=e.end3;return[{x:(a.x+i.x)/2,y:(a.y+i.y)/2},t,n,r,o]}},t}(zt);const rn=nn;var on=function(){return on=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},on.apply(this,arguments)};function an(e,t,n,r,o){void 0===r&&(r="");return new Promise((function(a,i){Se().question(on({class:"mobile"===U.env?"custom-iziToast-question-mobile":"custom-iziToast-question",close:!1,drag:!1,timeout:!1,overlay:!0,theme:"dark",color:"unset",message:e,position:"topCenter",icon:"",inputs:[['<input type="text" value=\''.concat(r,"' maxLength=100 placeholder='请输入' >"),"keyup",function(e,t,n,r){""!==n.value&&(n.placeholder="请输入")},!0]],buttons:[["<button class='confirm' >确定</button>",function(e,r,o,i,l){var c=l[0].value;if(function(e){var n=!0;switch((0,s.dataType)(t)){case"RegExp":n=t.test(e);break;case"function":n=t(e);break;default:console.error("verification is necessary, interceptor required for RegExp or Function")}return n}(c))return e.destroy(),void a(c);l[0].value="",l[0].placeholder=n},!1],["<button class='cancel' >取消</button>",function(e,t,n,r){e.hide({},t,"cancel")},!1]],onClosing:function(e,t,n){"confirm"!==n&&a(null)}},o))}))}var sn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ln=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},cn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},un=(0,a.importInternal)("base/BaseAnnotationTool"),dn=(0,a.importInternal)("manipulators/moveNewHandle"),fn=(0,a.importInternal)("util/pointInsideBoundingBox"),hn=(0,a.importInternal)("util/lineSegDistance"),pn=(0,a.importInternal)("util/triggerEvent"),mn=(0,a.importInternal)("drawing/drawLinkedTextBox"),gn=(0,a.importInternal)("drawing/getNewContext"),vn=(0,a.importInternal)("drawing/draw"),yn=(0,a.importInternal)("drawing/setShadow"),bn=(0,a.importInternal)("drawing/drawArrow"),xn=(0,a.importInternal)("drawing/drawHandles"),wn=(0,a.importInternal)("drawing/textBoxWidth"),Tn=(0,a.importInternal)("tools/cursors").arrowAnnotateCursor,In=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Cn,changeTextCallback:En,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:Tn};return(n=e.call(this,t,r)||this).preventNewMeasurement=!1,n}return sn(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){if(!1===t.visible)return!1;var o="mouse"===r?15:25;return hn(e,t.handles.start,t.handles.end,n)<o},t.prototype.updateCachedStats=function(){},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=n.element,o=n.enabledElement,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=i.renderDashed,d=(0,a.getToolState)(r,this.name);if(d){var f,h=e.detail.canvasContext.canvas,p=gn(h),m=a.toolStyle.getToolWidth();u&&(f=(0,a.getModule)("globalConfiguration").configuration.lineDash);for(var g=function(n){var i=d.data[n];if(!1===i.visible)return"continue";vn(p,(function(n){yn(n,t.configuration);var u=a.toolColors.getColorIfActive(i),d=a.external.cornerstone.pixelToCanvas(r,i.handles.start),h=a.external.cornerstone.pixelToCanvas(r,i.handles.end);t.configuration.arrowFirst?bn(n,h,d,u,m,f):bn(n,d,h,u,m,f);var p={color:u,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&i.active&&xn(n,e.detail,i.handles,p);var g=function(e){return e.text}(i);if(g&&""!==g){var v=wn(n,g,5),b=a.textStyle.getFontSize()+10,x=Math.max(v,b)/2+5;if(h.x<d.x&&(x=-x),!i.handles.textBox.hasMoved){var w=void 0;w=t.configuration.arrowFirst?{x:h.x-v/2+x,y:h.y-b/2}:{x:d.x-v/2-x,y:d.y-b/2};var T=a.external.cornerstone.internal.getTransform(o);T.invert();var I=T.transformPoint(w.x,w.y);i.handles.textBox.x=I.x,i.handles.textBox.y=I.y}mn(n,r,i.handles.textBox,g,i.handles,y,u,m,0,!1)}}))},v=0;v<d.data.length;v++)g(v)}function y(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this,r=e.detail.element,o=this.createNewMeasurement(e),i=this.configuration.allowEmptyLabel;(0,a.addToolState)(r,this.name,o),a.external.cornerstone.updateImage(r),dn(e.detail,this.name,o,o.handles.end,this.options,t,(function(t){t?void 0===o.text&&n.configuration.getTextCallback((function(e){if(e||i){o.text=e,o.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:o};a.external.cornerstone.updateImage(r),pn(r,a.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,a.removeToolState)(r,n.name,o)}),e.detail):(0,a.removeToolState)(r,n.name,o),a.external.cornerstone.updateImage(r)}))},t.prototype.doubleClickCallback=function(e){return this._updateTextForNearbyAnnotation(e,"mouse")},t.prototype.touchPressCallback=function(e){return this._updateTextForNearbyAnnotation(e,"touch")},t.prototype._updateTextForNearbyAnnotation=function(e,t){var n=e.detail.element,r=e.detail.currentPoints.canvas,o=(0,a.getToolState)(n,this.name);if(!o)return!1;for(var i=0;i<o.data.length;i++){var s=o.data[i];if(this.pointNearTool(n,s,r,t)||fn(s.handles.textBox,r))return s.active=!0,a.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(s,e.detail,this._doneChangingTextCallback.bind(this,n,s)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}},t.prototype._doneChangingTextCallback=function(e,t,n,r){!0===r?(0,a.removeToolState)(e,this.name,t):t.text=n,t.active=!1,a.external.cornerstone.updateImage(e),pn(e,a.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})},t}(un);const Sn=In;function Cn(e){return ln(this,void 0,void 0,(function(){var t;return cn(this,(function(n){switch(n.label){case 0:return t=e,[4,an("输入注释：")];case 1:return t.apply(void 0,[n.sent()]),[2]}}))}))}function En(e,t,n){return ln(this,void 0,void 0,(function(){var e;return cn(this,(function(t){switch(t.label){case 0:return e=n,[4,an("更改注释：")];case 1:return e.apply(void 0,[t.sent()]),[2]}}))}))}var An=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Mn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Pn=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Dn=(0,a.importInternal)("base/BaseAnnotationTool"),kn=(0,a.importInternal)("manipulators/moveHandle"),Ln=(0,a.importInternal)("util/pointInsideBoundingBox"),On=(0,a.importInternal)("util/triggerEvent"),Rn=(0,a.importInternal)("util/getLogger"),_n=(0,a.importInternal)("drawing/drawLinkedTextBox"),Nn=(0,a.importInternal)("drawing/getNewContext"),Bn=(0,a.importInternal)("drawing/draw"),Un=(0,a.importInternal)("drawing/setShadow"),Vn=(0,a.importInternal)("drawing/drawHandles"),Fn=(0,a.importInternal)("drawing/textBoxWidth"),jn=(0,a.importInternal)("tools/cursors").textMarkerCursor,Hn=Rn("tools:annotation:ProbeTool"),zn=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Annotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Wn,changeTextCallback:Gn,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,allowEmptyLabel:!1},svgCursor:jn};return(n=e.call(this,t,r)||this).preventNewMeasurement=!1,n}return An(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.end;if(o||Hn.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i=a.external.cornerstone.pixelToCanvas(e,t.handles.end),s="mouse"===r?15:25;return a.external.cornerstoneMath.point.distance(i,n)<s},t.prototype.updateCachedStats=function(){},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=n.element,o=n.enabledElement,i=this.configuration,s=i.handleRadius,l=i.drawHandlesOnHover,c=i.hideHandlesIfMoving,u=(0,a.getToolState)(r,this.name);if(u)for(var d=e.detail.canvasContext.canvas,f=Nn(d),h=a.toolStyle.getToolWidth(),p=function(n){var i=u.data[n];if(!1===i.visible)return"continue";Bn(f,(function(n){Un(n,t.configuration);var u=a.toolColors.getColorIfActive(i),d=a.external.cornerstone.pixelToCanvas(r,i.handles.end),f={color:u,handleRadius:s,drawHandlesIfActive:l,hideHandlesIfMoving:c};t.configuration.drawHandles&&Vn(n,e.detail,i.handles,f);var p=function(e){return e.text}(i);if(p&&""!==p){var m=Fn(n,p,5),v=a.textStyle.getFontSize()+10,y=Math.max(m,v)/2+5;if(!i.handles.textBox.hasMoved){var b={x:d.x-m/2+y,y:d.y-v/2},x=a.external.cornerstone.internal.getTransform(o);x.invert();var w=x.transformPoint(b.x,b.y);i.handles.textBox.x=w.x,i.handles.textBox.y=w.y}_n(n,r,i.handles.textBox,p,i.handles,g,u,h,0,!1)}}))},m=0;m<u.data.length;m++)p(m);function g(e){return[e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this,r=e.detail.element,o=this.createNewMeasurement(e),i=this.configuration.allowEmptyLabel;(0,a.addToolState)(r,this.name,o),a.external.cornerstone.updateImage(r),kn(e.detail,this.name,o,o.handles.end,this.options,t,(function(t){t?void 0===o.text&&n.configuration.getTextCallback((function(e){if(e||i){o.text=e,o.active=!1;var t={toolName:n.name,toolType:n.name,element:r,measurementData:o};a.external.cornerstone.updateImage(r),On(r,a.EVENTS.MEASUREMENT_COMPLETED,t)}else(0,a.removeToolState)(r,n.name,o)}),e.detail):(0,a.removeToolState)(r,n.name,o),a.external.cornerstone.updateImage(r)}))},t.prototype.doubleClickCallback=function(e){return this._updateTextForNearbyAnnotation(e,"mouse")},t.prototype.touchPressCallback=function(e){return this._updateTextForNearbyAnnotation(e,"touch")},t.prototype._updateTextForNearbyAnnotation=function(e,t){var n=e.detail.element,r=e.detail.currentPoints.canvas,o=(0,a.getToolState)(n,this.name);if(!o)return!1;for(var i=0;i<o.data.length;i++){var s=o.data[i];if(this.pointNearTool(n,s,r,t)||Ln(s.handles.textBox,r))return s.active=!0,a.external.cornerstone.updateImage(n),this.configuration.changeTextCallback(s,e.detail,this._doneChangingTextCallback.bind(this,n,s)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}},t.prototype._doneChangingTextCallback=function(e,t,n,r){!0===r?(0,a.removeToolState)(e,this.name,t):t.text=n,t.active=!1,a.external.cornerstone.updateImage(e),On(e,a.EVENTS.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:e,measurementData:t})},t}(Dn);const qn=zn;function Wn(e){return Mn(this,void 0,void 0,(function(){var t;return Pn(this,(function(n){switch(n.label){case 0:return t=e,[4,an("输入文本：")];case 1:return t.apply(void 0,[n.sent()]),[2]}}))}))}function Gn(e,t,n){return Mn(this,void 0,void 0,(function(){var e;return Pn(this,(function(t){switch(t.label){case 0:return e=n,[4,an("更改文本：")];case 1:return e.apply(void 0,[t.sent()]),[2]}}))}))}var Yn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zn=(0,a.importInternal)("base/BaseTool"),Xn=(0,a.importInternal)("util/getPixelSpacing"),Qn=(0,a.importInternal)("drawing/getNewContext"),Kn=(0,a.importInternal)("drawing/draw"),Jn=(0,a.importInternal)("drawing/setShadow"),$n=(0,a.importInternal)("drawing/drawLine"),er=(0,a.importInternal)("drawing/drawTextBox"),tr=(0,a.importInternal)("util/getLogger")("tools:ScaleOverlayTool"),nr=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"ScaleOverlay",configuration:{minorTickLength:14,majorTickLength:24},mixins:["enabledOrDisabledBinaryTool"]})||this}return Yn(t,e),t.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.forceImageUpdate=function(e){a.external.cornerstone.getEnabledElement(e).image&&a.external.cornerstone.updateImage(e)},t.prototype.renderToolData=function(e){var t=e.detail,n=Qn(t.canvasContext.canvas),r=t.image,o=t.viewport,i=t.element;if(!(o.scale<.3)){var s=Xn(r),l=s.rowPixelSpacing,c=s.colPixelSpacing;if(l&&c){var u={width:n.canvas.width,height:n.canvas.height},d=10/l*o.scale,f=10/c*o.scale,h=or(u,.2,.05),p=or(u,.05,.2);if(u.width&&u.height&&h&&p){var m=a.toolColors.getToolColor(),g=a.toolStyle.getToolWidth(),v=Object.assign({},{hscaleBounds:h,vscaleBounds:p,verticalMinorTick:d,horizontalMinorTick:f,verticalLine:{start:{x:p.bottomRight.x,y:p.topLeft.y},end:{x:p.bottomRight.x,y:p.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:m,lineWidth:g},this.configuration);Kn(n,(function(e){Jn(e,v),$n(e,i,v.verticalLine.start,v.verticalLine.end,{color:v.color,lineWidth:v.lineWidth},"canvas"),ar(e,i,v),$n(e,i,v.horizontalLine.start,v.horizontalLine.end,{color:v.color,lineWidth:v.lineWidth},"canvas"),ir(e,i,v)}))}}else tr.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}},t}(Zn);const rr=nr;var or=function(e,t,n){var r=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),a={left:r,top:o,width:e.width-2*r,height:e.height-2*o};return{topLeft:{x:a.left,y:a.top},bottomRight:{x:a.left+a.width,y:a.top+a.height}}},ar=function(e,t,n){for(var r=0,o=n.color,i=n.lineWidth;n.verticalLine.start.y+r*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var s={x:n.verticalLine.start.x,y:n.verticalLine.start.y+r*n.verticalMinorTick},l={x:0,y:n.verticalLine.start.y+r*n.verticalMinorTick};l.x=r%10==0?n.verticalLine.start.x-n.majorTickLength:r%5==0?n.verticalLine.start.x-n.minorTickLength:n.verticalLine.start.x-n.minorTickLength/2,$n(e,t,s,l,{color:o,lineWidth:i},"canvas"),r++}var c=10*(r-1)+"mm";er(e,c,n.verticalLine.end.x-e.measureText(c).width-10,n.verticalLine.end.y,a.toolColors.getToolColor())},ir=function(e,t,n){var r=0,o=n.color,i=n.lineWidth;for(n.horizontalMinorTick!==n.verticalMinorTick&&(n.horizontalMinorTick=n.verticalMinorTick);n.horizontalLine.start.x+r*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var s={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:n.horizontalLine.start.y},l={x:n.horizontalLine.start.x+r*n.horizontalMinorTick,y:0};l.y=r%10==0?n.horizontalLine.start.y-n.majorTickLength:r%5==0?n.horizontalLine.start.y-n.minorTickLength:n.horizontalLine.start.y-n.minorTickLength/2,$n(e,t,s,l,{color:o,lineWidth:i},"canvas"),r++}er(e,10*(r-1)+"mm",n.horizontalLine.end.x,n.horizontalLine.end.y-a.textStyle.getFontSize(),a.toolColors.getToolColor())},sr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),lr=function(){return lr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},lr.apply(this,arguments)},cr=(0,a.importInternal)("base/BaseAnnotationTool"),ur=(0,a.importInternal)("manipulators/getHandleNearImagePoint"),dr=(0,a.importInternal)("drawing/getNewContext"),fr=(0,a.importInternal)("drawing/draw"),hr=(0,a.importInternal)("drawing/setShadow"),pr=(0,a.importInternal)("drawing/drawEllipse"),mr=(0,a.importInternal)("drawing/drawLinkedTextBox"),gr=(0,a.importInternal)("drawing/drawLine"),vr=(0,a.importInternal)("drawing/drawHandles"),yr=(0,a.importInternal)("util/getROITextBoxCoords"),br=(0,a.importInternal)("util/numbersWithCommas"),xr=(0,a.importInternal)("util/calculateSUV"),wr=(0,a.importInternal)("util/ellipseUtils"),Tr=wr.calculateEllipseStatistics,Ir=wr.pointInEllipse,Sr=(0,a.importInternal)("util/getLogger"),Cr=(0,a.importInternal)("util/throttle"),Er=(0,a.importInternal)("util/getPixelSpacing"),Ar=Sr?Sr("tools:annotation:LengthTool"):console,Mr=(0,a.importInternal)("tools/cursors").ellipticalRoiCursor,Pr=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Mr};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=Cr(n.updateCachedStats,110),n.throttledHandlesMove=Cr(kr,0),n}return sr(t,e),t.prototype.createNewMeasurement=function(e){var t=e||{currentPoints:{}},n=t.currentPoints.image;t.image;if(n)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Ar.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||Ar.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;if(ur(e,t.handles,n,6))return!0;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.start),l=a.external.cornerstone.pixelToCanvas(e,t.handles.end),c={left:Math.min(s.x,l.x)+i/2,top:Math.min(s.y,l.y)+i/2,width:Math.abs(s.x-l.x)-i,height:Math.abs(s.y-l.y)-i},u={left:Math.min(s.x,l.x)-i/2,top:Math.min(s.y,l.y)-i/2,width:Math.abs(s.x-l.x)+i,height:Math.abs(s.y-l.y)+i},d=Ir(c,n);return!(!Ir(u,n)||d)},t.prototype.updateCachedStats=function(e,t,n){var r=(a.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=Er(e),i=function(e,t,n,r,o){var i,s=_r(n.start,n.end),l=a.external.cornerstone.getPixels(t,s.left,s.top,s.width,s.height),c=Tr(l,s);"PT"===r&&(i={mean:xr(e,c.mean,!0)||0,stdDev:xr(e,c.stdDev,!0)||0});return{area:Math.PI*(s.width*(o.colPixelSpacing||1)/2)*(s.height*(o.rowPixelSpacing||1)/2)||0,count:c.count||0,mean:c.mean||0,variance:c.variance||0,stdDev:c.stdDev||0,min:c.min||0,max:c.max||0,meanStdDevSUV:i,handles:JSON.parse(JSON.stringify(n))}}(e,t,n.handles,r,o);n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,i=r.element,s=a.toolStyle.getToolWidth(),l=(0,a.getModule)("globalConfiguration").configuration.lineDash,c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,f=c.hideHandlesIfMoving,h=c.renderDashed,p=dr(r.canvasContext.canvas),m=Er(o),g=m.rowPixelSpacing,v=m.colPixelSpacing,y=(a.external.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,b=g&&v;fr(p,(function(e){for(var c=0;c<n.data.length;c++){var p=n.data[c];if(!1!==p.visible){var m=a.toolColors.getColorIfActive(p),g={color:m,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:f};hr(e,t.configuration);var v={color:m};if(h&&(v.lineDash=l),pr(e,i,p.handles.start,p.handles.end,v,"pixel",p.handles.initialRotation),t.configuration.drawHandles&&p.active){vr(e,r,lr(lr({},p.handles),{top:{drawnIndependently:!0},left:{drawnIndependently:!0},bottom:{drawnIndependently:!0},right:{drawnIndependently:!0}}),g);var x={color:m,lineWidth:s,lineDash:[2,3]};gr(e,i,p.handles.start,p.handles.end,x)}if(!0===p.invalidated&&(p.cachedStats?t.throttledUpdateCachedStats(o,i,p):t.updateCachedStats(o,i,p)),!p.handles.textBox.hasMoved){var w=yr(r.viewport,p.handles);Object.assign(p.handles.textBox,w)}var T=Rr(e,o.color,p.cachedStats,y,b,t.configuration);p.unit=Or(y,t.configuration.showHounsfieldUnits),mr(e,i,p.handles.textBox,T,p.handles,(function(e){return Lr(e.start,e.end)}),m,s,10,!0)}}}))}},t}(cr);const Dr=Pr;function kr(e,t){var n=e.top,r=e.left,o=e.bottom,a=e.right,i=t.top,s=t.left,l=t.bottom,c=t.right;n.active?(e.start.y+=n.y-i.y,e.top.x=o.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):r.active?(e.start.x+=r.x-s.x,e.left.y=a.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2):o.active?(e.end.y+=o.y-l.y,e.bottom.x=n.x,e.left.y=e.right.y=(e.start.y+e.end.y)/2):a.active&&(e.end.x+=a.x-c.x,e.right.y=r.y,e.top.x=e.bottom.x=(e.start.x+e.end.x)/2)}function Lr(e,t){var n=_r(e,t),r=n.left,o=n.top,a=n.width,i=n.height;return[{x:r+a/2,y:o},{x:r,y:o+i/2},{x:r+a/2,y:o+i},{x:r+a,y:o+i/2}]}function Or(e,t){return"CT"===e&&!1!==t?"HU":""}function Rr(e,t,n,r,o,a){var i=void 0===n?{}:n,s=i.area,l=i.mean,c=i.stdDev,u=i.min,d=i.max,f=i.meanStdDevSUV;void 0===a&&(a={});var h=a.showMinMax||!1,p=[],m=[];if(!t){var g=f&&0!==f.mean,v=Or(r,a.showHounsfieldUnits),y="Mean: ".concat(br(l.toFixed(2))," ").concat(v),b="Std Dev: ".concat(br(c.toFixed(2))," ").concat(v);if(g){for(var x=" SUV: ",w="".concat(x).concat(br(f.mean.toFixed(2))),T="".concat(x).concat(br(f.stdDev.toFixed(2))),I=Math.floor(e.measureText("".concat(b,"     ")).width);e.measureText(y).width<I;)y+=" ";m.push("".concat(y).concat(w)),m.push("".concat(b,"     ").concat(T))}else m.push("".concat(y)),m.push("".concat(b));if(h){var S="Min: ".concat(u," ").concat(v),C="Max: ".concat(d," ").concat(v);for(I=g?Math.floor(e.measureText("".concat(b,"     ")).width):Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(S).width<I;)S+=" ";m.push("".concat(S).concat(C))}}return p.push(function(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(br(e.toFixed(2))).concat(n)}(s,o)),m.forEach((function(e){return p.push(e)})),p}function _r(e,t){return{left:Math.round(Math.min(e.x,t.x)),top:Math.round(Math.min(e.y,t.y)),width:Math.round(Math.abs(e.x-t.x)),height:Math.round(Math.abs(e.y-t.y))}}var Nr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Br=(0,a.importInternal)("base/BaseAnnotationTool"),Ur=(0,a.importInternal)("drawing/getNewContext"),Vr=(0,a.importInternal)("drawing/draw"),Fr=(0,a.importInternal)("drawing/setShadow"),jr=(0,a.importInternal)("drawing/drawRect"),Hr=(0,a.importInternal)("drawing/drawLinkedTextBox"),zr=(0,a.importInternal)("drawing/drawHandles"),qr=(0,a.importInternal)("util/getLogger"),Wr=(0,a.importInternal)("util/throttle"),Gr=(0,a.importInternal)("util/getPixelSpacing"),Yr=(0,a.importInternal)("util/calculateSUV"),Zr=(0,a.importInternal)("util/getROITextBoxCoords"),Xr=(0,a.importInternal)("util/numbersWithCommas"),Qr=qr?qr("tools:annotation:LengthTool"):console,Kr=(0,a.importInternal)("tools/cursors").rectangleRoiCursor,Jr=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:Kr};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=Wr(n.updateCachedStats,110),n}return Nr(t,e),t.prototype.createNewMeasurement=function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},initialRotation:e.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};Qr.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||Qr.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.start),l=a.external.cornerstone.pixelToCanvas(e,t.handles.end),c={left:Math.min(s.x,l.x),top:Math.min(s.y,l.y),width:Math.abs(s.x-l.x),height:Math.abs(s.y-l.y)};return a.external.cornerstoneMath.rect.distanceToPoint(c,n)<i},t.prototype.updateCachedStats=function(e,t,n){var r=(a.external.cornerstone.metaData.get("generalSeriesModule",e.imageId)||{}).modality,o=Gr(e),i=function(e,t,n,r,o){var i,s=eo(n.start,n.end),l=function(e,t){for(var n=0,r=0,o=0,a=0,i=e?e[0]:null,s=e?e[0]:null,l=t.top;l<t.top+t.height;l++)for(var c=t.left;c<t.left+t.width;c++)n+=e[a],r+=e[a]*e[a],i=Math.min(i,e[a]),s=Math.max(s,e[a]),o++,a++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0,min:0,max:0};var u=n/o,d=r/o-u*u;return{count:o,mean:u,variance:d,stdDev:Math.sqrt(d),min:i,max:s}}(a.external.cornerstone.getPixels(t,s.left,s.top,s.width,s.height),s);"PT"===r&&(i={mean:Yr(e,l.mean,!0)||0,stdDev:Yr(e,l.stdDev,!0)||0});var c=s.width*(o.colPixelSpacing||1)*(s.height*(o.rowPixelSpacing||1)),u=2*s.width*(o.colPixelSpacing||1)+2*s.height*(o.rowPixelSpacing||1);return{area:c||0,perimeter:u,count:l.count||0,mean:l.mean||0,variance:l.variance||0,stdDev:l.stdDev||0,min:l.min||0,max:l.max||0,meanStdDevSUV:i}}(e,t,n.handles,r,o);n.cachedStats=i,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name);if(n){var r=e.detail,o=r.image,i=r.element,s=a.toolStyle.getToolWidth(),l=(0,a.getModule)("globalConfiguration").configuration.lineDash,c=this.configuration,u=c.handleRadius,d=c.drawHandlesOnHover,f=c.hideHandlesIfMoving,h=c.renderDashed,p=Ur(r.canvasContext.canvas),m=Gr(o),g=m.rowPixelSpacing,v=m.colPixelSpacing,y=(a.external.cornerstone.metaData.get("generalSeriesModule",o.imageId)||{}).modality,b=g&&v;Vr(p,(function(e){for(var c=0;c<n.data.length;c++){var p=n.data[c];if(!1!==p.visible){var m=a.toolColors.getColorIfActive(p),g={color:m,handleRadius:u,drawHandlesIfActive:d,hideHandlesIfMoving:f};Fr(e,t.configuration);var v={color:m};if(h&&(v.lineDash=l),jr(e,i,p.handles.start,p.handles.end,v,"pixel",p.handles.initialRotation),t.configuration.drawHandles&&p.active&&zr(e,r,p.handles,g),!0===p.invalidated&&(p.cachedStats?t.throttledUpdateCachedStats(o,i,p):t.updateCachedStats(o,i,p)),!p.handles.textBox.hasMoved){var x=Zr(r.viewport,p.handles);Object.assign(p.handles.textBox,x)}var w=ro(e,o.color,p.cachedStats,y,b,t.configuration);p.unit=no(y,t.configuration.showHounsfieldUnits),Hr(e,i,p.handles.textBox,w,p.handles,(function(e){return to(e.start,e.end)}),m,s,10,!0)}}}))}},t}(Br);const $r=Jr;function eo(e,t){return{left:Math.min(e.x,t.x),top:Math.min(e.y,t.y),width:Math.abs(e.x-t.x),height:Math.abs(e.y-t.y)}}function to(e,t){var n=eo(e,t),r=n.left,o=n.top,a=n.width,i=n.height;return[{x:r+a/2,y:o},{x:r,y:o+i/2},{x:r+a/2,y:o+i},{x:r+a,y:o+i/2}]}function no(e,t){return"CT"===e&&!1!==t?"HU":""}function ro(e,t,n,r,o,a){var i=n.area,s=n.mean,l=n.stdDev,c=n.min,u=n.max,d=n.meanStdDevSUV;void 0===a&&(a={});var f=a.showMinMax||!1,h=[],p=[];if(!t){var m=d&&0!==d.mean,g=no(r,a.showHounsfieldUnits),v="Mean: ".concat(Xr(s.toFixed(2))," ").concat(g),y="Std Dev: ".concat(Xr(l.toFixed(2))," ").concat(g);if(m){for(var b=" SUV: ",x="".concat(b).concat(Xr(d.mean.toFixed(2))),w="".concat(b).concat(Xr(d.stdDev.toFixed(2))),T=Math.floor(e.measureText("".concat(y,"     ")).width);e.measureText(v).width<T;)v+=" ";p.push("".concat(v).concat(x)),p.push("".concat(y,"     ").concat(w))}else p.push("".concat(v)),p.push("".concat(y));if(f){var I="Min: ".concat(c," ").concat(g),S="Max: ".concat(u," ").concat(g);for(T=m?Math.floor(e.measureText("".concat(y,"     ")).width):Math.floor(e.measureText("".concat(v,"     ")).width);e.measureText(I).width<T;)I+=" ";p.push("".concat(I).concat(S))}}return h.push(function(e,t){var n=t?" mm".concat(String.fromCharCode(178)):" px".concat(String.fromCharCode(178));return"Area: ".concat(Xr(e.toFixed(2))).concat(n)}(i,o)),p.forEach((function(e){return h.push(e)})),h}var oo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ao=(0,a.importInternal)("base/BaseAnnotationTool"),io=(0,a.importInternal)("drawing/getNewContext"),so=(0,a.importInternal)("drawing/draw"),lo=(0,a.importInternal)("drawing/setShadow"),co=(0,a.importInternal)("drawing/drawLinkedTextBox"),uo=(0,a.importInternal)("drawing/drawLine"),fo=(0,a.importInternal)("drawing/drawHandles"),ho=(0,a.importInternal)("util/getLogger"),po=(0,a.importInternal)("util/throttle"),mo=(0,a.importInternal)("util/getPixelSpacing"),go=(0,a.importInternal)("util/lineSegDistance"),vo=ho?ho("tools:annotation:LengthTool"):console,yo=(0,a.importInternal)("tools/cursors").lengthCursor,bo=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:yo,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return(n=e.call(this,t,r)||this).throttledUpdateCachedStats=po(n.updateCachedStats,110),n}return oo(t,e),t.prototype.createNewMeasurement=function(e){var t,n=null===(t=null==e?void 0:e.currentPoints)||void 0===t?void 0:t.image;if(n){var r=n.x,o=n.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:r,y:o,highlight:!0,active:!1},end:{x:r,y:o,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}vo.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))},t.prototype.pointNearTool=function(e,t,n,r){if(!(t&&t.handles&&t.handles.start&&t.handles.end))return vo.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1;if(!1===t.visible)return!1;var o="mouse"===r?15:25;return go(e,t.handles.start,t.handles.end,n)<o},t.prototype.updateCachedStats=function(e,t,n){var r=mo(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(n.handles.end.x-n.handles.start.x)*(a||1),s=(n.handles.end.y-n.handles.start.y)*(o||1),l=Math.sqrt(i*i+s*s);n.length=l,n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=r.digits,u=(0,a.getToolState)(e.currentTarget,this.name);if(u)for(var d=io(n.canvasContext.canvas),f=n.image,h=n.element,p=mo(f),m=p.rowPixelSpacing,g=p.colPixelSpacing,v=a.toolStyle.getToolWidth(),y=(0,a.getModule)("globalConfiguration").configuration.lineDash,b=function(e){var r=u.data[e];if(!1===r.visible)return"continue";so(d,(function(e){lo(e,t.configuration);var u=a.toolColors.getColorIfActive(r),d={color:u};l&&(d.lineDash=y),uo(e,h,r.handles.start,r.handles.end,d);var p={color:u,handleRadius:o,drawHandlesIfActive:i,hideHandlesIfMoving:s};if(t.configuration.drawHandles&&r.active&&fo(e,n,r.handles,p),!r.handles.textBox.hasMoved){var b={x:Math.max(r.handles.start.x,r.handles.end.x)};b.x===r.handles.start.x?b.y=r.handles.start.y:b.y=r.handles.end.y,r.handles.textBox.x=b.x,r.handles.textBox.y=b.y}!0===r.invalidated&&(r.length?t.throttledUpdateCachedStats(f,h,r):t.updateCachedStats(f,h,r));var x=function(e,t,n){var r=(o=e.length,a=Number(o),isNaN(a)?void 0:a);var o,a;if(!r)return"";var i="mm";t&&n||(i="pixels");return e.unit=i,"".concat(r.toFixed(c)," ").concat(i)}(r,m,g);co(e,h,r.handles.textBox,x,r.handles,w,u,v,10,!0)}))},x=0;x<u.data.length;x++)b(x);function w(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}},t}(ao);const xo=bo;var wo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),To=(0,a.importInternal)("base/BaseAnnotationTool"),Io=(0,a.importInternal)("manipulators/moveNewHandle"),So=(0,a.importInternal)("drawing/getNewContext"),Co=(0,a.importInternal)("drawing/draw"),Eo=(0,a.importInternal)("drawing/setShadow"),Ao=(0,a.importInternal)("drawing/drawJoinedLines"),Mo=(0,a.importInternal)("drawing/drawLinkedTextBox"),Po=(0,a.importInternal)("drawing/drawHandles"),Do=(0,a.importInternal)("util/triggerEvent"),ko=(0,a.importInternal)("util/lineSegDistance"),Lo=(0,a.importInternal)("util/roundToDecimal"),Oo=(0,a.importInternal)("util/throttle"),Ro=(0,a.importInternal)("util/getPixelSpacing"),_o=(0,a.importInternal)("drawing/textBoxWidth"),No=(0,a.importInternal)("tools/cursors").angleCursor,Bo=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:No,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,r)||this).preventNewMeasurement=!1,n.throttledUpdateCachedStats=Oo(n.updateCachedStats,110),n}return wo(t,e),t.prototype.createNewMeasurement=function(e){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){if(!1===t.visible)return!1;var o="mouse"===r?15:25;return ko(e,t.handles.start,t.handles.middle,n)<o||ko(e,t.handles.middle,t.handles.end,n)<o},t.prototype.updateCachedStats=function(e,t,n){if(n.handles.middle){var r=Fo(e,n.handles.middle,n.handles.start),o=Fo(e,n.handles.end,n.handles.middle),a=Fo(e,n.handles.end,n.handles.start),i=Vo(r),s=Vo(o),l=Vo(a),c=Math.acos((Math.pow(i,2)+Math.pow(s,2)-Math.pow(l,2))/(2*i*s));c*=180/Math.PI,n.rAngle=Lo(c,2),n.invalidated=!1}},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=n.enabledElement,o=this.configuration,i=o.handleRadius,s=o.drawHandlesOnHover,l=o.hideHandlesIfMoving,c=o.renderDashed,u=(0,a.getToolState)(e.currentTarget,this.name),d=(0,a.getModule)("globalConfiguration").configuration.lineDash;if(u)for(var f=So(n.canvasContext.canvas),h=n.image,p=n.element,m=Ro(h),g=m.rowPixelSpacing,v=m.colPixelSpacing,y=a.toolStyle.getToolWidth(),b=function(e){var o=u.data[e];if(!1===o.visible)return"continue";Co(f,(function(e){Eo(e,t.configuration);var u=a.toolColors.getColorIfActive(o),f=a.external.cornerstone.pixelToCanvas(n.element,o.handles.start),m=a.external.cornerstone.pixelToCanvas(n.element,o.handles.middle),b={color:u};c&&(b.lineDash=d),Ao(e,n.element,o.handles.start,[o.handles.middle,o.handles.end],b);var x={color:u,handleRadius:i,drawHandlesIfActive:s,hideHandlesIfMoving:l};if(t.configuration.drawHandles&&o.active&&Po(e,n,o.handles,x),!0===o.invalidated&&(o.rAngle?t.throttledUpdateCachedStats(h,p,o):t.updateCachedStats(h,p,o)),o.rAngle){var T=function(e,t,n){var r=t&&n?"":" (isotropic)",o="00B0";return e.rAngle.toString()+String.fromCharCode(parseInt(o,16))+r}(o,g,v),I=void 0;if(!o.handles.textBox.hasMoved){I={x:m.x,y:m.y};var S=_o(e,T,5);m.x<f.x?I.x-=15+S+10:I.x+=15;var C=a.external.cornerstone.internal.getTransform(r);C.invert();var E=C.transformPoint(I.x,I.y);o.handles.textBox.x=E.x,o.handles.textBox.y=E.y}Mo(e,n.element,o.handles.textBox,T,o.handles,w,u,y,0,!0)}}))},x=0;x<u.data.length;x++)b(x);function w(e){return[e.start,e.middle,e.end]}},t.prototype.addNewMeasurement=function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var r=e.detail,o=this.createNewMeasurement(r),i=e.detail.element;(0,a.addToolState)(i,this.name,o),a.external.cornerstone.updateImage(i),Io(r,this.name,o,o.handles.middle,this.options,t,(function(e){if(o.active=!1,!e)return(0,a.removeToolState)(i,n.name,o),void(n.preventNewMeasurement=!1);o.handles.end.active=!0,a.external.cornerstone.updateImage(i),Io(r,n.name,o,o.handles.end,n.options,t,(function(e){e?(o.active=!1,a.external.cornerstone.updateImage(i)):(0,a.removeToolState)(i,n.name,o),n.preventNewMeasurement=!1,a.external.cornerstone.updateImage(i);var t={toolName:n.name,toolType:n.name,element:i,measurementData:o};Do(i,a.EVENTS.MEASUREMENT_COMPLETED,t)}))}))}},t}(To);const Uo=Bo;function Vo(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function Fo(e,t,n){var r=Ro(e),o=r.rowPixelSpacing,a=r.colPixelSpacing;return{x:(t.x-n.x)*(a||1),y:(t.y-n.y)*(o||1)}}var jo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Ho=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"Pointer",supportedInteractionTypes:["Mouse","Touch"]})||this}return jo(t,e),t}((0,a.importInternal)("base/BaseTool"));var zo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qo=(0,a.importInternal)("base/BaseAnnotationTool"),Wo=(0,a.importInternal)("manipulators/moveNewHandle"),Go=(0,a.importInternal)("drawing/getNewContext"),Yo=(0,a.importInternal)("drawing/draw"),Zo=(0,a.importInternal)("drawing/setShadow"),Xo=(0,a.importInternal)("drawing/drawLine"),Qo=(0,a.importInternal)("drawing/drawLinkedTextBox"),Ko=(0,a.importInternal)("drawing/drawHandles"),Jo=(0,a.importInternal)("util/triggerEvent"),$o=(0,a.importInternal)("util/lineSegDistance"),ea=(0,a.importInternal)("util/roundToDecimal"),ta=(0,a.importInternal)("util/throttle"),na=(0,a.importInternal)("util/getPixelSpacing"),ra=(0,a.importInternal)("tools/cursors").cobbAngleCursor,oa=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:ra,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return(n=e.call(this,t,r)||this).hasIncomplete=!1,n.throttledUpdateCachedStats=ta(n.updateCachedStats,110),n}return zo(t,e),t.prototype.createNewMeasurement=function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}},t.prototype.pointNearTool=function(e,t,n,r){if(!1===t.visible)return!1;var o="mouse"===r?15:25,a=$o(e,t.handles.start,t.handles.end,n)<o,i=$o(e,t.handles.start2,t.handles.end2,n)<o;return a||i},t.prototype.updateCachedStats=function(e,t,n){var r=na(e),o=r.rowPixelSpacing,a=r.colPixelSpacing,i=(n.handles.start.x-n.handles.end.x)*(a||1),s=(n.handles.start.y-n.handles.end.y)*(o||1),l=(n.handles.start2.x-n.handles.end2.x)*(a||1),c=(n.handles.start2.y-n.handles.end2.y)*(o||1),u=Math.acos((i*l+s*c)/(Math.sqrt(i*i+s*s)*Math.sqrt(l*l+c*c)));u*=180/Math.PI,n.rAngle=ea(u,2),n.lAngle2=ea(360-u,2),n.invalidated=!1},t.prototype.renderToolData=function(e){var t=this,n=e.detail,r=this.configuration,o=r.handleRadius,i=r.drawHandlesOnHover,s=r.hideHandlesIfMoving,l=r.renderDashed,c=(0,a.getToolState)(e.currentTarget,this.name);if(c)for(var u=Go(n.canvasContext.canvas),d=a.toolStyle.getToolWidth(),f=(0,a.getModule)("globalConfiguration").configuration.lineDash,h=a.textStyle.getFont(),p=e.detail.element,m=a.external.cornerstone.getEnabledElement(p).image,g=na(m),v=g.rowPixelSpacing,y=g.colPixelSpacing,b=function(e){var r=c.data[e],m=r.handles,g=m.start,b=m.end,w=m.start2,I=m.end2;if(!1===r.visible)return"continue";r.value||(r.value=x.textBoxText(r,v,y)),Yo(u,(function(e){Zo(e,t.configuration);var c=a.toolColors.getColorIfActive(r),u={color:c};l&&(u.lineDash=f),Xo(e,n.element,g,b,u);var m={color:c,lineWidth:d,lineDash:[2,3]};if(r.active||!r.complete){var v=ia(n,g,b),y=v.start,x=v.end;Xo(e,p,y,x,m)}if(r.complete&&(Xo(e,n.element,w,I,u),r.active)){var S=ia(n,w,I),C=S.start,E=S.end;Xo(e,p,C,E,m)}var A={color:c,handleRadius:o,drawHandlesIfActive:i,hideHandlesIfMoving:s};t.configuration.drawHandles&&r.active&&Ko(e,n,r.handles,A),e.fillStyle=c;var M=r.value;if(!r.handles.textBox.hasMoved){var P={x:(g.x+b.x)/2,y:(g.y+b.y)/2+10};e.font=h,r.handles.textBox.x=P.x,r.handles.textBox.y=P.y}r.complete&&Qo(e,n.element,r.handles.textBox,M,r.handles,T,c,d,0,!0)}))},x=this,w=0;w<c.data.length;w++)b(w);function T(e){return[e.start,e.start2,e.end,e.end2]}},t.prototype.getIncomplete=function(e){var t=(0,a.getToolState)(e,this.name);if(t&&Array.isArray(t.data))return t.data.find((function(e){return!1===e.complete}))},t.prototype.addNewMeasurement=function(e,t){var n=this;e.preventDefault(),e.stopPropagation();var r,o,i=e.detail,s=function(e){if(e){var t=a.EVENTS.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:l,measurementData:r};Jo(l,t,o)}else(0,a.removeToolState)(l,n.name,r)},l=e.detail.element,c=this.getIncomplete(l);c?((r=c).complete=!0,r.handles.start2={x:i.currentPoints.image.x,y:i.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},r.handles.end2={x:i.currentPoints.image.x,y:i.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},o=r.handles.end2,this.hasIncomplete=!1,s=function(e){if(e){var t=a.EVENTS.MEASUREMENT_COMPLETED,o={toolName:n.name,toolType:n.name,element:l,measurementData:r};Jo(l,t,o)}else(0,a.removeToolState)(l,n.name,r)}):(r=this.createNewMeasurement(i),(0,a.addToolState)(l,this.name,r),o=r.handles.end),a.external.cornerstone.updateImage(l),Wo(i,this.name,r,o,this.options,t,s)},t.prototype.onMeasureModified=function(e){var t=e.detail.element,n=a.external.cornerstone.getEnabledElement(t).image,r=na(n),o=r.rowPixelSpacing,i=r.colPixelSpacing;if(e.detail.toolName===this.name){var s=e.detail.measurementData;!0===s.invalidated&&(s.rAngle?this.throttledUpdateCachedStats(n,t,s):this.updateCachedStats(n,t,s)),s.value=this.textBoxText(s,o,i)}},t.prototype.textBoxText=function(e,t,n){var r=e.rAngle,o=e.lAngle2;if(void 0===r)return"";if(Number.isNaN(r))return"";var a=t&&n?"":" (isotropic)";return"".concat(r,"°").concat(a," (").concat(o,"°").concat(a,")")},t.prototype.activeCallback=function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.passiveCallback=function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.enabledCallback=function(e){e.removeEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t.prototype.disabledCallback=function(e){e.removeEventListener(a.EVENTS.MEASUREMENT_MODIFIED,this.onMeasureModified)},t}(qo);const aa=oa;function ia(e,t,n){var r,o,a,i,s=e.image,l=s.columnPixelSpacing,c=void 0===l?1:l,u=s.rowPixelSpacing,d=void 0===u?1:u,f={x:(t.x+n.x)/2,y:(t.y+n.y)/2};if(t.x===n.x&&t.y===n.y)r=t.x,o=t.y,a=n.x,i=n.y;else{var h=function(e,t,n,r){var o=(n.x-r.x)*e,a=(n.y-r.y)*t,i=Math.sqrt(o*o+a*a);return{x:o/i,y:a/i,length:i}}(c,d,t,n),p=10*h.length,m=p/(2*d),g=p/(2*c);r=f.x+g*h.y,o=f.y-m*h.x,a=f.x-g*h.y,i=f.y+m*h.x}return{start:{x:r,y:o},mid:f,end:{x:a,y:i}}}var sa=a.store.state,la=a.store.modules.globalConfiguration;function ca(e,t){sa.svgCursorUrl&&window.URL.revokeObjectURL(sa.svgCursorUrl),sa.svgCursorUrl=null,e.style.cursor=t}var ua=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),da=(0,a.importInternal)("base/BaseTool"),fa=(0,a.importInternal)("drawing/getNewContext"),ha=(0,a.importInternal)("tools/cursors").magnifyCursor,pa=function(e){function t(t){void 0===t&&(t={});var n=this,r={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:ha};return(n=e.call(this,t,r)||this).zoomCanvas=void 0,n.zoomElement=void 0,n.activeCallback=n._createMagnificationCanvas.bind(n),n.enabledCallback=n._createMagnificationCanvas.bind(n),n.disabledCallback=n._destroyMagnificationCanvas.bind(n),n.postTouchStartCallback=n._addMagnifyingGlass.bind(n),n.touchDragCallback=n._updateMagnifyingGlass.bind(n),n.touchEndCallback=n._removeMagnifyingGlass.bind(n),n.touchDragEndCallback=n._removeMagnifyingGlass.bind(n),n.postMouseDownCallback=n._addMagnifyingGlass.bind(n),n.mouseDragCallback=n._updateMagnifyingGlass.bind(n),n.mouseUpCallback=n._removeMagnifyingGlass.bind(n),n.mouseClickCallback=n._removeMagnifyingGlass.bind(n),n.newImageCallback=n._drawMagnificationTool.bind(n),n}return ua(t,e),t.prototype._addMagnifyingGlass=function(e){var t,n=this;(this._removeZoomElement(),e.detail.element.querySelector(".active"))||(this._drawZoomedElement(e),window.requestAnimationFrame((function(){return n._drawMagnificationTool(e)})),t=e.detail.element,la.configuration.showSVGCursors&&ca(t,"none"),e.preventDefault(),e.stopPropagation())},t.prototype._updateMagnifyingGlass=function(e){e.detail.element.querySelector(".active")||(this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation())},t.prototype._removeMagnifyingGlass=function(e){var t=e.detail.element;!function(e,t){if(la.configuration.showSVGCursors){var n=t.getIconWithPointerSVG(),r=t.mousePoint,o=window.URL.createObjectURL(n);e.style.cursor="url('".concat(o,"') ").concat(r,", auto"),sa.svgCursorUrl=o}}(this.element,this.svgCursor),t.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()},t.prototype._drawMagnificationTool=function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(void 0!==this.zoomCanvas){var r=t.querySelector("canvas:not(.magnifyTool)"),o=fa(n),i=a.external.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),s=Math.min(this.configuration.magnifySize,r.width,r.height),l=this.configuration.magnificationLevel;n.width=s,n.height=s,i.x=Math.max(i.x,.5*s/l),i.x=Math.min(i.x,r.width-.5*s/l),i.y=Math.max(i.y,.5*s/l),i.y=Math.min(i.y,r.height-.5*s/l);var c={x:i.x*l-.5*s,y:i.y*l-.5*s};c.x=Math.max(c.x,0),c.y=Math.max(c.y,0),o.drawImage(this.zoomCanvas,c.x,c.y,s,s,0,0,s,s);var u=e.detail.isTouchEvent?120:0,d={top:Math.max(i.y-.5*s-u,0),left:Math.max(i.x-.5*s,0)},f=n.getBoundingClientRect();d.top=Math.min(d.top,r.height-f.height),d.left=Math.min(d.left,r.width-f.width),n.style.top="".concat(d.top,"px"),n.style.left="".concat(d.left,"px"),n.style.display="block"}},t.prototype._drawZoomedElement=function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=a.external.cornerstone.getEnabledElement(t));var r=this.configuration.magnificationLevel,o=n.canvas,i=n.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=o.width*r,this.zoomElement.height=o.height*r,a.external.cornerstone.enable(this.zoomElement,n.options));var s=a.external.cornerstone.getEnabledElement(this.zoomElement),l=a.external.cornerstone.getViewport(n.element);this.zoomCanvas=s.canvas,this.zoomCanvas.width=o.width*r,this.zoomCanvas.height=o.height*r,s.viewport=Object.assign({},l),l.scale*=r,a.external.cornerstone.displayImage(this.zoomElement,i),a.external.cornerstone.setViewport(this.zoomElement,l)},t.prototype._removeZoomElement=function(){void 0!==this.zoomElement&&(a.external.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)},t.prototype._createMagnificationCanvas=function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}},t.prototype._destroyMagnificationCanvas=function(e){var t=e.querySelector(".magnifyTool");t&&e.removeChild(t)},t}(da);const ma=pa;var ga=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),va=(0,a.importInternal)("base/BaseTool"),ya=(0,a.importInternal)("util/angleBetweenPoints"),ba=(0,a.importInternal)("tools/cursors").rotateCursor;const xa=function(e){function t(t){void 0===t&&(t={});var n={name:"Rotate",strategies:{default:wa,horizontal:Ta,vertical:Ia},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:ba};return e.call(this,t,n)||this}return ga(t,e),t.prototype.touchDragCallback=function(e){this.dragCallback(e)},t.prototype.mouseDragCallback=function(e){this.dragCallback(e)},t.prototype.postTouchStartCallback=function(e){this.initialRotation=e.detail.viewport.rotation},t.prototype.postMouseDownCallback=function(e){this.initialRotation=e.detail.viewport.rotation},t.prototype.dragCallback=function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e),a.external.cornerstone.setViewport(e.detail.element,e.detail.viewport)},t}(va);function wa(e){var t=this.configuration,n=t.roundAngles,r=t.rotateScale,o=e.detail,a=o.element,i=o.viewport,s=o.startPoints,l=o.currentPoints,c=i.initialRotation?i.initialRotation:i.rotation,u=a.getBoundingClientRect(a),d=a.clientWidth,f=a.clientHeight,h=i.scale,p=i.translation,m={x:u.left+d/2+p.x*h,y:u.top+f/2+p.y*h},g=ya(m,s.client,l.client);g.angle*=r,n&&(g.angle=Math.ceil(g.angle)),g.direction<0&&(g.angle=-g.angle),i.rotation=c+g.angle}function Ta(e){var t=this.configuration,n=t.roundAngles,r=t.flipHorizontal,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.x,d=(l.client.x-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}function Ia(e){var t=this.configuration,n=t.roundAngles,r=t.flipVertical,o=t.rotateScale,a=e.detail,i=a.viewport,s=a.startPoints,l=a.currentPoints,c=i.initialRotation,u=s.client.y,d=(l.client.y-u)*o;n&&(d=Math.round(Math.abs(d))*(d>0?1:-1)),r&&(d=-d),i.rotation=c+d}var Sa=function(){return Sa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Sa.apply(this,arguments)},Ca=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ea=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Aa=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Ma=new Map,Pa={},Da={store:{},IDArr:void 0,add:function(e,t){this.store[e]||(this.store[e]=[]),this.store[e].push(Number(t))},sort:function(){for(var e in this.IDArr=[],this.store)this.IDArr.push(e),this.store[e].sort((function(e,t){return e-t}))},getFirstIndex:function(e){var t;return null===(t=this.store[e])||void 0===t?void 0:t[0]},getSeriesIDArr:function(){if(!this.IDArr)for(var e in this.IDArr=[],this.store)this.IDArr.push(e);return this.IDArr}};function ka(e){var t={Calcification:"钙化",Ground_Glass:"磨玻璃",Part_Solid:"部分实性",Solid:"实性",pleural:"胸膜结节"},n=[];for(var r in e){var o={name:r,value:e[r],typeText:t[r]};n.push(o)}return n.sort((function(e,t){return t.value-e.value})),n[0].typeText}function La(e){return e<.25?"良性":e<.5?"偏良性":e<.75?"偏恶性":e<1?"恶性":void 0}function Oa(e){var t=e.nodule_no,n=(e.instanceNumber,e.nodule_volume),r=e.nodule_maxHU,o=e.nodule_minHU,a=Ea(e.nodule_cross,1)[0],i=a.major_diameter_length_mm,s=a.minor_diameter_length_mm,l=e.noduleType,c=e.noduleBmProbCN;return["编号:N".concat(t),"长短经: ".concat(i.toFixed(2),"*").concat(s.toFixed(2),"mm"),"体积: ".concat(n.toFixed(2),"mm").concat(String.fromCharCode(179)),"Min: ".concat(o,"HU  Max: ").concat(r,"HU"),"类型: ".concat(l,"  良恶性: ").concat(c)]}var Ra=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_a=function(){return _a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},_a.apply(this,arguments)},Na=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Ba=(0,a.importInternal)("base/BaseAnnotationTool"),Ua=(0,a.importInternal)("drawing/getNewContext"),Va=(0,a.importInternal)("drawing/draw"),Fa=(0,a.importInternal)("drawing/drawRect"),ja=(0,a.importInternal)("drawing/drawLinkedTextBox"),Ha=(0,a.importInternal)("util/getLogger"),za=Ha?Ha("tools:annotation:LengthTool"):console,qa=function(e){function t(t){void 0===t&&(t={});return e.call(this,t,{name:"AI",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}})||this}return Ra(t,e),t.prototype.activeCallback=function(e){this.forceImageUpdate(e)},t.prototype.passiveCallback=function(e){this.forceImageUpdate(e)},t.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},t.prototype.forceImageUpdate=function(e){a.external.cornerstone.getEnabledElement(e).image&&a.external.cornerstone.updateImage(e)},t.prototype.createNewMeasurement=function(){},t.prototype.updateCachedStats=function(){},t.prototype.pointNearTool=function(e,t,n,r){var o=t&&t.handles&&t.handles.start&&t.handles.end;if(o||za.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!o||!1===t.visible)return!1;var i="mouse"===r?15:25,s=a.external.cornerstone.pixelToCanvas(e,t.handles.start),l=a.external.cornerstone.pixelToCanvas(e,t.handles.end),c={left:Math.min(s.x,l.x),top:Math.min(s.y,l.y),width:Math.abs(s.x-l.x),height:Math.abs(s.y-l.y)},u=a.external.cornerstoneMath.rect.distanceToPoint(c,n);return t.handles.disable=u<i,t.handles.disable},t.prototype.renderToolData=function(e){var t=this,n=(0,a.getToolState)(e.currentTarget,this.name),r=e.currentTarget.dataset,o=r.seriesId,i=r.currentImageIdIndex;if(!n){var s=Ma.get("".concat(o,"?index=").concat(i));if(!s)return;n={data:s},s.forEach((function(r,o){o>=1&&a.external.cornerstoneMath.point.distance(r.handles.textBox,n.data[o-1].handles.textBox)<100&&(r.textBoxPointsCompute=!0),(0,a.addToolState)(e.currentTarget,t.name,r)}))}var l=e.detail,c=l.image,u=l.element,d=a.toolStyle.getToolWidth(),f=(0,a.getModule)("globalConfiguration").configuration.lineDash,h=this.configuration,p=h.handleRadius,m=h.drawHandlesOnHover,g=h.hideHandlesIfMoving,v=h.renderDashed,y=Ua(l.canvasContext.canvas);Va(y,(function(e){for(var t=0;t<n.data.length;t++){var r=n.data[t],o=a.toolColors.getColorIfActive(r),i={color:o,handleRadius:p,drawHandlesIfActive:m,hideHandlesIfMoving:g};v&&({color:o}.lineDash=f),Fa(e,u,r.handles.start,r.handles.end,i,"pixel");if(r.textBoxPointsCompute){var s=Na([200,150],2),l=s[0],h=s[1],y=c.height-h,b=c.width-l,x={x:0,y:0};switch(t){case 2:x={x:b,y:0};break;case 3:x={x:0,y};break;case 4:x={x:b,y}}r.handles.textBox=_a(_a({},r.handles.textBox),x),r.textBoxPointsCompute=!1}ja(e,u,r.handles.textBox,r.textBoxContent,r.handles,(function(e){return[e.start,e.end]}),o,d,20,!1)}}))},t}(Ba);const Wa=qa;var Ga=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ya=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Za=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Xa=(0,a.importInternal)("base/BaseTool"),Qa=(0,a.importInternal)("drawing/getNewContext"),Ka=(0,a.importInternal)("drawing/draw"),Ja=(0,a.importInternal)("drawing/drawTextBox");!function(e){function n(t){void 0===t&&(t={});return e.call(this,t,{name:"OrientationMarkers",configuration:{},mixins:["enabledOrDisabledBinaryTool"]})||this}Ga(n,e),n.prototype.enabledCallback=function(e){this.forceImageUpdate(e)},n.prototype.disabledCallback=function(e){this.forceImageUpdate(e)},n.prototype.forceImageUpdate=function(e){a.external.cornerstone.getEnabledElement(e).image&&a.external.cornerstone.updateImage(e)},n.prototype.renderToolData=function(e){var n=e.detail,r=Qa(n.canvasContext.canvas),o=n.image,i=o.width,s=o.height,l=o.imageId,c=n.element,u=t.metaData.get("imageOrientationTagModule","cacheDB:"+l),d=u.imageleftTag,f=u.imagetopTag,h=u.imagetightTag,p=u.imageBottomTag;Ka(r,(function(e){var n,r;try{for(var o=Ya([[0,s/2,d,{y:!0}],[i/2,0,f,{x:!0}],[i-30,s/2,h,{y:!0}],[i/2,s-10,p,{x:!0,y:!0}]]),l=o.next();!l.done;l=o.next()){var u=Za(l.value,4),m=u[0],g=u[1],v=u[2],y=u[3],b=(0,t.pixelToCanvas)(c,{x:m,y:g,_pixelCoordinateBrand:""});Ja(e,v,b.x,b.y,a.toolColors.getToolColor(),{centering:y})}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}))}}(Xa);var $a=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const ei=function(e){function t(t){void 0===t&&(t={});var n=this;return(n=e.call(this,t,{name:"PersistentSate",configuration:{},mixins:["enabledOrDisabledBinaryTool"]})||this).state="disabled",n}return $a(t,e),t.prototype.enabledCallback=function(){this.state="enabled"},t.prototype.disabledCallback=function(){this.state="disabled"},t}((0,a.importInternal)("base/BaseTool"));var ti=R.toolColor,ni=R.zoomTool,ri={configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:ni.minScale,maxScale:ni.maxScale}};function oi(){(0,a.setToolEnabled)("PersistentSate"),(0,a.setToolEnabled)("ScaleOverlay"),(0,a.setToolEnabled)("OrientationMarkers"),"mobile"===U.env?((0,a.setToolActive)("ZoomTouchPinch",{}),(0,a.setToolActive)("PanMultiTouch",{})):((0,a.setToolActive)("StackScrollMouseWheel",{}),(0,a.setToolActive)("Wwwc",{mouseButtonMask:2}),(0,a.setToolActive)("Pan",{mouseButtonMask:4}))}a.external.cornerstoneMath=We(),a.external.cornerstone=o(),a.external.Hammer=ze(),(0,a.init)({globalToolSyncEnabled:!0,mouseEnabled:!0,showSVGCursors:!0,autoResizeViewports:!0}),(0,a.addTool)(a.WwwcTool),(0,a.addTool)(xa),(0,a.addTool)(a.ReferenceLinesTool),(0,a.addTool)(Dr,{configuration:{showMinMax:!0}}),(0,a.addTool)(a.StackScrollTool),(0,a.addTool)(a.FreehandRoiTool,{configuration:{showMinMax:!0}}),(0,a.addTool)(a.CircleRoiTool,{configuration:{showMinMax:!0}}),(0,a.addTool)(ma),(0,a.addTool)(a.EraserTool),(0,a.addTool)(a.PanTool),(0,a.addTool)(Sn,{}),(0,a.addTool)($r,{configuration:{showMinMax:!0}}),(0,a.addTool)(xo,{}),(0,a.addTool)(Uo,{}),(0,a.addTool)(Ho),(0,a.addTool)(aa),(0,a.addTool)(qn),(0,a.addTool)(rr),(0,a.addTool)(Ft,{markerFlag:"L"}),(0,a.addTool)(Ft,{markerFlag:"R"}),(0,a.addTool)(rn),(0,a.addTool)(Ct),(0,a.addTool)(st),(0,a.addTool)($e),(0,a.addTool)(Wa),(0,a.addTool)(a.OrientationMarkersTool),(0,a.addTool)(a.ZoomTool,ri),(0,a.addTool)(ei),"mobile"===U.env?((0,a.addTool)(a.ZoomTouchPinchTool,ri),(0,a.addTool)(a.PanMultiTouchTool)):(0,a.addTool)(a.StackScrollMouseWheelTool),a.toolColors.setToolColor(ti),a.store.state.clickProximity=20,a.store.state.touchProximity=30,a.store.state.handleRadius=8;var ai=(0,s.debounce)((function(){if("disabled"===(a.store.state.tools.find((function(e){return"PersistentSate"===e.name}))||{}).state){var e=U.webDicomView.layoutView.toolsContainer.querySelector(".tools2d .tool-event-link.disableAllTool");oi(),console.info("ForceEnabledGlobalTools"),e.click()}}),2e3);oi();var ii=n(4865);(0,ii.configure)({parent:".viewerContentWrapper"}),Se().settings({timeout:5e3});var si;si=function(){try{var e=navigator.userAgent.toLowerCase();if(e.indexOf("win32")>=0||e.indexOf("wow32")>=0)return 32;if(e.indexOf("win64")>=0||e.indexOf("wow64")>=0)return 64;if(new ActiveXObject("Wscript.Shell").RegRead("HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\\PROCESSOR_ARCHITECTURE").toLowerCase().indexOf("32")>=0)return 32}catch(e){}}(),console.info("systemInfo",{performance,navigator,screen,history,location,window,systemArchitecture:si}),32===si&&Se().info({title:"检测到浏览器为32位，可能导致软件异常，请使用64浏览器！！",timeout:0});var li=function(){return li=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},li.apply(this,arguments)};const ci=function(e,n){try{(0,t.getEnabledElement)(e)}catch(r){(0,t.enable)(e,li({},n))}};var ui=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},di=function(e){var n=e.element,r=e.canvas;try{var o={element:n};(0,t.triggerEvent)(n,t.EVENTS.ELEMENT_DISABLED,o),(0,t.triggerEvent)(t.events,t.EVENTS.ELEMENT_DISABLED,o),1===n.querySelectorAll("canvas").length&&(null==n||n.removeChild(r)),e.canvas=void 0}catch(e){console.info(e)}},fi=function(){var e,n,r=(0,t.getEnabledElements)();try{for(var o=ui(r),a=o.next();!a.done;a=o.next()){var i=a.value;di(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}r.length=0};const hi=function e(n){if(void 0===n)throw new Error("disable: element must not be undefined");for(var r=(0,t.getEnabledElements)(),o=0;o<r.length;o++){var a=r[o];if(a.element===n){var i=n.querySelectorAll("canvas");i.length>1&&i.forEach((function(t){return setTimeout((function(){return e(t.parentElement)}))})),di(a),r.splice(o,1)}}};const pi=new s.PromiseQueue;var mi=function(){return mi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},mi.apply(this,arguments)},gi=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},vi=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};o().loadAndCacheImage=function(e,n){return void 0===n&&(n={}),(0,t.loadAndCacheImage)(e,mi(mi({},n),{useRGBA:!0}))};var yi=function(e,t){return new Promise((function(n,r){return gi(void 0,void 0,void 0,(function(){var a,i,l;return vi(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,4]),[4,o().loadAndCacheImage(e,t)];case 1:return a=c.sent(),n(a),[3,4];case 2:return i=c.sent(),r(i),5e3,Me("loadAndCacheImage",(0,s.throttle)((function(e){var t,n=((null==e?void 0:e.error)||{}).status;t=void 0===n?"图像解析失败!":203===n?"授权验证失效，请稍后重试！":"图像解析失败，请稍后重试！",console.error(t,"错误信息：",e,n),Se().error({title:t,timeout:5e3})}),5e3,{trailing:!1}),i),l=y(e,U.imageType).indexedDBKey,[4,Te.open()];case 3:return c.sent(),console.info("即将执行数据清除:",l),Te.dispatch("delete",{},l),[3,4];case 4:return[2]}}))}))}))};const bi=function(e,t){return gi(void 0,void 0,void 0,(function(){var n,r,o,a,i,s,l,c;return vi(this,(function(u){switch(u.label){case 0:return r=(n=t||{}).cancel,o=void 0===r||r,a=n.forceCancelAll,i=void 0!==a&&a,s=n.countCallback,l="function"==typeof s,c=0,i?[2,pi.cancel()]:(!k.fullLoad&&o&&pi.cancel(),[4,pi.init({arr:e,func:function(e){return gi(void 0,void 0,void 0,(function(){var t,n;return vi(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,yi(e)];case 1:return t=r.sent(),c+=1,1,l&&s(t,e,c),Y("loadAndCacheImages",!1,400)&&0,[3,3];case 2:return n=r.sent(),console.error(n),[3,3];case 3:return[2]}}))}))},limit:6})]);case 1:return u.sent(),[2]}}))}))};const xi=function(e){var n=(0,t.getEnabledElement)(e);n.renderingTools.colormapId=void 0,n.renderingTools.colorLut=void 0;var r=n.renderingTools.renderCanvas,o=r.getContext("2d",{willReadFrequently:!0});o.fillStyle="white",o.fillRect(0,0,r.width,r.height);var a=o.getImageData(0,0,r.width,r.height);n.renderingTools.renderCanvasContext=o,n.renderingTools.renderCanvasData=a};var wi=[{type:"CT-Air"},{type:"CT-MIP"},{type:"CT-Soft-Tissue",name:"CT-软组织"},{type:"CT-Fat",name:"CT-脂肪"},{type:"CT-Lung",name:"CT-肺"},{type:"CT-Muscle",name:"CT-肌肉"},{type:"CT-Bone",name:"CT-骨"},{type:"CT-Bones",name:"CT-骨骼"},{type:"CT-Cropped-Volume-Bone",name:"CT-截骨"},{type:"CT-Cardiac",name:"CT-心脏"},{type:"CT-Cardiac2",name:"CT-心脏2"},{type:"CT-Cardiac3",name:"CT-心脏3"},{type:"CT-Chest-Contrast-Enhanced",name:"CT-胸部增强"},{type:"CT-Liver-Vasculature",name:"CT-肝血管"},{type:"CT-Chest-Vessels",name:"CT-胸部血管"},{type:"CT-Coronary-Arteries",name:"CT-冠状动脉"},{type:"CT-Coronary-Arteries-2",name:"CT-冠状动脉2"},{type:"CT-Coronary-Arteries-3",name:"CT-冠状动脉3"},{type:"CT-Pulmonary-Arteries",name:"CT-肺动脉"},{type:"CT-AAA"},{type:"CT-AAA2"},{type:"MR-Default"},{type:"MR-MIP"},{type:"MR-Angio",name:"MR-血管"},{type:"MR-T2-Brain",name:"MR-T2-大脑"},{type:"DTI-FA-Brain",name:"DTI-FA-大脑"}];const Ti=wi;var Ii=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Si=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Ci={main:[{toolName:"序列栏",toolTag:"seriesBar",icon:"icon-dicom-side",disActive:!0,visibility:function(){return"mobile"===U.env&&U.toolsBar.seriesBarVisibility}},{toolName:"MPR",toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:function(){return U.toolsBar.MPRVisibility}},{toolName:"3D",toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:function(){return U.toolsBar.VRTVisibility}},{toolName:"AI",toolTag:"AI",icon:"icon-dicom-ai",isToggle:!0,visibility:function(){return U.toolsBar.AIVisibility&&!(0,s.isNull)(U.instanceOptions.AI)}},{toolName:function(){return["极速模式","标准模式","专业模式"][U.imageType+1]},toolTag:"imageType",icon:function(){return["icon-dicom-mode3","icon-dicom-mode1","icon-dicom-mode2"][U.imageTypeDefault+1]},disActive:!0,select:!0,visibility:function(){return U.toolsBar.imageModeVisibility}},{toolName:"重载",toolTag:"reload",icon:"icon-dicom-reload",disActive:!0},{toolName:"释放",toolTag:"disableAllTool",icon:"icon-dicom-release"},{toolName:"恢复",toolTag:"cancelToolAndDefaultViewport",icon:"icon-dicom-restore",disActive:!0},{toolName:"翻页",toolTag:"stackScroll",icon:"icon-dicom-paging",visibility:function(){return"mobile"===U.env}},{toolName:"调窗",toolTag:"modulation",icon:"icon-dicom-tiaochuang",select:!0},{toolName:"预设调窗",toolTag:"modulationMenu",icon:"icon-dicom-tiaochuang2",select:!0},{toolName:"移动",toolTag:"move",icon:"icon-dicom-move",visibility:function(){return"mobile"!==U.env}},{toolName:"序列",toolTag:"series",icon:"icon-dicom-series",disActive:!0,select:!0},{toolName:"图像",toolTag:"image",icon:"icon-dicom-layout",disActive:!0,select:!0},{toolName:"放大镜",toolTag:"magnify",icon:"icon-dicom-magnifier"},{toolName:"播放",toolTag:"timeplay",icon:"icon-dicom-play",isToggle:!0},{toolName:"旋转",toolTag:"rotate",icon:"icon-dicom-rotate",select:!0},{toolName:"负像",toolTag:"invert",disActive:!0,icon:"icon-dicom-negative"},{toolName:"缩放",toolTag:"scale",icon:"icon-dicom-scale",select:!0,visibility:function(){return"mobile"!==U.env}},{toolName:"测量",icon:"icon-dicom-measure",children:[]},{toolName:"直线",toolTag:"straightline",icon:"icon-dicom-line"},{toolName:"自由测量",toolTag:"freehandRoi",icon:"icon-dicom-curve"},{toolName:"角度",toolTag:"angle",icon:"icon-dicom-angle"},{toolName:"cobb角",toolTag:"cobbAngle",icon:"icon-dicom-cobb"},{toolName:"矩形",toolTag:"rect",icon:"icon-dicom-rectangle"},{toolName:"椭圆",toolTag:"elliptical",icon:"icon-dicom-round"},{toolName:"圆形",toolTag:"circle",icon:"icon-dicom-round",visibility:!1},{toolName:"点CT值",toolTag:"probeCT",icon:"icon-dicom-ct"},{toolName:"批注",icon:"icon-dicom-annotate",children:[]},{toolName:"文本批注",toolTag:"annotate",icon:"icon-dicom-text"},{toolName:"箭头批注",toolTag:"arrowAnnotate",icon:"icon-dicom-one-line-arrow"},{toolName:"左标记",toolTag:"lMarker",icon:"icon-dicom-L"},{toolName:"右标记",toolTag:"rMarker",icon:"icon-dicom-R"},{toolName:"删除标注",toolTag:"eraser",icon:"icon-dicom-rubber"},{toolName:"全部撤销",toolTag:"cancelToolState",icon:"icon-dicom-clean",disActive:!0},{toolName:"增强",icon:"icon-dicom-enhance",visibility:function(){return U.toolsBar.enhanceVisibility},children:[]},{toolName:"锐化",toolTag:"sharpen",icon:"icon-dicom-sharpen"},{toolName:"平滑",toolTag:"blur",icon:"icon-dicom-blur"},{toolName:"伪彩",toolTag:"colorMap",disActive:!0,icon:"icon-dicom-color-map",select:!0},{toolName:"定位线",toolTag:"referenceLine",isToggle:!0,icon:"icon-dicom-referenceLine"},{toolName:"心胸比",toolTag:"ctr",icon:"icon-dicom-CTR"},{toolName:"更多",icon:"icon-dicom-more",isLonelyGroup:!0,children:[]},{toolName:"DICOM信息",toolTag:"DICOMMetaDataInfo",disActive:!0,icon:"icon-dicom-info"},{toolName:"四角信息",toolTag:"visibilityCavanAroundInfo",isToggle:!0,isActive:U.cavanAroundInfo,icon:"icon-dicom-show"},{toolName:"删除图像",toolTag:"disableSeries",icon:"icon-dicom-delete",disActive:!0},{toolName:"保存图片",toolTag:"saveImage",icon:"icon-dicom-img-save",disActive:!0},{toolName:"使用缓存",toolTag:"useCacheImage",icon:"icon-dicom-save",isToggle:!0,isActive:N.enable},{toolName:"高性能模式",toolTag:"imageCacheType",icon:"icon-dicom-speed",isToggle:!0,isActive:1===U.imageCacheTypeDefault},{toolName:"关于我们",toolTag:"aboutUs",icon:"icon-dicom-about",disActive:!0,floatRight:!0,visibility:function(){return U.toolsBar.aboutUsVisibility}}],MPR:[{toolName:"2D",toolTag:"MPRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:"3D",toolTag:"VRT",icon:"icon-dicom-3D",disActive:!0,visibility:function(){return U.toolsBar.VRTVisibility}},{toolName:"翻页",toolTag:"MPRstackScroll",icon:"icon-dicom-paging",visibility:function(){return"mobile"===U.env}},{toolName:"十字准星",toolTag:"MPRCrosshairs",icon:"icon-dicom-aim"},{toolName:"调窗",toolTag:"MPRmodulation",icon:"icon-dicom-tiaochuang",visibility:function(){return"mobile"===U.env}},{toolName:"缩放",toolTag:"MPRZoom",icon:"icon-dicom-scale",visibility:function(){return"mobile"!==U.env}},{toolName:"重置视图",toolTag:"MPRReset",icon:"icon-dicom-reload",disActive:!0},{toolName:"密度投影",icon:"icon-dicom-projection",isLonelyGroup:!0},{toolName:"最大密度投影",toolTag:"MPRMaxIntensity"},{toolName:"最小密度投影",toolTag:"MPRMinIntensity"},{toolName:"平均密度投影",toolTag:"MPRAverageIntensity"},{toolName:"默认",toolTag:"MPRComposite"},{toolName:"层厚",toolTag:"MPRThickness",icon:"icon-dicom-thickness",isLonelyGroup:!0,select:!0},{toolName:"体积",toolTag:"MPRVolume",icon:"icon-dicom-volume",isToggle:!0},{toolName:"视图预设",toolTag:"MPRViewportPresets",icon:"icon-dicom-color-map",isLonelyGroup:!0,visibility:!1,children:Si([],Ii(Ti.map((function(e){var t=e.type;return{toolNameAlias:e.name||t,toolType:t,toolTag:"MPRApplyPreset"}}))),!1)},{toolName:"画质调整",toolTag:"MPRLevel",icon:"icon-dicom-picture-quality",disActive:!0}],VRT:[{toolName:"2D",toolTag:"VTRReload2D",icon:"icon-dicom-2D",disActive:!0},{toolName:"MPR",toolTag:"MPR",icon:"icon-dicom-MPR",disActive:!0,visibility:function(){return U.toolsBar.MPRVisibility}},{toolName:"旋转",toolTag:"VRTRotate",icon:"icon-dicom-rotate3d",visibility:function(){return"mobile"===U.env}},{toolName:"骨窗调节",toolTag:"VRTModulation",icon:"icon-dicom-tiaochuang",visibility:function(){return"mobile"===U.env}},{toolName:"手术刀内",toolTag:"VRTKnifeIn",icon:"icon-dicom-shoushudao1"},{toolName:"手术刀外",toolTag:"VRTKnifeOut",icon:"icon-dicom-shoushudao"},{toolName:"重置视图",toolTag:"VRTReset",icon:"icon-dicom-reload",disActive:!0}]};const Ei=Ci;var Ai=function(){return Ai=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ai.apply(this,arguments)},Mi=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},Pi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Di={main:[{toolName:"序列栏"},{toolName:"MPR"},{toolName:"3D"},{toolName:"AI"},{toolTag:"imageType"},{toolName:"重载"},{toolName:"释放"},{toolName:"恢复",divider:!0},{toolName:"翻页"},{toolName:"调窗"},{toolName:"移动"},{toolName:"序列"},{toolName:"图像"},{toolName:"放大镜"},{toolName:"播放"},{toolName:"旋转"},{toolName:"负像"},{toolName:"缩放",divider:!0},{toolName:"测量",children:[{toolName:"直线"},{toolName:"自由测量"},{toolName:"角度"},{toolName:"cobb角"},{toolName:"矩形"},{toolName:"椭圆"},{toolName:"点CT值"}]},{toolName:"批注",children:[{toolName:"文本批注"},{toolName:"箭头批注"},{toolName:"左标记"},{toolName:"右标记"}]},{toolName:"删除标注"},{toolName:"全部撤销",divider:!0},{toolName:"增强",children:[{toolName:"锐化"},{toolName:"平滑"}]},{toolName:"伪彩"},{toolName:"定位线"},{toolName:"心胸比",divider:!0},{toolName:"更多",children:[{toolName:"DICOM信息"},{toolName:"四角信息"},{toolName:"删除图像"},{toolName:"保存图片"},{toolName:"使用缓存"},{toolName:"高性能模式"}]},{toolName:"关于我们"}],MPR:[{toolName:"2D"},{toolName:"3D"},{toolName:"翻页"},{toolName:"十字准星"},{toolName:"移动"},{toolName:"调窗"},{toolName:"缩放"},{toolName:"密度投影",children:[{toolName:"最大密度投影"},{toolName:"最小密度投影"},{toolName:"平均密度投影"},{toolName:"默认"}]},{toolName:"层厚"},{toolName:"重置视图",divider:!0},{toolName:"体积"},{toolName:"视图预设",divider:!0},{toolName:"画质调整"}],VRT:[{toolName:"2D"},{toolName:"MPR"},{toolName:"旋转"},{toolName:"骨窗调节"},{toolName:"手术刀内"},{toolName:"手术刀外"},{toolName:"重置视图"}]},ki={main:[{toolName:"序列栏"},{toolName:"调窗",select:!1},{toolName:"预设调窗"},{toolName:"翻页"},{toolName:"MPR"},{toolName:"测量",toolNameAlias:"测绘",children:[{toolName:"直线"},{toolName:"自由测量",toolNameAlias:"曲面测量"},{toolName:"角度"},{toolName:"cobb角"},{toolName:"矩形"},{toolName:"椭圆",divider:!0},{toolName:"心胸比"},{toolName:"定位线",divider:!0},{toolName:"点CT值"},{toolName:"文本批注"},{toolName:"箭头批注"},{toolName:"左标记"},{toolName:"右标记",divider:!0},{toolName:"删除标注"},{toolName:"全部撤销"}]},{toolName:"专业",icon:"icon-dicom-box",children:[{toolName:"重载"},{toolName:"释放"},{toolName:"恢复",divider:!0},{toolName:"3D"},{toolName:"AI",divider:!0},{toolName:"旋转"},{toolName:"放大镜"},{toolName:"负像"},{toolName:"伪彩"},{toolName:"播放",divider:!0},{toolName:"序列"},{toolName:"图像"}]},{toolName:"增强",children:[{toolName:"锐化"},{toolName:"平滑"}]},{toolName:"更多",floatRight:!0,children:[{toolTag:"imageType"},{toolName:"DICOM信息"},{toolName:"四角信息"},{toolName:"删除图像"},{toolName:"保存图片"},{toolName:"使用缓存"},{toolName:"高性能模式"},{toolName:"关于我们"}]}],MPR:[{toolName:"2D"},{toolName:"3D"},{toolName:"翻页"},{toolName:"十字准星"},{toolName:"移动"},{toolName:"调窗"},{toolName:"缩放"},{toolName:"密度投影",children:[{toolName:"最大密度投影"},{toolName:"最小密度投影"},{toolName:"平均密度投影"},{toolName:"默认"}]},{toolName:"层厚"},{toolName:"重置视图",divider:!0},{toolName:"体积"},{toolName:"视图预设",divider:!0},{toolName:"画质调整"}],VRT:[{toolName:"2D"},{toolName:"MPR"},{toolName:"旋转"},{toolName:"骨窗调节"},{toolName:"手术刀内"},{toolName:"手术刀外"},{toolName:"重置视图"}]},Li=function e(t,n,r){var o,a;void 0===r&&(r=!1);var i=Ei[n],s=[],l=function(t){var o=t.toolName,a=t.toolTag,l=t.children,c=Mi(t,["toolName","toolTag","children"]),u=i.find((function(e){return o?e.toolName===o:a?e.toolTag===a:void 0}));if(!u&&l&&(u=Ai({},t)),u){if(r&&(l&&console.warn("不建议多层菜单，影响交互体验",l),(u.children||u.select)&&console.warn("不建议菜单嵌套，影响交互体验",u)),l){var d=e(l,n,!0);d&&(u.children=d)}s.push(Ai(Ai({},u),c))}};try{for(var c=Pi(t),u=c.next();!u.done;u=c.next()){l(u.value)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}return s},Oi="mobile"===U.env?ki:Di,Ri={mobile:ki,PC:Di};const _i=function(){return Li(U.toolsBar.customMenu.main||Oi.main,"main")},Ni=function(){return Li(U.toolsBar.customMenu.MPR||Oi.MPR,"MPR")},Bi=function(){return Li(U.toolsBar.customMenu.VRT||Oi.VRT,"VRT")};var Ui=function(){return Ui=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ui.apply(this,arguments)},Vi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Fi=function(e){var n=e.btnTarget,r=e.toolData,o=e.toolDefault,a=e.classNameCopilot;new zi(a||"moreLayout",e,(function(e){var a,i,l=function(a){var i=a.toolName,l=a.toolNameAlias,c=a.toolType,u=a.toolTag,d=void 0===u?"":u,f=a.icon,h=a.isActive,p=a.visibility,m=a.divider,g=a.select,v=a.children,y=l||("function"==typeof i?i():i),b=Ui(Ui({},a),{parentData:r}),x=(0,s.createElement)({tagName:"i",className:"iconfont"});f&&x.classList.add("function"==typeof f?f():f);var w=(0,s.createElement)({className:"text",tagName:"span",innerText:y}),T=(0,s.createElement)({className:"select-popup-item tool-event-link ".concat(c||d),title:y,onclick:function(e){(0,t.triggerEvent)(t.events,"tool_event",{events:e,toolData:b,btnTarget:T,btnOriginTarget:n})}});T.dataset.toolData=JSON.stringify(b),T.dataset.toolType=c||d,h&&(T.classList.add("active"),n.classList.add("active")),d===(null==o?void 0:o.toolTag)&&(T.classList.add("active"),setTimeout((function(){(0,t.triggerEvent)(t.events,"tool_event",{toolData:b,btnTarget:T,btnOriginTarget:n})}))),(!1===p||"function"==typeof p&&!p())&&T.classList.add("hidden"),m&&T.classList.add("menu-divider"),(v||g)&&T.appendChild((0,s.createElement)({tagName:"i",className:"triangle"})),T.appendChild(x),T.appendChild(w),e.appendChild(T)};try{for(var c=Vi(r.children),u=c.next();!u.done;u=c.next())l(u.value)}catch(e){a={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}}))};const ji=Fi;var Hi=function(){function e(e,t,n,r){var o=this;this.className="select-popup-layout";var a=t.btnTarget,i=t.events,l=t.forceRender,c=t.destroy,u=this.layout=a.querySelector(".".concat(this.className,".").concat(e));if(this.layout&&(l||c)){var d=!this.layout.classList.contains("invisible");if(this.layout.remove(),this.layout=void 0,c||d)return}if(!this.layout){u=this.layout=(0,s.createElement)({className:"".concat(this.className," ").concat(e," invisible"),onclick:function(e){var t=e.target,n=t.classList.contains("tool-event-link")?t:t.parentElement,r=JSON.parse(n.dataset.toolData||"{}"),a=r.select,i=r.children,s=r.toolTag;if(e.stopPropagation(),t!==u)if(i){var l=n.classList.toggle("open-mark");new ji({events:{},toolData:r,btnTarget:n,classNameCopilot:"menu-nest",isMenuNest:!0,destroy:!l})}else if(a){var c=U.webDicomView.layoutView.toolsContainer.querySelector(".".concat(o.className,".").concat(s,":not(.invisible)"));c&&o.setLeft({btnTarget:n,_layout:c,forceShow:!0,isMenuNest:!0})}else o.hideLayout(!0)},ontouchmove:function(e){e.stopPropagation()}});var f=(0,s.createElement)({className:"select-popup-container"});null==n||n(f),u.appendChild(f),a.appendChild(u),a.addEventListener("mouseleave",(function(){return o.mouseleaveHandle()})),a.addEventListener("mouseenter",(function(){return o.mouseenterHandle()}))}null==r||r(u),i&&this.setLeft(t)}return e.prototype.mouseleaveHandle=function(){var e=this;this.timer=setTimeout((function(){e.hideLayout()}),"mobile"===U.env?0:300)},e.prototype.mouseenterHandle=function(){this.timer&&clearTimeout(this.timer)},e.prototype.hideLayout=function(e){this.layout.classList.add("invisible"),U.webDicomView.layoutView.removeOpenMark(),e&&U.webDicomView.layoutView.selectPopupHidden()},e.prototype.setLeft=function(e){var t=e.btnTarget,n=e.isMenuNest,r=e._layout,o=e.forceShow,a=e.direction,i=(null==t?void 0:t.getBoundingClientRect())||{},s=i.left,l=i.bottom,c=i.top,u=i.right,d=r||this.layout,f=U.webDicomView.globalContainer.clientWidth,h=d.clientWidth,p=d.clientHeight;n?(d.style.left="".concat(f-u>s?u+h>f?f-h:u:s-h>0?s-h:0,"px"),d.style.top="".concat(c,"px")):(d.style.left="".concat(s+h>f?f-h:s,"px"),d.style.top="".concat(l,"px")),"top"===a&&(d.style.top="".concat(c-p,"px")),d.classList.toggle("invisible",!o&&!d.classList.contains("invisible"))},e}();const zi=Hi;var qi=function(){return qi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},qi.apply(this,arguments)},Wi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Gi=function(){function e(){this.data=[{title:"极速模式",icon:"icon-dicom-mode3",type:-1,visibility:function(){var e,t;return null!==(t=null===(e=U.toolsBar)||void 0===e?void 0:e.fastImageModeVisibility)&&void 0!==t?t:U.toolsBar.fasModeVisibility}},{title:"标准模式",icon:"icon-dicom-mode1",type:0,visibility:function(){return U.toolsBar.staModeVisibility}},{title:"专业模式",icon:"icon-dicom-mode2",visibility:function(){return U.toolsBar.majModeVisibility},type:1}]}return e.prototype.createLayout=function(e){var n=this;new zi("imageType",e.detail,(function(r){var o,a,i=function(n){var o=n.title,a=n.icon,i=n.visibility;if(!1!==(null==i?void 0:i())){var l=(0,s.createElement)({tagName:"i",className:"iconfont "+a}),c=(0,s.createElement)({tagName:"span",innerText:o}),u=(0,s.createElement)({className:"select-popup-item",title:o,onclick:function(){(0,t.triggerEvent)(t.events,"tool_imageType",qi(qi({},n),e.detail))}});u.appendChild(l),u.appendChild(c),r.appendChild(u)}};try{for(var l=Wi(n.data),c=l.next();!c.done;c=l.next()){i(c.value)}}catch(e){o={error:e}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}}))},e.prototype.handleLayout=function(e){var t=e.title,n=e.btnTarget,r=e.icon;if(e.custom){var o=this.data.find((function(e){return e.type===U.imageType}));t=o.title,r=o.icon,n=U.webDicomView.layoutView.toolsContainer.querySelector(".tools2d .tool-event-link.imageType"),U.imageType}var a=n.querySelector(".toolbar-text")||n.querySelector(".text"),i=n.querySelector("i.iconfont");n.title=t,a.innerText=t,i.className="iconfont "+r},e}();const Yi=Gi;var Zi=function(){return Zi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Zi.apply(this,arguments)},Xi=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Qi=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Ki=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ji=function(){function e(){this.data=[{title:"肺窗",name:"lungs",WW:1750,WC:-500},{title:"纵隔窗",name:"mediastinum",WW:300,WC:40},{title:"骨窗",name:"bone",WW:1250,WC:300},{title:"头颅",name:"skull",WW:90,WC:35},{title:"软组织窗",name:"flab",WW:400,WC:50,divider:!0},{title:"自定义窗宽/位",name:"custom"}]}return e.prototype.createLayout=function(e){var n=this,r=e.detail,o=r.isPng,a=r.modality;new zi("modulation",Zi(Zi({},e.detail),{forceRender:!0}),(function(e){var r,i,l=function(n){var r=n.title,o=n.divider,a=(0,s.createElement)({className:"select-popup-item",title:r,innerText:r,onclick:function(){(0,t.triggerEvent)(t.events,"tool_wwwc",n)}});o&&a.classList.add("menu-divider"),e.appendChild(a)};try{for(var c=Ki(o||"CT"!==a?[n.data[5]]:n.data),u=c.next();!u.done;u=c.next()){l(u.value)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}))},e.prototype.handleLayout=function(e,n){return Xi(this,void 0,void 0,(function(){var r,o,a,i;return Qi(this,(function(s){switch(s.label){case 0:return r=n.name,o=n.WW,a=n.WC,i=e.querySelector(".layoutImage.active"),e=i||e,"custom"!==r?[3,3]:[4,an("请输入窗宽：(例：255）",/^[-+]?\d+(\.\d*)?$/,"数据有误，请重新输入！！！")];case 1:return null===(o=s.sent())?[2]:[4,an("请输入窗位：(例：128）",/^[-+]?\d+(\.\d*)?$/,"数据有误，请重新输入！！！")];case 2:a=s.sent(),s.label=3;case 3:return null===o||null==a||(0,t.setViewport)(e,{voi:{windowWidth:Number(o),windowCenter:Number(a)}}),[2]}}))}))},e}();const $i=Ji;var es=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ts=function(){function e(){this.data=[{title:"恢复默认",name:"default",icon:"icon-dicom-restore"},{title:"逆时针90°",name:"anticlockwise",icon:"icon-dicom-rotate90R"},{title:"顺时针90°",name:"clockwise",icon:"icon-dicom-rotate90L"},{title:"垂直翻转",name:"leftRight",icon:"icon-dicom-leftRight"},{title:"水平翻转",name:"upDown",icon:"icon-dicom-upDown"}]}return e.prototype.createLayout=function(e){var n=this;new zi("rotate",e.detail,(function(e){var r,o,a=function(n){var r=n.title,o=n.icon,a=(0,s.createElement)({tagName:"i",className:"iconfont "+o}),i=(0,s.createElement)({tagName:"span",innerText:r}),l=(0,s.createElement)({className:"select-popup-item",title:r,onclick:function(){(0,t.triggerEvent)(t.events,"tool_rotate",n)}});l.appendChild(a),l.appendChild(i),e.appendChild(l)};try{for(var i=es(n.data),l=i.next();!l.done;l=i.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}))},e.prototype.handleLayout=function(e,n){var r=n.name,o=e.querySelector(".layoutImage.active");e=o||e;var a=(0,t.getViewport)(e);switch(r){case"default":a.rotation=0,a.hflip=!1,a.vflip=!1;break;case"anticlockwise":a.rotation-=90;break;case"clockwise":a.rotation+=90;break;case"leftRight":a.hflip=!a.hflip;break;case"upDown":a.vflip=!a.vflip}(0,t.setViewport)(e,a)},e}();const ns=ts;function rs(e,n,r){if(r!==n){var o=(0,t.getViewport)(n),a=(0,t.getViewport)(r);a.rotation===o.rotation&&a.hflip===o.hflip&&a.vflip===o.vflip||(a.rotation=o.rotation,a.hflip=o.hflip,a.vflip=o.vflip,e.setViewport(r,a))}}function os(e,n,r){if(r!==n){var o=(0,t.getViewport)(n),a=(0,t.getViewport)(r);a.translation.x===o.translation.x&&a.translation.y===o.translation.y||(a.translation.x=o.translation.x,a.translation.y=o.translation.y,e.setViewport(r,a))}}function as(e,n,r){if(r!==n){var o=(0,t.getViewport)(n),a=(0,t.getViewport)(r);a.voi.windowWidth===o.voi.windowWidth&&a.voi.windowCenter===o.voi.windowCenter||(a.voi.windowWidth=o.voi.windowWidth,a.voi.windowCenter=o.voi.windowCenter,e.setViewport(r,a))}}function is(e,n,r){if(r!==n){var o=(0,t.getViewport)(n),a=(0,t.getViewport)(r);a.scale!==o.scale&&(a.scale=o.scale,e.setViewport(r,a))}}t.colors.getColormap("myCustomColorMap",{name:"myCustomColorMap",numColors:256,gamma:1,segmentedData:{red:[[0,1,0],[1,1,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}});const ss=[{id:"gray",name:"灰色",icon:n(5990)},{id:"blues",name:"蓝",icon:n(4842)},{id:"bone",name:"骨骼",icon:n(3701)},{id:"cool",name:"cool",icon:n(2778)},{id:"coolwarm",name:"冷色",icon:n(5263)},{id:"copper",name:"铜",icon:n(8495)},{id:"hot",name:"热金属",icon:n(3737)},{id:"hotIron",name:"铬铁",icon:n(2198)},{id:"hotMetalBlue",name:"热金属蓝",icon:n(1289)},{id:"hsv",name:"HSV",icon:n(3972)},{id:"jet",name:"Jet",icon:n(7136)},{id:"pet",name:"PET",icon:n(7573)},{id:"pet20Step",name:"PET 20 Step",icon:n(4321)},{id:"spectral",name:"光谱",icon:n(5945)},{id:"spring",name:"春天",icon:n(2425)},{id:"summer",name:"夏天",icon:n(898)},{id:"autumn",name:"秋天",icon:n(436)},{id:"winter",name:"冬天",icon:n(1217)}];var ls=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},cs=function(){function e(){this.data=ss}return e.prototype.createLayout=function(e){var n=this;new zi("colorMap",e.detail,(function(e){var r,o,a=function(n){var r=n.id,o=n.icon,a=n.name,i=(0,s.createElement)({tagName:"div",className:"select-grid-item2",title:r==a?r:"".concat(r,",").concat(a),onclick:function(){(0,t.triggerEvent)(t.events,"tool_colorMap",n)}}),l=(0,s.createElement)({tagName:"img",width:30,height:30,src:o});i.appendChild(l),e.appendChild(i)};try{for(var i=ls(n.data),l=i.next();!l.done;l=i.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}e.setAttribute("style","\n\t\t\t\t\tdisplay: grid;\n\t\t\t\t\tgrid-template-columns: repeat(4, 40px);\n\t\t\t\t\tpadding: 4px;\n\t\t\t \t")}))},e.prototype.handleLayout=function(e,n,r){var o=n.id,a=r.getHandler(),i=e.querySelector(".layoutImage.active");e=i||e,r.setHandler((function(e,n,r){a&&a(e,n,r),function(e,n,r){if(r!==n){var o=(0,t.getViewport)(n),a=(0,t.getViewport)(r);a.colormap!==o.colormap&&(a.colormap=o.colormap,e.setViewport(r,a))}}(e,n,r)})),(0,t.setViewport)(e,{colormap:o})},e}();const us=cs;var ds=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},fs=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},hs=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ps=R.zoomTool,ms=ps.minScale,gs=ps.maxScale,vs=function(){function e(){this.data=[{title:"自定义缩放",name:"custom"}]}return e.prototype.createLayout=function(e){var n=this;new zi("scale",e.detail,(function(e){var r,o,a=function(n){var r=n.title,o=(0,s.createElement)({className:"select-popup-item",title:r,innerText:r,onclick:function(){(0,t.triggerEvent)(t.events,"tool_scale",n)}});e.appendChild(o)};try{for(var i=hs(n.data),l=i.next();!l.done;l=i.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}))},e.prototype.handleLayout=function(e,n){return ds(this,void 0,void 0,(function(){var r,o;return fs(this,(function(a){switch(a.label){case 0:return r=n.name,o=n.scale,"custom"!==r?[3,2]:[4,an("请输入缩放比例：(例：".concat(ms,"~").concat(gs,"）"),(function(e){return/^\d+(\.\d*)?$/.test(e)&&e>=ms&&e<=gs}),"数据有误，请重新输入！！！")];case 1:o=a.sent(),a.label=2;case 2:return null===o||(0,t.setViewport)(e,{scale:Number(o)}),[2]}}))}))},e}();const ys=vs;const bs=function(){function e(){}return e.prototype.createSeriesMarker=function(e){var t=e.querySelector("#ltMarker"),n=e.querySelector("#rtMarker"),r=e.querySelector("#lbMarker"),o=e.querySelector("#rbMarker"),a="\n\t\tposition: absolute;\n\t\tfont-size: 10px;\n\t\ttext-shadow: 1px 1px 1px #000;\n\t\tcursor: default;\n\t\tpointer-events: none;\n\t\t";if(!t){var i=(0,s.createElement)({id:"ltMarker"});i.style.cssText=a+"left: 3px;top: 3px;text-align: left;",e.appendChild(i)}if(!n){var l=(0,s.createElement)({id:"rtMarker"});l.style.cssText=a+"right: ".concat("mobile"===U.env?6:16,"px;top: 3px;text-align: right;"),e.appendChild(l)}if(!r){var c=(0,s.createElement)({id:"lbMarker"});c.style.cssText=a+"left: 3px;bottom: 3px;text-align: left;",e.appendChild(c)}if(!o){var u=(0,s.createElement)({id:"rbMarker"});u.style.cssText=a+"right: ".concat("mobile"===U.env?6:16,"px;bottom: 3px;text-align: right;"),e.appendChild(u)}},e.prototype.createParagraph=function(e,t,n,r,o){this.createSeriesMarker(e);var a=e.querySelector("#"+t);if(a)switch(a.innerHTML="",t){case"ltMarker":var i=(0,s.createElement)({tagName:"p",innerHTML:"姓名："+((null==o?void 0:o.name)||n.name)}),l=(0,s.createElement)({tagName:"p",innerHTML:"ID："+((null==o?void 0:o.patientid)||n.patid)}),c=(0,s.createElement)({tagName:"p",innerHTML:"设备："+n.mod}),u=(0,s.createElement)({tagName:"p",innerHTML:"性别："+I((null==o?void 0:o.sex)||n.sex)}),d=(0,s.createElement)({tagName:"p",innerHTML:"年龄："+T((null==o?void 0:o.age)||n.age)});a.appendChild(i),a.appendChild(l),a.appendChild(c),a.appendChild(u),a.appendChild(d);break;case"rtMarker":var f=(0,s.createElement)({tagName:"p",innerHTML:"日期："+(n.acqdt||(null==o?void 0:o.studydate))}),h=(0,s.createElement)({tagName:"p",id:"filmMarker",innerHTML:"影像号： ".concat(n.stuid?((null==o?void 0:o.studyid)||n.stuid)+"-":"").concat(n.serid,"-").concat(n.imgnum)});h.id="filmMarker",a.appendChild(f),a.appendChild(h);break;case"lbMarker":var p=(0,s.createElement)({tagName:"p",innerHTML:"电压："+n.kv}),m=(0,s.createElement)({tagName:"p",innerHTML:"层厚："+n.sliceth});a.appendChild(p),a.appendChild(m);break;case"rbMarker":var g=(0,s.createElement)({tagName:"p",id:"scaleMarker",innerHTML:"倍数："+Number(r.scale).toFixed(2)}),v=(0,s.createElement)({tagName:"p",id:"wwWMarker",innerHTML:"窗位："+r.voi.windowWidth}),y=(0,s.createElement)({tagName:"p",id:"wwHMarker",innerHTML:"窗宽："+r.voi.windowCenter}),b=(0,s.createElement)({tagName:"p",innerHTML:(null==o?void 0:o.orgname)||n.inst});a.appendChild(g),a.appendChild(v),a.appendChild(y),a.appendChild(b)}},e}();function xs(e){"Error: element not enabled"!==(null==e?void 0:e.toString())&&console.error(e)}var ws=function(){return ws=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ws.apply(this,arguments)},Ts=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Is=function(){function e(){}return e.prototype.createTopTools=function(e,n,r,o,a){var i,l;void 0===o&&(o="toolsChild"),void 0===a&&(a=!1);var c=e.querySelectorAll(".toolsChild"),u=e.querySelector(".".concat(o));if(c.forEach((function(e){e.classList.remove("active")})),a&&(null==u||u.remove(),u=void 0),u)u.classList.add("active");else{var d=(0,s.createElement)({className:"toolsChild active ".concat(o)}),f=function(e){var n=e.toolName,o=e.toolNameAlias,a=e.toolType,i=e.toolTag,l=void 0===i?"":i,c=e.icon,u=e.iconText,f=e.iconImg,h=e.isActive,p=e.children,m=e.divider,g=e.floatRight,v=e.select,y=e.visibility,b=o||("function"==typeof n?n():n),x=(0,s.createElement)({tagName:"span",className:"tool-btn-style tool-event-link ".concat(a||l),title:b||u,onclick:function(n){var r={events:n,toolData:e,btnTarget:x};"Array"===(0,s.dataType)(p)&&new ji(r),l&&(0,t.triggerEvent)(t.events,"tool_event",r)}}),w=(0,s.createElement)({tagName:"i",className:"iconfont"}),T=(0,s.createElement)({tagName:"span",className:"toolbar-text",innerText:b});x.dataset.toolData=JSON.stringify(e),x.dataset.toolType=a||l,f?w=(0,s.createElement)({tagName:"img",src:f,className:"iconfont-img"}):c?w.classList.add("function"==typeof c?c():c):(w.innerHTML=u,w.setAttribute("style","\n\t\t\t\t\tfont-size: 24px;\n\t\t\t\t\tpadding:0 2px\n\t\t\t\t\t"),b||(w.style.lineHeight="48px",T.style.display="none")),(!1===y||"function"==typeof y&&!y())&&x.classList.add("hidden"),l===(null==r?void 0:r.toolTag)&&(x.classList.add("active"),setTimeout((function(){(0,t.triggerEvent)(t.events,"tool_event",{toolData:e,btnTarget:x})}))),h&&x.classList.add("active"),"Array"===(0,s.dataType)(p)&&(new ji({toolData:e,btnTarget:x,toolDefault:r}),w.appendChild((0,s.createElement)({tagName:"i",className:"triangle"}))),v&&w.appendChild((0,s.createElement)({tagName:"i",className:"triangle"})),x.appendChild(w),x.appendChild(T),g&&d.appendChild((0,s.createElement)({className:"flex-1"})),d.appendChild(x),m&&d.appendChild((0,s.createElement)({tagName:"span",className:"divider"}))};try{for(var h=Ts(n),p=h.next();!p.done;p=h.next()){f(p.value)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(l=h.return)&&l.call(h)}finally{if(i)throw i.error}}e.appendChild(d)}},e.prototype.clearTools=function(){console.info(a.store.state.tools.filter((function(e){return"passive"!==e.mode})),a.store.state)},e.prototype.disableAllTool=function(e){e.setHandler((function(){})),(0,a.setToolActive)("Pointer",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.rectangleRoiTools=function(){(0,a.setToolActive)("RectangleRoi",{mouseButtonMask:1})},e.prototype.ellipticalRoiTools=function(){(0,a.setToolActive)("EllipticalRoi",{mouseButtonMask:1})},e.prototype.circleRoiTools=function(){(0,a.setToolActive)("CircleRoi",{mouseButtonMask:1})},e.prototype.straightlineTools=function(){(0,a.setToolActive)("Length",{mouseButtonMask:1})},e.prototype.EraserTools=function(){(0,a.setToolActive)("Eraser",{mouseButtonMask:1})},e.prototype.angleTools=function(){(0,a.setToolActive)("Angle",{mouseButtonMask:1})},e.prototype.cobbAngleTools=function(){(0,a.setToolActive)("CobbAngle",{mouseButtonMask:1})},e.prototype.rotateTool=function(e){e.setHandler(rs),(0,a.setToolActive)("Rotate",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.scaleTool=function(e){e.setHandler(is),(0,a.setToolActive)("Zoom",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.magnifyTool=function(){(0,a.setToolActive)("Magnify",{mouseButtonMask:1})},e.prototype.modulationTool=function(e){e.setHandler(as),(0,a.setToolActive)("Wwwc",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.stackScrollTool=function(e){e.setHandler(a.stackImageIndexSynchronizer),(0,a.setToolActive)("StackScroll",{mouseButtonMask:1})},e.prototype.sharpenTool=function(){(0,a.setToolActive)("Sharpen",{mouseButtonMask:1})},e.prototype.blurTool=function(){(0,a.setToolActive)("Blur",{mouseButtonMask:1})},e.prototype.moveTool=function(e){e.setHandler(os),(0,a.setToolActive)("Pan",{mouseButtonMask:1,synchronizationContext:e})},e.prototype.FreehandRoiTool=function(){(0,a.setToolActive)("FreehandRoi",{mouseButtonMask:1})},e.prototype.ProbeCTTool=function(){(0,a.setToolActive)("ProbeCT",{mouseButtonMask:1})},e.prototype.ArrowAnnotateTool=function(){(0,a.setToolActive)("ArrowAnnotate",{mouseButtonMask:1})},e.prototype.AnnotateTool=function(){(0,a.setToolActive)("Annotate",{mouseButtonMask:1})},e.prototype.lrMarkerTool=function(e){"L"===e?(0,a.setToolActive)("AnnL",{mouseButtonMask:1}):(0,a.setToolActive)("AnnR",{mouseButtonMask:1})},e.prototype.heartratioTool=function(){(0,a.setToolActive)("Heartratio",{mouseButtonMask:1})},e.prototype.AITool=function(e){void 0===e&&(e=!1),e?(0,a.setToolPassive)("AI"):(0,a.setToolDisabled)("AI")},e.prototype.cancelTool=function(e,n){void 0===n&&(n=!0),a.globalImageIdSpecificToolStateManager.clear(e),n&&(0,t.updateImage)(e)},e.prototype.cancelToolAndDefaultViewportTools=function(e){var n,r;e&&0!==e.length||(e=(0,t.getEnabledElements)().map((function(e){return e.element})),a.globalImageIdSpecificToolStateManager.restoreToolState({}));try{for(var o=Ts(e),i=o.next();!i.done;i=o.next()){var s=i.value;try{if(!s)continue;var l=(0,t.getImage)(s),c=(0,t.getDefaultViewportForImage)(s,l);((0,t.getViewport)(s)||{}).colormap&&xi(s),this.cancelTool(s,!1),(0,t.setViewport)(s,ws(ws({},c),{sharpen:0,blur:0}))}catch(e){xs(e)}}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e}();const Ss=Is;var Cs=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Es=(0,a.importInternal)("util/scrollToIndex"),As=function(){function e(){this.layoutclassName="series-slider-layout",this.EVENTSHandle=new Map}return e.prototype.changMarker=function(e,t){var n=e.querySelector("#filmMarker");if(n){var r=n.innerHTML.split("-")[0]+"-"+n.innerHTML.split("-")[1]+"-"+(t+1);n.innerHTML=r}},e.prototype.createLayout=function(e,n,r){var o,i=this,l=e.querySelector(".".concat(this.layoutclassName)),c=function(){var t=e.dataset,n=t.imgRow,r=t.imgColumn;return Number(null!=n?n:1)*Number(null!=r?r:1)}(),u=Math.ceil((null===(o=null==n?void 0:n.imgs)||void 0===o?void 0:o.length)/c),d={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||l.clientHeight,this._scrollLen},set scrollLen(e){this._stepLen=0,this._scrollLen=e},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(u-1)/u,this._stepLen}},f=function(n){e.dataset.currentImageIdIndex=String(d.currentIndex),(0,t.triggerEvent)(t.events,"series_scroll",{element:e,imageIds:n,currentIndex:d.currentIndex,isSeriesImage:1!==c})};if(!l){var h=function(){var t,n=Cs((null===(t=(0,a.getToolState)(e,"stack"))||void 0===t?void 0:t.data)||[{}],1)[0],o=n.currentImageIdIndex,s=void 0===o?r||0:o,h=n.imageIds,p=d.scrollLen;if(l.scrollTop=p*s,s&&s%100==0&&Y("scroll",!1,400),1===c)i.changMarker(e,s),d.currentIndex=s;else{var m=s;if(m>=u&&(m=u,Es(e,U.webDicomView.layoutView.iconPlayer.playerStatus?0:m-1)),d.currentIndex===m)return;d.currentIndex=m}f(h)};l=(0,s.createElement)({className:this.layoutclassName});var p=(0,s.createElement)();p.style.height="calc(100% * ".concat(u,")"),l.appendChild(p),e.appendChild(l),r&&(Es(e,r),l.scrollTop=d.scrollLen*r,r=void 0),this.EVENTSHandle.set(e,h),e.addEventListener(t.EVENTS.NEW_IMAGE,h),l.addEventListener("scroll",(function(n){var r;if(d.scrollLen===l.clientHeight){var o=n.target,i=d.stepLen,s=d.currentIndex,h=Math.floor(o.scrollTop/i);if(!(h>=u||s==h)&&(Es(e,h),d.currentIndex=h,(0,t.triggerEvent)(t.events,"canvas_active",{$canvas:e,type:"wheel"}),1!==c)){var p=Cs((null===(r=(0,a.getToolState)(e,"stack"))||void 0===r?void 0:r.data)||[{}],1)[0].imageIds;f(p)}}else d.scrollLen=l.clientHeight}))}},e.prototype.removeLayout=function(e){var n=this.EVENTSHandle.get(e),r=e.querySelector(".".concat(this.layoutclassName));e.removeEventListener(t.EVENTS.NEW_IMAGE,n),this.EVENTSHandle.delete(e),null==r||r.remove()},e}();const Ms=As;const Ps=function(){function e(){this.className="study-slider-layout"}return e.prototype.createLayout=function(e,n,r,o){void 0===o&&(o=!1);var a,i,l=e.querySelector(".".concat(this.className)),c=(a=r.x,i=r.y,Number(null!=a?a:1)*Number(null!=i?i:1)),u=Math.ceil(n.length/c),d=this.scrollData={currentIndex:0,_scrollLen:0,get scrollLen(){return this._scrollLen=this._scrollLen||l.clientHeight,this._scrollLen},set scrollLen(e){this._stepLen=0,this._scrollLen=e},_stepLen:0,get stepLen(){return this._stepLen=this._stepLen||this.scrollLen*(u-1)/u,this._stepLen}};if(o&&(this.container.remove(),this.container=l=void 0),!l){this.container=l=(0,s.createElement)({className:this.className});var f=(0,s.createElement)();U.webDicomView.layoutView.canvasContainer.style.paddingRight=u<=1||"mobile"===U.env?"0px":"12px",l.style.display=u>1?"block":"none",f.style.height="calc(100% * ".concat(u,")"),l.appendChild(f),e.appendChild(l),l.addEventListener("scroll",(function(e){if(d.scrollLen===l.clientHeight){var n=e.target,r=d.stepLen,o=d.currentIndex,a=Math.floor(n.scrollTop/r);a>=u||o==a||(Me("triggerEvent_study_scroll",(0,s.debounce)((function(e){(0,t.triggerEvent)(t.events,"study_scroll",e)}),300),{currentIndex:a,layoutCount:c}),d.currentIndex=a)}else d.scrollLen=l.clientHeight}))}},e.prototype.visibility=function(e){this.container.style.visibility=e?"visible":"hidden"},e.prototype.setIndex=function(e){this.container.scrollTop=this.scrollData.stepLen*e+1},e}();var Ds=function(){function e(e,t){this.iconPlayer=e,this.container=t}return e.prototype.createLayout=function(e,t){var n=0===t;n&&this.createOrEditInfoBar(e,n),1===t&&this.createMenuBtn(),this.addItemMenu(e,n)},e.prototype.createOrEditInfoBar=function(e,t){var n=e.modality,r=e.name,o=e.sex,a=e.age,i=e.studydate,l="<span class='name' title='".concat(r,"'>").concat(r,"</span> / ").concat(I(o),"  / ").concat(T(a),"  / ").concat(i," ");if(t){this.infoBarContainer=(0,s.createElement)({className:"info-bar"});var c=(0,s.createElement)({className:"modality",innerText:"".concat(n)}),u=(0,s.createElement)({className:"details",innerHTML:l});this.infoBarContainer.appendChild(c),this.infoBarContainer.appendChild(u),this.container.appendChild(this.infoBarContainer)}else this.infoBarContainer.querySelector(".details").innerHTML=l,this.infoBarContainer.querySelector(".modality").innerText=n},e.prototype.createMenuBtn=function(){var e=this;if(this.infoBarContainer){var t=(0,s.createElement)({className:"menu-btn",innerText:"切换检查",onclick:function(){e.iconPlayer.playerPause(),e.toggleMenuVisibility()}});this.infoBarContainer.appendChild(t)}},e.prototype.activeFirst=function(){var e,t=null===(e=this.menuContainer)||void 0===e?void 0:e.querySelector(".menu-item");null==t||t.click()},e.prototype.addItemMenu=function(e,t){var n=this,r=e.modality,o=e.name,a=e.sex,i=e.age,l=e.studydate,c=e.studyid;t&&(this.menuContainer=(0,s.createElement)({className:"menu hidden"}),this.container.appendChild(this.menuContainer));var u=(0,s.createElement)({className:"menu-item ".concat(t&&"active"),onclick:function(){var t=n.container.parentElement.querySelectorAll(".study-navigation-body .studyNavigationContainer"),r=n.menuContainer.querySelectorAll(".menu-item");n.toggleElClassName(t,c,"hidden","remove"),n.toggleElClassName(r,c,"active","add"),n.createOrEditInfoBar(e,!1),n.toggleMenuVisibility(!1)}});u.dataset.studyId=c;var d=(0,s.createElement)({className:"modality",innerText:"".concat(r)}),f=(0,s.createElement)({className:"info",innerHTML:"<span class='name' title='".concat(o,"'>").concat(o,"</span> / ").concat(I(a),"  / ").concat(T(i)," ")}),h=(0,s.createElement)({className:"study-date",innerText:"".concat(l)}),p=(0,s.createElement)({className:"icon",innerHTML:'<i class="icon-dicom-arrow"</i>'});u.appendChild(d),u.appendChild(f),u.appendChild(h),u.appendChild(p),this.menuContainer.appendChild(u)},e.prototype.toggleElClassName=function(e,t,n,r){e.forEach((function(e){var o=t===e.getAttribute("data-study-id");e.classList.toggle(n,"add"===r?o:!o)}))},e.prototype.toggleMenuVisibility=function(e){var t=this.menuContainer;if(t){var n=void 0!==e?e:t.classList.contains("hidden");t.classList.toggle("hidden",!n)}},e}();const ks=Ds;var Ls=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Os=function(e,t){var n=this;this.data=[{title:"10FPS/S",val:10},{title:"20FPS/S",val:20},{title:"30FPS/S",val:30},{title:"40FPS/S",val:40},{title:"50FPS/S",val:50}];var r=e.target;new zi("fps",{btnTarget:r,events:e,direction:"top"},(function(e){var r,o,a=function(n,r){var o=(0,s.createElement)({className:"select-popup-item",title:n,innerText:n,onclick:function(){t(r)}});e.appendChild(o)};try{for(var i=Ls(n.data),l=i.next();!l.done;l=i.next()){var c=l.value;a(c.title,c.val)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}}))};const Rs=Os;var _s=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Ns=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Bs=i().import("util/scrollToIndex"),Us=function(e){var t,n=_s((null===(t=(0,a.getToolState)(e,"stack"))||void 0===t?void 0:t.data)||[{}],1)[0],r=n.currentImageIdIndex,o=void 0===r?0:r,i=n.imageIds;return{imageIds:i,currentImageIdIndex:Number(o),seriesImagesLen:i.length}},Vs=function(){function e(){this.eventNamespace="player",this.enableColor="white",this.disableColor="gray",this.framesPerSecond=10,this.EVENTSHandle=new Map,this.elementPlayClip,this.playerStatus=!0,this.playData=[{id:"player1001",title:"第一张",flag:"control",icon:"icon-dicom-first",cssText:"display: none;"},{id:"player1002",title:"上一张",flag:"control",icon:"icon-dicom-previous"},{id:"player1003",title:"播放",flag:"control",cssText:"color: ".concat(this.enableColor,";"),icon:"icon-dicom-play"},{id:"player1004",title:"下一张",flag:"control",icon:"icon-dicom-next"},{id:"player1005",title:"最后一张",flag:"control",icon:"icon-dicom-last",cssText:"display: none;"}],this.iconControls=[]}return e.prototype.createPlayer=function(e,n,r,o){var a=this;void 0===o&&(o=10);var i=n.querySelector("div.player-bar");if(i)return this.playerStatus=!1,void n.removeChild(i);this.playerStatus=!(r.loadIds.length>1),this.elementPlayClip=e,this.framesPerSecond=Math.round(o);var l=Us(e),c=l.seriesImagesLen,u=l.currentImageIdIndex,d=(0,s.createElement)({className:"player-bar",ondblclick:function(e){e.stopPropagation()},onmousedown:function(e){e.stopPropagation()}}),f=(0,s.createElement)({className:"slider-group"}),h=(0,s.createElement)({tagName:"input",className:"slider",type:"range",min:0,max:c-1,step:1,value:u,oninput:function(t){var n=Number(t.target.value);Bs(e,n)},onmousedown:function(){a.playerPause(e)},ontouchstart:function(){a.playerPause(e)}}),p=(0,s.createElement)({className:"slider-info",innerText:"".concat(u+1,"/").concat(c)});f.appendChild(h),f.appendChild(p),d.appendChild(f);for(var m=(0,s.createElement)({className:"body-group"}),g=(0,s.createElement)({className:"fps-option",innerHTML:"".concat(this.framesPerSecond,"FPS/S"),onclick:function(e){setTimeout((function(){new Rs(e,(function(e){a.framesPerSecond=e,g.innerHTML="".concat(a.framesPerSecond,"FPS/S"),y.value=String(a.framesPerSecond),a.playerStatus&&a.playerStart()}))}),100)}}),v=(0,s.createElement)({className:"fps-custom"}),y=(0,s.createElement)({className:"custom-input hidden",tagName:"input",type:"tel",maxLength:100,value:this.framesPerSecond,onkeyup:function(e){var t,n=e.target;if("Backspace"!==e.key){var r=null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.replace(/[^\d]/g,"");if(n.value=String(Math.min(50,Math.max(1,""===r?a.framesPerSecond:Number(r)))),"Enter"===e.key){if(c<=1)return;a.playerStart(),y.classList.add("hidden")}}},onblur:function(e){var t=e.target,n=null==t?void 0:t.value;a.framesPerSecond=Number(n)||a.framesPerSecond||10,t.value=String(a.framesPerSecond),b.classList.remove("hidden"),y.classList.add("hidden"),g.innerHTML="".concat(a.framesPerSecond,"FPS/S"),a.playerStatus&&a.playerStart()}}),b=(0,s.createElement)({tagName:"span",innerText:"自定义",onclick:function(){b.classList.add("hidden"),y.classList.remove("hidden"),y.value="",y.focus()}}),x=(0,s.createElement)({className:"fps-play"}),w=function(n){var o=T.playData[n],i=o.flag,l=o.title,c=o.cssText,u=o.icon,d=o.id;if("control"===i){var f=(0,s.createElement)({tagName:"i",className:"control ".concat(u," ").concat(d),title:l});f.style.cssText=c,f.addEventListener("mobile"===U.env?"touchstart":"click",(function(o){var i={event:o,series:r,playerData:a.playData[n],playerDom:e};(0,t.triggerEvent)(t.events,"iconplayer_series",i)})),T.iconControls.push(f),x.appendChild(f)}},T=this,I=0;I<this.playData.length;I++)w(I);v.appendChild(y),v.appendChild(b),m.appendChild(g),m.appendChild(v),m.appendChild(x),d.appendChild(m),n.appendChild(d),this.toggleControlStyle(u,c);var S=function(){var t=Us(e),n=t.seriesImagesLen,r=t.currentImageIdIndex;p.innerText="".concat(r+1,"/").concat(n),h.value=String(r)};t.events.addEventNamespaceListener("canvas_active.".concat(this.eventNamespace),(function(e){var t=e.detail.$canvas,n=U.webDicomView.queryCurrentSeries();if(t===a.elementPlayClip)return a.playerPause();a.playerRemove(),a.createPlayer(t,t.parentElement,n)})),this.EVENTSHandle.set(e,S),e.addEventListener(t.EVENTS.NEW_IMAGE,S),this.togglePalyerTool(!0)},e.prototype.playerToggle=function(e,t){if(t&&(this.elementPlayClip=t),this.elementPlayClip){var n=this.elementPlayClip.parentElement.querySelector(".player1003");this.playerStatus=e,this.playerToggleHandle(n,e)}},e.prototype.playerStart=function(e){this.playerToggle(!0,e)},e.prototype.playerPause=function(e){this.playerToggle(!1,e)},e.prototype.playerAllPauseAndRemove=function(){var e,n;this.playerRemove();try{for(var r=Ns((0,t.getEnabledElements)()),o=r.next();!o.done;o=r.next()){var i=o.value.element;(0,a.stopClip)(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e.prototype.playerRemove=function(e,n){void 0===n&&(n=!0);var r=e||this.elementPlayClip;if(r)try{var o=r.parentElement.querySelector("div.player-bar");o&&((0,a.stopClip)(r),o.remove(),n&&G("playerRemove"),this.togglePalyerTool(!1)),this.playerStatus=!1,this.iconControls=[],this.elementPlayClip=void 0}catch(e){xs(e)}finally{var i=this.EVENTSHandle.get(r);t.events.removeEventNamespaceListener("canvas_active.".concat(this.eventNamespace)),r.removeEventListener(t.EVENTS.NEW_IMAGE,i),this.EVENTSHandle.delete(r)}},e.prototype.playerBarClickHandle=function(e){var t=e.playerData,n=e.playerDom;if(e.event.target.style.color!==this.disableColor){var r=e.event.target,o=Us(n),a=o.seriesImagesLen,i=o.currentImageIdIndex,s=i;switch(t.id){case"player1001":0!==i&&(s=0);break;case"player1002":i>=1&&(s-=1);break;case"player1003":this.playerToggleHandle(r,!this.playerStatus);break;case"player1004":i<a-1&&(s+=1);break;case"player1005":i!==a-1&&(s=a-1)}this.toggleControlStyle(s,a),Bs(n,s)}},e.prototype.playerToggleHandle=function(e,t){void 0===t&&(t=!1),G(t?"playerResume":"playerPause"),(0,a.stopClip)(this.elementPlayClip),this.playerStatus=t,t?(e.title="暂停",e.classList.remove("icon-dicom-play"),e.classList.add("icon-dicom-pause"),(0,a.playClip)(this.elementPlayClip,this.framesPerSecond)):(e.title="播放",e.classList.remove("icon-dicom-pause"),e.classList.add("icon-dicom-play"))},e.prototype.togglePalyerTool=function(e){var t=U.webDicomView.layoutView.toolsContainer.querySelector(".tools2d .tool-event-link.timeplay");setTimeout((function(){return t.classList.toggle("active",e)}))},e.prototype.toggleControlStyle=function(e,t){if(this.iconControls.length){if(t<=1)return this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[2].style.color=this.disableColor,this.iconControls[3].style.color=this.disableColor,void(this.iconControls[4].style.color=this.disableColor);this.playerStatus&&(this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[3].style.color=this.disableColor,this.iconControls[4].style.color=this.disableColor),0===e&&t>0&&!this.playerStatus&&(this.iconControls[0].style.color=this.disableColor,this.iconControls[1].style.color=this.disableColor,this.iconControls[3].style.color=this.enableColor,this.iconControls[4].style.color=this.enableColor),e!==t-1||this.playerStatus||(this.iconControls[0].style.color=this.enableColor,this.iconControls[1].style.color=this.enableColor,this.iconControls[3].style.color=this.disableColor,this.iconControls[4].style.color=this.disableColor),e>0&&e<t-1&&!this.playerStatus&&(this.iconControls[0].style.color=this.enableColor,this.iconControls[1].style.color=this.enableColor,this.iconControls[3].style.color=this.enableColor,this.iconControls[4].style.color=this.enableColor)}},e}();const Fs=Vs;var js=function(){return js=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},js.apply(this,arguments)},Hs=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},zs=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},qs=function(){function e(e,t,n){this.seriesSlider=e,this.studySlider=t,this.iconSynchronizer=n,this.seriesLayouts=[]}return e.prototype.initSingle=function(e,t,n,r){var o,a;n=js({imgRow:"1",imgColumn:"1"},n);var i=r||{},l=i.synchronizerStatus,c=i.scrollIndex;try{for(var u=Hs(Object.entries(n||{})),d=u.next();!d.done;d=u.next()){var f=zs(d.value,2),h=f[0],p=f[1];!(0,s.isNull)(p)&&(e.dataset[h]=p)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}(0,s.isNull)(t)||(this.seriesSlider.createLayout(e,t,c),this.iconSynchronizer.createIconSynchronizer(e,l))},e.prototype.createCanvasSeries=function(e,n,r,o){var a;void 0===o&&(o=!0);var i=[],l=r.y,c=r.x,u=l*c;null===(a=e.querySelector(".container"))||void 0===a||a.remove();var d=(0,s.createElement)({className:"container"});d.setAttribute("style","\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(".concat(c,", calc(100% / ").concat(c,"));\n\t\t\t\tgrid-template-rows: repeat(").concat(l,", calc(100% / ").concat(l,"));\n\t\t\t\t"));for(var f=0;f<u;f++){var h=n[f],p=h||{},m=p.uuid,g=p.studyUID,v=p.arrImage,y=p.flatSeries,b=(0,s.createElement)({className:"layoutCellsOuter"+(1===u?" singleBoxMode":"")}),x=(0,s.createElement)({className:"layoutCellsInner"}),w=(null==v?void 0:v.length)||0;m&&(x.dataset.seriesId=m,x.dataset.studyUID=g,x.dataset.seriesIndex=String(f),x.dataset.seriesRow=String(l),x.dataset.seriesColumn=String(c),y&&(x.dataset.flatSeries=String(y))),this.initSeriesLayout(x,h),o&&w&&(this.seriesSlider.createLayout(x,h),this.iconSynchronizer.createIconSynchronizer(x)),i.push(x),b.appendChild(x),d.appendChild(b)}this.studySlider.createLayout(e,n,r),e.appendChild(d),(0,t.triggerEvent)(t.events,"first_active",{$canvas:i[0]})},e.prototype.createImagesLayout=function(e,t,n){var r=this,o=n.y,a=n.x,i=o*a;e.dataset.imgRow=String(o),e.dataset.imgColumn=String(a),this.seriesSlider.createLayout(e,t);var l=(0,s.createElement)({className:"layoutImageLayout"});l.setAttribute("style","\n\t\t\t\theight:100%;\n\t\t\t\tdisplay:grid;\n\t\t\t\tgrid-template-columns: repeat(".concat(a,", calc(100% / ").concat(a,"));\n\t\t\t\tgrid-template-rows: repeat(").concat(o,", calc(100% / ").concat(o,"));\n\t\t\t\t"));for(var c=function(t){var n=(0,s.createElement)({className:0===t?"layoutImage active":"layoutImage"});new(ze())(n).on("tap press panstart",(function(n){r.toggleStyle(e,t,"layoutImage"),n.preventDefault()})),l.appendChild(n)},u=0;u<i;u++)c(u);e.appendChild(l)},e.prototype.dblclickCanvasLayout=function(e,n,r){if(!e.classList.contains("singleBoxMode")){var o=n.querySelectorAll(".layoutImage"),a=null!=r?r:e.classList.contains("signBigLayout"),i=U.webDicomView.querySeries(n.dataset.seriesId);e.classList.toggle("signBigLayout",!a),this.studySlider.visibility(a),this.seriesSlider.removeLayout(n),i&&(o.length?o.forEach((function(e){(0,t.resize)(e)})):(0,t.resize)(n),this.seriesSlider.createLayout(n,i,Number(n.dataset.currentImageIdIndex)))}},e.prototype.initSeriesLayout=function(e,n){var r=this,o=function(e,n){(0,t.triggerEvent)(t.events,"canvas_active",{$canvas:e,type:n})};e.addEventListener("dragover",(function(e){e.preventDefault()})),e.addEventListener("drop",(function(t){t.preventDefault(),o(e,"drop")})),e.addEventListener("wheel",(function(){o(e,"wheel")})),e.addEventListener("click",(function(){o(e,"click")})),e.addEventListener("touchstart",(function(n){var r=n.type;o(e,"touchstart"),(0,t.triggerEvent)(t.events,"layout_area_focus",{area:"seriesLayout",type:r})})),new(ze())(e).on("doubletap",(function(){r.dblclickCanvasLayout(e.parentElement,e)})),e.addEventListener(t.EVENTS.IMAGE_RENDERED,(function(e){(0,t.triggerEvent)(t.events,"images_viewport",e.detail)})),this.seriesLayouts.push({seriesId:null==n?void 0:n.uuid,seriesDom:e})},e.prototype.seriesLayoutsUpdate=function(e,t){this.seriesLayouts.forEach((function(n){e===n.seriesDom&&(n.seriesId=t)}))},e.prototype.toggleSeriesStyle=function(e){var t=this,n=e.target,r=e.seriesId,o=e.seriesIndex;U.webDicomView.layoutView.canvasContainer.querySelectorAll(".layoutCellsOuter").forEach((function(e){var a=e.querySelector(".layoutCellsInner"),i=a.dataset,s=i.seriesId,l=i.seriesIndex;if(null!=n&&a===n||null!=r&&s===r||null!=o&&Number(l)===o){if(e.classList.add("active"),a.classList.add("active"),a.classList.contains("noActiveBorder")){var c=a.querySelector(".layoutImage");c?a.querySelector(".layoutImage.active")||c.click():a.classList.remove("noActiveBorder")}}else e.classList.remove("active"),a.classList.remove("active"),t.toggleStyle(e,-1,"layoutImage")}))},e.prototype.toggleStyle=function(e,t,n){for(var r=e.getElementsByClassName(n),o=r.length,a=0;a<o;a++)a===t?r[a].classList.add("active"):r[a].classList.remove("active")},e.prototype.scrollIntoView=function(e,t){void 0===t&&(t=0),setTimeout((function(){"scrollIntoViewIfNeeded"in e?e.scrollIntoViewIfNeeded():e.scrollIntoView()}),t)},e.prototype.toggleNavigatorInfo=function(e){U.webDicomView.layoutView.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper").forEach((function(t){t.dataset.seriesId==e?(t.classList.add("active"),t.classList.add("showProgress")):(t.classList.remove("active"),!k.fullLoad&&t.classList.remove("showProgress"))}))},e}();const Ws=qs;const Gs=function(){function e(e){this.id=e,this.ElementContent=void 0}return e.prototype.createLayout=function(){var e=U.webDicomView.globalContainer.querySelector("#".concat(this.id));if(e)e.style.zIndex="98";else{var n=U.webDicomView.globalContainer.querySelector(".viewerContentWrapper");this.ElementContent=e=(0,s.createElement)({id:this.id,oncontextmenu:function(e){return e.preventDefault()}}),e.setAttribute("style","\n\t\t\t    position: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\tz-index: 98;\n\t\t\t\t\tbackground: #000;\n\t\t\t\t\tborder: 2px solid #CACACA;\n\t\t\t\t\tborder-top: none;\n\t\t\t\t\t// padding: 2px;\n\t\t\t\t\t// margin: 2px;\n\t\t"),e.addEventListener("touchmove",(function(e){var n=e.type;(0,t.triggerEvent)(t.events,"layout_area_focus",{area:"seriesMPROr3DLayout",type:n}),e.preventDefault()}),{passive:!1}),n.append(e)}return e},e.prototype.hidden=function(){this.ElementContent&&(this.ElementContent.style.zIndex="-1")},e}();var Ys=function(){function e(){}return e.prototype.createIconSynchronizer=function(e,t){var n=this,r=e.querySelector(".seriesSynchronizerLayout");if(!r){var o="iconCheckBox"+e.dataset.seriesIndex;r=(0,s.createElement)({className:"seriesSynchronizerLayout",title:"序列同步器",onclick:function(t){var r;n.triggerEventHandle(e,null===(r=t.target)||void 0===r?void 0:r.checked)},ontouchstart:function(t){var r=a,o=r.checked=!r.checked;try{n.triggerEventHandle(e,o)}catch(e){Se().info({title:"序列同步器已打开，请重新选择需要同步的功能",timeout:1e4})}},ondblclick:function(e){e.stopPropagation()}});var a=(0,s.createElement)({tagName:"input",className:"checkbox-input",type:"checkbox",checked:t,id:o}),i=(0,s.createElement)({tagName:"label",className:"checkbox-label",onclick:function(e){e.stopPropagation()}});i.setAttribute("for",o),i.appendChild((0,s.createElement)({tagName:"span",className:"circle"})),i.appendChild((0,s.createElement)({tagName:"span",className:"text on",innerText:"关闭"})),i.appendChild((0,s.createElement)({tagName:"span",className:"text off",innerText:"联动"})),r.appendChild(a),r.appendChild(i),e.appendChild(r),this.triggerEventHandle(e,t)}},e.prototype.triggerEventHandle=function(e,n){var r={element:e};switch(n){case!0:(0,t.triggerEvent)(t.events,"series_synchronizer_add",r);break;case!1:(0,t.triggerEvent)(t.events,"series_synchronizer_remove",r)}},e.prototype.removeSynchronizer=function(e){var t=e.querySelector(".seriesSynchronizerLayout");null==t||t.remove()},e}();const Zs=Ys;const Xs=function(){function e(){}return e.prototype.createLayout=function(e,n,r){var o=function(e){return e>=0?"".concat(e||Math.max(r,.1),"mm"):""};e.forceRender=!0,new zi("thicknessLayout",e,(function(e){var r=(0,s.createElement)({tagName:"span",className:"label",innerText:"层厚："}),a=(0,s.createElement)({tagName:"span",className:"num",innerText:o(n)}),i=(0,s.createElement)({className:"select-popup-item tool-event-link thickness"}),l=(0,s.createElement)({tagName:"input",type:"range",min:0,max:10,step:1,value:n,onclick:function(e){e.stopPropagation()},oninput:function(e){var n=Number(e.target.value);a.innerText=o(n),(0,t.triggerEvent)(t.events,"tool_event",{events:e,toolData:{toolTag:"MPRThicknessChange",disActive:!0},value:n,btnTarget:i})}});i.appendChild(r),i.appendChild(l),i.appendChild(a),e.appendChild(i)}))},e}();const Qs=[{title:"患者信息",labels:[{title:"name",alias:"姓名"},{title:"sex",alias:"性别",format:I},{title:"age",alias:"年龄",format:T},{title:"birth",alias:"生日"},{title:"patid",alias:"患者ID"}]},{title:"检查信息",labels:[{title:"inst",alias:"机构医院"},{title:"acqdt",alias:"图像获取日期"},{title:"acqtm",alias:"图像获取时间"},{title:"studt",alias:"检查日期"},{title:"stutm",alias:"检查时间"},{title:"studes",alias:"检查描述"},{title:"accnum",alias:"检查流水号"}]},{title:"序列信息",labels:[{title:"serid",alias:"序列ID"},{title:"seruid",alias:"序列UID"},{title:"serdes",alias:"序列描述"}]},{title:"图像信息",labels:[{title:"imgnum",alias:"影像号"},{title:"wc",alias:"默认窗位"},{title:"ww",alias:"默认窗宽"},{title:"ma",alias:"电流"},{title:"kv",alias:"电压"},{title:"sliceth",alias:"层厚"},{title:"row",alias:"像素行数"},{title:"col",alias:"像素列数"},{title:"pixx",alias:"像素间X高距离"},{title:"pixy",alias:"像素间Y高距离"},{title:"bita",alias:"图像分配位数"},{title:"bits",alias:"实际占用位数"},{title:"hbit",alias:"高位"},{title:"rescin",alias:"偏移量"},{title:"rescsl",alias:"调整斜率"},{title:"pixrep",alias:"符号标识"},{title:"frames",alias:void 0},{title:"sappix",alias:"像象素所点位"},{title:"phme",alias:"图像光度"},{title:"imgpos",alias:"图像位置"},{title:"imgori",alias:"图像方位"},{title:"imgtype",alias:void 0},{title:"orl",alias:"图像方位左"},{title:"orr",alias:"图像方位右"},{title:"ort",alias:"图像方位上"},{title:"orb",alias:"图像方位下"},{title:"scount",alias:void 0},{title:"blocks",alias:"分片"}]},{title:"设备信息",labels:[{title:"mod",alias:"设备型号"},{title:"manu",alias:"设备厂商"}]},{title:"UID信息",labels:[{title:"id",alias:void 0},{title:"sopuid",alias:"图像唯一号"},{title:"uid",alias:void 0},{title:"uuid",alias:void 0},{title:"stuid",alias:"检查UID"},{title:"stuuid",alias:void 0},{title:"syntaxuid",alias:void 0}]},{title:"其他信息",labels:[{title:"fileName",alias:"文件名"},{title:"relationid",alias:void 0},{title:"fileLocation",alias:void 0},{title:"dcmfile",alias:void 0}]}];var Ks=function(){return Ks=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ks.apply(this,arguments)},Js=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},$s=function(){function e(){this.toolsDataMPR=Ni(),this.toolsDataVRT=Bi(),this.toolsData=_i(),this.rotatePop=new ns,this.imageTypeLayout=new Yi,this.wwwcLayout=new $i,this.scale=new ys,this.colorMap=new us,this.seriesMarker=new bs,this.topTools=new Ss,this.seriesSlider=new Ms,this.studySlider=new Ps,this.iconSynchronizer=new Zs,this.seriesLayout=new Ws(this.seriesSlider,this.studySlider,this.iconSynchronizer),this.mprLayout=new Gs("MPRContent"),this.vrtLayout=new Gs("VRTContent"),this.iconPlayer=new Fs,this.ThicknessLayout=new Xs}return e.prototype.resizeLayout=function(e){void 0===e&&(e=this.canvasContainer),e.querySelectorAll(".layoutCellsInner").forEach((function(e){e.querySelectorAll(".layoutImage").forEach((function(e){try{(0,t.resize)(e)}catch(e){}}));try{(0,t.resize)(e)}catch(e){}}))},e.prototype.createImageTypeLayout=function(e){this.imageTypeLayout.createLayout(e)},e.prototype.createWWWCLayout=function(e){this.wwwcLayout.createLayout(e)},e.prototype.createRotateLayout=function(e){this.rotatePop.createLayout(e)},e.prototype.createScaleLayout=function(e){this.scale.createLayout(e)},e.prototype.createColorMapLayout=function(e){this.colorMap.createLayout(e)},e.prototype.createPopupLayout=function(e,t,n){void 0===e&&(e="提示"),void 0===n&&(n="");var r=U.webDicomView.globalContainer,o=r.querySelector(".popupLayout"),a=null==o?void 0:o.querySelector(".popup-info-content"),i=null==o?void 0:o.querySelector(".popup-info-title");if(o)a.innerHTML="",i.innerText=e,o.style.visibility="initial";else{o=(0,s.createElement)({className:"popupLayout"});var l=(0,s.createElement)({className:"popup-info-layout"}),c=(0,s.createElement)({className:"popup-info-title-bar"});i=(0,s.createElement)({className:"popup-info-title",innerText:e});var u=(0,s.createElement)({className:"popup-info-close",innerText:"关闭",onclick:function(){o.style.visibility="hidden"}});a=(0,s.createElement)({className:"popup-info-content"}),c.append(i),c.append(u),l.append(c),l.append(a),o.append(l),r.appendChild(o)}a.setAttribute("style",n),"string"==typeof t?a.innerHTML=t:a.append(t)},e.prototype.createDICOMMetaDataInfoLayout=function(e){var t,n,r,o,a,i="";try{for(var l=Js(Qs),c=l.next();!c.done;c=l.next()){var u=c.value,d=u.title,f=u.labels;i+="<div class='title'>".concat(d,"</div>");try{for(var h=(r=void 0,Js(f)),p=h.next();!p.done;p=h.next()){var m=p.value,g=m.title,v=m.alias,y=m.format,b=null!==(a=e[g])&&void 0!==a?a:"";b="function"===(0,s.dataType)(y)?y(b):b,i+="\n\t\t\t\t\t\t<div class='DICOM-meta-data-cell' title='".concat(v?v+",":"").concat(g,"：").concat(b||"undefined","'>\n\t\t\t\t\t\t<div class='label'>").concat(v||g,"</div>\n\t\t\t\t\t\t<div class='value'>").concat(b,"</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t")}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}this.createPopupLayout("DICOM信息",i)},e.prototype.createAboutUsLayout=function(e){var t=e.version,n=e.copyright,r=e.description,o=e.tel,a=e.imgURl,i=(0,s.createElement)({tagName:"div",className:"about-Us-2"}),l=(0,s.createElement)({tagName:"div",className:"contains"}),c=(0,s.createElement)({tagName:"div",className:"bar"}),u=(0,s.createElement)({tagName:"div",className:"logo"}),d=r?(0,s.createElement)({tagName:"div",className:"dark description",innerHTML:"".concat(r)}):"",f=t?(0,s.createElement)({tagName:"div",innerHTML:'<span class="dark">软件发布版本号：</span><span class="bold">V'.concat(String(t).split(".")[0],"</span>")}):"",h=t?(0,s.createElement)({tagName:"div",innerHTML:'<span class="dark">软件完整版本号：</span><span class="bold">V'.concat(t,"</span>")}):"",p=n?(0,s.createElement)({tagName:"div",innerHTML:'<i class="iconfont icon-dicom-contacts"></i><span class="bold">'.concat(n,"</span>")}):"",m=o?(0,s.createElement)({tagName:"div",innerHTML:'<i class="iconfont icon-dicom-tel"></i><span class="bold">'.concat(o,"</span>")}):"";c.append(p),c.append(m),a&&(u.style.backgroundImage="url(".concat(a,")")),(a||void 0===a)&&l.append(u),l.append(d),l.append(f),l.append(h),i.append(l),i.append(c),this.createPopupLayout("关于我们",i,"padding:0;height:auto;")},e.prototype.createImageLayout=function(e,t){var n=(0,s.createElement)({tagName:"img",src:e,alt:t});n.setAttribute("style","\n\t\t\tmargin: auto;\n\t\t\theight: 100%;\n\t\t"),this.createPopupLayout("长按保存图像",n)},e.prototype.createSeriesMarker=function(e,t,n){var r=t.stuuid,o=U.webDicomView.queryStudy(r);this.seriesMarker.createParagraph(e,"ltMarker",t,n,o),this.seriesMarker.createParagraph(e,"rtMarker",t,n,o),this.seriesMarker.createParagraph(e,"lbMarker",t,n,o),this.seriesMarker.createParagraph(e,"rbMarker",t,n,o)},e.prototype.imageType=function(e){this.imageTypeLayout.handleLayout(e)},e.prototype.wwwcImage=function(e,t){this.wwwcLayout.handleLayout(e,t)},e.prototype.scaleImage=function(e,t){this.scale.handleLayout(e,t)},e.prototype.rotateImage=function(e,t){this.rotatePop.handleLayout(e,t)},e.prototype.colorMapImage=function(e,t,n){this.colorMap.handleLayout(e,t,n)},e.prototype.createSeriesCellLayout=function(e,n,r,o){var a=this,i=r||{},l=i.x,c=void 0===l?6:l,u=i.y,d=void 0===u?6:u;new zi("series"===n?"series":"image",e.detail,(function(e){for(var r=function(r){for(var o=function(o){var i=(0,s.createElement)({className:"select-grid-item",onclick:function(){(0,t.triggerEvent)(t.events,"series"===n?"tool_series_layout":"tool_series_image_layout",{type:n,ptCell:{x:o,y:r}})},onmouseover:function(){a.changeCellStyle(e,{x:o,y:r})}});i.setAttribute("data-x",o+""),i.setAttribute("data-y",r+""),e.appendChild(i)},i=1;i<=c;i++)o(i)},o=1;o<=d;o++)r(o);e.setAttribute("style","\n\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\tgrid-template-columns: repeat(".concat(c,", 24px);\n\t\t\t\t\t\tgrid-template-rows: repeat(").concat(d,", 24px);\n\t\t\t\t\t\tpadding: 4px;\n\t\t\t\t\t\t"))}),(function(e){a.changeCellStyle(e,o)}))},e.prototype.initLayout=function(e){var n=this,r=(0,s.createElement)({className:"dicomViewToolbar"}),o=(0,s.createElement)({tagName:"img",src:U.logoURL,className:"logo",crossOrigin:"Anonymous"}),a=(0,s.createElement)({className:"divider"}),i=(0,s.createElement)({className:"viewerContentWrapper",id:"viewerContentWrapper"});if(this.leftSideContainer=(0,s.createElement)({className:"viewerLeftSidePanel"}),this.studyNavigationBody=(0,s.createElement)({className:"study-navigation-body"}),this.canvasContainer=(0,s.createElement)({className:"canvasbox",oncontextmenu:function(e){return e.preventDefault()}}),this.toolsContainer=(0,s.createElement)({className:"toolbar",onmousewheel:function(e){"mobile"!==U.env&&(n.toolsContainer.scrollLeft+=150*(e.deltaY>0?1:-1))}}),this.toolsContainer.addEventListener("touchmove",(function(e){var n=e.type;(0,t.triggerEvent)(t.events,"layout_area_focus",{area:"toolbarLayout",type:n})}))," "!==U.logoURL){var l=this.logoGrouper=(0,s.createElement)({className:"logoGroup"});l.appendChild(a),l.appendChild(o),r.appendChild(l)}"mobile"===U.env&&e.classList.add("isMobile"),U.toolsBar.navigationBottomLayout&&(e.classList.add("navigationBottomLayout"),this.studyNavigationHead=(0,s.createElement)({className:"study-navigation-head"}),this.studyMenuLayout=new ks(this.iconPlayer,this.studyNavigationHead),this.leftSideContainer.style.height="118px",this.leftSideContainer.appendChild(this.studyNavigationHead)),this.leftSideContainer.appendChild(this.studyNavigationBody),i.appendChild(this.leftSideContainer),i.appendChild(this.canvasContainer),r.appendChild(this.toolsContainer),e.classList.add("dicomView"),e.addEventListener("touchstart",(function(e){e.stopPropagation()})),e.appendChild(r),e.appendChild(i)},e.prototype.initTop2DTools=function(e,t){void 0===t&&(t=!1);var n=Ei.main.find((function(t){return t.toolName===e}));this.topTools.createTopTools(this.toolsContainer,this.toolsData,n,"tools2d",t)},e.prototype.initTopMPRTools=function(e,t){void 0===t&&(t=!0);var n=Ei.MPR.find((function(t){return t.toolName===e}));this.topTools.createTopTools(this.toolsContainer,this.toolsDataMPR,n,"toolsMPR",t)},e.prototype.initTopVRTTools=function(e,t){void 0===t&&(t=!0);var n=Ei.VRT.find((function(t){return t.toolName===e}));this.topTools.createTopTools(this.toolsContainer,this.toolsDataVRT,n,"toolsVRT",t)},e.prototype.updateToolVisibility=function(e,t){var n=this.toolsContainer.querySelector(".".concat(e));null==n||n.classList.toggle("hidden",!t)},e.prototype.createStudyNavigationGroup=function(e,t,n){var r,o=(0,s.createElement)({className:"studyNavigationContainer"}),a=t.length;o.dataset.studyId=e.studyid,this.studyNavigationBody.appendChild(o),this.navigatorStudyToggleStyle(o,a),U.toolsBar.navigationBottomLayout?(0===n?this.seriesBarIconToggle(!0):o.classList.add("hidden"),null===(r=this.studyMenuLayout)||void 0===r||r.createLayout(e,n)):this.renderStudyInfo(o,e,a),this.renderDicomIcon(o,t,n)},e.prototype.renderDicomIcon=function(e,n,r){for(var o=(0,s.createElement)({className:"body-bar"}),a=null,i=function(e,t){void 0===t&&(t=0),setTimeout((function(){e.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})}),t)},l=function(e){var l=n[e],c=l.seriesDescription,u=l.icon,d=l.seriesId,f=l.images,h=l.series.flatSeries;l.seriesIndex=e;var p={iconImage:l},m=(0,s.createElement)({className:"viewer-navigator-wrapper",draggable:!0,onclick:function(e){clearTimeout(a),a=setTimeout((function(){(0,t.triggerEvent)(t.events,"navigator_active",Ks(Ks({},p),{target:e.target,type:"click",event:e})),i(m,e.isTrusted?0:500)}),200)},ondblclick:function(){clearTimeout(a),(0,t.triggerEvent)(t.events,"navigator_dbClick_drag",Ks(Ks({},p),{type:"dblclick"})),i(m)},ondragend:function(e){"none"!==e.dataTransfer.dropEffect&&(0,t.triggerEvent)(t.events,"navigator_dbClick_drag",Ks(Ks({},p),{type:"drag"}))},oncontextmenu:function(e){e.preventDefault()}});"mobile"===U.env&&new(ze())(m).on("press doubletap",(function(){(0,t.triggerEvent)(t.events,"navigator_dbClick_drag",Ks(Ks({},p),{type:"press doubletap"}))}));var g=(0,s.createElement)({className:"navigator-card"}),v=(0,s.createElement)({tagName:"div",className:"icon-image"}),y=(0,s.createElement)({tagName:"div",className:"navigator-text-wrapper"}),b=(0,s.createElement)({tagName:"div",className:"text",innerHTML:"<i class=icon-dicom-series-2></i> <span>".concat(e+1,"</span> ")}),x=(0,s.createElement)({tagName:"div",className:"num",innerHTML:"<i class=icon-dicom-image></i> <span>".concat(f.length,"</span>")}),w=(0,s.createElement)({tagName:"div",className:"navigator-description",title:c,innerHTML:"".concat(c||"")}),T=(0,s.createElement)({tagName:"img",src:u,crossOrigin:"Anonymous",decoding:"async",loading:"lazy",draggable:!1}),I=(0,s.createElement)({className:"AI-icon",tagName:"span"}),S=(0,s.createElement)({tagName:"div",className:"progressGroup"}),C=(0,s.createElement)({tagName:"span",className:"progressNum"}),E=(0,s.createElement)({tagName:"div",className:"progressBar"});if(0==r&&0===e&&(m.classList.add("active"),C.innerText="0%"),m.dataset.seriesId=d,m.dataset.index=String(e),h&&(m.dataset.flatSeries=String(h)),(0,s.env)().isWeChat){var A=(0,s.createElement)();A.setAttribute("style","\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t"),v.appendChild(A)}v.appendChild(T),v.appendChild(I),y.appendChild(b),y.appendChild(x),S.appendChild(C),S.appendChild(E),g.appendChild(v),g.appendChild(y),g.appendChild(w),m.appendChild(g),m.appendChild(S),o.appendChild(m)},c=0;c<n.length;c++)l(c);e.appendChild(o)},e.prototype.renderStudyInfo=function(e,t,n){var r=this,o=t.name,a=t.sex,i=t.age,l=t.modality,c=t.studydate,u=(0,s.createElement)({className:"panel-info"}),d=(0,s.createElement)({tagName:"p",innerHTML:"<span title='".concat(o,"'>").concat(o,"</span>/").concat(I(a),"/").concat(T(i))}),f=(0,s.createElement)({tagName:"p",innerText:l}),h=(0,s.createElement)({tagName:"p",innerText:c});u.appendChild(f),u.appendChild(d),u.appendChild(h),e.appendChild(u),u.onclick=function(){r.navigatorStudyToggleStyle(e,n)}},e.prototype.navigatorStudyToggleStyle=function(e,t){e.classList.contains("active")?e.style.cssText=void 0:U.toolsBar.navigationBottomLayout?e.style.maxWidth=68*t+100+"px":e.style.maxHeight=120*t+100+"px",e.classList.toggle("active")},e.prototype.seriesBarToggle=function(e){var t;this.leftSideContainer.classList.toggle("show",e),null===(t=this.logoGrouper)||void 0===t||t.classList.toggle("show",e),this.seriesBarIconToggle(e)},e.prototype.seriesBarIconToggle=function(e){this.toolsContainer.querySelector(".tools2d .tool-event-link.seriesBar").classList.toggle("active",e)},e.prototype.navigationMenuColseHandle=function(){var e,t=this;U.toolsBar.navigationBottomLayout&&(null===(e=this.studyMenuLayout)||void 0===e||e.toggleMenuVisibility(!1),setTimeout((function(){return t.resizeLayout()}),500))},e.prototype.selectPopupHidden=function(){var e;null===(e=this.toolsContainer.querySelector(".select-popup-layout:not(.invisible)"))||void 0===e||e.classList.add("invisible"),this.removeOpenMark()},e.prototype.removeOpenMark=function(){var e;null===(e=this.toolsContainer.querySelector(".select-popup-layout .open-mark"))||void 0===e||e.classList.remove("open-mark")},e.prototype.toggleToolStyle=function(e){var t=e||{},n=t.disActive,r=t.isToggle,o=t.btnTarget,a=t.toolType,i=t.toolTag,s=t.btnOriginTarget,l=t.parentData,c=(void 0===l?{isLonelyGroup:void 0}:l).isLonelyGroup;if(!n&&!e.isLonelyGroup){if(r&&o)return o.classList.toggle("active"),void(null==s||s.classList.toggle("active",!!o.parentElement.querySelector(".active")));this.toolsContainer.querySelectorAll(".toolsChild.active .tool-event-link").forEach((function(e){var t=JSON.parse(e.dataset.toolData||"{}"),n=t.disActive,r=t.isToggle,o=t.children,a=t.parentData,i=(void 0===a?{isLonelyGroup:void 0}:a).isLonelyGroup;n||r||(c===i&&e.classList.remove("active"),o&&setTimeout((function(){e.classList.toggle("active",!!e.querySelector(".active"))})))})),null==o||o.classList.add("active"),null==s||s.classList.add("active"),this.toolsContainer.querySelectorAll(".tool-event-link.".concat(a||i,":not(.active)")).forEach((function(e){e.classList.add("active")}))}},e.prototype.changeCellStyle=function(e,t){if(t)for(var n=e.getElementsByTagName("div"),r=0;r<n.length;r++){var o=Number(n[r].getAttribute("data-x")),a=Number(n[r].getAttribute("data-y"));o<=t.x&&a<=t.y?n[r].classList.add("active"):n[r].classList.remove("active")}},e.prototype.progressCountStyle=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=!1);var o=this.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(e,"']"));if(r)o.classList.add("showProgress");else if(!o.classList.contains("showProgress")&&!o.classList.contains("active"))return;var a,i=o.querySelector(".progressNum"),s=o.querySelector(".progressBar");if(t>=0&&(a=(n/t*100).toFixed(0)+"%",i.innerText=a,s.style.width=a),"100%"===a)return o.classList.add("loaded"),void o.classList.remove("showProgress");void 0!==t||r||o.classList.remove("showProgress")},e.prototype.toggleCavanAroundInfoStyle=function(e){this.canvasContainer.querySelectorAll("#ltMarker,#rtMarker,#lbMarker,#rbMarker").forEach((function(t){t.style.opacity=e?"1":"0"}))},e.prototype.toggleAIIconStyle=function(e){var t,n=this;e?e.forEach((function(e){var t;null===(t=n.leftSideContainer.querySelector(".viewer-navigator-wrapper[data-series-id='".concat(e,"']")))||void 0===t||t.classList.add("show-AI")})):null===(t=this.leftSideContainer.querySelectorAll(".viewer-navigator-wrapper.show-AI"))||void 0===t||t.forEach((function(e){e.classList.remove("show-AI")}))},e.prototype.clearSeriesLayout=function(e,t,n){var r,o,a;void 0===t&&(t=!1),void 0===n&&(n=!1);var i=e.querySelector(".layoutImageLayout"),s=e.querySelectorAll(".layoutImage"),l=e.querySelectorAll("#ltMarker,#rtMarker,#lbMarker,#rbMarker");if(t?null===(a=e.querySelector("canvas"))||void 0===a||a.remove():hi(e),s.forEach((function(e){hi(e),null==e||e.remove()})),null==i||i.remove(),l.forEach((function(e){null==e||e.remove()})),this.seriesSlider.removeLayout(e),this.iconSynchronizer.removeSynchronizer(e),!n)try{for(var c=Js(["studyUID","seriesId","seriesColumn","seriesRow","seriesIndex","currentImageIdIndex"]),u=c.next();!u.done;u=c.next()){var d=u.value;delete e.dataset[d]}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}this.iconPlayer.playerRemove(e)},e}();const el=$s;var tl=function(){return tl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},tl.apply(this,arguments)},nl=function(){function e(e){var t=this;this.options=tl({message:void 0,position:"center",class:"mobile"===U.env?"custom-iziToast-mobile":"custom-iziToast",close:!1,theme:"dark",overlay:!0,image:n(5187),timeout:!1,onOpening:function(){try{var e=t.dicomViewContainer,n=document.querySelector(".iziToast-overlay"),r=(null==e?void 0:e.getBoundingClientRect())||{},o=r.top,a=r.left,i=r.bottom,s=r.right,l=r.width,c=r.height;n&&(n.style.top="".concat(o,"px"),n.style.left="".concat(a,"px"),n.style.bottom="".concat(i-c,"px"),n.style.right="".concat(s-l,"px"),n.style.width="".concat(l,"px"),n.style.height="".concat(c,"px"))}catch(e){console.error(e)}}},e),this.loading=!1}return Object.defineProperty(e.prototype,"dicomViewContainer",{get:function(){return this._dicomViewContainer=this._dicomViewContainer||U.webDicomView.globalContainer},enumerable:!1,configurable:!0}),e.prototype.show=function(e){this.loading||(this.loading=!0,Se().show(tl(tl({},this.options),e)))},e.prototype.progress=function(e){return Se().progress(tl({},e),document.querySelector("."+this.options.class))},e.prototype.hidden=function(){this.loading&&(this.loading=!1,Se().destroy())},e}();const rl=nl;var ol=n(129),al=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},il=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},sl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ll=(0,a.importInternal)("util/throttle"),cl=function(e,t){this.x=e,this.y=t},ul=function(){function e(){var e=this;this.ptLast={x:0,y:0},this.webDcmSocket=void 0,this.seruuId=void 0,this.loadingAnimation=new rl({message:"3D资源加载中,请耐心等待"}),this.zoomLazy=ll((function(t){e.zoom(t)}),"mobile"===U.env?150:40),this.KnifeMoveLazy=ll((function(t){e.KnifeMove(t)}),40),this.rotateLazy=ll((function(t){e.rotate(t)}),100),this.windowsLevelLazy=ll((function(t){e.windowsLevel(t)}),60),this.panLazy=ll((function(t){e.pan(t)}),100)}return e.prototype.open=function(e,t){var n,r,o=this,a=t.seriesUid,i=t.hospId,l=t.studyUID,c=t.wadoURL,u=t.vrtWsURl,d=t.layoutView;if(!e.querySelector("#canvas-vrt")){var f=this.canvas=(0,s.createElement)({tagName:"canvas",id:"canvas-vrt",width:e.clientWidth,height:e.clientHeight});e.appendChild(f);var h=ll((function(){f.width=e.clientWidth,f.height=e.clientHeight,o.resizeCanvasDrawImage()}),500);this.resizeObserver=new ResizeObserver(h),this.resizeObserver.observe(e);try{for(var p=sl(["touchstart","mousedown","touchmove","mousemove","touchend","mouseup","mouseout","mousewheel"]),m=p.next();!m.done;m=p.next()){var g=m.value;f.addEventListener(g,(function(e){o.msgTransform(e)}))}}catch(e){n={error:e}}finally{try{m&&!m.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}var y=new(ze().Manager)(f);y.add(new(ze().Pinch)({threshold:.2})),y.add(new(ze().Pan)({threshold:10,pointers:2})),y.on("pinch",(function(e){o.zoomLazy(e),e.preventDefault()})),y.on("panmove",(function(e){o.panLazy(e),e.preventDefault()}))}var b=v(a),x=c+"/GetImagesPath"+(0,ol.stringify)({seruuid:b,seriesUID:b,hospcode:i,studyuid:l,studyUID:l},{addQueryPrefix:!0});if(u||alert("vrtWsURl is undefined"),this.webDcmSocket){if(this.seruuId===a)return void this.refresh();this.webDcmSocketClose()}this.seruuId=a;var w=u+"/Wado?serurl="+encodeURIComponent(x);this.webDcmSocket=new WebSocket(w),this.loadingAnimation.show(),this.webDcmSocket.onclose=function(e){o.loadingAnimation.hidden(),"leave"!==e.reason&&(ke("webDcmSocketError","3D服务器连接失败，请退出重试！"),console.info("Connection closed",e))},this.webDcmSocket.onerror=function(e){o.loadingAnimation.hidden(),ke("webDcmSocketError","3D服务器连接失败!"),console.info("An error occur",e),d.initTop2DTools(),vl()},this.webDcmSocket.onmessage=function(e){if("string"==typeof e.data)console.info(JSON.parse(e.data));else{var t=new FileReader;t.onload=function(e){e.target.readyState==FileReader.DONE&&(o.loadingAnimation.hidden(),o.webDcmSocketResult=t.result,(0,s.canvasDrawImage)(o.canvas,o.webDcmSocketResult))},t.readAsDataURL(e.data)}}},e.prototype.resizeCanvasDrawImage=function(){this.canvas&&this.webDcmSocketResult&&(0,s.canvasDrawImage)(this.canvas,this.webDcmSocketResult)},e.prototype.msgTransform=function(e){var t;if(!((null===(t=e.targetTouches)||void 0===t?void 0:t.length)>1))switch(e.type){case"touchstart":case"mousedown":var n=void 0;if("touchstart"===e.type){var r=e.targetTouches[0];n=new cl(r.pageX,r.pageY),this.which=1}else n=new cl(e.pageX,e.pageY),this.which=e.which;this.ptLast=n;break;case"touchmove":case"mousemove":this.mouseDownMove(e);break;case"touchend":case"mouseup":case"mouseout":this.mouseUp(),this.which=void 0;break;case"mousewheel":this.zoomLazy(e)}},e.prototype.mouseDownMove=function(e){if(1===this.which)switch(this.toolType){case"KnifeIn":case"KnifeOut":this.KnifeMoveLazy(e);break;case"Modulation":this.windowsLevelLazy(e);break;default:this.rotateLazy(e)}else 3===this.which?this.windowsLevelLazy(e):2===this.which&&this.panLazy(e)},e.prototype.mouseUp=function(){switch(this.toolType){case"KnifeIn":case"KnifeOut":this.knifeEnd(),this.toolType=void 0}},e.prototype.errorHandle=function(e,t){"cancel"!==t&&console.error(e,t)},e.prototype.getPosition=function(e){var t="touchmove"==e.type?e.targetTouches[0]:e,n=t.pageX,r=t.pageY,o=new cl(n,r),a=this.ptLast.x,i=this.ptLast.y,s=o.x-a,l=o.y-i;if(0===s&&0===l)return Promise.reject("cancel");var c=e.target.getBoundingClientRect(),u=Math.round(c.left+window.pageXOffset),d=Math.round(c.top+window.pageYOffset);return this.ptLast=o,Promise.resolve({LastPosition:[a-u,i-d],NowPosition:[n-u,r-d],rect:c})},e.prototype.rotate=function(e){return al(this,void 0,void 0,(function(){var t,n,r,o;return il(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=a.sent(),n=t.LastPosition,r=t.NowPosition,this.webDcmSocketSend({Cmd:1,LastPosition:n,NowPosition:r}),[3,3];case 2:return o=a.sent(),this.errorHandle("rotate",o),[3,3];case 3:return[2]}}))}))},e.prototype.pan=function(e){return al(this,void 0,void 0,(function(){var t,n,r,o,a,i,s;return il(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),"panmove"==e.type&&(t=e.center||{},n=t.x,r=t.y,e.pageX=Math.floor(n),e.pageY=Math.floor(r)),[4,this.getPosition(e)];case 1:return o=l.sent(),a=o.LastPosition,i=o.NowPosition,this.webDcmSocketSend({Cmd:2,LastPosition:a,NowPosition:i}),[3,3];case 2:return s=l.sent(),this.errorHandle("pan",s),[3,3];case 3:return[2]}}))}))},e.prototype.zoom=function(e){var t=e.type,n=e.scale,r=e.deltaY;this.webDcmSocketSend({Cmd:3,DeltaY:"pinch"===t?n>=1?1:-1:r>0?-1:1})},e.prototype.windowsLevel=function(e){return al(this,void 0,void 0,(function(){var t,n,r,o;return il(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=a.sent(),n=t.LastPosition,r=t.NowPosition,this.webDcmSocketSend({Cmd:4,LastPosition:n,NowPosition:r}),[3,3];case 2:return o=a.sent(),this.errorHandle("windowsLevel",o),[3,3];case 3:return[2]}}))}))},e.prototype.KnifeMove=function(e){return al(this,void 0,void 0,(function(){var t,n,r,o,a;return il(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getPosition(e)];case 1:return t=i.sent(),n=t.LastPosition,r=t.NowPosition,o=t.rect,this.webDcmSocketSend({Cmd:5,LastPosition:n,NowPosition:r,ViewWidth:Math.round(o.width),ViewHeight:Math.round(o.height)}),[3,3];case 2:return a=i.sent(),this.errorHandle("KnifeMove",a),[3,3];case 3:return[2]}}))}))},e.prototype.toolsToggle=function(e){this.toolType=e},e.prototype.knifeBegin=function(e,t){if(void 0===t&&(t=function(){}),"function"!=typeof t)throw"callback function is required";this.toolType=e,this.knifeFinishCallback=t,this.webDcmSocketSend({KnifeOut:{Cmd:6},KnifeIn:{Cmd:7}}[e])},e.prototype.knifeEnd=function(){var e=this.knifeFinishCallback;if(this.webDcmSocketSend({Cmd:8}),"function"!=typeof e)throw"callback function is required";e()},e.prototype.reset=function(){if(this.webDcmSocket.readyState>=2)return this.reconnect();this.webDcmSocketSend({Cmd:0})},e.prototype.refresh=function(){this.webDcmSocketSend({Cmd:99})},e.prototype.webDcmSocketClose=function(){this.webDcmSocket&&(this.webDcmSocket.close(1e3,"leave"),this.webDcmSocket=void 0)},e.prototype.webDcmSocketSend=function(e){this.webDcmSocket.send(JSON.stringify(e))},e.prototype.reconnect=function(){var e=this.webDcmSocket,t=e.onclose,n=e.onerror,r=e.onmessage,o=e.onopen,a=e.url;this.webDcmSocketClose(),this.webDcmSocket=new WebSocket(a),this.webDcmSocket.onclose=t,this.webDcmSocket.onmessage=r,this.webDcmSocket.onerror=n,this.webDcmSocket.onopen=o},e.prototype.destroy=function(){this.webDcmSocketClose(),this.resizeObserver.disconnect(),this.canvas.remove()},e}();const dl=ul;var fl,hl,pl=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},ml=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},gl=function(){null==hl||hl.toggleToolStyle(Ei.VRT.find((function(e){return"旋转"===e.toolName})))},vl=function(){if(fl)try{fl.destroy()}catch(e){console.error(e)}finally{fl=void 0,hl.vrtLayout.hidden()}};const yl=function(){};var bl=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const xl=function(e){function t(t){var n=e.call(this)||this;return n.id=t.id,n.num=t.num,n.imageicon=t.imageicon,n.isLoadImage=t.isLoadImage,n}return bl(t,e),t.prototype.setInfo=function(e){if(this.name=e.name.replace(/\^/g,""),this.sex=e.sex,this.age=e.age,this.birth=e.birth,this.patid=e.patid,this.mod=e.mod,this.accnum=e.accnum,this.stuid=e.stuid,this.stuuid=e.stuuid,this.studes=e.studes,this.serid=e.serid,this.seruid=e.seruid,this.serdes=e.serdes,this.imgnum=e.imgnum,this.sopuid=e.sopuid,this.uid=e.uid,this.blocks=parseInt(e.blocks),this.studt=e.studt,this.stutm=e.stutm,"string"==typeof e.stutm&&e.stutm.indexOf(":")<0||"string"==typeof e.stutm&&e.studt.indexOf("-")<0)for(var t=0;t<2;t++){var n=e.stutm.substr(2*t,2),r=e.studt.substr(2*t+4,2);0==t&&(this.stutm=n,this.studt=e.studt.substr(0,4)),this.stutm+=":"+n,this.studt+="-"+r}else this.stutm=e.stutm,this.studt=e.studt;if(this.acqdt=e.acqdt,this.acqtm=e.acqtm,this.acqtm&&(this.acqtm=parseFloat(e.acqtm).toFixed(3)),this.wc=parseFloat(e.wc),this.ww=parseFloat(e.ww),this.ma=e.ma,this.kv=e.kv,this.sliceth=e.sliceth,this.manu=e.manu,this.inst=e.inst,this.row=parseInt(e.row),this.col=parseInt(e.col),"string"==typeof e.pixx&&"string"==typeof e.pixx){if(-1!=e.pixx.indexOf(" ")){var o=e.pixx.split(" ");2==o.length&&(this.pixx=parseFloat(o[0]),this.pixy=parseFloat(o[1]))}this.pixx=parseFloat(e.pixx),this.pixy=parseFloat(e.pixy)}this.bita=parseInt(e.bita),this.bits=e.bits,this.hbit=e.hbit,this.rescin=parseInt(e.rescin),this.rescsl=parseFloat(e.rescsl),(""===e.rescin||null===e.rescin||isNaN(this.rescin))&&(this.rescin=0),(""===e.rescsl||null===e.rescsl||isNaN(this.rescsl)||this.rescsl<1)&&(this.rescsl=1),this.pixrep=parseInt(e.pixrep),this.sappix=parseInt(e.sappix),this.phme=e.phme,this.orl=e.orl,this.ort=e.ort,this.orr=e.orr,this.orb=e.orb,this.strScount=e.scount},t.prototype.setData=function(e){void 0!==e&&(this.pixsBuffer=e,this.isLoadImage=!0,this.getMaxMinGary())},t.prototype.getMaxMinGary=function(){for(var e,t=1e6,n=-1e6,r=0;r<this.pixsBuffer.length;r++)(e=this.pixsBuffer[r])>t&&(t=e),e<n&&(n=e);this.minGary=n,this.maxGary=t},t}(yl);const wl=function(){function e(e){this.flatSeries=!1,this.desp=e.desp,this.imgs=e.imgs,this.num=e.num,this.uid=e.uid,this.uuid=e.uuid,this.studyUID=e.studyUID,this.wado=e.wado,this.icon=e.icon,this.flatSeries=e.flatSeries,this.arrImage=[],this.initSeries()}return e.prototype.initSeries=function(){var e=this;this.imgs.forEach((function(t){var n=new xl({id:t.id,num:t.num,imageicon:e.icon,isLoadImage:!1});e.arrImage.push(n)}))},e}();function Tl(e){return Tl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tl(e)}var Il=function(){function e(e,t){this.wado=t,this.hospId=e.hospId,this.arrSeries=[],this.images=[],this.studyuid=e.studyuid,this.studyuuid=e.studyuuid,this.age=e.age,this.hasseries=parseInt(e.hasseries),this.orgname=e.orgname,this.imgcount=parseInt(e.imgcount),this.modality=e.modality,null!=this.modality&&""!=this.modality&&(this.modality=this.modality.toUpperCase()),this.name=e.name,null!=this.name&&""!=this.name&&(this.name=this.name.replace(/\^/g,"")),this.orginaltype=e.orginaltype,this.patientid=e.patientid,this.seriescount=e.seriescount,this.studydate=e.studydate,this.studydate.indexOf("-")>-1&&(this.studydate=this.studydate.replace(/-/g,"/"));var n=w(this.studydate,"yyyy-MM-dd"),r=w(this.studydate,"hh:mm:ss");this.studydate=n,this.studytime=r,this.seriesArr=e.serieses.sort((function(e,t){return Number(e.num)-Number(t.num)})),this.sex=e.sex,this.studyid=e.studyid,this.totaltype="RAW",null!=this.totaltype&&""!=this.totaltype&&(this.totaltype=this.totaltype.toUpperCase()),this.hasseries?this.setSeries():this.setImages(e.imgs)}return e.prototype.setSeries=function(e){var t=this;void 0===e&&(e=this.seriesArr),e.forEach((function(e,n){var r=e.desp,o=e.imgs,a=e.num,i=e.uid,s=e.uuid,l=e.sign,c=e.flatSeries;e.imgs.sort((function(e,t){return Number(e.num)-Number(t.num)})),t.arrSeries.push(new wl({desp:r,imgs:o,num:a,uid:i+(c?"?index="+n:""),uuid:s+(c?"?index="+n:""),flatSeries:c,studyUID:t.studyuid,wado:t.wado,icon:t.wado+"/GetImageThumb/"+o[0].id+(0,ol.stringify)({studyuid:t.studyuid,studyUID:t.studyuid,seriesId:s,seriesID:s,hospId:t.hospId,hospID:t.hospId,sign:l},{addQueryPrefix:!0})}))}))},e.prototype.setImages=function(e){var t=this;void 0!==e&&e.forEach((function(e){var n=new xl({id:e.id,num:e.num,imageicon:t.wado+"/GetImageThumb"+e.id,isLoadImage:!1});t.images.push(n)}))},e.prototype.setSeriesDicom=function(e){var t=this;e instanceof Array&&e.forEach((function(e){t.setDicomMeta(e)}))},e.prototype.setDicomMeta=function(e){for(var t=0;t<this.arrSeries.length;t++)for(var n=this.arrSeries[t],r=0;r<n.arrImage.length;r++){n.arrImage[r].id,e.id}},e.prototype.deepCopy=function(e,t){for(var n in t=t||new wl(null),e)"object"===Tl(e[n])&&null!=e[n]?(t[n]=e[n].constructor===Array?[]:{},this.deepCopy(e[n],t[n])):t[n]=e[n];return t},e.prototype.getStudyType=function(){var e="";return"JPG"==this.totaltype?e="jpg":"RAW"==this.totaltype&&(e="series"),e},e.prototype.getSeriesLayoutCount=function(){var e=U.instanceOptions.seriesLayoutDefault||{},t=e.x,n=e.y,r={x:1,y:1};return t&&n?{x:Math.max(Math.trunc(t)||0,1),y:Math.max(Math.trunc(n)||0,1)}:"mobile"===U.env?r:["CT","MR"].includes(this.modality)?{x:2,y:2}:r},e.prototype.getDicomByID=function(e){for(var t=null,n=null,r=0;r<this.arrSeries.length;r++){t=this.arrSeries[r];for(var o=0;o<t.arrImage.length;o++)if((n=t.arrImage[o]).id==e)return n}},e.prototype.getAllDicom=function(){var e=[];return this.arrSeries.forEach((function(t){t.arrImage.forEach((function(t){e.push(t)}))})),e},e}();const Sl=Il;var Cl=function(){return Cl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Cl.apply(this,arguments)},El=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Al=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Ml=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Pl=function(){function e(e){this.states=[],this.originStates=[],this.addSeriesArr(e)}return e.prototype.addSeriesArr=function(e){var t,n;try{for(var r=El(e),o=r.next();!o.done;o=r.next()){var a=o.value,i=a.studyUID,s=a.uuid;this.states.push({studyUID:i,seriesId:s,series:a,scrollIndex:0,synchronizerStatus:!1})}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getStates=function(){return this.states},e.prototype.getStatesLength=function(){return this.states.length},e.prototype.getSeries=function(e){return void 0===e&&(e="states"),("states"===e?this.states:this.originStates).map((function(e){return e.series}))},e.prototype.getSeriesActiveIndex=function(e){for(var t=void 0,n=0;n<this.states.length;n++){if(this.states[n].seriesId===e){t=n;break}}return t},e.prototype.removeSerie=function(e){this.states[e]={studyUID:void 0,seriesId:void 0,scrollIndex:void 0,synchronizerStatus:void 0,series:void 0}},e.prototype.syncState=function(e){void 0===e&&(e="states"),this[e]=Ml([],Al("states"===e?this.originStates:this.states),!1)},e.prototype.getOriginState=function(){return this.originStates},e.prototype.setState=function(e,t){this.states[e]=Cl(Cl({},this.states[e]),t)},e.prototype.setSynchronizerStatus=function(e,t){this.states[e]=Cl(Cl({},this.states[e]),{synchronizerStatus:t})},e.prototype.getSynchronizerStatus=function(e){return this.states[e].synchronizerStatus},e.prototype.setScrollIndex=function(e,t){this.states[e]=Cl(Cl({},this.states[e]),{scrollIndex:t})},e}();const Dl=Pl;function kl(e,t){return function(){return e.apply(t,arguments)}}const{toString:Ll}=Object.prototype,{getPrototypeOf:Ol}=Object,Rl=(_l=Object.create(null),e=>{const t=Ll.call(e);return _l[t]||(_l[t]=t.slice(8,-1).toLowerCase())});var _l;const Nl=e=>(e=e.toLowerCase(),t=>Rl(t)===e),Bl=e=>t=>typeof t===e,{isArray:Ul}=Array,Vl=Bl("undefined");const Fl=Nl("ArrayBuffer");const jl=Bl("string"),Hl=Bl("function"),zl=Bl("number"),ql=e=>null!==e&&"object"==typeof e,Wl=e=>{if("object"!==Rl(e))return!1;const t=Ol(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},Gl=Nl("Date"),Yl=Nl("File"),Zl=Nl("Blob"),Xl=Nl("FileList"),Ql=Nl("URLSearchParams");function Kl(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,o;if("object"!=typeof e&&(e=[e]),Ul(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{const o=n?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length;let i;for(r=0;r<a;r++)i=o[r],t.call(null,e[i],i,e)}}function Jl(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}const $l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,ec=e=>!Vl(e)&&e!==$l;const tc=(nc="undefined"!=typeof Uint8Array&&Ol(Uint8Array),e=>nc&&e instanceof nc);var nc;const rc=Nl("HTMLFormElement"),oc=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),ac=Nl("RegExp"),ic=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Kl(n,((n,o)=>{let a;!1!==(a=t(n,o,e))&&(r[o]=a||n)})),Object.defineProperties(e,r)},sc="abcdefghijklmnopqrstuvwxyz",lc="0123456789",cc={DIGIT:lc,ALPHA:sc,ALPHA_DIGIT:sc+sc.toUpperCase()+lc};const uc=Nl("AsyncFunction"),dc={isArray:Ul,isArrayBuffer:Fl,isBuffer:function(e){return null!==e&&!Vl(e)&&null!==e.constructor&&!Vl(e.constructor)&&Hl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||Hl(e.append)&&("formdata"===(t=Rl(e))||"object"===t&&Hl(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Fl(e.buffer),t},isString:jl,isNumber:zl,isBoolean:e=>!0===e||!1===e,isObject:ql,isPlainObject:Wl,isUndefined:Vl,isDate:Gl,isFile:Yl,isBlob:Zl,isRegExp:ac,isFunction:Hl,isStream:e=>ql(e)&&Hl(e.pipe),isURLSearchParams:Ql,isTypedArray:tc,isFileList:Xl,forEach:Kl,merge:function e(){const{caseless:t}=ec(this)&&this||{},n={},r=(r,o)=>{const a=t&&Jl(n,o)||o;Wl(n[a])&&Wl(r)?n[a]=e(n[a],r):Wl(r)?n[a]=e({},r):Ul(r)?n[a]=r.slice():n[a]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Kl(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:r}={})=>(Kl(t,((t,r)=>{n&&Hl(t)?e[r]=kl(t,n):e[r]=t}),{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let o,a,i;const s={};if(t=t||{},null==e)return t;do{for(o=Object.getOwnPropertyNames(e),a=o.length;a-- >0;)i=o[a],r&&!r(i,e,t)||s[i]||(t[i]=e[i],s[i]=!0);e=!1!==n&&Ol(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Rl,kindOfTest:Nl,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Ul(e))return e;let t=e.length;if(!zl(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:rc,hasOwnProperty:oc,hasOwnProp:oc,reduceDescriptors:ic,freezeMethods:e=>{ic(e,((t,n)=>{if(Hl(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Hl(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return Ul(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Jl,global:$l,isContextDefined:ec,ALPHABET:cc,generateString:(e=16,t=cc.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&Hl(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(ql(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const o=Ul(e)?[]:{};return Kl(e,((e,t)=>{const a=n(e,r+1);!Vl(a)&&(o[t]=a)})),t[r]=void 0,o}}return e};return n(e,0)},isAsyncFn:uc,isThenable:e=>e&&(ql(e)||Hl(e))&&Hl(e.then)&&Hl(e.catch)};function fc(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o)}dc.inherits(fc,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:dc.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const hc=fc.prototype,pc={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{pc[e]={value:e}})),Object.defineProperties(fc,pc),Object.defineProperty(hc,"isAxiosError",{value:!0}),fc.from=(e,t,n,r,o,a)=>{const i=Object.create(hc);return dc.toFlatObject(e,i,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),fc.call(i,e.message,t,n,r,o),i.cause=e,i.name=e.name,a&&Object.assign(i,a),i};const mc=fc;function gc(e){return dc.isPlainObject(e)||dc.isArray(e)}function vc(e){return dc.endsWith(e,"[]")?e.slice(0,-2):e}function yc(e,t,n){return e?e.concat(t).map((function(e,t){return e=vc(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const bc=dc.toFlatObject(dc,{},null,(function(e){return/^is[A-Z]/.test(e)}));const xc=function(e,t,n){if(!dc.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=dc.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!dc.isUndefined(t[e])}));const r=n.metaTokens,o=n.visitor||c,a=n.dots,i=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&dc.isSpecCompliantForm(t);if(!dc.isFunction(o))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(dc.isDate(e))return e.toISOString();if(!s&&dc.isBlob(e))throw new mc("Blob is not supported. Use a Buffer instead.");return dc.isArrayBuffer(e)||dc.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,o){let s=e;if(e&&!o&&"object"==typeof e)if(dc.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(dc.isArray(e)&&function(e){return dc.isArray(e)&&!e.some(gc)}(e)||(dc.isFileList(e)||dc.endsWith(n,"[]"))&&(s=dc.toArray(e)))return n=vc(n),s.forEach((function(e,r){!dc.isUndefined(e)&&null!==e&&t.append(!0===i?yc([n],r,a):null===i?n:n+"[]",l(e))})),!1;return!!gc(e)||(t.append(yc(o,n,a),l(e)),!1)}const u=[],d=Object.assign(bc,{defaultVisitor:c,convertValue:l,isVisitable:gc});if(!dc.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!dc.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),dc.forEach(n,(function(n,a){!0===(!(dc.isUndefined(n)||null===n)&&o.call(t,n,dc.isString(a)?a.trim():a,r,d))&&e(n,r?r.concat(a):[a])})),u.pop()}}(e),t};function wc(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Tc(e,t){this._pairs=[],e&&xc(e,this,t)}const Ic=Tc.prototype;Ic.append=function(e,t){this._pairs.push([e,t])},Ic.toString=function(e){const t=e?function(t){return e.call(this,t,wc)}:wc;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Sc=Tc;function Cc(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ec(e,t,n){if(!t)return e;const r=n&&n.encode||Cc,o=n&&n.serialize;let a;if(a=o?o(t,n):dc.isURLSearchParams(t)?t.toString():new Sc(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const Ac=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){dc.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Mc={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Pc={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Sc,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Dc="undefined"!=typeof window&&"undefined"!=typeof document,kc=(Lc="undefined"!=typeof navigator&&navigator.product,Dc&&["ReactNative","NativeScript","NS"].indexOf(Lc)<0);var Lc;const Oc="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Rc={...e,...Pc};const _c=function(e){function t(e,n,r,o){let a=e[o++];if("__proto__"===a)return!0;const i=Number.isFinite(+a),s=o>=e.length;if(a=!a&&dc.isArray(r)?r.length:a,s)return dc.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!i;r[a]&&dc.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],o)&&dc.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const o=n.length;let a;for(r=0;r<o;r++)a=n[r],t[a]=e[a];return t}(r[a])),!i}if(dc.isFormData(e)&&dc.isFunction(e.entries)){const n={};return dc.forEachEntry(e,((e,r)=>{t(function(e){return dc.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const Nc={transitional:Mc,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=dc.isObject(e);o&&dc.isHTMLForm(e)&&(e=new FormData(e));if(dc.isFormData(e))return r&&r?JSON.stringify(_c(e)):e;if(dc.isArrayBuffer(e)||dc.isBuffer(e)||dc.isStream(e)||dc.isFile(e)||dc.isBlob(e))return e;if(dc.isArrayBufferView(e))return e.buffer;if(dc.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return xc(e,new Rc.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return Rc.isNode&&dc.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=dc.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return xc(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),function(e,t,n){if(dc.isString(e))try{return(t||JSON.parse)(e),dc.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Nc.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&dc.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw mc.from(e,mc.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Rc.classes.FormData,Blob:Rc.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};dc.forEach(["delete","get","head","post","put","patch"],(e=>{Nc.headers[e]={}}));const Bc=Nc,Uc=dc.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Vc=Symbol("internals");function Fc(e){return e&&String(e).trim().toLowerCase()}function jc(e){return!1===e||null==e?e:dc.isArray(e)?e.map(jc):String(e)}function Hc(e,t,n,r,o){return dc.isFunction(r)?r.call(this,t,n):(o&&(t=n),dc.isString(t)?dc.isString(r)?-1!==t.indexOf(r):dc.isRegExp(r)?r.test(t):void 0:void 0)}class zc{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function o(e,t,n){const o=Fc(t);if(!o)throw new Error("header name must be a non-empty string");const a=dc.findKey(r,o);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=jc(e))}const a=(e,t)=>dc.forEach(e,((e,n)=>o(e,n,t)));return dc.isPlainObject(e)||e instanceof this.constructor?a(e,t):dc.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?a((e=>{const t={};let n,r,o;return e&&e.split("\n").forEach((function(e){o=e.indexOf(":"),n=e.substring(0,o).trim().toLowerCase(),r=e.substring(o+1).trim(),!n||t[n]&&Uc[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&o(t,e,n),this}get(e,t){if(e=Fc(e)){const n=dc.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(dc.isFunction(t))return t.call(this,e,n);if(dc.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Fc(e)){const n=dc.findKey(this,e);return!(!n||void 0===this[n]||t&&!Hc(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function o(e){if(e=Fc(e)){const o=dc.findKey(n,e);!o||t&&!Hc(0,n[o],o,t)||(delete n[o],r=!0)}}return dc.isArray(e)?e.forEach(o):o(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const o=t[n];e&&!Hc(0,this[o],o,e,!0)||(delete this[o],r=!0)}return r}normalize(e){const t=this,n={};return dc.forEach(this,((r,o)=>{const a=dc.findKey(n,o);if(a)return t[a]=jc(r),void delete t[o];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(o):String(o).trim();i!==o&&delete t[o],t[i]=jc(r),n[i]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return dc.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&dc.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[Vc]=this[Vc]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Fc(e);t[r]||(!function(e,t){const n=dc.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,o){return this[r].call(this,t,e,n,o)},configurable:!0})}))}(n,e),t[r]=!0)}return dc.isArray(e)?e.forEach(r):r(e),this}}zc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),dc.reduceDescriptors(zc.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),dc.freezeMethods(zc);const qc=zc;function Wc(e,t){const n=this||Bc,r=t||n,o=qc.from(r.headers);let a=r.data;return dc.forEach(e,(function(e){a=e.call(n,a,o.normalize(),t?t.status:void 0)})),o.normalize(),a}function Gc(e){return!(!e||!e.__CANCEL__)}function Yc(e,t,n){mc.call(this,null==e?"canceled":e,mc.ERR_CANCELED,t,n),this.name="CanceledError"}dc.inherits(Yc,mc,{__CANCEL__:!0});const Zc=Yc;const Xc=Rc.hasStandardBrowserEnv?{write(e,t,n,r,o,a){const i=[e+"="+encodeURIComponent(t)];dc.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),dc.isString(r)&&i.push("path="+r),dc.isString(o)&&i.push("domain="+o),!0===a&&i.push("secure"),document.cookie=i.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Qc(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Kc=Rc.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=dc.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};const Jc=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let o,a=0,i=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=r[i];o||(o=l),n[a]=s,r[a]=l;let u=i,d=0;for(;u!==a;)d+=n[u++],u%=e;if(a=(a+1)%e,a===i&&(i=(i+1)%e),l-o<t)return;const f=c&&l-c;return f?Math.round(1e3*d/f):void 0}};function $c(e,t){let n=0;const r=Jc(50,250);return o=>{const a=o.loaded,i=o.lengthComputable?o.total:void 0,s=a-n,l=r(s);n=a;const c={loaded:a,total:i,progress:i?a/i:void 0,bytes:s,rate:l||void 0,estimated:l&&i&&a<=i?(i-a)/l:void 0,event:o};c[t?"download":"upload"]=!0,e(c)}}const eu={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const o=qc.from(e.headers).normalize();let a,i,{responseType:s,withXSRFToken:l}=e;function c(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}if(dc.isFormData(r))if(Rc.hasStandardBrowserEnv||Rc.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if(!1!==(i=o.getContentType())){const[e,...t]=i?i.split(";").map((e=>e.trim())).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.set("Authorization","Basic "+btoa(t+":"+n))}const d=Qc(e.baseURL,e.url);function f(){if(!u)return;const r=qc.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new mc("Request failed with status code "+n.status,[mc.ERR_BAD_REQUEST,mc.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),c()}),(function(e){n(e),c()}),{data:s&&"text"!==s&&"json"!==s?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),Ec(d,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(f)},u.onabort=function(){u&&(n(new mc("Request aborted",mc.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new mc("Network Error",mc.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||Mc;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new mc(t,r.clarifyTimeoutError?mc.ETIMEDOUT:mc.ECONNABORTED,e,u)),u=null},Rc.hasStandardBrowserEnv&&(l&&dc.isFunction(l)&&(l=l(e)),l||!1!==l&&Kc(d))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&Xc.read(e.xsrfCookieName);t&&o.set(e.xsrfHeaderName,t)}void 0===r&&o.setContentType(null),"setRequestHeader"in u&&dc.forEach(o.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),dc.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),s&&"json"!==s&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",$c(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",$c(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{u&&(n(!t||t.type?new Zc(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const h=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(d);h&&-1===Rc.protocols.indexOf(h)?n(new mc("Unsupported protocol "+h+":",mc.ERR_BAD_REQUEST,e)):u.send(r||null)}))}};dc.forEach(eu,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const tu=e=>`- ${e}`,nu=e=>dc.isFunction(e)||null===e||!1===e,ru=e=>{e=dc.isArray(e)?e:[e];const{length:t}=e;let n,r;const o={};for(let a=0;a<t;a++){let t;if(n=e[a],r=n,!nu(n)&&(r=eu[(t=String(n)).toLowerCase()],void 0===r))throw new mc(`Unknown adapter '${t}'`);if(r)break;o[t||"#"+a]=r}if(!r){const e=Object.entries(o).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));let n=t?e.length>1?"since :\n"+e.map(tu).join("\n"):" "+tu(e[0]):"as no adapter specified";throw new mc("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function ou(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Zc(null,e)}function au(e){ou(e),e.headers=qc.from(e.headers),e.data=Wc.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ru(e.adapter||Bc.adapter)(e).then((function(t){return ou(e),t.data=Wc.call(e,e.transformResponse,t),t.headers=qc.from(t.headers),t}),(function(t){return Gc(t)||(ou(e),t&&t.response&&(t.response.data=Wc.call(e,e.transformResponse,t.response),t.response.headers=qc.from(t.response.headers))),Promise.reject(t)}))}const iu=e=>e instanceof qc?e.toJSON():e;function su(e,t){t=t||{};const n={};function r(e,t,n){return dc.isPlainObject(e)&&dc.isPlainObject(t)?dc.merge.call({caseless:n},e,t):dc.isPlainObject(t)?dc.merge({},t):dc.isArray(t)?t.slice():t}function o(e,t,n){return dc.isUndefined(t)?dc.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function a(e,t){if(!dc.isUndefined(t))return r(void 0,t)}function i(e,t){return dc.isUndefined(t)?dc.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,o,a){return a in t?r(n,o):a in e?r(void 0,n):void 0}const l={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:s,headers:(e,t)=>o(iu(e),iu(t),!0)};return dc.forEach(Object.keys(Object.assign({},e,t)),(function(r){const a=l[r]||o,i=a(e[r],t[r],r);dc.isUndefined(i)&&a!==s||(n[r]=i)})),n}const lu="1.6.5",cu={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{cu[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const uu={};cu.transitional=function(e,t,n){function r(e,t){return"[Axios v1.6.5] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,o,a)=>{if(!1===e)throw new mc(r(o," has been removed"+(t?" in "+t:"")),mc.ERR_DEPRECATED);return t&&!uu[o]&&(uu[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,a)}};const du={assertOptions:function(e,t,n){if("object"!=typeof e)throw new mc("options must be an object",mc.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const a=r[o],i=t[a];if(i){const t=e[a],n=void 0===t||i(t,a,e);if(!0!==n)throw new mc("option "+a+" must be "+n,mc.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new mc("Unknown option "+a,mc.ERR_BAD_OPTION)}},validators:cu},fu=du.validators;class hu{constructor(e){this.defaults=e,this.interceptors={request:new Ac,response:new Ac}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=su(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;void 0!==n&&du.assertOptions(n,{silentJSONParsing:fu.transitional(fu.boolean),forcedJSONParsing:fu.transitional(fu.boolean),clarifyTimeoutError:fu.transitional(fu.boolean)},!1),null!=r&&(dc.isFunction(r)?t.paramsSerializer={serialize:r}:du.assertOptions(r,{encode:fu.function,serialize:fu.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&dc.merge(o.common,o[t.method]);o&&dc.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete o[e]})),t.headers=qc.concat(a,o);const i=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,d=0;if(!s){const e=[au.bind(this),void 0];for(e.unshift.apply(e,i),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=i.length;let f=t;for(d=0;d<u;){const e=i[d++],t=i[d++];try{f=e(f)}catch(e){t.call(this,e);break}}try{c=au.call(this,f)}catch(e){return Promise.reject(e)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return Ec(Qc((e=su(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}dc.forEach(["delete","get","head","options"],(function(e){hu.prototype[e]=function(t,n){return this.request(su(n||{},{method:e,url:t,data:(n||{}).data}))}})),dc.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,o){return this.request(su(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}hu.prototype[e]=t(),hu.prototype[e+"Form"]=t(!0)}));const pu=hu;class mu{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,o){n.reason||(n.reason=new Zc(e,r,o),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new mu((function(t){e=t})),cancel:e}}}const gu=mu;const vu={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vu).forEach((([e,t])=>{vu[t]=e}));const yu=vu;const bu=function e(t){const n=new pu(t),r=kl(pu.prototype.request,n);return dc.extend(r,pu.prototype,n,{allOwnKeys:!0}),dc.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(su(t,n))},r}(Bc);bu.Axios=pu,bu.CanceledError=Zc,bu.CancelToken=gu,bu.isCancel=Gc,bu.VERSION=lu,bu.toFormData=xc,bu.AxiosError=mc,bu.Cancel=bu.CanceledError,bu.all=function(e){return Promise.all(e)},bu.spread=function(e){return function(t){return e.apply(null,t)}},bu.isAxiosError=function(e){return dc.isObject(e)&&!0===e.isAxiosError},bu.mergeConfig=su,bu.AxiosHeaders=qc,bu.formToJSON=e=>_c(dc.isHTMLForm(e)?new FormData(e):e),bu.getAdapter=ru,bu.HttpStatusCode=yu,bu.default=bu;const xu=bu;var wu=function(e){var t=e.message,n=void 0===t?"未知错误":t;ke(n,n)},Tu=xu.create({baseURL:"",timeout:6e4});Tu.interceptors.request.use((function(e){return(0,ii.start)(),e}),(function(e){return Promise.reject(e)})),Tu.interceptors.response.use((function(e){var t,n,r;try{(0,ii.done)();var o=e.data,a=e.config,i=a.headers,s=a.params,l=a.data,c=null!==(r=null!==(t=null==i?void 0:i.disableToast)&&void 0!==t?t:null===(n=JSON.parse(l||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==r?r:null==s?void 0:s.disableToast,u=o||{},d=u.statusCode,f=u.msg,h=u.message,p=u.success,m=u.data,g=u.result;return!p&&void 0!==p||200!=d&&void 0!==d||null==(m||g)?(1!=c&&wu({message:f||h}),Promise.reject(e)):e}catch(e){return Promise.reject(e)}}),(function(e){var t,n,r;(0,ii.done)();var o=e.response,a=void 0===o?{config:{}}:o,i=a.status,s=void 0===i?void 0:i,l=a.config,c=e.config,u=e.message,d=c||l,f=d.headers,h=d.params,p=d.data;if(null!==(r=null!==(t=null==f?void 0:f.disableToast)&&void 0!==t?t:null===(n=JSON.parse(p||"null"))||void 0===n?void 0:n.disableToast)&&void 0!==r?r:null==h?void 0:h.disableToast)return Promise.reject(e);switch(s){case 401:wu({message:"授权信息已失效！"});break;case 403:wu({message:"访问权限受限！"});break;case 404:console.error("请求接口地址不存在，请检查！");break;default:wu({message:s?u:"获取数据失败，请稍后重试!",duration:5e3})}return Promise.reject(e)}));const Iu=Tu;var Su=function(){return Su=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Su.apply(this,arguments)},Cu=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Eu=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Au=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},Mu=xu.CancelToken.source();function Pu(e,t,n,r){return Cu(this,void 0,void 0,(function(){var o,a,i,s;return Eu(this,(function(l){switch(l.label){case 0:o=r.token,a=Au(r,["token"]),l.label=1;case 1:return l.trys.push([1,4,,6]),[4,Iu.get("".concat(e,"/").concat("GetStudyInfo"),{params:Su({hospId:t,hospID:t,studyUID:n},a),headers:o?{Authorization:"bearer "+o}:{}})];case 2:return i=l.sent(),[4,Promise.resolve(i.data)];case 3:return[2,l.sent()];case 4:return s=l.sent(),[4,Promise.reject(s)];case 5:return[2,l.sent()];case 6:return[2]}}))}))}function Du(e,t){return new Promise((function(n,r){Iu.get("".concat(e),{params:{studyUID:t}}).then((function(e){var o,a=(JSON.parse(null===(o=e.data)||void 0===o?void 0:o.result)||{}).data;switch(a){case void 0:case"ALGOERROR":return r({studyUID:t,mesage:"未获取到AI结果",data:a});default:return"Array"===(0,s.dataType)(a)?n(a):r({studyUID:t,mesage:"未知错误",data:a})}})).catch((function(e){return r(e)}))}))}var ku=function(){return ku=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ku.apply(this,arguments)};const Lu=function(e,t,n,r){var o=!1;if(t.includes("web:")&&(t=t.replace("web:",""),o=!0),t.includes("cacheDB:")&&(t=t.replace(/(cacheDB:)|(wadouri:)/g,"")),"cornerstone3D"===r&&t.includes("wadouri:")&&(t=t.replace("wadouri:","")),!t.includes("wadouri:")){var a=n.get(t)||n.get("IM:"+t)||n.get("wadouri:"+t);if(a){if("generateGrayImageModule"===e){var i=a.transferSyntaxUID,s=a.rows,l=a.columns,c=a.rescaleIntercept,u=a.rescaleSlope,d=a.bitsAllocated,f=a.photometricInterpretation,h=a.pixelRepresentation,p=a.windowCenter,m=a.windowWidth,g=a.blocks;return{windowWidth:m[0],windowCenter:p[0],rows:s,columns:l,rescaleSlope:u,rescaleIntercept:c,photometricInterpretation:f,bitsAllocated:d,pixelRepresentation:h,blocks:g,transferSyntaxUID:i}}if("generalSeriesModule"===e)return{modality:a.modality,seriesInstanceUID:a.seriesInstanceUID,seriesNumber:a.seriesNumber,studyInstanceUID:a.studyInstanceUID,seriesDate:a.seriesDate,seriesTime:a.seriesTime,acquisitionDate:a.acquisitionDate,acquisitionTime:a.acquisitionTime};if("patientStudyModule"===e)return{patientAge:a.patientAge};if("imagePlaneModule"===e){var v=a.frameOfReferenceUID,y=(s=a.rows,l=a.columns,a.rowPixelSpacing),b=a.columnPixelSpacing,x=a.pixelSpacing,w=a.rowCosines,T=a.columnCosines;return{frameOfReferenceUID:v,rows:s,columns:l,imageOrientationPatient:a.imageOrientationPatient,rowCosines:w,columnCosines:T,imagePositionPatient:a.imagePositionPatient,sliceThickness:a.sliceThickness,sliceLocation:a.sliceLocation,pixelSpacing:x,rowPixelSpacing:y,columnPixelSpacing:b}}if("imageOrientationTagModule"===e)return{imageBottomTag:a.imageBottomTag,imageleftTag:a.imageleftTag,imagetightTag:a.imagetightTag,imagetopTag:a.imagetopTag};if("imagePixelModule"===e){s=a.rows,l=a.columns,d=a.bitsAllocated;var I=a.bitsStored,S=a.highBit,C=(f=a.photometricInterpretation,h=a.pixelRepresentation,a.samplesPerPixel);return ku({samplesPerPixel:C,photometricInterpretation:f,rows:s,columns:l,bitsAllocated:d,bitsStored:I,highBit:S,pixelRepresentation:h},o&&{pixelRepresentation:0,bitsAllocated:24,bitsStored:24,highBit:24,photometricInterpretation:"RGB",samplesPerPixel:3})}if("voiLutModule"===e)return o?{windowWidth:[256],windowCenter:[128]}:{windowCenter:p=a.windowCenter,windowWidth:m=a.windowWidth};if("modalityLutModule"===e)return{rescaleIntercept:c=a.rescaleIntercept,rescaleSlope:u=a.rescaleSlope};if("sopCommonModule"===e)return{sopClassUID:void 0,sopInstanceUID:a.sopInstanceUID};if("transferSyntax"===e)return{transferSyntaxUID:i=a.transferSyntaxUID}}}};var Ou=function(e){return e.split("|").map((function(e){return Number(e)}))};const Ru=function(e){var t,n,r,o,a=e.mod,i=e.syntaxuid,s=e.seruid,l=e.stuuid,c=e.serid,u=e.stutm,d=e.studt,f=e.acqdt,h=e.acqtm,p=e.age,m=e.row,g=e.col,v=e.imgori,y=e.imgpos,b=e.orb,x=e.orl,w=e.orr,T=e.ort,I=e.pixx,S=e.pixy,C=e.sliceth,E=e.bita,A=e.bits,M=e.hbit,P=e.phme,D=e.pixrep,k=e.sappix,L=e.wc,O=e.ww,R=e.rescin,_=e.rescsl,N=e.sopuid,B=e.blocks,U=Ou(v),V=Ou(y),F=[Number(I),Number(S)],j=Number(_||1),H=Number(R||0),z=Number(D);return F&&(n=F[0],t=F[1]),U&&(r=[U[0],U[1],U[2]],o=[U[3],U[4],U[5]]),{modality:a,frameOfReferenceUID:l,transferSyntaxUID:i,seriesInstanceUID:s,studyInstanceUID:l,sopInstanceUID:N,seriesNumber:Number(c),seriesTime:X().parseTM(u||""),seriesDate:X().parseDA(d||""),acquisitionTime:X().parseTM(h||""),acquisitionDate:X().parseDA(f||""),patientAge:p,rows:Number(m),columns:Number(g),rescaleIntercept:H,rescaleSlope:j,rowPixelSpacing:n,columnPixelSpacing:t,pixelSpacing:F,rowCosines:r,columnCosines:o,imageBottomTag:b,imageleftTag:x,imagetightTag:w,imagetopTag:T,imageOrientationPatient:U,imagePositionPatient:V,sliceThickness:Number(C),sliceLocation:V[2],bitsAllocated:Number(E),bitsStored:Number(A),highBit:Number(M),photometricInterpretation:P,pixelRepresentation:z,samplesPerPixel:Number(k),windowCenter:[parseFloat(String(L))],windowWidth:[parseFloat(String(O))],blocks:Number(B),origin:e}};var _u=new Map,Nu=function(e){e.addProvider((function(e,t){return Lu(e,t,_u,"cornerstone3D")}))},Bu=function(){_u.clear()};t.metaData.addProvider((function(e,t){return Lu(e,t,_u)}));var Uu,Vu=document.createElement("canvas");const Fu=function(e,t,n){void 0===n&&(n={});var r=e.naturalHeight,o=e.naturalWidth;function a(n){var r,o=function(){var n;Uu===t?n=Vu.getContext("2d",{willReadFrequently:!0}):(Vu.height=e.naturalHeight,Vu.width=e.naturalWidth,(n=Vu.getContext("2d",{willReadFrequently:!0})).drawImage(e,0,0),Uu=t);return n.getImageData(0,0,e.naturalWidth,e.naturalHeight)}();return function(e,t){for(var n=0,r=0;n<e.data.length;n+=4,r+=3)t[r]=e.data[n],t[r+1]=e.data[n+1],t[r+2]=e.data[n+2]}(o,r=(null==n?void 0:n.arrayBuffer)?new Uint8Array(n.arrayBuffer,n.offset,n.length):new Uint8Array(o.width*o.height*3)),r}return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,getPixelData:a,getCanvas:function(){return Uu===t||(Vu.height=e.naturalHeight,Vu.width=e.naturalWidth,Vu.getContext("2d",{willReadFrequently:!0}).drawImage(e,0,0),Uu=t),Vu},getImage:function(){return e},rows:r,columns:o,height:r,width:o,color:!0,rgba:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:r*o*3,pixelData:(null==n?void 0:n.targetBuffer)?a(n.targetBuffer):void 0}};var ju=K.wadouri.parseImageId;const Hu=function(e,t){void 0===t&&(t={});var n=ju(e),r=ie(n.url,e),o=(new Date).getTime();return{promise:new Promise((function(n,a){r.then((function(r){try{var i=(0,Q.arrayBufferToImage)(r),s=(new Date).getTime();i.then((function(r){var a=Fu(r,e,t),i=(new Date).getTime();r.sharedCacheKey=e,r.loadTimeInMS=s-o,r.totalTimeInMS=i-o,n(a)}),a)}catch(e){a({error:e,response:r})}}),a)})),cancelFn:function(){r.xhr.abort()}}};const zu=function(e){e.registerImageLoader("web",Hu)};var qu=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},Wu=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Gu=(0,a.importInternal)("util/triggerEvent"),Yu={x:null,y:null},Zu={client:Yu,page:Yu},Xu=function(e){try{if(!e)return;var n=(0,t.getEnabledElement)(e),r="mobile"==U.env?[a.EVENTS.TOUCH_DRAG,a.EVENTS.TOUCH_END]:[a.EVENTS.MOUSE_UP],o=a.store.state.globalToolChangeHistory.slice(-1)[0]||{},i=o.mode,s=qu(o.args,2),l=s[0],c=s[1];if("active"!==i||!c.mouseButtonMask.includes(1))return;switch(l){case"Wwwc":case"Rotate":break;case"FreehandRoi":(0,a.getToolForElement)(e,"FreehandRoi").cancelDrawing(e);break;default:r.forEach((function(t){Gu(e,t,{image:n.image,element:e,startPoints:Zu,lastPoints:Zu,currentPoints:Zu,deltaPoints:Zu,type:t,isTouchEvent:!0})}))}}catch(e){xs(e)}};const Qu=function(){var e,n;try{for(var r=Wu((0,t.getEnabledElements)()),o=r.next();!o.done;o=r.next()){var i=o.value.element;Xu(i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}setTimeout((function(){a.store.state.isToolLocked=!1}))};var Ku="cornerstone-canvas";function Ju(e){var t="canvas.".concat(Ku);return e.querySelector(t)||function(e){var t=document.createElement("canvas");return t.style.display="block",t.classList.add(Ku),e.appendChild(t),t}(e)}function $u(){(function(){var e,t=(null===(e=window.performance)||void 0===e?void 0:e.memory)||{};return t.usedJSHeapSize/t.totalJSHeapSize})()>.99&&console.error("如遇渲染缓慢、失败或崩溃，可调整画质级别")}var ed=function(){return ed=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ed.apply(this,arguments)},td=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},nd=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},rd=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},od=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},ad=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},id=new rl,sd=(0,a.importInternal)("util/scrollToIndex"),ld=function(){function e(e,n,r,o,i){var l=this;this.eventNamespace="clear",this.studyScrollIndex=0,this.isDestroy=!1;var c=i||{},u=c.sharedArrayBuffer,d=c.GPUBenchmarksURL,f=c.imageTypeDefault,h=void 0===f?U.imageTypeDefault:f,p=c.cacheImagesDefault,m=void 0===p?N.enableDefault:p,g=c.scrollPreload,v=void 0===g?k.scroll:g,y=c.scrollPreloadNum,b=void 0===y?k.scrollNum:y,x=c.seriesPreFetchNum,w=void 0===x?k.seriesFetchNum:x,T=c.fullLoad,I=void 0===T?k.fullLoad:T,S=c.token,C=void 0===S?void 0:S,E=c.isDesensitize,A=void 0!==E&&E,M=c.departCode,P=void 0===M?void 0:M,D=c.isKeyImage,R=void 0!==D&&D,_=c.isInternal,V=void 0!==_&&_,F=c.clientType,j=void 0===F?0:F,H=c.forceIM,z=c.logoURL,q=c.minRenderCountMPR3D,W=c.theme,G=c.toolsBar,Y=c.AI,Z=c.aboutUs;if(this.globalContainer=(0,s.dataType)(e).includes("Element")?e:document.getElementById(e),!this.globalContainer)throw new Error("container is required, type is id:string or HTMLDivElement");if(this.globalContainer.childElementCount)throw new Error("该容器已实例化或内有其他元素，请调用destroy方法或清除内部无关元素再试！");for(var X in W)this.globalContainer.style.setProperty("--theme-".concat(X,"-dicom-viewer"),W[X]);this.wado=new URL(n,origin).href,this.hospId=r,this.studyUIDArr=od([],rd(new Set(null==o?void 0:o.split(",").filter((function(e){return e})))),!1),this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.getStudyInfoCount=0,this.token=C,this.departCode=P,this.GPUBenchmarksURL=d,this.isDesensitize=A?1:0,this.isKeyImage=R?1:0,this.isInternal=V?1:0,this.clientType=j,U.imageTypeDefault=h,this.imageType=U.imageType,this.seriesCount={x:1,y:1},this.imageCount={x:1,y:1},N.enableDefault=m,k.scroll=v,k.scrollNum=b,k.seriesFetchNum=w,k.fullLoad=I,U.aboutUs=ed(ed({},B),Z),U.toolsBar=ed(ed({},L),G),U.toolsBar.navigationBottomLayout="mobile"===U.env&&U.toolsBar.navigationBottomLayout,U.AI=ed(ed({},O),Y),U.forceIM=null!=H?H:U.forceIM,U.logoURL=U.toolsBar.navigationBottomLayout?" ":null!=z?z:U.logoURL,U.sharedArrayBuffer=null!=u?u:U.sharedArrayBuffer,U.minRenderCountMPR3D=null!=q?q:U.minRenderCountMPR3D,U.instanceOptions=ed({container:e,wado:n,hospId:r,studyUID:o},i),U.webDicomView=this,this.synchronizer=new a.Synchronizer(t.EVENTS.IMAGE_RENDERED,(function(){})),this.synchronizerStackImageIndex=new a.Synchronizer("".concat(t.EVENTS.NEW_IMAGE," ").concat(a.EVENTS.STACK_SCROLL),a.stackImageIndexSynchronizer),this.layoutView=new el,this.bindEvents(),t.events.addEventNamespaceListener("tool_event.VRT",(function(e){var t=e.detail.toolData,n=(void 0===t?{}:t).toolTag;if(fl)switch(void 0===n?"":n){case"VTRReload2D":hl.initTop2DTools();case"MPR":vl();break;case"VRTKnifeIn":fl.knifeBegin("KnifeIn",gl);break;case"VRTKnifeOut":fl.knifeBegin("KnifeOut",gl);break;case"VRTModulation":fl.toolsToggle("Modulation");break;case"VRTRotate":fl.toolsToggle("Rotate");break;case"VRTReset":fl.reset()}})),this.layoutView.initLayout(this.globalContainer),this.layoutView.initTop2DTools("mobile"===U.env?"翻页":"缩放"),this.initAI(void 0,!0).finally((function(){l.getStudyInfos().then((function(){l.initAI()}))})),U.toolsBar.VRTVisibility&&this.initVRTPath(),U.toolsBar.enhanceVisibility&&K.webWorkerManager.loadWebWorkerTask("./opencvDecode.worker.js")}return e.prototype.getStudyInfoHandle=function(e,t){var n;return td(this,void 0,void 0,(function(){var r,o,a,i,s,l;return nd(this,(function(c){switch(c.label){case 0:t>0&&!this.studyArr[0]&&(t=0),c.label=1;case 1:if(c.trys.push([1,4,,5]),!this.wado||!e)throw console.warn("wadoURL:",this.wado,"studyUID:",e),"wadoURL,studyUID is required";return[4,Pu(this.wado,this.hospId,e,{isDcm:this.imageType,imageType:this.imageType,token:this.token,departCode:this.departCode,hasDesensitize:this.isDesensitize,isKeyImage:this.isKeyImage,isInternal:this.isInternal,clientType:this.clientType})];case 2:return r=c.sent(),this.studyArr[t]=new Sl(ed(ed({},r.data),{hospId:this.hospId}),this.wado),0==t?(o=this.studyArr[0],a=(null===(n=o.arrSeries)||void 0===n?void 0:n[0])||{},i=a.uuid,s=a.studyUID,this.selectSeries={seriesId:i,studyUID:s,seriesIndex:0},this.studyScrollIndex=0,this.initFirstStudySeriesLayoutState(o),this.seriesCount=o.getSeriesLayoutCount(),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,o.arrSeries,this.seriesCount)):this.seriesLayoutState.addSeriesArr(this.studyArr[t].arrSeries),this.initStudyNavigation(t),[4,this.initSeries(t)];case 3:return c.sent(),this.seriesLayoutState.syncState("originStates"),t>0&&this.addSeries(this.seriesLayoutState.getSeries("originStates")),[3,5];case 4:return l=c.sent(),console.error(l),[3,5];case 5:return this.getStudyInfoCount+=1,[2]}}))}))},e.prototype.getStudyInfos=function(){return td(this,void 0,void 0,(function(){var e,t,n,r,o,a,i,s;return nd(this,(function(l){switch(l.label){case 0:if(!this.studyUIDArr.length)throw"studyUID is empty";l.label=1;case 1:l.trys.push([1,6,7,8]),e=ad(Object.entries(this.studyUIDArr)),t=e.next(),l.label=2;case 2:return t.done?[3,5]:(n=rd(t.value,2),r=n[0],o=n[1],[4,this.getStudyInfoHandle(o,Number(r))]);case 3:l.sent(),l.label=4;case 4:return t=e.next(),[3,2];case 5:return[3,8];case 6:return a=l.sent(),i={error:a},[3,8];case 7:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))},e.prototype.addStudy=function(e){return td(this,void 0,void 0,(function(){var t,n,r=this;return nd(this,(function(o){if("string"!=typeof e)throw"studyUID is required";return this.studyUIDArr.includes(e)?[2]:(t=this.studyUIDArr.length,this.getStudyInfoCount!==t?(setTimeout((function(){r.addStudy(e)}),1e3),[2]):(this.studyUIDArr.push(e),n=t,this.getStudyInfoHandle(e,n),[2]))}))}))},e.prototype.activeAI=function(e){U.AI=ed(ed(ed({},U.AI),{parseSuccess:!0,active:!0}),e),this.initAI()},e.prototype.renderLayoutImageToCanvas=function(e,n,r,o,a){ci(e);var i=(0,t.getDefaultViewportForImage)(e,n);(0,t.displayImage)(e,n,i),r&&(this.layoutView.createSeriesMarker(e,r,i),this.layoutView.toggleCavanAroundInfoStyle(U.cavanAroundInfo)),this.initDicomTools(e,o,void 0,a)},e.prototype.initDicomTools=function(e,t,n,r){var o=t.loadIds;o&&o.length>0&&((0,a.addStackStateManager)(e,["stack"]),(0,a.addToolState)(e,"stack",{currentImageIdIndex:n||0,imageIds:o,loadObj:t}))},e.prototype.displaySeriesByImageindex=function(e,t,n){var r=this;return new Promise((function(o,a){if(!t)return a("dicomObj is not defined");var i=t.loadIds,s=t.imgs;yi(i[n||0]).then((function(a){r.renderLayoutImageToCanvas(e,a,s[n||0],t),o(a)}),(function(e){a(e)}))}))},e.prototype.displayDcmByImages=function(e,n,r){var o=this,a=n.loadIds,i=e.querySelectorAll(".layoutImage"),s=i.length;s>0&&i.forEach((function(n,i){return td(o,void 0,void 0,(function(){var o,l,c;return nd(this,(function(u){switch(u.label){case 0:return(l=a[o=(r||0)*s+i])?(Ju(n).classList.remove("hidden"),ci(n),[4,yi(l)]):[3,2];case 1:return c=u.sent(),(0,t.displayImage)(n,c),[3,3];case 2:Ju(n).classList.add("hidden"),e.querySelector("div.player-bar")&&o>a.length&&sd(e,0),u.label=3;case 3:return[2]}}))}))}))},e.prototype.displayDcmBySlider=function(e,n,r,o){var a=r[o];a&&yi(a).then((function(r){var a=e.seriesDom.clientWidth,i=e.seriesDom.clientHeight,s=(0,t.getDefaultViewportForImage)(e.seriesDom,r),l=i/r.height,c=a/r.width;s.scale=c<l?parseFloat(c.toFixed(2)):parseFloat(l.toFixed(2)),(0,t.displayImage)(e.seriesDom,r,s),n.currentImageIdIndex=o}),(function(e){}))},e.prototype.assambleLoadIds=function(e,t,n){for(var r=e.studyUID,o=e.imgs,a=e.flatSeries,i=e.uuid,s=n.length,l=function(e,t){return e+(e.includes("?")?"&":"?")+"v=".concat(t)},c=[],u=0;u<s;u++){var d=(o[a?0:u]||{}).url,f=n[u],h=f.url,p=f.id,m=f.acqtm,g=f.isIM,v=f.blocks,y=void 0;1===this.imageType?(y=l(y=d||h||this.wado+"/GetBlock/"+p+(0,ol.stringify)({studyuid:r,hospitalid:this.hospId,seriesId:i,blockIndex:0,imageType:1},{addQueryPrefix:!0}),m),n[u].url=y,y="wadouri:"+y):(y=l(y=d||h||this.wado+"/GetBlock/"+p+(0,ol.stringify)({studyuid:r,hospitalid:this.hospId,seriesId:i,blockIndex:0},{addQueryPrefix:!0}),m),n[u].url=y,(g||U.forceIM)&&Number(v||1)<=1&&(y="IM:"+y+"&isIM")),n[u].imageIdURL=y,c.push(y)}return{seriesIndex:t,seriesUid:i,studyUID:r,loadIds:a?c.filter((function(e,n){return n===t})):c,imgs:a?n.filter((function(e,n){return n===t})):n,images:[]}},e.prototype.initVRTPath=function(){return td(this,void 0,void 0,(function(){var e,t,n,r;return nd(this,(function(o){switch(o.label){case 0:e=this.layoutView.toolsContainer.querySelector(".tools2d .tool-event-link.VRT"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(a=this.wado,i=this.token,new Promise((function(e,t){var n=function(e){if("Object"!=(0,s.dataType)(e.data))return t("未获得3D数据或该医院接口未支持，请联系管理员")};Iu.get("".concat(a,"/").concat("getPath3d"),{data:{disableToast:!0},headers:i?{Authorization:"bearer "+i}:{}}).then((function(t){return n(t),e(t.data)})).catch((function(e){return n(e),t(e)}))})))];case 2:return t=o.sent(),(n=((null==t?void 0:t.data)||{}).path)&&(this.VRTWsURl=n,U.toolsBar.VRTVisibility=!0,null==e||e.classList.remove("hidden")),[3,4];case 3:return r=o.sent(),U.toolsBar.VRTVisibility=!1,null==e||e.classList.add("hidden"),console.error(r),[3,4];case 4:return[2]}var a,i}))}))},e.prototype.initAI=function(e,n){return td(this,void 0,void 0,(function(){var r,o,a,i,s,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I,S,C,E,A,M=this;return nd(this,(function(P){switch(P.label){case 0:r=0,o=U.AI,a=o.resultURL,i=o.parseSuccess,s=o.getParseHandler,l=o.active,c=o.jumpFirstAI,u=this.layoutView.toolsContainer.querySelector(".tools2d .tool-event-link.AI"),d=function(e,n){if(void 0===n&&(n=!1),!e)throw"seriesID is required";return new Promise((function(r){if(n){var o=Da.getFirstIndex(e),a=M.layoutView.canvasContainer.querySelector(".layoutCellsInner[data-series-id='".concat(e,"']"));a&&sd(a,o),r(a)}else{var i=t.EVENTS.NEW_IMAGE,s=M.layoutView.canvasContainer.querySelectorAll(".layoutCellsInner"),l=function t(n){setTimeout((function(){var o=n.target;n.target.dataset.seriesId===e&&(s.forEach((function(e){e.removeEventListener(i,t);var n=Da.getFirstIndex(e.dataset.seriesId);n&&sd(e,n)})),r(o))}))};s.forEach((function(e){e.addEventListener(i,l)}))}}))},P.label=1;case 1:if(P.trys.push([1,17,,18]),f=function(){if(setTimeout((function(){null==u||u.classList.remove("active")}),100),"function"!=typeof s)throw"AI configure error";s({studyArr:M.studyUIDArr,departCode:M.departCode,hospId:M.hospId}),console.info("getParseHandler事件已执行")},!1===e)return this.layoutView.toggleAIIconStyle(),this.layoutView.topTools.AITool(),[2];if(!i)return e?[2,f()]:[2];if(!l&&!e)return[2];if(!a)throw"AI configure error";P.label=2;case 2:P.trys.push([2,9,10,11]),h=ad(this.studyUIDArr.filter((function(e){return!Pa[e]}))),p=h.next(),P.label=3;case 3:if(p.done)return[3,8];m=p.value,P.label=4;case 4:return P.trys.push([4,6,,7]),[4,Du(a,m)];case 5:return function(e,t){var n,r;Pa[t]=!0;try{for(var o=Ca(e),a=o.next();!a.done;a=o.next()){var i=a.value,s=i.nodule_bbox,l=i.seriesID,c=i.nodule_type,u=i.nodule_bm_prob;for(var d in s){var f=Number(d)-1,h=s[d],p=h.position,m=h.size,g="".concat(l,"?index=").concat(f),v=Ma.get(g),y=p.x-m.w,b=p.y-m.h,x=p.x+m.w,w=p.y+m.h,T=Sa(Sa({},i),{noduleType:ka(c),noduleBmProbCN:La(u),instanceNumber:Number(d),visible:!0,active:!1,invalidated:!0,handles:{start:{x:y,y:b,movesIndependently:!0,hasBoundingBox:!0},end:{x,y:w,movesIndependently:!0,hasBoundingBox:!0},textBox:{x,y:w,active:!1,hasMoved:!0,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}});T.textBoxContent=Oa(T),Ma.set(g,Aa(Aa([],Ea(v||[]),!1),[T],!1)),Da.add(l,f)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}Da.sort()}(P.sent(),m),null==u||u.classList.add("active"),[3,7];case 6:return g=P.sent(),r+=1,console.error(g),e&&r>=this.studyUIDArr.length&&f(),[3,7];case 7:return p=h.next(),[3,3];case 8:return[3,11];case 9:return v=P.sent(),E={error:v},[3,11];case 10:try{p&&!p.done&&(A=h.return)&&A.call(h)}finally{if(E)throw E.error}return[7];case 11:if(n)return[2];if(this.layoutView.toggleAIIconStyle(Da.getSeriesIDArr()),this.layoutView.topTools.AITool(!0),!c)return[3,16];for(x in y=void 0,b=[],Da.store)b.push(x);w=0,P.label=12;case 12:return w<b.length?(T=b[w],[4,d(T,!0)]):[3,15];case 13:(I=P.sent())&&(y=I),P.label=14;case 14:return w++,[3,12];case 15:if(!y){if(!(S=this.layoutView.leftSideContainer.querySelector(".viewer-navigator-wrapper.show-AI")))return[2];S.click(),d(S.dataset.seriesId,!1)}P.label=16;case 16:return[3,18];case 17:return C=P.sent(),setTimeout((function(){null==u||u.classList.remove("active"),console.error("AI configure error"===C?"该医院未正确配置或接入AI分析":C)})),console.error(C),[3,18];case 18:return[2]}}))}))},e.prototype.initSeries=function(e){return td(this,void 0,void 0,(function(){var t,n,r,o,a,i,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I=this;return nd(this,(function(S){switch(S.label){case 0:return t=this.studyArr[e],n=0,r=[],[4,(new s.PromiseQueue).init({arr:t.arrSeries,func:function(t){return td(I,void 0,void 0,(function(){return nd(this,(function(r){switch(r.label){case 0:return[4,this.getSeriesMeta(t,e,n++)];case 1:return r.sent(),[2]}}))}))},limit:6})];case 1:if(S.sent(),0==e)try{if(k.fullLoad){o=function(e,t){var n=e.slice(1);n.length?bi(n,{cancel:!1,countCallback:function(e,r,o){I.layoutView.progressCountStyle(t,n.length,o,!0)}}):a.layoutView.progressCountStyle(t,1,1,!0)},a=this;try{for(i=ad(t.arrSeries),l=i.next();!l.done;l=i.next())c=l.value.seriesLoadIds,g=c.loadIds,u=c.seriesUid,o(g,u)}catch(e){b={error:e}}finally{try{l&&!l.done&&(x=i.return)&&x.call(i)}finally{if(b)throw b.error}}}else{d=Math.max(k.seriesFetchNum||(t.arrSeries.length<=6?7:5),0);try{for(f=ad(t.arrSeries),h=f.next();!h.done;h=f.next())p=h.value.seriesLoadIds.loadIds,r=od(od([],rd(r),!1),rd(p.slice(1,d)),!1)}catch(e){w={error:e}}finally{try{h&&!h.done&&(T=f.return)&&T.call(f)}finally{if(w)throw w.error}}r.length&&bi(r,{cancel:!1}),m=t.arrSeries[0].seriesLoadIds,g=m.loadIds,v=m.seriesUid,(y=g.slice(d)).length?bi(y,{cancel:!1,countCallback:function(e,t,n){I.layoutView.progressCountStyle(v,y.length,n)}}):this.layoutView.progressCountStyle(v,1,1,!0)}}catch(e){console.error("first series load error: "+e)}return[2]}}))}))},e.prototype.addSeries=function(e){var n=this;if(null==e?void 0:e.length){var r=this.layoutView.seriesLayout.seriesLayouts,o=(0,t.getEnabledElements)().map((function(e){return e.element}));r.forEach((function(t,r){var a=t.seriesDom;return td(n,void 0,void 0,(function(){var t;return nd(this,(function(n){switch(n.label){case 0:return t=e[r],o.includes(a)||!t?[3,2]:[4,this.displaySeriesByImageindex(a,t.seriesLoadIds)];case 1:n.sent(),this.layoutView.seriesLayout.initSingle(a,t,{seriesId:t.uuid,studyUID:t.studyUID,seriesIndex:r}),this.layoutView.seriesLayout.seriesLayoutsUpdate(a,t.uuid),n.label=2;case 2:return[2]}}))}))})),this.layoutView.studySlider.createLayout(this.layoutView.canvasContainer,e,this.seriesCount,!0),this.layoutView.resizeLayout(),this.reloadReferenceLineTool()}},e.prototype.restoreSeries=function(e){var t=this;(null==e?void 0:e.length)&&(fi(),this.studyScrollIndex=0,this.layoutView.seriesLayout.seriesLayouts=[],b(this.layoutView.canvasContainer),this.layoutView.seriesLayout.createCanvasSeries(this.layoutView.canvasContainer,e,this.seriesCount),this.layoutView.seriesLayout.seriesLayouts.forEach((function(n,r){var o=n.seriesDom,a=e[r];a&&t.displaySeriesByImageindex(o,a.seriesLoadIds)})),this.reloadReferenceLineTool())},e.prototype.getSeriesMeta=function(e,t,n){var r,o=this,a=e.studyUID,i=e.uuid;if(0===t){var l=function(){return null==r?void 0:r.seriesDom.querySelector("canvas")};if((r=this.layoutView.seriesLayout.seriesLayouts[n])&&!l()){ci(r.seriesDom);var c=l();(0,s.canvasDrawImage)(c,this.iconImagesArr[t][n].icon,{interceptors:function(){return Promise.resolve((0,s.isCanvasBlank)(c))}}).catch((function(){}))}}return function(e,t,n,r,o,a,i){return Cu(this,void 0,void 0,(function(){var s;return Eu(this,(function(l){switch(l.label){case 0:t=v(t),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,Iu.get("".concat(e,"/").concat("GetSeriesMeta"),{params:{uuid:t,studyuid:n,studyUID:n,hospid:r,hospitalid:r,hospID:r,imageType:o,isDcm:o,hasDesensitize:a},headers:i?{Authorization:"bearer "+i}:{},cancelToken:Mu.token})];case 2:return s=l.sent(),[4,Promise.resolve(s.data)];case 3:return[2,l.sent()];case 4:throw l.sent(),"无法请求到uuid为"+t+"的SeriesMeta数据";case 5:return[2]}}))}))}(this.wado,i,a,this.hospId,this.imageType,this.isDesensitize,this.token).then((function(a){var s=a.data;return td(o,void 0,void 0,(function(){var o,a,l,c,u,d,f,h,p,m,g,v,y,b=this;return nd(this,(function(x){switch(x.label){case 0:o=s.imgs.sort((function(e,t){return Number(e.imgnum)-Number(t.imgnum)})),a=this.assambleLoadIds(e,n,o),l=a.imgs,c=a.loadIds;try{for(u=ad(l),d=u.next();!d.done;d=u.next())f=d.value,w=f.imageIdURL,T=f,_u.set(w,Ru(T))}catch(e){v={error:e}}finally{try{d&&!d.done&&(y=u.return)&&y.call(u)}finally{if(v)throw v.error}}return this.studyArr[t].arrSeries[n].seriesLoadIds=a,this.seriesLoadIds.push(a),0!==t?[3,4]:(h=this.seriesCount.x*this.seriesCount.y==1,p=Da.getSeriesIDArr(),m=p.length,g=function(){return yi(c[0]).then((function(e){!r||h&&(0!==n||m)||b.renderLayoutImageToCanvas(r.seriesDom,e,s.imgs[0],a)}),(function(e){console.error("loadAndCacheImage",e)}))},p.includes(i)?[4,g()]:[3,2]);case 1:return x.sent(),[3,3];case 2:g(),x.label=3;case 3:x.label=4;case 4:return[2]}var w,T}))}))})).catch((function(e){console.error(e)}))},e.prototype.initFirstStudySeriesLayoutState=function(e){var t=e.arrSeries;this.seriesLayoutState=new Dl(t)},e.prototype.initStudyNavigation=function(e){var t,n=this.studyArr[e],r=this.iconImagesArr[e]=[];n.arrSeries.forEach((function(e){r.push({icon:e.icon,images:e.arrImage,hasAi:!1,seriesId:e.uuid,seriesDescription:e.desp,series:e})})),((null===(t=this.layoutView.studyNavigationBody)||void 0===t?void 0:t.childElementCount)||0)<this.studyArr.length&&this.layoutView.createStudyNavigationGroup(n,r,e)},e.prototype.reload2d=function(){this.layoutView.iconPlayer.playerAllPauseAndRemove(),this.layoutView.topTools.cancelToolAndDefaultViewportTools(),this.layoutView.initTop2DTools();var e=this.studyArr[0];this.seriesCount=e.getSeriesLayoutCount(),this.seriesLayoutState.syncState(),this.restoreSeries(this.seriesLayoutState.getSeries()),ai()},e.prototype.initMPR=function(e){var r,a=(void 0===e?{}:e).levelDefault;return td(this,void 0,void 0,(function(){var e,i,c,u,d,f,h,p,m,g,v,y,b,w,T,I,S,C,E;return nd(this,(function(A){switch(A.label){case 0:if(A.trys.push([0,2,,3]),e='"MPR渲染加速"必须使用https安全协议，未部署https安全协议？',i=_.performanceLevel,!(c=this.selectSeries.seriesId))return[2];if(u=U.sharedArrayBuffer,d=U.minRenderCountMPR3D,f=U.tipRecord,h=this.querySeriesLoadIds(c),p=this.queryCurrentContainer().seriesDom,void 0===(m=((0,t.getImage)(p)||{}).color))throw"isReturn";if(g=h.seriesUid,v=rd(h.imgs,1),y=v[0].mod,b=od([],rd(h.loadIds),!1),w=!0,!g||!b)return[2,Se().error({title:"请选择一个序列"})];if(b.length<d)return[2,Se().error({title:"当前序列图像数量小于".concat(d,"张，无法构建MPR")})];if(window.SharedArrayBuffer?(Object.defineProperty(window,"crossOriginIsolated",{writable:!0}),window.crossOriginIsolated=!0):u&&!f.sharedArrayBufferGuide&&(T=navigator.userAgent.indexOf("WebKit")>-1,"http:"===(I=location.protocol)&&(0,s.env)().isWin&&T?(n.g.getSpeedMPRBat=function(){var e=URL.createObjectURL(new Blob(['@REM chcp 65001\n@REM chcp 936\n\n@echo off\nSetlocal enabledelayedexpansion\nset SCRIPT="%TEMP%\\%RANDOM%-%RANDOM%-%RANDOM%-%RANDOM%.vbs"\n\n:loop\n\n@REM utf-8\nchcp 65001\n\necho.\nset /p "lnkPath=请拖动chrome、Edge、360极速、360安全、QQ等(谷歌内核)浏览器快捷方式到本窗口并回车:"\n\n@REM GB2312 读取中文文件路径\nchcp 936\n\nif exist "%lnkPath%" ( echo. & echo 配置中... ) else (  echo. & echo 请重试  & goto loop)\n\necho Set oWS = WScript.CreateObject("WScript.Shell") >> %SCRIPT%\n\necho sLinkFile = "%lnkPath:"=%" >> %SCRIPT%\n\necho Set oLink = oWS.CreateShortcut(sLinkFile) >> %SCRIPT%\n\necho oLink.Arguments= "--enable-features=SharedArrayBuffer"  >> %SCRIPT%\n\n@REM echo oLink.WorkingDirectory = "%workingDir%" >> %SCRIPT%\n\necho oLink.Save >> %SCRIPT%\n\ncscript /nologo %SCRIPT%\n\ndel %SCRIPT%\n\n@REM utf-8\nchcp 65001\n\necho.\necho MPR特性支持配置完成，请关闭该浏览器全部窗口后再重新运行该快捷方式去使用MPR功能！\n\necho.\necho.\n\necho 如出现报错或运行本程序后还是无法使用MPR！\necho.\necho 解决方案：\necho.\necho 1.将快捷方式复制一份（解决权限问题）或把名称改为纯英文后再重新运行该程序；\necho.\necho 2.手动修改：找到浏览器快捷方式==》右键==》属性==》目标==》尾部添加--enable-features=SharedArrayBuffer，（例如："某某浏览器.exe" --enable-features=SharedArrayBuffer）\n\necho.\necho.\n\npause',{type:"application/x-msdownload"}]));x(e,"双击运行-配置MPR渲染加速特性支持.bat"),URL.revokeObjectURL(e)},console.info("强制配置MPR渲染加速特性支持,控制台执行getSpeedMPRBat()下载.bat文件")):console.error("http:"===I?"".concat(e,"将关闭MPR渲染加速!"):'MPR渲染加速"需配置crossOriginIsolated，请联系管理员'),f.sharedArrayBufferGuide=!0),!0!==u&&!1!==u||(w=u,console.error("MPR渲染加速已被手动设置为:",u)),1!==this.imageType?(w=!1,console.info("MPR渲染加速已关闭")):window.crossOriginIsolated?console.info("MPR渲染加速已开启"):(w=!1,console.info("MPR渲染加速未开启"),console.error("".concat(e,"Your page is NOT cross-origin isolated, see https://developer.mozilla.org/en-US/docs/Web/API/crossOriginIsolated"))),m&&(b=b.map((function(e){return e.replace("IM","web")}))),S=a||Math.min(10,Math.max(1,Math.floor(80*i/b.length*10)-1)),b.length>60*i&&(b=function(e,t){if(t<=0||t>100)throw new Error("Percentage must be between 0 and 100.");for(var n=e.length,r=Math.floor(n*(t/100)),o=[],a=0;a<r;a++){var i=Math.floor(a*(n/r));o.push(e[i])}return o}(b,10*Number(S))),C=this.layoutView.mprLayout.createLayout(),id.show({message:"MPR资源加载中,请耐心等待"}),id.hidden(),$u(),void 0===n.g.webDicomViewMPR)throw"MPRError";return this.layoutView.initTopMPRTools("mobile"===U.env?"翻页":"十字准星"),[4,null===(r=n.g.webDicomViewMPR)||void 0===r?void 0:r.MPRRun(C,{seriesUid:g,loadIds:b,GPUBenchmarksURL:this.GPUBenchmarksURL,layoutView:this.layoutView,useSharedArrayBuffer:w,recommendLevel:S,modality:y,globalVar:{cornerstone:o(),cornerstoneWADOImageLoader:J(),iziToast:Se(),simple2k13:l(),store:U,utils:{clearImageCache:G,customPrompt:an,Hammer:ze(),init3DProvider:Nu,registerIMImageLoader:ce,registerWebImageLoader:zu}}})];case 1:return A.sent(),[3,3];case 2:return E=A.sent(),$u(),id.hidden(),this.layoutView.mprLayout.hidden(),this.layoutView.initTop2DTools(),"isReturn"===E?[2]:"MPRError"===E?(console.error("MPR模块未加载，请稍后重试或联系管理员检查配置"),[2]):(console.error(E),Se().error({title:"MPR生成失败，请稍后重试"}),[3,3]);case 3:return[2]}}))}))},e.prototype.initVRT=function(){this.layoutView.initTop2DTools();var e=this.selectSeries.seriesId;if(e){var t,n,r=this.querySeriesLoadIds(e),o=r.loadIds,a=r.seriesUid,i=r.studyUID;if(this.VRTWsURl||console.error("该医院未接入3D"),!a||!o)return Se().error({title:"请选择一个序列"});if(o.length<U.minRenderCountMPR3D)return Se().error({title:"当前序列图像数量小于".concat(U.minRenderCountMPR3D,"张，无法构建3D")});t=this.layoutView.vrtLayout.createLayout(),n={vrtWsURl:this.VRTWsURl,wadoURL:this.wado,hospId:this.hospId,studyUID:i,seriesUid:a,layoutView:this.layoutView},pl(void 0,void 0,void 0,(function(){var e;return ml(this,(function(r){return e=n.layoutView,fl=new dl,hl=e,fl.open(t,n),[2]}))})),this.layoutView.initTopVRTTools("旋转")}},e.prototype.reloadReferenceLineTool=function(){var e,t=null===(e=this.layoutView.toolsContainer.querySelector(".tools2d .tool-event-link.referenceLine"))||void 0===e?void 0:e.classList.contains("active");this.referenceLineTool(t)},e.prototype.cancelToolAndDefaultViewport=function(){var e=(this.queryCurrentContainer()||{}).seriesDom,t=null==e?void 0:e.querySelector(".layoutImage.active"),n=od(od([],rd(this.synchronizer.getSourceElements()),!1),[t||e],!1);this.layoutView.topTools.cancelToolAndDefaultViewportTools(n)},e.prototype.saveImageTool=function(){var e,t,n,r,o=this.queryCurrentContainer()||{},a=o.seriesDom,i=o.seriesId,l=a.querySelector(".layoutImage.active"),c=null===(t=null===(e=a.querySelector("#filmMarker"))||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.replace("影像号：","_"),u=null===(n=l||a)||void 0===n?void 0:n.querySelector("canvas");if(!u)return Se().error({title:"请选择一个序列"});var d=u.toDataURL("image/png",1),f=rd((null===(r=this.querySeriesLoadIds(i))||void 0===r?void 0:r.imgs)||[{}],1)[0],h=f.name,p=f.mod,m=f.age,g=f.studt,v="".concat(h,"_").concat(m,"_").concat(p,"_").concat(g).concat(c||""),y=(0,s.env)(),b=y.isWeChat,w=y.isMobile;if(b&&w)return this.layoutView.createImageLayout(d,v);x(d,v)},e.prototype.disableSeriesTool=function(){var e=(this.queryCurrentContainer()||{}).seriesDom,t=e.dataset.seriesIndex;this.seriesLayoutState.removeSerie(Number(t)),delete e.dataset.seriesId,this.layoutView.clearSeriesLayout(e,!0)},e.prototype.invertTool=function(e){var n=this.queryCurrentContainer().seriesDom,r=n.querySelector(".layoutImage.active");n=r||n;var o=((0,t.getViewport)(n)||{}).invert,a=e.getHandler();e.setHandler((function(e,n,r){a&&a(e,n,r),function(e,n,r){if(r!==n){var o=(0,t.getViewport)(n),a=(0,t.getViewport)(r);a.invert!==o.invert&&(a.invert=o.invert,e.setViewport(r,a))}}(e,n,r)})),(0,t.setViewport)(n,{invert:!o})},e.prototype.referenceLineTool=function(e){var n,r,o;if(G(e?"ReferenceLinesOpen":"ReferenceLinesClose"),!e)return(0,a.setToolDisabled)("ReferenceLines");var i=new a.Synchronizer(t.EVENTS.NEW_IMAGE,a.updateImageSynchronizer),s=((null===(o=this.layoutView)||void 0===o?void 0:o.seriesLayout)||{}).seriesLayouts;try{for(var l=ad(s),c=l.next();!c.done;c=l.next()){var u=c.value,d=u.seriesDom;u.seriesId&&(d.querySelector(".layoutImage")||d.dataset.seriesId&&(ci(d),i.add(d)))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}(0,a.setToolEnabled)("ReferenceLines",{synchronizationContext:i}),s.length<this.seriesLayoutState.getStatesLength()&&console.warn("温馨提示：可视序列窗口数量少于序列总量，可能导致定位线不工作。1.将相关序列置于可视序列窗口中；2.可设置序列窗口数量大于等于序列总量")},e.prototype.magnifyTool=function(){this.layoutView.topTools.magnifyTool()},e.prototype.queryImage=function(){var e=this.queryCurrentContainer(),n=e.seriesDom,r=e.seriesId,o=this.querySeriesLoadIds(r),a=(0,t.getImage)(n),i=rd(o.imgs,1)[0].mod;return ed(ed({},a),{modality:i})},e.prototype.queryStudy=function(e){return this.studyArr.find((function(t){var n=t.studyuid;return e===n}))},e.prototype.querySeries=function(e){var t,n,r,o;try{for(var a=ad(this.studyArr),i=a.next();!i.done;i=a.next()){var s=i.value;if(o=null===(r=null==s?void 0:s.arrSeries)||void 0===r?void 0:r.find((function(t){return t.uuid===e})),o)break}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o},e.prototype.querySeriesLoadIds=function(e){return this.seriesLoadIds.find((function(t){return t.seriesUid===e}))},e.prototype.queryCurrentContainer=function(){return this.layoutView.seriesLayout.seriesLayouts.find((function(e){var t=e.seriesDom;return t.classList.contains("active")||t.parentElement.classList.contains("active")}))},e.prototype.queryCurrentSeries=function(e){void 0===e&&(e=this.queryCurrentContainer());var t=e.seriesId,n=e.seriesDom,r=this.querySeriesLoadIds(t);return ed({seriesId:t,seriesDom:n},r)},e.prototype.bindEvents=function(){var e,n,r=this,o=this.eventNamespace,i=(0,s.debounce)((function(){return(0,t.triggerEvent)(t.events,"window_resize")}),50);window.addEventListener("resize",(function(){i()})),window.addEventListener("keydown",(function(e){"Escape"===e.key&&Qu()}));try{for(var l=ad(["beforeunload","unload","pagehide","visibilitychange"]),u=l.next();!u.done;u=l.next()){var d=u.value;window.addEventListener(d,(function(){var e=U.instanceOptions.closePageResetDefault,t=void 0===e?{}:e,n=t.imageType,r=t.cacheImages,o=U.DBCacheImages;n&&(U.imageType=null),r&&(o.enable=o.enableDefault)}))}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}t.events.addEventNamespaceListener("layout_area_focus.".concat(o),(function(e){var t=e.detail.area;Me("multiImage",(0,s.throttle)((function(){switch(t){case"toolbarLayout":case"seriesLayout":case"seriesMPROr3DLayout":U.toolsBar.navigationBottomLayout||r.layoutView.seriesBarToggle(!1),r.layoutView.selectPopupHidden(),r.layoutView.navigationMenuColseHandle()}}),500,{trailing:!1}))})),t.events.addEventNamespaceListener("tool_series_layout.".concat(o),(function(e){var t=e.detail.ptCell;r.seriesCount=t,r.restoreSeries(r.seriesLayoutState.getSeries())})),t.events.addEventNamespaceListener("tool_series_image_layout.".concat(o),(function(e){return td(r,void 0,void 0,(function(){var n,r,o,a,i,l,c,u,d,f,h,p,m,g,v,y,b,x,w;return nd(this,(function(T){switch(T.label){case 0:return n=e.detail,r=n.ptCell,o=n.ptCell,a=o.x,i=o.y,l=this.queryCurrentContainer(),c=l.seriesDom,(u=l.seriesId)?(d=this.querySeries(u),f=this.querySeriesLoadIds(u),h=a*i==1,sd(c,0),this.layoutView.clearSeriesLayout(c,!0,!0),h?(p=c.dataset.seriesIndex,m=this.seriesLayoutState.getSynchronizerStatus(Number(p)),c.classList.remove("noActiveBorder"),hi(c),[4,this.displaySeriesByImageindex(c,f)]):[3,2]):[2];case 1:return T.sent(),this.layoutView.seriesLayout.initSingle(c,f,void 0,{synchronizerStatus:m}),[3,3];case 2:c.classList.add("noActiveBorder"),(0,t.triggerEvent)(t.events,"series_synchronizer_remove",{seriesDom:c,setSynchronizerStatus:!1}),this.layoutView.seriesLayout.createImagesLayout(c,d,r),this.displayDcmByImages(c,ed({series:d},f)),g=(0,s.env)(),v=g.isWeChat,y=g.isAndroid,v&&y&&(b=this.seriesCount,x=b.x,w=b.y,a*i+x*w>8&&console.warn("安卓版微信渲染序列图像过多可能导致失败!")),T.label=3;case 3:return(0,t.triggerEvent)(t.events,"image_active",{$canvas:c}),this.reloadReferenceLineTool(),[2]}}))}))})),t.events.addEventNamespaceListener("study_scroll.".concat(o),(function(e){return td(r,void 0,void 0,(function(){var n,r,o,a,i,s,l,c,u,d,f,h,p,m,g,v,y,b,x,w,T,I,S,C,E=this;return nd(this,(function(A){switch(A.label){case 0:for(d in n=e.detail,r=n.currentIndex,o=void 0===r?0:r,a=n.layoutCount,i=void 0===a?1:a,s=this.seriesLayoutState.getStates(),l=this.layoutView.seriesLayout.seriesLayouts,c=o*i,this.studyScrollIndex=o,this.layoutView.iconPlayer.playerRemove(),Qu(),u=[],l)u.push(d);f=0,A.label=1;case 1:if(!(f<u.length))return[3,7];h=u[f],A.label=2;case 2:return A.trys.push([2,5,,6]),p=Number(h)+c,m=l[h],g=m.seriesDom,v=s[p]||{},y=v.seriesId,b=v.studyUID,x=v.series,w=v.synchronizerStatus,T=v.scrollIndex,I=(x||{}).seriesLoadIds,m.seriesId=y,this.layoutView.clearSeriesLayout(g),ci(g),I?[4,this.displaySeriesByImageindex(g,I)]:[3,4];case 3:A.sent(),A.label=4;case 4:return this.layoutView.seriesLayout.initSingle(g,x,{seriesId:y,studyUID:b,seriesIndex:p},{synchronizerStatus:w,scrollIndex:T}),[3,6];case 5:return S=A.sent(),console.error(S),[3,6];case 6:return f++,[3,1];case 7:return C=(this.selectSeries||{}).seriesId,(0,t.triggerEvent)(t.events,"image_active",{seriesId:C}),this.layoutView.seriesLayout.toggleSeriesStyle({seriesId:C}),setTimeout((function(){E.reloadReferenceLineTool()}),500),o%2==1&&ai(),[2]}}))}))})),t.events.addEventNamespaceListener("series_scroll.".concat(o),(function(e){var t=e.detail,n=t.element,o=t.currentIndex,a=t.isSeriesImage,i=t.imageIds;a&&r.displayDcmByImages(n,{loadIds:i},o),r.seriesLayoutState.setScrollIndex(n.dataset.seriesIndex,o),r.layoutView.iconPlayer.toggleControlStyle(o,null==i?void 0:i.length);var s=r.synchronizer;s.timer&&clearTimeout(s.timer),s.enabled=!1,s.timer=setTimeout((function(){s.enabled=!0}),100)})),t.events.addEventNamespaceListener("tool_imageType.".concat(o),(function(e){return td(r,void 0,void 0,(function(){var t,n;return nd(this,(function(r){switch(r.label){case 0:return t=e.detail,n=t.type,t.custom||(U.imageType=n,this.imageType=n),this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.getStudyInfoCount=0,this.layoutView.seriesLayout.seriesLayouts=[],this.layoutView.imageType(e.detail),fi(),Bu(),G("imageTypeToggle",!0),bi([],{forceCancelAll:!0}),document.querySelectorAll(".iziToast").forEach((function(e){Se().hide({},e)})),b(this.layoutView.canvasContainer),b(this.layoutView.studyNavigationBody),b(this.layoutView.studyNavigationHead),[4,this.getStudyInfos()];case 1:return r.sent(),this.reloadReferenceLineTool(),[2]}}))}))})),t.events.addEventNamespaceListener("tool_wwwc.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.wwwcImage(t,e.detail)})),t.events.addEventNamespaceListener("tool_scale.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.scaleImage(t,e.detail)})),t.events.addEventNamespaceListener("tool_rotate.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.rotateImage(t,e.detail)})),t.events.addEventNamespaceListener("tool_colorMap.".concat(o),(function(e){var t=r.queryCurrentContainer().seriesDom;r.layoutView.colorMapImage(t,e.detail,r.synchronizer)})),t.events.addEventNamespaceListener("window_resize.".concat(o),(function(e){r.layoutView.resizeLayout(),U.env!==c()&&Se().info({title:"为了更好的体验，请刷新或重新进入"})}));var f=function(e,t){G("downloadActive"),bi(e,{countCallback:function(n,o,a){r.layoutView.progressCountStyle(t,e.length,a)}})};t.events.addEventNamespaceListener("navigator_dbClick_drag.".concat(o),(function(e){var t=e.detail.iconImage.seriesId,n=r.querySeries(t),o=n.seriesLoadIds,a=n.seriesLoadIds,i=a.loadIds,s=a.studyUID,l=r.queryCurrentContainer(),c=l.seriesDom,u=c.dataset.seriesIndex;r.selectSeries={seriesId:t,studyUID:s,seriesIndex:Number(u)},r.layoutView.iconPlayer.playerRemove(),r.layoutView.seriesLayout.toggleNavigatorInfo(t),f(i,t),r.layoutView.clearSeriesLayout(c),l.seriesId=t,r.seriesLayoutState.setState(Number(u),{studyUID:s,seriesId:t,series:n,scrollIndex:0,synchronizerStatus:!1}),r.layoutView.seriesLayout.initSingle(c,o,r.selectSeries),r.displaySeriesByImageindex(c,o)})),t.events.addEventNamespaceListener("first_active.".concat(o),(function(e){var n,o=e.detail.$canvas;(0,t.triggerEvent)(t.events,"canvas_active",{$canvas:o}),null===(n=r.layoutView.studyMenuLayout)||void 0===n||n.activeFirst()})),t.events.addEventNamespaceListener("navigator_active.".concat(o),(function(e){var n=e.detail,o=n.iconImage.seriesId,a=n.target,i=n.event.isTrusted,s=(r.selectSeries.seriesId,r.querySeriesLoadIds(o)),l=s.loadIds,c=s.studyUID,u=s.seriesIndex,d=r.seriesCount,h=d.x*d.y,p=r.seriesLayoutState.getSeriesActiveIndex(o);if(void 0===p)return Se().error({title:"该序列不在序列窗口中，图像未渲染，请".concat("mobile"===U.env?"长按添加":"拖拽","或双击添加到序列窗口"),timeout:1e4});r.selectSeries={seriesId:o,studyUID:c,seriesIndex:u},r.layoutView.iconPlayer.playerRemove(),r.layoutView.seriesLayout.toggleNavigatorInfo(o),i?f(l,o):r.layoutView.progressCountStyle(o);var m=Math.floor(p/h),g=m!==r.studyScrollIndex;g?r.layoutView.studySlider.setIndex(m):((0,t.triggerEvent)(t.events,"image_active",{seriesId:o}),r.layoutView.seriesLayout.toggleSeriesStyle({seriesId:o}));var v=r.layoutView.canvasContainer.querySelector(".signBigLayout");v&&setTimeout((function(){var e=r.layoutView.canvasContainer.querySelector(".layoutCellsOuter.active");!e||g&&e==v?null==a||a.click():(r.layoutView.seriesLayout.dblclickCanvasLayout(v,v.querySelector(".layoutCellsInner"),!0),r.layoutView.seriesLayout.dblclickCanvasLayout(e,e.querySelector(".layoutCellsInner"),!1))}),0)})),t.events.addEventNamespaceListener("canvas_active.".concat(o),(function(e){var n,o=e.detail,i=o.$canvas,s=o.type,l=i.dataset,c=l.seriesId,u=l.seriesIndex,d=l.studyUID,f=r.selectSeries.seriesId;if((0,t.triggerEvent)(t.events,"image_active",{$canvas:i}),r.selectSeries={seriesId:c,seriesIndex:u,studyUID:d},r.layoutView.seriesLayout.toggleSeriesStyle({target:i}),("wheel"===s||c!==f)&&(r.layoutView.seriesLayout.toggleNavigatorInfo(c),c))try{var h=rd((null===(n=(0,a.getToolState)(i,"stack"))||void 0===n?void 0:n.data)||[{}],1)[0],p=h.imageIds,m=void 0===p?[]:p,g=h.currentImageIdIndex,v=void 0===g?0:g;k.scroll?(bi(m.slice(v,v+Math.max(k.scrollNum,1))),r.layoutView.progressCountStyle(c,void 0,void 0,k.fullLoad)):bi(m,{countCallback:function(e,t,n){r.layoutView.progressCountStyle(c,m.length,n,k.fullLoad)}})}catch(e){xs(e)}})),t.events.addEventNamespaceListener("tool_event.".concat(o),(function(e){var n,o,i,s,l=e.detail,c=l.toolData,u=void 0===c?{}:c,d=l.btnTarget,f=l.btnOriginTarget,h=!(null==d?void 0:d.classList.contains("active")),p=!0,m=!0;switch(u.btnTarget=d,u.btnOriginTarget=f,Qu(),u.toolTag){case"seriesBar":m=!1,r.layoutView.seriesBarToggle(),r.layoutView.navigationMenuColseHandle();break;case"MPR":G("MPR"),r.initMPR(),r.layoutView.seriesBarToggle(!1);break;case"VRT":G("VRT"),r.initVRT(),r.layoutView.seriesBarToggle(!1);break;case"AI":r.initAI(h);break;case"imageType":r.layoutView.createImageTypeLayout(e);break;case"reload":G("reload"),r.reload2d();break;case"disableAllTool":r.layoutView.topTools.disableAllTool(r.synchronizer);break;case"modulation":var g=r.queryImage(),v=g.color,y=g.modality;e.detail.isPng=v,e.detail.modality=y,r.layoutView.topTools.modulationTool(r.synchronizer),u.select&&r.layoutView.createWWWCLayout(e);break;case"modulationMenu":var b=r.queryImage();v=b.color,y=b.modality;e.detail.isPng=v,e.detail.modality=y,r.layoutView.createWWWCLayout(e);break;case"stackScroll":r.layoutView.topTools.stackScrollTool(r.synchronizer);break;case"sharpen":r.layoutView.topTools.sharpenTool();break;case"blur":r.layoutView.topTools.blurTool();break;case"series":r.layoutView.createSeriesCellLayout(e,"series",{x:3,y:3},r.seriesCount);break;case"image":var x=(null===(n=r.queryCurrentContainer())||void 0===n?void 0:n.seriesDom.dataset)||{},w=x.imgRow,T=void 0===w?1:w,I=x.imgColumn,S=void 0===I?1:I;r.layoutView.createSeriesCellLayout(e,"image","mobile"===U.env?{x:3,y:3}:{x:5,y:5},{x:Number(S),y:Number(T)});break;case"move":r.layoutView.topTools.moveTool(r.synchronizer);break;case"scale":r.layoutView.topTools.scaleTool(r.synchronizer),u.select&&r.layoutView.createScaleLayout(e);break;case"rotate":r.layoutView.topTools.rotateTool(r.synchronizer),u.select&&r.layoutView.createRotateLayout(e);break;case"invert":r.invertTool(r.synchronizer);break;case"colorMap":r.layoutView.createColorMapLayout(e);break;case"referenceLine":r.referenceLineTool(h);break;case"DICOMMetaDataInfo":var C=r.queryCurrentContainer(),E=C.seriesId,A=C.seriesDom;if(!A.querySelector("canvas"))return Se().error({title:"请选择一个序列"});var M=rd((null===(o=(0,a.getToolState)(A,"stack"))||void 0===o?void 0:o.data)||[{}],1)[0].currentImageIdIndex,P=void 0===M?0:M,D=(null===(i=r.queryCurrentSeries({seriesId:E,seriesDom:A}))||void 0===i?void 0:i.imgs[P])||{},L=r.queryStudy(D.stuuid)||{},O=L.name,R=L.patientid,_=L.age,B=L.studydate,V=L.studyid,F=L.orgname;r.layoutView.createDICOMMetaDataInfoLayout(ed(ed({},D),{name:O,patid:R,age:_,acqdt:B,stuid:V,inst:F}));break;case"visibilityCavanAroundInfo":U.cavanAroundInfo=!U.cavanAroundInfo,r.layoutView.toggleCavanAroundInfoStyle(h);break;case"magnify":r.magnifyTool();break;case"angle":r.layoutView.topTools.angleTools();break;case"cobbAngle":r.layoutView.topTools.cobbAngleTools();break;case"straightline":r.layoutView.topTools.straightlineTools();break;case"rect":r.layoutView.topTools.rectangleRoiTools();break;case"elliptical":r.layoutView.topTools.ellipticalRoiTools();break;case"circle":r.layoutView.topTools.circleRoiTools();break;case"freehandRoi":r.layoutView.topTools.FreehandRoiTool();break;case"timeplay":var j=r.queryCurrentSeries(),H=null===(s=j.loadIds)||void 0===s?void 0:s.length;if(m=!1,H>=1){var z=j.seriesDom,q=z.parentElement,W=z.parentElement.querySelector("div.player-bar");r.layoutView.iconPlayer.playerAllPauseAndRemove(),W||(r.layoutView.iconPlayer.createPlayer(z,q,j),H>1&&r.layoutView.iconPlayer.playerStart())}else Se().error({title:"请选择一个序列"});break;case"probeCT":r.layoutView.topTools.ProbeCTTool();break;case"arrowAnnotate":r.layoutView.topTools.ArrowAnnotateTool();break;case"annotate":r.layoutView.topTools.AnnotateTool();break;case"lMarker":r.layoutView.topTools.lrMarkerTool("L");break;case"rMarker":r.layoutView.topTools.lrMarkerTool("R");break;case"ctr":r.layoutView.topTools.heartratioTool();break;case"cancelToolAndDefaultViewport":r.cancelToolAndDefaultViewport();break;case"cancelToolState":var Y=(r.queryCurrentContainer()||{}).seriesDom,Z=Y.querySelector(".layoutImage.active");r.layoutView.topTools.cancelTool(Y),Z&&r.layoutView.topTools.cancelTool(Z);break;case"eraser":r.layoutView.topTools.EraserTools();break;case"saveImage":r.saveImageTool();break;case"disableSeries":r.disableSeriesTool();break;case"useCacheImage":if(bi([],{forceCancelAll:!0}),!h){var X="缓存功能即将关闭，低内存手机建议打开!";if(k.fullLoad){if(X="全量下载模式下请保持缓存功能打开，否则可能影响下载效果！是否关闭？",!confirm(X)){p=!1;break}}else setTimeout((function(){Se().info({title:X})}),0);(0,t.triggerEvent)(t.events,"tool_imageType",{custom:!0})}N.enable=h;break;case"imageCacheType":if(h)Se().info({title:String("高性能模式即将打开，建议高性能设备使用，如遇问题请关闭或刷新即会自动关闭!")});else if(!N.enable){var Q=r.layoutView.toolsContainer.querySelector(".select-popup-item.useCacheImage");null==Q||Q.click()}U.imageCacheTypeDefault=h?1:0,G("imageCacheType");break;case"aboutUs":r.layoutView.createAboutUsLayout(U.aboutUs)}p&&r.layoutView.toggleToolStyle(u),m&&r.layoutView.iconPlayer.playerPause()})),t.events.addEventNamespaceListener("images_viewport.".concat(o),(function(e){var t=e.detail,n=t.element,r=t.viewport,o=r.voi,a=o.windowWidth,i=o.windowCenter,s=r.scale,l=n.querySelector("#wwWMarker"),c=n.querySelector("#wwHMarker"),u=n.querySelector("#scaleMarker");l&&(l.innerHTML="窗宽："+(null==a?void 0:a.toFixed(2))),c&&(c.innerHTML="窗位："+(null==i?void 0:i.toFixed(2))),u&&(u.innerHTML="倍数："+(null==s?void 0:s.toFixed(2)))})),t.events.addEventNamespaceListener("iconplayer_series.".concat(o),(function(e){var t=e.detail;r.layoutView.iconPlayer.playerBarClickHandle(t)})),t.events.addEventNamespaceListener("series_synchronizer_add.".concat(o),(function(e){var t=e.detail.element;r.synchronizer.add(t),r.synchronizerStackImageIndex.add(t),r.seriesLayoutState.setSynchronizerStatus(t.dataset.seriesIndex,!0)})),t.events.addEventNamespaceListener("series_synchronizer_remove.".concat(o),(function(e){var t=e.detail,n=t.element,o=t.setSynchronizerStatus,a=void 0===o||o;r.synchronizer.remove(n),r.synchronizerStackImageIndex.remove(n),a&&r.seriesLayoutState.setSynchronizerStatus(n.dataset.seriesIndex,!1)})),t.events.addEventNamespaceListener("".concat(t.EVENTS.IMAGE_CACHE_FULL,".").concat(o),(function(e){console.error("影像可使用缓存不足，可能导致功能异常",e),G(t.EVENTS.IMAGE_CACHE_FULL,!0)})),t.events.addEventNamespaceListener("".concat(t.EVENTS.WEBGL_TEXTURE_CACHE_FULL,".").concat(o),(function(e){console.error("影像绘制可使用缓存不足，可能导致功能异常",e),G(t.EVENTS.WEBGL_TEXTURE_CACHE_FULL,!0)}))},e.prototype.removeEventListener=function(){var e,n,r=this.eventNamespace;window.onresize=void 0;try{for(var o=ad(["tool_series_layout","tool_series_image_layout","study_scroll","series_scroll","tool_imageType","tool_wwwc","tool_scale","tool_rotate","tool_colorMap","window_resize","navigator_dbClick_drag","first_active","image_active","navigator_active","canvas_active","canvas_active.player","tool_event","tool_event.VRT","layout_area_focus","images_viewport","iconplayer_series","series_synchronizer_add","series_synchronizer_remove"]),a=o.next();!a.done;a=o.next()){var i=a.value;i.indexOf(".")<=0&&(i+=".".concat(r)),t.events.removeEventNamespaceListener(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},e.getMenuDefault=function(){return Ri},e.prototype.destroy=function(){var e;if(this.isDestroy)throw new Error("实例已销毁，请勿重复调用,请将实例赋值为null或undefined");this.layoutView.iconPlayer.playerAllPauseAndRemove(),Qu(),Ae.clear(),Bu(),null===(e=n.g.webDicomViewMPR)||void 0===e||e.MPRDestroy(),vl(),fi(),G("destroy",!0),bi([],{forceCancelAll:!0}),(0,ii.configure)({parent:"body"}),this.layoutView.seriesLayout.seriesLayouts=[],this.studyUIDArr=[],this.iconImagesArr=[],this.seriesLoadIds=[],this.studyArr=[],this.seriesLoadIds=[],this.selectSeries={},this.removeEventListener(),b(this.layoutView.canvasContainer),b(this.globalContainer),this.globalContainer.classList.remove("dicomView"),this.synchronizer=void 0,this.synchronizerStackImageIndex=void 0,this.seriesLayoutState=void 0,this.globalContainer=void 0,this.isDestroy=!0},e}();const cd=ld})(),r=r.default})()));